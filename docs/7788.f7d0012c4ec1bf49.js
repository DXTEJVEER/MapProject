var s7=Object.defineProperty,n7=Object.defineProperties,o7=Object.getOwnPropertyDescriptors,$E=Object.getOwnPropertySymbols,q2=Object.prototype.hasOwnProperty,eS=Object.prototype.propertyIsEnumerable,Q2=(dt,Re,T)=>Re in dt?s7(dt,Re,{enumerable:!0,configurable:!0,writable:!0,value:T}):dt[Re]=T,or=(dt,Re)=>{for(var T in Re||(Re={}))q2.call(Re,T)&&Q2(dt,T,Re[T]);if($E)for(var T of $E(Re))eS.call(Re,T)&&Q2(dt,T,Re[T]);return dt},yi=(dt,Re)=>n7(dt,o7(Re)),WT=(dt,Re)=>{var T={};for(var x in dt)q2.call(dt,x)&&Re.indexOf(x)<0&&(T[x]=dt[x]);if(null!=dt&&$E)for(var x of $E(dt))Re.indexOf(x)<0&&eS.call(dt,x)&&(T[x]=dt[x]);return T};(self.webpackChunkbeachSports=self.webpackChunkbeachSports||[]).push([[7788],{7788:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{ArcgisModule:()=>KF});var x=T(69808),A=T(31223);T(32076),T(68306),T(54742),T(38421),T(77669),T(25403),T(83268),T(31810);var ue=T(54004);let tn=(()=>{class _{}return _.\u0275fac=function(O){return new(O||_)},_.\u0275mod=A.oAB({type:_}),_.\u0275inj=A.cJS({}),_})();const Vn=new A.OlP("NgModelWithFormControlWarning");let Go=(()=>{class _{}return _.\u0275fac=function(O){return new(O||_)},_.\u0275mod=A.oAB({type:_}),_.\u0275inj=A.cJS({imports:[[tn]]}),_})(),Do=(()=>{class _{static withConfig(O){return{ngModule:_,providers:[{provide:Vn,useValue:O.warnOnNgModelWithFormControl}]}}}return _.\u0275fac=function(O){return new(O||_)},_.\u0275mod=A.oAB({type:_}),_.\u0275inj=A.cJS({imports:[Go]}),_})();var za,bl=T(65271),Ai=T(15861),Ze=T(17626),lo=T(73386),ol=T(91558),Pn=T(46160),o0=T(89726),Fl=T(94573),Ls=T(26584),xn=T(86810),al=T(58817),da=T(47996),Xa=T(47877),pn=T(63290),zi=T(10699),nt=T(77712),Ro=T(90912),ui=T(76898),dd=T(99433),Cl=T(85931),Jo=T(8314),vc=(T(82255),T(55342));let Wu=za=class extends xn.wq{constructor(_){super(_),this.type="none"}clone(){return new za({type:this.type})}};(0,Ze._)([(0,vc.J)({none:"none",stayAbove:"stay-above"})],Wu.prototype,"type",void 0),Wu=za=(0,Ze._)([(0,ui.j)("esri.ground.NavigationConstraint")],Wu);var tc,zn=T(92236);const lu=pn.Z.getLogger("esri.Ground");let ha=tc=class extends((0,xn.eC)(da.Z)){constructor(_){super(_),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new Pn.Z;const v=D=>{D.parent&&D.parent!==this&&"remove"in D.parent&&D.parent.remove(D),D.parent=this,"elevation"!==D.type&&"base-elevation"!==D.type&&lu.error(`Layer '${D.title}, id:${D.id}' of type '${D.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)};this.layers.on("after-add",D=>v(D.item)),this.layers.on("after-remove",D=>(D=>{D.parent=null})(D.item))}initialize(){this.when().catch(_=>{lu.error("#load()","Failed to load ground",_)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const _=this.layers.removeAll();for(const v of _)v.destroy();this.layers.destroy()}normalizeCtorArgs(_){return _&&"resourceInfo"in _&&(this._set("resourceInfo",_.resourceInfo),delete(_=or({},_)).resourceInfo),_}set layers(_){this._set("layers",(0,o0.Z)(_,this._get("layers")))}writeLayers(_,v,O,D){const w=[];_&&(D=yi(or({},D),{layerContainerType:"ground"}),_.forEach(te=>{if("write"in te){const fe={};(0,Fl.sM)(te)().write(fe,D)&&w.push(fe)}else D&&D.messages&&D.messages.push(new Ls.Z("layer:unsupported",`Layers (${te.title}, ${te.id}) of type '${te.declaredClass}' cannot be persisted in the ground`,{layer:te}))})),v.layers=w}load(_){return this.addResolvingPromise(this._loadFromSource(_)),Promise.resolve(this)}loadAll(){return(0,Xa.G)(this,_=>{_(this.layers)})}queryElevation(_,v){var O=this;return(0,Ai.Z)(function*(){yield O.load({signal:null==v?void 0:v.signal});const{ElevationQuery:D}=yield T.e(2493).then(T.bind(T,42493));(0,zi.k_)(v);const w=new D,te=O.layers.filter(Wd).toArray();return w.queryAll(te,_,v)})()}createElevationSampler(_,v){var O=this;return(0,Ai.Z)(function*(){yield O.load({signal:null==v?void 0:v.signal});const{ElevationQuery:D}=yield T.e(2493).then(T.bind(T,42493));(0,zi.k_)(v);const w=new D,te=O.layers.filter(Wd).toArray();return w.createSamplerAll(te,_,v)})()}clone(){const _={opacity:this.opacity,surfaceColor:(0,al.d9)(this.surfaceColor),navigationConstraint:(0,al.d9)(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(_.loadStatus="loaded"),new tc({resourceInfo:this.resourceInfo}).set(_)}read(_,v){this.resourceInfo||this._set("resourceInfo",{data:_,context:v}),super.read(_,v)}_loadFromSource(_){const v=this.resourceInfo;return v?this._loadLayersFromJSON(v.data,v.context,_):Promise.resolve(null)}_loadLayersFromJSON(_,v,O){const D=v&&v.origin||"web-scene",w=v&&v.portal||null,te=v&&v.url||null;return Promise.all([T.e(7534),T.e(1074)]).then(T.bind(T,71074)).then(({populateOperationalLayers:fe})=>{(0,zi.k_)(O);const Pe=[];return _.layers&&Array.isArray(_.layers)&&Pe.push(fe(this.layers,_.layers,{context:{origin:D,url:te,portal:w,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"})),(0,zi.as)(Pe)}).then(()=>{})}};function Wd(_){return"elevation"===_.type||function Xo(_){return _&&"createElevationSampler"in _}(_)}(0,Ze._)([(0,nt.Cb)({json:{read:!1}})],ha.prototype,"layers",null),(0,Ze._)([(0,dd.c)("layers")],ha.prototype,"writeLayers",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],ha.prototype,"resourceInfo",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:Ro.z8,read:{reader:zn.b,source:"transparency"},write:{writer:(_,v)=>{v.transparency=(0,zn.a)(_)},target:"transparency"}}})],ha.prototype,"opacity",void 0),(0,Ze._)([(0,nt.Cb)({type:ol.Z,json:{type:[Ro.z8],write:(_,v)=>{v.surfaceColor=_.toJSON().slice(0,3)}}})],ha.prototype,"surfaceColor",void 0),(0,Ze._)([(0,nt.Cb)({type:Wu,json:{write:!0}})],ha.prototype,"navigationConstraint",void 0),ha=tc=(0,Ze._)([(0,ui.j)("esri.Ground")],ha);const Sa=ha;var Bi=T(14517),Bc=T(46882),sa=T(61885),lt=T(62208),Ga=T(66656);function Vd(_){var v;return!(!(_&&_.loaded&&"capabilities"in _&&(null==(v=null==_?void 0:_.capabilities)?void 0:v.operations)&&"supportsEditing"in _.capabilities.operations&&!0===_.capabilities.operations.supportsEditing)||"editingEnabled"in _&&!_.editingEnabled)}var Ha=T(59318),ll=T(21726),zd=T(33954);const Nc=pn.Z.getLogger("esri.support.basemapUtils");var cu=T(38953);const Vc=pn.Z.getLogger("esri.support.groundUtils"),ul={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};var sc=T(6432),gd=T(6119);let ho=class extends((0,gd.Q)((0,sc.K)(sa.Z.EventedMixin(Bi.Z)))){constructor(_){super(_),this.allLayers=new Bc.Z({getCollections:()=>{var v,O,D;return[null==(v=this.basemap)?void 0:v.baseLayers,null==(O=this.ground)?void 0:O.layers,this.layers,null==(D=this.basemap)?void 0:D.referenceLayers]},getChildrenFunction:v=>"layers"in v?v.layers:null}),this.allTables=(0,cu.a)(this),this.basemap=null,this.editableLayers=new Bc.Z({getCollections:()=>[this.allLayers],itemFilterFunction:Vd}),this.ground=new Sa,this._basemapCache={}}destroy(){var _,v;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),null==(_=this.ground)||_.destroy(),null==(v=this.basemap)||v.destroy(),function Ch(_){for(const v in _){const O=_[v];!1===(null==O?void 0:O.destroyed)&&O.destroy(),delete _[v]}}(this._basemapCache),this._basemapCache=null}castBasemap(_){return function Qo(_,v){let O;if("string"==typeof _){if(!(_ in zd.s)){const D=Object.entries(zd.s).filter(([w,te])=>Ha.Z.apiKey&&!te.classic||!Ha.Z.apiKey&&te.classic&&!te.deprecated).map(([w])=>`"${w}"`).join(", ");return Nc.warn(`Unable to find basemap definition for: ${_}. Try one of these: ${D}`),null}v&&(O=v[_]),O||(O=lo.default.fromId(_),v&&(v[_]=O))}else O=(0,Ro.se)(lo.default,_);return(null==O?void 0:O.destroyed)&&(Nc.warn("The provided basemap is already destroyed",{basemap:O}),O=null),O}(_,this._basemapCache)}castGround(_){const v=function pa(_){let v=null;return"string"==typeof _?_ in ul?v=new Sa({resourceInfo:{data:{layers:[ul[_]]}}}):Vc.warn(`Unable to find ground definition for: ${_}. Try "world-elevation"`):v=(0,Ro.se)(Sa,_),v}(_);return(0,lt.Wi)(v)?this._get("ground"):v}findLayerById(_){return this.allLayers.find(v=>v.id===_)}findTableById(_){return this.allTables.find(v=>v.id===_)}};(0,Ze._)([(0,nt.Cb)({readOnly:!0,dependsOn:[]})],ho.prototype,"allLayers",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],ho.prototype,"allTables",void 0),(0,Ze._)([(0,nt.Cb)({type:lo.default})],ho.prototype,"basemap",void 0),(0,Ze._)([(0,Ga.p)("basemap")],ho.prototype,"castBasemap",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],ho.prototype,"editableLayers",void 0),(0,Ze._)([(0,nt.Cb)({type:Sa,nonNullable:!0})],ho.prototype,"ground",void 0),(0,Ze._)([(0,Ga.p)("ground")],ho.prototype,"castGround",null),ho=(0,Ze._)([(0,ui.j)("esri.Map")],ho);const nc=ho;var Hd=T(79608),ga=T(23719),li=T(21286),Kd=T(68653),vs=T(49672);let Qa=class extends((0,Hd.J)(xn.wq)){constructor(..._){super(..._),this.position=new vs.Z([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(_,v,O,D){if(_&&"object"==typeof _&&("x"in _||Array.isArray(_))){const w={position:_};return null!=v&&(w.heading=v),null!=O&&(w.tilt=O),null!=D&&(w.fov=D),w}return _}writePosition(_,v,O,D){const w=_.clone();w.x=(0,Ro.q9)(_.x||0),w.y=(0,Ro.q9)(_.y||0),w.z=_.hasZ?(0,Ro.q9)(_.z||0):_.z,v[O]=w.write({},D)}readPosition(_,v){const O=new vs.Z;return O.read(_,v),O.x=(0,Ro.q9)(O.x||0),O.y=(0,Ro.q9)(O.y||0),O.z=O.hasZ?(0,Ro.q9)(O.z||0):O.z,O}equals(_){return!!_&&this.tilt===_.tilt&&this.heading===_.heading&&this.fov===_.fov&&this.position.equals(_.position)}};(0,Ze._)([(0,nt.Cb)({type:vs.Z,json:{write:{isRequired:!0}}})],Qa.prototype,"position",void 0),(0,Ze._)([(0,dd.c)("position")],Qa.prototype,"writePosition",null),(0,Ze._)([(0,Kd.r)("position")],Qa.prototype,"readPosition",null),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,Ga.p)(_=>ga.BV.normalize((0,Ro.q9)(_)))],Qa.prototype,"heading",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,Ga.p)(_=>(0,li.uZ)((0,Ro.q9)(_),-180,180))],Qa.prototype,"tilt",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],Qa.prototype,"fov",void 0),Qa=(0,Ze._)([(0,ui.j)("esri.Camera")],Qa);const qo=Qa;var du,uu=T(29132),Dn=T(88879),Wl=T(91179);let oc=du=class extends xn.wq{constructor(_){super(_),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(_){return(_%=360)<0&&(_+=360),_}clone(){return new du({rotation:this.rotation,scale:this.scale,targetGeometry:(0,lt.pC)(this.targetGeometry)?this.targetGeometry.clone():null,camera:(0,lt.pC)(this.camera)?this.camera.clone():null})}};function Bo(){return{enabled:!this.camera}}(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Bo}}}}})],oc.prototype,"rotation",void 0),(0,Ze._)([(0,Ga.p)("rotation")],oc.prototype,"castRotation",null),(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:Bo}}}}})],oc.prototype,"scale",void 0),(0,Ze._)([(0,nt.Cb)({types:uu.qM,json:{read:Wl.im,write:!0,origins:{"web-scene":{read:Wl.im,write:{overridePolicy:Bo}}}}})],oc.prototype,"targetGeometry",void 0),(0,Ze._)([(0,nt.Cb)({type:qo,json:{write:!0}})],oc.prototype,"camera",void 0),oc=du=(0,Ze._)([(0,ui.j)("esri.Viewpoint")],oc);const Ra=oc;var zc=T(40764),mt=T(17770),Ut=T(54024),Tt=T(56354),ft=T(73234),pt=T(32917),rt=T(50618),dr=T(23841),wr=T(59289),$t=T(28093),Or=T(28705),fi=T(79334),ci=T(55915),qr=T(65401),_s=T(41743),$s=T(93088),Ri=T(83137),Ws=T(72469);const Vs=pn.Z.getLogger("esri.support.AnalysesCollection");let po=class extends Or.a{constructor(_){super(_),this.handles.add(this.on("before-add",v=>{(0,lt.Wi)(v.item)||v.item.parent===this.owner&&(Vs.warn("Analysis inside the collection must be unique. Not adding this element again."),v.preventDefault())}))}_own(_){_.parent=this.owner}_release(_){_.parent=null}};po=(0,Ze._)([(0,ui.j)("esri.support.AnalysesCollection")],po);var co=T(35575),cn=T(72392);const ac={widthBreakpoint:{getValue(_){const v=_.viewSize[0],O=_.breakpoints,D=this.values;return v<=O.xsmall?D.xsmall:v<=O.small?D.small:v<=O.medium?D.medium:v<=O.large?D.large:D.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(_){const v=_.viewSize[1],O=_.breakpoints,D=this.values;return v<=O.xsmall?D.xsmall:v<=O.small?D.small:v<=O.medium?D.medium:v<=O.large?D.large:D.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(_){const v=_.viewSize,w=this.values;return v[1]>=v[0]?w.portrait:w.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},oo={xsmall:544,small:768,medium:992,large:1200};function dp(_,v){return v?ac[_].valueToClassName[v].split(" "):[]}const lc=_=>{let v=class extends _{constructor(...O){super(...O),this._breakpointsHandles=new cn.Z,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=oo}initialize(){this._breakpointsHandles.add((0,pt.YP)(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),pt.nn))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=(0,lt.SC)(this._breakpointsHandles))}set breakpoints(O){if(O===this._get("breakpoints"))return;const D=function Zd(_){return _&&_.xsmall<_.small&&_.small<_.medium&&_.medium<_.large}(O);if(!D){const w=JSON.stringify(oo,null,2);console.warn("provided breakpoints are not valid, using defaults:"+w)}this._set("breakpoints",or({},O=D?O:oo))}_updateClassNames(){if(!this.container)return;const O=co.Z.acquire(),D=co.Z.acquire();let w,te=!1;for(w in ac){const fe=this[w],Pe=ac[w].getValue({viewSize:this.size,breakpoints:this.breakpoints});fe!==Pe&&(te=!0,this[w]=Pe,dp(w,fe).forEach(Ue=>D.push(Ue)),dp(w,Pe).forEach(Ue=>O.push(Ue)))}te&&(this._applyClassNameChanges(O,D),co.Z.release(O),co.Z.release(D))}_applyClassNameChanges(O,D){const w=this.container;w&&(D.forEach(te=>w.classList.remove(te)),O.forEach(te=>w.classList.add(te)))}_removeActiveClassNames(){const O=this.container;if(!O)return;let D;for(D in ac)dp(D,this[D]).forEach(w=>O.classList.remove(w))}};return(0,Ze._)([(0,nt.Cb)()],v.prototype,"breakpoints",null),(0,Ze._)([(0,nt.Cb)()],v.prototype,"orientation",void 0),(0,Ze._)([(0,nt.Cb)()],v.prototype,"widthBreakpoint",void 0),(0,Ze._)([(0,nt.Cb)()],v.prototype,"heightBreakpoint",void 0),v=(0,Ze._)([(0,ui.j)("esri.views.BreakpointsOwner")],v),v};var Vl=T(59029),Ho=T(33190),$d=T(13762),ks=T(10558);const kd=pn.Z.getLogger("esri.views.support.GroundViewElevationSampler");let hu=class extends sa.Z.EventedAccessor{constructor(_){super(_),this.demResolution={min:-1,max:-1},this.noDataValue=ks.$7}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const _=this.view.basemapTerrain;if((0,lt.Wi)(_.extent)||!_.spatialReference)return null;const v=(0,qr.HH)(_.extent,_.spatialReference);return v.zmin=_.elevationBounds.min,v.zmax=_.elevationBounds.max,v}elevationAt(_,v){if((0,lt.Wi)(this.extent)||!(0,Ho.Kv)(this.extent,_,v)){const O=(0,lt.pC)(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return kd.warn("#elevationAt()",`Point used to sample elevation (${_}, ${v}) is outside of the sampler extent (${O})`),this.noDataValue}return(0,lt.Pt)(this.view.elevationProvider.getElevation(_,v,0,this.spatialReference,"ground"),this.noDataValue)}queryElevation(_){return(0,$d.G$)(_.clone(),this)}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],hu.prototype,"demResolution",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],hu.prototype,"extent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],hu.prototype,"noDataValue",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],hu.prototype,"spatialReference",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],hu.prototype,"view",void 0),hu=(0,Ze._)([(0,ui.j)("esri.views.support.GroundViewElevationSampler")],hu);const dl=hu;let zl=class extends Bi.Z{constructor(_){super(_),this.handles=new cn.Z,this.view=null,this.layerViews=new Pn.Z}initialize(){this.handles.add((0,pt.gx)(()=>{var _,v;return null==(v=null==(_=this.view)?void 0:_.map)?void 0:v.ground},_=>_.load())),this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this._set("view",null),this.handles&&(this.handles.destroy(),this.handles=null)}get elevationSampler(){return this.view?"2d"===this.view.type?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new dl({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(_=>_.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.handles.remove("updating"),this.handles.add(this.layerViews.map(_=>(0,pt.YP)(()=>_.updating,()=>this._updateUpdating(),pt.Z_)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],zl.prototype,"elevationSampler",null),(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],zl.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],zl.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:Pn.Z,readOnly:!0})],zl.prototype,"layerViews",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],zl.prototype,"suspended",null),zl=(0,Ze._)([(0,ui.j)("esri.views.GroundView")],zl);const Gc=zl,l0=_=>{let v=class extends _{fetchPopupFeatures(O,D){var w=this;return(0,Ai.Z)(function*(){yield w.when();const{location:te,queryArea:fe,layerViewsAndGraphics:Pe,clientOnlyGraphics:Ue}=yield w._prepareFetchPopupFeatures(O,D),Xe=Promise.resolve(Ue),st=w._queryLayerPopupFeatures(fe,Pe,D),vt=st.map(Ct=>Ct.promise);return{location:te,clientOnlyGraphics:Ue,allGraphicsPromise:(0,zi.WW)([Xe,...vt]).then(Ct=>Array.from(new Set(Ct.flat()))),promisesPerLayerView:st}})()}_queryLayerPopupFeatures(O,D,w){return D.map(({layerView:te,graphics:fe})=>{const Pe={clientGraphics:fe,event:(0,lt.pC)(w)?w.event:null,signal:(0,lt.pC)(w)?w.signal:null,defaultPopupTemplateEnabled:!!(0,lt.pC)(w)&&!!w.defaultPopupTemplateEnabled},Ue=te.fetchPopupFeatures(O,Pe);return{layerView:te,promise:Ue}})}_isValidPopupGraphic(O,D){return O&&!!O.getEffectivePopupTemplate((0,lt.pC)(D)&&D.defaultPopupTemplateEnabled)}_prepareFetchPopupFeatures(O,D){var w=this;return(0,Ai.Z)(function*(){const{clientGraphics:te,queryArea:fe,location:Pe}=yield w._popupHitTestGraphics(O,D),Ue=w._getFetchPopupLayerViews(),{layerViewsAndGraphics:Xe,clientOnlyGraphics:st}=w._graphicsPerFetchPopupLayerView(te,Ue);return{clientOnlyGraphics:st,layerViewsAndGraphics:Xe,queryArea:fe,location:Pe}})()}_popupHitTestGraphics(O,D){var w=this;return(0,Ai.Z)(function*(){const{results:te,mapPoint:fe}=yield w.popupHitTest(O),Pe=te.filter(Xe=>"graphic"===Xe.type&&w._isValidPopupGraphic(Xe.graphic,D)),Ue=Pe.length?Pe[0].mapPoint:null;return{clientGraphics:Pe.map(Xe=>Xe.graphic),queryArea:fe,location:fe||Ue}})()}_getFetchPopupLayerViews(){const O=[];return this.allLayerViews.forEach(D=>{this._isValidPopupLayerView(D)&&O.push(D)}),(0,lt.pC)(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&O.push(this.graphicsView),O.reverse()}_isValidPopupLayerView(O){return(0,lt.pC)(O)&&(!("layer"in O)||!O.suspended)&&"fetchPopupFeatures"in O}_graphicsPerFetchPopupLayerView(O,D){const w=[],te=new Map,fe=D.map(Pe=>{const Ue=[];return te.set("layer"in Pe?Pe.layer:Pe.graphics,Ue),{layerView:Pe,graphics:Ue}});for(const Pe of O){const Ue=te.get(Pe.layer)||te.get(Pe.sourceLayer)||null;Ue?Ue.push(Pe):w.push(Pe)}return{layerViewsAndGraphics:fe,clientOnlyGraphics:w}}};return v=(0,Ze._)([(0,ui.j)("esri.views.PopupView")],v),v};var hp=T(97478),cc=T(80542),pp=T(60330),Ss=T(83960),To=T(2004),Xn=T(65234),qs=T(37053),Ph=T(51815);let uc=class extends Bi.Z{constructor(_){super(_),this.view=null,this.baseLayerViews=new Pn.Z,this.referenceLayerViews=new Pn.Z,this._loadingHandle=(0,pt.YP)(()=>{var v,O;return null==(O=null==(v=this.view)?void 0:v.map)?void 0:O.basemap},v=>{v&&v.load().catch(()=>{})},pt.nn)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null)}get suspended(){return!this.view||this.view.suspended}get updating(){var v,O;if(this.view&&this.view.suspended)return!1;const _=null==(O=null==(v=this.view)?void 0:v.map)?void 0:O.basemap;return!!_&&!!_.loaded&&(this.baseLayerViews.some(D=>D.updating)||this.referenceLayerViews.some(D=>D.updating))}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],uc.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],uc.prototype,"baseLayerViews",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],uc.prototype,"referenceLayerViews",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],uc.prototype,"suspended",null),(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],uc.prototype,"updating",null),uc=(0,Ze._)([(0,ui.j)("esri.views.BasemapView")],uc);var ya=T(88159),Yd=T(17760);const n_=pn.Z.getLogger("esri.views.LayerViewManager");class zu{constructor(v,O,D){this.layer=v,this.view=O,this.layerViewImporter=D,this._controller=new AbortController,this._deferred=(0,zi.dD)(),this._started=!1,this.done=!1,(0,zi.fu)(this._controller.signal,()=>{const w=new Ls.Z("cancelled:layerview-create","layerview creation cancelled",{layer:v});this._deferred.reject(w)})}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:v}=this;if(!v)return;const{layer:O,view:D}=this;O.emit("layerview-destroy",{view:D,layerView:v}),D.emit("layerview-destroy",{layer:O,layerView:v}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}start(){var v=this;return(0,Ai.Z)(function*(){var te,fe;if(v._started)return;v._started=!0;const{_controller:{signal:O},layer:D,view:w}=v;v._map=w.map;try{let Pe,Ue;if(yield D.load({signal:O}),"prefetchResources"in D&&(yield D.prefetchResources({signal:O})),D.createLayerView)Pe=yield D.createLayerView(w,{signal:O});else{if(!v.layerViewImporter.hasLayerViewModule(D))throw new Ls.Z("layer:view-not-supported","No layerview implementation was found");const vt=yield v.layerViewImporter.importLayerView(D);(0,zi.k_)(O),Pe="default"in vt?new vt.default({layer:D,view:w}):new vt({layer:D,view:w})}const Xe=()=>{Ue=(0,lt.hw)(Ue),Pe.destroyed||Pe.destroy(),Pe.layer=null,Pe.parent=null,Pe.view=null,v.done=!0};Ue=(0,zi.fu)(O,Xe),(0,zi.k_)(O);try{yield Pe.when()}catch(vt){throw Xe(),vt}if(!(null==(fe=null==(te=v._map)?void 0:te.allLayers)?void 0:fe.includes(D)))return Xe(),void v._deferred.reject(new Ls.Z("view:no-layerview-for-layer","The layer has been removed from the map",{layer:D}));v.layerView=Pe,D.emit("layerview-create",{view:w,layerView:Pe}),w.emit("layerview-create",{layer:D,layerView:Pe}),v.done=!0,v._deferred.resolve(Pe)}catch(Pe){D.emit("layerview-create-error",{view:w,error:Pe}),w.emit("layerview-create-error",{layer:D,error:Pe}),v.done=!0,v._deferred.reject(new Ls.Z("layerview:create-error","layerview creation failed",{layer:D,error:Pe}))}})()}}let Tl=class extends cc.r{constructor(_){super(_),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new Yd.t,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var O;const v=null==(O=this.view.map)?void 0:O.allLayers;if(v)for(const D of v)this.layerViewImporter.hasLayerViewModule(D)&&this.layerViewImporter.importLayerView(D)},this._reschedule=()=>((0,lt.Wi)(this._workPromise)&&(this._workPromise=(0,zi.dD)()),this.handles.remove("reschedule"),this.handles.add((0,rt.Os)(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var te,fe,Pe;const v=this.view.map;if(this._map!==v&&(this.clear(),this._map=v),(0,lt.Wi)(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const O=new Bc.Z({getCollections:()=>this._rootCollectionNames.map(Ue=>this.get(Ue)),getChildrenFunction:Ue=>Ue&&"layers"in Ue?Ue.layers:null});if(!O)return this._workPromise.resolve(),void(this._workPromise=null);for(const Ue of O)this._createLayerView(Ue);this._refreshCollections();for(const[Ue,Xe]of this._layerLayerViewInfoMap)O.includes(Ue)||(this._layerLayerViewInfoMap.delete(Xe.layer),Xe.destroy());const D=O.filter(Ue=>"group"===Ue.type).map(Ue=>Ue.layers),w=[null==(te=null==v?void 0:v.ground)?void 0:te.layers,null==(fe=null==v?void 0:v.basemap)?void 0:fe.baseLayers,null==(Pe=null==v?void 0:v.basemap)?void 0:Pe.referenceLayers,null==v?void 0:v.layers,...D].filter(Ue=>!!Ue);this.handles.add(w.map(Ue=>this._watchUpdatingTracking.addOnCollectionChange(()=>Ue,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([(0,pt.on)(()=>{var _,v;return null==(v=null==(_=this.view)?void 0:_.map)?void 0:v.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),(0,pt.YP)(()=>{const _=this.view,v=null==_?void 0:_.map;return[null==v?void 0:v.basemap,null==v?void 0:v.ground,null==v?void 0:v.layers,null==_?void 0:_.ready]},()=>this._reschedule(),pt.tX)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const _=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&_.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(_)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return(0,lt.pC)(this._workPromise)||this._watchUpdatingTracking.updating||(0,ya.oE)(this._layerLayerViewInfoMap,_=>!_.done)}get updatingRemaining(){let _=0;for(const v of this._layerLayerViewInfoMap.values())v.done||++_;return _}clear(){if(!this.destroyed){for(const _ of this._layerLayerViewInfoMap.values())_.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}whenLayerView(_){var v=this;return(0,Ai.Z)(function*(){if(yield v._reschedule(),!v._layerLayerViewInfoMap.has(_))throw new Ls.Z("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:_});return v._layerLayerViewInfoMap.get(_).promise})()}_refreshCollections(){for(const[_,v]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(_),this.get(v),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(_,v,O){if(!_||!v)return void(v&&v.removeAll());let D=0;for(const w of _){const te=this._layerLayerViewInfoMap.get(w);if(!te||!te.layerView)continue;const fe=te.layerView;fe.layer=w,fe.parent=O,v.getItemAt(D)!==fe&&v.splice(D,0,fe),w.layers&&this._populateLayerViewsOwners(w.layers,fe.layerViews,fe),D+=1}D<v.length&&v.splice(D,v.length)}_createLayerView(_){if(this._layerLayerViewInfoMap.has(_))return this.view.ready&&this._layerLayerViewInfoMap.get(_).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");_.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(_)&&this.layerViewImporter.importLayerView(_);const v=new zu(_,this.view,this.layerViewImporter);v.promise.then(()=>this._refreshCollections(),O=>{var D,w;O&&((0,zi.D_)(O)||"cancelled:layerview-create"===O.name)||n_.error(`Failed to create layerview for layer title:'${null!=(D=_.title)?D:"no title"}', id:'${null!=(w=_.id)?w:"no id"}' of type '${_.type}'.`,{layer:_,error:O}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(_,v),this.view.ready&&v.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};(0,Ze._)([(0,nt.Cb)()],Tl.prototype,"_workPromise",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Tl.prototype,"_watchUpdatingTracking",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Tl.prototype,"_layersToLayerViews",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Tl.prototype,"_rootCollectionNames",null),(0,Ze._)([(0,nt.Cb)()],Tl.prototype,"layerViewImporter",void 0),(0,Ze._)([(0,nt.Cb)()],Tl.prototype,"supportsGround",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Tl.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Tl.prototype,"updatingRemaining",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Tl.prototype,"view",void 0),Tl=(0,Ze._)([(0,ui.j)("esri.views.LayerViewManager")],Tl);const yd=Tl;let No=class extends Bi.Z{constructor(_){super(_),this.factor=1.5,this.offset=(0,dr.vW)(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};(0,Ze._)([(0,nt.Cb)({type:Number})],No.prototype,"factor",void 0),(0,Ze._)([(0,nt.Cb)({nonNullable:!0})],No.prototype,"offset",void 0),(0,Ze._)([(0,nt.Cb)()],No.prototype,"position",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,range:{min:0}})],No.prototype,"size",void 0),(0,Ze._)([(0,nt.Cb)()],No.prototype,"maskUrl",void 0),(0,Ze._)([(0,nt.Cb)()],No.prototype,"maskEnabled",void 0),(0,Ze._)([(0,nt.Cb)()],No.prototype,"overlayUrl",void 0),(0,Ze._)([(0,nt.Cb)()],No.prototype,"overlayEnabled",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],No.prototype,"version",null),(0,Ze._)([(0,nt.Cb)({type:Boolean})],No.prototype,"visible",void 0),No=(0,Ze._)([(0,ui.j)("esri.views.Magnifier")],No);const hl=No;var Gn=T(87091);let Jd=class extends Bi.Z{constructor(_,v){var O;super({}),this._stage=_,this._textureRequests=new Map,this._frameTask=null!=(O=null==v?void 0:v.registerTask(Gn.T8.TEXTURE_UNLOAD))?O:Gn.sq}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach(_=>this._releaseTextureRequest(_)),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(_,v,O){const D=this.makeUid(_);let w=this._textureRequests.get(D);return w||(w={referenceCount:0,texture:v(),textureAsync:null,abortController:null,onRemove:O},this._stage&&(this._stage.add(w.texture),this._stage.loadImmediate(w.texture)),this._textureRequests.set(D,w)),w.referenceCount++,{uid:D,texture:w.texture,release:()=>this._release(D)}}_release(_){const v=this._textureRequests.get(_);v?(v.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+_),v.referenceCount--,v.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(_))):console.warn(`TextureCollection: texture doesn't exist: '${_}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(_){if(!this._textureRequests)return;const v=this._textureRequests.get(_);!v||v.referenceCount>0||(this._releaseTextureRequest(v),this._textureRequests.delete(_))}_releaseTextureRequest(_){var v;_.onRemove&&_.onRemove(),_.texture?null==(v=this._stage)||v.remove(_.texture):_.abortController&&(_.abortController.abort(),_.abortController=null)}makeUid(_,v=null){return(0,lt.pC)(v)?`${_}.${v}px`:_}};(0,Ze._)([(0,nt.Cb)()],Jd.prototype,"_frameTask",void 0),(0,Ze._)([(0,nt.Cb)()],Jd.prototype,"updating",null),Jd=(0,Ze._)([(0,ui.j)("esri.views.3d.support.TextureCollection")],Jd);var mo=T(56846),c0=T(45458),xh=T(33786);const pu=pn.Z.getLogger("esri.views.interactive.interactiveToolUtils");function Gu(_){return _.visible&&_.getEditableFlag(xh.bH.USER)&&_.getEditableFlag(xh.bH.MANAGER)}var na=T(41900);class o_{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(v,O){const D=()=>v.stopPropagation();switch(v.type){case"pointer-move":Dh(v.pointerType)&&this._pointerLocations.set(v.pointerId,{x:v.x,y:v.y,pointerType:v.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(D(),"end"===v.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!fp(v))break;const w=(0,na.vT)(v),te=this._intersect(w,v.pointerType,O.forEachTool);if((0,lt.Wi)(te))break;const fe=this._findToolAndManipulatorByKey(te,O.forEachTool,Gl),Pe=(0,lt.yw)(fe,Xe=>Xe.manipulator),Ue=(0,lt.yw)(fe,Xe=>Xe.tool);!((0,lt.pC)(Pe)&&(0,lt.pC)(Ue)&&Pe.interactive)||Pe.grabbable&&Pe.grabbableForEvent(v)||!Pe.grabbing||Pe.dragging||this._ungrabManipulatorBeforeDragging(Pe,Ue,v),(0,lt.pC)(Pe)&&Pe.interactive&&Pe.grabbable&&Pe.grabbableForEvent(v)&&!Pe.grabbing&&(this._grabbedManipulators.set(v.pointerId,{key:te,start:w,pointerType:v.pointerType}),1===this._grabbedManipulators.size&&O.activeTool!==te.tool&&(this._currentlyActiveTool=O.activeTool,this._revertToActiveTool=!0,O.setActiveTool(te.tool)),Pe.grabbing=!0,Pe.events.emit("grab-changed",{action:"start",pointerType:v.pointerType,screenPoint:w}),D());break}case"pointer-up":this._handlePointerEnd(v,O);break;case"pointer-drag":{if(!fp(v))break;const w=this._grabbedManipulators.get(v.pointerId),te=this._draggedManipulators.get(v.pointerId),fe=(0,lt.yw)(w||te,({key:st})=>st),Pe=this._findManipulatorByKey(fe,O.forEachTool);if((0,lt.Wi)(Pe))break;const Ue=(0,na.vT)(v);Ue.x=(0,li.uZ)(Ue.x,0,O.view.width),Ue.y=(0,li.uZ)(Ue.y,0,O.view.height);const Xe=(0,lt.Wg)(w||te).start;switch(v.action){case"start":case"update":"update"!==v.action&&1!==this._grabbedManipulators.size||(Pe.dragging=!0,Pe.events.emit("drag",te?{action:"update",start:Xe,screenPoint:Ue}:{action:"start",start:Xe,screenPoint:Ue,pointerType:v.pointerType}),this._draggedManipulators.set(v.pointerId,{key:(0,lt.Wg)(fe),start:Xe}));break;case"end":Pe.dragging=!1,te&&Pe.events.emit("drag",{action:"end",start:Xe,screenPoint:Ue}),this._draggedManipulators.delete(v.pointerId),this._handlePointerEnd(v,O)}D();break}case"immediate-click":{const w=(0,na.vT)(v),te=this._intersect(w,v.pointerType,O.forEachTool),fe=this._findToolAndManipulatorByKey(te,O.forEachTool,Gl);if(function Hu(_){return!!_.native.shiftKey}(v)||O.forEachTool(st=>{if((!(0,lt.pC)(fe)||fe.tool!==st||st.automaticManipulatorSelection)&&st.manipulators){let vt=!1;st.manipulators.forEach(({manipulator:Ct})=>{Ct.selected&&(Ct.selected=!1,vt=!0)}),vt&&st.manipulatorSelectionChanged&&st.manipulatorSelectionChanged()}}),(0,lt.Wi)(fe))break;const{manipulator:Pe,tool:Ue}=fe;if(!Pe.interactive)break;Pe.selectable&&Ue.automaticManipulatorSelection&&(Pe.selected=!Pe.selected,Ue.manipulatorSelectionChanged&&Ue.manipulatorSelectionChanged()),Pe.events.emit("immediate-click",{screenPoint:w,button:v.button,pointerType:v.pointerType,shiftKey:v.native.shiftKey,stopPropagation:D});break}case"click":{const w=(0,na.vT)(v),te=this._intersect(w,v.pointerType,O.forEachTool),fe=this._findManipulatorByKey(te,O.forEachTool);if((0,lt.Wi)(fe)||!fe.interactive)break;fe.events.emit(v.type,{screenPoint:w,button:v.button,pointerType:v.pointerType,shiftKey:v.native.shiftKey}),D();break}case"double-click":{const w=(0,na.vT)(v),te=this._intersect(w,v.pointerType,O.forEachTool),fe=this._findManipulatorByKey(te,O.forEachTool);if((0,lt.Wi)(fe)||!fe.interactive)break;fe.events.emit("double-click",{screenPoint:w,button:v.button,pointerType:v.pointerType,shiftKey:v.native.shiftKey,stopPropagation:D});break}case"immediate-double-click":{const w=(0,na.vT)(v),te=this._intersect(w,v.pointerType,O.forEachTool),fe=this._findManipulatorByKey(te,O.forEachTool);if((0,lt.Wi)(fe)||!fe.interactive)break;fe.events.emit("immediate-double-click",{screenPoint:w,button:v.button,pointerType:v.pointerType,shiftKey:v.native.shiftKey,stopPropagation:D});break}}this._onFocusChange(O.forEachTool)}_ungrabManipulatorBeforeDragging(v,O,D){v.grabbing=!1,v.events.emit("grab-changed",{action:"end",pointerType:D.pointerType,screenPoint:(0,na.vT)(D)}),this._grabbedManipulators.forEach(({key:w},te)=>{w.tool===O&&O.manipulators.findById(w.manipulatorId)===v&&this._grabbedManipulators.delete(te)})}_handlePointerEnd(v,O){const D=(0,lt.yw)(this._grabbedManipulators.get(v.pointerId),({key:te})=>te),w=this._findManipulatorByKey(D,O.forEachTool);(0,lt.pC)(w)&&!w.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&this._revertToActiveTool&&(O.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),w.grabbing&&(w.grabbing=!1,w.events.emit("grab-changed",{action:"end",pointerType:v.pointerType,screenPoint:(0,na.vT)(v)})),this._grabbedManipulators.delete(v.pointerId))}_cursorFromMap(v,O){let D=null;return(0,ya.oE)(v,({key:w})=>{const te=this._findManipulatorByKey(w,O);return!!((0,lt.pC)(te)&&te.interactive&&"cursor"in te&&te.cursor)&&(D=te.cursor,!0)}),D}_onFocusChange(v){this._updateCursor(v),this._updateFocusedManipulatorTools(v)}_updateCursor(v){this._cursor=this._grabbedManipulators.size>0?this._cursorFromMap(this._grabbedManipulators,v)||"grabbing":this._hoveredManipulators.size>0?this._cursorFromMap(this._hoveredManipulators,v)||"pointer":null}_updateFocusedManipulatorTools(v){const O=new Set;this._grabbedManipulators.forEach(({key:{tool:D}})=>{O.add(D)}),this._hoveredManipulators.forEach(({key:{tool:D}})=>{O.add(D)}),v(D=>{D.hasFocusedManipulators=O.has(D)})}clearPointers(v,O,D=!0,w){const te=fe=>fe.tool===v&&((0,lt.Wi)(w)||fe.manipulatorId===w);this._grabbedManipulators.forEach(({key:fe,pointerType:Pe},Ue)=>{if(te(fe)){this._grabbedManipulators.delete(Ue);const Xe=this._findManipulatorByKey(fe,O);(0,lt.pC)(Xe)&&(Xe.grabbing=!1,Xe.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:Pe}))}}),this._draggedManipulators.forEach(({key:fe},Pe)=>{if(te(fe)){this._draggedManipulators.delete(Pe);const Ue=this._findManipulatorByKey(fe,O);(0,lt.pC)(Ue)&&(Ue.dragging=!1,Ue.events.emit("drag",{action:"cancel"}))}}),D&&this._hoveredManipulators.forEach(({key:fe},Pe)=>{if(te(fe)){this._hoveredManipulators.delete(Pe);const Ue=this._findManipulatorByKey(fe,O);(0,lt.pC)(Ue)&&(Ue.hovering=!1)}}),this._onFocusChange(O)}_intersect(v,O,D){let w=null;return D(te=>{if(null==te.manipulators||!Gu(te))return!1;const fe=te.manipulators.intersect(v,O);return!(0,lt.Wi)(fe)&&(w={manipulatorId:fe.id,tool:te},!0)}),w}updateHoveredStateFromKnownPointers(v){this._pointerLocations.forEach((O,D)=>{this._updateHoveredStateForPointerAtScreenPosition((0,dr.vW)(O.x,O.y),D,O.pointerType,v)})}handleHoverEvent(v,O){"pointer-up"!==v.type&&"immediate-click"!==v.type&&"pointer-move"!==v.type||!Dh(v.pointerType)||this._updateHoveredStateForPointerAtScreenPosition((0,na.vT)(v),v.pointerId,v.pointerType,O)}_updateHoveredStateForPointerAtScreenPosition(v,O,D,w){const te=this._intersect(v,D,w);let fe=this._findManipulatorByKey(te,w);const Pe=(0,lt.yw)(this._hoveredManipulators.get(O),({key:Xe})=>Xe),Ue=this._findManipulatorByKey(Pe,w);(0,lt.pC)(fe)&&!fe.interactive&&(fe=null),Ue!==fe&&((0,lt.pC)(Ue)&&(Ue.hovering=!1),(0,lt.pC)(fe)?(fe.hovering=!0,this._hoveredManipulators.set(O,{key:(0,lt.Wg)(te)})):this._hoveredManipulators.delete(O),this._onFocusChange(w))}_findManipulatorByKey(v,O){return this._findToolAndManipulatorByKey(v,O,Gl)?Gl.manipulator:null}_findToolAndManipulatorByKey(v,O,D){return(0,lt.Wi)(v)?null:(D.tool=null,D.manipulator=null,O(w=>{if(w!==v.tool||null==w.manipulators||!Gu(w))return!1;const te=w.manipulators.findById(v.manipulatorId);return!!(0,lt.pC)(te)&&(D.manipulator=te,D.tool=w,!0)}),D.manipulator?D:null)}}function Dh(_){return"mouse"===_}function fp(_){return"mouse"!==_.pointerType||0===_.button}const Gl={manipulator:null,tool:null},Mo=pn.Z.getLogger("esri.views.ToolViewManager"),_u="attached",dc="tools";let Da=class extends cc.r{constructor(_){super(_),this._manipulatorState=new o_,this.tools=new Pn.Z,this.cursor=null,this._forEachTool=v=>{for(const O of this.tools.items)if(v(O))return}}initialize(){var _;this.handles.add([this.view.on(c0.uS,_=>{this._handleInputEvent(_)},mo.f.TOOL),...(_=this.tools,[_.on("before-add",v=>{const O=v.item;if(null==O||_.includes(O))return pu.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void v.preventDefault();O.onAdd()}),_.on("after-remove",v=>{const O=v.item;O.visible=!1,O.active&&(O.view.activeTool=null),O.destroy()})]),this.tools.on("before-remove",({item:_})=>{this._manipulatorState.clearPointers(_,this._forEachTool)}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(_){if((0,lt.pC)(_)&&!this.view.ready)return void Mo.error("Cannot set active tool while view is not ready.");if(_===this.activeTool)return;const v=this.activeTool;this._set("activeTool",_),(0,lt.pC)(v)&&v.deactivate(),(0,lt.pC)(_)&&_.activate(),this._removeIncompleteTools(_);const O=(0,lt.Wi)(this.activeTool);for(const D of this.tools){D.setEditableFlag(xh.bH.MANAGER,O||D===this.activeTool);const w=Gu(D);!O&&w||this._manipulatorState.clearPointers(D,this._forEachTool,!w)}this._updateCursor()}get updating(){var _,v;return this.updatingHandles.updating||this.tools.some(O=>O.updating)||null!=(v=null==(_=this.textures)?void 0:_.updating)&&v}attach(){"3d"===this.view.type?(this._set("textures",new Jd(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([(0,pt.YP)(()=>{const{state:_}=this.view;return"camera"in _&&_.camera},()=>{this._forEachManipulator(_=>{null!=_.onViewChange&&_.onViewChange()})}),this.view.elevationProvider.on("elevation-change",_=>{this._forEachManipulator(v=>{null!=v.onElevationChange&&v.onElevationChange(_)})}),(0,Ut.kB)(()=>this._set("textures",(0,lt.SC)(this.textures)))],_u)):this.handles.add((0,pt.YP)(()=>this.view.extent,()=>{this._forEachManipulator(_=>{null!=_.onViewChange&&_.onViewChange()})}))}detach(){(0,lt.pC)(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove(_u)}_forEachManipulator(_){this._forEachTool(v=>{v.manipulators&&v.manipulators.forEach(({manipulator:O})=>_(O,v))})}_handleInputEvent(_){let v=!1;const O=yi(or({},_),{stopPropagation:()=>{v=!0,_.stopPropagation()}});(0,lt.pC)(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(O):this._forEachTool(D=>{!v&&D.visible&&D.handleInputEvent(O)}),!v&&"key-down"===_.type&&"Escape"===_.key&&this.activeTool&&(_.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(O,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:D=>{this.activeTool=D},view:this.view}),!v&&(0,lt.pC)(this.activeTool)&&this.activeTool.handleInputEventAfter(O),this._manipulatorState.handleHoverEvent(O,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove(dc),this._forEachTool(_=>{if(_ instanceof Bi.Z){const v=(0,pt.YP)(()=>[_.cursor,_.visible,_.editable],()=>{Gu(_)||this._manipulatorState.clearPointers(_,this._forEachTool),this._updateCursor()});this.handles.add(v,dc)}_.manipulators&&this.handles.add(_.manipulators.on("change",v=>{v.removed.forEach(({id:O})=>{this._manipulatorState.clearPointers(_,this._forEachTool,!0,O)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}),dc)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const _=this._manipulatorState.cursor;let v=_;this._forEachTool(O=>!(!(0,lt.pC)(O.cursor)||!O.visible||!(0,lt.Wi)(_)&&O.preferManipulatorCursor||(v=O.cursor,0))),this._get("cursor")!==v&&this._set("cursor",v)}_removeIncompleteTools(_){this.tools.filter(v=>((0,lt.Wi)(_)||v!==_)&&!v.created&&v.removeIncompleteOnCancel).forEach(v=>{this.tools.remove(v)})}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0,nonNullable:!0})],Da.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,nonNullable:!0})],Da.prototype,"textures",void 0),(0,Ze._)([(0,nt.Cb)({value:null})],Da.prototype,"activeTool",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0,type:Pn.Z})],Da.prototype,"tools",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Da.prototype,"cursor",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Da.prototype,"updating",null),Da=(0,Ze._)([(0,ui.j)("esri.views.ToolViewManager")],Da);const _p=Da;let Ku=class extends Bi.Z{constructor(_){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",this._detectedDeviceType="standard"===_.mapping?"standard":Ah.test(_.id)?"spacemouse":"unknown",this.nativeIndex=_.index}get native(){return(navigator.getGamepads?navigator.getGamepads():[])[this.nativeIndex]}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return mf[this.deviceType]}};(0,Ze._)([(0,nt.Cb)({nonNullable:!0,readOnly:!0})],Ku.prototype,"nativeIndex",void 0),(0,Ze._)([(0,nt.Cb)({type:String,readOnly:!0})],Ku.prototype,"deviceType",null),(0,Ze._)([(0,nt.Cb)({type:Number,readOnly:!0})],Ku.prototype,"axisThreshold",null),Ku=(0,Ze._)([(0,ui.j)("esri.views.input.gamepad.GamepadInputDevice")],Ku);const Ah=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),mf={standard:.15,spacemouse:.025,unknown:0},mu=Ku;let Ml=class extends Bi.Z{constructor(..._){super(..._),this.devices=new Pn.Z,this.enabledFocusMode="document"}};(0,Ze._)([(0,nt.Cb)({type:Pn.Z.ofType(mu),readOnly:!0})],Ml.prototype,"devices",void 0),(0,Ze._)([(0,nt.Cb)({type:["document","view","none"]})],Ml.prototype,"enabledFocusMode",void 0),Ml=(0,Ze._)([(0,ui.j)("esri.views.input.gamepad.GamepadSettings")],Ml);const u0=Ml;let Hc=class extends Bi.Z{constructor(){super(...arguments),this.gamepad=new u0}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Hc.prototype,"gamepad",void 0),Hc=(0,Ze._)([(0,ui.j)("esri.views.input.Input")],Hc);const Sh=Hc;let Kc=class extends Bi.Z{constructor(_){super(_),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0})],Kc.prototype,"enabled",void 0),(0,Ze._)([(0,nt.Cb)({type:mu})],Kc.prototype,"device",void 0),(0,Ze._)([(0,nt.Cb)({type:["pan","zoom"],nonNullable:!0})],Kc.prototype,"mode",void 0),(0,Ze._)([(0,nt.Cb)({type:["forward-down","forward-up"],nonNullable:!0})],Kc.prototype,"tiltDirection",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0})],Kc.prototype,"velocityFactor",void 0),Kc=(0,Ze._)([(0,ui.j)("esri.views.navigation.gamepad.GamepadSettings")],Kc);const qa=Kc;let Ka=class extends Bi.Z{constructor(_){super(_),this.browserTouchPanEnabled=!0,this.gamepad=new qa,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};(0,Ze._)([(0,nt.Cb)({type:Boolean})],Ka.prototype,"browserTouchPanEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:qa,nonNullable:!0})],Ka.prototype,"gamepad",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],Ka.prototype,"momentumEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],Ka.prototype,"mouseWheelZoomEnabled",void 0),Ka=(0,Ze._)([(0,ui.j)("esri.views.navigation.Navigation")],Ka);const Xd=Ka;var vd=T(36947),Us=T(59617);let Qd,mp=null;function qd(_){return Ec.apply(this,arguments)}function Ec(){return(Ec=(0,Ai.Z)(function*(_){mp||(mp=Promise.resolve().then(T.bind(T,35082)).then(v=>Qd=v)),yield mp,(0,zi.k_)(_)})).apply(this,arguments)}function Rh(_,v,O,D){return Ed.apply(this,arguments)}function Ed(){return(Ed=(0,Ai.Z)(function*(_,v,O,D){if(!_)return null;const w=_.spatialReference;return(0,ci.kR)()||(0,ci.Up)(w,v)?(0,ci.iV)(_,v):Qd?Qd.projectGeometry(_,v,O,D):(yield Promise.race([qd(D),(0,ci.zD)(D)]),Rh(_,v,O,D))})).apply(this,arguments)}let _n=class extends Bi.Z{constructor(_){super(_),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=(0,lt.IM)(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return(0,lt.pC)(this.userSpatialReference)?this.userSpatialReference:(0,lt.Wg)(this._spatialReferenceTask.spatialReference)}get extent(){return(0,lt.Wg)(this._extentTask.extent)}get heightModelInfo(){return(0,lt.Wg)(this._heightModelInfoTask.heightModelInfo)}get vcsWkid(){return(0,lt.Wg)(this._heightModelInfoTask.vcsWkid)}get latestVcsWkid(){return(0,lt.Wg)(this._heightModelInfoTask.latestVcsWkid)}get viewingMode(){return(0,lt.Wi)(this.userSpatialReference)||this.userSpatialReference.equals((0,lt.Wg)(this._spatialReferenceTask.spatialReference))?(0,lt.Wg)(this._spatialReferenceTask.viewingMode):null}get tileInfo(){return(0,lt.Wg)(this._tileInfoTask.tileInfo)}get mapCollections(){var O,D,w,te;const _=null==(O=this.map)?void 0:O.call(this),v=[];return(0,lt.pC)(this.priorityCollection)&&v.push(this.priorityCollection),v.push({parent:null==_?void 0:_.basemap,layers:null==(D=null==_?void 0:_.basemap)?void 0:D.baseLayers},{layers:null==_?void 0:_.layers},{parent:null==_?void 0:_.ground,layers:null==(w=null==_?void 0:_.ground)?void 0:w.layers},{parent:null==_?void 0:_.basemap,layers:null==(te=null==_?void 0:_.basemap)?void 0:te.referenceLayers}),v}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){var w;if(this.suspended)return null!=(w=this._get("_spatialReferenceTask"))?w:{updating:!1};const{layers:_,updating:v}=this._allLayers;let O=null;for(const te of _){const fe=this._getSupportedSpatialReferences(te);if(fe.length>0){const Pe=this._narrowDownSpatialReferenceCandidates(O,fe);(0,lt.pC)(Pe)&&(O=Pe)}if((0,lt.pC)(O)&&1===O.length)break}if(v&&((0,lt.Wi)(O)||1!==O.length))return{updating:!0};const D=this._pickSpatialReferenceCandidate(O);return{spatialReference:(0,lt.pC)(D)?D.spatialReference:null,viewingMode:(0,lt.pC)(D)?D.viewingMode:null,updating:!1}}get _tileInfoTask(){var O,D,w,te,fe,Pe,Ue,Xe;if(!this.required.tileInfo)return null!=(O=this._get("_tileInfoTask"))?O:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:_,updating:v}=this._collectLayers([{parent:null==(w=null==(D=this.map)?void 0:D.call(this))?void 0:w.basemap,layers:null==(Pe=null==(fe=null==(te=this.map)?void 0:te.call(this))?void 0:fe.basemap)?void 0:Pe.baseLayers},{layers:null==(Xe=null==(Ue=this.map)?void 0:Ue.call(this))?void 0:Xe.layers}]);if(_&&_.length>0&&"tileInfo"in _[0]){const st=_[0].tileInfo;return{tileInfo:st&&st.spatialReference.equals(this.spatialReference)?st:null,updating:!1}}return{updating:v}}get _heightModelInfoTask(){var O,D,w,te;if(!this.required.heightModelInfo||this.suspended&&(null==(O=this._get("_heightModelInfoTask"))?void 0:O.heightModelInfo))return null!=(D=this._get("_heightModelInfoTask"))?D:{updating:!1};const{layers:_,updating:v}=this._allLayers;for(const fe of _)if((0,vd.qC)(fe)){const Pe=(0,vd.Ku)(fe);if(Pe)return{heightModelInfo:Pe,vcsWkid:null==(w=fe.spatialReference)?void 0:w.vcsWkid,latestVcsWkid:null==(te=fe.spatialReference)?void 0:te.latestVcsWkid,updating:!1}}return{updating:v}}get _extentCandidatesTask(){var D,w;if(this.suspended||!this.required.extent)return null!=(D=this._get("_extentCandidatesTask"))?D:{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const _=this._allLayers,v=_.updating,O=[];for(const te of _.layers){const fe="fullExtents"in te&&te.fullExtents||((0,lt.pC)(te.fullExtent)?[te.fullExtent]:[]),Pe=this.requiresExtentInSpatialReference?null:fe[0],Ue=null!=(w=fe.find(Xe=>Xe.spatialReference.equals(this.spatialReference)))?w:Pe;if(Ue)return{candidates:[{extent:Ue,layer:te}],updating:!1};if(this._getSupportedSpatialReferences(te).length>0)for(const Xe of fe)O.push({extent:Xe,layer:te})}return{candidates:O,updating:v}}get _extentTask(){var _=this;const{candidates:v,updating:O}=this._extentCandidatesTask;if(O)return{updating:O};if((0,lt.Wi)(v)||0===v.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const D=this._pickExtentCandidate(v),w=this.spatialReference;return D.extent.equals(this._projectExtentTask.input)&&w.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:(0,lt.pC)(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:((0,lt.pC)(this._projectExtentTask.task)&&(this._projectExtentTask.task=(0,lt.IM)(this._projectExtentTask.task)),this._projectExtentTask={input:D.extent.clone(),output:null,spatialReference:w.clone(),task:(0,zi.vr)(function(){var te=(0,Ai.Z)(function*(fe){try{const Pe=yield Rh(D.extent,w,D.layer.portalItem,fe);_._projectExtentTask=yi(or({},_._projectExtentTask),{task:null,output:Pe})}catch(Pe){if((0,zi.Hc)(fe))return;_._projectExtentTask=yi(or({},_._projectExtentTask),{task:null})}});return function(fe){return te.apply(this,arguments)}}())},{updating:!0})}_narrowDownSpatialReferenceCandidates(_,v){if((0,lt.Wi)(_))return v;const O=[],D=(w,te)=>(0,lt.pC)(w)?(0,lt.pC)(te)?w===te&&w:w:te;for(const w of _)for(const te of v){if(!w.spatialReference.equals(te.spatialReference))continue;const fe=D(w.viewingMode,te.viewingMode);if(!1!==fe){O.push({spatialReference:w.spatialReference,viewingMode:fe});break}}return O.length>0?O:null}_pickSpatialReferenceCandidate(_){const v=this.defaultSpatialReference;return(0,lt.Wi)(_)||_.length<1?(0,lt.pC)(v)?{spatialReference:v,viewingMode:null}:null:((0,lt.pC)(v)&&_.length>1&&_.some(({spatialReference:O})=>O.equals(v))&&(_=_.filter(({spatialReference:O})=>O.equals(v))),_.length>1&&_.some(({viewingMode:O})=>O!==Us.JY.Local)&&(_=_.filter(({viewingMode:O})=>O!==Us.JY.Local)),_[0])}_getSupportedSpatialReferences(_){const v="supportedSpatialReferences"in _&&_.supportedSpatialReferences||(_.spatialReference?[_.spatialReference]:[]);if(0===v.length)return[];const O=[];for(const D of v){const w=this.getSpatialReferenceSupport({spatialReference:D,layer:_});if((0,lt.pC)(w)){const te=(0,lt.pC)(w.constraints)?w.constraints:[{spatialReference:D,viewingMode:null}];for(const{spatialReference:fe,viewingMode:Pe}of te)(!this.requiresExtentInSpatialReference||(0,lt.Wi)(this.userSpatialReference)||fe.equals(this.userSpatialReference))&&O.push({spatialReference:fe,viewingMode:Pe})}}return O}_pickExtentCandidate(_){const v=this.spatialReference;return _.find(({extent:O})=>v.equals(O.spatialReference))||_[0]}_collectLayers(_){var O;if("loaded"!==this._loadMaybe(null==(O=this.map)?void 0:O.call(this)))return{layers:[],updating:!0};const v={layers:[],preloading:-1,updating:!1};for(const D of _)if(this._collectCollection(D,v),v.preloading===this.sourcePreloadCount)break;return{layers:v.layers,updating:v.updating}}_collectCollection(_,v){if(_.layers){switch(this._loadMaybe(_.parent)){case"loading":return v.updating=!0,void++v.preloading;case"failed":return}for(const O of _.layers){switch(this._loadMaybe(O)){case"failed":continue;case"loading":v.updating=!0,++v.preloading;break;case"loaded":v.updating||v.layers.push(O),"layers"in O&&this._collectCollection({layers:O.layers},v)}if(v.preloading===this.sourcePreloadCount)break}}}_loadMaybe(_){return _&&"loadStatus"in _?"not-loaded"===_.loadStatus?(_.load(),"loading"):_.loadStatus:"loaded"}};var gu;(0,Ze._)([(0,nt.Cb)()],_n.prototype,"required",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],_n.prototype,"map",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],_n.prototype,"getSpatialReferenceSupport",void 0),(0,Ze._)([(0,nt.Cb)()],_n.prototype,"defaultSpatialReference",void 0),(0,Ze._)([(0,nt.Cb)()],_n.prototype,"userSpatialReference",void 0),(0,Ze._)([(0,nt.Cb)()],_n.prototype,"sourcePreloadCount",void 0),(0,Ze._)([(0,nt.Cb)()],_n.prototype,"priorityCollection",void 0),(0,Ze._)([(0,nt.Cb)()],_n.prototype,"requiresExtentInSpatialReference",void 0),(0,Ze._)([(0,nt.Cb)()],_n.prototype,"suspended",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"ready",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"heightModelInfoReady",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"spatialReference",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"extent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"heightModelInfo",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"vcsWkid",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"latestVcsWkid",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"viewingMode",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"tileInfo",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"mapCollections",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"_allLayers",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"_spatialReferenceTask",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"_tileInfoTask",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"_heightModelInfoTask",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],_n.prototype,"_extentCandidatesTask",null),(0,Ze._)([(0,nt.Cb)()],_n.prototype,"_extentTask",null),(0,Ze._)([(0,nt.Cb)()],_n.prototype,"_projectExtentTask",void 0),_n=(0,Ze._)([(0,ui.j)("esri.views.support.DefaultsFromMap")],_n);const on=pn.Z.getLogger("esri.views.View");let Rs=gu=class extends((0,cc.p)(sa.Z.EventedMixin((0,pp.v)(Bi.Z)))){constructor(_){super(_),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new Bc.Z({getCollections:()=>{var v,O,D;return[null==(v=this.basemapView)?void 0:v.baseLayerViews,null==(O=this.groundView)?void 0:O.layerViews,this.layerViews,null==(D=this.basemapView)?void 0:D.referenceLayerViews]},getChildrenFunction:v=>v.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new Ph.J,this.analyses=new po,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new Pn.Z,this.magnifier=new hl,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new Sh,this.navigation=new Xd,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new c0.CE(this),this.persistableViewModels=new Pn.Z,this._isValid=!1,this._readyCycleForced=!1,this.handles.add((0,pt.YP)(()=>this.preconditionsReady,v=>{var O,D;v?(this._currentSpatialReference=this.spatialReference,gu.views.add(this)):(this._currentSpatialReference=null,gu.views.remove(this)),this.notifyChange("spatialReference"),!v&&this.ready?(null==(O=this.layerViewManager)||O.clear(),null==(D=this.toolViewManager)||D.detach(),(0,lt.pC)(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):v&&!this.ready&&(this._startup(),(0,lt.pC)(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())},pt.Z_))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,(0,pt.N1)(()=>this.ready)))),this.basemapView=new uc({view:this}),this.layerViewManager=new yd({view:this,layerViewImporter:{importLayerView:_=>this.importLayerView(_),hasLayerViewModule:_=>this.hasLayerViewModule(_)},supportsGround:this.supportsGround}),this.toolViewManager=new _p({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([(0,pt.YP)(()=>this.initialExtentRequired,_=>this.defaultsFromMap.required=yi(or({},this.defaultsFromMap.required),{extent:_}),{sync:!0,initial:!0}),(0,pt.YP)(()=>this.ready,_=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=_,this.defaultsFromMap.userSpatialReference=_?this.spatialReference:this._userSpatialReference)},{sync:!0}),(0,pt.YP)(()=>this._userSpatialReference,_=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=_)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){var _=this;let v=null;this.handles.add([(0,pt.YP)(()=>{var O;return null==(O=this.defaultsFromMap)?void 0:O.ready},O=>{var w;const D=(null==(w=this.map)?void 0:w.allLayers.length)>0;if(O&&!this.spatialReference&&D){if((0,lt.pC)(v))return;const te=(0,Ut.kB)(()=>v=(0,lt.IM)(v));v=(0,zi.vr)(function(){var fe=(0,Ai.Z)(function*(Pe){try{yield(0,zi.e4)(_.spatialReferenceWarningDelay,null,Pe)}catch(Ue){return}finally{v=null}on.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")});return function(Pe){return fe.apply(this,arguments)}}()),this.handles.add(te,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=(0,lt.SC)(this.graphics),this.analyses=(0,lt.SC)(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),(0,lt.SC)(this.analysisViewManager),this.toolViewManager=(0,lt.SC)(this.toolViewManager),this.layerViewManager=(0,lt.SC)(this.layerViewManager),this.basemapView=(0,lt.SC)(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const _=this.map;this.map=null,null==_||_.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return on.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new _n(or({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:_=>this.getSpatialReferenceSupport(_)},this._defaultsFromMapSettings))}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){var _;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||da.Z.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!(null==(_=this.defaultsFromMap)?void 0:_.ready)||!this.typeSpecificPreconditionsReady)}set map(_){_!==this._get("map")&&((null==_?void 0:_.destroyed)&&(on.warn("#map","The provided map is already destroyed",{map:_}),_=null),da.Z.isLoadable(_)&&_.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",_))}get spatialReference(){var v,O;let _=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return _&&(null==(O=null==(v=this.defaultsFromMap)?void 0:v.required)?void 0:O.heightModelInfo)&&(_=_.clone(),_.vcsWkid=this.defaultsFromMap.vcsWkid,_.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),_}set spatialReference(_){const v=!(0,qs.fS)(_,this._get("spatialReference"));this._set("_userSpatialReference",_),v&&(this._set("spatialReference",_),this._spatialReferenceChanged(_))}_spatialReferenceChanged(_){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){var _;return null==(_=this.defaultsFromMap)?void 0:_.extent}get cursor(){const _=this.toolViewManager?this.toolViewManager.cursor:null;return(0,lt.pC)(_)?_:this._cursor||"default"}set cursor(_){this._cursor=_,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(_){return this.layerViewManager.whenLayerView(_)}getDefaultSpatialReference(){var _;return null==(_=this.defaultsFromMap)?void 0:_.spatialReference}getDefaultHeightModelInfo(){var _,v,O;return null!=(O=null!=(v=this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)?v:null==(_=this.defaultsFromMap)?void 0:_.heightModelInfo)?O:null}importLayerView(_){throw new Ls.Z("importLayerView() not implemented")}hasLayerViewModule(_){return!1}validate(){return(0,Ai.Z)(function*(){})()}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(_){return(0,lt.pC)(this.getSpatialReferenceSupport({spatialReference:_}))}when(_,v){return this.isResolved()&&!this.ready&&on.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(_,v)}forceReadyCycle(){this.ready&&((0,pt.gx)(()=>!1===this.preconditionsReady,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(_){this.toolViewManager.tools.add(_),this.activeTool=_}tryFatalErrorRecovery(){this.fatalError=null}};Rs.views=new Pn.Z,(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"_userSpatialReference",void 0),(0,Ze._)([(0,Ss.B)("toolViewManager.activeTool")],Rs.prototype,"activeTool",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"allLayerViews",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"groundView",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"animation",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"basemapView",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"_defaultsFromMapSettings",null),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"defaultsFromMap",null),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"fatalError",void 0),(0,Ze._)([(0,nt.Cb)({type:To.Z})],Rs.prototype,"extent",void 0),(0,Ze._)([(0,nt.Cb)((0,Or.z)(Ph.J,"graphics"))],Rs.prototype,"graphics",void 0),(0,Ze._)([(0,nt.Cb)((0,Or.z)(po,"analyses"))],Rs.prototype,"analyses",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,type:fi.Z})],Rs.prototype,"heightModelInfo",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"interacting",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"navigating",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Rs.prototype,"preconditionsReady",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"typeSpecificPreconditionsReady",void 0),(0,Ze._)([(0,nt.Cb)({type:Pn.Z,readOnly:!0})],Rs.prototype,"layerViews",void 0),(0,Ze._)([(0,nt.Cb)({type:hl})],Rs.prototype,"magnifier",void 0),(0,Ze._)([(0,nt.Cb)({value:null,type:nc})],Rs.prototype,"map",null),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"padding",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"ready",void 0),(0,Ze._)([(0,nt.Cb)({type:Xn.Z})],Rs.prototype,"spatialReference",null),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"spatialReferenceWarningDelay",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"stationary",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"supportsGround",void 0),(0,Ze._)([(0,nt.Cb)({type:hp.Z})],Rs.prototype,"timeExtent",void 0),(0,Ze._)([(0,Ss.B)("toolViewManager.tools")],Rs.prototype,"tools",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"toolViewManager",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:Number})],Rs.prototype,"scale",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"updating",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"initialExtentRequired",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"initialExtent",null),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"cursor",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"input",void 0),(0,Ze._)([(0,nt.Cb)({type:Xd,nonNullable:!0})],Rs.prototype,"navigation",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"layerViewManager",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"analysisViewManager",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"width",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"height",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"resizing",void 0),(0,Ze._)([(0,nt.Cb)({value:null,readOnly:!0})],Rs.prototype,"size",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"suspended",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"viewEvents",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Rs.prototype,"persistableViewModels",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"_isValid",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"_readyCycleForced",void 0),(0,Ze._)([(0,nt.Cb)()],Rs.prototype,"_currentSpatialReference",void 0),Rs=gu=(0,Ze._)([(0,ui.j)("esri.views.View")],Rs);const pl=Rs;let go=class extends pp.D{constructor(_){super(_),this.state="running",this.target=null}initialize(){this.addResolvingPromise(new Promise((_,v)=>this._dfd={resolve:_,reject:v}))}get done(){return"finished"===this.state||"stopped"===this.state}stop(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","stopped"),this._dfd.reject(new Ls.Z("ViewAnimation stopped")))}finish(){"stopped"!==this.state&&"finished"!==this.state&&(this._set("state","finished"),this._dfd.resolve())}update(_,v){v||(v=(0,zi.y8)(_)?"waiting-for-target":"running"),this._set("target",_),this._set("state",v)}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],go.prototype,"done",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0,type:String})],go.prototype,"state",void 0),(0,Ze._)([(0,nt.Cb)()],go.prototype,"target",void 0),go=(0,Ze._)([(0,ui.j)("esri.views.ViewAnimation")],go),(go||(go={})).State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"};const Ol=go,Za=()=>Promise.all([T.e(8592),T.e(1726)]).then(T.bind(T,8562)),bc=()=>Promise.all([T.e(8592),T.e(4976)]).then(T.bind(T,64976)),Ki={"base-dynamic":()=>Promise.all([T.e(9759),T.e(5627)]).then(T.bind(T,95627)),"base-elevation":bc,"base-tile":Za,"bing-maps":Za,"building-scene":()=>Promise.all([T.e(3464),T.e(4231),T.e(5542),T.e(7915),T.e(5849),T.e(8592),T.e(1736)]).then(T.bind(T,81736)),csv:()=>Promise.all([T.e(3464),T.e(4231),T.e(8433),T.e(2947),T.e(126),T.e(4048)]).then(T.bind(T,84048)),elevation:bc,feature:()=>Promise.all([T.e(3464),T.e(4231),T.e(8433),T.e(2947),T.e(126),T.e(6446)]).then(T.bind(T,16446)),geojson:()=>Promise.all([T.e(3464),T.e(4231),T.e(8433),T.e(2947),T.e(126),T.e(4937)]).then(T.bind(T,54937)),graphics:()=>Promise.all([T.e(4231),T.e(3487),T.e(2359)]).then(T.bind(T,62359)),group:()=>T.e(961).then(T.bind(T,961)),imagery:()=>Promise.all([T.e(9759),T.e(4366)]).then(T.bind(T,4366)),"integrated-mesh":()=>Promise.all([T.e(4231),T.e(5542),T.e(7915),T.e(4281)]).then(T.bind(T,4186)),"line-of-sight":()=>T.e(8325).then(T.bind(T,68325)),"map-image":()=>Promise.all([T.e(9759),T.e(8592),T.e(1955)]).then(T.bind(T,81955)),media:()=>Promise.all([T.e(8592),T.e(9094)]).then(T.bind(T,59094)),"ogc-feature":()=>Promise.all([T.e(3464),T.e(4231),T.e(8433),T.e(2947),T.e(126),T.e(3835)]).then(T.bind(T,3835)),"open-street-map":Za,"point-cloud":()=>Promise.all([T.e(4471),T.e(8592),T.e(154)]).then(T.bind(T,61525)),voxel:()=>T.e(9991).then(T.bind(T,19991)),route:()=>Promise.all([T.e(4231),T.e(3487),T.e(403),T.e(2124)]).then(T.bind(T,62124)),scene:_=>null==_.profile||"mesh-pyramids"===_.profile?Promise.all([T.e(3464),T.e(4231),T.e(5542),T.e(7915),T.e(5849),T.e(8592),T.e(15)]).then(T.bind(T,80015)):Promise.all([T.e(3464),T.e(4231),T.e(8433),T.e(5542),T.e(8592),T.e(8454)]).then(T.bind(T,39988)),stream:()=>Promise.all([T.e(3464),T.e(4231),T.e(8433),T.e(2947),T.e(5895),T.e(937)]).then(T.bind(T,20937)),tile:Za,"imagery-tile":()=>Promise.all([T.e(8594),T.e(8592),T.e(342)]).then(T.bind(T,10342)),"vector-tile":()=>Promise.all([T.e(3751),T.e(4654),T.e(7692),T.e(8364),T.e(8592),T.e(2020)]).then(T.bind(T,32020)),wcs:()=>Promise.all([T.e(8594),T.e(8592),T.e(342)]).then(T.bind(T,10342)),"web-tile":Za,wfs:()=>Promise.all([T.e(3464),T.e(4231),T.e(8433),T.e(2947),T.e(126),T.e(8726)]).then(T.bind(T,68726)),wms:()=>Promise.all([T.e(9759),T.e(8592),T.e(8765)]).then(T.bind(T,48765)),wmts:()=>Promise.all([T.e(8592),T.e(6373)]).then(T.bind(T,6373)),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null},Cc=pn.Z.getLogger("esri.views.3d.analysis.AnalysisViewManager3D"),Pl="analyses-owner-handles";var hc,Hl,_;(_=hc||(hc={}))[_.PENDING=0]="PENDING",_[_.CREATED=1]="CREATED",function(_){_[_.ADDED=0]="ADDED",_[_.REMOVED=1]="REMOVED"}(Hl||(Hl={}));let Ts=class extends cc.r{constructor(_){super(_),this._allAnalysisViews=new Pn.Z,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=(0,zi.hh)(),this._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,zi.zE)("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject((0,zi.zE)()),this._attachedToViewResolver=(0,zi.hh)(),this._attachedToViewResolver.promise.catch(()=>{})}get updating(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(_=>_.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}whenAnalysisView(_){var v=this;return(0,Ai.Z)(function*(){yield v._attachedToViewResolver.promise;const O=v._items.get(_);if((0,lt.Wi)(O)||O.state.list===Hl.REMOVED)throw new Ls.Z("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:_});return O.createAnalysisViewTask.promise})()}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),Pl)}_disconnectOwners(){this.handles.remove(Pl),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(_){for(const D of _)this._addAnalysis(D);const v=_.on("after-add",D=>this._addAnalysis(D.item)),O=_.on("after-remove",D=>this._removeAnalysis(D.item));return{remove:()=>{v.remove(),O.remove();for(const D of _)this._removeAnalysis(D)}}}_addAnalysis(_){const v=this._items.get(_);if(null==v){const O={state:{view:hc.PENDING,list:Hl.ADDED},analysis:_,view:null,createAnalysisViewTask:null};this._items.set(_,O),O.createAnalysisViewTask=(0,zi.vr)(D=>this._createAnalysisViewPromise(O,D))}else v.state.list=Hl.ADDED}_removeAnalysis(_){const v=this._items.get(_);null!=v?(v.state.list=Hl.REMOVED,this._scheduleUpdate()):Cc.error("Trying to remove analysis which was not added")}_scheduleUpdate(){(0,lt.pC)(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=(0,rt.Os)(()=>this._update()))}_update(){this._scheduledUpdateHandle=(0,lt.hw)(this._scheduledUpdateHandle),this._items.forEach(_=>{if(_.state.list===Hl.REMOVED)switch(this._items.delete(_.analysis),_.state.view){case hc.PENDING:_.createAnalysisViewTask=(0,lt.IM)(_.createAnalysisViewTask);break;case hc.CREATED:(0,lt.pC)(_.view)&&(this._allAnalysisViews.remove(_.view),_.view=(0,lt.SC)(_.view),_.createAnalysisViewTask=null)}})}_createAnalysisViewPromise(_,v){var O=this;return(0,Ai.Z)(function*(){const D=_.analysis,w=D.type,te=O._analysisModules[w];if(O._creatingViewCount+=1,(0,lt.Wi)(te.module))try{te.module=yield O._loadAnalysisModule(w)}catch(Pe){throw O._creatingViewCount-=1,Pe}if((0,zi.Hc)(v))throw O._creatingViewCount-=1,(0,zi.zE)("AnalysisView creation aborted");const fe=new te.module.default({analysis:D,view:O.view});try{yield fe.when()}catch(Pe){throw O._creatingViewCount-=1,Pe}if((0,zi.Hc)(v))throw O._creatingViewCount-=1,fe.destroy(),(0,zi.zE)("AnalysisView creation aborted");return _.view=fe,_.state.view=hc.CREATED,O._allAnalysisViews.add(fe),O._creatingViewCount-=1,fe})()}_loadAnalysisModule(_){switch(_){case"area-measurement":return Promise.all([T.e(4918),T.e(6777),T.e(7558),T.e(8562),T.e(496)]).then(T.bind(T,60496));case"dimensioning":return Promise.all([T.e(6777),T.e(4735),T.e(1668),T.e(3792),T.e(7558),T.e(6813),T.e(8592),T.e(977)]).then(T.bind(T,19902));case"direct-line-measurement":return Promise.all([T.e(4918),T.e(7558),T.e(8562),T.e(6212)]).then(T.bind(T,96212));case"line-of-sight":return Promise.all([T.e(4735),T.e(1668),T.e(3792),T.e(8592),T.e(9024)]).then(T.bind(T,99024));case"slice":return Promise.all([T.e(4735),T.e(1668),T.e(5671),T.e(8592),T.e(9688)]).then(T.bind(T,99688))}}};(0,Ze._)([(0,nt.Cb)()],Ts.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ts.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)()],Ts.prototype,"_allAnalysisViews",void 0),(0,Ze._)([(0,nt.Cb)()],Ts.prototype,"_creatingViewCount",void 0),Ts=(0,Ze._)([(0,ui.j)("esri.views.3d.analysis.AnalysisViewManager3D")],Ts);const yp=Ts;var wa=T(94425),oa=T(98943);const bd=pn.Z.getLogger("esri.views.3d.state.Constraints");let Ia=class extends Bi.Z{constructor(_){super(_),this.collision=new Qn,this.distance=1/0,this.minimumPoiDistance=4}get altitude(){return this.mode===Us.JY.Local?null:this._get("altitude")||null}set altitude(_){this.mode!==Us.JY.Local?this._set("altitude",_):bd.warn("Altitude constraint is ignored in local scenes")}clampAltitude(_){return this.altitude?(0,li.uZ)(_,this.altitude.min,this.altitude.max):_}clampTilt(_,v){if(!this.tilt)return v;const O=this.tilt(_);return(0,li.uZ)(v,O.min,O.max)}clampDistance(_){return Math.min(_,this.distance)}createDefaultTilt(){return this.mode===Us.JY.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(_){return(v,O=La)=>(O.min=jo.min,O.max=_,O)}_createDefaultTiltLocal(){const _=this.collision.enabled?(0,oa.uV)([[4e3,jo.max],[1e4,(0,li.Vl)(88)],[6e6,(0,li.Vl)(88)]]):()=>jo.max;return(v,O=La)=>(O.min=jo.min,O.max=_(v),O)}_createDefaultTiltGlobal(){const _=(0,oa.uV)(this.collision.enabled?[[4e3,jo.max],[5e4,(0,li.Vl)(88)],[6e6,(0,li.Vl)(88)],[2e7,jo.min]]:[[3e5,jo.max],[3e6,(0,li.Vl)(88)],[6e6,(0,li.Vl)(88)],[2e7,jo.min]]);return(v,O=La)=>(O.min=jo.min,O.max=_(v),O)}};(0,Ze._)([(0,nt.Cb)()],Ia.prototype,"altitude",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Ia.prototype,"collision",void 0),(0,Ze._)([(0,nt.Cb)()],Ia.prototype,"distance",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Ia.prototype,"minimumPoiDistance",void 0),(0,Ze._)([(0,nt.Cb)()],Ia.prototype,"tilt",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ia.prototype,"mode",void 0),Ia=(0,Ze._)([(0,ui.j)("esri.views.3d.state.Constraints")],Ia);const eh=function Cd(_){return{min:-2e5,max:4*_.radius}}(wa.sv),jo={min:(0,li.Vl)(.5),max:(0,li.Vl)(179.5)},La={min:0,max:0};let Qn=class extends Bi.Z{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};(0,Ze._)([(0,nt.Cb)({type:Boolean})],Qn.prototype,"enabled",void 0),(0,Ze._)([(0,nt.Cb)({type:Number})],Qn.prototype,"elevationMargin",void 0),Qn=(0,Ze._)([(0,ui.j)("esri.views.3d.state.Constraints.CollisionConstraint")],Qn);let bi=class extends Bi.Z{constructor(){super(...arguments),this.min=eh.min,this.max=eh.max}};(0,Ze._)([(0,nt.Cb)({type:Number})],bi.prototype,"min",void 0),(0,Ze._)([(0,nt.Cb)({type:Number})],bi.prototype,"max",void 0),bi=(0,Ze._)([(0,ui.j)("esri.views.3d.constraints.AltitudeConstraint")],bi);let Le=class extends Bi.Z{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(_){this._set("near",_),_>=this._get("far")&&(this.far=_+1e-9),this.mode="manual"}castNear(_){return Math.max(1e-8,_)}get far(){return this._get("far")}set far(_){this._set("far",_),_<=this._get("near")&&(this.near=_-1e-9),this.mode="manual"}castFar(_){return Math.max(1e-8,_)}autoUpdate(_,v){"auto"===this.mode&&(this._get("near")!==_&&this._set("near",_),this._get("far")!==v&&this._set("far",v))}};(0,Ze._)([(0,nt.Cb)({type:Number,value:1e-8})],Le.prototype,"near",null),(0,Ze._)([(0,Ga.p)("near")],Le.prototype,"castNear",null),(0,Ze._)([(0,nt.Cb)({type:Number,value:1e-8})],Le.prototype,"far",null),(0,Ze._)([(0,Ga.p)("far")],Le.prototype,"castFar",null),(0,Ze._)([(0,nt.Cb)({type:["auto","manual"]})],Le.prototype,"mode",void 0),Le=(0,Ze._)([(0,ui.j)("esri.views.3d.constraints.ClipDistanceConstraint")],Le);const Qe={min:(0,li.BV)(jo.min),max:(0,li.BV)(jo.max)};let ut=class extends Bi.Z{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(_){this._set("max",_),this.mode="manual"}castMax(_){return(0,li.uZ)(_,Qe.min,Qe.max)}autoUpdate(_){"auto"===this.mode&&this._get("max")!==_&&this._set("max",_)}};(0,Ze._)([(0,nt.Cb)({type:["auto","manual"]})],ut.prototype,"mode",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,value:Qe.max})],ut.prototype,"max",null),(0,Ze._)([(0,Ga.p)("max")],ut.prototype,"castMax",null),ut=(0,Ze._)([(0,ui.j)("esri.views.3d.constraints.TiltConstraint")],ut);let Et=class extends Bi.Z{constructor(){super(...arguments),this.tilt=new ut,this.altitude=new bi,this.clipDistance=new Le}};var xt;(0,Ze._)([(0,nt.Cb)({type:ut})],Et.prototype,"tilt",void 0),(0,Ze._)([(0,nt.Cb)({type:bi})],Et.prototype,"altitude",void 0),(0,Ze._)([(0,nt.Cb)({type:Le})],Et.prototype,"clipDistance",void 0),Et=(0,Ze._)([(0,ui.j)("esri.views.3d.constraints.Constraints")],Et);let Gt=xt=class extends xn.wq{constructor(_){super(_),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(_,v){return null!=v.datetime&&new Date(v.datetime)||null}writeDate(_,v,O){v[O]=_.getTime()}readDirectShadowsEnabled(_,v){return!!v.directShadows}writedirectShadowsEnabled(_,v,O){_&&(v[O]=_)}writeDisplayUTCOffset(_,v){null!=_&&(v.displayUTCOffset=_)}clone(){return new xt(this.cloneConstructProperties())}cloneConstructProperties(){const _={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(_.date=new Date(this.date.getTime())),_}};(0,Ze._)([(0,nt.Cb)({readOnly:!0,type:["sun"],json:{write:!0}})],Gt.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:Date,json:{type:Number,write:{target:"datetime"}}})],Gt.prototype,"date",void 0),(0,Ze._)([(0,Kd.r)("date",["datetime"])],Gt.prototype,"readDate",null),(0,Ze._)([(0,dd.c)("date")],Gt.prototype,"writeDate",null),(0,Ze._)([(0,nt.Cb)({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],Gt.prototype,"directShadowsEnabled",void 0),(0,Ze._)([(0,Kd.r)("directShadowsEnabled",["directShadows"])],Gt.prototype,"readDirectShadowsEnabled",null),(0,Ze._)([(0,dd.c)("directShadowsEnabled")],Gt.prototype,"writedirectShadowsEnabled",null),(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0}})],Gt.prototype,"displayUTCOffset",void 0),(0,Ze._)([(0,dd.c)("displayUTCOffset")],Gt.prototype,"writeDisplayUTCOffset",null),Gt=xt=(0,Ze._)([(0,ui.j)("esri.webscene.SunLighting")],Gt);const ar=Gt;var Ve;let gt=Ve=class extends(sa.Z.EventedMixin(ar)){constructor(_){super(_),this.cameraTrackingEnabled=!0,this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const v=(new Date).getFullYear(),O=new Date("March 15, "+v+" 12:00:00 UTC");this._set("defaultDate",O),this._set("date",O)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(_){return new Ve(_.cloneConstructProperties())}set defaultDate(_){const v=this._get("date")===this._get("defaultDate");_=new Date(_.getTime()),this._set("defaultDate",_),v&&this._set("date",_)}set date(_){null!=_&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(_.getTime())))}autoUpdate(_,v){const O=Ve.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=v.hours,this.positionTimezoneInfo.minutes=v.minutes,this.positionTimezoneInfo.seconds=v.seconds;let D=null;null!=_&&(this.positionTimezoneInfo.autoUpdated=!0,D=this.date&&this.date.getTime(),this._set("date",new Date(_.getTime())));const w=Ve.calculateTimezoneOffset(this.positionTimezoneInfo);if(O!==w&&(Pt.target=this,Pt.timezoneOffset=w,this.emit("timezone-will-change",Pt)),null!=_)return D!==_.getTime()}clone(){const _=this._get("date")===this._get("defaultDate"),v=new Ve(yi(or({},this.cloneConstructProperties()),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}));return _&&v._set("date",v._get("defaultDate")),v.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,v.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,v.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,v.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,v}cloneWithWebsceneLighting(_){const v=this.clone();return null!=_.date&&(v.date=_.date),v.directShadowsEnabled=_.directShadowsEnabled,v.displayUTCOffset=_.displayUTCOffset,v}};(0,Ze._)([(0,nt.Cb)({type:Boolean})],gt.prototype,"cameraTrackingEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],gt.prototype,"ambientOcclusionEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],gt.prototype,"waterReflectionEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:Date})],gt.prototype,"defaultDate",null),(0,Ze._)([(0,nt.Cb)({type:Date})],gt.prototype,"date",null),gt=Ve=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.SunLighting")],gt),function(_){_.calculateTimezoneOffset=function v({hours:O,minutes:D,seconds:w}){return Math.round(O+D/60+w/3600)}}(gt||(gt={}));const Pt={target:null,timezoneOffset:0},Yt=gt;var Jr;let Mi=Jr=class extends xn.wq{constructor(_){super(_),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Jr(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};(0,Ze._)([(0,nt.Cb)({readOnly:!0,type:["virtual"],json:{write:!0}})],Mi.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],Mi.prototype,"directShadowsEnabled",void 0),Mi=Jr=(0,Ze._)([(0,ui.j)("esri.webscene.VirtualLighting")],Mi);const Pi=Mi;var Si;let xs=Si=class extends(sa.Z.EventedMixin(Pi)){constructor(_){super(_),this.ambientOcclusionEnabled=!1,this.waterReflectionEnabled=!1}clone(){return new Si(yi(or({},this.cloneConstructProperties()),{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled}))}static fromWebsceneLighting(_){return new Si(_.cloneConstructProperties())}cloneWithWebsceneLighting(_){const v=this.clone();return v.directShadowsEnabled=_.directShadowsEnabled,v}};(0,Ze._)([(0,nt.Cb)({type:Boolean})],xs.prototype,"ambientOcclusionEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],xs.prototype,"waterReflectionEnabled",void 0),xs=Si=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.VirtualLighting")],xs);const Kn=xs,Mn={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:Yt,virtual:Kn}};var el;let Kl=el=class extends Bi.Z{set quality(_){["low","high"].includes(_)&&this._set("quality",_)}clone(){return new el({quality:this.quality})}};var vu;(0,Ze._)([(0,nt.Cb)({type:["low","high"],value:"low"})],Kl.prototype,"quality",null),Kl=el=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.SceneViewAtmosphere")],Kl);let Tc=vu=class extends xn.wq{constructor(_){super(_),this.type="sunny",this.cloudCover=.5}clone(){return new vu({cloudCover:this.cloudCover})}};(0,Ze._)([(0,vc.J)({sunny:"sunny"})],Tc.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Tc.prototype,"cloudCover",void 0),Tc=vu=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.SunnyWeather")],Tc);const Zu=Tc;var vp;let wh=vp=class extends xn.wq{constructor(_){super(_),this.type="cloudy",this.cloudCover=.5}clone(){return new vp({cloudCover:this.cloudCover})}};(0,Ze._)([(0,vc.J)({cloudy:"cloudy"})],wh.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],wh.prototype,"cloudCover",void 0),wh=vp=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.CloudyWeather")],wh);const Eu=wh;var Ep;let bp=Ep=class extends xn.wq{constructor(_){super(_),this.type="foggy",this.fogStrength=.5}clone(){return new Ep({fogStrength:this.fogStrength})}};(0,Ze._)([(0,vc.J)({foggy:"foggy"})],bp.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],bp.prototype,"fogStrength",void 0),bp=Ep=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.FoggyWeather")],bp);const gf=bp;var yf;let d0=yf=class extends xn.wq{constructor(_){super(_),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new yf({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,Ze._)([(0,vc.J)({rainy:"rainy"})],d0.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d0.prototype,"cloudCover",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],d0.prototype,"precipitation",void 0),d0=yf=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.RainyWeather")],d0);const $u=d0;var h0;let Mc=h0=class extends xn.wq{constructor(_){super(_),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new h0({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,Ze._)([(0,vc.J)({snowy:"snowy"})],Mc.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Mc.prototype,"cloudCover",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],Mc.prototype,"precipitation",void 0),(0,Ze._)([(0,nt.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],Mc.prototype,"snowCover",void 0),Mc=h0=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.SnowyWeather")],Mc);const vm=Mc,th={key:"type",base:Zu,typeMap:{sunny:Zu,cloudy:Eu,rainy:$u,snowy:vm,foggy:gf}},fl=Object.keys(th.typeMap);function xl(_,v){return!!fl.includes(_)||(v.error(`"${_}" is not a valid weather type`),!1)}const bu=1e4,oy={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:ar,virtual:Pi}};let Em=class extends xn.wq{constructor(_){super(_)}clone(){}};(0,Ze._)([(0,nt.Cb)({readOnly:!0,json:{read:!1}})],Em.prototype,"type",void 0),Em=(0,Ze._)([(0,ui.j)("esri.webscene.background.Background")],Em);const bm=Em;var p0,kE=T(60958);const It=yi(or({},kE.a),{nonNullable:!0});let Ae=p0=class extends bm{constructor(_){super(_),this.type="color",this.color=new ol.Z([0,0,0,1])}clone(){return new p0(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};(0,Ze._)([(0,vc.J)({color:"color"},{readOnly:!0})],Ae.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)(It)],Ae.prototype,"color",void 0),Ae=p0=(0,Ze._)([(0,ui.j)("esri.webscene.background.ColorBackground")],Ae);const He=Ae,it={base:bm,key:"type",typeMap:{color:He}},Dt={types:it,json:{read:function ht(_){return(v,O,D)=>{if(!v)return v;for(const w in _.typeMap)if(v.type===w){const te=new _.typeMap[w];return te.read(v,D),te}}}(it),write:{overridePolicy:(_,v,O)=>({enabled:!O||!O.isPresentation})}}};var Vt;const Qt=pn.Z.getLogger("esri.webscene.Environment"),cr=(_,v,O)=>({enabled:!O||!O.isPresentation});let xr=Vt=class extends xn.wq{constructor(_){super(_),this.lighting=new ar,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(_){xl(null==_?void 0:_.type,Qt)&&this._set("weather",_)}clone(){return new Vt(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?Pi.prototype.clone.call(this.lighting):ar.prototype.clone.call(this.lighting),background:(0,al.d9)(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};(0,Ze._)([(0,nt.Cb)({types:oy,nonNullable:!0,json:{write:!0}})],xr.prototype,"lighting",void 0),(0,Ze._)([(0,nt.Cb)(Dt)],xr.prototype,"background",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:cr}}})],xr.prototype,"atmosphereEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:cr}}})],xr.prototype,"starsEnabled",void 0),(0,Ze._)([(0,nt.Cb)({types:th,nonNullable:!0,json:{write:!0},value:new Zu})],xr.prototype,"weather",null),xr=Vt=(0,Ze._)([(0,ui.j)("esri.webscene.Environment")],xr);const Xr=xr;var Vr;let ei=Vr=class extends Xr{constructor(_){super(_),this.atmosphere=new Kl,this.lighting=new Yt}static fromWebsceneEnvironment(_){const v=_.cloneConstructProperties();return new Vr(yi(or({},v),{lighting:"virtual"===v.lighting.type?Kn.fromWebsceneLighting(v.lighting):Yt.fromWebsceneLighting(v.lighting)}))}castLighting(_){return this._convertLighting(_)}applyLighting(_){this.lighting=this._convertLighting(_)}_convertLighting(_){return _?_ instanceof Yt||_ instanceof Kn?_:_ instanceof ar?this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(_):new Yt(_.cloneConstructProperties()):_ instanceof Pi?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(_):new Kn(_.cloneConstructProperties()):(0,Ro.N7)(Mn,_):new Yt}clone(){return new Vr({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,al.d9)(this.background)})}cloneWithWebsceneEnvironment(_){return new Vr(yi(or({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:(0,al.d9)(this.background)},_.cloneConstructProperties()),{lighting:this._getLighting(_)}))}_getLighting(_){return"sun"===_.lighting.type?this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(_.lighting):Yt.fromWebsceneLighting(_.lighting):"virtual"===_.lighting.type?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(_.lighting):Kn.fromWebsceneLighting(_.lighting):Yt.fromWebsceneLighting(_.lighting)}};(0,Ze._)([(0,nt.Cb)({type:Kl,json:{read:!1},nonNullable:!0})],ei.prototype,"atmosphere",void 0),(0,Ze._)([(0,nt.Cb)({nonNullable:!0})],ei.prototype,"lighting",void 0),(0,Ze._)([(0,Ga.p)("lighting")],ei.prototype,"castLighting",null),ei=Vr=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.SceneViewEnvironment")],ei);const di=ei;var _t=T(84161),vi=T(4794),Zi=T(12080),Oi=T(67831),Li=T(99770);function os(_){return Math.min(1,Math.max(0,(_-1e5)/9e5))}const Bs=(0,$t.f)(5802e-9,13558e-9,331e-7),un=(0,$t.f)(65e-8*3,5643e-9,255e-9),jn=1e5;var Dl=T(56598),vn=T(651),vo=T(91056),bo=T(39114),ea=T(12407),Jt=T(67969),ls=T(2078);class Ih extends vo.A{initializeProgram(v){const O=Ih.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)(this.configuration.haze?{blending:(0,ls.wK)(Jt.zi.ONE,Jt.zi.ZERO,Jt.zi.ONE_MINUS_SRC_COLOR,Jt.zi.ONE),colorWrite:ls.BK}:{blending:(0,ls.wK)(Jt.zi.SRC_ALPHA,Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Jt.wb.LEQUAL},colorWrite:ls.BK})}}Ih.shader=new vn.J(Dl.C,()=>T.e(6713).then(T.bind(T,66713)));var En=T(87601);class a_ extends En.m{constructor(){super(...arguments),this.haze=!1}}(0,Ze._)([(0,En.o)()],a_.prototype,"haze",void 0);var Zc=T(17625),Lh=T(59631),$a=T(19597);class f0{constructor(v){this._view=v,this.type="realistic",this.canRender=!0,this._cameraPosition=(0,$t.c)(),this._heightParameters=(0,vi.c)(),this._betasRayleigh=(0,$t.c)(),this._betasCombined=(0,$t.c)(),this._scaleHeight=0,this._radii=(0,Li.a)(),this._cameraHeight=0,this._cameraHeightSq=0,this._cAtmosphere=0,this._innerFadeDistance=0,this._altitudeFade=0,this._lowerElevationBoundRadius=0,this._lowerBoundEarthRadius=wa.sv.radius,this._hazeStrength=1,this._darkenHaze=!1,this._updateRadius(wa.sv.radius)}destroy(){this._atmosphereTechnique=(0,lt.RY)(this._atmosphereTechnique),this._atmosphereHazeTechnique=(0,lt.RY)(this._atmosphereHazeTechnique),this._vao=(0,lt.O3)(this._vao),this._handles=(0,lt.SC)(this._handles)}when(){return Promise.resolve()}initializeRenderContext(v){const O=v.renderContext.rctx,D=this._handles=new cn.Z,w=this._view.basemapTerrain;(0,lt.pC)(w.rootTiles)&&this._updateElevation({spatialReference:w.spatialReference,tile:w.rootTiles[0],extent:w.rootTiles[0].extent,context:"ground"}),D.add((0,pt.on)(()=>this._view.basemapTerrain,"elevation-change",fe=>this._updateElevation(fe),{onListenerAdd:()=>this._updateElevation()})),D.add((0,pt.on)(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));const te=new a_;te.haze=!1,this._atmosphereTechnique=v.shaderTechniqueRepository.acquire(Ih,te),te.haze=!0,this._atmosphereHazeTechnique=v.shaderTechniqueRepository.acquire(Ih,te),this._vao=(0,$a.ow)(O,Lh.Bn),this._scaleHeight=8500,(0,_t.s)(this._betasRayleigh,Bs[0],Bs[1],Bs[2]),(0,_t.s)(this._betasCombined,Bs[0]+un[0],Bs[1]+un[1],Bs[2]+un[2])}render(v){this._render(v,this._atmosphereTechnique,v.offscreenRenderingHelper.depthTexture)}renderHaze(v,O){this._darkenHaze=O,this._render(v,this._atmosphereHazeTechnique,v.offscreenRenderingHelper.linearDepthTexture)}_render(v,O,D){this._update(v.bindParameters.camera);const w=v.rctx.bindTechnique(O,Cm,v.bindParameters);v.offscreenRenderingHelper.renderDepthDetached(()=>{w.bindTexture("depthTex",D),this._renderCommon(O.program,v)})}_renderCommon(v,O){if((0,lt.Wi)(this._vao))return;const D=O.rctx;v.setUniform4fv("heightParameters",this._heightParameters),v.setUniform3fv("cameraPosition",this._cameraPosition),v.setUniform2fv("radii",this._radii),v.setUniform1f("scaleHeight",this._scaleHeight),v.setUniform1f("betaMie",3996e-9),v.setUniform3fv("betaRayleigh",this._betasRayleigh),v.setUniform3fv("betaCombined",this._betasCombined),v.setUniform1f("innerFadeDistance",this._innerFadeDistance),v.setUniform1f("altitudeFade",this._altitudeFade),v.setUniform1f("hazeStrength",this._hazeStrength),D.bindVAO(this._vao),v.assertCompatibleVertexAttributeLocations(this._vao),D.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4)}_adjustRadiusForTesselation(v){return v*Math.cos(Math.PI/16/16)}_updateElevation(v){const O=v?v.tile:(0,lt.Pt)(this._view.basemapTerrain.rootTiles,[null])[0];if((0,lt.Wi)(O)||0!==O.level)return;const D=this._adjustRadiusForTesselation(wa.sv.radius+O.elevationBounds[0]);D!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=D,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const v=this._adjustRadiusForTesselation(wa.sv.radius+this._view.basemapTerrain.elevationBounds.min);(this._lowerBoundEarthRadius<0||v<this._lowerBoundEarthRadius)&&this._updateRadius(v)}_updateRadius(v){this._lowerBoundEarthRadius=v,(0,Oi.a)(this._radii,v,v+jn),this._innerFadeDistance=2*Math.sqrt(1e4*(2*v-1e4))}_update(v){if((0,lt.Wi)(v))return;this._cameraHeight=(0,_t.l)(v.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*this._radii[1];const O=Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/jn));this._heightParameters=(0,vi.f)(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,O),(0,_t.c)(this._cameraPosition,v.eye),this._altitudeFade=os(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?(0,li.t7)(.6,1,(0,li.CW)(9500,10500,this._cameraHeight-wa.sv.radius)):1}static isSupported(v){return v.renderContext.rctx.capabilities.depthTexture}}const Cm=new Zc.K;var js=T(28347),Zn=T(43703),Tm=T(48977),Mm=T(78451),Om=T(34054),Oo=T(26242);function Cp(_=rS){return[_[0],_[1],_[2],_[3]]}function Pm(_,v){return function YE(_,v,O,D,w=Cp()){return w[0]=_,w[1]=v,w[2]=O,w[3]=D,w}(_[0],_[1],_[2],v,Oo.o6.get())}function xm(_,v,O=Cp()){return(0,_t.f)(O,_,v),(0,_t.n)(O,O),O[3]=(0,Om.EU)(_,v),O}const rS=[0,0,1,0];(0,Mm.a)(),(0,Mm.a)();var Ko=T(12015),iS=T(50722);class ly extends vo.A{constructor(v){super(v,null,()=>this.destroy())}initializeProgram(v){const O=ly.shader.get().build();return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.if)(Jt.zi.ONE,Jt.zi.SRC_ALPHA),depthTest:{func:Jt.wb.LEQUAL},colorWrite:ls.BK})}}function HT(_){return(0,lt.pC)(_)&&!_.running}ly.shader=new vn.J(iS.C,()=>T.e(2694).then(T.bind(T,32694)));let vf=class extends Bi.Z{constructor(_){super(_),this._technique=new ly(_),this._vao=(0,$a.ow)(_.rctx)}destroy(){this._technique=(0,lt.RY)(this._technique),this._vao=(0,lt.O3)(this._vao)}render(_,v){const O=_.bindParameters.clouds;if((0,lt.Wi)(this._vao)||(0,lt.Wi)(O.data))return;if(!this._technique.compiled)return void this.requestRender();this._setParallaxParameters(O,_.bindParameters.camera.eye,v);const D=_.rctx.bindTechnique(this._technique,uS,_.bindParameters);_.rctx.bindVAO(this._vao),D.assertCompatibleVertexAttributeLocations(this._vao),_.rctx.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4),function cS(_){return _.crossFade.enabled||_.fadeInOut.stage!==Ko.co.FINISHED||_.fadeIn.stage!==Ko.YF.FINISHED||_.fadeInOutHeight.stage!==Ko.hZ.FINISHED}(O)&&this.requestRender()}_setFadeInStage(_,v){const O=performance.now(),D=_.parallax.anchorPointClouds;_.fadeIn.stage===Ko.YF.FINISHED&&(_.fadeIn.factor=1,(0,_t.c)(D,Uh),_.fadeIn.stage=Ko.YF.CHANGE_ANCHOR,_.crossFade.enabled=!1,_.fadeInOut.stage=Ko.co.FINISHED);const w=$T(_,v);_.fadeIn.stage===Ko.YF.CHANGE_ANCHOR&&w&&HT(_.data)&&((0,_t.c)(D,Uh),_.fadeIn.stage=Ko.YF.FADE_IN,_.startTime=O),_.fadeIn.factor>0&&_.fadeIn.stage===Ko.YF.FADE_IN&&(_.fadeIn.factor=1-(O-_.startTime)/ZT),_.fadeIn.factor<=0&&_.fadeIn.stage===Ko.YF.FADE_IN&&(_.fadeIn.stage=Ko.YF.FINISHED,_.fadeIn.factor=0)}_setCrossFadingStage(_){const v=performance.now(),{crossFade:O}=_,D=_.parallax.anchorPointClouds;_.crossFade.enabled||((0,_t.c)(_.parallaxNew.anchorPointClouds,Uh),_.startTime=v,O.factor=0,_.crossFade.enabled=!0),O.factor<1&&_.crossFade.enabled&&(O.factor=(v-_.startTime)/aS),O.factor>=1&&_.crossFade.enabled&&(_.crossFade.enabled=!1,O.factor=1,(0,_t.c)(D,_.parallaxNew.anchorPointClouds))}_setFadeInOutStage(_,v){const O=performance.now(),{fadeInOut:D,crossFade:w}=_;D.stage===Ko.co.FINISHED&&(_.startTime=O,D.factor=0,D.stage=Ko.co.FADE_OUT),D.factor<1&&D.stage===Ko.co.FADE_OUT&&(D.factor=(O-_.startTime)/oS),D.factor>=1&&D.stage===Ko.co.FADE_OUT&&(D.factor=1,(0,_t.c)(_.parallax.anchorPointClouds,Uh)),D.factor>=1&&D.stage===Ko.co.FADE_OUT&&$T(_,v)&&(D.factor=1,D.stage=Ko.co.SWITCH,_.crossFade.enabled=!1,w.factor=1),HT(_.data)&&D.stage===Ko.co.SWITCH&&(_.startTime=O,D.factor=1,D.stage=Ko.co.FADE_IN,(0,_t.c)(_.parallax.anchorPointClouds,Uh),_.crossFade.enabled=!1,w.factor=1),D.factor>0&&D.stage===Ko.co.FADE_IN&&(D.factor=1-(O-_.startTime)/ZT),D.factor<=0&&D.stage===Ko.co.FADE_IN&&(D.stage=Ko.co.FINISHED,D.factor=0)}_setFadeInOutHeight(_,v){const O=performance.now(),D=_.fadeInOutHeight,w=(O-(D.stage===Ko.hZ.FINISHED?O:_.startTimeHeightFade))/lS;D.factor+=v?-w:w,_.startTimeHeightFade=O,D.factor=(0,li.uZ)(D.factor,0,1),D.stage=Ko.hZ.HEIGHT_FADE}_setParallaxParameters(_,v,O){const{parallax:D}=_;_.fadeInOutHeight.factor<0&&(_.fadeInOutHeight.factor=(0,_t.l)(v)-this.planetRadius>bu?1:0),(0,_t.n)(Uh,v),(0,_t.g)(Uh,Uh,this.planetRadius),0===D.anchorPointClouds[0]&&0===D.anchorPointClouds[1]&&0===D.anchorPointClouds[2]&&(0,_t.c)(D.anchorPointClouds,Uh);const w=(0,_t.l)((0,_t.b)(nS,D.anchorPointClouds,Uh));let te=!0;w>_.fadeIn.distanceThresholdFactor*D.cloudsHeight||_.fadeIn.stage!==Ko.YF.FINISHED?this._setFadeInStage(_,v):w>_.fadeInOut.distanceThresholdFactor*D.cloudsHeight||_.fadeInOut.stage!==Ko.co.FINISHED?this._setFadeInOutStage(_,v):w>_.crossFade.distanceThresholdFactor*D.cloudsHeight&&!O||_.crossFade.enabled?this._setCrossFadingStage(_):te=!1;const fe=(0,_t.l)(v),Pe=fe-this.planetRadius;if((Pe>17e3||Pe<-bu)&&_.fadeInOutHeight.factor<1?_.fadeInOutHeight.factor=1:(Pe>bu||Pe<-3500)&&_.fadeInOutHeight.factor<1?this._setFadeInOutHeight(_,!1):Pe<bu&&Pe>-3500&&_.fadeInOutHeight.factor>0?this._setFadeInOutHeight(_,!0):_.fadeInOutHeight.stage=Ko.hZ.FINISHED,D.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(fe*fe-this.planetRadius*this.planetRadius,0))/fe,xm(KT,D.anchorPointClouds,l_),D.transform=(0,Zn.c)(),(0,js.e)(D.transform,D.transform,l_[3],l_),te){const{parallaxNew:Ue}=_;xm(KT,Ue.anchorPointClouds,l_),Ue.transform=(0,Zn.c)(),(0,js.e)(Ue.transform,Ue.transform,l_[3],l_)}(0,_t.c)(_.cameraPositionLastFrame,v)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],vf.prototype,"rctx",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],vf.prototype,"viewingMode",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],vf.prototype,"planetRadius",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],vf.prototype,"requestRender",void 0),vf=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.CloudsComposition")],vf);const KT=(0,$t.f)(0,0,1),l_=Cp(),Uh=(0,$t.c)(),nS=(0,$t.c)(),ZT=500,oS=250,aS=500,lS=500;function $T(_,v){return(0,_t.z)(_.cameraPositionLastFrame,v)}const uS=new Zc.K;var Aa=T(30217),c_=T(9545),tl=T(14658),kT=T(89803),u_=T(32849);class Dm{constructor(v,O,D,w,te,fe,Pe,Ue,Xe=.5){this.coverage=v,this.density=O,this.absorption=D,this.cloudSize=w,this.detailSize=te,this.smoothness=fe,this.cloudHeight=Pe,this.raymarchingStepType=Ue,this.median=Xe}}const YT={sunny:new Dm([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],u_.p.SIXTEEN),cloudy:new Dm([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],u_.p.TWOHUNDRED,.6),rainy:new Dm([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],u_.p.TWOHUNDRED,.4),snowy:new Dm([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],u_.p.HUNDRED,.65),foggy:new Dm([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],u_.p.SIXTEEN)};class cy extends vo.A{constructor(v,O){super(v,O,()=>this.destroy())}initializeProgram(v){const O=cy.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.wK)(Jt.zi.ONE,Jt.zi.ONE,Jt.zi.ZERO,Jt.zi.ZERO),depthTest:{func:Jt.wb.LEQUAL},colorWrite:ls.BK})}}cy.shader=new vn.J(kT.a,()=>T.e(8698).then(T.bind(T,78698)));var _0=T(64312),d_=T(85755),dS=T(42474);class Am extends vo.A{initializeProgram(v){const O=Am.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:this.configuration.mode===_0.u.Full?(0,ls.if)(Jt.zi.ONE,Jt.zi.ZERO):(0,ls.wK)(Jt.zi.ZERO,Jt.zi.ONE,Jt.zi.ONE,Jt.zi.ZERO),depthTest:{func:Jt.wb.ALWAYS},colorWrite:ls.BK})}}Am.shader=new vn.J(dS.N,()=>T.e(5337).then(T.bind(T,35337)));var pc=T(85775);class JT extends Bi.Z{constructor(v){let O;super(v),this._weatherTile=(0,c_.f)(0,0),this._needsRender=!0,this._frameBuffer=new pc.X(v.context.renderContext.rctx,{colorTarget:Jt.Lm.TEXTURE,width:d_.IQ,height:d_.IQ},{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:Jt.cw.LINEAR,hasMipmap:!1,width:d_.IQ,height:d_.IQ}),this._vao=(0,$a.ow)(v.context.renderContext.rctx),this._shaderTechniqueRepository=v.context.shaderTechniqueRepository,this._ensureRendered=()=>((0,lt.pC)(O)?(0,lt.pC)(this.weatherMapTechnique)&&this.weatherMapTechnique.compiled&&this._needsRender&&(O=this._render(v.context.renderContext.rctx,_0.u.WeatherMap)):(0,lt.pC)(this.fullTechnique)&&this.fullTechnique.compiled&&(O=this._render(v.context.renderContext.rctx,_0.u.Full)),O)}get textureAtlas(){return this._ensureRendered()}_setDirty(){this._needsRender=!0}updateWeatherMap(v){this._weatherTile[0]===v[0]&&this._weatherTile[1]===v[1]||(this._weatherTile=v,this._setDirty())}destroy(){this._fullTechnique=(0,lt.RY)(this._fullTechnique),this._weatherMapTechnique=(0,lt.RY)(this._weatherMapTechnique),this._frameBuffer=(0,lt.O3)(this._frameBuffer),this._vao=(0,lt.O3)(this._vao)}get fullTechnique(){if((0,lt.Wi)(this._fullTechnique)){const v=new _0.i;v.mode=_0.u.Full,this._fullTechnique=this._shaderTechniqueRepository.acquire(Am,v)}return this._fullTechnique}get weatherMapTechnique(){if((0,lt.Wi)(this._weatherMapTechnique)){const v=new _0.i;v.mode=_0.u.WeatherMap,this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(Am,v)}return this._weatherMapTechnique}_render(v,O){if((0,lt.Wi)(this._vao)||(0,lt.Wi)(this._frameBuffer))return null;const D=O===_0.u.Full?this.fullTechnique:this.weatherMapTechnique;if((0,lt.Wi)(D))return null;const w=v.getViewport();v.setViewport(0,0,d_.IQ,d_.IQ),v.bindFramebuffer(this._frameBuffer);const te=v.bindTechnique(D);return te.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]),v.bindVAO(this._vao),te.assertCompatibleVertexAttributeLocations(this._vao),v.gl.drawArrays(v.gl.TRIANGLE_STRIP,0,4),v.setViewport(w.x,w.y,w.width,w.height),this._needsRender=!1,this._frameBuffer.colorTexture}}(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],JT.prototype,"context",void 0);var JE=T(74202);let Oc=class extends Bi.Z{constructor(_){super(_),this._frameTask=null,this._handles=new cn.Z,this._cubeMapSize=(0,Jo.Z)("esri-mobile")?1024:2048,this._techniques=[],this._techniqueConfiguration=new u_.t,this._bindParameters=new JE.p(null,null,null),this._drawParameters=new kT.C,this._weatherTile=(0,c_.f)(0,0),this._weatherTileCount=128,this.coverage=(0,li.t7)($c.coverage[0],$c.coverage[1],.5),this.density=(0,li.t7)($c.density[0],$c.density[1],.5),this.absorption=(0,li.t7)($c.absorption[0],$c.absorption[1],.5),this.cloudSize=(0,li.t7)($c.cloudSize[0],$c.cloudSize[1],.5),this.detailSize=(0,li.t7)($c.detailSize[0],$c.detailSize[1],.5),this.smoothness=(0,li.t7)($c.smoothness[0],$c.smoothness[1],.5),this.cloudHeight=(0,li.t7)($c.cloudHeight[0],$c.cloudHeight[1],.5),this.raymarchingStepType=$c.raymarchingStepType,this._cloudRadius=0,this._viewMatrix=(0,Zn.c)(),this._cameraPositionLastFrame=(0,$t.c)(),this.running=!1}_getTechnique(_){return this._techniques[_]||(this._techniqueConfiguration.steps=_,this._techniques[_]=new cy({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[_])}_getWeatherTile(){let O=(0,c_.f)((this.view.camera.position.latitude+90)/180,(this.view.camera.position.longitude+180)/360);const D=Math.floor(this._weatherTileCount*Math.abs(2*O[0]-1));O=(0,c_.f)(Math.floor(2*this._weatherTileCount*O[0]),Math.floor(4*(this._weatherTileCount-D)*O[1]));let w=0,te=0;if((0,lt.pC)(this.view.environment)&&"sun"===this.view.environment.lighting.type&&(0,lt.pC)(this.view.environment.lighting.date)){const fe=new Date(this.view.environment.lighting.date);fe.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),w=31*fe.getUTCMonth()+fe.getUTCDate(),te=fe.getUTCFullYear()}return O[0]=(O[0]+w)%(2*this._weatherTileCount),O[1]=(O[1]+te%100)%(4*this._weatherTileCount),O}initialize(){this._vao=(0,$a.ow)(this.context.renderContext.rctx);const _=(0,Zi.Iu)(this.view.spatialReference);this._cloudRadius=.5*_.radius,this.setDirty(),this._weatherTile=this._getWeatherTile(),this._frameTask=this.view.resourceController.scheduler.registerTask(Gn.T8.CLOUDS_GENERATOR,this),this._handles.add(this._frameTask),this._handles.add((0,pt.YP)(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),pt.nn))}destroy(){this._handles.destroy(),this._techniques.forEach(_=>(0,lt.RY)(_)),this._techniques=null,this._frameBufferCube=(0,lt.O3)(this._frameBufferCube),this._vao=(0,lt.O3)(this._vao),this._noiseTexture=(0,lt.SC)(this._noiseTexture)}_ensureNoiseTexture(){return(0,lt.Wi)(this._noiseTexture)&&(this._noiseTexture=new JT({context:this.context}),this._noiseTexture.updateWeatherMap(this._weatherTile)),this._noiseTexture.textureAtlas}ensureWeatherTile(){const _=this._getWeatherTile();(0,lt.pC)(this._noiseTexture)&&(0,lt.pC)(this.context)&&this._noiseTexture.updateWeatherMap(_),_[0]===this._weatherTile[0]&&_[1]===this._weatherTile[1]||(this._weatherTile=_,this.setDirty())}get frameBufferCube(){return(0,lt.Wi)(this._frameBufferCube)&&(this._frameBufferCube=new pc.X(this.context.renderContext.rctx,{colorTarget:Jt.Lm.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},{target:Jt.No.TEXTURE_CUBE_MAP,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:Jt.cw.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize})),this._frameBufferCube}get cubeMap(){return this._frameBufferCube}isFading(_){return _.crossFade.enabled||_.fadeInOut.stage===Ko.co.FADE_OUT||_.fadeInOutHeight.stage!==Ko.hZ.FINISHED}applyPreset(_,v){const O=_.median,D=w=>{const te=(0,li.t7)(w[0],w[1],O);return v<.5?(0,li.t7)(w[0],te,2*v):(0,li.t7)(te,w[1],2*(v-.5))};this.coverage=D(_.coverage),this.density=D(_.density),this.absorption=D(_.absorption),this.cloudSize=D(_.cloudSize),this.detailSize=D(_.detailSize),this.smoothness=D(_.smoothness),this.cloudHeight=D(_.cloudHeight),this.raymarchingStepType=_.raymarchingStepType}setDirty(){this.running=!0}runTask(_){if(0===this.coverage||(0,lt.Wi)(this._vao))return void(this.running=!1);const v=this._getTechnique(this.raymarchingStepType);if(!v.compiled)return;if(!(0,_t.z)(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))return void(0,_t.c)(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);this.ensureWeatherTile();const O=this._ensureNoiseTexture();if((0,lt.Wi)(O))return;const D=this.context.renderContext.rctx,w=D.bindTechnique(v),te=1+this.absorption,fe=(0,li.t7)(35,120,this.absorption);w.bindTexture("cloudShapeTexture",O),w.setUniform1f("cloudRadius",this._cloudRadius),w.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize),w.setUniform1f("power",fe),w.setUniform1f("sigmaE",te),w.setUniform1f("density",(0,li.t7)(0,.3,this.density)),w.setUniform1f("cloudSize",(0,li.t7)(0,.02,Math.max(.01,1-this.cloudSize))),w.setUniform1f("detailSize",(0,li.t7)(0,.2,Math.max(.01,1-this.detailSize))),w.setUniform1f("smoothness",(0,li.t7)(0,.5,1-this.smoothness)),w.setUniform1f("cloudHeight",(0,li.t7)(0,1500,this.cloudHeight)),w.setUniform1f("coverage",this.coverage),D.bindVAO(this._vao),w.assertCompatibleVertexAttributeLocations(this._vao);const Pe=D.getViewport();D.setViewport(0,0,this._cubeMapSize,this._cubeMapSize),D.bindFramebuffer(this.frameBufferCube);for(let Ue=0;Ue<5;Ue++)(0,js.y)(this._viewMatrix,fS,hS[Ue],pS[Ue]),(0,Aa.f)(this._drawParameters.viewMatrix,this._viewMatrix),this.frameBufferCube.setColorTextureTarget(Jt.No.TEXTURE_CUBE_MAP_POSITIVE_X+Ue),w.bindDraw(this._drawParameters,this._bindParameters),D.gl.drawArrays(D.gl.TRIANGLE_STRIP,0,4),D.gl.flush();this.running=!1,D.setViewport(Pe.x,Pe.y,Pe.width,Pe.height),this.requestRender(),_.madeProgress()}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Oc.prototype,"context",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Oc.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Oc.prototype,"requestRender",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"_frameTask",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"coverage",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"density",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"absorption",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"cloudSize",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"detailSize",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"smoothness",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"cloudHeight",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"raymarchingStepType",void 0),(0,Ze._)([(0,nt.Cb)()],Oc.prototype,"running",void 0),Oc=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.CloudsGenerator")],Oc);const hS=[(0,tl.f)(1,0,0),(0,tl.f)(-1,0,0),(0,tl.f)(0,1,0),(0,tl.f)(0,-1,0),(0,tl.f)(0,0,1)],pS=[(0,tl.f)(0,1,0),(0,tl.f)(0,1,0),(0,tl.f)(0,0,-1),(0,tl.f)(0,0,1),(0,tl.f)(0,1,0)],fS=(0,tl.z)(),$c=YT.sunny;var _S=T(50570);class Sm extends vo.A{initializeProgram(v){const O=Sm.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)(this.configuration.haze?{blending:(0,ls.wK)(Jt.zi.ONE,Jt.zi.ZERO,Jt.zi.ONE_MINUS_SRC_COLOR,Jt.zi.ONE),colorWrite:ls.BK}:{blending:(0,ls.wK)(Jt.zi.SRC_ALPHA,Jt.zi.ZERO,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE),colorWrite:ls.BK})}}Sm.shader=new vn.J(_S.F,()=>T.e(3354).then(T.bind(T,53354)));class XE extends En.m{constructor(){super(...arguments),this.haze=!1}}(0,Ze._)([(0,En.o)()],XE.prototype,"haze",void 0);let Rm=class extends Bi.Z{constructor(_){super(_),this._fogColor=(0,tl.c)(),this._fogColorAtNight=(0,tl.c)(),this._cameraDirection=(0,tl.c)(),this._foggyFadeStart=.95,this._foggyFadeEnd=1,this._hazeFadeStart=.7,this._hazeFadeEnd=1,this._strength=4e-6,this._vao=(0,$a.ow)(_.context.renderContext.rctx,Lh.Bn);const O=(0,Zi.Iu)(_.view.spatialReference);this._planetRadius=O.radius,this._atmosphereRadius=O.radius+jn}destroy(){this._hazeFogTechnique=(0,lt.RY)(this._hazeFogTechnique),this._thickFogTechnique=(0,lt.RY)(this._thickFogTechnique),this._vao=(0,lt.O3)(this._vao)}get _shaderTechniqueRepository(){return this.context.shaderTechniqueRepository}set strength(_){this._strength=_}get strength(){return this._strength}get thickFogTechnique(){if((0,lt.Wi)(this._thickFogTechnique)){const _=new XE;_.haze=!1,this._thickFogTechnique=this._shaderTechniqueRepository.acquire(Sm,_)}return this._thickFogTechnique}get hazeFogTechnique(){if((0,lt.Wi)(this._hazeFogTechnique)){const _=new XE;_.haze=!0,this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(Sm,_)}return this._hazeFogTechnique}when(){return Promise.resolve()}render(_,v,O){if(0===this.view.basemapTerrain.baseOpacity&&!v||(this._update(_,v,O),this._fogAmount<=0))return;const D=v?this.thickFogTechnique:this.hazeFogTechnique;if(!D.compiled)return void this.context.requestRender();const w=_.offscreenRenderingHelper,te=_.rctx.bindTechnique(D,mS,_.bindParameters);w.renderDepthDetached(()=>{te.bindTexture("depthTex",w.depthTexture),this._renderFog(D.program,_)})}_renderFog(_,v){if((0,lt.Wi)(this._vao))return!1;const O=v.rctx;return _.setUniform3fv("cameraPosition",v.bindParameters.camera.eye),_.setUniform1f("atmosphereC",this._atmosphereC),_.setUniform1f("fogStrength",this._strength),_.setUniform1f("fogAmount",this._fogAmount),_.setUniform3fv("fogColor",this._fogColor),O.bindVAO(this._vao),_.assertCompatibleVertexAttributeLocations(this._vao),O.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4),!0}_update(_,v,O){const D=_.bindParameters.camera,w=v?.1:0;O?(0,_t.s)(this._fogColor,.5,.5,.5):v?(0,_t.s)(this._fogColor,1.5,1.5,1.5):(0,_t.s)(this._fogColor,.24,.44,.8),(0,_t.g)(this._fogColorAtNight,this._fogColor,w),(0,_t.n)(this._cameraDirection,D.eye);const te=Math.max(0,(0,_t.e)(this._cameraDirection,_.bindParameters.lighting.lightingMainDirection));(0,_t.h)(this._fogColor,this._fogColorAtNight,this._fogColor,te);const fe=(0,_t.l)(D.eye);this._atmosphereC=fe*fe-this._atmosphereRadius*this._atmosphereRadius,this._fogAmount=v?1-(0,li.CW)(this._foggyFadeStart*bu,this._foggyFadeEnd*bu,Math.abs(fe-this._planetRadius)):1-(0,li.CW)(this._hazeFadeStart*bu,this._hazeFadeEnd*bu,Math.abs(fe-this._planetRadius))}static isSupported(_){return _.capabilities.depthTexture}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Rm.prototype,"context",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Rm.prototype,"view",void 0),Rm=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.Fog")],Rm);const mS=new Zc.K;var m0=T(70026),QE=T(4300),Ef=T(49115);class h_ extends vo.A{initializeProgram(v){const O=h_.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)(this.configuration.geometry===Ef.n.Cylinder?{blending:(0,ls.wK)(Jt.zi.SRC_ALPHA,Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE_MINUS_SRC_ALPHA),culling:ls.Rd,depthTest:{func:Jt.wb.LEQUAL},colorWrite:ls.BK}:{blending:(0,ls.wK)(Jt.zi.SRC_ALPHA,Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Jt.wb.LEQUAL},colorWrite:ls.BK})}}h_.shader=new vn.J(QE.a,()=>T.e(5359).then(T.bind(T,75359)));const XT="data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII=";var g0=T(4511),bf=T(19625),gS=T(57521),Fo=T(16396),Zl=T(83994),ka=T(55086),_l=T(26906),ku=T(49353);const yS=pn.Z.getLogger("esri.views.3d.environment.PanoramicAtmosphere");class vS{constructor(){this.type="panoramic",this._techniqueConfig=new Ef.f,this._passParameters=new QE.S,this._readyResolver=(0,zi.hh)(),this._readyController=new AbortController}destroy(){this._readyResolver.reject(),this._passParameters.texture=(0,lt.O3)(this._passParameters.texture),this._vao=(0,lt.O3)(this._vao),this._readyController=(0,lt.IM)(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(v){this._techniqueConfig.geometry=Ef.n.Cylinder,this._technique=v.shaderTechniqueRepository.acquire(h_,this._techniqueConfig);const O=v.renderContext.rctx;this._vao=this._createVertexArrayObject(O),this._vaoCount=(0,_l._V)(this._vao,"geometry"),(0,m0.t)(XT,{signal:this._readyController.signal}).then(D=>{this._passParameters.texture=new ka.x(O,{pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:Jt.cw.LINEAR,flipped:!0},D),v.requestRender(),this._readyController=null,this._readyResolver.resolve()}).catch(D=>{(0,zi.D_)(D)||yS.error("Unable to initialize atmosphere: image request failed",D),this._readyResolver.reject()})}get canRender(){return null!=this._passParameters.texture}render(v){const O=v.rctx,D=O.bindTechnique(this._technique,this._passParameters,v.bindParameters);(function ES(_,v){(0,js.c)(_,v),_[12]=0,_[13]=0,_[14]=0,_[15]=1})(QT,v.bindParameters.camera.viewMatrix),D.setUniformMatrix4fv("view",QT),O.bindVAO(this._vao),D.assertCompatibleVertexAttributeLocations(this._vao),O.drawArrays(Jt.MX.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(v){const O=gS.Z.createPolySphereGeometry(1,2,!1),D=O.indices.get(Fo.T.POSITION);for(let Pe=0;Pe<D.length;Pe+=3){const Ue=D[Pe];D[Pe]=D[Pe+2],D[Pe+2]=Ue}const w=O.vertexAttributes.get(Fo.T.POSITION).data,te=qT.createBuffer(D.length),fe=te.position;for(let Pe=0;Pe<D.length;++Pe){const Ue=3*D[Pe];fe.set(Pe,0,w[Ue]),fe.set(Pe,1,w[Ue+1]),fe.set(Pe,2,w[Ue+2])}return new ku.U(v,bo.i,{geometry:(0,g0.K)(qT)},{geometry:Zl.f.createVertex(v,Jt.l1.STATIC_DRAW,te.buffer)})}}const QT=(0,Zn.c)(),qT=(0,bf.U$)().vec3f(Fo.T.POSITION);var io=T(27422),bS=T(5585);class CS extends Zc.K{constructor(){super(...arguments),this.time=0,this.radius=1}}class Tp extends vo.A{initializeProgram(v){const O=Tp.shader.get().build(this.configuration);return new ea.$(v.rctx,O,Tp.attributeLocation)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.wK)(Jt.zi.ONE,Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Jt.wb.LEQUAL},colorWrite:ls.BK})}}Tp.shader=new vn.J(bS.P,()=>T.e(8954).then(T.bind(T,78954))),Tp.attributeLocation=new Map([[Fo.T.POSITION,0],[Fo.T.INSTANCEFEATUREATTRIBUTE,1]]);var uy=T(6067),TS=T(42836);let Cf=class extends Bi.Z{constructor(_){super(_),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._opacity=1,this._width=500,this._offset=(0,$t.c)(),this._tile=(0,$t.c)(),this._particleColor=(0,tl.c)(),this._particleColorAtNight=(0,tl.c)(),this._nightMultiplier=.7,this._cameraDirection=(0,tl.c)(),this._renderParameters=new CS,this._animation=new TS.d,this._updatingTracking=new Yd.t,this._renderParameters.time=0,this._renderParameters.radius=(0,Zi.Iu)(_.view.spatialReference).radius,this._shaderTechniqueRepository=_.context.shaderTechniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechnique=(0,lt.RY)(this._snowTechnique),this._rainTechnique=(0,lt.RY)(this._rainTechnique),this._vao=(0,lt.O3)(this._vao),this._instanceIdBuffer=(0,lt.O3)(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get rainTechnique(){if((0,lt.Wi)(this._rainTechnique)){const _=new uy.Y;_.type=uy.H.Rain,this._rainTechnique=this._shaderTechniqueRepository.acquire(Tp,_)}return this._rainTechnique}get snowTechnique(){if((0,lt.Wi)(this._snowTechnique)){const _=new uy.Y;_.type=uy.H.Snow,this._snowTechnique=this._shaderTechniqueRepository.acquire(Tp,_)}return this._snowTechnique}update(_){return this._animation.advance(_)}render(_,v,O){const D="rainy"===O,w=D?this.rainTechnique:this.snowTechnique;if(!w.compiled)return void this.context.requestRender();const te=_.rctx;if(this._ensureResources(te),(0,lt.Wi)(w)||(0,lt.Wi)(this._vao)||(0,lt.Wi)(this._instanceIdBuffer)||((0,lt.pC)(_.bindParameters.clouds.data)&&(this._opacity=1-_.bindParameters.clouds.fadeInOutHeight.factor),this._opacity<=0))return;v=v<.5?(0,li.t7)(0,.35,2*v):(0,li.t7)(.35,1,2*(v-.5));const Pe=te.bindTechnique(w);this._renderParameters.camera=_.bindParameters.camera,this._renderParameters.time=(D?this._rainSpeed:this._snowSpeed)*(0,io.D9)(this._animation.time),this._renderParameters.time=this._renderParameters.time%1e5,this._update(Pe,O,_),te.bindVAO(this._vao);const Ue=Tp.attributeLocation;Pe.assertCompatibleVertexAttributeLocations(this._vao),(0,_l.XP)(te,Ue,this._instanceIdBuffer,eM,0),te.capabilities.instancing.drawArraysInstanced(Jt.MX.TRIANGLES,0,3,this._numParticles*v),(0,_l.UF)(te,Ue,this._instanceIdBuffer,eM)}_update(_,v,O){const D=O.bindParameters.camera,w=D.eye;this._tile[0]=Math.floor((w[0]+.5*this._width)/this._width),this._tile[1]=Math.floor((w[1]+.5*this._width)/this._width),this._tile[2]=Math.floor((w[2]+.5*this._width)/this._width),this._offset[0]=w[0]-this._tile[0]*this._width,this._offset[1]=w[1]-this._tile[1]*this._width,this._offset[2]=w[2]-this._tile[2]*this._width,_.setUniform1f("width",this._width),_.setUniform3fv("offset",this._offset),_.setUniformMatrix4fv("view",D.viewMatrix),_.setUniform3fv("cameraPosition",w),_.bindPass(null,O.bindParameters),_.setUniform1f("time",this._renderParameters.time),"rainy"===v?(0,_t.s)(this._particleColor,.85,.85,.85):(0,_t.s)(this._particleColor,1,1,1),(0,_t.g)(this._particleColorAtNight,this._particleColor,this._nightMultiplier),(0,_t.n)(this._cameraDirection,w);const te=Math.max(0,(0,_t.e)(this._cameraDirection,O.bindParameters.lighting.lightingMainDirection));(0,_t.h)(this._particleColor,this._particleColorAtNight,this._particleColor,te),_.setUniform3fv("particleColor",this._particleColor),_.setUniform1f("opacity",this._opacity)}_ensureResources(_){(0,lt.Wi)(this._vao)&&(this._vao=this._createVertexArrayObject(_)),(0,lt.Wi)(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(_))}_createInstanceIndices(_){const v=[];for(let O=0;O<this._numParticles;O++)v.push(O);return Zl.f.createVertex(_,Jt.l1.STATIC_DRAW,new Float32Array(v))}_createVertexArrayObject(_){const v=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new ku.U(_,Tp.attributeLocation,{geometry:(0,g0.K)(MS)},{geometry:Zl.f.createVertex(_,Jt.l1.STATIC_DRAW,v)})}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Cf.prototype,"context",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Cf.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Cf.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)()],Cf.prototype,"_updatingTracking",void 0),Cf=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.Precipitation")],Cf);const MS=(0,bf.U$)().vec3f(Fo.T.POSITION),eM=(0,g0.K)((0,bf.U$)().f32(Fo.T.INSTANCEFEATUREATTRIBUTE),1);var Td=T(2282);const PS=pn.Z.getLogger("esri.views.3d.environment.SimpleAtmosphere"),DS=(0,oa.uV)([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);class AS{constructor(v){this.view=v,this.type="simple",this._renderData={texV:(0,Li.a)(),silCircleCenter:(0,$t.c)(),silCircleV1:(0,$t.c)(),silCircleV2:(0,$t.c)(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0},this._passParameters=new QE.S,this._fadeVaoCount=0,this._readyResolver=(0,zi.hh)(),this._readyController=new AbortController,this.texV1=1,this.canRender=!0,this.isOnMars=(0,qs.BZ)(v.spatialReference);const O=(0,Zi.Iu)(v.spatialReference);this.planetRadius=O.radius,this.outerRimWidth=O.outerAtmosphereRimWidth,this.innerRimFactor=(this.planetRadius+-1e4)/this.planetRadius,this.middleRimFactor=(this.planetRadius+0)/this.planetRadius,this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius,this.texV0=0/this.outerRimWidth,this.texVScale=this.texV1-this.texV0}destroy(){this._readyResolver.reject(),this._cameraChangeHandle=(0,lt.hw)(this._cameraChangeHandle),this._passParameters.texture=(0,lt.O3)(this._passParameters.texture),this._fadeVao=(0,lt.O3)(this._fadeVao),this._vao=(0,lt.O3)(this._vao),this._readyController=(0,lt.IM)(this._readyController)}when(){return this._readyResolver.promise}initializeRenderContext(v){var O=this;return(0,Ai.Z)(function*(){O._shaderTechniqueRepository=v.shaderTechniqueRepository;const D=v.renderContext.rctx;O._cameraChangeHandle=(0,pt.YP)(()=>{var fe;return null==(fe=O.view.state)?void 0:fe.camera},()=>v.requestRender(),pt.tX),O._vao=O._createRibbon(D),O._vaoCount=(0,_l._V)(O._vao,"geometry"),O._fadeVao=(0,$a.ow)(D),O._fadeVaoCount=(0,_l._V)(O._fadeVao,"geometry");const w=O.isOnMars?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg==":XT,te=O._readyController.signal;try{const fe=yield(0,m0.t)(w,{signal:te});(0,zi.k_)(te),O._passParameters.texture=new ka.x(D,{pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:Jt.cw.LINEAR,flipped:!0},fe),v.requestRender(),O._readyController=null,O._readyResolver.resolve()}catch(fe){(0,zi.D_)(fe)||PS.error("Unable to initialize simple atmosphere: image request failed",fe),O._readyResolver.reject(fe)}})()}get coneTechnique(){if((0,lt.Wi)(this._coneTechnique)){const v=new Ef.f;v.geometry=Ef.n.Cone,this._coneTechnique=this._shaderTechniqueRepository.acquire(h_,v)}return this._coneTechnique}get undergroundTechnique(){if((0,lt.Wi)(this._undergroundTechnique)){const v=new Ef.f;v.geometry=Ef.n.Underground,this._undergroundTechnique=this._shaderTechniqueRepository.acquire(h_,v)}return this._undergroundTechnique}render(v){const O=v.bindParameters.camera;this._update(O);const D=v.rctx;if(this._renderData.undergroundFadeAlpha<1){const w=D.bindTechnique(this.coneTechnique,this._passParameters,v.bindParameters);w.setUniformMatrix4fv("proj",O.projectionMatrix),w.setUniformMatrix4fv("view",O.viewMatrix),w.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),w.setUniform3fv("silCircleV1",this._renderData.silCircleV1),w.setUniform3fv("silCircleV2",this._renderData.silCircleV2),w.setUniform2fv("texV",this._renderData.texV),w.setUniform1f("altitudeFade",this._renderData.altitudeFade),w.setUniform1f("innerScale",this._renderData.innerScale),D.bindVAO(this._vao),D.drawArrays(Jt.MX.TRIANGLES,0,this._vaoCount)}if(this._renderData.undergroundFadeAlpha>0){const w=D.bindTechnique(this.undergroundTechnique,this._passParameters,v.bindParameters);w.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),w.setUniform3fv("cameraPosition",O.eye),D.bindVAO(this._fadeVao),D.drawArrays(Jt.MX.TRIANGLE_STRIP,0,this._fadeVaoCount)}}renderHaze(){return!1}_update(v){const O=(0,$t.c)(),D=this.planetRadius,w=(0,_t.l)(v.eye),te=w-D;if(te<0){const Wt=Math.min(-te/5e3,1);this._renderData.undergroundFadeAlpha=Wt}else this._renderData.undergroundFadeAlpha=0;const fe=Math.max(50,te);this._renderData.innerScale=function SS(_,v,O){return _*_/(Math.sqrt(_*_-v*v)*Math.sqrt(_*_-O*O)+v*O)}(D+fe,D,D+-1e4)-1,this._renderData.altitudeFade=os(te),(0,_t.g)(O,v.eye,(D+50)/w),iM(O,v.center,v.up,D,this._renderData);const Ue=this._computeScreenRimWidth(v,O,v.up,this._renderData),Xe=1-511/512,st=DS(te);let vt=this.texV0+Xe*this.texVScale,Ct=this.texV0+Ue*st*this.texVScale;if(te>50){iM(v.eye,v.center,v.up,D,this._renderData);const Wt=this._computeScreenRimWidth(v,v.eye,v.up,this._renderData),Kt=(0,li.uZ)((Wt-1.5)/(Ue-1.5),0,1);vt=this.texV0+Kt*Xe*this.texVScale,Ct=this.texV0+(0,li.t7)(this.texV1,Ue*st,Kt)*this.texVScale}(0,Oi.a)(this._renderData.texV,vt,Ct)}_createRibbon(v){const O=new Float32Array(1155),D=new Uint32Array(1920);O[0]=0,O[1]=0,O[2]=-1;for(let fe=0;fe<128;fe++){const Pe=9*fe+3;O[Pe+0]=fe,O[Pe+1]=this.innerRimFactor,O[Pe+2]=-1,O[Pe+3]=fe,O[Pe+4]=this.middleRimFactor,O[Pe+5]=0,O[Pe+6]=fe,O[Pe+7]=this.outerRimFactor,O[Pe+8]=1;const Ue=3*fe+1,Xe=127===fe?1:Ue+3,st=15*fe;D[st+0]=Ue,D[st+1]=Ue+1,D[st+2]=Xe+1,D[st+3]=Xe+1,D[st+4]=Xe,D[st+5]=Ue,D[st+6]=Ue+1,D[st+7]=Ue+2,D[st+8]=Xe+2,D[st+9]=Xe+2,D[st+10]=Xe+1,D[st+11]=Ue+1,D[st+12]=Ue,D[st+13]=Xe,D[st+14]=0}const w=sM.createBuffer(D.length),te=w.position;for(let fe=0;fe<D.length;++fe){const Pe=3*D[fe];te.set(fe,0,O[Pe]),te.set(fe,1,O[Pe+1]),te.set(fe,2,O[Pe+2])}return new ku.U(v,bo.i,{geometry:(0,g0.K)(sM)},{geometry:Zl.f.createVertex(v,Jt.l1.STATIC_DRAW,w.buffer)})}_computeScreenRimWidth(v,O,D,w){return(0,_t.a)(wm,w.silCircleCenter,w.silCircleV2),(0,_t.g)(t1,wm,this.outerRimFactor),(0,js.n)(e1,O,wm,D),(0,Td.iV)(wm,e1,v.projectionMatrix,v.viewport),(0,Td.iV)(t1,e1,v.projectionMatrix,v.viewport),(0,_t.i)(wm,t1)/v.height}}function iM(_,v,O,D,w){const te=(0,_t.l)(_),fe=D*Math.sqrt(te*te-D*D)/te,Pe=Math.sqrt(D*D-fe*fe),Ue=w.silCircleV1,Xe=w.silCircleV2;return(0,_t.g)(w.silCircleCenter,_,Pe/te),(0,_t.f)(Ue,_,v),(0,_t.p)(Ue)<1&&(0,_t.f)(Ue,_,O),(0,_t.g)(Ue,Ue,fe/(0,_t.l)(Ue)),(0,_t.f)(Xe,Ue,_),(0,_t.g)(Xe,Xe,fe/(0,_t.l)(Xe)),fe}const e1=(0,Zn.c)(),wm=(0,$t.c)(),t1=(0,$t.c)(),sM=(0,bf.U$)().vec3f(Fo.T.POSITION);var hy=T(54346),RS=T(45695);class wS extends Zc.K{constructor(){super(...arguments),this.modelMatrix=(0,Zn.c)()}}class py extends vo.A{constructor(v){super(v,null,()=>this.destroy())}initializeProgram(v){const O=py.shader.get().build();return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.wK)(Jt.zi.SRC_ALPHA,Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Jt.wb.LEQUAL},colorWrite:ls.BK})}}py.shader=new vn.J(RS.S,()=>T.e(1317).then(T.bind(T,61317)));const IS=pn.Z.getLogger("esri.views.3d.environment.Stars");let y0=class extends Bi.Z{constructor(_){super(_),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new wS,this._updatingTracking=new Yd.t}get updating(){return this._updatingTracking.updating||this.loading}get loading(){return(0,lt.pC)(this._loadDataTask)&&!this._loadDataTask.finished}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=(0,lt.IM)(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=(0,lt.RY)(this._technique),this._vao=(0,lt.O3)(this._vao)}render(_){const{rctx:v}=_;if(this._ensureResources(v),(0,lt.Wi)(this._technique)||(0,lt.Wi)(this._vao))return;if(!this._technique.compiled)return void this.requestRender();const O=v.bindTechnique(this._technique,this._renderParameter,_.bindParameters);v.bindVAO(this._vao),O.assertCompatibleVertexAttributeLocations(this._vao),v.drawArrays(Jt.MX.POINTS,0,this._numPoints)}_ensureResources(_){if((0,lt.pC)(this._technique)||(0,lt.Wi)(p_))return;this._technique=new py({rctx:_,viewingMode:this.view.state.viewingMode}),this._numPoints=p_.byteLength/nM;const v=new Float32Array(p_,0,2*this._numPoints),O=new Uint8Array(p_,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(_,v,O,this._numPoints),this._updatingTracking.add(()=>"sun"===this.view.environment.lighting.type?this.view.environment.lighting.date:null,D=>this._update(D),pt.nn)}_computeDayDuration(_){const v=_,O=new Date(_.getFullYear(),0,1,11,58,56);return(+v-+O)/(+new Date(_.getFullYear()+1,0,1,11,58,55)-+O)}_update(_){if(!_)return;const v=(_.getHours()/12+_.getMinutes()/60*(2/24)+_.getSeconds()/60*(2/1440)-.9972222)%2,O=2*this._computeDayDuration(_),D=(0,js.c)(this._renderParameter.modelMatrix,BS);(0,js.g)(D,D,-O*Math.PI),(0,js.m)(D,US,D),(0,js.g)(D,D,-v*Math.PI),this.requestRender()}_hexToRGB(_){return[parseInt(_.substring(0,2),16),parseInt(_.substring(2,4),16),parseInt(_.substring(4,6),16)]}_unpackUint8Attributes(_){return _>=192?[2.9,_-192]:_>=160?[2.5,_-160]:_>=128?[2,_-128]:_>=96?[1.5,_-96]:_>=64?[1,_-64]:_>=32?[.7,_-32]:[.4,_]}_createVertexArrayObject(_,v,O,D){const w=oM.createBuffer(D),te=w.position,fe=w.color,Pe=w.size;for(let Ue=0;Ue<D;Ue++){const Xe=v[2*Ue+0],st=v[2*Ue+1];te.set(Ue,0,-Math.cos(Xe)*Math.sin(st)),te.set(Ue,1,-Math.sin(Xe)*Math.sin(st)),te.set(Ue,2,-Math.cos(st));const vt=this._unpackUint8Attributes(O[Ue]),Ct=this._hexToRGB(LS[vt[1]]);fe.set(Ue,0,255*Ct[0]),fe.set(Ue,1,255*Ct[1]),fe.set(Ue,2,255*Ct[2]),fe.set(Ue,3,255),Pe.set(Ue,vt[0])}return new ku.U(_,bo.i,{geometry:(0,g0.K)(oM)},{geometry:Zl.f.createVertex(_,Jt.l1.STATIC_DRAW,w.buffer)})}_createLoadDataTask(){var _=this;if((0,lt.pC)(p_))return null;const v=(0,zi.vr)(function(){var O=(0,Ai.Z)(function*(D){const{data:w}=yield(0,hy.b)("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:D});_._verifyStarData(w),p_=w});return function(D){return O.apply(this,arguments)}}());return v.promise.catch(O=>{(0,zi.D_)(O)||IS.error(O)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),v}_verifyStarData(_){if(!_)throw new Ls.Z("stars:no-data-received","Failed to create stars because star catalogue is missing");const v=_.byteLength/nM;if(v%1!=0||v>5e4||v<5e3)throw new Ls.Z("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],y0.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],y0.prototype,"requestRender",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],y0.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)()],y0.prototype,"_loadDataTask",void 0),(0,Ze._)([(0,nt.Cb)()],y0.prototype,"_updatingTracking",void 0),y0=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.Stars")],y0);const LS=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],US=(0,Zn.f)(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),BS=(0,Zn.f)(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),nM=9,oM=(0,bf.U$)().vec3f(Fo.T.POSITION).vec4u8(Fo.T.COLOR).f32(Fo.T.SIZE);let p_=null;var Im,gn=T(91263),fn=T(5894);const NS=[fn.r.POSTPROCESSING_ENVIRONMENT_OPAQUE,fn.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let aM,Pc=Im=class extends Bi.Z{constructor(_){super(_),this._handles=new cn.Z,this._context=null,this._pendingAtmosphere=null,this._atmosphere=null}initialize(){this.view._stage.addRenderPlugin(NS,this)}destroy(){var _;this._pendingAtmosphere=(0,lt.SC)(this._pendingAtmosphere),null!=(null==(_=this.view)?void 0:_._stage)&&this.view._stage.removeRenderPlugin(this),this._handles=(0,lt.SC)(this._handles),this._set("view",null)}get atmosphereType(){return(0,lt.pC)(this._pendingAtmosphere)?this._pendingAtmosphere.type:(0,lt.pC)(this._atmosphere)?this._atmosphere.type:"none"}get canRender(){var _;return!!(null==(_=this.view.basemapTerrain)?void 0:_.renderer.canRender)||"global"!==this.view.viewingMode}get needsLinearDepth(){return"realistic"===this._selectAtmosphereType()}updateAnimation(_){return!!(0,lt.pC)(this._precipitation)&&this._precipitation.update(_)}get updating(){return(0,lt.pC)(this._pendingAtmosphere)||(0,lt.pC)(this._stars)&&this._stars.updating||(0,lt.pC)(this._clouds)&&this._clouds.running}get weatherVisible(){return(0,_t.l)(this.view.state.camera.eye)-(0,Zi.Iu)(this.view.spatialReference).radius<=bu}get _stars(){var D,w;const _=this.view,v=null!=(w=null==(D=_.environment)?void 0:D.starsEnabled)&&w,O=this._get("_stars");return!v||(0,lt.Wi)(this._context)?((0,lt.SC)(O),null):(0,lt.pC)(O)?O:new y0({view:_,requestRender:()=>this._setNeedsRender()})}get _precipitation(){const _=this._get("_precipitation");if(!this._precipitationEnabled||(0,lt.Wi)(this._context))return(0,lt.SC)(_),null;const v=this.view,O=this._context;return(0,lt.pC)(_)&&_.context===O?_:((0,lt.SC)(_),new Cf({context:O,view:v}))}get _clouds(){const _=this._get("_clouds");if(!this.weatherEnabled||(0,lt.Wi)(this._context))return(0,lt.SC)(_),null;if((0,lt.pC)(_))return _;const v=this.view,O=this._context;return(0,lt.SC)(_),new Oc({context:O,view:v,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const _=this._get("_cloudsComposition");if(!this.weatherEnabled||(0,lt.Wi)(this._context))return(0,lt.SC)(_),null;const v=this.view.state.viewingMode,O=this._context.renderContext.rctx,D=(0,Zi.Iu)(this.view.spatialReference).radius;return(0,lt.pC)(_)&&_.viewingMode===v&&_.planetRadius===D?_:((0,lt.SC)(_),new vf({rctx:O,viewingMode:v,planetRadius:D,requestRender:()=>this._setNeedsRender()}))}get _fog(){const _=this._get("_fog");if(!this.weatherEnabled||(0,lt.Wi)(this._context))return(0,lt.SC)(_),null;if((0,lt.pC)(_))return _;const v=this.view,O=this._context;return(0,lt.SC)(_),new Rm({context:O,view:v})}get weatherEnabled(){var _,v;return!!(null==(v=null==(_=this.view)?void 0:_.environmentManager)?void 0:v.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}initializeRenderContext(_=null){this._context=_,this._handles.add([(0,pt.gx)(()=>{var v;return null==(v=this.view)?void 0:v.basemapTerrain},()=>this._updateBasemapTerrain(),pt.tX),(0,pt.YP)(()=>({viewingMode:this.view.viewingMode,atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),pt.tX),(0,pt.YP)(()=>this._stars,()=>this._setNeedsRender()),(0,pt.YP)(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),pt.nn),(0,pt.YP)(()=>this._precipitation,()=>this._setNeedsRender()),(0,pt.YP)(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),pt.nn),(0,pt.YP)(()=>this._weatherUpdateParameters,v=>{this._updateWeather(v),this._updateFog(v)},pt.tX)])}uninitializeRenderContext(){this._context=null,this._atmosphere=(0,lt.SC)(this._atmosphere),this._set("_stars",(0,lt.SC)(this._stars)),this._set("_precipitation",(0,lt.SC)(this._precipitation)),this._set("_clouds",(0,lt.SC)(this._clouds)),this._set("_cloudsComposition",(0,lt.SC)(this._cloudsComposition)),this._set("_fog",(0,lt.SC)(this._fog))}prepareRender(_){_.bindParameters.clouds.data=function sS(_){return(0,lt.pC)(_)&&(0,lt.pC)(_.cubeMap)&&_.coverage>0}(this._clouds)?this._clouds:null}render(_){if(_.pass===gn.C.MATERIAL)switch(_.bindParameters.slot){case fn.r.POSTPROCESSING_ENVIRONMENT_OPAQUE:(0,lt.pC)(this._stars)&&this._stars.render(_),(0,lt.pC)(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(_),(0,lt.pC)(this._cloudsComposition)&&(0,lt.pC)(_.bindParameters.clouds.data)&&(this.weatherVisible&&(0,lt.pC)(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(_,(0,lt.pC)(this.view.animation))));break;case fn.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if((0,lt.pC)(this._atmosphere)&&this._atmosphere.canRender){const v=this.weatherEnabled?this.view.environment.weather.type:"disabled";if(this._atmosphere.renderHaze(_,"rainy"===v),(0,lt.pC)(this._fog)){const O="foggy"===v||"rainy"===v||"snowy"===v;(O||"realistic"!==this._selectAtmosphereType())&&this._fog.render(_,O,"rainy"===v)}if((0,lt.pC)(this._precipitation)){const O=this.view.environment.weather;"rainy"!==O.type&&"snowy"!==O.type||this._precipitation.render(_,O.precipitation,O.type)}}}}get _weatherUpdateParameters(){const _=this.weatherEnabled?this.view.environment.weather:null;return(0,lt.Wi)(_)?null:"rainy"===_.type||"snowy"===_.type?{type:_.type,weatherAdjustment:_.cloudCover,effect:_.precipitation}:{type:_.type,weatherAdjustment:"foggy"===_.type?_.fogStrength:_.cloudCover}}_updateWeather(_){(0,lt.Wi)(_)||(0,lt.Wi)(this._clouds)||(this._clouds.applyPreset(YT[_.type],_.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){(0,lt.pC)(this._context)&&this._context.requestRender()}_updateFog(_){if(!(0,lt.Wi)(this._fog)&&!(0,lt.Wi)(_))switch(_.type){case"foggy":this._fog.strength=(0,li.t7)(3e-5,.005,_.weatherAdjustment**3),this._setNeedsRender();break;case"rainy":case"snowy":this._fog.strength=(0,li.t7)(4e-6,2e-4,_.effect**3),this._setNeedsRender();break;default:this._fog.strength=4e-6,this._setNeedsRender()}}_updateAtmosphere(){const _=this._selectAtmosphereType();if(this.atmosphereType===_)return;(0,lt.pC)(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null);const v=this._getAtmosphereClass();if(!v)return(0,lt.pC)(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),void this._updateBasemapTerrain();const O=new v(this.view);(0,lt.pC)(this._context)&&O.initializeRenderContext(this._context),(0,lt.Wi)(this._atmosphere)&&(this._atmosphere=O,this._setNeedsRender()),this._pendingAtmosphere=O,O.when().then(()=>{(0,lt.pC)(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere),this._pendingAtmosphere=null,this._setNeedsRender(),this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===O&&(this._pendingAtmosphere=null)})}_getAtmosphereClass(){switch(this._selectAtmosphereType()){case"none":return null;case"realistic":return f0;case"panoramic":return vS;case"simple":return AS;default:return}}_selectAtmosphereType(){const _=this.view.get("environment.atmosphereEnabled"),v=this.view.get("environment.atmosphere.quality"),O=this.view.viewingMode;return!_||null==v||(0,qs.V2)(this.view.spatialReference)?"none":"local"===O?"panoramic":"high"===v&&(0,lt.pC)(this._context)&&f0.isSupported(this._context)&&(0,qs.N$)(this.view.spatialReference)?"realistic":"simple"}_updateBasemapTerrain(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=(0,lt.pC)(this._atmosphere)&&"simple"===this.atmosphereType)}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:_=>{aM=Im.prototype._getAtmosphereClass,Im.prototype._getAtmosphereClass=_},restoreGetAtmosphereClass:()=>{Im.prototype._getAtmosphereClass=aM}}}};function lM(_,v,O){return function jS(_,v,O,D,w){const te=(0,li.Vl)(O),fe=(0,li.Vl)(w),Pe=te-fe,Ue=(0,li.Vl)(v)-(0,li.Vl)(D),Xe=Math.sin(Pe/2),st=Math.sin(Ue/2),vt=2*(0,li.Kt)(Math.sqrt(Xe*Xe+Math.cos(te)*Math.cos(fe)*st*st))*_;return Math.round(1e4*vt)/1e4}(_,v.longitude,v.latitude,O.longitude,O.latitude)}function r1(_,v){v||(v={hours:0,minutes:0,seconds:0}),v.hours=function cM(_,v){let O=_/15;return v||(O=Math.round(O)),O}(_[0],!0);const O=v.hours%1;v.hours-=O,v.minutes=60*O;const D=v.minutes%1;return v.minutes-=D,v.seconds=Math.round(60*D),v}(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Pc.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],Pc.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"weatherVisible",null),(0,Ze._)([(0,nt.Cb)()],Pc.prototype,"_context",void 0),(0,Ze._)([(0,nt.Cb)()],Pc.prototype,"_pendingAtmosphere",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"_stars",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"_precipitation",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"_clouds",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"_cloudsComposition",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"_fog",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"weatherEnabled",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"_precipitationEnabled",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pc.prototype,"_weatherUpdateParameters",null),Pc=Im=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.EnvironmentRenderer")],Pc);var uM,dM,hM,pM={exports:{}};uM=pM,dM=function(){var _=Math.PI,v=Math.sin,O=Math.cos,D=Math.tan,w=Math.asin,te=Math.atan2,fe=Math.acos,Pe=_/180,vt={dec:0,ra:0};function Wt($i){return new Date(864e5*($i+.5-2440588))}function Kt($i){return function Ct($i){return $i.valueOf()/864e5-.5+2440588}($i)-2451545}var Lt=23.4397*Pe;function nr($i,qi){return te(v($i)*O(Lt)-D(qi)*v(Lt),O($i))}function sr($i,qi){return w(v(qi)*O(Lt)+O(qi)*v(Lt)*v($i))}function Er($i,qi,as){return te(v($i),O($i)*v(qi)-D(as)*O(qi))}function yr($i,qi,as){return w(v(qi)*v(as)+O(qi)*O(as)*O($i))}function br($i,qi){return Pe*(280.16+360.9856235*$i)-qi}function Rr($i){return Pe*(357.5291+.98560028*$i)}function $r($i){return Pe*(1.9148*v($i)+.02*v(2*$i)+3e-4*v(3*$i))}function si($i,qi){return $i+qi+102.9372*Pe+_}function Ci($i,qi){var as=Rr($i),bs=si(as,$r(as));return qi||(qi={dec:0,ra:0}),qi.dec=sr(bs,0),qi.ra=nr(bs,0),qi}var Ti={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function($i,qi,as,bs){var en=Pe*-as,Cs=Pe*qi,xi=Kt($i),Qi=Ci(xi,vt),As=br(xi,en)-Qi.ra;return bs||(bs={azimuth:0,altitude:0}),bs.azimuth=Er(As,Cs,Qi.dec),bs.altitude=yr(As,Cs,Qi.dec),bs}},ki=[[-.83,"sunrise","sunset"]];function rs($i,qi,as){return 9e-4+($i+qi)/(2*_)+as}function Es($i,qi,as){return 2451545+$i+.0053*v(qi)-.0069*v(2*as)}function ws($i){var qi=Pe*(134.963+13.064993*$i),as=Pe*(93.272+13.22935*$i),bs=Pe*(218.316+13.176396*$i)+6.289*Pe*v(qi),en=5.128*Pe*v(as),Cs=385001-20905*O(qi);return{ra:nr(bs,en),dec:sr(bs,en),dist:Cs}}return Ti.addTime=function($i,qi,as){ki.push([$i,qi,as])},Ti.getTimes=function($i,qi,as){var bs=Pe*-as,en=Pe*qi,Cs=function Xi($i,qi){return Math.round($i-9e-4-qi/(2*_))}(Kt($i),bs),xi=rs(0,bs,Cs),Qi=Rr(xi),As=$r(Qi),Is=si(Qi,As),Qs=sr(Is,0),Ns=Es(xi,Qi,Is);var ao,ra,ua,kn,Co,so={solarNoon:Wt(Ns),nadir:Wt(Ns-.5),polarException:Ti.PolarException.NORMAL};for(ao=0,ra=ki.length;ao<ra;ao+=1)Co=Ns-((kn=Es(rs(function Gs($i,qi,as){return fe((v($i)-v(qi)*v(as))/(O(qi)*O(as)))}((ua=ki[ao])[0]*Pe,en,Qs),bs,Cs),Qi,Is))-Ns),so[ua[1]]=Wt(Co),so[ua[2]]=Wt(kn);return so.polarException=function dn(Po){var Oa=(v(Po)-v(en)*v(Qs))/(O(en)*O(Qs));return Oa<-1?Ti.PolarException.MIDNIGHT_SUN:Oa>1?Ti.PolarException.POLAR_NIGHT:Ti.PolarException.NORMAL}(ki[0][0]*Pe),so},Ti.getMoonPosition=function($i,qi,as){var bs=Pe*-as,en=Pe*qi,Cs=Kt($i),xi=ws(Cs),Qi=br(Cs,bs)-xi.ra,As=yr(Qi,en,xi.dec);return As+=.017*Pe/D(As+10.26*Pe/(As+5.1*Pe)),{azimuth:Er(Qi,en,xi.dec),altitude:As,distance:xi.dist}},Ti.getMoonFraction=function($i){var qi=Kt($i),as=Ci(qi),bs=ws(qi),en=149598e3,Cs=fe(v(as.dec)*v(bs.dec)+O(as.dec)*O(bs.dec)*O(as.ra-bs.ra)),xi=te(en*v(Cs),bs.dist-en*O(Cs));return(1+O(xi))/2},Ti},void 0!==(hM=dM())&&(uM.exports=hM);const v0=pM.exports,Bh={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function VS(_,v,O,D,w,te,fe){(0,_t.s)(fe.ambient.color,1,1,1),fe.ambient.intensity=Bh.global.ambient,(0,_t.s)(fe.direct.color,1,1,1),fe.direct.intensity=Bh.global.direct;const Ue=(0,li.uZ)((Math.abs(v[2])-Bh.local.altitude)/(Bh.global.altitude-Bh.local.altitude),0,1);let Xe;if(fe.globalFactor=Ue,"sun"===te&&(Xe=v0.getTimes(_,v[1],v[0])),Ue<1){let st;if("sun"===te)st=function kS(_,v,O){const D=_.valueOf();let w,te;v.polarException===v0.PolarException.MIDNIGHT_SUN?(w=D-60*(_.getHours()+48)*60*1e3-60*_.getMinutes()*1e3,te=w+432e6):v.polarException===v0.PolarException.POLAR_NIGHT?(w=D-2,te=D-1):(w=v.sunrise.valueOf(),te=v.sunset.valueOf());const fe=te-w,Pe=w+fe/2,Ue=fe/4,Xe=Pe-Ue,st=Pe+Ue,vt=.06*fe,Ct=w-vt/2,Wt=w+vt/2,Kt=te-vt/2,Lt=te+vt/2,nr=Bh.local,sr=[.01,nr.ambientAtNight],Er=[.8,.8,1],yr=[.01,.01,.01],br=[nr.directAtTwilight,nr.ambientAtTwilight],Rr=[1,.6,.5],$r=[.8,.8,1],si=[.9*nr.directAtNoon,nr.ambientAtNoon],Ci=[1,.98,.98],Ti=[.98,.98,1],ki=[nr.directAtNoon,nr.ambientAtNoon],Fi=[1,1,1],Xi=[1,1,1],rs=si,Es=Ci,Gs=Ti,ws=br,$i=Rr,qi=$r;let as,bs,en=[0,0],Cs=[0,0,0],xi=[0,0,0];D<Ct||D>Lt?(en=sr,Cs=yr,xi=Er,bs="night"):D<Wt?(as=Wt-Ct,en=$l(D-Ct,as,sr,br),Cs=$l(D-Ct,as,yr,Rr),xi=$l(D-Ct,as,Er,$r),bs="sun rising"):D<Xe?(as=Xe-Wt,en=$l(D-Wt,as,br,si),Cs=$l(D-Wt,as,Rr,Ci),xi=$l(D-Wt,as,$r,Ti),bs="early morning"):D<Pe?(as=Pe-Xe,en=$l(D-Xe,as,si,ki),Cs=$l(D-Xe,as,Ci,Fi),xi=$l(D-Xe,as,Ti,Xi),bs="late morning"):D<st?(as=st-Pe,en=$l(D-Pe,as,ki,rs),Cs=$l(D-Pe,as,Fi,Es),xi=$l(D-Pe,as,Xi,Gs),bs="early afternoon"):D<Kt?(as=Kt-st,en=$l(D-st,as,rs,ws),Cs=$l(D-st,as,Es,$i),xi=$l(D-st,as,Gs,qi),bs="late afternoon"):D<Lt&&(as=Lt-Kt,en=$l(D-Kt,as,ws,sr),Cs=$l(D-Kt,as,$i,yr),xi=$l(D-Kt,as,qi,Er),bs="sun setting");let Qi=0;switch(O){case"rainy":case"foggy":Qi=.9;case"snowy":Qi=.5}Qi>0&&(Cs=gM(Cs,Qi),xi=gM(xi,Qi));const As=(0,$t.f)(Cs[0],Cs[1],Cs[2]),Is=(0,$t.f)(xi[0],xi[1],xi[2]),Qs=mM(O);return{direct:{intensity:en[0]*Qs.direct,color:As},ambient:{intensity:en[1]*Qs.ambient,color:Is},timeOfDay:bs}}(_,Xe,D);else{const vt=mM(D);st={direct:{intensity:Bh.local.directAtNoon*vt.direct,color:(0,$t.f)(1,1,1)},ambient:{intensity:Bh.local.ambientAtNoon*vt.ambient,color:(0,$t.f)(1,1,1)},timeOfDay:"early afternoon"}}(0,_t.h)(fe.ambient.color,st.ambient.color,fe.ambient.color,Ue),fe.ambient.intensity=(0,li.t7)(st.ambient.intensity,fe.ambient.intensity,Ue),(0,_t.h)(fe.direct.color,st.direct.color,fe.direct.color,Ue),fe.direct.intensity=(0,li.t7)(st.direct.intensity,fe.direct.intensity,Ue),fe.specularStrength="rainy"===D||"snowy"===D||"foggy"===D?0:1,fe.environmentStrength="rainy"===D?.7:"snowy"===D||"foggy"===D?.75:1}fe.noonFactor="sun"===te?function $S(_,v){const O=_.valueOf();let D,w;return v.polarException===v0.PolarException.MIDNIGHT_SUN?(D=O-60*(_.getHours()+48)*60*1e3-60*_.getMinutes()*1e3,w=D+432e6):v.polarException===v0.PolarException.POLAR_NIGHT?(D=O-2,w=O-1):(D=v.sunrise.valueOf(),w=v.sunset.valueOf()),1-(0,li.uZ)(Math.abs(O-(D+(w-D)/2))/432e5,0,1)}(_,Xe):1,"sun"===te?function fM(_,v,O,D){const w=ZS,te=(0,js.i)(KS);if(O===Us.JY.Global)v0.getPosition(_,0,0,w),(0,_t.s)(D,0,0,-1),(0,js.r)(te,te,-w.azimuth),(0,js.o)(te,te,-w.altitude),(0,_t.m)(D,D,te);else{const fe=Bh.planarDirection,Pe=fe.globalAngles;let Xe=(Math.abs(v[2])-fe.localAltitude)/(fe.globalAltitude-fe.localAltitude);Xe=(0,li.uZ)(Xe,0,1),Xe<1?(v0.getPosition(_,v[1],v[0],w),w.azimuth=(1-Xe)*w.azimuth+Xe*Pe.azimuth,w.altitude=(1-Xe)*w.altitude+Xe*Pe.altitude):(w.azimuth=Pe.azimuth,w.altitude=Pe.altitude),(0,_t.s)(D,0,-1,0),(0,js.g)(te,te,-w.azimuth),(0,js.r)(te,te,-w.altitude),(0,_t.m)(D,D,te)}}(_,v,O,fe.direct.directionToLightSource):function zS(_,v,O){v===Us.JY.Global?(0,_t.n)(i1,_.eye):(0,_t.s)(i1,0,0,1),(0,_t.g)(s1,_.viewForward,-1);const D=(0,oa.EU)(s1,i1),w=Math.max(D-2*n1,0),fe=Math.max(n1,D-n1-.85*w/(w+1));(0,js.d)(vM,-fe,_.viewRight),(0,_t.m)(O,s1,vM),(0,_t.a)(O,O,(0,_t.g)(YS,_.viewRight,JS)),(0,_t.n)(O,O)}(w,O,fe.direct.directionToLightSource)}const HS=(0,$t.f)(.5773502691896258,-.5773502691896258,.5773502691896258);class _M{constructor(){this.ambient={color:(0,$t.f)(1,1,1),intensity:.55},this.direct={color:(0,$t.f)(1,1,1),intensity:.55,directionToLightSource:(0,$t.a)(HS)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const KS=(0,Zn.c)(),ZS={azimuth:0,altitude:0};function mM(_){switch(_){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function gM(_,v){const O=(_[0]+_[1]+_[2])/3;for(let D=0;D<3;D++)_[D]=_[D]+(O-_[D])*v;return _}function $l(_,v,O,D){const w=[];for(let te=0;te<O.length;te++)w[te]=(D[te]-O[te])*_/v+O[te];return w}new Date(0);const vM=(0,Zn.c)(),i1=(0,$t.c)(),s1=(0,$t.c)(),YS=(0,$t.c)(),n1=.25,JS=.2;var o1=T(82244);let rh=class extends sa.Z.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new cn.Z,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new o1.Eg,this._ambientLight=new o1.Mi,this._moonLight=new o1.AM,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var _;return null==(_=this._renderer)?void 0:_.view}get updating(){var _;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!(null==(_=this._renderer)?void 0:_.updating))}get weatherEnabled(){var _,v,O;return(null==(_=this._view)?void 0:_.environment.atmosphereEnabled)&&!this._disableWeather&&(null==(O=null==(v=this._view)?void 0:v.state)?void 0:O.viewingMode)===Us.JY.Global&&(0,qs.N$)(this._view.spatialReference)}get weatherVisible(){var _;return this.weatherEnabled&&(null==(_=this._renderer)?void 0:_.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(_){if(this._renderer)return;this._renderer=new Pc({view:_});const v=()=>this._updateRenderParameters(),O=()=>this._cameraHandler(),D=()=>this._updateLighting();this._viewHandles.add([(0,pt.YP)(()=>_.environment.lighting,w=>this._updateLightingHandler(w),pt.Z_),(0,pt.YP)(()=>"sun"===_.environment.lighting.type?_.environment.lighting.date:null,w=>this._lightingDateHandler(w),pt.Z_),(0,pt.YP)(()=>_.stationary,()=>this._interactingStationaryHandler()),(0,pt.YP)(()=>_.environment.lighting.directShadowsEnabled,v,pt.Z_),(0,pt.YP)(()=>_.environment.lighting.ambientOcclusionEnabled,v,pt.Z_),(0,pt.YP)(()=>_.environment.lighting.waterReflectionEnabled,v,pt.Z_),(0,pt.YP)(()=>{var w;return null==(w=_.environment.background)?void 0:w.color},v,pt.Z_),(0,pt.YP)(()=>_.spatialReference,()=>this._resetReferencePosition(!0),pt.Z_),(0,pt.YP)(()=>_.environment.weather.type,D,pt.Z_),(0,pt.YP)(()=>this.weatherEnabled,D,pt.Z_),(0,pt.YP)(()=>_.viewingMode,()=>this._resetReferencePosition(!0),pt.tX),(0,pt.YP)(()=>"sun"===_.environment.lighting.type&&_.environment.lighting.cameraTrackingEnabled,w=>this._updateCameraTracking(w),pt.tX),(0,pt.YP)(()=>_.state.camera,O,pt.tX),(0,pt.YP)(()=>this.disableQueries,O)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=(0,lt.SC)(this._renderer)}_updateLightingHandler(_){this._updateCameraTracking("sun"===_.type&&_.cameraTrackingEnabled),this._lightingDateHandler("sun"===_.type?_.date:null),this._updateRenderParameters()}_updateCameraTracking(_){if(this._trackingEnabled=_,_)this._cameraHandler();else{const v=this._view.environment.lighting;"sun"===(null==v?void 0:v.type)&&(v.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(_){const v=this._view.environment.lighting;if("virtual"!==(null==v?void 0:v.type)){if(_){if(!v.positionTimezoneInfo.autoUpdated){if(this._preserveAbsoluteDateTime=!0,!(0,ci.jF)(this._view.spatialReference)){const D=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(D))return void this._requestReferencePositionUpdate(D)}if(this._preupdateTracking(_),(0,lt.pC)(this._referencePosWGS84Comparable)){const D=r1(this._referencePosWGS84Comparable,EM);(0,lt.pC)(D)&&(v.autoUpdate(null,D),this._trackingEnabled&&(v.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(_)}}else this._updateLighting()}_preupdateTracking(_){!this._trackingEnabled&&"sun"===this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(_)}_cameraHandler(_=null){const v=this._view;if(!v.ready)return;const O=v.stateManager.camera;O&&(this._cameraHandlerClientSide(O,_)||this._cameraHandlerServerSide(O))}_cameraHandlerClientSide(_,v){const O=(0,qs.N$)(this._view.spatialReference);if(O&&!(0,ci.jF)(this._view.spatialReference))return!1;const D=_.position;return(0,lt.Wi)(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=(0,$t.c)()),O?(0,ci.UY)(D,this._referencePosWGS84Comparable):(0,_t.s)(this._referencePosWGS84Comparable,D.longitude,D.latitude,D.z),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,v)||this._updateLighting(v),!0}_cameraHandlerServerSide(_){const v=_.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(v))&&this._requestReferencePositionUpdate(v,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=v.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(_){const v=this._view,O=_||("sun"===v.environment.lighting.type?v.environment.lighting.date:null),D=this._referencePosWGS84Comparable,w=(0,lt.pC)(D)?XS:QS;(0,lt.pC)(D)&&VS(O,D,v.state.viewingMode,this.weatherVisible?v.environment.weather.type:"disabled",v.state.camera,v.environment.lighting.type,w);const te=this._mainLight,fe=w.direct;(0,_t.g)(te.intensity,fe.color,fe.intensity*Math.PI),(0,_t.c)(te.direction,fe.directionToLightSource),te.specularStrength=w.specularStrength,te.environmentStrength=w.environmentStrength;const Pe=this._ambientLight;(0,_t.g)(Pe.intensity,w.ambient.color,w.ambient.intensity);const Ue=this._moonLight;(0,_t.h)(Ue.intensity,eR,tR,w.globalFactor),(0,_t.g)(Ue.intensity,Ue.intensity,(1-.5*w.globalFactor)*(1-.4*w.noonFactor*(1-w.globalFactor))),(0,_t.c)(Ue.direction,fe.directionToLightSource),v._stage.renderView.updateLightSources([te,Pe,Ue],1-w.noonFactor,w.globalFactor),this._updateRenderParameters()}_autoUpdateTimezone(_,v=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||(0,lt.Wi)(_))return!1;const O=qS;O.setTime((v||this._view.environment.lighting.date).getTime());const D=r1(_,EM);if((0,lt.Wi)(D))return!1;let w=this._view.environment.lighting.positionTimezoneInfo;if(w.autoUpdated){if(w.hours===D.hours&&w.minutes===D.minutes&&w.seconds===D.seconds)return!1}else w=D;const te=O.getUTCHours()-(D.hours-w.hours),fe=O.getUTCMinutes()-(D.minutes-w.minutes),Pe=O.getUTCSeconds()-(D.seconds-w.seconds);return O.setUTCHours(te),O.setUTCMinutes(fe),O.setUTCSeconds(Pe),!v&&this._view.environment.lighting.autoUpdate(O,D)}_updateRenderParameters(){const _=this._view._stage;if(!_)return;const v=(0,lt.R2)(this._referencePosWGS84Comparable,!0,w=>function GS(_,v){if(v===Us.JY.Global)return!0;const O=Bh.planarDirection;return Math.abs(_)<O.localAltitude}(w[2],this._view.state.viewingMode)),O=this._view.environment.background,D=O instanceof He?{type:"color",color:(0,vi.b)(ol.Z.toUnitRGBA(O.color))}:{type:"color",color:(0,vi.f)(0,0,0,1)};_.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&v,background:D,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}_resetReferencePosition(_=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),_&&this._cameraHandler()}_requestReferencePositionUpdate(_,v=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(_):this._referencePosMapCoordsRequested=_.clone(),this._referencePosResetPreserveAbsoluteTime=!!v,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const O=this._referencePosUpdateQuery=(0,zi.e4)(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===O)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==O)}).catch(w=>{"mapcoordshelper:missing-geometry-service"===w.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===O&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),D=this._referencePosUpdateTimer=(0,zi.e4)(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===D&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}_doReferencePositionUpdateQuery(_){var v=this;return(0,Ai.Z)(function*(){v._referencePosResetPreserveAbsoluteTime&&(v._preserveAbsoluteDateTime=!1),v._referencePosMapCoords?v._referencePosMapCoords.copy(v._referencePosMapCoordsRequested):v._referencePosMapCoords=v._referencePosMapCoordsRequested.clone(),v._referencePosResetPreserveAbsoluteTime=null,v._referencePosMapCoordsRequested=null;const O=yield v._view.mapCoordsHelper.toGeographic(v._referencePosMapCoords);if(!_()&&!isNaN(O[0])&&!isNaN(O[1])){const D=v._referencePosMapCoords.z*v._view.mapCoordsHelper.unitInMeters;v._referencePosWGS84Comparable?(v._referencePosWGS84Comparable[0]=O[0],v._referencePosWGS84Comparable[1]=O[1],v._referencePosWGS84Comparable[2]=D):v._referencePosWGS84Comparable=[O[0],O[1],D],v._referencePosChanged()}})()}_executePendingReferencePositionUpdate(){const _=this._referencePosMapCoordsRequested;_&&this._requestReferencePositionUpdate(_,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(_){if(this._referencePosMapCoords){let v=this._referencePosMapCoords.distance(_);return this._view.mapCoordsHelper&&(v*=this._view.mapCoordsHelper.unitInMeters),v>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const _=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,_}get test(){const _=this;return{get renderer(){return _._renderer},set referencePointUpdateInterval(v){_._referencePointUpdateInterval=v},set referencePointUpdateDistThreshold(v){_._referencePointUpdateDistThreshold=v},set referencePosUpdateTimer(v){_._referencePosUpdateTimer=v},set referencePointUpdateDelay(v){_._referencePointUpdateDelay=v},set disableWeather(v){_._disableWeather=v}}}};(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],rh.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)()],rh.prototype,"disableQueries",void 0),(0,Ze._)([(0,nt.Cb)()],rh.prototype,"_disableWeather",void 0),(0,Ze._)([(0,nt.Cb)()],rh.prototype,"weatherEnabled",null),(0,Ze._)([(0,nt.Cb)()],rh.prototype,"weatherVisible",null),(0,Ze._)([(0,nt.Cb)()],rh.prototype,"referencePositionWGS84Comparable",null),(0,Ze._)([(0,nt.Cb)()],rh.prototype,"_renderer",void 0),(0,Ze._)([(0,nt.Cb)()],rh.prototype,"_referencePosWGS84Comparable",void 0),rh=(0,Ze._)([(0,ui.j)("esri.views.3d.environment.SceneViewEnvironmentManager")],rh);const XS=new _M,QS=new _M,qS=new Date,EM={hours:0,minutes:0,seconds:0},eR=(0,$t.f)(.22,.22,.33),tR=(0,$t.f)(.22,.22,.22);var bn,wo,ml,aa=T(97126),Yu=T(70562);function Lm(_,v){return 0!=(_&v)}function fy(_,v,O,D,w,te){0!==_&&(O?(te.min=Math.min(te.min,v),te.max=Math.max(te.max,v)):null!=D?(te.min-=Math.max(0,(v-te.min)*(1-D)),te.max+=Math.max(0,(v-te.max)*(1-D))):w&&(te.min-=Math.max(0,v-te.min-w),te.max+=Math.max(0,v-te.max-w)))}(function(_){_[_.NONE=0]="NONE",_[_.ZOOM=1]="ZOOM",_[_.TUMBLE=2]="TUMBLE",_[_.LOOK_AROUND=3]="LOOK_AROUND",_[_.PAN=4]="PAN",_[_.ASCEND=5]="ASCEND"})(bn||(bn={})),function(_){_[_.NONE=0]="NONE",_[_.TILT=1]="TILT",_[_.ALTITUDE=2]="ALTITUDE",_[_.DISTANCE=4]="DISTANCE",_[_.COLLISION=8]="COLLISION",_[_.ALL=15]="ALL",_[_.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"}(wo||(wo={})),function(_){_[_.TUMBLE=0]="TUMBLE",_[_.LOOK_AROUND=1]="LOOK_AROUND"}(ml||(ml={}));const E0={selection:wo.NONE,interactionType:bn.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ml.TUMBLE};function bM(_,v,O,D){return(0,_t.c)(D,v=v||_.viewForward),(0,_t.g)(D,D,Math.sign((0,_t.e)(v,O))),D}var rR=T(24229);function a1(_,v,O=E0){if(!function sR(_,v){return!(!_.state.isGlobal||!_.state.constraints.altitude||v.interactionType===bn.TUMBLE&&Lm(v.selection,wo.TILT))}(_,O))return 0;const D=function aR(_,v){return v.min=_.min,v.max=_.max,v}(_.state.constraints.altitude,lR);!function nR(_,v,O){const D=v.interactionType;if(D===bn.NONE)return;const{min:w,max:te}=O,{interactionStartCamera:fe,interactionFactor:Pe}=v,Ue=D===bn.TUMBLE||D===bn.ZOOM,Xe=a1(_,fe),st=0===Xe?0:_.renderCoordsHelper.getAltitude(fe.eye);O.min=w,O.max=te,fy(Xe,st,Ue,Pe,.05*st,O)}(_,O,D);const w=_.renderCoordsHelper.getAltitude(v.eye),te=(0,li.uZ)(w,D.min,D.max)-w;return Math.abs(te)<=1e-6?0:te}const lR={min:0,max:0},cR=(0,$t.c)(),uR=(0,$t.c)(),dR=(0,$t.c)(),l1=(0,$t.c)();function c1(_,v,O=E0){if(!_.state.isLocal)return 0;const D=_.state.constraints.distance;if(!_.pointsOfInterest.surfaceOrigin.renderLocation||D===1/0)return 0;_y.min=0,_y.max=D,function pR(_,v,O){const D=v.interactionType;if(D===bn.NONE)return;const{min:w,max:te}=O,{interactionStartCamera:fe,interactionFactor:Pe}=v,Ue=D===bn.ZOOM||D===bn.PAN,Xe=c1(_,fe),st=0===Xe?0:u1(_,fe);O.min=w,O.max=te,fy(Xe,st,Ue,Pe,.05*st,O)}(_,O,_y);const w=u1(_,v),te=_y.max-w;return te>=-1e-6?0:te}function u1(_,v){return(0,_t.i)(v.eye,_.pointsOfInterest.surfaceOrigin.renderLocation)}const _y={min:0,max:0},_R=(0,$t.c)(),mR=(0,$t.c)(),gR=(0,$t.c)(),yR=(0,$t.c)(),my=(0,$t.c)();var fc=T(62483);function CM(_,v,O,D){return(0,lt.pC)(_.renderCoordsHelper.fromRenderCoords(v.eye,yy,D))&&(0,qr.BD)(O,yy)}function gy(_,v){return _.elevationProvider?(0,lt.Pt)(_.elevationProvider.getElevation(v[0],v[1],v[2],_.renderCoordsHelper.spatialReference,"ground"),0):0}function Tf(_,v,O,D){const w=_.state.camera.clone();v&&(w.eye=v,w.center=O,w.up=D),function vR(_,v,O){let D=MM[_.viewingMode];D||(D=(0,fc.Z8)(_.state.viewingMode),D.options.backfacesTerrain=!_.state.isGlobal,D.options.invisibleTerrain=!0,MM[_.viewingMode]=D);const{isGlobal:w}=_.state;return!(!_.sceneIntersectionHelper.intersectRay(v,D,O)||TM(_,v.origin,O))||!(!_.renderCoordsHelper.intersectManifold(v,0,O)||TM(_,v.origin,O))||!!w&&function ER(_,v,O){const D=(0,_t.e)(_.origin,_.origin)-O*O,w=D>0?Math.sqrt(D)/3:1;return(0,_t.g)(v,_.direction,w/(0,_t.l)(_.direction)),(0,_t.a)(v,v,_.origin),!0}(v,O,(0,Zi.Iu)(_.spatialReference).radius)}(_,w.ray,b0)||(0,_t.c)(b0,w.center);const te=_.state.constraints,fe=te.minimumPoiDistance;if((0,_t.d)(w.eye,b0)<fe){const Pe=te.collision.enabled;(0,_t.c)(Mf,w.viewForward),(0,_t.g)(Mf,Mf,fe),Pe?w.eye=(0,_t.b)(yy,b0,Mf):(0,_t.a)(b0,w.eye,Mf);const Ue=_.renderCoordsHelper,Xe=Ue.getAltitude(w.eye),st=te.collision.elevationMargin;Pe&&Xe<st&&((0,_t.b)(Mf,b0,w.eye),w.eye=Ue.setAltitude(yy,st,w.eye),(0,_t.a)(b0,w.eye,Mf))}return w.center=b0,w}function TM(_,v,O){if(!_.state.isGlobal)return!1;const D=gy(_,v),w=_.stateManager.constraintsManager.nearFarHeuristic,{far:te}=w.compute(v,O,_.renderDataExtent,D,bR),fe=te*te;return(0,_t.d)(v,O)>fe}const MM={},yy=(0,$t.c)(),b0=(0,$t.c)(),Mf=(0,$t.c)(),bR={near:0,far:0};function f_(_,v,O=Md.EYE){const D=_.state.constraints;if(!D.collision.enabled)return!1;const w=gy(_,v.eye),te=_.renderCoordsHelper.getAltitude(v.eye),fe=w+D.collision.elevationMargin;if(te>=fe)return!1;const Pe=(0,_t.l)(v.eye);return(0,_t.b)(vy,v.center,v.eye),v.eye=_.renderCoordsHelper.setAltitude(CR,fe,v.eye),O===Md.EYE_AND_CENTER?v.center=(0,_t.a)(vy,v.eye,vy):O===Md.EYE_AND_CENTER_SCALE&&(v.center=(0,_t.g)(vy,v.center,(Pe-te+fe)/Pe)),!0}var Md;!function(_){_[_.EYE=0]="EYE",_[_.EYE_AND_CENTER=1]="EYE_AND_CENTER",_[_.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"}(Md||(Md={}));const vy=(0,$t.c)(),CR=(0,$t.c)();function C0(_,v,O){_.worldUpAtPosition(v,OM),(0,_t.b)(d1,O,v);const D=(0,_t.l)(d1);return 0===D?0:(0,li.ZF)((0,_t.e)(d1,OM)/D)}const OM=(0,$t.c)(),d1=(0,$t.c)();function h1(_,v,O=E0,D=E0,w){if(!_.state.constraints.tilt)return 0;const fe=_.state.constraints.tilt(v.distance,wR);return function RR(_,v,O){if(v.interactionType===bn.NONE)return;const{interactionStartCamera:D,interactionFactor:w}=v,{min:te,max:fe}=O,Pe=h1(_,D,E0,v),Ue=0===Pe?0:C0(_.renderCoordsHelper,D.center,D.eye);O.min=te,O.max=fe,v.interactionType===bn.TUMBLE?(Lm(v.selection,wo.ALTITUDE)&&xM(_,D,O),fy(Pe,Ue,!0,w,DM,O)):fy(Pe,Ue,!1,w,DM,O)}(_,O,fe),D.interactionType===bn.TUMBLE&&Lm(D.selection,wo.ALTITUDE)&&xM(_,D.interactionStartCamera,fe),O.tiltMode===ml.LOOK_AROUND||D.tiltMode===ml.LOOK_AROUND?function MR(_,v,O,D){switch(D&&(D.requiresTwoSteps=!1),_.viewingMode){case"global":return function PR(_,v,O,D){const w=function xR(_,v,O){const D=_.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,w=D+(0,Zi.Iu)(_.spatialReference).radius,te=_.renderCoordsHelper.intersectManifold(v.ray,D,M0);return O.eyeCenterDistance=v.distance,O.centerIsOnSurface=!1,(0,lt.pC)(te)?(O.eyeCenterDistance=(0,_t.i)(v.eye,te),O.tiltAtCenter=C0(_.renderCoordsHelper,te,v.eye),O.centerIsOnSurface=!0):_.state.isLocal?O.tiltAtCenter=C0(_.renderCoordsHelper,v.center,v.eye):((0,aa.j)((0,aa.k)(aa.t,w),v.ray,M0),O.eyeCenterDistance=(0,_t.i)(v.eye,M0),O.tiltAtCenter=(0,li.ZF)(-(0,_t.e)(v.viewForward,(0,_t.n)(M0,M0)))),O.radius=w,O.eyeRadius=(0,_t.l)(v.eye),O.constraints=_.state.constraints,O}(_,v,IR),te=(0,li.uZ)(w.tiltAtCenter,O.min,O.max);if(!Um(w.tiltAtCenter-te))return 0;let fe,Pe;return w.centerIsOnSurface?(fe=function DR(_){const{constraints:v,eyeCenterDistance:O,tiltAtCenter:D}=_;let w=D,te=v.clampTilt(O,D);const fe=p1(_,te);if(v.clampTilt(fe,D)===te)return te;let Pe=0;for(;Pe<10&&Um(te-w);){const Ue=(w+te)/2,Xe=p1(_,Ue);Um(v.clampTilt(Xe,Ue)-Ue)?w=Ue:te=Ue,Pe++}return te}(w),Pe=function AR(_,v){const O=(0,li.Kt)(_.radius/_.eyeRadius*Math.sin(_.tiltAtCenter)),D=(0,li.Kt)(_.radius/_.eyeRadius*Math.sin(v));return _.eyeRadius>_.radius?O-D:D-O}(w,fe)):(fe=w.constraints.clampTilt(w.eyeCenterDistance,w.tiltAtCenter),D&&fe<Math.PI/2&&(D.requiresTwoSteps=!0,fe=Math.PI/2-1e-5),Pe=function SR(_,v){return _.tiltAtCenter-Math.PI/2-(v-Math.PI/2)}(w,fe)),D&&(D.eyeCenterDistance=p1(w,fe)),Pe}(_,v,O,D);case"local":return function OR(_,v,O,D){const w=C0(_.renderCoordsHelper,v.center,v.eye),te=(0,li.uZ)(w,O.min,O.max),fe=w-te;if(!Um(fe))return 0;if(D){const Pe=_.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,Ue=_.renderCoordsHelper.getAltitude(v.eye)-Pe,Xe=Math.cos(te);D.eyeCenterDistance=Math.abs(Xe)>1e-4?Ue/Xe:v.distance}return fe}(_,v,O,D);default:return void(0,Fl.Bg)(_.viewingMode)}}(_,v,fe,w):function TR(_,v,O){const D=C0(_.renderCoordsHelper,v.center,v.eye),w=D-(0,li.uZ)(D,O.min,O.max);return Um(w)?w:0}(_,v,fe)}function Um(_){return Math.abs(_)>1e-9}function p1(_,v){if(!_.centerIsOnSurface)return _.eyeCenterDistance;const O=Math.PI-(0,li.uZ)(v,0,Math.PI),D=(0,li.Kt)(_.radius/_.eyeRadius*Math.sin(O)),w=Math.PI-O-D,te=Math.sin(w)/Math.sin(O);if(_.eyeRadius<_.radius&&te>1){const fe=Math.PI-D,Pe=Math.PI-O-fe;return Math.sin(Pe)/Math.sin(O)*_.eyeRadius}return te*_.eyeRadius}function xM(_,v,O){if(_.state.isLocal)return;const D=_.state.constraints;if(!D.altitude)return;const w=(0,_t.p)(v.center),te=Math.sqrt(w),fe=v.distance,Pe=(0,Zi.Iu)(_.spatialReference).radius,Ue=D.altitude.min+Pe,Xe=D.altitude.max+Pe,st=(Ue*Ue-fe*fe-w)/(-2*te*fe);O.min=Math.max(O.min,Math.min(Math.PI-(0,li.ZF)((Xe*Xe-fe*fe-w)/(-2*te*fe)),O.max)),O.max=Math.min(O.max,Math.PI-(0,li.ZF)(st))}const T0=(0,$t.c)(),Ey=(0,Zn.c)(),M0=(0,$t.c)(),DM=(0,li.Vl)(5),wR={min:0,max:0},IR={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},Bm={eyeCenterDistance:0,requiresTwoSteps:!1},by=_=>_*_,f1=_=>1-by(1-_),_1=_=>_*_*_,AM=_=>1-_1(1-_),SM=_=>_<.5?_1(2*_)/2:(AM(2*(_-.5))+1)/2,m1=_=>_*_*_*_,RM=_=>1-m1(1-_),g1=_=>_*_*_*_*_,wM=_=>1-g1(1-_),y1=_=>1-Math.cos(_*Math.PI/2),IM=_=>1-y1(1-_),v1=_=>2**(10*(_-1)),Nm=_=>1-v1(1-_),E1=_=>-(Math.sqrt(1-_*_)-1),LM=_=>1-E1(1-_);function Od(_){const v=2*(_-Math.sqrt((_-1)*_)),O=v/2/_;return D=>D<O?_*D*D:v*D-v+1}function Pd(_,v){return(O,D)=>O<v?v*_(O/v,D):1-_((1-O)/(1-v),D)*(1-v)}const VR=Pd(Od(1),1),zR=Pd(Od(1),0),UM=Pd(Od(1),.5),GR=Pd(Od(2),1),HR=Pd(Od(2),0),KR=Pd(Od(2),.5),ZR=Pd(Od(3),1),$R=Pd(Od(3),0),kR=Pd(Od(3),.5),YR=Pd(Od(4),1),JR=Pd(Od(4),0),XR=Pd(Od(4),.5),QR={linear:function LR(_){return _},"in-quad":by,"out-quad":f1,"in-out-quad":_=>_<.5?by(2*_)/2:(f1(2*(_-.5))+1)/2,"in-coast-quad":VR,"out-coast-quad":zR,"in-out-coast-quad":UM,"in-cubic":_1,"out-cubic":AM,"in-out-cubic":SM,"in-coast-cubic":GR,"out-coast-cubic":HR,"in-out-coast-cubic":KR,"in-quart":m1,"out-quart":RM,"in-out-quart":_=>_<.5?m1(2*_)/2:(RM(2*(_-.5))+1)/2,"in-coast-quart":ZR,"out-coast-quart":$R,"in-out-coast-quart":kR,"in-quint":g1,"out-quint":wM,"in-out-quint":_=>_<.5?g1(2*_)/2:(wM(2*(_-.5))+1)/2,"in-coast-quint":YR,"out-coast-quint":JR,"in-out-coast-quint":XR,"in-sine":y1,"out-sine":IM,"in-out-sine":_=>_<.5?y1(2*_)/2:(IM(2*(_-.5))+1)/2,"in-expo":v1,"out-expo":Nm,"in-out-expo":_=>_<.5?v1(2*_)/2:(Nm(2*(_-.5))+1)/2,"in-circ":E1,"out-circ":LM,"in-out-circ":_=>_<.5?E1(2*_)/2:(LM(2*(_-.5))+1)/2};function va(_,v,O=rw,D=v){let w=!1;D!==v&&D.copyFrom(v),D.computeUp(_.state.viewingMode);for(let Pe=0;Pe<iw;Pe++){let Ue=0;for(const Xe of tw)if(Lm(O.selection,Xe.type)){const st=Math.abs(Xe.error(_,D,O));Xe.apply(_,D,O)&&(w=!0,Ue+=st)}if(0===Ue)break}const te=Lm(O.selection,wo.COLLISION),fe=function qR(_,v){switch(_){case bn.PAN:return Md.EYE_AND_CENTER;case bn.ASCEND:return v.state.isGlobal?Md.EYE_AND_CENTER_SCALE:Md.EYE_AND_CENTER;default:return Md.EYE}}(O.interactionType,_);return te&&f_(_,D,fe)&&(w=!0),w&&D.computeUp(_.state.viewingMode),w}function ih(_,v){const O="number"==typeof _?_:(0,Oi.j)(_,v),D=Math.min(1,O/150);return SM(D)}const tw=[{type:wo.TILT,error:function ew(_,v,O){return h1(_,v,O)*v.distance},apply:function PM(_,v,O=E0,D=!0){Bm.eyeCenterDistance=0,Bm.requiresTwoSteps=!1;const w=h1(_,v,O,void 0,Bm);if(0===w)return!1;switch((0,js.d)(Ey,-w,v.viewRight),O.tiltMode){case ml.LOOK_AROUND:(0,_t.m)(T0,v.viewForward,Ey),(0,_t.g)(T0,T0,Bm.eyeCenterDistance),v.center=(0,_t.a)(M0,v.eye,T0);break;case ml.TUMBLE:(0,_t.b)(T0,v.center,v.eye),(0,_t.m)(T0,T0,Ey),v.eye=(0,_t.b)(M0,v.center,T0);break;default:(0,Fl.Bg)(O.tiltMode)}return v.up=(0,_t.m)(M0,v.up,Ey),!Bm.requiresTwoSteps||!D||PM(_,v,O,!1)}},{type:wo.ALTITUDE,error:a1,apply:function iR(_,v,O=E0){const D=a1(_,v,O);if(0===D)return!1;const w=_.renderCoordsHelper,te=w.getAltitude(v.eye)+D,fe=bM(v,O.interactionDirection,function oR(_,v,O,D){return _.renderCoordsHelper.worldUpAtPosition(v.eye,D),(0,_t.g)(D,D,O),D}(_,v,Math.sign(D),uR),cR),Pe=(0,_t.c)(dR,v.viewForward),Ue=w.intersectInfiniteManifold((0,Yu.re)(v.eye,fe),te,l1);return v.eye=(0,lt.pC)(Ue)?Ue:w.setAltitude(l1,te,v.eye),v.center=(0,rR.W8)(l1,v.eye,Pe,v.center),!0}},{type:wo.DISTANCE,error:c1,apply:function hR(_,v,O=E0){const D=c1(_,v,O);if(0===D)return!1;const w=_.pointsOfInterest.surfaceOrigin,te=u1(_,v)+D,fe=(0,_t.c)(_R,v.eye),Pe=bM(v,O.interactionDirection,function fR(_,v,O){return(0,_t.r)(O,v.eye,_.pointsOfInterest.surfaceOrigin.renderLocation)}(_,v,yR),gR);if(!(0,aa.h)((0,aa.l)(w.renderLocation,te),(0,Yu.re)(v.eye,Pe),my))return!1;v.eye=my;const Ue=(0,_t.b)(mR,v.eye,fe);v.center=(0,_t.a)(my,v.center,Ue);const Xe=_.renderCoordsHelper.getAltitude(v.center),st=_.renderCoordsHelper.intersectInfiniteManifold(v.ray,Xe,my);return(0,lt.pC)(st)&&(v.center=st),!0}}],rw={selection:wo.ALL,interactionType:bn.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ml.TUMBLE},iw=5;var Mp=T(550);const Ju=(0,$t.c)(),Cu=(0,$t.c)(),O0=(0,$t.c)(),_c=(0,$t.c)(),Of=(0,$t.c)(),sw=(0,$t.c)(),Xu={upward:(0,$t.f)(0,0,1),forward:(0,$t.f)(0,1,0),sideway:(0,$t.f)(1,0,0)},BM=(0,Mp.c)();class NM{constructor(v=Us.JY.Global){this.viewingMode=v,this.center=(0,$t.c)(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=(0,$t.a)(Xu.forward)}pixelsPerPanAtZoom(v){return this.size/2/(this._zoomToPanScale*v)}zoomAtPixelsPerPan(v){return this.size/2/(this._zoomToPanScale*v)}pixelsPerRotateAtZoom(){const v=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/v}compareTo(v,O){if(O||(O={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===Us.JY.Global){const te=((0,_t.l)(this.center)+(0,_t.l)(v.center))/2;O.pan=(0,oa.EU)(this.center,v.center)*te}else O.pan=(0,_t.i)(this.center,v.center);let D=Math.abs(v.yaw-this.yaw);D>=Math.PI&&(D=2*Math.PI-D);const w=Math.abs(v.pitch-this.pitch);return O.rotate=Math.max(D,w),O.sourceZoom=this.distance,O.targetZoom=v.distance,O}interpolate(v,O,D){this.viewingMode===Us.JY.Global?(0,oa.ZA)(v.center,O.center,D.pan,this.center):(0,_t.h)(this.center,v.center,O.center,D.pan),this.distance=(0,li.t7)(v.distance,O.distance,D.zoom),this.pitch=(0,li.t7)(v.pitch,O.pitch,D.rotate);let w=v.yaw;const te=O.yaw;Math.abs(te-w)>=Math.PI&&(w+=2*(w<te?1:-1)*Math.PI),this.yaw=(0,li.t7)(w,te,D.rotate)}copyFrom(v){(0,_t.c)(this.center,v.center),this.pitch=v.pitch,this.yaw=v.yaw,this.distance=v.distance,(0,_t.c)(this.lookAtDirection,v.lookAtDirection),this.size=v.size,this.copyFromCommon(v),this.viewingMode=v.viewingMode}copyFromRenderCamera(v){const O=this._lookAtOrientation(v.center,BM);(0,_t.c)(this.center,v.center),(0,_t.b)(_c,v.center,v.eye),(0,_t.t)(_c,_c,O),(0,_t.t)(Of,v.up,O),this.distance=(0,_t.l)(_c),_c[0]/=this.distance,_c[1]/=this.distance,_c[2]/=this.distance,this.pitch=this._eyeUpToPitch(_c),this.yaw=this._eyeUpToYaw(_c,Of),this.size=Math.sqrt(v.width*v.width+v.height*v.height),this.copyFromCommon(v)}copyFromCommon(v){this.fov=v.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(v){const O=this._lookAtOrientation(this.center,BM);(0,Aa.t)(O,O),this._axisAngleVec3(Xu.sideway,this.pitch-Math.PI/2,Xu.forward,_c),this._axisAngleVec3(Xu.upward,this.yaw,_c),this._axisAngleVec3(Xu.sideway,this.pitch-Math.PI/2,Xu.upward,Of),this._axisAngleVec3(Xu.upward,this.yaw,Of),(0,_t.g)(_c,_c,this.distance),(0,_t.t)(_c,_c,O),(0,_t.t)(Of,Of,O),v.center=this.center,v.eye=(0,_t.b)(_c,this.center,_c),v.up=Of}_axisAngleVec3(v,O,D,w=D){const te=Math.cos(O),fe=Math.sin(O);return(0,_t.g)(Ju,D,te),(0,_t.f)(Cu,v,D),(0,_t.g)(Cu,Cu,fe),(0,_t.g)(O0,v,(1-te)*(0,_t.e)(v,D)),(0,_t.a)(w,(0,_t.a)(w,Ju,Cu),O0)}_lookAtOrientation(v,O=(0,Mp.c)()){return this._upAtLookAt(v,O0),(0,_t.f)(Ju,this.lookAtDirection,O0),(0,_t.n)(Ju,Ju),0===Ju[0]&&0===Ju[1]&&0===Ju[2]&&(0,_t.c)(Ju,Xu.sideway),(0,_t.f)(Cu,O0,Ju),(0,_t.n)(Cu,Cu),O[0]=Ju[0],O[1]=Cu[0],O[2]=O0[0],O[3]=Ju[1],O[4]=Cu[1],O[5]=O0[1],O[6]=Ju[2],O[7]=Cu[2],O[8]=O0[2],O}_upAtLookAt(v,O){return this.viewingMode===Us.JY.Local?(0,_t.c)(O,Xu.upward):(0,_t.n)(O,v)}_eyeUpToPitch(v){return Math.PI-(0,oa.EU)(Xu.upward,v)}_eyeUpToYaw(v,O){const D=sw;return Math.abs(O[2])<.5?((0,_t.c)(D,O),v[2]>0&&(0,_t.g)(D,D,-1)):(0,_t.c)(D,v),(0,_t.f)(Cu,D,Xu.upward),(0,_t.n)(Cu,Cu),(0,oa.EU)(Xu.sideway,Cu,Xu.upward)}}var $n=T(59856);const Cy_minDuration=(0,io.HA)(500),Cy_maxDuration=(0,io.HA)(8e3);class b1{constructor(v){this.createCamera=v,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:2},this.source=v(),this.target=v()}clone(){const v=new b1(this.createCamera);return v.copyFrom(this),v}copyFrom(v){this.update(v.source,v.target,v.settings)}update(v,O,D){this.source!==v&&this.source.copyFrom(v),this.target!==O&&this.target.copyFrom(O),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=null!=D.desiredScreenFlow?D.desiredScreenFlow:2,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(v){const O=this.target.pixelsPerPanAtZoom(v);return this.halfWindowSize/O}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}}class C1{constructor(v){v&&this.update(v)}get time(){return this._time}update(v){v&&(this.definition?this.definition.copyFrom(v):this.definition=v.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const v=this.definition,O=v.compared,D=O.sourceZoom,w=O.targetZoom;this._zoomSign=D>w?1:-1,this._panPixelsAtSource=O.pan*v.source.pixelsPerPanAtZoom(D);const te=(v.source.pixelsPerRotateAtZoom(D)+v.target.pixelsPerRotateAtZoom(w))/2;this._rotatePixels=O.rotate*te}_updatePixelFlow(){const v=this.definition.compared.sourceZoom,O=this.definition.compared.targetZoom,{hasZoom:D,hasPan:w,hasRotate:te}=this.definition;let fe=0,Pe=0;D&&(w&&(fe=(O/v-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),te&&(Pe=this._zoomSign*(Math.log(v/O)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const Ue=this.definition.desiredPixelFlow;if(D&&w&&te){const Xe=fe+Pe+fe*Pe;this._zoomPixelFlow=fe*Pe/Xe*Ue,this._panPixelFlow=Pe/Xe*Ue,this._rotatePixelFlow=fe/Xe*Ue}else if(D&&w){const Xe=1+fe;this._zoomPixelFlow=fe/Xe*Ue,this._panPixelFlow=1/Xe*Ue}else if(D&&te){const Xe=1+Pe;this._zoomPixelFlow=Pe/Xe*Ue,this._rotatePixelFlow=1/Xe*Ue}else if(w&&te){const Xe=this._panPixelsAtSource/this._rotatePixels,st=1+Xe;this._panPixelFlow=Xe/st*Ue,this._rotatePixelFlow=1/st*Ue}else w?this._panPixelFlow=Ue:D?this._zoomPixelFlow=Ue:te&&(this._rotatePixelFlow=Ue);this._time=te?this.rotateTime:D?this.zoomTime:w?this.panTime:(0,io._H)(0)}get rotateTime(){return(0,io._H)(this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0)}get zoomTime(){return(0,io._H)(this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0)}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const v=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return(0,io._H)(Math.log(v*this._panPixelsAtSource*(this._zoomPixelFlow/this._panPixelFlow)+1)/(v*this._zoomPixelFlow))}return(0,io._H)(this._panPixelsAtSource/this._panPixelFlow)}return(0,io._H)(0)}_interpolateComponentsZoom(v){if(0===v||1===v)return v;if(this.definition.hasZoom){const O=this.definition.compared.sourceZoom,D=this.definition.compared.targetZoom;return(O*(O/D)**-v-O)/(D-O)}return v}_interpolateComponentsPan(v){if(0===v||1===v)return v;if(this.definition.hasPan&&this.definition.hasZoom){const O=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(O*v*this._time)-1))/(O*Math.LN2)}return v}_interpolateComponentsRotate(v){return v}interpolateComponentsAt(v,O){v=Math.min(Math.max(v,0),1);const D=this._interpolateComponentsZoom(v),w=this._interpolateComponentsPan(v),te=this._interpolateComponentsRotate(v);return O?(O.zoom=D,O.pan=w,O.rotate=te):O={zoom:D,pan:w,rotate:te},O}}function ow(_,v,O){const w=_.halfWindowPanAtZoom(v-_.compared.sourceZoom);return-_.halfWindowSize*(O.ascensionFactor*Math.LN2*_.compared.pan+w)*Math.log(_.compared.sourceZoom/v)/(_.desiredPixelFlow*Math.LN2*w)}function aw(_,v,O){const D=1/v,w=Math.log(_.compared.sourceZoom*D),te=1/_.desiredPixelFlow,fe=1/Math.LN2,Pe=v-_.compared.sourceZoom,Ue=1/Pe,Xe=(O.ascensionFactor*Math.LN2*_.compared.pan+_.halfWindowPanAtZoom(Pe))/_.halfWindowPanAtZoom(1);return _.halfWindowSize*D*te*fe*Ue*Xe-_.halfWindowSize*w*te*fe*Ue+_.halfWindowSize*w*te*fe*Xe/(Pe*Pe)}function lw(_,v,O){const D=v-_.compared.sourceZoom,w=1/D,te=1/v,fe=Math.log(_.compared.sourceZoom*te),Pe=(O.ascensionFactor*Math.LN2*_.compared.pan+_.halfWindowPanAtZoom(D))/_.halfWindowPanAtZoom(1);return _.halfWindowSize*w*(-2*w*te*Pe+2*w*fe+2*te-2*fe*Pe/(D*D)-Pe/(v*v))/(_.desiredPixelFlow*Math.LN2)}function cw(_,v){return-_.halfWindowSize*Math.log(_.compared.sourceZoom/v)/(_.desiredPixelFlow*Math.LN2)}function uw(_,v){return _.halfWindowSize/(v*_.desiredPixelFlow*Math.LN2)}function dw(_,v){return-_.halfWindowSize/(v*v*_.desiredPixelFlow*Math.LN2)}function _w(_,v,O){return _.halfWindowSize*(-_.halfWindowPanAtZoom(v)-O.descensionFactor*Math.LN2*_.compared.pan+_.halfWindowPanAtZoom(_.compared.targetZoom))*Math.log(v/_.compared.targetZoom)/(_.desiredPixelFlow*Math.LN2*_.halfWindowPanAtZoom(-v+_.compared.targetZoom))}function mw(_,v,O){const D=Math.log(v/_.compared.targetZoom),w=1/_.desiredPixelFlow,te=1/Math.LN2,fe=-v+_.compared.targetZoom,Pe=1/fe,Ue=(-_.halfWindowPanAtZoom(v)-O.descensionFactor*Math.LN2*_.compared.pan+_.halfWindowPanAtZoom(_.compared.targetZoom))/_.halfWindowPanAtZoom(1);return-_.halfWindowSize*D*w*te*Pe+_.halfWindowSize*D*w*te*Ue/(fe*fe)+_.halfWindowSize*w*te*Pe*Ue/v}function gw(_,v,O){const D=v-_.compared.targetZoom,w=1/D,te=1/v,fe=Math.log(v/_.compared.targetZoom),Pe=(_.halfWindowPanAtZoom(v)+O.descensionFactor*Math.LN2*_.compared.pan-_.halfWindowPanAtZoom(_.compared.targetZoom))/_.halfWindowPanAtZoom(1);return _.halfWindowSize*w*(-2*w*te*Pe-2*w*fe+2*te+2*fe*Pe/(D*D)-Pe/(v*v))/(_.desiredPixelFlow*Math.LN2)}function yw(_,v){return _.halfWindowSize*Math.log(v/_.compared.targetZoom)/(_.desiredPixelFlow*Math.LN2)}function vw(_,v){return _.halfWindowSize/(v*_.desiredPixelFlow*Math.LN2)}function Ew(_,v){return-_.halfWindowSize/(v*v*_.desiredPixelFlow*Math.LN2)}class Mw extends class nw{constructor(){this.segments=[]}get time(){return this.segments.reduce((v,O)=>(0,io._H)(v+O.time),(0,io._H)(0))}interpolateComponentsAt(v,O){v=Math.min(Math.max(v,0),1),v*=this.time;let D=0,w=0;const te=this.definition;for(let fe=0;fe<this.segments.length;fe++){const Pe=this.segments[fe],Ue=Pe.definition;if(v<=Pe.time||fe===this.segments.length-1){(O=this.segmentInterpolateComponentsAt(Pe,v/Pe.time,O)).pan=te.hasPan?(D+Ue.compared.pan*O.pan)/te.compared.pan:1,O.rotate=te.hasRotate?(w+Ue.compared.rotate*O.rotate)/te.compared.rotate:1;const Xe=O.zoom*(Ue.compared.targetZoom-Ue.compared.sourceZoom)+Ue.compared.sourceZoom,st=this.segments[0].definition.compared.sourceZoom,vt=this.segments[this.segments.length-1].definition.compared.targetZoom;return O.zoom=te.hasZoom?(Xe-st)/(vt-st):1,O}v-=Pe.time,D+=Ue.compared.pan,w+=Ue.compared.rotate}}segmentInterpolateComponentsAt(v,O,D){return v.interpolateComponentsAt(O,D)}}{constructor(v,O){super(),this._preallocSegments=[new C1,new C1,new C1],this.update(v,O)}update(v,O){if(!v)return;this.definition?this.definition.copyFrom(v):this.definition=v.clone();let D=null;O&&O.apex&&(D=function Cw(_,v){let O=function Tw(_,v){const O=Math.max(_.compared.sourceZoom,_.compared.targetZoom),D=_.source.zoomAtPixelsPerPan(_.desiredPixelFlow/_.compared.pan)/2;return D<O?null!=v.maximumDistance?O+(v.maximumDistance-O)/2:1.5*O:v.maximumDistance?Math.min(v.maximumDistance,D):D}(_,v);const D={ascensionFactor:null!=v.ascensionFactor?v.ascensionFactor:.5,descensionFactor:null!=v.descensionFactor?v.descensionFactor:.5},w=0===D.ascensionFactor,te=0===D.descensionFactor,fe=w?cw:ow,Pe=w?uw:aw,Ue=w?dw:lw,Xe=te?yw:_w,st=te?vw:mw,vt=te?Ew:gw,Ct=br=>fe(_,br,D)+function hw(_,v,O){return-_.compared.pan*_.halfWindowSize*(O.ascensionFactor+O.descensionFactor-1)/(_.desiredPixelFlow*_.halfWindowPanAtZoom(v))}(_,br,D)+Xe(_,br,D),Kt=br=>Ue(_,br,D)+function fw(_,v,O){return-2*_.compared.pan*_.halfWindowSize*(O.ascensionFactor+O.descensionFactor-1)/(_.desiredPixelFlow*_.halfWindowPanAtZoom(v*v*v))}(_,br,D)+vt(_,br,D);let Lt=Ct(O);const nr=function bw(_){const v=Math.LN2*_.compared.pan,D=_.halfWindowPanAtZoom(_.compared.sourceZoom-_.compared.targetZoom),w=_.halfWindowSize*Math.log(_.compared.sourceZoom/_.compared.targetZoom)/(_.desiredPixelFlow*Math.LN2*D);return _.compared.sourceZoom<=_.compared.targetZoom?w*(v-D):w*(v+D)}(_);let sr;const Er=v.maximumIterations||20,yr=null!=v.maximumDistance?v.maximumDistance:1/0;for(sr=0;sr<Er;sr++){const Rr=(Pe(_,br=O,D)+function pw(_,v,O){return _.compared.pan*_.halfWindowSize*(O.ascensionFactor+O.descensionFactor-1)/(_.desiredPixelFlow*_.halfWindowPanAtZoom(v*v))}(_,br,D)+st(_,br,D)+1e-6)/Kt(O);if(isNaN(Rr)||O>=yr&&Rr<0){if(!isFinite(yr))return null;O=yr,Lt=Ct(O);break}if(O-=Rr,O<_.compared.sourceZoom||O<_.compared.targetZoom)return null;const $r=Ct(O);if(Math.abs($r-Lt)/Lt<=.005)break;Lt=$r}var br;return Lt>.7*nr||O<_.compared.sourceZoom||O<_.compared.targetZoom?null:O}(v,O.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,null==D?this._updateWithoutApex():this._updateWithApex(D,O.apex)}segmentInterpolateComponentsAt(v,O,D){return D=v.interpolateComponentsAt(O,D),v===this._ascensionSegment?D.zoom=f1(D.zoom):v===this._descensionSegment&&(D.zoom=by(D.zoom)),D}_updateWithApex(v,O){const[D,w,te]=this._preallocSegments,fe=null!=O.ascensionFactor?O.ascensionFactor:.5,Pe=Math.min(1-fe,null!=O.ascensionFactor?O.descensionFactor:.5),Ue=1-fe-Pe;D.definition?D.definition.copyFrom(this.definition):D.definition=this.definition.clone(),D.definition.compared.targetZoom=v,D.definition.compared.pan=this.definition.compared.pan*fe,D.definition.compared.rotate=this.definition.compared.rotate*fe,D.update(),this._ascensionSegment=D,this.segments.push(D),Ue>0&&(w.definition?w.definition.copyFrom(this.definition):w.definition=this.definition.clone(),w.definition.copyFrom(this.definition),w.definition.compared.sourceZoom=v,w.definition.compared.targetZoom=v,w.definition.compared.pan=this.definition.compared.pan*Ue,w.definition.compared.rotate=this.definition.compared.rotate*Ue,w.update(),this.segments.push(w)),te.definition?te.definition.copyFrom(this.definition):te.definition=this.definition.clone(),te.definition.compared.sourceZoom=v,te.definition.compared.pan=this.definition.compared.pan*Pe,te.definition.compared.rotate=this.definition.compared.rotate*Pe,te.update(),this._descensionSegment=te,this.segments.push(te)}_updateWithoutApex(){const[v]=this._preallocSegments;v.update(this.definition),this.segments.push(v)}}const Ow={zoom:0,pan:0,rotate:0};class Pw{constructor(v){this.createCamera=v,this._time=(0,io.HA)(0),this.definition=new b1(v),this.path=new Mw}get time(){return this._time}update(v,O,D){this.definition.update(v,O,D),this.path.update(this.definition,D),this._time=this._applyTimeSettings((0,io.up)(this.path.time),D),this._easing=D.easing?D.easing:this._time>=1e3?UM:Nm}cameraAt(v,O){O=O||this.createCamera(),v=Math.min(Math.max(0,v),1),v=this._normalizedEasing(v);const D=this.path.interpolateComponentsAt(v,Ow);return O.interpolate(this.definition.source,this.definition.target,D),O}_normalizedEasing(v){const O=this._easing(0,this._time),D=this._easing(1,this._time);return(this._easing(v,this._time)-O)/(D-O)}_applyTimeSettings(v,O){const D=null!=O.speedFactor?O.speedFactor:1;null!=O.duration?v=O.duration:null!=O.speedFactor&&(v=(0,io.HA)(v/D));const te=null!=O.maxDuration?O.maxDuration:Cy_maxDuration/D;return(0,io.HA)(Math.min(Math.max(null!=O.minDuration?O.minDuration:Cy_minDuration/D,v),te))}}const xw=(0,$t.c)();class Dw{constructor(v){this.currentTime=(0,io.HA)(0),this._animation=new Pw(()=>new NM(v)),this._current=new NM(v)}get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}update(v,O,D){const w=this._animation.definition.source,te=this._animation.definition.target,fe=(0,_t.b)(xw,O.center,v.center),Pe=(0,_t.l)(fe);Pe>=1e-5?(fe[0]/=Pe,fe[1]/=Pe,fe[2]/=Pe):(fe[0]=0,fe[1]=1,fe[0]=0),(0,_t.c)(w.lookAtDirection,fe),(0,_t.c)(te.lookAtDirection,fe),w.copyFromRenderCamera(v),te.copyFromRenderCamera(O),this._current.copyFrom(w),this._animation.update(w,te,D),this.currentTime=(0,io.HA)(0),v.almostEquals(O)&&(this.currentTime=this._animation.time)}cameraAt(v,O){return this._animation.cameraAt(v,this._current),O=O||new $n.V,this._current.copyToRenderCamera(O),O}step(v,O){return this.finished||(this.currentTime=(0,io.HA)(this.currentTime+(0,io.up)(v)),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,O)}}var ta;!function(_){_.Ready="ready",_.Rejected="rejected",_.Running="running",_.Stopped="stopped",_.Finished="finished"}(ta||(ta={}));let Pf=class extends Bi.Z{constructor(){super(...arguments),this.state=ta.Ready}get active(){return this.state===ta.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=ta.Stopped,!0)}finishController(){this.state=ta.Finished}get steppingFinished(){return!1}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pf.prototype,"active",null),(0,Ze._)([(0,nt.Cb)()],Pf.prototype,"state",void 0),Pf=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.CameraController")],Pf);let jm=class extends Pf{get canStop(){return!0}set asyncResult(_){this._asyncResult&&(this._asyncResult.reject((0,zi.zE)()),this._asyncResult=null),this.state===ta.Finished||this.state===ta.Stopped?this.state===ta.Finished?_.resolve():_.reject((0,zi.zE)()):this._asyncResult=_}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=ta.Running,(0,lt.pC)(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){!(0,lt.pC)(this.viewAnimation)||this.state!==ta.Ready&&this.state!==ta.Running||(this.viewAnimation.state===Ol.State.FINISHED?this.finish():this.viewAnimation.state===Ol.State.STOPPED&&(this.state=ta.Stopped))}onControllerEnd(){(0,lt.pC)(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===ta.Finished?this.viewAnimation.finish():this.state===ta.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===ta.Finished?this._asyncResult.resolve():this._asyncResult.reject((0,zi.zE)()))}finish(){this.finishController()}};jm=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.AnimationController")],jm);let Op=class extends jm{constructor(_){super(_),this.view=null,this.mode="interaction",this.hasTarget=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.animation=new Dw(this.view.state.viewingMode),this.viewAnimation="interaction"===this.mode?null:new Ol}get isInteractive(){return"interaction"===this.mode}begin(_,v){this.hasTarget=!0;const O=this.animationSettings(v);Ty.copyFrom(this.view.state.camera);const D=(0,fc.Z8)(this.view.state.viewingMode);this.intersectionHelper.intersectRay(Ty.ray,D,jM)&&(Ty.center=jM),this.animation.update(Ty,_,O),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this.hasTarget&&this.animation.finished}stepController(_,v){this.hasTarget&&this.animation.step(_,v)}onControllerEnd(_){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,_),this.animation.currentTime=this.animation.time),super.onControllerEnd(_)}animationSettings(_={}){return yi(or({apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0}},_),{easing:"string"==typeof _.easing?QR[_.easing]:_.easing})}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Op.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Op.prototype,"mode",void 0),Op=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.PointToPointAnimationController")],Op);const Ty=new $n.V,jM=(0,$t.c)();var Io=T(90014),Nh=T(26046);function T1(_,v,O,D){const w=(0,Nh.iE)(v,O,Aw);return(0,aa.h)(_,w,D)}const Aw=(0,Yu.Ue)();var __;!function(_){_[_.Ellipsoid=0]="Ellipsoid",_[_.Silhouette=1]="Silhouette"}(__||(__={}));const My=[1,3e8];function xf(_,v,O){return O[0]=v[0]/(_.fullWidth/_.pixelRatio),O[1]=v[1]/(_.fullHeight/_.pixelRatio),O}function M1(_){for(;_>Math.PI;)_-=2*Math.PI;for(;_<-Math.PI;)_+=2*Math.PI;return _}function P0(_,v,O){const D=(0,js.d)(Oo.MP.get(),O[3],O);(0,lt.Wi)(D)||((0,_t.b)(Eo,_.eye,v),(0,_t.m)(Eo,Eo,D),_.eye=(0,_t.a)(Eo,Eo,v),(0,_t.b)(Eo,_.center,v),(0,_t.m)(Eo,Eo,D),_.center=(0,_t.a)(Eo,Eo,v),_.up=(0,_t.m)(Eo,_.up,D))}function O1(_,v,O,D){return(0,Io.BR)(_,(0,Nh.iE)(v,O,A1),D)}function P1(_,v,O,D){const w=Oo.WM.get();let te=1-O;(0,_t.b)(w,v,_.eye);const fe=(0,_t.l)(w);let Pe=fe*(1-te);te>=0&&Pe<D&&(Pe=D,te=-(Pe-fe)/fe),Math.abs(fe-Pe)<1e-6||((0,_t.g)(w,w,te),_.eye=(0,_t.a)(Eo,_.eye,w),_.center=(0,_t.h)(Eo,_.center,v,te))}function VM(_,v,O){v.getScreenCenter(zM),T1(_,v,zM,Eo)&&(v.center=Eo);const D=v.distance,w=D*O;if(Math.abs(D-w)<1e-6)return;const te=(0,_t.g)(Oo.WM.get(),v.viewForward,w);v.eye=(0,_t.b)(Eo,v.center,te)}const zM=(0,dr.s1)();function Oy(_,v){(0,_t.s)(v,0,0,0);for(const O of _)(0,_t.a)(v,v,O);(0,_t.g)(v,v,1/_.length)}function Py(_,v,O,D){return Math.sin(_/(0,_t.l)(v))*(O+D.radius)}function GM(_,v,O,D){return Py(Math.PI/2,v,O,D)+(_-Math.PI/2)}var Al;!function(_){_[_.Vertical=0]="Vertical",_[_.Horizontal=1]="Horizontal"}(Al||(Al={}));const HM_Angle=(0,li.Vl)(6),Fm={Pole:.95,Angle:(0,li.Vl)(18),Tilt:45},KM=(0,li.Vl)(80);function ZM(_,v,O,D,w,te){const fe=(0,$t.c)(),Pe=(0,aa.c)();let Ue=!0,Xe=!0;return _.intersectScreen(O,fe,te)?Pe[3]=(0,_t.l)(fe):(Xe=!1,Pe[3]=v.aboveGround&&w!==__.Ellipsoid?Math.max((0,_t.l)(v.center),.9*D.radius):(0,_t.l)(v.eye)-v.relativeElevation,w===__.Silhouette?Wm(Pe,v,O,fe):Ue=T1(Pe,v,O,fe)),{sphere:Pe,scenePickPoint:Ue?fe:null,hasGeometryIntersection:Xe}}function xy(_,v,O,D){return(0,_t.l)(_.eye)-D.radius>3e4?Al.Horizontal:O?((0,Nh.iE)(_,v,aO),-Math.sign(_.relativeElevation)*(.5*Math.PI+(0,Om.EU)(_.eye,aO.direction))<HM_Angle?Al.Vertical:Al.Horizontal):Al.Vertical}function $M(_,v,O){(0,_t.b)(x1,O,v),_.eye=(0,_t.b)(Eo,_.eye,x1),_.center=(0,_t.b)(Eo,_.center,x1)}const x1=(0,$t.c)();function Wm(_,v,O,D){const w=(0,Nh.iE)(v,O,A1);return!((0,lt.Wi)(w)||((0,aa.j)(_,w,Dy),(0,aa.h)(_,w,D)?(0,_t.d)(Dy,w.origin)<(0,_t.d)(D,w.origin)&&((0,_t.c)(D,Dy),1):((0,_t.b)(m_,v.eye,v.center),(0,_t.n)(m_,m_),(0,Io.Oy)(m_,-(0,_t.e)((0,_t.n)(m_,m_),Dy),kM),(0,Io.BR)(kM,w,D),1)))}const Dy=(0,$t.c)(),m_=(0,$t.c)(),kM=(0,Io.Ue)();function YM(_,v,O,D,w,te){let fe;if((0,_t.f)(By,_,v),(0,_t.b)(Ly,_,v),(0,_t.l)(_)<=w||!D.aboveGround){(0,_t.f)(O,Ly,D.eye);const Pe=(0,_t.e)(_,v)/((0,_t.l)(_)*(0,_t.l)(v)),Ue=Math.cos((0,li.uZ)(ga.Q4.normalize((0,li.Vl)(te)),0,KM));fe=-(0,li.ZF)(Pe)-Math.max(0,(0,_t.l)(v)-w)/(Ue*w)}else(0,_t.b)(JM,D.eye,D.center),(0,_t.f)(O,Ly,JM),fe=-(0,_t.l)(Ly)/w;return(0,_t.n)(O,O),(0,_t.g)(O,O,(0,_t.l)(By)),fe}const JM=(0,$t.c)();function XM(_,v,O,D){let w,te;const fe=Math.cos((0,li.uZ)(ga.Q4.normalize((0,li.Vl)(D)),0,KM));return w=v>O?-(v-O)/(fe*O):v<-O?Math.PI-(v+O)/(fe*O):(0,li.ZF)(v/O),te=_>O?-(_-O)/(fe*O):_<-O?Math.PI-(_+O)/(fe*O):(0,li.ZF)(_/O),(te-w)*O}function QM(_,v,O,D,w,te,fe,Pe,Ue,Xe){(0,_t.f)(By,_,v),(0,$s.Tz)(te.up,te.eye,Ay,Sy,Ry),(0,$s.Tz)([0,0,1],te.eye,Pp,x0,rO),(0,_t.c)(O,x0),(0,_t.c)(D,Pp),(0,_t.n)(O,O),(0,_t.g)(O,O,(0,_t.l)(By)),(0,$s.yS)(_,(0,_t.n)(Sy,Sy),(0,_t.n)(Ry,Ry),(0,_t.n)(Ay,Ay),iO),(0,$s.yS)(v,Sy,Ry,Ay,sO),function Rw(_,v,O,D,w,te,fe,Pe,Ue,Xe){const st=XM(_[2],v[2],fe[3],Ue),vt=Xe?XM(_[0],v[0],fe[3],180):v[0]-_[0],Ct=Math.sin(Pe)*vt-Math.cos(Pe)*st,Wt=Math.cos(Pe)*vt+Math.sin(Pe)*st;(0,_t.n)(Eo,w);const Kt=Xe?Ct/Math.sqrt(Math.abs(fe[3]**2-(0,_t.e)(O,Eo)**2)):Ct/fe[3],Lt=Wt/Math.sqrt(Math.abs(fe[3]**2-(0,_t.e)(O,D)**2));(0,Oi.a)(te,Kt,Lt)}(iO,sO,_,Pp,x0,w,fe,Pe,Ue,Xe)}function ww(_,v,O,D,w,te,fe){(0,js.d)(wy,w,D),(0,js.d)(Iy,fe,te),(0,js.m)(g_,wy,Iy),(0,_t.b)(v,_,O),(0,_t.m)(v,v,g_),(0,_t.a)(v,v,O)}function qM(_,v,O,D,w,te){(0,js.d)(wy,D,O),(0,js.d)(Iy,te,w),(0,js.m)(g_,wy,Iy),(0,_t.b)(Eo,_.eye,v),(0,_t.m)(Eo,Eo,g_),_.eye=(0,_t.a)(Eo,Eo,v),(0,_t.b)(Eo,_.center,v),(0,_t.m)(Eo,Eo,g_),_.center=(0,_t.a)(Eo,Eo,v),(0,_t.b)(Eo,_.up,v),(0,_t.m)(Eo,Eo,g_),_.up=(0,_t.a)(Eo,Eo,v)}function D1(_,v,O,D,w,te,fe=Fm.Pole,Pe=Fm.Angle){const Ue=Math.abs(D)>Math.PI-Pe||Math.abs(D)<Pe,Xe=Math.abs(_[2])<O*fe||Math.abs(v)>O;return!!(Ue&&Xe&&te.aboveGround&&w<Fm.Tilt)}function eO(_,v,O,D,w,te){if(te)xm(O,D,nO),P0(v,_,nO);else{const fe=YM(O,D,oO,v,_[3],w);P0(v,_,Pm(oO,fe))}}function tO(_,v,O,D,w,te,fe){const Pe=fe?20:1;let Xe,st;(0,_t.c)(Df,D),Uy.copyFrom(v);for(let vt=0;vt<Pe&&(0,_t.d)(O,Df)>1e-12&&(Xe=(0,_t.d)(O,Df),QM(O,Df,x0,Pp,Vm,Uy,_,w,te,fe),qM(Uy,_,Pp,Vm[1],x0,Vm[0]),ww(Df,Df,_,Pp,Vm[1],x0,Vm[0]),st=(0,_t.d)(O,Df),st<Xe||0===vt);vt++)v.copyFrom(Uy)}const Pp=(0,$t.c)(),x0=(0,$t.c)(),rO=(0,$t.c)(),Ay=(0,$t.c)(),Sy=(0,$t.c)(),Ry=(0,$t.c)(),iO=(0,$t.c)(),sO=(0,$t.c)(),Vm=(0,Li.a)(),nO=Cp(),wy=(0,Zn.c)(),Iy=(0,Zn.c)(),g_=(0,Zn.c)(),Df=(0,$t.c)(),Eo=(0,$t.c)(),Ly=(0,$t.c)(),Uy=new $n.V,By=(0,$t.c)(),oO=(0,$t.c)(),A1={origin:(0,$t.c)(),direction:(0,$t.c)()},aO={origin:(0,$t.c)(),direction:(0,$t.c)()};var Qu=T(40841);let Ny=class extends Op{constructor(){super(...arguments),this.zoomLocation=(0,$t.c)(),this.tmpCamera=new $n.V,this.tmpViewDir=(0,$t.c)(),this.tmpRayDir={origin:(0,$t.c)(),direction:(0,$t.c)()},this.targetOnSphere=(0,$t.c)(),this.tmpCenter=(0,$t.c)(),this.constraintOptions={selection:wo.ALL_EXCEPT_COLLISION,interactionType:bn.ZOOM,interactionFactor:null,interactionStartCamera:new $n.V,interactionDirection:null,tiltMode:ml.TUMBLE},this.sphere=(0,aa.c)()}initialize(){this.intersector=(0,fc.Z8)(this.view.state.viewingMode)}zoomStep(_,v){if(!this.active)return;const O=this.view.state,{interactionStartCamera:D}=this.constraintOptions;this.animation.finished?D.copyFrom(O.camera):this.animation.cameraAt(1,D);let w=!1,te=!1;this.intersectionHelper.intersectScreen(v,this.zoomLocation,0===this.view.map.ground.opacity?Ww:{})&&(w=_>0,te=!0),this.tmpCamera.copyFrom(O.camera),w?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:(0,_t.c)(this.zoomLocation,this.tmpCamera.center),this._updateCamera(this.tmpCamera,_,this.zoomLocation,v,te),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:(0,io.HA)(600),easing:Nm}}_updateCamera(_,v,O,D,w){const fe=xy(_,D,w,(0,Zi.Iu)(this.view.spatialReference));let Pe;this.view.camera.position.hasZ&&(Pe=Math.abs(this.view.camera.position.z)),(0,_t.n)(Fy,_.eye),(0,_t.g)(Fy,Fy,-1),(0,Nh.iE)(_,D,this.tmpRayDir),(0,_t.n)(this.tmpRayDir.direction,this.tmpRayDir.direction);const Ue=Math.max(Math.min(12,1/Math.abs((0,_t.e)(Fy,this.tmpRayDir.direction)))*Pe,200);if(fe===Al.Horizontal){let Xe=.6**v;this.sphere[3]=(0,_t.l)(O),(0,_t.b)(this.tmpViewDir,_.center,_.eye);const st=Math.min((0,_t.l)(this.tmpViewDir),Ue);let vt=st*Xe;if(Xe<=1&&vt<4&&(vt=4,Xe=vt/st),Math.abs(st-vt)<1e-6)return;const Ct=(0,_t.l)(_.center);this.sphere[3]!==Ct&&(_.center=(0,_t.g)(jy,_.center,(this.sphere[3]+Xe*(Ct-this.sphere[3]))/Ct)),(0,_t.g)(this.tmpViewDir,this.tmpViewDir,-Xe),_.eye=(0,_t.a)(jy,_.center,this.tmpViewDir),va(this.view,_,this.constraintOptions),(0,_t.d)(O,_.center)>1e-12&&T1(this.sphere,_,D,this.targetOnSphere)&&function Iw(_,v,O,D,w,te,fe){D1(O,(0,_t.e)(v.up,O),_[3],-ga.Q4.normalize((0,li.Vl)(w)),te,v,Fm.Pole,Fm.Angle)?tO(_,v,O,D,-ga.Q4.normalize((0,li.Vl)(w)),te,fe):eO(_,v,O,D,te,fe)}(this.sphere,_,O,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let Xe=.6**Math.abs(v);const st=v>0?1:-1;(0,_t.b)(this.tmpViewDir,O,_.eye);const vt=(0,_t.l)(this.tmpViewDir),Ct=this.view._stage.renderView.getMinimalDepthForArea(null,D[0],D[1],this.view.state.camera,60);let Wt=Ct?Math.min(Ue,Ct):Ue;Wt=w?Math.min(Wt,vt):Wt,(0,_t.g)(this.tmpRayDir.direction,this.tmpRayDir.direction,Wt),(0,_t.a)(O,this.tmpRayDir.origin,this.tmpRayDir.direction);let Kt=Wt*Xe;const Lt=Math.max(4,1.01*_.nearFar[0]);if(v>0&&Kt<Lt&&(Kt=Lt,Xe=Kt/Wt),Math.abs(Wt-Kt)<1e-6)return;(0,_t.g)(this.tmpRayDir.direction,this.tmpRayDir.direction,st*(1-Xe)),_.eye=(0,_t.a)(jy,_.eye,this.tmpRayDir.direction),_.center=(0,_t.a)(jy,_.center,this.tmpRayDir.direction)}f_(this.view,_)}};Ny=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.global.ZoomStepController")],Ny);const jy=(0,$t.c)(),Fy=(0,$t.c)(),Ww={exclude:new Set([Qu.cy])};let Wy=class extends Op{constructor(){super(...arguments),this.zoomLocation=(0,$t.c)(),this.tmpCamera=new $n.V,this.tmpRayDir=(0,$t.c)(),this.tmpCenter=(0,$t.c)(),this.constraintOptions={selection:wo.ALL,interactionType:bn.ZOOM,interactionFactor:null,interactionStartCamera:new $n.V,interactionDirection:null,tiltMode:ml.TUMBLE}}zoomStep(_,v){if(!this.active)return;const O=this.view.state,{interactionStartCamera:D}=this.constraintOptions;this.animation.finished?D.copyFrom(O.camera):this.animation.cameraAt(1,D),this.tmpCamera.copyFrom(O.camera);const w=(0,fc.Z8)(this.view.state.viewingMode);_>0?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(v,this.zoomLocation,$w):this.intersectionHelper.intersectScreenFreePointFallback(v,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,w,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,w,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:(0,_t.c)(this.zoomLocation,this.tmpCamera.center);const te=.6**_;let fe=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,v[0],v[1],this.view.state.camera,60);(0,_t.b)(Vy,this.tmpCamera.eye,this.zoomLocation),(0,_t.n)(Vy,Vy);const Pe=Math.max(Math.min(14,1/Math.abs((0,_t.e)(Zw,Vy)))*Math.abs(this.view.camera.position.z),200);if(fe=fe?Math.min(fe,Pe):Pe,fe){const Ue=(0,$t.c)();(0,_t.b)(Ue,this.zoomLocation,this.tmpCamera.eye),fe<(0,_t.l)(Ue)&&((0,_t.n)(Ue,Ue),(0,_t.a)(this.zoomLocation,this.tmpCamera.eye,(0,_t.g)(Ue,Ue,fe)))}this._updateCamera(this.tmpCamera,te,this.zoomLocation),this.begin(this.tmpCamera)}animationSettings(){return{apex:null,duration:(0,io.HA)(600),easing:Nm}}_updateCamera(_,v,O){(0,_t.b)(this.tmpRayDir,O,_.eye);const D=(0,_t.l)(this.tmpRayDir);let w=D*v;const te=v<=1,fe=Math.max(4,1.01*_.nearFar[0]);te&&w<fe&&(w=fe,v=w/D),Math.abs(D-w)<1e-6||((0,_t.g)(this.tmpRayDir,this.tmpRayDir,v),_.eye=(0,_t.b)(cO,O,this.tmpRayDir),_.center=(0,_t.h)(cO,_.center,O,1-v),va(this.view,_,this.constraintOptions))}};Wy=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.local.ZoomStepController")],Wy);const cO=(0,$t.c)(),Zw=(0,$t.f)(0,0,1),Vy=(0,$t.c)(),$w={exclude:new Set([Qu.cy])};var xc=T(35216);function R1(_,v){if("touch"===_.pointerType)return!1;switch(v){case"primary":return 0===_.button;case"secondary":return 2===_.button;case"tertiary":return 1===_.button}}class Yw extends xc.a{constructor(v,O){super(!0),this.view=v,this.registerIncoming("double-click",O,D=>this._handleDoubleClick(D))}_handleDoubleClick(v){const O=v.data;if(function kw(_,v){switch(v){case"primary":return"touch"===_.pointerType||0===_.button;case"secondary":return"touch"!==_.pointerType&&2===_.button;case"tertiary":return"touch"!==_.pointerType&&1===_.button}}(O,"primary")){const D=this.view.state.isGlobal?new Ny({view:this.view,mode:"animation"}):new Wy({view:this.view,mode:"animation"});this.view.state.switchCameraController(D),D.zoomStep(Math.log(.5)/Math.log(.6),(0,dr.s1)(O.x,O.y)),v.stopPropagation()}}}let D0=class extends Pf{constructor(){super(...arguments),this.startCamera=new $n.V,this.currentCamera=new $n.V}get isInteractive(){return!0}stepController(_,v){v.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(v)}onControllerStart(_){this.state=ta.Running,this.startCamera.copyFrom(_),this.currentCamera.copyFrom(_)}onControllerEnd(_){_.copyViewFrom(this.currentCamera)}};var Tu;D0=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.InteractiveController")],D0),function(_){_[_.CENTER=0]="CENTER",_[_.EYE=1]="EYE"}(Tu||(Tu={}));let y_=class extends D0{constructor(_){super(_),this.view=null,this.pivot=Tu.CENTER,this.lastPoint=(0,Li.a)(),this.tmpWorldUp=(0,$t.c)(),this.tmpViewDir=(0,$t.c)(),this.tmpRotCurPoint=(0,Li.a)(),this.tmpTransf=(0,Zn.c)(),this.tmpAxis=(0,$t.c)(),this.tmpPivotPoint=(0,$t.c)(),this.pivotPos=(0,$t.c)(),this.constraintOptions={selection:wo.ALL,interactionType:bn.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ml.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}initialize(){this.rotScale=this.pivot===Tu.CENTER?3:1.5}begin(_){if(this.active){switch(this.pivot){case Tu.EYE:(0,_t.c)(this.pivotPos,this.startCamera.eye),this.constraintOptions.interactionType=bn.LOOK_AROUND,this.constraintOptions.tiltMode=ml.LOOK_AROUND,this.constraintOptions.selection=wo.NONE;break;case Tu.CENTER:{const v=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);v||(0,_t.c)(this.pivotPos,this.startCamera.center),this._constrainPivotPoint(_,v),this.startCamera.center=this.pivotPos,this.constraintOptions.interactionType=bn.TUMBLE,this.constraintOptions.tiltMode=ml.TUMBLE,this.constraintOptions.selection=wo.ALL&~wo.DISTANCE;break}}this.constraintOptions.interactionStartCamera=this.startCamera,xf(this.startCamera,_,this.lastPoint)}}_constrainPivotPoint(_,v){const O=this.startCamera,D=(0,$t.c)();(0,_t.b)(D,this.pivotPos,O.eye);const w=(0,_t.l)(D);let te=Math.min(w,7*Math.abs(this.view.camera.position.z));const fe=(0,Zi.Iu)(this.view.spatialReference),Pe=(0,dr.s1)(O.width/O.pixelRatio*.5,O.height/O.pixelRatio*.5),Ue=xy(this.startCamera,Pe,!0,fe);let Xe=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,O.fullWidth/O.pixelRatio*.5,O.fullHeight/O.pixelRatio*.5,O,225,90),st=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,_[0],_[1],O,90);void 0===Xe&&void 0===st||(Xe=void 0===Xe?st:Xe,st=void 0===st||Ue===Al.Horizontal?Xe:st,te=Xe>st?st:Xe,te=v?Math.min(te,w):te),(0,_t.n)(D,D),(0,_t.c)(this.pivotPos,(0,_t.a)(this.tmpPivotPoint,O.eye,(0,_t.g)(this.tmpPivotPoint,D,te)))}update(_){if(this.active){switch(this.pivot){case Tu.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,_,this.currentCamera.center,this.pivotPos);break;case Tu.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,_,this.currentCamera.eye,this.pivotPos)}va(this.view,this.currentCamera,this.constraintOptions)}}end(){this.active&&this.finishController()}_applyRotation(_,v,O,D){this.view.renderCoordsHelper.worldUpAtPosition(D,this.tmpWorldUp),xf(_,v,this.tmpRotCurPoint);let w=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale,te=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;(0,_t.b)(this.tmpViewDir,O,D);const fe=(0,_t.l)(this.tmpViewDir),Pe=(0,li.ZF)((0,_t.e)(this.tmpViewDir,this.tmpWorldUp)/fe);if(this.pivot===Tu.EYE){w*=-.5;const Ue=.5*Math.PI-Pe,Xe=.5*Math.PI*.99;w=Ue-Math.max(-Xe,Math.min(Xe,Ue+w))}return w=(0,li.uZ)(w+Pe,jo.min,jo.max)-Pe,(0,_t.f)(this.tmpAxis,_.up,this.tmpViewDir),this.pivot===Tu.CENTER&&(te=-te),(0,js.d)(this.tmpTransf,te,this.tmpWorldUp),(0,js.e)(this.tmpTransf,this.tmpTransf,w,this.tmpAxis),(0,_t.m)(this.tmpViewDir,this.tmpViewDir,this.tmpTransf),_.up=(0,_t.m)(I1,_.up,this.tmpTransf),(0,_t.a)(I1,D,this.tmpViewDir),(0,Oi.c)(this.lastPoint,this.tmpRotCurPoint),I1}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],y_.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)()],y_.prototype,"pivot",void 0),y_=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.RotateController")],y_);const I1=(0,$t.c)();class L1 extends xc.a{constructor(v,O,D,w){super(!0),this.view=v,this.pointerAction=O,this.pivot=D,this.registerIncoming("drag",w,te=>this._handleDrag(te))}_handleDrag(v){const O=v.data;if(O.pointers.size>1||!R1(v.data,this.pointerAction))return;const D=(0,dr.s1)(O.center.x,O.center.y);switch(O.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=new y_({view:this.view,pivot:this.pivot}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(D);break;case"update":this.cameraController&&this.cameraController.update(D);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}v.stopPropagation()}}let zy=class extends D0{constructor(_){super(_),this.view=null,this.pickPoint=(0,$t.c)(),this.tmpP0=(0,Li.a)(),this.panAxisAngle=Cp(),this.tmpRayDir=(0,$t.c)(),this.tmpRayDirPick=(0,$t.c)(),this.targetOnSphere=(0,$t.c)(),this.tmpRay={origin:(0,$t.c)(),direction:(0,$t.c)()},this.dragBeginPoint=(0,dr.s1)(),this.normalizedAnchorPoint=(0,Li.a)(),this.constraintOptions={selection:wo.ALL_EXCEPT_COLLISION,interactionType:bn.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ml.TUMBLE},this.sphere=(0,aa.c)(),this.hasPickPoint=!1}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(_){if(!this.active)return;(0,Oi.c)(this.dragBeginPoint,_),xf(this.startCamera,_,this.normalizedAnchorPoint);const v=(0,Zi.Iu)(this.view.spatialReference),O=ZM(this.intersectionHelper,this.startCamera,_,v,__.Ellipsoid,0===this.view.map.ground.opacity?Xw:{});if(this.navMode=xy(this.startCamera,_,O.hasGeometryIntersection,v),this.navMode===Al.Horizontal)this.hasPickPoint=!!O.scenePickPoint,this.pickPoint=O.scenePickPoint,this.sphere=O.sphere;else{let D,w;(0,Nh.iE)(this.startCamera,_,this.tmpRay),(0,_t.n)(this.tmpRay.direction,this.tmpRay.direction),O.scenePickPoint&&((0,_t.b)(this.tmpRayDirPick,this.startCamera.eye,O.scenePickPoint),w=(0,_t.l)(this.tmpRayDirPick)),this.view.camera.position.hasZ&&(D=Math.abs(this.view.camera.position.z));let te=(0,li.uZ)(30*D,My[0],My[1]);const fe=this.view._stage.renderView.getMinimalDepthForArea(null,_[0],_[1],this.view.state.camera,70);te=fe?Math.min(te,fe):te,te=O.scenePickPoint?Math.min(te,w):te,this.hasPickPoint=!0,(0,_t.g)(this.tmpRay.direction,this.tmpRay.direction,te),(0,_t.a)(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}update(_){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this.navMode===Al.Horizontal){(0,_t.b)(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const v=(0,_t.l)(this.tmpRayDir);xf(this.currentCamera,_,this.tmpP0);const O=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let D=v*2**O;const w=this.view.state.constraints.minimumPoiDistance;if(O<0&&D<w&&(D=w),Math.abs(v-D)<1e-6)return;if(this.hasPickPoint&&D<v){const te=1-(1-D/v)*(1-this.sphere[3]/(0,_t.l)(this.currentCamera.center));this.currentCamera.center=(0,_t.g)(Gy,this.currentCamera.center,te)}(0,_t.g)(this.tmpRayDir,this.tmpRayDir,-D/v),this.currentCamera.eye=(0,_t.a)(Gy,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=ih(this.dragBeginPoint,_),va(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(Wm(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),xm(this.pickPoint,this.targetOnSphere,this.panAxisAngle),P0(this.currentCamera,this.sphere,this.panAxisAngle))}else{const v=(0,_t.l)(this.tmpRay.direction);xf(this.currentCamera,_,this.tmpP0);const O=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);let D=v*2**O;const w=this.view.state.constraints.minimumPoiDistance;if(O<0&&D<w&&(D=w),Math.abs(v-D)<1e-6)return;(0,_t.g)(this.tmpRayDir,this.tmpRay.direction,1-D/v),this.currentCamera.eye=(0,_t.a)(Gy,this.currentCamera.eye,this.tmpRayDir),this.currentCamera.center=(0,_t.a)(Gy,this.currentCamera.center,this.tmpRayDir)}f_(this.view,this.currentCamera)}}end(){this.active&&this.finishController()}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],zy.prototype,"view",void 0),zy=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.global.ZoomController")],zy);const Gy=(0,$t.c)(),Xw={exclude:new Set([Qu.cy])};let Hy=class extends D0{constructor(_){super(_),this.view=null,this.tmpP=(0,$t.c)(),this.tmpDir=(0,$t.c)(),this.tmpN=(0,$t.c)(),this.tmpP0=(0,Li.a)(),this.tmpPoi=(0,$t.c)(),this.tmpRayDir=(0,$t.c)(),this.dragBeginPoint=(0,dr.s1)(),this.normalizedAnchorPoint=(0,Li.a)(),this.constraintOptions={selection:wo.ALL,interactionType:bn.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:(0,$t.c)(),tiltMode:ml.TUMBLE},this.plane=(0,Io.Ue)()}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(_){if(!this.active)return;(0,Oi.c)(this.dragBeginPoint,_),xf(this.startCamera,_,this.normalizedAnchorPoint);const v=this.intersectionHelper.intersectScreenFreePointFallback(_,this.tmpP,0===this.view.map.ground.opacity?Qw:{});(0,_t.b)(this.tmpDir,this.tmpP,this.startCamera.eye);const O=(0,_t.l)(this.tmpDir);let D;(0,_t.n)(this.tmpDir,this.tmpDir),this.view.camera.position.hasZ&&(D=Math.abs(this.view.camera.position.z));let w=(0,li.uZ)(30*D,My[0],My[1]);const te=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,_[0],_[1],this.view.state.camera,70);w=te?Math.min(w,te):w,w=v?Math.min(w,O):w,(0,_t.g)(this.tmpDir,this.tmpDir,w),(0,_t.a)(this.tmpP,this.startCamera.eye,this.tmpDir),(0,_t.b)(this.tmpN,this.startCamera.eye,this.startCamera.center),(0,_t.n)(this.tmpN,this.tmpN),this.tmpN[1]<0&&(0,_t.o)(this.tmpN,this.tmpN),(0,Io.Yq)(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=this.startCamera}update(_){if(!this.active)return;(function Sw(_,v,O,D){return(0,Io.BR)(_,(0,Nh.u4)(v,O,A1),D)})(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||(0,_t.c)(this.tmpPoi,this.currentCamera.center),xf(this.currentCamera,_,this.tmpP0);let v=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);(0,Oi.c)(this.normalizedAnchorPoint,this.tmpP0),(0,_t.b)(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);const O=(0,_t.l)(this.tmpRayDir);let D=O*(1-v);(0,_t.c)(this.constraintOptions.interactionDirection,this.tmpRayDir),(0,_t.g)(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(v)/O);const w=this.view.state.constraints.minimumPoiDistance;v>=0&&D<w&&(D=w,v=-(D-O)/O),Math.abs(O-D)<1e-6||((0,_t.g)(this.tmpRayDir,this.tmpRayDir,v),this.currentCamera.eye=(0,_t.a)(Af,this.currentCamera.eye,this.tmpRayDir),(0,_t.h)(Af,this.currentCamera.center,this.tmpPoi,v),Af[2]=this.tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],Af[2]):Math.min(this.startCamera.center[2],Af[2]),this.currentCamera.center=Af,this.constraintOptions.interactionFactor=ih(this.dragBeginPoint,_),va(this.view,this.currentCamera,this.constraintOptions))}end(){this.active&&this.finishController()}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Hy.prototype,"view",void 0),Hy=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.local.ZoomController")],Hy);const Af=(0,$t.c)(),Qw={exclude:new Set([Qu.cy])};class qw extends xc.a{constructor(v,O,D){super(!0),this.view=v,this.pointerAction=O,this.registerIncoming("drag",D,w=>this._handleDrag(w))}_handleDrag(v){const O=v.data;if(O.pointers.size>1||!R1(v.data,this.pointerAction))return;const D=(0,dr.s1)(O.center.x,O.center.y);switch(O.action){case"start":this.cameraController&&(this.cameraController.end(),this.cameraController=null),this.cameraController=this.view.state.isGlobal?new zy({view:this.view}):new Hy({view:this.view}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(D);break;case"update":this.cameraController&&this.cameraController.update(D);break;case"end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}v.stopPropagation()}}const eI=(0,$t.c)(),Ky=(0,$t.c)();function U1(){return{direction:(0,$t.c)(),up:(0,$t.c)()}}function uO(_,v,O,D,w){let te=(0,_t.n)(eI,_),fe=(0,_t.e)(te,D);const Pe=fe>0;fe=Math.abs(fe),fe>.99&&(fe=Math.abs((0,_t.e)(v,D)),fe<.99?((0,_t.c)(te,v),Pe&&(0,_t.g)(te,te,-1)):te=null);let Ue=0;if(te){(0,_t.g)(Ky,D,(0,_t.e)(D,te)),(0,_t.b)(te,te,Ky);const st=(0,_t.e)(te,w)/((0,_t.l)(te)*(0,_t.l)(w));(0,_t.f)(Ky,te,w),Ue=((0,_t.e)(Ky,D)>0?1:-1)*(0,li.BV)((0,li.ZF)(st))}const Xe=(0,li.BV)((0,li.ZF)(-(0,_t.e)(D,_)/(0,_t.l)(_)));return O?(O.heading=Ue,O.tilt=Xe,O):{heading:Ue,tilt:Xe}}const dO=(0,$t.f)(0,1,0),hO=(0,$t.f)(0,0,1),zm=(0,Zn.c)(),xp=(0,$t.c)(),Dp=(0,$t.c)();function pO(_,v,O,D=U1()){const{direction:w,up:te}=D;return(0,js.b)(zm,-(0,li.Vl)(v)),(0,js.r)(zm,zm,(0,li.Vl)(O)),(0,_t.m)(w,hO,zm),(0,_t.g)(w,w,-1),(0,_t.m)(te,dO,zm),D}function fO(_,v,O,D,w){const te=_.renderSpatialReference,fe=_.map&&_.spatialReference||v.spatialReference;return(0,ci.KC)(v,xp,te),(0,ci.KC)(v,Dp,te),xp[0]-=O/2,Dp[0]+=O/2,xp[1]-=D/2,Dp[1]+=D/2,(0,ci.SH)(xp,te,xp,fe),(0,ci.SH)(Dp,te,Dp,fe),w?(w.xmin=xp[0],w.ymin=xp[1],w.xmax=Dp[0],w.ymax=Dp[1],w.spatialReference=fe):w=new To.Z(xp[0],xp[1],Dp[0],Dp[1],fe),w}const nI=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:pO,directionToHeadingTilt:function tI(_,v,O,D){return uO(v,O,D,hO,dO)},eyeForCenterWithHeadingTilt:function rI(_,v,O,D){const w=pO(0,O,D),te=(0,$t.c)();return(0,_t.g)(te,w.direction,-v),(0,_t.a)(te,te,_),{up:w.up,eye:te,heading:O,tilt:D}},lookAtTiltToEyeTilt:function iI(_){return(0,li.BV)(_)},eyeTiltToLookAtTilt:function sI(_){return(0,li.Vl)(_)},toExtent:fO},Symbol.toStringTag,{value:"Module"}));var sh=T(46367);const _O=(0,$t.f)(0,0,1),mO=(0,_t.n)((0,$t.c)(),(0,$t.f)(1,1,1)),oI=new ga.pE(-180,180),Gm=(0,Zn.c)(),A0=(0,$t.c)(),v_=(0,$t.c)();function gO(_,v,O,D=U1()){(0,_t.f)(A0,_,_O),0===(0,_t.e)(A0,A0)&&(0,_t.f)(A0,_,mO),(0,js.d)(Gm,-(0,li.Vl)(v),_),(0,js.e)(Gm,Gm,-(0,li.Vl)(O),A0);const{up:w,direction:te}=D;return(0,_t.f)(w,A0,_),(0,_t.n)(w,w),(0,_t.m)(w,w,Gm),(0,_t.n)(te,_),(0,_t.o)(te,te),(0,_t.m)(te,te,Gm),D}function B1(_){const v=_[1];_[1]=-_[2],_[2]=v}function N1(_,v){const O=gO(v,_.heading,_.tilt);return _.up=O.up,_}function yO(_,v,O,D,w){let te,fe,Pe,Ue;const Xe=v.latitude,st=(0,Zi.Iu)(_.spatialReference).radius,vt=v.longitude,Ct=function WS(_,v,O){const D=v/O,w=(0,li.Vl)(_),te=Math.sin(D/2),fe=Math.cos(w),Pe=2*(0,li.Kt)(Math.sqrt(te*te/(fe*fe)));return(0,li.BV)(Pe)}(Xe,O,st)/2;te=vt-Ct,fe=vt+Ct;const Wt=(0,li.Vl)(Xe),Kt=(1+Math.sin(Wt))/(1-Math.sin(Wt)),Lt=(Kt+1)*Math.tan(D/st/2);function sr(yr){const br=Math.PI/2;return(yr=ga.c5.normalize(yr,-br))>br&&(yr=Math.PI-yr),yr}if(Pe=1.5*Math.PI-2*Math.atan(.5*(Lt+Math.sqrt(4*Kt+Lt*Lt))),Ue=Pe+D/st,Pe=sr(Pe),Ue=sr(Ue),Ue<Pe){const yr=Ue;Ue=Pe,Pe=yr}if(Pe=Math.max((0,li.BV)(Pe),-90),Ue=Math.min((0,li.BV)(Ue),90),fe=oI.monotonic(te,fe),fe-te>180){const yr=(fe-te-180)/2;te+=yr,fe-=yr}const Er=_.spatialReference&&_.spatialReference.isGeographic?_.spatialReference:Xn.Z.WGS84;return w?(w.xmin=te,w.ymin=Pe,w.xmax=fe,w.ymax=Ue,w.spatialReference=Er):w=new To.Z(te,Pe,fe,Ue,Er),_.spatialReference&&_.spatialReference.isWebMercator&&(0,sh.$)(w,!1,w),w}const dI=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:gO,directionToHeadingTilt:function aI(_,v,O,D){const w=A0,te=v_;return(0,_t.n)(w,_),(0,_t.f)(v_,w,_O),0===(0,_t.e)(v_,v_)&&(0,_t.f)(v_,w,mO),(0,_t.f)(te,v_,w),uO(v,O,D,w,te)},eyeForCenterWithHeadingTilt:function lI(_,v,O,D){const w={eye:(0,$t.c)(),up:null,tilt:D,heading:O},te=A0;te[0]=_[0],te[1]=_[2],te[2]=-_[1];const fe=v,Pe=(0,li.Vl)(O),Ue=(0,li.Vl)(D),Xe=Math.sin(Pe),st=Math.cos(Pe),vt=Math.sin(Ue),Ct=Math.cos(Ue),Wt=(0,_t.l)(te);let Kt;if(Math.abs(Ue)<1e-8)Kt=fe+Wt;else{const ws=Wt/vt,$i=(0,li.Kt)(fe/ws),qi=Math.PI-Ue-$i;Kt=ws*Math.sin(qi)}const Lt=Ct*fe,nr=fe*fe*(vt*vt),sr=st*st*nr,Er=Kt-Lt,yr=Er*Er,br=sr*(sr+yr-te[1]*te[1]);if(br<0)return(0,_t.g)(w.eye,te,Kt/Wt),w.tilt=0,w;const Rr=Math.sqrt(br),$r=te[1]*Er,si=sr+yr;let Ci;if(Ci=st>0?-Rr+$r:Rr+$r,Math.abs(si)<1e-8)return Wt<1e-8?(w.eye[0]=0,w.eye[1]=0,w.eye[2]=fe):(0,_t.g)(w.eye,te,Kt/Wt),w.tilt=0,B1(w.eye),N1(w,_);w.eye[1]=Ci/si;const Ti=Xe*Xe*nr,ki=vt*fe,Fi=st*ki*w.eye[1],Xi=w.eye[1]*w.eye[1],rs=1-Xi,Es=Math.sqrt(rs),Gs=sr*Xi+Ti-2*Fi*Es*Er+rs*yr;return Math.abs(Gs)<1e-8?((0,_t.g)(w.eye,te,Kt/Wt),w.tilt=0,B1(w.eye),N1(w,_)):(w.eye[0]=(rs*(Kt*te[0]-Lt*te[0])-ki*Es*(te[0]*w.eye[1]*st+te[2]*Xe))/Gs,w.eye[2]=(rs*(Kt*te[2]-Lt*te[2])-ki*Es*(te[2]*w.eye[1]*st-te[0]*Xe))/Gs,(0,_t.g)(w.eye,w.eye,Kt),B1(w.eye),N1(w,_))},lookAtTiltToEyeTilt:function cI(_,v,O){const D=(0,_t.l)(v),w=Math.sqrt(O*O+D*D-2*O*D*Math.cos(Math.PI-_)),te=(0,li.Kt)(O/(w/Math.sin(_)));return(0,li.BV)(_-te)},eyeTiltToLookAtTilt:function uI(_,v,O){const D=(0,li.Vl)(_),w=(0,_t.l)(v);return(0,li.Kt)(O/(w/Math.sin(D)))+D},toExtent:yO},Symbol.toStringTag,{value:"Module"}));var E_=T(53929),j1=T(86080);const vO=pn.Z.getLogger("esri.views.3d.support.cameraUtils"),TO=(0,$t.c)(),Zy=(0,$t.c)(),fI={heading:0,tilt:0},Ap=new vs.Z,_I=new ga.pE(-20037508.342788905,20037508.342788905),mI=new ga.pE(-180,180);var kl;function Hm(_){return _.spatialReference||Xn.Z.WGS84}function b_(_){return"global"===_.viewingMode?dI:nI}function Sp(_,v){if((0,lt.Wi)(v))return null;const O=_.renderSpatialReference,D=b_(_).headingTiltToDirectionUp,w=(0,$t.c)();if(!(0,ci.KC)(v.position,w,O))return null;const te=D(w,v.heading,v.tilt);(0,_t.g)(te.direction,te.direction,_.state.camera.distance),(0,_t.a)(te.direction,te.direction,w);const fe=Tf(_,w,te.direction,te.up);return fe.fov=(0,li.Vl)(v.fov),fe}!function(_){_[_.LOCKED=0]="LOCKED",_[_.ADJUST=1]="ADJUST"}(kl||(kl={}));const C_=(0,$t.c)();function T_(_,v,O){const D=_.renderSpatialReference,w=$y(_,v.eye,v.viewForward,v.up,fI);let te=Hm(_);return(0,ci.SH)(v.eye,D,C_,te)||(te=Xn.Z.WGS84,(0,ci.SH)(v.eye,D,C_,te)),(0,lt.Wi)(O)?new qo(new vs.Z(C_,te),w.heading,w.tilt,(0,li.BV)(v.fov)):(O.position.x=C_[0],O.position.y=C_[1],O.position.z=C_[2],O.position.spatialReference=te,O.heading=w.heading,O.tilt=w.tilt,O.fov=(0,li.BV)(v.fov),O)}function W1(_,v,O){const D=_.state.camera,w=D.width/2/D.pixelRatio;return _.renderCoordsHelper.viewingMode===Us.JY.Global&&null!=O&&(v*=Math.cos((0,li.Vl)(O))),w/(96*39.37/(v/=_.renderCoordsHelper.unitInMeters))/Math.tan(D.fovX/2)}function Sf(_,v,O){const D=_.state.camera,w=v*Math.tan(D.fovX/2);let fe=96*39.37/(D.width/2/D.pixelRatio/w);return _.renderCoordsHelper.viewingMode===Us.JY.Global&&(fe/=Math.cos((0,li.Vl)(O))),fe*=_.renderCoordsHelper.unitInMeters,fe}function MO(_,v,O,D,w,te){return OO(_,v,W1(_,O,v.latitude),D,w,te)}function OO(_,v,O,D,w,te){if(Rf(te)){const Pe=new M_(te.signal);return Km(_,D.heading,D.tilt,v,O,w,Pe),void Pe.resolver.promise.then(Ue=>{const Xe=Yy(_,Ue,D.fov);if(!(0,lt.Wi)(Xe))return te.resolver.resolve(Xe);te.resolver.reject()},Ue=>te.resolver.reject(Ue))}const fe=Km(_,D.heading,D.tilt,v,O,w);return Yy(_,fe,D.fov,te)}function $y(_,v,O,D,w){return b_(_).directionToHeadingTilt(v,O,D,w)}function V1(){return V1=(0,Ai.Z)(function*(_,v,O){if(!_.renderCoordsHelper.fromRenderCoords(v,Ap,_.spatialReference))return!1;const D=yield _.elevationProvider.queryElevation(Ap.x,Ap.y,Ap.z,Ap.spatialReference,"ground",O);return(0,lt.Pt)(D,0)>Ap.z-1}),V1.apply(this,arguments)}function z1(){return z1=(0,Ai.Z)(function*(_,v,O){const D=(0,$t.c)();if(v)if(v instanceof vs.Z){if((0,ci.KC)(v,D,_.renderSpatialReference),null==v.z&&null!=_.basemapTerrain){const w=yield _.elevationProvider.queryElevation(v.x,v.y,v.z,v.spatialReference,"ground",O);return(0,lt.pC)(w)&&_.renderCoordsHelper.setAltitude(D,w),D}}else(0,_t.c)(D,v);else(0,_t.c)(D,_.state.camera.center);return D}),z1.apply(this,arguments)}function Km(_,v,O,D,w,te,fe){const Pe=D&&D instanceof vs.Z?D:null;if(Rf(fe))return function EI(_,v,O){return z1.apply(this,arguments)}(_,D,fe.signal).then(Xe=>{G1(_,v,O,Pe,Xe,w,te,fe)},Xe=>fe.resolver.reject(Xe)),null;const Ue=function bI(_,v){const O=(0,$t.c)();if(v&&v instanceof vs.Z){if((0,ci.KC)(v,O,_.renderSpatialReference),null==v.z&&null!=_.basemapTerrain){const D=(0,E_.KO)(_.elevationProvider,v);(0,lt.pC)(D)&&_.renderCoordsHelper.setAltitude(O,D)}}else(0,_t.c)(O,v||_.state.camera.center);return O}(_,D);return G1(_,v,O,Pe,Ue,w,te,fe)}function G1(_,v,O,D,w,te,fe,Pe){if((0,lt.Wi)(D)&&(D=(0,ci.fA)(w,_.renderSpatialReference,Hm(_)),(0,lt.Wi)(D)))return null;te=Math.max(te,_.state.constraints.minimumPoiDistance);const Ue=function MI(_,v,O,D,w,te){let fe=0;return te===kl.ADJUST&&function TI(_,v,O){const D=_.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(O/D)/Math.LN2>8)return!0;const w=_.renderSpatialReference,te=Hm(_),fe=(0,ci.fA)(v,w,te),Pe=(0,ci.fA)(_.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,w,te);if((0,lt.Wi)(fe)||(0,lt.Wi)(Pe))return!1;const Ue=Math.tan(.5*_.state.camera.fov)*D;return Pe.distance(fe)/Ue>5}(_,D,w)?(v=0,fe=function OI(_,v,O,D){const w=_.state.constraints.tilt(v);w.max=Math.min(w.max,.5*Math.PI);const te=w.min*(1-.7)+.7*w.max,fe=H1(_,D,v,O);return Math.min(fe,te)}(_,w,O,D)):fe=H1(_,D,w,O),fe=_.state.constraints.clampTilt(w,fe),{heading:v,tilt:O=PO(_,D,w,fe)}}(_,v,O,w,te,fe),Xe=(0,b_(_).eyeForCenterWithHeadingTilt)(w,te,Ue.heading,Ue.tilt);if(fe===kl.ADJUST&&"global"===_.viewingMode&&O>0){const vt=()=>{const Wt=PO(_,w,te,function PI(_,v,O,D){const w=_.state.constraints.tilt(v);let te=H1(_,D,v,O);return te=Math.min(te,.5*Math.PI),w.min*(1-ky)+te*ky}(_,te,O,w));return G1(_,v,Wt,D,w,te,fe=O-Wt<1?kl.LOCKED:kl.ADJUST,Pe)},Ct=_.map.ground.navigationConstraint;if(!Ct||"stay-above"===Ct.type){if(function yI(_,v){return!!(_.basemapTerrain&&_.renderCoordsHelper.fromRenderCoords(v,Ap,_.spatialReference)&&(0,lt.Pt)((0,E_.KO)(_.elevationProvider,Ap),0)>Ap.z-1)}(_,Xe.eye))return vt();if(Rf(Pe))return function vI(_,v,O){return V1.apply(this,arguments)}(_,Xe.eye,Pe.signal).then(Wt=>Wt?vt():(Pe.resolver.resolve({eye:Xe.eye,up:Xe.up,center:(0,$t.a)(w),heading:Xe.heading,tilt:Xe.tilt}),null)),null}}const st=!Pe||Rf(Pe)?{center:(0,$t.c)(),eye:(0,$t.c)(),up:(0,$t.c)(),tilt:0,heading:0}:Pe;return st.eye=Xe.eye,st.up=Xe.up,st.center=(0,$t.a)(w),st.heading=Xe.heading,st.tilt=Xe.tilt,Rf(Pe)&&Pe.resolver.resolve(st),st}function Zm(_,v,O,D,w,te=null){const fe=null!=v.zmax&&null!=v.zmin;let Pe,Ue,Xe;if(_.state.isGlobal){if(!(0,j1.D)(v.spatialReference,Us.JY.Global))return Rf(te)&&te.resolver.reject(),null;const sr=new vs.Z(v.xmin,v.ymin,v.spatialReference),Er=new vs.Z(v.xmax,v.ymax,v.spatialReference),yr=v.spatialReference.isGeographic?mI:_I;Pe=new vs.Z({x:yr.center(sr.x,Er.x),y:(Er.y+sr.y)/2,z:fe?(v.zmax+v.zmin)/2:null,spatialReference:v.spatialReference});const br=(0,Zi.Iu)(v.spatialReference),Rr=function FS(_,v,O){const D=v.spatialReference,w=(0,Zi.Iu)(D),te=new vs.Z(v.x,_.y,D),fe=new vs.Z(O.x,_.y,D),Pe=new vs.Z(_.x,v.y,D),Ue=new vs.Z(_.x,O.y,D);return{lon:lM(w.radius,te,fe),lat:lM(w.radius,Pe,Ue)}}(Pe,sr,Er);Ue=Rr.lon,Xe=Rr.lat,yr.diff(sr.x,Er.x)>yr.range/2&&(Ue+=br.halfCircumference),Ue=Math.min(Ue,br.halfCircumference),Xe=Math.min(Xe,br.halfCircumference)}else{const sr=(0,lt.Pt)(_.renderSpatialReference,v.spatialReference);sr.equals(v.spatialReference)||(v=(0,ci.iV)(v,sr)),Ue=v.xmax-v.xmin,Xe=v.ymax-v.ymin,Pe=new vs.Z({x:v.xmin+.5*Ue,y:v.ymin+.5*Xe,z:fe?(v.zmax+v.zmin)/2:null,spatialReference:sr})}const st=fe?v.zmax-v.zmin:0,vt=_.state.camera,Ct=1/Math.tan(vt.fovX/2),Wt=1/Math.tan(vt.fovY/2),Kt=1/Math.tan(vt.fov/2),Lt=Math.max(.5*Ue*Ct,.5*Xe*Wt,.5*st*Kt)/1;if(Rf(te)){const sr=new M_(te.signal);return Km(_,O,D,Pe,Lt,w,sr),void sr.resolver.promise.then(Er=>{const yr=Yy(_,Er,_.camera.fov);if(!(0,lt.Wi)(yr))return te.resolver.resolve(yr);te.resolver.reject()},Er=>te.resolver.reject(Er))}const nr=Km(_,O,D,Pe,Lt,w);return Yy(_,nr,_.camera.fov,te)}const ky=.7;function PO(_,v,O,D){return b_(_).lookAtTiltToEyeTilt(D,v,O)}function H1(_,v,O,D){return b_(_).eyeTiltToLookAtTilt(D,v,O)}function Yy(_,v,O,D){if((0,lt.Wi)(v))return null;const te=(0,ci.fA)(v.eye,_.renderSpatialReference,Hm(_));return(0,lt.Wi)(te)?null:(0,lt.pC)(D)?(D.position=te,D.heading=v.heading,D.tilt=v.tilt,D.fov=O,D):new qo(te,v.heading,v.tilt,O)}function xO(_,v){var D;const O=null==(D=_.basemapTerrain)?void 0:D.tilingScheme;if(O)return O.levelAtScale(v);vO.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function DO(_,v){var D;const O=null==(D=_.basemapTerrain)?void 0:D.tilingScheme;if(O)return O.scaleAtLevel(v);vO.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function AO(_,v,O){const D=_.renderSpatialReference;let w,te;v||(v=_.state.camera);const fe=Xn.Z.WGS84;return v instanceof qo?(w=v.position.latitude,(0,ci.KC)(v.position,TO,D),(0,ci.KC)(O,Zy,D),te=(0,_t.i)(TO,Zy)):((0,ci.SH)(v.center,D,Zy,fe),w=Zy[1],te=v.distance),Sf(_,te,w)}class M_{constructor(v){this.signal=v,this.resolver=(0,zi.hh)()}}function Rf(_){return _&&"resolver"in _}function nh(_){let v=_*_;return _<0&&(v*=-1),v}function SO(_,v,O){const D=O,w=_.state,te=_.device,fe="forward-down"===v.tiltDirection?1:-1;return"standard"===te.deviceType?(D.translation[0]=nh(w.axes[0]),D.translation[1]=nh(w.axes[1]),D.translation[2]=nh(w.buttons[7])-nh(w.buttons[6]),D.heading=nh(w.axes[2]),D.tilt=nh(w.axes[3])):"spacemouse"===te.deviceType&&(D.translation[0]=1.2*nh(w.axes[0]),D.translation[1]=1.2*nh(w.axes[1]),D.translation[2]=2*-nh(w.axes[2]),D.heading=1.2*nh(w.axes[5]),D.tilt=1.2*nh(w.axes[3])),D.tilt*=fe,(0,_t.g)(D.translation,D.translation,1),D}function RO(_,v){const O=v;return O.translation[0]=_[1]-_[0],O.translation[1]=_[3]-_[2],O.translation[2]=_[4]-_[5],O.heading=_[7]-_[6],O.tilt=_[8]-_[9],O.zoom=_[10]-_[11],O}function K1(_){return 0===_.translation[0]&&0===_.translation[1]&&0===_.translation[2]&&0===_.heading&&0===_.tilt&&0===_.zoom}let S0=class extends D0{constructor(_){super(_),this.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this.tmpCamera=new $n.V,this.constraintOptions={selection:wo.ALL,interactionType:bn.NONE,interactionStartCamera:new $n.V,interactionFactor:0,interactionDirection:null,tiltMode:ml.LOOK_AROUND}}handleEventGamepad(_){const v=SO(_,this.view.navigation.gamepad,this.transformation);("end"===_.action||K1(v))&&this.finishController()}activateDirection(_){this.keysButtonState[_]=1,RO(this.keysButtonState,this.transformation)}deactivateDirection(_){this.keysButtonState[_]=0,K1(RO(this.keysButtonState,this.transformation))&&this.finishController()}onControllerStart(_){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this.headingStart=this.view.camera.heading,super.onControllerStart(_)}_updateFilteredSurfaceElevation(_){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*_}stepController(_,v){this._updateStartHeading(),this._updateFilteredSurfaceElevation(_),this.currentCamera.copyViewFrom(v),this._updateCameraCenter(),this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera),this._calculateControlTransformation(_,this.currentCamera,wf),this._applyDisabledMovementTypes(wf),this._applyPan(wf.pan),this._applyRotate(wf.rotate),this._applyZoom(wf.zoom),this._applyAscend(wf.ascend),this.constraintOptions.interactionType=bn.NONE,this.constraintOptions.selection=wo.COLLISION,va(this.view,this.currentCamera,this.constraintOptions),super.stepController(_,v)}_updateStartHeading(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)}_applyRotate(_){if(!_.enabled)return;const v=this.currentCamera;(0,_t.b)(kc,v.center,v.eye),(0,_t.m)(kc,kc,_.matrix),v.center=(0,_t.a)(kc,kc,v.eye),v.up=(0,_t.m)(kc,v.up,_.matrix),this.constraintOptions.interactionType=bn.LOOK_AROUND,this.constraintOptions.selection=wo.ALL_EXCEPT_COLLISION,va(this.view,v,this.constraintOptions)}_applyPan(_,v=this.currentCamera){!_.enabled||(v.eye=(0,_t.m)(kc,v.eye,_.matrix),v.center=(0,_t.m)(kc,v.center,_.matrix),this.view.state.isGlobal&&(v.up=(0,_t.m)(kc,v.up,_.matrix)),this.constraintOptions.interactionType=bn.PAN,this.constraintOptions.selection=wo.ALL,va(this.view,v,this.constraintOptions))}_applyZoom(_){if(!_)return;const v=this.currentCamera.viewForward;this.currentCamera.eye=(0,_t.a)(kc,this.currentCamera.eye,(0,_t.g)(Oo.WM.get(),v,_)),(0,_t.c)($m,v),(0,_t.o)($m,$m),this.constraintOptions.interactionDirection=$m,this.constraintOptions.interactionType=bn.ZOOM,this.constraintOptions.selection=wo.ALL_EXCEPT_COLLISION,va(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_applyAscend(_){if(!_)return;const v=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,Oo.WM.get());if(this.constraintOptions.interactionDirection=(0,_t.c)($m,v),this.view.state.isGlobal){const O=(0,_t.l)(this.currentCamera.eye),D=(O+_)/O;this.currentCamera.eye=(0,_t.g)(kc,this.currentCamera.eye,D),this.currentCamera.center=(0,_t.g)(kc,this.currentCamera.center,D)}else{const O=(0,_t.g)(Oo.WM.get(),v,_);this.currentCamera.eye=(0,_t.a)(kc,this.currentCamera.eye,O),this.currentCamera.center=(0,_t.a)(kc,this.currentCamera.center,O)}this._updateCameraCenter(),this.constraintOptions.interactionType=bn.ASCEND,this.constraintOptions.selection=wo.COLLISION,va(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter(),this.constraintOptions.selection=wo.ALL_EXCEPT_COLLISION,va(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null}_calculateControlTransformation(_,v,O){!function LI(_){_.zoom=0,_.ascend=0,_.pan.enabled=!1,(0,js.i)(_.pan.matrix),_.rotate.enabled=!1,(0,js.i)(_.rotate.matrix)}(O);const D=this._computeVelocities(_);this.view.state.isLocal?this._calculateControlTransformationLocal(D,v,O):this._calculateControlTransformationGlobal(D,v,O)}_updateCameraCenter(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,kc)}_calculateControlTransformationLocal(_,v,O){const{viewRight:D,viewForward:w}=v,te=this.transformation,fe=this.view.navigation.gamepad,Pe=(0,_t.s)(Oo.WM.get(),w[0],w[1],0);(0,_t.n)(Pe,Pe);const Ue=te.translation[0]*_.pan;if(0!==Ue){const Kt=(0,_t.g)(Oo.WM.get(),D,Ue);(0,js.j)(O.pan.matrix,O.pan.matrix,Kt),O.pan.enabled=!0}switch(fe.mode){case"pan":{const Kt=-te.translation[1]*_.pan;if(0!==Kt){const Lt=(0,_t.g)(Oo.WM.get(),Pe,Kt);(0,js.j)(O.pan.matrix,O.pan.matrix,Lt),O.pan.enabled=!0}O.zoom=te.zoom*_.zoom;break}case"zoom":O.zoom=(-te.translation[1]+te.zoom)*_.zoom;break;default:(0,Fl.Bg)(fe.mode)}O.ascend=te.translation[2]*_.ascend;const st=-te.heading*_.rotate;0!==st&&((0,js.e)(O.rotate.matrix,O.rotate.matrix,st,this.view.renderCoordsHelper.worldUpAtPosition(v.eye,Oo.WM.get())),O.rotate.enabled=!0);const vt=te.tilt*_.rotate,Ct=C0(this.view.renderCoordsHelper,v.center,v.eye),Wt=(0,li.uZ)(Ct+vt,jo.min,jo.max)-Ct;Wt&&((0,js.e)(O.rotate.matrix,O.rotate.matrix,Wt,D),O.rotate.enabled=!0)}_calculateControlTransformationGlobal(_,v,O){const{eye:D,viewRight:w}=v,te=this.transformation,fe=this.view.navigation.gamepad,Pe=(0,_t.f)(Oo.WM.get(),w,D);(0,_t.n)(Pe,Pe),(0,_t.o)(Pe,Pe),function Bw(_,v,O,D,w,te,fe,Pe,Ue){D1(_.center,(0,_t.e)(_.up,_.center),(0,_t.l)(_.center),-ga.Q4.normalize((0,li.Vl)(te)),fe,v)?function Lw(_,v,O,D,w,te){const{eye:fe}=_;(0,$s.Tz)([0,0,1],fe,Pp,x0,rO);const Pe=v.translation[0]*O.pan,Ue="zoom"===w.mode?0:v.translation[1]*O.pan,Xe=Math.max(Math.sqrt(Math.abs(1-(0,_t.e)(_.center,Pp)**2/(0,_t.l)(_.center)**2)),.5),st=(Math.sin(te)*Ue+Math.cos(te)*Pe)/Xe,vt=-Math.cos(te)*Ue+Math.sin(te)*Pe;switch((0,js.e)(D.pan.matrix,D.pan.matrix,st,Pp),D.pan.enabled=!0,w.mode){case"pan":(0,js.e)(D.pan.matrix,D.pan.matrix,vt,x0),D.pan.enabled=!0;break;case"zoom":D.zoom=-v.translation[1]*O.zoom}}(v,O,D,Pe,Ue,-ga.Q4.normalize((0,li.Vl)(w))):function Uw(_,v,O,D,w){const{eye:te,viewRight:fe}=_,Pe=(0,_t.f)(Oo.WM.get(),fe,te),Ue=v.translation[0]*O.pan;switch(0!==Ue&&((0,js.e)(D.pan.matrix,D.pan.matrix,-Ue,Pe),D.pan.enabled=!0),w.mode){case"pan":{const Xe=v.translation[1]*O.pan;0!==Xe&&((0,js.e)(D.pan.matrix,D.pan.matrix,Xe,fe),D.pan.enabled=!0);break}case"zoom":D.zoom=-v.translation[1]*O.zoom}}(v,O,D,Pe,Ue)}(this.startCamera,v,te,_,this.view.camera.heading,this.headingStart,this.view.camera.tilt,O,fe),this.tmpCamera.copyFrom(this.currentCamera),this._applyPan(wf.pan,this.tmpCamera);const Ue=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;O.ascend=te.translation[2]*_.ascend;const st=-te.heading*_.rotate;0!==st&&((0,js.e)(O.rotate.matrix,O.rotate.matrix,st,this.tmpCamera.eye),O.rotate.enabled=!0);const Ct=this._clampTiltDeltaGlobalToValidRange(te.tilt*_.rotate,v.ray,Ue);0!==Ct&&((0,js.e)(O.rotate.matrix,O.rotate.matrix,Ct,this.tmpCamera.viewRight),O.rotate.enabled=!0),O.zoom+=te.zoom*_.zoom}_clampTiltDeltaGlobalToValidRange(_,v,O){const D=(0,Zi.Iu)(this.view.spatialReference),w=Py(jo.min,v.origin,O,D);let te=0,fe=0;const Pe=Oo.WM.get();return this.view.renderCoordsHelper.intersectManifold(v,O,Pe)?(te=Py(C0(this.view.renderCoordsHelper,Pe,v.origin),v.origin,O,D),fe=Py(jo.max,v.origin,O,D)):((0,aa.j)((0,aa.k)(aa.t,O+D.radius),v,Pe),te=GM((0,li.ZF)(-(0,_t.e)(v.direction,(0,_t.n)(Pe,Pe))),v.origin,O,D),fe=GM(jo.max,v.origin,O,D)),(0,li.uZ)(te+_,w,fe)-te}_getPointAbsoluteSurfaceElevation(_,v,O){const{renderCoordsHelper:D}=this.view,w=D.getAltitude(_),te=v+Math.abs(w-v);return D.setAltitude(O,te,_),te}_clampedDistanceToSurface(_,v){const{renderCoordsHelper:O}=this.view,{camera:D}=this.view.state,{direction:w}=function gI(_,v,O,D,w){return b_(_).headingTiltToDirectionUp(v,O,D,w)}(this.view,v,0,wO,II),te=O.intersectManifoldClosestSilhouette((0,Yu.re)(v,w),_,Oo.WM.get()),fe=(0,_t.i)(v,te),Pe=O.intersectManifoldClosestSilhouette((0,Yu.re)(v,(0,_t.r)(Oo.WM.get(),v,D.center)),_,Oo.WM.get()),Ue=(0,_t.i)(v,Pe);return Math.min(fe,Ue)}_computeHeadingRotateRadius(_){const{renderCoordsHelper:v,state:O}=this.view,{camera:D,isGlobal:w}=O,te=v.intersectManifoldClosestSilhouette(D.ray,this.filteredSurfaceElevation,Oo.WM.get());if(w){const fe=(0,_t.b)(Oo.WM.get(),_,te),Pe=(0,_t.l)(fe);(0,_t.g)(fe,fe,1/Pe);const Ue=(0,_t.n)(Oo.WM.get(),_),Xe=(0,li.ZF)((0,_t.e)(Ue,fe));return Pe*Math.sin(Math.min(AI,Xe))}{const fe=(0,_t.c)(Oo.WM.get(),_);return v.setAltitude(fe,this.filteredSurfaceElevation),(0,_t.i)(te,fe)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:SI}_computeVelocities(_){const v=this.filteredSurfaceElevation,O=v+(0,Zi.Iu)(this.view.spatialReference).radius,{camera:D,isGlobal:w}=this.view.state,te=Oo.WM.get(),fe=this._getPointAbsoluteSurfaceElevation(D.eye,v,te),Pe=this._clampedDistanceToSurface(v,te),Ue=D.width/2,Xe=IO*D.width,st=IO*D.width,vt=Pe*Math.tan(.5*D.fovX)/Ue,Ct=vt/O,Wt=vt/this._computeHeadingRotateRadius(te),Kt=fe-v;return{pan:(w?Ct:vt)*Xe*_,ascend:Math.max(this._minimumAscendVelocity()*_,2**(Xe*_/Ue)*Kt-Kt),zoom:2**(Xe*_/Ue)*Pe-Pe,rotate:(0,li.uZ)(Wt*st,RI,wI)*_}}_applyDisabledMovementTypes(_){!(0,lt.pC)(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(_.zoom=this.disableMovements.zoom?0:_.zoom,_.ascend=this.disableMovements.ascend?0:_.ascend,_.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&(0,js.i)(_.pan.matrix),_.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&(0,js.i)(_.rotate.matrix))}static activatesFor(_,v){const O=SO(v,_.navigation.gamepad,DI);return!("end"===v.action||K1(O))}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],S0.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],S0.prototype,"gamepadDevice",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],S0.prototype,"disableMovements",void 0),S0=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.GamepadKeyboardController")],S0);const DI={translation:[0,0,0],heading:0,tilt:0,zoom:0},wO=80,AI=(0,li.Vl)(wO),IO=.75,SI=5,RI=(0,li.Vl)(30),wI=(0,li.Vl)(80),wf={zoom:0,ascend:0,pan:{enabled:!1,matrix:(0,Zn.c)()},rotate:{enabled:!1,matrix:(0,Zn.c)()}},kc=(0,$t.c)(),$m=(0,$t.c)(),II=U1();class UI extends xc.a{constructor(v){super(!0),this.view=v,this.watchHandles=new cn.Z,this.handle=this.registerIncoming("gamepad",O=>this._handleEventGamepad(O)),this.handle.pause()}onInstall(v){super.onInstall(v),this.watchHandles.add([(0,pt.YP)(()=>this.view.navigation.gamepad.enabled,O=>{O?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))},pt.nn),(0,pt.YP)(()=>this.view.navigation.gamepad.device,O=>{this.cameraControllerGamepad&&O&&this.cameraControllerGamepad.gamepadDevice!==O&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])}onUninstall(){this.watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(v){const O=this.view.navigation.gamepad.device;if(O&&v.data.device!==O)return;const D=this.cameraControllerGamepad&&this.cameraControllerGamepad.active;if(D||S0.activatesFor(this.view,v.data)){if(!D){const w=new S0({view:this.view,gamepadDevice:v.data.device});this.view.state.switchCameraController(w)&&(this.cameraControllerGamepad=w)}this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===v.data.device&&this.cameraControllerGamepad.handleEventGamepad(v.data)}}}var Mu;!function(_){_[_.LEFT=0]="LEFT",_[_.RIGHT=1]="RIGHT",_[_.FORWARD=2]="FORWARD",_[_.BACKWARD=3]="BACKWARD",_[_.UP=4]="UP",_[_.DOWN=5]="DOWN",_[_.HEADINGLEFT=6]="HEADINGLEFT",_[_.HEADINGRIGHT=7]="HEADINGRIGHT",_[_.TILTUP=8]="TILTUP",_[_.TILTDOWN=9]="TILTDOWN",_[_.ZOOMIN=10]="ZOOMIN",_[_.ZOOMOUT=11]="ZOOMOUT"}(Mu||(Mu={}));class BI extends xc.a{constructor(v,O){super(!0),this.view=v,this.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:Us.JY.Local},this.keyToNumber={[O.left]:Mu.LEFT,[O.right]:Mu.RIGHT,[O.forward]:Mu.FORWARD,[O.backward]:Mu.BACKWARD,[O.up]:Mu.UP,[O.down]:Mu.DOWN,[O.headingLeft]:Mu.HEADINGLEFT,[O.headingRight]:Mu.HEADINGRIGHT,[O.tiltUp]:Mu.TILTUP,[O.tiltDown]:Mu.TILTDOWN,[O.zoomIn]:Mu.ZOOMIN,[O.zoomOut]:Mu.ZOOMOUT},this.registerIncoming("key-down",null,D=>this._handleKeyDown(D)),this.registerIncoming("key-up",null,D=>this._handleKeyUp(D)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(v){if(v.data.native.ctrlKey||v.data.native.metaKey)return;const O=this.keyToNumber[v.data.key];null!=O&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new S0({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(O),v.stopPropagation()))}_handleBlur(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)}_handleKeyUp(v){if(v.data.native.ctrlKey||v.data.native.metaKey)return;const O=this.keyToNumber[v.data.key];null!=O&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(O),v.stopPropagation())}}class NI extends xc.a{constructor(v,O){super(!0),this.view=v,this.registerIncoming("mouse-wheel",O,D=>this._handleMouseWheel(D))}_handleMouseWheel(v){if(!this.view.navigation.mouseWheelZoomEnabled)return;const O=v.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new Ny({view:this.view,mode:"interaction"}):new Wy({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController)),this.cameraController.zoomStep(-1/60*O.deltaY,(0,dr.s1)(O.x,O.y)),v.preventDefault(),v.stopPropagation()}}class Jy{constructor(v){this._gain=v}reset(v){this._value=v}set gain(v){this._gain=v}get value(){return void 0===this._value?0:this._value}update(v){this._value=void 0===this._value?v:this._gain*v+(1-this._gain)*this._value}}let R0=class extends jm{constructor(_){super(_),this.view=null,this.beginCamera=new $n.V,this.elapsedTimeSec=0,this.constraintOptions={selection:wo.ALL,interactionType:bn.PAN,interactionFactor:0,interactionStartCamera:new $n.V,interactionDirection:null,tiltMode:ml.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new Ol}get steppingFinished(){return this.momentum.isFinished(this.elapsedTimeSec)}onControllerStart(_){this.beginCamera.copyFrom(_),this.constraintOptions.interactionStartCamera=this.beginCamera,super.onControllerStart(_)}stepController(_,v){v.copyViewFrom(this.beginCamera),this.elapsedTimeSec+=_,this.momentumStep(this.elapsedTimeSec,v),va(this.view,v,this.constraintOptions)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],R0.prototype,"view",void 0),R0=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.momentum.MomentumController")],R0);let km=class extends R0{constructor(_){super(_),this.interactionType=bn.PAN,this.tmpPan=(0,$t.c)()}momentumStep(_,v){const O=this.momentum.value(_);(0,_t.g)(this.tmpPan,this.momentum.direction,O),v.eye=(0,_t.b)(LO,v.eye,this.tmpPan),v.center=(0,_t.b)(LO,v.center,this.tmpPan),this.constraintOptions.interactionDirection=this.tmpPan}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],km.prototype,"momentum",void 0),km=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],km);const LO=(0,$t.c)(),jI=(0,$t.c)(),Xy=(0,$t.c)();let Qy=class extends R0{constructor(_){super(_),this.interactionType=bn.PAN}momentumStep(_,v){const O=this.momentum.value1(_),D=this.momentum.value2(_);(0,_t.c)(Xy,v.eye),(0,_t.n)(Xy,Xy),(0,_t.f)(this.momentum.axis2,Xy,this.momentum.axis1),qM(v,jI,this.momentum.axis1,O,this.momentum.axis2,D)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Qy.prototype,"momentum",void 0),Qy=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],Qy);let If=class extends R0{constructor(_){super(_),this.interactionType=bn.TUMBLE}set center(_){this._set("center",(0,$t.a)(_))}set axis(_){this._set("axis",(0,$t.a)(_))}momentumStep(_,v){const O=this.momentum.value(_);P0(v,this.center,Pm(this.axis,O))}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],If.prototype,"momentum",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],If.prototype,"center",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],If.prototype,"axis",null),If=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.momentum.MomentumController")],If);let O_=class extends R0{constructor(_){super(_),this.interactionType=bn.ZOOM,this.constraintOptions.interactionDirection=(0,$t.c)()}set zoomCenter(_){this._set("zoomCenter",(0,$t.a)(_))}momentumStep(_,v){(0,_t.c)(this.constraintOptions.interactionDirection,v.eye);const O=this.momentum.valueDelta(0,_);P1(v,this.zoomCenter,O,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionDirection=(0,_t.r)(this.constraintOptions.interactionDirection,v.eye,this.constraintOptions.interactionDirection)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],O_.prototype,"momentum",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],O_.prototype,"zoomCenter",null),O_=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],O_);let Lf=class extends R0{constructor(_){super(_),this.interactionType=bn.ZOOM,this.radius=0,this.tmpSceneCenter=(0,$t.c)(),this.tmpZoomAxisAngle=Cp(),this.sphere=(0,aa.c)()}set screenCenter(_){this._set("screenCenter",(0,dr.s1)(_[0],_[1]))}set sceneCenter(_){this._set("sceneCenter",(0,$t.a)(_))}initialize(){this.sphere[3]=this.radius}momentumStep(_,v){const O=this.momentum.valueDelta(0,_);VM(this.sphere,v,O),this.constraintOptions.interactionType=bn.ZOOM,va(this.view,v,this.constraintOptions),Wm(this.sphere,v,this.screenCenter,this.tmpSceneCenter),xm(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle),P0(v,this.sphere,this.tmpZoomAxisAngle),this.constraintOptions.interactionType=bn.PAN}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Lf.prototype,"momentum",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Lf.prototype,"screenCenter",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Lf.prototype,"sceneCenter",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Lf.prototype,"radius",void 0),Lf=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],Lf);class oh{constructor(v){this.gain=v}update(v){if(this.hasLastValue){const O=this.computeDelta(v);this._updateDelta(O)}this.lastValue=v}reset(){this.lastValue=void 0,this.filteredDelta=void 0}get hasLastValue(){return void 0!==this.lastValue}get hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(v){return v-this.lastValue}_updateDelta(v){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*v:v}}class qy{constructor(v,O,D){this._initialVelocity=v,this._stopVelocity=O,this._friction=D,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(v){return v>this.duration}get friction(){return this._friction}value(v){return this.valueFromInitialVelocity(this._initialVelocity,v)}valueDelta(v,O){const D=this.value(v);return this.value(v+O)-D}valueFromInitialVelocity(v,O){O=Math.min(O,this.duration);const D=1-this.friction;return v*(D**O-1)/Math.log(D)}}class FI extends qy{constructor(v,O,D,w,te){super(v,O,D),this.sceneVelocity=w,this.direction=te}value(v){return super.valueFromInitialVelocity(this.sceneVelocity,v)}}class UO{constructor(v=300,O=12,D=.84){this.minimumInitialVelocity=v,this.stopVelocity=O,this.friction=D,this.enabled=!0,this.time=new oh(.6),this.screen=[new oh(.4),new oh(.4)],this.scene=[new oh(.6),new oh(.6),new oh(.6)],this.tmpDirection=(0,$t.c)()}add(v,O,D){if(this.enabled){if(this.time.hasLastValue&&this.time.computeDelta(D)<.015)return;this.screen[0].update(v[0]),this.screen[1].update(v[1]),this.scene[0].update(O[0]),this.scene[1].update(O[1]),this.scene[2].update(O[2]),this.time.update(D)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.scene[0].reset(),this.scene[1].reset(),this.scene[2].reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const v=this.screen[0].filteredDelta,O=this.screen[1].filteredDelta,D=Math.sqrt(v*v+O*O)/this.time.filteredDelta;return Math.abs(D)<this.minimumInitialVelocity?null:this.createMomentum(D,this.stopVelocity,this.friction)}createMomentum(v,O,D){(0,_t.s)(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const w=(0,_t.l)(this.tmpDirection);return w>0&&(0,_t.g)(this.tmpDirection,this.tmpDirection,1/w),new FI(v,O,D,w/this.time.filteredDelta,this.tmpDirection)}}class BO{constructor(v){this.gain=v}update(v){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*v:v}reset(){this.filteredValue=void 0}get hasFilteredValue(){return void 0!==this.filteredValue}}class WI extends qy{constructor(v,O,D,w,te,fe=0,Pe){super(v,O,D),this.angularVelocity1=w,this.axis1=te,this.angularVelocity2=fe,this.axis2=Pe}value1(v){return super.valueFromInitialVelocity(this.angularVelocity1,v)}value2(v){return super.valueFromInitialVelocity(this.angularVelocity2,v)}}class VI{constructor(v=300,O=12,D=.84){this.minimumInitialVelocity=v,this.stopVelocity=O,this.friction=D,this.enabled=!0,this.tmpAxis1=(0,$t.c)(),this.tmpAxis2=(0,$t.c)(),this.tmpAngles=(0,Li.a)(),this.time=new oh(.3),this.screen=[new oh(.4),new oh(.4)],this.angle1=new BO(.6),this.angle2=new BO(.6),this.axis1=(0,$t.c)(),this.axis2=(0,$t.c)(),this.lastScene=(0,$t.c)()}addMomentumDirectRotation(v,O,D,w,te,fe){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(D)<.01)return;let Pe=YM(this.lastScene,O,this.tmpAxis2,w,te,fe);this.angle2.update(0),(0,_t.p)(this.tmpAxis2)<1e-5?Pe=0:(0,_t.n)(this.axis1,this.tmpAxis2),this.angle1.update(Pe),(0,_t.c)(this.lastScene,O)}this.screen[0].update(v[0]),this.screen[1].update(v[1]),this.time.update(D)}}addMomentumPreserveHeading(v,O,D,w,te,fe,Pe){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(D)<.01)return;QM(this.lastScene,O,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,w,te,fe,Pe,!1),(0,_t.p)(this.tmpAxis2)<1e-5?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),(0,_t.n)(this.axis1,this.tmpAxis1),(0,_t.n)(this.axis2,this.tmpAxis2)),(0,_t.c)(this.lastScene,O)}this.screen[0].update(v[0]),this.screen[1].update(v[1]),this.time.update(D)}}reset(){this.screen[0].reset(),this.screen[1].reset(),this.angle1.reset(),this.angle2.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;const v=this.screen[0].filteredDelta,O=this.screen[1].filteredDelta,D=Math.sqrt(v*v+O*O)/this.time.filteredDelta;return Math.abs(D)<this.minimumInitialVelocity?null:this.createMomentum(D,this.stopVelocity,this.friction)}createMomentum(v,O,D){return new WI(v,O,D,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)}}class jO{constructor(v=2.5,O=.01,D=.95,w=12){this.minimumInitialVelocity=v,this.stopVelocity=O,this.friction=D,this.maxVelocity=w,this.enabled=!0,this.value=new oh(.8),this.time=new oh(.3)}add(v,O){if(this.enabled){if(this.time.hasLastValue){if(this.time.computeDelta(O)<.01)return;if(this.value.hasFilteredDelta){const D=this.value.computeDelta(v);this.value.filteredDelta*D<0&&this.value.reset()}}this.time.update(O),this.value.update(v)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let v=this.value.filteredDelta/this.time.filteredDelta;return v=(0,li.uZ)(v,-this.maxVelocity,this.maxVelocity),Math.abs(v)<this.minimumInitialVelocity?null:this.createMomentum(v,this.stopVelocity,this.friction)}createMomentum(v,O,D){return new qy(v,O,D)}}class FO extends jO{constructor(v=3,O=.01,D=.95,w=12){super(v,O,D,w)}add(v,O){if(this.value.hasLastValue){const D=this.value.lastValue;let w=v-D;for(;w>Math.PI;)w-=2*Math.PI;for(;w<-Math.PI;)w+=2*Math.PI;v=D+w}super.add(v,O)}}class zI extends qy{constructor(v,O,D){super(v,O,D)}value(v){const O=super.value(v);return Math.exp(O)}valueDelta(v,O){const D=super.value(v),w=super.value(v+O)-D;return Math.exp(w)}}class WO extends jO{constructor(v=2.5,O=.01,D=.95,w=12){super(v,O,D,w)}add(v,O){super.add(Math.log(v),O)}createMomentum(v,O,D){return new zI(v,O,D)}}let ev=class extends D0{constructor(_){super(_),this.view=null,this.smoothRotation=new Jy(.05),this.rotationAxis=(0,$t.c)(),this.panningPlane=(0,Io.Ue)(),this.smoothScaling=new Jy(.05),this.zoomCenterScreen=(0,dr.s1)(),this.zoomMomentumEstimator=new WO,this.rotationMomentumEstimator=new FO,this.panSphericalMomentumEstimator=new VI,this.panPlanarMomentumEstimator=new UO,this.adjustedSphere=(0,aa.c)(),this.tmp3d=(0,$t.c)(),this.tmpScreenPointArray=(0,dr.s1)(),this.beginScreenPoint=(0,dr.s1)(),this.beginScenePoint=(0,$t.c)(),this.screenPickPoint=(0,dr.s1)(),this.navMode=Al.Horizontal,this.tmpInteractionDirection=(0,$t.c)(),this.constraintOptions={selection:wo.ALL,interactionType:bn.NONE,interactionFactor:0,interactionStartCamera:new $n.V,interactionDirection:null,tiltMode:ml.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(_){if(!this.active)return;const v=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=v,this.rotationMomentumEstimator.enabled=v,this.panPlanarMomentumEstimator.enabled=v,this.panSphericalMomentumEstimator.enabled=v,this.beginHeading=-ga.Q4.normalize((0,li.Vl)(this.view.camera.heading)),this.beginRadius=_.radius,this.pointerCount=_.pointers.size,this.beginAngle=_.angle,this.smoothRotation.reset(),(0,dr.md)(_.center,this.screenPickPoint),(0,Oi.c)(this.beginScreenPoint,this.screenPickPoint);const O=(0,Zi.Iu)(this.view.spatialReference),D=ZM(this.intersectionHelper,this.startCamera,this.screenPickPoint,O,__.Silhouette);this.scenePickPoint=D.scenePickPoint,this.sphere=D.sphere,(0,_t.c)(this.beginScenePoint,this.scenePickPoint),this.navMode=xy(this.startCamera,this.screenPickPoint,D.hasGeometryIntersection,O),this.navMode===Al.Vertical&&this._preparePlanarPanMode(_),this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}_preparePlanarPanMode(_){const v=(0,_t.o)(this.tmp3d,this.startCamera.viewForward);(0,Io.Yq)(this.scenePickPoint,v,this.panningPlane);const O=(0,dr.s1)(this.screenPickPoint[0],0),D=(0,$t.c)(),w=(0,_t.l)(this.startCamera.eye);this.adjustedSphere[3]=w<this.sphere[3]?w-100:this.sphere[3],Wm(this.adjustedSphere,this.startCamera,O,D);const te=(0,dr.J$)();this.startCamera.projectToRenderScreen(D,te),this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*te[1]);const Pe=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint);Pe&&(0,Io.Yq)(this.scenePickPoint,(0,Io.mJ)(this.panningPlane),this.panningPlane);const Ue=(0,$t.c)(),Xe=(0,$t.c)(),st=(0,$t.c)();(0,_t.b)(Ue,this.scenePickPoint,this.currentCamera.eye);const Kt=(0,_t.l)(Ue);(0,_t.n)(Ue,Ue);const Lt=5*Math.max(Math.abs(this.view.camera.position.z),50),nr=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,80);let sr=nr?Math.min(nr,Lt):Lt;sr=Pe?Math.min(sr,Kt):sr,(0,_t.c)(st,(0,_t.a)(Xe,this.currentCamera.eye,(0,_t.g)(Xe,Ue,sr))),this.panningPlane[3]=-(0,_t.e)(this.panningPlane,st),this.startCamera.center=(0,_t.a)(Xe,this.startCamera.eye,(0,_t.g)(Xe,this.startCamera.viewForward,sr));const Er=(0,dr.md)(_.center,this.tmpScreenPointArray);O1(this.panningPlane,this.startCamera,Er,this.beginScenePoint)}update(_){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const v=_.pointers.size>1;this.navMode===Al.Horizontal?(v&&this._zoomSpherical(_),this._panningSpherical(_),v&&this._rotateSpherical(_)):(v&&this._zoomPlanar(_),this._panningPlanar(_),v&&this._rotatePlanar(_))}end(_){_.pointers.size===this.pointerCount&&this.update(_),this.finishController();const v=this.zoomMomentumEstimator.evaluateMomentum();if(v)return this.navMode===Al.Horizontal?new Lf({view:this.view,momentum:v,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new O_({view:this.view,momentum:v,zoomCenter:this.beginScenePoint});const O=this.rotationMomentumEstimator.evaluateMomentum();if(O)return new If({view:this.view,momentum:O,center:this.sphere,axis:this.rotationAxis});if(this.navMode===Al.Horizontal){const D=this.panSphericalMomentumEstimator.evaluateMomentum();if(D)return new Qy({view:this.view,momentum:D})}else{const D=this.panPlanarMomentumEstimator.evaluateMomentum();if(D)return new km({view:this.view,momentum:D})}return null}_zoomSpherical(_){const v=this.beginRadius/_.radius,O=.001875*Math.min(Math.max(_.radius,40),120);this.smoothScaling.gain=O,this.smoothScaling.update(v),VM(this.sphere,this.currentCamera,this.smoothScaling.value),(0,dr.md)(_.center,this.zoomCenterScreen),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*_.timestamp),this.constraintOptions.interactionType=bn.ZOOM,this.constraintOptions.interactionFactor=ih(_.radius-this.beginRadius),va(this.view,this.currentCamera,this.constraintOptions)}_panningSpherical(_){const v=(0,dr.md)(_.center,this.tmpScreenPointArray);Wm(this.sphere,this.currentCamera,v,this.tmp3d),D1(this.beginScenePoint,(0,_t.e)(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(tO(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(v,this.tmp3d,.001*_.timestamp,this.startCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(eO(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(v,this.tmp3d,.001*_.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt)),this.constraintOptions.interactionType=bn.PAN,this.constraintOptions.interactionFactor=ih(this.screenPickPoint,v),va(this.view,this.currentCamera,this.constraintOptions)}_rotateSpherical(_){(0,_t.n)(this.rotationAxis,this.scenePickPoint),this.currentCamera.aboveGround||(0,_t.o)(this.rotationAxis,this.rotationAxis);const v=this.smoothRotation.value,O=v+M1(_.angle-v),D=.00125*Math.min(Math.max(_.radius,40),120);this.smoothRotation.gain=D,this.smoothRotation.update(O);const w=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(w,.001*_.timestamp),P0(this.currentCamera,this.sphere,Pm(this.rotationAxis,w)),this.constraintOptions.interactionType=bn.TUMBLE,this.constraintOptions.interactionFactor=ih(_.radius*O),va(this.view,this.currentCamera,this.constraintOptions)}_panningPlanar(_){const v=(0,dr.md)(_.center,this.tmpScreenPointArray);O1(this.panningPlane,this.currentCamera,v,this.tmp3d)&&($M(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(v,this.tmp3d,.001*_.timestamp),this.constraintOptions.interactionType=bn.PAN,this.constraintOptions.interactionFactor=ih(this.beginScreenPoint,v),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),va(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)}_zoomPlanar(_){const v=this.beginRadius/_.radius,O=.001875*Math.min(Math.max(_.radius,40),120);this.smoothScaling.gain=O,this.smoothScaling.update(v),this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*_.timestamp),P1(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this.constraintOptions.interactionType=bn.ZOOM,this.constraintOptions.interactionFactor=ih(_.radius-this.beginRadius),va(this.view,this.currentCamera,this.constraintOptions)}_rotatePlanar(_){(0,_t.c)(this.rotationAxis,this.beginScenePoint),this.currentCamera.aboveGround||(0,_t.o)(this.rotationAxis,this.rotationAxis);const v=this.smoothRotation.value;let O=_.angle-v;O=M1(O);const D=v+O,w=.00125*Math.min(Math.max(_.radius,40),120);this.smoothRotation.gain=w,this.smoothRotation.update(D);const te=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(te,.001*_.timestamp),P0(this.currentCamera,this.sphere,Pm(this.rotationAxis,te)),this.constraintOptions.interactionType=bn.TUMBLE,this.constraintOptions.interactionFactor=ih(_.radius*te),va(this.view,this.currentCamera,this.constraintOptions)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ev.prototype,"view",void 0),ev=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.global.PinchAndPanController")],ev);const VO=(0,$t.f)(0,0,1),GI_ANGLE_THRESHOLD=16/180*Math.PI;let tv=class extends D0{constructor(_){super(_),this.view=null,this.rotationValueSmooth=new Jy(.05),this.scalingValueSmooth=new Jy(.05),this.planeHorizontal=(0,Io.Ue)(),this.planeVertical=(0,Io.Ue)(),this.rotationMomentumEstimator=new FO,this.panMomentumEstimator=new UO(300,12,.9),this.zoomMomentumEstimator=new WO,this.beginCenter=(0,$t.c)(),this.tmpPoints=[],this.beginCenterScreen=(0,dr.s1)(),this.tmpCentroid3d=(0,$t.c)(),this.tmpCentroid2d=(0,dr.s1)(),this.tmp2d=(0,dr.s1)(),this.constraintOptions={selection:wo.ALL,interactionType:bn.NONE,interactionFactor:0,interactionStartCamera:new $n.V,interactionDirection:null,tiltMode:ml.TUMBLE}}get intersectionHelper(){return this.view.sceneIntersectionHelper}begin(_){if(!this.active)return;const v=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=v,this.rotationMomentumEstimator.enabled=v,this.panMomentumEstimator.enabled=v,this.beginRadius=_.radius,this.pointerCount=_.pointers.size,this.beginAngle=_.angle,this.rotationValueSmooth.reset(),this.scalingValueSmooth.reset(),(0,dr.md)(_.center,this.beginCenterScreen),(0,Io.Oy)(VO,0,this.planeHorizontal);const O=(0,$t.c)(),D=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,O),w=(0,$t.c)();(0,_t.o)(w,this.startCamera.viewForward);const te=(0,$t.c)();(0,_t.c)(te,VO);const fe=(0,_t.e)(w,te),Pe=(0,li.Kt)(fe<0?-fe:fe);if(this.panMode=Pe>=GI_ANGLE_THRESHOLD?Al.Horizontal:Al.Vertical,(0,Io.T5)(this.planeHorizontal,this.planeHorizontal,O),this.startCamera.aboveGround||(0,Io.tk)(this.planeHorizontal,this.planeHorizontal),this.panMode===Al.Vertical){(0,_t.g)(te,te,fe),(0,_t.b)(this.planeVertical,w,te),(0,_t.n)(this.planeVertical,this.planeVertical),(0,Io.T5)(this.planeVertical,this.planeVertical,O);const Ue=(0,$t.c)(),Xe=(0,$t.c)(),st=(0,$t.c)();(0,_t.b)(Ue,O,this.currentCamera.eye);const vt=(0,_t.l)(Ue);(0,_t.n)(Ue,Ue);const Ct=5*Math.max(Math.abs(this.view.camera.position.z),50),Wt=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80);let Kt=Wt?Math.min(Wt,Ct):Ct;Kt=D?Math.min(Kt,vt):Kt,(0,_t.c)(st,(0,_t.a)(Xe,this.currentCamera.eye,(0,_t.g)(Xe,Ue,Kt))),this.planeVertical[3]=-(0,_t.e)(this.planeVertical,st),this.computePlanePoints(_.pointers,this.planeVertical,this.startCamera,this.tmpPoints),Oy(this.tmpPoints,this.beginCenter)}else this.computePlanePoints(_.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints),Oy(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}update(_){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const v=_.pointers.size>1,O=this.panMode===Al.Horizontal?this.planeHorizontal:this.planeVertical,D=this.beginCenter;if(v){const w=this.beginRadius/_.radius,te=.001875*Math.min(Math.max(_.radius,40),120);this.scalingValueSmooth.gain=te,this.scalingValueSmooth.update(w),P1(this.currentCamera,D,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*_.timestamp),this.constraintOptions.interactionType=bn.ZOOM,this.constraintOptions.interactionFactor=ih(Math.abs(_.radius-this.beginRadius)),va(this.view,this.currentCamera,this.constraintOptions)}if(this.computePlanePoints(_.pointers,O,this.currentCamera,this.tmpPoints),Oy(this.tmpPoints,this.tmpCentroid3d),(0,dr.md)(_.center,this.tmpCentroid2d),$M(this.currentCamera,D,this.tmpCentroid3d),this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*_.timestamp),this.constraintOptions.interactionType=bn.PAN,this.constraintOptions.interactionFactor=ih(this.beginCenterScreen,this.tmpCentroid2d),va(this.view,this.currentCamera,this.constraintOptions),v){const w=this.planeHorizontal,te=D,fe=this.rotationValueSmooth.value,Pe=fe+M1(_.angle-fe),Ue=.00125*Math.min(Math.max(_.radius,40),120);this.rotationValueSmooth.gain=Ue,this.rotationValueSmooth.update(Pe);const Xe=this.rotationValueSmooth.value-this.beginAngle;this.rotationMomentumEstimator.add(Xe,.001*_.timestamp),P0(this.currentCamera,te,Pm(w,Xe)),this.constraintOptions.interactionType=bn.TUMBLE,this.constraintOptions.interactionFactor=ih(Math.abs(_.radius*Xe)),va(this.view,this.currentCamera,this.constraintOptions)}}end(_){_.pointers.size===this.pointerCount&&this.update(_),this.finishController();const v=this.zoomMomentumEstimator.evaluateMomentum();if(v)return new O_({view:this.view,momentum:v,zoomCenter:this.beginCenter});const O=this.rotationMomentumEstimator.evaluateMomentum();if(O)return new If({view:this.view,momentum:O,center:this.beginCenter,axis:(0,Io.mJ)(this.planeHorizontal)});const D=this.panMomentumEstimator.evaluateMomentum();return D?new km({view:this.view,momentum:D}):null}computePlanePoints(_,v,O,D){D.length=_.size;const w=this.tmp2d;let te=0;return _.forEach(fe=>{w[0]=fe.x,w[1]=fe.y,void 0===D[te]&&(D[te]=(0,$t.c)()),O1(v,O,w,D[te]),te+=1}),D}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],tv.prototype,"view",void 0),tv=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.local.PinchAndPanController")],tv);class zO extends xc.a{constructor(v,O,D){super(!0),this.view=v,this.pointerAction=O,this.lastEndTimestamp=0,this.lastTimestamp=0,this.registerIncoming("drag",D,w=>this._handleDrag(w))}_handleDrag(v){if("mouse"===v.data.pointerType&&!R1(v.data,this.pointerAction))return;const w=this.momentum&&this.momentum.active&&v.timestamp-this.lastEndTimestamp<40;switch(v.data.action){case"start":case"update":if(w)break;this.controller&&this.controller.active?v.data.timestamp-this.lastTimestamp>2&&(this.controller.update(v.data),this.lastTimestamp=v.timestamp):this._startController(v);break;case"end":case"removed":this._endController(v,!0);break;case"added":this._endController(v,!1),this._startController(v)}v.stopPropagation()}_endController(v,O){if(this.controller&&this.controller.active){this.lastEndTimestamp=v.timestamp;const D=this.controller.end(v.data);O&&D&&(this.momentum=D,this.view.state.switchCameraController(this.momentum))}this.controller=null}_startController(v){this.controller=this._createController(),this.view.state.switchCameraController(this.controller),this.controller.begin(v.data),this.lastTimestamp=v.timestamp}_createController(){return this.view.state.isGlobal?new ev({view:this.view}):new tv({view:this.view})}}class KI extends xc.a{constructor(v,O){super(!0),this.view=v,this.registerIncoming("pointer-down",O,()=>this.view.state.stopActiveCameraController())}}class GO extends xc.a{constructor(v,O){super(!0),this.key=v,this.registerIncoming("key-down",O,D=>this._handleKeyDown(D))}_handleKeyDown(v){v.data.key===this.key&&(this.activate(),v.stopPropagation())}}class ZI extends GO{constructor(v,O,D){super(O,D),this.view=v}activate(){this.view.goTo({heading:0}).catch(()=>{})}}class $I extends GO{constructor(v,O,D){super(O,D),this.view=v}activate(){this.view.goTo({tilt:0}).catch(()=>{})}}class kI extends xc.a{constructor(v,O=!1){super(!0),this.view=v,this.invert=O,this.registerIncoming("vertical-two-finger-drag",D=>this._handleTwoFinger(D))}_handleTwoFinger(v){var w,te,fe;const D=(0,dr.s1)(0,v.data.delta*(this.invert?-1:1));switch(v.data.action){case"begin":null==(w=this.cameraController)||w.end(),this.cameraController=new y_({view:this.view,pivot:Tu.CENTER}),this.view.state.switchCameraController(this.cameraController),this.cameraController.begin(D);break;case"update":null==(te=this.cameraController)||te.update(D);break;case"end":null==(fe=this.cameraController)||fe.end(),this.cameraController=null}}}var YI=T(25441);function HO(_){const v=_.native;return v?{buttons:v.buttons.map(O=>O.pressed?O.value?O.value:1:0),axes:v.axes.map(O=>function QI(_,v){const O=Math.abs(_);return O<v?0:Math.sign(_)*(O-v)/(1-v)}(O,_.axisThreshold))}:{buttons:[],axes:[]}}class qI{constructor(v,O){this.element=v,this.input=O,this._hasEventListeners=!1,this._onConnectGamepad=te=>{this._connectGamepad(te.gamepad)},this._onDisconnectGamepad=te=>{const fe=te.gamepad,Pe=fe.index,Ue=this.inputDevices[Pe];Ue&&(this._emitGamepadEvent(fe,HO(Ue),!1),this.inputDevices.splice(Pe,1),this.latestUpdate.splice(Pe,1),this.input.gamepad.devices.remove(Ue),this.ensurePollingState())},this.frameTask=null,this.latestUpdate=new Array,this.inputDevices=new Array,this.callback=null;const D="getGamepads"in window.navigator,w=window.isSecureContext;this.supported=D&&w,this.supported&&(this._forEachGamepad(te=>this._connectGamepad(te)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(v){this._hasEventListeners!==v&&(this._hasEventListeners=v,this.ensurePollingState())}get eventsEnabled(){return this.supported&&this.inputDevices.length>0&&this._hasEventListeners}set onEvent(v){this.callback=v}_connectGamepad(v){const O=new mu(v);"unknown"!==O.deviceType&&(this.inputDevices[v.index]=O,this.input.gamepad.devices.add(O)),this.ensurePollingState()}ensurePollingState(){this.eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){null==this.frameTask&&(this.frameTask=(0,rt.A)({update:()=>this._readGamepadState()}))}_stopPolling(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=new Array)}_readGamepadState(){const v=document.hasFocus(),O=this.element.contains(document.activeElement),D="document"===this.input.gamepad.enabledFocusMode&&!v||"view"===this.input.gamepad.enabledFocusMode&&!O;this._forEachGamepad(w=>{const te=this.inputDevices[w.index];if(!te)return;const fe=this.latestUpdate[w.index],Pe=HO(te),Ue=D||function XI(_){for(let v=0;v<_.axes.length;v++)if(0!==_.axes[v])return!1;for(let v=0;v<_.buttons.length;v++)if(0!==_.buttons[v])return!1;return!0}(Pe);fe&&(fe.timestamp===w.timestamp||!fe.active&&Ue||function JI(_,v){if(_.axes.length!==v.axes.length||_.buttons.length!==v.buttons.length)return!1;for(let O=0;O<_.axes.length;O++)if(_.axes[O]!==v.axes[O])return!1;for(let O=0;O<_.buttons.length;O++)if(_.buttons[O]!==v.buttons[O])return!1;return!0}(fe.state,Pe))||this._emitGamepadEvent(w,Pe,!Ue)})}_forEachGamepad(v){const O=window.navigator.getGamepads();for(let D=0;D<O.length;D++){const w=O[D];this._validate(w)&&v(w)}}_emitGamepadEvent(v,O,D){const w=this.latestUpdate[v.index],te=w&&w.active;if(!te&&!D)return;const fe=!te&&D?"start":te&&D?"update":"end";this.latestUpdate[v.index]={timestamp:v.timestamp,state:O,active:D},this.callback&&this.callback({device:this.inputDevices[v.index],state:O,action:fe})}_validate(v){if(!v||!v.connected)return!1;for(let O=0;O<v.axes.length;O++)if(isNaN(v.axes[O]))return!1;return!0}}const KO=(0,Jo.Z)("trident"),ZO=(0,Jo.Z)("edge"),e3=(0,Jo.Z)("chrome"),t3=(0,Jo.Z)("ff"),r3=(0,Jo.Z)("safari"),P__touchNone="esri-view-surface--touch-none",P__touchPan="esri-view-surface--touch-pan";let i3=(()=>{class _{constructor(O,D){this.input=D,this._active={},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=O,O.getAttribute("tabindex")||O.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new qI(O,this.input),this._gamepadSource.onEvent=w=>this._callback("gamepad",w)}destroy(){this._callback=null,this.activeEvents=null,this._activePointerCaptures.forEach(O=>{this._releasePointerCaptureSafe(O)}),this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(O){this._browserTouchPanningEnabled=O,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(O){this._callback=O}set activeEvents(O){for(const D in this._active)O&&O.has(D)||(this._element.removeEventListener(Z1[D],this._active[D]),delete this._active[D]);O&&O.forEach(D=>{if(!this._active[D]&&Z1[D]){const w=(this._eventHandlers[D]||this._handleDefault).bind(this,D);this._element.addEventListener(Z1[D],w),this._active[D]=w}}),this._gamepadSource.hasEventListeners=O&&O.has("gamepad")}setPointerCapture(O,D){D?(this._element.setPointerCapture(O.pointerId),this._activePointerCaptures.add(O.pointerId)):(this._releasePointerCaptureSafe(O.pointerId),this._activePointerCaptures.delete(O.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?P__touchNone:P__touchPan),this._element.classList.add(this._browserTouchPanningEnabled?P__touchPan:P__touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(P__touchNone),this._element.classList.remove(P__touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_releasePointerCaptureSafe(O){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(O))return;this._element.releasePointerCapture(O)}catch(D){}}_updateNormalizedPointerLikeEvent(O,D){const w=(0,na.Eu)(this._element,O);return _.test.disableSubpixelCoordinates&&(w.x=Math.round(w.x),w.y=Math.round(w.y)),D.x=w.x,D.y=w.y,D}_handleKey(O,D){const w=(0,YI.kK)(D);w&&"key-up"===O&&this._keyDownState.delete(w);const te={native:D,key:w,repeat:w&&this._keyDownState.has(w)};w&&"key-down"===O&&this._keyDownState.add(te.key),this._callback(O,te)}_handlePointer(O,D){const w=this._updateNormalizedPointerLikeEvent(D,{native:D,x:0,y:0,pointerType:D.pointerType,button:D.button,buttons:D.buttons,eventId:this._eventId++});this._callback(O,w)}_handlePointerPreventDefault(O,D){const w=this._updateNormalizedPointerLikeEvent(D,{native:D,x:0,y:0,pointerType:D.pointerType,button:D.button,buttons:D.buttons,eventId:this._eventId++});D.preventDefault(),this._callback(O,w)}_handleMouseWheel(O,D){let w=D.deltaY;switch(D.deltaMode){case 0:(KO||ZO)&&(w=w/document.documentElement.clientHeight*600);break;case 1:w*=30;break;case 2:w*=900}KO||ZO?w*=.7:e3||r3?w*=.6:t3&&(w*=1.375);const fe=Math.abs(w);fe>100&&(w=w/fe*200/(1+Math.exp(-.02*(fe-100))));const Pe=this._updateNormalizedPointerLikeEvent(D,{native:D,x:0,y:0,deltaY:w});this._callback(O,Pe)}_handlePointerCaptureLost(O,D){this._activePointerCaptures.delete(D.pointerId),this._handleDefault(O,D)}_handleDefault(O,D){const w={native:D};D.preventDefault(),this._callback(O,w)}_preventAltKeyDefault(O){"Alt"===O.key&&O.preventDefault()}_preventMultiTouchPanning(O){O.touches.length>1&&O.preventDefault()}}return _.test={disableSubpixelCoordinates:!1},_})();const Z1={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};class s3 extends xc.a{constructor(){super(!0),this.registerIncoming("context-menu",v=>{v.data.native.preventDefault()})}}function $O(_,v){return Math.abs(v.x-_.x)+Math.abs(v.y-_.y)}class a3 extends xc.a{constructor(v){super(!1),this.navigationTouch=v,this.startStateModifiers=new Set,this.activePointerMap=new Map,this.isDragging=!1,this.isCurrentDragSuppressed=!1,this.drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(v,O,D,w){return{action:v,pointerType:this.pointerType,button:this.mouseButton,buttons:O.buttons,timestamp:w,pointers:l3(this.activePointerMap),pointer:O,angle:D.angle,radius:D.radius,center:D.center}}_addPointer(v){const O=v.native.pointerId,D=rv(this.activePointerMap).angle,w={event:v,initialAngle:0,lastAngle:0};this.activePointerMap.set(O,w);const te=iv(w,kO(this.activePointerMap));w.initialAngle=te,w.lastAngle=te,this._updatePointerAngles(D)}_updatePointer(v){if(v&&null==v.x&&null==v.y)return;const D=this.activePointerMap.get(v.native.pointerId);D?D.event=v:this._addPointer(v)}_removePointer(v){const O=rv(this.activePointerMap).angle;this.activePointerMap.delete(v),this._updatePointerAngles(O)}_updatePointerAngles(v){const O=rv(this.activePointerMap);this.activePointerMap.forEach(D=>{D.initialAngle=iv(D,O)-v,D.lastAngle=iv(D,O)-v})}_emitEvent(v,O,D){const w=rv(this.activePointerMap);this.drag.emit(this._createPayload(v,O,w,D),void 0,this.startStateModifiers)}_handlePointerUpAndPointerLost(v){const O=v.data.native.pointerId,D=(0,io.HA)(v.timestamp);this.activePointerMap.get(O)&&(1===this.activePointerMap.size?(this._updatePointer(v.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",v.data,D),this.isDragging=!1,this.isCurrentDragSuppressed=!1,this._removePointer(O)):(this._removePointer(O),this._emitEvent("removed",v.data,(0,io.HA)(v.timestamp))))}_handlePointerDrag(v){const O=v.data,D=O.currentEvent,w=(0,io.HA)(v.timestamp);switch(O.action){case"start":case"update":this.isDragging?this.activePointerMap.has(D.native.pointerId)?(this._updatePointer(D),!this.isCurrentDragSuppressed&&this._emitEvent("update",D,w)):(this._addPointer(D),this._emitEvent("added",D,w),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(D),this.pointerType=v.data.startEvent.pointerType,this.mouseButton=v.data.startEvent.button,this.startStateModifiers=v.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",D,w))}}get isSuppressed(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}function kO(_){const v=[];return _.forEach(O=>{v.push((0,dr.vW)(O.event.x,O.event.y))}),function o3(_,v){if(v?(v.radius=0,v.center.x=0,v.center.y=0):v={radius:0,center:(0,dr.vW)()},0===_.length)return v;if(1===_.length)return v.center.x=_[0].x,v.center.y=_[0].y,v;if(2===_.length){const[yr,br]=_,[Rr,$r]=[br.x-yr.x,br.y-yr.y];return v.radius=Math.sqrt(Rr*Rr+$r*$r)/2,v.center.x=(yr.x+br.x)/2,v.center.y=(yr.y+br.y)/2,v}let O=0,D=0;for(let yr=0;yr<_.length;yr++)O+=_[yr].x,D+=_[yr].y;O/=_.length,D/=_.length;const w=_.map(yr=>yr.x-O),te=_.map(yr=>yr.y-D);let fe=0,Pe=0,Ue=0,Xe=0,st=0,vt=0,Ct=0;for(let yr=0;yr<w.length;yr++){const br=w[yr],Rr=te[yr],$r=br*br,si=Rr*Rr;fe+=$r,Pe+=si,Ue+=br*Rr,Xe+=$r*br,st+=si*Rr,vt+=br*si,Ct+=Rr*$r}const Wt=.5*(Xe+vt),Kt=.5*(st+Ct),Lt=fe*Pe-Ue*Ue,nr=(Wt*Pe-Kt*Ue)/Lt,sr=(fe*Kt-Ue*Wt)/Lt,Er=(0,dr.vW)(nr+O,sr+D);return{radius:Math.sqrt(nr*nr+sr*sr+(fe+Pe)/_.length),center:Er}}(v)}function rv(_){const v=kO(_);let O=0;return _.forEach(D=>{let w=iv(D,v),te=w-D.lastAngle;for(;te>Math.PI;)te-=2*Math.PI;for(;te<-Math.PI;)te+=2*Math.PI;w=D.lastAngle+te,D.lastAngle=w,O+=w-D.initialAngle}),O/=_.size||1,{angle:O,radius:v.radius,center:v.center}}function l3(_){const v=new Map;return _.forEach((O,D)=>v.set(D,O.event)),v}function iv(_,v){const O=_.event;return Math.atan2(O.y-v.center.y,O.x-v.center.x)}var YO;!function(_){_[_.Left=0]="Left",_[_.Middle=1]="Middle",_[_.Right=2]="Right",_[_.Back=3]="Back",_[_.Forward=4]="Forward",_[_.Undefined=-1]="Undefined"}(YO||(YO={}));var $1=T(84244);class c3 extends xc.a{constructor(v=250,O=10,D=350,w=35,te=$1.m){super(!1),this.maximumDoubleClickDelay=v,this.maximumDoubleClickDistance=O,this.maximumDoubleTouchDelay=D,this.maximumDoubleTouchDistance=w,this._clock=te,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("drag",this._handleDrag.bind(this))}onUninstall(){this._pointerState.forEach(v=>v.doubleClickTimeout=(0,lt.hw)(v.doubleClickTimeout))}get hasPendingInputs(){return(0,ya.oE)(this._pointerState,v=>null!=v.doubleClickTimeout)}_pointerId(v){const O=v.native;return"mouse"===O.pointerType?`${O.pointerId}:${O.button}`:`${O.pointerType}`}_handleImmediateClick(v){const O=v.data,D=this._pointerId(O),w=this._pointerState.get(D);if(w){const te="touch"===O.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;$O(w.event.data,O)>te?(this._clearDoubleClickTimeout(D,!0),this._startClick(v)):(this._clearDoubleClickTimeout(D,!1),this._doubleClick.emit(w.event.data,void 0,w.event.modifiers))}else this._startClick(v)}_startClick(v){const O=this._pointerId(v.data);this._pointerState.set(O,{event:v,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(O),"touch"===v.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}),this.refreshHasPendingInputs()}_handlePointerDrag(v){const O=this._pointerId(v.data.currentEvent);this._clearDoubleClickTimeout(O,!0)}_handleDrag(v){const O=this._pointerId(v.data.pointer);this._clearDoubleClickTimeout(O,!0)}_clearDoubleClickTimeout(v,O){const D=this._pointerState.get(v);D&&(D.doubleClickTimeout.remove(),D.doubleClickTimeout=null,O&&this._doubleClickTimeoutExceeded(v),this._pointerState.delete(v),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(v){const O=this._pointerState.get(v);this._click.emit(O.event.data,void 0,O.event.modifiers),O.doubleClickTimeout=null,this._pointerState.delete(v),this.refreshHasPendingInputs()}}class u3 extends xc.a{constructor(v=250,O=10,D=350,w=35,te=$1.m){super(!1),this.maximumDoubleClickDelay=v,this.maximumDoubleClickDistance=O,this.maximumDoubleTouchDelay=D,this.maximumDoubleTouchDistance=w,this._clock=te,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",fe=>{this._handlePointerLoss(fe,"pointer-up")}),this.registerIncoming("pointer-capture-lost",fe=>{this._handlePointerLoss(fe,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",fe=>{this._handlePointerLoss(fe,"pointer-cancel")})}onUninstall(){this._pointerState.forEach(v=>{v.immediateDoubleClick&&v.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(v){const O=v.data,D=this._pointerId(O);this._pointerState.has(D)||(this._pointerState.set(D,{downButton:O.native.button,immediateDoubleClick:null}),this.startCapturingPointer(O.native))}_handlePointerLoss(v,O){const D=v.data,w=this._pointerId(D),te=this._pointerState.get(w);if(te&&"pointer-up"===O&&te.downButton===D.native.button){const fe=te.immediateDoubleClick;if(fe){fe.timeoutHandle.remove();const Pe="touch"===v.data.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;$O(fe,v.data)>Pe?this._startImmediateDoubleClick(v,te):(this._immediateDoubleClick.emit(v.data,void 0,fe.modifiers),this._removeState(D))}else this._startImmediateDoubleClick(v,te)}}_startImmediateDoubleClick(v,O){O.immediateDoubleClick={x:v.data.x,y:v.data.y,modifiers:v.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(v.data),"touch"===v.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}}_pointerId(v){const O=v.native;return"mouse"===O.pointerType?`${O.pointerId}:${O.button}`:`${O.pointerType}`}_removeState(v){const O=this._pointerId(v);this._pointerState.delete(O),this.stopCapturingPointer(v.native),this.refreshHasPendingInputs()}}class d3 extends xc.a{constructor(v=300,O=1.5,D=6,w=6,te=500,fe=$1.m){super(!1),this.maximumClickDelay=v,this.movementUntilMouseDrag=O,this.movementUntilPenDrag=D,this.movementUntilTouchDrag=w,this.holdDelay=te,this._clock=fe,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",Pe=>{this._handlePointerLoss(Pe,"pointer-up")}),this.registerIncoming("pointer-capture-lost",Pe=>{this._handlePointerLoss(Pe,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",Pe=>{this._handlePointerLoss(Pe,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(v=>{null!=v.holdTimeout&&(v.holdTimeout.remove(),v.holdTimeout=null)}),super.onUninstall()}_handlePointerDown(v){const O=v.data,D=O.native.pointerId;let w=null;0===this._pointerState.size&&(w=this._clock.setTimeout(()=>{const fe=this._pointerState.get(D);fe&&(fe.isDragging||(this._pointerHold.emit(fe.previousEvent,void 0,v.modifiers),fe.holdEmitted=!0),fe.holdTimeout=null)},this.holdDelay)),this._pointerState.set(D,{startEvent:O,previousEvent:O,startTimestamp:v.timestamp,isDragging:!1,downButton:O.native.button,holdTimeout:w,modifiers:new Set}),this.startCapturingPointer(O.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(v)}_createPointerDragData(v,O,D){return{action:v,startEvent:O.startEvent,previousEvent:O.previousEvent,currentEvent:D}}_handlePointerMove(v){const O=v.data,w=this._pointerState.get(O.native.pointerId);w&&(w.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",w,O),void 0,w.modifiers):function n3(_,v){const O=v.x-_.x,D=v.y-_.y;return Math.sqrt(O*O+D*D)}(O,w.startEvent)>this._getDragThreshold(O.native.pointerType)&&this._startDragging(v),w.previousEvent=O)}_getDragThreshold(v){switch(v){case"touch":return this.movementUntilTouchDrag;case"pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}}_startDragging(v){const O=v.data,D=O.native.pointerId;this._pointerState.forEach(w=>{null!=w.holdTimeout&&(w.holdTimeout.remove(),w.holdTimeout=null),w.isDragging||(w.modifiers=v.modifiers,w.isDragging=!0,D===w.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",w,O)):this._pointerDrag.emit(this._createPointerDragData("start",w,w.previousEvent),v.timestamp))})}_handlePointerLoss(v,O){const D=v.data,w=D.native.pointerId,te=this._pointerState.get(w);te&&(null!=te.holdTimeout&&(te.holdTimeout.remove(),te.holdTimeout=null),te.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",te,"pointer-up"===O?D:te.previousEvent),void 0,te.modifiers):"pointer-up"===O&&te.downButton===D.native.button&&v.timestamp-te.startTimestamp<=this.maximumClickDelay&&!te.holdEmitted&&this._immediateClick.emit(D),this._pointerState.delete(w),this.stopCapturingPointer(D.native),0===this._pointerState.size&&this._moveHandle.pause())}}class h3{constructor(v){this.callbacks=v,this.currentCount=0,this.callbacks.condition||(this.callbacks.condition=()=>!0)}handle(v){const O=v.data,D=O.pointers.size;switch(O.action){case"start":this.currentCount=D,this._emitStart(v);break;case"added":this._emitEnd(this.previousEvent),this.currentCount=D,this._emitStart(v);break;case"update":this._emitUpdate(v);break;case"removed":this.startEvent&&this._emitEnd(this.previousEvent),this.currentCount=D,this._emitStart(v);break;case"end":this._emitEnd(v),this.currentCount=0}this.previousEvent=v}_emitStart(v){this.startEvent=v,this.callbacks.condition(this.currentCount,v)&&this.callbacks.start(this.currentCount,v,this.startEvent)}_emitUpdate(v){this.callbacks.condition(this.currentCount,v)&&this.callbacks.update(this.currentCount,v,this.startEvent)}_emitEnd(v){this.callbacks.condition(this.currentCount,v)&&this.callbacks.end(this.currentCount,v,this.startEvent),this.startEvent=null}}class p3 extends xc.a{constructor(v=20,O=40){super(!1),this._threshold=v,this._maxDelta=O,this.state="ready",this.emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this.dragEventSeparator=new h3({start:(D,w)=>this._observeStart(D,w),update:(D,w,te)=>this._observeUpdate(D,w,te),end:(D,w)=>this._observeEnd(w)}),this.registerIncoming("drag",D=>this.dragEventSeparator.handle(D))}get failed(){return"failed"===this.state}_observeStart(v,O){1===v&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:O.data.button,buttons:O.data.buttons,pointerType:O.data.pointerType,timestamp:O.data.timestamp,pointers:O.data.pointers,pointer:O.data.pointer,angle:O.data.angle,radius:O.data.radius,center:O.data.center}),O.stopPropagation()),this.state=2===v?"ready":"failed"}_observeUpdate(v,O,D){if("failed"!==this.state&&2===v)return"active"===this.state?(this._vertical.emit({delta:O.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void O.stopPropagation()):void(this._checkMovementWithinLimits(O.data,D.data)?this._checkVerticalThresholdReached(O.data,D.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=O.data.center,this._artificalDrag.emit({action:"end",button:O.data.button,buttons:O.data.buttons,pointerType:O.data.pointerType,timestamp:O.data.timestamp,pointers:O.data.pointers,pointer:O.data.pointer,angle:O.data.angle,radius:O.data.radius,center:O.data.center}),this._vertical.emit({delta:O.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),O.stopPropagation()):this.state="failed")}_observeEnd(v){"active"===this.state&&(this._vertical.emit({delta:v.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",v.stopPropagation())}_checkMovementWithinLimits(v,O){let D=-1/0,w=1/0,te=-1/0,fe=1/0;O.pointers.forEach(Lt=>{D=Math.max(D,Lt.x),w=Math.min(w,Lt.x),te=Math.max(te,Lt.y),fe=Math.min(fe,Lt.y)});let Pe=-1/0,Ue=1/0,Xe=-1/0,st=1/0;v.pointers.forEach(Lt=>{Pe=Math.max(Pe,Lt.x),Ue=Math.min(Ue,Lt.x),Xe=Math.max(Xe,Lt.y),st=Math.min(st,Lt.y)});const vt=D-w,Ct=te-fe,Wt=Pe-Ue,Kt=Xe-st;return Math.abs(v.center.x-O.center.x)<this._threshold&&Math.abs(Wt-vt)<=this._maxDelta&&Math.abs(Kt-Ct)<=this._maxDelta}_checkVerticalThresholdReached(v,O){let D=Math.abs(v.center.y-O.center.y);return v.pointers.forEach((w,te)=>{const fe=O.pointers.get(te);D=Math.min(D,Math.abs(w.y-fe.y))}),D>=this._threshold}}let jh=class extends Bi.Z{constructor(){super(...arguments),this._handles=new cn.Z}destroy(){this._handles&&(this._handles.removeAll(),this._handles=null),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(_){"pan"!==_&&"rotate"!==_||_===this._get("primaryDragAction")||(this._set("primaryDragAction",_),this._updateMode())}get mode(){return this._get("mode")}set mode(_){"default"!==_&&"pro"!==_||_===this._get("mode")||(this._set("mode",_),this._updateMode())}get hasPendingInputs(){var _;return null==(_=this._inputManager)?void 0:_.hasPendingInputs}get latestPointerType(){var _;return null==(_=this._inputManager)?void 0:_.latestPointerType}get latestPointerLocation(){var _;return null==(_=this._inputManager)?void 0:_.latestPointerLocation}disconnect(){this.view.viewEvents.disconnect(),this._inputManager&&(this._inputManager.destroy(),this._inputManager=null),this._source&&(this._source.destroy(),this._source=null)}connect(){const _=this.view;this._source=new i3(this.view.surface,_.input);const v=[new u3,new d3,new c3,new a3(this.view.navigation),new p3],O=new mo.$({eventSource:this._source,recognizers:v});this._inputManager=O,O.installHandlers("prevent-context-menu",[new s3],mo.f.INTERNAL),this._modeDragPan=new zO(_,"primary"),this._modeDragRotate=new L1(_,"secondary",Tu.CENTER),this._modeDragZoom=new qw(_,"tertiary");O.installHandlers("navigation",[new KI(_),new Yw(_),new UI(_),new BI(_,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new NI(_),new $I(_,"p"),new ZI(_,"n"),new L1(_,"primary",Tu.EYE,["b"]),new L1(_,"secondary",Tu.CENTER,["b"]),new zO(_,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new kI(_)],mo.f.INTERNAL),this.view.viewEvents.connect(O),this._updateMode(),this._handles.add((0,pt.YP)(()=>{var w;return null==(w=this.view.navigation)?void 0:w.browserTouchPanEnabled},w=>{this._source.browserTouchPanningEnabled=!w},pt.nn))}_updateMode(){const v=this.primaryDragAction,O=k1.get(this.mode).get(v);this._modeDragPan&&(this._modeDragPan.pointerAction=O.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=O.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=O.zoom)}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};(0,Ze._)([(0,nt.Cb)()],jh.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({value:"pan"})],jh.prototype,"primaryDragAction",null),(0,Ze._)([(0,nt.Cb)({value:"default"})],jh.prototype,"mode",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],jh.prototype,"hasPendingInputs",null),(0,Ze._)([(0,nt.Cb)()],jh.prototype,"latestPointerType",null),(0,Ze._)([(0,nt.Cb)()],jh.prototype,"latestPointerLocation",null),(0,Ze._)([(0,nt.Cb)()],jh.prototype,"_inputManager",void 0),jh=(0,Ze._)([(0,ui.j)("esri.views.3d.input.SceneInputManager")],jh);const k1=new Map,Y1=new Map,J1=new Map;Y1.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),Y1.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),J1.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),J1.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),k1.set("default",Y1),k1.set("pro",J1);const f3=jh;var Ua=T(77029),Sl=T(993),Yl=T(93605);let qu,x_,X1=!1,Q1=!1,q1=!1,eb=!1,Jm=null;function JO(){Jm&&(Jm(),Jm=null)}function XO(_,v,O,D,w){JO();const te=qu.height,fe=x_;fe.beginPath(),fe.lineWidth=1,fe.strokeStyle=w,fe.moveTo(_,te-O),fe.lineTo(v,te-O),fe.stroke(),fe.lineTo(v,te-D),fe.stroke(),fe.lineTo(v,te-O),fe.stroke(),fe.lineTo(_,te-O),fe.stroke(),fe.lineTo(_,te-O),fe.stroke(),fe.closePath()}function y3(_,v){X1&&(v&&q1||!v&&eb)&&XO(_.aabr[0],_.aabr[2],_.aabr[1],_.aabr[3],v?"green":"red")}var rl=T(79721),sv=T(17962),QO=T(80805);const Fh=(0,$t.c)(),D_=(0,vi.c)(),Xm=(0,vi.c)(),tb=(0,$t.c)(),v3=(0,Zn.c)(),E3=(0,aa.c)(),rb=(0,Yu.Ue)(),b3=(0,$t.c)(),C3=(0,qr.Ue)();class T3{constructor(){this.aabr=(0,qr.Ue)(),this.distance=0,this.culled=!1,this.visible=!1}}class M3{constructor(v,O,D={}){this.graphics3DGraphic=v,this.slicePlaneEnabled=O,this.info=D}}class O3{constructor(){this.active=new Map,this.visible=new Map}clear(){this.active.clear(),this.visible.clear()}}class P3{}class x3{constructor(){this.sortArray=new Ua.Z({allocator:v=>v||new P3})}}var Ou;!function(_){_[_.Idle=0]="Idle",_[_.Process=1]="Process",_[_.Sort=2]="Sort",_[_.Deconflict=3]="Deconflict",_[_.NumStates=4]="NumStates"}(Ou||(Ou={}));class qO{constructor(){this.camera=new $n.V,this.slicePlane=(0,_s.c)(),this.slicePlaneEnabled=!1}copyFrom(v){this.camera.copyFrom(v.camera),(0,_s.a)(v.slicePlane,this.slicePlane),this.slicePlaneEnabled=v.slicePlaneEnabled}}let A_=class extends Bi.Z{constructor(){super(...arguments),this._dirty=!1,this._runningViewState=new qO,this._state=Ou.Idle,this.graphics=new O3,this.iterators=new x3,this.accBinsNumX=15,this.accBinsNumY=20,this.accBinsSizeX=0,this.accBinsSizeY=0,this.accBins=null,this.accNumTests=0}get dirty(){return this._dirty}get state(){return this._state}destroy(){this.graphics.clear(),this.iterators=null}setDirty(){!this._dirty&&this.graphics.active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Ou.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const _=this._state/Ou.NumStates;return this._dirty?.5*_:_}get running(){return this.view.ready&&null!=this.view.state&&this.updating}runTask(_){switch(this._state){case Ou.Idle:this._startUpdate(),_.madeProgress();case Ou.Process:if(this._state=Ou.Process,!this._processActiveGraphics(_))return;case Ou.Sort:if(this._state=Ou.Sort,!this._sortVisibleGraphics(_))return;case Ou.Deconflict:if(this._state=Ou.Deconflict,!this._deconflictVisibleGraphics(_))return;default:(function _3(_,v){if(!Q1||!x_)return;JO();const O=x_;let D=0;for(let w=0;w<_.accBinsNumX;w++)for(let te=0;te<_.accBinsNumY;te++){const fe=_.accBins[w][_.accBinsNumY-1-te];D+=fe.length;const Pe=w*_.accBinsSizeX,Ue=(w+1)*_.accBinsSizeX,Xe=te*_.accBinsSizeY,st=(te+1)*_.accBinsSizeY;O.fillText(fe.length.toFixed(),Pe+5,Xe+15),XO(Pe,Ue,Xe,st,"blue")}O.fillText("total totalShownLabels: "+D,70,40),O.fillText("total visible labels: "+v.size,70,50),O.fillText("total numTests: "+_.accNumTests,70,30)})(this,this.graphics.visible),this._state=Ou.Idle,this.notifyChange("updating")}}modifyGraphics(_,v){_.forEach(v?O=>this.addToActiveGraphics(O):O=>this.removeFromActiveGraphics(O)),this.setDirty()}layerSupportsDeconfliction(_){if((0,lt.Wi)(_)||"object3d"!==_.type)return!1;const v=_.stageObject;return 1===(v?v.geometryRecords.length:0)&&v.geometryRecords[0].material instanceof QO.A}_startUpdate(){(function m3(_){q1=Yl.Z.DECONFLICTOR_SHOW_VISIBLE,eb=Yl.Z.DECONFLICTOR_SHOW_INVISIBLE,X1=q1||eb,Q1=Yl.Z.DECONFLICTOR_SHOW_GRID,Jm=null,X1||Q1?Jm=()=>function g3(_){null==qu&&(qu=document.createElement("canvas"),qu.setAttribute("id","canvas2d"),_.surface.parentElement.style.position="relative",_.surface.parentElement.appendChild(qu));const{state:v}=_,{camera:O,pixelRatio:D}=v,{width:w,height:te}=O,Pe=te*D;qu.setAttribute("width",w*D+"px"),qu.setAttribute("height",`${Pe}px`),qu.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${w}px;height:${te}px`),x_=qu.getContext("2d"),x_.clearRect(0,0,w,te),x_.font="12px Arial"}(_):qu&&(qu.parentElement.removeChild(qu),qu=null)})(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:_,fullHeight:v}=this._runningViewState.camera;this._initBins(_,v),this._resetIterators()}addToActiveGraphics(_){_.info[this.visibilityGroup]=new T3,this.graphics.active.set(_.graphics3DGraphic.graphic.uid,_),this.setDirty()}removeFromActiveGraphics(_){this._removeFromVisibleGraphics(_),function D3(_,v){const O=_.graphics3DGraphic;O.destroyed||O.clearVisibilityFlag(rl.P.DECONFLICTION,v)}(_,this.visibilityGroup),delete _.info[this.visibilityGroup],this.graphics.active.delete(_.graphics3DGraphic.graphic.uid),this.setDirty()}_addToVisibleGraphics(_){this.graphics.visible.set(_.graphics3DGraphic.graphic.uid,_)}_removeFromVisibleGraphics(_){this.graphics.visible.delete(_.graphics3DGraphic.graphic.uid)}_processActiveGraphics(_){const v=this._ensureActiveGraphicsIterator(),O=(0,js.a)(v3,this._runningViewState.camera.projectionMatrix),D="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this._runningViewState.camera.relativeElevation>0?E3:null;let w=0;for((0,lt.pC)(D)&&((0,_t.m)(D,$t.Z,this._runningViewState.camera.viewMatrix),D[3]=(0,Zi.Iu)(this.view.spatialReference).radius,w=(0,aa.e)(D,$t.Z));!_.done;){_.madeProgress();const te=v.next();if(!0===te.done)return this._resetActiveGraphicsIterator(),!0;const fe=te.value,Pe=fe&&fe.info[this.visibilityGroup];Pe&&(this._collectGraphics3DGraphics(fe,O,D,w),Pe.culled?this._removeFromVisibleGraphics(fe):this._addToVisibleGraphics(fe))}return!1}_sortVisibleGraphics(_){const v=this._ensureSortGraphicsIterator();for(;!_.done;){const O=v.next();if(_.madeProgress(),!0===O.done)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(_){const v=this._ensureVisibleGraphicsIterator(),O=this.visibilityGroup===rl.E.LABEL;for(;!_.done;){_.madeProgress();const D=v.next();if(!0===D.done)return this._resetVisibleGraphicsIterator(),!0;const w=D.value,te=w.info[this.visibilityGroup];if(!te||te.culled)continue;const fe=w.graphics3DGraphic,Pe=(!O||fe.isVisible())&&!this._isConflicted(w);Pe&&this._addToBins(w),te.visible=Pe,this._setGraphicVisibility(w,Pe),y3(te,Pe)}return!1}_resetIterators(){this.iterators.active=null,this.iterators.visible=null,this.iterators.sort=null}_ensureActiveGraphicsIterator(){return this.iterators.active||(this.iterators.active=eP(this.graphics.active)),this.iterators.active}_resetActiveGraphicsIterator(){this.iterators.active=null}_ensureVisibleGraphicsIterator(){return this.iterators.visible||(this.iterators.visible=eP(this.graphics.visible)),this.iterators.visible}_resetVisibleGraphicsIterator(){this.iterators.visible=null}_ensureSortGraphicsIterator(){return this.iterators.sort||(this.iterators.sort=function*A3(_,v,O){v.clear(),_.forEach((w,te)=>{const fe=v.pushNew();fe.id=te,fe.prio=w.info?-w.info[O].distance:Number.MAX_VALUE}),yield;const D=v.iterableSort((w,te)=>te.prio-w.prio);for(let w=D.next();!w.done;w=D.next())yield;v.forAll(w=>{const te=_.get(w.id);te&&(_.delete(w.id),_.set(w.id,te))}),v.clear()}(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup)),this.iterators.sort}_resetSortGraphicsIterator(){this.iterators.sort=null}_collectGraphics3DGraphics(_,v,O,D){const w=_.graphics3DGraphic;if(w.destroyed)return;const te=_.info[this.visibilityGroup];if(!w.isVisible(rl.E.GRAPHIC,rl.P.DECONFLICTION))return void(te.culled=!0);const fe=this.getGraphicsLayers(w);(0,qr.cS)(te.aabr);let Pe=null;for(const Ue of fe){if(!this.layerSupportsDeconfliction(Ue))continue;const Xe=Ue.stageObject.geometryRecords[0].material;if((0,lt.Wi)(Pe)){if(Pe=this._getProjectionInfo(Ue,v,w3),Pe.isOutsideScreen||this._isCulledBySlice(_,Fh)||(0,lt.pC)(O)&&this._isCulledByHorizon(Pe,O,D))return void(te.culled=!0);!Yl.Z.TESTS_DISABLE_OPTIMIZATIONS&&te.visible&&(Pe.distance*=.7)}this._expandBoundingRect(te,Ue,Xe,Pe)}(0,lt.Wi)(Pe)?te.culled=!0:(te.distance=Pe.distance,te.culled=!1)}_getProjectionInfo(_,v,O){const D=this._runningViewState.camera,w=_.stageObject,te=w.geometryRecords[0],fe=te.material,Pe=(0,aa.g)(w.boundingVolumeWorldSpace.bounds);(0,_t.m)(Fh,Pe,D.viewMatrix);const Ue=te.geometry.vertexAttributes,Xe=Ue.get(Fo.T.NORMAL).data,st=Ue.get(Fo.T.AUXPOS1).data;return fe.applyShaderOffsetsView(Fh,Xe,w.transformation,st,D,O.scaleInfo,Fh),(0,Sl.s)(D_,Fh[0],Fh[1],Fh[2],1),(0,Sl.t)(Xm,D_,D.projectionMatrix),(0,_t.g)(O.positionNDC,Xm,1/Xm[3]),fe.applyShaderOffsetsNDC(O.positionNDC,st,D,O.positionNDC,tb),O.distanceWithoutPolygonOffset=D.depthNDCToWorld(tb[2]),O.distance=tb[2]===O.positionNDC[2]?O.distanceWithoutPolygonOffset:D.depthNDCToWorld(O.positionNDC[2]),(0,Sl.s)(Xm,O.positionNDC[0],O.positionNDC[1],O.positionNDC[2],1),(0,Sl.t)(D_,Xm,v),(0,Sl.b)(D_,D_,1/D_[3]),(0,_t.s)(O.positionView,Fh[0],Fh[1],Fh[2]),O}_isCulledByHorizon(_,v,O){return(0,_t.c)(rb.direction,_.positionView),(0,_t.s)(rb.origin,0,0,0),!!(0,aa.h)(v,rb,b3)&&_.distanceWithoutPolygonOffset>O}_isCulledBySlice(_,v){return _.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&(0,_s.e)(this._runningViewState.slicePlane,v)}_expandBoundingRect(_,v,O,{positionNDC:D,scaleInfo:w}){const te=this._runningViewState.camera,fe=v.getScreenSize(S3);(0,sv.TU)(fe,w.factor,fe),fe[0]*=te.pixelRatio,fe[1]*=te.pixelRatio;const Pe=(0,qr.cv)(O.calculateRelativeScreenBounds(fe,w.factorAlignment.scale,C3),(0,li.t7)(0,te.fullWidth,.5+.5*D[0]),(0,li.t7)(0,te.fullHeight,.5+.5*D[1])),Ue=this.iconMarginFactor;if(0!==Ue){const Xe=Ue*Math.min((0,qr.bf)(Pe),(0,qr.Cb)(Pe));Pe[0]-=Xe,Pe[1]-=Xe,Pe[2]+=Xe,Pe[3]+=Xe}(0,qr.jn)(_.aabr,Pe,_.aabr)}_isConflicted(_){const v=_.graphics3DGraphic.graphic.uid,O=_.info[this.visibilityGroup];for(let D=Math.floor(O.aabr[0]/this.accBinsSizeX);D<=Math.floor(O.aabr[2]/this.accBinsSizeX);D++)if(!(D<0||D>=this.accBinsNumX))for(let w=Math.floor(O.aabr[1]/this.accBinsSizeY);w<=Math.floor(O.aabr[3]/this.accBinsSizeY);w++){if(w<0||w>=this.accBinsNumY)continue;const te=this.accBins[D][w];for(let fe=0;fe<te.length;fe++){const Pe=te.data[fe],Ue=Pe.info[this.visibilityGroup];if(Ue&&Ue.visible&&Pe.graphics3DGraphic.graphic.uid!==v&&(this.accNumTests++,(0,qr.kK)(Ue.aabr,O.aabr)))return!0}}return!1}_initBins(_,v){if(null==this.accBins){this.accBins=[];for(let O=0;O<this.accBinsNumX;O++){this.accBins.push([]);const D=this.accBins[this.accBins.length-1];for(let w=0;w<this.accBinsNumY;w++)D.push(new Ua.Z)}}else for(let O=0;O<this.accBinsNumX;O++)for(let D=0;D<this.accBinsNumY;D++)this.accBins[O][D].clear();this.accBinsSizeX=_/this.accBinsNumX,this.accBinsSizeY=v/this.accBinsNumY,this.accNumTests=0}_addToBins(_){const v=_.info[this.visibilityGroup],O=Math.floor(v.aabr[0]/this.accBinsSizeX),D=Math.floor(v.aabr[2]/this.accBinsSizeX),w=Math.floor(v.aabr[1]/this.accBinsSizeY),te=Math.floor(v.aabr[3]/this.accBinsSizeY);for(let fe=O;fe<=D;fe++)if(!(fe<0||fe>=this.accBinsNumX))for(let Pe=w;Pe<=te;Pe++)Pe<0||Pe>=this.accBinsNumY||this.accBins[fe][Pe].push(_)}_setGraphicVisibility(_,v){const O=_.graphics3DGraphic;O.destroyed||(O.setVisibilityFlag(rl.P.DECONFLICTION,v,this.visibilityGroup),this.visibilityGroup===rl.E.LABEL&&this.view.labeler.setLabelGraphicVisibility(O,v))}};function*eP(_){if(Map.prototype.entries){const v=_.entries();for(let O=v.next();!O.done;O=v.next())yield O.value[1]}else yield*_.values()}(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],A_.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],A_.prototype,"updating",null),A_=(0,Ze._)([(0,ui.j)("esri.views.3d.layers.graphics.Deconflictor")],A_);const S3=(0,Li.a)(),w3=new class R3{constructor(){this.positionView=(0,$t.c)(),this.positionNDC=(0,$t.c)(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}get isOutsideScreen(){const v=this.positionNDC;return v[0]<-1||v[1]<-1||v[2]<-1||v[0]>=1||v[1]>=1}};let nv=class extends A_{constructor(){super(...arguments),this.visibilityGroup=rl.E.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(_){if(this.parent.running)return;const v=performance.now();(_.state===Gn.ZM.IDLE||v-this._lastDeconfliction>2e3)&&(super.runTask(_),this.state===Ou.Idle&&(this._lastDeconfliction=v))}enabledChanged(_,v){this.modifyGraphics(v,_.labelsEnabled)}getGraphicsLayers(_){return _.labelGraphics}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],nv.prototype,"parent",void 0),nv=(0,Ze._)([(0,ui.j)("esri.views.3d.layers.graphics.LabelDeconflictor")],nv);let ib=class extends A_{constructor(){super(...arguments),this._handles=new cn.Z,this._contexts=new Map,this._viewState=new qO,this.visibilityGroup=rl.E.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([(0,pt.YP)(()=>{var _,v;return null==(v=null==(_=this.view)?void 0:_.state)?void 0:v.camera},()=>{this._updateViewState(),this.setDirty()}),(0,pt.YP)(()=>{var _,v,O;return null==(O=null==(v=null==(_=this.view)?void 0:_.map)?void 0:v.ground)?void 0:O.opacity},(_,v)=>{1!==_&&1!==v||this.setDirty()}),(0,pt.YP)(()=>{var _;return null==(_=this.view)?void 0:_.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},pt.nn)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Gn.T8.GRAPHICS_DECONFLICTOR,this),this._labels=new nv({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(_){this._iconMarginFactor=_,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(_){super.runTask(_),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(_,v){const O=!(this._graphicSupportsDeconfliction(v)&&sb(_));v.setVisibilityFlag(rl.P.DECONFLICTION,O,rl.E.GRAPHIC)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const _=this.view?this.view.slicePlane:null;(0,lt.pC)(_)&&(0,_s.t)(_,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=(0,lt.pC)(_)}_slicePlaneChanged(){(0,ya.oE)(this._contexts,(_,v)=>v.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(_){let v=this._contexts.get(_);return null==v&&(v=new Map,this._contexts.set(_,v),this.setDirty()),{addGraphic:O=>this._addGraphic(_,v,O),removeGraphic:O=>this._removeGraphic(v,O),labelingInfoChange:()=>this._labels.enabledChanged(_,v),featureReductionChange:()=>this.enabledChanged(_,v),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(_,v),clear:()=>v.forEach(O=>this._removeGraphic(v,O.graphics3DGraphic))}}removeGraphicsOwner(_){const v=this._contexts.get(_);v&&(v.forEach(O=>this._removeGraphic(v,O.graphics3DGraphic)),this._contexts.delete(_),this.setDirty())}_addGraphic(_,v,O){const D=O.graphic.uid,w=new M3(O,_.symbolCreationContext.slicePlaneEnabled);v.set(D,w),sb(_)&&this.addToActiveGraphics(w),_.labelsEnabled&&this._labels.addToActiveGraphics(w)}_removeGraphic(_,v){const O=v.graphic.uid,D=_.get(O);D&&(this.removeFromActiveGraphics(D),this._labels.removeFromActiveGraphics(D),_.delete(O),this.setDirty())}enabledChanged(_,v){const O=sb(_);O||function L3(_){const v=_.graphics3DGraphics;v&&v.forEach(O=>O.clearVisibilityFlag(rl.P.DECONFLICTION))}(_),this.modifyGraphics(v,O)}_slicePlaneEnabledChanged(_,v){const O=_.symbolCreationContext.slicePlaneEnabled;v.forEach(D=>D.slicePlaneEnabled=O),this.setDirty()}getGraphicsLayers(_){return _.graphics}_graphicSupportsDeconfliction(_){if(_.isDraped)return!1;const v=_.graphics;if(!v||!v.length)return!1;for(const O of v)if(this.layerSupportsDeconfliction(O))return!0;return!1}};function sb(_){const v=_.layer;return!(!v||!v.featureReduction||"selection"!==v.featureReduction.type)}ib=(0,Ze._)([(0,ui.j)("esri.views.3d.layers.graphics.GraphicsDeconflictor")],ib);var Qm=T(59213),U3=T(84786),B3=T(22445),N3=T(9824),j3=T(18170),F3=T(23641),W3=T(95428),V3=T(13939);function nb(_){return _ instanceof V3.Z?_.graphics3DSymbol:_ instanceof W3.Z?_:null}var Ea=T(5548);const qm=pn.Z.getLogger("esri.views.3d.layers.graphics.labelPlacement");function z3(_){const v=function X3(_){const v=_.labelClass.labelPlacement,{labelSymbol:O,graphics3DGraphic:D}=_,w=nb(D.graphics3DSymbol),te=(0,lt.yw)(w,Pe=>"point-3d"===Pe.symbol.type?Pe.symbol:null),fe=ah[v]||ov(_);return(0,lt.pC)(te)&&te.supportsCallout()&&te.hasVisibleVerticalOffset()&&!D.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:rP(te.verticalOffset),anchor:null,normalizedOffset:null}:O&&O.hasVisibleVerticalOffset()&&((0,lt.Wi)(te)||!te.supportsCallout()||!te.verticalOffset||D.isDraped)?function J3(_){return"above-center"===_}(fe.placement)?{placement:"above-center",verticalOffset:rP(O.verticalOffset),anchor:"bottom",normalizedOffset:[0,fe.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(qm.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+v+" placement)"),null):{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}(_);if((0,lt.Wi)(v))return null;const O=function G3(_,v){if(v.anchor)return v;const O=_.labelClass.labelPlacement,D=ah[O],w=D||ov(_);return O&&!D&&qm.warnOncePerTick(`the requested label placement '${O}' is currently unsupported in SceneView.`),function H3(_,v){const O=v.graphics3DGraphic.graphic.geometry;if((0,lt.Wi)(O))return null;if((0,lt.pC)(v.disablePlacement))return v.labelClass.labelPlacement?(qm.warnOncePerTick(tP(_.placement,v.disablePlacement.logEntityDescription)),ov(v)):_;const D=O.type;switch(D){case"polyline":case"polygon":case"extent":case"multipoint":if(v.labelClass.labelPlacement)return qm.warnOncePerTick(tP(_.placement,`'${D}' geometries`)),ov(v);break;case"point":case"mesh":return _}return _}(w,_)}(_,v);if((0,lt.Wi)(O))return null;const w=!!v.hasLabelVerticalOffset;return function K3(_,v,O){const D=O.graphics3DGraphic.graphic.geometry;if((0,lt.Wi)(D))return null;switch(D.type){case"point":!function $3(_,v,O){const D=ob(O);if((0,lt.Wi)(D))return;const w=O.graphics3DGraphic.graphics[0];switch((0,lt.pC)(w)?w.getCenterObjectSpace(_.translation):(0,_t.s)(_.translation,0,0,0),D.type){case"icon":case"text":!function k3(_,v,O,D){const{graphics3DGraphic:w}=O,te=(0,lt.pC)(D)?D.getScreenSize():null;if(!w.isDraped&&(0,lt.pC)(te)){const fe=function Y3(_,v=Q3){const{graphics3DGraphic:O}=_,D=O.graphics[0],w=(0,lt.pC)(D)?D.stageObject.geometryRecords[0].material:null;if(w&&w instanceof QO.A){const te=w.parameters.anchorPosition;v[0]=2*(te[0]-.5),v[1]=2*(te[1]-.5)}else v[0]=0,v[1]=0;return v}(O);eg[0]=te[0]/2*(v.normalizedOffset[0]-fe[0]),eg[1]=te[1]/2*(v.normalizedOffset[1]-fe[1]),_.screenOffset[0]=eg[0],_.hasLabelVerticalOffset?(_.centerOffset[1]=eg[1],_.centerOffsetUnits="screen"):_.screenOffset[1]=eg[1]}else _.hasLabelVerticalOffset||"center"===_.anchor||(ah[O.labelClass.labelPlacement]&&qm.warnOncePerTick(`the requested placement '${v.placement}' is currently unsupported for draped graphics`),_.anchor="center")}(_,v,O,w);break;case"object":ab(_,v,w)}}(_,v,O);break;case"polygon":!function Z3(_,v,O){const D=ob(O);if(!(0,lt.Wi)(D))switch(D.type){case"extrude":{const w=O.graphics3DGraphic.graphics[0];(0,lt.pC)(w)?(w.getBoundingBoxObjectSpace(tg),(0,Ea.be)(tg,_.translation),_.translation[2]=(0,Ea.Cb)(tg)/2):(0,_t.s)(_.translation,0,0,0),ab(_,v,w);break}}}(_,v,O);break;case"mesh":ab(_,v,O.graphics3DGraphic.graphics[0])}return _}({anchor:O.anchor,verticalOffset:v.verticalOffset,screenOffset:(0,Li.a)(),centerOffset:(0,vi.f)(0,0,0,-1),centerOffsetUnits:"world",translation:(0,$t.c)(),elevationOffset:0,hasLabelVerticalOffset:w},O,_)}function ob(_){const O=nb(_.graphics3DGraphic.graphics3DSymbol);return(0,lt.pC)(O)?O.symbol.symbolLayers.getItemAt(0):null}function tP(_,v){return`the requested label placement '${_}' is currently unsupported for ${v} in SceneView.`}function ov(_){const v=_.graphics3DGraphic.graphic.geometry;if((0,lt.Wi)(v))return null;switch(v.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const O=ob(_);return(0,lt.pC)(O)&&"extrude"===O.type?ah["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return ah["above-center"];default:return}}function ab(_,v,O){const D=(0,lt.pC)(O)?O.getBoundingBoxObjectSpace(tg):tg,w=(0,$t.f)(D[3]-D[0],D[4]-D[1],D[5]-D[2]),te=Math.sqrt(w[0]*w[0]+w[1]*w[1]);_.centerOffset[0]=te/2*v.normalizedOffset[0];const fe=_.translation[2],Pe=w[2]/2*v.normalizedOffset[1];_.translation[2]=0,_.elevationOffset=fe+Pe;const Ue=(0,_t.l)(w);_.centerOffset[2]=Ue/2*v.normalizedOffset[2]}function rP(_){const{screenLength:v,minWorldLength:O,maxWorldLength:D}=_;return{screenLength:v,minWorldLength:O,maxWorldLength:D}}const ah={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},iP={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const _ in iP){const O=ah[_];iP[_].forEach(D=>{ah[D]=O})}Object.freeze&&(Object.freeze(ah),Object.keys(ah).forEach(_=>{Object.freeze(ah[_]),Object.freeze(ah[_].normalizedOffset)}));const eg=[0,0],Q3=[0,0],tg=(0,Ea.Ue)();var av=T(75688);class sP{constructor(v){this._stage=v,this._materials=new Map}get(v){return this._materials.get(v)}add(v,O){this._materials.set(v,O),this._stage.add(O)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}}var q3=T(6169),eL=T(65542),lv=T(86236),lb=T(24425),tL=T(39782);let rg=class extends Bi.Z{constructor(_){super(_),this.type=lb.U.Texture,this.id=(0,lv.D)(),this.events=new sa.Z,this._glTexture=null,this.needsClear=!1,this.elementsToAddOrUpdate=new Map,this.elementsToRemove=new Map,this.elementsToRender=new Map,this.elements=new Map,this.stageObjects=new Map,this.updating=!1}initialize(){this.stage=this.view._stage,this.canvas=this._create2DCanvas(),this.ctx=this.canvas.getContext("2d"),this.stage.add(this);const _=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(_),this._update2DCanvasSize(),this._resetAtlasCursor()}unload(){this._glTexture=(0,lt.O3)(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get width(){return this.atlas.size.width}get height(){return this.atlas.size.height}get requiresFrameUpdates(){return!1}_createDescriptor(_){return{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,flipped:!0,samplingMode:Jt.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:_.parameters.maxMaxAnisotropy}}get glTexture(){return this._glTexture}load(_){return(0,lt.pC)(this._glTexture)||(this._glTexture=new ka.x(_,this._createDescriptor(_),this.canvas),this.frameWorker=this.view.resourceController.scheduler.registerTask(Gn.T8.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this.elements=null,this.elementsToAddOrUpdate=null,this.elementsToRemove=null,this.elementsToRender=null,this.frameWorker=(0,lt.hw)(this.frameWorker),this._glTexture&&(this.stage.remove(this),this._glTexture=(0,lt.O3)(this._glTexture)),this.canvas.width=0,this.canvas.height=0,this.canvas=null,this.ctx=null}_create2DCanvas(){const _=document.createElement("canvas");return _.setAttribute("id","canvas2d"),_.setAttribute("style","display:none"),_.setAttribute("width",512..toString()),_.setAttribute("height",512..toString()),_}_update2DCanvasSize(){this.canvas.setAttribute("width",this.atlas.size.width.toString()),this.canvas.setAttribute("height",this.atlas.size.height.toString())}_createAtlasRegion(_=512){this.atlas={size:{width:_,height:_},cursor:{x:0,y:0},lineHeight:0}}_computeAtlasResolution(_,v){let O=Math.max(_,v);return O+=256,O=(0,li.Sf)(O),O=Math.min(O,4096),O}_resizeAtlas(_,v){v=v||_;const O=this.atlas;O.size.width=_,O.size.height=v,(0,lt.pC)(this._glTexture)&&this._glTexture.resize(_,v),this._update2DCanvasSize()}_resetAtlasCursor(){const _=this.atlas;_.cursor.x=ig,_.cursor.y=ig+nP,_.lineHeight=0,this.needsClear=!0}_getAtlasUsage(){const _=this.atlas;return(_.cursor.x+_.cursor.y*_.size.width)/(_.size.width*_.size.height)}_getExpectedAtlasUsage(){const _=this.elementsToRemove.size,v=this.elementsToAddOrUpdate.size,O=this.elements.size;return this._getAtlasUsage()/O*(O+v-_)}_addAtlasElement(_,v,O,D){const w=this.atlas,{renderedWidth:te,renderedHeight:fe,displayWidth:Pe,displayHeight:Ue}=_.textRenderer;_.placement.offset.x=w.cursor.x,_.placement.offset.y=w.cursor.y,_.placement.size.width=te,_.placement.size.height=fe,_.placement.size.displayWidth=Pe,_.placement.size.displayHeight=Ue,_.placement.uvMinMax=[_.placement.offset.x/w.size.width,1-(_.placement.offset.y+fe)/w.size.height,(_.placement.offset.x+te)/w.size.width,1-_.placement.offset.y/w.size.height],w.cursor.x+=O,w.lineHeight=Math.max(w.lineHeight,D),this.elements.set(v,_)}_removeAtlasElement(_){if(_&&this.elements.has(_.textId)){const v=_.placement.offset,O=_.placement.size;this.ctx.clearRect(v.x,v.y,O.width,O.height),this.elements.delete(_.textId)}}_ensureStageObjects(_){const v=this.stageObjects.get(_);if(v)return v;const O=new Set;return this.stageObjects.set(_,O),O}_addStageObject(_,v){this._ensureStageObjects(_).add(v)}_removeStageObject(_,v){const O=this.stageObjects.get(_);O&&O.delete(v)&&(v.geometries[0].vertexAttributes.get(Fo.T.SIZE).data=[0,0],v.geometryVertexAttrsUpdated(v.geometryRecords[0]))}_processAddition(_,v){const O=this.atlas,D=_.textId,fe=_.textRenderer.renderedWidth+ig,Pe=_.textRenderer.renderedHeight+ig+nP;if(O.cursor.x+fe<O.size.width&&O.cursor.y+Pe<O.size.height)this._addAtlasElement(_,D,fe,Pe),this.elementsToRender.set(D,_),this.elementsToAddOrUpdate.delete(D);else{if(!(O.cursor.y+Pe+O.lineHeight<O.size.height)){const Ue=this._getExpectedAtlasUsage(),Xe=Ue>.85&&O.size.width<4096;return Xe&&this._resizeAtlas(2*O.size.width,2*O.size.height),!v||!Xe&&Ue>.95&&4096===O.size.width?(this._processRemovals(),S_.OK):(this._repack(),S_.REPACK)}O.cursor.x=ig,O.cursor.y+=O.lineHeight,O.lineHeight=0,this._addAtlasElement(_,D,fe,Pe),this.elementsToRender.set(D,_),this.elementsToAddOrUpdate.delete(D)}return S_.OK}_processRemovals(){this.elementsToRemove.forEach((_,v)=>{const O=this.stageObjects.get(v);O&&0!==O.size||this._removeAtlasElement(_),O&&0===O.size&&this.stageObjects.delete(v)}),this.elementsToRemove.clear()}_repack(){this._processRemovals(),this.elements.forEach((_,v)=>{_.rendered=!1,this.elementsToAddOrUpdate.set(v,_)}),this.elements.clear(),this._resetAtlasCursor(),this.elementsToRender.clear()}_processRenderingRequest(_){this.ctx.clearRect(_.placement.offset.x,_.placement.offset.y,_.placement.size.width,_.placement.size.height),_.textRenderer.render(this.ctx,_.placement.offset.x,_.placement.offset.y);const v=this.stageObjects.get(_.textId);v&&v.forEach(O=>{O.geometries[0].vertexAttributes.get(Fo.T.UV0).data=new Float32Array(_.placement.uvMinMax),O.geometries[0].vertexAttributes.get(Fo.T.SIZE).data=[_.placement.size.displayWidth,_.placement.size.displayHeight],O.geometryVertexAttrsUpdated(O.geometryRecords[0])}),_.rendered=!0}get running(){return this.updating}runTask(_,v=!0){if(!this._glTexture)return;let O=!1;if((0,ya.oE)(this.elementsToAddOrUpdate,(w,te)=>{const fe=this.elements.get(te);if(fe&&fe.rendered){const Pe=this.stageObjects.get(te);return Pe&&Pe.forEach(Ue=>{const Xe=Ue.geometries[0].vertexAttributes,st=this.elements.get(te);Xe.get(Fo.T.UV0).data=new Float32Array(st.placement.uvMinMax),Xe.get(Fo.T.SIZE).data=new Float32Array([st.placement.size.displayWidth,st.placement.size.displayHeight]),Ue.geometryVertexAttrsUpdated(Ue.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(te),!1}return this._processAddition(this.elementsToAddOrUpdate.get(te),v)===S_.REPACK&&(O=!0,!0)}),O)return void this.runTask(Gn.G5,!1);let D=!1;this.elementsToRender.size>0&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1),(0,ya.oE)(this.elementsToRender,(w,te)=>(this._processRenderingRequest(w),this.elementsToRender.delete(te),D=!0,_.madeProgress(),_.done)),D&&(0,lt.pC)(this._glTexture)&&this._glTexture.setData(this.canvas),this.updating=this.elementsToRender.size>0,!this.updating&&tL.y.orderedRepackingEnabled&&this.repackOrdered()}addTextTexture(_,v){const O=_.key;this.elementsToAddOrUpdate.has(O)||this.elementsToAddOrUpdate.set(O,{textId:O,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:_,rendered:!1}),this._addStageObject(O,v),this.elementsToRemove.delete(O),this.setDirty()}removeTextTexture(_,v){const O=_.key;this.elementsToRemove.set(O,this.elements.get(O)),this._removeStageObject(O,v)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(0===this.elements.size)return;const _=[];this.elements.forEach((O,D)=>_.push({element:O,key:D}));let v=!0;for(let O=0;O<_.length-1;O++)if(_[O].key.localeCompare(_[O+1].key)>0){v=!1;break}if(!v||this.elementsToRemove.size){_.sort((O,D)=>O.key.localeCompare(D.key)),this.elements.clear();for(const{element:O,key:D}of _)this.elements.set(D,O);this._repack(),this.setDirty()}}get test(){const{elements:_,stageObjects:v,elementsToRemove:O,atlas:D}=this,w=this;return{elements:_,stageObjects:v,elementsToRemove:O,atlas:D,_resizeAtlas:(te,fe)=>w._resizeAtlas(te,fe),run:(te,fe)=>w.runTask(te,fe)}}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],rg.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],rg.prototype,"updating",void 0),rg=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],rg);const ig=2,nP=2;var S_;!function(_){_[_.OK=0]="OK",_[_.REPACK=1]="REPACK"}(S_||(S_={}));var sg=T(34103);const oP=pn.Z.getLogger("esri.views.3d.layers.graphics.Labeler");let Uf=class extends Bi.Z{constructor(){super(...arguments),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new cn.Z,this._handles.add([(0,pt.YP)(()=>{var _;return null==(_=this.view.state)?void 0:_.camera},()=>this.setDirty()),(0,pt.YP)(()=>{var _;return null==(_=this.view.state)?void 0:_.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Gn.T8.LABELER,this)]),this._textTextureAtlas=new rg({view:this.view}),this._hudMaterialCollection=new sP(this.view._stage),this._calloutMaterialCollection=new sP(this.view._stage)}dispose(){this._handles=(0,lt.SC)(this._handles),this._textTextureAtlas=(0,lt.O3)(this._textTextureAtlas),this._hudMaterialCollection=(0,lt.O3)(this._hudMaterialCollection),this._calloutMaterialCollection=(0,lt.O3)(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}_activateLabelingContext(_){_.labels.forEach((v,O)=>{this._labels.set(O,v),v.graphics3DGraphic.setVisibilityFlag(rl.P.USER_SETTING,!0,rl.E.LABEL)}),_.active=!0}_deactivateLabelingContext(_){_.labels.forEach((v,O)=>{v.graphics3DGraphic.setVisibilityFlag(rl.P.USER_SETTING,!1,rl.E.LABEL),this.setLabelGraphicVisibility(v.graphics3DGraphic,!1),this._labels.delete(O)}),_.active=!1}_addLabelTextureToAtlas(_){for(const v of _.graphics3DGraphic.labelGraphics){if(!v._labelClass)continue;const O=_.textTextureResources.textRenderers[v._labelIndex];(0,lt.pC)(O)&&this._textTextureAtlas.addTextTexture(O,v.stageObject)}_.rendered=!0}_removeLabelTextureFromAtlas(_){for(const v of _.graphics3DGraphic.labelGraphics){if(!v._labelClass)continue;const O=_.textTextureResources.textRenderers[v._labelIndex];(0,lt.pC)(O)&&this._textTextureAtlas.removeTextTexture(O,v.stageObject)}_.rendered=!1}get running(){var _;return this.view.ready&&(this._dirty||(null==(_=this._textTextureAtlas)?void 0:_.updating)||this.deconflictor.running)}runTask(_){this._updateLabels(_),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(_)}_updateLabels(_){if(this._dirty){this._dirty=!1;for(const v of this._labelingContexts)if(sL(v)){if(!aP(v)){if(nL(v)){this._deactivateLabelingContext(v);continue}if(this._createLabelClassContext(v),db(v)){this._dirty=!0;continue}if(!aP(v))continue}(0,ya.oE)(v.labelsToInitialize,(O,D)=>(this._ensureGraphics3DResources(O)&&(this._labels.set(D,O),this.deconflictor.setDirty(),_.madeProgress()),(O.visible&&O.textTextureResources.initialized||!O.visible&&O.hasGraphics3DResources)&&(v.labelsToInitialize.delete(D),_.madeProgress()),_.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(v=>this._removeLabelTextureFromAtlas(v)),this._labelsToAdd.forEach(v=>this._addLabelTextureToAtlas(v)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}_createLabelClassContextAsync(_){var v=this;return(0,Ai.Z)(function*(){const O=_.labelClassAbortController.signal;yield _.layer.when(),(0,zi.k_)(O),_.scaleVisibility&&_.scaleVisibility.updateScaleRangeActive();const D=_.graphics3DCore,w=D.layer,te=w.labelingInfo&&w.labelingInfo.filter(Ue=>!!Ue.symbol);if(!te||0===te.length)return;const fe=new Array(te.length);let Pe=!1;yield(0,Qm.Ed)(te,function(){var Ue=(0,Ai.Z)(function*(Xe,st){const vt=Xe.symbol,Ct=nb(D.getOrCreateGraphics3DSymbol(vt));if((0,lt.Wi)(Ct))return void oP.error("Failed to create Graphics3DSymbol for label");yield Ct.load(),(0,zi.k_)(O);let Wt=null;(0,N3.Pd)(vt)&&vt.hasVisibleCallout()&&(Wt=(0,j3.S)(vt,D.symbolCreationContext),yield Wt.load(),(0,zi.k_)(O));const Kt=yield(0,Qm.q6)((0,B3.createLabelFunction)(Xe,_.layer.fieldsIndex,v.view.spatialReference));if((0,zi.k_)(O),!0===Kt.ok){const Lt=yield v._createTextRenderParameters(Ct.symbol);(0,zi.k_)(O),fe[st]={labelClass:Xe,labelFunction:Kt.value,graphics3DSymbol:Ct,graphics3DCalloutSymbolLayer:Wt,calloutSymbolLayerIndex:0,textRenderParameters:Lt}}else oP.error(`Label expression failed to evaluate: ${Kt.error}`),Pe=!0});return function(Xe,st){return Ue.apply(this,arguments)}}()),(0,zi.k_)(O),Pe||(_.labelClassContexts=fe)})()}_createLabelClassContext(_){var v=this;return(0,Ai.Z)(function*(){return _.labelClassPromise||(_.labelClassPromise=v._createLabelClassContextAsync(_).catch(O=>{if((0,zi.D_)(O))throw O;_.labelClassContexts=null}).then(()=>{_.labelClassAbortController=null,v.notifyChange("updating")}).catch(()=>{}),v.notifyChange("updating")),_.labelClassPromise})()}_createTextRenderParameters(_){var v=this;return(0,Ai.Z)(function*(){const O=_.symbolLayers.getItemAt(0);return O&&"text"===O.type?eL.V.fromSymbol(O,v.view.state.pixelRatio):null})()}_destroyLabelClassContext(_){for(const O of _.labelClassContexts)--O.graphics3DSymbol.referenced,O.graphics3DSymbol=null;const v=_.labelClassAbortController;_.labelClassAbortController=new AbortController,v&&v.abort(),_.labelClassContexts=[],_.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(_,v,O,D,w){const te={text:_.text,centerOffset:O.centerOffset,translation:O.translation,elevationOffset:O.elevationOffset,screenOffset:O.screenOffset,centerOffsetUnits:O.centerOffsetUnits,horizontalPlacement:(0,av.zi)(O.anchor),verticalPlacement:(0,av.EP)(O.anchor),verticalOffset:O.verticalOffset,debugDrawLabelBorder:Yl.Z.LABELS_SHOW_BORDER,displayWidth:_.displayWidth,displayHeight:_.displayHeight};return I0.graphic=v,I0.renderingInfo=null,I0.layer=D,w.createLabel(I0,te,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(_,v,O,D,w){const te={symbol:v,translation:D.translation,elevationOffset:D.elevationOffset,screenOffset:D.screenOffset,centerOffset:D.centerOffset,centerOffsetUnits:D.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};return I0.graphic=_,I0.renderingInfo=te,I0.layer=w,O.createGraphics3DGraphic(I0)}_ensureGraphics3DResources(_){if(_.hasGraphics3DResources)return!1;const v=_.graphics3DGraphic;if(v.destroyed)return!1;this._ensureTextTextureResources(_);const{textTextureResources:O}=_,D=_.labelingContext,w=D.labelClassContexts;if(!w||0===w.length||!D.emptySymbolLabelSupported&&0===v.graphics.length)return!1;let te=!1;const fe=v.graphic,Pe=D.layer,Ue=(0,Ws.C6)(D.layer),Xe=this.view._stage;for(let st=0;st<w.length;st++){const vt=O.textRenderers[st],Ct=O.labelPlacements[st];if((0,lt.Wi)(vt)||(0,lt.Wi)(Ct))continue;const Wt=w[st],Kt=Wt.graphics3DSymbol,Lt=Kt.symbol&&"label-3d"===Kt.symbol.type?Kt.symbol:null,nr=Kt.symbolLayers[0];if(!nr)continue;nr.setElevationInfoOverride(D.elevationInfoOverride);const sr=this._createTextSymbolGraphic(vt,fe,Ct,Pe,nr);if(!sr)return!1;sr._labelClass=Wt.labelClass,sr._labelIndex=st,v.addLabelGraphic(sr,Xe,D.stageLayer),v.setVisibilityFlag(rl.P.USER_SETTING,Ue,rl.E.LABEL),v.clearVisibilityFlag(rl.P.SCALE_RANGE,rl.E.LABEL),v.setVisibilityFlag(rl.P.DECONFLICTION,!1,rl.E.LABEL),te=!0;const Er=Wt.graphics3DCalloutSymbolLayer;if(Er&&Ct.hasLabelVerticalOffset){Er.setElevationInfoOverride(D.elevationInfoOverride);const yr=this._createLineCalloutGraphic(fe,Lt,Er,Ct,Pe);(0,lt.pC)(yr)&&(Wt.calloutSymbolLayerIndex=v.labelGraphics.length,v.addLabelGraphic(yr,Xe,D.stageLayer))}break}return D.scaleVisibility&&te&&D.scaleVisibility.updateGraphicLabelScaleVisibility(v),_.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(_){const v=_.labelingContext.labelClassContexts;for(const O of _.graphics3DGraphic.labelGraphics){if(null==O._labelClass)continue;const D=v[O._labelIndex].graphics3DSymbol.symbolLayers[0];null!=D&&D.onRemoveGraphic(O)}_.graphics3DGraphic.clearLabelGraphics(),_.hasGraphics3DResources=!1}_ensureTextTextureResources(_){const{textTextureResources:v}=_;if(v.initialized)return;const O=_.labelingContext,D=O.labelClassContexts;if(!D||0===D.length)return;const w=_.graphics3DGraphic.graphic;for(let te=0;te<D.length;te++){const fe=D[te];if(v.textRenderers[te]=null,v.labelPlacements[te]=null,!fe.textRenderParameters)continue;const Pe=fe.labelFunction;let Ue;if("arcade"===Pe.type)try{const sr=Pe.needsHydrationToEvaluate()?(0,U3.mW)(w,O.layer):w;Ue=Pe.evaluate(sr)}catch(sr){Ue=null}else Ue=Pe.evaluate(w);if((0,lt.Wi)(Ue)||""===Ue||/^\s+$/.test(Ue))continue;const Xe=fe.graphics3DSymbol,st=Xe.symbol&&"label-3d"===Xe.symbol.type?Xe.symbol:null;if(!Xe.symbolLayers[0])continue;const Kt=z3({graphics3DGraphic:_.graphics3DGraphic,labelSymbol:st,labelClass:fe.labelClass,disablePlacement:O.disablePlacement});if((0,lt.Wi)(Kt))continue;const Lt=(0,av.zi)(Kt.anchor),nr=(0,av.mq)(Lt);v.textRenderers[te]=new q3.tV(Ue,nr,fe.textRenderParameters),v.labelPlacements[te]=Kt}v.initialized=!0}_destroyTextTextureResources(_){const{textTextureResources:v}=_;v.initialized=!1,v.textRenderers=[],v.labelPlacements=[]}_addGraphic(_,v){const O={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:_,graphics3DGraphic:v,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}},D=v.graphic.uid;_.labels.set(D,O),_.labelsToInitialize.set(D,O),this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(_,v){const O=v.graphic.uid,D=_.labels.get(O);D&&(this._destroyGraphic(D,O),_.labels.delete(O),_.labelsToInitialize.delete(O),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(_,v){this._labels.has(v)&&(this._labels.delete(v),this._labelsToAdd.delete(v),this._labelsToRemove.delete(v)),_.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(_),this._destroyTextTextureResources(_)),_.hasGraphics3DResources&&this._destroyGraphics3DResources(_)}_labelingInfoChange(_,v){var O=this;return(0,Ai.Z)(function*(){if(!v)return O._visibilityInfoChange(_),O._resetLabels(_),O._createLabelClassContext(_);for(const D of v){const w=_.labels.get(D);w&&(O._removeGraphic(_,w.graphics3DGraphic),O._addGraphic(_,w.graphics3DGraphic))}})()}_globalPropertyChanged(_,v){for(const O of v.labelClassContexts){const D=new Map;v.labels.forEach(te=>{const fe=te.graphics3DGraphic;D.set(fe.graphic.uid,fe)});const w=te=>te.labelGraphics[0];(0,lt.Wg)(O.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(_,D,w),O.graphics3DCalloutSymbolLayer&&O.graphics3DCalloutSymbolLayer.globalPropertyChanged(_,D,fe=>fe.labelGraphics[O.calloutSymbolLayerIndex])}}_visibilityInfoChange(_){const v=_.layer.labelsVisible;v&&!_.active&&this._activateLabelingContext(_),!v&&_.active&&this._deactivateLabelingContext(_),this.setDirty()}_resetAllLabels(){for(const _ of this._labelingContexts)this._resetLabels(_)}_resetLabels(_){_.labels.forEach((v,O)=>{this._destroyGraphic(v,O),v.visible=!1,v.rendered=!1,_.labelsToInitialize.set(O,v)}),this._destroyLabelClassContext(_),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(_){for(const v of this._labelingContexts)if(v.graphics3DCore===_)return v;return null}addGraphicsOwner(_,v,O){const D=O&&O.emptySymbolLabelSupported||!1,w=O&&O.elevationInfoOverride||null,te=O&&O.disablePlacement||null;if(this._findLabelingContext(_))return;const fe=_.layer,Pe={graphics3DCore:_,layer:fe,scaleVisibility:v,emptySymbolLabelSupported:D,elevationInfoOverride:w,disablePlacement:te,active:fe.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new sg.F({isPickable:!0},fe.uid)};return this.view._stage.add(Pe.stageLayer),this._labelingContexts.push(Pe),this.setDirty(),{addGraphic:Ue=>this._addGraphic(Pe,Ue),removeGraphic:Ue=>this._removeGraphic(Pe,Ue),featureReductionChange:()=>{},layerLabelsEnabled:()=>(0,Ws.C6)(Pe.layer),labelingInfoChange:Ue=>this._labelingInfoChange(Pe,Ue),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",Pe),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",Pe),visibilityInfoChange:()=>this._visibilityInfoChange(Pe),reset:()=>this._resetLabels(Pe),clear:()=>{}}}removeGraphicsOwner(_){const v=this._findLabelingContext(_);if(!v)return;const O=this._labelingContexts.indexOf(v);this._labelingContexts.splice(O,1),v.labels.forEach(D=>this._removeGraphic(v,D.graphics3DGraphic)),this.view._stage.remove(v.stageLayer),v.stageLayer=null,this.setDirty()}setLabelGraphicVisibility(_,v){const O=_.graphic.uid,D=this._labels.get(O);D&&D.visible!==v&&(v&&!D.rendered?(this._labelsToAdd.set(O,D),this._labelsToRemove.delete(O),D.textTextureResources.initialized||D.labelingContext.labelsToInitialize.set(O,D)):!v&&D.rendered&&(this._labelsToRemove.set(O,D),this._labelsToAdd.delete(O)),D.visible=v,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var _;return this._dirty||(null==(_=this._textTextureAtlas)?void 0:_.updating)||this.deconflictor.updating||this._labelingContexts.some(v=>db(v))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const _=this._labelingContexts.length>0?this._labelingContexts.reduce((v,O)=>v+(db(O)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*_+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function sL(_){return _.active&&(0,Ws.C6)(_.layer)}function db(_){return _.labelClassPromise&&!!_.labelClassAbortController}function aP(_){return _.labelClassContexts&&_.labelClassContexts.length}function nL(_){return null===_.labelClassContexts}(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Uf.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Uf.prototype,"deconflictor",void 0),(0,Ze._)([(0,nt.Cb)()],Uf.prototype,"_textTextureAtlas",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],Uf.prototype,"updating",null),Uf=(0,Ze._)([(0,ui.j)("esri.views.3d.layers.graphics.Labeler")],Uf);const I0=new F3.Z(null,null,null);var oL=T(9160),aL=T(93831),lL=T(98973);class cL{constructor(){this.gltfCache=new Map,this.wosrCache=new Map,this.evictHandles=new cn.Z}loadGLTF(v,O,D){return this._fromCache(this.gltfCache,D?`gltfPBR:${v}`:`gltf:${v}`,te=>(0,aL.z)(new oL.C(te.streamDataRequester),v,te,D),O)}loadWOSR(v,O){return this._fromCache(this.wosrCache,`wosr:${v}:${O.disableTextures}`,w=>(0,lL.zD)(v,w),O)}destroy(){this.evictHandles.destroy(),this.gltfCache.clear(),this.wosrCache.clear()}get size(){return this.wosrCache.size+this.gltfCache.size}_fromCache(v,O,D,w){return new Promise((te,fe)=>{if((0,zi.Hc)(w))return void fe((0,zi.zE)());const Pe=(0,zi.fu)(w,()=>{this._remove(v,O),fe((0,zi.zE)())}),Ue=v.get(O);if(Ue)return this.evictHandles.remove(O),Ue.refCount++,void Ue.item.then(te,fe);const Xe=new AbortController,st=yi(or({},w),{signal:Xe.signal}),vt={refCount:1,abortController:Xe,item:D(st).then(Ct=>(vt.abortController=null,Ct.remove=()=>this._remove(v,O),Ct))};v.set(O,vt),vt.item.then(Ct=>{(0,lt.pC)(Pe)&&Pe.remove(),te(Ct)},Ct=>{(0,lt.pC)(Pe)&&Pe.remove(),fe(Ct)})})}_remove(v,O){const D=v.get(O);D&&(D.refCount--,0===D.refCount&&this.evictHandles.add((0,Ut.HO)(()=>{v.delete(O),(0,lt.pC)(D.abortController)&&D.abortController.abort()},hb),O))}}let hb=1e4;var Rl=T(27351),qn=T(8834),cP=T(11544),lh=T(27899),R_=T(24805),uL=T(37810);class dL{constructor(v){this.renderCoordsHelper=v,this.surfaceElevation=0,this.cache=new Map,this.frustum=new R_.i(v),this.extendedFrustum=new R_.i(v),this.intersector=new uL.q({renderCoordsHelper:v}),this.renderCoordsHelper=v}begin(v,O){this.surfaceElevation=O,this.aboveGround=this.renderCoordsHelper.getAltitude(v.eye)>O,this.frustum.update(v),this._shortenFrustumFarPlane(this.frustum),this._updateExtendedFrustum(v)}end(){this.cache.clear()}calculate(v){if(this.allTilesInvisible)return Rl.E.INVISIBLE;const O=this.renderCoordsHelper.viewingMode===Us.JY.Global&&v.lij[0]>=hL&&v.lij[0]<pL,D=this._getOrCalculateSingleTileVisibility(v,!O);return D!==Rl.E.INVISIBLE&&O?this._calculateAggregatedChildrenVisibility(v):D}_shortenFrustumFarPlane(v){const O=R_.i.nearFarLineIndices,D=v.mutablePoints;for(const w of O){const[te,fe]=w,Pe=D[te];(0,_t.b)(ed,D[fe],Pe),(0,_t.g)(ed,ed,_L),(0,_t.a)(D[fe],Pe,ed)}v.updatePoints(D)}_calculateAggregatedChildrenVisibility(v){let O=Rl.E.INVISIBLE;const D=this.cache.get(v.id);if(null!=D)return D;const w=pP.acquire();v.getChildren(w);for(const te of w){const fe=this.calculate(te);if(fe!==Rl.E.INVISIBLE&&(O=fe,fe===Rl.E.VISIBLE_ON_SURFACE))break}return pP.release(w),this.cache.set(v.id,O),O}_getOrCalculateSingleTileVisibility(v,O){const D=this.cache.get(v.id);if(null!=D)return D;const w=this._calculateSingleTileVisibility(v);return O&&this.cache.set(v.id,w),w}_calculateSingleTileVisibility(v){return!this.aboveGround&&this.renderCoordsHelper.viewingMode===Us.JY.Global&&v.lij[0]<fL?this._calculateSingleTileVisibilitySided(v,!1)===Rl.E.INVISIBLE?this._calculateSingleTileVisibilitySided(v,!0):void 0:this._calculateSingleTileVisibilitySided(v,this.aboveGround)}_calculateSingleTileVisibilitySided(v,O){this.intersector.update(v.extent,v.tilingScheme.spatialReference,this.surfaceElevation,O);const D=(0,Zi.Iu)(v.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,D)?this.intersector.isVisibleInFrustum(this.frustum,D,!0)?Rl.E.VISIBLE_ON_SURFACE:Rl.E.VISIBLE_WHEN_EXTENDED:Rl.E.INVISIBLE}_updateExtendedFrustum(v){this.extendedFrustum.update(v),this._shortenFrustumFarPlane(this.extendedFrustum);const O=this.renderCoordsHelper.worldUpAtPosition(v.eye,ed);this.aboveGround||(0,_t.o)(O,O);const D=(0,li.ZF)(-(0,_t.e)(O,v.viewForward));if(this.allTilesInvisible=D>(Math.PI+v.fovY)/2,this.allTilesInvisible||(this.hasExtendedFrustum=D>v.fovY/2,!this.hasExtendedFrustum))return;const w=this._extendedFrustumParameters(),te=this.extendedFrustum.mutablePoints;for(let fe=0;fe<4;fe++){const Pe=w.pointIndices[fe],Ue=te[Pe],Xe=this.renderCoordsHelper.getAltitude(Ue);if(w.needsAltitudeAdjustment(Xe)){switch(this.renderCoordsHelper.worldUpAtPosition(Ue,ed),Pe){case qn.NQ.FAR_BOTTOM_LEFT:case qn.NQ.FAR_TOP_LEFT:case qn.NQ.NEAR_BOTTOM_LEFT:case qn.NQ.NEAR_TOP_LEFT:(0,Io._l)(this.extendedFrustum.planes[qn.Nu.LEFT],ed,ed);break;case qn.NQ.FAR_BOTTOM_RIGHT:case qn.NQ.FAR_TOP_RIGHT:case qn.NQ.NEAR_BOTTOM_RIGHT:case qn.NQ.NEAR_TOP_RIGHT:(0,Io._l)(this.extendedFrustum.planes[qn.Nu.RIGHT],ed,ed)}(0,_t.g)(ed,ed,w.direction),this.renderCoordsHelper.intersectInfiniteManifold((0,Yu.re)(Ue,ed),w.zWithMargin,Ue)}}if(this.extendedFrustum.updatePoints(te),(0,Io.zk)(te[qn.NQ.NEAR_BOTTOM_LEFT],te[qn.NQ.NEAR_BOTTOM_RIGHT],te[qn.NQ.NEAR_TOP_RIGHT],dP),(0,Io.zk)(te[qn.NQ.NEAR_BOTTOM_RIGHT],te[qn.NQ.NEAR_TOP_RIGHT],te[qn.NQ.NEAR_TOP_LEFT],hP),(0,_t.e)((0,Io.mJ)(dP),(0,Io.mJ)(hP))<0){const fe=this.extendedFrustum.mutablePoints;this.aboveGround?[fe[qn.NQ.NEAR_BOTTOM_LEFT],fe[qn.NQ.NEAR_BOTTOM_RIGHT]]=[fe[qn.NQ.NEAR_BOTTOM_RIGHT],fe[qn.NQ.NEAR_BOTTOM_LEFT]]:[fe[qn.NQ.NEAR_TOP_LEFT],fe[qn.NQ.NEAR_TOP_RIGHT]]=[fe[qn.NQ.NEAR_TOP_RIGHT],fe[qn.NQ.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(fe)}}_extendedFrustumParameters(){return this.aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const v=this.surfaceElevation-uP;return{zWithMargin:v,pointIndices:R_.i.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:O=>O>v}}_extendedFrustumParametersBelowSurface(){const v=this.surfaceElevation+uP;return{zWithMargin:v,pointIndices:R_.i.planePointIndices.top,direction:1,needsAltitudeAdjustment:O=>O<v}}}const hL=2,pL=6,fL=12,_L=.95,uP=1,ed=(0,$t.c)(),dP=(0,Io.Ue)(),hP=(0,Io.Ue)(),pP=new lh.Z(Array,_=>{4!==_.length&&(_[0]=new Rl.C,_[1]=new Rl.C,_[2]=new Rl.C,_[3]=new Rl.C)},_=>{_[0].release(),_[1].release(),_[2].release(),_[3].release()});class mL{constructor(v){this.camera=new $n.V,this.focusOnMap=[0,0],this.screenRect=(0,qr.Ue)(),this.tileSize=v.tileSize,this.renderCoordsHelper=v.renderCoordsHelper,this.tilingScheme=v.tilingScheme,this.visibility=new dL(v.renderCoordsHelper)}begin(v,O,D){this.camera.copyFrom(v),this.surfaceElevation=D,this.focusOnMap[0]=O.x,this.focusOnMap[1]=O.y,(0,qr.al)(0,0,v.fullWidth,v.fullHeight,this.screenRect),this.visibility.begin(this.camera,D)}end(){this.visibility.end()}updateTile(v){v.measures.visibility=this.visibility.calculate(v),v.measures.distance=(0,qr.TE)(v.extent,this.focusOnMap),v.measures.visibility!==Rl.E.INVISIBLE&&this._updateScreenMeasure(v)}_updateScreenMeasure(v){const O=gL,D=1<<O,w=v.measures.screenRect;(0,qr.cS)(w);let te=0;const fe=v.lij[0]+O,Pe=v.lij[1]<<O,Ue=v.lij[2]<<O,Xe=this._tileSizeWithBias(v),st=Xe*Xe;for(let vt=0;vt<D;vt++)for(let Ct=0;Ct<D;Ct++)if(te+=this._computeScreenArea(v,fe,Pe+vt,Ue+Ct,w),te>st)return void(v.measures.shouldSplit=!0);v.measures.shouldSplit=!1}_tileSizeWithBias(v){return v.measures.visibility===Rl.E.VISIBLE_WHEN_EXTENDED?this.tileSize*yL:this.tileSize}_computeScreenArea(v,O,D,w,te){this._projectToScreen(O,D,w,v.measures.visibility===Rl.E.VISIBLE_WHEN_EXTENDED,L0),(0,qr.cS)(pb);for(let Pe=0;Pe<4;Pe++)(0,qr.Ho)(pb,L0[Pe]);return(0,qr.jn)(te,pb,te),(0,cP.wu)(L0[0],L0[1],L0[2])+(0,cP.wu)(L0[0],L0[2],L0[3])}_projectToScreen(v,O,D,w,te){this.tilingScheme.ensureMaxLod(v),this.tilingScheme.getExtent(v,O,D,ng),this._toRenderCoords(ng,0,3,U0[0]),this._toRenderCoords(ng,2,3,U0[1]),this._toRenderCoords(ng,2,1,U0[2]),this._toRenderCoords(ng,0,1,U0[3]),w&&(this._projectToPlane(U0,this.camera.frustum[qn.Nu.NEAR]),this._projectToPlane(U0,this.camera.frustum[qn.Nu.TOP]),this._projectToPlane(U0,this.camera.frustum[qn.Nu.BOTTOM]));for(let fe=0;fe<4;fe++)this.camera.projectToRenderScreen(U0[fe],fP),this.camera.renderToScreen(fP,te[fe])}_projectToPlane(v,O){for(let w=0;w<4;w++)ag[w]=(0,Io.jH)(O,v[w]);const D=Math.max(ag[0],ag[1],ag[2],ag[3]);if(D>0){const w=(0,_t.g)(og,(0,Io.mJ)(O),-D);for(let te=0;te<4;te++)(0,_t.a)(v[te],v[te],w)}}_toRenderCoords(v,O,D,w){return og[0]=v[O],og[1]=v[D],og[2]=this.surfaceElevation,this.renderCoordsHelper.toRenderCoords(og,this.tilingScheme.spatialReference,w),w}}const pb=(0,qr.Ue)(),gL=2,yL=5,L0=[(0,dr.s1)(),(0,dr.s1)(),(0,dr.s1)(),(0,dr.s1)()],ng=(0,qr.Ue)(),og=(0,$t.c)(),U0=[(0,$t.c)(),(0,$t.c)(),(0,$t.c)(),(0,$t.c)()],ag=[0,0,0,0],fP=(0,dr.J$)();var _P=T(55745);const vL=pn.Z.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");let wl=class extends Bi.Z{constructor(_){super(_),this.tiles=new Pn.Z,this.tileSize=512,this._idToTile=new Map,this._handles=new cn.Z,this._clients=new Set,this._dirty=!1,this._newTiles=new Ua.Z}get tilingScheme(){const _=this.tilingSchemeOwner.tilingScheme;return _?_.clone():null}set filterExtent(_){if((0,lt.pC)(_)&&!_.spatialReference.equals(this.viewState.spatialReference))return void vL.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const v=this._get("filterExtent");if(v===_||(0,lt.pC)(v)&&_&&v.equals(_))return;const O=(0,lt.pC)(_)?_.clone():null;this._set("filterExtent",O),this._setDirty()}get filterExtentRect(){if((0,lt.Wi)(this.filterExtent)||!this.tilingScheme)return null;const _=(0,qr.Ue)();return(0,_P.G)(this.filterExtent,_,this.tilingScheme.spatialReference),_}get rootTileIds(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}set suspended(_){_!==this._get("suspended")&&(this._set("suspended",_),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}initialize(){this._handles.add([(0,pt.YP)(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),pt.Z_),(0,pt.YP)(()=>{var _,v,O;return[this.tileSize,null==(_=this.cameraOnSurface)?void 0:_.location,this.tilingScheme,null==(v=this.viewState)?void 0:v.contentCamera,null==(O=this.focus)?void 0:O.location]},()=>this._setDirty(),pt.tX)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Gn.T8.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=(0,lt.hw)(this._frameWorker),this._handles=(0,lt.SC)(this._handles)}addClient(){const _=function bL(){return EL++}();return this._clients.add(_),1===this._clients.size&&this._setDirty(),{remove:()=>this._removeClient(_)}}_removeClient(_){this._clients.delete(_),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(Gn.G5))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(_){this._dirty=!1,this._pendingTiles||(this._startUpdate(),(0,lt.pC)(this._frameWorker)&&(this._frameWorker.priority=Gn.T8.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(_),!this._pendingTiles&&(0,lt.pC)(this._frameWorker)&&(this._frameWorker.priority=Gn.T8.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new mL({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()):this._clear())}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){return this.rootTileIds.map(_=>new Rl.C(_[0],_[1],_[2],this.tilingScheme))}_purgeHorizonTiles(_){_.sort((v,O)=>{const D=v.measures.screenRect,w=O.measures.screenRect;return D[1]+D[3]-(w[1]+w[3])}),(0,qr.cS)(cv);for(let v=0;v<_.length;v++)if((0,qr.jn)(cv,_.data[v].measures.screenRect,cv),(0,qr.Cb)(cv)>CL)return _.data.slice(v,_.length);return[]}_subdivideTilesForView(_){if(this._pendingTiles){for(;this._pendingTiles.length>0&&!_.done;){const v=this._pendingTiles.pop();_.madeProgress(),this.filterExtentRect&&!(0,qr.kK)(this.filterExtentRect,v.extent)||(this._tileMeasurements.updateTile(v),v.measures.visibility!==Rl.E.INVISIBLE&&(v.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(v.lij[0]+1),this._pendingTiles.push(...v.getChildren())):this._newTiles.push(v)))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}}_updateTiles(_){for(const D of this.tiles.items)D.used=!1;const v=_.filter(D=>{const w=this._idToTile.get(D.id);return w?(w.copyMeasurementsFrom(D),w.used=!0):this._idToTile.set(D.id,D),!w}),O=this.tiles.items.filter(D=>!D.used&&(this._idToTile.delete(D.id),!0));this.tiles.removeMany(O),this.tiles.addMany(v),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((_,v)=>_.measures.visibility!==v.measures.visibility?_.measures.visibility===Rl.E.VISIBLE_ON_SURFACE?-1:1:_.measures.distance-v.measures.distance),this.tiles.forEach((_,v)=>_.loadPriority=v)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wl.prototype,"scheduler",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wl.prototype,"renderCoordsHelper",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wl.prototype,"tilingSchemeOwner",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wl.prototype,"cameraOnSurface",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wl.prototype,"focus",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wl.prototype,"viewState",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wl.prototype,"terrain",void 0),(0,Ze._)([(0,nt.Cb)()],wl.prototype,"tiles",void 0),(0,Ze._)([(0,nt.Cb)()],wl.prototype,"tileSize",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],wl.prototype,"tilingScheme",null),(0,Ze._)([(0,nt.Cb)()],wl.prototype,"filterExtent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],wl.prototype,"filterExtentRect",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],wl.prototype,"rootTileIds",null),(0,Ze._)([(0,nt.Cb)({value:!1})],wl.prototype,"suspended",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],wl.prototype,"updating",null),wl=(0,Ze._)([(0,ui.j)("esri.views.3d.layers.support.FeatureTileTree3D")],wl);let EL=0;const cv=(0,qr.Ue)(),CL=10;var TL=T(30755),B0=T(63416);let Il=class extends Bi.Z{constructor(){super(...arguments),this._propertiesPool=new B0.L({camera:$n.V},this),this._lastSeenCameraProjectionValues=new $n.V,this.events=new sa.Z,this.viewingMode=Us.JY.Global,this._cameraChanged=!1,this.updateQueue=new Array,this.processingUpdates=!1}init(_,v){this._set("viewingMode",_),this._set("spatialReference",v),this._set("constraints",new Ia({mode:this.viewingMode}))}exit(){this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new B0.L({camera:$n.V},this)}createInitialCamera(){if(this.viewingMode===Us.JY.Global){const _=(0,Zi.Iu)(this.spatialReference).radius;this.camera=new $n.V((0,$t.f)(4*_,0,0),(0,$t.f)(_,0,0),(0,$t.f)(0,0,1))}else this.camera=new $n.V((0,$t.f)(0,0,100),(0,$t.f)(0,0,0),(0,$t.f)(0,1,0))}get animation(){return this.cameraController instanceof jm&&(0,lt.pC)(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}get camera(){return this._get("camera")}set camera(_){_!==xd&&xd.copyFrom(_),xd.computeUp(this.viewingMode),mP.camera=xd,this.events.emit("before-camera-change",mP);const v=this._get("camera");if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,xd)&&(this._lastSeenCameraProjectionValues.copyFrom(xd),gP.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",gP)),(!v||!v.equals(xd))&&(this._set("camera",this._propertiesPool.get("camera").copyFrom(xd)),this._cameraChanged=!v||!v.almostEquals(xd),this._cameraChanged)){const O=(0,TL.Fs)(()=>{this._cameraChanged=!1,O.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get contentCamera(){return(0,lt.pC)(this._contentCamera)?this._contentCamera:this.camera}set contentCamera(_){this._contentCamera=(0,lt.pC)(_)?_.clone():null}get fixedContentCamera(){return(0,lt.pC)(this._contentCamera)}get isGlobal(){return this.viewingMode===Us.JY.Global}get isLocal(){return this.viewingMode===Us.JY.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(_){this.stopActiveCameraController()?(_&&(this.own((0,pt.YP)(()=>_.state,v=>{v!==ta.Finished&&v!==ta.Stopped||(this._set("cameraController",null),this.updateCamera(O=>_.onControllerEnd(O)))},pt.Z_)),_.onControllerStart(this.camera)),this._set("cameraController",_)):_&&(_.state=ta.Rejected)}switchCameraController(_){return this.cameraController=_,_.state!==ta.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(_){this.updateQueue.push(_),this._processUpdateQueue()}_processUpdateQueue(){if(0===this.updateQueue.length||this.processingUpdates)return;this.processingUpdates=!0;const _=this.updateQueue.shift();xd.copyFrom(this._get("camera")),_(xd),this.camera=xd,this.processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(_,v){return _.fov!==v.fov||_.fullViewport[0]!==v.fullViewport[0]||_.fullViewport[1]!==v.fullViewport[1]||_.fullViewport[2]!==v.fullViewport[2]||_.fullViewport[3]!==v.fullViewport[3]||_.padding[$n.N.TOP]!==v.padding[$n.N.TOP]||_.padding[$n.N.RIGHT]!==v.padding[$n.N.RIGHT]||_.padding[$n.N.BOTTOM]!==v.padding[$n.N.BOTTOM]||_.padding[$n.N.LEFT]!==v.padding[$n.N.LEFT]}};(0,Ze._)([(0,nt.Cb)({readOnly:!0,type:Ol})],Il.prototype,"animation",null),(0,Ze._)([(0,nt.Cb)({type:$n.V})],Il.prototype,"camera",null),(0,Ze._)([(0,nt.Cb)()],Il.prototype,"pixelRatio",null),(0,Ze._)([(0,nt.Cb)({})],Il.prototype,"_contentCamera",void 0),(0,Ze._)([(0,nt.Cb)({type:$n.V})],Il.prototype,"contentCamera",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"fixedContentCamera",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"constraints",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"events",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"isGlobal",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"isLocal",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"viewingMode",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"spatialReference",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"navigating",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Il.prototype,"stationary",null),(0,Ze._)([(0,nt.Cb)()],Il.prototype,"_cameraChanged",void 0),(0,Ze._)([(0,nt.Cb)()],Il.prototype,"cameraController",null),Il=(0,Ze._)([(0,ui.j)("esri.views.3d.state.ViewState")],Il);const ML=Il,xd=new $n.V,mP={camera:null},gP={camera:null};var uv=T(16730);class PL{constructor(v,O){this.elevationProvider=v,this._referenceEllipsoid=(0,Zi.Iu)(O),this.unitInMeters=(0,uv.c9)(O,this._referenceEllipsoid.metersPerDegree)}compute(v,O,D,w,te){te||(te={near:0,far:0});let fe=v[2]*this.unitInMeters;const Ue=fe-w,Xe=this.elevationProvider?this.elevationProvider.elevationBounds:null;Xe&&(fe=Ue>=0?fe-this.unitInMeters*Xe.min:this.unitInMeters*Xe.max-fe);const st={x:(D=(0,lt.pC)(D)?D:new To.Z({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-D.xmin,y:D.ymax-D.ymin,z:4*Math.max(D.xmax-D.xmin,D.ymax-D.ymin)},vt=Math.max(st.x,st.y,st.z);(0,_t.b)(Bf,O,v),w_[0]=Bf[0]>0?D.xmax:D.xmin,w_[1]=Bf[1]>0?D.ymax:D.ymin,w_[2]=Bf[2]>0?vt/2:-vt/2,(0,_t.b)(w_,w_,v),(0,_t.n)(Bf,Bf);const Ct=1.1*(0,_t.e)(w_,Bf)*this.unitInMeters,Wt=Math.sqrt(fe*(fe+2*this._referenceEllipsoid.radius)),Kt=Math.max(D.xmax-D.xmin,D.ymax-D.ymin),nr=Kt*RL*this.unitInMeters;let sr=(0,li.uZ)((fe-nr)/(Kt*SL*this.unitInMeters-nr),0,1);sr*=sr*sr;let Er=(0,li.t7)(Wt,Ct,sr);return Er*=Math.max(Math.log(Math.abs(Ue)),1),Er=Math.min(Er,Math.max(34064e4,vt)),Er/=this.unitInMeters,yP(Er,DL,this.unitInMeters,te)}}class xL{constructor(v){this._referenceEllipsoid=(0,Zi.Iu)(v)}compute(v,O,D,w,te){te||(te={near:0,far:0});const fe=(0,_t.l)(v)-this._referenceEllipsoid.radius,Pe=this._referenceEllipsoid.radius+Math.min(0,w),Ue=Math.abs(fe-w),Xe=Math.max(Ue,Math.abs(fe));return yP(1.2*Math.sqrt(Xe*(Xe+2*Pe)),(0,li.uZ)(2e4-(Math.log(Xe)-7.983)/9.011*19e3,1e3,2e4),1,te)}}function yP(_,v,O,D){const w=AL/O;return _/v>w?(D.far=_,D.near=D.far/v):(D.near=w,D.far=D.near*v),D}const DL=2e4,AL=2,SL=.001,RL=1e-4,w_=(0,$t.c)(),Bf=(0,$t.c)();let dv=class extends Bi.Z{constructor(_){super(_),this.handles=new cn.Z}initialize(){this.handles.add(this.view.basemapTerrain.on("elevation-change",_=>this._handleElevationChangeEvent(_)))}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_handleElevationChangeEvent(_){this.view.state.cameraController||CM(this.view,this.view.state.camera,_.extent,_.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(_=>{f_(this.view,_,Md.EYE_AND_CENTER)})}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],dv.prototype,"view",void 0),dv=(0,Ze._)([(0,ui.j)("esri.views.3d.state.ElevationCollisionConstraint")],dv);let lg=class extends Bi.Z{constructor(_){super(_),this._handles=new cn.Z,this.nearFarHeuristic=function OL(_,v,O){return _===Us.JY.Global?new xL(O):new PL(v,O)}(_.view.state.viewingMode,_.view.basemapTerrain,_.view.renderCoordsHelper.spatialReference)}initialize(){this._handles.add([(0,pt.YP)(()=>{var _,v,O,D;return[null==(v=null==(_=this.view.constraints)?void 0:_.clipDistance)?void 0:v.near,null==(D=null==(O=this.view.constraints)?void 0:O.clipDistance)?void 0:D.far]},()=>this._clipDistanceNearFarChanged()),(0,pt.YP)(()=>{var _,v;return null==(v=null==(_=this.view.constraints)?void 0:_.clipDistance)?void 0:v.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",_=>this._updateCameraNearFar(_.camera)),(0,pt.YP)(()=>this.view.renderDataExtent,()=>this._updateNearFar(),pt.Z_),(0,pt.YP)(()=>{var _,v,O,D;return[null==(v=null==(_=this.view.constraints)?void 0:_.altitude)?void 0:v.min,null==(D=null==(O=this.view.constraints)?void 0:O.altitude)?void 0:D.max]},()=>this._updateAltitude(),pt.Z_),(0,pt.YP)(()=>{var _,v;return null==(v=null==(_=this.view.constraints)?void 0:_.tilt)?void 0:v.max},()=>this._updateTiltMax(),pt.Z_),(0,pt.YP)(()=>{var _,v;return null==(v=null==(_=this.view.constraints)?void 0:_.tilt)?void 0:v.mode},()=>this._updateTilt(),pt.Z_),(0,pt.YP)(()=>{var _;return null==(_=this.view.state)?void 0:_.camera},()=>this._updateTiltAutoMax(),pt.Z_),(0,pt.YP)(()=>{var _,v,O,D,w,te;return[null==(O=null==(v=null==(_=this.view.map)?void 0:_.ground)?void 0:v.navigationConstraint)?void 0:O.type,null==(te=null==(w=null==(D=this.view.state)?void 0:D.constraints)?void 0:w.collision)?void 0:te.enabled]},()=>this._updateCollision(),pt.Z_)]),this.view.state.isLocal&&this._handles.add((0,pt.YP)(()=>this.view.renderDataExtent,_=>this._updateLocalSurfaceDistance(_),pt.nn)),this._updateNearFar(),this.view.state.viewingMode!==Us.JY.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new dv({view:this.view}))}destroy(){this._handles=(0,lt.SC)(this._handles),this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var v;const _=null==(v=this.view.constraints)?void 0:v.clipDistance;_&&"auto"!==_.mode&&this.view.state.updateCamera(O=>(this._updateCameraNearFarManual(O,_),!0))}_updateNearFar(){this.view.state.updateCamera(_=>(this._updateCameraNearFar(_),!0))}_updateCameraNearFar(_){const v=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(v?v.mode:"auto")?this._updateCameraNearFarManual(_,v):this._updateCameraNearFarAuto(_,v)}_updateCameraNearFarAuto(_,v){this.nearFarHeuristic.compute(_.eye,_.center,this.view.renderDataExtent,gy(this.view,_.eye),_),v&&v.autoUpdate(_.near,_.far)}_updateCameraNearFarManual(_,v){v&&(_.near=v.near,_.far=v.far)}_updateCollision(){var D,w,te;const _=null==(te=null==(w=null==(D=this.view.map)?void 0:D.ground)?void 0:w.navigationConstraint)?void 0:te.type,v=!_||"stay-above"===_,O=this.view.state.constraints.collision;if(v!==O.enabled){O.enabled=v,v&&this._reapplyConstraints(wo.COLLISION);const fe=this.view.constraints&&this.view.constraints.tilt;fe&&"auto"!==fe.mode||this._updateTiltAuto()}}_updateAltitude(){const _=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=_&&this.view.state.viewingMode!==Us.JY.Local?{min:_.min,max:_.max}:null,this._reapplyConstraints()}_updateTiltMax(){const _=this.view.constraints&&this.view.constraints.tilt;_&&"auto"!==_.mode&&(this._updateTiltManual(_),this._reapplyConstraints())}_updateTilt(){const _=this.view.constraints&&this.view.constraints.tilt;"manual"===(_?_.mode:"auto")?this._updateTiltManual(_):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(_){const v=this.view.state.constraints;v.tilt=v.createConstantMaxTilt((0,li.Vl)(_.max))}_updateTiltAuto(){const _=this.view.state.constraints;_.tilt=_.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const _=this.view.constraints&&this.view.constraints.tilt;if(!_||"auto"!==_.mode)return;const v=this.view.state.constraints;if(v.tilt){const O=v.tilt(this.view.state.camera.distance).max;_.autoUpdate((0,li.BV)(O))}}_updateLocalSurfaceDistance(_){if((0,lt.Wi)(_))return;let v=Math.max(_.width,_.height);if(v<=0)return;_.hasZ&&(v=Math.max(v,_.zmax-_.zmin));const O=this.view.state,D=3*v/Math.atan(O.camera.fov/2);D!==O.constraints.distance&&(O.constraints.distance=D)}_reapplyConstraints(_=wo.ALL){this.view.state.updateCamera(v=>va(this.view,v,{selection:_,interactionType:bn.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:ml.TUMBLE}))}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],lg.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],lg.prototype,"surfaceCollisionConstraint",void 0),lg=(0,Ze._)([(0,ui.j)("esri.views.3d.state.ConstraintsManager")],lg);let I_=class extends Pf{constructor(_){super(_),this.handles=new cn.Z}set desiredCamera(_){this._set("desiredCamera",_.clone())}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=ta.Running,this.handles.add(this.view.basemapTerrain.on("elevation-change",_=>this._handleElevationChangeEvent(_))),this._applyCorrection()}onControllerEnd(){this.handles.removeAll()}stepController(){}_handleElevationChangeEvent(_){CM(this.view,this.desiredCamera,_.extent,_.spatialReference)&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(_=>{_.copyViewFrom(this.desiredCamera),f_(this.view,_,Md.EYE_AND_CENTER)||this.constraintEnabled||(this.state=ta.Stopped)})}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],I_.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],I_.prototype,"desiredCamera",null),I_=(0,Ze._)([(0,ui.j)("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],I_);var wL=T(21674);function vP(_){return 360-ga.BV.normalize(_)}function hv(_){return ga.BV.normalize(360-_)}function pv(_){return(0,lt.pC)(_)&&_.resolver&&_.resolver.reject(),null}function EP(_,v,O,D=null){if(!v)return pv(D);const w=_.spatialReference||Xn.Z.WGS84;if((0,lt.pC)(v.camera)){const Xe=(0,sh.iV)(v.camera.position,w);if((0,lt.Wi)(Xe))return pv(D);const st=v.camera.clone();return st.position=Xe,function LL(_,v){return(0,lt.pC)(_)&&_.resolver&&_.resolver.resolve(v),v}(D,st)}if((0,lt.Wi)(v.targetGeometry))return pv(D);const te=v.get("targetGeometry.spatialReference");if(te&&!(0,sh.Q8)(te,w))return pv(D);const fe=T_(_,_.state.camera);let Pe=kl.ADJUST;if(null!=v.rotation&&(fe.heading=vP(v.rotation),Pe=kl.LOCKED),null!=O&&(fe.tilt=O),"point"===v.targetGeometry.type){const Xe=v.targetGeometry;let st;const vt=v.targetGeometry.clone();return st=null!=v.scale?W1(_,v.scale,Xe.latitude):_.state.camera.distance,OO(_,vt,st,fe,Pe,D)}return Zm(_,v.targetGeometry.extent,fe.heading,fe.tilt,Pe,D)}function fb(){return fb=(0,Ai.Z)(function*(_,v,O){const D=ZL(_,v);if(!D)throw new Ls.Z("viewpointutils-create:no-target","Missing target for creating viewpoint");const w=new qo({fov:_.camera.fov}),te=new Ra({camera:w});if(D.target instanceof Ra)return Nf(yield FL(_,D.target,D,O,te));if(D.target instanceof qo)return Nf(CP(_,D.target,te));const fe=null!=D.scale||null!=D.zoom;if(D.target instanceof To.Z){const Xe=D.target.xmin===D.target.xmax||D.target.ymin===D.target.ymax;return Nf(fe||Xe?yield bb(_,D,D.target.center,w,O,te):yield GL(_,D,D.target,w,O,te))}const Pe={boundingBox:(0,Ea.cS)(),hasZ:!1,screenSpaceObjects:[]},Ue=fe?NL(_,D):void 0;if(yield bP(_,D.target,Ue,Pe),isFinite(Pe.boundingBox[0])){let Xe;if((0,Ea.be)(Pe.boundingBox,ba),td.x=ba[0],td.y=ba[1],td.z=ba[2],td.spatialReference=_.spatialReference,isFinite(td.z)&&Pe.hasZ?Xe=(0,Ea.wp)(Pe.boundingBox):(td.z=void 0,Xe=(0,qr.wp)((0,Ea.y8)(Pe.boundingBox,kL))),fe||Xe)return Nf(yield bb(_,D,td,w,O,te));const st=$L(_,Pe.screenSpaceObjects);return Nf(yield KL(_,D,td,Pe.boundingBox,st,w,O,te))}return Nf(D.position?VL(_,D,w,te):yield zL(_,D,w,O,te))}),fb.apply(this,arguments)}function _b(_,v){return null==v.scale&&null!=v.zoom?DO(_,v.zoom):v.scale}function NL(_,v){return function xI(_,v){return _.spatialReference?(0,Ri.dp)(v,_.spatialReference):void 0}(_,_b(_,v))}function mb(_,v){let O=!1;return null!=v.heading?(_.heading=v.heading,O=!0):null!=v.rotation&&(_.heading=vP(v.rotation),O=!0),null!=v.tilt&&(_.tilt=v.tilt,O=!0),null!=v.fov&&(_.fov=v.fov),O}function gb(_,v,O,D){const w=_.spatialReference||Xn.Z.WGS84;return v=(0,lt.pC)(v)?v:Sp(_,O),(0,lt.Wi)(v)||(D.targetGeometry=(0,ci.fA)(v.center,_.renderSpatialReference,w),D.scale=AO(_,v),D.rotation=hv(O.heading),D.camera=O),D}function fv(_,v,O){if(!v)return;if(!(0,sh.Q8)(v.spatialReference,_.spatialReference))throw new Ls.Z("viewpointutils:incompatible-spatialreference",`Spatial reference (${v.spatialReference?v.spatialReference.wkid:"unknown"}) is incompatible with the view (${_.spatialReference.wkid})`,{geometry:v});const D=[];if(!v.hasZ&&_.basemapTerrain){let fe;switch(v.type){case"point":fe=v;break;case"multipoint":case"polyline":fe=v.extent.center;break;case"mesh":fe=v.origin;break;case"extent":fe=v.center;break;case"polygon":fe=v.centroid}ba[2]=fe&&(0,sh.Q8)(fe,_.basemapTerrain.spatialReference)?(0,lt.Pt)((0,E_.KO)(_.elevationProvider,fe),0):0}(0,YL[v.type])(v,fe=>{D.push(fe[0],fe[1],fe[2])},ba);const w=D.length/3;if(0===w)return;const te=new Array(D.length);if((0,ci.CM)(D,v.spatialReference,0,te,_.spatialReference,0,w)){v.hasZ&&(O.hasZ=!0);for(let fe=0;fe<te.length;fe+=3)v.hasZ?(ba[0]=te[fe+0],ba[1]=te[fe+1],ba[2]=te[fe+2]):(ba[0]=te[fe+0],ba[1]=te[fe+1]),(0,Ea.pp)(O.boundingBox,ba)}}function jL(_,v,O,D){return yb.apply(this,arguments)}function yb(){return yb=(0,Ai.Z)(function*(_,v,O,D){const w=yield(0,Qm.q6)(_.whenViewForGraphic(v));if(!1===w.ok||(0,lt.Wi)(w.value)||!("whenGraphicBounds"in w.value))return void fv(_,v.geometry,D);const te=w.value,fe=yield(0,Qm.q6)(te.whenGraphicBounds(v,{minDemResolution:O}));if(!1===fe.ok)return void fv(_,v.geometry,D);const{screenSpaceObjects:Pe,boundingBox:Ue}=fe.value;(0,Ea.TC)(D.boundingBox,Ue),Pe&&Pe.forEach(Xe=>{D.screenSpaceObjects.push(Xe)}),isFinite(Ue[2])&&(D.hasZ=!0)}),yb.apply(this,arguments)}function bP(_,v,O,D){return vb.apply(this,arguments)}function vb(){return vb=(0,Ai.Z)(function*(_,v,O,D){if(Array.isArray(v)&&2===v.length){const w=v[0],te=v[1];if("number"==typeof w&&"number"==typeof te)return td.x=w,td.y=te,td.z=void 0,td.spatialReference=_.spatialReference.isGeographic?_.spatialReference:Xn.Z.WGS84,void fv(_,td,D)}v&&"function"==typeof v.map?yield(0,zi.as)(v.map(w=>bP(_,w,O,D))):v instanceof wL.Z?fv(_,v,D):v instanceof Dn.Z&&(yield jL(_,v,O,D))}),vb.apply(this,arguments)}function FL(_,v,O,D,w){return Eb.apply(this,arguments)}function Eb(){return Eb=(0,Ai.Z)(function*(_,v,O,D,w){if((0,lt.pC)(v.camera))return CP(_,v.camera,w);w.scale=v.scale,w.rotation=v.rotation,w.targetGeometry=(0,lt.pC)(v.targetGeometry)?v.targetGeometry.clone():null,w.camera=null,null!=O.heading?w.rotation=hv(O.heading):null!=O.rotation&&(w.rotation=O.rotation);const te=_b(_,O);null!=te&&(w.scale=te);const fe=new M_(D);return EP(_,w,O.tilt,fe),w.camera=yield fe.resolver.promise,w}),Eb.apply(this,arguments)}function CP(_,v,O){const w=(0,sh.iV)(v.position,_.spatialReference);return(0,lt.Wi)(w)?null:((v=v.clone()).fov=_.camera.fov,v.position=w,gb(_,null,v,O))}function WL(_,v,O,D,w,te){const fe=_.renderSpatialReference;return(0,ci.KC)(O.position,gv,fe),(0,ci.KC)(v,Pb,fe),te.targetGeometry=new vs.Z(v),w.position=new vs.Z(O.position),(0,_t.b)(mv,Pb,gv),$y(_,gv,mv,D.up,w),te.scale=Sf(_,(0,_t.i)(gv,Pb),te.targetGeometry.latitude),te.rotation=hv(w.heading),te.camera=w,te}function bb(_,v,O,D,w,te){return Cb.apply(this,arguments)}function Cb(){return Cb=(0,Ai.Z)(function*(_,v,O,D,w,te){if((0,lt.Wi)(O))throw new Ls.Z("createfromcenter","invalid point");te.targetGeometry=O.clone();const fe=Tf(_);if(v.position)return WL(_,te.targetGeometry,v,fe,D,te);if(v.zoomFactor){const Ue=fe.distance/v.zoomFactor,Xe=(0,_t.g)(ba,fe.viewForward,-Ue);fe.eye=(0,_t.a)(ba,fe.center,Xe),te.scale=Sf(_,Ue,O.latitude)}T_(_,fe,D);const Pe=mb(D,v)?kl.LOCKED:kl.ADJUST;if(!v.zoomFactor){te.scale=_b(_,v),null==te.scale&&((0,ci.KC)(O,ba,_.renderSpatialReference),te.scale=(0,qn.g8)(fe.frustum,ba)?Sf(_,(0,_t.i)(fe.eye,ba),O.latitude):AO(_,fe));const Ue=new M_(w);MO(_,te.targetGeometry,te.scale,D,Pe,Ue),te.camera=yield Ue.resolver.promise}return te}),Cb.apply(this,arguments)}function VL(_,v,O,D){const w=Tf(_);return(0,_t.c)(mv,w.viewForward),$y(_,w.eye,mv,w.up,xb),O.position=new vs.Z(v.position),O.heading=null!=v.heading?v.heading:xb.heading,O.tilt=null!=v.tilt?v.tilt:xb.tilt,gb(_,null,O,D)}function zL(_,v,O,D,w){return Tb.apply(this,arguments)}function Tb(){return Tb=(0,Ai.Z)(function*(_,v,O,D,w){const te=Tf(_);return bb(_,v,(0,ci.fA)(te.center,_.renderSpatialReference,_.spatialReference),O,D,w)}),Tb.apply(this,arguments)}function GL(_,v,O,D,w,te){return Mb.apply(this,arguments)}function Mb(){return Mb=(0,Ai.Z)(function*(_,v,O,D,w,te){te.targetGeometry=O.clone(),T_(_,Tf(_),D);const Pe=mb(D,v)?kl.LOCKED:kl.ADJUST,Ue=new M_(w);return Zm(_,O,D.heading,D.tilt,Pe,Ue),te.camera=yield Ue.resolver.promise,te}),Mb.apply(this,arguments)}function HL(_,v,O,D,w){let te=0;O.hasZ?te=O.z:_.basemapTerrain&&(te=(0,lt.Wg)((0,E_.KO)(_.elevationProvider,O))),(0,_t.s)(ba,O.x,O.y,te),(0,ci.Bm)(_.spatialReference,ba,TP,_.renderSpatialReference),(0,Aa.f)(_v,TP),(0,Aa.t)(_v,_v),(0,Ea.cS)(cg);const fe=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let Kt=0;Kt<fe.length;Kt++){const Lt=fe[Kt];let nr=D[Lt[2]];isFinite(nr)||(nr=te),(0,_t.s)(ba,D[Lt[0]],D[Lt[1]],nr),(0,ci.SH)(ba,_.spatialReference,ba,_.renderSpatialReference),(0,Ea.pp)(cg,(0,_t.t)(ba,ba,_v))}const Pe=(0,Ea.bf)(cg),Ue=(0,Ea.Cb)(cg),Xe=(0,Ea.Ye)(cg),st=1/Math.tan(v.fovX/2),vt=1/Math.tan(v.fovY/2),Ct=.5*Math.sqrt(Pe*Pe+Xe*Xe)*Math.max(vt,st)+.5*Ue,Wt=.5*Ue*vt+.5*Math.max(Pe,Xe);return Math.max(Ct,Wt)/w}function KL(_,v,O,D,w,te,fe,Pe){return Ob.apply(this,arguments)}function Ob(){return Ob=(0,Ai.Z)(function*(_,v,O,D,w,te,fe,Pe){Pe.targetGeometry=O.clone();const Ue=Tf(_),Xe=HL(_,Ue,O,D,w);T_(_,Ue,te);const st=mb(te,v)?kl.LOCKED:kl.ADJUST;Pe.scale=Sf(_,Xe,Pe.targetGeometry.latitude);const vt=new M_(fe);return MO(_,Pe.targetGeometry,Pe.scale,te,st,vt),Pe.camera=yield vt.resolver.promise,Pe}),Ob.apply(this,arguments)}function ZL(_,v){if(!v||!_.spatialReference)return null;const O={target:null};if("declaredClass"in v||Array.isArray(v))O.target=v;else{for(const D in v)O[D]=v[D];v.center&&!O.target&&(O.target=v.center)}return O}function Nf(_){return _&&(0,lt.pC)(_.camera)&&(_.rotation=hv(_.camera.heading)),_}function $L(_,v){if(!v.length)return.66;let D=Number.NEGATIVE_INFINITY;for(let w=0;w<v.length;w++){const te=v[w].screenSpaceBoundingRect;D=Math.max(D,Math.abs(te[0]),Math.abs(te[1]),Math.abs(te[2]),Math.abs(te[3]))}return.66-D/Math.min(_.width,_.height)*2}const ba=(0,$t.c)(),TP=(0,Zn.c)(),_v=(0,Mp.c)(),cg=(0,Ea.Ue)(),kL=(0,qr.Ue)(),mv=(0,$t.c)(),gv=(0,$t.c)(),Pb=(0,$t.c)(),xb={heading:0,tilt:0},td=new vs.Z,YL={point(_,v,O){O[0]=_.x,O[1]=_.y,_.hasZ&&(O[2]=_.z),v(O)},polygon(_,v,O){const D=_.hasZ;for(let w=0;w<_.rings.length;w++){const te=_.rings[w];for(let fe=0;fe<te.length;fe++)O[0]=te[fe][0],O[1]=te[fe][1],D&&(O[2]=te[fe][2]),v(O)}},polyline(_,v,O){const D=_.hasZ;for(let w=0;w<_.paths.length;w++){const te=_.paths[w];for(let fe=0;fe<te.length;fe++)O[0]=te[fe][0],O[1]=te[fe][1],D&&(O[2]=te[fe][2]),v(O)}},multipoint(_,v,O){const D=_.points,w=_.hasZ;for(let te=0;te<D.length;te++)O[0]=D[te][0],O[1]=D[te][1],w&&(O[2]=D[te][2]),v(O)},extent(_,v,O){_.hasZ?(v((0,_t.s)(O,_.xmin,_.ymin,_.zmin)),v((0,_t.s)(O,_.xmax,_.ymin,_.zmin)),v((0,_t.s)(O,_.xmin,_.ymax,_.zmin)),v((0,_t.s)(O,_.xmax,_.ymax,_.zmin)),v((0,_t.s)(O,_.xmin,_.ymin,_.zmax)),v((0,_t.s)(O,_.xmax,_.ymin,_.zmax)),v((0,_t.s)(O,_.xmin,_.ymax,_.zmax)),v((0,_t.s)(O,_.xmax,_.ymax,_.zmax))):(v((0,_t.s)(O,_.xmin,_.ymin,O[2])),v((0,_t.s)(O,_.xmax,_.ymin,O[2])),v((0,_t.s)(O,_.xmin,_.ymax,O[2])),v((0,_t.s)(O,_.xmax,_.ymax,O[2])))},mesh(_,v,O){const D=_.vertexAttributes&&_.vertexAttributes.position;if(D)for(let w=0;w<D.length;w+=3)v((0,_t.s)(O,D[w+0],D[w+1],D[w+2]))}};class JL{constructor(v,O,D){this.target=v,this.options=O,this.view=D,this.state="pending",this.abortController=null,this.animationController=null,this.promise=new Promise((w,te)=>{this.resolveCallback=w,this.rejectCallback=te;const fe=new AbortController;(0,lt.pC)(this.options.signal)&&(0,zi.fu)(this.options.signal,()=>{this.abort()}),this.abortController=fe,this.waitForReady()})}then(v,O){return this.promise.then(v,O)}catch(v){return this.promise.catch(v)}resolve(v){return this.state="finished",this.resolveCallback(v)}reject(v){return this.state="finished",this.rejectCallback(v)}abort(v=!1){switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":this.reject((0,zi.zE)());break;case"wait-for-animation-finish":!v&&(0,lt.pC)(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),this.reject((0,zi.zE)())}}waitForReady(){var v=this;return(0,Ai.Z)(function*(){if(v.state="wait-for-ready",!v.view.ready)try{yield(0,pt.N1)(()=>v.view.ready,v.abortController.signal)}catch(O){return v.reject(O)}v.createViewPoint()})()}createViewPoint(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,function BL(_,v,O){return fb.apply(this,arguments)}(this.view,this.target,this.abortController.signal).then(v=>{if("finished"===this.state)return;const O=this._getCameraFromViewpoint(v);if(!(0,lt.Wi)(O))if(this.options.animate){if((0,lt.Wi)(this.animationController))return;this.startAnimation(O,this.animationController)}else this.view.stateManager.setStateCamera(O.camera,{applyConstraints:!O.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},v=>{this.reject(v)}))}_getCameraFromViewpoint(v){const O=!!(this.target instanceof Ra&&this.target.camera||this.target instanceof qo),D=v.camera;if((0,lt.Wi)(D))return null;if(!this.view.stateManager.isCompatible(D)){const te=D.position,fe=te&&te.spatialReference;return this.reject(new Ls.Z("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${fe?fe.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:D})),null}const w=Sp(this.view,D);return(0,lt.Wi)(w)?(this.reject(new Ls.Z("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:v,camera:w,isFullySpecified:O}}startAnimation(v,O){this.state="wait-for-animation-finish";const D=O.viewAnimation;if((0,lt.Wi)(D))return void this.reject(new Ls.Z("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(D.update(v.viewpoint,"running"),!O.active||(0,lt.Wi)(O.viewAnimation)||O.viewAnimation.target!==v.viewpoint||this.view.state.cameraController!==O)return this.abort();let w;v.isFullySpecified?(w=new I_({view:this.view,desiredCamera:v.camera}),f_(this.view,v.camera,Md.EYE_AND_CENTER)):va(this.view,v.camera),O.begin(v.camera,this.options);const fe=Pe=>{if(!(0,lt.Wi)(this.view.state))switch(O.state){case ta.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case ta.Ready:case ta.Rejected:case ta.Running:case ta.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(Pe)}}};D.when(()=>{const Pe=this.view.state.cameraController;w&&(Pe&&Pe.active?Pe instanceof Op&&(0,lt.pC)(Pe.viewAnimation)&&Pe.viewAnimation.target===v.viewpoint&&(this.view.state.cameraController=w):(0,lt.pC)(O.viewAnimation)&&O.viewAnimation.target===v.viewpoint&&"finished"===O.state&&(this.view.state.cameraController=w))},Pe=>fe(Pe)),O.asyncResult={resolve:()=>fe(),reject:Pe=>fe(Pe)}}_getAnimationController(){let v,O=null;const D=this.view.state.cameraController;return D instanceof Op&&(D.updateStateFromViewAnimation(),D.active&&(v=D,O=v.viewAnimation)),null!=v||(v=new Op({view:this.view,mode:"animation"}),O=v.viewAnimation,this.view.state.switchCameraController(v))?v:((0,lt.pC)(O)&&O.stop(),this.reject(new Ls.Z("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}}const Dd=pn.Z.getLogger("esri.views.3d.state.ViewStateManager");let il=class extends Bi.Z{constructor(_){super(_),this.propertiesPool=new B0.L({frustum:R_.i},this),this.handles=new cn.Z,this.cameraSetByUser=!1,this.gotoOperation=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._maximumPixelRatioOverride=null,this.test={contentCameraResetState:new Map,setDevicePixelRatio:v=>this._devicePixelRatioOverride=v,setMaximumPixelRatio:v=>this._maximumPixelRatioOverride=v}}get camera(){const _=this._get("camera");if(!this.ready)return _;const v=T_(this.view,this.view.state.camera);return v&&_&&v.equals(_)?_:v}set camera(_){this._updatePropertyBeforeReady("camera",_)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(Sp(this.view,_),{applyConstraints:!1})||Dd.error("#camera=","Invalid camera",_),this.view.elevationProvider.enableElevationCache(!1))}get contentCamera(){const _=this._get("contentCamera");if(!this.ready)return _;const v=T_(this.view,this.view.state.contentCamera);return v&&_&&v.equals(_)?_:v}set contentCamera(_){if(this._updatePropertyBeforeReady("contentCamera",_))return;const v=Sp(this.view,_);(0,lt.Wi)(v)?this.view.state.contentCamera=null:(this._updateElevation(v),this.view.state.contentCamera=v)}installContentCameraReset(_){if(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const v=this.zoom,O=this.view.state.camera.distance**2,D=(0,$t.d)(this.view.state.camera.center),w=_.sticky?this.contentCamera.clone():null;return this.handles.add([(0,pt.YP)(()=>this.contentCamera,()=>{_.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),(0,pt.YP)(()=>this.zoom,te=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(te-v)/2),Math.abs(te-v)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=w)}),(0,pt.YP)(()=>this.view.state.camera,te=>{const fe=(0,_t.d)(D,te.center);this.test.contentCameraResetState.set("camera.center",fe/O),fe>O?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=w)})],"contentCameraReset"),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(_){this._updatePropertyBeforeReady("center",_)||(_?this.isCompatible(_)?this.setStateCamera(this._centerToCamera(_),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():Dd.error("#center=","Invalid center",_):Dd.error("#center=","Center has an incompatible spatial reference (center: "+(_.spatialReference?_.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",_):Dd.error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const _=this.view,v=function CI(_,v,O){const w=(0,ci.fA)(O,_.renderSpatialReference,Hm(_));if((0,lt.Wi)(w))return null;const te=Math.tan(v.fovX/2),fe=Math.tan(v.fovY/2),Pe=(0,_t.j)(v.eye,O),Ue=2*Pe*te*1,Xe=2*Pe*fe*1;return"global"===_.viewingMode?yO(_,w,Ue,Xe):fO(_,w,Ue,Xe)}(_,_.state.camera,_.pointsOfInterest.centerOnContent.renderLocation);return(0,lt.pC)(v)?v:this._get("extent")}set extent(_){this._updatePropertyBeforeReady("extent",_)||(_?this.isCompatible(_)?this.setStateCamera(this._extentToCamera(_),{applyConstraints:!0})||Dd.error("#extent=","Invalid extent",_):Dd.error("#extent=","Extent has an incompatible spatial reference (extent: "+(_.spatialReference?_.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",_):Dd.error("#extent=","Extent may not be null or undefined"))}get frustum(){const _=this.propertiesPool.get("frustum");return _.renderCoordsHelper=this.view.renderCoordsHelper,_.update(this.view.state.camera),_}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const _=this.view.pointsOfInterest.centerOnContent;return Sf(this.view,_.distance,_.location.latitude)}return this._get("scale")}set scale(_){this._updatePropertyBeforeReady("scale",_)||this.setStateCamera(this._scaleToCamera(_),{applyConstraints:!0})||Dd.error("#scale=","Invalid scale",_)}get padding(){if(!this.ready)return this._get("padding");const _=this.view.state.camera,v=_.padding,O=_.pixelRatio,D=this._get("padding"),w=Math.round(v[$n.N.TOP]/O),te=Math.round(v[$n.N.RIGHT]/O),fe=Math.round(v[$n.N.BOTTOM]/O),Pe=Math.round(v[$n.N.LEFT]/O);return null!=D&&D.top===w&&D.right===te&&D.bottom===fe&&D.left===Pe?D:{top:w,right:te,bottom:fe,left:Pe}}set padding(_){this._updatePropertyBeforeReady("padding",_)||(this._paddingToArray(_,this.view.state.camera.pixelRatio,yv),this.view.state.updateCamera(v=>v.padding=yv))}_paddingToArray(_,v,O){_?(0,Sl.s)(O,_.top||0,_.right||0,_.bottom||0,_.left||0):(0,Sl.s)(O,0,0,0,0);for(let D=0;D<4;D++)O[D]=Math.round(O[D]*v)}get screenCenter(){const _=this.padding;return(0,dr.vW)((this.view.width-(_.left+_.right))/2+_.left,(this.view.height-(_.top+_.bottom))/2+_.top)}get viewpoint(){return this.ready?function UL(_,v,O=null){return(0,lt.Wi)(O)&&(O=new Ra),gb(_,null,v.clone(),O)}(this.view,this.camera):this._get("viewpoint")}set viewpoint(_){if(!this._updatePropertyBeforeReady("viewpoint",_))if(_)if(this.isCompatible(_))this.setStateCamera(this._viewpointToCamera(_),{applyConstraints:!_.camera})||Dd.error("#viewpoint=","Invalid viewpoint",_);else{const v=(0,lt.pC)(_.camera)?_.camera.position:_.targetGeometry,O=(0,lt.pC)(v)&&v.spatialReference;Dd.error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(O?O.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",_)}else Dd.error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?xO(this.view,this.scale):this._get("zoom")}set zoom(_){this._updatePropertyBeforeReady("zoom",_)||this.setStateCamera(this._zoomToCamera(_),{applyConstraints:!0})||Dd.error("#zoom=","Invalid zoom",_)}get maximumPixelRatio(){if((0,lt.pC)(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let _=1/0;const{maximumPixelRatio:v,maximumRenderResolution:O}=this.view.qualitySettings;if(null!=v&&(_=Math.min(_,v)),null!=O){const D=O/Math.max(this.view.width,this.view.height);_=Math.min(_,D)}return _}get _devicePixelRatio(){return(0,lt.Wi)(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}initialize(){this.handles.add([(0,pt.on)(()=>this.view.state.events,"before-camera-change",_=>this._updateElevation(_.camera))]),(0,pt.YP)(()=>this.view.state.camera,_=>this._updateElevation(_),{once:!0,sync:!0}),this.handles.add((0,rt.A)({prepare:()=>this._prepareFrame()})),this.handles.add((0,pt.YP)(()=>this.view.state.cameraController,()=>{this.cameraSetByUser=!0,this.handles.remove(vv)})),this.handles.add((0,pt.on)(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))}destroy(){this.deinit(),this.handles&&(this.handles.destroy(),this.handles=null),this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)}init(){this.constraintsManager=new lg({view:this.view}),this._prepareFrame();const _=this._getInitialProperties();this.cameraSetByUser=!1,this._set("ready",!0);for(const v of _)this.set(v.name,v.value);if(!this.cameraSetByUser){const v=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;v&&this.isCompatible(v)?this._setInitialView(v):this.view.state.viewingMode===Us.JY.Local&&this.handles.add((0,pt.gx)(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove(vv),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),vv)}}deinit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove(vv),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))}goTo(_,v){var O=this;return(0,Ai.Z)(function*(){const D=or({animate:!0},v);return(0,lt.pC)(O.gotoOperation)&&O.gotoOperation.abort(D.animate),O.gotoOperation=new JL(_,D,O.view),O.view.resourceController.scheduler.stopFrame(),O.gotoOperation})()}debugSetCameraOnContent(){this.setStateCamera(Tf(this.view),{applyConstraints:!1})}step(_){const v=this.view.state,O=v&&this.view.state.cameraController;O&&(v.updateCamera(D=>{O.stepController(_,D)}),O.steppingFinished&&O.finishController())}_cancelGoToOperation(){(0,lt.pC)(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)}_getInitialProperties(){const _=new Set,v=[];for(const{propertyName:O,overrides:D}of qL){const w=_.has(O),te=this._isOverridden(O);!w&&te&&v.push({name:O,value:this._get(O)}),this._clearOverride(O),(w||te)&&D.forEach(fe=>_.add(fe))}return v}_setInitialView(_){if((0,lt.Wi)(_)||this.cameraSetByUser)return;if(_ instanceof qo)return void this.setStateCamera(Sp(this.view,_),{applyConstraints:!1});if(_ instanceof Ra){if(_.targetGeometry instanceof To.Z){const w=Zm(this.view,_.targetGeometry,0,.5,kl.LOCKED);return void((0,lt.pC)(w)&&this.setStateCamera(Sp(this.view,w),{applyConstraints:!0}))}const O={applyConstraints:!_.camera},D=this._viewpointToCamera(_);return void this.setStateCamera(D,O)}const v=Zm(this.view,_,0,.5,kl.LOCKED);(0,lt.pC)(v)&&this.setStateCamera(Sp(this.view,v),{applyConstraints:!0})}_updatePropertyBeforeReady(_,v){return!this.ready&&(this._override(_,v),v&&QL.includes(_)&&this._override("hasInitialView",!0),!0)}isCompatible(_){return!(0,lt.Wi)(_)&&(_ instanceof Ra?this.isCompatible(_.camera?_.camera:_.targetGeometry):_ instanceof qo?this.isCompatible(_.position):_.spatialReference&&(0,sh.Q8)(_.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(_=eU){return this.cameraSetByUser?(_.heading=this.camera.heading,_.tilt=this.camera.tilt):(_.heading=0,_.tilt=.5),_}_centerPointAtDistanceToCamera(_,v,O=N0){const{heading:D,tilt:w}=this._getPreservingHeadingTilt(),te=Km(this.view,D,w,_,v,kl.ADJUST);return(0,lt.Wi)(te)?null:(O.copyFrom(this.view.state.camera),O.eye=te.eye,O.center=te.center,O.up=te.up,O)}_centerToCamera(_){const v=this.view.pointsOfInterest.centerOnContent;return v.runTask(),this._centerPointAtDistanceToCamera(_,v.distance)}_extentToCamera(_){const{heading:v,tilt:O}=this._getPreservingHeadingTilt(),D=Zm(this.view,_,v,O,kl.ADJUST,tU);return(0,lt.pC)(D)?Sp(this.view,D):null}_scaleToCamera(_){if(null==_)return null;const v=this.view.pointsOfInterest.centerOnContent;v.runTask();const O=v.renderLocation,w=W1(this.view,_,v.location.latitude);return this._centerPointAtDistanceToCamera(O,w)}_zoomToCamera(_){return this._scaleToCamera(DO(this.view,_))}_viewpointToCamera(_){return Sp(this.view,EP(this.view,_))}setStateCamera(_,v){return!((0,lt.Wi)(_)||!this.view.state.stopActiveCameraController()||(this.cameraSetByUser=!0,v.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(O=>{v.positionAndOrientationOnly?(O.eye=_.eye,O.center=_.center,O.up=_.up):O.copyFrom(_),v.applyConstraints&&va(this.view,O)}),v.applyConstraints||(this.view.state.cameraController=new I_({view:this.view,desiredCamera:_})),0))}_prepareFrame(){const{surface:_,canvas:v}=this.view;if(!_||!v)return;this._windowDevicePixelRatio=window.devicePixelRatio;const O=this._devicePixelRatio,D=Math.round(_.clientWidth*O),w=Math.round(_.clientHeight*O);if(0!==D&&0!==w&&(v.width===D&&v.height===w||(v.width=D,v.height=w),this.view.state)){const te=this.view.state.camera;te.fullWidth===D&&te.fullHeight===w&&te.pixelRatio===O||(N0.copyFrom(te),N0.pixelRatio!==O&&(this._paddingToArray(this.padding,O,yv),N0.padding=yv),N0.fullWidth=D,N0.fullHeight=w,N0.pixelRatio=O,this.view.state.camera=N0)}}_updateElevation(_){const v=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,O=this.view.renderCoordsHelper.getAltitude(_.eye),D=v?gy(this.view,_.eye):0;_.relativeElevation=O-D}};(0,Ze._)([(0,nt.Cb)({type:qo,dependsOn:["view.state.camera","ready"]})],il.prototype,"camera",null),(0,Ze._)([(0,nt.Cb)({type:qo,dependsOn:["view.state.contentCamera","ready"]})],il.prototype,"contentCamera",null),(0,Ze._)([(0,nt.Cb)({type:vs.Z})],il.prototype,"center",null),(0,Ze._)([(0,nt.Cb)({type:To.Z})],il.prototype,"extent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],il.prototype,"frustum",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],il.prototype,"hasInitialView",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0,type:Boolean})],il.prototype,"ready",void 0),(0,Ze._)([(0,nt.Cb)({type:Number})],il.prototype,"scale",null),(0,Ze._)([(0,nt.Cb)()],il.prototype,"padding",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],il.prototype,"screenCenter",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],il.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:Ra})],il.prototype,"viewpoint",null),(0,Ze._)([(0,nt.Cb)({type:Number})],il.prototype,"zoom",null),(0,Ze._)([(0,nt.Cb)()],il.prototype,"maximumPixelRatio",null),(0,Ze._)([(0,nt.Cb)()],il.prototype,"_devicePixelRatio",null),(0,Ze._)([(0,nt.Cb)()],il.prototype,"_windowDevicePixelRatio",void 0),(0,Ze._)([(0,nt.Cb)()],il.prototype,"_devicePixelRatioOverride",void 0),(0,Ze._)([(0,nt.Cb)()],il.prototype,"_maximumPixelRatioOverride",void 0),il=(0,Ze._)([(0,ui.j)("esri.views.3d.state.ViewStateManager")],il);const XL=il,QL=["camera","viewpoint","extent","scale","center","zoom"],qL=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],eU={heading:0,tilt:0},tU=new qo,N0=new $n.V,yv=(0,vi.c)(),vv="pending-initial-view";var Ll=T(67857),Ev=T(91480);class rU{constructor(v,O,D){this.viewingMode=v,this._forEachLayer=O,this.view=D,this.externalIntersectionHandlers=new Ua.Z,this.tolerance=fc.vh,this.tmpRay=(0,Yu.Ue)(),this.tmpRegion=(0,qr.Ue)(),this.validateHUDIntersector=(0,fc.Z8)(this.viewingMode),this.validateHUDIntersector.options.hud=!1}intersectScreen(v,O,D){return this.intersectRay(this._getPickRay(v,this.tmpRay),MP(this.viewingMode),O,D)}intersectScreenFreePointFallback(v,O,D){return this.intersectRayFreePointFallback(this._getPickRay(v,this.tmpRay),O,D)}intersectRayFreePointFallback(v,O,D){return this.intersectRay(v,MP(this.viewingMode),O,D)||this._intersectRayFreePointLocal(v,O)}intersectRay(v,O,D,w){return O.options.selectionMode=!1,O.options.store=Ll.eC.MIN,this.computeIntersection(v,O,w),!!O.results.min&&O.results.min.getIntersectionPoint(D)}getCenterRayWithSubpixelOffset(v,O,D=.5,w=.5){return v.getRenderCenter(Tv,D,w),Tv[0]+=.0466,Tv[1]-=.0123,(0,Nh.eW)(v,Tv,O)}intersectIntersectorScreen(v,O,D){this.computeIntersection(this._getPickRay(v,this.tmpRay),O,D)}intersectToolIntersectorScreen(v,O,D){const w=this._getPickRay(v,this.tmpRay);this.intersectToolIntersectorRay(w,O,D)}intersectToolIntersectorRay(v,O,D){O.options.selectionMode=!0,this.computeIntersection(v,O,D);const w=O.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||(0,Ev.nn)(w)&&w.intersector!==Ll.q7.TERRAIN||(O.options.selectionMode=!1,this.computeIntersection(v,O,D))}setTolerance(v=fc.vh){this.tolerance=v}addIntersectionHandler(v){this.externalIntersectionHandlers.push(v),this.externalIntersectionHandlers.sort((O,D)=>O.type===Ll.q7.TERRAIN?1:D.type===Ll.q7.TERRAIN?-1:0)}removeIntersectionHandler(v){null!=this.externalIntersectionHandlers.removeUnordered(v)&&this.externalIntersectionHandlers.sort((O,D)=>O.type===Ll.q7.TERRAIN?1:D.type===Ll.q7.TERRAIN?-1:0)}_getPickRay(v,O){return(0,Nh.u4)(this.view.state.camera,v,O)}_intersectRayFreePointLocal(v,O){if(this.viewingMode!==Us.JY.Local||(0,lt.Wi)(v))return!1;const D=this.view.renderDataExtent;if((0,lt.Wi)(D))return(0,_t.a)(O,v.origin,(0,_t.n)(Oo.WM.get(),v.direction)),!0;const w={x:D.xmax-D.xmin,y:D.ymax-D.ymin,z:8*Math.max(D.xmax-D.xmin,D.ymax-D.ymin)},te=Math.max(w.x,w.y,w.z);if(0===te)return(0,_t.a)(O,v.origin,(0,_t.n)(Oo.WM.get(),v.direction)),!0;const fe=this.view.state.camera,Pe=Math.max(0,D.xmin-fe.eye[0],fe.eye[0]-D.xmax),Ue=Math.max(0,D.ymin-fe.eye[1],fe.eye[1]-D.ymax),Xe=Math.sqrt(Pe*Pe+Ue*Ue),st=Math.abs(fe.relativeElevation)+Number.MIN_VALUE,vt=Math.max(0,Math.log(te/st))**2;let Ct=te/Math.max(1,vt);Ct=Math.max(Ct,Math.min(Xe,te));const Wt=(0,_t.g)(Oo.WM.get(),v.direction,Ct/(0,_t.l)(v.direction));return(0,_t.a)(O,v.origin,Wt),!0}intersectElevationFromScreen(v,O,D=0,w=null){return this._intersectElevation(this._getPickRay(v,this.tmpRay),O,D,w)}_intersectElevation(v,O,D=0,w=null){if((0,lt.Wi)(v))return null;const te=(0,lt.pC)(O)?O.mode:"absolute-height",fe=(0,lt.pC)(O)?(0,lt.Pt)(O.offset,0):0,Pe="on-the-ground"!==te?fe+D:0,Ue=Pe/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===te){if(this.view.renderCoordsHelper.intersectInfiniteManifold(v,Pe,Cv)){const Er=this.view.computeMapPointFromVec3d(Cv);return Er.z-=fe,Er}return null}const Xe=this.view.state.camera,st=(0,dr.Wv)(Oo.WM.get());Xe.projectToRenderScreen(v.origin,st);const vt=new OP(null,this._forEachLayer),Ct=this.view.slicePlane,Wt=(0,lt.pC)(Ct)?(0,Ev.e4)(Ct):null,Kt=(0,fc.Z8)(this.viewingMode);Kt.options.store=Ll.eC.MIN,Kt.options.verticalOffset=Ue;const Lt=v.origin,nr=(0,_t.a)(Oo.WM.get(),Lt,v.direction);Kt.reset(Lt,nr,Xe),Kt.point=st;const sr=(0,lt.pC)(w)?"type"in w&&"graphics"===w.type?Er=>Er.metadata.layerUid!==w.uid:Er=>Er.metadata.graphicUid!==w.uid:null;switch(te){case"relative-to-scene":Kt.intersect(vt.layers,st,this.tolerance,null,yr=>((0,lt.Wi)(sr)||sr(yr))&&yr.metadata&&yr.metadata.isElevationSource),this.externalIntersectionHandlers.forAll(yr=>{yr.type!==Ll.q7.I3S&&yr.type!==Ll.q7.TERRAIN||yr.intersect(Kt,yr.slicePlaneEnabled?Wt:null,Kt.rayBegin,Kt.rayEnd,st)});break;case"on-the-ground":case"relative-to-ground":this.externalIntersectionHandlers.forAll(Er=>{Er.isGround&&Er.intersect(Kt,Er.slicePlaneEnabled?Wt:null,Kt.rayBegin,Kt.rayEnd,st)})}if(Kt.results.min.getIntersectionPoint(Cv)){const Er=this.view.computeMapPointFromVec3d(Cv);return Er.z=D,Er}return null}computeIntersection(v,O,D){if((0,lt.Wi)(v))return;const w=this.view.state.camera,te=(0,dr.Wv)(Oo.WM.get());w.projectToRenderScreen(v.origin,te);const fe=new OP(D,this._forEachLayer);O.options.selectOpaqueTerrainOnly=!D||!("include"in D||"exclude"in D);const Pe=v.origin,Ue=(0,_t.a)(Oo.WM.get(),v.origin,v.direction);O.reset(Pe,Ue,w),O.intersect(fe.layers,te,this.tolerance);const Xe=this.view.slicePlane,st=(0,lt.pC)(Xe)?(0,Ev.e4)(Xe):null;O.intersect(fe.sliceableLayers,te,this.tolerance,st);const vt=D&&(D.requiresGroundFeedback||D.enableDraped);this.externalIntersectionHandlers.forAll(Wt=>{O.options.isFiltered=!fe.filterLayerUid(Wt.layerUid),(Wt.isGround&&vt||!O.options.isFiltered)&&Wt.intersect(O,Wt.slicePlaneEnabled?st:null,Pe,Ue,te)});const Ct=Oo.WM.get();if(D&&D.enableDraped&&O.results.ground.getIntersectionPoint(Ct)){const Wt=this.view.basemapTerrain,Kt=Wt.overlayManager.renderer,Lt=this.view.renderCoordsHelper.spatialReference,nr=Oo.WM.get();this.view.renderCoordsHelper.fromRenderCoords(Ct,nr,Wt.spatialReference),nr[2]=(0,lt.Pt)(this.view.elevationProvider.getElevation(Ct[0],Ct[1],Ct[2],Lt,"ground"),0),Kt.intersect(O,nr,O.results.ground,sr=>fe.filterRenderGeometry(sr))}O.sortResults(),this._processHUDResults(O)}_processHUDResults(v){const O=v.results.hud;(0,qr.JG)(this.tmpRegion,qr.Gv);const D=this.view.state.camera,w=[],te=this.tmpRegion,fe=sr=>{const Er=new sU(sr);D.projectToRenderScreen(sr.target.center,Er.screenPoint),Er.screenPoint[0]=Math.floor(Er.screenPoint[0]),Er.screenPoint[1]=Math.floor(Er.screenPoint[1]),w.push(Er),(0,qr.Ho)(te,Er.screenPoint)};v.sortResults(O.all),(0,lt.pC)(O.min.dist)&&fe(O.min);for(const sr of O.all)O.min.target.object!==sr.target.object&&O.max.target.object!==sr.target.object&&fe(sr);if((0,lt.pC)(O.max.dist)&&O.max.target.object!==O.min.target.object&&fe(O.max),!w.length)return;te[0]===te[2]&&(te[2]+=1),te[1]===te[3]&&(te[3]+=1);const Pe=D.fullWidth,Ue=D.fullHeight,Xe=Math.max(0,te[0]-ug),st=Math.max(0,te[1]-ug),vt=Math.min((0,qr.bf)(te)+2*ug,Pe-Xe),Ct=Math.min((0,qr.Cb)(te)+2*ug,Ue-st),Wt=new Uint8Array(vt*Ct*4);this.view._stage.renderView.readHUDVisibility(Xe,st,vt,Ct,Wt);let Kt=!0;const Lt=(0,lt.Wi)(v.results.max.dist);let nr=0;for(const sr of w)for(const Er of iU)if(Wt[4*(Math.min(sr.screenPoint[0]+Er[0],Pe)-te[0]+(Math.min(sr.screenPoint[1]+Er[1],Ue)-te[1])*vt)]){Kt&&(v.results.min.copy(sr.result),Kt=!1),Lt&&v.results.max.copy(sr.result),v.options.store===Ll.eC.ALL&&v.results.all.splice(nr++,0,sr.result);break}}}const ug=1,iU=(()=>{const _=[],v=ug;for(let O=-v;O<=v;O++)for(let D=-v;D<=v;D++)_.push([D+v,O+v]);return _})();class sU{constructor(v){this.result=v,this.screenPoint=(0,dr.J$)()}}let bv;function MP(_){return bv&&bv.viewingMode===_||(bv=(0,fc.Z8)(_)),bv}class OP{constructor(v,O){this.layers=new Array,this.sliceableLayers=new Array,this.include=null==v?void 0:v.include,this.exclude=null==v?void 0:v.exclude,O(D=>{D.isPickable&&this.filterLayerUid(D.apiLayerUid)&&(D.isSliceable?this.sliceableLayers:this.layers).push(D)})}filterLayerUid(v){const{include:O,exclude:D}=this;return(0,lt.Wi)(v)?null==O&&null==D:(null==O||O.has(v))&&(null==D||!D.has(v))}filterRenderGeometry(v){return this.filterLayerUid(v.layerUid)}}function PP(_){return"object"==typeof _&&"intersect"in _}const Cv=(0,$t.c)(),Tv=(0,dr.J$)();var nU=T(39912);let dg=class extends(sa.Z.EventedMixin(Bi.Z)){constructor(_){super(_),this.im=new Array,this.ground=new Array,this.scene=new Array,this.handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQuery=(0,lt.SC)(this._elevationQuery)}get elevationQuery(){return(0,lt.Wi)(this._elevationQuery)&&(this._elevationQuery=new nU.K(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQuery}enableElevationCache(_){_||(this.lastElevationQuery=null),this.elevationCacheEnabled=_}getElevation(_,v,O,D,w){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){const fe=this.lastElevationQuery;if(_===fe.x&&v===fe.y&&O===fe.z&&D.equals(fe.spatialReference)&&w===fe.queryContext)return fe.result}let te=null;return te=Mv(te,this.im,_,v,O,D,w),(0,lt.Wi)(te)&&(te=Mv(te,this.ground,_,v,O,D,w)),"scene"===w&&(te=Mv(te,this.scene,_,v,O,D,w)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:_,y:v,z:O,spatialReference:D,queryContext:w,result:te}),te}queryElevation(_,v,O,D,w,te=null,fe=0){const Pe=(0,zi.hh)();return this.elevationQuery.queryElevation(_,v,te,fe).then(Ue=>{"scene"===w&&(Ue=Mv(Ue,this.scene,_,v,O,D,w)),Pe.resolve(Ue)}).catch(Ue=>{(0,zi.D_)(Ue)?Pe.reject(Ue):Pe.resolve(this.getElevation(_,v,O,D,w))}),Pe.promise}register(_,v){this.handles.set(v,v.on("elevation-change",O=>this.emit("elevation-change",O))),this[_].push(v)}unregister(_){this.handles.has(_)&&(this.handles.get(_).remove(),this.handles.delete(_));for(const v of[this.im,this.ground,this.scene]){const O=v.indexOf(_);O>-1&&v.splice(O,1)}}};function Mv(_,v,O,D,w,te,fe){for(const Pe of v){const Ue=Pe.getElevation(O,D,w,te,fe);(0,lt.pC)(Ue)&&(_=(0,lt.pC)(_)?Math.max(Ue,_):Ue)}return _}(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],dg.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],dg.prototype,"spatialReference",void 0),dg=(0,Ze._)([(0,ui.j)("esri.views.3d.support.CombinedElevationProvider")],dg);class j0{static isValidProfile(v){return v in j0.profiles}static getDefaultProfile(){return(0,Jo.Z)("trident")||(0,Jo.Z)("esri-iPhone")?"low":"medium"}static apply(v,O){const D=j0.profiles[v];O.graphics3D.maxTotalNumberOfFeatures=D.graphics3D.maxTotalNumberOfFeatures,O.graphics3D.maxTotalNumberOfPrimitives=D.graphics3D.maxTotalNumberOfPrimitives,O.graphics3D.polygonLodFactor=D.graphics3D.polygonLodFactor,O.graphics3D.polylineLodFactor=D.graphics3D.polylineLodFactor,O.graphics3D.snapshotAvailable=D.graphics3D.snapshotAvailable;{const w=O.sceneService["3dObject"],te=D.sceneService["3dObject"];w.lodFactor=te.lodFactor,w.lodCrossfadeinDuration=te.lodCrossfadeinDuration,w.lodCrossfadeoutDuration=te.lodCrossfadeoutDuration,w.lodCrossfadeUncoveredDuration=te.lodCrossfadeUncoveredDuration}O.sceneService.point.lodFactor=D.sceneService.point.lodFactor,O.sceneService.integratedMesh.lodFactor=D.sceneService.integratedMesh.lodFactor,O.sceneService.pointCloud.lodFactor=D.sceneService.pointCloud.lodFactor,O.sceneService.uncompressedTextureDownsamplingEnabled=D.sceneService.uncompressedTextureDownsamplingEnabled,O.tiledSurface.lodBias=D.tiledSurface.lodBias,O.tiledSurface.angledSplitBias=D.tiledSurface.angledSplitBias,O.tiledSurface.reduceTileLevelDifferences=D.tiledSurface.reduceTileLevelDifferences,O.tiledSurface.textureFadeDuration=D.tiledSurface.textureFadeDuration,O.heatmap.pixelRatio=D.heatmap.pixelRatio,O.heatmap.maxTotalNumberOfFeatures=D.heatmap.maxTotalNumberOfFeatures,O.antialiasingEnabled=D.antialiasingEnabled,O.physicallyBasedRenderingEnabled=D.physicalBasedRenderingEnabled,O.highQualityTransparency=D.highQualityTransparency,O.memoryLimit=D.memoryLimit,O.additionalCacheMemory=D.additionalCacheMemory,O.frameRate=D.frameRate,O.maximumRenderResolution=D.maximumRenderResolution,O.maximumPixelRatio=D.maximumPixelRatio}}function xP(){const _=!!(0,Jo.Z)("esri-mobile"),v=!!(0,Jo.Z)("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:_?.8:1,polylineLodFactor:_?1.2:1.5,snapshotAvailable:!v},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:_},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!(0,Jo.Z)("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:_?600:750,additionalCacheMemory:_?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:_?1.2:2,polylineLodFactor:_?1.2:2,snapshotAvailable:!v},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!(0,Jo.Z)("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:_?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:_?null:4096,maximumPixelRatio:_?1:null}}}j0.debug={reset(){const _=xP();for(const v in _)j0.profiles[v]=_[v]}},function(_){_.profiles=xP()}(j0||(j0={}));const Ov=j0;var jf=T(67709);let Wh=class extends Bi.Z{constructor(){super(...arguments),this.color=new ol.Z([0,255,255]),this.haloColor=null,this.haloOpacity=1,this.fillOpacity=.25,this.shadowOpacity=.4,this.shadowColor=new ol.Z([0,0,0]),this.shadowDifference=.2}static toEngineOptions(_){const v=ol.Z.toUnitRGBA(_.color),O=(0,lt.pC)(_.haloColor)?ol.Z.toUnitRGBA(_.haloColor):v,D=ol.Z.toUnitRGBA(_.shadowColor);return{color:(0,jf.f)(v[0],v[1],v[2],v[3]),haloColor:(0,jf.f)(O[0],O[1],O[2],O[3]),haloOpacity:_.haloOpacity,haloOpacityOccluded:.25*_.haloOpacity,fillOpacity:_.fillOpacity,fillOpacityOccluded:.25*_.fillOpacity,shadowOpacity:_.shadowOpacity,shadowColor:(0,vi.f)(D[0],D[1],D[2],D[3]),occludedShadowOpacity:_.shadowOpacity*(1-_.shadowDifference)}}};(0,Ze._)([(0,nt.Cb)({type:ol.Z})],Wh.prototype,"color",void 0),(0,Ze._)([(0,nt.Cb)({type:ol.Z})],Wh.prototype,"haloColor",void 0),(0,Ze._)([(0,nt.Cb)()],Wh.prototype,"haloOpacity",void 0),(0,Ze._)([(0,nt.Cb)()],Wh.prototype,"fillOpacity",void 0),(0,Ze._)([(0,nt.Cb)()],Wh.prototype,"shadowOpacity",void 0),(0,Ze._)([(0,nt.Cb)({type:ol.Z})],Wh.prototype,"shadowColor",void 0),(0,Ze._)([(0,nt.Cb)()],Wh.prototype,"shadowDifference",void 0),Wh=(0,Ze._)([(0,ui.j)("esri.views.3d.support.HighlightOptions")],Wh);const Db=Wh;var oU=T(35082),DP=T(68886),AP=T(77294);class aU{constructor(v,O){this.spatialReference=O,this.unitInMeters=(0,uv.c9)(this.spatialReference,(0,Zi.Iu)(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=(0,oU.getGeometryServiceURL)(v&&v.get("portalItem")).catch(()=>{throw new Ls.Z("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}toGeographic(v){var O=this;return(0,Ai.Z)(function*(){const D=yield O._geometryServiceURLPromise;let w,te=!0;Array.isArray(v[0])&&"number"!=typeof v[0]?w=v:(w=[v],te=!1);const fe=w.map(Xe=>Xe instanceof vs.Z?Xe:new vs.Z(Xe,O.spatialReference)),Pe=new AP.Z({geometries:fe,outSpatialReference:Xn.Z.WGS84}),Ue=(yield(0,DP.i)(D,Pe)).map(Xe=>"point"===Xe.type?[Xe.x,Xe.y]:void 0);return te?Ue:Ue[0]})()}}let Vh=class extends Bi.Z{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1}};(0,Ze._)([(0,nt.Cb)()],Vh.prototype,"minTotalNumberOfFeatures",void 0),(0,Ze._)([(0,nt.Cb)()],Vh.prototype,"maxTotalNumberOfFeatures",void 0),(0,Ze._)([(0,nt.Cb)()],Vh.prototype,"maxTotalNumberOfPrimitives",void 0),(0,Ze._)([(0,nt.Cb)()],Vh.prototype,"snapshotAvailable",void 0),(0,Ze._)([(0,nt.Cb)()],Vh.prototype,"polygonLodFactor",void 0),(0,Ze._)([(0,nt.Cb)()],Vh.prototype,"polylineLodFactor",void 0),Vh=(0,Ze._)([(0,ui.j)("esri.views.3d.support.QualitySettings.Graphics3DSettings")],Vh);let zh=class extends Bi.Z{constructor(){super(...arguments),this.lodFactor=1}};(0,Ze._)([(0,nt.Cb)()],zh.prototype,"lodFactor",void 0),zh=(0,Ze._)([(0,ui.j)("esri.views.3d.support.QualitySettings.LoDFactorSettings")],zh);let Pv=class extends zh{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};Pv=(0,Ze._)([(0,ui.j)("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],Pv);let Rp=class extends Bi.Z{constructor(){super(...arguments),this["3dObject"]=new Pv,this.point=new zh,this.integratedMesh=new zh,this.pointCloud=new zh,this.uncompressedTextureDownsamplingEnabled=!1}};(0,Ze._)([(0,nt.Cb)({type:Pv})],Rp.prototype,"3dObject",void 0),(0,Ze._)([(0,nt.Cb)({type:zh})],Rp.prototype,"point",void 0),(0,Ze._)([(0,nt.Cb)({type:zh})],Rp.prototype,"integratedMesh",void 0),(0,Ze._)([(0,nt.Cb)({type:zh})],Rp.prototype,"pointCloud",void 0),(0,Ze._)([(0,nt.Cb)()],Rp.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Rp=(0,Ze._)([(0,ui.j)("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Rp);let F0=class extends Bi.Z{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=500}};(0,Ze._)([(0,nt.Cb)()],F0.prototype,"lodBias",void 0),(0,Ze._)([(0,nt.Cb)()],F0.prototype,"angledSplitBias",void 0),(0,Ze._)([(0,nt.Cb)()],F0.prototype,"reduceTileLevelDifferences",void 0),(0,Ze._)([(0,nt.Cb)()],F0.prototype,"textureFadeDuration",void 0),F0=(0,Ze._)([(0,ui.j)("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],F0);let L_=class extends Bi.Z{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};(0,Ze._)([(0,nt.Cb)()],L_.prototype,"pixelRatio",void 0),(0,Ze._)([(0,nt.Cb)()],L_.prototype,"maxTotalNumberOfFeatures",void 0),L_=(0,Ze._)([(0,ui.j)("esri.views.3d.support.QualitySettings.HeatmapSettings")],L_);let Yc=class extends Bi.Z{constructor(){super(...arguments),this.graphics3D=new Vh,this.sceneService=new Rp,this.tiledSurface=new F0,this.heatmap=new L_,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0}};(0,Ze._)([(0,nt.Cb)({type:Vh})],Yc.prototype,"graphics3D",void 0),(0,Ze._)([(0,nt.Cb)({type:Rp})],Yc.prototype,"sceneService",void 0),(0,Ze._)([(0,nt.Cb)({type:F0})],Yc.prototype,"tiledSurface",void 0),(0,Ze._)([(0,nt.Cb)({type:L_})],Yc.prototype,"heatmap",void 0),(0,Ze._)([(0,nt.Cb)()],Yc.prototype,"antialiasingEnabled",void 0),(0,Ze._)([(0,nt.Cb)()],Yc.prototype,"physicallyBasedRenderingEnabled",void 0),(0,Ze._)([(0,nt.Cb)()],Yc.prototype,"highQualityTransparency",void 0),(0,Ze._)([(0,nt.Cb)()],Yc.prototype,"memoryLimit",void 0),(0,Ze._)([(0,nt.Cb)()],Yc.prototype,"additionalCacheMemory",void 0),(0,Ze._)([(0,nt.Cb)()],Yc.prototype,"frameRate",void 0),(0,Ze._)([(0,nt.Cb)()],Yc.prototype,"maximumRenderResolution",void 0),(0,Ze._)([(0,nt.Cb)()],Yc.prototype,"maximumPixelRatio",void 0),Yc=(0,Ze._)([(0,ui.j)("esri.views.3d.support.QualitySettings.QualitySettings")],Yc);const SP=Yc;var lU=T(60011),hg=T(39135),RP=T(1036);function wP(_){return"function"==typeof _.getUsedMemory}const cU=pn.Z.getLogger("esri.views.3d.support.MemoryController");let Jc=class extends Bi.Z{constructor(_){super(_),this._quality=1,this._memoryUsed=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new RP.WJ,this._numQualityChanges=0,this._maxMemory=500,this._additionalCacheMemory=100}destroy(){this._cacheStorage.destroy()}set maxMemory(_){null==_||_<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<_&&this._updateQuality(1),this._maxMemory=_)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(_){null!=_&&_>=0&&(this._additionalCacheMemory=_)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._memoryUsed}newCache(_,v){return new RP.Xq(_,this._cacheStorage,v)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let _=this._layersUpdating();this._memoryPredicted<.6&&this._canFastRecover?(this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(1)):_?(this._memoryPredicted>1.1||this._memoryUsed>1)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)):(this._downscaleMemoryUsed=0,this._memoryUsed>1?(this._stableQuality=0,this._canFastRecover=!1,_=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(this._memoryUsed<.75&&this._quality<1?(this._stableQuality=this._quality,_=this._updateQuality(this._quality+.05)):this._quality<1&&(this._canFastRecover=!0))),this._updating=_}_updateQuality(_){return(_=Math.min(Math.max(_,this.minQuality),1))!==this._quality&&(this._quality=_,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(_=>!!_.updating)}_updateMemory(){let _=0,v=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(_+=this.view.basemapTerrain.getUsedMemory());const O=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;(0,lt.pC)(O)&&(_+=O.usedMemory),this.view.allLayerViews&&this.view.allLayerViews.forEach(fe=>{if(wP(fe)){const Pe=fe.ignoresMemoryFactor()?this._quality:1;_+=fe.getUsedMemory()*Pe,v+=fe.getUnloadedMemory()*Pe}});const D=null==this._warnMemoryUsage||Math.round(10*_)!==Math.round(10*this._warnMemoryUsage),w=1048576*this.maxMemory;if(_>w&&D){this._warnMemoryUsage=_;const fe=Ue=>(Ue/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",Pe=Math.round(100*this._quality);cU.warn(`Memory Limit exceeded! Limit: ${fe(w)} Current: ${fe(_)} Projected: ${fe(_+v)} Quality: ${Pe}%`)}this._memoryUsed=_/w,this._memoryPredicted=(_+v)/w,this._cacheStorage.maxSize=Math.max(0,w-_+1048576*this.additionalCacheMemory)}get test(){const _=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const v=_._numQualityChanges;return _._numQualityChanges=0,v}}}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Jc.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"maxMemory",null),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"additionalCacheMemory",null),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"memoryFactor",null),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"usedMemory",null),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"_quality",void 0),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"_memoryUsed",void 0),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"_updating",void 0),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"_stableQuality",void 0),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"_maxMemory",void 0),(0,Ze._)([(0,nt.Cb)()],Jc.prototype,"_additionalCacheMemory",void 0),Jc=(0,Ze._)([(0,ui.j)("esri.views.3d.support.MemoryController")],Jc);var Sb=T(91540);let Dv=class extends Bi.Z{constructor(){super(...arguments),this.updating=!1}};var Rb;(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Dv.prototype,"updating",void 0),Dv=(0,Ze._)([(0,ui.j)("esri.views.3d.support.ResourceController")],Dv),function(_){let v=class extends Dv{constructor(){super(...arguments),this._scheduler=null,this._memoryController=null,this._streamDataLoader=null,this._scheduleTask=Gn.sq,this._cameraChangeTime=0,this._handles=new cn.Z,this._frameTask=null,this._state=Gn.ZM.IDLE}initialize(){this._cameraChangeTime=performance.now(),this._scheduler=(0,Gn.z4)(),this._memoryController=function uU(_){return new Jc({view:_})}(this.view),this._streamDataLoader=new Sb.wu,this._streamDataLoader.setup(hg.NT,hg.Ty,this._scheduler),this._handles.add([(0,pt.YP)(()=>{var D;return null==(D=this.view.state)?void 0:D.camera},(D,w)=>this._cameraChangedHandler(D,w),pt.Z_),(0,pt.YP)(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=(0,rt.A)({update:D=>this._frame(D)}),this._scheduleTask=this._scheduler.registerTask(Gn.T8.RESOURCE_CONTROLLER)}destroy(){this._handles=(0,lt.SC)(this._handles),this._scheduleTask.remove(),this._frameTask=(0,lt.hw)(this._frameTask),this._streamDataLoader=(0,lt.SC)(this._streamDataLoader),this._memoryController=(0,lt.SC)(this._memoryController),this._scheduler=(0,lt.SC)(this._scheduler)}get updating(){var D,w,te;return!!((null==(D=this._memoryController)?void 0:D.updating)||(null==(w=this._streamDataLoader)?void 0:w.updating)||(null==(te=this._scheduleTask)?void 0:te.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}schedule(D,w,te){return this._scheduleTask.schedule(D,w,te)}createStreamDataRequester(D){const w=this._streamDataLoader;return{request:(te,fe,Pe)=>w.request(te,fe,D,Pe),get busy(){return!w.hasDownloadSlots(D)}}}_frame(D){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step((0,io.D9)(D.deltaTime)),!this._scheduler)||(this._updateState(),this._scheduler.state=this._state,this._scheduler.updateBudget(D)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_cameraChangedHandler(D,w){D&&w&&D.almostEquals(w)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}_updateState(){this.view.animation?this._state=Gn.ZM.ANIMATING:this.view.interacting?this._state=Gn.ZM.INTERACTING:(this._state===Gn.ZM.ANIMATING&&(this._cameraChangeTime=0),this._state=performance.now()-this._cameraChangeTime<=O?Gn.ZM.INTERACTING:Gn.ZM.IDLE)}get test(){return{getQueueStats:D=>this._streamDataLoader.test.loadQueue.getStatsForType(D),state:this._state}}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],v.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)()],v.prototype,"_scheduler",void 0),(0,Ze._)([(0,nt.Cb)()],v.prototype,"_memoryController",void 0),(0,Ze._)([(0,nt.Cb)()],v.prototype,"_streamDataLoader",void 0),(0,Ze._)([(0,nt.Cb)()],v.prototype,"_scheduleTask",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],v.prototype,"updating",null),v=(0,Ze._)([(0,ui.j)("esri.views.3d.support.ResourceController")],v),_.ResourceController=v;const O=300}(Rb||(Rb={}));var fU=T(27306),Ji=T(61779);class mU{constructor(v,O){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=v.layer,this.memory=(0,Ji.wP)(v)?O.basemapTerrain.getUsedMemoryForLayerView(v):v.getUsedMemory(),function _U(_){return"performanceInfo"in _}(v)){const D=v.performanceInfo;this.displayedNumberOfFeatures=D.displayedNumberOfFeatures,this.maximumNumberOfFeatures=D.maximumNumberOfFeatures,this.totalNumberOfFeatures=D.totalNumberOfFeatures}}}class gU{constructor(v){this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array;const O=v.resourceController.memoryController;this.totalMemory=O.maxMemory*fU.Y8.MEGABYTES,this.usedMemory=Math.round(O.usedMemory*this.totalMemory),this.quality=O.memoryFactor,this.load=v.resourceController.scheduler.load,this.terrainMemory=v.basemapTerrain?v.basemapTerrain.getUsedMemory():0;const D=v._stage&&v._stage.renderView&&v._stage.renderView.edgeView;this.edgesMemory=(0,lt.pC)(D)?D.usedMemory:0,v.allLayerViews.items.forEach(w=>{(wP(w)||(0,Ji.wP)(w))&&this.layerPerformanceInfos.push(new mU(w,v))}),this.layerPerformanceInfos.sort((w,te)=>te.memory-w.memory)}}var Fs=T(42743),yU=T(81695);class vU extends Jd{constructor(v,O,D,w){super(O,w),this._streamDataRequester=v,this._parameters=D}fromUrl(v,O,D){var w=this;return(0,Ai.Z)(function*(){(0,zi.k_)(D);const te=(0,lt.pC)(D)&&D.signal,fe=w.makeUid(v,O);let Pe=w._textureRequests.get(fe);if(!Pe){const Ue=new AbortController,Xe=w._streamDataRequester.request(v,"image",{uid:fe,signal:Ue.signal});Pe={referenceCount:0,texture:null,textureAsync:null,abortController:Ue},w._textureRequests.set(fe,Pe),Pe.textureAsync=Xe.then(function(){var st=(0,Ai.Z)(function*(vt){const Ct=w._createTexture(v,vt,O);return Pe.texture=Ct,Pe.abortController=null,w._stage.add(Ct),yield w._stage.load(Ct),{uid:fe,texture:Ct,release:()=>w._release(fe)}});return function(vt){return st.apply(this,arguments)}}(),st=>{throw Pe.abortController=null,st})}return Pe.referenceCount++,new Promise((Ue,Xe)=>{(0,zi.fu)(te,()=>{Xe((0,zi.zE)())}),Pe.textureAsync.then(Ue,Xe)}).catch(Ue=>{throw w._release(fe),Ue})})()}_createTexture(v,O,D){const w=yi(or({},this._parameters),{powerOfTwoResizeMode:Fs.CE.PAD});if((0,ll.zd)(v)){if(D||0===O.width&&0===O.height){const te=O.width?O.height/O.width:1;D=D||64,te>1?(O.width=Math.round(D/te),O.height=D):(O.width=D,O.height=Math.round(D*te))}this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(w.preMultiplyAlpha=!1)}return w.width=O.width,w.height=O.height,new yU.x(O,w)}}class EU{constructor(v){this.textures=null,this.streamDataRequester=null,this.graphicsOwners=[],this.screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this.viewState=v.viewState,this.view=v.view,this.pointsOfInterest=v.pointsOfInterest,this.objectResourceCache=v.objectResourceCache,this.streamDataRequester=v.resourceController.createStreamDataRequester(hg.Bh.SYMBOLOGY),this.textures=new vU(this.streamDataRequester,v.view._stage,{preMultiplyAlpha:!0,wrap:{s:Jt.e8.CLAMP_TO_EDGE,t:Jt.e8.CLAMP_TO_EDGE}},v.resourceController.scheduler);const O=(0,Zi.Iu)(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=(0,sv.Gw)(v.viewingMode,O),this.screenSizePerspectiveSettingsLabels=(0,sv.n9)(v.viewingMode,O)}destroy(){this.textures.destroy(),this.textures=null,this.streamDataRequester=null}addGraphicsOwner(v){if(!v)return(0,Ut.kB)();this.graphicsOwners.push(v);const O=(0,pt.YP)(()=>{var D;return null==(D=v.layer)?void 0:D.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),(0,Ut.kB)(()=>{O.remove(),(0,Cl.e$)(this.graphicsOwners,v),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const v=this.graphicsOwners.some(O=>{var D;return!0===(null==(D=O.layer)?void 0:D.screenSizePerspectiveEnabled)});if(v&&!this.screenSizePerspectiveHandles){this.screenSizePerspectiveHandles=new cn.Z;const O=()=>this._updateScreenSizePerspectiveSettings();this.screenSizePerspectiveHandles.add([(0,pt.YP)(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,O,pt.Z_),this.viewState.events.on("camera-projection-changed",O)]),this._updateScreenSizePerspectiveSettings()}else!v&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)}_updateScreenSizePerspectiveSettings(){Av.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance,Av.fovY=this.viewState.camera.fovY,this.screenSizePerspectiveSettings.update(Av),this.screenSizePerspectiveSettingsLabels.update(Av),this.view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}const Av={distance:0,fovY:0};var Ff=T(20383),LP=T(37118),bU=(T(9260),T(89673)),Wo=T(69852),CU=T(26531),TU=T(21716);class W0{constructor(v,O,D=""){this.graphics=v,this._symbol=new Wo.Z({symbolLayers:[new CU.Z({material:{color:O},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new TU.Z({text:D,halo:{color:"white",size:1/.75},material:{color:O},size:12})]})}show(v,O){if((0,lt.Wi)(O))return;this.hide();const D=new vs.Z({x:v[0],y:v[1],z:v[2],spatialReference:O});this._graphic=new Dn.Z({geometry:D,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){(0,lt.pC)(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)}}let V0=class extends Bi.Z{constructor(_){super(_),this.handles=new cn.Z}destroy(){this.handles.destroy()}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],V0.prototype,"renderCoordsHelper",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],V0.prototype,"surface",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],V0.prototype,"state",void 0),V0=(0,Ze._)([(0,ui.j)("esri.views.3d.support.PointOfInterest")],V0);const MU=Array;let rd=class extends V0{constructor(_){super(_),this._dirty=!1,this._propertiesPool=new B0.L({location:vs.Z,renderLocation:MU},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.cameraName="camera",this.renderLocation=(0,$t.c)(),this.tmpPoint=new vs.Z}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const _=()=>this._setDirty();this.handles.add((0,pt.on)(()=>{var v,O;return null==(O=null==(v=this.map)?void 0:v.ground)?void 0:O.layers},"change",_,{onListenerAdd:_,onListenerRemove:_}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool.destroy(),this._propertiesPool=null}get _camera(){return this.state[this.cameraName]}get location(){const _=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,_,this.state.spatialReference),_}get scale(){const _=this._camera,v=(0,_t.i)(_.eye,this.renderLocation);return Sf({renderCoordsHelper:this.renderCoordsHelper,state:{camera:_}},v,0)}get updating(){return this._dirty||null!=this._pendingElevationQueryController}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const _=this._pendingElevationQueryController;_&&(this._pendingElevationQueryController=null,_.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return void this._updateSurfaceAltitude(0);this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);let _=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:_.signal,cache:this.cache}).then(v=>this._updateSurfaceAltitude(v.geometry.z)).catch(v=>{(0,zi.D_)(v)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===_&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),_=null}),this._pendingElevationQueryController=_}_updateSurfaceAltitude(_){this._estimatedSurfaceAltitude!==_&&(this._estimatedSurfaceAltitude=_,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(wb,this._estimatedSurfaceAltitude,this._camera.eye),(0,_t.k)(this._get("renderLocation"),wb)||this._set("renderLocation",(0,_t.c)(this._propertiesPool.get("renderLocation"),wb))}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],rd.prototype,"scheduler",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],rd.prototype,"cache",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],rd.prototype,"task",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],rd.prototype,"cameraName",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],rd.prototype,"location",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],rd.prototype,"map",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],rd.prototype,"renderLocation",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],rd.prototype,"scale",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],rd.prototype,"updating",null),rd=(0,Ze._)([(0,ui.j)("esri.views.3d.support.CameraOnSurface")],rd);const wb=(0,$t.c)(),OU=Array;let Pu=class extends V0{constructor(_){super(_),this._propertiesPool=new B0.L({location:vs.Z,renderLocation:OU},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.cameraName="camera",this.distance=0,this.renderLocation=(0,$t.c)(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=(0,lt.hw)(this._frameWorker),this._propertiesPool=(0,lt.SC)(this._propertiesPool)}get _camera(){return this.state[this.cameraName]}get location(){const _=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,_,this.state.spatialReference),_}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1}_updateRenderLocation(){const _=xU;let v=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,_);!v&&this._currentSurfaceAltitude!==this._latestSurfaceAltitude&&(v=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,_),v&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const D=DU;v&&this._latestSurfaceAltitudeChangesDistanceSignificantly(_,D)&&((0,_t.c)(_,D),this._currentSurfaceAltitude=this._latestSurfaceAltitude),v?this.distance=(0,_t.i)(this._camera.eye,_):((0,_t.g)(_,this._camera.viewForward,this._get("distance")),(0,_t.a)(_,_,this._camera.eye)),(0,_t.k)(this._get("renderLocation"),_)||this._set("renderLocation",(0,_t.c)(this._propertiesPool.get("renderLocation"),_))}_calculateSurfaceIntersection(_,v){const O=this._camera;if(!this.renderCoordsHelper.intersectManifold(O.ray,_,v))return!1;if(this.state.isGlobal){const D=(0,Zi.Iu)(this.renderCoordsHelper.spatialReference).radius,w=D+_,te=(0,_t.p)(O.eye),fe=te<w*w,Pe=(0,_t.i)(O.eye,v);if(fe&&Pe>D/4){const Ue=w-Math.sqrt(te);return(0,_t.g)(v,O.viewForward,Ue),(0,_t.a)(v,v,O.eye),!0}}else{const D=this.surface.ready?this.surface.extent:null;(0,lt.pC)(D)&&(0,ci.dH)(D,this.surface.spatialReference,pg,this.renderCoordsHelper.spatialReference)&&(v[0]=(0,li.uZ)(v[0],pg[0],pg[2]),v[1]=(0,li.uZ)(v[1],pg[1],pg[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(_,v){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==_)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,v)){if(Yl.Z.TESTS_DISABLE_OPTIMIZATIONS)return!0;const O=this._camera.eye,D=(0,_t.i)(O,_),w=(0,_t.i)(O,v);if(Math.abs(w-D)/D>PU)return!0}return!1}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Pu.prototype,"scheduler",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Pu.prototype,"task",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Pu.prototype,"cameraName",void 0),(0,Ze._)([(0,nt.Cb)()],Pu.prototype,"distance",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Pu.prototype,"estimateSurfaceAltitudeAtCenter",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pu.prototype,"location",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Pu.prototype,"renderLocation",void 0),(0,Ze._)([(0,nt.Cb)()],Pu.prototype,"updating",void 0),Pu=(0,Ze._)([(0,ui.j)("esri.views.3d.support.CenterOnSurface")],Pu);const PU=.05,xU=(0,$t.c)(),DU=(0,$t.c)(),pg=(0,qr.Ue)();class AU{constructor(v){this.handles=new cn.Z,this.events=new sa.Z,this.contentLayerViews=v.contentLayerViews,this.handles.add(this.contentLayerViews.on("change",O=>this._layerViewsChanged(O))),this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}destroy(){this.handles&&(this.handles.destroy(),this.handles=null)}_layerViewsChanged(v){v.added.forEach(O=>{"esri.views.3d.layers.SceneLayerView3D"===O.declaredClass&&this.handles.add(O.on("visible-geometry-changed",()=>this._contentChanged()),O.uid)}),v.removed.forEach(O=>this.handles.remove(O.uid))}_contentChanged(){this.events.emit("request-update",SU)}}const SU={},RU=Array;let Gh=class extends V0{constructor(_){super(_),this._propertiesPool=new B0.L({location:vs.Z,renderLocation:RU},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([(0,pt.YP)(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),(0,pt.YP)(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Gn.T8.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool.destroy(),this._propertiesPool=null}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const _=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,_,this.state.spatialReference),_}get running(){return this._dirty}runTask(){const _=this._get("renderLocation"),v=this.centerOnSurface.renderLocation,O=this.renderCoordsHelper,D=this.state.contentCamera;this._dirty=!1,O.worldUpAtPosition(v,UP);const w=Math.max(0,(Math.acos((0,_t.e)(UP,D.viewForward))-.5*Math.PI)*(D.aboveGround?1:-1));if(Number.isNaN(w)){if(!_||!(0,_t.z)(_,v)){const Ue=this._propertiesPool.get("renderLocation");(0,_t.c)(Ue,v),this._set("renderLocation",Ue)}return}const te=1-(0,li.uZ)(w/(.5*Math.PI),0,1),fe=te*te*te;this._calculateScreenHorizontalEdgeOnSurface(BP);const Pe=this._propertiesPool.get("renderLocation");(0,_t.h)(Pe,v,BP,fe),_&&(0,_t.z)(_,Pe)||this._set("renderLocation",Pe)}_calculateScreenHorizontalEdgeOnSurface(_){const v=this.state.contentCamera,O=v.getRenderCenter((0,dr.J$)());if(O[1]=v.aboveGround?v.padding[$n.N.BOTTOM]:v.fullHeight-v.padding[$n.N.TOP],this.estimateSurfaceIntersectionAtRenderPoint(O,_))return _;const D=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(v.unprojectFromRenderScreen(O,fg)){(0,_t.b)(fg,fg,v.eye);const w=(0,_t.n)(fg,fg);if(this.renderCoordsHelper.intersectManifold((0,Yu.re)(v.eye,w),D,_))return _}return this.renderCoordsHelper.setAltitude(_,D,v.eye)}updateRenderLocation(){this._dirty=!0}};(0,Ze._)([(0,nt.Cb)()],Gh.prototype,"_dirty",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Gh.prototype,"scheduler",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Gh.prototype,"centerOnSurface",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Gh.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Gh.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Gh.prototype,"location",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Gh.prototype,"renderLocation",void 0),Gh=(0,Ze._)([(0,ui.j)("esri.views.3d.support.CenterOnSurface")],Gh);const UP=(0,$t.c)(),fg=(0,$t.c)(),BP=(0,$t.c)();let wp=class extends Bi.Z{constructor(_){super(_),this.location=null,this._updateController=null,this._handles=new cn.Z}get renderLocation(){if(!this.location)return null;const _=(0,$t.c)();return this.view.renderCoordsHelper.toRenderCoords(this.location,_),_}initialize(){this.view.state.isLocal&&(this._handles.add([(0,pt.YP)(()=>{var _,v;return[null==(_=this.surfaceView)?void 0:_.spatialReference,null==(v=this.surfaceView)?void 0:v.extent]},()=>this._update()),(0,pt.on)(()=>{var _;return null==(_=this.surface)?void 0:_.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||(0,lt.Wi)(this.surfaceView.extent)||!this.surfaceView.spatialReference)return void this._set("location",null);const _=(0,qr.be)(this.surfaceView.extent),v=new vs.Z({x:_[0],y:_[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(v,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(O=>{this._updateController=null,this._set("location",O.geometry)}).catch(O=>{(0,zi.D_)(O)||O&&"elevation-query:invalid-layer"===O.name||console.error("StableSurfaceCenter failed to update: ",O)})):this._set("location",v)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wp.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],wp.prototype,"cache",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,aliasOf:"view.map.ground"})],wp.prototype,"surface",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,aliasOf:"view.basemapTerrain"})],wp.prototype,"surfaceView",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],wp.prototype,"location",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],wp.prototype,"renderLocation",null),wp=(0,Ze._)([(0,ui.j)("esri.views.3d.terrain.StableSurfaceCenter")],wp);let Ip=class extends Bi.Z{constructor(){super(...arguments),this.handles=new cn.Z,this._tileGeometryUpdateExtent=(0,qr.cS)(),this._tileGeometryUpdateSpatialReference=null,this.events=new sa.Z,this.updating=!1}initialize(){this.handles.add([this.surface.on("elevation-change",_=>this._tileGeometryChanged(_)),this.scheduler.registerTask(Gn.T8.SURFACE_GEOMETRY_UPDATES,this)])}destroy(){this.handles=(0,lt.SC)(this.handles)}get running(){return this.updating}runTask(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",wU),(0,qr.cS)(this._tileGeometryUpdateExtent),this._set("updating",!1))}_tileGeometryChanged(_){this._tileGeometryUpdateSpatialReference=_.spatialReference,(0,qr.jn)(this._tileGeometryUpdateExtent,_.tile.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let _=this.centerOnSurfaces[0];for(let v=1;v<this.centerOnSurfaces.length;v++){const O=this.centerOnSurfaces[v];O.distance>_.distance&&(_=O)}return _}_centerIntersectsExtent(_,v){const O=this.state.camera.eye,D=IU,w=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(O,Wf,v),this.renderCoordsHelper.fromRenderCoords(w.renderLocation,Vf,v),Wf[0]<Vf[0]?(D[0]=Wf[0],D[2]=Vf[0]):(D[0]=Vf[0],D[2]=Wf[0]),Wf[1]<Vf[1]?(D[1]=Wf[1],D[3]=Vf[1]):(D[1]=Vf[1],D[3]=Wf[1]),(0,qr.kK)(D,_)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ip.prototype,"state",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ip.prototype,"centerOnSurfaces",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ip.prototype,"renderCoordsHelper",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ip.prototype,"scheduler",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ip.prototype,"surface",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Ip.prototype,"updating",void 0),Ip=(0,Ze._)([(0,ui.j)("esri.views.3d.support.SurfaceGeometryUpdates")],Ip);const wU={},Wf=(0,$t.c)(),Vf=(0,$t.c)(),IU=(0,qr.cS)();let mc=class extends Bi.Z{constructor(_){super(_),this._handles=new cn.Z,this._tmpRay=(0,Yu.Ue)(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new B0.L({renderPointOfView:LU},this),this.renderPointOfView=(0,$t.c)(),this._pois=new Array,this._debugCenters=new Map}initialize(){var Xe;const{state:_,basemapTerrain:v,renderCoordsHelper:O,map:D}=this.view;this._surfaceIntersector=(0,fc.Z8)(_.viewingMode),this._surfaceIntersector.options.backfacesTerrain=!_.isGlobal,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Ll.eC.MIN,this._contentIntersector=(0,fc.Z8)(_.viewingMode);const w=()=>this._estimateSurfaceAltitudeAtCenter(),te=this.view.resourceController.scheduler,fe=(0,lt.Wg)(null==(Xe=this.view.basemapTerrain)?void 0:Xe.elevationQueryCache),Pe={state:_,scheduler:te,surface:v,renderCoordsHelper:O};this._set("centerOnSurfaceInfrequent",new Pu(yi(or({},Pe),{task:Gn.T8.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:w}))),this._set("centerOnSurfaceFrequent",new Pu(yi(or({},Pe),{task:Gn.T8.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:w}))),this._set("contentCenterOnSurface",new Pu(yi(or({},Pe),{task:Gn.T8.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:w,cameraName:"contentCamera"}))),this._set("centerOnContent",new Pu(yi(or({},Pe),{task:Gn.T8.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}))),this._set("cameraOnSurface",new rd(yi(or({},Pe),{cache:fe,task:Gn.T8.POINT_OF_INTEREST_INFREQUENT,map:D}))),this._set("contentCameraOnSurface",new rd(yi(or({},Pe),{cache:fe,task:Gn.T8.POINT_OF_INTEREST_INFREQUENT,map:D,cameraName:"contentCamera"}))),this._set("surfaceGeometryUpdates",new Ip(yi(or({},Pe),{centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}))),this._set("contentGeometryUpdates",new AU({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:O})),this._set("surfaceOrigin",new wp({cache:fe,view:this.view})),this._set("focus",new Gh({state:_,scheduler:te,surface:v,renderCoordsHelper:O,centerOnSurface:this.contentCenterOnSurface,estimateSurfaceIntersectionAtRenderPoint:(st,vt)=>this._estimateSurfaceIntersectionAtRenderPoint(st,this.view.state.contentCamera,vt)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);const Ue=this.view.graphics;this._debugCenters.set(this.centerOnContent,new W0(Ue,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new W0(Ue,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new W0(Ue,"red","CenterOnSurface")),this._debugCenters.set(this.contentCenterOnSurface,new W0(Ue,"red","ContentCenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new W0(Ue,"blue","CameraOnSurface")),this._debugCenters.set(this.contentCameraOnSurface,new W0(Ue,"blue","ContentCameraOnSurface")),this._debugCenters.set(this.focus,new W0(Ue,"green","Focus")),this._handles.add([(0,pt.YP)(()=>_.camera,st=>this._cameraChanged(st),pt.Z_),(0,pt.YP)(()=>v.extent,()=>this._updateCenterPointsOfInterest()),(0,pt.gx)(()=>!v.updating,()=>this._updateCenterPointsOfInterest(),pt.Z_),(0,pt.on)(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),(0,pt.on)(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),(0,pt.gx)(()=>Yl.Z.SHOW_POI,st=>this._setDebug(st),pt.nn)]),this._cameraChanged(this.view.state.camera);for(const st of this._pois)st.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const _ of this._pois)_.destroy();this.surfaceOrigin.destroy()}get updating(){var _;return!(!(null==(_=this.surfaceGeometryUpdates)?void 0:_.updating)&&!this._pois.some(v=>v.updating))}get centerRay(){return this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1),this._centerRay}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const _=this.centerRay;return(0,lt.Wi)(_)||(this._contentAltitudeAtCenter=this.view.sceneIntersectionHelper.intersectRay(_,this._contentIntersector,U_,BU)?this.view.renderCoordsHelper.getAltitude(U_):this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const _=this.centerRay;if((0,lt.Wi)(_))return this._surfaceAltitudeAtCenter;const v=_.origin,O=(0,_t.a)(U_,_.origin,_.direction);return this._surfaceIntersector.resetWithRay(_,this.view.state.camera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,v,O),this._surfaceIntersector.results.min.getIntersectionPoint(U_)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(U_)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(_,v,O){const D=(0,Nh.eW)(v,_,UU);if((0,lt.Wi)(D))return null;const w=D.origin,te=(0,_t.a)(U_,D.origin,D.direction);return this._surfaceIntersector.resetWithRay(D,v),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,w,te),this._surfaceIntersector.results.min.getIntersectionPoint(O)?O:null}_cameraChanged(_){this._updateCenterPointsOfInterest();const v=_.eye;(0,_t.k)(this.renderPointOfView,v)||this._set("renderPointOfView",(0,_t.c)(this._propertiesPool.get("renderPointOfView"),v))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const _ of this._pois)_.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(_){if(!_)return this._debugCenters.forEach(v=>v.hide()),void this._handles.remove("debug");for(const v of this._pois)this._handles.add((0,pt.YP)(()=>v.renderLocation,O=>this._debugCenters.get(v).show(O,v.renderCoordsHelper.spatialReference),pt.nn),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const _ of this._pois)_.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"centerOnContent",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"centerOnSurfaceFrequent",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"centerOnSurfaceInfrequent",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"contentCenterOnSurface",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"cameraOnSurface",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"contentCameraOnSurface",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"focus",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"renderPointOfView",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"surfaceOrigin",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"contentGeometryUpdates",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"surfaceGeometryUpdates",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],mc.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],mc.prototype,"updating",null),mc=(0,Ze._)([(0,ui.j)("esri.views.3d.support.PointsOfInterest")],mc);const LU=Array,U_=(0,$t.c)(),UU=(0,Yu.Ue)(),BU={exclude:new Set([Qu.cy])};var NU=T(30346);class jU{constructor(v){this.store=v}destroy(){this.store.destroy()}get(v){return this.store.get(v)}put(v,O){this.store.put(v,O,O.values.byteLength+256)}}var FU=T(36596),Sv=T(21410),WU=T(41632);class Ib{constructor(v=0,O=0){this.min=v,this.max=O,this.level=0,this.hasNoDataValues=!1}copyFrom(v){this.min=v.min,this.max=v.max,this.level=v.level,this.hasNoDataValues=v.hasNoDataValues}}class VU{constructor(v,O,D){this.type="elevation",this.samplerData=null,this.level=v[0],this.i=v[1],this.j=v[2],this.extent=O;const w=D.noDataValue,te=D.values;let fe=1/0,Pe=-1/0,Ue=!0,Xe=!1;for(let st=0;st<te.length;st++){const vt=te[st];vt!==w?(fe=vt<fe?vt:fe,Pe=vt>Pe?vt:Pe,Ue=!1):Xe=!0}Ue&&(fe=0,Pe=0),Pe=Pe>-3e38?Pe:0,this.samplerData={pixelData:D.values,width:D.width,height:D.height,noDataValue:w,safeWidth:.99999999*(D.width-1),dx:(D.width-1)/(O[2]-O[0]),dy:(D.width-1)/(O[3]-O[1]),x0:O[0],y1:O[3]},this.bounds=[fe,Pe],this.hasNoDataValues=Xe}release(){this.samplerData=null,this.bounds=null}computeMinMaxValue(v,O,D,w){w.min=1/0,w.max=-1/0,w.hasNoDataValues=!1;const te=v-this.level;if(te<=0)return w;const fe=2**te;if(Math.floor(O/fe)!==this.i||Math.floor(D/fe)!==this.j)return w;let Pe=1/0,Ue=-1/0;const Xe=this.samplerData.width,st=this.samplerData.pixelData,vt=.5*ks.$7;let Ct=(Xe-1)/fe,Wt=(D-this.j*fe)*Ct,Kt=(O-this.i*fe)*Ct;if(Ct<1){const Lt=Math.floor(Wt),nr=Math.floor(Kt),sr=Lt+nr*Xe,Er=st[sr],yr=st[sr+1],br=st[sr+Xe],Rr=st[sr+Xe+1];if(Er+yr+br+Rr<vt){const $r=Wt-Lt,si=Kt-nr,Ci=(0,oa.bX)(Er,yr,br,Rr,$r,si),Ti=(0,oa.bX)(Er,yr,br,Rr,$r+Ct,si),ki=(0,oa.bX)(Er,yr,br,Rr,$r,si+Ct),Fi=(0,oa.bX)(Er,yr,br,Rr,$r+Ct,si+Ct);return w.min=Math.min(Ci,Ti,ki,Fi),w.max=Math.max(Ci,Ti,ki,Fi),w}Wt=Lt,Kt=nr,Ct=1}else Wt=Math.floor(Wt),Kt=Math.floor(Kt),Ct=Math.ceil(Ct);for(let Lt=Wt;Lt<=Wt+Ct;Lt++)for(let nr=Kt;nr<=Kt+Ct;nr++){const sr=st[Lt+nr*Xe];sr<vt?(Pe=Math.min(Pe,sr),Ue=Math.max(Ue,sr)):w.hasNoDataValues=!0}return w.min=Pe,w.max=Ue,w}}function NP(_,v,O){if((0,lt.Wi)(O))return null;for(const D of O){if(!D)continue;const w=D.safeWidth;let te=(0,li.uZ)(D.dy*(D.y1-v),0,w),fe=(0,li.uZ)(D.dx*(_-D.x0),0,w);const Pe=Math.floor(te),Ue=Math.floor(fe),Xe=D.width,st=Pe*Xe+Ue,vt=D.pixelData,Ct=vt[st],Wt=vt[st+1],Kt=st+Xe,Lt=vt[Kt],nr=vt[Kt+1];if(Ct+Lt+Wt+nr<.5*ks.$7){te-=Pe,fe-=Ue;const sr=Ct+(Wt-Ct)*fe;return sr+(Lt+(nr-Lt)*fe-sr)*te}}return null}function Lo(_,v,O){const D=NP(_,v,O);return(0,lt.pC)(D)?D:0}let Ad=class extends Bi.Z{constructor(_){super(_),this._handles=new cn.Z}initialize(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){this._handles.destroy(),this._handles=null}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const _=[];return this.layerViews.forEach(v=>{const O=v.layer;if("IntegratedMeshLayer"===O.operationalLayerType&&null!=this.viewSpatialReference){const D=jP(O.fullExtent,this.viewSpatialReference);(0,lt.pC)(D)&&_.push((0,qr.oJ)(D))}}),_}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Ad.prototype,"layerViewsExtent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Ad.prototype,"tiledLayersExtent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Ad.prototype,"stencilEnabledExtents",null),(0,Ze._)([(0,nt.Cb)()],Ad.prototype,"viewSpatialReference",void 0),(0,Ze._)([(0,nt.Cb)()],Ad.prototype,"tilingScheme",void 0),(0,Ze._)([(0,nt.Cb)()],Ad.prototype,"defaultTiledLayersExtent",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ad.prototype,"layers",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Ad.prototype,"layerViews",void 0),Ad=(0,Ze._)([(0,ui.j)("esri.views.3d.terrain.ExtentHelper")],Ad);let Lb=class extends Ad{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?ks.cy:ks.Lz}};Lb=(0,Ze._)([(0,ui.j)("esri.views.3d.terrain.ExtentHelperGlobal")],Lb);let Ub=class extends Ad{_computeLayerViewsExtent(){const _=(0,qr.cS)(),v=this.viewSpatialReference;this.layerViews.forEach(w=>{const te=w.layer;if(w.isResolved()&&("graphics"!==te.type||!te.internal)){const fe=jP("fullExtentInLocalViewSpatialReference"in w&&w.fullExtentInLocalViewSpatialReference||w.layer.fullExtent,v);(0,qr.jn)(_,fe,_)}});const O=(0,qr.sU)(_)?_:null,D=this._get("layerViewsExtent");return(0,qr.fS)(O,D)?D:O}_computeTiledLayersExtent(){const _=this.tilingScheme;if(!_)return null;const v=this.viewSpatialReference,O=(0,qr.cS)();this.layers.forEach(te=>{if(te.loaded&&(0,Ws.iC)(te)){const fe=(0,Ji.E_)(te,v,Us.JY.Local);if((0,lt.Wi)(fe))return;const{tileInfo:Pe,fullExtent:Ue}=fe;(0,lt.pC)(Pe)&&(0,lt.pC)(Ue)&&((0,Ji.x4)(te)||_.compatibleWith(Pe)&&Ue.spatialReference.equals(_.spatialReference))&&(0,qr.jn)(O,Ue,O)}}),(0,qr.jn)(O,this.defaultTiledLayersExtent,O);const D=(0,qr.sU)(O)?O:null,w=this._get("tiledLayersExtent");return(0,qr.fS)(D,w)?w:D}};function jP(_,v){return(0,lt.pC)(_)&&!_.spatialReference.equals(v)?(0,ci.fi)(_,_.spatialReference,v):_}Ub=(0,Ze._)([(0,ui.j)("esri.views.3d.terrain.ExtentHelperLocal")],Ub);var An,Ys=T(75224);!function(_){_[_.ELEVATION=0]="ELEVATION",_[_.MAP=1]="MAP"}(An||(An={}));const zf=[An.ELEVATION,An.MAP];var Sd=T(61034),Bb=T(64835),GU=T(30993),HU=T(14411);function FP(){var v;const _=null==(v=globalThis.require)?void 0:v.modules;if(_){const O=Object.keys(_);for(const D of O)-1!==D.search(".glsl")&&delete _[D]}}const KU=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let z0,Xc=class extends Bi.Z{constructor(_){super(_),this._handles=new cn.Z,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=(0,Jo.Z)("esri-mobile")?2048:4096,this._animationTimeLast=0}get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Yl.Z.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return(0,lt.pC)(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?(0,Zi.Iu)(this._spatialReference).metersPerDegree:1}get view(){return this.surface.view}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}initialize(){const _=this.view;this.renderer=new Bb.CB({view:_,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference}),this._groundIntersector=(0,fc.Z8)(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",v=>{var O;return null==(O=_._stage)?void 0:O.renderView.setRenderParameters({hasOverlayWater:v})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),(0,pt.YP)(()=>{var v,O,D;return[null==(v=_.pointsOfInterest)?void 0:v.renderPointOfView,null==(D=null==(O=_.pointsOfInterest)?void 0:O.centerOnSurfaceFrequent)?void 0:D.location]},()=>this.setPlacementDirty()),(0,pt.YP)(()=>{var v;return null==(v=_.state)?void 0:v.pixelRatio},()=>this.setPlacementDirty(),pt.Z_),this.surface.on("elevation-change",()=>this.setPlacementDirty()),_.on("resize",()=>this.setPlacementDirty()),(0,rt.A)({preRender:v=>{this._contentUpdated=!1,this.renderer.processSyncDrapeSources(),this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(v),this._drawOverlayTextures(this.renderer.overlays,Fs.Xx.UPDATE)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),_.resourceController.scheduler.registerTask(Gn.T8.OVERLAY,this),_._stage.renderView.events.on("force-camera-for-screenshot",v=>{this._updateOverlays(v,Fs.Xx.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,Fs.Xx.BACKGROUND,v)})])}destroy(){this.renderer.dispose(),this._handles&&(this._handles.destroy(),this._handles=null),(0,lt.pC)(z0)&&(z0.hide(),z0=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(_){this._spatialReference=_,this.renderer.spatialReference=_,this._longitudeCyclical=null;const v=this.view.renderSpatialReference;(0,lt.pC)(_)&&(0,lt.pC)(v)?(this._renderSR=v,this._overlaySREqualsRenderSR=_.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=_.isWebMercator?new ga.pE(-20037508.342787,20037508.342787):new ga.pE(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(_,v,O){this._drapeSources.add(_),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const D=this.renderer.createDrapeSourceRenderer(_,v,O);return this._updateDrapeSourceExtent(_),this._setContentDirty(),this.notifyChange("running"),D}registerGeometryDrapeSource(_){return this.registerDrapeSource(_,HU.S)}_updateDrapeSourceExtent(_){2===this.renderer.overlays.length&&(0,lt.pC)(_.setDrapingExtent)&&(0,lt.pC)(this._spatialReference)&&_.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(_){this._drapeSources.has(_)&&(this._drapeSources.delete(_),this.renderer.removeDrapeSourceRenderer(_),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(_){this._drapeTargets.add(_),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var _;null==(_=this.view._stage)||_.renderView.setRenderParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(_){this._drapeTargets.delete(_),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(){this._updateOverlays(this.view.state.camera,Fs.Xx.UPDATE)}_updateOverlays(_,v){if(!this._spatialReference)return;const O=(0,Sd.Jk)(_.fullWidth,_.fullHeight,this._maxResolution);this._computeOverlayExtents(_,O,Lp);const D=(0,qr.bf)(Lp.inner)/(0,qr.bf)(Lp.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const w=this._updateOverlay(Ys.fu.INNER,Lp.inner,O,1*Lp.pixelRatioAdjustment,Lp.mapUnitsPerPixel),te=this._updateOverlay(Ys.fu.OUTER,Lp.outer,O,D*Lp.pixelRatioAdjustment,Lp.mapUnitsPerPixel);w!==Hh.EXTENT&&te!==Hh.EXTENT||(this._drapeSources.forEach(fe=>this._updateDrapeSourceExtent(fe)),this.surface.updateTileOverlayParams(v)),w===Hh.NONE&&te===Hh.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1}_updateOverlay(_,v,O,D,w){if(0===this.renderer.overlays.length)return Hh.NONE;const te=this.renderer.overlays[_],fe=te.mapUnitsPerPixel;if(te.mapUnitsPerPixel=w,te.pixelRatio=D,function ZU(_,v){const D=Yl.Z.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(_[2]-_[0],_[3]-_[1],v[2]-v[0],v[3]-v[1]);return Math.abs(v[0]-_[0])<=D&&Math.abs(v[1]-_[1])<=D&&Math.abs(v[2]-_[2])<=D&&Math.abs(v[3]-_[3])<=D}(v,te.extent)&&O===te.resolution)return fe===w?Hh.NONE:Hh.RERENDER_ONLY;(0,qr.JG)(te.extent,v),te.resolution=O;const Pe=(0,qr.be)(te.extent);return te.renderLocalOrigin=(0,GU.al)(Pe[0],Pe[1],0,"OV_"+this._latestOriginId++),Hh.EXTENT}setTileParameters(_){const v=_.renderData.overlay;if(this.renderer.overlays.length>0){const O=this.renderer.overlays[Ys.fu.INNER],D=this.renderer.overlays[Ys.fu.OUTER],w=(0,qr.jV)(_.extent,this.surface.extent,WP);this._rectInsideRect(O.extent,w)||this._rectanglesOverlap(w,O.extent)||this._rectanglesOverlap(w,D.extent)?(this._setTileOverlayData(w,Ys.fu.INNER,v),this._setTileOverlayData(w,Ys.fu.OUTER,v)):(this._clearTileOverlayData(Ys.fu.INNER,v),this._clearTileOverlayData(Ys.fu.OUTER,v))}else this._clearTileOverlayData(Ys.fu.INNER,v),this._clearTileOverlayData(Ys.fu.OUTER,v)}overlayPixelSizeInMapUnits(_){if(0===this.renderer.overlays.length)return 0;const v=this.renderer.overlays[Ys.fu.INNER],O=this.renderer.overlays[Ys.fu.OUTER],D=this._pointIsInExtent(_,v.extent)?v:O;return(D.extent[2]-D.extent[0])/D.resolution}_setTileOverlayData(_,v,O){if(0===this.renderer.overlays.length)return;const D=this.renderer.overlays[v].extent,w=(0,qr.bf)(D),te=(0,qr.Cb)(D);let fe=_[0];if(this._longitudeCyclical){fe=this._longitudeCyclical.minimalMonotonic(D[0],fe);const Pe=this._longitudeCyclical.minimalMonotonic(D[0],_[2]);fe>Pe&&(fe=Pe-(_[2]-_[0]))}O.setScale(v,(0,qr.bf)(_)/w,(0,qr.Cb)(_)/te),O.setOffset(v,(fe-D[0])/w,(_[1]-D[1])/te)}_clearTileOverlayData(_,v){v.setScale(_,-1,-1),v.setOffset(_,-1,-1)}reloadShaders(){var _=this;return(0,Ai.Z)(function*(){FP(),yield _.renderer.reloadShaders(),_.setDrawTexturesDirty(),_.runTask()})()}_dispatchAnimationUpdate(_){const v=(0,io.HA)(_.time-this._animationTimeLast);(v>=this.surface.view._stage.renderView.animationTimestep||(0,lt.pC)(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)&&(this.renderer.updateAnimation({dt:v,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=_.time)}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0):this.setPlacementDirty()}_intersectGroundFromView(_,v,O,D){const w=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(_,kU,v,O);if((0,lt.Wi)(w))return!1;const te=w.origin,fe=(0,_t.a)(Rv,w.origin,w.direction);return this._groundIntersector.reset(te,fe,_),this._groundIntersector.intersect([],null),this.view.basemapTerrain.intersect(this._groundIntersector,null,te,fe),this._groundIntersector.results.min.getIntersectionPoint(D)}_findHorizonBasedPointOfInterest(_,v){let O=.5;const D=.55,w=this.view.renderCoordsHelper.getAltitude(_.eye),te=this.view.pointsOfInterest.centerOnSurfaceFrequent,Pe=(0,li.uZ)(te.estimatedSurfaceAltitude,_.aboveGround?-1/0:w+1e-5,_.aboveGround?w-1e-5:1/0),Ue=_.aboveGround;if("global"===this.view.viewingMode){const Xe=Rv;(0,aa.j)((0,aa.k)(aa.t,(0,Zi.Iu)(this.view.spatialReference).radius+Pe),(0,Yu.re)(_.eye,_.viewForward),Xe),(0,_t.b)(Xe,Xe,_.eye);const st=ga.Q4.normalize((0,Om.cp)(_.viewForward,Xe,_.viewRight))/_.fovY+.5,vt=st<=0||st>=1?.5:D;O=Ue?vt*st:st+vt*(1-st)}else{const Xe=.5*Math.PI-Math.acos(-_.viewForward[2]),st=Math.tan(Xe),vt=(0,vi.f)(0,st,1,0),Ct=(0,Sl.t)(vt,vt,_.projectionMatrix)[1],Wt=(0,li.uZ)(.5+.5*Ct,0,1);O=1===Wt||0===Wt?.5:Ue?Wt*D:1-(1-Wt)*D}return!!this._intersectGroundFromView(_,.5,O,v)&&(0,_t.x)(v,_.eye)<te.distance*te.distance}_computeOverlayExtents(_,v,O){const D=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,w=(0,$t.c)();this._findHorizonBasedPointOfInterest(_,w)||(0,_t.c)(w,D);const te=Math.max(.1,(0,_t.i)(_.eye,w)),fe=C0(this.view.renderCoordsHelper,D,_.eye),Pe=Math.PI/2-Math.abs(fe-Math.PI/2);Yl.Z.OVERLAY_SHOW_CENTER?((0,lt.Wi)(z0)&&(z0=new W0(this.view.graphics,"red")),z0.show(w,this._renderSR)):(0,lt.pC)(z0)&&z0.hide(),this._overlaySREqualsRenderSR||(0,ci.SH)(w,this._renderSR,w,this._spatialReference);const Ue=this.surface.extent,Xe=!this._isSpherical&&(0,lt.pC)(this._spatialReference)&&this._spatialReference.isGeographic,st=Xe&&(0,lt.pC)(this._spatialReference)?1/(0,Zi.Iu)(this._spatialReference).metersPerDegree:1,vt=_.perRenderPixelRatio*te*st;O.mapUnitsPerPixel=vt/this._worldToPCSRatio;let Ct=v*vt/2,Wt=!1,Kt=Xe?90:1/0;this._isSpherical&&(0,lt.pC)(Ue)&&(0,lt.pC)(this._spatialReference)&&(this._spatialReference.isWebMercator?(Ct/=Math.cos((0,sh.mZ)(w[1])),Kt=Ue[3]):(Wt=!0,Ct/=(0,Zi.Iu)(this._spatialReference).metersPerDegree,Kt=90),Ct>=Kt&&(Ct=Kt,w[1]=0,this._spatialReference.isWebMercator&&(w[0]=0)));let Lt=1;Wt&&(Lt=1/Math.max(.2,Math.cos(Math.abs((0,li.Vl)(w[1])))),Ct*Lt>180&&(Lt=180/Ct),O.mapUnitsPerPixel*=Lt);const nr=Math.log(2)/12;Ct=Math.exp(Math.round(Math.log(Ct)/nr)*nr);const sr=Ct*Lt,yr=.5*v/(32*sr),br=.5*v/(32*Ct);w[0]=Math.round(w[0]*yr)/yr,w[1]=Math.round(w[1]*br)/br;const Rr=O.inner;Rr[0]=w[0]-sr,Rr[1]=w[1]-Ct,Rr[2]=w[0]+sr,Rr[3]=w[1]+Ct,this._isSpherical&&this._shiftExtentToFitBounds(Rr,1/0,Kt);const $r=O.outer;if(6*sr>(0,qr.bf)(Ue))(0,qr.JG)($r,(0,lt.Wg)(Ue));else if(Pe<=.25*Math.PI)$r[0]=Rr[0]-sr,$r[1]=Rr[1]-Ct,$r[2]=Rr[2]+sr,$r[3]=Rr[3]+Ct;else{(0,ci.SH)(_.eye,this._renderSR,Rv,this._spatialReference),(0,Oi.g)(Gf,w,Rv);let Ci=-Math.atan2(Gf[1],Gf[0])+.125*Math.PI;Ci<0&&(Ci+=2*Math.PI);const Ti=Math.floor(Ci/(.25*Math.PI));(0,Sl.b)(Gf,KU[Ti],2*Ct),Gf[0]*=Lt,Gf[2]*=Lt,(0,Sl.a)($r,Rr,Gf)}if(this._isSpherical)$r[0]=this._longitudeCyclical.clamp($r[0]),$r[2]=this._longitudeCyclical.clamp($r[2]),$r[1]=Math.max($r[1],-Kt),$r[3]=Math.min($r[3],Kt);else{const Ci=(0,qr.jV)(Rr,Ue,WP),Ti=(0,qr.jV)($r,Ue,$U);(0,qr.r3)(Ci,Ti)&&($r[2]=$r[0],$r[3]=$r[1])}const si=Math.abs(Rr[2]-Rr[0])/v;O.mapUnitsPerPixel=Math.max(O.mapUnitsPerPixel,si),O.pixelRatioAdjustment=O.mapUnitsPerPixel/si}_drawOverlayTextures(_,v,O=this.view.state.camera){if(0===_.length||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const D=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const w=this._drawOverlay(_[Ys.fu.INNER],O),te=this._drawOverlay(_[Ys.fu.OUTER],O);w!==Fs.Yg.CHANGED&&te!==Fs.Yg.CHANGED||this.surface.updateTileOverlayParams(Fs.Xx.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),D?(this.surface.requestRender(v),v===Fs.Xx.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(Fs.Xx.BACKGROUND)}_drawOverlay(_,v){return this._longitudeCyclical?_.setupGeometryViewsCyclical(this._longitudeCyclical):_.setupGeometryViewsDirect(),_.draw(this.renderer,v.pixelRatio)}_collectUnusedRenderTargetMemory(){if(this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays){const _=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(_)}}_rectanglesOverlap(_,v){return!(0,lt.Wi)(_)&&(this._longitudeCyclical?(this._longitudeCyclical.contains(v[0],v[2],_[0])||this._longitudeCyclical.contains(v[0],v[2],_[2])||this._longitudeCyclical.contains(_[0],_[2],v[0]))&&!(_[1]>v[3]||_[3]<v[1]):(0,qr.kK)(_,v))}_rectInsideRect(_,v){return!(0,lt.Wi)(v)&&(this._longitudeCyclical?this._longitudeCyclical.contains(_[0],_[2],v[0])&&this._longitudeCyclical.contains(_[0],_[2],v[2])&&v[1]>_[1]&&v[3]<_[3]:(0,qr.r3)(_,v))}_pointIsInExtent(_,v){if(this._longitudeCyclical)return this._longitudeCyclical.contains(v[0],v[2],_.x)&&_.y>=v[1]&&_.y<=v[3];const O=_.x,D=_.y;return O>v[0]&&O<v[2]&&D>v[1]&&D<v[3]}_shiftExtentToFitBounds(_,v,O){let D=0,w=0;_[0]<-v?D=_[0]+v:_[2]>v&&(D=v-_[2]),_[1]<-O?w=_[1]+O:_[3]>O&&(w=O-_[3]),(0,qr.cv)(_,D,w)}get test(){return{renderer:this.renderer,update:()=>this.runTask()}}};(0,Ze._)([(0,nt.Cb)()],Xc.prototype,"_spatialReference",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Xc.prototype,"running",null),(0,Ze._)([(0,nt.Cb)()],Xc.prototype,"_placementDirty",void 0),(0,Ze._)([(0,nt.Cb)()],Xc.prototype,"_contentUpdated",void 0),(0,Ze._)([(0,nt.Cb)()],Xc.prototype,"_isSpherical",null),(0,Ze._)([(0,nt.Cb)()],Xc.prototype,"_worldToPCSRatio",null),(0,Ze._)([(0,nt.Cb)()],Xc.prototype,"renderer",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Xc.prototype,"surface",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,aliasOf:"surface.suspended"})],Xc.prototype,"suspended",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Xc.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)({type:Boolean})],Xc.prototype,"hasHighlights",null),(0,Ze._)([(0,nt.Cb)({type:Boolean})],Xc.prototype,"rendersOccluded",null),Xc=(0,Ze._)([(0,ui.j)("esri.views.3d.terrain.OverlayManager")],Xc);const Gf=(0,vi.c)(),Rv=(0,$t.c)(),Lp={inner:(0,qr.Ue)(),outer:(0,qr.Ue)(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},WP=(0,qr.Ue)(),$U=(0,qr.Ue)(),kU=(0,Yu.Ue)();var Hh;!function(_){_[_.NONE=0]="NONE",_[_.EXTENT=1]="EXTENT",_[_.RERENDER_ONLY=2]="RERENDER_ONLY"}(Hh||(Hh={}));let YU=(()=>{class _{constructor(O,D){this._factoryCallback=O,this._lengthCallback=D,this._pool=new Map}acquire(O){if(!_.test.disabled){const D=this._pool.get(O);if(D&&0!==D.length)return D.pop()}try{return this._factoryCallback(O)}catch(D){const w=window.performance&&window.performance.memory;let te="";throw w&&(te=`\n  totalJSHeapSize: ${w.totalJSHeapSize}, usedJSHeapSize: ${w.usedJSHeapSize}, jsHeapSizeLimit: ${w.jsHeapSizeLimit}`),console.log("Array allocation of size "+O+" failed: "+D+te),D}}release(O){if(_.test.disabled)return;const D=this._lengthCallback(O);let w=this._pool.get(D);w||(w=new Ua.Z({shrink:!0}),this._pool.set(D,w)),w.push(O)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}}return _.test={disabled:!1},_})();class JU{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=(0,Ea.cS)(),this.indexCount=0,this.numVerticesPerSide=0,this.uvOffsetAndScale=(0,vi.c)(),this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}}class VP{constructor(v,O,D,w,te){this._buf=v,this._localOrigin=O,this.offset0=D,this.stride=w,this.count=te}getVertexOffset(v){return(0,Ji.Fp)(0<=v&&v<this.count),this.offset0+this.stride*v}getVertex(v,O){const D=this.getVertexOffset(O)*ks.Vs;v[0]=this._buf[D+0]+this._localOrigin[0],v[1]=this._buf[D+1]+this._localOrigin[1],v[2]=this._buf[D+2]+this._localOrigin[2]}getVertexZ(v){const O=this.getVertexOffset(v)*ks.Vs;return this._buf[O+2]+this._localOrigin[2]}setVertex(v,O,D,w){const te=this.getVertexOffset(v)*ks.Vs;this._buf[te+0]=O[0]-this._localOrigin[0],this._buf[te+1]=O[1]-this._localOrigin[1],this._buf[te+2]=O[2]-this._localOrigin[2],this._buf[te+3]=D,this._buf[te+4]=w}getNormal(v,O){const D=this.getVertexOffset(O)*ks.Vs;v[0]=this._buf[D+5],v[1]=this._buf[D+6],v[2]=this._buf[D+7]}setVertexRawXYZUV(v,O,D,w,te,fe){const Pe=this.getVertexOffset(v)*ks.Vs;this._buf[Pe+0]=O,this._buf[Pe+1]=D,this._buf[Pe+2]=w,this._buf[Pe+3]=te,this._buf[Pe+4]=fe}setVertexRawXYZUVN(v,O,D,w,te,fe,Pe,Ue,Xe){const st=this.getVertexOffset(v)*ks.Vs;this._buf[st+0]=O,this._buf[st+1]=D,this._buf[st+2]=w,this._buf[st+3]=te,this._buf[st+4]=fe,this._buf[st+5]=Pe,this._buf[st+6]=Ue,this._buf[st+7]=Xe}setVertexRawNormal(v,O,D,w){const te=this.getVertexOffset(v)*ks.Vs;this._buf[te+5]=O,this._buf[te+6]=D,this._buf[te+7]=w}getVertexRawNormal(v,O){const D=this.getVertexOffset(O)*ks.Vs;v[0]=this._buf[D+5],v[1]=this._buf[D+6],v[2]=this._buf[D+7]}}const XU=(0,bf.U$)().vec3f(Fo.T.POSITION).vec2f(Fo.T.UV0).vec3f(Fo.T.NORMAL),Nb=new YU(_=>XU.createBuffer(_),_=>_.count);function zP(_){return Nb.acquire(_)}class wv{constructor(){this.elevation=0,this.normal=[0,0,1],this.cornerTiles=[null,null,null,null]}}class t5{constructor(){this.edgeNeighbours=[null,null,null,null],this.cornerNeighborData=[new wv,new wv,new wv,new wv],this.edgeResolutions=[1,1,1,1],this.modifiedEdgeResolutions=[!1,!1,!1,!1]}}class r5{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new t5}}class B_{constructor(v){this._getFadeDuration=v,this._fadeStart=0,this._delayedTime=0}clear(){this._current=(0,lt.SC)(this._current),this._next=(0,lt.SC)(this._next),this._waiting=(0,lt.SC)(this._waiting),this._delayed=(0,lt.SC)(this._delayed)}get current(){if((0,lt.Wi)(this._current))return null;if(!this._isFadingEnabled){const O=this._delayed||this._waiting||this._next||this._current;O!==this._current&&(this._current=null,this.clear(),this._current=O)}let v=B_.test.fadeMoment;if((0,lt.pC)(this._delayed)&&(v=v||performance.now(),v>=this._delayedTime&&(this._push(this._delayed,Up.Immediate),this._delayed=null)),(0,lt.pC)(this._next)){v=v||performance.now();const O=this._fadeDuration,D=(0,lt.pC)(this._current)&&this._next.texture===this._current.texture,w=this._next.type!==Ys.Ns.FADING,te=v-this._fadeStart>=O;(D||w||te)&&((0,lt.SC)(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(v))}return this._current}get next(){return this._next}get fadeFactor(){if((0,lt.Wi)(this._next))return 1;const v=B_.test.fadeMoment||performance.now(),O=Math.max(0,v-this._fadeStart),D=this._fadeDuration;return O>D?0:1-O/D}get isFading(){return(0,lt.pC)(this._next)||(0,lt.pC)(this._delayed)}push(v,O=Up.Immediate){this._delayed=(0,lt.SC)(this._delayed),this._push(v,O)}_push(v,O){if(this._isFadingEnabled||this.clear(),(0,lt.Wi)(this._current))return void(this._current=v);const D=B_.test.fadeMoment||performance.now();return O!==Up.Immediate?(this._delayed=v,void(this._delayedTime=D+O)):(0,lt.Wi)(this._next)?(this._next=v,void(this._fadeStart=this._alignFadeStart(D))):void((0,lt.Wi)(v)||((0,lt.SC)(this._waiting),this._waiting=v))}get _fadeDuration(){return(0,lt.Wi)(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(v){const O=this._getFadeDuration();return v+O-v%O}get _isFadingEnabled(){return this._getFadeDuration()>0}}var Up;B_.test={fadeMoment:0},function(_){_[_.Immediate=0]="Immediate",_[_.Delayed=5e3]="Delayed"}(Up||(Up={}));var Iv=T(39863),xu=T(15076);class jb{get updating(){return!!this._tileRequested}init(v,O,D,w){this.tile=v,this._layerIdx=O,this._layerClass=D,this._suspended=w,this._tileLayerInfo=v.getLayerInfo(O,D),this._tileRequested=null;const te=this._findAncestorWithData();this._setUpsampleTile(te)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(v){v!==this._suspended&&(this._suspended=v,v?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const v=this._findAncestorWithData();return this._setUpsampleTile(v),this._requestNext()}dataArrived(v){this._setUpsampleTile(v),this._tileRequested=null,v===this.tile?this.tile.updateRenderData(this._layerClass,Ys.Ns.FADING):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const v=this._findNextDownload();if(this._tileRequested){if(v===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return(0,lt.pC)(v)?v.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=v):this._agentDone(),!!this._tileRequested}_findNextDownload(){const v=this._layerIdx,O=this._layerClass,D=this.tile.surface.layerViewByIndex(v,O),w=(0,Ji.RB)(D),{minLevel:te,maxLevel:fe}=D.dataLevelRange,Pe=this._desiredMinLevelDelta,Ue=this._progressiveLevelModulo+Pe,Xe=this._scaleRangeEnabled?xu.yf:()=>!0;let st=this.tile;const vt=st.level;let Ct;const Wt=this._tileLayerInfo.upsampleInfo,Kt=(0,lt.pC)(Wt)?Wt.tile.level:-1,Lt=!!(0,lt.pC)(Wt)&&Kt-vt>=Pe,nr=(0,lt.U2)(w,"tilemapCache");for(;st&&Xe(st,w,!1)&&st.level>=te;){const sr=st.level,Er=vt-sr,yr=st.layerInfo[O][v];if(yr.data&&Er>=Pe){(!Lt||sr>Kt)&&this._setUpsampleTile(st),yr.dataInvalidated&&(Ct=st);break}if(((0,lt.Wi)(nr)||"unavailable"!==nr.getAvailability(st.lij[0],st.lij[1],st.lij[2]))&&sr<=fe&&!yr.data&&!yr.dataMissing&&(((0,lt.Wi)(Ct)||st.level===te||sr%ks.Sx==0||vt-Ct.level<Pe)&&(Ct=st),Er>=Ue))break;st=st.parent}return(0,lt.pC)(Ct)&&vt-Ct.level<Pe&&this._tileLayerInfo.upsampleInfo&&(Ct=null),Ct}_findAncestorWithData(){const v=this.tile.vlevel,O=this._desiredMinLevelDelta;let D;for(let w=this.tile;w;w=w.parent)if(w.hasLayerData(this._layerIdx,this._layerClass)){if(v-w.level>=O)return w;D=w}return D}_setUpsampleTile(v){this._tileLayerInfo.setUpsampleInfo(this.tile,v),this.tile.updateRenderData(this._layerClass,Ys.Ns.FADING)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}const GP=new Error("Abstract method called on TileAgent"),Du=new class i5 extends jb{get _desiredMinLevelDelta(){throw GP}get _progressiveLevelModulo(){throw GP}dispose(){}};class HP extends jb{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return(0,ks.L)(this.tile.level)-(this.tile.vlevel-this.tile.level)}get _progressiveLevelModulo(){return 0}}class KP extends jb{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return ks.Sx}}var s5=T(31498);class Lv{constructor(){this.waitingAgents=new Ua.Z,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(v){const O=Fb.acquire();return O._init(v),O}release(){this.dispose(),Uv.delete(this),Fb.release(this)}dispose(){this.loadingAgent=(0,lt.O3)(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=(0,Ji.z4)(this._data)}static prune(){Fb.prune(0)}_init(v){this.waitingAgents.clear(),this._data=(0,Ji.z4)(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=v,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=(0,lt.IM)(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){(0,lt.pC)(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(v,O){if(v===O||(0,lt.Wi)(O))this._unsetUpsampleInfo();else{if((0,lt.Wi)(this._upsampleInfo))this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===O)return;this._upsampleInfo.tile.unrefMapData()}O.refMapData(),(0,xu.QT)(v,O,this._upsampleInfo)}}get data(){return this._data}set data(v){(0,Ji.z4)(this._data),this._data=v}}const Fb=new lh.Z(Lv,null,()=>{}),Uv=new Map;class N_{constructor(v){this._texture=v,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,0===this._refCount&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}}var zs;!function(_){_[_.NONE=0]="NONE",_[_.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD",_[_.SPLIT=2]="SPLIT",_[_.VSPLITMERGE=4]="VSPLITMERGE",_[_.MERGE=8]="MERGE",_[_.RENDERDATA=16]="RENDERDATA",_[_.GEOMETRY=32]="GEOMETRY",_[_.TEXTURE_NOFADING=64]="TEXTURE_NOFADING",_[_.TEXTURE_FADING=128]="TEXTURE_FADING"}(zs||(zs={}));const Wb=(0,$t.c)(),j_=(0,$t.c)(),Ul=(0,$t.c)();class a5{constructor(){this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}}class Vb{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this._dirty=!0,this._previouslyRendered=!1,this.extent=(0,qr.Ue)(),this._elevationBounds=(0,Li.a)(),this.layerInfo=[[],[]],this.extentInRadians=(0,qr.Ue)(),this.centerAtSeaLevel=(0,$t.c)(),this._center=[(0,$t.c)(),(0,aa.c)(),(0,$t.c)()],this.up=(0,$t.u)(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemory=0,this._mapDataRefCount=0,this._screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0}static prune(){zb.prune(0),Gb.prune(0),Lv.prune()}get isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Dc.MIDDLE][3]}get screenDepth(){return this._screenDepth}get visible(){return this._dirty&&this.computeVisibility(),this._visible}computeVisibility(){this._dirty=!1;const v=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);return v!==this._visible&&(this._visible=v,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension()),this._visible}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const v=!!this.renderData;return v!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=v,this._surface.renderer.setNeedsRender()),v}get shouldLoad(){if(!this.loadable)return!1;if(this._surface.lodSnapping===Ys.VB.ON){const v=this.level-this._surface.snapLevel;if(0===v)return!0;if(1===v)return!1}return this.isLeaf}init(v,O,D){this.lij[0]=v[0],this.lij[1]=v[1],this.lij[2]=v[2],this.ellipsoid=(0,Zi.Iu)(D.tilingScheme.spatialReference),D.tilingScheme.getExtent(v[0],v[1],v[2],this.extent),D.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,D.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Dc.MIDDLE][3]=0,this.vlevel=v?v[0]:0,O&&O.elevationBounds?(0,Oi.c)(this._elevationBounds,O.elevationBounds):(0,Oi.a)(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this._screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=O,this.unsetChildren(),this._surface=D,this.updateVisibility();for(const w of zf){const te=D.numLayers(w),fe=this.layerInfo[w];for(const Pe of fe)Pe.release();fe.length=te;for(let Pe=0;Pe<te;Pe++)fe[Pe]=Lv.acquire(this._surface.upsampleInfoPool),w===An.ELEVATION&&this.findElevationBoundsForLayer(Pe,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(D.tilingScheme.pixelSize,ks.HB)}release(){(0,Ji.wu)(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const v of zf){for(const O of this.layerInfo[v])O.release();this.layerInfo[v].length=0}this._parent=null,this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this.isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this.isCached){this.setMemoryDirty();const v=this.cachedMemory;v>0&&this._surface.upsampleMapCache.put(this.key,this,v)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this.isCached?0:this._mapTileMemory)}get cachedMemory(){return this.isCached?this.mapTileMemory:0}get mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[An.MAP].reduce((v,O)=>v+(O instanceof Sv.i?O.memoryUsage:0),this._mapTileMemory)}get cpuImageMemorySize(){const O=this._surface.tilingScheme.pixelSize;return O*O*4}_ensureUsedMemory(){if((0,lt.pC)(this._usedMemory))return this._usedMemory;this._usedMemory=0,this._mapTileMemory=0;let v=0;for(const{data:D}of this.layerInfo[An.MAP])D instanceof Sv.i?v+=this._getTerrainDataMemory(D):this._mapTileMemory+=this._getTerrainDataMemory(D);const O=this.cpuImageMemorySize;for(const D of this.layerInfo[An.ELEVATION])this._usedMemory+=D.data?O:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=(0,_l.un)(this.renderData.textureDescriptor)),this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+v),this._usedMemory}getUsedMemoryForLayer(v,O){const D=this.layerInfo[v][O];return(null==D?void 0:D.data)?v===An.MAP?this.isCached?0:this._getTerrainDataMemory(D.data):v===An.ELEVATION?this.cpuImageMemorySize:0:0}_getTerrainDataMemory(v){return v instanceof N_?(0,_l.un)(v.texture):v instanceof HTMLImageElement||v instanceof Sb.nN?this.cpuImageMemorySize:v instanceof Sv.i||v instanceof s5.H?v.memoryUsage:0}updateScreenDepth(v){const O=this._center[Dc.MIDDLE],w=O[0],te=O[1],fe=O[2],Pe=v[2]*w+v[6]*te+v[10]*fe+v[14];this._screenDepth=Pe<0?0:Pe/(v[3]*w+v[7]*te+v[11]*fe+v[15])}shouldSplit(v,O,D){if((0,lt.pC)(v.frustum)&&(!this._intersectsClippingArea||!this._isVisible(v.frustum)))return zs.NONE;const w=this.level;(0,_t.b)(Wb,this._center[Dc.MIDDLE],O);let te=(0,_t.p)(Wb),fe=Dc.MIDDLE;(0,_t.b)(j_,this._center[Dc.TOP],O);const Pe=(0,_t.p)(j_);Pe<te&&(te=Pe,fe=Dc.TOP),(0,_t.b)(j_,this._center[Dc.BOTTOM],O);const Ue=(0,_t.p)(j_);if(Ue<te&&(te=Ue,fe=Dc.BOTTOM),this._edgeLen2>te&&w<v.maxLod)return zs.SPLIT;const Xe=Math.sqrt(te),vt=this._edgeLen/(v.fovX*Xe*2),Ct=()=>{const nr=w+Math.ceil(-Math.log2(v.relativeWidthLimit/vt));return nr!==this.vlevel?(this.vlevel=nr,zs.VSPLITMERGE):zs.NONE_HIT_MAXLOD};if(D===Ys.VB.ON&&this._surface.snapLevel-w==1)return w>=v.maxLod?Ct():zs.SPLIT;const Wt=(0,_t.e)(this.up,Wb),Kt=this._elevationBounds[1]-this._elevationBounds[0],Lt=Kt/this.edgeLen;if(v.aboveGround&&Wt>0&&Lt<.001&&Wt/Xe-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-Lt>0)return zs.NONE;if(vt<v.relativeWidthLimit)return this.vlevel!==this.level?(this.vlevel=this.level,zs.VSPLITMERGE):zs.NONE;if(w>=v.maxLod)return Ct();if(w>6){(0,_t.b)(j_,this._center[fe],O),(0,_t.g)(Ul,this.up,Wt),(0,_t.b)(Ul,Ul,j_);const nr=(0,_t.p)(Ul);if(nr>this.radius*this.radius&&((0,_t.g)(Ul,Ul,this.radius/Math.sqrt(nr)),(0,_t.a)(Ul,Ul,this._center[fe]),(0,_t.b)(Ul,O,Ul),Math.min(1,(Math.abs((0,_t.e)(Ul,this.up))+.5*Kt+this._curvatureHeight)/(0,_t.l)(Ul))*(this._edgeLen/(v.fovY*Xe*2))<.1/v.angledSplitBias*v.relativeHeightLimit))return zs.NONE}return zs.SPLIT}setChildren(v,O,D,w){(0,Ji.wu)(!!(v&&O&&D&&w),"Null child passed"),this._children[0]=v,this._children[1]=O,this._children[2]=D,this._children[3]=w}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var v,O;return null!=(O=null==(v=this.renderData)?void 0:v.hasGeometry)&&O}prepareToLoad(v){this.refMapData();for(const O of zf)this._createOrUpdateAgents(0,O);v.updateTileGeometryState(this)}load(v){this.prepareToLoad(v),this.loadPrepared(v)}loadPrepared(v){v.loadTile(this)}unload(v){v.unloadTile(this);for(const O of zf){const D=this.layerInfo[O];for(const w of D)w.loadingAgent&&w.loadingAgent!==Du&&(Bv(w.loadingAgent),w.loadingAgent=null),w.pendingUpdates=0}this.resetPendingUpdate(zs.GEOMETRY),this.resetPendingUpdate(zs.TEXTURE_NOFADING),this.resetPendingUpdate(zs.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const v=this.layerInfo[An.MAP];for(const O of v)O.loadingAgent&&O.loadingAgent!==Du&&(Bv(O.loadingAgent),O.loadingAgent=null),O.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(v){if((0,qr.fS)(v,this._clippingArea))return!1;const O=this._intersectsClippingArea,D=this._isWithinClippingArea;return(0,lt.pC)(v)?(this._intersectsClippingArea=this.intersectsExtent(v),this._isWithinClippingArea=this._isWithinExtent(v)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=v,this.updateVisibility(),!this.renderData||D&&this._isWithinClippingArea||!(D||O||this._isWithinClippingArea||this._intersectsClippingArea)||this.setPendingUpdate(zs.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(v,O){return this.layerInfo[O][v]}hasLayerData(v,O){const D=this.layerInfo[O][v];return!(!D||!D.data||D.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const v of zf){const O=this.layerInfo[v];for(const D of O)if(D.loadingAgent&&D.loadingAgent!==Du&&D.loadingAgent.updating)return!0}return!1}_isSuspended(v){return!!this.hasPendingUpdate(zs.SPLIT)||v!==An.ELEVATION&&!this.loadable}get hasPendingUpdates(){return 0!==this._pendingUpdates}hasPendingUpdate(v){return(this._pendingUpdates&v)===v}setPendingUpdate(v){this._pendingUpdates|=v,v===zs.SPLIT||v===zs.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(v){return!!this.hasPendingUpdate(v)&&(this._pendingUpdates&=~v,!0)}requestLayerData(v,O,D){const w=this.layerInfo[O][v];if(w.waitingAgents.has(D))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),D.tile.lij.toString(),O,v),!0;if(w.waitingAgents.push(D),w.data&&!w.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),D.tile.lij.toString(),O,v),D.dataArrived(this),!0;if(w.requestPromise)return!0;(0,lt.IM)(w.requestAbort),w.requestAbort=new AbortController;const te=this._surface.requestTileData(this,v,O,w.requestAbort);if(!te)return w.requestAbort=null,!1;const fe=()=>{w.requestPromise===te&&(w.requestPromise=null,w.requestAbort=null)};return w.requestPromise=te,te.then(fe,fe),!0}get isLeaf(){return null==this._children[0]}hasLij(v){return this.lij[0]===v[0]&&this.lij[1]===v[1]&&this.lij[2]===v[2]}findByLij(v){return this.hasLij(v)?this:this.isLeaf?null:this._children[0].findByLij(v)||this._children[1].findByLij(v)||this._children[2].findByLij(v)||this._children[3].findByLij(v)||null}distanceToSquared(v){return(0,_t.p)((0,_t.b)(Ul,this._center[Dc.MIDDLE],v))}containsPoint(v){const O=this.extent;return v[0]>=O[0]&&v[1]>=O[1]&&v[0]<=O[2]&&v[1]<=O[3]}unrequestLayerData(v,O,D){const w=this.layerInfo[O][v],te=w.waitingAgents,fe=null!=te.removeUnordered(D);(0,Ji.wu)(fe,"agent has not requested this piece of map data"),te.length<1&&(w.abortRequest(),this.setMemoryDirty())}dataArrived(v,O,D){const w=this.layerInfo[O][v];w.data=D,w.dataInvalidated=!1,w.waitingAgents.forAll(te=>te.dataArrived(this)),w.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(v,O,D){D.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${O}/${v} error ${D}`);const w=this.layerInfo[O][v];w.dataMissing=!0,w.waitingAgents.forAll(te=>te.dataMissing()),w.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(v,O){switch(v){case An.MAP:return this._updateTexture(O);case An.ELEVATION:return this._updateGeometry()}}_updateTexture(v){this.renderData&&(this.resetPendingUpdate(v===Ys.Ns.FADING?zs.TEXTURE_NOFADING:zs.TEXTURE_FADING),this.setPendingUpdate(v===Ys.Ns.FADING?zs.TEXTURE_FADING:zs.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(zs.GEOMETRY);for(const v of this.layerInfo[An.ELEVATION])v.pendingUpdates|=zs.GEOMETRY}invalidateLayerData(v,O){this.layerInfo[O][v].invalidateSourceData(),this.restartAgents(O)}computeElevationBounds(){const v=this._elevationBounds;(0,Oi.a)(v,Number.MAX_VALUE,-Number.MAX_VALUE);const O=this.layerInfo[An.ELEVATION];let D=!0;for(const w of O)(0,lt.pC)(w.elevationBounds)&&(v[0]=Math.min(v[0],w.elevationBounds.min),v[1]=Math.max(v[1],w.elevationBounds.max),w.elevationBounds.hasNoDataValues||(D=!1));D&&(v[0]=Math.min(v[0],0),v[1]=Math.max(v[1],0)),this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()}_updateCenter(){const v=this._elevationBounds;(0,_t.g)(Ul,this.up,.5*(v[0]+v[1])),(0,_t.a)(this._center[Dc.MIDDLE],this.centerAtSeaLevel,Ul),(0,_t.g)(Ul,this.up,v[0]),(0,_t.a)(this._center[Dc.TOP],this.centerAtSeaLevel,Ul),(0,_t.g)(Ul,this.up,v[1]),(0,_t.a)(this._center[Dc.BOTTOM],this.centerAtSeaLevel,Ul)}findElevationBoundsForLayer(v,O){const D=this.layerInfo[An.ELEVATION][v];if((0,lt.pC)(D.elevationBounds)&&D.elevationBounds.level>=O)return;const w=this._surface.layerViewByIndex(v,An.ELEVATION),te=(0,Ji.RB)(w);if(!(0,xu.yf)(this,te,!1))return;const fe=c5;let Pe=!1;if(D.data){const Ue=D.data;fe.min=Ue.bounds[0],fe.max=Ue.bounds[1],fe.hasNoDataValues=Ue.hasNoDataValues,fe.level=this.level,Pe=!0}else{let Ue,Xe,st=0;for(let vt=this._parent;vt&&(!Xe||st<(0,ks.L)(this.level))&&(st=this.vlevel-vt.level,Ue=Xe||Ue,Xe=vt.layerInfo[An.ELEVATION][v].data,!(!Xe&&Ue&&st>=(0,ks.L)(this.level)));vt=vt.parent);Xe=Xe||Ue,Xe&&(Xe.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],fe),fe.min!==1/0&&(fe.level=Xe.level,Pe=!0))}Pe&&((0,lt.Wi)(D.elevationBounds)&&(D.elevationBounds=new Ib),D.elevationBounds.copyFrom(fe))}modifyLayers(v,O,D){const w=this.layerInfo[D];for(const Pe of w)Pe.loadingAgent&&Pe.loadingAgent!==Du&&(Bv(Pe.loadingAgent),Pe.loadingAgent=null),Pe.waitingAgents.clear();for(let Pe=0;Pe<w.length;++Pe)void 0===v[Pe]&&w[Pe].release();const te=new Array(...w),fe=O.length;w.length=fe;for(let Pe=0;Pe<fe;Pe++){const Ue=O[Pe];w[Pe]=Ue>-1?te[Ue]:Lv.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(v){this.renderData&&(this._createOrUpdateAgents(0,v),this.updateRenderData(v,Ys.Ns.FADING))}updateAgents(v){if(this.renderData){const O=this.layerInfo[v];for(const D of O)D.loadingAgent===Du&&(D.loadingAgent=null);this._createOrUpdateAgents(0,v)}}updateAgentSuspension(){for(const v of zf){const O=this._isSuspended(v);for(const D of this.layerInfo[v])D.loadingAgent&&D.loadingAgent!==Du&&(D.loadingAgent.setSuspension(O),D.loadingAgent===Du&&this.updateRenderData(v,Ys.Ns.FADING))}}removeLayerAgent(v,O){const D=this.layerInfo[O][v];D.loadingAgent&&D.loadingAgent!==Du&&D.loadingAgent.dispose(),D.loadingAgent=null}agentDone(v,O){const D=this.layerInfo[O][v];D.loadingAgent=Du,!D.data&&(0,lt.Wi)(D.upsampleInfo)&&this._createOrUpdateAgents(v+1,O)}_createOrUpdateAgents(v,O){const D=this.layerInfo[O];if(0===D.length)return;const w=(()=>{for(let fe=v;fe<D.length;++fe){const Pe=this._surface.layerViewByIndex(fe,O);if((0,Ji.TK)(Pe)&&"normal"!==Pe.layer.blendMode)return!0}return!1})(),te=this._isSuspended(O);for(let fe=v;fe<D.length;++fe){const Pe=D[fe];let Ue=!1;const Xe=this._surface.layerViewByIndex(fe,O),st=(0,Ji.RB)(Xe);if(Pe.loadingAgent?(0,xu.yf)(this,st,!1)?(Pe.loadingAgent!==Du&&Pe.loadingAgent.setSuspension(te),Pe.loadingAgent!==Du&&(Ue=Pe.loadingAgent.update())):Pe.dispose():(0,xu.yf)(this,st,!1)&&(Pe.loadingAgent=l5(this,fe,O,te),Ue=Pe.loadingAgent.startLoading(),Ue?Pe.loadingAgent===Du&&this.setPendingUpdate(zs.GEOMETRY):(Bv(Pe.loadingAgent),Pe.loadingAgent=Du)),Pe.loadingAgent===Du&&this.updateRenderData(O,Ys.Ns.FADING),!w&&Ue&&Xe.isOpaque)return}}_isWithinExtent(v){const O=this.extent;return O[0]>=v[0]&&v[2]>=O[2]&&O[1]>=v[1]&&v[3]>=O[3]}intersectsExtent(v){const O=this.extent;return O[2]>=v[0]&&v[2]>=O[0]&&O[3]>=v[1]&&v[3]>=O[1]}getElevationBasedVerticesPerSide(v){const O=this.vlevel-this.level,D=Math.max(this.level-v,(0,ks.L)(this.level)-O);return(0,li.uZ)(1+(this.maxTesselation>>D),2,this.maxTesselation+1)}get test(){return{cachedMemory:this.cachedMemory}}_findLIJ(v,O){if(!v)return null;const D=this.surface.rootTiles;if((0,lt.pC)(D))for(const w of D)if(u5(w,v)){let te=w,fe=v[0]-te.level-1;for(;fe>=0&&!te.isLeaf&&!O(te);)te=te.children[2*(v[1]>>fe&1)+(v[2]>>fe&1)],fe--;return O(te)?te:null}return null}findNeighborTile(v,O){const D=this.lij,w=this.getNeighborLIJ(D,v);return w?function d5(_,v){return _[0]===v[0]&&_[1]===v[1]&&_[2]===v[2]}(D,w)?O(this)?this:null:this._findLIJ(w,O):null}findCorner(v,O){const D=v===Ys.Xo.NORTH_EAST?1:v===Ys.Xo.NORTH_WEST?0:v===Ys.Xo.SOUTH_WEST?2:3;let w=this;for(;!(w.isLeaf||O&&O(w));)w=w.children[D];return w}findNeighborCornerTileExact(v,O){var D;return null==(D=this.findNeighborTile(v,w=>O(w)||w.level===this.level))?void 0:D.findCorner((0,Ji.$v)(v),O)}forAllSubtreeOnSide(v,O){const D=v===Ys.Xo.NORTH?[0,1]:v===Ys.Xo.NORTH_EAST?[1]:v===Ys.Xo.EAST?[1,3]:v===Ys.Xo.SOUTH_EAST?[3]:v===Ys.Xo.SOUTH?[2,3]:v===Ys.Xo.SOUTH_WEST?[2]:v===Ys.Xo.WEST?[0,2]:[0],w=te=>{O(te)||te.isLeaf||D.forEach(fe=>w(te.children[fe]))};w(this)}forallNeighbors(v){Ji.cA.forEach(O=>this.findNeighborCornerTileExact(O,v)),Ji.OC.forEach(O=>{var D;return null==(D=this.findNeighborTile(O,w=>w.level===this.level||v(w)))?void 0:D.forAllSubtreeOnSide((0,Ji._F)(O),v)})}getNeighborEdgeStartVertexIndex(v,O){const D=null!=O?O:this.findNeighborTile(Ji.OC[v],st=>st.isLoaded);if(!D||!this.isLoaded||!D.isLoaded)return 0;const w=this.level-D.level;if(0===w)return 0;const te=2**w,fe=1==(1&v),Pe=fe?0:1,Xe=this.lij[Pe+1]-D.lij[Pe+1]*te;return fe?te-1-Xe:Xe}_updateNeighborsWithChangedEdgeResolution(){for(let v=0;v<4;++v)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[v]){const O=Ji.OC[v],D=this.findNeighborTile(O,w=>w.isLoaded||w.level===this.level);if(!D)continue;if(!D.isLoaded){(0,Ji.Fp)(!D.isLeaf);const w=(v+2)%4,te=(0,Ji._F)(O);D.forAllSubtreeOnSide(te,fe=>fe.isLoaded?(fe.updateEdgeAfterResolutionChange(w),!0):((0,Ji.Fp)(!fe.isLeaf),!1))}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[v]=!1}}updateNeighborDataAndGeometryIfNeeded(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()}updateNeighborsAfterGeometryChange(v=this.level){this.forEachLoadedNeighbor(O=>this._updateNeighbor(O)),Ji.OC.forEach(O=>{var D;null==(D=this.findNeighborTile(O,w=>w.isLoaded&&w.level<v))||D.updateNeighborsWithChangedEdgeResolution()})}updateNeighborsWithChangedEdgeResolution(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()}updateEdgeAfterResolutionChange(v){this.renderData.updateEdgeAfterResolutionChange(v)}forEachLoadedNeighbor(v){const O=this.level,D=w=>w.level===O||w.isLoaded;Ji.OC.forEach((w,te)=>{var Ue,Xe;const fe=this.findNeighborTile(w,D);null!=fe&&fe!==this&&fe.forAllSubtreeOnSide((0,Ji._F)(w),st=>!!st.isLoaded&&(v(st),!0));const Pe=null==(Xe=null==(Ue=this.renderData)?void 0:Ue.geometryState)?void 0:Xe.neighborData;Pe&&(Pe.modifiedEdgeResolutions[te]=!1)}),Ji.cA.forEach(w=>{var fe;const te=null==(fe=this.findNeighborTile(w,D))?void 0:fe.findCorner((0,Ji.$v)(w),Pe=>Pe.isLoaded);(0,Ji.Fp)(!te||function h5(_,v,O){return!(0,lt.Wi)(_)&&!(0,lt.Wi)(v)&&v!==_&&(_.level>=v.level?ZP(_,v,O):ZP(v,_,(0,Ji.$v)(O)))}(this,te,w)),(null==te?void 0:te.isLoaded)&&v(te)})}_updateNeighbor(v){(null==v?void 0:v.isLoaded)&&v.updateNeighborDataAndGeometryIfNeeded()}getNeighborLIJ(v,O){const D=(0,Ji.Mw)(O)?-1:(0,Ji.uv)(O)?1:0,w=(0,Ji.OD)(O)?-1:(0,Ji.Eu)(O)?1:0,te=[v[0],v[1]+D,v[2]+w];return te[1]<0?null:this.surface.isGlobal?this.wrapLIJ(te):te[2]<0?null:te}wrapLIJ(v){return!v||v[1]<0||v[1]>=2**v[0]?null:this.surface.wrapEastWest(v)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return 0===this.lij[2]}get isNorthEnd(){return 0===this.lij[1]}get isSouthEnd(){return this.extent[1]+Iv.E>=this.surface.extent[1]}compareLIJs(v){const O=this.lij,D=O[0],w=v[0];if(D===w)return[O,v];const te=D-w;if(te<0){const fe=2**-te;return[[w,O[1]*fe,O[2]*fe],v]}{const fe=2**te;return[O,[D,v[1]*fe,v[2]*fe]]}}checkGeometryWaterproofness(){Ji.XJ&&((0,Ji.Fp)(this.isLoaded),this.renderData.checkGeometryWaterproofness())}shouldHaveNeighbor(v){const O=this.extent,D=this.surface.rootTilesExtent,w=.25*(O[2]-O[0]);if((0,Ji.Mw)(v)&&O[3]+w>=D[3]||(0,Ji.uv)(v)&&O[1]-w<=D[1])return!1;const te=this.surface.isGlobal;return!(!te&&(0,Ji.OD)(v)&&O[0]-w<=D[0]||!te&&(0,Ji.Eu)(v)&&O[2]+w>=D[2])}}function l5(_,v,O,D){const w=O===An.ELEVATION?Gb.acquire():zb.acquire();return w.init(_,v,O,D),w}function Bv(_){_.dispose(),_ instanceof HP?Gb.release(_):_ instanceof KP&&zb.release(_)}const zb=new lh.Z(KP),Gb=new lh.Z(HP),c5=new Ib;var Dc;function u5(_,v){const O=_.level,D=v[0];if(O>D)return!1;const w=D-O,te=Math.floor(v[1]/2**w),fe=Math.floor(v[2]/2**w);return te===_.lij[1]&&fe===_.lij[2]}function Bp(_,v,O){return Math.abs(_-v)<=O}function ZP(_,v,O){(0,Ji.Fp)(_.level>=v.level);const D=(0,Ji._0)(O),w=(0,Ji.wt)(O),te=_.extent,fe=v.extent,Pe=[D?te[0]:te[2],w?te[3]:te[1]],Ue=[D?fe[2]:fe[0],w?fe[1]:fe[3]],Xe=1e-5*(te[2]-te[0]),st=Bp(Pe[0],Ue[0],Xe)||_.surface.isGlobal&&Bp(Pe[0],-Ue[0],Xe),vt=Bp(Pe[1],Ue[1],Xe);return!(!st||!vt)||!(_.level===v.level||!st&&!vt)&&(st?$P(fe[1],fe[3],te[1],te[3],Xe):$P(fe[0],fe[2],te[0],te[2],Xe))}function $P(_,v,O,D,w=Iv.E){return _-w<=O&&O<=D&&D<=v+w}!function(_){_[_.TOP=0]="TOP",_[_.MIDDLE=1]="MIDDLE",_[_.BOTTOM=2]="BOTTOM"}(Dc||(Dc={}));class p5{constructor(){this._scales=[-1,-1,-1,-1],this._offsets=[-1,-1,-1,-1]}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(v,O,D){this._scales[2*v]=O,this._scales[2*v+1]=D}setOffset(v,O,D){this._offsets[2*v]=O,this._offsets[2*v+1]=D}get scales(){return this._scales}get offsets(){return this._offsets}}class Np{constructor(){this.geometryInfo=new JU,this.intersectionData=null,this.geometryState=null,this._textureRef=new B_(()=>this.tile.surface.textureFadeDuration),this.overlay=new p5,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get tile(){return this._tile}init(v){this._tile=v,this.clear();const O=this.geometryInfo;O.indices=null,O.vertexAttributes=null,(0,Ea.cS)(O.boundingBox),O.indexCount=0,O.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new r5,this.localOrigin=null,this.overlay.clear()}clear(){this._releaseGeometry(),this.releaseTexture(),this._textureRef.clear()}updateGeometryIfChanged(v,O){const D=this.updateGeometryStateAndPrepareForGeometryGeneration(O);return this._hasGeometry=!0,this.updateNeighborDataAndGeometryIfNeeded(D,v)}updateNeighborDataAndGeometryIfNeeded(v=!1,O=this.vao.context){const D=this._updateNeighborData(),w=v||this._geometryStateChangedSinceLastUpdate||D;return w&&(this._updateGeometry(O),this._geometryStateChangedSinceLastUpdate=!1),w}_calculateEdgeResolution(v,O){var Xe;const D=this.tile,w=this.geometryState.numVerticesPerSide-1;if(!D.surface.isGlobal){const st=D.surface.extent;if((0,lt.pC)(st)&&(0===v&&D.extent[3]>st[3]||1===v&&D.extent[2]>st[2]||2===v&&D.extent[1]<st[1]||3===v&&D.extent[0]<st[0]))return w}const te=D.level,fe=Ji.OC[v],Pe=O||D.findNeighborTile(fe,st=>st.isLoaded||st.level===te);if(!Pe||Pe.isLeaf&&!Pe.isLoaded)return(0,Ji.Fp)((0,lt.Wi)(null==(Xe=D.surface)?void 0:Xe.rootTiles)||D.surface.updatingRootTiles||!D.shouldHaveNeighbor(fe)),w;if(Pe.isLoaded){const vt=Pe.renderData.geometryState,Ct=te-Pe.level;return 0===Ct?Math.max(vt.numVerticesPerSide-1,w):Math.max(1,vt.neighborData.edgeResolutions[(v+2)%4]/2**Ct)}(0,Ji.Fp)(!Pe.isLeaf);let Ue=w;return Pe.forAllSubtreeOnSide((0,Ji._F)(fe),st=>st===D||(st.isLoaded?(Ue=Math.max(Ue,2**(st.level-te)),!0):((0,Ji.Fp)(!st.isLeaf),!1))),Ue}_updateNeighborData(){const v=this.tile,O=Xe=>Xe.isLoaded||Xe.level===v.level,D=Xe=>Xe.isLoaded,w=[null,null,null,null],te=[null,null,null,null];(()=>{for(let Xe=0;Xe<4;++Xe){const st=v.findNeighborTile(Ji.OC[Xe],O);w[Xe]=st,te[Xe]=(null==st?void 0:st.isLoaded)?st:null}})();const fe=[null,null,null,null];(()=>{for(let Xe=0;Xe<4;++Xe)fe[Xe]=v.findNeighborTile(Ji.cA[Xe],D)})();const Pe=this.geometryState.neighborData;let Ue=!1;return(()=>{for(let Xe=0;Xe<4;++Xe){const st=Pe.edgeResolutions[Xe],vt=w[Xe],Ct=this._calculateEdgeResolution(Xe,vt);Pe.edgeResolutions[Xe]=Ct,st!==Ct&&(Ue=!0,this._edgeResolutionChanged=!0,vt&&vt!==v&&!vt.isLoaded&&vt.level===v.level&&(Pe.modifiedEdgeResolutions[Xe]=!0))}})(),(()=>{const st=Pe.cornerNeighborData,vt=(Ct,Wt)=>{var sr;const Kt=st[Ct],Lt=Kt.cornerTiles;for(let Er=0;Er<4;++Er){const yr=Ji.cA[Er],br=null==(sr=Wt[Er])?void 0:sr.findCorner((0,Ji.$v)(yr),Rr=>(null==Rr?void 0:Rr.isLoaded)||Rr===v);Lt[Er]=br}const nr=((Ct,Wt)=>{var sr,Er;const Kt=Ct.reduce((yr,br)=>{var Rr;return Math.min(yr,null!=(Rr=null==br?void 0:br.level)?Rr:1/0)},1/0);for(let yr=0;yr<4;++yr){const br=Ct[(yr+3)%4],Rr=Ct[yr];if(br&&br.level<v.level&&br===Rr){const $r=br,si=1==(1&yr),Ci=(v.getNeighborEdgeStartVertexIndex(yr,$r)+(0===Wt||1===Wt&&!si||3===Wt&&si?1:0))/2**(v.level-$r.level);return Lo(si?0===Wt||1===Wt?$r.extent[0]:$r.extent[2]:(0,li.t7)($r.extent[0],$r.extent[2],Ci),si?(0,li.t7)($r.extent[1],$r.extent[3],Ci):0===Wt||3===Wt?$r.extent[1]:$r.extent[3],$r.renderData.geometryState.samplerData)}}let Lt=0,nr=0;for(let yr=0;yr<4;++yr){const br=Ct[yr];if(br&&br.level===Kt){const si=br.extent;nr+=Lo(si[0===yr||1===yr?0:2],si[0===yr||3===yr?1:3],null==(Er=null==(sr=br.renderData)?void 0:sr.geometryState)?void 0:Er.samplerData),Lt++}}return Lt?nr/Lt:0})(Lt,Ct);return Kt.elevation!==nr&&(Kt.elevation=nr,!0)};for(let Ct=0;Ct<4;++Ct){const Lt=[fe[Ct],te[(Ct+1)%4],v,te[Ct]],nr=Lt.map((sr,Er)=>Lt[(Er+4-Ct)%4]);vt(Ct,nr)&&(this._cornerElevationChanged=!0,Ue=!0)}})(),(()=>{var vt;const Xe=(Ct,Wt)=>{if(!(null==Ct?void 0:Ct.isLoaded)||Ct.lij[0]>v.lij[0])return null;const Kt=Ct.renderData.geometryState;return{neighborSamplerData:Kt.samplerData,neighborEdgeOverlapResolution:Kt.neighborData.edgeResolutions[Wt+2],version:Kt.samplerDataVersion,neighborVerticesPerSide:Kt.numVerticesPerSide,neighborTile:Ct}},st=Pe.edgeNeighbours;for(let Ct=0;Ct<4;++Ct){const Wt=te[Ct];Wt&&((0,Ji.Fp)(null==Wt?void 0:Wt.isLoaded),(0,Ji.Fp)((null==Wt?void 0:Wt.lij[0])<=v.lij[0]));const Kt=st[Ct],Lt=null==Kt?void 0:Kt.version,nr=Xe(Wt,Ct),sr=null!=(vt=null==nr?void 0:nr.version)?vt:null,yr=Kt&&nr&&Lt!==sr,br=Kt&&nr&&(null==Kt?void 0:Kt.neighborTile)!==(null==nr?void 0:nr.neighborTile),Rr=null!=Kt!=(null!=nr)||yr||br;this._edgeNeighborChanged||(this._edgeNeighborChanged=Rr),Ue||(Ue=Rr),!Rr&&Lt||(st[Ct]=nr)}})(),Ue}updateEdgeAfterResolutionChange(v){var te,fe;const O=this._calculateEdgeResolution(v),D=this.geometryState.neighborData.edgeResolutions,w=D[v];(0,Ji.Fp)((null!=(fe=null==(te=this.geometryState.neighborData.edgeNeighbours[v])?void 0:te.neighborTile.level)?fe:0)<=this.tile.level),O!==w&&(D[v]=O,this._edgeResolutionChanged=!0,Np.deferTileNeighborUpdate?Np.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))}_updateGeometry(v){this.intersectionData=null;const O=this.tile,D=O.lij,w=Np.updatedGeometryTiles.get(D)||0;Np.updatedGeometryTiles.set(D,w+1);const Pe=!this._vao||!this.geometryInfo.vertexAttributes||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._edgeResolutionChanged,Ue=!Pe&&this._edgeNeighborChanged,Xe=!Ue&&this._cornerElevationChanged;this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._edgeResolutionChanged=!1,this._edgeNeighborChanged=!1,this._cornerElevationChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,Pe?(this._releaseGeometry(),this._createGeometry(v)):Ue?O.updateEdgeElevations():Xe?O.updateCornerElevations():console.warn("Update for no reason?")}releaseGeometry(){return this._releaseGeometry()}get hasGeometry(){return this._hasGeometry}ensureTexture(v,O){return(0,lt.pC)(this._texture)&&this._texture.descriptor.width!==v&&this.releaseTexture(),(0,lt.Wi)(this._texture)&&(this._texture=O(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){(0,lt.pC)(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}updateGeometryStateAndPrepareForGeometryGeneration(v){const O=this._getElevationInfo(),D=O.samplerData?this.tile.getElevationBasedVerticesPerSide(O.maxTileLevel):this.tile.getDefaultVerticesPerRowOnLevel(),w=Math.max(D,5);let te=this.tile.clippingArea;this.tile.intersectsClippingArea&&!this.tile.isWithinClippingArea||(te=null);const fe=this.geometryState;let Pe=!1;return fe.numVerticesPerSide!==w&&(this._numVerticesPerSideChanged=!0,fe.numVerticesPerSide=w,fe.samplerDataVersion++,Pe=!0),O.changed&&(this._samplerDataChanged=!0,fe.samplerData=O.samplerData,fe.samplerDataVersion++,Pe=!0),(0,Cl.fS)(fe.clippingArea,te)||(this._clippingAreaChanged=!0,fe.clippingArea=te,Pe=!0),fe.wireframe!==v&&(this._wireframeChanged=!0,fe.wireframe=v,Pe=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=Pe),this._hasGeometry=!0,Pe}_createGeometry(v){this.tile.createGeometry();const O=this.geometryInfo.vertexAttributes,D=this.geometryInfo.indices,w=v.gl;this._vao=new ku.U(v,bo.i,{geometry:(0,g0.K)(O.layout)},{geometry:Zl.f.createVertex(v,w.STATIC_DRAW,O.buffer)},Zl.f.createIndex(v,w.STATIC_DRAW,D)),this._hasGeometry=!0}_releaseGeometry(){return this._hasGeometry=!1,!!this._vao&&(this._vao.dispose(),this._vao=null,function qU(_){Nb.release(_.vertexAttributes),_.vertexAttributes=null,_.indices=null}(this.geometryInfo),!0)}get vao(){return this._vao}setTextureReference(v,O=Up.Immediate){(0,lt.pC)(v)&&v.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(v,O)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const v=this.geometryState.samplerData,O=this.tile.layerInfo[An.ELEVATION],D=O.length;let w=new Array(D),te=0,fe=0,Pe=!1;for(let Ue=0;Ue<D;Ue++){const Xe=O[Ue];if((0,lt.pC)(Xe.upsampleInfo)){const st=Xe.upsampleInfo.tile,vt=st.layerInfo[An.ELEVATION][Ue].data,Ct=vt&&vt.samplerData;v&&v[te]===Ct||(Pe=!0),w[te++]=Ct,fe=Math.max(fe,st.lij[0])}else if(Xe.data){const st=this.tile.surface.layerViewByIndex(Ue,An.ELEVATION);if((0,xu.yf)(this.tile,st.layer,!1)){const vt=Xe.data;v&&v[te]===vt.samplerData||(Pe=!0),w[te++]=vt.samplerData,fe=this.tile.level}}}return(0,lt.pC)(v)&&v.length!==te&&(Pe=!0),te>0?w.length=te:w=null,{changed:Pe,samplerData:w,maxTileLevel:fe}}get estimatedGeometryMemoryUsage(){const v=(0,lt.R2)(this.intersectionData,0,O=>O.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+v}get textureDescriptor(){return(0,lt.pC)(this._texture)?this._texture.descriptor:null}get test(){return{hasTexture:null!=this._texture}}checkGeometryWaterproofness(){}}function kP(_,v,O,D,w,te){const fe=v-1,Pe=_.vertexAttributes.count,Ue=2*(Math.min(v-2,D[1])-Math.max(1,D[0]))*(Math.min(v-2,w[1])-Math.max(1,w[0])),Xe=Ji.OC.map((sr,Er)=>0===Er&&w[1]<v-2||1===Er&&D[1]<v-2||2===Er&&w[0]>1||3===Er&&D[0]>1),st=3*(Ue+_.outerEdges.reduce((sr,Er,yr)=>sr+(Xe[yr]?0:fe-2+Er.count-1),0)+O.reduce((sr,Er)=>sr+fe*(2*(Er.latitudeResolution-1)+1),0))*(te?2:1),vt=new(Pe>65536?Uint32Array:Uint16Array)(st);let Ct=0;const Wt=te?(sr,Er,yr)=>{vt[Ct++]=sr,vt[Ct++]=Er,vt[Ct++]=Er,vt[Ct++]=yr,vt[Ct++]=yr,vt[Ct++]=sr}:(sr,Er,yr)=>{vt[Ct++]=sr,vt[Ct++]=Er,vt[Ct++]=yr},Kt=v-2,Lt=fe-2;(()=>{for(let sr=Math.max(w[0],1)-1;sr<Math.min(w[1],v-2)-1;++sr)for(let Er=Math.max(D[0],1)-1;Er<Math.min(D[1],v-2)-1;++Er){const yr=sr*Kt+Er,br=yr+1,Rr=br+Kt,$r=Rr-1;Wt(yr,br,Rr),Wt(Rr,$r,yr)}})(),(()=>{for(let sr=0;sr<4;++sr){if(Xe[sr])continue;const Er=_.outerEdges[sr],yr=_.innerEdges[sr];let br=0,Rr=0;const $r=Er.count,si=yr.count,Ci=1===sr||2===sr?(Ti,ki,Fi)=>Wt(Ti,ki,Fi):(Ti,ki,Fi)=>Wt(Ti,Fi,ki);for(;br<$r-1||Rr<si-1;){const Ti=yr.getVertexOffset(Rr),ki=Er.getVertexOffset(br),Fi=br<$r-1,Xi=Rr<si-1,rs=Fi?0+fe*(br+.5)/($r-1):0,Es=Xi?1+Lt*(Rr+.5)/(si-1):0;Fi&&(!Xi||rs<=Es)?(++br,Ci(Ti,ki,Er.getVertexOffset(br))):(++Rr,Ci(Ti,ki,yr.getVertexOffset(Rr)))}}})(),O.forEach(sr=>{let Er=_.outerEdges[sr.connectedOuterEdgeOffset].offset0;for(let yr=0;yr<sr.latitudeResolution;++yr){const br=0===yr?sr.rowOffset:Er+v;for(let Rr=0;Rr<fe;Rr++)Wt(Er,Er+1,br+Rr),yr<sr.latitudeResolution-1&&Wt(Er+1,br+Rr+1,br+Rr),++Er;Er=br}}),_.indices=vt,_.indexCount=st}function YP(_,v){const O=_.localOrigin,D=_.geometryInfo,w=_.geometryState.neighborData.edgeResolutions,te=D.numVerticesPerSide-2,fe=D.vertexAttributes.position.typedBuffer;let Pe=v;for(let Ue=0;Ue<4;++Ue){{const Xe=0===Ue||2===Ue;D.innerEdges[Ue]=new VP(fe,O,(0===Ue?te-1:0)*te+(1===Ue?te-1:0),(Xe?0:1)*te+(Xe?1:0),te)}{const st=w[Ue]+1;D.outerEdges[Ue]=new VP(fe,O,Pe,1,st),Pe+=st}}}function JP(_,v){qP(_,v),function x5(_,v){const O=_.geometryState.clippingArea,D=_.tile.extent,w=(0,lt.pC)(O)&&(D[0]<O[0]||D[2]>O[2]||D[1]<O[1]||D[3]>O[3])?A5:D5;for(let te=0;te<4;++te)w(_,te,v)}(_,v),nx(_,v)}function XP(_,v,O,D,w){const te=Math.cos(O),fe=Math.sin(O),Pe=Math.sin(v),Ue=Math.cos(v),Xe=w+D;_[0]=Ue*te*Xe,_[1]=Pe*te*Xe,_[2]=fe*Xe}function _g(_,v,O){return _?D=>function C5(_,v){return(Math.PI/2-2*Math.atan(Math.exp(-_/v)))*v}(D,v):D=>function T5(_,v){return _*v}(D,O)}function QP(_){ex(_,(v,O,D,w)=>function b5(_,v,O,D,w,te){XP(_,w[0===v?0:2],w[0===O?1:3],D,te)}(v,O,D,w,_.tile.extentInRadians,_.tile.ellipsoid.radius))}function qP(_,v){const O=_.tile;(0,lt.pC)(O.renderData.geometryState.clippingArea)?function O5(_,v){const O=_.geometryState,D=_.tile,w=D.extent,te=(0,lt.Pt)(O.clippingArea,w),fe=_.geometryInfo,Pe=fe.boundingBox,Ue=fe.outerEdges,Xe=O.neighborData.cornerNeighborData,Ct=fe.uvOffsetAndScale[2],Wt=fe.uvOffsetAndScale[3],Kt=Ct>0?1/Ct:1,Lt=Wt>0?1/Wt:1,nr=-fe.uvOffsetAndScale[0]*Kt,sr=-fe.uvOffsetAndScale[1]*Lt,Er=D.surface.isWebMercatorOnPlateeCarree,yr=_g(Er,Er?D.ellipsoid.radius:0,v),br=O.samplerData,Rr=O.neighborData.edgeNeighbours,$r=_.localOrigin,si=(Ci,Ti,ki,Fi,Xi)=>{const Es=w[1]*(1-Xi)+w[3]*Xi,Gs=(0,li.uZ)(w[0]*(1-Fi)+w[2]*Fi,te[0],te[2]),ws=(0,li.uZ)(Es,te[1],te[3]),$i=[ws===w[3],Gs===w[2],ws===w[1],Gs===w[0]],qi=!$i[3]&&!$i[1]||!$i[0]&&!$i[2],as=qi?$i[0]&&(0,lt.pC)(Rr[0])?Rr[0]:$i[1]&&(0,lt.pC)(Rr[1])?Rr[1]:$i[2]&&(0,lt.pC)(Rr[2])?Rr[2]:$i[3]&&(0,lt.pC)(Rr[3])?Rr[3]:null:null,bs=qi?as?as.neighborTile.level===D.level?.5*(Lo(Gs,ws,br)+Lo(Gs,ws,as.neighborSamplerData)):Lo(Gs,ws,as.neighborSamplerData):Lo(Gs,ws,br):Xe[ki].elevation,en=Gs*v-$r[0],Cs=yr(ws)-$r[1],xi=bs-$r[2];jp(en,Cs,xi,Pe);const Qi=(0,li.uZ)(nr+Fi*Kt,0,1),As=(0,li.uZ)(sr+Xi*Lt,0,1);Ci.setVertexRawXYZUV(Ti,en,Cs,xi,Qi,As)};for(let Ci=0;Ci<4;++Ci){const Ti=Ue[Ci];si(Ti,0,0===Ci?3:1===Ci?1:2,1===Ci?1:0,0===Ci?1:0),si(Ti,Ti.count-1,2===Ci?1:3===Ci?3:0,3===Ci?0:1,2===Ci?0:1)}}(_,v):ex(_,(D,w,te,fe)=>function M5(_,v,O,D,w,te,fe){const Ue=0===O?w[1]:w[3],Xe=D;_[0]=(0===v?w[0]:w[2])*te,_[1]=fe(Ue),_[2]=Xe}(D,w,te,fe,_.tile.extent,v,_g(O.surface.isWebMercatorOnPlateeCarree,O.ellipsoid.radius,v)))}function ex(_,v){const O=_.geometryInfo,D=O.outerEdges,w=_.geometryState.neighborData.cornerNeighborData,te=O.boundingBox,fe=_.localOrigin,Pe=(Ue,Xe,st,vt,Ct)=>{v(G0,st,vt,w[Xe].elevation);for(let Wt=0;Wt<3;++Wt)G0[Wt]-=fe[Wt];jp(G0[0],G0[1],G0[2],te),Ue.setVertexRawXYZUV(Ct,G0[0],G0[1],G0[2],st,vt)};for(let Ue=0;Ue<4;++Ue){const Xe=D[Ue];Pe(Xe,0===Ue?3:1===Ue?1:2,1===Ue?1:0,0===Ue?1:0,0),Pe(Xe,2===Ue?1:3===Ue?3:0,3===Ue?0:1,2===Ue?0:1,Xe.count-1)}}function Hb(_){var D,w;const v=_.vao;null==(w=null==(D=null==v?void 0:v.vertexBuffers)?void 0:D.geometry)||w.setSubData(_.geometryInfo.vertexAttributes.position.typedBuffer)}function tx(_){QP(_);for(let v=0;v<4;++v)P5(_,v);sx(_)}function P5(_,v){var W2,V2,z2;const O=_.geometryState,D=O.neighborData,w=_.tile,te=w.extent,fe=te[2]-te[0],Pe=te[3]-te[1],Ue=w.extentInRadians,Xe=Ue[0],st=Ue[2],vt=w.ellipsoid.radius,Ct=Kb(_),Kt=D.edgeNeighbours[v],Lt=D.edgeResolutions[v],nr=1===v||3===v,sr=1===v?1:0,Er=0===v?1:0,yr=te[0]+sr*fe,br=te[1]+Er*Pe,Rr=Xe*(1-sr)+st*sr,$r=Ct(Er),si=null==Kt?void 0:Kt.neighborTile,Ci=w.level-(null!=(W2=null==si?void 0:si.level)?W2:w.level),Ti=2**Ci,ki=Lt*Ti,Fi=(fo=>{if(!fo)return 0;const Uc=nr?0:1,ny=w.lij[Uc+1]-fo.lij[Uc+1]*Ti;return(nr?Ti-1-ny:ny)*Lt})(si),Xi=null==si?void 0:si.extent,rs=(v+2)%4,Es=O.samplerData,Gs=null==(z2=null==(V2=null==si?void 0:si.renderData)?void 0:V2.geometryState)?void 0:z2.samplerData,ws=si&&0===Ci,as=ws?(fo,au,Uc,Fd)=>.5*(Lo(fo,au,Gs)+Lo(Uc,Fd,Es)):(fo,au)=>Lo(fo,au,Gs);let bs=Xi?1===rs?Xi[2]:Xi[0]:yr,en=Xi?0===rs?Xi[3]:Xi[1]:br;const Qi=si?nr?(fo,au,Uc)=>{const Fd=(Fi+fo)/ki;return en=Xi[1]*(1-Fd)+Xi[3]*Fd,as(bs,en,au,Uc)}:(fo,au,Uc)=>{const Fd=(Fi+fo)/ki;return bs=Xi[0]*(1-Fd)+Xi[2]*Fd,as(bs,en,au,Uc)}:(fo,au,Uc)=>Lo(au,Uc,Es),As=(fo,au,Uc)=>Qi(fo,au,Uc);let Is=sr,Qs=yr,Ns=Rr,an=Er,dn=br,ao=$r,ra=Math.sin(Ns),ua=Math.cos(Ns),kn=Math.cos(ao),Co=Math.sin(ao);const so=nr?()=>Ct(an):()=>$r,Po=nr?fo=>{an=fo,dn=te[1]*(1-fo)+te[3]*fo,ao=so(),kn=Math.cos(ao),Co=Math.sin(ao)}:fo=>{Is=fo,Qs=te[0]*(1-fo)+te[2]*fo,Ns=Xe*(1-Is)+st*Is,ra=Math.sin(Ns),ua=Math.cos(Ns)},Oa=_.geometryInfo,Fa=Oa.boundingBox,Uo=Oa.vertexAttributes,ko=Uo.position.typedBuffer,yh=Uo.uv0.typedBuffer,jd=Uo.normal.typedBuffer,ju=Oa.outerEdges[v];let vh=ju.getVertexOffset(1);const Eh=Lt+1,ap=_.localOrigin,ff=ap[0],ZF=ap[1],$F=ap[2],B2=w.surface.shadingEnabled,N2=1===v?-1:3===v?1:0,j2=0===v?-1:2===v?1:0,F2=fe/Lt,kF=N2*F2,YF=j2*F2,JF=N2*(1/Lt),XF=j2*(1/Lt),jT=fo=>{(0,_t.v)(Fp,fo,Kh),(0,_t.f)(W_,Fp,H0),(0,_t.f)(V_,W_,Fp),(0,_t.a)(Ca,Ca,V_)};for(let fo=1;fo<Eh-1;++fo){Po(fo/Lt);const au=As(fo,Qs,dn),Uc=vt+au,Fd=ua*kn*Uc,ny=ra*kn*Uc,G2=Co*Uc,H2=Fd-ff,K2=ny-ZF,Z2=G2-$F;jp(H2,K2,Z2,Fa);const _f=ks.Vs*vh;if(ko[_f+0]=H2,ko[_f+1]=K2,ko[_f+2]=Z2,yh[_f+0]=Is,yh[_f+1]=an,B2){(0,_t.s)(Ca,0,0,0),(0,_t.s)(Kh,Fd,ny,G2),(0,_t.n)(H0,Kh);const $2=(ZE,QF)=>{const qF=Lo(Qs+ZE*kF,dn+ZE*YF,QF),FT=vt+qF,k2=Is+ZE*JF,Y2=Xe*(1-k2)+st*k2,e7=Math.sin(Y2),t7=Math.cos(Y2),J2=Ct(an+ZE*XF),r7=Math.sin(J2),X2=Math.cos(J2),i7=(0,$t.f)(t7*X2*FT,e7*X2*FT,r7*FT);jT(i7)};si&&$2(-1,Gs),si&&!ws||$2(1,Es),jd[_f+0]=Ca[0],jd[_f+1]=Ca[1],jd[_f+2]=Ca[2]}++vh}if(B2)for(let fo=1;fo<Eh-1;++fo)ju.getVertexRawNormal(Ca,fo),ju.getVertex(Kh,fo),(0,_t.n)(H0,Kh),ju.getVertex(Au,fo-1),jT(Au),ju.getVertex(Au,fo+1),jT(Au),(0,_t.n)(Ca,Ca),ju.setVertexRawNormal(fo,Ca[0],Ca[1],Ca[2])}function rx(_,v,O,D,w,te,fe){return fe===w?!_||v?(Pe,Ue)=>Lo(Pe,Ue,O):null:fe===te&&_?(Pe,Ue)=>Lo(Pe,Ue,D):null}function Nv(_,v,O,D){if(v!==_)return()=>0;const w=v?3:2,te=v?1:0,fe=D(w,te),Pe=D(te,w),Ue=(null!=fe?1:0)+(null!=Pe?1:0),Xe=v?O:0,st=v?0:O;return(vt,Ct,Wt)=>((null!=fe?-(fe(vt+Xe,Ct+st)-Wt):0)+(null!=Pe?+(Pe(vt-Xe,Ct-st)-Wt):0))/Ue}function D5(_,v,O){const D=_.geometryState.neighborData,te=_.tile,Pe=te.surface,Ue=Pe.shadingEnabled,st=D.edgeResolutions[v],vt=st,Ct=te.extent,Kt=vt+1,Lt=D.edgeNeighbours[v],nr=_.localOrigin,sr=_.geometryState.samplerData,Rr=(null==Lt?void 0:Lt.neighborTile.level)===te.level,$r=Rr?(xi,Qi)=>.5*(Lo(xi,Qi,Lt.neighborSamplerData)+Lo(xi,Qi,sr)):(xi,Qi)=>Lo(xi,Qi,Lt.neighborSamplerData),si=(0,lt.pC)(Lt)?$r:(xi,Qi)=>Lo(xi,Qi,sr),Ci=_.geometryInfo,Ti=Ci.outerEdges[v],ki=_g(Pe.isWebMercatorOnPlateeCarree,te.ellipsoid.radius,O),Fi=Ci.boundingBox,Xi=1===v||3===v,rs=1===v?Ct[2]:Ct[0],Es=0===v?Ct[3]:Ct[1],Gs=1===v?1:0,ws=0===v?1:0,$i=(Ct[2]-Ct[0])/st,qi=null==Lt?void 0:Lt.neighborSamplerData,as=(0,lt.pC)(Lt),bs=(xi,Qi)=>rx(as,Rr,sr,qi,xi,Qi,v),en=Nv(Xi,!0,$i,bs),Cs=Nv(Xi,!1,$i,bs);for(let xi=1;xi<Kt-1;++xi){const Qi=xi/vt,As=Xi?rs:Ct[0]*(1-Qi)+Ct[2]*Qi,Is=Xi?Ct[1]*(1-Qi)+Ct[3]*Qi:Es,Qs=Xi?Gs:Qi,Ns=Xi?Qi:ws,an=si(As,Is),dn=As*O-nr[0],ao=ki(Is)-nr[1],ra=an-nr[2];if(jp(dn,ao,ra,Fi),Ue){const ua=en(As,Is,an),kn=Cs(As,Is,an);Ti.setVertexRawXYZUVN(xi,dn,ao,ra,Qs,Ns,ua,kn,$i)}else Ti.setVertexRawXYZUV(xi,dn,ao,ra,Qs,Ns)}if(Ue){const xi=Xi?0:1,Qi=Xi?1:0;for(let As=1;As<Kt-1;++As){Ti.getNormal(z_,As);const Is=Ti.getVertexZ(As-1)-Ti.getVertexZ(As+1),Qs=z_[0]+.5*xi*Is,Ns=z_[1]+.5*Qi*Is,an=2*$i,dn=1/Math.sqrt(Qs*Qs+Ns*Ns+an*an);Ti.setVertexRawNormal(As,dn*Qs,dn*Ns,dn*an)}}}function A5(_,v,O){const D=_.geometryState.neighborData,te=_.tile,fe=te.level,Pe=te.surface,Ue=Pe.shadingEnabled,Xe=D.edgeNeighbours[v],st=D.edgeResolutions[v],vt=st,Ct=te.extent,Wt=_.geometryState,Kt=(0,lt.Pt)(Wt.clippingArea,ax),Lt=_.geometryInfo,nr=Lt.uvOffsetAndScale[0],sr=Lt.uvOffsetAndScale[1],Er=nr+Lt.uvOffsetAndScale[2],yr=sr+Lt.uvOffsetAndScale[3],br=Er>nr?1/(Er-nr):1,Rr=yr>sr?1/(yr-sr):1,$r=-nr*br,si=-sr*Rr,Ci=vt+1,Ti=[Ct[3]>Kt[3],Ct[2]>Kt[2],Ct[1]<Kt[1],Ct[0]<Kt[0]],ki=Xe,Fi=Wt.samplerData,Xi=(kn,Co)=>Lo(kn,Co,Fi),rs=(null==ki?void 0:ki.neighborTile.level)===fe,Gs=Xi,ws=(0,lt.pC)(ki)?(kn,Co)=>{const so=Lo(kn,Co,ki.neighborSamplerData);return rs?.5*(so+Lo(kn,Co,Fi)):so}:Xi,$i=Ti[v]?Gs:ws,qi=Lt.outerEdges[v],as=Lt.boundingBox,bs=1===v||3===v,en=(0,li.uZ)(1===v?Ct[2]:Ct[0],Kt[0],Kt[2]),Cs=(0,li.uZ)(0===v?Ct[3]:Ct[1],Kt[1],Kt[3]),xi=1===v?1:0,Qi=0===v?1:0,As=_.localOrigin,Is=_g(Pe.isWebMercatorOnPlateeCarree,te.ellipsoid.radius,O),Qs=(Ct[2]-Ct[0])/st,Ns=null==ki?void 0:ki.neighborSamplerData,an=(0,lt.pC)(ki),dn=(null==ki?void 0:ki.neighborTile.level)===fe,ao=(kn,Co)=>rx(an,dn,Fi,Ns,kn,Co,v),ra=Nv(bs,!0,Qs,ao),ua=Nv(bs,!1,Qs,ao);for(let kn=1;kn<Ci-1;++kn){const Co=kn/vt,so=bs?en:(0,li.uZ)(Ct[0]*(1-Co)+Ct[2]*Co,Kt[0],Kt[2]),Po=bs?(0,li.uZ)(Ct[1]*(1-Co)+Ct[3]*Co,Kt[1],Kt[3]):Cs,Oa=bs?xi:(0,li.uZ)($r+Co*br,0,1),Fa=bs?(0,li.uZ)(si+Co*Rr,0,1):Qi,Uo=$i(so,Po),ko=so*O-As[0],yh=Is(Po)-As[1],jd=Uo-As[2];if(jp(ko,yh,jd,as),Ue){const ju=ra(so,Po,Uo),vh=ua(so,Po,Uo);qi.setVertexRawXYZUVN(kn,ko,yh,jd,Oa,Fa,ju,vh,Qs)}else qi.setVertexRawXYZUV(kn,ko,yh,jd,Oa,Fa)}if(Ue){const kn=bs?0:1,Co=bs?1:0;for(let so=1;so<Ci-1;++so){qi.getNormal(z_,so);const Po=qi.getVertexZ(so-1)-qi.getVertexZ(so+1),Oa=z_[0]+.5*kn*Po,Fa=z_[1]+.5*Co*Po,Uo=2*Qs,ko=1/Math.sqrt(Oa*Oa+Fa*Fa+Uo*Uo);qi.setVertexRawNormal(so,ko*Oa,ko*Fa,ko*Uo)}}}function ix(_,v){return Math.PI/2-2*Math.atan(Math.exp(-_/v))}function Kb(_){const v=_.tile;if(v.surface.isWebMercator){const D=v.extent,w=v.ellipsoid.radius;return te=>function S5(_,v,O,D){return ix(_+D*(v-_),O)}(D[1],D[3],w,te)}const O=v.extentInRadians;return D=>function R5(_,v,O){return _*(1-O)+v*O}(O[1],O[3],D)}function sx(_){_.tile.surface.shadingEnabled&&ox(_,(v,O,D,w,te,fe,Pe)=>function w5(_,v,O,D,w,te,fe){(function L5(_,v,O,D,w){const te=Kb(_),fe=_.tile,Pe=fe.extent;(0,Ji.Fp)((0,qr.OC)(Pe,O,D,1));const Ue=(O-Pe[0])/(Pe[2]-Pe[0]),st=fe.extentInRadians;XP(v,st[0]*(1-Ue)+st[2]*Ue,te((D-Pe[1])/(Pe[3]-Pe[1])),w,fe.ellipsoid.radius)})(_,Au,w,te,fe),(0,_t.v)(Fp,Au,O),(0,_t.f)(W_,Fp,D),(0,_t.f)(v,W_,Fp)}(O,v,D,w,te,fe,Pe))}function nx(_,v){_.tile.surface.shadingEnabled&&ox(_,(O,D,w,te,fe,Pe,Ue)=>function I5(_,v,O,D,w,te){_(Au,D,w,te);const fe=Au[0]-O[0],Pe=Au[1]-O[1],Ue=Au[2]-O[2];v[0]=-fe*Ue,v[1]=-Pe*Ue,v[2]=fe*fe+Pe*Pe}(function U5(_,v){return _.tile.surface.isWebMercatorOnPlateeCarree?(O,D,w,te)=>function N5(_,v,O,D,w,te){O[0]=D*_,O[1]=(Math.PI/2-2*Math.atan(Math.exp(-w/v)))*v,O[2]=te}(v,_.tile.ellipsoid.radius,O,D,w,te):(O,D,w,te)=>function B5(_,v,O,D,w){v[0]=O*_,v[1]=D*_,v[2]=w}(v,O,D,w,te)}(_,v),O,w,fe,Pe,Ue))}function ox(_,v){var fe;if(!_.tile.surface.shadingEnabled)return;const O=_.geometryState.neighborData.cornerNeighborData,D=_.tile,w=D.extent,te="local"===(null==(fe=_.tile.surface.view)?void 0:fe.viewingMode);te&&(0,_t.s)(H0,0,0,1);{const Pe=(Lt,nr,sr,Er)=>{v(V_,Lt.renderData,Kh,H0,nr,sr,Er),(0,_t.a)(Ca,Ca,V_)},Xe=(Lt,nr,sr,Er,yr,br)=>{const si=(1===br?yr.extent[0]:3===br?yr.extent[2]:Lt)+F_[sr][0]*Er,Ci=(0===br?yr.extent[1]:2===br?yr.extent[3]:nr)+F_[sr][1]*Er;(0,Ji.Fp)((0,qr.OC)(yr.extent,si,Ci,1));const Ti=Lo(si,Ci,yr.renderData.geometryState.samplerData);Pe(yr,si,Ci,Ti)},st=(Lt,nr,sr)=>Lt.extent[0===nr||1===nr?2:0]+sr,vt=(Lt,nr,sr)=>Lt.extent[0===nr||3===nr?3:1]+sr,Ct=(Lt,nr,sr,Er)=>{const yr=st(sr,Er,F_[Lt][0]*nr),br=vt(sr,Er,F_[Lt][1]*nr);(0,Ji.Fp)((0,qr.OC)(sr.extent,yr,br,1));const Rr=Lo(yr,br,sr.renderData.geometryState.samplerData);Pe(sr,yr,br,Rr)},Wt=(Lt,nr,sr,Er,yr,br)=>{const Rr=F_[Lt][0]*nr,$r=F_[Lt][1]*nr,si=st(sr,Er,Rr),Ci=vt(sr,Er,$r),Ti=st(yr,br,Rr),ki=vt(yr,br,$r);(0,Ji.Fp)((0,qr.OC)(sr.extent,si,Ci,1)),(0,Ji.Fp)((0,qr.OC)(yr.extent,Ti,ki,1));const Fi=Lo(si,Ci,sr.renderData.geometryState.samplerData),Xi=Lo(Ti,ki,yr.renderData.geometryState.samplerData);Pe(sr,si,Ci,.5*(Fi+Xi))},Kt=Lt=>{const nr=0===Lt||1===Lt?w[2]:w[0],sr=0===Lt||3===Lt?w[3]:w[1],Er=O[Lt].cornerTiles,yr=Er.reduce((br,Rr)=>{var $r;return Math.min(br,null!=($r=null==Rr?void 0:Rr.level)?$r:1/0)},1/0);for(let br=0;br<4;++br){const Rr=Er[br];K0[br]=(null==Rr?void 0:Rr.level)===yr?Rr:null}for(let br=0;br<4;++br){const Rr=K0[(br+3)%4],$r=K0[br];if(null!=Rr&&Rr!==D&&Rr===$r){const si=Rr,ki=Math.max(si.renderData.geometryState.neighborData.edgeResolutions[(br+2)%4],2**(D.level-si.level)),Fi=(si.extent[2]-si.extent[0])/ki,Xi=(br+0)%4,rs=(br+1)%4;return Xe(nr,sr,(br+3)%4,Fi,si,br),Xe(nr,sr,Xi,Fi,si,br),Xe(nr,sr,rs,Fi,si,br),Ca}}{(0,Ji.Fp)(K0.some(Rr=>(null==Rr?void 0:Rr.isLoaded)||Rr===D));const br=K0.reduce((Rr,$r)=>$r?$r.extent[2]-$r.extent[0]:Rr,0)/K0.reduce((Rr,$r)=>{var si;return Math.max(Rr,null!=(si=null==$r?void 0:$r.renderData.geometryState.numVerticesPerSide)?si:1)},1);for(let Rr=0;Rr<4;++Rr){const $r=K0[(Rr+3)%4],si=K0[(Rr+0)%4];if(!$r&&!si)continue;const Ci=0===Rr?1:1===Rr?2:2===Rr?3:0,Ti=0===Rr?2:1===Rr?3:2===Rr?0:1;$r&&si?Wt(Rr,br,$r,Ci,si,Ti):Ct(Rr,br,null!=$r?$r:si,$r?Ci:Ti)}}return Ca};for(let Lt=0;Lt<4;++Lt){const nr=_.geometryInfo.outerEdges[Lt];nr.getVertex(Kh,1===Lt||2===Lt?0:nr.count-1),te||(0,_t.n)(H0,Kh),(0,_t.s)(Ca,0,0,0);const Er=Kt(Lt);(0,_t.n)($b[Lt],Er)}}{const Pe=(Xe,st,vt,Ct,Wt)=>{Xe.setVertexRawNormal(Wt,st,vt,Ct)},Ue=_.geometryInfo.outerEdges;for(let Xe=0;Xe<4;++Xe){const st=Ue[Xe];{const vt=$b[0===Xe?3:1===Xe?1:2];Pe(st,vt[0],vt[1],vt[2],0)}{const vt=$b[2===Xe?1:3===Xe?3:0];Pe(st,vt[0],vt[1],vt[2],st.count-1)}}}}function jp(_,v,O,D){_<D[0]?D[0]=_:_>D[3]&&(D[3]=_),v<D[1]?D[1]=v:v>D[4]&&(D[4]=v),O<D[2]?D[2]=O:O>D[5]&&(D[5]=O)}Np.updatedGeometryTiles=new Map,Np.deferTileNeighborUpdate=!1,Np.neighborTilesToUpdate=new Set;const F_=[[0,1],[1,0],[0,-1],[-1,0]],Hf=new class e5{constructor(){this.sinLonLUT=new Array(ks.HB+1),this.cosLonLUT=new Array(ks.HB+1)}update(v,O){const D=O[0],w=O[2];for(let te=0;te<=v;te++){const fe=te/v,Pe=D*(1-fe)+w*fe;this.sinLonLUT[te]=Math.sin(Pe),this.cosLonLUT[te]=Math.cos(Pe)}}},ax=(0,qr.al)(-1/0,-1/0,1/0,1/0),G0=(0,$t.c)(),Au=(0,$t.c)(),Fp=(0,$t.c)(),W_=(0,$t.c)(),V_=(0,$t.c)(),Kh=(0,$t.c)(),Zb=(0,$t.c)(),H0=(0,$t.c)(),Ca=(0,$t.c)(),z_=(0,$t.c)(),$b=[(0,$t.c)(),(0,$t.c)(),(0,$t.c)(),(0,$t.c)()],K0=[null,null,null,null];var Kf=T(57623);class j5 extends Vb{constructor(v,O,D){super(),this.horizontalScaleFactor=1,this.extentInRenderSR=(0,qr.Ue)(),void 0!==v&&this.init(v,O,D)}init(v,O,D){super.init(v,O,D);const w=D.view.renderSpatialReference,te=D.spatialReference,fe=(0,lt.pC)(w)&&(0,qs.QM)(w)&&te.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this.horizontalScaleFactor=fe;const Ue=this.extentInRenderSR,Xe=this.extent;if(this.surface.isWebMercatorOnPlateeCarree){const st=(0,$t.f)(Xe[0],Xe[1],0);(0,ci.SH)(st,Xn.Z.WebMercator,st,Xn.Z.PlateCarree);const vt=(0,$t.f)(Xe[2],Xe[3],0);(0,ci.SH)(vt,Xn.Z.WebMercator,vt,Xn.Z.PlateCarree),Ue[0]=st[0],Ue[1]=st[1],Ue[2]=vt[0],Ue[3]=vt[1]}else for(let st=0;st<4;++st)Ue[st]=Xe[st]*fe;this.centerAtSeaLevel[0]=.5*(Ue[0]+Ue[2]),this.centerAtSeaLevel[1]=.5*(Ue[1]+Ue[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(Ue[2]-Ue[0],Ue[3]-Ue[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const v=this.extentInRenderSR,O=.5*(v[2]-v[0]),D=.5*(v[3]-v[1]),w=Math.sqrt(O*O+D*D),fe=Math.max(w,.5*(this.elevationBounds[0]-this.elevationBounds[1]));this._center[Dc.MIDDLE][3]=fe}_isVisible(v){return(0,qn.fz)(v,this._aabb())}_aabb(){const v=this.extentInRenderSR;return(0,Ea.re)(v[0],v[1],this.elevationBounds[0],v[2],v[3],this.elevationBounds[1])}intersectsRay(v,O,D,w){return jv[0]=1/O[0],jv[1]=1/O[1],jv[2]=1/O[2],(0,Kf.Fw)(this._aabb(),v,jv,D,w)}createGeometry(){(function m5(_,v){const O=_.tile,D=O.extent,w=_.localOrigin,te=_.geometryState,fe=O.surface,Pe=fe.isWebMercatorOnPlateeCarree,Ue=fe.shadingEnabled,Xe=D[0],st=D[1],vt=D[2]-Xe,Ct=D[3]-st,Wt=te.clippingArea,Kt=(0,lt.pC)(Wt)?Math.max(0,(Wt[0]-D[0])/vt):0,Lt=(0,lt.pC)(Wt)?Math.max(0,(Wt[1]-D[1])/Ct):0,nr=(0,lt.pC)(Wt)?Math.min(1,(Wt[2]-D[0])/vt):1,sr=(0,lt.pC)(Wt)?Math.min(1,(Wt[3]-D[1])/Ct):1,Er=nr-Kt,yr=sr-Lt,br=Er>0?1/Er:1,Rr=yr>0?1/yr:1,$r=-Kt*br,si=-Lt*Rr,Ci=te.numVerticesPerSide,Ti=Ci-1,ki=(Ci-2)**2+te.neighborData.edgeResolutions.reduce((Is,Qs)=>Is+Qs+1,0),Fi=zP(ki),Xi=Fi.position.typedBuffer,rs=Fi.uv0.typedBuffer,Es=Fi.normal.typedBuffer,Gs=_.geometryInfo,ws=Gs.boundingBox;(0,Ea.cS)(ws);let $i=0;const qi=O.ellipsoid.radius,as=te.samplerData,bs=(0,lt.pC)(Wt)?Wt:ax,en=(0,qr.al)(Math.max(D[0],bs[0]),Math.max(D[1],bs[1]),Math.min(D[2],bs[2]),Math.min(D[3],bs[3])),Cs=w[0],xi=w[1],Qi=w[2],As=_g(Pe,qi,v);(()=>{for(let Is=1;Is<=Ti-1;Is++){const Qs=Is/Ti,Ns=si+Qs*Rr,an=(0,li.uZ)(st+Qs*Ct,en[1],en[3]),dn=(0,li.uZ)(Ns,0,1),ao=As(an)-xi,ra=vt/Ti;for(let ua=1;ua<=Ti-1;ua++){const kn=ua/Ti,Co=$r+kn*br,so=(0,li.uZ)(Xe+kn*vt,en[0],en[2]),Po=(0,li.uZ)(Co,0,1),Oa=Lo(so,an,as),Fa=so*v-Cs,Uo=Oa-Qi;jp(Fa,ao,Uo,ws);const ko=ks.Vs*$i;if(Xi[ko+0]=Fa,Xi[ko+1]=ao,Xi[ko+2]=Uo,rs[ko+0]=Po,rs[ko+1]=dn,Ue){const yh=Lo(so+ra,an,as),jd=Lo(so-ra,an,as),ju=Lo(so,an+ra,as),vh=.25*(jd-yh),Eh=.25*(Lo(so,an-ra,as)-ju),ap=ra,ff=Math.sqrt(vh*vh+Eh*Eh+ap*ap);Es[ko+0]=vh/ff,Es[ko+1]=Eh/ff,Es[ko+2]=ap/ff}++$i}}})(),Gs.numVerticesPerSide=te.numVerticesPerSide,Gs.vertexAttributes=Fi,(0,Sl.s)(_.geometryInfo.uvOffsetAndScale,Kt,Lt,nr-Kt,sr-Lt),YP(_,$i),JP(_,v),$i=ki,kP(Gs,te.numVerticesPerSide,[],[0,Ci-1],[0,Ci-1],te.wireframe),_.intersectionData=null})(this.renderData,this.horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerRowOnLevel(){return this.level<9?3:2}updateCornerElevations(){!function v5(_,v){qP(_,v),nx(_,v),Hb(_)}(this.renderData,this.horizontalScaleFactor)}updateEdgeElevations(){!function E5(_,v){JP(_,v),Hb(_)}(this.renderData,this.horizontalScaleFactor)}}const jv=(0,$t.c)();var mg;!function(_){_[_.BACK_TO_FRONT=-1]="BACK_TO_FRONT",_[_.NONE=0]="NONE",_[_.FRONT_TO_BACK=1]="FRONT_TO_BACK"}(mg||(mg={}));class F5 extends Vb{constructor(v,O,D){super(),this.obb=new Array(8);for(let w=0;w<8;w++)this.obb[w]=(0,$t.c)();void 0!==v&&this.init(v,O,D)}init(v,O,D){super.init(v,O,D);const w=this.ellipsoid.radius,te=this.extentInRadians[0],fe=this.extentInRadians[1],Pe=this.extentInRadians[2],Ue=this.extentInRadians[3],Xe=v[0],st=(0,li.t7)(fe,Ue,.5),vt=(0,li.t7)(te,Pe,.5),Ct=0===Xe?0:Math.min(Math.abs(fe),Math.abs(Ue));this._edgeLen=(Pe-te)*Math.cos(Ct)*w,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=w-Math.sqrt(w*w-this._edgeLen2/4),(0,ci.zP)(this.centerAtSeaLevel,vt,st,this.ellipsoid.radius);const Wt=(0,$t.d)(this.centerAtSeaLevel);(0,_t.n)(Wt,Wt),this.up=Wt,this._updateOBB(),this.updateRadiusAndCenter()}updateRadiusAndCenter(){if(0===this.lij[0])(0,_t.s)(this._center[ch.MIDDLE],0,0,0),(0,_t.s)(this._center[ch.TOP],0,0,0),(0,_t.s)(this._center[ch.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=(0,Zi.Iu)(this.surface.spatialReference)),this._center[ch.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const v=Math.max((0,_t.d)(this._center[ch.MIDDLE],this.obb[0]),(0,_t.d)(this._center[ch.MIDDLE],this.obb[1]));this._center[ch.MIDDLE][3]=Math.sqrt(v)}}_isVisible(v){if(!(0,qn.hr)(v,this._center[ch.MIDDLE]))return!1;if(this.lij[0]<10)return!0;const O=this.obb;for(let D=0;D<qn.tc.NUM;D++){const w=D===qn.Nu.NEAR,te=v[D];w&&(gg[0]=te[0],gg[1]=te[1],gg[2]=te[2],gg[3]=te[3]-this.surface.view.state.camera.near);const fe=w?gg:te;let Pe;for(Pe=0;Pe<8;Pe++){const Ue=O[Pe];if(fe[0]*Ue[0]+fe[1]*Ue[1]+fe[2]*Ue[2]+fe[3]<0)break}if(8===Pe)return!1}return!0}computeElevationBounds(){super.computeElevationBounds(),this._updateOBB()}createGeometry(){const v=this._getPatchType(this.lij[1],this.lij[0]);(function _5(_,v){const O=_.tile,{extent:D,extentInRadians:w,surface:te}=O,fe=_.localOrigin,Pe=_.geometryState,Ue=te.isWebMercator,Xe=te.shadingEnabled,st=Pe.numVerticesPerSide,vt=st-1,Ct=(st-2)**2,Wt=Ue&&(v===Ys.tk.HAS_SOUTH_POLE||v===Ys.tk.HAS_BOTH_POLES),Kt=Ue&&(v===Ys.tk.HAS_NORTH_POLE||v===Ys.tk.HAS_BOTH_POLES),nr=6*((Wt?1:0)+(Kt?1:0))*(vt+1),sr=Pe.neighborData,Er=sr.edgeResolutions.reduce((Cs,xi)=>Cs+xi+1,0),yr=zP(Ct+nr+Er),br=_.geometryInfo;br.numVerticesPerSide=Pe.numVerticesPerSide,br.vertexAttributes=yr,(0,Sl.s)(br.uvOffsetAndScale,0,0,1,1);const Rr=yr.position.typedBuffer,$r=yr.uv0.typedBuffer,si=yr.normal.typedBuffer,Ci=br.boundingBox;(0,Ea.cS)(Ci);const Ti=fe[0],ki=fe[1],Fi=fe[2];Hf.update(vt,w);let Xi=0;const rs=Pe.samplerData,Es=O.ellipsoid.radius,Gs=Kb(_),ws=st-2,$i=D[0],qi=D[2],as=D[1],bs=D[3];(()=>{for(let Cs=1;Cs<=ws;Cs++){const xi=Cs/vt,Qi=as*(1-xi)+bs*xi,As=Gs(xi),Is=Math.cos(As),Qs=Math.sin(As);for(let Ns=1;Ns<=ws;Ns++){const an=Ns/vt,ao=Hf.sinLonLUT[Ns],ra=Hf.cosLonLUT[Ns],ua=Es+Lo($i*(1-an)+qi*an,Qi,rs),kn=ra*Is*ua-Ti,Co=ao*Is*ua-ki,so=Qs*ua-Fi;jp(kn,Co,so,Ci);const Po=ks.Vs*Xi;Rr[Po+0]=kn,Rr[Po+1]=Co,Rr[Po+2]=so,$r[Po+0]=an,$r[Po+1]=xi,++Xi}}})(),Xe&&(()=>{const Cs=Ns=>((0,_t.b)(Fp,Ns,Zb),(0,_t.f)(W_,Fp,H0),(0,_t.f)(V_,W_,Fp),V_),xi=yr.position,Qi=yr.normal;Xi=0;const Qs=(Ns,an,dn)=>{Ns>1&&an>1&&Ns<ws&&an<ws?(Ns=>{xi.getVec(Ns,Au),(0,_t.a)(Ca,Ca,Cs(Au))})(Xi+dn):((Ns,an)=>{{const dn=Ns/vt,ao=$i*(1-dn)+qi*dn,ra=Hf.sinLonLUT[Ns],ua=Hf.cosLonLUT[Ns],kn=an/vt,Co=as*(1-kn)+bs*kn,so=Gs(kn),Po=Math.cos(so),Oa=Math.sin(so),Fa=Es+Lo(ao,Co,rs);(0,_t.s)(Au,ua*Po*Fa-Ti,ra*Po*Fa-ki,Oa*Fa-Fi)}(0,_t.a)(Ca,Ca,Cs(Au))})(Ns,an)};for(let Ns=1;Ns<=ws;Ns++)for(let an=1;an<=ws;an++)xi.getVec(Xi,Zb),(0,_t.a)(Kh,Zb,_.localOrigin),(0,_t.n)(H0,Kh),(0,_t.s)(Ca,0,0,0),Qs(an-1,Ns,-1),Qs(an+1,Ns,1),Qs(an,Ns-1,-ws),Qs(an,Ns+1,+ws),(0,_t.n)(Ca,Ca),Qi.setVec(Xi,Ca),++Xi})(),Xi=Ct,YP(_,Ct),tx(_),Xi=Ct+Er;const en=[];(()=>{const Cs=(xi,Qi)=>{const As=Qi*st;jp(-Ti,-ki,xi*Es-Fi,Ci),en.push({connectedRowOffset:As,connectedOuterEdgeOffset:1===xi?0:2,rowOffset:Xi,latitudeResolution:6});const Is=ix(-1===xi?as:bs,Es),Qs=xi*Math.PI/2-Is,Ns=.99*(1===xi?1:-1),an=Es+0;for(let dn=1;dn<=6;++dn){const ao=Is+Qs*(dn/6),ra=Math.cos(ao),ua=Math.sin(ao);for(let kn=0;kn<=vt;kn++){const Co=kn/vt,Po=Hf.cosLonLUT[kn]*ra*an-Ti,Oa=Hf.sinLonLUT[kn]*ra*an-ki,Fa=ua*an-Fi;jp(Po,Oa,Fa,Ci);const Uo=ks.Vs*Xi;if(Rr[Uo+0]=Po,Rr[Uo+1]=Oa,Rr[Uo+2]=Fa,$r[Uo+0]=Co,$r[Uo+1]=Ns,Xe){const ko=1/Math.sqrt(Po*Po+Oa*Oa+Fa*Fa);si[Uo+0]=ko*Po,si[Uo+1]=ko*Oa,si[Uo+2]=ko*Fa}++Xi}}};Wt&&Cs(-1,0),Kt&&Cs(1,vt)})(),kP(br,Pe.numVerticesPerSide,en,[0,st-1],[0,st-1],Pe.wireframe),_.intersectionData=null;for(let Cs=0;Cs<4;++Cs)(0,Ji.Fp)(br.outerEdges[Cs].count===sr.edgeResolutions[Cs]+1)})(this.renderData,v),this.setMemoryDirty()}_updateOBB(){const v=this.extentInRadians,O=this.obb;for(let D=0;D<2;D++){const w=this.elevationBounds[D];let te=4*D;(0,ci.zP)(O[te++],v[0],v[1],this.ellipsoid.radius+w),(0,ci.zP)(O[te++],v[0],v[3],this.ellipsoid.radius+w),(0,ci.zP)(O[te++],v[2],v[3],this.ellipsoid.radius+w),(0,ci.zP)(O[te++],v[2],v[1],this.ellipsoid.radius+w)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case Ys.tk.HAS_NORTH_POLE:(0,_t.s)(O[1],0,0,this.ellipsoid.radius),(0,_t.s)(O[2],0,0,this.ellipsoid.radius),(0,_t.s)(O[5],0,0,this.ellipsoid.radius),(0,_t.s)(O[6],0,0,this.ellipsoid.radius);break;case Ys.tk.HAS_SOUTH_POLE:(0,_t.s)(O[0],0,0,-this.ellipsoid.radius),(0,_t.s)(O[3],0,0,-this.ellipsoid.radius),(0,_t.s)(O[4],0,0,-this.ellipsoid.radius),(0,_t.s)(O[7],0,0,-this.ellipsoid.radius)}}_getPatchType(v,O){return v===(1<<O)-1?0===v?Ys.tk.HAS_BOTH_POLES:Ys.tk.HAS_SOUTH_POLE:0===v?Ys.tk.HAS_NORTH_POLE:Ys.tk.REGULAR}intersectsRay(v,O,D,w){const te=this._center[ch.MIDDLE],fe=te[3]+D,Ue=te[0]-v[0],Xe=te[1]-v[1],st=te[2]-v[2],vt=(Ue*O[0]+Xe*O[1]+st*O[2])/(O[0]*O[0]+O[1]*O[1]+O[2]*O[2]),Ct=O[0]*vt-Ue,Wt=O[1]*vt-Xe,Kt=O[2]*vt-st;return Ct*Ct+Wt*Wt+Kt*Kt<fe*fe}getDefaultVerticesPerRowOnLevel(){return this.level<lx.length?lx[this.level]+1:2}updateCornerElevations(){!function g5(_){var D,w;QP(_),sx(_);const v=_.vao;null==(w=null==(D=null==v?void 0:v.vertexBuffers)?void 0:D.geometry)||w.setSubData(_.geometryInfo.vertexAttributes.position.typedBuffer)}(this.renderData)}updateEdgeElevations(){!function y5(_){tx(_),Hb(_)}(this.renderData)}}const lx=[128,64,32,16,16,8,8,4],gg=(0,Io.Ue)();var ch;!function(_){_[_.TOP=0]="TOP",_[_.MIDDLE=1]="MIDDLE",_[_.BOTTOM=2]="BOTTOM"}(ch||(ch={}));var Fv=T(60479);class W5{constructor(){this.extent=(0,vi.c)(),this.minLevel=0,this.maxLevel=0,this.callback=null}}class V5{constructor(){this._queries=new Ua.Z({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new Ua.Z({initialSize:30}),this._queryPool=new lh.Z(W5)}queryVisibleLevelRange(v,O,D,w){const te=this._queryPool.acquire();(0,Sl.c)(te.extent,v),te.minLevel=O||-Number.MAX_VALUE,te.maxLevel=null!=D?D:Number.MAX_VALUE,te.callback=w,this._queryQueue.push(te)}hasPendingQueries(){return 0!==this._queryQueue.length}prepareQueries(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const v=this._queryQueue.pop();this._queries.push(v)}this._queriesInvPtr=this._queries.length}processQueries(){for(let v=0;v<this._queries.length;v++){const O=this._queries.data[v];this._queryPool.release(O),O.callback(v>=this._queriesInvPtr),O.callback=null}this._queries.clear()}scaleQueriesForTile(v){const O=v.level;let D=0;for(;D<this._queriesInvPtr;){const w=this._queries.data[D],te=w.extent;O>=w.minLevel&&O<=w.maxLevel&&te[0]<=v.extent[2]&&te[2]>=v.extent[0]&&te[1]<=v.extent[3]&&te[3]>=v.extent[1]?(this._queries.swapElements(D,this._queriesInvPtr-1),this._queriesInvPtr--):D++}}}var id=T(7699);class kb extends En.m{constructor(){super(...arguments),this.blendMode=id.iM.Normal}}(0,Ze._)([(0,En.o)({count:id.iM.COUNT})],kb.prototype,"blendMode",void 0);var z5=T(14273),Ba=T(87204);class G5 extends z5.R{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.blendMode=id.iM.Normal,this.backgroundColor=$t.Z}}class Wv extends vo.A{initializeProgram(v){const O=Wv.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.if)(Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ls.BK})}}Wv.shader=new vn.J(Ba.b,()=>T.e(7298).then(T.bind(T,7298)));class Vv extends kb{constructor(){super(...arguments),this.output=Ba.B.Composite,this.baseOpacityMode=Ba.a.One,this.premultipliedSource=!1}}(0,Ze._)([(0,En.o)({count:Ba.B.COUNT})],Vv.prototype,"output",void 0),(0,Ze._)([(0,En.o)({count:Ba.a.COUNT})],Vv.prototype,"baseOpacityMode",void 0),(0,Ze._)([(0,En.o)()],Vv.prototype,"premultipliedSource",void 0);class Yb{constructor(v,O,D,w,te,fe){this.texture=v,this.type=O,v.retain(),this.offsetAndScale=(0,vi.f)(D.offset[0],D.offset[1],D.scale,D.scale),this.opacities=(0,$t.f)(w,fe,te)}destroy(){this.texture.release()}}var G_=T(62449),Qc=T(31478),H5=T(12225),Zf=T(46342),H_=T(49966),Jb=T(75957);Math;function Xb(_,v){return v.type?(0,Oi.a)(_,v.x,v.y):(0,Oi.c)(_,v)}function Wp(_,v){const O=_.targetGeometry,D=v.targetGeometry;return O.x=D.x,O.y=D.y,O.spatialReference=D.spatialReference,_.scale=v.scale,_.rotation=v.rotation,_}const k5=function(){const _=(0,Li.a)();return function(v,O,D){const w=O.targetGeometry;Xb(_,w);const te=.5*K_(O);return v.xmin=_[0]-te*D[0],v.ymin=_[1]-te*D[1],v.xmax=_[0]+te*D[0],v.ymax=_[1]+te*D[1],v.spatialReference=w.spatialReference,v}}(),px=function(){const _=(0,Li.a)();return function(v,O,D){return(0,Oi.k)(v,function q5(_,v){return(0,Oi.f)(_,v,.5)}(v,O),function $5(_,v,O){return O?(0,Oi.a)(_,.5*(v[0]-O.right+O.left),.5*(v[1]-O.bottom+O.top)):(0,Oi.f)(_,v,.5)}(_,O,D))}}();!function(){const _=(0,Zf.c)(),v=(0,Li.a)()}();function K_(_){return _.scale*function X5(_){return(0,lt.pC)(_)&&(0,qs.JY)(_.spatialReference)?1/(39.37*function hx(_){return(0,uv.c9)(_)}(_.spatialReference)*96):1}(_.targetGeometry)}function tC(_){return(0,Iv.t)(_.rotation)||0}const rC=function(){const _=(0,Li.a)(),v=(0,Li.a)(),O=(0,Li.a)();return function(D,w,te,fe,Pe,Ue){return(0,Oi.n)(_,w),(0,Oi.f)(v,te,.5*Ue),(0,Oi.a)(O,1/fe*Ue,-1/fe*Ue),(0,Qc.a)(D,v),Pe&&(0,Qc.r)(D,D,Pe),(0,Qc.s)(D,D,O),(0,Qc.t)(D,D,_),D}}(),iC=function(){const _=(0,Li.a)();return function(v,O,D,w){const te=K_(O),fe=tC(O);return Xb(_,O.targetGeometry),rC(v,_,D,te,fe,w)}}(),e4=function(){const _=(0,Li.a)();return function(v,O,D,w){const te=K_(O);return Xb(_,O.targetGeometry),rC(v,_,D,te,0,w)}}();(0,Li.a)(),(0,Li.a)(),(0,Li.a)(),(0,Li.a)();(function(){const _=(0,Li.a)()})(),function(){const _=(0,Li.a)()}();const fx=((0,Li.a)(),(0,Li.a)(),function(){const _=(0,Zf.c)();return function(v,O,D,w){return(0,Oi.t)(v,O,function Y5(_,v,O,D){return iC(_,v,O,D),(0,Qc.b)(_,_)}(_,D,w,1))}}()),_x=function(){const _=(0,Zf.c)();return function(v,O,D,w){return(0,Oi.t)(v,O,iC(_,D,w,1))}}(),sC=function(){const _=(0,Li.a)(),v=(0,Zf.c)();return function(O,D,w){Wp(O,D);const te=K_(D),fe=O.targetGeometry;return(0,Qc.c)(v,tC(D)),(0,Qc.s)(v,v,(0,Li.f)(te,te)),(0,Oi.t)(_,w,v),fe.x+=_[0],fe.y+=_[1],O}}();var nC;const Vp=[0,0];let Z0=nC=class extends xn.wq{constructor(_){super(_),this._viewpoint2D={center:(0,Li.a)(),rotation:0,scale:0,spatialReference:null},this.center=[0,0],this.extent=new To.Z,this.id=0,this.inverseTransform=(0,Zf.c)(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=(0,Zf.c)(),this.transformNoRotation=(0,Zf.c)(),this.displayMat3=(0,H_.c)(),this.displayViewMat3=(0,H_.c)(),this.viewMat3=(0,H_.c)(),this.viewMat2d=(0,H5.c)(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(_){this._set("pixelRatio",_),this._update()}set size(_){this._set("size",_),this._update()}set viewpoint(_){if(_){const v=this._viewpoint2D,O=_.targetGeometry;v.center[0]=O.x,v.center[1]=O.y,v.rotation=_.rotation,v.scale=_.scale,v.spatialReference=O.spatialReference}this._update()}copy(_){const v=this.size,O=this.viewpoint;return O&&v?(this.viewpoint=Wp(O,_.viewpoint),this._set("size",(0,Oi.c)(v,_.size))):(this.viewpoint=_.viewpoint.clone(),this._set("size",[_.size[0],_.size[1]])),this._set("pixelRatio",_.pixelRatio),this}clone(){return new nC({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(_,v,O){return(0,Jb.lM)(v)?(0,Oi.t)(_,v,this.inverseTransform):(Vp[0]=v,Vp[1]=O,(0,Oi.t)(_,Vp,this.inverseTransform))}toScreen(_,v,O){return(0,Jb.lM)(v)?(0,Oi.t)(_,v,this.transform):(Vp[0]=v,Vp[1]=O,(0,Oi.t)(_,Vp,this.transform))}toScreenNoRotation(_,v,O){return(0,Jb.lM)(v)?(0,Oi.t)(_,v,this.transformNoRotation):(Vp[0]=v,Vp[1]=O,(0,Oi.t)(_,Vp,this.transformNoRotation))}getScreenTransform(_,v){const{center:O}=this._viewpoint2D,D=this._get("pixelRatio")||1,w=this._get("size");return rC(_,O,w,v,0,D),_}_update(){const{center:_,spatialReference:v,scale:O,rotation:D}=this._viewpoint2D,w=this._get("pixelRatio")||1,te=this._get("size"),fe=new Ra({targetGeometry:new vs.Z(_[0],_[1],v),scale:O,rotation:D});if(this._set("viewpoint",fe),!te||!v||!O)return;this.resolution=K_(fe),this.rotation=D,this.scale=O,this.spatialReference=v,(0,Oi.c)(this.center,_),(0,Aa.s)(this.displayMat3,0!==te[0]?2/te[0]:0,0,0,0,0!==te[1]?-2/te[1]:0,0,-1,1,1);const Xe=(0,Aa.b)(this.viewMat3),st=(0,c_.f)(te[0]/2,te[1]/2),vt=(0,c_.f)(-te[0]/2,-te[1]/2),Ct=(0,Iv.t)(D);(0,Aa.c)(Xe,Xe,st),(0,Aa.r)(Xe,Xe,Ct),(0,Aa.c)(Xe,Xe,vt),(0,Aa.m)(this.displayViewMat3,this.displayMat3,Xe);const Wt=(0,Qc.a)(this.viewMat2d,st);return(0,Qc.r)(Wt,Wt,Ct),(0,Qc.t)(Wt,Wt,vt),k5(this.extent,fe,te),iC(this.transform,fe,te,w),(0,Qc.b)(this.inverseTransform,this.transform),e4(this.transformNoRotation,fe,te,w),this.worldScreenWidth=function r4(_,v){return Math.round(function t4(_){const v=(0,qs.C5)(_);return v?v.valid[1]-v.valid[0]:0}(_)/v)}(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Z0.prototype,"id",void 0),(0,Ze._)([(0,nt.Cb)({value:1,json:{write:!0}})],Z0.prototype,"pixelRatio",null),(0,Ze._)([(0,nt.Cb)({json:{write:!0}})],Z0.prototype,"size",null),(0,Ze._)([(0,nt.Cb)()],Z0.prototype,"spatialReference",void 0),(0,Ze._)([(0,nt.Cb)({type:Ra,json:{write:!0}})],Z0.prototype,"viewpoint",null),Z0=nC=(0,Ze._)([(0,ui.j)("esri.views.2d.ViewState")],Z0);const o4=Z0;class l4{constructor(){this._renderParams={context:null,drawPhase:1,state:new o4({viewpoint:new Ra({targetGeometry:new vs.Z(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}dispose(){this._renderParams=null}render(v,O,D,w,te,fe,Pe,Ue,Xe,st){const vt=fe.adjustLevel(O[0]),Ct=this._renderParams;Ct.context=v,Ct.painter=w,Ct.glyphMosaic=w.glyphMosaic,Ct.spriteMosaic=w.spriteMosaic,Ct.pixelRatio=st,Ct.displayLevel=vt,Ct.requiredLevel=vt;const Wt=fe.getScale(O[0]),[Kt,Lt]=fe.getShift(O,Pe*Wt),nr=.125*Pe*Wt/Xe,sr=D.transforms.dvs;sr[0]=nr,sr[4]=-nr,sr[6]=-1-Kt-Ue[0]*Pe*2,sr[7]=1+Lt+(1-Ue[1])*Pe*2-2,Ct.state.size[0]=Xe,Ct.state.size[1]=Xe,D.stage||D.attachWithContext(v),D.triangleCount=0,w.drawTile(Ct,D,te)}}var c4=T(44796),uh=T(87633);class Gv extends vo.A{initializeProgram(v){const O=Gv.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.if)(Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ls.BK})}}Gv.shader=new vn.J(c4.R,()=>T.e(9903).then(T.bind(T,89903)));class Z_ extends kb{constructor(){super(...arguments),this.colorizerType=G_.U.Stretch,this.stretchType=G_.H.Noop,this.tileBlendInput=uh.R.LayerOnly,this.baseOpacityMode=Ba.a.One,this.applyColormap=!0}}(0,Ze._)([(0,En.o)({count:G_.U.COUNT})],Z_.prototype,"colorizerType",void 0),(0,Ze._)([(0,En.o)({count:G_.H.COUNT})],Z_.prototype,"stretchType",void 0),(0,Ze._)([(0,En.o)({count:uh.R.COUNT})],Z_.prototype,"tileBlendInput",void 0),(0,Ze._)([(0,En.o)({count:Ba.a.COUNT})],Z_.prototype,"baseOpacityMode",void 0),(0,Ze._)([(0,En.o)()],Z_.prototype,"applyColormap",void 0);class mx{constructor(v){this._rctx=v,this._pools=new Map}acquire(v){return this._getPool(v).acquire()}clear(){this._pools.forEach(v=>v.destroy()),this._pools.clear()}_getPool(v){let O=this._pools.get(v);if(!O){const D=gx.bind(gx,this._rctx,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.DEPTH_RENDER_BUFFER,width:v,height:v},w=>this._getPool(w.width).release(w));O=new lh.Z(D,null,()=>{}),this._pools.set(v,O)}return O}}class gx extends pc.X{constructor(v,O,D){super(v,O),this.release=()=>D(this)}}const u4=pn.Z.getLogger("esri.views.3d.terrain");class d4{constructor(v,O){this._rctx=v,this._techniqueRepository=O,this._fboPools=[],this._doubleBufferFbo=[],this._vectorTileHelper=new l4,this._bindParameters=new JE.p(null,null,null),this._blendLayersTechniqueConfig=new Vv,this._poolToWrite=0,this._vaoQuad=(0,$a.ow)(this._rctx,Lh.Bn),this._fboPools.push(new mx(this._rctx)),this._fboPools.push(new mx(this._rctx))}dispose(){this._fboPools.forEach(v=>{v.clear(),v=null}),this._fboPools=null,this._doubleBufferFbo.forEach(v=>(0,lt.O3)(v)),this._vaoQuad=(0,lt.O3)(this._vaoQuad),this._vectorTileHelper=(0,lt.O3)(this._vectorTileHelper),this._backgroundTechnique=(0,lt.RY)(this._backgroundTechnique),this._applyOpacityTechnique=(0,lt.RY)(this._applyOpacityTechnique),this._blendLayersTechnique=(0,lt.RY)(this._blendLayersTechnique)}_getBlendLayersTechnique(v,O,D,w=!1){return this._blendLayersTechniqueConfig.output=O,this._blendLayersTechniqueConfig.blendMode=v,this._blendLayersTechniqueConfig.baseOpacityMode=D?O===Ba.B.Composite?Ba.a.OnBaseLayer:Ba.a.OnBackground:Ba.a.One,this._blendLayersTechniqueConfig.premultipliedSource=w,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(Wv,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(v,O){const D=this._getBlendLayersTechnique(id.iM.Normal,O,!1),w=this._rctx.bindTechnique(D,v,this._bindParameters);this._render(w)}_render(v){this._rctx.bindVAO(this._vaoQuad),v.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Jt.MX.TRIANGLE_STRIP,0,(0,_l._V)(this._vaoQuad,"geometry"))}drawRasterData(v,O,D=!1){if((0,lt.Wi)(O.texture))return;const w=O.baseOpacity<1;O.blendMode!==id.iM.Normal||w||D?(O.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):O.fboTexture=null;const te=this._getBlendLayersTechnique(O.blendMode,v,w,D),fe=this._rctx.bindTechnique(te,O,this._bindParameters);this._render(fe)}drawImageryTileData(v,O,D){const w=v.sourceLayerInfo.data;if(!w.source)return;v.tile.surface.layerViewByIndex(v.layerIndex,An.MAP).ensureSymbolizerParameters(w);const te=D.baseOpacity<1;D.blendMode!==id.iM.Normal||te?(D.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):D.fboTexture=null;const fe=this._getRasterColorizerTechnique(w,O,D.blendMode,te),Pe=this._rctx.bindTechnique(fe);if(!w.bind(this._rctx))return;w.opacity=D.opacity;const Ue=w.getUniforms();Ue.scale=v.scale,Ue.offset=v.offset,Ue.backgroundColor=D.backgroundColor,Ue.fboTexture=D.fboTexture,Ue.baseOpacity=D.baseOpacity,fe.bindPass(Ue,null),this._render(Pe)}_getRasterColorizerTechnique(v,O,D,w){const te=v.symbolizerParameters,fe=["stretch","lut","hillshade"].indexOf(te.type);return(0,lt.Wi)(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new Z_,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.tileBlendInput=O===Ba.B.ColorComposite?uh.R.ColorComposite:O===Ba.B.GridComposite?uh.R.GridComposite:uh.R.LayerOnly,this._rasterColorizerConfig.blendMode=D,this._rasterColorizerConfig.baseOpacityMode=w?O===Ba.B.Composite?Ba.a.OnBaseLayer:Ba.a.OnBackground:Ba.a.One,this._rasterColorizerConfig.colorizerType=fe,this._rasterColorizerConfig.applyColormap=!!te.colormap,this._rasterColorizerConfig.stretchType=v.hasStretchTypeNone()?G_.H.Noop:G_.H.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(Gv,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(v,O,D,w,te,fe,Pe){const Ue=this._rctx,Xe=O.sourceLayerInfo.data,st=O.tile.surface.layerViewByIndex(O.layerIndex,An.MAP),vt=v.baseOpacity<1||v.opacity<1||v.blendMode!==id.iM.Normal||Pe!==Ba.B.Composite;let Ct;this._getBlendLayersTechnique(v.blendMode,Pe,v.baseOpacity<1,vt).bindPipelineState(Ue),vt?(Ct=this._acquire(te),Ue.bindFramebuffer(Ct),Ue.setClearColor(0,0,0,0),Ue.clearSafe(Jt.lk.COLOR_BUFFER_BIT|Jt.lk.DEPTH_BUFFER_BIT)):fe&&Ue.clearSafe(Jt.lk.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(Ue,O.sourceLod,Xe,st.painter,st.layer.styleRepository,st.schemaHelper,Math.round(1/O.scale),O.offset,w,D)}catch(Wt){u4.warnOnce("A render call containing vector tiles did not resolve correctly.",Wt)}return!(0,lt.pC)(Ct)||(Ue.bindFramebuffer(this._currentFBO),v.texture=Ct.colorTexture,v.offset=Li.Z,v.scale=1,this.drawRasterData(Pe,v,vt),Ct.release(),fe)}copyFBOToTexture(v){const O=this._rctx,D=O.bindTexture(v.texture,ka.x.TEXTURE_UNIT_FOR_UPDATES),w=v.descriptor;O.gl.copyTexImage2D(Jt.No.TEXTURE_2D,0,w.pixelFormat,0,0,w.width,w.height,0),v.generateMipmap(),O.bindTexture(D,ka.x.TEXTURE_UNIT_FOR_UPDATES)}_initFBO(v,O){this._rctx.bindFramebuffer(v),this._rctx.setViewport(0,0,O,O),this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Jt.lk.COLOR_BUFFER_BIT|Jt.lk.DEPTH_BUFFER_BIT)}_acquire(v){return this._fboPools[this._poolToWrite].acquire(v)}bindPool(v,O){this._poolToWrite=v,null==this._doubleBufferFbo[v]&&(this._doubleBufferFbo[v]=this._acquire(O),this._initFBO(this._doubleBufferFbo[v],O))}_switchPool(v){this._releaseCurrentFBO(),this._doubleBufferFbo[this._poolToWrite]=null,this._poolToWrite=0===this._poolToWrite?1:0,this.bindPool(this._poolToWrite,v)}get _currentFBO(){return this._doubleBufferFbo[this._poolToWrite]}_releaseCurrentFBO(){this._doubleBufferFbo[this._poolToWrite].release(),this._doubleBufferFbo[this._poolToWrite]=null}releasePool(){this._rctx.bindFramebuffer(null),this._releaseCurrentFBO()}cleanupFBOPool(v,O){v===this._lastPixelRatio&&O===this._lastNumLayers||(this._fboPools.forEach(D=>D.clear()),this._lastPixelRatio=v,this._lastNumLayers=O)}}class h4{constructor(v,O,D){this._rctx=v,this.tileSize=O,this._techniqueRepository=D,this._passParameters=new G5,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._numTexturedLayer=0,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new d4(this._rctx,this._techniqueRepository),this._blackTex=new N_((0,$a.YO)(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=(0,lt.O3)(this._composition),this._backgroundTexture=(0,lt.RY)(this._backgroundTexture),this._blackTex=(0,lt.RY)(this._blackTex)}get backgroundIsGrid(){return(0,lt.Wi)(this._backgroundColor)}get backgroundColor(){return this._backgroundColor}updateTileTexture(v,O){if(!v.renderData)return;const D=v.surface,w=D.baseOpacity;this._numTexturedLayer=0;let te=0,fe=this.tileSize,Pe=!1;const Ue=D.view.state.pixelRatio;let Xe=!1;const st=v.layerInfo[An.MAP];let vt=st.length,Ct=0;for(;Ct<st.length;Ct++){const Lt=D.layerViewByIndex(Ct,An.MAP),nr=Lt.fullOpacity;if(aC[Ct]=nr,(0,Ws.sy)(Lt.layer)&&vt>=st.length&&(vt=Ct),0===nr){st[Ct].pendingUpdates&=~(zs.TEXTURE_NOFADING&zs.TEXTURE_FADING);continue}++te;const sr=oC(v,Ct);if(sr){if(st[Ct].pendingUpdates&=~(zs.TEXTURE_NOFADING&zs.TEXTURE_FADING),(0,Ji.TK)(Lt)){const Er=(0,Ji.CY)(Lt.layer.parent)?"normal":Lt.layer.blendMode;yx[Ct]=Er;const yr="normal"!==Er;yr&&(Xe=yr,Pe=!1)}(0,Ji.Q)(Lt)?fe=Math.max(fe,this.tileSize*Ue):1===w&&1===nr&&(Lt.isOpaque||this._dataToTexture(sr)&&sr.sourceLayerInfo.data.descriptor.isOpaque)&&(Pe=!0),++this._numTexturedLayer}}this._composition.cleanupFBOPool(Ue,st.length),fe=function p4(_){const v=(0,li.Sf)(_),O=v*v,D=_*_;if(O===D)return _;const w=v/2;return O-D<D-w*w?v:w}(fe);const Wt=fe/this.tileSize,Kt=Ct-1;this._ensureBackgroundTexture(this.tileSize),0!==this._numTexturedLayer?1===this._numTexturedLayer&&!Xe&&this._useLayerTexture(v,Kt,vt,aC[Kt])||this._composeMapLayers(v,O,Kt,vt,aC,yx,fe,Wt,!Pe||Xe):this._useBackgroundTexture(v,te)}_ensureBackgroundTexture(v){(0,lt.Wi)(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(v),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bindPool(0,v),this._passParameters.offset=Li.Z,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=id.iM.Normal,(0,lt.pC)(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,(0,lt.pC)(this.backgroundColor)?Ba.B.ColorOnly:Ba.B.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=!1)}_useBackgroundTexture(v,O){let D=Up.Immediate;(v.surface.view.layerViewManager.updating||O>0)&&(D=Up.Delayed),this._backgroundTexture&&(0,lt.Wi)(v.renderData.textureReference)&&(D=Up.Immediate),v.renderData.setTextureReference((0,lt.pC)(this._backgroundTexture)?new Yb(this._backgroundTexture,Ys.Ns.FADING,vx,v.surface.baseOpacity,1,0):null,D)}_useLayerTexture(v,O,D,w){const te=O<D,fe=te?1:v.surface.baseOpacity,Pe=te?v.surface.baseOpacity:1,Ue=oC(v,O);return!!this._dataToTexture(Ue)&&(v.renderData.setTextureReference(new Yb(Ue.sourceLayerInfo.data,Ys.Ns.FADING,Ue,fe,w,Pe)),!0)}_composeMapLayers(v,O,D,w,te,fe,Pe,Ue,Xe){this._composition.bindPool(0,Pe);const st=v.surface.baseOpacity;let vt=!1,Ct=Jt.cw.LINEAR_MIPMAP_LINEAR,Wt=!1,Kt=0;for(let nr=D;nr>=0;nr--){const sr=oC(v,nr);if(!sr||0===te[nr])continue;const Er=nr<w&&st<1&&!vt;this._passParameters.baseOpacity=Er?st:1,Er&&(vt=!0);const yr=0===Kt,br=Xe&&yr?this.backgroundIsGrid?Ba.B.GridComposite:Ba.B.ColorComposite:Ba.B.Composite;(0,Ji.Ke)(sr)?(this._passParameters.opacity=te[nr],this._passParameters.blendMode=id.pU[fe[nr]],Wt=this._composition.drawVectorData(this._passParameters,sr,Ue,this.tileSize,Pe,Wt,br)):(0,Ji.Ay)(sr)?(this._passParameters.opacity=te[nr],this._passParameters.blendMode=id.pU[fe[nr]],this._composition.drawImageryTileData(sr,br,this._passParameters),this._hasNearestInterpolation(sr)&&(Ct=Jt.cw.NEAREST)):this._dataToTexture(sr)&&(this._passParameters.texture=sr.sourceLayerInfo.data.texture,this._passParameters.offset=sr.offset,this._passParameters.scale=sr.scale,this._passParameters.opacity=te[nr],this._passParameters.blendMode=id.pU[fe[nr]],this._composition.drawRasterData(br,this._passParameters)),Kt++}const Lt=v.renderData.ensureTexture(Pe,()=>this._buildTexture(Pe,Ct));this._composition.copyFBOToTexture(Lt),this._composition.releasePool(),v.renderData.setTextureReference(new Yb(Lt,O,vx,vt?1:st,1,0))}_hasNearestInterpolation(v){const O=v.sourceLayerInfo.data;return!!O.source&&"nearest"===O.interpolation}_dataToTexture(v){return(0,Ji.L4)(v)&&this._rasterDataToTexture(v),(0,Ji.z7)(v)}_rasterDataToTexture(v){const O=v.sourceLayerInfo;O.data=this._buildTexture(O.data),v.tile.setMemoryDirty()}setBackground(v){this._backgroundColor!==v&&(this._backgroundColor=v,this._backgroundDirty=!0)}_buildTexture(v,O=Jt.cw.LINEAR_MIPMAP_LINEAR){if((0,lt.Wi)(v))return null;const D={target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:O,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},w=this._rctx;let te;if("number"==typeof v)D.width=D.height=v,te=new N_(new ka.x(w,D));else if(v instanceof Sb.nN)D.isOpaque=v.isOpaque,te=new N_(new ka.x(w,D,v.image)),v.release();else try{te=new N_(new ka.x(w,D,v))}catch(Pe){te=new N_((0,$a.l_)(w)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const fe=w.bindTexture(te.texture,ka.x.TEXTURE_UNIT_FOR_UPDATES);return te.generateMipmap(),w.bindTexture(fe,ka.x.TEXTURE_UNIT_FOR_UPDATES),te}get test(){return{backgroundTexture:this._backgroundTexture}}}function oC(_,v){sd.layerIndex=v;const O=_.layerInfo[An.MAP][v];if((0,lt.pC)(O.data))return(0,Oi.a)(sd.offset,0,0),sd.tile=_,sd.scale=1,sd.sourceLod=_.lij,sd.sourceLayerInfo=O,sd;const D=O.upsampleInfo;if((0,lt.pC)(D)){const w=D.tile.layerInfo[An.MAP][v];return sd.tile=D.tile,(0,Oi.c)(sd.offset,D.offset),sd.scale=D.scale,sd.sourceLod=D.tile.lij,sd.sourceLayerInfo=w,sd}return null}const aC=new Array,yx=new Array,sd={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},vx={offset:[0,0],scale:1},vg=1e-6;class bx{constructor(v,O,D,w,te){this.aabb=v,this.axis=O,this.d=D,this.midStartIndex=w,this.rightStartIndex=te}}let Cx=(()=>{class _{constructor(O,D,w,te){this.globalTriangleVertexIndices=O,this.firstTriangleIndex=D,this.positionAttribute=te,this.rayDirection=(0,$t.c)(),this.bspNodeTree=new Array,this.vertexPositionBuffer=te.data,this.vertexPositionStride=te.stride;const fe=w-D,Pe=fe<=Tx?new Uint16Array(fe):new Uint32Array(fe);this.indices=Pe;for(let Ue=0;Ue<fe;++Ue)Pe[Ue]=Ue;{const Ue=function b4(_,v,O,D,w){const te=O-v,fe=new Float32Array(6*te);for(let Pe=0;Pe<te;++Pe){const Ue=3*(Pe+v),Xe=_[Ue+0]*w,st=_[Ue+1]*w,vt=_[Ue+2]*w;for(let Ct=0;Ct<3;++Ct){const Wt=D[Xe+Ct],Kt=D[st+Ct],Lt=D[vt+Ct];fe[6*Pe+Ct]=Math.min(Wt,Kt,Lt),fe[6*Pe+3+Ct]=Math.max(Wt,Kt,Lt)}}return fe}(O,D,w,te.data,te.stride),Xe=(0,li.uZ)(Math.log2(fe/40),2,10),st=(vt,Ct,Wt)=>{const Kt=function v4(_,v,O,D){if(D<=O)return(0,Ea.al)(NaN,NaN,NaN,NaN,NaN,NaN);{const w=6*_[O];for(let te=0;te<3;++te)$_[te]=v[w+0+te],k_[te]=v[w+3+te]}for(let w=O+1;w<D;++w){const te=6*_[w];for(let fe=0;fe<3;++fe)$_[fe]=Math.min($_[fe],v[te+0+fe]),k_[fe]=Math.max(k_[fe],v[te+3+fe])}return(0,Ea.al)($_[0],$_[1],$_[2],k_[0],k_[1],k_[2])}(Pe,Ue,vt,Ct),Lt=Ct-vt;if(Lt<=40){const Rr=new bx(Kt,void 0,0,vt,Ct);return this.bspNodeTree.push(Rr),Rr}const{axis:nr,midValue:sr}=function E4(_){const v=_[3]-_[0],O=_[4]-_[1],D=_[5]-_[2],w=v>O?v>D?0:O>D?1:2:O>D?1:D>v?2:0;return{axis:w,midValue:(_[w]+_[w+3])/2}}(Kt),Er=function y4(_,v,O,D,w,te){let fe=O,Pe=D;for(;fe<Pe;){const Xe=_[fe];v[6*Xe+w+3]<=te?++fe:(--Pe,_[fe]=_[Pe],_[Pe]=Xe)}let Ue=fe;for(Pe=D;Ue<Pe;){const Xe=_[Pe-1];v[6*Xe+w]>=te?--Pe:(_[Pe-1]=_[Ue],_[Ue]=Xe,++Ue)}return{next:fe,mid:Ue}}(Pe,Ue,vt,Ct,nr,sr),yr=(Rr,$r)=>{if(Wt>Xe)return;const si=$r-Rr;return si<40||si>=.8*Lt?void 0:st(Rr,$r,Wt+1)},br=new bx(Kt,nr,sr,Er.next,Er.mid);return this.bspNodeTree.push(br),br.leftNode=yr(vt,Er.next),br.rightNode=yr(Er.mid,Ct),br};st(0,fe,0),this.triangleVertexIndices=function C4(_,v,O,D){const w=D-O;let te=0;for(let Pe=O;Pe<D;++Pe)for(let Ue=0;Ue<3;++Ue)te=Math.max(v[3*Pe+Ue],te);const fe=te<=Tx?new Uint16Array(3*w):new Uint32Array(3*w);for(let Pe=0;Pe<w;++Pe){const Ue=3*(_[Pe]+O);for(let Xe=0;Xe<3;++Xe)fe[3*Pe+Xe]=v[Ue+Xe]}return fe}(Pe,O,D,w)}}intersectRayTriangleRange(O,D){{if(O>=D)return;const w=this.triangleVertexIndices,te=this.positionAttribute.data,fe=this.positionAttribute.stride,Pe=this.rayOrigin,Ue=Pe[0],Xe=Pe[1],st=Pe[2],vt=this.rayDirection,Ct=vt[0],Wt=vt[1],Kt=vt[2];for(let Lt=O,nr=3*O;Lt<D;++Lt){const sr=w[nr]*fe,Er=te[sr],yr=te[sr+1],br=te[sr+2],Rr=w[nr+1]*fe,Ti=w[nr+2]*fe;nr+=3;const rs=te[Rr]-Er,Es=te[Rr+1]-yr,Gs=te[Rr+2]-br,ws=te[Ti]-Er,$i=te[Ti+1]-yr,qi=te[Ti+2]-br,as=Wt*qi-$i*Kt,bs=Kt*ws-qi*Ct,en=Ct*$i-ws*Wt,Cs=rs*as+Es*bs+Gs*en;if(Math.abs(Cs)<=Number.EPSILON)continue;const xi=Ue-Er,Qi=Xe-yr,As=st-br,Is=xi*as+Qi*bs+As*en;if(Cs>0){if(Is<0||Is>Cs)continue}else if(Is>0||Is<Cs)continue;const Qs=Qi*Gs-Es*As,Ns=As*rs-Gs*xi,an=xi*Es-rs*Qi,dn=Ct*Qs+Wt*Ns+Kt*an;if(Cs>0){if(dn<0||Is+dn>Cs)continue}else if(dn>0||Is+dn<Cs)continue;const ao=(ws*Qs+$i*Ns+qi*an)/Cs;if(ao>=0){const ra=this.indices[Lt]+this.firstTriangleIndex,ua=(0,Kf.Mw)(rs,Es,Gs,ws,$i,qi,g4);this.callback(ao,ua,ra,!1)}}}_.numFacesTested+=D-O}intersectRay(O,D){_.numFacesTested=0;const w=(0,$t.f)(O.r0[0],O.r0[1],O.r0[2]),te=(0,$t.f)(O.r1[0],O.r1[1],O.r1[2]),fe=te[0]-w[0],Pe=te[1]-w[1],Ue=te[2]-w[2];if(fe*fe+Pe*Pe+Ue*Ue<vg)return;this.rayOrigin=w;const Xe=this.rayDirection;Xe[0]=fe,Xe[1]=Pe,Xe[2]=Ue;const st=this.triangleVertexIndices.length/3;this.callback=D,this.intersectRayBSP(this.bspNodeTree[0],0,st)}intersectRayBSP(O,D,w){const te=this.rayOrigin,fe=this.rayDirection;if(!function m4(_,v,O){const D=v,w=O;let te=0,fe=1/0;for(let Pe=0;Pe<3;++Pe){{const Ue=_[Pe];if(D[Pe]<Ue){if(w[Pe]<=vg)return!1;te=Math.max(te,(Ue-D[Pe])/w[Pe])}else w[Pe]<=-vg&&(fe=Math.min(fe,(Ue-D[Pe])/w[Pe]));if(te>fe)return!1}{const Ue=_[Pe+3];if(D[Pe]>Ue){if(w[Pe]>=-vg)return!1;te=Math.max(te,(Ue-D[Pe])/w[Pe])}else w[Pe]>=vg&&(fe=Math.min(fe,(Ue-D[Pe])/w[Pe]));if(te>fe)return!1}}return!0}(O.aabb,te,fe))return;const Pe=O.axis,Ue=O.d;if(te[Pe]<Ue||fe[Pe]<0){const Xe=D,st=O.midStartIndex;if(Xe<st){const vt=O.leftNode;void 0!==vt?this.intersectRayBSP(vt,Xe,st):this.intersectRayTriangleRange(Xe,st)}}if(this.intersectRayTriangleRange(O.midStartIndex,O.rightStartIndex),te[Pe]>Ue||fe[Pe]>0){const Xe=O.rightStartIndex,st=w;if(Xe<st){const vt=O.rightNode;void 0!==vt?this.intersectRayBSP(vt,Xe,st):this.intersectRayTriangleRange(Xe,st)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}return _.numFacesTested=0,_})();const g4=(0,$t.c)(),$_=[1/0,1/0,1/0],k_=[-1/0,-1/0,-1/0],Tx=65535;var Ac=T(6945),Eg=T(30249),Mx=T(73693),Su=T(40723),Ox=T(7949),Hv=T(64127);class Kv extends vo.A{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(v,O){O.spherical=v.viewingMode===Us.JY.Global}initializeProgram(v){const O=Kv.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(v){const O=this.configuration,D=O.backfaceCullingEnabled&&!O.renderOccluded;return(0,ls.sm)({blending:O.renderOccluded?(0,ls.if)(Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA):null,culling:D&&ls.Rd,depthTest:!O.renderOccluded&&{func:Jt.wb.LESS},depthWrite:!O.renderOccluded&&ls.LZ,colorWrite:ls.BK,stencilTest:v?(0,Hv.iV)(Fs.hU.IntegratedMeshMaskExcluded):null})}getPipelineState(v,O){return this.useStencil?this._stencilPipelineState:super.getPipelineState(v,O)}}Kv.shader=new vn.J(Mx.a,()=>T.e(3277).then(T.bind(T,13277)));var bg=T(92724),Px=T(41528);class Na extends Px.W{constructor(){super(...arguments),this.output=Ac.H.Color,this.overlayMode=Eg.gT.Disabled,this.tileBlendInput=uh.R.LayerOnly,this.spherical=!1,this.atmosphere=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.stencilEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.tileBorders=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.shading=(0,Jo.Z)("enable-feature:terrain-shading")}}(0,Ze._)([(0,En.o)({count:Ac.H.COUNT})],Na.prototype,"output",void 0),(0,Ze._)([(0,En.o)({count:Eg.gT.COUNT})],Na.prototype,"overlayMode",void 0),(0,Ze._)([(0,En.o)({count:uh.R.COUNT})],Na.prototype,"tileBlendInput",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"spherical",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"atmosphere",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"receiveShadows",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"hasSlicePlane",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"backfaceCullingEnabled",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"stencilEnabled",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"textureFadingEnabled",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"renderOccluded",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"hasScreenSpaceReflections",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"hasCloudsReflections",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"tileBorders",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"screenSizePerspective",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"receiveAmbientOcclusion",void 0),(0,Ze._)([(0,En.o)()],Na.prototype,"shading",void 0),(0,Ze._)([(0,En.o)({constValue:!0})],Na.prototype,"isGround",void 0),(0,Ze._)([(0,En.o)({constValue:bg.f7.Disabled})],Na.prototype,"pbrMode",void 0),(0,Ze._)([(0,En.o)({constValue:!1})],Na.prototype,"highStepCount",void 0),(0,Ze._)([(0,En.o)({constValue:!1})],Na.prototype,"useCustomDTRExponentForWater",void 0),(0,Ze._)([(0,En.o)({constValue:!1})],Na.prototype,"useFillLights",void 0);const uC=(0,Ea.Ue)(),Zv=(0,vi.c)();let nd=class extends Bi.Z{constructor(_){super(_),this.type=Ll.q7.TERRAIN,this.isGround=!0,this.tileSize=256,this._techniqueConfiguration=new Na,this._passParameters=new Mx.T,this.rctx=null,this._isTransparent=!1,this._scaleRangeQueries=new V5,this.renderDataPool=new lh.Z(Np),this._patchGroups=new Map,this.patchGroupsDirty=!0,this.tileIterator=new xu.AA,this.highestVisibleLODTile=null,this.visible=!0,this._opaque=!0,this._velvetOverground=!0,this._castShadows=!0,this.emptyTex=null,this.tileRenderer=null,this.stencilEnabledLayerExtents=[],this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=Su.yD.Occlude}get isGlobal(){return this.stage.viewingMode===Us.JY.Global}get shadingEnabled(){var _;return null==(_=this._techniqueConfiguration)?void 0:_.shading}initialize(){this.stage.addRenderPlugin([fn.r.OPAQUE_TERRAIN,fn.r.TRANSPARENT_TERRAIN,fn.r.OCCLUDED_TERRAIN],this)}destroy(){this.stage.removeRenderPlugin(this),function QU(){Nb.clear()}()}get canRender(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(_){this._set("renderingDisabled",!!_),this.setNeedsRender()}set opaque(_){this._opaque!==_&&(this._opaque=_,this.setNeedsRender())}get opaque(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane}get needsLinearDepth(){return this.overlayRenderer.hasWater}set isTransparent(_){this._isTransparent!==_&&(this._isTransparent=_,this.setNeedsRender())}get isTransparent(){return this._isTransparent}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(_){this._techniqueConfiguration.tileBorders!==_&&(this._techniqueConfiguration.tileBorders=_,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(_){this._techniqueConfiguration.backfaceCullingEnabled!==_&&(this._techniqueConfiguration.backfaceCullingEnabled=_,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(_){this._set("renderOrder",_),this.setNeedsRender()}set velvetOverground(_){this._velvetOverground!==_&&(this._velvetOverground=_,this.setNeedsRender())}get layerUid(){return Qu.cy}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(_){this._techniqueConfiguration.hasSlicePlane!==_&&(this._techniqueConfiguration.hasSlicePlane=_,this.setNeedsRender())}set textureFadingEnabled(_){this._techniqueConfiguration.textureFadingEnabled!==_&&(this._techniqueConfiguration.textureFadingEnabled=_,this.setNeedsRender())}setDebugScreenSizePerspective(_){this._techniqueConfiguration.screenSizePerspective!==_&&(this._techniqueConfiguration.screenSizePerspective=_,this.setNeedsRender())}toggleShading(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading,this.setNeedsRender()}setRootTiles(_){this._rootTiles=_,this.setNeedsRender()}setNeedsHighlight(_){this.needsHighlight=_,this.setNeedsRender()}setRenderOccludedOverlay(_){this.renderOccludedFlags=_?Bb.Qi:Su.yD.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(_){this.stencilEnabledLayerExtents=_,this.setNeedsRender()}setTileSize(_){this.tileSize=_,(0,lt.pC)(this.tileRenderer)&&(this.tileRenderer.tileSize=_),this.setNeedsRender()}_prepareTileForLoading(_){_.renderData||(_.renderData=this.renderDataPool.acquire(),_.renderData.init(_),_.renderData.localOrigin=this._getLocalOriginOfTile(_))}loadTile(_){this._prepareTileForLoading(_),this.updateTileGeometry(_),this.updateTileTexture(_,zs.TEXTURE_FADING)}queryVisibleLevelRange(_,v,O,D){this._scaleRangeQueries.queryVisibleLevelRange(_,v,O,D),this.setNeedsRender()}updateTileTexture(_,v){(0,lt.pC)(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(_,v===zs.TEXTURE_FADING?Ys.Ns.FADING:Ys.Ns.UNFADED),this.setNeedsRender(),_.resetPendingUpdate(v))}updateTileGeometryState(_){this._prepareTileForLoading(_),_.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)}updateTileGeometry(_){for(const v of _.layerInfo[An.ELEVATION])v.pendingUpdates&=~zs.GEOMETRY;_.resetPendingUpdate(zs.GEOMETRY),_.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()}unloadTile(_){const v=_.renderData;v&&(v.releaseGeometry(),this.renderDataPool.release(v),v.clear(),_.renderData=null,_.setMemoryDirty(),this.setNeedsRender())}_getLocalOriginOfTile(_){const O=Math.max(0,7*Math.floor((_.level-3)/7));if(this.isGlobal&&0===O)return $t.Z;for(;_.parent&&_.level>O;)_=_.parent;return _.centerAtSeaLevel}setVisibility(_){this.visible=_,this.setNeedsRender()}getStats(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}}set wireframe(_){this._get("wireframe")!==_&&(this._set("wireframe",_),this.allTiles.forAll(v=>{v.isLoaded&&(this.updateTileGeometry(v),v.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}setNeedsRender(_=Fs.Xx.UPDATE){this.patchGroupsDirty=!0,this._context.requestRender(_)}initializeRenderContext(_){this._context=_,this.rctx=_.renderContext.rctx,this._techniqueRepository=_.shaderTechniqueRepository,this.tileRenderer=new h4(this.rctx,this.tileSize,this._techniqueRepository),this.updateTileBackground(),this.emptyTex=(0,$a.l_)(this.rctx)}uninitializeRenderContext(){this.emptyTex=(0,lt.O3)(this.emptyTex),this.tileRenderer=(0,lt.O3)(this.tileRenderer)}intersect(_,v,O,D){if(!this._rootTiles||_.options.selectOpaqueTerrainOnly&&_.options.selectionMode&&!this._opaque)return;const w=O4,te=P4;(0,_t.b)(w,D,O),(0,_t.s)(te,1/w[0],1/w[1],1/w[2]);const fe=_.results.min,Pe=_.results.max,Ue=_.results.ground,Xe=_.options.store===Ll.eC.MIN,st=!!_.results.ground.target,vt=(0,Qu.lV)(_.verticalOffset),Ct=_.tolerance;let Wt,Kt=Xe&&(0,lt.pC)(fe.dist)?fe.dist:1/0;const Lt=sr=>{const Er=sr.renderData;if(!(null==Er?void 0:Er.vao))return;const yr=Er.geometryInfo;(0,Ea.t8)(uC,yr.boundingBox);const br=Er.localOrigin;(0,lt.pC)(vt)&&(vt.localOrigin=br,vt.applyToAabb(uC));const Rr=uC;if(Y_[0]=O[0]-br[0],Y_[1]=O[1]-br[1],Y_[2]=O[2]-br[2],!(0,Kf.Fw)(Rr,Y_,te,Ct,Kt))return;const $r=(rs,Es,Gs)=>{rs.set(this.type,sr,Es,Gs,Zn.I),Kt=Xe&&(0,lt.pC)(fe.dist)?fe.dist:1/0},si=(rs,Es)=>{if((0,lt.pC)(Es)&&rs>=0&&(_.options.backfacesTerrain||(0,_t.e)(Es,w)<0)&&(_.options.invisibleTerrain||!_.options.selectionMode||null==v||v(O,D,rs))){if((null==Ue.dist||rs<Ue.dist)&&$r(Ue,rs,Es),_.options.isFiltered)return;_.options.store===Ll.eC.ALL&&((0,lt.Wi)(Wt)?(Wt=(0,fc.LP)(_.ray),$r(Wt,rs,Es),_.results.all.push(Wt)):rs<Wt.dist&&$r(Wt,rs,Es)),(null==fe.dist||rs<fe.dist)&&$r(fe,rs,Es),_.options.store!==Ll.eC.MIN&&(null==Pe.dist||rs>Pe.dist)&&$r(Pe,rs,Es)}},Ci=x4;(0,_t.b)(Ci,D,br);const Ti=yr.indices,ki=yr.vertexAttributes,Fi={data:ki.getField(Fo.T.POSITION,Fv.ct).typedBuffer,size:3,stride:ki.stride/4},Xi=yr.indexCount/3;if((0,lt.Wi)(vt)&&Xi>200){const rs=sr.renderData;(0,lt.Wi)(rs.intersectionData)&&(rs.intersectionData=new Cx(Ti,0,Xi,Fi)),rs.intersectionData.intersectRay({r0:Y_,r1:Ci},si)}else(0,Kf.CN)(Y_,Ci,0,Xi,Ti,Fi,null,vt,si)},nr=this._rootTiles;(0,lt.pC)(nr)&&(()=>{const sr=this.tileIterator;sr.reset(nr);const Er=_.options.invisibleTerrain;for(;!sr.done;){const yr=sr.next();!(yr.visible||Er&&yr.intersectsClippingArea)||!(0,lt.pC)(vt)&&!yr.intersectsRay(O,w,Ct,Kt)||st&&this._useStencilForTile(yr)?sr.skipSubtree():Lt(yr)}})()}prepareTechnique(_){if(_.bindParameters.slot===fn.r.OCCLUDED_TERRAIN){if(0==(_.renderOccludedMask&Bb.Qi))return null}else if(_.bindParameters.slot!==(this.opaque?fn.r.OPAQUE_TERRAIN:fn.r.TRANSPARENT_TERRAIN))return null;switch(_.pass){case gn.C.MATERIAL:return this._techniqueConfiguration.hasScreenSpaceReflections=_.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=(0,lt.pC)(_.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=_.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=_.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=this.overlayRenderer.isEmpty()?Eg.gT.Disabled:this.overlayRenderer.hasWater?Eg.gT.EnabledWithWater:Eg.gT.Enabled,this._updateTechnique(Ac.H.Color,(_.bindParameters.slot===fn.r.OCCLUDED_TERRAIN?Sd.$e.Occluded:Sd.$e.ColorAndWater)===Sd.$e.Occluded);case gn.C.MATERIAL_DEPTH_SHADOWMAP_ALL:case gn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._castShadows&&1===_.bindParameters.lighting.globalFactor?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Ac.H.Shadow,!1)):null;case gn.C.MATERIAL_DEPTH:return this.isTransparent&&this.overlayRenderer.isEmpty()?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Ac.H.Depth,!1));case gn.C.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Ac.H.Normal,!1);case gn.C.MATERIAL_HIGHLIGHT:return this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(Ac.H.Highlight,!1)):null}return null}render(_,v){const O=_.pass,D=1===_.bindParameters.lighting.globalFactor;switch(this._updatePatchGroups(),v.useStencil=!1,O){case gn.C.MATERIAL:this._renderMaterialPass(_,v,_.bindParameters.slot===fn.r.OCCLUDED_TERRAIN?Sd.$e.Occluded:Sd.$e.ColorAndWater);break;case gn.C.MATERIAL_DEPTH_SHADOWMAP_ALL:case gn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&D&&this._renderAuxiliaryPass(_,v,Sd.$e.None);break;case gn.C.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(_,v,Sd.$e.None);break;case gn.C.MATERIAL_NORMAL:this._renderAuxiliaryPass(_,v,Sd.$e.None);break;case gn.C.MATERIAL_HIGHLIGHT:this.needsHighlight&&(this._renderAuxiliaryPass(_,v,Sd.$e.Highlight),_.rctx.clearSafe(Jt.lk.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()}_renderMaterialPass(_,v,O){const{rctx:D}=_;this._passParameters.overlaySource=O,D.bindTechnique(v,this._passParameters,_.bindParameters),this.numTilesRendered=0,this.numTilesCulled=0,this.numOriginsRendered=0,this._scaleRangeQueries.prepareQueries(),this.opaque?this._renderPatchGroups(_,v,O):_.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(_,v,O),_.offscreenRenderingHelper.tmpColor,_.offscreenRenderingHelper.mainDepth,[0,0,0,0]),this._scaleRangeQueries.processQueries()}_renderAuxiliaryPass(_,v,O){const D=_.rctx;this._passParameters.overlaySource=O,D.bindTechnique(v,this._passParameters,_.bindParameters),this._renderPatchGroupsAuxiliary(_,v,O)}updateTileBackground(_=null){if((0,lt.Wi)(this.tileRenderer))return;const v=this.tileRenderer;let O=null;if((0,lt.pC)(_)){const D=ol.Z.toUnitRGBA(_);O=(0,$t.f)(D[0]||0,D[1]||0,D[2]||0)}v.setBackground(O),this.allTiles.forAll(D=>v.updateTileTexture(D,Ys.Ns.FADING)),this._techniqueConfiguration.tileBlendInput=v.backgroundIsGrid?uh.R.GridComposite:(0,lt.pC)(v.backgroundColor)?uh.R.ColorComposite:uh.R.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this.patchGroupsDirty){if(this.highestVisibleLODTile=null,this._rebuildPatchGroups(),this.renderOrder!==mg.NONE){const _=Array.from(this._patchGroups.values());_.forEach(v=>(0,xu.zW)(this.renderOrder,v)),_.sort((v,O)=>(0,xu.dF)(v[0],O[0],this.renderOrder)),this._patchGroups=new Map(_.map(v=>[v[0].renderData.localOrigin,v]))}this.patchGroupsDirty=!1}}_rebuildPatchGroups(){var v;const _=this._rootTiles;if(!(0,lt.Wi)(_)){null==(v=_[0])||v.surface.checkAllTileWaterproofness(),this._patchGroups.clear();for(const O of _)this._rebuildPatchGroupsForRootTile(O)}}_rebuildPatchGroupsForRootTile(_){const v=this.tileIterator;for(v.resetOne(_);!v.done;){const O=v.next(),D=O.renderData;if(!D||O.visible)if(O.rendered){if(D){const w=this._patchGroups.get(D.localOrigin)||new Array;this._patchGroups.set(D.localOrigin,w),w.push(O),(!this.highestVisibleLODTile||O.vlevel>this.highestVisibleLODTile.vlevel)&&(this.highestVisibleLODTile=O),v.skipSubtree()}}else this.numTilesCulled++;else this.numTilesCulled++,v.skipSubtree()}}_useStencilForTile(_){for(const v of this.stencilEnabledLayerExtents)if(_.intersectsExtent(v))return!0;return!1}_renderPatchGroupsAuxiliary(_,v,O){const D=this.stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(w=>{v.program.bindDraw(new Ox.w(w[0].renderData.localOrigin),_.bindParameters);for(let fe=0;fe<w.length;fe++)this._renderPatch(_,v,w[fe],Jt.MX.TRIANGLES,D,O)}),_.rctx.bindVAO(null)}_renderPatchGroups(_,v,O){const D=_.rctx,w=_.bindParameters.camera,te=v.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&(0,sv.Gw)(this.stage.viewingMode,this.ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:w.fovY});const fe=this.stencilEnabledLayerExtents.length>0,Pe=O===Sd.$e.Occluded;Pe&&(te.bindTexture("tex",this.emptyTex),te.setUniform1f("blend",1),te.setUniform4fv("texOffsetAndScale",vi.Z));const Ue=(0,lt.pC)(this.tileRenderer)&&(0,lt.pC)(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:$t.Z;this._techniqueConfiguration.tileBlendInput===uh.R.ColorComposite&&te.setUniform3fv("backgroundColor",Ue);const Xe=this.wireframe?Jt.MX.LINES:Jt.MX.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&te.bindTexture("texNext",this.emptyTex),this._patchGroups.forEach(st=>{v.program.bindDraw(new Ox.w(st[0].renderData.localOrigin),_.bindParameters),this.numOriginsRendered++;for(let Ct=0;Ct<st.length;Ct++){const Wt=st[Ct],Kt=Wt.renderData.textureReference;if(!(0,lt.Wi)(Kt)){if(!Pe){this._scaleRangeQueries.scaleQueriesForTile(Wt),xx(Wt.renderData.geometryInfo.uvOffsetAndScale,Kt.offsetAndScale,Zv),te.setUniform4fv("texOffsetAndScale",Zv),te.bindTexture("tex",Kt.texture.texture);const Lt=Wt.renderData.textureFadeFactor,nr=Lt<1?Wt.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&(0,lt.pC)(nr)&&Lt<1?(xx(Wt.renderData.geometryInfo.uvOffsetAndScale,nr.offsetAndScale,Zv),te.setUniform1f("fadeFactor",Lt),te.setUniform4fv("nextTexOffsetAndScale",Zv),te.setUniform3fv("nextTexOpacities",nr.opacities),te.bindTexture("texNext",nr.texture.texture)):te.setUniform1f("fadeFactor",1),Wt.renderData.textureIsFading&&this.setNeedsRender(),te.setUniform3fv("textureOpacities",Kt.opacities)}this._renderPatch(_,v,Wt,Xe,fe,O),Wt.renderOrder=this.numTilesRendered,this.numTilesRendered++}}}),D.bindVAO(null)}_renderPatch(_,v,O,D,w,te){const fe=O.renderData,Pe=fe.vao,Ue=Pe.indexBuffer;if((0,lt.Wi)(Ue))return;const Xe=v.program;te!==Sd.$e.None&&this._bindOverlayPatchData(Xe,fe.overlay),w&&(v.useStencil=this._useStencilForTile(O),v.bindPipelineState(_.rctx,_.bindParameters.slot));const st=fe.geometryInfo.indexCount;_.rctx.bindVAO(Pe),Xe.assertCompatibleVertexAttributeLocations(Pe),_.rctx.drawElements(D,st,Ue.indexType,0)}_bindOverlayPatchData(_,v){_.setUniform4fv("overlayTexOffset",v.offsets),_.setUniform4fv("overlayTexScale",v.scales)}_updateTechnique(_,v){return this._techniqueConfiguration.output=_,_===Ac.H.Color&&(this._techniqueConfiguration.atmosphere=this.isGlobal&&this._velvetOverground),this._techniqueConfiguration.renderOccluded=v,this._techniqueConfiguration.stencilEnabled=!1,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(Kv,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this.tileRenderer}}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],nd.prototype,"overlayRenderer",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],nd.prototype,"stage",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],nd.prototype,"isGlobal",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],nd.prototype,"allTiles",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],nd.prototype,"ellipsoidRadius",void 0),(0,Ze._)([(0,nt.Cb)({value:!1})],nd.prototype,"renderingDisabled",null),(0,Ze._)([(0,nt.Cb)()],nd.prototype,"renderPatchBorders",null),(0,Ze._)([(0,nt.Cb)()],nd.prototype,"cullBackFaces",null),(0,Ze._)([(0,nt.Cb)({value:mg.FRONT_TO_BACK})],nd.prototype,"renderOrder",null),(0,Ze._)([(0,nt.Cb)()],nd.prototype,"wireframe",null),nd=(0,Ze._)([(0,ui.j)("esri.views.3d.terrain.TerrainRenderer")],nd);const M4=nd;function xx(_,v,O){O[0]=_[0]*v[2]+v[0],O[1]=_[1]*v[3]+v[1],O[2]=_[2]*v[2],O[3]=_[3]*v[3]}const O4=(0,$t.c)(),P4=(0,$t.c)(),Y_=(0,$t.c)(),x4=(0,$t.c)();class D4{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}}var J_=T(23461);let Zh=class extends Bi.Z{constructor(_){super(_),this._handles=new cn.Z}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add((0,pt.YP)(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=(0,lt.SC)(this._handles),this._waitTask=null}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let _;if(this.layers.some(v=>!(!(0,Ws.iC)(v)||v.isRejected()||v.isFulfilled()&&!function A4(_,v,O){return(0,lt.pC)((0,Ji.E_)(_,v,O))}(v,this.viewSpatialReference,this.viewingMode)||(_=v,"vector-tile"===(null==v?void 0:v.type)||(0,Ji.x4)(v)))),_)if(_.isResolved()){const v=(0,Ji.E_)(_,this.viewSpatialReference,this.viewingMode);if((0,lt.pC)(v)){const O=new J_.t(v.tileInfo);this._lockTilingScheme(O)}}else this._updateWhen(_)}_updateWhen(_){const v=_.when().catch(()=>{}).then(()=>{v!==this._waitTask||this.destroyed||this._update()});this._waitTask=v}_lockTilingScheme(_){if(this.viewingMode===Us.JY.Global){const v=_.levels.length-1;_.spatialReference.isWebMercator?_=J_.t.makeWebMercatorAuxiliarySphere(v):(0,ci.jF)(_.spatialReference)&&(_=J_.t.makeGCSWithTileSize(_.spatialReference,_.pixelSize,v))}this.tilingSchemeLocked=!0,this.tilingScheme=_,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add((0,pt.YP)(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===Us.JY.Global){const _=this.extentHelper.viewSpatialReference,v=(0,ci.jF)(_)||(0,qs.BZ)(_)||(0,qs.V2)(_);_.isWebMercator?this.tilingScheme=J_.t.WebMercatorAuxiliarySphere:v&&(this.tilingScheme=J_.t.makeGCSWithTileSize(_,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const _=this.extentHelper.layerViewsExtent;(0,lt.pC)(_)&&!(0,qr.fS)(_,this.extent)&&(this.tilingScheme=J_.t.fromExtent(_,this.extentHelper.viewSpatialReference),this._set("extent",_))}}get test(){return{lockTilingScheme:_=>this._lockTilingScheme(_),done:!this._waitTask}}};(0,Ze._)([(0,nt.Cb)()],Zh.prototype,"tilingScheme",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Zh.prototype,"extent",void 0),(0,Ze._)([(0,nt.Cb)({value:!1})],Zh.prototype,"tilingSchemeLocked",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Zh.prototype,"viewSpatialReference",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Zh.prototype,"layers",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Zh.prototype,"extentHelper",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Zh.prototype,"viewingMode",void 0),Zh=(0,Ze._)([(0,ui.j)("esri.views.3d.terrain.TilingSchemeLogic")],Zh);class S4{constructor(){this.offset=(0,Li.a)(),this.scale=0,this.tile=null}init(v,O,D,w){this.tile=v,this.offset[0]=O,this.offset[1]=D,this.scale=w}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}}const dh=pn.Z.getLogger("esri.views.3d.terrain.TerrainSurface");let Fn=class extends(sa.Z.EventedMixin(Bi.Z)){constructor(_){var v,O;super(_),this._elevationBounds=new Ib,this._iteratorPool=new lh.Z(xu.AA,D=>D.remove=()=>this._iteratorPool.release(D)),this._postorderIterator=new xu.rv,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visible=!1,this._usedMemory=null,this._performanceInfo=new D4,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=(0,$t.c)(),this._eyePosSurfaceSR=(0,$t.c)(),this._splitLimits=new a5,this._snapLevel=1/0,this._frustum=(0,qn.Ue)(),this._viewProjectionMatrix=(0,Zn.c)(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new cn.Z,this._watchUpdatingTracking=new Yd.t,this._frameTask=Gn.sq,this._allTiles=new Ua.Z,this._upsampleInfoPool=new lh.Z(S4),this._rootTilesExtent=(0,qr.Ue)(),this._maxNumUpdating=1,this.maxTextureScale=1.2,this.backgroundColor=null,this._updatingRootTiles=!1,this.deferTileNeighborUpdate=!1,this.neighborTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this._layerViewsDirty=!1,this._isGlobal=!(null==(O=null==(v=_.view)?void 0:v.state)?void 0:O.isLocal)}initialize(){this._lercDecoder=(0,FU.w)(this.view.resourceController),this._tilePool=new lh.Z(this.view.state.isLocal?j5:F5);const _=this.view.resourceController.memoryController;this._upsampleMapCache=_.newCache("esri.views.3d.terrain.upsample",w=>w.unloadMapData()),this._elevationQueryCache=new jU(_.newCache("elevation-query")),this._set("overlayManager",new Xc({surface:this})),this._handles.add([(0,pt.YP)(()=>this.overlayManager.hasHighlights,w=>this._renderer.setNeedsHighlight(w)),(0,pt.YP)(()=>this.overlayManager.rendersOccluded,w=>this._renderer.setRenderOccludedOverlay(w))],"overlayManager"),this._renderer=new M4({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:(0,Zi.Iu)(this.view.spatialReference).radius,stage:this.view._stage,allTiles:this._allTiles}),this._handles.add([(0,pt.YP)(()=>this.baseOpacity,w=>{this._handleLayerViewChanges(),this._updateBaseOpacity(w)},pt.tX),(0,pt.YP)(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},pt.tX),(0,pt.YP)(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),pt.Z_),(0,pt.YP)(()=>this.backgroundColor,w=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(w)},pt.tX),(0,pt.YP)(()=>this.view.pointsOfInterest,w=>{this._renderer.pointsOfInterest=w,this._watchUpdatingTracking.removeAll(),w&&this._watchUpdatingTracking.add(()=>w.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),(0,pt.YP)(()=>Yl.Z.TERRAIN_TILE_TREE_SHOW_TILES,w=>{w&&!this._treeDebugger?Promise.all([T.e(8592),T.e(1318)]).then(T.bind(T,21318)).then(({TerrainTileTree3DDebugger:te})=>{!this._treeDebugger&&Yl.Z.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new te({view:this.view}))}):w||(this._treeDebugger=(0,lt.SC)(this._treeDebugger))},pt.nn)]),this._extentHelper=function zU(_,v){return _===Us.JY.Global?new Lb(v):new Ub(v)}(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});const v=this.view.defaultsFromMap?new Bc.Z({getCollections:()=>{var w,te,fe;return null==(fe=null==(te=null==(w=this.view)?void 0:w.defaultsFromMap)?void 0:te.mapCollections)?void 0:fe.map(({layers:Pe})=>Pe)},getChildrenFunction:w=>w&&"layers"in w?w.layers:null}):this.view.map.allLayers,O=new Zh({layers:v,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",O),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(hg.Bh.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester(hg.Bh.BASEMAP),this._frameTask=this.view.resourceController.scheduler.registerTask(Gn.T8.TERRAIN_SURFACE,this),this._handles.add([(0,pt.YP)(()=>this._extentHelper.stencilEnabledExtents,w=>this._renderer.setStencilEnabledLayerExtents(w),pt.nn),(0,pt.YP)(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),pt.Z_),(0,pt.YP)(()=>this.extent,()=>this._updateRootTiles(),pt.nn),this.view.on("resize",()=>this._viewChangeUpdate()),(0,pt.YP)(()=>{var fe,Pe;const w=this.view,te=w.state;return[this.lodBias,this.lodSnapping,null==(Pe=null==(fe=w.resourceController)?void 0:fe.memoryController)?void 0:Pe.memoryFactor,te.camera,te.contentCamera,te.fixedContentCamera]},()=>this._viewChangeUpdate(),pt.tX),(0,pt.YP)(()=>{var w,te;return null==(te=null==(w=this.view.qualitySettings)?void 0:w.tiledSurface)?void 0:te.textureFadeDuration},w=>this._renderer.textureFadingEnabled=w>0,pt.nn),(0,pt.YP)(()=>this._userClippingExtent,()=>this._updateClippingExtent(),pt.Z_)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=(0,lt.RY)(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=(0,lt.SC)(this._upsampleMapCache),this._elevationQueryCache=(0,lt.SC)(this._elevationQueryCache),this._set("tilingSchemeLogic",(0,lt.SC)(this.tilingSchemeLogic)),this._extentHelper=(0,lt.SC)(this._extentHelper),this._basemapLayerViewHandles.forEach((_,v)=>this._unregisterTiledLayerView(v)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",(0,lt.SC)(this.overlayManager)),this._tilePool=(0,lt.SC)(this._tilePool),Vb.prune(),this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null),this._renderer=(0,lt.SC)(this._renderer),this._iteratorPool=(0,lt.SC)(this._iteratorPool),this._set("view",null),this._upsampleInfoPool=(0,lt.SC)(this._upsampleInfoPool),(0,Sv.K)(),function n5(){Uv.size>0&&(console.log(`${Uv.size} live TilePerLayerInfo allocations:`),Uv.forEach(_=>console.log(_,"\n")))}()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var v,O;const _=null==(O=null==(v=this.view.pointsOfInterest)?void 0:v.contentCameraOnSurface)?void 0:O.scale;if(_){const D=this.view.state.contentCamera;let w=$y(this.view,D.eye,D.viewForward,D.up).tilt;w>90&&(w=180-w);const te=2*(w/90)**2,fe=xO(this.view,_)-te;Math.abs(this._snapLevel-fe)>.25&&(Math.round(fe)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=fe)}return Math.round(this._snapLevel)}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?Ys.VB.ON:Ys.VB.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:_}=this,{clippingArea:v}=this.view;if((0,lt.Wi)(v)||(0,lt.Wi)(_))return null;const O=(0,qr.Ue)(),D=(0,_P.G)(v,O,_)?O:null,w=this._get("extent");return(0,qr.fS)(D,w)?w:D}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const _=(0,qr.jV)(this.groundExtent,this._userClippingExtent,(0,qr.Ue)()),v=this._get("extent");return(0,qr.fS)(_,v)?v:_}get groundExtent(){return(0,lt.pC)(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var _;return null==(_=this.tilingSchemeLogic)?void 0:_.extent}get updating(){return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||this._asyncWorkItems>0||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get viewingMode(){return this.view.state.viewingMode}get ready(){return(0,lt.pC)(this.rootTiles)}set renderOrder(_){this._renderer.renderOrder=_,this._set("renderOrder",_)}get spatialReference(){var _,v;return null!=(v=null==(_=this.tilingScheme)?void 0:_.spatialReference)?v:null}set slicePlaneEnabled(_){this._renderer.slicePlaneEnabled=_,this._set("slicePlaneEnabled",_),this._updateTransparentTerrain()}_updateTransparentTerrain(){var v,O;null==(O=null==(v=this.view)?void 0:v._stage)||O.renderView.setRenderParameters({transparentTerrain:!this.renderingDisabled&&!this.opaque})}set velvetOverground(_){_!==this.velvetOverground&&(this._renderer.velvetOverground=_),this._set("velvetOverground",_)}set visible(_){_!==this._visible&&(this._visible=_,this._renderer.setVisibility(_),this.suspended=!_)}get opaque(){return this._renderer.opaque}set suspended(_){this._set("suspended",_),this._viewChangeUpdate()}intersect(_,v,O,D){this._renderer.intersect(_,v,O,D)}getElevation(_,v,O,D){const w=this.getTileWithElevation(_,v,O,D,Jl);return(0,lt.Wi)(w)?null:NP(Jl[0],Jl[1],w.renderData.geometryState.samplerData)}getTileWithElevation(_,v,O,D,w=Jl){var fe;const te=this.rootTiles;if((0,lt.Wi)(te)||!te.length||0===te[0].layerInfo[An.ELEVATION].length)return null;if(w[0]=_,w[1]=v,w[2]=O,!(0,ci.SH)(w,D,w,null==(fe=this.tilingScheme)?void 0:fe.spatialReference))return dh.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let Pe of te){if(!Pe.containsPoint(w))continue;for(;Pe&&!Pe.rendered&&!Pe.isLeaf;){let Xe=0;w[0]>.5*(Pe.extent[0]+Pe.extent[2])&&(Xe+=1),w[1]<.5*(Pe.extent[1]+Pe.extent[3])&&(Xe+=2),Pe=Pe.children[Xe]}const Ue=Pe.renderData;return Ue&&Ue.geometryState.samplerData?Pe:null}return null}get elevationBounds(){return this._elevationBounds}getScale(_){if(this.tilingScheme){if(!(0,ci.KC)(_,Jl,this.spatialReference))return dh.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const v=this.rootTiles;if((0,lt.pC)(v))for(let O of v)if(null==O?void 0:O.containsPoint(Jl)){for(;!O.isLeaf&&!O.rendered;){let D=0;Jl[0]>O.children[0].extent[2]&&(D+=1),Jl[1]<O.children[0].extent[1]&&(D+=2),O=O.children[D]}return this._getLodBiasCorrectedScale(O.level)}}return 1e100}getSphereElevationBounds(_,v,O,D,w){var Xe;if(Jl[0]=_,Jl[1]=v,Jl[2]=O,Jl[3]=D,!(0,ci.SH)(Jl,w,Jl,null==(Xe=this.tilingScheme)?void 0:Xe.spatialReference))return dh.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let te=1/0,fe=-1/0;const Pe=st=>{if(st&&(0,qr.hr)(st.extent,Jl))if(st.isLeaf||st.rendered)te=Math.min(te,st.elevationBounds[0]),fe=Math.max(fe,st.elevationBounds[1]);else for(const vt of st.children)Pe(vt)},Ue=this.rootTiles;if((0,lt.pC)(Ue))for(const st of Ue)Pe(st);return{min:te,max:fe}}getSphereScale(_,v){if(!this.tilingScheme)return null;if(!(0,ci.KC)(_,Jl,this.spatialReference))return dh.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Jl[3]=v;let O=null;const D=te=>{if(te&&(0,qr.hr)(te.extent,Jl))if(te.isLeaf||te.rendered){const fe=this._getLodBiasCorrectedScale(te.level);O=null==O?fe:Math.min(O,fe)}else for(const fe of te.children)D(fe)},w=this.rootTiles;if((0,lt.pC)(w))for(const te of w)D(te);return O}queryVisibleScaleRange(_,v,O,D){const w=v?this.tilingScheme.levelAtScale(v):0,te=O?this.tilingScheme.levelAtScale(O):1/0,fe=this.lodBias;this._renderer.queryVisibleLevelRange(_,w+fe,te+fe,D)}_updateBaseOpacity(_){const v=this._renderer.opaque;this._renderer.opaque=_>=1&&!this.hasCompositeBlendMode,this._renderer.isTransparent=this._allSurfaceLayersTransparent();const O=v!==this._renderer.opaque;O&&this._updateTransparentTerrain(),this._updateTileTextures(O?Ys.Ns.UNFADED:Ys.Ns.IMMEDIATE)}_updateTilingScheme(){var v,O;const _=this.tilingSchemeLogic.tilingScheme;_!==this.tilingScheme&&((0,Ji.wu)(!!_,"tiling scheme cannot be reset to undefined"),this._isGlobal=!(null==(O=null==(v=this.view)?void 0:v.state)?void 0:O.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",_),this._updateClippingExtent(),_&&(this._updateTiledLayers(),this._renderer.setTileSize(_.pixelSize),this.overlayManager.setSpatialReference(_.spatialReference),this._updateRootTiles()))}_acquireTile(_,v,O,D){const w=this._tilePool.acquire();return $v[0]=_,$v[1]=v,$v[2]=O,w.init($v,D,this),w}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:_,tilingScheme:v}=this;if(!v)return;const O=L4;let D=v.rootTilesInExtent(_,O,5*ks.$r);if((0,lt.pC)(this.rootTiles)){if(D.length>ks.$r)return void dh.warn(ks.Tg);const w=this.rootTiles.map(fe=>fe.lij),te=(0,Cl.e5)(w,D,Dx);if(this._updatingRootTiles=!0,te.removed.length>0||te.added.length>0){const fe=this.rootTiles.filter(Pe=>!(te.removed.findIndex(Ue=>Dx(Ue,Pe.lij))>-1&&(this._purgeTile(Pe,!0),1)));te.added.forEach(Pe=>fe.push(this._newRootTile(Pe))),this._setRootTiles(fe)}}else this._updatingRootTiles=!0,D.length>ks.$r&&(dh.warn(ks.iU),D=v.rootTilesInExtent(_,O,ks.$r)),this._setRootTiles(D.map(w=>this._newRootTile(w)));(0,qr.fS)(O,this._rootTilesExtent)||(this._rootTilesExtent=(0,qr.Ue)(O)),this.visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._allTiles.forEach(w=>{w.isLoaded&&this._prepareToLoadTile(w)}),this._allTiles.forAll(w=>{w.isLoaded&&(this._updateTileGeometry(w),this._updateTileNeighborsAfterGeometryChange(w))}),this._updatingRootTiles=!1,this.checkAllTileWaterproofness()}_newRootTile(_){const v=this._acquireTile(0,_[1],_[2],null);return v.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===zs.SPLIT&&v.setPendingUpdate(zs.SPLIT),this._loadTile(v),this.deferTileNeighborUpdate||v.checkGeometryWaterproofness(),v}_setRootTiles(_){if(this._set("rootTiles",_),this._allTiles.clear(),(0,lt.pC)(_)){const v=this._iteratorPool.acquire();for(v.reset(_);!v.done;)this._allTiles.push(v.next());v.remove()}this._renderer.setRootTiles(this.rootTiles),this._updateTilesVisibility(_)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this.rootTiles)))}_updateClippingStatus(_){_.updateClippingStatus(this.extent)&&_.resetPendingUpdate(zs.GEOMETRY)&&this._updateTileGeometry(_)}_updateTilesVisibility(_){if((0,lt.Wi)(_))return;const v=(0,xu.t8)(_);let O=v?this._elevationBounds.min:1/0,D=v?this._elevationBounds.max:-1/0;const w=this.view.state.fixedContentCamera,te=this.extent,fe=this._viewProjectionMatrix;this.setTileTreeDirty();const Pe=this._iteratorPool.acquire();for(Pe.reset(_);!Pe.done;){const Ue=Pe.next();Ue.updateClippingStatus(te)&&Ue.resetPendingUpdate(zs.GEOMETRY)&&this._updateTileGeometry(Ue),Ue.setPendingUpdate(zs.RENDERDATA);const Xe=Ue.computeVisibility();w||Xe?(Ue.updateScreenDepth(fe),Ue.renderData&&(O=Math.min(Ue.elevationBounds[0],O),D=Math.max(Ue.elevationBounds[1],D))):Pe.skipSubtree()}Pe.remove(),this._viewChanged=!0,this._allTilesDirty=!0,isFinite(O)&&isFinite(D)&&(this._elevationBounds.min===O&&this._elevationBounds.max===D||(this._elevationBounds.min=O,this._elevationBounds.max=D,this.emit("elevation-bounds-change",null)))}_updateViewDependentParameters(){const _=this.view.state.camera,v=this.view.state.contentCamera,O=Math.tan(.5*v.fovX),D=Math.tan(.5*v.fovY),w=this.tilingScheme.pixelSize,te=2**-this.lodBias*_.pixelRatio;this._splitLimits.aboveGround=_.aboveGround,this._splitLimits.fovX=O,this._splitLimits.fovY=D,this._splitLimits.relativeWidthLimit=w/_.width*this.maxTextureScale*te,this._splitLimits.relativeHeightLimit=w/_.height*this.maxTextureScale*te,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?((0,lt.Wi)(this._splitLimits.frustum)&&(this._splitLimits.frustum=(0,qn.Ue)()),(0,qn.JG)(this._splitLimits.frustum,v.frustum)):this._splitLimits.frustum=null,(0,qn.JG)(this._frustum,_.frustum),(0,js.m)(this._viewProjectionMatrix,v.projectionMatrix,v.viewMatrix),(0,_t.c)(this._eyePosRenderSR,v.eye),(0,ci.SH)(_.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(_){_.rendered&&!_.shouldLoad&&(Ax(_)?(this._loadChildren(_),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(_),_.children.forEach(v=>v.checkGeometryWaterproofness()))):function I4(_){return _.isLeaf&&_.parent&&_.parent.shouldLoad}(_)&&this._loadParent(_))}_updateTileGeometry(_){_.updateVisibility(),this._renderer.updateTileGeometry(_),this._updateTileNeighborsAfterGeometryChange(_),this._elevationUpdate(_),this._usedMemory=null,this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(_)}_updateTileNeighborsAfterGeometryChange(_,v){if(this.deferTileNeighborUpdate){const O=this.neighborTilesToUpdate;_.forEachLoadedNeighbor(D=>{O.add(D)})}else _.updateNeighborsAfterGeometryChange(v)}_updateTileTexture(_,v){const O=_.resetPendingUpdate(zs.TEXTURE_FADING)?zs.TEXTURE_FADING:!!_.resetPendingUpdate(zs.TEXTURE_NOFADING)&&zs.TEXTURE_NOFADING;O&&(this._renderer.updateTileTexture(_,O),this._usedMemory=null,v.madeProgress())}_elevationUpdate(_){kv.spatialReference=this.spatialReference,kv.tile=_,kv.extent=_.extent,this.emit("elevation-change",kv)}get running(){return this.updating&&this.ready&&!this.suspended}runTask(_){this._handleLayerViewChanges(_),this._frameTask.processQueue(_),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateTileStatus(_),this._sortTiles(_);const v=!this.view.state.fixedContentCamera;this._mergeAndSplit(_,v),_.run(()=>this._updateElevation(_)),_.run(()=>this._updateTextures(_)),v||this._mergeAndSplit(_,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),_.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory(),this.notifyChange("updatingProgressValue")}_updateTileStatus(_){if(!this._viewChanged||!this.rootTiles||_.done)return;this._viewChanged=!1;const v=this._iteratorPool.acquire();for(v.reset(this.rootTiles);!v.done;){const O=v.next();if(O.loadable){const D=O.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(D===zs.SPLIT){O.resetPendingUpdate(zs.MERGE),O.isLeaf&&(O.setPendingUpdate(zs.SPLIT),v.skipSubtree());continue}O.resetPendingUpdate(zs.SPLIT)&&O.updateAgentSuspension(),D===zs.VSPLITMERGE&&O.updateAgents(An.ELEVATION)}if(v.skipSubtree(),!O.isLeaf){O.setPendingUpdate(zs.MERGE),O.resetPendingUpdate(zs.SPLIT);const D=this._iteratorPool.acquire();D.resetOne(O);for(let w=D.next();!D.done;w=D.next())this._updateClippingStatus(w),w.updateVisibility(),w.loadable&&w.updateScreenDepth(this._viewProjectionMatrix);D.remove()}}v.remove(),this.requestUpdate(),_.madeProgress()}_sortTiles(_){_.done||this._allTilesSorted||((0,xu.b)(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),_.madeProgress())}_prepareBatchTileGeometryUpdate(){(0,Ji.Fp)(0===this.neighborTilesToUpdate.size),this.deferTileNeighborUpdate=!0}_batchUpdateUpdatedTileNeighbors(){this.deferTileNeighborUpdate=!1;const _=this.neighborTilesToUpdate;(()=>{for(const O of _)O.updateNeighborDataAndGeometryIfNeeded()})(),(()=>{for(const O of _)O.updateNeighborsWithChangedEdgeResolution()})(),_.clear()}_mergeAndSplit(_,v){if(this.suspended||_.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate(),this._prepareBatchTileGeometryUpdate();let O=!1;for(;!_.done;){O=!0;let D=!1;const w=!this._allTiles.some(te=>{if(te.resetPendingUpdate(zs.MERGE)){if(!v)return te.setPendingUpdate(zs.MERGE),_.done;this._mergeTile(te),D=!0,_.madeProgress()}else te.resetPendingUpdate(zs.SPLIT)&&(this._splitTile(te),D=!0,_.madeProgress());return!_.done&&te.resetPendingUpdate(zs.RENDERDATA)&&(this._updateRenderData(te),_.madeProgress()),_.done});if(D&&(this._allTilesSorted=!1,this._allTilesDirty=!0),w){if(!D)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}O||(this._allTilesDirty=!0),this._batchUpdateUpdatedTileNeighbors(),this._sortTiles(_)}_updateElevation(_){return this._prepareBatchTileGeometryUpdate(),this._allTiles.some(v=>(v.resetPendingUpdate(zs.GEOMETRY)&&(this._updateTileGeometry(v),this._updateTileTexture(v,_),_.madeProgress()),_.done)),this._batchUpdateUpdatedTileNeighbors(),_.hasProgressed}_updateTextures(_){return this._allTiles.some(v=>(this._updateTileTexture(v,_),_.done)),_.hasProgressed}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(Fs.Xx.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get lodBias(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*ks.DR}_getLodBiasCorrectedScale(_){const v=this.tilingScheme.levels,O=(0,li.uZ)(_-this.lodBias,0,v.length-1),D=O-Math.floor(O);return v[Math.floor(O)].scale*(1-D)+v[Math.ceil(O)].scale*D}_removeAllTiles(){(0,lt.pC)(this.rootTiles)&&(this.rootTiles.forEach(_=>this._purgeTile(_,!1)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this.visible=!1}_purgeDescendantTiles(_){if(_.isLeaf)return!1;let v=!1;for(let O=0;O<4;++O)v=this._purgeTile(_.children[O],!1)||v;return _.unsetChildren(),v}_purgeTile(_,v){const O=this._purgeDescendantTiles(_)||_.rendered;return this._allTiles.removeUnordered(_),this._unloadTile(_),v&&this._updateTileNeighborsAfterGeometryChange(_),this._tilePool.release(_),O}_unloadTile(_){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(_),_.unload(this._renderer)}_splitTile(_){(0,Ji.wu)(_.isLeaf,"tile that is already split should not be split again!");const v=_.level+1,O=2*_.lij[1],D=2*_.lij[2];_.setChildren(this._createTile(v,O,D,_),this._createTile(v,O,D+1,_),this._createTile(v,O+1,D,_),this._createTile(v,O+1,D+1,_)),_.setPendingUpdate(zs.RENDERDATA),_.updateAgentSuspension(),this._allTiles.pushArray(_.children),this._allTilesDirty=!0,this._emitTileScaleChange(_,v),++this._performanceInfo.numSplit}_emitTileScaleChange(_,v=_.level){Yv.spatialReference=this.spatialReference,Yv.extent=_.extent,Yv.scale=this._getLodBiasCorrectedScale(v),this.emit("scale-change",Yv)}_createTile(_,v,O,D){(0,Ji.wu)(!!D,"_createTile sanity check");const w=this._acquireTile(_,v,O,D);return w.updateClippingStatus(this.extent),w.loadable&&(w.updateScreenDepth(this._viewProjectionMatrix),w.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===zs.SPLIT&&w.setPendingUpdate(zs.SPLIT)),w}_mergeTile(_){(0,Ji.wu)(!_.hasPendingUpdate(zs.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(_)&&((0,Ji.wu)(!_.renderData,"_mergeTile sanity check"),this._loadTile(_),this._updateTileNeighborsAfterGeometryChange(_),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(_)),this._allTilesDirty=!0,++this._performanceInfo.numMerged,this._emitTileScaleChange(_)}_checkTileAndNeighborsWaterproofness(_){_.checkGeometryWaterproofness(),this._checkTileNeighborsWaterproofness(_)}_checkTileNeighborsWaterproofness(_){Ji.XJ&&_.forallNeighbors(v=>!!v.isLoaded&&(v.checkGeometryWaterproofness(),!0))}_loadChildren(_){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(_),(0,Ji.wu)(_.rendered,"parent should be rendered"),this._unloadTile(_);const v=_.children;v.forEach(O=>this._prepareToLoadTile(O)),v.forEach(O=>this._loadTilePrepared(O)),this._updateTileNeighborsAfterGeometryChange(_,_.level+1),this.deferTileNeighborUpdate||(v.forEach(O=>O.updateNeighborsWithChangedEdgeResolution()),v.forEach(O=>O.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(_))}_loadParent(_){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(_);const v=_.parent;this._unloadChildren(v),this._loadTile(v),this._updateTileNeighborsAfterGeometryChange(v),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(v)}_unloadChildren(_){if(!_.isLeaf)for(let v=0;v<4;++v){const O=_.children[v];this._unloadChildren(O),this._unloadTile(O)}}_postLoadTile(_){_.setPendingUpdate(zs.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(_),this._elevationUpdate(_)}_loadTile(_){_.load(this._renderer),this._postLoadTile(_)}_loadTilePrepared(_){_.loadPrepared(this._renderer),this._postLoadTile(_)}_prepareToLoadTile(_){_.prepareToLoad(this._renderer)}_elevationDataArrived(_,v,O){const D=new VU(_.lij,_.extent,O);_.dataArrived(v,An.ELEVATION,D);const w=[_],te=_.level,fe=this._iteratorPool.acquire();for(fe.reset(w);!fe.done;){const Pe=fe.next();Pe.findElevationBoundsForLayer(v,te),Pe.computeElevationBounds()}fe.remove(),this._updateTilesVisibility(w)}_handleLayerViewChanges(_=Gn.G5){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let v=!1;const O=new Set;let D=-1;for(const w of this.view.allLayerViews.items)if(O.add(w.uid),(0,Ji.wP)(w))if(this._basemapLayerViewHandles.has(w.uid)){const te=this._layerClassFromLayerView(w),fe=this._getLayerIdxByUID(te,w.uid);(0,lt.pC)(fe)&&((fe<D||(0,lt.Wi)(D))&&(v=!0),D=fe)}else this._registerTiledLayerView(w),w.layer.loaded&&(v=!0);this._basemapLayerViewHandles.forEach((w,te)=>{O.has(te)||(this._unregisterTiledLayerView(te),v=!0)}),v&&this._updateTiledLayers(),this._renderer.isTransparent=this._allSurfaceLayersTransparent(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),_.madeProgress()}_allSurfaceLayersTransparent(){var v,O;let _=0===(null==(O=null==(v=this.view.map)?void 0:v.ground)?void 0:O.opacity);for(const D of this.view.allLayerViews.items)if((0,Ji.GL)(D)&&!(0,Ws.sy)(D.layer)&&0!==D.fullOpacity)return _=!1,_;return _}_hasCompositeBlendMode(){for(const _ of this.view.allLayerViews.items)if((0,Ji.TK)(_)){const v=(0,Ji.CY)(_.layer.parent)?"normal":_.layer.blendMode;if((0,id.MV)(id.pU[v]))return!0}return!1}_layerClassFromLayerView(_){return(0,Ji._1)(_)?An.ELEVATION:An.MAP}_registerTiledLayerView(_){const v=[],O=this._layerClassFromLayerView(_);v.push((0,pt.YP)(()=>_.suspended,()=>this._updateTiledLayers())),v.push((0,pt.YP)(()=>_.fullOpacity,()=>this._updateTileTextures(Ys.Ns.UNFADED))),v.push((0,pt.YP)(()=>"effectiveScaleRange"in _.layer?_.layer.effectiveScaleRange:null,()=>this._restartAllAgents(O))),(0,Ji.TK)(_)&&v.push((0,pt.YP)(()=>_.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(Ys.Ns.UNFADED)})),_.on("data-changed",()=>{const D=this._getLayerIdxByUID(O,_.uid);(0,lt.pC)(D)&&this._invalidateLayerData(D,O)}),this._basemapLayerViewHandles.set(_.uid,v)}_unregisterTiledLayerView(_){const v=this._basemapLayerViewHandles.get(_);if(v){for(let O=0;O<v.length;O++)v[O].remove();this._basemapLayerViewHandles.delete(_)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const v=[[],[]];let O=null;this.view.allLayerViews.forEach(D=>{if(!D.layer||D.suspended||!(0,Ji.wP)(D)||!D.fullExtent)return;const w=this._layerClassFromLayerView(D);if(w===An.MAP){const te=D.displayLevelRange.maxLevel;te!==1/0&&(null===O||te>O)&&(O=te)}v[w].push(D)});for(const D of zf){const w=this._layerViews[D],te=v[D];te.reverse();const fe=te.length;let Pe=w.length!==fe;const Ue=new Array(fe),Xe=new Array(w.length);this._layerIndexByUid[D].clear();for(let st=0;st<fe;st++){this._layerIndexByUid[D].set(te[st].uid,st);const Ct=w.indexOf(te[st]);Ue[st]=Ct,st!==Ct&&(Pe=!0),Ct>-1&&(Xe[Ct]=st)}if(Pe){const st=this._postorderIterator;for(st.reset(this.rootTiles);!st.done;)st.next().modifyLayers(Xe,Ue,D);this._layerViews[D]=te,this._restartAllAgents(D),this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(O)&&this._viewChangeUpdate()}_restartAllAgents(_){const v=this._postorderIterator;for(v.reset(this.rootTiles);!v.done;){const O=v.next();O.restartAgents(_),_===An.ELEVATION&&O.computeElevationBounds()}}layerViewByIndex(_,v){return this._layerViews[v][_]}numLayers(_){return this._layerViews[_].length}_updateTileTextures(_){this._allTiles.forAll(v=>{v.updateAgents(An.MAP),_===Ys.Ns.IMMEDIATE?this.renderer.updateTileTexture(v,zs.TEXTURE_NOFADING):v.updateRenderData(An.MAP,_)}),this._renderer.isTransparent=this._allSurfaceLayersTransparent()}_invalidateLayerData(_,v){this._allTiles.forAll(O=>O.removeLayerAgent(_,v)),this._allTiles.forAll(O=>O.invalidateLayerData(_,v))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(_=Fs.Xx.UPDATE){this.renderer.setNeedsRender(_)}requestUpdate(){1==++this._pendingUpdates&&(this._hasPendingUpdates=!0)}requestTileData(_,v,O,D){const w=this.layerViewByIndex(v,O),te=w.layer;return!te.tilemapCache||(0,Ji.Q)(w)?this._requestTileData(_,O,w,D):(++this._asyncWorkItems,te.tilemapCache.fetchAvailability(_.lij[0],_.lij[1],_.lij[2],yi(or({},D),{timeout:6e3})).then(()=>--this._asyncWorkItems).catch(fe=>{throw--this._asyncWorkItems,(0,zi.D_)(fe)||this._dataMissing(_,O,w,{notInTilemap:!0}),fe}).then(()=>this._frameTask.schedule(()=>this._requestTileData(_,O,w,D),D.signal)))}_requestTileData(_,v,O,D){return v===An.ELEVATION?(0,Ji._1)(O)?this._requestElevationTileData(_,O,D):Promise.reject():(0,Ji.GL)(O)?this._requestMapTileData(_,O,D):Promise.reject()}_requestElevationTileData(_,v,O){++this._asyncWorkItems;const D=fe=>{if((0,zi.Hc)(O))return;const Pe=this._layerIndexByUid[An.ELEVATION].get(v.uid);null!=Pe?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(_,Pe,fe)):dh.warn("TerrainSurface: received data from unknown layer %d %s",An.ELEVATION,_.lij.toString())},w=fe=>{(0,zi.D_)(fe)||(this._dataMissing(_,An.ELEVATION,v,fe),this.requestUpdate())};if((0,Ji.FZ)(v.layer))return v.layer.fetchTile(_.lij[0],_.lij[1],_.lij[2],{noDataValue:ks.$7,signal:O.signal}).then(fe=>{if(!(0,zi.Hc)(O))return this._frameTask.schedule(()=>D(fe),O.signal,w);dh.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},w).finally(()=>{--this._asyncWorkItems});const te=v.getTileUrl(_.lij[0],_.lij[1],_.lij[2]);return this._elevationDataRequester.request(te,"binary",O).then(fe=>this._lercDecoder.decode(fe,{noDataValue:ks.$7},O.signal)).then(fe=>{fe?D({values:fe.pixelData,width:fe.width,height:fe.height,noDataValue:fe.noDataValue,minValue:fe.minValue,maxValue:fe.maxValue}):w(new Error("LERC decoding failed"))},w).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(_,v,O){++this._asyncWorkItems;const D=(Xe,st)=>{--this._asyncWorkItems,(0,Ji.z4)(st),(0,zi.Hc)(O)||(this._dataMissing(_,An.MAP,v,Xe),this.requestUpdate())},w=Xe=>st=>D(st,Xe),te=Xe=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),(0,zi.Hc)(O)?(0,Ji.z4)(Xe):this._mapTileDataArrived(_,v,Xe)},O.signal,w(Xe)).catch(w(Xe)),fe=(Xe,st=null)=>this._frameTask.schedule(()=>D(Xe,st));if((0,Ji.Q)(v)){const Xe=v.schemaHelper.getLevelRowColumn(_.lij);return v.fetchTile(Xe[0],Xe[1],Xe[2],O).then(te,fe)}if((0,Ji.sR)(v))return v.fetchTile(_.lij[0],_.lij[1],_.lij[2],O).then(te,fe);if((0,Ji.FH)(v)&&(0,Ji.FZ)(v.layer))return v.layer.fetchTile(_.lij[0],_.lij[1],_.lij[2],O).then(Xe=>{if((0,zi.Hc)(O))return dh.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void fe((0,zi.zE)());te(Xe)},fe);let Pe=v.getTileUrl(_.lij[0],_.lij[1],_.lij[2]);return(0,NU.d)(v.layer)&&v.layer.refreshTimestamp&&(Pe+=`${Pe.includes("?")?"&":"?"}_ts=${v.layer.refreshTimestamp}`),this._mapDataRequester.request(Pe,v.hasMixedImageFormats?"image+type":"image",O).then(te,fe)}_mapTileDataArrived(_,v,O){const D=this._getLayerIdxByUID(An.MAP,v.uid);(0,lt.pC)(D)?_.dataArrived(D,An.MAP,O):((0,Ji.z4)(O),dh.warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(_,v){return this._layerIndexByUid[_].get(v)}_dataMissing(_,v,O,D){const w=this._getLayerIdxByUID(v,O.uid);(0,lt.pC)(w)?_.dataMissing(w,v,D):dh.warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(_){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(v=>{v.renderData&&this.overlayManager.setTileParameters(v)}),this._renderer.setNeedsRender(_))}get performanceInfo(){const _=this._performanceInfo;return _.numNodes=this._allTiles.length,_.numLeaves=_.numVisible=_.numRendered=_.numLoadedPerLevel.length=_.numRenderedPerLevel.length=0,this._allTiles.forAll(v=>{v.isLeaf&&_.numLeaves++;const O=v.level;v.renderData&&(_.numLoadedPerLevel[O]=(_.numLoadedPerLevel[O]||0)+1),v.visible&&(_.numVisible++,v.rendered&&(_.numRenderedPerLevel[O]=(_.numRenderedPerLevel[O]||0)+1,_.numRendered++))}),_}getUsedMemory(){return this.tilingScheme?((0,lt.Wi)(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory()),(0,lt.pC)(this._usedMemory)?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((_,v)=>_+v.usedMemory,0):null}getUsedMemoryForLayerView(_){let v=0;const O=this._layerClassFromLayerView(_),D=this._getLayerIdxByUID(O,_.uid);return(0,lt.pC)(D)&&this._allTiles.forAll(w=>v+=w.getUsedMemoryForLayer(O,D)),v}getTile(_){if((0,lt.Wi)(_)||(0,lt.Wi)(this.rootTiles))return null;const v=_.split("/").map(fe=>+fe);if(0===v[0])return this.rootTiles.find(fe=>fe.lij[1]===v[1]&&fe.lij[2]===v[2]);const O=2**v[0],D=Math.floor(v[1]/O),w=Math.floor(v[2]/O);let te;if(this.rootTiles.some(fe=>fe.lij[1]===D&&fe.lij[2]===w&&(te=fe,!0)),te){let fe=1<<v[0]-1;for(;te.lij[0]<v[0];){let Pe=v[1]&fe?2:0;if((v[2]&fe)>0&&Pe++,!te.children[Pe])return null;te=te.children[Pe],fe>>=1}return(0,Ji.wu)(te.lij[0]===v[0]&&te.lij[1]===v[1]&&te.lij[2]===v[2],"not the right tile?"),te}return null}get test(){const _=this;return{renderer:_._renderer,lercDecoder:_._lercDecoder,forceReload:()=>{(0,lt.pC)(_.rootTiles)&&(_._mergeTile(_.rootTiles[0]),_._viewChangeUpdate())},getTiles:()=>_._allTiles.toArray(),getRenderedTiles(){dC.clear(),_._allTiles.forAll(O=>{O.visible&&O.rendered&&dC.push(O)});const v=dC.toArray();return(0,xu.zW)(_.renderOrder,v),v},lockTilingScheme(v,O){_._extentHelper.defaultTiledLayersExtent=O,_.tilingSchemeLogic.test.lockTilingScheme(v)}}}checkAllTileWaterproofness(){if(!Ji.XJ)return;const _=this.rootTiles;if((0,lt.Wi)(_))return;const v=te=>{var fe,Pe,Ue;return(null==(Ue=null==(Pe=null==(fe=null==te?void 0:te.renderData)?void 0:fe.geometryInfo)?void 0:Pe.indices)?void 0:Ue.length)>0},O=(te,fe)=>{v(te)&&console.error("Tile[",te.lij,"] has geometry although parent[",fe.lij,"] has geom")},D=te=>{var fe,Pe,Ue;if(te.renderData&&!te.renderData.geometryState&&console.error("Tile[",te.lij,"] has renderData but not geometryState"),te.renderData&&!te.renderData.geometryInfo&&console.error("Tile[",te.lij,"] has renderData but not geometryInfo"),!(null==(fe=te.renderData)?void 0:fe.geometryInfo)||(null!=(Ue=null==(Pe=te.renderData.geometryInfo.indices)?void 0:Pe.length)?Ue:0)>0||console.error("Tile[",te.lij,"] has renderData but no indices - geometryInfo: ",te.renderData.geometryInfo),v(te)){te.checkGeometryWaterproofness();for(const Xe of te.children)O(Xe,te)}else if(te.isLeaf)console.error("Tile[",te.lij,"] has no geometry and no children, from root to leaf");else for(const Xe of te.children)D(Xe)},w=te=>{var Xe,st;const fe=null==(st=null==(Xe=te.parent)?void 0:Xe.visible)||st,Pe=te.visible;te.computeVisibility();const Ue=te.visible;if(Pe!==Ue&&fe&&console.error(" Tile[",te.lij,"] has out of date visibility: ",Pe," instead of ",Ue),!te.isLeaf)for(const vt of te.children)w(vt)};for(const te of _)D(te),w(te)}get isGlobal(){return this._isGlobal}get shadingEnabled(){return this._renderer.shadingEnabled}get isWebMercator(){var _;return!!(null==(_=this.tilingScheme)?void 0:_.spatialReference.isWebMercator)}get isWebMercatorOnPlateeCarree(){var _;return this.isWebMercator&&(0,qs.QM)(null==(_=this.view)?void 0:_.renderSpatialReference)}isEastEndWrap(_){return this.isGlobal&&_[2]===this.lijEastEnd(_[0])-1}isWestEndWrap(_){return this.isGlobal&&0===_[2]}lijEastEnd(_){return 2**(_+(this.spatialReference.isGeographic?1:0))}wrapEastWest(_){const v=this.lijEastEnd(_[0]),O=_[2];return 0<=O&&O<v?_:this.isGlobal?[_[0],_[1],(O+(O<0?v:0))%v]:null}};(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_renderer",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_hasPendingUpdates",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_asyncWorkItems",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_allTilesDirty",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_allTilesSorted",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_viewChanged",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"_watchUpdatingTracking",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_frameTask",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"snapLevel",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"lodSnapping",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Fn.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_userClippingExtent",null),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_rootTilesExtent",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"extent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"groundExtent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"_tilingSchemeExtent",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)(WU.q)],Fn.prototype,"updatingProgress",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"updatingProgressValue",null),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_maxNumUpdating",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"view.map.ground.opacity"})],Fn.prototype,"baseOpacity",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"hasCompositeBlendMode",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"overlayManager",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"viewingMode",null),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"maxTextureScale",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"ready",null),(0,Ze._)([(0,nt.Cb)({value:mg.FRONT_TO_BACK})],Fn.prototype,"renderOrder",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"rootTiles",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"spatialReference",null),(0,Ze._)([(0,nt.Cb)({type:ol.Z,aliasOf:"view.map.ground.surfaceColor"})],Fn.prototype,"backgroundColor",void 0),(0,Ze._)([(0,nt.Cb)({value:!1})],Fn.prototype,"slicePlaneEnabled",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"tilingScheme",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],Fn.prototype,"tilingSchemeLocked",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Fn.prototype,"tilingSchemeLogic",void 0),(0,Ze._)([(0,nt.Cb)({value:!0})],Fn.prototype,"velvetOverground",null),(0,Ze._)([(0,Ss.B)("_renderer.wireframe")],Fn.prototype,"wireframe",void 0),(0,Ze._)([(0,nt.Cb)({value:!1})],Fn.prototype,"suspended",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],Fn.prototype,"textureFadeDuration",void 0),(0,Ze._)([(0,nt.Cb)()],Fn.prototype,"_layerViewsDirty",void 0),(0,Ze._)([(0,Ss.B)("_renderer.renderPatchBorders")],Fn.prototype,"renderPatchBorders",void 0),(0,Ze._)([(0,Ss.B)("_renderer.renderingDisabled")],Fn.prototype,"renderingDisabled",void 0),Fn=(0,Ze._)([(0,ui.j)("esri.views.3d.terrain.TerrainSurface")],Fn);const w4=Fn;function Dx(_,v){return _[0]===v[0]&&_[1]===v[1]&&_[2]===v[2]}function Ax(_){return!_.isLeaf&&(_.children.some(v=>v.shouldLoad)||_.children.some(v=>Ax(v)))}const Jl=(0,vi.c)(),L4=(0,qr.Ue)(),$v=[0,0,0],dC=new Ua.Z,kv={spatialReference:null,tile:null,extent:null,context:"ground"},Yv={spatialReference:null,extent:null,scale:0};var Bl=T(2286),U4=T(26594),hC=T(24260),Sx=T(57851),la=T(54840);let Cg=class extends Bi.Z{constructor(_){super(_),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commit(_){this.dirty=!1,this._dirtyGeomRecords.forEach((v,O)=>this.commitLayer(O,_))}commitLayer(_,v){const O=this._dirtyGeomRecords.get(_);O&&(O.forEach((D,w)=>{const te=this._ensureGeomRecord(_,w);D.forEach((fe,Pe)=>{const Ue=fe[0],Xe=fe[1],st=fe[2];let vt=!1;if(Xe&la.$.Geometry.UPDATE){const Ct=te.get(Pe);if(Ct){const Wt=Ct[1];if(st&la.$.State.TRANSFORMATION){const Kt=this.model.getObject(w);this.model.updateRenderGeometryTransformation(Kt,Ue,Wt)&&(vt=!0)}vt||v.updates.push({renderGeometry:Wt,updateType:st})}else(0,Td.hu)(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(Xe&la.$.Geometry.REMOVE||vt){const Ct=te.get(Pe);Ct?(v.removes.push(Ct[1]),te.delete(Pe),Ct[0].disposed&&hC.k.pool.release(Ct[0])):Xe===la.$.Geometry.REMOVE&&(0,Td.hu)(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(Xe&la.$.Geometry.ADD||vt){const Ct=this.model.getObject(w);if((0,lt.pC)(Ct)){const Wt=this.model.getRenderGeometry(Ct,Ue),Kt=[Ue,Wt];v.adds.push(Wt),te.set(Pe,Kt)}}}),0===te.size&&this._residentGeomRecords.get(_).delete(w)}),0===this._residentGeomRecords.get(_).size&&this._residentGeomRecords.delete(_),this._dirtyGeomRecords.delete(_))}getResidentRenderGeometries(_,v){const O=this._residentGeomRecords.get(_);O&&O.forEach(D=>D.forEach(w=>v.push(w[1])))}_objectStateChanged(_,v){for(const O of v.geometryRecords)this._updateOrCreateDirtyRecord(v,O,null,la.$.Geometry.UPDATE,0,0,la.$.Geometry.UPDATE,la.$.Geometry.ADD|la.$.Geometry.REMOVE,_)}visibilityChanged(_){this._objectStateChanged(la.$.State.VISIBILITIES,_)}highlightChanged(_){this._objectStateChanged(la.$.State.HIGHLIGHTS,_)}occlusionChanged(_){this._objectStateChanged(la.$.State.OCCLUDEES,_)}vertexAttrsUpdated(_){this._updateOrCreateDirtyRecord(_.object,_.record,null,la.$.Geometry.UPDATE,0,0,la.$.Geometry.UPDATE,la.$.Geometry.ADD|la.$.Geometry.REMOVE,la.$.State.VERTEXATTRS)}layerAdded(_){_.objects.forAll(v=>this._layerObjectAdded(_,v))}layerRemoved(_){_.objects.forAll(v=>this._layerObjectRemoved(_,v))}layerObjectAdded(_){this._layerObjectAdded(_.layer,_.object)}_layerObjectAdded(_,v){const O=_.id;for(const D of v.geometryRecords)this._objectGeometryAdded(v,D,O)}layerObjectRemoved(_){this._layerObjectRemoved(_.layer,_.object)}layerObjectsAdded(_){for(const v of _.objects)this._layerObjectAdded(_.layer,v)}layerObjectsRemoved(_){for(const v of _.objects)this._layerObjectRemoved(_.layer,v)}_layerObjectRemoved(_,v){const O=_.id;for(const D of v.geometryRecords)this._objectGeometryRemoved(v,D,O)}shaderTransformationChanged(_){const v=this._residentGeomRecords.get(_.id);v&&v.forEach((O,D)=>{const w=this.model.getObject(D);w&&w.hasVolativeTransformation()&&O.forEach(te=>{te[1].shaderTransformationChanged()})})}objectTransformation(_){const v=this._getParentLayerId(_);this._ensureGeomRecord(v,_.id).forEach(D=>{this._updateOrCreateDirtyRecord(_,D[0],v,la.$.Geometry.UPDATE,0,0,la.$.Geometry.UPDATE,la.$.Geometry.ADD|la.$.Geometry.REMOVE,la.$.State.TRANSFORMATION)})}objectGeometryAdded(_){this._objectGeometryAdded(_.object,_.record)}_objectGeometryAdded(_,v,O=null){this._updateOrCreateDirtyRecord(_,v,O,la.$.Geometry.ADD,la.$.Geometry.REMOVE,0,0,0)}objectGeometryRemoved(_){this._objectGeometryRemoved(_.object,_.record)}_objectGeometryRemoved(_,v,O=null){this._updateOrCreateDirtyRecord(_,v,O,la.$.Geometry.REMOVE,la.$.Geometry.ADD,la.$.Geometry.UPDATE,0,0)}_updateOrCreateDirtyRecord(_,v,O,D,w,te,fe,Pe,Ue){O=(0,lt.Pt)(O,this._getParentLayerId(_));const st=v.id,vt=this._ensureDirtyRecord(O,_.id),Ct=vt.get(st);if(Ct){const Wt=Ct[1];Wt&w?(vt.delete(st),Ct[0].disposed&&hC.k.pool.release(Ct[0])):Wt&te?(Ct[1]=D,Ct[2]=Ue):Wt&fe?Ct[2]|=Ue:Wt&Pe||(0,Td.hu)(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")}else vt.set(st,[v,D,Ue]);this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(_,v){let O=this._residentGeomRecords.get(_);O||(O=new Map,this._residentGeomRecords.set(_,O));let D=O.get(v);return D||(D=new Map,O.set(v,D)),D}get _hasDirtyGeometryRecords(){return(0,ya.oE)(this._dirtyGeomRecords,_=>(0,ya.oE)(_,v=>v&&v.size>0))}_ensureDirtyRecord(_,v){let O=this._dirtyGeomRecords.get(_);O||(O=new Map,this._dirtyGeomRecords.set(_,O));let D=O.get(v);return D||(D=new Map,O.set(v,D)),D}_getParentLayerId(_){return(0,lt.pC)(_.parentLayer)?_.parentLayer.id:lv.u}formatDebugInfo(){const _=["ADD","UPD",void 0,"REM"];let v="";return this._dirtyGeomRecords.forEach((O,D)=>{O.forEach((w,te)=>{v.length>0&&(v+="\n"),v+=D+"."+te;const fe=[];w.forEach(Pe=>{const Ue=Pe[1];fe[Ue]||(fe[Ue]=[]),fe[Ue].push(Pe[0].geometry.id)});for(let Pe=0;Pe<fe.length;Pe++)if(fe[Pe]){v+=" "+_[Pe-1]+": ";for(let Ue=0;Ue<fe[Pe].length;Ue++)v+=fe[Pe][Ue]+", "}})}),v}get test(){const _=this;return{get residentLayerCount(){return _._residentGeomRecords.size},get residentObjectCount(){return Array.from(_._residentGeomRecords.values()).reduce((v,O)=>v+O.size,0)}}}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Cg.prototype,"model",void 0),(0,Ze._)([(0,nt.Cb)()],Cg.prototype,"dirty",void 0),Cg=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.lib.ModelDirtySet")],Cg);const B4=Cg;var N4=T(53855);let Jv=class extends Bi.Z{constructor(){super(...arguments),this.dirtySet=new B4({model:this}),this._content=new Map,this._originFactory=new Sx.C(null,75e4)}getObject(_){return this._content.get(_)}add(_){const v=_.id;(0,Td.hu)(!this._content.has(v),"Model/Stage already contains object to be added"),this._content.set(v,_),(0,sg.e)(_)&&this.dirtySet.layerAdded(_)}remove(_){(0,Td.hu)(this._content.has(_.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(_.id),_.unload(),(0,sg.e)(_)&&this.dirtySet.layerRemoved(_)}addMany(_){for(const v of _)(0,lt.pC)(v)&&((0,Td.hu)(!this._content.has(v.id),"Model/Stage already contains object to be added"),this._content.set(v.id,v))}removeMany(_){for(const v of _)(0,Td.hu)(this._content.has(v.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(v.id),v.unload()}has(_){return this._content.has(_.id)}forEachOfType(_,v){this._content.forEach(O=>{O.type===_&&v(O)})}getRenderGeometry(_,v){const{geometry:O,material:D,id:w,shaderTransformation:te,origin:fe,instanceParameters:Pe}=v,Ue=new N4.z(O,D,{id:w,boundingInfo:O.boundingInfo,calculateShaderTransformation:te,castShadow:_.castShadow});return Ue.updateTransformation(Xe=>_.getCombinedStaticTransformation(v,Xe)),Ue.origin=fe||this._originFactory.getOrigin(Ue.boundingSphere),Ue.instanceParameters=Pe,Ue}updateRenderGeometryTransformation(_,v,O){if((0,lt.Wi)(_))return!1;O.updateTransformation(w=>_.getCombinedStaticTransformation(v,w));const D=this._originFactory.getOrigin(O.boundingSphere);return O.origin!==D}getStats(){const _={},v=Array.from(this._content.values());for(let O=0;O<lb.U.COUNT;++O)_[O]=v.filter(D=>D.type===O).length;return{contentTypes:_,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Jv.prototype,"dirtySet",void 0),Jv=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.parts.Model")],Jv);var j4=T(79800),Rx=T(9554),F4=T(42964),Tg=T(9044),Mg=T(93394),W4=T(55713);class V4{constructor(v){this._totalCount=v,this._indexRanges=[0,v]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return 0===this._indexRanges.length}componentCount(){const v=this._indexRanges;let O=0;for(let D=0;D<v.length;D+=2)O+=v[D+1];return O}reset(v){this._indexRanges="all"===v||v.length===this._totalCount?[0,this._totalCount]:function z4(_){const v=new Array;if(0===_.length)return v;let O=_[0],D=1;for(let w=1;w<_.length;w++){const te=_[w];O+D===te?D+=1:(v.push(O),v.push(D),O=te,D=1)}return v.push(O),v.push(D),v}(v)}forEachComponent(v){const O=this._indexRanges;for(let D=0;D<O.length;D+=2){const w=O[D],te=w+O[D+1];for(let fe=w;fe<te;fe++)if(!v(fe))return!1}return!0}forEachComponentRange(v){const O=this._indexRanges;for(let D=0;D<O.length;D+=2){const w=O[D];if(!v(w,w+O[D+1]))return!1}return!0}computeOffsetRanges(v){const O=new Array(this._indexRanges.length),D=this._indexRanges;for(let w=0;w<D.length;w+=2){const te=D[w],Pe=v[te],Ue=v[te+D[w+1]];O[w]=Pe,O[w+1]=Ue-Pe}return O}}class G4 extends Bl.Xn{constructor(v,O){super(),this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null,this.offsets=(0,W4.tP)(O);const D=this.count;this.visibility=new V4(D),this.materialDataBuffer=v.getBuffer(D),this.materialDataIndices=new Uint16Array(D);for(let w=0;w<D;w++)this.materialDataIndices[w]=this.materialDataBuffer.acquireIndex()}dispose(){super.dispose();for(let v=0;v<this.count;v++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[v])}get count(){return this.offsets.length-1}get geometryRanges(){return(0,lt.Wi)(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return(0,lt.Wi)(this.highlightCounts)?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return(0,lt.Wi)(this.highlightCounts)?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if(((0,lt.Wi)(this.cachedHighlightRanges)||(0,lt.Wi)(this.cachedDefaultRanges))&&(0,lt.pC)(this.highlightCounts)){const{highlightRanges:v,defaultRanges:O}=function H4(_,v,O){const D=[],w=[];let te=O.length,fe=O.length;return v.forEachComponent(Pe=>(_[Pe]>0?(te!==Pe-1&&(D.length&&D.push(O[te+1]-D[D.length-1]),D.push(O[Pe])),te=Pe):(fe!==Pe-1&&(w.length&&w.push(O[fe+1]-w[w.length-1]),w.push(O[Pe])),fe=Pe),!0)),D.length&&D.push(O[te+1]-D[D.length-1]),w.length&&w.push(O[fe+1]-w[w.length-1]),{highlightRanges:D,defaultRanges:w}}(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=v,this.cachedDefaultRanges=O}}}var Xv=T(24225);function K4(_,v,O,D){if(O>=v)return _;null==_&&(_=function Z4(_=!0){return{isVisibleBit:!_,data:new Uint32Array(0)}}());const w=_.isVisibleBit;let te=_.data;const fe=Ix(te),Pe=O/fe|0,Ue=O-fe*Pe,Xe=(v-1)/fe|0,st=te,vt=D===w;if(!(O<st.length*fe)&&vt){const Wt=Pe+1,Kt=Math.ceil(1.5*st.length),Lt=Xe+1;let nr=Math.max(Wt,Kt);nr=Math.min(nr,Lt),te=new Uint32Array(nr),te.set(st)}return Pe<te.length&&(te[Pe]=function k4(_,v,O){return _&~(1<<v)|(O?1:0)<<v}(te[Pe],Ue,vt)),_.data=te,_}function wx(_,v){if(null==_)return!0;const{isVisibleBit:O,data:D}=_,w=Ix(D);return v<D.length*w?function $4(_,v,O,D){const w=O/D|0;return function Y4(_,v){return 0!=(_&1<<v)}(v[w],O-w*D)===_}(O,D,v,w):!_.isVisibleBit}function Ix(_){return 8*_.BYTES_PER_ELEMENT}var J4=T(36848);class X4{constructor(v,O){this._indices=(0,lt.pC)(v.indices)?v.indices:(0,J4.p)(v.positions.length/3),this._positions=new Fv.ct(v.positions),this._components=O,this._componentIntersectionData=new Array(O.count)}getComponentAabb(v,O){if((0,lt.pC)(this._perComponentAabbs)){for(let D=0;D<6;D++)O[D]=this._perComponentAabbs[6*v+D];return O}return this._computePerComponentAabbs(),this.getComponentAabb(v,O)}getComponentPositions(v,O){O.indices=this._indices,O.data=this._positions.typedBuffer,O.stride=this._positions.typedBufferStride,O.startIndex=this._components.offsets[v],O.endIndex=this._components.offsets[v+1]}intersect(v,O,D,w,te,fe,Pe){const Ue={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},Xe=this._indices,st=this._components.offsets,vt=(0,Kf.Ue)(v,O,Q4),Ct=v[2],Wt=O[2];this._components.visibility.forEachComponent(Kt=>{if(!wx(this._components.pickability,Kt))return!0;const Lt=this.getComponentAabb(Kt,q4);if((0,lt.pC)(fe)){const br=fe[Kt];(0,lt.pC)(te)?te.componentOffset=br:(v[2]=Ct-br,O[2]=Wt-br)}if((0,lt.pC)(te)&&te.applyToAabb(Lt),!(0,Kf.Tw)(Lt,v,vt,D))return!0;const nr=st[Kt]/3,sr=st[Kt+1]/3,Er=(br,Rr,$r)=>{Pe(Kt,br,(0,_t.t)(Rr,Rr,w),$r)},yr=sr-nr;return(0,lt.Wi)(te)&&yr>200?(null==this._componentIntersectionData[Kt]&&(this._componentIntersectionData[Kt]=new Cx(this._indices,nr,sr,Ue)),this._componentIntersectionData[Kt].intersectRay({r0:v,r1:O},Er)):(0,Kf.CN)(v,O,nr,sr,Xe,Ue,void 0,te,Er),!0})}_computePerComponentAabbs(){const v=this._components.count;this._perComponentAabbs=new Float32Array(6*v);const O=this._indices,D=this._positions.typedBuffer,w=this._positions.typedBufferStride,te=this._components.offsets;let fe=0;for(let Pe=0;Pe<v;Pe++){const Xe=te[Pe+1];let st=1/0,vt=1/0,Ct=1/0,Wt=-1/0,Kt=-1/0,Lt=-1/0;for(let nr=te[Pe];nr<Xe;nr++){const sr=O[nr]*w,Er=D[sr],yr=D[sr+1],br=D[sr+2];st=Math.min(st,Er),vt=Math.min(vt,yr),Ct=Math.min(Ct,br),Wt=Math.max(Wt,Er),Kt=Math.max(Kt,yr),Lt=Math.max(Lt,br)}this._perComponentAabbs[fe++]=st,this._perComponentAabbs[fe++]=vt,this._perComponentAabbs[fe++]=Ct,this._perComponentAabbs[fe++]=Wt,this._perComponentAabbs[fe++]=Kt,this._perComponentAabbs[fe++]=Lt}}get positions(){return this._positions}get indices(){return this._indices}}const Q4=(0,$t.c)(),q4=(0,Ea.Ue)();class e6{constructor(v,O,D){this.material=v,this.geometry=O,this.meta=D}dispose(){this.material.dispose(),this.geometry.dispose()}}class Lx extends Bl.Xn{constructor(v,O,D,w){super(),this.primitiveType=O,this.parameters=D,this.indexed=w,this.vao=v}}function Og(_){return _?Pg(_,1/0,-1/0):function t6(_,v){return{near:_,far:v}}(1/0,-1/0)}function Pg(_,v,O){return _.near=v,_.far=O,_}function X_(_,v,O=_){return O.near=Math.min(_.near,v.near),O.far=Math.max(_.far,v.far),O}function Qv(_,v){return _.near<=v&&v<=_.far}(0,Ze._)([(0,Bl.gT)()],Lx.prototype,"vao",void 0);const pC={near:0,far:0};const qv=new Ua.Z({allocator:_=>_||{near:1/0,far:-1/0,mask:0,object:null},deallocator:_=>(_.object=null,_)}),zp=Og(),qc=(0,$t.c)(),$f=(0,$t.c)(),i6=new Ua.Z({deallocator:null}),s6=new Ua.Z({deallocator:null});function n6(_,v,O){O.length=0;const D=v.length-3;fC(qc,v,D);const w=(0,Io.jH)(_,qc);w<=0&&(O.push(qc[0]),O.push(qc[1]),O.push(qc[2]));let te=0,fe=w;for(;te<D;te+=3){fC($f,v,te);const Pe=(0,Io.jH)(_,$f);fe*Pe<0&&((0,_t.h)(qc,$f,qc,Pe/(Pe-fe)),eu(O,qc)),Pe<=0&&eu(O,$f),fe=Pe,(0,_t.c)(qc,$f)}fe*w<0&&(fC($f,v,D),(0,_t.h)(qc,$f,qc,w/(w-fe)),eu(O,qc))}function fC(_,v,O){return(0,_t.s)(_,v.data[O+0],v.data[O+1],v.data[O+2])}function eu(_,v){_.push(v[0]),_.push(v[1]),_.push(v[2])}function o6(_,v,O,D){(0,Tm.c)(Nx,_.quaternion),(0,_t.v)(od,v,_.center),(0,_t.q)(od,od,Nx);const w=8*((od[0]<-_.halfSize[0]?-1:od[0]>_.halfSize[0]?1:0)+3*(od[1]<-_.halfSize[1]?-1:od[1]>_.halfSize[1]?1:0)+9*(od[2]<-_.halfSize[2]?-1:od[2]>_.halfSize[2]?1:0)+13),te=Ux[w];if(0===te)return te;(0,Aa.g)(eE,_.quaternion),(0,Aa.d)(eE,eE,_.halfSize);const fe=(Pe,Ue)=>{const Xe=Ux[w+Ue+1];return(0,_t.s)(Pe,((1&Xe)<<1)-1,(2&Xe)-1,((4&Xe)>>1)-1),(0,_t.t)(Pe,Pe,eE),(0,_t.a)(Pe,_.center,Pe)};return O.length=0,eu(O,fe(_C,0)),eu(O,fe(jx,1)),eu(O,fe(od,2)),eu(O,fe(Fx,3)),D(O),1===te||(O.length=0,eu(O,_C),eu(O,Fx),eu(O,fe(od,4)),eu(O,fe(Wx,5)),D(O),2===te||(O.length=0,eu(O,_C),eu(O,Wx),eu(O,fe(od,6)),eu(O,jx),D(O))),te}const Ux=(()=>{const _=new Int8Array(216);let v=0;const O=D=>{for(let w=0;w<D.length;w++)_[v+w]=D[w];v+=8};return O([3,0,6,2,3,1,5,4]),O([2,0,2,3,1,5,4,0]),O([3,1,0,2,3,7,5,4]),O([2,0,1,3,2,6,4,0]),O([1,0,1,3,2,0,0,0]),O([2,1,5,7,3,2,0,0]),O([3,2,0,1,3,7,6,4]),O([2,2,0,1,3,7,6,0]),O([3,3,0,1,5,7,6,2]),O([2,0,1,5,4,6,2,0]),O([1,0,1,5,4,0,0,0]),O([2,1,3,7,5,4,0,0]),O([1,0,2,6,4,0,0,0]),O([0,0,0,0,0,0,0,0]),O([1,1,3,7,5,0,0,0]),O([2,2,3,7,6,4,0,0]),O([1,2,3,7,6,0,0,0]),O([2,3,1,5,7,6,2,0]),O([3,4,0,1,5,7,6,2]),O([2,5,7,6,4,0,1,0]),O([3,5,0,1,3,7,6,4]),O([2,4,5,7,6,2,0,0]),O([1,4,5,7,6,0,0,0]),O([2,5,1,3,7,6,4,0]),O([3,6,0,2,3,7,5,4]),O([2,6,2,3,7,5,4,0]),O([3,7,6,2,3,1,5,4]),_})(),Bx=4,eE=(0,Mp.c)(),Nx=(0,Mm.a)(),od=(0,$t.c)(),_C=(0,$t.c)(),jx=(0,$t.c)(),Fx=(0,$t.c)(),Wx=(0,$t.c)();class l6{constructor(v){this._objects=v}submit(v,O){this._objects.preSubmit(O),this._objects.visibleObjects.forAll(D=>D.renderable.material.submit(v,O,D))}queryShadowCasterDepthRange(v){return this._objects.visibleObjects.length?function r6(_,v){const O=Og(),{eye:D,frustum:w,viewForward:te}=_;v.forAll(fe=>{const Pe=(0,lt.pC)(fe.offsetObb)?fe.offsetObb:fe.obb,Ue=(0,_t.e)((0,_t.v)(od,Pe.center,D),te),Xe=(0,Mg.xz)(Pe,te);if(Qv(O,Ue-Xe)&&Qv(O,Ue+Xe))return;const st=function a6(_,v){let O=0;for(let D=0;D<Bx;D++){const w=(0,Mg.hZ)(_,v[D]);if(w>0)return-1;0===w&&(O|=1<<D)}return O}(Pe,w);if(-1===st)return;if(0===st)return zp.far=Ue+Xe,zp.near=Ue-Xe,void X_(O,zp);const vt=qv.pushNew();vt.near=Ue-Xe,vt.far=Ue+Xe,vt.mask=st,vt.object=fe});for(let fe=0;fe<qv.length;fe++){const Pe=qv.data[fe];Qv(O,Pe.near)&&Qv(O,Pe.far)||(zp.far=Pe.far,zp.near=1/0,0===o6((0,lt.pC)(Pe.object.offsetObb)?Pe.object.offsetObb:Pe.object.obb,D,i6,Xe=>{let st=s6;for(let vt=0;vt<Bx&&Xe.length>0;vt++){if(0==(Pe.mask&1<<vt))continue;n6(w[vt],Xe,st);const Ct=Xe;Xe=st,st=Ct}for(let vt=0;vt<Xe.length;vt+=3){(0,_t.s)(qc,Xe.data[vt+0],Xe.data[vt+1],Xe.data[vt+2]);const Ct=(0,_t.e)((0,_t.v)(qc,qc,D),te);zp.near=Math.min(zp.near,Ct)}})&&(zp.near=0),X_(O,zp))}return qv.length=0,O}(v,this._objects.visibleObjects):null}}var c6=T(27355),$0=T(75550),xg=T(35357),mC=T(15261),Vx=T(7228),Q_=T(88569);class tE extends vo.A{bindDraw(v,O){const D=this.program;D.bindDraw(v,O),D.rebindTextures(),v.componentParameters.type===xg._N.Varying&&v.componentParameters.texture.bind(D,"componentColorTex","componentColorTexInvDim")}initializeConfiguration(v,O){O.spherical=v.viewingMode===Us.JY.Global,O.doublePrecisionRequiresObfuscation=(0,Vx.I)(v.rctx)}initializeProgram(v){const O=tE.shader.get(),D=O.build(this.configuration);return new ea.$(v.rctx,D,O.attributeLocations)}_setPipelineState(v){const O=this.configuration,D=O.integratedMeshMode!==$0.OH.None,w=v===Fs.Am.NONE,te=v===Fs.Am.FrontFace;return(0,ls.sm)({blending:O.output!==Ac.H.Color&&O.output!==Ac.H.Alpha||!O.blendingEnabled?null:w?Q_.wu:(0,Q_.j7)(v),culling:(0,ls.zp)(O.cullFace),depthTest:{func:(0,Q_.Bh)(v)},depthWrite:w||te?ls.LZ:null,colorWrite:ls.BK,stencilWrite:D||O.hasOccludees?Hv.s3:null,stencilTest:D?(0,Hv.ec)(Fs.hU.IntegratedMeshMaskExcluded):O.hasOccludees?Hv.RY:null,polygonOffset:w||te?O.hasPolygonOffset?{factor:2,units:2}:null:Q_.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}tE.shader=new vn.J(mC.C,()=>T.e(5905).then(T.bind(T,73208)));var Dg=T(50574);class u6 extends Zc.K{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,null!=this._parameterBlocks)for(const v of this._parameterBlocks)this[v]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(null==this._parameterBlocks)return!1;for(const v of this._parameterBlocks)if(this[v].dirty)return!0;return!1}}class gC{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}}function ca(_={}){return(v,O)=>{var w;const D=null!=(w=v._parameterCount)?w:0;if(v._parameterCount=D+1,_.vectorOps){const te=_.vectorOps;Object.defineProperty(v,O,{get(){return this[D]},set(fe){const Pe=this[D];if(null==Pe)this[D]=fe;else{if(te.equals(Pe,fe))return;te.copy(Pe,fe)}this._setDirty()}})}else Object.defineProperty(v,O,{get(){return this[D]},set(te){this[D]!==te&&(_.dispose&&this[D]&&this[D].dispose(),this[D]=te,this._setDirty())}})}}function zx(){return(_,v)=>{var D;const O=null!=(D=_._parameterCount)?D:0;_._parameterCount=O+1,_._parameterBlocks=_._parameterBlocks||[],_._parameterBlocks.push(O),Object.defineProperty(_,v,{get(){return this[O]},set(w){this[O]!==w&&(this[O]=w,this._setDirty())}})}}var Ta=T(43553),yC=T(26859),Gx=T(96395),d6=T(67022),h6=T(22799);class rE{constructor(v){this._low=(0,tl.c)(),this._high=(0,tl.c)(),v&&this.set(v)}get low(){return this._low}get high(){return this._high}set(v){const O=this._low,D=this._high;(0,_t.c)(O,v),(0,_t.v)(D,v,O)}setElements(v,O,D){(0,_t.s)(Hx,v,O,D),this.set(Hx)}get(v){return(0,_t.a)(v,this._low,this._high)}getLowScaled(v){return(0,_t.g)(v,this._low,1)}}const Hx=(0,$t.c)();class gl extends u6{constructor(v,O){super(),this.toMapSpace=O,this.baseColor=(0,jf.f)(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=(0,tl.f)(1,1,.5),this.emissiveFactor=(0,tl.f)(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new iE,this.componentParameters=new Ag,this.textureAlphaCutoff=d6.F,this.alphaDiscardMode=Fs.JJ.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=h6.U.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new $0._O;const D=new rE(v.position),w=(0,H_.a)(v.rotationScale);(0,Aa.e)(w,w),this.transformNormalGlobalFromModel=(0,Aa.t)(w,w),this.transformWorldFromModelTL=D.low,this.transformWorldFromModelTH=D.high,this.transformWorldFromModelRS=v.rotationScale}dispose(){this._technique=(0,lt.RY)(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return(0,lt.pC)(this.baseColorTexture)?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return(0,lt.pC)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return(0,lt.pC)(this.emissionTexture)?this.emissionTexture.glTexture:null}get textureOcclusion(){return(0,lt.pC)(this.occlusionTexture)?this.occlusionTexture.glTexture:null}get textureNormal(){return(0,lt.pC)(this.normalTexture)?this.normalTexture.glTexture:null}prepareTechnique(v,O,D,w){const te=this._techniqueConfiguration;te.hasVertexColors=w.colors,te.hasNormals=w.normals,te.textureCoordinateType=w.textureCoordinates,te.hasMetalnessAndRoughnessTexture=(0,lt.pC)(this.metallicRoughnessTexture),te.hasEmissionTexture=(0,lt.pC)(this.emissionTexture),te.hasOcclusionTexture=(0,lt.pC)(this.occlusionTexture),te.hasNormalTexture=(0,lt.pC)(this.normalTexture),te.transparencyPassType=O.identifier===Ta.o9.Material&&null!=D.transparencyPassType?D.transparencyPassType:Fs.Am.NONE,te.hasMultipassTerrain=O.identifier===Ta.o9.Material&&null!=D.multipassTerrain&&D.multipassTerrain.enabled,te.cullAboveGround=O.identifier===Ta.o9.Material&&null!=D.multipassTerrain&&D.multipassTerrain.cullAboveGround,te.ellipsoidMode=this.ellipsoidMode,te.componentData=this.componentParameters.type,te.cullFace=this.commonMaterialParameters.cullFace,te.doubleSidedMode=this.commonMaterialParameters.doubleSided?Gx.q.View:Gx.q.None,te.hasBaseColorTexture=(0,lt.pC)(this.baseColorTexture);const fe=this._computeWhichMaterialPass();te.blendingEnabled=fe===Sc.Transparent||fe===Sc.OpaqueAndTransparent,te.alphaDiscardMode=this.alphaDiscardMode,te.integratedMeshMode=this.isIntegratedMesh?function _6(_){return 0!==_.overlays.length&&(0,lt.pC)(_.overlays[Ys.fu.INNER].getColorTextureNoRasterImage())}(D)?(0,mC.g)(D)?$0.OH.ColorOverlayWithWater:$0.OH.ColorOverlay:$0.OH.NoOverlay:$0.OH.None,te.isGround=this.isIntegratedMesh,te.hasPolygonOffset=this.polygonOffsetEnabled;const Pe=this.hasParametersFromSource&&(0,lt.Wi)(this.baseColorTexture);return te.pbrMode=te.integratedMeshMode===$0.OH.ColorOverlayWithWater?bg.f7.WaterOnIntegratedMesh:this.usePBR?Pe?bg.f7.Schematic:bg.f7.Normal:bg.f7.Disabled,te.normalType=te.integratedMeshMode===$0.OH.None?te.hasNormals?yC.h.CompressedAttribute:yC.h.ScreenDerivative:yC.h.Ground,te.hasSlicePlane=(0,lt.pC)(D.slicePlane)&&this.commonMaterialParameters.hasSlicePlane,O.identifier===Ta.o9.ShadowMap?(te.output=Ac.H.Shadow,te.vertexDiscardMode=Dg.a.None):O.identifier===Ta.o9.Highlight?(te.output=Ac.H.Highlight,te.vertexDiscardMode=Dg.a.None):(te.vertexDiscardMode=this._computeWhichMaterialPass()===Sc.OpaqueAndTransparent?O.transparent?Dg.a.Opaque:Dg.a.Transparent:Dg.a.None,te.output=function p6(_){switch(_){case Ta.zp.Color:return Ac.H.Color;case Ta.zp.Alpha:return Ac.H.Alpha;case Ta.zp.Depth:return Ac.H.Depth;case Ta.zp.Normal:return Ac.H.Normal}}(O.subPass),O.subPass===Ta.zp.Alpha&&(te.hasOccludees=D.hasOccludees),O.subPass===Ta.zp.Color?(te.receiveAmbientOcclusion=D.ssaoHelper.ready,te.hasOccludees=D.hasOccludees,te.receiveShadows=D.shadowMap.ready,te.hasScreenSpaceReflections=D.ssr.enabled,te.hasCloudsReflections=(0,lt.pC)(D.clouds.data)):(te.receiveAmbientOcclusion=!1,te.receiveShadows=!1),te.snowCover=this.hasSnowCover(D)),this._technique=v.releaseAndAcquire(tE,te,this._technique),this._setClean(),this._technique}hasSnowCover(v){return(0,lt.pC)(v.weather)&&v.weatherVisible&&"snowy"===v.weather.type&&"enabled"===v.weather.snowCover}submit(v,O,D){if(0===this.objectOpacity)return;const w=D.renderable.geometry,te=D.components,fe=D.renderable.meta.cameraDepthSquared,Pe=te.geometryRanges,Ue=te.highlightRanges,Xe=te.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case Sc.Opaque:v.materialOpaque.submitDraw(this,w,Pe,fe);break;case Sc.Transparent:v.materialTransparent.submitDraw(this,w,Pe,fe);break;case Sc.OpaqueAndTransparent:v.materialOpaque.submitDraw(this,w,Pe,fe),v.materialTransparent.submitDraw(this,w,Pe,fe);break;case Sc.IntegratedMesh:v.materialIntegratedMesh.submitDraw(this,w,Pe,fe),function f6(_){return 0!==_.overlays.length&&(0,lt.pC)(_.overlays[Ys.fu.INNER].getValidTexture(Ys.NH.Highlight))}(O)&&v.highlightIntegratedMesh.submitDraw(this,w,Pe,fe)}const st=this.componentParameters.castShadows!==sl.None;st&&v.shadowMap.submitDraw(this,w,Pe,fe),(0,lt.pC)(Ue)&&(v.highlight.submitDraw(this,w,Ue,fe),st&&v.highlightShadowMap.submitDraw(this,w,Ue,fe)),st&&(0,lt.pC)(Xe)&&v.defaultShadowMap.submitDraw(this,w,Xe,fe)}get attributeLocations(){return mC.a}_computeWhichMaterialPass(){return this.isIntegratedMesh?Sc.IntegratedMesh:this.objectOpacity<1?Sc.Transparent:this.componentParameters.opaqueOverride===sl.All?Sc.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Fs.JJ.Blend||this.alphaDiscardMode===Fs.JJ.MaskBlend?Sc.Transparent:this.componentParameters.transparent===sl.None?Sc.Opaque:this.componentParameters.transparent===sl.All?Sc.Transparent:Sc.OpaqueAndTransparent}}var Kx,Sc,sl;(0,Ze._)([ca({vectorOps:Sl.v})],gl.prototype,"baseColor",void 0),(0,Ze._)([ca()],gl.prototype,"usePBR",void 0),(0,Ze._)([ca()],gl.prototype,"hasParametersFromSource",void 0),(0,Ze._)([ca({vectorOps:_t.F})],gl.prototype,"mrrFactors",void 0),(0,Ze._)([ca({vectorOps:_t.F})],gl.prototype,"emissiveFactor",void 0),(0,Ze._)([ca({dispose:!0})],gl.prototype,"baseColorTexture",void 0),(0,Ze._)([ca({dispose:!0})],gl.prototype,"metallicRoughnessTexture",void 0),(0,Ze._)([ca({dispose:!0})],gl.prototype,"emissionTexture",void 0),(0,Ze._)([ca({dispose:!0})],gl.prototype,"occlusionTexture",void 0),(0,Ze._)([ca({dispose:!0})],gl.prototype,"normalTexture",void 0),(0,Ze._)([ca()],gl.prototype,"objectOpacity",void 0),(0,Ze._)([zx()],gl.prototype,"commonMaterialParameters",void 0),(0,Ze._)([zx()],gl.prototype,"componentParameters",void 0),(0,Ze._)([ca()],gl.prototype,"textureAlphaCutoff",void 0),(0,Ze._)([ca()],gl.prototype,"alphaDiscardMode",void 0),(0,Ze._)([ca()],gl.prototype,"isIntegratedMesh",void 0),(0,Ze._)([ca()],gl.prototype,"polygonOffsetEnabled",void 0),(0,Ze._)([ca()],gl.prototype,"ellipsoidMode",void 0),(0,Ze._)([ca()],gl.prototype,"hasOccludees",void 0),function(_){_[_.VERTEX=0]="VERTEX",_[_.GROUND=1]="GROUND",_[_.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"}(Kx||(Kx={})),function(_){_[_.Opaque=0]="Opaque",_[_.Transparent=1]="Transparent",_[_.OpaqueAndTransparent=2]="OpaqueAndTransparent",_[_.IntegratedMesh=3]="IntegratedMesh"}(Sc||(Sc={}));class iE extends gC{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Fs.Vr.Back,this.hasSlicePlane=!0}}(0,Ze._)([ca()],iE.prototype,"doubleSided",void 0),(0,Ze._)([ca()],iE.prototype,"cullFace",void 0),(0,Ze._)([ca()],iE.prototype,"hasSlicePlane",void 0);class Ag extends gC{constructor(){super(...arguments),this.externalColor=(0,jf.f)(1,1,1,1),this.externalColorMixMode=Tg.a9.Multiply,this.castShadows=sl.All}get transparent(){return this.externalColor[3]<1?sl.All:sl.None}get opaqueOverride(){return this.externalColorMixMode===Tg.a9.Replace&&1===this.externalColor[3]?sl.All:sl.None}get visible(){return this.externalColor[3]>0?sl.All:sl.None}get type(){return xg._N.Uniform}}(0,Ze._)([ca({vectorOps:Sl.v})],Ag.prototype,"externalColor",void 0),(0,Ze._)([ca()],Ag.prototype,"externalColorMixMode",void 0),(0,Ze._)([ca()],Ag.prototype,"castShadows",void 0),function(_){_[_.All=0]="All",_[_.Some=1]="Some",_[_.None=2]="None"}(sl||(sl={}));class Sg extends gC{constructor(){super(...arguments),this.texture=null,this.transparent=sl.None,this.opaqueOverride=sl.None,this.castShadows=sl.None}get type(){return xg._N.Varying}}(0,Ze._)([ca()],Sg.prototype,"texture",void 0),(0,Ze._)([ca()],Sg.prototype,"transparent",void 0),(0,Ze._)([ca()],Sg.prototype,"opaqueOverride",void 0),(0,Ze._)([ca()],Sg.prototype,"castShadows",void 0);var Gp=T(7184),m6=T(51445);class g6{constructor(v){this.maxCount=v,this._nextIndex=0,this.recycledIndices=[]}get activeCount(){return this._nextIndex-this.recycledIndices.length}get availableCount(){return this.recycledIndices.length+this.maxCount-this._nextIndex}acquire(){return this.recycledIndices.length>0?this.recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(v){this.recycledIndices.push(v)}}class y6{constructor(v,O=1){this.rctx=v,this.fieldCount=O,this.textureWidth=4096,this.dirty=!0,this.texture=new ka.x(this.rctx,{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.NEAREST,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1}),this.data=new Fv.mc(new ArrayBuffer(4*this.textureWidth))}dispose(){this.texture.dispose(),this.texture=void 0,this.data=void 0}setData(v,O,D,w,te,fe){const Pe=v*this.fieldCount+O;this.dirty=!0,this.data.set(Pe,0,D),this.data.set(Pe,1,w),this.data.set(Pe,2,te),this.data.set(Pe,3,fe)}setDataElement(v,O,D,w){const te=v*this.fieldCount+O;this.dirty=!0,this.data.set(te,D,w)}resizeToFit(v){const O=v*this.fieldCount;if(O>=this.data.count){const D=Math.ceil((O+1)/this.textureWidth)*this.textureWidth,w=new Fv.mc(new ArrayBuffer(4*D));w.typedBuffer.set(this.data.typedBuffer),this.data=w}}updateTexture(){if(!this.dirty)return;const v=this.texture.descriptor.width;this.data.count>v*this.texture.descriptor.height&&this.texture.resize(v,this.data.count/v),this.texture.setData(this.data.typedBuffer),this.dirty=!1}bind(v,O,D){v.bindTexture(O,this.texture),v.setUniform2f(D,1/this.texture.descriptor.width,1/this.texture.descriptor.height)}}class v6{constructor(v,O=1){this.textureBuffer=new y6(v,O),this.indexManager=new g6(65536)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this.indexManager.availableCount}get activeCount(){return this.indexManager.activeCount}acquireIndex(){const v=this.indexManager.acquire();return this.textureBuffer.resizeToFit(v),v}releaseIndex(v){this.indexManager.release(v)}}class $x{constructor(v,O=1){this.rctx=v,this.fieldCount=O,this.buffers=[]}garbageCollect(){this.buffers=this.buffers.filter(v=>0!==v.activeCount||(v.dispose(),!1))}destroy(){this.buffers.forEach(v=>v.dispose()),this.buffers=[]}getBuffer(v){for(const D of this.buffers)if(D.availableCount>=v)return D;if(v>65536)return null;const O=new v6(this.rctx,this.fieldCount);return this.buffers.push(O),O}updateTextures(){for(const v of this.buffers)v.textureBuffer.updateTexture()}}const kx=pn.Z.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");class E6{constructor(v,O){this._renderManager=v,this._viewingMode=O,this._objects=[new Ua.Z,new Ua.Z],this._renderSubmit=new l6(this),this._renderManager.register(this._renderSubmit),this._componentBufferManager=new $x(v.rctx,2)}dispose(){(0,Td.hu)(0===this._objects[Xv.Z.Hidden].length&&0===this._objects[Xv.Z.Visible].length,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy()}createObject(v){const O=new Xv.c;return O.toMapSpace=v.toMapSpace,O.transform=v.transform,O.obb=(0,Mg.d9)(v.obb),O.components=new G4(this._componentBufferManager,v.geometry.componentOffsets),O.renderable=this._createRenderable(v,O.components),O.intersectionGeometry=new X4(v.geometry.positionData,O.components),this._objects[O.visible].push(O),O}destroyObject(v){const O=v;this._objects[O.visible].removeUnordered(O),O.dispose(),this._notifyDirty()}setObjectVisibility(v,O){const D=v;O!==D.visible&&(this._objects[D.visible].removeUnordered(D),this._objects[O].push(D),D.visible=O,this._notifyDirty())}preSubmit(v){const O=v.camera.eye;this.visibleObjects.forAll(D=>D.renderable.meta.cameraDepthSquared=(0,_t.d)(O,D.obb.center))}getMaterial(v){return v.renderable.material}updateMaterial(v,O){const D=v.renderable.material;O(D),D.dirty&&this._notifyDirty()}setAllComponentVisibilities(v,O){const D=v;D.components.visibility.reset(O),D.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(v,O){return v.components.visibility.forEachComponent(O)}getComponentCount(v){const O=v,D=O.components.visibility.componentCount();return{visible:D,invisible:O.components.count-D}}setComponentData(v,O){const D=v,w=D.renderable.material,te=D.components,fe=te.materialDataBuffer,Pe=te.materialDataIndices,Ue={castShadows:!0,pickable:!0,externalColor:(0,jf.c)(),externalColorMixMode:Tg.a9.Multiply,elevationOffset:0},Xe=fe.textureBuffer,st=new Uint8Array(4),vt=new Uint32Array(st.buffer);let Ct=0,Wt=0,Kt=0,Lt=te.verticalOffsets,nr=1/0,sr=-1/0,Er=!1,yr=!1,br=0;for(let Rr=0;Rr<te.count;Rr++)O(Rr,Ue),Ct+=+(Ue.externalColor[3]<1),Wt+=+(Ue.externalColorMixMode===Tg.a9.Replace&&1===Ue.externalColor[3]),Kt+=+Ue.castShadows,(0,Tg.HB)(Ue.externalColor,Ue.externalColorMixMode,st),st[2]=254&st[2]|+Ue.castShadows,Xe.setData(Pe[Rr],0,st[0],st[1],st[2],st[3]),Er||(Er=Rr>0&&br!==vt[0]),br=vt[0],yr||(yr=0!==Ue.elevationOffset),yr&&(0,lt.Wi)(Lt)&&(Lt=new Array(Rr).fill(0)),(0,lt.pC)(Lt)&&(Lt[Rr]=Ue.elevationOffset),nr=Math.min(nr,Ue.elevationOffset),sr=Math.max(sr,Ue.elevationOffset),(0,xg.nO)(Ue.elevationOffset,st),Xe.setData(Pe[Rr],1,st[0],st[1],st[2],st[3]),Ue.pickable!==wx(te.pickability,Rr)&&(te.pickability=K4(te.pickability,te.count,Rr,Ue.pickable));te.verticalOffsets=yr?Lt:null,D.offsetObb=yr?(0,F4.gI)(D.obb,nr,sr,this._viewingMode,(0,lt.pC)(D.offsetObb)?D.offsetObb:(0,Mg.d9)(D.obb)):null,Er||yr?(w.componentParameters=new Sg,w.componentParameters.castShadows=vC(Kt,te.count),w.componentParameters.transparent=vC(Ct,te.count),w.componentParameters.opaqueOverride=vC(Wt,te.count),w.componentParameters.texture=Xe,Xe.updateTexture()):(w.componentParameters=new Ag,w.componentParameters.castShadows=Ue.castShadows?sl.All:sl.None,w.componentParameters.externalColor=Ue.externalColor,w.componentParameters.externalColorMixMode=Ue.externalColorMixMode),this._notifyDirty()}getComponentAabb(v,O,D,w=!1){v.intersectionGeometry.getComponentAabb(O,D);const te=v,fe=te.components.verticalOffsets;if(w||(0,lt.Wi)(fe))return D;const Pe=fe[O];if(this._viewingMode===Us.JY.Local||0===Pe)return D[2]+=Pe,D[5]+=Pe,D;const Ue=(0,lt.Wg)((0,Qu.iO)(Pe));return Ue.localOrigin=te.transform.position,Ue.applyToAabb(D)}getComponentObb(v){return v.obb}getObjectTransform(v){return v.transform}getComponentPositions(v,O,D){return v.intersectionGeometry.getComponentPositions(O,D)}intersect(v,O,D,w,te,fe){const Pe=v;(0,lt.pC)(te)&&(te.localOrigin=Pe.transform.position);const Ue=(0,Aa.e)(Yx,Pe.transform.rotationScale);(0,_t.v)(sE,O,Pe.transform.position),(0,_t.v)(nE,D,Pe.transform.position),(0,_t.t)(sE,sE,Ue),(0,_t.t)(nE,nE,Ue);const Xe=(0,Aa.t)(Yx,Ue);return Pe.intersectionGeometry.intersect(sE,nE,w,Xe,te,Pe.components.verticalOffsets,fe)}addEdges(v,O,D,w){const te=v,{indices:fe,positions:Pe}=te.intersectionGeometry,Ue=te.components.offsets;return O.addComponentObject(v,te.transform,{center:te.obb.center,radius:(0,Mg.q0)(te.obb)},Pe,fe,Ue,D,w)}extractEdgeInformation(v,O,D){var w=this;return(0,Ai.Z)(function*(){const te=v,fe=te.components.visibility;if(fe.allInvisible())return{buffer:m6.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const{indices:Pe,positions:Ue}=te.intersectionGeometry,Xe=te.components.offsets,st=Gp.tf.createBuffer(Ue.count);(0,Rx.c)(st.position,Ue),(0,j4.a)(st.position,st.position,te.transform.rotationScale),w._setComponentIndices(st.componentIndex,Pe,Xe);const Ct=w._computeVisibilityIndices(Pe,fe,Xe,st.count);return{origin:(0,$t.a)(te.transform.position),buffer:yield O.extractComponentsEdgeLocations({indices:Ct,indicesLength:Ct.length,skipDeduplicate:!0,data:st,writerSettings:{reducedPrecision:!1,variants:0}},D)}})()}_setComponentIndices(v,O,D){let w=0;for(let te=0;te<D.length-1;te++){const Pe=D[te+1];for(let Ue=D[te];Ue<Pe;Ue++)v.set(O?O[Ue]:Ue,w);w++}}_computeVisibilityIndices(v,O,D,w){if(v&&O.allVisible())return v;let te=0;O.forEachComponentRange((Ue,Xe)=>(te+=D[Xe]-D[Ue],!0));const fe=2===(null==v?void 0:v.BYTES_PER_ELEMENT)||w<=65536?new Uint16Array(te):new Uint32Array(te);let Pe=0;return O.forEachComponentRange((Ue,Xe)=>{const vt=D[Xe];for(let Ct=D[Ue];Ct<vt;Ct++)fe[Pe++]=v?v[Ct]:Ct;return!0}),fe}addComponentHighlight(v,O){const D=v.components;(0,lt.Wi)(D.highlightCounts)&&(D.highlightCounts=new Uint32Array(D.count+1)),0==D.highlightCounts[O]++&&(D.highlightsDirty(),this._notifyDirty()),D.highlightCounts[D.count]++}removeComponentHighlight(v,O){const D=v.components;if((0,lt.Wi)(D.highlightCounts))return void kx.warn("Removing non-existing highlight.");const w=D.highlightCounts[O],te=D.highlightCounts[D.count];if(0!==w){if(w>1)return D.highlightCounts[O]=w-1,void(D.highlightCounts[D.count]=te-1);D.highlightCounts[O]=0,D.highlightsDirty(),this._notifyDirty(),1===te?D.highlightCounts=null:D.highlightCounts[D.count]=te-1}else kx.warn("Removing non-existing highlight.")}clearHighlights(v){const O=v.components;(0,lt.pC)(O.highlightCounts)&&(O.highlightCounts=null,O.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(v){return v.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[Xv.Z.Visible]}_createRenderable(v,O){const D=this._renderManager.rctx,w=v.geometry,te=w.vertices.layoutParameters,fe=Zl.f.createVertex(D,Jt.l1.STATIC_DRAW,w.vertices.data),Pe=(0,lt.yw)(w.indices,Lt=>Zl.f.createIndex(D,Jt.l1.STATIC_DRAW,Lt)),Ue=(0,g0.K)((0,c6.N)(te)),Xe=new Uint16Array(w.vertices.count);for(let Lt=0;Lt<O.count;Lt++){const nr=O.offsets[Lt],sr=O.offsets[Lt+1],Er=O.materialDataIndices[Lt];if((0,lt.pC)(w.indices))for(let yr=nr;yr<sr;yr++)Xe[w.indices[yr]]=Er;else for(let yr=nr;yr<sr;yr++)Xe[yr]=Er}const st=Zl.f.createVertex(D,Jt.l1.STATIC_DRAW,Xe.buffer),vt=new gl(v.transform,v.toMapSpace),Ct=new ku.U(D,vt.attributeLocations,{data:Ue,componentIndices:b6},{data:fe,componentIndices:st},(0,lt.Wg)(Pe)),Wt=new Lx(Ct,Jt.MX.TRIANGLES,te,(0,lt.pC)(Pe)),Kt={cameraDepthSquared:.5,gpuMemoryEstimate:fe.byteSize+st.byteSize+((0,lt.pC)(Pe)?Pe.byteSize:0)};return new e6(vt,Wt,Kt)}_notifyDirty(){this._renderManager.notifyDirty()}}const b6=(0,g0.K)((0,bf.U$)().u16(Fo.T.COMPONENTINDEX));function vC(_,v){return _===v?sl.All:0===_?sl.None:sl.Some}const Yx=(0,H_.c)(),sE=(0,$t.c)(),nE=(0,$t.c)();var C6=T(45323),Jx=T(70264),Xl=T(54580);class Rg extends vo.A{initializeProgram(v){const O=Rg.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){if(this.configuration.function===Xl.v3.TransparentToHUDVisibility)return(0,ls.sm)({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case Xl.Fv.None:return(0,ls.sm)({colorWrite:ls.BK});case Xl.Fv.Alpha:return(0,ls.sm)({blending:(0,ls.wK)(Jt.zi.SRC_ALPHA,Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ls.BK});default:return(0,ls.sm)({blending:(0,ls.if)(Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ls.BK})}}}Rg.shader=new vn.J(Jx.a,()=>T.e(505).then(T.bind(T,40505)));class T6{constructor(v,O){this._rctx=v,this._techniqueRepository=O,this._configuration=new Xl.ZB,this._passParameters=new Jx.C}dispose(){this._vao=(0,lt.O3)(this._vao)}compositeTransparent(v,O,D,w,te=1){this._configuration.alphaMode=Xl.Fv.Alpha,this._configuration.function=Xl.v3.Transparency,this._configuration.hasOpacityFactor=1!==te,this._passParameters.colorTexture=O,this._passParameters.alphaTexture=D,this._passParameters.frontFaceTexture=w;const fe=this._rctx,Pe=this._techniqueRepository.acquire(Rg,this._configuration);fe.bindTechnique(Pe,this._passParameters,v);const Ue=this._ensureVAO();fe.bindVAO(Ue),fe.drawArrays(Jt.MX.TRIANGLE_STRIP,0,(0,_l._V)(Ue,"geometry")),Pe.release()}composite(v,O,D=Xl.Fv.None,w=1,te=Xl.v3.Standard,fe=Ys.fu.INNER){const Pe=this._rctx;this._configuration.alphaMode=D,this._configuration.function=te,this._configuration.hasOpacityFactor=1!==w,this._passParameters.overlayIndex=fe,this._passParameters.texture=O,this._passParameters.opacity=w;const Ue=this._techniqueRepository.acquire(Rg,this._configuration);Pe.bindTechnique(Ue,this._passParameters,v);const Xe=this._ensureVAO();Pe.bindVAO(Xe),Pe.drawArrays(Jt.MX.TRIANGLE_STRIP,0,(0,_l._V)(Xe,"geometry")),Ue.release()}_ensureVAO(){return(0,lt.Wi)(this._vao)&&(this._vao=(0,$a.ow)(this._rctx)),this._vao}}var oE=T(36161),kf=T(82274);function D6(_,v,O){return(0,oE.v)(v,_)*(O[1]-O[0])+O[0]}function bC(_,v,O){if(!O.isVisible||!(0,qn.hr)(v.frustum,O.boundingVolumeWorldSpace.bounds))return;const D=O.transformation,w=B6;O.geometryRecords.forEach(te=>{(0,js.m)(w,D,te.getShaderTransformation());const fe=(0,oa.u1)(w);Xx(_,v,te.geometry.boundingInfo,w,fe)})}function Xx(_,v,O,D,w){if((0,lt.Wi)(O))return;const te=v.eye,fe=v.viewForward;(0,_t.m)(Ql,O.center,D);const Pe=fe[0]*(Ql[0]-te[0])+fe[1]*(Ql[1]-te[1])+fe[2]*(Ql[2]-te[2]);if(Ql[3]=O.radius*w,!(Pe-Ql[3]>_.near&&Pe+Ql[3]<_.far)&&(0,qn.hr)(v.frustum,Ql))if(O.radius>100&&O.getChildren()){const Ue=O.getChildren();for(let Xe=0;Xe<8;++Xe)Ue[Xe]&&Xx(_,v,Ue[Xe],D,w)}else TC.unionDepthRangeWithAABB(_,v.viewProjectionMatrix,D,O.bbMin,O.bbMax)}function Qx(_,v,O){const D=v.eye,w=v.viewForward,te=(O[0]-D[0])*w[0]+(O[1]-D[1])*w[1]+(O[2]-D[2])*w[2];_.near=Math.min(_.near,te-O[3]),_.far=Math.max(_.far,te+O[3])}const CC=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],Ql=(0,aa.c)(),B6=(0,Zn.c)(),Rd=Og(),q_=new class I6{constructor(){this._items=new Ua.Z({allocator:v=>v||{obj:null,distance:0,near:0,far:0},deallocator:v=>(v.obj=null,v.distance=0,v.near=0,v.far=0,v)})}get length(){return this._items.length}get empty(){return 0===this._items.length}clear(){this._items.clear()}add(v){this._items.pushNew().obj=v}sort(v){const O=v.eye,D=v.viewForward;this._items.forAll(w=>{const te=w.obj.boundingVolumeWorldSpace.bounds,fe=(te[0]-O[0])*D[0]+(te[1]-O[1])*D[1]+(te[2]-O[2])*D[2];w.distance=fe,w.near=fe-te[3],w.far=fe+te[3]}),this._items.sort((w,te)=>w.distance-te.distance)}forEachInDepthRange(v,O,D){if(O===kf.Z.DepthOrder.FRONT_TO_BACK)for(let w=0;w<this._items.length;++w){const te=this._items.data[w];te.far<v.near||te.near>v.far||D(te.obj,te.near,te.far)}else for(let w=this._items.length-1;w>=0;--w){const te=this._items.data[w];te.far<v.near||te.near>v.far||D(te.obj,te.near,te.far)}}},N6=new class L6{constructor(){this.view=(0,Zn.c)(),this.viewProj=(0,Zn.c)(),this.frustum=(0,qn.Ue)(),this.geometries=[],this.near=[],this.far=[],this.nearCandidates=[],this.farCandidates=[],this.range={near:0,far:0},this.looseRange={near:0,far:0}}compute(v,O){this._reset(),(0,js.c)(this.view,v.viewMatrix),(0,js.m)(this.viewProj,v.projectionMatrix,this.view),(0,qn.JG)(this.frustum,v.frustum);const D=this.view,w=D[2],te=D[6],fe=D[10],Pe=D[14],Ue=this.range;let Xe=0;if(O.forEach(Wt=>{if(!Wt.instanceParameters.visible||!Wt.castShadow)return;let Kt;Wt.hasShaderTransformation?(Wt.computeBoundingSphere(Wt.getShaderTransformation(),Ql,1),Kt=Ql):Kt=Wt.boundingSphere;const Lt=w*Kt[0]+te*Kt[1]+fe*Kt[2]+Pe,nr=Lt-Kt[3],sr=Lt+Kt[3];this.geometries[Xe]=Wt,this.near[Xe]=-sr,this.far[Xe]=-nr,++Xe}),0===this.geometries.length)return Ue;for(let Wt=0;Wt<this.geometries.length;++Wt)this.near[Wt]>Ue.far&&(Ue.far=this.near[Wt]),this.near[Wt]>2&&this.far[Wt]<Ue.near&&(Ue.near=this.far[Wt]);const st=this.looseRange;st.near=Math.max(.5*Ue.near,2),st.far=2*Ue.far;let vt=0,Ct=0;for(let Wt=0;Wt<this.geometries.length;++Wt)this.near[Wt]<Ue.near&&(this.near[Wt]>=st.near?Ue.near=this.near[Wt]:this.nearCandidates[vt++]=Wt),this.far[Wt]>Ue.far&&(this.far[Wt]<=st.far?Ue.far=this.far[Wt]:this.farCandidates[Ct++]=Wt);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return Ue;this.nearCandidates.sort((Wt,Kt)=>this.near[Wt]<this.near[Kt]?-1:this.near[Wt]>this.near[Kt]?1:0),this.farCandidates.sort((Wt,Kt)=>this.far[Wt]<this.far[Kt]?1:this.far[Wt]>this.far[Kt]?-1:0);for(let Wt=0;Wt<this.nearCandidates.length;++Wt){const Kt=this.nearCandidates[Wt];if(this.near[Kt]<Ue.near){const Lt=this.geometries[Kt];this._includeNearBoundingInfoRec(Lt.boundingInfo,Lt.getShaderTransformation())}}for(let Wt=0;Wt<this.farCandidates.length;++Wt){const Kt=this.farCandidates[Wt];if(this.far[Kt]>Ue.far){const Lt=this.geometries[Kt];this._includeFarBoundingInfoRec(Lt.boundingInfo,Lt.getShaderTransformation())}}return Ue}_reset(){this.geometries.length=0,this.near.length=0,this.far.length=0,this.nearCandidates.length=0,this.farCandidates.length=0,this.range.near=Number.MAX_VALUE,this.range.far=-Number.MAX_VALUE}_includeNearBoundingInfoRec(v,O){if((0,lt.Wi)(v))return;const D=v.getCenter();(0,_t.m)(Ql,D,O);const w=(0,oa.u1)(O),te=Ql[0],fe=Ql[1],Pe=Ql[2],Ue=v.getBSRadius()*w,Xe=this.frustum;if(Xe[0][0]*te+Xe[0][1]*fe+Xe[0][2]*Pe+Xe[0][3]>Ue||Xe[1][0]*te+Xe[1][1]*fe+Xe[1][2]*Pe+Xe[1][3]>Ue||Xe[2][0]*te+Xe[2][1]*fe+Xe[2][2]*Pe+Xe[2][3]>Ue||Xe[3][0]*te+Xe[3][1]*fe+Xe[3][2]*Pe+Xe[3][3]>Ue)return;const st=this.view[2]*te+this.view[6]*fe+this.view[10]*Pe+this.view[14],vt=st+Ue;if(!(-(st-Ue)<2||-vt>=this.range.near))if(-vt>this.looseRange.near)this.range.near=-vt;else{if(Ue>100){const Ct=v.getChildren();if(void 0!==Ct){for(let Wt=0;Wt<8;++Wt)void 0!==Ct[Wt]&&this._includeNearBoundingInfoRec(Ct[Wt],O);return}}TC.unionDepthRangeWithAABB(this.range,this.viewProj,O,v.getBBMin(),v.getBBMax())}}_includeFarBoundingInfoRec(v,O){if((0,lt.Wi)(v))return;let D=v.getBSRadius();const w=v.getCenter();(0,_t.m)(Ql,w,O);const te=(0,oa.u1)(O),fe=Ql[0],Pe=Ql[1],Ue=Ql[2];D*=te;const Xe=this.frustum;if(Xe[0][0]*fe+Xe[0][1]*Pe+Xe[0][2]*Ue+Xe[0][3]>D||Xe[1][0]*fe+Xe[1][1]*Pe+Xe[1][2]*Ue+Xe[1][3]>D||Xe[2][0]*fe+Xe[2][1]*Pe+Xe[2][2]*Ue+Xe[2][3]>D||Xe[3][0]*fe+Xe[3][1]*Pe+Xe[3][2]*Ue+Xe[3][3]>D)return;const st=this.view[2]*fe+this.view[6]*Pe+this.view[10]*Ue+this.view[14]-D;if(!(-st<=this.range.far))if(-st<this.looseRange.far)this.range.far=-st;else{if(D>100){const vt=v.getChildren();if(void 0!==vt){for(let Ct=0;Ct<8;++Ct)void 0!==vt[Ct]&&this._includeFarBoundingInfoRec(vt[Ct],O);return}}TC.unionDepthRangeWithAABB(this.range,this.viewProj,O,v.getBBMin(),v.getBBMax())}}},TC=new class U6{constructor(){this.modelViewProj=(0,Zn.c)(),this.clipPosition=[(0,vi.c)(),(0,vi.c)(),(0,vi.c)(),(0,vi.c)(),(0,vi.c)(),(0,vi.c)(),(0,vi.c)(),(0,vi.c)()]}unionDepthRangeWithAABB(v,O,D,w,te){const fe=this.modelViewProj;(0,js.m)(fe,O,D);let Pe=!1;for(let Ue=0;Ue<8;++Ue){const Xe=this.clipPosition[Ue],st=0===Ue||3===Ue||4===Ue||7===Ue?w[0]:te[0],vt=0===Ue||1===Ue||4===Ue||5===Ue?w[1]:te[1],Ct=Ue<4?w[2]:te[2];Xe[0]=fe[0]*st+fe[4]*vt+fe[8]*Ct+fe[12],Xe[1]=fe[1]*st+fe[5]*vt+fe[9]*Ct+fe[13],Xe[2]=fe[2]*st+fe[6]*vt+fe[10]*Ct+fe[14],Xe[3]=fe[3]*st+fe[7]*vt+fe[11]*Ct+fe[15]}for(let Ue=0;Ue<12;++Ue){const Ct=this._clipTriangle(this.clipPosition[CC[Ue][0]],this.clipPosition[CC[Ue][1]],this.clipPosition[CC[Ue][2]]);let Wt=!0;for(let Kt=0;Kt<Ct.length;++Kt)if(Ct[Kt][3]>=2){Wt=!1;break}if(!Wt){Pe=!0;for(let Kt=0;Kt<Ct.length;++Kt){const Lt=Ct[Kt][3];Lt<v.near&&(v.near=Lt),Lt>v.far&&(v.far=Lt)}}}return Pe}_inside(v,O){return 0===O?v[0]>=-v[3]:1===O?v[1]>=-v[3]:2===O?v[0]<=v[3]:3===O?v[1]<=v[3]:void(0,Td.hu)(!1)}_intersect(v,O,D){let w=0;return 0===D?w=(-v[3]-v[0])/(O[0]-v[0]+O[3]-v[3]):1===D?w=(-v[3]-v[1])/(O[1]-v[1]+O[3]-v[3]):2===D?w=(v[3]-v[0])/(O[0]-v[0]-O[3]+v[3]):3===D&&(w=(v[3]-v[1])/(O[1]-v[1]-O[3]+v[3])),(0,Sl.l)((0,vi.c)(),v,O,w)}_clipTriangle(v,O,D){let w=[v,O,D];for(let te=0;te<4;++te){const fe=w;w=[];for(let Pe=0;Pe<fe.length;++Pe){const Ue=fe[Pe],Xe=fe[(Pe+1)%fe.length];this._inside(Xe,te)?(this._inside(Ue,te)||w.push(this._intersect(Ue,Xe,te)),w.push(Xe)):this._inside(Ue,te)&&w.push(this._intersect(Ue,Xe,te))}}return w}};var j6=T(50907),qx=T(78038),F6=T(66054),W6=T(22355),MC=T(66838);class V6 extends Zc.K{constructor(){super(...arguments),this.maskEnabled=!1,this.overlayEnabled=!1}}function OC(){return OC=(0,Ai.Z)(function*(_){const v=T.e(9080).then(T.bind(T,29080)),O=T.e(5690).then(T.bind(T,5690)),D=(0,m0.t)((yield v).default,{signal:_}),w=(0,m0.t)((yield O).default,{signal:_}),te={mask:yield D,overlay:yield w};return(0,zi.k_)(_),te}),OC.apply(this,arguments)}let em=class extends Bi.Z{constructor(){super(...arguments),this._handles=new cn.Z,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new V6,this.events=new sa.Z,this.attributeLocations=new Map([[Fo.T.POSITION,0]]),this.tmpScreenPoint=(0,dr.s1)(),this.tmpRenderPoint=(0,dr.gX)()}get updating(){return(0,lt.Wi)(this._imageSources)&&(0,lt.pC)(this._imageLoadTask)&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(_){if(_===this._magnifier)return;this._handles.removeAll(),this._magnifier=_;const v=()=>{this._updateResourceLoading(),this.events.emit("request-render")};(0,lt.pC)(this._magnifier)&&this._handles.add((0,pt.YP)(()=>(0,lt.yw)(this._magnifier,O=>O.version),v)),v()}get enabled(){return(0,lt.pC)(this._validMagnifier)}get _validMagnifier(){return(0,lt.pC)(this._magnifier)&&this._magnifier.visible&&(0,lt.pC)(this._magnifier.position)&&this._magnifier.size>0?this._magnifier:null}get factor(){return(0,lt.pC)(this._magnifier)&&this._magnifier.factor||1}dispose(){this._magnifier=null,this._handles.destroy(),(0,lt.pC)(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(_,v){const O=this._validMagnifier;if((0,lt.Wi)(O))return;const D=v.camera.pixelRatio,w=Math.ceil(D*O.size);if(this._updateResources(_,w),(0,lt.Wi)(this._resources))return;this._passParameters.maskEnabled=O.maskEnabled,this._passParameters.overlayEnabled=O.overlayEnabled;const te=this._resources.program;_.useProgram(te),te.bindPass(this._passParameters,v);const fe=this._resources.textures,Pe=Math.ceil(1/this.factor*w);fe.input.resize(Pe,Pe);const Ue=v.camera.fullWidth,Xe=v.camera.fullHeight;(0,dr.md)(O.position,this.tmpScreenPoint);const st=v.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint),vt=.5*Pe,Ct=.5*Pe;st[0]=(0,li.uZ)(st[0],vt,Ue-vt-1),st[1]=(0,li.uZ)(st[1],Ct,Xe-Ct-1);const Wt=Math.floor(st[0]-vt),Kt=Math.floor(st[1]-Ct);te.bindTexture("textureInput",fe.input),_.gl.copyTexImage2D(fe.input.descriptor.target,0,fe.input.descriptor.pixelFormat,Wt,Kt,Pe,Pe,0);const sr=(st[0]+O.offset.x*D)/Ue*2-1,Er=(st[1]-O.offset.y*D)/Xe*2-1,yr=w/Ue*2,br=w/Xe*2;_.bindVAO(this._resources.vao),te.bindTexture("textureOverlay",fe.overlay),te.bindTexture("textureMask",fe.mask),te.setUniform4f("drawPosition",sr,Er,yr,br),_.setPipelineState(this._resources.pipelineState),_.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){var _=this;const v=this._validMagnifier;if((0,lt.Wi)(v))return;const O=v.maskUrl,D=v.overlayUrl;!(0,lt.pC)(this._imageLoadTask)||this._imageLoadTask.maskUrl===O&&this._imageLoadTask.overlayUrl===D||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),(0,lt.pC)(this._imageSources)||(0,lt.pC)(this._imageLoadTask)||(this._imageLoadTask={maskUrl:O,overlayUrl:D,task:(0,zi.vr)(function(){var w=(0,Ai.Z)(function*(te){const fe=(0,lt.Wi)(O)||(0,lt.Wi)(D)?function G6(_){return OC.apply(this,arguments)}(te):null,Pe=(0,lt.pC)(O)?(0,m0.t)(O,{signal:te}):fe.then(Xe=>Xe.mask),Ue=(0,lt.pC)(D)?(0,m0.t)(D,{signal:te}):fe.then(Xe=>Xe.overlay);_._imageSources={mask:yield Pe,overlay:yield Ue},_._disposeResources(),_.events.emit("request-render")});return function(te){return w.apply(this,arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(_,v){if(!this.enabled)return void this._disposeResources();if((0,lt.pC)(this._resources)){if(this._resources.textures.size!==v){const D=this._createTextureResources(_,v);if((0,lt.Wi)(D))return void this._disposeResources();this._disposeTextureResources(this._resources.textures),this._resources.textures=D}return}const O=this._createTextureResources(_,v);(0,lt.Wi)(O)||(this._resources={textures:O,program:this._createProgram(_),vao:(0,$a.ow)(_,Lh.QI,this.attributeLocations,0,1),pipelineState:(0,ls.sm)({blending:(0,ls.if)(Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:ls.BK})})}_disposeResources(){(0,lt.Wi)(this._resources)||(this._disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(_){_.mask.dispose(),_.overlay.dispose(),_.input.dispose()}_createTextureResources(_,v){if((0,lt.Wi)(this._imageSources))return null;this._imageSources.overlay.width=v,this._imageSources.overlay.height=v,this._imageSources.mask.width=v,this._imageSources.mask.height=v;const O=new ka.x(_,{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,internalFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:Jt.cw.LINEAR,flipped:!0,preMultiplyAlpha:!(0,ll.zd)(this._imageSources.overlay.src)||!_.driverTest.svgAlwaysPremultipliesAlpha},this._imageSources.overlay),D=new ka.x(_,{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.ALPHA,internalFormat:Jt.VI.ALPHA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:Jt.cw.LINEAR,flipped:!0},this._imageSources.mask);return{input:new ka.x(_,{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,internalFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:Jt.cw.LINEAR,flipped:!1}),mask:D,overlay:O,size:v}}_createProgram(_){return new ea.$(_,function z6(){const _=new W6.kG;return _.attributes.add(Fo.T.POSITION,"vec2"),_.vertex.uniforms.add(new F6.y("drawPosition")),_.varyings.add("vUV","vec2"),_.vertex.code.add(Zc.H`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),_.fragment.uniforms.add(new MC.Q("textureInput")),_.fragment.uniforms.add(new MC.Q("textureMask")),_.fragment.uniforms.add(new MC.Q("textureOverlay")),_.fragment.uniforms.add(new qx.U("maskEnabled",v=>v.maskEnabled)),_.fragment.uniforms.add(new qx.U("overlayEnabled",v=>v.overlayEnabled)),_.fragment.code.add(Zc.H`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),_}(),this.attributeLocations)}};(0,Ze._)([(0,nt.Cb)()],em.prototype,"_imageSources",void 0),(0,Ze._)([(0,nt.Cb)()],em.prototype,"_imageLoadTask",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],em.prototype,"updating",null),em=(0,Ze._)([(0,ui.j)("esri/views/3d/webgl-engine/lib/MagnifierHelper")],em);const K6=(0,io.HA)(1e3/30);var wg;!function(_){_[_.FrontToBack=0]="FrontToBack",_[_.BackToFront=1]="BackToFront"}(wg||(wg={}));class k0{constructor(v,O,D=wg.FrontToBack){this._rctx=v,this._techniqueRepository=O,this._sorting=D,this._draws=new Ua.Z({initialSize:32,allocator:w=>w||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(v,O,D,w){const te=this._draws.pushNew();te.geometry=O,te.geometryRanges=D,te.material=v,te.depthSquaredHint=w,te.indexType=O.indexed?(0,lt.Wg)(O.vao.indexBuffer).indexType:0}dispatch(v,O){const D=this._rctx;this._previouslyBoundDraw.clear();let w=null;const te=this._draws.map(Pe=>Pe.material.prepareTechnique(this._techniqueRepository,v,O,Pe.geometry.parameters)),fe=this._draws.length;for(let Pe=0;Pe<fe;Pe++){const Ue=te[Pe];Ue===w&&Ue.configuration.transparencyPassType===Fs.Am.NONE||(D.bindTechnique(Ue,v,O),w=Ue);const Xe=this._draws.data[Pe],st=Xe.geometry;D.bindVAO(st.vao),this._previouslyBoundDraw.get(Ue)!==Xe.material&&(Ue.bindDraw(Xe.material,O),this._previouslyBoundDraw.set(Ue,Xe.material));const vt=Xe.geometryRanges,Ct=vt.length;if(0!==Xe.indexType){const Wt=aE.get(Xe.indexType);for(let Kt=0;Kt<Ct;Kt+=2)D.drawElements(st.primitiveType,vt[Kt+1],Xe.indexType,vt[Kt]*Wt)}else for(let Wt=0;Wt<Ct;Wt+=2)D.drawArrays(st.primitiveType,vt[Wt],vt[Wt+1])}}prepareSubmit(){this._draws.clear()}finishSubmit(){const v=this._sorting===wg.FrontToBack?1:-1;this._draws.sort((O,D)=>{const w=v*(O.depthSquaredHint-D.depthSquaredHint);return 0!==w?w:O.geometry.vao.size-D.geometry.vao.size})}get count(){return this._draws.length}}const aE=new Map;aE.set(Jt.g.UNSIGNED_BYTE,1),aE.set(Jt.g.UNSIGNED_SHORT,2),aE.set(Jt.g.UNSIGNED_INT,4);class Z6{constructor(v,O){this.rctx=v,this.shaderTechniqueRepository=O,this.canRender=!0,this._materialPassParameters=new Ta.SP,this._shadowPassParameters=new Ta.kF,this._highlightPassParameters=new Ta.T5,this._systems=new Set,this._passes={materialOpaque:new k0(v,O),materialTransparent:new k0(v,O,wg.BackToFront),materialIntegratedMesh:new k0(v,O),shadowMap:new k0(v,O),highlight:new k0(v,O),highlightIntegratedMesh:new k0(v,O),highlightShadowMap:new k0(v,O),defaultShadowMap:new k0(v,O)}}register(v){this._systems.add(v)}prepareRender(v){if(0!==this._systems.size){for(const O of Object.values(this._passes))O.prepareSubmit();this._systems.forEach(O=>O.submit(this._passes,v.bindParameters));for(const O of Object.values(this._passes))O.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}render(v){if(0!==this._systems.size)switch(this._configure(v),v.bindParameters.slot){case fn.r.OPAQUE_MATERIAL:switch(v.pass){case gn.C.MATERIAL:return this._materialPassParameters.subPass=Ta.zp.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ta.zp.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ta.zp.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,v.bindParameters);case gn.C.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,v.bindParameters);case gn.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,v.bindParameters);case gn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,v.bindParameters)}return;case fn.r.TRANSPARENT_MATERIAL:switch(v.pass){case gn.C.MATERIAL:return this._materialPassParameters.subPass=Ta.zp.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_ALPHA:return this._materialPassParameters.subPass=Ta.zp.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ta.zp.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ta.zp.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,v.bindParameters)}return;case fn.r.INTEGRATED_MESH:switch(v.pass){case gn.C.MATERIAL:return this._materialPassParameters.subPass=Ta.zp.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_DEPTH:return this._materialPassParameters.subPass=Ta.zp.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_NORMAL:return this._materialPassParameters.subPass=Ta.zp.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,v.bindParameters);case gn.C.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,v.bindParameters)}return}}notifyDirty(){this._context.requestRender()}slots(){return[fn.r.OPAQUE_MATERIAL,fn.r.TRANSPARENT_MATERIAL,fn.r.INTEGRATED_MESH]}initializeRenderContext(v){this._context=v}uninitializeRenderContext(){}queryDepthRange(v){const O={near:1/0,far:-1/0};return this._systems.forEach(D=>{const w=D.queryShadowCasterDepthRange(v);(0,lt.pC)(w)&&X_(O,w,O)}),O}_configure(v){this._updateParameters(v,v.pass===gn.C.MATERIAL_DEPTH_SHADOWMAP_ALL||v.pass===gn.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||v.pass===gn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:v.pass===gn.C.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters)}_updateParameters(v,O){const D=v.bindParameters.camera,w=D.viewInverseTransposeMatrix;(0,_t.s)(PC,w[3],w[7],w[11]),xC.set(PC),(0,_t.c)(O.transformWorldFromViewTH,xC.high),(0,_t.c)(O.transformWorldFromViewTL,xC.low),(0,_t.c)(O.slicePlaneLocalOrigin,PC),(0,Aa.f)(O.transformViewFromCameraRelativeRS,D.viewMatrix),(0,js.c)(O.transformProjFromView,D.projectionMatrix),O.identifier===Ta.o9.Material&&(this._materialPassParameters.transparent=v.bindParameters.slot===fn.r.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=v.bindParameters.slot===fn.r.INTEGRATED_MESH,(0,Aa.t)(eD,O.transformViewFromCameraRelativeRS),(0,Aa.e)(O.transformNormalViewFromGlobal,eD))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}}const PC=(0,$t.c)(),eD=(0,Mp.c)(),xC=new rE;var Y0=T(42309),$6=T(98565),k6=T(17923);class lE extends vo.A{initializeProgram(v){const O=lE.shader.get().build();return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.wK)(Jt.zi.SRC_ALPHA,Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ls.BK})}}lE.shader=new vn.J(k6.H,()=>T.e(5265).then(T.bind(T,5265)));var tD=T(47482);class cE extends vo.A{initializeProgram(v){const O=cE.shader.get().build();return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({colorWrite:ls.BK})}}cE.shader=new vn.J(tD.a,()=>T.e(2337).then(T.bind(T,52337)));var rD=T(36227);class uE extends vo.A{initializeProgram(v){const O=uE.shader.get().build();return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({colorWrite:ls.BK})}}uE.shader=new vn.J(rD.a,()=>T.e(4496).then(T.bind(T,14496)));class iD extends Zc.K{constructor(){super(...arguments),this.color=(0,jf.f)(1,0,1,1),this.haloColor=(0,jf.f)(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=(0,vi.f)(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}}class J6{constructor(v,O){this._techniqueRep=v,this._rctx=O,this.viewportToRestore=(0,vi.c)(),this._passParameters=new iD,this._downsampleDrawParameters=new rD.H,this._blurDrawParameters=new tD.H,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this.quadVAO)return;this.quadVAO=(0,$a.ow)(this._rctx);const v={colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE,width:0,height:0},O={target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.LINEAR,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new pc.X(this._rctx,v,O),this.blur1Fbo=new pc.X(this._rctx,v,O);const D=new En.m;this._blurTechnique=this._techniqueRep.acquire(cE,D),this._downsampleTechnique=this._techniqueRep.acquire(uE,D),this._applyTechnique=this._techniqueRep.acquire(lE,D)}dispose(){if(this._blurTechnique=(0,lt.RY)(this._blurTechnique),this._downsampleTechnique=(0,lt.RY)(this._downsampleTechnique),this._applyTechnique=(0,lt.RY)(this._applyTechnique),this._grid.coverageMipmap)for(let v=1;v<this._grid.coverageMipmap.length;v++)this._grid.coverageMipmap[v].dispose();this._grid.vao&&this._grid.vao.dispose(!0),this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null),this.blur0Fbo=(0,lt.O3)(this.blur0Fbo),this.blur1Fbo=(0,lt.O3)(this.blur1Fbo)}setDefaultOptions(v){this._passParameters=or(or({},new iD),v)}render(v,O,D){this._passParameters.highlightColorTexture=O.colorTexture,this._assertResources();const w=v.camera;(0,Sl.c)(this.viewportToRestore,w.fullViewport);const fe=w.fullHeight,Pe=w.pixelRatio,Ue=Math.ceil(w.fullWidth/Pe),Xe=Math.ceil(fe/Pe);this.blur0Fbo.resize(Ue,Xe),this.blur1Fbo.resize(Ue,Xe);const st=this._rctx;st.bindVAO(this.quadVAO);let vt=null;this._gridUpdateResources(O,32),this._gridComputeMipmap(v),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,vt=this._grid.vao;const Ct=st.bindTechnique(this._blurTechnique,this._passParameters,v);st.bindVAO(vt),st.bindFramebuffer(this.blur0Fbo),st.setViewport(0,0,Ue,Xe),st.setClearColor(0,0,0,0),st.clear(Jt.lk.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=O.colorTexture,(0,Oi.a)(this._blurDrawParameters.blurSize,1/Ue,0),Ct.bindDraw(this._blurDrawParameters,v),st.drawArrays(this._blurTechnique.primitiveType,0,(0,_l._V)(vt,"geometry")),st.bindFramebuffer(this.blur1Fbo),st.clear(Jt.lk.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture,(0,Oi.a)(this._blurDrawParameters.blurSize,0,1/Xe),Ct.bindDraw(this._blurDrawParameters,v),st.drawArrays(this._blurTechnique.primitiveType,0,(0,_l._V)(vt,"geometry")),st.bindFramebuffer(D),st.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]),this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture,st.bindTechnique(this._applyTechnique,this._passParameters,v),st.drawArrays(this._applyTechnique.primitiveType,0,(0,_l._V)(vt,"geometry")),st.bindVAO(null)}_gridUpdateResources(v,O){const D=this._rctx,w=this._grid;let te=!1;if(null===w.coverageMipmap&&(w.coverageMipmap=[v],te=!0),w.viewportWidth===v.width&&w.viewportHeight===v.height||(te=!0,w.viewportWidth=v.width,w.viewportHeight=v.height),w.coverageMipmap[0]=v,w.cellPixelSize!==O&&(w.cellPixelSize=O,te=!0),te){for(let Ue=1;Ue<w.coverageMipmap.length;Ue++)w.coverageMipmap[Ue].dispose();w.mipmapLevels=Math.ceil(Math.log(w.cellPixelSize)*Math.LOG2E),w.coverageMipmap.length=w.mipmapLevels+1;for(let Ue=0;Ue<w.mipmapLevels;Ue++){const Xe=w.coverageMipmap[Ue],st={target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGB,dataType:Jt.Br.UNSIGNED_SHORT_5_6_5,samplingMode:Jt.cw.LINEAR,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:Math.ceil(Xe.width/2),height:Math.ceil(Xe.height/2)},vt={colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE,width:Math.ceil(Xe.width/2),height:Math.ceil(Xe.height/2)};w.coverageMipmap[Ue+1]=new pc.X(D,vt,st)}}const fe=Math.ceil(v.height/w.cellPixelSize),Pe=Math.ceil(v.width/w.cellPixelSize);if(!w.vao||w.verticalCellCount!==fe||w.horizontalCellCount!==Pe){w.verticalCellCount=fe,w.horizontalCellCount=Pe;const Ue=fe+1,Xe=Pe+1,st=1/fe,vt=1/Pe,Ct=6,Wt=4,Kt=new Float32Array(Ct*Wt*Ue*Xe);let Lt=0;for(let nr=0;nr<Ue;nr++)for(let sr=0;sr<Xe;sr++)Kt[Lt+0]=(sr-.5)*vt*2-1,Kt[Lt+1]=(nr-.5)*st*2-1,Kt[Lt+2]=sr*vt,Kt[Lt+3]=nr*st,Kt[Lt+4]=(sr+.5)*vt*2-1,Kt[Lt+5]=(nr-.5)*st*2-1,Kt[Lt+6]=sr*vt,Kt[Lt+7]=nr*st,Kt[Lt+8]=(sr-.5)*vt*2-1,Kt[Lt+9]=(nr+.5)*st*2-1,Kt[Lt+10]=sr*vt,Kt[Lt+11]=nr*st,Kt[Lt+12]=(sr-.5)*vt*2-1,Kt[Lt+13]=(nr+.5)*st*2-1,Kt[Lt+14]=sr*vt,Kt[Lt+15]=nr*st,Kt[Lt+16]=(sr+.5)*vt*2-1,Kt[Lt+17]=(nr-.5)*st*2-1,Kt[Lt+18]=sr*vt,Kt[Lt+19]=nr*st,Kt[Lt+20]=(sr+.5)*vt*2-1,Kt[Lt+21]=(nr+.5)*st*2-1,Kt[Lt+22]=sr*vt,Kt[Lt+23]=nr*st,Lt+=Ct*Wt;w.vao&&w.vao.dispose(!0),w.vao=new ku.U(D,bo.i,{geometry:Lh.Bn},{geometry:Zl.f.createVertex(D,Jt.l1.STATIC_DRAW,Kt)})}}_gridComputeMipmap(v){const O=this._rctx,D=this._grid,w=O.bindTechnique(this._downsampleTechnique,this._passParameters,v);O.bindVAO(this.quadVAO);for(let te=0;te<D.mipmapLevels;te++){O.bindFramebuffer(D.coverageMipmap[te+1]);const fe=D.coverageMipmap[te+1].width,Pe=D.coverageMipmap[te+1].height;this._downsampleDrawParameters.inputTexture=D.coverageMipmap[te].colorTexture,(0,Oi.a)(this._downsampleDrawParameters.invFramebufferDim,1/fe,1/Pe),w.bindDraw(this._downsampleDrawParameters,v),O.setViewport(0,0,fe,Pe),O.drawArrays(Jt.MX.TRIANGLE_STRIP,0,(0,_l._V)(this.quadVAO,"geometry"))}}get gpuMemoryUsage(){let v=((0,lt.pC)(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+((0,lt.pC)(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const O of this._grid.coverageMipmap)v+=O.gpuMemoryUsage;return v}get test(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}var X6=T(49266);const Q6={dataType:Jt.Br.UNSIGNED_BYTE,internalFormat:Jt.VI.RGBA},q6={};class eB{constructor(v){this.rctx=v,this._activeTargets=new Set,this._depthTextures=new Map,this._depthBuffers=new Map,this._colorTextures=new Map,this._framebuffers=new Map,this.depthTextureSupported=v.capabilities.depthTexture}dispose(){this._depthBuffers.forEach(v=>v.dispose()),this._depthBuffers.clear(),this._depthTextures.forEach(v=>v.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(v=>v.dispose()),this._colorTextures.clear(),this._framebuffers.forEach(v=>v.dispose()),this._framebuffers.clear(),this._activeTargets.clear()}disposeTargetResource(v){const O=v.id;this._activeTargets.has(O)&&(this._activeTargets.delete(O),this._disposeWithFramebuffers(this._depthTextures,O),this._disposeWithFramebuffers(this._depthBuffers,O),this._disposeWithFramebuffers(this._colorTextures,O))}_disposeWithFramebuffers(v,O){const D=v.get(O);D&&(this._framebuffers.forEach((w,te)=>{w.colorAttachment!==D&&w.depthStencilAttachment!==D||(w.detachAll(),w.dispose(),this._framebuffers.delete(te))}),D.dispose(),v.delete(O))}getDepthTexture(v,O){if(!this.depthTextureSupported)return null;let D=this._depthTextures.get(v.id);return!D||D.descriptor.width===O.width&&D.descriptor.height===O.height||(D.dispose(),D=null),D||(D=new ka.x(this.rctx,{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.DEPTH_STENCIL,dataType:Jt.Br.UNSIGNED_INT_24_8,samplingMode:Jt.cw.NEAREST,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:O.width,height:O.height}),this._depthTextures.set(v.id,D),this._activeTargets.add(v.id)),D}getAllocatedDepthTexture(v){return this._depthTextures.get(v.id)}getDepthBuffer(v,O){if(this.depthTextureSupported)return null;let D=this._depthBuffers.get(v.id);return D?D.descriptor.width===O.width&&D.descriptor.height===O.height||D.resize(O.width,O.height):(D=new X6.r(this.rctx,or({internalFormat:Jt.Tg.DEPTH_STENCIL},O)),this._depthBuffers.set(v.id,D),this._activeTargets.add(v.id)),D}getColorTexture(v,O){let D=this._colorTextures.get(v.id);return D&&(D.descriptor.width===O.width&&D.descriptor.height===O.height||(D.dispose(),D=null)),D||(D=new ka.x(this.rctx,{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,internalFormat:v.internalFormat,dataType:v.dataType,samplingMode:null!=v.samplingMode?v.samplingMode:Jt.cw.LINEAR,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:O.width,height:O.height}),this._colorTextures.set(v.id,D),this._activeTargets.add(v.id)),D}getAllocatedColorTexture(v){return this._colorTextures.get(v.id)}registerDepthTarget(v={}){return or(or({id:(0,lv.D)()},q6),v)}registerColorTarget(v={}){return or(or({id:(0,lv.D)()},Q6),v)}getFramebuffer(v,O,D){const w=this._getKey(O,D);let te=this._framebuffers.get(w);const fe=this.getColorTexture(O,v);if(this.depthTextureSupported){const Ue=D?this.getDepthTexture(D,v):void 0;return te?((te.width!==v.width||te.height!==v.height||te.colorTexture!==fe||te.depthStencilTexture!==Ue)&&(te.detachAll(),te.resize(v.width,v.height),te.attachColorTexture(fe),te.attachDepthStencilTexture(Ue)),te):(te=(0,lt.pC)(D)?new pc.X(this.rctx,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.DEPTH_STENCIL_TEXTURE},fe,Ue):new pc.X(this.rctx,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE},fe),this._framebuffers.set(w,te),te)}const Pe=D?this.getDepthBuffer(D,v):void 0;return te?((te.width!==v.width||te.height!==v.height||te.colorTexture!==fe)&&(te.detachAll(),te.resize(v.width,v.height),te.attachColorTexture(fe),te.attachDepthStencilBuffer(Pe)),te):(te=new pc.X(this.rctx,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:D?Jt.OU.DEPTH_STENCIL_RENDER_BUFFER:Jt.OU.NONE},fe,Pe),this._framebuffers.set(w,te),te)}_getKey(v,O){return`${v.id}_${O?O.id:"X"}_${v.name}${O?"_"+O.name:""}`}get gpuMemoryUsage(){let v=0;const O=new Set,D=w=>{O.has(w)||(O.add(w),v+=(0,_l.un)(w))};return this._depthTextures.forEach(D),this._colorTextures.forEach(D),this._depthBuffers.forEach(D),v}}var Yf=T(57596);class tB{constructor(v,O){this._rctx=v,this._compositingHelper=O,this._mainColorTarget=0,this._dimensions={width:4,height:4},this._needLastFrameColorTexture=!1,this._background={type:"color",color:[0,0,0,1]};const D=v.type===Yf.zO.WEBGL2;this._renderTargetHelper=new eB(v);const w=this._renderTargetHelper;this.mainColorTargets=[w.registerColorTarget({name:"mainColorTarget0"}),w.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=w.registerColorTarget({name:"frontFaceTarget"});const te=fe=>w.registerColorTarget({name:fe,dataType:Jt.Br.FLOAT,internalFormat:D?Jt.lP.RGBA32F:Jt.VI.RGBA,samplingMode:Jt.cw.NEAREST});this.colorFloatTarget=te("colorFloatTarget"),this.alphaFloatTarget=te("alphaFloatTarget"),this.mainDepth=w.registerDepthTarget({name:"mainDepth"}),this.linearDepth=w.registerColorTarget({name:"linearDepth",samplingMode:Jt.cw.NEAREST}),this.terrainLinearDepth=w.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=w.registerColorTarget({name:"geometryLinearDepth"}),this.normal=w.registerColorTarget({name:"normal"}),this.highlight=w.registerColorTarget({name:"highlight",internalFormat:D?Jt.lP.RGBA4:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=w.registerColorTarget({name:"hudVisibility",internalFormat:D?Jt.lP.RGBA4:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=w.registerColorTarget({name:"tmpColor"}),this.tmpDepth=w.registerDepthTarget({name:"tmpDepth"}),this.hudColor=w.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}get width(){return this._dimensions.width}get height(){return this._dimensions.height}set background(v){this._background=v}get background(){return this._background}get currentColorTarget(){return this.mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this.mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(v,O){return this._renderTargetHelper.getFramebuffer(this._dimensions,v,O)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}advanceCurrentRenderTarget(){this._mainColorTarget=0===this._mainColorTarget&&this._needLastFrameColorTexture?1:0}initializeFrame(v){const O=this._rctx;this._dimensions.width=v.fullWidth,this._dimensions.height=v.fullHeight,this.bindTarget(this.currentColorTarget,this.mainDepth),O.setClearStencil(0);const D=this._background.color;O.setClearColor(D[0]*D[3],D[1]*D[3],D[2]*D[3],D[3]),O.clearSafe(Jt.lk.COLOR_BUFFER_BIT|Jt.lk.DEPTH_BUFFER_BIT|Jt.lk.STENCIL_BUFFER_BIT)}composite(v){(0,lt.pC)(this.colorTexture)&&this._compositingHelper.composite(v,this.colorTexture,Xl.Fv.None)}renderTmpAndCompositeToMain(v,O,D,w=!1){this.renderToTargets(v,this.tmpColor,w?this.tmpDepth:this.mainDepth,rB),this._compositingHelper.composite(O,this._getColorTexture(this.tmpColor),D)}renderHUDVisibility(v,O=!1){this.renderToTargets(v,this.hudVisibility,O?this.tmpDepth:this.mainDepth,iB)}compositeTransparentTerrainOntoHUDVisibility(v){this.renderToTargets(()=>this._compositingHelper.composite(v,this._getColorTexture(this.tmpColor),Xl.Fv.None,1,Xl.v3.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)}renderOITPass(v,O,D){let w,te;switch(O){case Fs.Am.Color:w=this.colorFloatTarget,te=[0,0,0,0];break;case Fs.Am.Alpha:w=this.alphaFloatTarget,te=[1,1,1,1];break;case Fs.Am.FrontFace:w=this.frontFaceTarget,te=[0,0,0,0]}D?this.renderToTargets(v,w,this.tmpDepth,te,!0,!0):this.renderToTargets(v,w,this.mainDepth,te,!1)}compositeTransparentTerrainOntoMain(v){this.bindFramebuffer(),this._compositingHelper.composite(v,this._getColorTexture(this.tmpColor),Xl.Fv.PremultipliedAlpha)}compositeOccludedOntoMain(v,O){this.bindFramebuffer(),this._compositingHelper.composite(v,this._getColorTexture(this.tmpColor),Xl.Fv.PremultipliedAlpha,O)}compositeTransparentOntoOpaque(v,O){O?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Jt.lk.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeTransparent(v,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(v){this.bindTarget(this.currentColorTarget),v(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(v){this._renderTargetHelper.disposeTargetResource(v)}set needLastFrameColorTexture(v){!v&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1])),this._needLastFrameColorTexture=v}get needLastFrameColorTexture(){return this._needLastFrameColorTexture}renderToTargets(v,O,D,w,te=!1,fe=!1){const Pe=this._rctx,Ue=this.bindTarget(O,D);let Xe=0;if(w){const vt=Math.max(1e-13,w[3]);Pe.setClearColor(w[0],w[1],w[2],vt),Xe|=Jt.lk.COLOR_BUFFER_BIT}return te&&(Xe|=Jt.lk.DEPTH_BUFFER_BIT),!1===fe?fe=0:(!0===fe&&(fe=255),Xe|=Jt.lk.STENCIL_BUFFER_BIT),Xe&&Pe.clearSafe(Xe,fe),v(),Pe.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth),Ue}bindTarget(v,O){const D=this._renderTargetHelper.getFramebuffer(this._dimensions,v,O);return this._rctx.bindFramebuffer(D),D}_getColorTexture(v){return this._renderTargetHelper.getColorTexture(v,this._dimensions)}get gpuMemoryUsage(){let v=0;return this._renderTargetHelper&&(v+=this._renderTargetHelper.gpuMemoryUsage),v}}const rB=[0,0,0,0],iB=[0,1,0,1];var sB=T(64624),nB=T(83196);class oB{constructor(v){this.context=v,this._renderPlugins=new Ua.Z,this.slots=[];for(let O=0;O<fn.r.MAX_SLOTS;++O)this.slots[O]=[]}add(v,O,D){const w=()=>{if(null==D?void 0:D.aborted)throw O.uninitializeRenderContext(),(0,zi.zE)();this._renderPlugins.push(O);for(const fe of v)this.slots[fe].push(O);this.context.requestRender()},te=O.initializeRenderContext(this.context,D);if((0,zi.y8)(te))return te.then(w);w()}remove(v){if(null!=this._renderPlugins.removeUnordered(v)){for(let O=0;O<this.slots.length;++O)this.slots[O]=this.slots[O].filter(D=>D!==v);v.uninitializeRenderContext(),this.context.requestRender()}}prepareRender(){this._renderPlugins.forAll(v=>{v.prepareRender&&v.prepareRender(this.context.renderContext)})}updateAnimation(v){let O=!1;return this._renderPlugins.forAll(D=>{D.updateAnimation&&(O=D.updateAnimation(v)||O)}),O}render(){const v=this.slots[this.context.renderContext.bindParameters.slot],O=new Array;v.filter(D=>{if(!D.canRender)return!1;if(function aB(_){return"prepareTechnique"in _}(D)){const w=D.prepareTechnique(this.context.renderContext);return!!w&&(O.push(w),!0)}return O.push(null),!0}).forEach((D,w)=>D.render(this.context.renderContext,O[w]))}queryDepthRange(v){const O=lB;return O.near=1/0,O.far=-1/0,this._renderPlugins.forAll(D=>{if(D.queryDepthRange){const w=D.queryDepthRange(v);w&&X_(O,w,O)}}),O}get needsTransparentPass(){return this._renderPlugins.some(v=>v.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(v=>v.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(v=>v.needsLinearDepth)}get needsLaserlineWithContrastControl(){const v=this.slots[fn.r.LASERLINES_CONTRAST_CONTROL];return!!v&&v.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((v,O)=>v|O.renderOccludedFlags,0)}}const lB={near:0,far:0};var cB=T(82148);class dE extends vo.A{constructor(v,O){super(v,O,()=>this.destroy())}initializeProgram(v){const O=dE.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:Q_.wu,colorWrite:ls.BK,depthTest:null,depthWrite:null})}get primitiveType(){return Jt.MX.TRIANGLE_STRIP}}dE.shader=new vn.J(cB.S,()=>T.e(5915).then(T.bind(T,45915)));var sD=T(69828);const uB=(0,vi.f)(.01,0,.25,1),nD=1/512;let hE=class extends Bi.Z{constructor(_,v,O,D){super({}),this._techniqueRepository=_,this._rctx=v,this._shadowAccumulator=O,this._requestRender=D,this._passParameters={shadowCastMap:this._shadowCastTexture,sampleScale:0,color:uB,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"},this._techniqueConfig=new sD.l,this._enabled=!1,this._vao=(0,$a.ow)(v),this._techniqueConfig.visualization=sD.w.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=(0,lt.O3)(this._vao),this._techniqueRepository.release(this._technique),this._technique=null,this._shadowAccumulator=null}get visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(dE,this._techniqueConfig,this._technique),this._technique}render(_){if(!this._isRenderingVisualization)return;this._passParameters.sampleScale=1/this._computedSamples;const v=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(v,this._passParameters,_),this._rctx.drawArrays(v.primitiveType,0,(0,_l._V)(this._vao,"geometry"))}setOptions(_){void 0!==_.enabled&&this._setEnabled(_.enabled),void 0!==_.color&&this._setColor(_.color),void 0!==_.threshold&&(this._threshold=_.threshold),void 0!==_.visualization&&(this._visualization=_.visualization),void 0!==_.bandSize&&(this._bandSize=_.bandSize),void 0!==_.bandsEnabled&&(this._bandsEnabled=_.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(_){this._passParameters.opacityFromElevation!==_&&(this._passParameters.opacityFromElevation=_,this.notifyChange("opacityFromElevation"))}get _isRenderingVisualization(){return this._enabled&&this._computedSamples>0&&this.opacityFromElevation>nD}get _computedSamples(){return this._shadowAccumulator.computedSamples}get _shadowCastTexture(){return this._shadowAccumulator.shadowCastTexture}get _threshold(){return this._passParameters.threshold}set _threshold(_){this._threshold!==_&&(this._passParameters.threshold=_,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(_){_!==this._visualization&&(this._techniqueConfig.visualization=_,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(_){_!==this._bandSize&&(this._passParameters.bandSize=_,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(_){_!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=_,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(_){(0,Sl.g)(_,this._passParameters.color)||((0,Sl.c)(this._passParameters.color,_),this._requestRenderIfRunning())}_setEnabled(_){_!==this._enabled&&(_?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};(0,Ze._)([(0,nt.Cb)()],hE.prototype,"opacityFromElevation",null),hE=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],hE);var Ig,pE=T(53319),DC=T(94195);class fE extends vo.A{constructor(v,O){super(v,O,()=>this.destroy())}initializeProgram(v){const O=fE.shader.get().build();return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.wK)(Jt.zi.ONE,Jt.zi.ONE,Jt.zi.ONE,Jt.zi.ONE),colorWrite:ls.BK,depthTest:null,depthWrite:null})}get primitiveType(){return Jt.MX.TRIANGLE_STRIP}}fE.shader=new vn.J(DC.a,()=>T.e(8897).then(T.bind(T,58897)));let gc=Ig=class extends Bi.Z{constructor(_,v,O,D,w,te){super({}),this._rctx=_,this._stage=O,this._prepareForShadowMapPass=D,this._renderToShadowMap=w,this._requestRender=te,this._progress=0,this._sampleCount=0,this._passParameters=new DC.S,this._enabled=!1,this._cachedLightDirections=[],this._depthRange=pC,this._previewing=!1,this._handles=new cn.Z,this._cameraForcedForScreenshot=!1,this._bindParameters=new JE.p(new pE.l(_,O.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._bindParameters.camera=new $n.V,this._vao=(0,$a.ow)(_),this._fbo=new pc.X(_,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE,width:0,height:0},{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.LINEAR,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:0,height:0}),this._accumulationRenderer=new hE(v,_,this,te),this._handles.add(this._stage.resourceController.scheduler.registerTask(Gn.T8.SHADOW_ACCUMULATOR,this)),this._handles.add((0,pt.YP)(()=>O.renderView,Xe=>{this._handles.remove(Ig.renderViewHandleKey),(0,lt.Wi)(Xe)||this._handles.add(Xe.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),Ig.renderViewHandleKey)},pt.tX))}normalizeCtorArgs(){return{}}get computedSamples(){return this._progress}get shadowCastTexture(){return this._fbo.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get accumulationTechnique(){return(0,lt.Wi)(this._accumulationTechnique)&&(this._accumulationTechnique=new fE({rctx:this._rctx,viewingMode:this._stage.viewingMode},new En.m)),this._accumulationTechnique}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._enabled&&this._sampleCount>0}get canAccumulate(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==pC&&this._opacityFromElevation>nD}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(_){const v=this._cachedLightDirections;if((0,Cl.fS)(v,_,_t.z))return;const O=_.length;v.length=O,this._sampleCount=Math.min(DC.s,O);for(let D=0;D<O;++D){const w=_[D],te=v[D]||(0,$t.c)();(0,_t.c)(te,w),v[D]=te}this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(_){this._accumulationRenderer.opacityFromElevation=_}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(_){for(this._prepareForShadowMapPass(this._bindParameters);!_.done&&!this._isDoneAccumulating;)this._accumulateShadow(),_.madeProgress();this._requestRender()}renderAccumulation(_,v,O,D){if(this._passParameters.linearDepthTexture=_,this._depthRange=v,this._updateCamera(O),this._bindParameters.contentCamera=D,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();const w=this._cameraForcedForScreenshot?this._sampleCount:Math.min(Ig.previewSamples,this._sampleCount-this._progress);for(let te=0;te<w;++te)this._accumulateShadow();this._cameraForcedForScreenshot=!1}render(_){this._accumulationRenderer.render(_)}dispose(){this._stop(),this._handles.destroy(),this._accumulationRenderer=(0,lt.O3)(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=(0,lt.O3)(this._fbo),this._vao=(0,lt.O3)(this._vao),this._accumulationTechnique=(0,lt.RY)(this._accumulationTechnique),this._cachedLightDirections.length=0,this._sampleCount=0}setOptions(_){void 0!==_.enabled&&(this.enabled=_.enabled),void 0!==_.previewing&&(this.previewing=_.previewing),void 0!==_.lightDirections&&(this.lightDirections=_.lightDirections),this._accumulationRenderer.setOptions(_)}set previewing(_){this._previewing!==_&&(this._previewing=_,this._requestRenderIfEnabled())}set lightDirections(_){this._lightDirections=_}readAccumulatedShadow(_,v){if(!this._isActive||this._progress<1||_<0||_>this._fbo.width||v<0||v>this._fbo.height)return 0;const O=pB;return this._fbo.readPixels(_,v,1,1,Jt.VI.RGBA,Jt.Br.UNSIGNED_BYTE,O),O[0]/this._progress}_start(){this._progress=0,this._enabled=!0}_stop(){this._enabled=!1}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Jt.lk.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress],this._depthRange),this._passParameters.origin=this._bindParameters.camera.center,this._rctx.bindFramebuffer(this._fbo);const v=this.accumulationTechnique;this._rctx.bindTechnique(v,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(v.primitiveType,0,(0,_l._V)(this._vao,"geometry")),this._progress++}_updateCamera(_){_.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(_),this._fbo.resize(_.fullWidth,_.fullHeight),this._opacityFromElevation=1-(0,li.CW)(4e4,5e4,_.relativeElevation))}set enabled(_){_!==this._enabled&&(_?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}get test(){const _=this;return{lightDirections:this._lightDirections,get isDone(){return _._isDoneAccumulating},get isActive(){return _._isActive}}}};gc.previewSamples=6,gc.renderViewHandleKey="renderView",(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_progress",void 0),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_sampleCount",void 0),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_enabled",void 0),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_depthRange",void 0),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_previewing",void 0),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_accumulationRenderer",void 0),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_isRefining",null),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_isActive",null),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"canAccumulate",null),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_isDoneAccumulating",null),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"_opacityFromElevation",null),(0,Ze._)([(0,nt.Cb)()],gc.prototype,"running",null),gc=Ig=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],gc);const pB=new Uint8Array(4);var fB=T(56693),_B=T(19263);class mB extends Zc.K{constructor(){super(...arguments),this.shadowColor=(0,vi.f)(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}}class _E extends vo.A{constructor(v){super(v,null,()=>this.destroy())}initializeProgram(v){const O=_E.shader.get().build();return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({blending:(0,ls.wK)(Jt.zi.SRC_ALPHA,Jt.zi.ONE,Jt.zi.ONE_MINUS_SRC_ALPHA,Jt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:ls.BK,depthTest:null,depthWrite:null})}get primitiveType(){return Jt.MX.TRIANGLE_STRIP}}_E.shader=new vn.J(_B.S,()=>T.e(5147).then(T.bind(T,95147)));class EB{constructor(v,O){this._rctx=v,this._viewingMode=O,this._maxOpacity=1,this._passParameters=new mB,this._drawParameters=new fB.ry,this._vao=(0,$a.ow)(this._rctx)}get technique(){return(0,lt.Wi)(this._technique)&&(this._technique=new _E({rctx:this._rctx,viewingMode:this._viewingMode})),this._technique}render(v,O){if(!v.shadowMap.enabled||!v.linearDepthTexture||!this.isVisible)return;const D=this.technique;this._drawParameters.origin=v.camera.center,this._rctx.bindFramebuffer(O),this._rctx.bindTechnique(D,this._passParameters,v).bindDraw(this._drawParameters,v),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(D.primitiveType,0,(0,_l._V)(this._vao,"geometry"))}get gpuMemoryUsage(){var v,O;return null!=(O=null==(v=this._vao)?void 0:v.size)?O:0}setDefaultOptions(v){this._passParameters=or(or({},this._passParameters),v),this._updateMaxOpacity()}updateParameters(v,O){this._passParameters.opacityElevation=1-(0,li.CW)(4e4,5e4,v.relativeElevation);const D=this._viewingMode===Us.JY.Global?(0,_t.n)(oD,v.center):(0,_t.s)(oD,0,0,1),w=(0,_t.e)(D,O);this._passParameters.dayNightTerminator=(0,li.CW)(0,1,(0,li.uZ)(30*w,0,1))}dispose(){this._vao=(0,lt.O3)(this._vao),this._technique=(0,lt.RY)(this._technique)}get isVisible(){const{opacityElevation:v,dayNightTerminator:O}=this._passParameters;return this._maxOpacity*v*O>=.001953125}_updateMaxOpacity(){const v=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=v*this._passParameters.shadowColor[3]}}const oD=(0,$t.c)(),aD=(0,_s.c)();class bB{constructor(){this._plane=(0,_s.c)()}get isEnabled(){return!(0,_s.d)(this.plane,aD)}get plane(){return this._plane}set plane(v){(0,_s.a)(v||aD,this._plane)}}var CB=T(7508);class mE extends vo.A{initializeProgram(v){const O=mE.shader.get().build(this.configuration);return new ea.$(v.rctx,O,bo.i)}initializePipeline(){return(0,ls.sm)({colorWrite:ls.BK})}}mE.shader=new vn.J(CB.S,()=>T.e(7308).then(T.bind(T,57308)));var gE=T(53218);let Lg=class extends Bi.Z{constructor(_,v){super({}),this.rctx=_,this._techniqueRep=v,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=(0,lt.IM)(this._abortController),this.disable()}_loadResources(_){if((0,lt.pC)(this._abortController))return!1;if((0,lt.pC)(this._searchTexture))return!0;this._abortController=new AbortController;const v=this._abortController.signal;return T.e(3129).then(T.bind(T,63129)).then(O=>this._loadTextures(O,v)).then(()=>_()).finally(()=>this._abortController=null),!1}_loadTextures(_,v){return(0,zi.k_)(v),Promise.all([this._loadTextureFromBase64(_.areaTexture,Jt.cw.LINEAR,Jt.VI.RGB),this._loadTextureFromBase64(_.searchTexure,Jt.cw.NEAREST,Jt.VI.LUMINANCE)]).then(([O,D])=>{(0,zi.Hc)(v)?(O.dispose(),D.dispose(),(0,zi.k_)(v)):(this._areaTexture=O,this._searchTexture=D)})}get updating(){return(0,lt.pC)(this._abortController)}enable(_){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const v=new gE.L,O=(D,w)=>this._techniqueRep.releaseAndAcquire(mE,D,w);v.output=gE.f.EdgeDetector,this._edgeDetectTechnique=O(v,this._edgeDetectTechnique),v.output=gE.f.BlendWeight,this._blendWeightsTechnique=O(v,this._blendWeightsTechnique),v.output=gE.f.Blur,this._blurTechnique=O(v,this._blurTechnique)}return!!this._loadResources(_)&&(this._vao=(0,$a.E9)(this.rctx),this._edges=new pc.X(this.rctx,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE},{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGB,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.LINEAR,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:4,height:4}),this._blend=new pc.X(this.rctx,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE},{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.LINEAR,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:4,height:4}),this._isEnabled=!0,!0)}disable(){this._isEnabled&&(this._vao=(0,lt.O3)(this._vao),this._areaTexture=(0,lt.O3)(this._areaTexture),this._searchTexture=(0,lt.O3)(this._searchTexture),this._blend=(0,lt.O3)(this._blend),this._edges=(0,lt.O3)(this._edges),this._isEnabled=!1)}render(_){if(!this._isEnabled)return;const v=this.rctx,O=v.getBoundFramebufferObject(),D={x:0,y:0,width:_.descriptor.width,height:_.descriptor.height};v.bindVAO(this._vao),v.setViewport(D.x,D.y,D.width,D.height),this._edges.resize(D.width,D.height),v.bindFramebuffer(this._edges),v.setClearColor(0,0,0,1),v.clear(Jt.lk.COLOR_BUFFER_BIT);const w=v.bindTechnique(this._edgeDetectTechnique);w.bindTexture("tColor",_),w.setUniform4f("resolution",1/D.width,1/D.height,D.width,D.height),v.drawArrays(Jt.MX.TRIANGLES,0,3),this._blend.resize(D.width,D.height),v.bindFramebuffer(this._blend),v.setClearColor(0,0,1,1),v.clear(Jt.lk.COLOR_BUFFER_BIT);const te=v.bindTechnique(this._blendWeightsTechnique);te.setUniform4f("resolution",1/D.width,1/D.height,D.width,D.height),te.bindTexture("tSearch",this._searchTexture),te.bindTexture("tArea",this._areaTexture),te.bindTexture("tEdges",this._edges.colorTexture),v.drawArrays(Jt.MX.TRIANGLES,0,3),v.bindFramebuffer(O),v.setClearColor(0,1,0,1),v.clear(Jt.lk.COLOR_BUFFER_BIT);const fe=v.bindTechnique(this._blurTechnique);fe.setUniform4f("resolution",1/D.width,1/D.height,D.width,D.height),fe.bindTexture("tColor",_),fe.bindTexture("tBlendWeights",this._blend.colorTexture),v.drawArrays(Jt.MX.TRIANGLES,0,3)}_loadTextureFromBase64(_,v,O){return(0,m0.t)(_).then(D=>new ka.x(this.rctx,{pixelFormat:O,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.CLAMP_TO_EDGE,width:D.width,height:D.height,samplingMode:v},D))}};(0,Ze._)([(0,nt.Cb)()],Lg.prototype,"_abortController",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Lg.prototype,"updating",null),Lg=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],Lg);var TB=T(93783);class PB{constructor(v){this.factory=v,this.originData=new Map}acquire(v){return this.register(this.factory.getOrigin(v))}register(v){const O=this.originData.get(v.id);return O?(O.refCount++,O.origin):(this.originData.set(v.id,{refCount:1,viewMatrix:(0,Zn.c)(),origin:v}),v)}release(v){const O=this.originData.get(v.id);O&&(O.refCount--,0===O.refCount&&this.originData.delete(v.id))}updateViewMatrices(v){this.originData.forEach(O=>{(0,js.c)(O.viewMatrix,v),function OB(_,v){const O=v,D=_[0],w=_[1],te=_[2];O[12]+=D*O[0]+w*O[4]+te*O[8],O[13]+=D*O[1]+w*O[5]+te*O[9],O[14]+=D*O[2]+w*O[6]+te*O[10],O[14]+=D*O[3]+w*O[7]+te*O[11]}(O.origin.vec3,O.viewMatrix)})}getViewMatrix(v){return this.originData.get(v.id).viewMatrix}}var xB=T(97272),lD=T(89917),cD=T(25558),uD=T(51040);class DB extends uD.su{constructor(v,O,D){super(),this.distanceFalloffFactor=v,this.minimumEdgeLength=O,this.transparency=D,this.transformNormalViewFromGlobal=(0,Mp.c)()}}class AB extends uD.OU{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,Mp.c)(),this.slicePlaneLocalOrigin=(0,$t.c)(),this.transformNormalGlobalFromModel=(0,Mp.c)()}}var SB=T(71964);class yE extends vo.A{initializeProgram(v){const O=yE.shader.get().build(this.configuration);return new ea.$(v.rctx,O,Gp.so)}initializePipeline(v){return(0,ls.sm)(v.blendMinMax?{blending:(0,ls.wK)(Jt.zi.ONE,Jt.zi.ONE,Jt.zi.ZERO,Jt.zi.ONE,Jt.db.ADD,v.blendMinMax.MAX),depthTest:{func:Jt.wb.LEQUAL},colorWrite:ls.BK}:{depthTest:{func:Jt.wb.LEQUAL},depthWrite:ls.LZ,colorWrite:ls.BK})}}yE.shader=new vn.J(SB.E,()=>T.e(6625).then(T.bind(T,76625)));var Ug=T(73105);class $h extends Px.W{constructor(){super(...arguments),this.mode=Ug.Jb.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}}(0,Ze._)([(0,En.o)({count:Ug.Jb.COUNT})],$h.prototype,"mode",void 0),(0,Ze._)([(0,En.o)()],$h.prototype,"hasSlicePlane",void 0),(0,Ze._)([(0,En.o)()],$h.prototype,"silhouette",void 0),(0,Ze._)([(0,En.o)()],$h.prototype,"legacy",void 0),(0,Ze._)([(0,En.o)()],$h.prototype,"antialiasing",void 0),(0,Ze._)([(0,En.o)()],$h.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,Ze._)([(0,En.o)()],$h.prototype,"hasMultipassTerrain",void 0),(0,Ze._)([(0,En.o)()],$h.prototype,"cullAboveGround",void 0),(0,Ze._)([(0,En.o)()],$h.prototype,"spherical",void 0);var In=T(17803);const wB={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};class IB{constructor(){this._value=0}get value(){return this._value}increment(){this._value++}decrement(){this._value--}}const LB={solid:Ug.Jb.SOLID,sketch:Ug.Jb.SKETCH,uber:Ug.Jb.MIXED};class Bg{constructor(v,O,D){this.rctx=v,this.shaderTechniqueRepository=O,this._configuration=new $h,this.refCount=new IB,this.renderables=new Set,this.sortedRenderables={[In.i.TRANSPARENT]:{[In.i.TRANSPARENT]:new Ua.Z,[In.i.OPAQUE]:new Ua.Z},[In.i.OPAQUE]:{[In.i.TRANSPARENT]:new Ua.Z,[In.i.OPAQUE]:new Ua.Z}},this._renderablesDirty=!1,this._drawParameters=new AB,this._settings=or(or({},wB),D),this.key=Bg.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy),this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:Yl.Z.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=LB[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=(0,Vx.I)(v),this._configuration.spherical=D.spherical}dispose(){this._technique=(0,lt.RY)(this._technique)}addRenderable(v){this.renderables.add(v),this._renderablesDirty=!0}removeRenderable(v){this.renderables.delete(v),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(v,O){this._renderablesDirty&&this._sortRenderables(),this.sortedRenderables[O][In.i.TRANSPARENT].forAll(v),this.sortedRenderables[O][In.i.OPAQUE].forAll(v)}updateTechnique(v,O){return this._configuration.hasMultipassTerrain=!!v.multipassTerrain.enabled,this._configuration.cullAboveGround=!!v.multipassTerrain.cullAboveGround,this._configuration.silhouette=O,this._technique=this.shaderTechniqueRepository.releaseAndAcquire(yE,this._configuration,this._technique),this._technique}bindRegularEdges(v,O){return this.rctx.bindTechnique(this.updateTechnique(O,!1),v,O)}bindSilhouetteEdges(v,O){return this.rctx.bindTechnique(this.updateTechnique(O,!0),v,O)}renderRegularEdges(v,O,D,w,te){this._render(v,O,O.regular.vao,D,w,te)}renderSilhouetteEdges(v,O,D,w,te){this._render(v,O,O.silhouette.vao,D,w,te)}_render(v,O,D,w,te,fe){this._bindDraw(v,O,w,fe),this.rctx.bindVAO(D),this.rctx.capabilities.instancing.drawArraysInstanced(Jt.MX.TRIANGLE_FAN,0,4,te)}_bindDraw(v,O,D,w){if(O.components.buffer.textureBuffer.bind(v,UB,BB),"origin"in O.transform)v.setUniformMatrix4fv("localView",w),v.setUniformMatrix4fv("model",O.transform.modelMatrix),(0,_t.c)(this._drawParameters.slicePlaneLocalOrigin,O.transform.origin.vec3);else{const te=new rE(O.transform.position),fe=(0,Aa.t)(dD,(0,Aa.e)(dD,O.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=te.low,this._drawParameters.transformWorldFromModelTH=te.high,this._drawParameters.transformWorldFromModelRS=O.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=fe;const Pe=D.camera.viewInverseTransposeMatrix;(0,_t.s)(this._drawParameters.slicePlaneLocalOrigin,Pe[3],Pe[7],Pe[11])}v.bindDraw(this._drawParameters,D),"uber"!==this._settings.type&&"sketch"!==this._settings.type||this._setSketchUniforms(v)}_setSketchUniforms(v){const O=this._settings.strokesTexture,D=O.texture;(0,lt.Wi)(D)||(v.bindTexture("strokesTexture",D),v.setUniform2f("strokesTextureScale",1/D.descriptor.width,1/D.descriptor.height),v.setUniform1f("strokesLog2Resolution",Math.log2(O.resolution)),v.setUniform1f("strokesNormalizationScale",O.normalizationScale),v.setUniform1f("strokesAmplitude",O.amplitude),v.setUniform1f("strokeVariants",O.variants))}_sortRenderables(){this._renderablesDirty=!1,this.sortedRenderables[In.i.TRANSPARENT][In.i.TRANSPARENT].clear(),this.sortedRenderables[In.i.TRANSPARENT][In.i.OPAQUE].clear(),this.sortedRenderables[In.i.OPAQUE][In.i.TRANSPARENT].clear(),this.sortedRenderables[In.i.OPAQUE][In.i.OPAQUE].clear(),this.renderables.forEach(O=>{O.objectTransparency!==In.i.INVISIBLE&&O.edgeTransparency!==In.i.INVISIBLE&&this.sortedRenderables[O.objectTransparency][O.edgeTransparency].push(O)});const v=(O,D)=>"origin"in O.transform&&"origin"in D.transform?O.transform.origin.id<D.transform.origin.id?-1:O.transform.origin.id>D.transform.origin.id?1:0:0;this.sortedRenderables[In.i.TRANSPARENT][In.i.TRANSPARENT].sort(v),this.sortedRenderables[In.i.TRANSPARENT][In.i.OPAQUE].sort(v),this.sortedRenderables[In.i.OPAQUE][In.i.TRANSPARENT].sort(v),this.sortedRenderables[In.i.OPAQUE][In.i.OPAQUE].sort(v)}static getKey(v,O,D){return`edges-t:${v}:${O}:${D}`}}const UB="componentDataTex",BB="componentDataTexInvDim",dD=(0,H_.c)();var Jf,NB=T(94033);function vE(_,v){if(!_)return null;const O=_.length/2,D=FB*O,w=new Array(O);let te=0;const fe=v===Jf.PRESSURE;for(let Pe=0;Pe<_.length;Pe+=2){const Ue=(_[Pe]+_[Pe+1])/2;w[te++]=fe?Math.min(D,1-(1-Ue)*hD):Math.min(D,Ue*hD)}return w}!function(_){_[_.DISTANCE=0]="DISTANCE",_[_.PRESSURE=1]="PRESSURE"}(Jf||(Jf={}));const FB=.1,hD=.5;class WB{constructor(v,O,D,w,te){this.resolution=v,this.normalizationScale=O,this.amplitude=D,this.variants=w,this.texture=te}dispose(){this.texture=(0,lt.O3)(this.texture)}}const Hp_amplitude=8,Hp_resolution=256,Hp_strokes=[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}];function pD(_){let v=null;for(const O of _){const D=O.type;if(VB(O))if((0,lt.Wi)(v))v=D;else if(v!==D)return"uber"}return(0,lt.pC)(v)?v:"uber"}function SC(_){let v=In.i.INVISIBLE;for(const{material:O}of _)if(fD(O)){if(O.color[3]*O.opacity<1)return In.i.TRANSPARENT;v=In.i.OPAQUE}return v}function RC(_){let v=In.i.INVISIBLE;for(const{material:O}of _)if(fD(O)){switch(O.objectTransparency){case In.i.TRANSPARENT:case In.i.INVISIBLE:return In.i.TRANSPARENT;case In.i.OPAQUE:if(O.opacity<1)return In.i.TRANSPARENT}v=In.i.OPAQUE}return v}function fD(_){return _.size*_.color[3]*_.opacity>0}function VB(_){return _.size*_.color[3]>0}function _D(_,v,O){return _.length-function zB(_,v){const O=(0,Cl.$A)(_,v,!0);return-1===O?v<_[0]?0:_.length:O}(_,v*O.minimumEdgeLength)}function mD(_,v,O,D){for(let w=0;w<_.length;w++){const te=_[w].index,fe=v[w],Pe=v[w+1];if(D)for(let Ue=fe;Ue<Pe;Ue++)O.set(D[Ue],te);else for(let Ue=fe;Ue<Pe;Ue++)O.set(Ue,te)}}const GB=pn.Z.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");let hh=class extends Bi.Z{constructor(_){super(_),this.updatingHandles=new Yd.t,this.perObjectData=new Map,this.perObjectDataEvictionCache=new Set,this.renderers=new Map,this.numberOfRenderedEdges={[In.i.TRANSPARENT]:0,[In.i.OPAQUE]:0},this.gpuMemoryUsage=0,this.workerAbort=new AbortController,this.tmpModelPosition=(0,$t.c)(),this.localOrigins=new PB(new Sx.C(_.renderSR))}initialize(){this.worker=new NB.Z(this.schedule),this.componentColorManager=new $x(this.rctx,3);const _=Gp.rD.createBuffer(4);for(let v=0;v<4;v++)_.sideness.set(v,0,0===v||3===v?0:1),_.sideness.set(v,1,0===v||1===v?0:1);this.verticesBufferObject=Zl.f.createVertex(this.rctx,Jt.l1.STATIC_DRAW,_.buffer)}destroy(){this.destroyed||(this.perObjectData.forEach(_=>this._discardObjectEntry(_)),this.perObjectData.clear(),this.strokesTexture=(0,lt.O3)(this.strokesTexture),this.componentColorManager=(0,lt.SC)(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=(0,lt.O3)(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())}get updating(){return this.updatingHandles.updating}get usedMemory(){return this.gpuMemoryUsage}get numberOfRenderedPrimitives(){return this.numberOfRenderedEdges[In.i.TRANSPARENT]+this.numberOfRenderedEdges[In.i.OPAQUE]}shouldRender(){return this.renderers.size>0}addComponentObject(_,v,O,D,w,te,fe,Pe){var Ue=this;return(0,Ai.Z)(function*(){if(Ue.hasObject(_))return Ue.getObjectMemoryUsage(_);let Xe;const st=new gD(new Promise(Ct=>Xe=Ct),O.center,O.radius);Ue.perObjectData.set(_,st);const vt=yield Ue.updatingHandles.addPromise(Ue._addComponentGeometry(v,st,D,w,te,fe,Pe));return Ue.setNeedsRender(),Xe(),vt})()}addOrUpdateObject3D(_,v,O,D){var w=this;return(0,Ai.Z)(function*(){if(w.destroyed)return void GB.warn("Attempt to add an object to a destroyed instance");const te=w.perObjectData.get(_);let fe;(null==te?void 0:te.renderables.length)>0&&w.perObjectDataEvictionCache.add(te);const Pe=_.boundingVolumeWorldSpace.bounds,Ue=new gD(new Promise(st=>fe=st),(0,aa.g)(Pe),(0,aa.d)(Pe));w.perObjectData.set(_,Ue);const Xe=new Array;if(O.mergeGeometries&&_.geometries.length>1&&function KB(_){let v=null,O=null;for(let D=0;D<_.geometries.length;D++){const w=_.geometryRecords[D];if(w.material.supportsEdges){if(v){if(!(0,Cl.fS)(v,w.transformation))return!1}else v=w.transformation;if(!O&&(0,lt.pC)(w.origin))O=w;else if((0,lt.pC)(null==O?void 0:O.origin)&&(0,lt.pC)(w.origin)&&O.origin.id!==w.origin.id)return!1}}return!0}(_))Xe.push(w._addObjectMergedGeometries(_,Ue,v,O,D));else for(let st=0;st<_.geometries.length;st++){const vt=_.geometryRecords[st];vt.material.supportsEdges&&Xe.push(w._addGeometry(_,Ue,_.geometries[st],vt,v[0],O,D))}yield w.updatingHandles.addPromise(Promise.all(Xe)),w.perObjectDataEvictionCache.delete(Ue),w._discardObjectEntry(te),w.setNeedsRender(),fe()})()}_discardObjectEntry(_){_&&(_.renderables.length&&(_.renderables.forEach(v=>this._removeRenderable(v)),this.setNeedsRender()),_.loaded=null)}hasObject(_){return this.perObjectData.has(_)}updateAllComponentOpacities(_,v){var O=this;return(0,Ai.Z)(function*(){const D=v instanceof Array?w=>v[w]:()=>v;(yield O.updatingHandles.addPromise(O._getObjectEntry(_))).renderables.forEach(w=>{const te=w.components.meta.length;for(let fe=0;fe<te;fe++){const Pe=D(fe),Ue=w.components.meta[fe],Xe=Ue.index;Ue.material.opacity=Pe,w.components.buffer.textureBuffer.setDataElement(Xe,1,3,255*Pe)}O._updateTransparency(w)}),O.setNeedsRender()})()}getObjectMemoryUsage(_){var v=this;return(0,Ai.Z)(function*(){return(yield v._getObjectEntry(_)).renderables.reduce((O,D)=>O+D.statistics.gpuMemoryUsage,0)})()}updateAllComponentMaterials(_,v,O,D){var w=this;return(0,Ai.Z)(function*(){const te=_ instanceof xB.T,fe=!!O.hasSlicePlane,Pe=pD(v),Ue=Bg.getKey(Pe,fe,te);(yield w.updatingHandles.addPromise(w._getObjectEntry(_))).renderables.forEach(Xe=>{if(Ue!==Xe.rendererKey){const st=w.renderers.get(Xe.rendererKey),vt=w._acquireRenderer(Pe,fe,te);st.removeRenderable(Xe),st.refCount.decrement(),Xe.rendererKey=Ue,vt.addRenderable(Xe)}for(let st=0;st<v.length;st++)Xe.components.meta[st].material=v[st];D&&w._updateComponentBuffer(Xe.components),w._updateTransparency(Xe)}),w.setNeedsRender()})()}updateAllVerticalOffsets(_,v){var O=this;return(0,Ai.Z)(function*(){(yield O.updatingHandles.addPromise(O._getObjectEntry(_))).renderables.forEach(D=>{var te;const w=D.components.meta;for(let fe=0;fe<w.length;fe++)D.components.meta[fe].verticalOffset=null!=(te=null==v?void 0:v[fe])?te:0;O._updateComponentBuffer(D.components)}),O.setNeedsRender()})()}updateObjectVisibility(_,v){var O=this;return(0,Ai.Z)(function*(){(yield O.updatingHandles.addPromise(O._getObjectEntry(_))).renderables.forEach(D=>D.visible=v),O.setNeedsRender()})()}removeObject(_){const v=this.perObjectData.get(_);v&&(this.perObjectData.delete(_),this._discardObjectEntry(v))}_getObjectEntry(_){var v=this;return(0,Ai.Z)(function*(){const O=v.perObjectData.get(_);if(!O)throw"no object";if(yield O.loaded,null==O.loaded)throw(0,zi.zE)();return O})()}removeAll(){this.perObjectData.forEach((_,v)=>this.removeObject(v))}render(_,v){if(this.numberOfRenderedEdges[v]=0,(0,lt.Wi)(this.componentColorManager))return;this.localOrigins.updateViewMatrices(_.camera.viewMatrix);const O=_.camera.viewInverseTransposeMatrix,D=(0,$t.c)(),w=new rE;let te=0,fe=0;if(this.renderers.forEach(st=>{0===st.refCount.value?(this.renderers.delete(st.key),st.dispose()):st.forEachRenderable(vt=>{vt.visible&&(te+=vt.statistics.averageEdgeLength,fe++,vt.regular&&st.updateTechnique(_,!1),vt.silhouette&&st.updateTechnique(_,!0))},v)}),this.componentColorManager.garbageCollect(),this.componentColorManager.updateTextures(),0===fe)return;const Xe=new DB(40*te/fe,_.camera.perScreenPixelRatio,v);(0,_t.s)(D,O[3],O[7],O[11]),w.set(D),(0,_t.c)(Xe.transformWorldFromViewTH,w.high),(0,_t.c)(Xe.transformWorldFromViewTL,w.low),(0,Aa.f)(Xe.transformViewFromCameraRelativeRS,_.camera.viewMatrix),(0,Aa.t)(yD,Xe.transformViewFromCameraRelativeRS),(0,Aa.e)(Xe.transformNormalViewFromGlobal,yD),Xe.transformProjFromView=_.camera.projectionMatrix,this._updateObjectCameraDistances(_),this.renderers.forEach(st=>{this._renderRegularEdges(st,_,Xe),this._renderSilhouetteEdges(st,_,Xe)})}_updateTransparency(_){const v=SC(_.components.meta),O=RC(_.components.meta);v===_.edgeTransparency&&O===_.objectTransparency||(_.edgeTransparency=v,_.objectTransparency=O,this.renderers.get(_.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(_,v,O){if(_.getCombinedStaticTransformation(v,O),(0,lt.pC)(v.origin))this.localOrigins.register(v.origin);else{const D=(0,_t.s)(this.tmpModelPosition,O[12],O[13],O[14]);v.origin=this.localOrigins.acquire(D)}return function MB(_,v){const O=v,D=-_[0],w=-_[1],te=-_[2],fe=O[3],Pe=O[7],Ue=O[11],Xe=O[15];O[0]+=fe*D,O[1]+=fe*w,O[2]+=fe*te,O[4]+=Pe*D,O[5]+=Pe*w,O[6]+=Pe*te,O[8]+=Ue*D,O[9]+=Ue*w,O[10]+=Ue*te,O[12]+=Xe*D,O[13]+=Xe*w,O[14]+=Xe*te}(v.origin.vec3,O),v.origin}_updateComponentBuffer(_){const{meta:v,buffer:O}=_,D=new Uint8Array(4);for(let w=0;w<v.length;w++){const te=v[w].material,fe=v[w].index,Pe=(0,li.uZ)(Math.round(8*te.size),0,255),Ue=(0,li.uZ)(te.extensionLength,-128,127)+128,Xe="solid"===te.type?cD.P.SOLID:cD.P.SKETCH,st=255*te.opacity,vt=te.color;O.textureBuffer.setData(fe,0,255*vt[0],255*vt[1],255*vt[2],255*vt[3]),O.textureBuffer.setData(fe,1,Pe,Ue,Xe,st),(0,xg.nO)(v[w].verticalOffset,D),O.textureBuffer.setData(fe,2,D[0],D[1],D[2],D[3])}}_createComponentBuffers(_){if((0,lt.Wi)(this.componentColorManager))return null;const v=new Array,O=this.componentColorManager.getBuffer(_.length);for(let w=0;w<_.length;w++){const te=_[w],fe=O.acquireIndex();v.push({index:fe,verticalOffset:0,material:te})}const D={meta:v,buffer:O};return this._updateComponentBuffer(D),D}_extractEdges(_,v,O,D,w,te=w.length){return this.worker.process({data:v,indices:w,indicesLength:te,writerSettings:_,skipDeduplicate:O},this.workerAbort.signal,D)}_createEdgeResources(_){const v={};if((0,lt.Wi)(this.verticesBufferObject))return v;if(_.regular.lodInfo.lengths.length>0){const O=new ku.U(this.rctx,Gp.so,{vertices:Gp.dx,instances:lD.D9.glLayout},{vertices:this.verticesBufferObject,instances:Zl.f.createVertex(this.rctx,Jt.l1.STATIC_DRAW,_.regular.instancesData.buffer)});v.regular={vao:O,lod:_.regular.lodInfo}}if(_.silhouette.lodInfo.lengths.length>0){const O=new ku.U(this.rctx,Gp.so,{vertices:Gp.dx,instances:lD.qE.glLayout},{vertices:this.verticesBufferObject,instances:Zl.f.createVertex(this.rctx,Jt.l1.STATIC_DRAW,_.silhouette.instancesData.buffer)});v.silhouette={vao:O,lod:_.silhouette.lodInfo}}return v}_addGeometry(_,v,O,D,w,te,fe){var Pe=this;return(0,Ai.Z)(function*(){const Ue=O.vertexAttributes.get(Fo.T.POSITION),Xe=O.indices.get(Fo.T.POSITION),st=(0,Zn.c)(),vt={position:Ue,indices:Xe,modelTransform:st,origin:Pe._computeModelTransformWithLocalOrigin(_,D,st)};return Pe._addPositionData(v,vt,O.edgeIndicesLength,w,te,fe)})()}_addPositionData(_,v,O,D,w,te=!1){var fe=this;return(0,Ai.Z)(function*(){if(null==_.loaded)return;const Pe=fe._createComponentBuffers([D]);if((0,lt.Wi)(Pe)||O<=0)return;const Ue=fe._acquireRenderer(D.type,!!w.hasSlicePlane,!0),{modelTransform:Xe,origin:st}=v,vt=v.indices,Ct=v.position,Wt=Ct.data.length/Ct.size,Kt=Gp.tf.createBuffer(Wt);for(let br=0;br<Wt;br++)Kt.position.set(br,0,Ct.data[br*Ct.size+0]),Kt.position.set(br,1,Ct.data[br*Ct.size+1]),Kt.position.set(br,2,Ct.data[br*Ct.size+2]);mD(Pe.meta,[0,Kt.componentIndex.count],Kt.componentIndex);const Lt=yield fe.updatingHandles.addPromise(fe._extractEdges(Ue.writerSettings,Kt,!1,te,vt,O));if(null==_.loaded)return;const{regular:nr,silhouette:sr}=fe._createEdgeResources(Lt),Er=(nr?nr.vao.size:0)+(sr?sr.vao.size:0),yr={regular:nr,silhouette:sr,transform:{modelMatrix:Xe,origin:st},statistics:{gpuMemoryUsage:Er,externalMemoryUsage:!1,averageEdgeLength:Lt.averageEdgeLength},components:Pe,visible:!0,edgeTransparency:SC(Pe.meta),objectTransparency:RC(Pe.meta),distanceToCamera:0,rendererKey:Ue.key};_.renderables.push(yr),Ue.addRenderable(yr),fe.gpuMemoryUsage+=Er})()}_addComponentGeometry(_,v,O,D,w,te,fe){var Pe=this;return(0,Ai.Z)(function*(){if(null==v.loaded)return 0;const Ue=Pe._createComponentBuffers(te);if((0,lt.Wi)(Ue))return 0;const Xe=pD(te),st=Pe._acquireRenderer(Xe,fe.hasSlicePlane||!1,!1),vt=Gp.tf.createBuffer(O.count);(0,Rx.c)(vt.position,O),mD(Ue.meta,w,vt.componentIndex,D);const Wt=st.writerSettings,Kt=yield Pe.updatingHandles.addPromise(Pe._extractEdges(Wt,vt,!0,!1,D));if(null==v.loaded)return 0;const{regular:Lt,silhouette:nr}=Pe._createEdgeResources(Kt),sr=(Lt?Lt.vao.size:0)+(nr?nr.vao.size:0),Er={regular:Lt,silhouette:nr,transform:_,statistics:{gpuMemoryUsage:sr,externalMemoryUsage:!0,averageEdgeLength:Kt.averageEdgeLength},components:Ue,visible:!0,edgeTransparency:SC(Ue.meta),objectTransparency:RC(Ue.meta),distanceToCamera:0,rendererKey:st.key};return v.renderables.push(Er),st.addRenderable(Er),sr})()}_addObjectMergedGeometries(_,v,O,D,w){var te=this;return(0,Ai.Z)(function*(){const fe=new Map;let Pe=0,Ue=null,Xe=0;for(let Er=0;Er<_.geometries.length;Er++){const yr=_.geometries[Er],br=_.geometryRecords[Er];if(!br.material.supportsEdges)continue;!Ue&&br.origin&&(Ue=br);const Rr=yr.vertexAttributes.get(Fo.T.POSITION);Xe+=Rr.data.length/Rr.size,Pe+=yr.edgeIndicesLength}const st=Xe>=65536?Uint32Array:Uint16Array,vt=Pe?new st(Pe):null,Ct=[];let Wt=0;for(let Er=0;Er<_.geometries.length;Er++){const yr=_.geometries[Er];if(!_.geometryRecords[Er].material.supportsEdges)continue;const br=yr.vertexAttributes.get(Fo.T.POSITION),Rr=yr.indices.get(Fo.T.POSITION);let $r=fe.get(br.data);if(null==$r){$r=Ct.length/3;for(let si=0;si<br.data.length;si+=br.size)Ct.push(br.data[si+0]),Ct.push(br.data[si+1]),Ct.push(br.data[si+2]);fe.set(br.data,$r)}if(Rr)for(let si=0;si<yr.edgeIndicesLength;si++)vt[Wt++]=$r+Rr[si]}const Kt=Ue||_.geometryRecords[0],Lt=(0,Zn.c)(),nr=te._computeModelTransformWithLocalOrigin(_,Kt,Lt);for(let Er=0;Er<_.geometryRecords.length;Er++)_.geometryRecords[Er].origin=nr;const sr={position:{data:Ct,size:3},indices:vt,modelTransform:Lt,origin:nr};yield te.updatingHandles.addPromise(te._addPositionData(v,sr,vt.length,O[0],D,w))})()}_acquireRenderer(_,v,O){const D=Bg.getKey(_,v,O);let w=this.renderers.get(D);return(0,lt.Wi)(this.strokesTexture)&&(this.strokesTexture=function jB(_){const O=Hp_resolution,D=O/2,w=new Uint8Array(4*O*O),te=4*O*D,fe=Hp_amplitude,Pe=2*fe,Ue=4*O,Xe=Math.log2(O)+1,st=Hp_strokes.length;let vt=(Xe-1)*st*Ue;for(const{distance:Wt,pressure:Kt}of Hp_strokes){let Lt=Wt,nr=Kt,sr=vt;for(let Er=0;Er<Xe;Er++){0!==Er&&(Lt=vE(Lt,Jf.DISTANCE),nr=vE(nr,Jf.PRESSURE));for(let yr=0;yr<Hp_resolution;yr++){const Rr=nr?nr[yr%nr.length]:1;(0,oE.I)(.5+(Lt?Lt[yr%Lt.length]/Pe:0),w,sr),(0,oE.I)(Rr,w,sr+te),sr+=4}sr-=Ue*(st+1)}vt+=Ue}const Ct=new ka.x(_,{pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:Jt.cw.LINEAR,width:O,height:O,wrapMode:Jt.e8.REPEAT},w);return new WB(O,Pe,fe,st,Ct)}(this.rctx)),w||(w=new Bg(this.rctx,this.techniqueRepository,{type:_,hasSlicePlane:v,strokesTexture:this.strokesTexture,legacy:O,spherical:this.viewingMode===Us.JY.Global}),this.renderers.set(D,w)),w.refCount.increment(),w}_removeRenderable(_){!function HB(_){_.regular&&(_.regular.vao.vertexBuffers.instances.dispose(),_.regular.vao.dispose(!1),_.regular.vao=null),_.silhouette&&(_.silhouette.vao.vertexBuffers.instances.dispose(),_.silhouette.vao.dispose(!1),_.silhouette.vao=null)}(_);const v=this.renderers.get(_.rendererKey);if(v){v.removeRenderable(_),v.refCount.decrement(),"origin"in _.transform&&this.localOrigins.release(_.transform.origin),this.gpuMemoryUsage-=_.statistics.externalMemoryUsage?0:_.statistics.gpuMemoryUsage;for(const O of _.components.meta)_.components.buffer.releaseIndex(O.index)}}_updateObjectCameraDistances(_){const v=_.camera.eye,O=_.camera.viewForward,D=(0,$t.c)(),w=te=>{const{center:fe,radius:Pe}=te;(0,_t.v)(D,fe,v);const Ue=(0,_t.e)(D,O),Xe=Ue<-Pe?1/0:Ue<Pe?0:Ue-Pe;te.renderables.forEach(st=>st.distanceToCamera=Xe)};this.perObjectData.forEach(w),this.perObjectDataEvictionCache.forEach(w)}_renderRegularEdges(_,v,O){const D=_.bindRegularEdges(O,v),w=O.transparency;_.forEachRenderable(te=>{if(!te.visible||!te.regular)return;const fe=_D(te.regular.lod.lengths,te.distanceToCamera,O),Pe="origin"in te.transform?this.localOrigins.getViewMatrix(te.transform.origin):Zn.I;_.renderRegularEdges(D,te,v,fe,Pe),this.numberOfRenderedEdges[w]+=fe},w)}_renderSilhouetteEdges(_,v,O){const D=_.bindSilhouetteEdges(O,v),w=O.transparency;_.forEachRenderable(te=>{if(!te.visible||!te.silhouette)return;const fe=_D(te.silhouette.lod.lengths,te.distanceToCamera,O),Pe="origin"in te.transform?this.localOrigins.getViewMatrix(te.transform.origin):Zn.I;_.renderSilhouetteEdges(D,te,v,fe,Pe),this.numberOfRenderedEdges[w]+=fe},w)}};(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],hh.prototype,"rctx",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],hh.prototype,"renderSR",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],hh.prototype,"viewingMode",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],hh.prototype,"techniqueRepository",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],hh.prototype,"setNeedsRender",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],hh.prototype,"schedule",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],hh.prototype,"updatingHandles",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],hh.prototype,"updating",null),hh=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],hh);class gD{constructor(v,O,D){this.center=O,this.radius=D,this.renderables=new Array,this.loaded=v,this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})}}const yD=(0,Mp.c)();var ZB=T(38516),wC=T(73362),$B=T(52323);class YB{constructor(v){this.timer=v,this.start=v.createQuery(),v.createTimestamp(this.start)}stop(v,O=50){this.end=this.timer.createQuery(),this.timer.createTimestamp(this.end),this._checkQueryResult(v,O)}_checkQueryResult(v,O){if(!this.timer.resultAvailable(this.end))return void setTimeout(()=>this._checkQueryResult(v,O),O);if(this.timer.disjoint())return void v(null);const D=this.timer.getResult(this.start),w=this.timer.getResult(this.end);v((w-D)/1e6)}}class JB{constructor(v){this.timer=v,this.query=v.createQuery(),IC=!0,this.timer.beginTimeElapsed(this.query)}stop(v,O=50){this.timer.endTimeElapsed(),IC=!1,this._checkQueryResult(v,O)}_checkQueryResult(v,O){const D=this.timer.resultAvailable(this.query),w=this.timer.disjoint();if(!D||w)w?v(null):setTimeout(()=>this._checkQueryResult(v,O),O);else{const te=this.timer.getResult(this.query);v(te/1e6)}}}let IC=!1;var ja;!function(_){_[_.Prepare=0]="Prepare",_[_.Shadowmap=1]="Shadowmap",_[_.Lineardepth=2]="Lineardepth",_[_.Normals=3]="Normals",_[_.SSAO=4]="SSAO",_[_.Opaque=5]="Opaque",_[_.OpaqueEdges=6]="OpaqueEdges",_[_.Transparent=7]="Transparent",_[_.TransparentEdges=8]="TransparentEdges",_[_.Hudvisibility=9]="Hudvisibility",_[_.TransparentTerrain=10]="TransparentTerrain",_[_.Atmosphere=11]="Atmosphere",_[_.Laserline=12]="Laserline",_[_.Occluded=13]="Occluded",_[_.Antialiasing=14]="Antialiasing",_[_.Highlights=15]="Highlights",_[_.HudOccluded=16]="HudOccluded",_[_.HudNotoccluded=17]="HudNotoccluded"}(ja||(ja={}));const XB=["prepare","shadowmap","lineardepth","normals","ssao","opaque","opaque edges","transparent","transparent edges","hudvisibility","transparent terrain","atmosphere","laserline","occluded","antialiasing","highlights","hudOccluded","hudNotoccluded"];class QB extends wC.Z{constructor(){super("total"),this.total=0,this.frameCount=0}}class qB{constructor(){this._startTime=(0,io.HA)(0),this._lastSample=(0,io.HA)(0),this._enableGPUTimer=0,this.totalTime=new QB,this.gpuTime=new wC.Z("gpu",9),this.renderPassTimings=XB.map(v=>new wC.Z(v))}get elapsedTime(){return(0,io.HA)(performance.now()-this._startTime)}enableGPUTimer(){return++this._enableGPUTimer,{remove:(0,$B.IH)(()=>--this._enableGPUTimer)}}prerender(v){this._startTime=this._lastSample=(0,io.HA)(performance.now()),this._enableGPUTimer&&(this._gpuTimer=function kB(_){const v=_.capabilities.disjointTimerQuery;return(0,lt.Wi)(v)?null:v.timestampBits()>0?new YB(v):IC?null:new JB(v)}(v))}advance(v){const O=(0,io.HA)(performance.now());this.renderPassTimings[v].record(O-this._lastSample),this._lastSample=O}postrender(){(0,lt.pC)(this._gpuTimer)&&(this._gpuTimer.stop(O=>(0,lt.pC)(O)&&this.gpuTime.record(O),16),this._gpuTimer=null);const v=performance.now()-this._startTime;this.totalTime.record(v),this.totalTime.total+=v,this.totalTime.frameCount++}}let Kp=class extends Bi.Z{constructor(_,v,O,D,w,te,fe,Pe,Ue){super({}),this._materialRepository=_,this._shaderTechniqueRepository=O,this._rctx=D,this._compositingHelper=w,this._magnifierHelper=te,this._requestRender=fe,this._stage=Ue,this._materialRenderers=new Map,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._content=new Map,this._isRendering=!1,this._fallbackDepthStencilTexture=null,this.performanceInfo=new qB,this._antialiasing=Fs.C_.SMAA,this._oitEnabled=!1,this._multipassTerrain=!0,this._transparentTerrain=!1,this._hasAnimations=!1,this._animationTimestep=(0,io.HA)(0),this._handles=new cn.Z,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this._smaaPass=new Lg(this._rctx,O),this._oitEnabled=this._hasOITSupport,this._requestRender(),this._offscreenRendering=new tB(this._rctx,this._compositingHelper),this._sliceHelper=new bB,this._shadowMap=new pE.l(this._rctx,Ue.viewingMode,2),this._ssaoHelper=new TB.L(O,this._rctx,()=>this._requestRender()),this._highlight=new J6(O,this._rctx),this._shadowHighlight=new EB(this._rctx,Ue.viewingMode),this._shadowAccumulator=new gc(this._rctx,O,Ue,Xe=>{const st=this.shadowsEnabled;this._shadowMap.enabled=!0,this._ensureCameraBindParameters(Xe.camera,Xe.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=st},(Xe,st,vt)=>{Xe.shadowMap.start(Xe.camera,st,vt),this._renderShadowCascades(gn.C.MATERIAL_DEPTH_SHADOWMAP_ALL,Xe.shadowMap),Xe.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(Xe.camera,Xe.contentCamera)},()=>this._requestRender()),this._renderContext=new sB.V(this._rctx,this._offscreenRendering,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new oB({renderContext:this._renderContext,shaderTechniqueRepository:O,textureRep:v,materialRep:this._materialRepository,requestRender:this._requestRender,schedule:Pe}),this.renderPassManager=new Z6(this._rctx,this._shaderTechniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([(0,pt.YP)(()=>this._stage.state.camera,()=>this._requestRender(),pt.tX),(0,pt.YP)(()=>Yl.Z.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,Xe=>{this._renderHiddenTransparentEdges=Xe?()=>this._renderEdges(In.i.TRANSPARENT):()=>{},this._requestRender()},pt.nn)])}get _bindParameters(){return this._renderContext.bindParameters}get hasWater(){return this._hasWater||this._hasOverlayWater}get hasWaterReflection(){return this.hasWater&&this._waterReflectionEnabled}normalizeCtorArgs(){return{}}dispose(){this._handles.destroy(),this._smaaPass.dispose(),this._materialRenderers.forEach(_=>_.dispose()),this._materialRenderers.clear(),this._edgeView=(0,lt.SC)(this._edgeView),this._offscreenRendering.dispose(),this._fallbackDepthStencilTexture=(0,lt.O3)(this._fallbackDepthStencilTexture),this._shadowMap.enabled=!1,this._shadowMap.dispose(),this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),$6.j.prune(),this._content.clear()}disposeOffscreenBuffers(){this._offscreenRendering.dispose(),this._shadowMap.dispose(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing===Fs.C_.SMAA&&this._smaaPass.updating||(0,lt.pC)(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}ensureEdgeView(){return(0,lt.Wi)(this._edgeView)&&(this._edgeView=new hh({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:_=>this._stage.resourceController.schedule(_)}),this._handles.add((0,pt.YP)(()=>(0,lt.yw)(this._edgeView,_=>_.updating),()=>this._requestRender(),pt.Z_)),this._requestRender()),this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return(0,js.v)(this._bindParameters.ssr.reprojectionMatrix,Zn.I)}set _reprojectionMatrix(_){(0,Cl.Vx)(this._bindParameters.ssr.reprojectionMatrix,_)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var _;return!!(null==(_=this._shadowMap)?void 0:_.enabled)}setRenderParameters(_){const{_shadowMap:v,_ssaoHelper:O,_bindParameters:D}=this;if(void 0!==_.screenSpaceReflectionsEnabled&&D.ssr.enabled!==_.screenSpaceReflectionsEnabled&&(D.ssr.enabled=_.screenSpaceReflectionsEnabled,this._requestRender()),void 0!==_.shadowMap&&v.enabled!==_.shadowMap&&(v.enabled=_.shadowMap,this._requestRender()),void 0!==_.shadowMapMaxCascades&&v.maxCascades!==_.shadowMapMaxCascades&&(v.maxCascades=_.shadowMapMaxCascades,this._requestRender()),(0,lt.pC)(_.environment)){(0,lt.pC)(_.environment.weather)&&(this._bindParameters.weather=_.environment.weather,this._bindParameters.weatherVisible=_.weatherVisible,this._renderContext.bindParameters.weather=_.environment.weather,this._renderContext.bindParameters.weatherVisible=_.weatherVisible),void 0!==_.environment.lighting.ambientOcclusionEnabled&&O.enabled!==_.environment.lighting.ambientOcclusionEnabled&&(O.enabled=_.environment.lighting.ambientOcclusionEnabled,this._requestRender()),void 0!==_.environment.lighting.waterReflectionEnabled&&this._waterReflectionEnabled!==_.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=_.environment.lighting.waterReflectionEnabled,this._requestRender());const te="sun"===_.environment.lighting.type;D.enableFillLights!==te&&(D.enableFillLights=te,this._requestRender())}_.background&&this._offscreenRendering.background!==_.background&&(this._offscreenRendering.background=_.background,this._requestRender());const w=_.antialiasingEnabled?Fs.C_.SMAA:Fs.C_.NONE;void 0!==_.antialiasingEnabled&&this._antialiasing!==w&&(this._antialiasing=w,this._requestRender()),void 0!==_.highQualityTransparency&&this._multipassTerrain!==_.highQualityTransparency&&(this._multipassTerrain=_.highQualityTransparency,this._oitEnabled=_.highQualityTransparency&&this._hasOITSupport,this._requestRender()),void 0!==_.defaultHighlightOptions&&(this._highlight.setDefaultOptions(_.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(_.defaultHighlightOptions),this._requestRender()),void 0!==_.overlays&&this._bindParameters.overlays!==_.overlays&&(this._bindParameters.overlays=_.overlays,this._requestRender()),void 0!==_.slicePlane&&this._sliceHelper.plane!==_.slicePlane&&(this._sliceHelper.plane=(0,lt.Wg)(_.slicePlane),this._requestRender()),void 0!==_.transparentTerrain&&this._transparentTerrain!==_.transparentTerrain&&(this._transparentTerrain=_.transparentTerrain,this._requestRender()),void 0!==_.hasOverlayWater&&this._hasOverlayWater!==_.hasOverlayWater&&(this._hasOverlayWater=_.hasOverlayWater,this._requestRender()),void 0!==_.shadowCastOptions&&this._shadowAccumulator.setOptions(_.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlendWorking}modify(_){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:v,removes:O,updates:D}=_;if(0===v.length&&0===O.length&&0===D.length)return;O.forAll(({id:fe})=>this._content.delete(fe)),v.forAll(fe=>this._content.set(fe.id,fe));const w=(0,nB.q)(_);let te=!1;w.forEach((fe,Pe)=>{let Ue=this._materialRenderers.get(Pe);if(!Ue){if(!(fe.adds.length>0))return;Ue=new ZB.A(this._rctx,this._materialRepository,Pe),this._materialRenderers.set(Pe,Ue)}Ue.modify(fe),Ue.isEmpty&&(te=!0)}),te&&this._materialRenderers.forEach((fe,Pe)=>{fe.isEmpty&&(this._materialRenderers.delete(Pe),fe.dispose())}),this._hasHighlights=(0,ya.oE)(this._materialRenderers,fe=>fe.hasHighlights),this._bindParameters.hasOccludees=(0,ya.oE)(this._materialRenderers,fe=>fe.hasOccludees),this._hasWater=(0,ya.oE)(this._materialRenderers,fe=>fe.hasWater),this._needsTransparentPass=(0,ya.oE)(this._materialRenderers,fe=>fe.requiresSlot(fn.r.TRANSPARENT_MATERIAL,gn.C.MATERIAL)),this._hasHUDElements=(0,ya.oE)(this._materialRenderers,fe=>fe.requiresSlot(fn.r.LINE_CALLOUTS_HUD_DEPTH,gn.C.MATERIAL)||fe.requiresSlot(fn.r.HUD_MATERIAL,gn.C.MATERIAL)||fe.requiresSlot(fn.r.LABEL_MATERIAL,gn.C.MATERIAL)),this._requestRender()}updateAnimation(_){return this._hasAnimations=!1,this._materialRenderers.forEach(v=>this._hasAnimations=v.updateAnimation(_)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(_)||this._hasAnimations,this._hasAnimations}get animationTimestep(){return this._animationTimestep}updateLightSources(_,v,O){this._bindParameters.lighting.groundLightingFactor=v,this._bindParameters.lighting.globalFactor=O,this._bindParameters.lighting.set(_)}render(_,v,O,D){this._isRendering=!0,this.performanceInfo.prerender(this._rctx),this._bindParameters.transparencyPassType=Fs.Am.NONE;const w=this._offscreenRendering;w.needLastFrameColorTexture=this.hasWaterReflection,w.advanceCurrentRenderTarget();const te=(0,_s.c)(this._sliceHelper.plane);D===Fs.Iq.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(_),v.setGLViewport(this._rctx),this._ensureCameraBindParameters(v,O),this._renderPlugins.prepareRender(),this.performanceInfo.advance(ja.Prepare);const fe=this._computeDepthRange(v);this._renderShadowMap(_,v,this._bindParameters.lighting.lightingMainDirection,fe),this.performanceInfo.advance(ja.Shadowmap),w.initializeFrame(v),this._ensureBindParameters(v,O),this._renderLinearDepth(),this.performanceInfo.advance(ja.Lineardepth),this._accumulateShadows(fe,v,O),this._renderNormal(),this.performanceInfo.advance(ja.Normals),this._ensureBindParametersSSR(),this._ssaoHelper.computeSSAO(this._bindParameters,w.linearDepthTexture,w.normalTexture),this.performanceInfo.advance(ja.SSAO),this._renderContext.pass=gn.C.MATERIAL,w.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(ja.Opaque);const Pe=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(Pe),this._setMultipassEnabled(Pe),this._setTerrainCulling(Pe),this._renderEdges(In.i.OPAQUE),this.performanceInfo.advance(ja.OpaqueEdges),this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth),this._renderSlot(fn.r.VOXEL),this._renderHiddenTransparentEdges();const Ue=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;Ue&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(ja.Transparent),this._renderGeometryLinearDepth(Pe);const Xe=this._renderHUDVisibility();Pe||this._renderInternalSlot(fn.r.LINE_CALLOUTS),this.performanceInfo.advance(ja.Hudvisibility),this._renderEdges(In.i.TRANSPARENT,Pe),this.performanceInfo.advance(ja.TransparentEdges),this._renderTransparentTerrain(),this._transparentTerrain&&Xe&&(Pe?this._renderLineCallouts(Y0.v.Occluded):w.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Y0.v.Occluded,w.framebuffer),this.performanceInfo.advance(ja.HudOccluded)),this.performanceInfo.advance(ja.TransparentTerrain),this._setTerrainCulling(!1),this._transparentTerrain&&(w.compositeTransparentTerrainOntoMain(this._bindParameters),Pe&&(this._renderEdges(In.i.OPAQUE),this.performanceInfo.advance(ja.OpaqueEdges),Ue&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(ja.Transparent),this._renderEdges(In.i.TRANSPARENT),this.performanceInfo.advance(ja.TransparentEdges))),Pe&&this._renderLineCallouts(Y0.v.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),w.renderToTargets(()=>{this._renderInternalSlot(fn.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(fn.r.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(fn.r.LASERLINES)},w.currentColorTarget,w.mainDepth),this.performanceInfo.advance(ja.Atmosphere),this._renderPlugins.needsLaserlineWithContrastControl&&w.renderTmpAndCompositeToMain(()=>this._renderSlot(fn.r.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Xl.Fv.PremultipliedAlpha),this.performanceInfo.advance(ja.Laserline),this._renderOccluded(),this.performanceInfo.advance(ja.Occluded);const st=D===Fs.Iq.ON&&this._magnifierHelper.enabled,vt=st&&(0,lt.Wi)(_)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):_;this._rctx.bindFramebuffer(vt);const Ct=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,Ct)&&(0,lt.pC)(Ct)&&this._compositingHelper.composite(this._bindParameters,Ct,Xl.Fv.None),this.performanceInfo.advance(ja.Antialiasing),this._renderHUD(Y0.v.NotOccluded,vt),this.performanceInfo.advance(ja.HudNotoccluded),this._renderHighlights(vt,this._bindParameters),this.performanceInfo.advance(ja.Highlights),st&&this._magnifierHelper.render(this._rctx,this._bindParameters),vt!==_&&(this._rctx.bindFramebuffer(_),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,Xl.Fv.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=te,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.postrender()}finish(_){this._hasAnimations||(this._animationTimestep=(0,io.HA)(0)),_===Fs.Xx.BACKGROUND&&(this._rctx.gl.getError(),this._animationTimestep=(0,io.HA)(Math.max(.9*this._animationTimestep+this.performanceInfo.elapsedTime/.5*(1-.9),K6)))}readDepthPixels(_,v,O){const D=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this._needsLinearDepth||(this._ensureBindParameters(_,_),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Jt.lk.COLOR_BUFFER_BIT|Jt.lk.DEPTH_BUFFER_BIT|Jt.lk.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(gn.C.MATERIAL_DEPTH)),D.readPixels(v[0],v[1],v[2],v[3],Jt.VI.RGBA,Jt.Br.UNSIGNED_BYTE,O)}readHUDVisibility(_,v,O,D,w){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(_,v,O,D,Jt.VI.RGBA,Jt.Br.UNSIGNED_BYTE,w)}readAccumulatedShadow(_,v){return this._shadowAccumulator.readAccumulatedShadow(_,v)}_setMultipassEnabled(_){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=_}_setTerrainCulling(_){this._bindParameters.multipassTerrain.cullAboveGround=_}_renderSlot(_){this._bindParameters.slot=_,this._renderPlugins.render()}_renderEdges(_,v=!1){const O=this._edgeView;(0,lt.pC)(O)&&O.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>O.render(this._bindParameters,_),this._bindParameters,Xl.Fv.Alpha,v)}_renderShadowMap(_,v,O,D){const w=this._shadowMap;w.enabled&&(w.start(v,O,D),this._shadowHighlight.updateParameters(v,O),this.needsShadowHighlight?(this._renderShadowCascades(gn.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,te=>w.takeCascadeSnapshotTo(te,pE.i.Highlight)),w.clear(),this._renderShadowCascades(gn.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,te=>{w.takeCascadeSnapshotTo(te,pE.i.Default),this._renderGeometryAndTransparentTerrainPass(gn.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(gn.C.MATERIAL_DEPTH_SHADOWMAP_ALL),w.finish(_),v.setGLViewport(this._rctx))}_renderShadowCascades(_,v=this._shadowMap,O=(D=>{})){for(const D of v.getCascades())D.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(D.camera,D.camera),this._renderGeometryAndTransparentTerrainPass(_),O(D)}get _needsLinearDepth(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(gn.C.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth),this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture}_renderTerrainLinearDepth(_){if(_){const v=this._renderContext.pass;this._renderContext.pass=gn.C.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.pass=v}else this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture}_renderGeometryLinearDepth(_){if(_){const v=this._renderContext.pass;this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(gn.C.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=v}else this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture}get needsNormal(){return this._ssaoHelper.enabled}_renderNormal(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(gn.C.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)}get needsDepthRange(){return this._shadowMap.enabled||this.needsShadowCast}_computeDepthRange(_){if(!this.needsDepthRange)return pC;const v=function A6(_,v,O){if(v.size<1e4)return N6.compute(_,v);const D=Og();return O.forAll(w=>{w.isVisible&&X_(D,function S6(_,v){if(!v.isVisible)return;const O=Og(),D=v.getSpatialQueryAccelerator();return(0,lt.pC)(D)?function R6(_,v,O){const D=v.eye,w=v.viewForward,te=v.frustum,fe=Ue=>Ue.isVisible,Pe=O.objectCount;if(Pe<500)Pg(Rd,v.near,Math.min(_.near,v.far)),O.forEachInDepthRange(D,w,kf.Z.DepthOrder.FRONT_TO_BACK,Rd,(Ue,Xe)=>{bC(_,v,Ue),Rd.far=_.near,Xe.setRange(Rd)},te,fe),Pg(Rd,Math.max(_.far,v.near),v.far),O.forEachInDepthRange(D,w,kf.Z.DepthOrder.BACK_TO_FRONT,Rd,(Ue,Xe)=>{bC(_,v,Ue),Rd.near=_.far,Xe.setRange(Rd)},te,fe);else{const Ue=Math.max(Math.min(Pe,500),Math.ceil(.1*Pe)),Xe=O.findClosest(w,kf.Z.DepthOrder.FRONT_TO_BACK,te,fe,Ue),st=O.findClosest(w,kf.Z.DepthOrder.BACK_TO_FRONT,te,fe,Ue);Xe&&st&&(Qx(_,v,Xe.boundingVolumeWorldSpace.bounds),Qx(_,v,st.boundingVolumeWorldSpace.bounds))}}(O,_,D):function w6(_,v,O){q_.clear(),O.forAll(D=>{D.isVisible&&0!==D.geometryRecords.length&&q_.add(D)}),q_.empty||(q_.sort(v),Pg(Rd,v.near,Math.min(_.near,v.far)),q_.forEachInDepthRange(Rd,kf.Z.DepthOrder.FRONT_TO_BACK,(D,w)=>{w<_.near&&bC(_,v,D)}),Pg(Rd,Math.max(_.far,v.near),v.far),q_.forEachInDepthRange(Rd,kf.Z.DepthOrder.BACK_TO_FRONT,(D,w,te)=>{_.far=Math.max(_.far,te)}))}(O,_,v.objects),O}(_,w))}),D}(_,this._content,this._stage.layers);return X_(v,this.renderPlugins.queryDepthRange(_)),v.near=Math.max(_.near,v.near),v.far=Math.min(_.far,v.far),v}_renderGeometryAndTransparentTerrainPass(_){this._renderContext.pass=_,this._renderGeometryPass(_),this._renderTransparentTerrain()}_renderGeometryPass(_){this._renderContext.pass=_,this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderOpaqueGeometry(){this._renderSlot(fn.r.INTEGRATED_MESH),this._renderSlot(fn.r.OPAQUE_TERRAIN),this._renderInternalSlot(fn.r.OPAQUE_MATERIAL),this._renderSlot(fn.r.OPAQUE_MATERIAL),this._renderSlot(fn.r.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(fn.r.TRANSPARENT_MATERIAL),this._renderSlot(fn.r.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(fn.r.TRANSPARENT_TERRAIN)}_renderHUDVisibility(){let _=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,_=this._renderInternalSlot(fn.r.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain),_}_renderLineCallouts(_){this._bindParameters.renderTransparentlyOccludedHUD=_,_===Y0.v.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(fn.r.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(fn.r.LINE_CALLOUTS)}_renderHUD(_,v){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(_),!0),this._rctx.bindFramebuffer(v),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,Xl.Fv.PremultipliedAlpha)):_===Y0.v.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(Y0.v.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(_))}_renderHUDElements(_){this._bindParameters.renderTransparentlyOccludedHUD=_,this._renderInternalSlot(fn.r.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(fn.r.HUD_MATERIAL),this._renderInternalSlot(fn.r.LABEL_MATERIAL)}get needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}_renderHighlights(_,v){if(!this.needsHighlight)return void this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight);const O=this._highlight,D=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(gn.C.MATERIAL_HIGHLIGHT),this._rctx.clearSafe(Jt.lk.DEPTH_BUFFER_BIT),this._renderHUDElements(Y0.v.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=D.colorTexture,this.needsShadowHighlight&&this._shadowHighlight.render(v,_),O.render(this._bindParameters,D,_)}get needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(_,v,O){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,_,v,O)}_renderOrderIndependentTransparency(_,v){const O=w=>{this._bindParameters.transparencyPassType=w,this._offscreenRendering.renderOITPass(()=>_(),w,v)},D=this._renderContext.pass;this._renderContext.pass=gn.C.MATERIAL_ALPHA,O(Fs.Am.Alpha),this._renderContext.pass=gn.C.MATERIAL,O(Fs.Am.Color),O(Fs.Am.FrontFace),this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,v),this._bindParameters.transparencyPassType=Fs.Am.NONE,this._renderContext.pass=D,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget)),this._oitUsed=!1}_renderOccluded(){let _=0;this._materialRenderers.forEach((te,fe)=>{fe&&fe.isVisible()&&fe.renderOccluded===Su.yD.OccludeAndTransparentStencil&&(_|=fe.renderOccluded,jg.push(fe))});const v=this._offscreenRendering,O=(te,fe,Pe,Ue,Xe)=>{0!=(_&fe)&&(v.renderToTargets(Pe,v.tmpColor,v.mainDepth,[0,0,0,0],Ue,Xe),v.compositeOccludedOntoMain(this._bindParameters,te))};0!==jg.length&&(this._renderInternalSlot(fn.r.OCCLUDER_MATERIAL,jg),O(.5,Su.yD.OccludeAndTransparentStencil,()=>this._renderInternalSlot(fn.r.TRANSPARENT_OCCLUDER_MATERIAL,jg),!1,!1),jg.length=0),this._materialRenderers.forEach((te,fe)=>{fe&&fe.isVisible()&&(fe.renderOccluded===Su.yD.OccludeAndTransparent||fe.renderOccluded===Su.yD.Transparent||fe.renderOccluded===Su.yD.Opaque)&&(_|=fe.renderOccluded,Ng.push(fe))});const D=this._renderPlugins.renderOccludedFlags;if(_|=D,!_)return;const w=te=>{this._renderContext.renderOccludedMask=te,D>Su.yD.Occlude&&this._renderSlot(fn.r.OCCLUDED_TERRAIN),this._renderInternalSlot(fn.r.OPAQUE_MATERIAL,Ng),this._renderInternalSlot(fn.r.TRANSPARENT_MATERIAL,Ng),this._renderInternalSlot(fn.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,Ng),this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=gn.C.MATERIAL,O(.5,Su.yD.OccludeAndTransparent,()=>w(Su.yD.OccludeAndTransparent),!0,Fs.hU.OutlineVisualElementMask),O(.5,Su.yD.Transparent,()=>w(Su.yD.Transparent),!0,Fs.hU.OutlineVisualElementMask),O(1,Su.yD.Opaque,()=>w(Su.yD.Opaque),!0,Fs.hU.OutlineVisualElementMask),Ng.length=0}_renderAntiAliasing(_,v){if(_===Fs.C_.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&(0,lt.pC)(v))return this._smaaPass.render(v),!0}else this._smaaPass.disable();return!1}_ensureCameraBindParameters(_,v){this._bindParameters.camera=_,this._bindParameters.contentCamera=v}_ensureBindParameters(_,v){var D;this._ensureCameraBindParameters(_,v);const O=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=O.hudVisibilityTexture,this._bindParameters.highlightDepthTexture=null!=(D=O.depthTexture)?D:this._getFallbackDepthTexture()}_ensureBindParametersSSR(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=Zn.I:((0,js.a)(bD,this._bindParameters.camera.viewMatrix),(0,js.a)(ED,this._bindParameters.camera.projectionMatrix),(0,js.m)(tm,bD,ED),(0,js.m)(tm,this._renderContext.lastFrameCamera.viewMatrix,tm),(0,js.m)(tm,this._renderContext.lastFrameCamera.projectionMatrix,tm),this._reprojectionMatrix=tm),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null,this._bindParameters.ssr.enabled=this.hasWaterReflection}_renderInternalSlot(_,v){let O=!1;return this._bindParameters.slot=_,(0,lt.pC)(v)?v.forEach(D=>{if(!D.shouldRender(this._renderContext))return;const w=this._materialRenderers.get(D);(0,lt.pC)(w)&&(O=w.render(this._renderContext.pass,this._bindParameters)||O)}):this._materialRenderers.forEach((D,w)=>{w.shouldRender(this._renderContext)&&D.render(this._renderContext.pass,this._bindParameters)&&(O=!0)}),O}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=(0,$a.hf)(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var _,v,O,D,w,te,fe,Pe,Ue,Xe;return{offscreen:null!=(v=null==(_=this._offscreenRendering)?void 0:_.gpuMemoryUsage)?v:0,highlights:(null!=(D=null==(O=this._highlight)?void 0:O.gpuMemoryUsage)?D:0)+(null!=(te=null==(w=this._shadowHighlight)?void 0:w.gpuMemoryUsage)?te:0),shadows:null!=(Pe=null==(fe=this._shadowMap)?void 0:fe.gpuMemoryUsage)?Pe:0,ssao:null!=(Xe=null==(Ue=this._ssaoHelper)?void 0:Ue.gpuMemoryUsage)?Xe:0}}get test(){const _=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:v=>{switch(v){case J0.Color:return _._offscreenRendering.colorTexture;case J0.LinearDepth:return _._offscreenRendering.linearDepthTexture;case J0.Normals:return _._offscreenRendering.normalTexture;case J0.ShadowMap:return _._shadowMap.depthTexture;case J0.HudVisibility:return _._offscreenRendering.hudVisibilityTexture;case J0.Highlight:return _._offscreenRendering.highlightTexture}}}}};var J0;(0,Ze._)([(0,nt.Cb)()],Kp.prototype,"_shadowAccumulator",void 0),(0,Ze._)([(0,nt.Cb)()],Kp.prototype,"_smaaPass",void 0),(0,Ze._)([(0,nt.Cb)()],Kp.prototype,"_antialiasing",void 0),(0,Ze._)([(0,nt.Cb)()],Kp.prototype,"_edgeView",void 0),(0,Ze._)([(0,nt.Cb)()],Kp.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)()],Kp.prototype,"isCameraFinal",null),Kp=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.lib.Renderer")],Kp),function(_){_[_.Color=0]="Color",_[_.LinearDepth=1]="LinearDepth",_[_.Normals=2]="Normals",_[_.ShadowMap=3]="ShadowMap",_[_.HudVisibility=4]="HudVisibility",_[_.Highlight=5]="Highlight"}(J0||(J0={}));const Ng=[],jg=[],ED=(0,Zn.c)(),bD=(0,Zn.c)(),tm=(0,Zn.c)();var X0=T(68598);class CD{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:Jt.zi.ONE,dstRGB:Jt.zi.ZERO,srcAlpha:Jt.zi.ONE,dstAlpha:Jt.zi.ZERO},this.blendEquation={mode:Jt.db.ADD,modeAlpha:Jt.db.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=Jt.LR.BACK,this.frontFace=Jt.Wf.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Jt.wb.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:Jt.LR.FRONT_AND_BACK,func:Jt.wb.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:Jt.LR.FRONT_AND_BACK,fail:Jt.xS.KEEP,zFail:Jt.xS.KEEP,zPass:Jt.xS.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array}}class e8{constructor(v){this._allocations=new Map,v?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(v){this._allocations.set(v,(new Error).stack)}remove(v){this._allocations.delete(v)}print(){if(this._allocations.size>0){console.log(`${this._allocations.size} live object allocations:`);const v=new Map;this._allocations.forEach(O=>{var D;v.set(O,(null!=(D=v.get(O))?D:0)+1)}),v.forEach((O,D)=>{const w=D.split("\n");w.shift(),w.shift(),console.log(`${O}: ${w.shift()}`),w.forEach(te=>console.log("   ",te))})}}}class r8{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new e8(false);this._current.length<Jt._g.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(v,O){const D=++this._current[v];this._max[v]=Math.max(D,this._max[v]),this._allocations.add(O)}decrement(v,O){--this._current[v],this._allocations.remove(O)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((v,O)=>v+O,0)}printResourceCount(){if(this.total>0){console.log("Live objects:");for(let v=0;v<Jt._g.COUNT;++v){const O=this._current[v];O>0&&console.log(`${Jt._g[v]}: ${O}`)}}this._allocations.print()}}var i8=T(1101),s8=T(21285);class n8{constructor(v){this._rctx=v,this._store=new i8.r}dispose(){this._store.forEach(v=>v.forEach(O=>O.dispose())),this._store.clear()}acquire(v,O,D,w){const te=this._store.get(v,O);if((0,lt.pC)(te))return te.ref(),te;const fe=new s8.$(this._rctx,v,O,D,w);return fe.ref(),this._store.set(v,O,fe),fe}get test(){let v=0;return this._store.forEach(O=>O.forEach(D=>v+=D.hasGLName?2:1)),{cachedWebGLObjects:v}}}var TD=T(2757),LC=T(40852);function MD(_,v){const O=new pc.X(_,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE},{target:Jt.No.TEXTURE_2D,wrapMode:Jt.e8.CLAMP_TO_EDGE,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.NEAREST,width:1,height:1}),w=Zl.f.createVertex(_,Jt.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),te=new ku.U(_,new Map([["position",0]]),{geometry:[new LC.G("position",2,Jt.g.UNSIGNED_SHORT,0,4)]},{geometry:w}),fe=(0,$t.f)(5633261.287538229,2626832.878767164,1434988.0495278358),Pe=(0,$t.f)(5633271.46742708,2626873.6381334523,1434963.231608387),Ue=function D(sr,Er){const Rr=_.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${v?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor = v_color;\n  }\n  ",new Map([["position",0]])),$r=new Float32Array(6);(0,TD.LF)(sr,$r,3);const si=new Float32Array(6);return(0,TD.LF)(Er,si,3),_.useProgram(Rr),Rr.setUniform3f("u_highA",$r[0],$r[2],$r[4]),Rr.setUniform3f("u_lowA",$r[1],$r[3],$r[5]),Rr.setUniform3f("u_highB",si[0],si[2],si[4]),Rr.setUniform3f("u_lowB",si[1],si[3],si[5]),Rr}(fe,Pe),Xe=_.getBoundFramebufferObject(),{x:st,y:vt,width:Ct,height:Wt}=_.getViewport();_.bindFramebuffer(O),_.setViewport(0,0,1,1),_.bindVAO(te),_.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4);const Kt=new Uint8Array(4);O.readPixels(0,0,1,1,Jt.VI.RGBA,Jt.Br.UNSIGNED_BYTE,Kt),Ue.dispose(),te.dispose(!1),w.dispose(),O.dispose(),_.setViewport(st,vt,Ct,Wt),_.bindFramebuffer(Xe);const Lt=(fe[2]-Pe[2])/25,nr=(0,oE.v)(Kt);return Math.abs(Lt-nr)}var OD,xD,DD={exports:{}};OD=DD,void 0!==(xD=function(){var O={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},D=null,w=null;function te(Lt){if(null==D)for(var nr in D={},w={},Lt)"number"==typeof Lt[nr]&&(D[Lt[nr]]=nr,w[nr]=Lt[nr])}function fe(){if(null==D)throw"WebGLDebugUtils.init(ctx) not called"}function Ue(Lt){fe();var nr=D[Lt];return void 0!==nr?"gl."+nr:"/*UNKNOWN WebGL ENUM*/ 0x"+Lt.toString(16)}function Xe(Lt,nr,sr,Er){var yr;if(void 0!==(yr=O[Lt])&&void 0!==(yr=yr[nr])&&yr[sr]){if("object"==typeof yr[sr]&&void 0!==yr[sr].enumBitwiseOr){for(var br=yr[sr].enumBitwiseOr,Rr=0,$r=[],si=0;si<br.length;++si){var Ci=w[br[si]];0!=(Er&Ci)&&(Rr|=Ci,$r.push(Ue(Ci)))}return Rr===Er?$r.join(" | "):Ue(Er)}return Ue(Er)}return null===Er?"null":void 0===Er?"undefined":Er.toString()}function vt(Lt,nr,sr){Lt.__defineGetter__(sr,function(){return nr[sr]}),Lt.__defineSetter__(sr,function(Er){nr[sr]=Er})}function Wt(Lt){var nr=Lt.getParameter(Lt.MAX_VERTEX_ATTRIBS),sr=Lt.createBuffer();Lt.bindBuffer(Lt.ARRAY_BUFFER,sr);for(var Er=0;Er<nr;++Er)Lt.disableVertexAttribArray(Er),Lt.vertexAttribPointer(Er,4,Lt.FLOAT,!1,0,0),Lt.vertexAttrib1f(Er,0);Lt.deleteBuffer(sr);var yr=Lt.getParameter(Lt.MAX_TEXTURE_IMAGE_UNITS);for(Er=0;Er<yr;++Er)Lt.activeTexture(Lt.TEXTURE0+Er),Lt.bindTexture(Lt.TEXTURE_CUBE_MAP,null),Lt.bindTexture(Lt.TEXTURE_2D,null);for(Lt.activeTexture(Lt.TEXTURE0),Lt.useProgram(null),Lt.bindBuffer(Lt.ARRAY_BUFFER,null),Lt.bindBuffer(Lt.ELEMENT_ARRAY_BUFFER,null),Lt.bindFramebuffer(Lt.FRAMEBUFFER,null),Lt.bindRenderbuffer(Lt.RENDERBUFFER,null),Lt.disable(Lt.BLEND),Lt.disable(Lt.CULL_FACE),Lt.disable(Lt.DEPTH_TEST),Lt.disable(Lt.DITHER),Lt.disable(Lt.SCISSOR_TEST),Lt.blendColor(0,0,0,0),Lt.blendEquation(Lt.FUNC_ADD),Lt.blendFunc(Lt.ONE,Lt.ZERO),Lt.clearColor(0,0,0,0),Lt.clearDepth(1),Lt.clearStencil(-1),Lt.colorMask(!0,!0,!0,!0),Lt.cullFace(Lt.BACK),Lt.depthFunc(Lt.LESS),Lt.depthMask(!0),Lt.depthRange(0,1),Lt.frontFace(Lt.CCW),Lt.hint(Lt.GENERATE_MIPMAP_HINT,Lt.DONT_CARE),Lt.lineWidth(1),Lt.pixelStorei(Lt.PACK_ALIGNMENT,4),Lt.pixelStorei(Lt.UNPACK_ALIGNMENT,4),Lt.pixelStorei(Lt.UNPACK_FLIP_Y_WEBGL,!1),Lt.pixelStorei(Lt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),Lt.UNPACK_COLORSPACE_CONVERSION_WEBGL&&Lt.pixelStorei(Lt.UNPACK_COLORSPACE_CONVERSION_WEBGL,Lt.BROWSER_DEFAULT_WEBGL),Lt.polygonOffset(0,0),Lt.sampleCoverage(1,!1),Lt.scissor(0,0,Lt.canvas.width,Lt.canvas.height),Lt.stencilFunc(Lt.ALWAYS,0,4294967295),Lt.stencilMask(4294967295),Lt.stencilOp(Lt.KEEP,Lt.KEEP,Lt.KEEP),Lt.viewport(0,0,Lt.canvas.width,Lt.canvas.height),Lt.clear(Lt.COLOR_BUFFER_BIT|Lt.DEPTH_BUFFER_BIT|Lt.STENCIL_BUFFER_BIT);Lt.getError(););}return{init:te,mightBeEnum:function Pe(Lt){return fe(),void 0!==D[Lt]},glEnumToString:Ue,glFunctionArgToString:Xe,glFunctionArgsToString:function st(Lt,nr){for(var sr="",Er=nr.length,yr=0;yr<Er;++yr)sr+=(0==yr?"":", ")+Xe(Lt,Er,yr,nr[yr]);return sr},makeDebugContext:function Ct(Lt,nr,sr,Er){Er=Er||Lt,te(Lt),nr=nr||function(Ci,Ti,ki){for(var Fi="",Xi=ki.length,rs=0;rs<Xi;++rs)Fi+=(0==rs?"":", ")+Xe(Ti,Xi,rs,ki[rs]);!function(Lt){window.console&&window.console.error?window.console.error(Lt):function(Lt){window.console&&window.console.log&&window.console.log(Lt)}(Lt)}("WebGL error "+Ue(Ci)+" in "+Ti+"("+Fi+")")};var yr={};function br(Ci,Ti){return function(){sr&&sr(Ti,arguments);var ki=Ci[Ti].apply(Ci,arguments),Fi=Er.getError();return 0!=Fi&&(yr[Fi]=!0,nr(Fi,Ti,arguments)),ki}}var Rr={};for(var $r in Lt)if("function"==typeof Lt[$r])if("getExtension"!=$r)Rr[$r]=br(Lt,$r);else{var si=br(Lt,$r);Rr[$r]=function(){return Ct(si.apply(Lt,arguments),nr,sr,Er)}}else vt(Rr,Lt,$r);return Rr.getError=function(){for(var Ci in yr)if(yr.hasOwnProperty(Ci)&&yr[Ci])return yr[Ci]=!1,Ci;return Lt.NO_ERROR},Rr},makeLostContextSimulatingCanvas:function Kt(Lt){var nr,sr,Er=[],yr=[],br={},Rr=1,$r=!1,si=[],Ci=0,Ti=0,ki=!1,Fi=0,Xi={};function rs(xi){return"function"==typeof xi?xi:function(Qi){xi.handleEvent(Qi)}}Lt.getContext=(sr=Lt.getContext,function(){var xi=sr.apply(Lt,arguments);if(xi instanceof WebGLRenderingContext){if(xi!=nr){if(nr)throw"got different context";br=Cs(nr=xi)}return br}return xi});var Es=function(xi){Er.push(rs(xi))},Gs=function(xi){yr.push(rs(xi))};function qi(){++Ti,$r||Ci==Ti&&Lt.loseContext()}function as(xi,Qi){var As=xi[Qi];return function(){if(qi(),!$r)return As.apply(xi,arguments)}}function en(xi){return{statusMessage:xi,preventDefault:function(){ki=!0}}}return function ws(xi){var Qi=xi.addEventListener;xi.addEventListener=function(As,Is,Qs){switch(As){case"webglcontextlost":Es(Is);break;case"webglcontextrestored":Gs(Is);break;default:Qi.apply(xi,arguments)}}}(Lt),Lt.loseContext=function(){if(!$r){for($r=!0,Ci=0,++Rr;nr.getError(););(function $i(){for(var xi=Object.keys(Xi),Qi=0;Qi<xi.length;++Qi)delete Xi[xi]})(),Xi[nr.CONTEXT_LOST_WEBGL]=!0;var xi=en("context lost"),Qi=Er.slice();setTimeout(function(){for(var As=0;As<Qi.length;++As)Qi[As](xi);Fi>=0&&setTimeout(function(){Lt.restoreContext()},Fi)},0)}},Lt.restoreContext=function(){$r&&yr.length&&setTimeout(function(){if(!ki)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function bs(){for(var xi=0;xi<si.length;++xi){var Qi=si[xi];Qi instanceof WebGLBuffer?nr.deleteBuffer(Qi):Qi instanceof WebGLFramebuffer?nr.deleteFramebuffer(Qi):Qi instanceof WebGLProgram?nr.deleteProgram(Qi):Qi instanceof WebGLRenderbuffer?nr.deleteRenderbuffer(Qi):Qi instanceof WebGLShader?nr.deleteShader(Qi):Qi instanceof WebGLTexture&&nr.deleteTexture(Qi)}})(),Wt(nr),$r=!1,Ti=0,ki=!1;for(var xi=yr.slice(),Qi=en("context restored"),As=0;As<xi.length;++As)xi[As](Qi)},0)},Lt.loseContextInNCalls=function(xi){if($r)throw"You can not ask a lost contet to be lost";Ci=Ti+xi},Lt.getNumCalls=function(){return Ti},Lt.setRestoreTimeout=function(xi){Fi=xi},Lt;function Cs(xi){for(var Qi in xi)"function"==typeof xi[Qi]?br[Qi]=as(xi,Qi):vt(br,xi,Qi);br.getError=function(){if(qi(),!$r)for(;dn=nr.getError();)Xi[dn]=!0;for(var dn in Xi)if(Xi[dn])return delete Xi[dn],dn;return br.NO_ERROR};for(var As=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],Is=0;Is<As.length;++Is){var Qs=As[Is];br[Qs]=function(dn){return function(){if(qi(),$r)return null;var ao=dn.apply(xi,arguments);return ao.__webglDebugContextLostId__=Rr,si.push(ao),ao}}(xi[Qs])}var Ns=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(Is=0;Is<Ns.length;++Is)br[Qs=Ns[Is]]=function(dn){return function(){return qi(),$r?null:dn.apply(xi,arguments)}}(br[Qs]);var dn,an=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(Is=0;Is<an.length;++Is)br[Qs=an[Is]]=function(dn){return function(){return qi(),!$r&&dn.apply(xi,arguments)}}(br[Qs]);return br.checkFramebufferStatus=(dn=br.checkFramebufferStatus,function(){return qi(),$r?br.FRAMEBUFFER_UNSUPPORTED:dn.apply(xi,arguments)}),br.getAttribLocation=function(dn){return function(){return qi(),$r?-1:dn.apply(xi,arguments)}}(br.getAttribLocation),br.getVertexAttribOffset=function(dn){return function(){return qi(),$r?0:dn.apply(xi,arguments)}}(br.getVertexAttribOffset),br.isContextLost=function(){return $r},br}},resetToInitialState:Wt}}())&&(OD.exports=xD);const a8=pn.Z.getLogger("esri.views.WebGLDriverTest");var c8=T(93292);function UC(){return UC=(0,Ai.Z)(function*(_){const v=new Image;if(v.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",v.width=5,v.height=5,yield v.decode(),!_.gl)return!0;const O=new pc.X(_,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE},{target:Jt.No.TEXTURE_2D,wrapMode:Jt.e8.CLAMP_TO_EDGE,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.NEAREST,width:1,height:1}),D=Zl.f.createVertex(_,Jt.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),w=new ku.U(_,new Map([["a_pos",0]]),c8.cD,{geometry:D}),Pe=_.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv = a_pos;\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor = texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));_.useProgram(Pe);const Ue=new ka.x(_,{dataType:Jt.Br.UNSIGNED_BYTE,pixelFormat:Jt.VI.RGBA,preMultiplyAlpha:!1,wrapMode:Jt.e8.CLAMP_TO_EDGE,samplingMode:Jt.cw.LINEAR},v);_.bindTexture(Ue,0),Pe.setUniform1i("u_texture",0);const Xe=_.getBoundFramebufferObject(),{x:st,y:vt,width:Ct,height:Wt}=_.getViewport();_.bindFramebuffer(O),_.setViewport(0,0,1,1),_.setClearColor(0,0,0,0),_.setBlendingEnabled(!1),_.clearSafe(Jt.lk.COLOR_BUFFER_BIT),_.bindVAO(w),_.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4);const Kt=new Uint8Array(4);return O.readPixels(0,0,1,1,Jt.VI.RGBA,Jt.Br.UNSIGNED_BYTE,Kt),Pe.dispose(),w.dispose(!1),D.dispose(),O.dispose(),Ue.dispose(),_.setViewport(st,vt,Ct,Wt),_.bindFramebuffer(Xe),v.src="",255===Kt[0]}),UC.apply(this,arguments)}class d8{constructor(v){this.context=v,this._floatBufferBlendWorking=function o8(_){var Kt,Lt,nr,sr,Er;if(!_.gl)return!1;if(_.type===Yf.zO.WEBGL1)return!(!(null==(Kt=_.capabilities.textureFloat)?void 0:Kt.textureFloat)||!(null==(Lt=_.capabilities.colorBufferFloat)?void 0:Lt.textureFloat));if(!((null==(nr=_.capabilities.textureFloat)?void 0:nr.textureFloat)&&(null==(sr=_.capabilities.colorBufferFloat)?void 0:sr.textureFloat)&&(null==(Er=_.capabilities.colorBufferFloat)?void 0:Er.floatBlend)))return!1;const v=new pc.X(_,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE},{target:Jt.No.TEXTURE_2D,wrapMode:Jt.e8.CLAMP_TO_EDGE,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.FLOAT,internalFormat:Jt.lP.RGBA32F,samplingMode:Jt.cw.NEAREST,width:1,height:1}),O=Zl.f.createVertex(_,Jt.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),D=new ku.U(_,new Map([["a_pos",0]]),{geometry:[new LC.G("a_pos",2,Jt.g.UNSIGNED_SHORT,0,4)]},{geometry:O}),fe=_.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));_.useProgram(fe);const Pe=_.getBoundFramebufferObject(),{x:Ue,y:Xe,width:st,height:vt}=_.getViewport();_.bindFramebuffer(v),_.setViewport(0,0,1,1),_.bindVAO(D),_.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4);const Ct=(0,ls.sm)({blending:Q_.IB});_.setPipelineState(Ct),_.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4),DD.exports.init(_);const Wt=_.gl.getError();return _.setViewport(Ue,Xe,st,vt),_.bindFramebuffer(Pe),fe.dispose(),D.dispose(!1),O.dispose(),v.dispose(),1282!==Wt||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}(v),function u8(_){return UC.apply(this,arguments)}(v).then(O=>this._svgAlwaysPremultipliesAlpha=!O)}get floatBufferBlendWorking(){if((0,lt.Wi)(this._floatBufferBlendWorking))throw new Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}get svgAlwaysPremultipliesAlpha(){if((0,lt.Wi)(this._svgAlwaysPremultipliesAlpha))throw new Error("svgAlwaysPremultipliesAlpha test not yet available");return this._svgAlwaysPremultipliesAlpha}get doublePrecisionRequiresObfuscation(){if((0,lt.Wi)(this._doublePrecisionRequiresObfuscation)){const v=MD(this.context,!1),O=MD(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==v&&(0===O||v/O>5)}return this._doublePrecisionRequiresObfuscation}get ignoresSamplerPrecision(){return(0,lt.Wi)(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=function l8(_){const v=new pc.X(_,{colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.NONE},{target:Jt.No.TEXTURE_2D,wrapMode:Jt.e8.CLAMP_TO_EDGE,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.NEAREST,width:1,height:1}),w=new Uint8Array(4),te=Zl.f.createVertex(_,Jt.l1.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),fe=new ku.U(_,new Map([["a_position",0]]),{geometry:[new LC.G("a_position",2,Jt.g.SHORT,0,4)]},{geometry:te}),Pe=_.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset = pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value = texture2D(u_texture, vec2(0.0));\n  float bit = getBit(value.x * 255.0, 1);\n\n  v_color = bit * vec4(1.0);\n  gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n","\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor = v_color;\n}\n",new Map([["a_pos",0]]));_.useProgram(Pe);const Ue=new ka.x(_,{target:Jt.No.TEXTURE_2D,wrapMode:Jt.e8.CLAMP_TO_EDGE,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,samplingMode:Jt.cw.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));Pe.setUniform1i("u_texture",0),_.bindTexture(Ue,0);const Xe=_.getBoundFramebufferObject();_.bindFramebuffer(v),_.useProgram(Pe);const{x:st,y:vt,width:Ct,height:Wt}=_.getViewport();_.setViewport(0,0,1,1),_.bindVAO(fe),_.drawArrays(Jt.MX.TRIANGLE_STRIP,0,4),_.setViewport(st,vt,Ct,Wt),v.readPixels(0,0,1,1,Jt.VI.RGBA,Jt.Br.UNSIGNED_BYTE,w),Pe.dispose(),fe.dispose(!1),te.dispose(),v.dispose();const Kt=255!==w[0]||255!==w[1]||255!==w[2]||255!==w[3];return Kt&&a8.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${w[0]}.${w[1]}.${w[2]}.${w[3]}]`),_.bindFramebuffer(Xe),Kt}(this.context)),this._ignoresSamplerPrecision}}var tu=T(38210);class AD{constructor(v,O,D,w,te,fe,Pe,Ue){this.createQuery=v,this.resultAvailable=O,this.getResult=D,this.disjoint=w,this.beginTimeElapsed=te,this.endTimeElapsed=fe,this.createTimestamp=Pe,this.timestampBits=Ue}}function Fg(_,v,O,D,w){if(D&&(0,tu.Z)(_))return!0;if(v[O])return!1;for(const te of w)if(_.getExtension(te))return!0;return!1}class M8{constructor(v,O){this.gl=v,this._depthTexture=null,this._standardDerivatives=null,this._shaderTextureLOD=null,this._fragDepth=null,this._textureFloatLinear=null,this._disabledExtensions=O.disabledExtensions||{},this._debugWebGLExtensions=O.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=function p8(_,v){if(v.disjointTimerQuery)return null;if((0,tu.Z)(_))return{drawBuffers:_.drawBuffers.bind(_),MAX_DRAW_BUFFERS:_.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:_.MAX_COLOR_ATTACHMENTS};if(v.drawBuffers)return null;const O=_.getExtension("WEBGL_draw_buffers");return O?{drawBuffers:O.drawBuffersWEBGL.bind(O),MAX_DRAW_BUFFERS:O.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:O.MAX_COLOR_ATTACHMENTS_WEBGL}:null}(this.gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=function f8(_){if((0,tu.Z)(_))return{drawArraysInstanced:_.drawArraysInstanced.bind(_),drawElementsInstanced:_.drawElementsInstanced.bind(_),vertexAttribDivisor:_.vertexAttribDivisor.bind(_)};const v=_.getExtension("ANGLE_instanced_arrays");return v?{drawArraysInstanced:v.drawArraysInstancedANGLE.bind(v),drawElementsInstanced:v.drawElementsInstancedANGLE.bind(v),vertexAttribDivisor:v.vertexAttribDivisorANGLE.bind(v)}:null}(this.gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=function T8(_,v){if((0,tu.Z)(_))return{createVertexArray:_.createVertexArray.bind(_),deleteVertexArray:_.deleteVertexArray.bind(_),bindVertexArray:_.bindVertexArray.bind(_)};if(v.vao)return null;const O=_.getExtension("OES_vertex_array_object")||_.getExtension("MOZ_OES_vertex_array_object")||_.getExtension("WEBKIT_OES_vertex_array_object");return O?{createVertexArray:O.createVertexArrayOES.bind(O),deleteVertexArray:O.deleteVertexArrayOES.bind(O),bindVertexArray:O.bindVertexArrayOES.bind(O)}:null}(this.gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=function _8(_,v){if(v.compressedTextureETC)return null;const O=_.getExtension("WEBGL_compressed_texture_etc");return O?{COMPRESSED_R11_EAC:O.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:O.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:O.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:O.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:O.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:O.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:O.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:O.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:O.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:O.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}(this.gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=function m8(_,v){if(v.compressedTextureS3TC)return null;const O=_.getExtension("WEBGL_compressed_texture_s3tc");return O?{COMPRESSED_RGB_S3TC_DXT1:O.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:O.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:O.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:O.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}(this.gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=function y8(_,v){if(v.textureFilterAnisotropic)return null;const O=_.getExtension("EXT_texture_filter_anisotropic")||_.getExtension("MOZ_EXT_texture_filter_anisotropic")||_.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return O?{MAX_TEXTURE_MAX_ANISOTROPY:O.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:O.TEXTURE_MAX_ANISOTROPY_EXT}:null}(this.gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=function h8(_,v){if(v.disjointTimerQuery)return null;let O=_.getExtension("EXT_disjoint_timer_query_webgl2");return O&&(0,tu.Z)(_)?new AD(()=>_.createQuery(),D=>_.getQueryParameter(D,_.QUERY_RESULT_AVAILABLE),D=>_.getQueryParameter(D,_.QUERY_RESULT),()=>_.getParameter(O.GPU_DISJOINT_EXT),D=>_.beginQuery(O.TIME_ELAPSED_EXT,D),()=>_.endQuery(O.TIME_ELAPSED_EXT),D=>O.queryCounterEXT(D,O.TIMESTAMP_EXT),()=>_.getQuery(O.TIMESTAMP_EXT,O.QUERY_COUNTER_BITS_EXT)):(O=_.getExtension("EXT_disjoint_timer_query"),O?new AD(()=>O.createQueryEXT(),D=>O.getQueryObjectEXT(D,O.QUERY_RESULT_AVAILABLE_EXT),D=>O.getQueryObjectEXT(D,O.QUERY_RESULT_EXT),()=>_.getParameter(O.GPU_DISJOINT_EXT),D=>O.beginQueryEXT(O.TIME_ELAPSED_EXT,D),()=>O.endQueryEXT(O.TIME_ELAPSED_EXT),D=>O.queryCounterEXT(D,O.TIMESTAMP_EXT),()=>O.getQueryEXT(O.TIMESTAMP_EXT,O.QUERY_COUNTER_BITS_EXT)):null)}(this.gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=function v8(_,v){if((0,tu.Z)(_))return{textureFloat:!0,textureFloatLinear:!v.textureFloatLinear&&!!_.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:_.HALF_FLOAT,R16F:_.R16F,RG16F:_.RG16F,RGBA16F:_.RGBA16F,R32F:_.R32F,RG32F:_.RG32F,RGBA32F:_.RGBA32F,R11F_G11F_B10F:_.R11F_G11F_B10F,RGB16F:_.RGB16F};if(_ instanceof WebGLRenderingContext){const O=!v.textureHalfFloat&&_.getExtension("OES_texture_half_float");return{textureFloat:!v.textureFloat&&!!_.getExtension("OES_texture_float"),textureFloatLinear:!v.textureFloatLinear&&!!_.getExtension("OES_texture_float_linear"),textureHalfFloat:!!O,textureHalfFloatLinear:!v.textureHalfFloatLinear&&!!_.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:O?O.HALF_FLOAT_OES:void 0}}return null}(this.gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=function E8(_,v){if((0,tu.Z)(_)){const O=!v.colorBufferHalfFloat&&_.getExtension("EXT_color_buffer_half_float")||!v.colorBufferFloat&&_.getExtension("EXT_color_buffer_float"),D=!v.colorBufferFloat&&_.getExtension("EXT_color_buffer_float"),w=!v.floatBlend&&!v.colorBufferFloat&&_.getExtension("EXT_float_blend");return O||D||w?{textureFloat:!!D,textureHalfFloat:!!O,floatBlend:!!w,R16F:_.R16F,RG16F:_.RG16F,RGBA16F:_.RGBA16F,R32F:_.R32F,RG32F:_.RG32F,RGBA32F:_.RGBA32F,R11F_G11F_B10F:_.R11F_G11F_B10F,RGB16F:_.RGB16F}:null}if(_ instanceof WebGLRenderingContext){const O=!v.colorBufferHalfFloat&&_.getExtension("EXT_color_buffer_half_float"),D=!v.colorBufferFloat&&_.getExtension("WEBGL_color_buffer_float"),w=!v.floatBlend&&!v.colorBufferFloat&&_.getExtension("EXT_float_blend");return O||D||w?{textureFloat:!!D,textureHalfFloat:!!O,floatBlend:!!w,RGBA16F:O?O.RGBA16F_EXT:void 0,RGB16F:O?O.RGB16F_EXT:void 0,RGBA32F:D?D.RGBA32F_EXT:void 0}:null}return null}(this.gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=function g8(_,v){if((0,tu.Z)(_))return{MIN:_.MIN,MAX:_.MAX};if(v.blendMinMax)return null;{const O=_.getExtension("EXT_blend_minmax");return O?{MIN:O.MIN_EXT,MAX:O.MAX_EXT}:null}}(this.gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return null===this._depthTexture&&(this._depthTexture=Fg(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get standardDerivatives(){return null===this._standardDerivatives&&(this._standardDerivatives=Fg(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"])),this._standardDerivatives}get shaderTextureLOD(){return null===this._shaderTextureLOD&&(this._shaderTextureLOD=Fg(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"])),this._shaderTextureLOD}get fragDepth(){return null===this._fragDepth&&(this._fragDepth=Fg(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"])),this._fragDepth}get loseContext(){return this._loseContext||(this._loseContext=function C8(_,v){const O=v.loseContext&&_.getExtension("WEBGL_lose_context");return O?{loseRenderingContext:()=>O.loseContext()}:null}(this.gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=function b8(_,v){if(!(0,tu.Z)(_)||v.textureNorm16)return null;const O=_.getExtension("EXT_texture_norm16");return O?{R16:O.R16_EXT,RG16:O.RG16_EXT,RGB16:O.RGB16_EXT,RGBA16:O.RGBA16_EXT,R16_SNORM:O.R16_SNORM_EXT,RG16_SNORM:O.RG16_SNORM_EXT,RGB16_SNORM:O.RGB16_SNORM_EXT,RGBA16_SNORM:O.RGBA16_SNORM_EXT}:null}(this.gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return null===this._textureFloatLinear&&(this._textureFloatLinear=Fg(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(v){return this[v]}}function Ru(_,v,O,D){return v?D!==v&&_.bindBuffer(O,v.glName):_.bindBuffer(O,null),v}function SD(_,v){switch(_){case Jt.MX.POINTS:return 2*v;case Jt.MX.TRIANGLES:return v/3;case Jt.MX.TRIANGLE_STRIP:case Jt.MX.TRIANGLE_FAN:return v-2;default:return 0}}class RD extends class O8{constructor(v,O){this.gl=v,this.instanceCounter=new r8,this.programCache=new n8(this),this._state=new CD,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=(0,tu.Z)(v)?Yf.zO.WEBGL2:Yf.zO.WEBGL1,this._loadExtensions(),this.configure(O)}configure(v){this._capabilities=new M8(this.gl,v),this._parameters=this._loadParameters(v);const O=this.gl.getParameter(this.gl.VIEWPORT);this._state=new CD,this._state.viewport={x:O[0],y:O[1],width:O[2],height:O[3]},this._stateTracker=new ls.jp({setBlending:D=>{if(D){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(D.opRgb,D.opAlpha),this.setBlendFunctionSeparate(D.srcRgb,D.dstRgb,D.srcAlpha,D.dstAlpha);const w=D.color;this.setBlendColor(w.r,w.g,w.b,w.a)}else this.setBlendingEnabled(!1)},setCulling:D=>{D?(this.setFaceCullingEnabled(!0),this.setCullFace(D.face),this.setFrontFace(D.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:D=>{D?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(D.factor,D.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:D=>{D?(this.setDepthTestEnabled(!0),this.setDepthFunction(D.func)):this.setDepthTestEnabled(!1)},setStencilTest:D=>{if(D){this.setStencilTestEnabled(!0);const w=D.function;this.setStencilFunction(w.func,w.ref,w.mask);const te=D.operation;this.setStencilOp(te.fail,te.zFail,te.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:D=>{D?(this.setDepthWriteEnabled(!0),this.setDepthRange(D.zNear,D.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:D=>{D?this.setColorMask(D.r,D.g,D.b,D.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:D=>{this.setStencilWriteMask(D?D.mask:0)}}),this.enforceState(),this._driverTest=new d8(this)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}dispose(){this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Jt.w0.ARRAY_BUFFER),this.unbindBuffer(Jt.w0.ELEMENT_ARRAY_BUFFER),(0,tu.Z)(this.gl)&&(this.unbindBuffer(Jt.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Jt.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(Jt.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Jt.w0.COPY_READ_BUFFER),this.unbindBuffer(Jt.w0.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,(0,X0.hZ)()&&this.instanceCounter.printResourceCount()}setPipelineState(v){this._stateTracker.setPipeline(v)}setBlendingEnabled(v){this._state.blend!==v&&(!0===v?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=v,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var v;null==(v=this._state.program)||v.stop(),this._state.program=null}externalTextureUnitUpdate(v,O){for(let D=0;D<v.length;++D)this._state.textureUnitMap[v[D]]=null;O>=0&&(this._state.activeTexture=O)}externalVertexArrayObjectUpdate(){const v=this.capabilities.vao;v&&(v.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(v,O,D,w){v===this._state.blendColor.r&&O===this._state.blendColor.g&&D===this._state.blendColor.b&&w===this._state.blendColor.a||(this.gl.blendColor(v,O,D,w),this._state.blendColor.r=v,this._state.blendColor.g=O,this._state.blendColor.b=D,this._state.blendColor.a=w,this._stateTracker.invalidateBlending())}setBlendFunction(v,O){v===this._state.blendFunction.srcRGB&&O===this._state.blendFunction.dstRGB||(this.gl.blendFunc(v,O),this._state.blendFunction.srcRGB=v,this._state.blendFunction.srcAlpha=v,this._state.blendFunction.dstRGB=O,this._state.blendFunction.dstAlpha=O,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(v,O,D,w){this._state.blendFunction.srcRGB===v&&this._state.blendFunction.srcAlpha===D&&this._state.blendFunction.dstRGB===O&&this._state.blendFunction.dstAlpha===w||(this.gl.blendFuncSeparate(v,O,D,w),this._state.blendFunction.srcRGB=v,this._state.blendFunction.srcAlpha=D,this._state.blendFunction.dstRGB=O,this._state.blendFunction.dstAlpha=w,this._stateTracker.invalidateBlending())}setBlendEquation(v){this._state.blendEquation.mode!==v&&(this.gl.blendEquation(v),this._state.blendEquation.mode=v,this._state.blendEquation.modeAlpha=v,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(v,O){this._state.blendEquation.mode===v&&this._state.blendEquation.modeAlpha===O||(this.gl.blendEquationSeparate(v,O),this._state.blendEquation.mode=v,this._state.blendEquation.modeAlpha=O,this._stateTracker.invalidateBlending())}setColorMask(v,O,D,w){this._state.colorMask.r===v&&this._state.colorMask.g===O&&this._state.colorMask.b===D&&this._state.colorMask.a===w||(this.gl.colorMask(v,O,D,w),this._state.colorMask.r=v,this._state.colorMask.g=O,this._state.colorMask.b=D,this._state.colorMask.a=w,this._stateTracker.invalidateColorWrite())}setClearColor(v,O,D,w){this._state.clearColor.r===v&&this._state.clearColor.g===O&&this._state.clearColor.b===D&&this._state.clearColor.a===w||(this.gl.clearColor(v,O,D,w),this._state.clearColor.r=v,this._state.clearColor.g=O,this._state.clearColor.b=D,this._state.clearColor.a=w)}setFaceCullingEnabled(v){this._state.faceCulling!==v&&(!0===v?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=v,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(v){this._state.polygonOffsetFill!==v&&(!0===v?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=v,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(v,O){this._state.polygonOffset[0]===v&&this._state.polygonOffset[1]===O||(this._state.polygonOffset[0]=v,this._state.polygonOffset[1]=O,this.gl.polygonOffset(v,O),this._stateTracker.invalidatePolygonOffset())}setCullFace(v){this._state.cullFace!==v&&(this.gl.cullFace(v),this._state.cullFace=v,this._stateTracker.invalidateCulling())}setFrontFace(v){this._state.frontFace!==v&&(this.gl.frontFace(v),this._state.frontFace=v,this._stateTracker.invalidateCulling())}setScissorTestEnabled(v){this._state.scissorTest!==v&&(!0===v?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=v)}setScissorRect(v,O,D,w){this._state.scissorRect.x===v&&this._state.scissorRect.y===O&&this._state.scissorRect.width===D&&this._state.scissorRect.height===w||(this.gl.scissor(v,O,D,w),this._state.scissorRect.x=v,this._state.scissorRect.y=O,this._state.scissorRect.width=D,this._state.scissorRect.height=w)}setDepthTestEnabled(v){this._state.depthTest!==v&&(!0===v?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=v,this._stateTracker.invalidateDepthTest())}setClearDepth(v){this._state.clearDepth!==v&&(this.gl.clearDepth(v),this._state.clearDepth=v)}setDepthFunction(v){this._state.depthFunction!==v&&(this.gl.depthFunc(v),this._state.depthFunction=v,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(v){this._state.depthWrite!==v&&(this.gl.depthMask(v),this._state.depthWrite=v,this._stateTracker.invalidateDepthWrite())}setDepthRange(v,O){this._state.depthRange.zNear===v&&this._state.depthRange.zFar===O||(this.gl.depthRange(v,O),this._state.depthRange.zNear=v,this._state.depthRange.zFar=O,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(v){this._state.stencilTest!==v&&(!0===v?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=v,this._stateTracker.invalidateStencilTest())}setClearStencil(v){v!==this._state.clearStencil&&(this.gl.clearStencil(v),this._state.clearStencil=v)}setStencilFunction(v,O,D){this._state.stencilFunction.func===v&&this._state.stencilFunction.ref===O&&this._state.stencilFunction.mask===D||(this.gl.stencilFunc(v,O,D),this._state.stencilFunction.face=Jt.LR.FRONT_AND_BACK,this._state.stencilFunction.func=v,this._state.stencilFunction.ref=O,this._state.stencilFunction.mask=D,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(v,O,D,w){this._state.stencilFunction.face===v&&this._state.stencilFunction.func===O&&this._state.stencilFunction.ref===D&&this._state.stencilFunction.mask===w||(this.gl.stencilFuncSeparate(v,O,D,w),this._state.stencilFunction.face=v,this._state.stencilFunction.func=O,this._state.stencilFunction.ref=D,this._state.stencilFunction.mask=w,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(v){this._state.stencilWriteMask!==v&&(this.gl.stencilMask(v),this._state.stencilWriteMask=v,this._stateTracker.invalidateStencilWrite())}setStencilOp(v,O,D){this._state.stencilOperation.face===Jt.LR.FRONT_AND_BACK&&this._state.stencilOperation.fail===v&&this._state.stencilOperation.zFail===O&&this._state.stencilOperation.zPass===D||(this.gl.stencilOp(v,O,D),this._state.stencilOperation.face=Jt.LR.FRONT_AND_BACK,this._state.stencilOperation.fail=v,this._state.stencilOperation.zFail=O,this._state.stencilOperation.zPass=D,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(v,O,D,w){this._state.stencilOperation.face===v&&this._state.stencilOperation.fail===O&&this._state.stencilOperation.zFail===D&&this._state.stencilOperation.zPass===w||(this.gl.stencilOpSeparate(v,O,D,w),this._state.stencilOperation.face=v,this._state.stencilOperation.fail=O,this._state.stencilOperation.zFail=D,this._state.stencilOperation.zPass=w,this._stateTracker.invalidateStencilTest())}setActiveTexture(v,O=!1){const D=this._state.activeTexture;return v>=0&&(O||v!==this._state.activeTexture)&&(this.gl.activeTexture(Jt.Ld+v),this._state.activeTexture=v),D}clear(v){v&&this.gl.clear(v)}clearSafe(v,O=255){v&&(v&Jt.lk.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),v&Jt.lk.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),v&Jt.lk.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(O),this.gl.clear(v))}drawArrays(v,O,D){if((0,X0.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=SD(v,D)),this.gl.drawArrays(v,O,D),(0,X0.hZ)()){const w=(0,_l.HH)(this);w&&console.error("drawArrays:",w)}}drawElements(v,O,D,w){var te;if((0,X0.hZ)()&&(this._numOfDrawCalls++,this._numOfTriangles+=SD(v,O)),this.gl.drawElements(v,O,D,w),(0,X0.hZ)()){const fe=(0,_l.HH)(this);if(fe){const Pe=this.getBoundVAO(),Ue=null==Pe?void 0:Pe.indexBuffer,st={indexBuffer:Ue,vertexBuffers:null==Pe?void 0:Pe.vertexBuffers},vt={mode:v,count:O,type:D,offset:w},Ct=null!=(te=(0,lt.yw)(Ue,Lt=>Lt.size))?te:0,Wt=w+O;console.error(`drawElements: ${fe}${Ct<Wt?`. Buffer is too small. Attempted to draw index ${Wt} of ${Ct}`:""}`,{args:vt,vao:st})}}}logInfo(){(0,X0.hZ)()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){(0,X0.hZ)()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(v,O,D,w){D=Math.max(Math.round(D),1),w=Math.max(Math.round(w),1);const te=this._state.viewport;te.x===v&&te.y===O&&te.width===D&&te.height===w||(te.x=v,te.y=O,te.width=D,te.height=w,this.gl.viewport(v,O,D,w))}getViewport(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}}useProgram(v){var O,D;this._state.program!==v&&(null==(O=this._state.program)||O.stop(),this._state.program=v,this.gl.useProgram(null!=(D=null==v?void 0:v.glName)?D:null))}bindTexture(v,O,D=!1){(O>=this.parameters.maxTextureImageUnits||O<0)&&console.error("Input texture unit is out of range of available units!");const w=this._state.textureUnitMap[O];return(0,lt.Wi)(v)||null==v.glName?((0,lt.pC)(w)&&(this.setActiveTexture(O,D),this.gl.bindTexture(w.descriptor.target,null)),this._state.textureUnitMap[O]=null,w):D||w!==v?(this.setActiveTexture(O,D),this.gl.bindTexture(v.descriptor.target,v.glName),v.applyChanges(),this._state.textureUnitMap[O]=v,w):(v.isDirty&&(this.setActiveTexture(O,D),v.applyChanges()),w)}unbindTexture(v){if(!(0,lt.Wi)(v))for(let O=0;O<this.parameters.maxTextureImageUnits;O++)this._state.textureUnitMap[O]===v&&(this.bindTexture(null,O),this._state.textureUnitMap[O]=null)}bindFramebuffer(v,O=!1){if(O||this._state.readFramebuffer!==v||this._state.drawFramebuffer!==v){if((0,lt.Wi)(v))return this.gl.bindFramebuffer(Jt.qi.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);v.initializeAndBind(Jt.qi.FRAMEBUFFER),this._state.readFramebuffer=v,this._state.drawFramebuffer=v}}bindFramebufferSeparate(v,O,D=!1){const w=O===Jt.qi.READ_FRAMEBUFFER;(D||(w?this._state.readFramebuffer:this._state.drawFramebuffer)!==v)&&((0,lt.Wi)(v)?this.gl.bindFramebuffer(O,null):v.initializeAndBind(O),w?this._state.readFramebuffer=(0,lt.Pt)(v,null):this._state.drawFramebuffer=(0,lt.Pt)(v,null))}blitFramebuffer(v,O,D=0,w=0,te=v.width,fe=v.height,Pe=0,Ue=0,Xe=O.width,st=O.height,vt=Jt.lk.COLOR_BUFFER_BIT,Ct=Jt.cw.NEAREST){this.bindFramebufferSeparate(v,Jt.qi.READ_FRAMEBUFFER),this.bindFramebufferSeparate(O,Jt.qi.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(D,w,te,fe,Pe,Ue,Xe,st,vt,Ct)}bindBuffer(v,O){if(v)switch(null!=O||(O=v.bufferType),O){case Jt.w0.ARRAY_BUFFER:this._state.vertexBuffer=Ru(this.gl,v,O,this._state.vertexBuffer);break;case Jt.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ru(this.gl,v,O,this._state.indexBuffer);break;case Jt.w0.UNIFORM_BUFFER:this._state.uniformBuffer=Ru(this.gl,v,O,this._state.uniformBuffer);break;case Jt.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ru(this.gl,v,O,this._state.pixelPackBuffer);break;case Jt.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ru(this.gl,v,O,this._state.pixelUnpackBuffer);break;case Jt.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=Ru(this.gl,v,O,this._state.copyReadBuffer);break;case Jt.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ru(this.gl,v,O,this._state.copyWriteBuffer)}}bindRenderbuffer(v){const O=this.gl;v||(O.bindRenderbuffer(O.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==v&&(O.bindRenderbuffer(O.RENDERBUFFER,v.glName),this._state.renderbuffer=v)}_getBufferBinding(v,O){if(O>=this.parameters.maxUniformBufferBindings||O<0)return console.error("Uniform buffer binding point is out of range!"),null;const D=this._state.uniformBufferBindingPoints;let w=D[O];return(0,lt.Wi)(w)&&(w={buffer:null,offset:0,size:0},D[O]=w),w}bindBufferBase(v,O,D){const w=this._getBufferBinding(v,O);(0,lt.Wi)(w)||w.buffer===D&&0===w.offset&&0===w.size||(this.gl.bindBufferBase(v,O,D?D.glName:null),w.buffer=D,w.offset=0,w.size=0)}bindBufferRange(v,O,D,w,te){const fe=this._getBufferBinding(v,O);if(!(0,lt.Wi)(fe)&&(fe.buffer!==D||fe.offset!==w||fe.size!==te)){if(w%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(v,O,D.glName,w,te),fe.buffer=D,fe.offset=w,fe.size=te}}bindUBO(v,O,D,w){(0,lt.Wi)(O)?this.bindBufferBase(Jt.w0.UNIFORM_BUFFER,v,null):((0,X0.hZ)()&&(null!=w?w:O.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),O.initialize(),void 0!==D&&void 0!==w?this.bindBufferRange(Jt.w0.UNIFORM_BUFFER,v,O.buffer,D,w):this.bindBufferBase(Jt.w0.UNIFORM_BUFFER,v,O.buffer))}unbindUBO(v){for(let O=0,D=this._state.uniformBufferBindingPoints.length;O<D;O++){const w=this._state.uniformBufferBindingPoints[O];(0,lt.pC)(w)&&w.buffer===v.buffer&&this.bindBufferBase(Jt.w0.UNIFORM_BUFFER,O,null)}}unbindBuffer(v){switch(v){case Jt.w0.ARRAY_BUFFER:this._state.vertexBuffer=Ru(this.gl,null,v,this._state.vertexBuffer);break;case Jt.w0.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ru(this.gl,null,v,this._state.indexBuffer);break;case Jt.w0.UNIFORM_BUFFER:this._state.uniformBuffer=Ru(this.gl,null,v,this._state.uniformBuffer);break;case Jt.w0.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ru(this.gl,null,v,this._state.pixelPackBuffer);break;case Jt.w0.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ru(this.gl,null,v,this._state.pixelUnpackBuffer);break;case Jt.w0.COPY_READ_BUFFER:this._state.copyReadBuffer=Ru(this.gl,null,v,this._state.copyReadBuffer);break;case Jt.w0.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ru(this.gl,null,v,this._state.copyWriteBuffer)}}bindVAO(v=null){(0,lt.Wi)(v)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null):this._state.vertexArrayObject!==v&&(v.bind(),this._state.vertexArrayObject=v)}clientWaitAsync(v=(0,io.HA)(10)){var O=this;return(0,Ai.Z)(function*(){const D=O.gl,w=D.fenceSync(Jt.V7.SYNC_GPU_COMMANDS_COMPLETE,0);let te;O.instanceCounter.increment(Jt._g.Sync,w),D.flush();do{yield(0,zi.e4)(v),te=D.clientWaitSync(w,0,0)}while(te===Jt.Y5.TIMEOUT_EXPIRED);if(O.instanceCounter.decrement(Jt._g.Sync,w),D.deleteSync(w),te===Jt.Y5.WAIT_FAILED)throw new Error("Client wait failed")})()}getBoundFramebufferObject(v=Jt.qi.FRAMEBUFFER){return v===Jt.qi.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Jt.w0.ARRAY_BUFFER),this.unbindBuffer(Jt.w0.ELEMENT_ARRAY_BUFFER),(0,tu.Z)(this.gl)&&(this.unbindBuffer(Jt.w0.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Jt.w0.PIXEL_PACK_BUFFER),this.unbindBuffer(Jt.w0.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Jt.w0.COPY_READ_BUFFER),this.unbindBuffer(Jt.w0.COPY_WRITE_BUFFER));for(let v=0;v<this.parameters.maxTextureImageUnits;++v)this.bindTexture(null,v);this.setBlendingEnabled(!1),this.setBlendFunction(Jt.zi.ONE,Jt.zi.ZERO),this.setBlendEquation(Jt.db.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(Jt.LR.BACK),this.setFrontFace(Jt.Wf.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Jt.wb.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Jt.wb.ALWAYS,0,0),this.setStencilOp(Jt.xS.KEEP,Jt.xS.KEEP,Jt.xS.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var D,w,te,fe,Pe,Ue;const v=this.gl,O=this.capabilities.vao;O&&O.bindVertexArray(null);for(let Xe=0;Xe<this.parameters.maxVertexAttributes;Xe++)v.disableVertexAttribArray(Xe);if(this._state.vertexBuffer?v.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):v.bindBuffer(Jt.w0.ARRAY_BUFFER,null),this._state.indexBuffer?v.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):v.bindBuffer(Jt.w0.ELEMENT_ARRAY_BUFFER,null),(0,tu.Z)(v)){this._state.uniformBuffer?v.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):v.bindBuffer(Jt.w0.UNIFORM_BUFFER,null);for(let Xe=0;Xe<this._parameters.maxUniformBufferBindings;Xe++){const st=this._state.uniformBufferBindingPoints[Xe];if((0,lt.pC)(st)){const{buffer:vt,offset:Ct,size:Wt}=st;null!==vt?0===Ct&&0===Wt?v.bindBufferBase(Jt.w0.UNIFORM_BUFFER,Xe,vt.glName):v.bindBufferRange(Jt.w0.UNIFORM_BUFFER,Xe,vt.glName,Ct,Wt):v.bindBufferBase(Jt.w0.UNIFORM_BUFFER,Xe,null)}}this._state.pixelPackBuffer?v.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):v.bindBuffer(Jt.w0.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?v.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):v.bindBuffer(Jt.w0.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?v.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):v.bindBuffer(Jt.w0.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?v.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):v.bindBuffer(Jt.w0.COPY_WRITE_BUFFER,null),v.bindFramebuffer(Jt.qi.READ_FRAMEBUFFER,null),v.readBuffer(v.BACK),this._state.readFramebuffer&&(v.bindFramebuffer(Jt.qi.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),v.readBuffer(Jt.VY.COLOR_ATTACHMENT0)),v.bindFramebuffer(Jt.qi.DRAW_FRAMEBUFFER,null!=(w=null==(D=this._state.drawFramebuffer)?void 0:D.glName)?w:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,v.bindFramebuffer(Jt.qi.FRAMEBUFFER,null!=(fe=null==(te=this._state.drawFramebuffer)?void 0:te.glName)?fe:null);if(O&&this._state.vertexArrayObject){const Xe=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(Xe)}v.useProgram(null!=(Ue=null==(Pe=this._state.program)?void 0:Pe.glName)?Ue:null),v.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),v.bindRenderbuffer(v.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),!0===this._state.blend?v.enable(this.gl.BLEND):v.disable(this.gl.BLEND),v.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),v.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),v.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),v.clearDepth(this._state.clearDepth),v.clearStencil(this._state.clearStencil),v.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),v.cullFace(this._state.cullFace),v.depthFunc(this._state.depthFunction),v.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST),v.depthMask(this._state.depthWrite),v.frontFace(this._state.frontFace),v.lineWidth(1),!0===this._state.faceCulling?v.enable(v.CULL_FACE):v.disable(v.CULL_FACE),v.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?v.enable(v.POLYGON_OFFSET_FILL):v.disable(v.POLYGON_OFFSET_FILL),v.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?v.enable(v.SCISSOR_TEST):v.disable(v.SCISSOR_TEST),v.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),v.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?v.enable(v.STENCIL_TEST):v.disable(v.STENCIL_TEST),v.stencilMask(this._state.stencilWriteMask);for(let Xe=0;Xe<this.parameters.maxTextureImageUnits;Xe++){v.activeTexture(Jt.Ld+Xe),v.bindTexture(Jt.No.TEXTURE_2D,null),v.bindTexture(Jt.No.TEXTURE_CUBE_MAP,null),(0,tu.Z)(v)&&(v.bindTexture(Jt.No.TEXTURE_3D,null),v.bindTexture(Jt.No.TEXTURE_2D_ARRAY,null));const st=this._state.textureUnitMap[Xe];(0,lt.pC)(st)&&v.bindTexture(st.descriptor.target,st.glName)}v.activeTexture(Jt.Ld+this._state.activeTexture),v.viewport(this._state.viewport.x,this._state.viewport.y,this._state.viewport.width,this._state.viewport.height),this.resetInfo()}_loadExtensions(){this.type===Yf.zO.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}_loadParameters(v){var Pe;const O=this.capabilities.textureFilterAnisotropic,D=null!=(Pe=v.maxAnisotropy)?Pe:1/0,w=(0,tu.Z)(this.gl),te=this.gl,fe={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:O?Math.min(this.gl.getParameter(O.MAX_TEXTURE_MAX_ANISOTROPY),D):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:w?te.getParameter(te.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:w?te.getParameter(te.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:w?te.getParameter(te.MAX_FRAGMENT_UNIFORM_BLOCKS):0,maxUniformBlockSize:w?te.getParameter(te.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:w?te.getParameter(te.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:w?te.getParameter(te.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:w?te.getParameter(te.MAX_SAMPLES):1};return ka.x.TEXTURE_UNIT_FOR_UPDATES=fe.maxTextureImageUnits-1,fe}}{constructor(v,O,D){super(v,O),this.newCache=D,this._refCount=1}dispose(){--this._refCount>0||super.dispose()}ref(){++this._refCount}bindTechnique(v,O,D,w){this.useProgram(v.program);const te=(0,lt.pC)(D)?D.slot:null;return v.bindPipelineState(this,te,w),(0,lt.pC)(O)&&(0,lt.pC)(D)&&v.bindPass(O,D),v.program}get test(){return this.programCache.test}}var P8=T(80855),x8=T(97825);const wD=pn.Z.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");let rm=class extends Bi.Z{constructor(_,v,O){super({}),this._stage=_,this._techniqueRepository=v,this._rctx=O,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new sa.Z,this._frameTask=_.resourceController.scheduler.registerTask(Gn.T8.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}dispose(){this._frameTask.remove(),this._stage.forEachOfType(lb.U.Texture,_=>_.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return(0,lt.Wi)(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(P8.K,new x8.V)),this._textureTechnique}acquire(_){const v=this._textures.get(_);return v?(v.ref(),(0,lt.Pt)(v.loadingPromise,v)):this._createNewRef(_)}update(){let _=!1;this._frameUpdates.forEach(v=>{const O=v.texture.frameUpdate(this._rctx,this.textureTechnique,v.previousToken);O>=0&&O!==v.previousToken&&(v.previousToken=O,_=!0)}),_&&this.events.emit("changed",Fs.Xx.BACKGROUND)}_createNewRef(_){const v=this._stage.getObject(_);if((0,lt.Wi)(v))return(0,Td.hu)(void 0!==v),null;const O=v.events.on("unloaded",()=>{O.remove(),this._onTextureUnloaded(_)}),D=new D8(_,()=>{this._frameTask.schedule(()=>{D.isUnreferenced&&v.unload()})});return this._textures.set(_,D),D.ref(),(0,lt.pC)(v.glTexture)?(this._updateGLTexture(D,v.glTexture),v.requiresFrameUpdates&&this._frameUpdates.set(_,{texture:v,previousToken:-1}),D):(this._loadingCount++,D.loadingPromise=this._stage.schedule(()=>{const w=v.load(this._rctx,()=>this.textureTechnique),te=Pe=>(this._loadingCount--,D.loadingPromise=null,this._updateGLTexture(D,Pe),v.requiresFrameUpdates&&this._frameUpdates.set(_,{texture:v,previousToken:-1}),D);return(0,zi.y8)(w)?w.then(te,Pe=>(this._loadingCount--,D.loadingPromise=null,(0,zi.D_)(Pe)||wD.error(Pe),null)):te(w)}),D.loadingPromise)}_updateGLTexture(_,v){_.glTexture=v,this.events.emit("changed",Fs.Xx.UPDATE)}_onTextureUnloaded(_){this._textures.delete(_),this._frameUpdates.delete(_)}};(0,Ze._)([(0,nt.Cb)()],rm.prototype,"_loadingCount",void 0),(0,Ze._)([(0,nt.Cb)()],rm.prototype,"_frameTask",void 0),(0,Ze._)([(0,nt.Cb)()],rm.prototype,"updating",null),rm=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.lib.TextureRepository")],rm);class D8{constructor(v,O){this.id=v,this._release=O,this._refCount=0}get isUnreferenced(){return 0===this._refCount}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(0!==this._refCount?(wD.error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}}var A8=T(51899);const S8=pn.Z.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");let Wg=class extends Bi.Z{constructor(){super(...arguments),this._data=new Array,this._state=Fs.Rw.NOT_LOADED}dispose(){this._state=Fs.Rw.NOT_LOADED,this._data.forEach(_=>_.dispose()),this._data.length=0}get updating(){return this._state===Fs.Rw.LOADING}get resourceState(){return this._state}loadTextures(_){const v=[(0,hy.V)("esri/images/materials/water/normals.jpg"),(0,hy.V)("esri/images/materials/water/perturbation.jpg")];this._state=Fs.Rw.LOADING,Promise.all(v.map(O=>(0,m0.t)(O))).then(O=>{O.forEach(D=>this._data.push(new ka.x(_,{target:Jt.No.TEXTURE_2D,pixelFormat:Jt.VI.RGBA,dataType:Jt.Br.UNSIGNED_BYTE,wrapMode:Jt.e8.REPEAT,samplingMode:Jt.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:D.width,height:D.height},D))),this._state=Fs.Rw.LOADED}).catch(O=>{S8.error("Failed to load textures for water material.",O),this._state=Fs.Rw.NOT_LOADED})}bind(_){this._state===Fs.Rw.LOADED&&(_.bindTexture("texWaveNormal",this._data[0]),_.bindTexture("texWavePerturbation",this._data[1]))}};(0,Ze._)([(0,nt.Cb)()],Wg.prototype,"_state",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],Wg.prototype,"updating",null),Wg=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],Wg);const R8=new Map;var Q0=T(18605);class w8 extends Bl.Xn{constructor(v,O,D,w,te,fe){super(),this._rctx=v,this._renderScene=O,this._requestRenderScene=D,this._renderOverlay=w,this._forceCameraHook=te,this._disposeOffscreenBuffers=fe,this.supersample=!0,this._screenshotQueue=new Array}dispose(){this._rctx=null}takeScreenshot(v){this._requestRenderScene(Fs.Xx.BACKGROUND);const O=(0,zi.hh)();return this._screenshotQueue.push({settings:v,resolver:O}),O.promise}update(v){for(const O of this._screenshotQueue){if(this.isDisposed){O.resolver.reject();continue}const D=yi(or({},O.settings),{pixelRatio:O.settings.pixelRatio*v.viewCamera.pixelRatio}),w=this._renderScreenshot(v,D);O.resolver(w)}this._screenshotQueue.length=0}_renderScreenshotOverlay(v,O,D){if((0,lt.Wi)(this._renderOverlay))return O;v.width=O.width,v.height=O.height;const w=v.getContext("2d"),te=D.pixelRatio;return w.save(),w.translate(0,O.height),w.scale(1,-1),D.region&&w.translate(-D.region.x,-D.region.y),w.scale(te,te),O=this._renderOverlay(v,O),w.restore(),O}_readbackScreenshot(v,O){return v.resample?this._readbackScreenshotResampled(v,O):this._readbackScreenshotImmediate(v,O)}_readbackScreenshotResampled(v,O){const{framebufferWidth:D,framebufferHeight:w,region:te,resample:fe}=v,Pe=this._ensureScreenshotEncodeCanvas();let Ue=(0,Q0.r7)(D,w,Pe);this._rctx.gl.readPixels(0,0,D,w,Jt.VI.RGBA,Jt.g.UNSIGNED_BYTE,new Uint8Array(Ue.data.buffer)),O(),Ue=this._renderScreenshotOverlay(Pe,Ue,yi(or({},v),{region:null}));const Xe=(0,Q0.r7)(te.width,te.height,Pe);return(0,Q0.TT)(Ue,Xe,!0,fe.region.x,w-(fe.region.y+fe.region.height),fe.region.width,fe.region.height)}_readbackScreenshotImmediate(v,O){const{framebufferHeight:D,region:w}=v,te=this._ensureScreenshotEncodeCanvas(),fe=(0,Q0.r7)(w.width,w.height,te);return this._rctx.gl.readPixels(w.x,D-(w.y+w.height),w.width,w.height,Jt.VI.RGBA,Jt.g.UNSIGNED_BYTE,new Uint8Array(fe.data.buffer)),O(),this._renderScreenshotOverlay(te,fe,v)}_renderScreenshot(v,O){let D=null;const w=v.viewCamera,{framebufferWidth:te,framebufferHeight:fe}=O;let Pe=!1;const vt=te!==w.fullWidth||fe!==w.fullHeight||O.disableDecorations&&v.frameHasDecorations||O.ignorePadding&&w.pixelRatio!==O.pixelRatio;if(vt){const Kt=w.clone();if(O.ignorePadding){const sr=(0,vi.d)(Kt.padding);for(let Er=0;Er<4;Er++)sr[Er]=Math.round(sr[Er]/Kt.pixelRatio*O.pixelRatio);Kt.padding=sr}Kt.fullWidth=te,Kt.fullHeight=fe,Kt.pixelRatio=O.pixelRatio;const Lt=w.fovX-Kt.fovX,nr=w.fovY-Kt.fovY;Lt<0&&Lt<nr?Kt.fovX=w.fovX:nr<0&&nr<Lt&&(Kt.fovY=w.fovY),this._forceCameraHook(Kt),Pe=!0,D=new pc.X(this._rctx,{width:Kt.fullWidth,height:Kt.fullHeight,colorTarget:Jt.Lm.TEXTURE,depthStencilTarget:Jt.OU.DEPTH_STENCIL_RENDER_BUFFER}),this._renderScene(D,Kt,O.disableDecorations?Fs.Iq.OFF:Fs.Iq.ON),this._disposeOffscreenBuffers()}const Ct=()=>{this._rctx.bindFramebuffer(null),(0,lt.O3)(D)},Wt=this._readbackScreenshot(O,Ct);if(Ct(),vt&&!this._rctx.contextAttributes.alpha)for(let Kt=3;Kt<Wt.data.length;Kt+=4)Wt.data[Kt]=255;return Pe&&this._forceCameraHook(w),Wt}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}}const LD=pn.Z.getLogger("esri.views.3d.webgl-engine.parts.View");let ql=class extends((0,Bl.TF)(Bi.Z)){constructor(_){super({}),this.events=new sa.Z,this.waterTextureRepository=new Wg,this._magnifierHelper=new em,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=_.container,this._viewingMode=_.viewingMode,this._initializeContext(_),(0,pt.YP)(()=>{var v;return null==(v=this.waterTextureRepository)?void 0:v.updating},()=>this.requestRender(),pt.nn),this._magnifierHelper.events.on("request-render",()=>this.requestRender()),this._stippleTextureRepository=new A8.h(this._rctx),this._shaderTechniqueRepository=new C6.M({rctx:this._rctx,viewingMode:_.viewingMode,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository}),this._textureRepository=new rm(_,this._shaderTechniqueRepository,this._rctx),this._textureRepository.events.on("changed",v=>this.requestRender(v)),this._materialRepository=new j6.h(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new T6(this._rctx,this._shaderTechniqueRepository),this._renderer=new Kp(this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,v=>this.requestRender(v),(v,O)=>_.schedule(v,O),_),this._screenshotManager=new w8(this._rctx,(v,O,D)=>this._renderer.render(v,O,O,D),v=>this.requestRender(v),_.options.screenshot.renderOverlay,v=>this.events.emit("force-camera-for-screenshot",v),()=>this._renderer.disposeOffscreenBuffers()),this._registerFrameTask(_)}normalizeCtorArgs(){return{}}dispose(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=(0,lt.hw)(this._frameTask),this._shaderTechniqueRepository=(0,lt.O3)(this._shaderTechniqueRepository),super.dispose(),this._tmpDepthBuffer=null,this._rctx=null}get performanceInfo(){const _=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==_.getUsedTextureMemory?_.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==_.getUsedRenderbufferMemory?_.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==_.getUsedVBOMemory?_.getUsedVBOMemory():void 0}}requestRender(_=Fs.Xx.UPDATE){_===Fs.Xx.UPDATE?this._needsUpdate=!0:this._needsRender=!0}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}ensureEdgeView(){return this._renderer.ensureEdgeView()}get edgeView(){return this._renderer.edgeView}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(_){this._magnifierHelper.magnifier=_}updateLightSources(_,v,O){this._renderer.updateLightSources(_,v,O),this.requestRender()}setRenderParameters(_){void 0!==_.idleSuspend&&this._idleSuspend!==!!_.idleSuspend&&(this._idleSuspend=!!_.idleSuspend,this.requestRender()),this._renderer.setRenderParameters(_)}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}modify(_){this._renderer.modify(_),_.clear()}get canvas(){return this._canvas}takeScreenshot(_){return this._screenshotManager.takeScreenshot(_)}getAlpha(){return this._rctx.contextAttributes.alpha}get shadowsEnabled(){return this._renderer.shadowsEnabled}readAccumulatedShadow(_){return this._renderer.readAccumulatedShadow(_[0],_[1])}readHUDVisibility(_,v,O,D,w){this._renderer.readHUDVisibility(_,v,O,D,w)}getMinimalDepthForArea(_,v,O,D,w,te=w){const fe=D.constrainWindowSize(v,O,w*D.pixelRatio,te*D.pixelRatio),Pe=this._ensureDepthBuffer(fe);this._renderer.readDepthPixels(D,fe,Pe);let Ue=Number.MAX_VALUE;for(let Xe=0;Xe<fe[2]*fe[3];Xe++){const st=D6(4*Xe,Pe,D.nearFar);Ue>st&&st!==D.nearFar[0]&&st!==D.nearFar[1]&&(Ue=st)}if((0,lt.pC)(_)){const Xe=_.pickDepth(v*D.pixelRatio,O*D.pixelRatio,D);(0,lt.pC)(Xe)&&Ue>Xe&&Xe!==D.nearFar[0]&&Xe!==D.nearFar[1]&&(Ue=Xe)}return Ue===Number.MAX_VALUE?void 0:Ue}_ensureDepthBuffer(_){const v=4*_[2]*_[3];return((0,lt.Wi)(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<v)&&(this._tmpDepthBuffer=new Uint8Array(v)),this._tmpDepthBuffer}get renderPlugins(){return this._renderer.renderPlugins}get test(){return{renderer:this._renderer}}get gpuMemoryUsage(){return this._renderer.gpuMemoryUsage}reloadShaders(){var _=this;return(0,Ai.Z)(function*(){FP(),yield _._shaderTechniqueRepository.reloadAll(),_.requestRender()})()}get animationTimestep(){return this._renderer.animationTimestep}_registerFrameTask(_){const v=_.state,O={viewCamera:v.camera,frameHasDecorations:!1};let D=!1,w=Fs.Xx.BACKGROUND,te=!1;this._frameTask=(0,rt.A)({preRender:Pe=>{D=this.updating,w=this._needsUpdate?Fs.Xx.UPDATE:Fs.Xx.BACKGROUND,_.processSyncLayers();const Ue=(0,io.HA)(Pe.time-this._lastAnimationUpdate);(Ue>this.animationTimestep||(0,lt.pC)(this.forcedAnimationTime)||D||this._needsRender)&&(this._renderer.updateAnimation({camera:v.camera,dt:Ue,forcedTime:this.forcedAnimationTime})&&this.requestRender(Fs.Xx.BACKGROUND),this._lastAnimationUpdate=Pe.time)},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&v.camera.fullWidth>0&&v.camera.fullHeight>0){const Pe=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this._renderer.render(null,v.camera,v.contentCamera,Fs.Iq.ON),te=!0,Pe&&this._renderer.hasWaterReflection&&(this.requestRender(Fs.Xx.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:()=>{O.viewCamera=v.camera,O.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled,this._textureRepository.update(),this._screenshotManager.update(O)},finish:()=>{te&&(this._renderer.finish(w),te=!1)}})}_initializeContext(_){var w;const v=_.options;this._canvas=v.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const O={alpha:v.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==v.stencil||v.stencil,powerPreference:"high-performance",preserveDrawingBuffer:null!=(w=v.preserveDrawingBuffer)&&w},D=(0,Yf.sj)("3d",this._canvas,O);if((0,lt.Wi)(D)){const te=(0,Jo.Z)("esri-force-webgl");LD.error(te)}else this._rctx=this._newRenderingContext(D,_),this._loadShaderOnlyExtensions(),!v.alpha&&this._rctx.contextAttributes.alpha&&LD.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&(0,Jo.Z)("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)}_newRenderingContext(_,v){const O={disabledExtensions:v.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:v.options.debugWebGLExtensions||{},maxAnisotropy:8},D=(w,te)=>v.resourceController.memoryController.newCache(w,te);return new RD(_,O,D)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("standardDerivatives"),this._rctx.capabilities.enable("shaderTextureLOD"),this._rctx.capabilities.enable("textureFloat")}get componentObjectCollection(){return(0,lt.Wi)(this._componentObjectCollection)&&(this._componentObjectCollection=new E6(this._renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(_){this._componentObjectCollection=_}};(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],ql.prototype,"updating",null),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"_rctx",void 0),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"_container",void 0),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"_canvas",void 0),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"_stippleTextureRepository",void 0),(0,Ze._)([(0,Bl.gT)(),(0,nt.Cb)()],ql.prototype,"waterTextureRepository",void 0),(0,Ze._)([(0,Bl.gT)(),(0,nt.Cb)()],ql.prototype,"_magnifierHelper",void 0),(0,Ze._)([(0,Bl.gT)(),(0,nt.Cb)()],ql.prototype,"_textureRepository",void 0),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"_compositingHelper",void 0),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"_renderer",void 0),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"_screenshotManager",void 0),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"componentObjectCollection",null),(0,Ze._)([(0,Bl.gT)()],ql.prototype,"_componentObjectCollection",void 0),(0,Ze._)([(0,nt.Cb)()],ql.prototype,"_needsUpdate",void 0),(0,Ze._)([(0,nt.Cb)()],ql.prototype,"_needsWaterReflectionUpdate",void 0),ql=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.parts.RenderView")],ql);(function ID(){return R8})();var EE;let ru=EE=class extends((0,Bl.TF)(Bi.Z)){constructor(_){super(_),this._handles=new cn.Z,this._model=new Jv,this._layers=new Ua.Z,this._changeSet=new U4.as,this._layerSyncSet=new Set}initialize(){this._set("renderView",new ql(this)),this._frameTask=this.resourceController.scheduler.registerTask(Gn.T8.STAGE,this),this._handles.add(this._frameTask)}destroy(){hC.k.pool.prune(0),this._handles.destroy(),this.dispose()}get viewingMode(){return this.state.viewingMode}get updating(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}add(_){this._model.add(_),(0,sg.e)(_)&&(_.attachStage(this),this._addLayer(_)),this.renderView.requestRender()}remove(_){(0,lt.Wi)(_)||(this.renderView.requestRender(),this._model.remove(_),(0,sg.e)(_)&&(this._removeLayer(_),_.detachStage()))}addMany(_){(0,lt.pC)(_)&&(this._model.addMany(_),this.renderView.requestRender())}removeMany(_){(0,lt.pC)(_)&&(this._model.removeMany(_),this.renderView.requestRender())}load(_){var v=this;return(0,Ai.Z)(function*(){(0,lt.Wi)(_)||(Array.isArray(_)||(_=[_]),yield Promise.all(_.filter(O=>(0,lt.Wi)(O.glTexture)).map(O=>v.schedule(()=>v._model.has(O)?O.load(v.renderView.renderingContext,()=>v.renderView.textureRepository.textureTechnique):null))))})()}loadImmediate(_){return _.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)}forEachOfType(_,v){this._model.forEachOfType(_,v)}handleEvent(_,v){this.destroyed||(this._model.dirtySet[_](v),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty}runTask(_){this._frameTask.processQueue(_),_.done||this._commit()}_commit(){const _=this._model.dirtySet;EE.DebugSettings.logDirtySet&&console.log("Dirty set: "+_.formatDebugInfo()),_.commit(this._changeSet),EE.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(v=>v.id)),console.log("RGs remove: "+this._changeSet.removes.map(v=>v.id))),this._layerSyncSet.clear(),this.renderView.modify(this._changeSet),this.renderView.requestRender()}schedule(_,v){return this._frameTask.schedule(_,v)}syncLayer(_){this._layerSyncSet.add(_),this.renderView.requestRender()}processSyncLayers(){const _=this._model.dirtySet;this._layers.forAll(v=>{(this._layerSyncSet.has(v.id)||v.updatePolicy===Fs.jq.SYNC)&&(_.commitLayer(v.id,this._changeSet),this._layerSyncSet.delete(v.id))});for(const v of this._layerSyncSet)_.commitLayer(v,this._changeSet);this._layerSyncSet.clear(),this.renderView.modify(this._changeSet)}getObject(_){return this._model.getObject(_)}get layers(){return this._layers}_addLayer(_){this._layers.includes(_)||this._layers.push(_)}_removeLayer(_){this._commit(),null!=this._layers.removeUnordered(_)&&(this._model.dirtySet.getResidentRenderGeometries(_.id,this._changeSet.removes),this.renderView.modify(this._changeSet))}addRenderPlugin(_,v,O){const D=this.renderView.renderPlugins.add(_,v,O),w=()=>{PP(v)&&this.sceneIntersectionHelper.addIntersectionHandler(v)};if((0,zi.y8)(D))return D.then(w);w()}removeRenderPlugin(_){PP(_)&&this.sceneIntersectionHelper.removeIntersectionHandler(_),this.renderView.renderPlugins.remove(_)}get performanceInfo(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}get test(){const _=this;return{getCount:v=>_._model.test.content.filter(O=>O.type===v).length,model:_._model}}};ru.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1},(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ru.prototype,"resourceController",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ru.prototype,"options",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ru.prototype,"state",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ru.prototype,"sceneIntersectionHelper",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],ru.prototype,"viewingMode",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ru.prototype,"container",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ru.prototype,"renderSR",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ru.prototype,"_handles",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],ru.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],ru.prototype,"_model",void 0),(0,Ze._)([(0,Bl.gT)(),(0,nt.Cb)()],ru.prototype,"renderView",void 0),ru=EE=(0,Ze._)([(0,ui.j)("esri.views.3d.webgl-engine.Stage")],ru);var bE=T(55314);function BC(){return BC=(0,Ai.Z)(function*(_,v){if("2d"===_.type)return _.hitTest(v);const O=yield _.hitTest(v);if(0===O.results.length)return O;const D=O.results[0],w=(0,lt.pC)(D.distance)?D.distance*(1+U8):D.distance,te=O.results.findIndex(fe=>fe.distance>w);return-1!==te&&(O.results=O.results.slice(0,te)),O}),BC.apply(this,arguments)}const U8=.05;function BD(_){return(0,lt.pC)(_)&&"graphic"===_.type}var ND=T(93579),N8=T(31637);let Xf=class extends Bi.Z{constructor(){super(...arguments),this.widget=null}destroy(){this.widget&&this.widget.destroy(),this.node=null}get id(){return this.get("widget.id")||this.get("node.id")}set node(_){const v=this._get("node");_!==v&&(_&&_.classList.add("esri-component"),v&&v.classList.remove("esri-component"),this._set("node",_))}castNode(_){return _?"string"==typeof _||function F8(_){return _&&"nodeType"in _}(_)?(this._set("widget",null),(0,zc.L7)(_)):(function W8(_){return _&&"function"==typeof _.render}(_)&&!_.domNode&&(_.domNode=document.createElement("div")),this._set("widget",_),_.domNode):(this._set("widget",null),null)}};(0,Ze._)([(0,nt.Cb)({dependsOn:[]})],Xf.prototype,"id",null),(0,Ze._)([(0,nt.Cb)()],Xf.prototype,"node",null),(0,Ze._)([(0,Ga.p)("node")],Xf.prototype,"castNode",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Xf.prototype,"widget",void 0),Xf=(0,Ze._)([(0,ui.j)("esri.views.ui.Component")],Xf);const CE=Xf;var V8=T(64183),Nl=T(38570);const z8={left:0,top:0,bottom:0,right:0},FD={bottom:30,top:15,right:15,left:15},NC="manual",iu_corner="esri-ui-corner";function jC(_){const v=_,O="object"==typeof v&&null!==v&&Object.getPrototypeOf(v);return null!==O&&O!==Object.prototype||!("component"in v||"index"in v||"position"in v)?null:_}function FC(_,{top:v,bottom:O,left:D,right:w}){_.style.top=v,_.style.bottom=O,_.style.left=D,_.style.right=w}let Zp=class extends sa.Z.EventedAccessor{constructor(_){super(_),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentToKey=new Map,this._handles=new cn.Z,this.view=null,this._applyViewPadding=()=>{const v=this.container;v&&FC(v,this._toPxPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const v=this._innerContainer;v&&FC(v,this._toPxPosition(this.padding))},this._initContainers()}initialize(){this._handles.add([(0,pt.YP)(()=>{var _;return[null==(_=this.view)?void 0:_.padding,this.container]},this._applyViewPadding,pt.nn),(0,pt.YP)(()=>this.padding,this._applyUIPadding,pt.nn)])}destroy(){this.container=null;for(const _ of this._components)_.destroy();this._components.length=0,this._handles.destroy(),this._componentToKey.clear()}set container(_){const v=this._get("container");_!==v&&(_&&(_.classList.add("esri-ui"),(0,V8.V$)(_),this._attachContainers(_)),v&&(v.classList.remove("esri-ui"),FC(v,{top:"",bottom:"",left:"",right:""}),(0,zc.cS)(v)),this._set("container",_))}get height(){const _=this.get("view.height")||0;if(0===_)return _;const v=this._getViewPadding();return Math.max(_-(v.top+v.bottom),0)}get padding(){return this._get("padding")}set padding(_){_?this._override("padding",_):this._clearOverride("padding")}castPadding(_){return"number"==typeof _?{bottom:_,top:_,right:_,left:_}:or(or({},FD),_)}get width(){const _=this.get("view.width")||0;if(0===_)return _;const v=this._getViewPadding();return Math.max(_-(v.left+v.right),0)}add(_,v){let O,D;if(Array.isArray(_))return void _.forEach(te=>this.add(te,v));const w=jC(_);w&&({index:O,position:v,component:_,key:D}=w),v&&"object"==typeof v&&({index:O,key:D,position:v}=v),!_||v&&!this._isValidPosition(v)||this._add(_,v,O,D)}remove(_,v){if(!_)return;if(Array.isArray(_))return _.map(D=>this.remove(D,v));const O=this._find(_);if(O){const D=this._componentToKey;if(D.has(_)&&D.get(_)!==v)return;const w=this._components.indexOf(O);return O.node.parentNode&&O.node.parentNode.removeChild(O.node),this._componentToKey.delete(_),this._components.splice(w,1)[0]}}empty(_){return Array.isArray(_)?_.map(v=>this.empty(v)).reduce((v,O)=>v.concat(O)):(_=_||NC)===NC?Array.prototype.slice.call(this._manualContainer.children).filter(v=>!v.classList.contains(iu_corner)).map(v=>this.remove(v)):this._isValidPosition(_)?Array.prototype.slice.call(this._cornerNameToContainerLookup[_].children).map(this.remove,this):null}move(_,v){if(Array.isArray(_)&&_.forEach(te=>this.move(te,v)),!_)return;let O;const D=jC(_)||jC(v);if(D&&(O=D.index,v=D.position,_=D.component||_),v&&!this._isValidPosition(v))return;const w=this.remove(_);w&&this.add(w,{position:v,index:O})}find(_){if(!_)return null;const v=this._findById(_);return v&&(v.widget||v.node)}getPosition(_){for(const v in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[v].contains(_))return v;return null}_add(_,v,O,D){_ instanceof CE||(_=new CE({node:_})),this._place({component:_,position:v,index:O}),this._components.push(_),D&&this._componentToKey.set(_,D)}_find(_){return _?_ instanceof CE?this._findByComponent(_):"string"==typeof _?this._findById(_):this._findByNode(_.domNode||_):null}_getViewPadding(){return this.get("view.padding")||z8}_attachContainers(_){_.appendChild(this._innerContainer),_.appendChild(this._manualContainer)}_initContainers(){const _=document.createElement("div");_.classList.add("esri-ui-inner-container"),_.classList.add("esri-ui-corner-container");const v=document.createElement("div");v.classList.add("esri-ui-inner-container"),v.classList.add("esri-ui-manual-container");const O=document.createElement("div");O.classList.add("esri-ui-top-left"),O.classList.add(iu_corner),_.appendChild(O);const D=document.createElement("div");D.classList.add("esri-ui-top-right"),D.classList.add(iu_corner),_.appendChild(D);const w=document.createElement("div");w.classList.add("esri-ui-bottom-left"),w.classList.add(iu_corner),_.appendChild(w);const te=document.createElement("div");te.classList.add("esri-ui-bottom-right"),te.classList.add(iu_corner),_.appendChild(te),this._innerContainer=_,this._manualContainer=v;const fe=(0,Nl.dZ)();this._cornerNameToContainerLookup={"top-left":O,"top-right":D,"bottom-left":w,"bottom-right":te,"top-leading":fe?D:O,"top-trailing":fe?O:D,"bottom-leading":fe?te:w,"bottom-trailing":fe?w:te},this._positionNameToContainerLookup=or({manual:v},this._cornerNameToContainerLookup)}_isValidPosition(_){return!!this._positionNameToContainerLookup[_]}_place(_){const v=_.component,D=_.index,w=this._positionNameToContainerLookup[_.position||NC],te=D>-1;if(function G8(_){return _&&!_._started&&"function"==typeof _.postMixInProperties&&"function"==typeof _.buildRendering&&"function"==typeof _.postCreate&&"function"==typeof _.startup}(v.widget)&&v.widget.startup(),!te)return void w.appendChild(v.node);const fe=Array.prototype.slice.call(w.children);0!==D?D>=fe.length?w.appendChild(v.node):(0,zc.Vt)(v.node,fe[D]):w.firstChild?(0,zc.Vt)(v.node,w.firstChild):w.appendChild(v.node)}_toPxPosition(_){return{top:this._toPxUnit(_.top),left:this._toPxUnit(_.left),right:this._toPxUnit(_.right),bottom:this._toPxUnit(_.bottom)}}_toPxUnit(_){return 0===_?"0":_+"px"}_findByComponent(_){let v,O=null;return this._components.some(D=>(v=D===_,v&&(O=D),v)),O}_findById(_){let v,O=null;return this._components.some(D=>(v=D.id===_,v&&(O=D),v)),O}_findByNode(_){let v,O=null;return this._components.some(D=>(v=D.node===_,v&&(O=D),v)),O}};(0,Ze._)([(0,nt.Cb)()],Zp.prototype,"container",null),(0,Ze._)([(0,nt.Cb)()],Zp.prototype,"height",null),(0,Ze._)([(0,nt.Cb)({value:FD})],Zp.prototype,"padding",null),(0,Ze._)([(0,Ga.p)("padding")],Zp.prototype,"castPadding",null),(0,Ze._)([(0,nt.Cb)()],Zp.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)()],Zp.prototype,"width",null),Zp=(0,Ze._)([(0,ui.j)("esri.views.ui.UI")],Zp);const H8=Zp;var wu=T(10391);function WD(_,v){return _&&"copyright"in _&&(!v||"function"==typeof _.originOf&&"user"===_.originOf("copyright"))}function TE(_,v,O){!O||!v||_.find(D=>D.layerView===v&&D.text===O)||_.push({text:O,layerView:v})}const q0=[];let im=class extends cc.r{constructor(_){super(_),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new Pn.Z,this.view=null,this._allLayerViewsChange=v=>{this.handles.remove("suspension");const O=this.get("view.allLayerViews");O&&this.handles.add(O.map(D=>(0,pt.YP)(()=>{var w;return[D.suspended,null==(w=D.layer)?void 0:w.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),v&&v.removed&&v.removed.forEach(D=>{this._pendingAttributions.delete(D),this._fetchedAttributionData.delete(D)}),this._updateAttributionItems()},this.handles.add([(0,pt.on)(()=>{var v;return null==(v=this.view)?void 0:v.allLayerViews},"change",v=>this._allLayerViewsChange(v),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),(0,pt.gx)(()=>{var v;return!0===(null==(v=this.view)?void 0:v.stationary)},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const _=this.get("view.allLayerViews");q0.length=0,_?(_.forEach(v=>{var w;if(v.suspended||!(null==(w=v.layer)?void 0:w.attributionVisible))return;const O=v.layer;if(WD(O,"user"))return void TE(q0,v,O.copyright);if(O.hasAttributionData){if(this._fetchedAttributionData.has(v)){const te=this._fetchedAttributionData.get(v);return void(te?TE(q0,v,this._getDynamicAttribution(te,this.view,O)):WD(O)&&TE(q0,v,O.copyright))}return void this._fetchAttributionData(v)}const D=O.get("portalItem.accessInformation");TE(q0,v,D||O.copyright)}),function K8(_,v){return _.length!==v.length||_.some((O,D)=>O.text!==v[D].text)}(this.items,q0)&&(this.items.removeAll(),this.items.addMany(q0)),q0.length=0,this.notifyChange("state")):this._clear()}_fetchAttributionData(_){var v=this;return(0,Ai.Z)(function*(){if(v._pendingAttributions.has(_))return;v._pendingAttributions.add(_);const O=yield(0,Qm.q6)(_.layer.fetchAttributionData());if(v._pendingAttributions.has(_)){const D=O.ok?v._createContributionIndex(O.value,function Z8(_){return"bing-maps"===_.type}(_.layer)):null;v._pendingAttributions.delete(_),v._fetchedAttributionData.set(_,D)}v._updateAttributionItems()})()}_createContributionIndex(_,v){const O=_.contributors,D={};if(!O)return D;for(let w=0;w<O.length;w++){const te=O[w],fe=te.coverageAreas;if(!fe)return;for(const Pe of fe){const Ue=Pe.bbox,Xe=Pe.zoomMin-(v&&Pe.zoomMin?1:0),st=Pe.zoomMax-(v&&Pe.zoomMax?1:0),Ct={extent:(0,sh.$)({xmin:Ue[1],ymin:Ue[0],xmax:Ue[3],ymax:Ue[2],spatialReference:Xn.Z.WGS84}),attribution:te.attribution||"",score:null!=Pe.score?Pe.score:100,id:w};for(let Wt=Xe;Wt<=st;Wt++)D[Wt]=D[Wt]||[],D[Wt].push(Ct)}}return D.maxKey=Math.max.apply(null,Object.keys(D)),D}_getDynamicAttribution(_,v,O){const{extent:D,scale:w}=v;let te=O.tileInfo.scaleToZoom(w);if(te=Math.min(_.maxKey,Math.round(te)),!D||null==te||te<=-1)return"";const fe=_[te],Pe=(0,sh.iV)(D.center.clone().normalize(),v.spatialReference),Ue={};return fe?fe.filter(Xe=>{const st=!Ue[Xe.id]&&Pe&&(0,Ho.aV)(Xe.extent,Pe);return st&&(Ue[Xe.id]=!0),st}).sort((Xe,st)=>st.score-Xe.score||Xe.objectId-st.objectId).map(Xe=>Xe.attribution).join(", "):""}};(0,Ze._)([(0,nt.Cb)({readOnly:!0,type:Pn.Z})],im.prototype,"items",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],im.prototype,"state",null),(0,Ze._)([(0,nt.Cb)()],im.prototype,"view",void 0),im=(0,Ze._)([(0,ui.j)("esri.widgets.Attribution.AttributionViewModel")],im);const VD=im;var kh=T(24940),Iu=T(25552),pi=T(94450);let su=class extends wu.Z{constructor(_,v){super(_,v),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(O=>O.forEach(({target:D})=>this._checkSourceTextOverflow(D))),this.iconClass="esri-icon-description",this.itemDelimiter=" | ",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new VD}initialize(){this.own((0,pt.on)(()=>{var _;return null==(_=this.viewModel)?void 0:_.items},"change",()=>this.scheduleRender()))}destroy(){var _;null==(_=this._resizeObserver)||_.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((_,v)=>(_.includes(v.text)||_.push(v.text),_),[]).join(this.itemDelimiter)}render(){return(0,pi.u)("div",{bind:this,class:this.classes("esri-attribution esri-widget",{"esri-attribution--open":this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return(0,pi.u)("div",{class:"esri-attribution__powered-by"},"Powered by"," ",(0,pi.u)("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const _=this._isOpen,v=this._isInteractive,O=v?"0":"",{attributionText:D}=this;return(0,pi.u)("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",{"esri-attribution__sources--open":_,"esri-interactive":v}),innerHTML:D,tabindex:O})}_afterSourcesNodeCreate(_){this._prevSourceNodeHeight=_.clientWidth,this._resizeObserver.observe(_)}_checkSourceTextOverflow(_){let v=!1;const{clientHeight:O,clientWidth:D,scrollWidth:w}=_,te=w>D,fe=this._attributionTextOverflowed!==te;if(this._attributionTextOverflowed=te,fe&&(v=!0),this._isOpen){const Pe=O<this._prevSourceNodeHeight;this._prevSourceNodeHeight=O,Pe&&(this._isOpen=!1,v=!0)}v&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};(0,Ze._)([(0,nt.Cb)()],su.prototype,"_isOpen",void 0),(0,Ze._)([(0,nt.Cb)()],su.prototype,"_isInteractive",null),(0,Ze._)([(0,nt.Cb)()],su.prototype,"_attributionTextOverflowed",void 0),(0,Ze._)([(0,nt.Cb)()],su.prototype,"_prevSourceNodeHeight",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],su.prototype,"attributionText",null),(0,Ze._)([(0,nt.Cb)()],su.prototype,"iconClass",void 0),(0,Ze._)([(0,nt.Cb)()],su.prototype,"itemDelimiter",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],su.prototype,"label",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Attribution/t9n/Attribution")],su.prototype,"messages",void 0),(0,Ze._)([(0,Ss.B)("viewModel.view")],su.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:VD})],su.prototype,"viewModel",void 0),(0,Ze._)([(0,kh.h)()],su.prototype,"_toggleState",null),su=(0,Ze._)([(0,ui.j)("esri.widgets.Attribution")],su);const $8=su;var zD=T(67436);let Qf=class extends((0,zD._)(Bi.Z)){constructor(_){super(_),this._handles=new cn.Z,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add((0,pt.YP)(()=>this.view,this._updateRotationWatcher,pt.nn))}destroy(){this._handles=(0,lt.hw)(this._handles),this.view=null}get canShowNorth(){const _=this.get("view.spatialReference");return!(!_||!_.isWebMercator&&!_.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){if(!this.get("view.ready"))return;const _={};"2d"===this.view.type?_.rotation=0:_.heading=0,this.callGoTo({target:_})}_updateForRotation(_){null!=_&&(this.orientation={z:_})}_updateForCamera(_){_&&(this.orientation={x:0,y:0,z:-_.heading})}_updateRotationWatcher(_){this._handles.removeAll(),_&&this._handles.add("2d"===_.type?(0,pt.YP)(()=>null==_?void 0:_.rotation,this._updateForRotation,pt.nn):(0,pt.YP)(()=>null==_?void 0:_.camera,this._updateForCamera,pt.nn))}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Qf.prototype,"canShowNorth",null),(0,Ze._)([(0,nt.Cb)()],Qf.prototype,"orientation",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Qf.prototype,"state",null),(0,Ze._)([(0,nt.Cb)()],Qf.prototype,"view",void 0),Qf=(0,Ze._)([(0,ui.j)("esri.widgets.CompassViewModel")],Qf);const GD=Qf;let Yh=class extends wu.Z{constructor(_,v){super(_,v),this.goToOverride=null,this.iconClass="esri-icon-locate-circled",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new GD}reset(){return this.viewModel.reset()}render(){const{orientation:_,state:v}=this.viewModel,O="disabled"===v,D="compass"==("rotation"===v?"rotation":"compass"),w=O?-1:0,te={"esri-disabled":O,"esri-interactive":!O},fe={"esri-icon-compass":D,"esri-icon-dial":!D},{messages:Pe}=this;return(0,pi.u)("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",te),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:w,"aria-label":Pe.reset,title:Pe.reset},(0,pi.u)("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",fe),styles:this._toRotationTransform(_)}),(0,pi.u)("span",{class:"esri-icon-font-fallback-text"},Pe.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(_){return{transform:`rotateZ(${_.z}deg)`}}};(0,Ze._)([(0,Ss.B)("viewModel.goToOverride")],Yh.prototype,"goToOverride",void 0),(0,Ze._)([(0,nt.Cb)()],Yh.prototype,"iconClass",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Yh.prototype,"label",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Compass/t9n/Compass")],Yh.prototype,"messages",void 0),(0,Ze._)([(0,Ss.B)("viewModel.view")],Yh.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:GD})],Yh.prototype,"viewModel",void 0),(0,Ze._)([(0,kh.h)()],Yh.prototype,"_reset",null),Yh=(0,Ze._)([(0,ui.j)("esri.widgets.Compass")],Yh);const Y8=Yh;let sm=class extends Bi.Z{constructor(_){super(_),this._handles=new cn.Z,this.navigationMode="pan",this.view=null}initialize(){this._handles.add((0,pt.gx)(()=>{var _;return null==(_=this.view)?void 0:_.inputManager},()=>this._setNavigationMode()))}destroy(){this._handles.destroy(),this._handles=null,this.view=null}get state(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}toggle(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],sm.prototype,"state",null),(0,Ze._)([(0,nt.Cb)()],sm.prototype,"navigationMode",void 0),(0,Ze._)([(0,nt.Cb)()],sm.prototype,"view",void 0),sm=(0,Ze._)([(0,ui.j)("esri.widgets.NavigationToggleViewModel")],sm);const HD=sm,wd_button="esri-navigation-toggle__button esri-widget--button";let Jh=class extends wu.Z{constructor(_,v){super(_,v),this.iconClass="esri-icon-pan2",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new HD}set layout(_){"horizontal"!==_&&(_="vertical"),this._set("layout",_)}toggle(){return this.viewModel.toggle()}render(){const _="disabled"===this.get("viewModel.state"),v="pan"===this.get("viewModel.navigationMode"),D={"esri-navigation-toggle__button--active":v},w={"esri-navigation-toggle__button--active":!v},te=_?-1:0,fe=this.messages.toggle;return(0,pi.u)("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{"esri-disabled":_,"esri-navigation-toggle--horizontal":"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:te,"aria-label":fe,title:fe},(0,pi.u)("div",{class:this.classes(wd_button,"esri-navigation-toggle__button--pan",D)},(0,pi.u)("span",{class:"esri-icon-pan"})),(0,pi.u)("div",{class:this.classes(wd_button,"esri-navigation-toggle__button--rotate",w)},(0,pi.u)("span",{class:"esri-icon-rotate"})))}_toggle(){this.toggle()}};(0,Ze._)([(0,nt.Cb)()],Jh.prototype,"iconClass",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Jh.prototype,"label",void 0),(0,Ze._)([(0,nt.Cb)({value:"vertical"})],Jh.prototype,"layout",null),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/NavigationToggle/t9n/NavigationToggle")],Jh.prototype,"messages",void 0),(0,Ze._)([(0,Ss.B)("viewModel.view")],Jh.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:HD})],Jh.prototype,"viewModel",void 0),(0,Ze._)([(0,kh.h)()],Jh.prototype,"_toggle",null),Jh=(0,Ze._)([(0,ui.j)("esri.widgets.NavigationToggle")],Jh);const J8=Jh;let rf=class extends wu.Z{constructor(){super(...arguments),this.enabled=!0,this.iconClass="",this.title=""}render(){const _=this.enabled?0:-1,O={[this.iconClass]:!!this.iconClass};return(0,pi.u)("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{"esri-disabled":!this.enabled,"esri-interactive":this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:_,title:this.title},(0,pi.u)("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",O)}),(0,pi.u)("span",{class:"esri-icon-font-fallback-text"},this.title))}_triggerAction(){this.action.call(this)}};(0,Ze._)([(0,nt.Cb)()],rf.prototype,"action",void 0),(0,Ze._)([(0,nt.Cb)()],rf.prototype,"enabled",void 0),(0,Ze._)([(0,nt.Cb)()],rf.prototype,"iconClass",void 0),(0,Ze._)([(0,nt.Cb)()],rf.prototype,"title",void 0),(0,Ze._)([(0,kh.h)()],rf.prototype,"_triggerAction",null),rf=(0,Ze._)([(0,ui.j)("esri.widgets.IconButton")],rf);const KD=rf;let nm=class extends Bi.Z{get canZoomIn(){if(!this.get("view.ready"))return!1;const _=this.get("view.animation.target.scale")||this.get("view.scale"),v=this.get("view.constraints.effectiveMaxScale");return 0===v||_>v}get canZoomOut(){if(!this.get("view.ready"))return!1;const _=this.get("view.animation.target.scale")||this.get("view.scale"),v=this.get("view.constraints.effectiveMinScale");return 0===v||_<v}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],nm.prototype,"canZoomIn",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],nm.prototype,"canZoomOut",null),(0,Ze._)([(0,nt.Cb)()],nm.prototype,"view",void 0),nm=(0,Ze._)([(0,ui.j)("esri.widgets.Zoom.ZoomConditions2D")],nm);const X8=nm;let om=class extends Bi.Z{get canZoomIn(){return!!this.get("view.ready")}get canZoomOut(){return!!this.get("view.ready")}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],om.prototype,"canZoomIn",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],om.prototype,"canZoomOut",null),(0,Ze._)([(0,nt.Cb)()],om.prototype,"view",void 0),om=(0,Ze._)([(0,ui.j)("esri.widgets.Zoom.ZoomConditions3D")],om);const Q8=om;let sf=class extends Bi.Z{constructor(_){super(_),this.canZoomIn=!1,this.canZoomOut=!1}destroy(){this.view=null}get state(){return this.get("view.ready")?"ready":"disabled"}set view(_){_?"2d"===_.type?this._zoomConditions=new X8({view:_}):"3d"===_.type&&(this._zoomConditions=new Q8({view:_})):this._zoomConditions=null,this._set("view",_)}zoomIn(){if(!this.canZoomIn)return;const _=this.view;"2d"===_.type?_.mapViewNavigation.zoomIn():(0,zi.R8)(_.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const _=this.view;"2d"===_.type?_.mapViewNavigation.zoomOut():(0,zi.R8)(_.goTo({zoomFactor:.5}))}};(0,Ze._)([(0,nt.Cb)()],sf.prototype,"_zoomConditions",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],sf.prototype,"canZoomIn",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],sf.prototype,"canZoomOut",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],sf.prototype,"state",null),(0,Ze._)([(0,nt.Cb)()],sf.prototype,"view",null),sf=(0,Ze._)([(0,ui.j)("esri.widgets.Zoom.ZoomViewModel")],sf);const ZD=sf;let $p=class extends wu.Z{constructor(_,v){super(_,v),this.iconClass="esri-icon-zoom-in-magnifying-glass",this.label=void 0,this.messages=null,this.view=null,this.viewModel=new ZD}initialize(){this._zoomInButton=new KD({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"}),this._zoomOutButton=new KD({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})}destroy(){this._zoomInButton.destroy(),this._zoomOutButton.destroy(),this._zoomInButton=null,this._zoomOutButton=null}set layout(_){"horizontal"!==_&&(_="vertical"),this._set("layout",_)}render(){const _=this.viewModel,v={"esri-zoom--horizontal":"horizontal"===this.layout};return this._zoomInButton.enabled="ready"===_.state&&_.canZoomIn,this._zoomOutButton.enabled="ready"===_.state&&_.canZoomOut,this._zoomInButton.title=this.messages.zoomIn,this._zoomOutButton.title=this.messages.zoomOut,(0,pi.u)("div",{class:this.classes("esri-zoom esri-widget",v)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};(0,Ze._)([(0,nt.Cb)()],$p.prototype,"iconClass",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],$p.prototype,"label",void 0),(0,Ze._)([(0,nt.Cb)({value:"vertical"})],$p.prototype,"layout",null),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Zoom/t9n/Zoom")],$p.prototype,"messages",void 0),(0,Ze._)([(0,Ss.B)("viewModel.view")],$p.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:ZD})],$p.prototype,"viewModel",void 0),$p=(0,Ze._)([(0,ui.j)("esri.widgets.Zoom")],$p);const q8=$p,$D="esri.views.ui.DefaultUI";pn.Z.getLogger($D);let ME=class extends H8{constructor(_){super(_),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[]}initialize(){this._handles.add([(0,pt.YP)(()=>this.components,this._componentsWatcher.bind(this),pt.nn),(0,pt.YP)(()=>this.view,this._updateViewAwareWidgets.bind(this),pt.nn)])}_add(_,v,O,D){if("string"==typeof _&&this._defaultPositionLookup[_]){if(this._find(_))return;_=this._createComponent(_)}super._add(_,v,O,D)}_removeComponents(_){_.forEach(v=>{const O=this._find(v);O&&(this.remove(O),O.destroy())})}_updateViewAwareWidgets(_){this.components.forEach(v=>{const O=this._find(v),D=O&&O.widget;(function eN(_){return _&&void 0!==_.view})(D)&&(D.view=_)})}_componentsWatcher(_,v){this._removeComponents(v),this._addComponents(_),this._adjustPadding(_)}_adjustPadding(_){if(!_.includes("attribution")&&!this._isOverridden("padding")){const{top:v}=this.padding;this.padding=v}}_addComponents(_){this.initialized&&_.forEach(v=>this.add(this._createComponent(v),this._defaultPositionLookup[v]))}_createComponent(_){const v=this._createWidget(_);if(v)return new CE({id:_,node:v})}_createWidget(_){return"attribution"===_?this._createAttribution():"compass"===_?this._createCompass():"navigation-toggle"===_?this._createNavigationToggle():"zoom"===_?this._createZoom():void 0}_createAttribution(){return new $8({view:this.view})}_createCompass(){return new Y8({view:this.view})}_createNavigationToggle(){return new J8({view:this.view})}_createZoom(){return new q8({view:this.view})}};(0,Ze._)([(0,nt.Cb)()],ME.prototype,"components",void 0),ME=(0,Ze._)([(0,ui.j)($D)],ME);const tN=ME;let OE=class extends tN{constructor(_){super(_),this.components=["attribution","zoom","navigation-toggle","compass"]}};(0,Ze._)([(0,nt.Cb)()],OE.prototype,"components",void 0),OE=(0,Ze._)([(0,ui.j)("esri.views.ui.3d.DefaultUI3D")],OE);const kD=OE,ad=pn.Z.getLogger("esri.views.SceneView");let Os=class extends(lc((0,Vl.f)(l0(pl)))){constructor(_){var v;super(_),v=this,this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this.propertiesPool=new B0.L({slicePlane:_s.B},this),this._resourceController=function pU(_){return new Rb.ResourceController({view:_})}(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new ib({view:this}),this.labeler=new Uf({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new po,this.basemapTerrain=null,this.elevationProvider=null,this.camera=null,this.canvas=null,this.center=null,this.constraints=new Et,this.environmentManager=new rh,this.extent=null,this.floors=new Pn.Z,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new yp({view:this}),this.groundView=null,this.navigating=!1,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new ML,this.scale=null,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new kD,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.viewpoint=null,this.zoom=null,this.highlightOptions=new Db,this.voxelWasm=null,this.voxelWasmPromise=null,(0,wr.j2)(),_&&_.environment||(this._defaults.environment=new di,this.environment=this._defaults.environment);const O=(D=null)=>{(0,lt.pC)(D)&&D.type===ft.y.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(function(){var w=(0,Ai.Z)(function*(te){try{yield te.when()}catch(fe){}v._updatingChanged()});return function(te){return w.apply(this,arguments)}}()))};this.handles.add([(0,pt.on)(()=>{var D;return null==(D=this.map)?void 0:D.allLayers},"after-changes",D=>O(D),{onListenerAdd:()=>O(),onListenerRemove:()=>O(),sync:!0}),this.allLayerViews.on("after-changes",D=>this._updateUpdatingMonitors(D)),(0,pt.YP)(()=>this.map,D=>{D&&"load"in D&&D.load&&D.load().catch(()=>{})})]),this.inputManager=new f3({view:this}),this.stateManager=new XL({view:this})}initialize(){this.groundView=new Gc({view:this}),this._updateUpdatingMonitors();const _=()=>this._updateDefaultToMapOptions();this.handles.add((0,pt.on)(()=>{var v;return null==(v=this.map)?void 0:v.allLayers},"after-changes",_,{onListenerAdd:_,onListenerRemove:_})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,v=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=v)},pt.nn),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,v=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=v)},pt.nn),this.updatingHandles.add(()=>this.qualitySettings.frameRate,v=>(0,rt.bP)(v>0?1e3/Math.ceil(v):0),pt.nn),this.updatingHandles.add(()=>{var v;return null==(v=this.map)?void 0:v.ground},_,pt.tX),this.updatingHandles.add(()=>{var v,O;return null==(O=null==(v=this.map)?void 0:v.ground)?void 0:O.opacity},()=>this._updateDefaultHitTestOptions(),pt.tX),this.handles.add((0,pt.YP)(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),pt.Z_))}destroy(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=(0,lt.SC)(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=(0,lt.SC)(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=(0,lt.SC)(this.groundView))}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var _;return null==(_=this.basemapTerrain)?void 0:_.spatialReference}installContentCameraReset(_={sticky:!1}){return this.stateManager.installContentCameraReset(_)}get clippingArea(){if("global"===this.viewingMode)return null;let _=this._userClippingArea||this.get("map.clippingArea");return!this._userClippingArea&&!this.get("map.clippingEnabled")||(0,lt.Wi)(_)?(this._clippingArea=null,null):_ instanceof To.Z?this.spatialReference&&(_=PE(_,this.spatialReference),(0,lt.Wi)(_))?(ad.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(_=_.clone(),(0,lt.Wi)(_.intersection(this.groundAndLayersExtent))&&(_.xmin=_.xmax,_.ymin=_.ymax),_.zmin=void 0,_.zmax=void 0,_.equals(this._clippingArea)||(this._clippingArea=_),this._clippingArea):(ad.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(_){this.ready&&"global"===this.viewingMode&&(0,lt.pC)(_)?ad.error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=_}get renderDataExtent(){if(this.state.viewingMode===Us.JY.Global)return null;const _=this.renderSpatialReference,v=this.dataExtent;return(0,lt.Wi)(v)||(0,lt.Wi)(_)||v.spatialReference.equals(_)?v:PE(v,_)}get dataExtent(){let _=this.groundAndLayersExtent;const O=PE(this.clippingArea,this.spatialReference||Xn.Z.WGS84);(0,lt.pC)(O)&&(_=(0,lt.pC)(_)?_.intersection(O):O);const D=this._get("dataExtent");return(0,lt.pC)(_)&&_.equals(D)?D:_}get groundAndLayersExtent(){const _=this.spatialReference||Xn.Z.WGS84;let v;const O=te=>{const fe=PE(te,_);(0,lt.Wi)(fe)||((0,lt.pC)(v)?v.union(fe):v=fe.clone())},D=this.basemapTerrain;if(null==D?void 0:D.spatialReference){const te=D.groundExtent;O(new To.Z({xmin:te[0],ymin:te[1],zmin:0,xmax:te[2],ymax:te[3],zmax:0,spatialReference:D.spatialReference}))}if(this.map){const te=fe=>{!(0,lt.pC)(fe.fullExtent)||"graphics"===fe.type&&fe.internal||O(fe.fullExtent)};this.map.allLayers.forEach(fe=>te(fe))}if((0,lt.Wi)(v))return null;v.hasZ?(v.zmin=Math.min(0,v.zmin),v.zmax=Math.max(0,v.zmax)):(v.zmin=0,v.zmax=0);const w=this._get("groundAndLayersExtent");return v.equals(w)?w:v}set environment(_){_!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",_)}castEnvironment(_){return _?_ instanceof di?_:_ instanceof Xr?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(_):di.fromWebsceneEnvironment(_):(0,Ro.se)(di,_):new di}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){return this.navigating||(0,lt.pC)(this.activeTool)}get stationary(){return!this.animation&&!this.resizing&&((0,lt.Wi)(this.state)||this.state.stationary)}set qualityProfile(_){Ov.isValidProfile(_)&&(Ov.apply(_,this.qualitySettings),this._set("qualityProfile",_))}get qualityProfile(){return this._get("qualityProfile")||Ov.getDefaultProfile()}set slicePlane(_){if((0,lt.pC)(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:_}),(0,lt.Wi)(_))return void this._set("slicePlane",null);const v=this.propertiesPool.get("slicePlane");(0,_s.a)(_,v),this._set("slicePlane",v)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return null!=this.spatialReference?(0,Ri.dp)(this.scale,this.spatialReference):0}get heightModelInfo(){const _=this.getDefaultHeightModelInfo();return null!=_?fi.Z.deriveUnitFromSR(_,this.spatialReference):null}get updating(){var D,w,te;if(this.destroyed)return!1;let _=0,v=this.layerViewManager.updating,O=v?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(fe=>{if(fe.isFulfilled()){if(fe.updating){if(v=!0,fe.suspended||(0,Ji.wP)(fe))return;++O,_+=fe.updatingProgress}}else++O});for(const fe of[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])(0,lt.pC)(fe)&&fe.updating&&(O+=.1,_+=.05);for(const fe of[this.deconflictor,this.labeler,this.basemapTerrain])(0,lt.pC)(fe)&&fe.updating&&(++O,_+=fe.updatingProgress);if(v=!!(v||O>0||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||(null==(D=this.inputManager)?void 0:D.hasPendingInputs)||(null==(te=null==(w=this.map)?void 0:w.allLayers)?void 0:te.some(fe=>!fe.isFulfilled()))),v?(this._numUpdating=Math.max(O,this._numUpdating),_+=this._numUpdating-O):this._numUpdating=0,this._numUpdating>0?_/=this._numUpdating:_=v?0:1,this._get("updatingProgress")!==_){const fe=performance.now();if(_<1){const Pe=Math.min((fe-this._lastUpdateTime)/2e3,1);_=this.updatingProgress*(1-Pe)+_*Pe}this._set("updatingProgress",_),this._lastUpdateTime=v&&_<1?fe:0}return v}get viewingMode(){var O;const _=this._predeterminedViewingMode;if((0,lt.pC)(_))return(0,Us.M7)(_);const v=this.spatialReference;return v?(0,lt.pC)(null==(O=this.defaultsFromMap)?void 0:O.viewingMode)&&v.equals(this.defaultsFromMap.spatialReference)?(0,Us.M7)(this.defaultsFromMap.viewingMode):(0,j1.D)(v,Us.JY.Global)?"global":"local":"global"}set viewingMode(_){this.ready?ad.error("#viewingMode","viewingMode cannot be set once view is ready"):_?this._override("viewingMode",_):void 0===_&&this._clearOverride("viewingMode")}get resourceController(){return this._resourceController}get performanceInfo(){return new gU(this)}forceAnimationTime(_){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=_}on(_,v,O,D){return this.viewEvents.on(_,v,O,D)||super.on(_,v)}hasEventListener(_){return super.hasEventListener(_)||this.viewEvents.hasHandler(_)}toMap(_,v){if(!this.ready)return ad.error("#toMap()","Scene view cannot be used before it is ready"),null;const O=v?this.externalToInternalIntersectOptions(v):this._defaultToMapOptions,D=(0,lt.pC)(O.graphics)&&((0,lt.pC)(O.graphics.include)||(0,lt.pC)(O.graphics.exclude)),w=(0,na.Rw)(_)?(0,na.s6)(this,_):_,te=(0,dr.md)(w);O.enableDraped=O.include&&!O.include.has(Qu.cy)||O.exclude&&O.exclude.has(Qu.cy);const fe=this.sceneIntersectionHelper,Pe=(0,fc.Z8)(this.state.viewingMode);if(Pe.options.selectionMode=!0,Pe.options.store=D?Ll.eC.ALL:Ll.eC.MIN,fe.intersectIntersectorScreen(te,Pe,O),D){for(const Ue of Pe.results.all){const Xe=(0,bE.bK)(Ue,this);if((0,lt.Wi)(Xe))return this._intersectResultToMapPoint(Ue);if("graphic"!==Xe.type||this._testGraphicUidFilter(O.graphics,Xe.graphic))return this._intersectResultToMapPoint(Ue)}return null}return this._intersectResultToMapPoint(Pe.results.min)}toScreen(_){if(!this.ready)return ad.error("#toScreen()","Scene view cannot be used before it is ready"),null;const v=(0,lt.Pt)(null==_.z&&(0,E_.KO)(this.elevationProvider,_),0);return(0,ci.KC)(_,am,this.renderSpatialReference,v),this.state.camera.projectToScreen(am,WC),(0,dr.vW)(WC[0],WC[1])}pixelSizeAt(_){return this.ready?_?((0,ci.KC)(_,am,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(am)):0:(ad.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(_){const v=this.basemapTerrain.overlayManager;return v?v.overlayPixelSizeInMapUnits(_):1}hitTest(_,v){if(!this.ready)return ad.error("#hitTest()","Scene view cannot be used before it is ready"),null;const O=(0,na.Rw)(_)?(0,na.s6)(this,_):_,D=(0,dr.s1)(O.x,O.y),w=v?this.externalToInternalIntersectOptions(v):this._defaultHitTestOptions;w.requiresGroundFeedback=!0,w.enableDraped=!0;const te=(0,fc.Z8)(this.state.viewingMode);te.options.selectionMode=!0,te.options.store=Ll.eC.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(D,te,w);const fe=this._intersectResultsToHits(te.results.all,w.graphics),Pe=te.results.ground,Ue=(0,bE.J4)(Pe,this),Xe=(0,lt.pC)(Ue)&&"type"in Ue&&"integrated-mesh"===Ue.type?Ue:null,st={screenPoint:O,results:fe,ground:{mapPoint:this._intersectResultToMapPoint(Pe),distance:(0,Ev.nn)(Pe)?Pe.distanceInRenderSpace:0,layer:Xe}};return Yl.Z.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(st.intersector=te),Promise.resolve(st)}popupHitTest(_){var v=this;return(0,Ai.Z)(function*(){const{results:O,ground:D}=yield function L8(_,v){return BC.apply(this,arguments)}(v,_);let w=null;return!(0===O.length||Math.abs((0,lt.Pt)(O[0].distance,0)-D.distance)<1e-5)||D.layer&&"integrated-mesh"===D.layer.type||(w=D.mapPoint),{results:O,screenPoint:_,mapPoint:w}})()}goTo(_,v){return this.updatingHandles.addPromise(this.stateManager.goTo(_,v))}whenAnalysisView(_){var v=this;return(0,Ai.Z)(function*(){if((0,lt.Wi)(_.parent))throw new Ls.Z("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:_});return"line-of-sight"===_.parent.type?(yield v.whenLayerView(_.parent)).whenAnalysisView():v.analysisViewManager.whenAnalysisView(_)})()}whenLayerView(_){return super.whenLayerView(_)}takeScreenshot(_){var v=this;return(0,Ai.Z)(function*(){const O=v._completeSettings(_);yield v.whenReady();const D=yield v._stage.renderView.takeScreenshot(O);return(0,Q0.cv)(D,O,v._pixelFormat())})()}_takeScreenshot(_){var v=this;return(0,Ai.Z)(function*(){const O=v._completeSettings(_);yield v.whenReady();const D=yield v._stage.renderView.takeScreenshot(O);return(0,Q0.v8)(D,v._pixelFormat())})()}_completeSettings(_){const v=(0,Q0.uz)(_,this);return v.pixelRatio/=this.state.pixelRatio,(0,Q0.$3)(v,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:_=>this._takeScreenshot(_)}}addUpdatingPromise(_){return this.updatingHandles.addPromise(_)}importLayerView(_){return(_=>{const v=Ki[_.type];if((0,lt.Wi)(v))throw function yu(_){const v=_.declaredClass?_.declaredClass.slice(_.declaredClass.lastIndexOf(".")+1):"Unknown",O=v.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new Ls.Z(`${O}:view-not-supported`,`${v} is not supported in 3D`)}(_);return v(_)})(_)}hasLayerViewModule(_){return(_=>(0,lt.pC)(Ki[_.type]))(_)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var _,v,O,D;return this.map&&"initialViewProperties"in this.map&&(null==(v=null==(_=this.map)?void 0:_.initialViewProperties)?void 0:v.spatialReference)||(null==(O=this.defaultsFromMap)?void 0:O.spatialReference)||(null==(D=this.defaultsFromMap)?void 0:D.ready)&&this._initialDefaultSpatialReference||null}validate(){var _=this;return(0,Ai.Z)(function*(){let v=function j8(_){const v=(0,N8.hc)(_);if(!v.available)return new Ls.Z("webgl:required","WebGL is required but not supported.");if("3d"===_&&v.majorPerformanceCaveat)return new Ls.Z("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!v.supportsHighPrecisionFragment)return new Ls.Z("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!v.supportsVertexShaderSamplers)return new Ls.Z("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(v.type===Yf.zO.WEBGL1){if(!v.supportsElementIndexUint)return new Ls.Z("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!v.supportsStandardDerivatives)return new Ls.Z("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!v.supportsInstancedArrays)return new Ls.Z("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}(_.type);if((0,Jo.Z)("safari")&&(0,Jo.Z)("safari")<9&&(v=new Ls.Z("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:(0,Jo.Z)("safari")})),(0,lt.pC)(v))throw ad.warn("#validate()",v.message),v})()}get _predeterminedViewingMode(){var v,O;const _=this._isOverridden("viewingMode")?this._get("viewingMode"):null!=(O=this.map&&"initialViewProperties"in this.map?null==(v=this.map.initialViewProperties)?void 0:v.viewingMode:null)?O:null;return(0,lt.pC)(_)?(0,Us.wg)(_):null}getSpatialReferenceSupport({spatialReference:_,layer:v}){const O=this._predeterminedViewingMode;if((0,lt.pC)(O))return this._validateSpatialReferenceForViewingMode(_,v,O)?{constraints:this._makeSpatialReferenceConstraints(_,v,O)}:null;const D=this._validateSpatialReferenceForViewingMode(_,v,Us.JY.Local),w=this._validateSpatialReferenceForViewingMode(_,v,Us.JY.Global);return D||w?D&&w?{constraints:this._makeSpatialReferenceConstraints(_,v,null)}:D?{constraints:this._makeSpatialReferenceConstraints(_,v,Us.JY.Local)}:{constraints:this._makeSpatialReferenceConstraints(_,v,Us.JY.Global)}:null}_validateSpatialReferenceForViewingMode(_,v,O){return!(!(0,j1.D)(_,O)||!(0,lt.Wi)(v)&&!(0,Ws.Am)(v)&&((0,Ws.iC)(v)&&(0,lt.Wi)((0,Ji.E_)(v,_,O))||(0,Ws.Tv)(v)&&O===Us.JY.Global))}_makeSpatialReferenceConstraints(_,v,O){if((0,lt.Wi)(v))return[{spatialReference:_,viewingMode:O}];const D=_.isWebMercator,w=_.isWGS84;return(0,Ws.Am)(v)&&(D||w)?w&&O!==Us.JY.Local&&null!==(0,Ji.er)(v.tileInfo,v.fullExtent,_,Us.JY.Global)?[{spatialReference:D?Xn.Z.WGS84:Xn.Z.WebMercator,viewingMode:O}]:[{spatialReference:_,viewingMode:O},{spatialReference:Xn.Z.WebMercator,viewingMode:O}]:(0,Ws.iC)(v)||(0,Ws.Tv)(v)||!D&&!w?(0,Ws.iC)(v)&&D&&O!==Us.JY.Global?[{spatialReference:_,viewingMode:O},{spatialReference:Xn.Z.WGS84,viewingMode:Us.JY.Local}]:[{spatialReference:_,viewingMode:O}]:[{spatialReference:_,viewingMode:O},{spatialReference:D?Xn.Z.WGS84:Xn.Z.WebMercator,viewingMode:O}]}_validateSpatialReference(_){const v=(0,lt.pC)(this.getSpatialReferenceSupport({spatialReference:_})),O=this._predeterminedViewingMode;return v||((0,lt.pC)(O)?ad.warnOnce(`Spatial reference defined on view not supported in ${(0,Us.M7)(O)} viewing mode.`):_.isGeographic&&ad.warnOnce("Spatial reference is geographic but not supported.")),v}whenReady(){return new Promise(_=>{this.ready?_(this):this._resolveWhenReady.push(_)})}computeMapPointFromVec3d(_,v){let O=this.spatialReference||Xn.Z.WGS84;return(0,ci.SH)(_,this.renderSpatialReference,_,O)||(O=Xn.Z.WGS84,(0,ci.SH)(_,this.renderSpatialReference,_,O)),v?(v.x=_[0],v.y=_[1],v.z=_[2],v.spatialReference=O):v=new vs.Z(_,O),v}trackGraphicState(_){if(!_.graphic)return ad.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const v=this.getViewForGraphic(_.graphic);let O=null,D=!1;const w=te=>{var fe;!D&&(0,lt.pC)(te)&&"processor"in te&&"graphics-3d"===(null==(fe=te.processor)?void 0:fe.type)&&te.processor.graphicsCore&&(O=te.processor.graphicsCore.trackGraphicState(_))};return(0,lt.pC)(v)?w(v):this.whenViewForGraphic(_.graphic,{waitForLayer:!0}).then(te=>w(te),()=>{}).catch(()=>{}),{remove:()=>{D=!0,(0,lt.pC)(O)&&(O.remove(),O=null)}}}highlight(_){if(Array.isArray(_))return(0,Ut.AL)(_.map(O=>this.highlight(O)));if(Pn.Z.isCollection(_))return(0,Ut.AL)(_.toArray().map(O=>this.highlight(O)));const v=this.getViewForGraphic(_);return v&&"highlight"in v?v.highlight(_):(0,Ut.kB)()}maskOccludee(_){if(!_)return ad.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const v=this.getViewForGraphic(_);let O=null,D=!1;const w=te=>{!D&&(0,lt.pC)(te)&&(0,ND._1)(te)&&(O=te.maskOccludee(_))};return(0,lt.pC)(v)?w(v):this.whenViewForGraphic(_,{waitForLayer:!0}).then(te=>w(te),()=>{}).catch(()=>{}),{remove:()=>{D=!0,(0,lt.pC)(O)&&(O.remove(),O=null)}}}getViewForGraphic(_){return _.layer===this.graphics?this.graphicsView:_.layer?this.allLayerViews.find(v=>v.layer===_.layer):null}graphicChanged(_){(0,lt.pC)(this.graphicsView)&&this.graphicsView.graphicChanged(_)}whenViewForGraphic(_,v){var O=this;return(0,Ai.Z)(function*(){if(_.layer===O)return yield(0,pt.N1)(()=>O.graphicsView),O.graphicsView;if(!_.layer||!O.map)throw new Ls.Z("no-view-for-graphic");return v&&v.waitForLayer&&!O.map.allLayers.includes(_.layer)?new Promise((D,w)=>{const te=O.map.allLayers.on("change",fe=>{fe.added.includes(_.layer)&&(te.remove(),O.whenLayerView(_.layer).then(D,w))})}):O.whenLayerView(_.layer)})()}externalToInternalIntersectOptions(_){const v=this._externalToInternalRenderItems(_.include,Hg.INCLUDE),O=this._externalToInternalRenderItems(_.exclude,Hg.EXCLUDE);return{include:v.layerUids,exclude:O.layerUids,graphics:{include:v.graphicUids,exclude:O.graphicUids}}}_intersectResultToMapPoint(_,v){return _.getIntersectionPoint(am)?(v=this.computeMapPointFromVec3d(am,v),_.intersector===Ll.q7.TERRAIN&&this.basemapTerrain&&(v.z=(0,lt.Pt)((0,E_.KO)(this.basemapTerrain,v),0)),v):null}_intersectResultsToHits(_,v){const O=new Array;let D=null;for(let w=0;w<_.length;w++){const te=_[w],fe=(0,bE.J4)(te,this);if((0,lt.pC)(fe)&&(fe===this.map.ground||"type"in fe&&"integrated-mesh"===fe.type))break;const Pe=(0,bE.bK)(te,this);if((0,lt.Wi)(Pe))continue;if("graphic"===Pe.type){if((0,lt.Wi)(D)&&w!==_.length-1&&(D=new Set),(0,lt.pC)(D)){const st=this._getGraphicFilterUid(Pe.graphic);if(D.has(st))continue;D.add(st)}if(!this._testGraphicUidFilter(v,Pe.graphic))continue}const Ue=this._intersectResultToMapPoint(te),Xe=te.distanceInRenderSpace;O.push(yi(or({},Pe),{mapPoint:Ue,distance:Xe}))}return O}_getGraphicFilterUid(_){if(_.layer&&"objectIdField"in _.layer){const v=_.attributes[_.layer.objectIdField];if(v)return`o-${_.layer.id}-${v}`}return`u-${_.uid}`}_testGraphicUidFilter(_,v){const O=this._getGraphicFilterUid(v);return(0,lt.Wi)(_)||((0,lt.Wi)(_.include)||_.include.has(O))&&((0,lt.Wi)(_.exclude)||!_.exclude.has(O))}_externalToInternalRenderItems(_,v,O={layerUids:null,graphicUids:null}){if(!_)return O;if(_ instanceof Dn.Z)(function rN(_,v){_.graphicUids||(_.graphicUids=new Set),_.graphicUids.add(v)})(O,this._getGraphicFilterUid(_)),v===Hg.INCLUDE&&((0,lt.pC)(this.graphicsView)&&_.layer===this?Gg(O,this.graphicsView.processor.layer.id):_.layer&&Gg(O,_.layer.uid));else if((0,Tt.TW)(_))for(const D of _)D===this.graphics&&(0,lt.pC)(this.graphicsView)?Gg(O,this.graphicsView.processor.layer.id):D===this.map.ground?Gg(O,Qu.cy):this._externalToInternalRenderItems(D,v,O);else"uid"in _&&Gg(O,_.uid);return O}_initBasemapTerrain(){this._set("basemapTerrain",new w4({view:this})),this._set("elevationProvider",new dg({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new mc({view:this})),this._set("featureTiles",new wl({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const _=()=>{var O;const v=null==(O=this.basemapTerrain)?void 0:O.extent;if(this.clippingArea||v)if(v&&this.basemapTerrain.spatialReference){const D=(0,lt.pC)(this.basemapTerrain.extent)?(0,ci.iV)((0,qr.HH)(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.featureTiles.filterExtent=(0,lt.pC)(this.clippingArea)?this.clippingArea.intersection(D):D}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>Yl.Z.FEATURE_TILE_TREE_SHOW_TILES,v=>{v&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(Promise.all([T.e(8592),T.e(5566)]).then(T.bind(T,15566))).then(({FeatureTileTree3DDebugger:O})=>{!this.featureTreeDebugger&&Yl.Z.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new O({view:this}))}):v||!this.featureTreeDebugger||Yl.Z.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},pt.tX),this.updatingHandles.add(()=>this.clippingArea,_,pt.tX),this.updatingHandles.add(()=>this.basemapTerrain.extent,_,pt.tX)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const _=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(_)||this._set("mapCoordsHelper",new aU(this.map,_));const v=this.state.isGlobal,O=(0,$s.E2)(v,_);O!==this.renderSpatialReference&&(this._set("renderCoordsHelper",lU.Z.create(this.state.viewingMode,O)),v||this.handles.add((0,pt.YP)(()=>{var D;return null==(D=this.basemapTerrain)?void 0:D.extent},D=>{D&&(0!==D[0]||0!==D[1]||0!==D[2]||0!==D[3])&&(0,ci.dH)(D,this.basemapTerrain.spatialReference,YD,this.renderCoordsHelper.spatialReference)&&(this.renderCoordsHelper.extent=YD)},pt.Z_),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(fc.vh/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(_=null){(0,lt.pC)(_)&&_.type===ft.y.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(v=>{v.destroyed||(this.handles.add((0,pt.YP)(()=>[v.updating,v.updatingProgress],()=>this._updatingChanged(),pt.Z_),"updatingMonitors"),v.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}_renderScreenshotOverlay(_,v){if(!this.overlay||!this.overlay.hasVisibleItems)return v;const O=_.getContext("2d");return O.putImageData(v,0,0),this.overlay.renderCanvas(_),O.getImageData(0,0,v.width,v.height)}_initStage(){const _={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(Pe,Ue)=>this._renderScreenshotOverlay(Pe,Ue)}},v=new rU(this.state.viewingMode,Pe=>this._stage.layers.forAll(Pe),this);this._set("sceneIntersectionHelper",v);const O=(0,zc.L7)(this.surface),{resourceController:D,state:w,renderSpatialReference:te}=this;this._stage=new ru({options:_,container:O,resourceController:D,state:w,sceneIntersectionHelper:v,renderSR:te}),this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane}),this._lostWebGLContextHandle=(0,mt.on)(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new Ls.Z("webgl-context-lost")),this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),pt.nn),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),pt.nn),(0,pt.YP)(()=>this.magnifier,Pe=>this._stage.renderView.magnifier=Pe,pt.tX)],"stage");const fe=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:Db.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],fe),"stage"),fe(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(fc.vh/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage.destroy(),this._stage=null,this._lostWebGLContextHandle.remove(),this._lostWebGLContextHandle=null,this.handles.remove("stage"),this._set("canvas",null)}_initSurface(_){this._exitSurface(),this.state.init(_,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new EU({view:this,viewingMode:_,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new cL})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||0===this.graphics.length)return;this.handles.remove("graphics-view"),this._createGraphicsViewController=new AbortController;const _=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(_,_),this._updatingChanged()}_createGraphicsViewAsync(_){var v=this;return(0,Ai.Z)(function*(){const O=(yield Promise.all([T.e(4231),T.e(3487),T.e(7312)]).then(T.bind(T,87312))).default;(0,zi.k_)(_),yield(0,pt.N1)(()=>{var D;return null==(D=v.basemapTerrain)?void 0:D.ready},_),v._set("graphicsView",new O({view:v}))})()}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.handles.remove("graphics-view"),(0,lt.pC)(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const _=(0,Us.wg)(this.viewingMode);if(_===Us.JY.Global&&(this._clippingArea=null),this._initSurface(_),this._set("ready",!0),this.handles.add((0,pt.on)(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const O=this.get("map.initialViewProperties.environment");O&&(this.environment=O)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const v=this._resolveWhenReady;this._resolveWhenReady=[],v.forEach(O=>O(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.handles.remove("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Qu.cy);for(const _ of this.map.allLayers.items)"integrated-mesh"===_.type&&this._defaultToMapOptions.include.add(_.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Qu.cy);for(const _ of this.map.allLayers.items)"integrated-mesh"===_.type&&_.opacity<1&&this._defaultToMapOptions.exclude.add(_.uid)}}addVoxelLayerViewToWasm(_){return(0,lt.Wi)(this.voxelWasm)?((0,lt.Wi)(this.voxelWasmPromise)&&(this.voxelWasmPromise=T.e(3208).then(T.bind(T,23208)).then(v=>(this.voxelWasm=new v.default(this),this.voxelWasm))),this.voxelWasmPromise.then(v=>v.addVoxelLayer(_))):this.voxelWasm.addVoxelLayer(_)}removeVoxelLayerViewFromWasm(_){(0,lt.pC)(this.voxelWasm)&&this.voxelWasm.removeVoxelLayer(_)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function Gg(_,v){_.layerUids||(_.layerUids=new Set),_.layerUids.add(v)}function PE(_,v){return(0,lt.pC)(_)&&(0,ci.Up)(_.spatialReference,v)?(0,ci.iV)(_,v):null}var Hg;Os.type="3d",(0,Ze._)([(0,nt.Cb)()],Os.prototype,"_userClippingArea",void 0),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"_resourceController",void 0),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"_stage",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"deconflictor",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"labeler",void 0),(0,Ze._)([(0,nt.Cb)((0,Or.z)(po,"analyses"))],Os.prototype,"analyses",void 0),(0,Ze._)([(0,nt.Cb)({type:Ol,readOnly:!0,aliasOf:"state.animation"})],Os.prototype,"animation",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"basemapTerrain",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"elevationProvider",void 0),(0,Ze._)([(0,nt.Cb)({type:qo,aliasOf:"stateManager.camera"})],Os.prototype,"camera",void 0),(0,Ze._)([(0,nt.Cb)({type:qo,aliasOf:"stateManager.contentCamera"})],Os.prototype,"contentCamera",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"canvas",void 0),(0,Ze._)([(0,nt.Cb)({type:vs.Z,aliasOf:"stateManager.center"})],Os.prototype,"center",void 0),(0,Ze._)([(0,nt.Cb)({type:To.Z})],Os.prototype,"clippingArea",null),(0,Ze._)([(0,nt.Cb)({type:Et})],Os.prototype,"constraints",void 0),(0,Ze._)([(0,nt.Cb)({type:To.Z,readOnly:!0})],Os.prototype,"renderDataExtent",null),(0,Ze._)([(0,nt.Cb)({type:To.Z,readOnly:!0})],Os.prototype,"dataExtent",null),(0,Ze._)([(0,nt.Cb)({type:To.Z,readOnly:!0})],Os.prototype,"groundAndLayersExtent",null),(0,Ze._)([(0,nt.Cb)({value:null,type:di})],Os.prototype,"environment",null),(0,Ze._)([(0,Ga.p)("environment")],Os.prototype,"castEnvironment",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"environmentManager",void 0),(0,Ze._)([(0,nt.Cb)({type:To.Z,aliasOf:"stateManager.extent"})],Os.prototype,"extent",void 0),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"floors",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,aliasOf:"stateManager.screenCenter"})],Os.prototype,"screenCenter",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"stateManager.frustum"})],Os.prototype,"frustum",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,readOnly:!0})],Os.prototype,"fullOpacity",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"graphicsView",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"analysisViewManager",void 0),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"groundView",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],Os.prototype,"initialExtentRequired",null),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"_defaultsFromMapSettings",null),(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0})],Os.prototype,"interacting",null),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"stationary",null),(0,Ze._)([(0,nt.Cb)({aliasOf:"state.navigating"})],Os.prototype,"navigating",void 0),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"map",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"mapCoordsHelper",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"stateManager.padding"})],Os.prototype,"padding",void 0),(0,Ze._)([(0,nt.Cb)({type:mc,readOnly:!0})],Os.prototype,"pointsOfInterest",void 0),(0,Ze._)([(0,nt.Cb)({type:wl,readOnly:!0})],Os.prototype,"featureTiles",void 0),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"featureTreeDebugger",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],Os.prototype,"screenSizePerspectiveEnabled",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Os.prototype,"deactivatedWebGLExtensions",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Os.prototype,"debugWebGLExtensions",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Os.prototype,"renderCanvas",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Os.prototype,"state",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"inputManager",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"stateManager",void 0),(0,Ze._)([(0,nt.Cb)({type:["low","medium","high"]})],Os.prototype,"qualityProfile",null),(0,Ze._)([(0,nt.Cb)({type:SP,get(){let _=this._get("qualitySettings");return _||(_=new SP,Ov.apply(this.qualityProfile,_)),_}})],Os.prototype,"qualitySettings",void 0),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"slicePlane",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"typeSpecificPreconditionsReady",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"renderCoordsHelper",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"sceneIntersectionHelper",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Os.prototype,"resolution",null),(0,Ze._)([(0,nt.Cb)({type:Number,aliasOf:"stateManager.scale"})],Os.prototype,"scale",void 0),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"heightModelInfo",null),(0,Ze._)([(0,nt.Cb)()],Os.prototype,"spatialReference",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,constructOnly:!0})],Os.prototype,"alphaCompositingEnabled",void 0),(0,Ze._)([(0,nt.Cb)({constructOnly:!0})],Os.prototype,"preserveDrawingBufferEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean})],Os.prototype,"supersampleScreenshotsEnabled",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Os.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)({type:kD})],Os.prototype,"ui",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.hasPendingInputs","toolViewManager.updating","analysisViewManager.updating"]})],Os.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)({type:Number,readOnly:!0,dependsOn:["updating"]})],Os.prototype,"updatingProgress",void 0),(0,Ze._)([(0,nt.Cb)({type:["global","local"]})],Os.prototype,"viewingMode",null),(0,Ze._)([(0,nt.Cb)({type:Ra,aliasOf:"stateManager.viewpoint"})],Os.prototype,"viewpoint",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,aliasOf:"stateManager.zoom"})],Os.prototype,"zoom",void 0),(0,Ze._)([(0,nt.Cb)({type:Db})],Os.prototype,"highlightOptions",void 0),Os=(0,Ze._)([(0,ui.j)("esri.views.SceneView")],Os),function(_){_[_.INCLUDE=0]="INCLUDE",_[_.EXCLUDE=1]="EXCLUDE"}(Hg||(Hg={}));const am=(0,$t.c)(),WC=(0,dr.s1)(),YD=(0,qr.Ue)(),xE=Os;var lm=T(27559),iN=T(40342),sN=T(69357),JD=T(25748),qf=T(51470),Rc=T(69648),nN=T(96064),DE=T(89557),XD=T(60507),QD=T(10228),Vo=T(72791),qD=T(24959),eA=T(94309),aN=T(45390),tA=T(79546);let ec=class extends sa.Z.EventedAccessor{constructor(_){super(_),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:(0,Fl.Bg)(this.activeComponent)}return null}addToHistory(_){this.history.redo=[],this.history.undo.push(_)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent.reset()}refreshComponent(){const _=this.activeComponent;_&&("box"!==_.type&&"reshape"!==_.type&&"graphic-mover"!==_.type||_.refresh())}set undo(_){this._set("undo",()=>{this.canUndo()&&_()})}set redo(_){this._set("redo",()=>{this.canRedo()&&_()})}};(0,Ze._)([(0,nt.Cb)()],ec.prototype,"activeComponent",void 0),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"cancelled",void 0),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"history",void 0),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"tool",null),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"type",void 0),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"canUndo",null),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"canRedo",null),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"onEnd",void 0),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"undo",null),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"redo",null),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"toggleTool",void 0),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"addToSelection",void 0),(0,Ze._)([(0,nt.Cb)()],ec.prototype,"removeFromSelection",void 0),ec=(0,Ze._)([(0,ui.j)("esri.widgets.Sketch.support.OperationHandle")],ec);let VC=class extends ec{};(0,Ze._)([(0,nt.Cb)()],VC.prototype,"activeComponent",void 0),VC=(0,Ze._)([(0,ui.j)("esri.widgets.Sketch.support.CreateOperationHandle")],VC);let kp=class extends ec{constructor(_){super(_)}};(0,Ze._)([(0,nt.Cb)()],kp.prototype,"activeComponent",void 0),kp=(0,Ze._)([(0,ui.j)("esri.widgets.Sketch.support.UpdateOperationHandle")],kp);var zC=T(57213),GC=T(88493),HC=T(52068);const rA="esri.widgets.Sketch.SketchViewModel",lN=pn.Z.getLogger(rA),iA={defaultZ:0},AE={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};let Zo=class extends sa.Z.EventedAccessor{constructor(_){super(_),this._numUpdating=0,this._handles=new cn.Z,this._internalGraphicsLayer=new qf.Z({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new cn.Z,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new qD.Z,this.layer=null,this.pointSymbol=new zC.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new GC.Z({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new HC.Z({color:[130,130,130,1],width:2}),this._snappingManager=null,this.tooltipOptions=new eA.Z,this.updateGraphics=new Pn.Z,this.updateOnGraphicClick=!0,this.updatePointSymbol=new zC.Z({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}}),this.updatePolygonSymbol=new GC.Z({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}}),this.updatePolylineSymbol=new HC.Z({color:[12,207,255],width:2}),this.vertexSymbol=new zC.Z({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalAutoOpenEnabled=null,this.defaultCreateOptions=iA,this.defaultUpdateOptions=AE,this.snappingOptions=new tA.Z}initialize(){this._handles.add([(0,pt.on)(()=>{var _,v;return null==(v=null==(_=this.view)?void 0:_.map)?void 0:v.layers},"change",_=>{_.removed.includes(this.layer)&&this.cancel()}),(0,pt.on)(()=>{var _;return null==(_=this.layer)?void 0:_.graphics},"change",_=>{if((0,lt.pC)(this._operationHandle))for(const v of _.removed)this.updateGraphics.includes(v)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(v):this._operationHandle.cancel())}),(0,pt.YP)(()=>{var _,v;return null!=(v=null==(_=this.layer)?void 0:_.elevationInfo)?v:null},_=>{_!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=_)},pt.tX),(0,pt.YP)(()=>this.view,_=>{(0,lt.SC)(this._snappingManager),_&&(this._snappingManager=new aN.N({view:_,options:this.snappingOptions}),"2d"===_.type?Promise.all([T.e(4918),T.e(6777),T.e(4735),T.e(61),T.e(8592),T.e(9593)]).then(T.bind(T,1362)):"3d"===_.type&&(Promise.all([T.e(4918),T.e(6777),T.e(4735),T.e(1668),T.e(3792),T.e(61),T.e(5671),T.e(6813),T.e(8592),T.e(2327)]).then(T.bind(T,82327)),Promise.all([T.e(4231),T.e(3487),T.e(2359)]).then(T.bind(T,62359))))},pt.tX),(0,pt.YP)(()=>{var _;return null==(_=this.view)?void 0:_.spatialReference},(_,v)=>{_&&v&&!_.equals(v)&&this.cancel()})])}destroy(){this.cancel(),this._handles=(0,lt.SC)(this._handles),this._viewHandles=(0,lt.SC)(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=(0,lt.SC)(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){return"3d"===this.view.type?"move":"transform"}get updating(){return this._numUpdating>0}get activeTool(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}get activeComponent(){return this._operationHandle?this._operationHandle.activeComponent:null}get createGraphic(){return!(0,lt.pC)(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):(0,lt.Wg)(this.activeComponent.graphic)}set defaultCreateOptions(_){this._set("defaultCreateOptions",or(or({},iA),_))}set defaultUpdateOptions(_){this._set("defaultUpdateOptions",yi(or(or({},AE),_),{reshapeOptions:or(or({},AE.reshapeOptions),null==_?void 0:_.reshapeOptions)}))}set snappingOptions(_){(0,lt.pC)(this._snappingManager)&&(this._snappingManager.options=_),this._set("snappingOptions",_)}get state(){var O;const _=!(!(null==(O=this.view)?void 0:O.ready)||!this.layer);return _&&this._operationHandle?"active":_?"ready":"disabled"}get view(){return this._get("view")}set view(_){const v=this._get("view");if(v){const{container:D,map:w}=v;D&&(v.cursor=null),w&&w.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const O="view-ready";this._handles.remove(O),_&&this._handles.add((0,pt.gx)(()=>_.ready,D=>{this._viewHandles.removeAll(),D&&this._viewHandles.add(this._generateViewHandles(_))},pt.tX),O),this._set("view",_)}cancel(){this._moduleLoaderAbortController=(0,lt.IM)(this._moduleLoaderAbortController),this._viewReadyAbortController=(0,lt.IM)(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:_,updateGraphics:v}=this;if("active"===_&&v.length){const{activeTool:O,layer:D}=this,w=v.toArray();D.removeMany(w),this.cancel(),this._emitDeleteEvent({graphics:w,tool:O})}}create(_,v){var O=this;return(0,Ai.Z)(function*(){if(O.cancel(),yield O._waitViewReady(),"disabled"===O.state)throw O.layer||O._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),O.view||O._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),(0,zi.zE)();if((0,lt.pC)(O.view.activeTool)&&(O.view.activeTool=null),!_)return void O._logError("sketch:missing-parameter","Missing parameter 'tool'.");(0,QD.p)(O.view,O._internalGraphicsLayer);const D=yield O._setupCreateOperation(_,v);(0,lt.Wi)(D)||O.destroyed?O.view.map.remove(O._internalGraphicsLayer):(D.on("complete",()=>{if(D===O._operationHandle){const te=O.createGraphic,fe=O._operationHandle.cancelled;O._operationHandle.destroy(),O._operationHandle=null,O._set("createGraphic",null),O.view&&O.view.map&&O.view.map.remove(O._internalGraphicsLayer),D.cancelled||null==te||O.layer.add(te),O.emit("create",{graphic:te,state:fe?"cancel":"complete",tool:_,toolEventInfo:null,type:"create"})}}),O._operationHandle=D,O.view.ready&&(0,Vl.t)(O.view)&&O.view.focus())})()}update(_,v){var O=this;return(0,Ai.Z)(function*(){O.cancel(),yield O._waitViewReady();const{layer:D,view:w,state:te}=O;if("disabled"===te)throw w||O._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),D||O._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),(0,zi.zE)();(0,lt.pC)(O.view.activeTool)&&(O.view.activeTool=null);const fe=Array.isArray(_)?_:[_];if(null==_||!fe||!fe.length)return void O._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(fe.some(Ue=>Ue.layer!==D?(O._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):!!(0,lt.Wi)(Ue.geometry)&&(O._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const Pe=yield O._setupUpdateOperation(fe,v);O.destroyed||(0,lt.Wi)(Pe)||yl(Pe)||((0,QD.p)(O.view,O._internalGraphicsLayer),O._setUpdateOperationHandle(Pe,v),O.emit("update",{graphics:fe,state:"start",aborted:!1,tool:Pe.tool,toolEventInfo:null,type:"update"}))})()}_updateSpatialReference(_){var v=this;return(0,Ai.Z)(function*(){v._beginAsyncOperation(),_=Array.isArray(_)?_:[_];for(const O of _)(0,lt.pC)(O.geometry)&&"mesh"!==O.geometry.type&&!(0,qs.fS)(O.geometry.spatialReference,v.view.spatialReference)&&((0,ci.Up)(O.geometry.spatialReference,v.view.spatialReference)||(0,ci.kR)()||(yield(0,ci.zD)()),O.geometry=(0,ci.iV)(O.geometry,v.view.spatialReference));v._endAsyncOperation()})()}undo(){this.canUndo()&&this._operationHandle.undo()}redo(){this.canRedo()&&this._operationHandle.redo()}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}_getFirstHit(_){var v=this;return(0,Ai.Z)(function*(){const O=v.view;if("2d"===O.type){const te=[];return v.view.map.allLayers.forEach(Pe=>{"vector-tile"!==Pe.type&&"imagery"!==Pe.type||te.push(Pe)}),function B8(_){var v;return null!=(v=_.find(BD))?v:null}((yield v.view.hitTest(_,{exclude:te})).results)}const D=[v.view.map.ground];O.map.allLayers.forEach(te=>{"integrated-mesh"===te.type&&D.push(te)});const w=yield O.hitTest(_,{exclude:D});if(w.results.length>0){const te=w.results[0];if((0,lt.pC)(te)&&"graphic"===te.type&&te.graphic&&(!w.ground.mapPoint||O.map.ground.opacity<1||w.ground.distance-(0,lt.Pt)(te.distance,0)>-Math.min(3*w.ground.distance,"global"===O.viewingMode?(0,Zi.Iu)(O.renderCoordsHelper.spatialReference).radius/O.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return te}return null})()}_generateViewHandles(_){var v=this;return[_.on("immediate-click",function(){var O=(0,Ai.Z)(function*(D){if("disabled"===v.state||"active"===v.state&&"create"===v._operationHandle.type||!v.updateOnGraphicClick)return;v._beginAsyncOperation();const te=yield D.async(()=>v._getFirstHit((0,na.vT)(D)));let fe=null;if((0,lt.pC)(te)){const Pe=te.graphic;v.updateGraphics.includes(Pe)||Pe.layer===v.layer?(D.stopPropagation(),fe=Pe):"2d"!==_.type||v._isComponentGraphic(Pe)||"active"!==v.state||v.cancel()}else"active"===v.state&&v.cancel();(0,lt.pC)(fe)&&!v.updateGraphics.includes(fe)&&(yield v.update([fe],yi(or({},v.defaultUpdateOptions),{reshapeOptions:or({},v.defaultUpdateOptions.reshapeOptions)}))),v._endAsyncOperation()});return function(D){return O.apply(this,arguments)}}(),mo.f.WIDGET)]}_setupCreateOperation(_,v){var O=this;return(0,Ai.Z)(function*(){const D=or(or({hasZ:"3d"===O.view.type},O.defaultCreateOptions),v),w=yield O._setupDrawGraphicTool(_,O.view,D);return(0,lt.Wi)(w)?null:(O.view.tools.add(w),O.view.activeTool=w,O._setupCreateOperationHandle(w))})()}_setupDrawGraphicTool(_,v,O){var D=this;return(0,Ai.Z)(function*(){if("multipoint"===_&&"3d"===v.type)return D._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;const w="rectangle"!==_,te="rectangle"!==_;D.snappingOptions.enabledToggled=!1;const fe=yi(or({view:v,mode:"rectangle"===_||"circle"===_?"hybrid":"click"},O),{snapToScene:!1,geometryType:_,graphicSymbol:D._getGraphicSymbolFromTool(_),snappingManager:D._snappingManager,forceUniformSize:te,centered:w});return"2d"===D.view.type?D._makeDrawGraphicTool2D(fe):D._makeDrawGraphicTool3D(fe)})()}_makeDrawGraphicTool2D(_){var v=this;return(0,Ai.Z)(function*(){const O=yield v._requireModule(Promise.all([T.e(4918),T.e(6777),T.e(4735),T.e(61),T.e(8592),T.e(9593)]).then(T.bind(T,1362)));return yl(O)||v.destroyed?null:new O.module.DrawGraphicTool2D(yi(or({},_),{activeVertexSymbol:v.activeVertexSymbol,regularVerticesSymbol:v.vertexSymbol,activeLineSymbol:v.activeLineSymbol,activeFillSymbol:cN(_.geometryType)?v.activeFillSymbol:null}))})()}_makeDrawGraphicTool3D(_){var v=this;return(0,Ai.Z)(function*(){const O=yield v._requireModule(Promise.all([T.e(4918),T.e(6777),T.e(4735),T.e(1668),T.e(3792),T.e(61),T.e(5671),T.e(6813),T.e(8592),T.e(2327)]).then(T.bind(T,82327)));if(yl(O)||v.destroyed)return null;const{elevationInfo:D}=v.layer;return new O.module.DrawGraphicTool3D(yi(or({},_),{elevationInfo:D,snapToScene:!(0,lt.pC)(D)||"absolute-height"===D.mode,labelOptions:v.labelOptions,tooltipOptions:v.tooltipOptions}))})()}_setupCreateOperationHandle(_){let v=null;const O=_.forceUniformSize,D=_.centered,w=[this.view.on("key-down",fe=>{if(fe.key===Vo.j.pan)fe.stopPropagation(),fe.repeat||(_.enabled=!1);else if(fe.key===Vo.j.complete)fe.stopPropagation(),_.completeCreateOperation();else if(fe.key!==Vo.j.vertexAdd||fe.repeat)fe.key===Vo.j.undo?(fe.stopPropagation(),te.undo()):fe.key===Vo.j.redo?(fe.stopPropagation(),te.redo()):fe.key!==Vo.j.snappingToggle||"rectangle"===_.geometryType||"circle"===_.geometryType||fe.repeat?fe.key!==Vo.j.constraint||"rectangle"!==_.geometryType&&"circle"!==_.geometryType||fe.repeat?fe.key===Vo.j.center&&(fe.repeat||(_.centered=!D,fe.stopPropagation())):(_.forceUniformSize=!O,fe.stopPropagation()):(this.snappingOptions.enabledToggled=!0,fe.stopPropagation());else{const Pe=_.drawOperation.geometryType;"polyline"!==Pe&&"polygon"!==Pe&&"multipoint"!==Pe||(fe.stopPropagation(),_.drawOperation.commitStagedVertex())}},mo.f.WIDGET),this.view.on("key-up",fe=>{fe.key===Vo.j.pan?_.enabled=!0:fe.key===Vo.j.snappingToggle&&"rectangle"!==_.geometryType&&"circle"!==_.geometryType?(this.snappingOptions.enabledToggled=!1,fe.stopPropagation()):fe.key!==Vo.j.constraint||"rectangle"!==_.geometryType&&"circle"!==_.geometryType?fe.key===Vo.j.center&&(_.centered=D,fe.stopPropagation()):(_.forceUniformSize=O,fe.stopPropagation())},mo.f.WIDGET),_.on("vertex-add",fe=>{switch(v=(0,lt.Wi)(v)?"start":"active",fe.operation){case"apply":this.emit("create",{graphic:(0,lt.Wg)(_.graphic),state:v,tool:this.activeTool,toolEventInfo:fe,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,lt.Wg)(_.graphic)],tool:_.geometryType});break;case"redo":this._emitRedoEvent({graphics:[(0,lt.Wg)(_.graphic)],tool:_.geometryType})}}),_.on("cursor-update",fe=>{_.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:(0,lt.Wg)(_.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:fe.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),_.on("vertex-remove",fe=>{switch(fe.operation){case"apply":this.emit("create",{graphic:(0,lt.Wg)(_.graphic),state:"active",tool:this.activeTool,toolEventInfo:fe,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[(0,lt.Wg)(_.graphic)],tool:_.geometryType});break;case"redo":this._emitRedoEvent({graphics:[(0,lt.Wg)(_.graphic)],tool:_.geometryType})}}),_.on("complete",fe=>{this._set("createGraphic",(0,lt.Wg)(fe.graphic)),v="complete",fe.aborted?te&&te.cancel():te&&te.complete()}),(0,pt.YP)(()=>this._getGraphicSymbolFromTool(_.geometryType),fe=>{_.graphicSymbol=fe})],te=new ec({activeComponent:_,tool:_.geometryType,type:"create",onEnd:()=>{var fe;w.forEach(Pe=>Pe.remove()),w.length=0,null==(fe=this.view.tools)||fe.remove(_)},undo:()=>{_.canUndo&&_.undo()},redo:()=>{_.canRedo&&_.redo()},canUndo:()=>_.canUndo,canRedo:()=>_.canRedo});return te}_getGraphicSymbolFromTool(_){switch(_){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;default:return null}}_setupUpdateOperation(_,v){var O=this;return(0,Ai.Z)(function*(){const{layer:D,view:w}=O,te=yi(or(or({tool:O._defaultUpdateTool},O.defaultUpdateOptions),v),{reshapeOptions:or(or({},O.defaultUpdateOptions.reshapeOptions),null==v?void 0:v.reshapeOptions)});let fe=te.tool;for(const Pe of _)D.remove(Pe),D.add(Pe);if("3d"===w.type){if(0===_.length)return null;switch(fe){case"move":return O._setupMove3DOperation(_,te,w,fe);case"reshape":{if(_.length>1)return O._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const Pe=(0,DE.P)(_[0]);return Pe===Rc.e.SUPPORTED?O._setupReshape3DOperation(_[0],te,w):(O._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,Rc.Z)(Pe)}).`),null)}case"transform":return O._setupGraphicTransform3DOperation(_,te,w)}}switch(fe){case"move":return O._setupMove2DOperation(_,te,w);case"reshape":{if(_.length>1)return O._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const Pe=(0,DE.P)(_[0]);return Pe===Rc.e.SUPPORTED?O._setupTransformOrReshape2DOperation(_,fe,te,w):(O._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${(0,Rc.Z)(Pe)}).`),null)}case"transform":if(1===_.length){const Pe=(0,lt.U2)(_[0].geometry,"type");"point"!==Pe&&"multipoint"!==Pe||(fe="reshape")}return O._setupTransformOrReshape2DOperation(_,fe,te,w)}})()}_setupMove3DOperation(_,v,O,D,w=!1){var te=this;return(0,Ai.Z)(function*(){for(const st of _){const vt=(0,nN.P)(st);if(vt!==Rc.e.SUPPORTED)return te._logError("sketch:move",`Move operation not supported for provided graphic(s) (${(0,Rc.Z)(vt)}).`),null}const fe=yield te._requireModule(Promise.all([T.e(4918),T.e(6777),T.e(4735),T.e(1668),T.e(3792),T.e(61),T.e(5671),T.e(6813),T.e(8592),T.e(2327)]).then(T.bind(T,82327)));if(yl(fe))return fe;const Pe=new fe.module.GraphicMoveTool({view:O,enableZ:v.enableZ,snappingManager:te._snappingManager,tooltipOptions:te.tooltipOptions});te.view.tools.add(Pe),Pe.graphics.addMany(_),w||te.updateGraphics.addMany(_);const Ue=[],Xe=new kp({activeComponent:Pe,tool:D,type:"update",onEnd:()=>{var st;Ue.forEach(vt=>vt.remove()),Ue.length=0,null==(st=te.view.tools)||st.remove(Pe),Pe.destroyed||Pe.destroy()},undo:()=>{SE(Xe,te.updateGraphics.toArray()),te._emitUndoEvent({graphics:te.updateGraphics.toArray(),tool:D})},redo:()=>{RE(Xe,te.updateGraphics.toArray()),te._emitRedoEvent({graphics:te.updateGraphics.toArray(),tool:D})},addToSelection:st=>{te.updateGraphics.push(st),Pe.graphics.push(st),te.emit("update",{graphics:te.updateGraphics.toArray(),state:"active",aborted:!1,tool:te.activeTool,toolEventInfo:{added:[st],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:st=>{const vt=te.updateGraphics.indexOf(st);Xe.history.undo.forEach(Ct=>Ct.updates.splice(vt,1)),Xe.history.redo.forEach(Ct=>Ct.updates.splice(vt,1)),te.updateGraphics.remove(st),te.emit("update",{graphics:te.updateGraphics.toArray(),state:"active",aborted:!1,tool:te.activeTool,toolEventInfo:{added:[],removed:[st],type:"selection-change"},type:"update"}),0!==te.updateGraphics.length?Pe.graphics.remove(st):Xe.complete()},toggleTool:(st=(0,Ai.Z)(function*(){if(1!==te.updateGraphics.length||!1===v.toggleToolOnClick||"transform"!==D)return;const vt=te.updateGraphics.getItemAt(0);if((0,DE.P)(vt)!==Rc.e.SUPPORTED)return;const Ct=yield te._setupReshape3DOperation(vt,v,O,!0);yl(Ct)||(Xe.onEnd(),Xe.destroy(),te._setUpdateOperationHandle(Ct,v))}),function(){return st.apply(this,arguments)})});var st;return Ue.push(...te._getHandlesForComponent(Xe,v),te.view.on("immediate-click",st=>te._getCommonUpdateOperationClickHandlers(Xe,st,v),mo.f.WIDGET),O.on("key-down",st=>{te._getCommonUpdateOperationKeyDownHandlers(Xe,st),st.key===Vo.j.snappingToggle&&(te.snappingOptions.enabledToggled=!0,st.stopPropagation())},mo.f.WIDGET),O.on("key-up",st=>{st.key===Vo.j.snappingToggle&&(te.snappingOptions.enabledToggled=!1,st.stopPropagation())},mo.f.WIDGET)),Xe})()}_setupGraphicTransform3DOperation(_,v,O,D=!1){if(1===_.length&&function oN(_){var O;if("graphics"!==(null==(O=_.layer)?void 0:O.type))return Rc.e.GRAPHICS_LAYER_MISSING;if((0,lt.Wi)(_.geometry))return Rc.e.GEOMETRY_MISSING;switch(_.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return Rc.e.SUPPORTED;default:return Rc.e.GEOMETRY_TYPE_UNSUPPORTED}const v=(0,lt.pC)(_.symbol)&&"point-3d"===_.symbol.type&&_.symbol.symbolLayers;return v&&v.length>0&&v.some(D=>"object"===D.type)?"on-the-ground"!==(0,XD.vu)(_)&&(0,XD.Lt)(_)?Rc.e.ELEVATION_MODE_UNSUPPORTED:Rc.e.SUPPORTED:Rc.e.SYMBOL_TYPE_UNSUPPORTED}(_[0])===Rc.e.SUPPORTED){const w=_[0],te=w.geometry;if((0,lt.pC)(te)&&("point"===te.type||"mesh"===te.type))return this._setupPointTransform3DOperation(w,v,O);if((0,lt.pC)(te)&&("polygon"===te.type||"polyline"===te.type))return this._setupPolyTransform3DOperation(w,v,O,D)}return this._setupMove3DOperation(_,v,O,"transform",D)}_setupPointTransform3DOperation(_,v,O){var D=this;return(0,Ai.Z)(function*(){const w="transform",{enableRotation:te,enableScaling:fe,enableZ:Pe}=v,Ue=yield D._requireModule(Promise.all([T.e(4918),T.e(6777),T.e(4735),T.e(1668),T.e(3792),T.e(61),T.e(5671),T.e(6813),T.e(8592),T.e(2327)]).then(T.bind(T,82327)));if(yl(Ue))return Ue;const Xe=new Ue.module.GraphicTransformTool({graphic:_,view:O,enableRotation:te,enableScaling:fe,enableZ:Pe,snappingManager:D._snappingManager,tooltipOptions:D.tooltipOptions});D.view.tools.add(Xe),D.updateGraphics.add(_);const st=[],vt=new kp({activeComponent:Xe,tool:w,type:"update",onEnd:()=>{var Ct;st.forEach(Wt=>Wt.remove()),st.length=0,null==(Ct=D.view.tools)||Ct.remove(Xe),Xe.destroyed||Xe.destroy()},undo:()=>{SE(vt,D.updateGraphics.toArray()),D._emitUndoEvent({graphics:D.updateGraphics.toArray(),tool:w})},redo:()=>{RE(vt,D.updateGraphics.toArray()),D._emitRedoEvent({graphics:D.updateGraphics.toArray(),tool:w})},addToSelection:(Ct=(0,Ai.Z)(function*(Wt){D.updateGraphics.add(Wt),D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{added:[Wt],removed:[],type:"selection-change"},type:"update"});const Kt=yield D._setupMove3DOperation(D.updateGraphics.toArray(),v,O,"transform",!0);yl(Kt)||(vt.onEnd(),vt.destroy(),D._setUpdateOperationHandle(Kt,v))}),function(Kt){return Ct.apply(this,arguments)}),removeFromSelection:Ct=>{D.updateGraphics.remove(Ct),D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{added:[],removed:[Ct],type:"selection-change"},type:"update"}),vt.complete()},toggleTool:()=>{}});var Ct;return st.push(...D._getHandlesForComponent(vt,v),D.view.on("immediate-click",Ct=>D._getCommonUpdateOperationClickHandlers(vt,Ct,v),mo.f.WIDGET),O.on("key-down",Ct=>{D._getCommonUpdateOperationKeyDownHandlers(vt,Ct),Ct.key===Vo.j.snappingToggle&&(D.snappingOptions.enabledToggled=!0,Ct.stopPropagation())},mo.f.WIDGET),O.on("key-up",Ct=>{Ct.key===Vo.j.snappingToggle&&(D.snappingOptions.enabledToggled=!1,Ct.stopPropagation())},mo.f.WIDGET)),vt})()}_setupPolyTransform3DOperation(_,v,O,D=!1){var w=this;return(0,Ai.Z)(function*(){const te="transform",{enableRotation:fe,enableScaling:Pe,enableZ:Ue,preserveAspectRatio:Xe}=v,st=yield w._requireModule(Promise.all([T.e(4918),T.e(6777),T.e(4735),T.e(1668),T.e(3792),T.e(61),T.e(5671),T.e(6813),T.e(8592),T.e(2327)]).then(T.bind(T,82327)));if(yl(st))return st;const vt=new st.module.ExtentTransformTool({graphic:_,view:O,enableRotation:fe,enableScaling:Pe,enableZ:Ue,preserveAspectRatio:Xe,tooltipOptions:w.tooltipOptions});w.view.tools.add(vt),D||w.updateGraphics.add(_);const Ct=[],Wt=new kp({activeComponent:vt,tool:te,type:"update",onEnd:()=>{var Kt;Ct.forEach(Lt=>Lt.remove()),Ct.length=0,null==(Kt=w.view.tools)||Kt.remove(vt),vt.destroyed||vt.destroy()},canUndo:()=>vt.canUndo,undo:()=>{vt.undo(),w._emitUndoEvent({graphics:w.updateGraphics.toArray(),tool:te})},canRedo:()=>vt.canRedo,redo:()=>{vt.redo(),w._emitRedoEvent({graphics:w.updateGraphics.toArray(),tool:te})},addToSelection:(Kt=(0,Ai.Z)(function*(Lt){w.updateGraphics.add(Lt),w.emit("update",{graphics:w.updateGraphics.toArray(),state:"active",aborted:!1,tool:w.activeTool,toolEventInfo:{added:[Lt],removed:[],type:"selection-change"},type:"update"});const nr=yield w._setupMove3DOperation(w.updateGraphics.toArray(),v,O,"transform",!0);yl(nr)||(Wt.onEnd(),Wt.destroy(),w._setUpdateOperationHandle(nr,v))}),function(nr){return Kt.apply(this,arguments)}),removeFromSelection:Kt=>{w.updateGraphics.remove(Kt),w.emit("update",{graphics:w.updateGraphics.toArray(),state:"active",aborted:!1,tool:w.activeTool,toolEventInfo:{added:[],removed:[Kt],type:"selection-change"},type:"update"}),Wt.complete()},toggleTool:function(){var Kt=(0,Ai.Z)(function*(){if(1!==w.updateGraphics.length||!1===v.toggleToolOnClick)return;const Lt=w.updateGraphics.getItemAt(0);if((0,DE.P)(Lt)!==Rc.e.SUPPORTED)return;const nr=yield w._setupReshape3DOperation(Lt,v,O,!0);yl(nr)||(Wt.onEnd(),Wt.destroy(),w._setUpdateOperationHandle(nr,v))});return function(){return Kt.apply(this,arguments)}}()});var Kt;return Ct.push(...w._getHandlesForComponent(Wt,v),w.view.on("immediate-click",Kt=>w._getCommonUpdateOperationClickHandlers(Wt,Kt,v),mo.f.WIDGET),w.view.on("key-down",Kt=>w._getCommonUpdateOperationKeyDownHandlers(Wt,Kt),mo.f.WIDGET),w.view.on("key-down",Kt=>{Kt.key!==Vo.j.constraint||Kt.repeat||(vt.preserveAspectRatio=!vt.preserveAspectRatio,Kt.stopPropagation())},mo.f.WIDGET),w.view.on("key-up",Kt=>{Kt.key===Vo.j.constraint&&(vt.preserveAspectRatio=!vt.preserveAspectRatio,Kt.stopPropagation())},mo.f.WIDGET)),Wt})()}_setupMove2DOperation(_,v,O){var D=this;return(0,Ai.Z)(function*(){const w="move";D.updateGraphics.addMany(_),yield D._updateSpatialReference(_);const te=yield D._getGraphicMover(_,v,O);if(yl(te))return te;const fe=new kp({activeComponent:te,tool:w,type:"update",onEnd:()=>{var st;D._displayDefaultCursor(),Xe.forEach(vt=>vt.remove()),Ue.forEach(vt=>vt.remove()),Xe=[],Ue=[],te.destroy(),null==(st=D._internalGraphicsLayer)||st.removeMany([...D.updateGraphics.toArray()])},undo:()=>{const st=D.updateGraphics.toArray();SE(fe,st),fe.refreshComponent(),D._emitUndoEvent({graphics:st,tool:w})},redo:()=>{const st=D.updateGraphics.toArray();RE(fe,st),fe.refreshComponent(),D._emitRedoEvent({graphics:st,tool:w})},addToSelection:(st=(0,Ai.Z)(function*(vt){yield D._updateSpatialReference(vt),D.updateGraphics.push(vt),te.graphics=D.updateGraphics.toArray(),D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{added:[vt],removed:[],type:"selection-change"},type:"update"})}),function(Ct){return st.apply(this,arguments)}),removeFromSelection:st=>{const vt=D.updateGraphics.indexOf(st);fe.history.undo.forEach(Wt=>Wt.updates.splice(vt,1)),fe.history.redo.forEach(Wt=>Wt.updates.splice(vt,1)),D.updateGraphics.remove(st);const Ct=D.updateGraphics.toArray();D.emit("update",{graphics:Ct,state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{added:[],removed:[st],type:"selection-change"},type:"update"}),0!==D.updateGraphics.length?te.graphics=Ct:fe.complete()}});var st;let Pe=!1,Ue=[O.on("immediate-click",st=>D._getCommonUpdateOperationClickHandlers(fe,st,v),mo.f.WIDGET),O.on("key-down",st=>{D._getCommonUpdateOperationKeyDownHandlers(fe,st),st.key!==Vo.j.constraint||st.repeat||(Pe=!0,te.enableMoveAllGraphics=!te.enableMoveAllGraphics)},mo.f.WIDGET),O.on("key-up",st=>{st.key===Vo.j.constraint&&Pe&&(Pe=!1,te.enableMoveAllGraphics=!te.enableMoveAllGraphics)},mo.f.WIDGET)],Xe=D._getHandlesForComponent(fe,v);return fe})()}_setupReshape3DOperation(_,v,O,D=!1){var w=this;return(0,Ai.Z)(function*(){const te="reshape",fe=yield w._requireModule(Promise.all([T.e(4918),T.e(6777),T.e(4735),T.e(1668),T.e(3792),T.e(61),T.e(5671),T.e(6813),T.e(8592),T.e(2327)]).then(T.bind(T,82327)));if(yl(fe))return fe;w.snappingOptions.enabledToggled=!1;const Pe=new fe.module.GraphicReshapeTool({view:O,graphic:_,enableZVertex:v.enableZ&&"move"===v.reshapeOptions.vertexOperation,enableZShape:v.enableZ&&"move"===v.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===v.reshapeOptions.shapeOperation||"move-xy"===v.reshapeOptions.shapeOperation,enableMidpoints:"split"===v.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===v.reshapeOptions.edgeOperation,snappingManager:w._snappingManager,labelOptions:w.labelOptions,tooltipOptions:w.tooltipOptions});O.tools.add(Pe),D||w.updateGraphics.add(_);const Ue=[],Xe=new kp({activeComponent:Pe,tool:te,type:"update",onEnd:()=>{var st;Ue.forEach(vt=>vt.remove()),Ue.length=0,null==(st=w.view.tools)||st.remove(Pe),Pe.destroyed||Pe.destroy()},canUndo:()=>Pe.canUndo,undo:()=>{Pe.undo(),w._emitUndoEvent({graphics:w.updateGraphics.toArray(),tool:te})},canRedo:()=>Pe.canRedo,redo:()=>{Pe.redo(),w._emitRedoEvent({graphics:w.updateGraphics.toArray(),tool:te})},addToSelection:(st=(0,Ai.Z)(function*(vt){w.updateGraphics.add(vt),w.emit("update",{graphics:w.updateGraphics.toArray(),state:"active",aborted:!1,tool:w.activeTool,toolEventInfo:{added:[vt],removed:[],type:"selection-change"},type:"update"});const Ct=yield w._setupMove3DOperation(w.updateGraphics.toArray(),v,O,"transform",!0);yl(Ct)||(Xe.onEnd(),Xe.destroy(),w._setUpdateOperationHandle(Ct,v))}),function(Ct){return st.apply(this,arguments)}),removeFromSelection:st=>{w.updateGraphics.remove(st),w.emit("update",{graphics:w.updateGraphics.toArray(),state:"active",aborted:!1,tool:w.activeTool,toolEventInfo:{added:[],removed:[st],type:"selection-change"},type:"update"}),Xe.complete()},toggleTool:function(){var st=(0,Ai.Z)(function*(){if(!1===v.toggleToolOnClick)return;const vt=yield w._setupGraphicTransform3DOperation(w.updateGraphics.toArray(),v,O,!0);yl(vt)||(Xe.onEnd(),Xe.destroy(),w._setUpdateOperationHandle(vt,v))});return function(){return st.apply(this,arguments)}}()});var st;return Ue.push(...w._getHandlesForComponent(Xe,v),O.on("immediate-click",st=>w._getCommonUpdateOperationClickHandlers(Xe,st,v),mo.f.WIDGET),O.on("key-down",st=>{w._getCommonUpdateOperationKeyDownHandlers(Xe,st),st.key===Vo.j.snappingToggle&&(w.snappingOptions.enabledToggled=!0,st.stopPropagation())},mo.f.WIDGET),O.on("key-up",st=>{st.key===Vo.j.snappingToggle&&(w.snappingOptions.enabledToggled=!1,st.stopPropagation())},mo.f.WIDGET)),Xe})()}_setupTransformOrReshape2DOperation(_,v,O,D){var w=this;return(0,Ai.Z)(function*(){w.updateGraphics.addMany(_),yield w._updateSpatialReference(_);const te="transform"===v?yield w._getBox(_,O,D):yield w._getReshape(_,O,D);if(yl(te))return te;const fe=new kp({activeComponent:te,type:"update",onEnd:()=>{Ue.forEach(Xe=>Xe.remove()),Pe.forEach(Xe=>Xe.remove()),Ue=[],Pe=[],fe.activeComponent&&!fe.activeComponent.destroyed&&fe.activeComponent.destroy(),w._internalGraphicsLayer.removeMany(w.updateGraphics.toArray())},undo:()=>{SE(fe,w.updateGraphics.toArray()),fe.refreshComponent(),w._emitUndoEvent({graphics:w.updateGraphics.toArray(),tool:fe.tool})},redo:()=>{RE(fe,w.updateGraphics.toArray()),fe.refreshComponent(),w._emitRedoEvent({graphics:w.updateGraphics.toArray(),tool:fe.tool})},addToSelection:(Xe=(0,Ai.Z)(function*(st){let vt=fe.activeComponent;if("reshape"===vt.type){const Ct=[...w.updateGraphics,st];w.updateGraphics.removeAll();const Wt=yield w._setupMove2DOperation(Ct,O,D);if(yl(Wt))return;fe.onEnd(),fe.destroy(),w._setUpdateOperationHandle(Wt,O)}else w.updateGraphics.add(st),vt.graphics=w.updateGraphics.toArray(),vt.refresh(),fe.resetHistory();w.emit("update",{graphics:w.updateGraphics.toArray(),state:"active",aborted:!1,tool:w.activeTool,toolEventInfo:{added:[st],removed:[],type:"selection-change"},type:"update"})}),function(vt){return Xe.apply(this,arguments)}),removeFromSelection:function(){var Xe=(0,Ai.Z)(function*(st){const vt=w.updateGraphics.indexOf(st);fe.history.undo.forEach(Wt=>Wt.updates.splice(vt,1)),fe.history.redo.forEach(Wt=>Wt.updates.splice(vt,1)),w.updateGraphics.remove(st);const Ct=w.updateGraphics.toArray();if(0===Ct.length)fe.complete();else{const Wt=Ct[0].geometry;1!==Ct.length||!(0,lt.pC)(Wt)||"point"!==Wt.type&&"multipoint"!==Wt.type?fe.activeComponent.graphics=Ct:fe.toggleTool()}w.emit("update",{graphics:Ct,state:"active",aborted:!1,tool:w.activeTool,toolEventInfo:{added:[],removed:[st],type:"selection-change"},type:"update"})});return function(vt){return Xe.apply(this,arguments)}}(),toggleTool:function(){var Xe=(0,Ai.Z)(function*(){if(w.updateGraphics.length>1)return;const st=w.updateGraphics.getItemAt(0),vt=st.geometry;if((0,lt.pC)(vt)&&("reshape"===fe.tool&&("point"===vt.type||"multipoint"===vt.type)||"transform"===fe.tool&&"extent"===vt.type))return;let Ct=null;"transform"===fe.tool?Ct=yield w._getReshape([st],O,D):"reshape"===fe.tool&&(Ct=yield w._getBox([st],O,D)),yl(Ct)||(fe.activeComponent.destroy(),fe.activeComponent=Ct,fe.activeComponent&&(Ue.forEach(Wt=>Wt.remove()),Ue=w._getHandlesForComponent(fe,O)))});return function(){return Xe.apply(this,arguments)}}()});var Xe;let Pe=[D.on("immediate-click",Xe=>w._getCommonUpdateOperationClickHandlers(fe,Xe,O),mo.f.WIDGET),D.on("key-down",Xe=>{if(w._getCommonUpdateOperationKeyDownHandlers(fe,Xe),Xe.key!==Vo.j.snappingToggle||Xe.repeat||(w.snappingOptions.enabledToggled=!0,Xe.stopPropagation()),Xe.key===Vo.j.constraint&&!Xe.repeat&&fe){const st=fe.activeComponent;st&&"box"===st.type&&(st.preserveAspectRatio=!st.preserveAspectRatio)}},mo.f.WIDGET),D.on("key-up",Xe=>{var st;if(Xe.key===Vo.j.snappingToggle&&"reshape"===(null==(st=null==fe?void 0:fe.activeComponent)?void 0:st.type)&&(w.snappingOptions.enabledToggled=!1,Xe.stopPropagation()),Xe.key===Vo.j.constraint&&fe){const vt=fe.activeComponent;vt&&"box"===vt.type&&(vt.preserveAspectRatio=!vt.preserveAspectRatio)}},mo.f.WIDGET)],Ue=w._getHandlesForComponent(fe,O);return fe})()}_getGraphicMover(_,v,O){var D=this;return(0,Ai.Z)(function*(){const{enableMoveAllGraphics:w}=v,te=yield D._requireModule(T.e(9119).then(T.bind(T,9119)));return yl(te)?te:new te.module.default({enableMoveAllGraphics:w,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:_,view:O,callbacks:{onGraphicMoveStart:({dx:fe,dy:Pe,graphic:Ue})=>{D._displayGrabbingCursor(),D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{dx:fe,dy:Pe,mover:Ue,type:"move-start"},type:"update"})},onGraphicMove:({dx:fe,dy:Pe,graphic:Ue})=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{dx:fe,dy:Pe,mover:Ue,type:"move"},type:"update"}),onGraphicMoveStop:({dx:fe,dy:Pe,graphic:Ue})=>{D._displayPointerCursor(),D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{dx:fe,dy:Pe,mover:Ue,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>D._displayPointerCursor(),onGraphicPointerOut:()=>D._displayDefaultCursor()}})})()}_getBox(_,v,O){var D=this;return(0,Ai.Z)(function*(){const{enableRotation:w,enableScaling:te,preserveAspectRatio:fe}=v,Pe=yield D._requireModule(Promise.all([T.e(9119),T.e(8592),T.e(878)]).then(T.bind(T,878)));return yl(Pe)?Pe:new Pe.module.default({graphics:_,enableRotation:w,enableScaling:te,preserveAspectRatio:fe,layer:D._internalGraphicsLayer,view:O,callbacks:{onMoveStart:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"}),onMove:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"}),onMoveStop:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"}),onScaleStart:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"}),onScale:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"}),onScaleStop:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"}),onRotateStart:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"}),onRotate:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"}),onRotateStop:Ue=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Ue),type:"update"})}})})()}_getReshape(_,v,O){var D=this;return(0,Ai.Z)(function*(){var Pe,Ue;const w="split"===(null==(Pe=v.reshapeOptions)?void 0:Pe.edgeOperation),te="move"===(null==(Ue=v.reshapeOptions)?void 0:Ue.shapeOperation),fe=yield D._requireModule(Promise.all([T.e(6777),T.e(9119),T.e(8592),T.e(1303)]).then(T.bind(T,30120)));return yl(fe)?fe:new fe.module.default({enableMidpoints:w,enableMovement:te,graphic:_[0],layer:D._internalGraphicsLayer,snappingManager:D._snappingManager,view:O,callbacks:{onReshapeStart:Xe=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Xe),type:"update"}),onReshape:Xe=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:or({},Xe),type:"update"}),onReshapeStop:({mover:Xe,type:st})=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{mover:Xe,type:st},type:"update"}),onMoveStart:({dx:Xe,dy:st,mover:vt,type:Ct})=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{dx:Xe,dy:st,mover:vt,type:Ct},type:"update"}),onMove:({dx:Xe,dy:st,mover:vt,type:Ct})=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{dx:Xe,dy:st,mover:vt,type:Ct},type:"update"}),onMoveStop:({dx:Xe,dy:st,mover:vt,type:Ct})=>D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{dx:Xe,dy:st,mover:vt,type:Ct},type:"update"}),onVertexAdd:({added:Xe,type:st,vertices:vt})=>{const Ct=Xe.map(Wt=>(0,JD.nA)(Wt.geometry));D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{added:Ct,vertices:vt,type:st},type:"update"})},onVertexRemove:({removed:Xe,type:st,vertices:vt})=>{const Ct=Xe.map(Wt=>(0,JD.nA)(Wt.geometry));D.emit("update",{graphics:D.updateGraphics.toArray(),state:"active",aborted:!1,tool:D.activeTool,toolEventInfo:{removed:Ct,vertices:vt,type:st},type:"update"})}}})})()}_getHandlesForComponent(_,v){const O=_.activeComponent;switch(O.type){case"graphic-mover":return[O.on("graphic-click",({graphic:D,viewEvent:w})=>{var te;(null==(te=w.native)?void 0:te.shiftKey)&&(w.stopPropagation(),_.removeFromSelection(D))}),O.on("graphic-move-start",D=>_.addToHistory(Yp(D.allGraphics)))];case"box":return[O.on("graphic-click",D=>this._onTransformOrReshape2DGraphicClick(_,v,D)),O.on("move-start",D=>_.addToHistory(Yp(D.graphics))),O.on("rotate-start",D=>_.addToHistory(Yp(D.graphics))),O.on("scale-start",D=>_.addToHistory(Yp(D.graphics)))];case"reshape":return[O.on("graphic-click",D=>this._onTransformOrReshape2DGraphicClick(_,v,D)),O.on("move-start",D=>_.addToHistory(Yp([D.mover]))),O.on("reshape-start",D=>_.addToHistory(Yp([D.graphic]))),O.on("vertex-add",D=>_.addToHistory(Yp([D.oldGraphic]))),O.on("vertex-remove",D=>_.addToHistory(Yp([D.oldGraphic])))];case"move-3d":return[O.on("graphic-move-start",D=>{_.addToHistory(Yp(D.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:D.allGraphics.length>0?D.allGraphics[0]:null,type:"move-start"},type:"update"})}),O.on("graphic-move",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:D.dx,dy:D.dy,mover:D.allGraphics.length>0?D.allGraphics[0]:null,type:"move"},type:"update"})}),O.on("graphic-move-stop",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:D.allGraphics.length>0?D.allGraphics[0]:null,type:"move-stop"},type:"update"})}),O.on("immediate-click",D=>{D.shiftKey?this._toggleSelection([D.graphic],_,v):_.toggleTool()})];case"transform-3d":return[O.on("record-undo",({record:D})=>{_.addToHistory({updates:[D]})}),O.on("graphic-translate-start",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,dx:D.dxScreen,dy:D.dyScreen,type:"move-start"},type:"update"})}),O.on("graphic-translate-stop",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,dx:D.dxScreen,dy:D.dyScreen,type:"move-stop"},type:"update"})}),O.on("graphic-rotate-start",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,angle:D.angle,type:"rotate-start"},type:"update"})}),O.on("graphic-rotate-stop",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,angle:D.angle,type:"rotate-stop"},type:"update"})}),O.on("graphic-scale-start",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,xScale:D.xScale,yScale:D.yScale,type:"scale-start"},type:"update"})}),O.on("graphic-scale-stop",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,xScale:D.xScale,yScale:D.yScale,type:"scale-stop"},type:"update"})}),O.on("graphic-translate",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,dx:D.dxScreen,dy:D.dyScreen,type:"move"},type:"update"})}),O.on("graphic-rotate",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,angle:D.angle,type:"rotate"},type:"update"})}),O.on("graphic-scale",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:D.graphic,xScale:D.xScale,yScale:D.yScale,type:"scale"},type:"update"})}),O.on("immediate-click",D=>{D.shiftKey?this._toggleSelection([D.graphic],_,v):_.toggleTool()})];case"reshape-3d":return[O.on("reshape",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:D,type:"update"})}),O.on("move",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:D,type:"update"})}),O.on("vertex-add",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:D,type:"update"})}),O.on("vertex-remove",D=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:D,type:"update"})}),O.on("immediate-click",D=>{D.shiftKey?this._toggleSelection([D.graphic],_,v):_.toggleTool()})];default:return}}_onTransformOrReshape2DGraphicClick(_,v,O){var te;const{graphic:D,viewEvent:w}=O;return(null==(te=w.native)?void 0:te.shiftKey)&&D.layer===this.layer?(w.stopPropagation(),_.removeFromSelection(D)):v.toggleToolOnClick?(w.stopPropagation(),_.toggleTool()):void 0}_setUpdateOperationHandle(_,v){this._operationHandle=_;const O=this.view.map;this._disablePopup(v),_.on("complete",()=>{if(_===this._operationHandle){const w=this.updateGraphics.toArray(),te=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),O&&O.remove(this._internalGraphicsLayer),this._restorePopup(v),this.emit("update",{graphics:w,state:"complete",aborted:_.cancelled,tool:te,toolEventInfo:null,type:"update"})}})}_getCommonUpdateOperationClickHandlers(_,v,O){var D=this;return(0,Ai.Z)(function*(){const w=(0,na.vT)(v),te=yield v.async(()=>D._getFirstHit(w));(0,lt.Wi)(te)?_.complete():v.native.shiftKey&&D._toggleSelection([te.graphic],_,O)||D.updateGraphics.includes(te.graphic)?v.stopPropagation():_.complete()})()}_toggleSelection(_,v,O){const D=!!O.multipleSelectionEnabled;return _.some(w=>null!=w&&!(!D||w.layer!==this.layer)&&(this.updateGraphics.includes(w)?v.removeFromSelection(w):v.addToSelection(w),!0))}_getCommonUpdateOperationKeyDownHandlers(_,v){if(!_)return;const O=v.key;O===Vo.j.undo&&_.canUndo()?(v.stopPropagation(),_.undo()):O===Vo.j.redo&&_.canRedo()?(v.stopPropagation(),_.redo()):O===Vo.j.cancel?(v.stopPropagation(),_.cancel()):this.allowDeleteKey&&Vo.j.delete.includes(O)&&this._onDeleteKey(v)}_onDeleteKey(_){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const v=this.activeComponent,O=this.updateGraphics.toArray();(0,lt.Wi)(v)||"reshape-3d"===v.type||("reshape"!==v.type||1===O.length&&"point"===(0,lt.U2)(O[0].geometry,"type"))&&(_.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=(0,lt.SC)(this._internalGraphicsLayer))}_isComponentGraphic(_){const{activeComponent:v}=this;return!(!_||(0,lt.Wi)(v))&&(_.attributes&&_.attributes.esriSketchTool||"draw-2d"===v.type&&v.graphic===_||("box"===v.type||"reshape"===v.type)&&v.isUIGraphic(_))}_displayPointerCursor(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)}_logError(_,v,O){lN.error(new Ls.Z(_,v,O))}_requireModule(_){var v=this;return(0,Ai.Z)(function*(){const O=new AbortController;v._moduleLoaderAbortController=O;const D=yield _;return v._moduleLoaderAbortController!==O||O.signal.aborted?{requireError:"aborted"}:{module:D}})()}_emitUndoEvent(_){this.emit("undo",yi(or({},_),{type:"undo"}))}_emitRedoEvent(_){this.emit("redo",yi(or({},_),{type:"redo"}))}_emitDeleteEvent(_){this.emit("delete",yi(or({},_),{type:"delete"}))}get test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:AE}}wait(){return(0,pt.N1)(()=>!this.updating)}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(_){var v;return"3d"!==(null==(v=this.view)?void 0:v.type)||this.updateOnGraphicClick||(0,lt.pC)(_)&&_.toggleToolOnClick}_disablePopup(_){if(!this._disablePopupEnabled(_))return;const v=this.view.popup;v&&(0,lt.Wi)(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=v.autoOpenEnabled,v.autoOpenEnabled=!1)}_restorePopup(_){if(!this._disablePopupEnabled(_))return;const v=this.view.popup;v&&(0,lt.pC)(this._originalAutoOpenEnabled)&&(v.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)}_waitViewReady(){var _=this;return(0,Ai.Z)(function*(){const v=_.view;v&&((0,lt.IM)(_._viewReadyAbortController),_._viewReadyAbortController=new AbortController,yield(0,zi.Hl)((0,pt.N1)(()=>null==v?void 0:v.ready),_._viewReadyAbortController.signal))})()}};function cN(_){return"polygon"===_||"rectangle"===_||"circle"===_}function SE(_,v){sA("undo",_.history.undo,_.history.redo,v)}function RE(_,v){sA("redo",_.history.redo,_.history.undo,v)}function sA(_,v,O,D){const w=v.pop().updates,te=[];D.forEach((fe,Pe)=>{const Ue=w[Pe];null!=Ue&&("geometry"in Ue&&(0,lt.pC)(Ue.geometry)&&(te.push({geometry:fe.geometry}),fe.geometry=Ue.geometry),"symbol"in Ue&&(0,lt.pC)(Ue.symbol)&&(te.push({symbol:fe.symbol}),fe.symbol=Ue.symbol),"undo"in Ue&&(te.push(Ue),Ue[_](fe)))}),O.push({updates:te})}function Yp(_){return{updates:_.map(v=>({geometry:v.geometry}))}}function yl(_){return"requireError"in _&&"aborted"===_.requireError}(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"_operationHandle",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Zo.prototype,"activeTool",null),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"activeFillSymbol",void 0),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"activeLineSymbol",void 0),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"activeVertexSymbol",void 0),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"allowDeleteKey",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Zo.prototype,"createGraphic",null),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"defaultCreateOptions",null),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"defaultUpdateOptions",null),(0,Ze._)([(0,nt.Cb)({type:qD.Z,nonNullable:!0})],Zo.prototype,"labelOptions",void 0),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"layer",void 0),(0,Ze._)([(0,nt.Cb)({types:Ff.LB})],Zo.prototype,"pointSymbol",void 0),(0,Ze._)([(0,nt.Cb)({types:Ff.LB})],Zo.prototype,"polygonSymbol",void 0),(0,Ze._)([(0,nt.Cb)({types:Ff.LB})],Zo.prototype,"polylineSymbol",void 0),(0,Ze._)([(0,nt.Cb)({type:tA.Z,nonNullable:!0})],Zo.prototype,"snappingOptions",null),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"_snappingManager",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Zo.prototype,"state",null),(0,Ze._)([(0,nt.Cb)({type:eA.Z,nonNullable:!0})],Zo.prototype,"tooltipOptions",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Zo.prototype,"updateGraphics",void 0),(0,Ze._)([(0,nt.Cb)()],Zo.prototype,"updateOnGraphicClick",void 0),(0,Ze._)([(0,nt.Cb)({types:Ff.LB})],Zo.prototype,"updatePointSymbol",void 0),(0,Ze._)([(0,nt.Cb)({types:Ff.LB})],Zo.prototype,"updatePolygonSymbol",void 0),(0,Ze._)([(0,nt.Cb)({types:Ff.LB})],Zo.prototype,"updatePolylineSymbol",void 0),(0,Ze._)([(0,nt.Cb)({types:Ff.LB})],Zo.prototype,"vertexSymbol",void 0),(0,Ze._)([(0,nt.Cb)({value:null})],Zo.prototype,"view",null),Zo=(0,Ze._)([(0,ui.j)(rA)],Zo);const uN=Zo;var nA=T(13065);const nf="esri-weather",Xh={base:nf,esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",widgetIcon:"esri-icon-partly-cloudy",content:`${nf}__content`,hasError:`${nf}__content--has-error`,selector:`${nf}__selector`,options:`${nf}__options`,error:`${nf}__error`,warning:`${nf}__warning`},pN={base:`${nf}__labeled-slider`};var Qh,ph;(function(_){_.Disabled="disabled",_.Ready="ready",_.Error="error"})(Qh||(Qh={})),function(_){_.NotVisible="not-visible",_.LocalScene="local-scene",_.NoAtmosphere="no-atmosphere",_.UnsupportedView="unsupported-view"}(ph||(ph={}));let ld=class extends wu.Z{constructor(_){super(_),this.debounceDelay=200,this._onChangeTimeout=null,this._onChangeDebounced=v=>{const O=v.target.value;this._cancelChange(),this._onChangeTimeout=setTimeout(()=>this.onChange(O),this.debounceDelay)},this._cancelChange=()=>{(0,lt.pC)(this._onChangeTimeout)&&(clearTimeout(this._onChangeTimeout),this._onChangeTimeout=null)}}initialize(){this.own([(0,pt.YP)(()=>this.onChange,()=>{this._cancelChange()})])}render(){const{label:_,disabled:v}=this;return(0,pi.u)("div",{class:pN.base},(0,pi.u)("calcite-label",{scale:"s",disabled:v},_,(0,pi.u)("calcite-slider",{"aria-label":_,disabled:this.disabled,max:1,min:0,step:.01,value:this.value,onCalciteSliderInput:this._onChangeDebounced,onCalciteSliderChange:this._onChangeDebounced})))}destroy(){this._cancelChange()}loadDependencies(){return(0,Ai.Z)(function*(){yield Promise.all([T.e(797),T.e(8592),T.e(7914)]).then(T.bind(T,7914))})()}};(0,Ze._)([(0,nt.Cb)()],ld.prototype,"value",void 0),(0,Ze._)([(0,nt.Cb)()],ld.prototype,"onChange",void 0),(0,Ze._)([(0,nt.Cb)()],ld.prototype,"disabled",void 0),(0,Ze._)([(0,nt.Cb)()],ld.prototype,"debounceDelay",void 0),ld=(0,Ze._)([(0,ui.j)("esri.widgets.Weather.LabeledSlider")],ld);let wE=class extends Bi.Z{constructor(){super(...arguments),this.header=!0}};(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0})],wE.prototype,"header",void 0),wE=(0,Ze._)([(0,ui.j)("esri.widgets.Weather.VisibleElements")],wE);const oA=wE,fN=pn.Z.getLogger("esri.widgets.Weather.WeatherViewModel");let of=class extends Bi.Z{constructor(_){super(_),this.view=null,this._handles=new cn.Z,this._settingWeather=!1,this._weatherByType={sunny:new Zu,cloudy:new Eu,rainy:new $u,snowy:new vm,foggy:new gf}}initialize(){this._handles.add([(0,pt.YP)(()=>this.current,_=>{this._settingWeather||(0,lt.Wi)(_)||(this._weatherByType=yi(or({},this._weatherByType),{[_.type]:_}))},pt.tX)])}destroy(){this._handles=(0,lt.SC)(this._handles)}get state(){const _=this.view;return(0,lt.Wi)(_)||!_.ready?Qh.Disabled:(0,lt.pC)(this.error)?this.error===ph.NotVisible?Qh.Ready:Qh.Error:Qh.Ready}get error(){const _=this.view;return(0,lt.Wi)(_)||!_.ready?null:"3d"!==_.type?ph.UnsupportedView:"local"===_.viewingMode?ph.LocalScene:_.environment.atmosphereEnabled?_.environmentManager.weatherVisible?null:ph.NotVisible:ph.NoAtmosphere}get current(){const _=(0,lt.yw)(this._environment,v=>v.weather);return(0,lt.Pt)(_,this._weatherByType.sunny)}set current(_){(0,lt.yw)(this._environment,v=>v.weather=_)}get test(){return or({},this._weatherByType)}get _environment(){const _=this.view;return(0,lt.pC)(_)&&"3d"===_.type?_.environment:null}setWeatherByType(_){if(!xl(_,fN))return;const v=this._environment;(0,lt.pC)(v)&&(this._settingWeather=!0,v.weather=this._weatherByType[_],this._settingWeather=!1)}setSnowCoverEnabled(_){const v=this.current;"snowCover"in v&&(v.snowCover=_?"enabled":"disabled")}};(0,Ze._)([(0,nt.Cb)()],of.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)()],of.prototype,"state",null),(0,Ze._)([(0,nt.Cb)()],of.prototype,"error",null),(0,Ze._)([(0,nt.Cb)()],of.prototype,"current",null),(0,Ze._)([(0,nt.Cb)()],of.prototype,"_environment",null),of=(0,Ze._)([(0,ui.j)("esri.widgets.Weather.WeatherViewModel")],of);const _N=of,mN={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let Id=class extends wu.Z{constructor(_){super(_),this.viewModel=new _N,this.headingLevel=4,this.visibleElements=new oA,this.iconClass=Xh.widgetIcon,this.label=void 0,this._renderWeatherTypeButton=v=>{const O=this.viewModel,D=this.messages[v].label,w=O.state===Qh.Disabled,te=!w&&O.current.type===v;return(0,pi.u)("calcite-button",{appearance:te?"solid":"outline","aria-checked":te?"true":"false",color:te?"blue":"neutral",disabled:w,"icon-start":mN[v],key:`${v}-type-button`,label:D,role:"radio",scale:"l",title:D,onclick:()=>{te||O.setWeatherByType(v)}})},this._memoizedCallbacks=function dN(_){let v,O,D=[],w=!1;return function te(...fe){return w&&v===this&&function hN(_,v){if(_.length!==v.length)return!1;for(let O=0;O<_.length;++O)if(_[O]!==v[O])return!1;return!0}(fe,D)||(O=_.apply(this,fe),v=this,D=fe,w=!0),O}}(v=>({onCloudCoverChange:O=>{"cloudCover"in v&&(v.cloudCover=O)},onPrecipitationChange:O=>{"precipitation"in v&&(v.precipitation=O)},onFogStrengthChange:O=>{"fogStrength"in v&&(v.fogStrength=O)},onSnowCoverChange:O=>{this.viewModel.setSnowCoverEnabled(O.target.checked)}}))}render(){return(0,pi.u)("div",{class:this.classes(Xh.base,Xh.esriWidget,this.viewModel.state===Qh.Disabled&&Xh.esriWidgetDisabled),role:"region","aria-label":this.messages.widgetLabelAccessible},this._renderContent())}loadDependencies(){return(0,Ai.Z)(function*(){yield Promise.all([Promise.all([T.e(797),T.e(8592),T.e(5857)]).then(T.bind(T,65857)),Promise.all([T.e(797),T.e(9488)]).then(T.bind(T,59488)),Promise.all([T.e(8592),T.e(508)]).then(T.bind(T,46794)),T.e(9749).then(T.bind(T,79749)),Promise.all([T.e(797),T.e(8592),T.e(7914)]).then(T.bind(T,7914))])})()}get view(){var _;return null==(_=this.viewModel)?void 0:_.view}set view(_){this.viewModel&&(this.viewModel.view=_)}get _errorMessage(){const _=this.messages.error;switch(this.viewModel.error){case ph.LocalScene:return _.localScene;case ph.NoAtmosphere:return _.noAtmosphere;case ph.UnsupportedView:return _.unsupported;default:return null}}get _warningMessage(){var _;return this.viewModel.error===ph.NotVisible&&(0,lt.pC)(this.view)&&"3d"===(null==(_=this.view)?void 0:_.type)&&this.view.environment.atmosphereEnabled?this.messages.error.notVisible:null}_renderContent(){const _=this.messages,v=this._warningMessage,O=this.viewModel.state===Qh.Error;return(0,pi.u)(pi.D,null,this.visibleElements.header&&(0,pi.u)(nA.X6,{level:this.headingLevel},_.widgetLabel),O&&(0,pi.u)("div",{key:"error",class:Xh.error},this._errorMessage),(0,pi.u)("div",{key:"content",class:(0,Nl.Sh)({[Xh.content]:!0,[Xh.hasError]:O})},(0,pi.u)("div",{class:Xh.selector,role:"radiogroup","aria-label":_.weatherType},fl.map(this._renderWeatherTypeButton)),(0,pi.u)("div",{class:Xh.options},this._renderOptions()),(0,lt.pC)(v)&&this._renderWarning(v)))}_renderOptions(){const{viewModel:_,messages:v}=this,O=_.state===Qh.Disabled,D=_.current,w=this._memoizedCallbacks(D);switch(D.type){case"sunny":return(0,pi.u)(ld,{key:"sunny-cover",disabled:O,label:v.sunny.cloudCover,value:D.cloudCover,onChange:w.onCloudCoverChange});case"cloudy":return(0,pi.u)(ld,{key:"cloudy-cover",disabled:O,label:v.cloudy.cloudCover,value:D.cloudCover,onChange:w.onCloudCoverChange});case"rainy":return(0,pi.u)(pi.D,null,(0,pi.u)(ld,{key:"rainy-cover",disabled:O,label:v.rainy.cloudCover,value:D.cloudCover,onChange:w.onCloudCoverChange}),(0,pi.u)(ld,{key:"rainy-precipitation",disabled:O,debounceDelay:0,label:v.rainy.precipitation,value:D.precipitation,onChange:w.onPrecipitationChange}));case"snowy":return(0,pi.u)(pi.D,null,(0,pi.u)(ld,{key:"snowy-cloud-cover",disabled:O,label:v.snowy.cloudCover,value:D.cloudCover,onChange:w.onCloudCoverChange}),(0,pi.u)(ld,{key:"snowy-precipitation",disabled:O,debounceDelay:0,label:v.snowy.precipitation,value:D.precipitation,onChange:w.onPrecipitationChange}),(0,pi.u)("calcite-label",{key:"snow-cover",scale:"s",disabled:O,layout:"inline",title:v.snowy.snowCoverTooltip},(0,pi.u)("calcite-checkbox",{checked:"enabled"===D.snowCover,onCalciteCheckboxChange:w.onSnowCoverChange}),v.snowy.snowCover));case"foggy":return(0,pi.u)(ld,{key:"foggy-cover",disabled:O,debounceDelay:0,label:v.foggy.fogStrength,value:D.fogStrength,onChange:w.onFogStrengthChange})}}_renderWarning(_){return(0,pi.u)("div",{key:"warning",class:Xh.warning},(0,pi.u)("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),_)}};(0,Ze._)([(0,nt.Cb)()],Id.prototype,"viewModel",void 0),(0,Ze._)([(0,nt.Cb)()],Id.prototype,"view",null),(0,Ze._)([(0,nt.Cb)()],Id.prototype,"headingLevel",void 0),(0,Ze._)([(0,nt.Cb)({type:oA,nonNullable:!0})],Id.prototype,"visibleElements",void 0),(0,Ze._)([(0,nt.Cb)()],Id.prototype,"iconClass",void 0),(0,Ze._)([(0,Ss.B)("messages.widgetLabel",{overridable:!0})],Id.prototype,"label",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Weather/t9n/Weather")],Id.prototype,"messages",void 0),(0,Ze._)([(0,nt.Cb)()],Id.prototype,"_errorMessage",null),(0,Ze._)([(0,nt.Cb)()],Id.prototype,"_warningMessage",null),Id=(0,Ze._)([(0,ui.j)("esri.widgets.Weather")],Id);const gN=Id,qh="esri-daylight",KC=`${qh}__container`,Ma={base:qh,widgetIcon:"esri-icon-environment-settings",widget:"esri-widget",select:"esri-select",pause:"esri-icon-pause",play:"esri-icon-play",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",sliderAmPmOn:"esri-slider--ampm-on",sliderAlignLeft:"esri-slider--align-left",sliderAlignRight:"esri-slider--align-right",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",secondaryTick:"secondary-tick",dayContainer:`${KC} ${qh}__day-container`,dateContainer:`${KC} ${qh}__date-container`,containerDisabled:`${KC}--disabled`,playPauseButton:`${qh}__play-pause-button`,seasonPicker:`${qh}__season-picker`,seasonPickerDisabled:`${qh}__season-picker--disabled`,panelError:`${qh}__panel--error`,sunLightingCheckbox:`${qh}__sun-lighting-checkbox`,shadowsCheckbox:`${qh}__shadows-checkbox`};var ep,fh=T(28170);!function(_){_[_.NORTHERN=0]="NORTHERN",_[_.SOUTHERN=1]="SOUTHERN"}(ep||(ep={}));const yN={spring:{dayOfMonth:20,month:2},summer:{dayOfMonth:21,month:5},fall:{dayOfMonth:23,month:8},winter:{dayOfMonth:21,month:11}},ZC=["spring","summer","fall","winter"];function Kg(_,v,O){const D=$C(v,O),{dayOfMonth:w,month:te}=yN[D],fe=new Date(_.getTime());return fe.setMonth(te,w),fe}function $C(_,v){return v===ep.NORTHERN?_:function bN(_){const v=ZC.indexOf(_);return ZC[(v+2)%4]}(_)}const aA="esri.widgets.Slider.SliderViewModel",ON=pn.Z.getLogger(aA);let nu=class extends Bi.Z{constructor(_){super(_),this.precision=4,this.thumbsConstrained=!0}set effectiveMax(_){this.setEffectiveMax(_)}set effectiveMin(_){this.setEffectiveMin(_)}set labelFormatFunction(_){this._set("labelFormatFunction",_)}set inputFormatFunction(_){this._set("inputFormatFunction",_)}set inputParseFunction(_){this._set("inputParseFunction",_)}get labels(){const{max:_,min:v,values:O}=this,D=O&&O.length?O.map((w,te)=>this.getLabelForValue(w,"value",te)):[];return{max:this.getLabelForValue(_,"max"),min:this.getLabelForValue(v,"min"),values:D}}set max(_){this.setMax(_)}set min(_){this.setMin(_)}get state(){const{max:_,min:v}=this;return(0,lt.pC)(_)&&(0,lt.pC)(v)&&_>v?"ready":"disabled"}set values(_){const{max:v,min:O}=this,D=this.values;D&&_&&D.length===_.length&&D.every((w,te)=>w===_[te])||(this._set("values",null),_&&_.length&&((0,lt.pC)(O)&&_.some(w=>w<O)&&(this.min=Math.min(..._)),(0,lt.pC)(v)&&_.some(w=>w>v)&&(this.max=Math.max(..._))),this._set("values",_))}toPrecision(_){return parseFloat(_.toFixed(this.precision))}defaultLabelFormatFunction(_){const{max:v,min:O,precision:D}=this;return parseFloat(_.toFixed(v-O>10?2:D)).toString()}defaultInputFormatFunction(_){return _.toString()}defaultInputParseFunction(_){return parseFloat(_)}getBounds(){const{effectiveMax:_,effectiveMin:v,max:O,min:D}=this;return{min:(0,lt.pC)(v)?Math.max(D,v):D,max:(0,lt.pC)(_)?Math.min(O,_):O}}getBoundsForValueAtIndex(_){const{thumbsConstrained:v,values:O}=this,{min:D,max:w}=this.getBounds();if(v){const te=_-1,fe=_+1;return{min:(0,lt.pC)(O[te])?O[te]:D,max:(0,lt.pC)(O[fe])?O[fe]:w}}return{min:D,max:w}}getLabelForValue(_,v,O){return(0,lt.Wi)(_)?null:this.labelFormatFunction?this.labelFormatFunction(_,v,O):this.defaultLabelFormatFunction(_)}setMax(_){const{max:v,values:O}=this;if(isNaN(_))return void this._logError("slider:invalid-value","Supplied value for property 'max' is NaN.");if(null===_)return void this._set("max",null);const D=this.toPrecision(_);if(v!==D&&(this._set("max",D),O&&O.length))for(let w=0;w<O.length;w++)D<O[w]&&this.setValue(w,D)}setMin(_){const{min:v,values:O}=this;if(isNaN(_))return void this._logError("slider:invalid-value","Supplied value for property 'min' is NaN.");if(null===_)return void this._set("min",null);const D=this.toPrecision(_);if(v!==D&&(this._set("min",D),O&&O.length))for(let w=0;w<O.length;w++)D>O[w]&&this.setValue(w,D)}setEffectiveMax(_){if(isNaN(_))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMax' is NaN.");if(null===_)return void this._set("effectiveMax",null);const v=this.toPrecision(_);this.effectiveMax!==v&&this._set("effectiveMax",this._applyBoundsToValue(v))}setEffectiveMin(_){if(isNaN(_))return void this._logError("slider:invalid-value","Supplied value for property 'effectiveMin' is NaN.");if(null===_)return void this._set("effectiveMin",null);const v=this.toPrecision(_);this.effectiveMin!==v&&this._set("effectiveMin",this._applyBoundsToValue(v))}setValue(_,v){if(isNaN(v))return void this._logError("slider:invalid-value","Supplied value for member of property 'values' is NaN.");const{values:O}=this,D=O[_],w=this.toPrecision(v);if(D===w)return;const te=[...O];te[_]=w,this._set("values",te),this.notifyChange("labels")}_applyBoundsToValue(_){const{max:v,min:O}=this;return(0,lt.pC)(O)&&_<O?O:(0,lt.pC)(v)&&_>v?v:_}_logError(_,v,O){ON.error(new Ls.Z(_,v,O))}};(0,Ze._)([(0,nt.Cb)()],nu.prototype,"effectiveMax",null),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"effectiveMin",null),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"labelFormatFunction",null),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"inputFormatFunction",null),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"inputParseFunction",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],nu.prototype,"labels",null),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"max",null),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"min",null),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"precision",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],nu.prototype,"state",null),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"thumbsConstrained",void 0),(0,Ze._)([(0,nt.Cb)()],nu.prototype,"values",null),nu=(0,Ze._)([(0,ui.j)(aA)],nu);const lA=nu;let Jp=class extends lA{constructor(_){super(_),this.items=null,this.currentIndex=0,this.isDropdownOpen=!1}get currentItem(){return null!==this.items&&null!==this.currentIndex&&this.currentIndex<this.items.length?this.items[this.currentIndex]:null}selectItem(_){this.currentIndex=_,this.isDropdownOpen=!1}toggle(){this.isDropdownOpen=!this.isDropdownOpen}};(0,Ze._)([(0,nt.Cb)()],Jp.prototype,"items",void 0),(0,Ze._)([(0,nt.Cb)()],Jp.prototype,"currentIndex",void 0),(0,Ze._)([(0,nt.Cb)()],Jp.prototype,"currentItem",null),(0,Ze._)([(0,nt.Cb)()],Jp.prototype,"isDropdownOpen",void 0),Jp=(0,Ze._)([(0,ui.j)("esri.widgets.Daylight.SliderWithDropdown")],Jp);let Zg=class extends Bi.Z{constructor(){super(...arguments),this.state="ready",this.value=new Date}};(0,Ze._)([(0,nt.Cb)()],Zg.prototype,"state",void 0),(0,Ze._)([(0,nt.Cb)()],Zg.prototype,"value",void 0),Zg=(0,Ze._)([(0,ui.j)("esri.widgets.support.DateTimeElementViewModel")],Zg);const PN=Zg;let kC=class extends PN{constructor(_){super(_)}};kC=(0,Ze._)([(0,ui.j)("esri.widgets.support.DatePickerViewModel")],kC);const IE=kC;var ou=T(88411);const xN={hour:"2-digit",minute:"2-digit",timeZone:"UTC"},DN={hour:"numeric",timeZone:"UTC"};function cA(_,v){let O;if("tick"===v){const w=Math.round((0,fh.rJ)(_,"minutes","hours"));O=new Date((0,fh.rJ)(w,"hours","milliseconds"))}else O=new Date(6e4*_);let D=(0,ou.p6)(O,xN);return 0!==_&&"00:00"===D&&(D="24:00"),"tick"===v&&D.includes(" ")&&(D=(0,ou.p6)(O,DN),D=D.replace(":00","")),D}function SN(_){return[{utcOffset:-12,short:"UTC-12",long:_.timezoneDateline},{utcOffset:-11,short:"UTC-11",long:_.timezoneSamoa},{utcOffset:-10,short:_.timezoneHAST,long:_.timezoneHawaii},{utcOffset:-9,short:_.timezoneAKST,long:_.timezoneAlaska},{utcOffset:-8,short:_.timezonePST,long:_.timezoneBaja},{utcOffset:-7,short:_.timezoneMST,long:_.timezoneMountain},{utcOffset:-7,short:_.timezoneMST,long:_.timezoneLaPaz},{utcOffset:-7,short:_.timezoneMST,long:_.timezoneArizona},{utcOffset:-6,short:_.timezoneCST,long:_.timezoneSaskatchewan},{utcOffset:-6,short:_.timezoneCST,long:_.timezoneCentralAmerica},{utcOffset:-6,short:_.timezoneCST,long:_.timezoneCentralTime},{utcOffset:-6,short:_.timezoneCST,long:_.timezoneMexico},{utcOffset:-5,short:_.timezoneEST,long:_.timezoneEasternUS},{utcOffset:-5,short:_.timezoneEST,long:_.timezoneLima},{utcOffset:-5,short:_.timezoneEST,long:_.timezoneIndiana},{utcOffset:-4,short:null,long:_.timezoneAtlantic},{utcOffset:-4,short:null,long:_.timezoneCuiaba},{utcOffset:-4,short:null,long:_.timezoneSantiago},{utcOffset:-4,short:null,long:_.timezoneManaus},{utcOffset:-4,short:null,long:_.timezoneAsuncion},{utcOffset:-3,short:null,long:_.timezoneBrasilia},{utcOffset:-3,short:null,long:_.timezoneGreenland},{utcOffset:-3,short:null,long:_.timezoneMontevideo},{utcOffset:-3,short:null,long:_.timezoneCayenne},{utcOffset:-3,short:null,long:_.timezoneBuenosAires},{utcOffset:-2,short:null,long:_.timezoneMidAtlantic},{utcOffset:-1,short:null,long:_.timezoneAzores},{utcOffset:-1,short:null,long:_.timezoneCaboVerde},{utcOffset:0,short:null,long:_.timezoneDublin},{utcOffset:0,short:null,long:_.timezoneReykjavik},{utcOffset:0,short:null,long:_.timezoneCasablanca},{utcOffset:1,short:_.timezoneCET,long:_.timezoneBelgrade},{utcOffset:1,short:_.timezoneCET,long:_.timezoneSarajevo},{utcOffset:1,short:_.timezoneCET,long:_.timezoneBrussels},{utcOffset:1,short:_.timezoneCET,long:_.timezoneWCAfrica},{utcOffset:1,short:_.timezoneCET,long:_.timezoneAmsterdam},{utcOffset:1,short:_.timezoneCET,long:_.timezoneWindhoek},{utcOffset:2,short:_.timezoneEET,long:_.timezoneMinsk},{utcOffset:2,short:_.timezoneEET,long:_.timezoneCairo},{utcOffset:2,short:_.timezoneEET,long:_.timezoneHelsinki},{utcOffset:2,short:_.timezoneEET,long:_.timezoneAthens},{utcOffset:2,short:_.timezoneEET,long:_.timezoneJerusalem},{utcOffset:2,short:_.timezoneEET,long:_.timezoneAmman},{utcOffset:2,short:_.timezoneEET,long:_.timezoneBeirut},{utcOffset:2,short:_.timezoneEET,long:_.timezoneHarare},{utcOffset:2,short:_.timezoneEET,long:_.timezoneDamascus},{utcOffset:2,short:_.timezoneEET,long:_.timezoneIstanbul},{utcOffset:3,short:_.timezoneMSK,long:_.timezoneKuwait},{utcOffset:3,short:_.timezoneMSK,long:_.timezoneBaghdad},{utcOffset:3,short:_.timezoneMSK,long:_.timezoneNairobi},{utcOffset:3,short:_.timezoneMSK,long:_.timezoneKaliningrad},{utcOffset:4,short:_.timezoneGST,long:_.timezoneMoscow},{utcOffset:4,short:_.timezoneGST,long:_.timezoneMuscat},{utcOffset:4,short:_.timezoneGST,long:_.timezoneBaku},{utcOffset:4,short:_.timezoneGST,long:_.timezoneYerevan},{utcOffset:4,short:_.timezoneGST,long:_.timezoneTbilisi},{utcOffset:4,short:_.timezoneGST,long:_.timezonePortLouis},{utcOffset:5,short:null,long:_.timezoneTashkent},{utcOffset:5,short:null,long:_.timezoneIslamabad},{utcOffset:6,short:null,long:_.timezoneEkaterinburg},{utcOffset:6,short:null,long:_.timezoneAstana},{utcOffset:6,short:null,long:_.timezoneDhaka},{utcOffset:7,short:_.timezoneICT,long:_.timezoneNovosibirsk},{utcOffset:7,short:_.timezoneICT,long:_.timezoneBangkok},{utcOffset:8,short:_.timezoneCCT,long:_.timezoneKrasnoyarsk},{utcOffset:8,short:_.timezoneCCT,long:_.timezoneBeijing},{utcOffset:8,short:_.timezoneCCT,long:_.timezoneSingapore},{utcOffset:8,short:_.timezoneCCT,long:_.timezoneTaipei},{utcOffset:8,short:_.timezoneCCT,long:_.timezonePerth},{utcOffset:8,short:_.timezoneCCT,long:_.timezoneUlaanbaatar},{utcOffset:9,short:_.timezoneJST,long:_.timezoneIrkutsk},{utcOffset:9,short:_.timezoneJST,long:_.timezoneSeoul},{utcOffset:9,short:_.timezoneJST,long:_.timezoneOsaka},{utcOffset:10,short:_.timezoneAEST,long:_.timezoneYakutsk},{utcOffset:10,short:_.timezoneAEST,long:_.timezoneCanberra},{utcOffset:10,short:_.timezoneAEST,long:_.timezoneBrisbane},{utcOffset:10,short:_.timezoneAEST,long:_.timezoneHobart},{utcOffset:10,short:_.timezoneAEST,long:_.timezoneGuam},{utcOffset:11,short:null,long:_.timezoneVladivostok},{utcOffset:11,short:null,long:_.timezoneSolomon},{utcOffset:12,short:_.timezoneNZST,long:_.timezoneMagadan},{utcOffset:12,short:_.timezoneNZST,long:_.timezoneFiji},{utcOffset:12,short:_.timezoneNZST,long:_.timezoneAuckland},{utcOffset:12,short:_.timezoneNZST,long:_.timezoneNukualofa}].map(({utcOffset:v,short:O,long:D})=>{const w=v>0?`UTC+${v}`:v<0?`UTC${v}`:"GMT";return O?{utcOffset:v,short:O,shortWithUTC:`${w} (${O})`,long:D}:{utcOffset:v,short:w,shortWithUTC:w,long:D}})}let $o=class extends cc.r{constructor(_){super(_),this.view=null,this.datePickerViewModel=new IE,this.timeSliderViewModel=new Jp,this.lightingUpdateInterval=200,this._oldLighting=null,this.playSpeedMultiplier=1,this._cachedLightingDateUTC=new Date(0),this._cachedDisplayUTCOffset=0,this._firstInteraction=!0,this._lastLightingUpdate=0,this._nextLightingUpdate=null}initialize(){this.handles.add([(0,pt.gx)(()=>this.view,_=>_.when(()=>this._updateLighting(null)),pt.nn),(0,pt.YP)(()=>(0,lt.yw)(this._lighting,_=>"sun"===_.type?_.date:null),_=>this._scheduleUpdateLighting(_)),(0,pt.on)(()=>this._lighting,"timezone-will-change",_=>this._timezoneWillChange(_),{onListenerAdd:()=>this._timezoneWillChange(null)}),(0,pt.YP)(()=>!0===(0,lt.yw)(this.view,_=>_.stationary),()=>{(this.dayPlaying||this.yearPlaying)&&this._updateSunriseAndSunset()},pt.nn),(0,pt.YP)(()=>{const _=this.timeSliderViewModel;return{vm:_,state:_.state,sliderPosition:this.timeSliderPosition}},({vm:_,state:v,sliderPosition:O})=>{"ready"===v&&_.setValue(0,O)}),(0,pt.YP)(()=>{var _;return null==(_=this.timeSliderViewModel.currentItem)?void 0:_.utcOffset},_=>this.utcOffset=_),(0,pt.YP)(()=>this.timeSliderViewModel.isDropdownOpen,()=>this.stopPlaying()),(0,pt.YP)(()=>this.timeSliderViewModel.values,_=>this.timeSliderPosition=_[0]),(0,pt.YP)(()=>this.datePickerViewModel.value,_=>{this.dayPlaying=!1,this.localDate=_}),(0,pt.YP)(()=>this.localDate,_=>{this.datePickerViewModel.value.valueOf()!==_.getTime()&&this.datePickerViewModel.set("value",_)})])}destroy(){this._nextLightingUpdate&&(clearTimeout(this._nextLightingUpdate),this._nextLightingUpdate=null),this.view=null}get isSupported(){return(0,lt.Wi)(this.view)||"3d"===this.view.type}get utcOffset(){return this._cachedDisplayUTCOffset}set utcOffset(_){_!==this.utcOffset&&(0,lt.pC)(this._lighting)&&"sun"===this._lighting.type&&(this._lighting.displayUTCOffset=_,this._updateLighting(null))}get localDate(){return(0,fh.cH)(this._lightingDateDisplay)}set localDate(_){_.getTime()!==this.localDate.getTime()&&(this._lightingDateDisplay=(0,fh.y7)(this._lightingDateDisplay,_))}get timeSliderPosition(){return function TN(_){return(0,fh.Ni)(_,"minutes")}(this._lightingDateDisplay)}set timeSliderPosition(_){Math.abs(_-this.timeSliderPosition)>1/60&&(this._lightingDateDisplay=function CN(_,v){return(0,fh.cl)(_,v,"minutes")}(this._lightingDateDisplay,_),this.stopPlaying(),this._enableDirectShadowsIfFirstInteraction())}_timezoneFromCamera(_,v){if((0,lt.Wi)(v)||!_.cameraTrackingEnabled)return 0;const O=r1([v.longitude,v.latitude]);return(0,lt.Wi)(O)?0:Math.round(O.hours+O.minutes/60+O.seconds/3600)}get directShadowsEnabled(){const _=(0,lt.yw)(this._lighting,v=>v.directShadowsEnabled);return(0,lt.Pt)(_,!1)}set directShadowsEnabled(_){(0,lt.yw)(this._lighting,v=>{v.directShadowsEnabled=_})}get sunLightingEnabled(){return"sun"===this._lightingType}set sunLightingEnabled(_){const v=this._environment;if(_===this._get("sunLightingEnabled")||(0,lt.Wi)(v))return;const O=v.lighting,D=this._oldLighting;this._oldLighting=O;const w={directShadowsEnabled:O.directShadowsEnabled,ambientOcclusionEnabled:O.ambientOcclusionEnabled,waterReflectionEnabled:O.waterReflectionEnabled},te=_?"sun":"virtual";let fe;fe=(0,lt.pC)(D)&&D.type===te?D:_?new Yt:new Kn,fe.set(w),v.lighting=fe,_||(this.timeSliderViewModel.isDropdownOpen=!1)}set playingState(_){this.playingState!==_&&this.sunLightingEnabled&&(this._set("playingState",_),"none"!==_&&(this._updateSunriseAndSunset(),this._lastTime=Date.now(),this._play(),this._enableDirectShadowsIfFirstInteraction()))}get dayPlaying(){return"day"===this.playingState}set dayPlaying(_){_?this.playingState="day":this.dayPlaying&&(this.playingState="none")}get yearPlaying(){return"year"===this.playingState}set yearPlaying(_){_?this.playingState="year":this.yearPlaying&&(this.playingState="none")}get currentSeason(){return function vN(_,v){return $C(function EN(_){const v=_.getTime(),O=Kg(_,"spring",ep.NORTHERN).getTime(),D=Kg(_,"summer",ep.NORTHERN).getTime(),w=Kg(_,"fall",ep.NORTHERN).getTime(),te=Kg(_,"winter",ep.NORTHERN).getTime();return v>=O&&v<D?"spring":v>=D&&v<w?"summer":v>=w&&v<te?"fall":"winter"}(_),v)}(this.localDate,this._currentHemisphere)}set currentSeason(_){this.stopPlaying();const v=$C(_,this._currentHemisphere);this.localDate=Kg(this.localDate,v,ep.NORTHERN)}get _currentHemisphere(){const _=(0,lt.yw)(this.view,v=>{var O;return null==(O=v.camera)?void 0:O.position});return(0,lt.Wi)(_)||_.latitude>=0?ep.NORTHERN:ep.SOUTHERN}get _environment(){return(0,lt.yw)(this.view,_=>_.environment)}get _lighting(){return(0,lt.yw)(this._environment,_=>_.lighting)}get _lightingType(){return(0,lt.yw)(this._lighting,_=>_.type)}get _lightingDateDisplay(){return(0,fh.Nm)(this._cachedLightingDateUTC,this._cachedDisplayUTCOffset,"hours")}set _lightingDateDisplay(_){const v=this._lighting;if((0,lt.Wi)(v)||!this.sunLightingEnabled||"sun"!==v.type)return;const O=(0,fh.Nm)(_,-this._cachedDisplayUTCOffset,"hours");O.getTime()!==v.date.getTime()&&(v.date=O,this._updateLighting(null))}stopPlaying(){this.playingState="none"}toggleDayPlaying(){this.dayPlaying=!this.dayPlaying}toggleYearPlaying(){this.yearPlaying=!this.yearPlaying}toggleSunLightingEnabled(){this.stopPlaying(),this.sunLightingEnabled=!this.sunLightingEnabled}toggleDirectShadowsEnabled(){this.stopPlaying(),this.directShadowsEnabled=!this.directShadowsEnabled}_enableDirectShadowsIfFirstInteraction(){this._firstInteraction&&(this._firstInteraction=!1,this.directShadowsEnabled=!0)}_updateLighting(_){var Pe;const v=Date.now();this._lastLightingUpdate=v;const{view:O}=this,D=this._lighting;if((0,lt.Wi)(O)||(0,lt.Wi)(D)||"sun"!==D.type)return;const w=_||D.date,te=D.displayUTCOffset,fe=null!==te?te:this._timezoneFromCamera(D,null==(Pe=O.camera)?void 0:Pe.position);this._cachedLightingDateUTC.getTime()!==w.getTime()&&(this._cachedLightingDateUTC=new Date(w.getTime())),this._cachedDisplayUTCOffset!==fe&&(this._cachedDisplayUTCOffset=fe)}_timezoneWillChange(_){const v=this._lighting;if((0,lt.Wi)(v)||"sun"!==v.type||!v.cameraTrackingEnabled)return;let O;if(_)O=_.timezoneOffset;else{if(null!=v.displayUTCOffset)return;O=Yt.calculateTimezoneOffset(v.positionTimezoneInfo)}v.displayUTCOffset=O,this._scheduleUpdateLighting(null)}_scheduleUpdateLighting(_){if(this._nextLightingUpdate||(0,lt.Wi)(_))return;const v=Date.now()-this._lastLightingUpdate,O=this.lightingUpdateInterval-v;O<=0?(0,rt.Os)(()=>this._updateLighting(_)):this._nextLightingUpdate=setTimeout(()=>{this._updateLighting(null),this._nextLightingUpdate=null},O)}_play(){const _=this._lighting;if(!(0,lt.Wi)(_)&&this.sunLightingEnabled&&"sun"===_.type&&(this.dayPlaying||this.yearPlaying)){const v=Date.now()-this._lastTime;if(this.dayPlaying){this._lastTime=Date.now();const O=function MN(_,v,O){if(isNaN(_.getTime())&&isNaN(v.getTime()))return 3e5;const Ue=O.getTime(),Xe=_.getTime(),st=v.getTime(),vt=Xe-36e5,Ct=Xe+36e5,Wt=st-48e5,Kt=st+24e5;let Lt=3e5;return Ue>=vt&&Ue<=Ct?Lt=Ue-vt<=12e5?18e5-(Ue-vt)/12e5*16e5:Ct-Ue<=6e5?3e5-(Ct-Ue)/12e5*2*1e5:2e5:Ue>=Wt&&Ue<=Kt?Lt=Ue-Wt<=6e5?3e5-(Ue-Wt)/12e5*2*1e5:Kt-Ue<=12e5?18e5-(Kt-Ue)/12e5*16e5:2e5:(Ue<Xe||Ue>st)&&(Lt=18e5),Lt}(this._sunrise,this._sunset,_.date)*this.playSpeedMultiplier/100*v;if(O>0){let D=new Date(_.date.getTime()+O);((D.getUTCHours()+_.displayUTCOffset)%24+24)%24<((_.date.getUTCHours()+_.displayUTCOffset)%24+24)%24&&(D=new Date(_.date.getTime()+O-864e5)),_.date=D}}else if(v>1e3){this._lastTime=Date.now();const O=(_.date.getUTCMonth()+1)%12,D=new Date(_.date.getTime());D.setUTCMonth(O),_.date=D}requestAnimationFrame(()=>this._play())}}_updateSunriseAndSunset(){const _=this._lighting;if((0,lt.Wi)(_)||"sun"!==_.type||!this.sunLightingEnabled)return;const v=(0,lt.yw)(this.view,D=>{var w;return null==(w=D.camera)?void 0:w.position});if((0,lt.Wi)(v))return;const O=function AN(_,v,O,D){const w=v0.getTimes(_,v,O),te=w.sunrise,fe=w.sunset,Pe=(0,fh.Nm)(_,D,"hours"),Ue=(0,fh.Nm)(te,D,"hours"),Xe=(0,fh.Nm)(fe,D,"hours");if(Pe.getUTCDate()!==Ue.getUTCDate()||Pe.getUTCDate()!==Xe.getUTCDate()){const st=Pe.getTime()-Ue.getTime()>0?1:-1;te.setUTCDate(te.getUTCDate()+st),fe.setUTCDate(fe.getUTCDate()+st)}return{sunrise:te,sunset:fe}}(_.date,v.latitude,v.longitude,_.displayUTCOffset);this._sunrise=new Date(O.sunrise),this._sunset=new Date(O.sunset)}};(0,Ze._)([(0,nt.Cb)({type:xE})],$o.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:IE,nonNullable:!0})],$o.prototype,"datePickerViewModel",void 0),(0,Ze._)([(0,nt.Cb)({type:Jp,nonNullable:!0})],$o.prototype,"timeSliderViewModel",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"isSupported",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"lightingUpdateInterval",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"utcOffset",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"localDate",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"timeSliderPosition",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"directShadowsEnabled",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"sunLightingEnabled",null),(0,Ze._)([(0,nt.Cb)({type:["none","day","year"],value:"none"})],$o.prototype,"playingState",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"dayPlaying",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"yearPlaying",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"playSpeedMultiplier",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"currentSeason",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_lastTime",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_sunrise",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_sunset",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_cachedLightingDateUTC",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_cachedDisplayUTCOffset",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_firstInteraction",void 0),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_currentHemisphere",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_environment",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_lighting",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_lightingType",null),(0,Ze._)([(0,nt.Cb)()],$o.prototype,"_lightingDateDisplay",null),$o=(0,Ze._)([(0,ui.j)("esri.widgets.Daylight.DaylightViewModel")],$o);const uA=$o;let Xp=class extends Bi.Z{constructor(){super(...arguments),this.header=!0,this.playButtons=!0,this.datePicker=!0,this.timezone=!0,this.sunLightingToggle=!0,this.shadowsToggle=!0}};(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0})],Xp.prototype,"header",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0})],Xp.prototype,"playButtons",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0})],Xp.prototype,"datePicker",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0})],Xp.prototype,"timezone",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0})],Xp.prototype,"sunLightingToggle",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,nonNullable:!0})],Xp.prototype,"shadowsToggle",void 0),Xp=(0,Ze._)([(0,ui.j)("esri.widgets.Daylight.VisibleElements")],Xp);const dA=Xp;T(52515);var YC=T(97059);const Lu={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},hA={labels:!1,rangeLabels:!1};let eo=class extends wu.Z{constructor(_,v){super(_,v),this._activeLabelInputIndex=null,this._anchorElements=[],this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._lastMovedHandleIndex=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.draggableSegmentsEnabled=!0,this.effectiveMax=null,this.effectiveMin=null,this.effectiveSegmentElements=new Pn.Z,this.extraNodes=[],this.inputCreatedFunction=null,this.inputFormatFunction=null,this.inputParseFunction=null,this.label=void 0,this.labelElements=new Pn.Z,this.labelInputsEnabled=!1,this.labelFormatFunction=null,this.labels=null,this.max=null,this.maxLabelElement=null,this.messages=null,this.min=null,this.minLabelElement=null,this.precision=4,this.rangeLabelInputsEnabled=!1,this.segmentElements=new Pn.Z,this.snapOnClickEnabled=!0,this.steps=null,this.syncedSegmentsEnabled=!1,this.thumbsConstrained=!0,this.thumbCreatedFunction=null,this.thumbElements=new Pn.Z,this.tickElements=new Pn.Z,this.trackElement=null,this.values=null,this.viewModel=new lA,this.visibleElements=or({},hA),this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this),this._onTrackPointerMove=this._onTrackPointerMove.bind(this),this._onTrackPointerUp=this._onTrackPointerUp.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),this.labelElements.removeAll(),this.labelElements.destroy(),this.segmentElements.removeAll(),this.segmentElements.destroy(),this.effectiveSegmentElements.removeAll(),this.effectiveSegmentElements.destroy(),this.thumbElements.removeAll(),this.thumbElements.destroy(),this.tickElements.removeAll(),this.tickElements.destroy()}set layout(_){["vertical","vertical-reversed","horizontal","horizontal-reversed"].includes(_)||(_="horizontal"),this._set("layout",_)}get state(){const{_activeLabelInputIndex:_,_isMaxInputActive:v,_isMinInputActive:O,_dragStartInfo:D,_segmentDragStartInfo:w,disabled:te,viewModel:fe}=this,Pe=(0,lt.pC)(D)||(0,lt.pC)(w);return te?"disabled":null!==_||v||O?"editing":Pe?"dragging":fe.state}set tickConfigs(_){this._set("tickConfigs",_),this.scheduleRender()}castVisibleElements(_){return or(or({},hA),_)}render(){const{label:_}=this,v=this.classes("esri-slider","esri-widget",this._isHorizontalLayout()?"esri-slider--horizontal":"esri-slider--vertical",this._isReversedLayout()?"esri-slider--reversed":null,this._isDisabled()?"esri-disabled":null);return this._storeTrackDimensions(),(0,pi.u)("div",{"aria-label":_,class:v,"touch-action":"none",bind:this,afterCreate:this._afterContainerCreate},this.renderContent())}toNextStep(_){this._toStep(_,1)}toPreviousStep(_){this._toStep(_,-1)}renderContent(){const{max:_,min:v}=this;if(!((0,lt.Wi)(v)||(0,lt.Wi)(_)||v>=_))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return(0,pi.u)("div",{key:"slider-container",bind:this,class:"esri-slider__content"},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return(0,pi.u)("div",{afterCreate:this._afterTrackCreate,afterRemoved:this._afterTrackRemoved,bind:this,class:"esri-slider__track","data-node-ref":"trackElement","touch-action":"none"},this.renderEffectiveSegmentElements(),this.renderSegmentElements(),this.renderAnchorElements())}renderEffectiveSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const _=(0,lt.pC)(this.effectiveMax),v=(0,lt.pC)(this.effectiveMin);if(!_&&!v)return;const{max:O,min:D,viewModel:w}=this,te=w.getBounds(),fe=[];return v&&fe.push(this.renderEffectiveSegmentElement(D,te.min,!0)),_&&fe.push(this.renderEffectiveSegmentElement(te.max,O,!1)),fe}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const _=this.values.length,v=[];for(let O=0;O<=_;O++)v.push(this.renderSegmentElement(O));return v}renderSegmentElement(_){const{_trackHeight:v,_trackWidth:O,draggableSegmentsEnabled:D,id:w,state:te,values:fe}=this,Pe=this._isHorizontalLayout(),Ue=Pe?O:v,Xe=this.viewModel.getBounds(),st=this._positionFromValue(Xe.max),vt=this._positionFromValue(Xe.min),Ct=_===fe.length?null:_,Wt=0===_?null:_-1,Kt=(0,lt.pC)(Ct),Lt=(0,lt.pC)(Wt);let nr,sr;const Er=[...fe].sort((si,Ci)=>si-Ci);this._isReversedLayout()?(nr=Lt?this._positionFromValue(Er[Wt]):vt,sr=Kt?this._positionFromValue(Er[Ct]):st):(nr=Kt?this._positionFromValue(Er[Ct]):st,sr=Lt?this._positionFromValue(Er[Wt]):vt);const yr=this._applyPrecisionToPosition(100*sr/Ue),br=(nr-sr)/Ue,Rr=Pe?`transform: translate(${yr}%, 0px) scale(${br}, 1);`:`transform: translate(0px, ${yr}%) scale(1, ${br});`,$r=this.classes("esri-slider__segment","esri-slider__segment-"+_,D&&Kt&&Lt&&"disabled"!==te?"esri-slider__segment--interactive":null);return(0,pi.u)("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:$r,"data-max-thumb-index":Ct,"data-min-thumb-index":Wt,"data-segment-index":_,key:`${w}-segment-${_}`,style:Rr,"touch-action":"none"})}renderEffectiveSegmentElement(_,v,O){const{_trackHeight:D,_trackWidth:w,layout:te}=this,fe=this._positionFromValue(_),Pe=this._positionFromValue(v),Ue=this._isHorizontalLayout(),Xe=Ue?w:D,st=this._applyPrecisionToPosition(100*fe/Xe);let vt=null;if("horizontal"===te){const Kt=O?Xe-Pe:Pe,Lt=fe===Xe?0:st;vt=`clip-path: inset(0% ${Pe===Xe?0:this._applyPrecisionToPosition(Kt/Xe*100)}% 0% ${Lt}%);`}else{const Kt=(Pe-fe)/Xe;vt=Ue?`transform: translate(${st}%, 0px) scale(${Kt}, 1);`:`transform: translate(0px, ${st}%) scale(1, ${Kt});`}const Wt=this.classes("esri-slider__segment","esri-slider__effective-segment",O?"esri-slider__effective-min-segment":"esri-slider__effective-max-segment");return(0,pi.u)("div",{afterCreate:this._afterEffectiveSegmentCreate,afterRemoved:this._afterEffectiveSegmentRemoved,bind:this,class:Wt,style:vt,"touch-action":"none"})}renderAnchorElements(){const{trackElement:_,values:v}=this;if(v&&v.length)return this._zIndices=v.map((O,D)=>{const w=this._positionFromValue(O),te=this._positionToPercent(w),fe=(this._isHorizontalLayout()?te>50:te<50)?-1:1;return this._zIndexOffset+(v.length+fe*D)}),_&&v&&v.length?v.map((O,D)=>this.renderAnchorElement(O,D)):null}renderAnchorElement(_,v){const O=this._positionFromValue(_),D=this._valueFromPosition(O);if((0,lt.Wi)(D)||isNaN(D))return;const{_dragStartInfo:w,_lastMovedHandleIndex:te,id:fe,layout:Pe,values:Ue,visibleElements:{labels:Xe}}=this,st=w&&w.index===v,vt=te===v,Ct=this.classes("esri-slider__anchor","esri-slider__anchor-"+v,st?"esri-slider__anchor--moving":null,vt?"esri-slider__anchor--moved":null),Wt=this.labels.values[v],Kt=this._getStyleForAnchor(_,v,st||vt),{min:Lt,max:nr}=this.viewModel.getBoundsForValueAtIndex(v),{disabled:sr,messages:Er}=this,yr=2===Ue.length?(0,YC.n)(0===v?Er.rangeMinimum:Er.rangeMaximum,{value:_}):Wt;return(0,pi.u)("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":1===Ue.length?null:0===v?`${fe}-handle-${v+1}`:v===Ue.length-1?`${fe}-handle-${v-1}`:`${fe}-handle-${v-1} ${fe}-handle-${v+1}`,"aria-label":Er.sliderValue,"aria-labelledby":Xe?`${fe}-label-${v}`:null,"aria-orientation":Pe,"aria-valuemax":nr.toString(),"aria-valuemin":Lt.toString(),"aria-valuenow":_.toString(),"aria-valuetext":yr,bind:this,class:Ct,"data-thumb-index":v,"data-value":_,id:`${fe}-handle-${v}`,key:`${fe}-handle-${v}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:Kt,tabIndex:sr?-1:0},(0,pi.u)("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:"esri-slider__thumb","data-thumb-index":v,"touch-action":"none"}),this.renderThumbLabel(v))}renderThumbLabel(_){const{id:v,labels:O,labelInputsEnabled:D,state:w}=this,te=this.visibleElements.labels,fe=O.values[_],Pe=this.classes("esri-slider__label",te?null:"esri-hidden",D&&"disabled"!==w?"esri-slider__label--interactive":null);return(0,pi.u)("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!te).toString(),bind:this,class:Pe,"data-thumb-index":_,key:`${v}-label-${_}`,id:`${v}-label-${_}`,role:D?"button":null,"touch-action":"none"},this._activeLabelInputIndex===_?this.renderValueInput(_):fe)}renderValueInput(_){const{disabled:v,values:O}=this;return(0,pi.u)("input",{key:`value-input-${_}`,afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:"esri-slider__label-input","data-input-type":"thumb","data-input-index":_,required:!0,tabIndex:v?-1:0,type:"text",value:this._formatInputValue(O[_],"value",_),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:_,labels:v,rangeLabelInputsEnabled:O,state:D}=this,w=this.visibleElements.rangeLabels,te=this.classes("esri-slider__max",{"esri-hidden":!w,"esri-slider__max--interactive":O&&"disabled"!==D,"esri-slider__range--active":_});return(0,pi.u)("div",{"aria-hidden":(!w).toString(),afterCreate:this._afterMaxLabelCreate,bind:this,class:te,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:O?"button":null,tabIndex:!this.disabled&&O?0:-1},_?this.renderMaxInput():v.max)}renderMin(){const{_isMinInputActive:_,labels:v,rangeLabelInputsEnabled:O,state:D}=this,w=this.visibleElements.rangeLabels,te=this.classes("esri-slider__min",{"esri-hidden":!w,"esri-slider__min--interactive":O&&"disabled"!==D,"esri-slider__range--active":_});return(0,pi.u)("div",{"aria-hidden":(!w).toString(),afterCreate:this._afterMinLabelCreate,bind:this,class:te,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:O?"button":null,tabIndex:!this.disabled&&O?0:-1},_?this.renderMinInput():v.min)}renderMaxInput(){return(0,pi.u)("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:"esri-slider__range-input","data-input-type":"max",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return(0,pi.u)("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:"esri-slider__range-input","data-input-type":"min",required:!0,tabIndex:this.disabled?-1:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return(0,pi.u)("div",{bind:this,class:"esri-slider__extra-content"},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(0!==this._trackHeight||0!==this._trackWidth))return this.tickConfigs.map((_,v)=>(0,pi.u)("div",{key:"ticks-container",class:this.classes("esri-slider__ticks")},this.renderTicks(_,v)))}renderTicks(_,v){const{mode:O,values:D}=_;if(this.tickElements.getItemAt(v)||this.tickElements.add(new Pn.Z,v),"position"===O){const fe=Array.isArray(D)?D:[D];return this._calculateTickPositions(fe).map((Pe,Ue)=>this.renderTickGroup(_,Ue,v,Pe))}if("percent"===O&&Array.isArray(D)){const{max:fe,min:Pe}=this,Ue=fe-Pe,Xe=D.map(st=>this._applyPrecisionToPosition(st/100*Ue+Pe));return this._calculateTickPositions(Xe).map((st,vt)=>this.renderTickGroup(_,vt,v,st))}const w=Array.isArray(D)&&D.length?D[0]:isNaN(D)?null:D,te=this._getTickCounts(w,_);return this._calculateEquidistantTickPositions(te).map((fe,Pe)=>this.renderTickGroup(_,Pe,v,fe))}renderTickGroup(_,v,O,D){const w="position"===_.mode?Array.isArray(_.values)?_.values[v]:_.values:this._valueFromPosition(D);if(!(0,lt.Wi)(w)&&!isNaN(w))return(0,pi.u)("div",{afterCreate:this._afterTickGroupCreate,afterRemoved:this._afterTickGroupRemoved,bind:this,"data-config":_,"data-position":D,"data-tick-config-index":O,"data-tick-group-index":v,"data-value":w,onclick:this._onTickGroupClick,key:`tick-group-${v}`},this.renderTickLine(_,v,O,w),_.labelsVisible?this.renderTickLabel(_,v,O,w):null)}renderTickLine(_,v,O,D){return(0,pi.u)("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":D.toString(),bind:this,class:"esri-slider__tick","data-config":_,"data-tick-config-index":O,"data-tick-group-index":v,"data-value":D,key:`tick-label-${v}`,style:this._getPositionStyleForElement(D)})}renderTickLabel(_,v,O,D){const w=_.labelFormatFunction?_.labelFormatFunction(D,"tick",v):this.viewModel.getLabelForValue(D,"tick",v);return(0,pi.u)("div",{afterCreate:this._afterTickLabelCreate,"aria-label":w,"aria-valuenow":D.toString(),"aria-valuetext":w,bind:this,class:"esri-slider__tick-label","data-config":_,"data-tick-config-index":O,"data-tick-group-index":v,"data-value":D,key:`tick-label-${v}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(D)}`},w)}_afterContainerCreate(_){this.own((0,Nl.ib)(_,()=>this.scheduleRender()))}_afterTrackCreate(_){this._set("trackElement",_),_.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterTrackRemoved(_){_.removeEventListener("pointerdown",this._onTrackPointerDown),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp)}_afterSegmentCreate(_){this.segmentElements.add(_),_.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(_){this.segmentElements.remove(_),_.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterEffectiveSegmentCreate(_){this.effectiveSegmentElements.add(_)}_afterEffectiveSegmentRemoved(_){this.effectiveSegmentElements.remove(_)}_afterAnchorCreate(_){if(this._anchorElements.push(_),_.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const v=_["data-thumb-index"],O=_["data-value"],D=this.thumbElements.getItemAt(v)||null,w=this.labelElements.getItemAt(v)||null;this.thumbCreatedFunction(v,O,D,w)}}_afterAnchorUpdate(_){(0,lt.pC)(this._focusedAnchorIndex)&&_["data-thumb-index"]===this._focusedAnchorIndex&&(_.focus(),this._focusedAnchorIndex=null)}_afterAnchorRemoved(_){const v=this._anchorElements.indexOf(_,0);v>-1&&this._anchorElements.splice(v,1),_.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(_){this.thumbElements.add(_)}_afterThumbRemoved(_){this.thumbElements.remove(_)}_afterLabelCreate(_){this.labelElements.add(_),_.addEventListener("pointerdown",this._onLabelPointerDown),_.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(_){this.labelElements.remove(_),_.removeEventListener("pointerdown",this._onLabelPointerDown),_.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(_){if(_.focus(),_.select(),this.inputCreatedFunction){const v=_.getAttribute("data-input-type");this.inputCreatedFunction(_,v,"thumb"===v?_["data-input-index"]:null)}}_afterTickLineCreate(_){const O=_["data-tick-group-index"],D=this.tickElements.getItemAt(_["data-tick-config-index"]);D.getItemAt(O)?D.getItemAt(O).tickElement=_:D.add({groupElement:null,tickElement:_,labelElement:null},O)}_afterTickLabelCreate(_){const O=_["data-tick-group-index"],D=this.tickElements.getItemAt(_["data-tick-config-index"]);D.getItemAt(O)?D.getItemAt(O).labelElement=_:D.add({groupElement:null,labelElement:_,tickElement:null},O)}_afterTickGroupRemoved(_){const O=this.tickElements.items[_["data-tick-config-index"]],D=null==O?void 0:O.find(w=>w.groupElement===_);D&&O.remove(D)}_afterTickGroupCreate(_){var O,D;const v=_["data-config"];if(v&&v.tickCreatedFunction){const w=_["data-tick-config-index"],te=_["data-tick-group-index"],fe=_["data-value"],Pe=null==(D=null==(O=this.tickElements)?void 0:O.getItemAt(w))?void 0:D.getItemAt(te);Pe&&(Pe.groupElement=_,v.tickCreatedFunction(fe,Pe.tickElement||null,Pe.labelElement||null))}}_afterMaxLabelCreate(_){this._set("maxLabelElement",_)}_afterMinLabelCreate(_){this._set("minLabelElement",_)}_onAnchorKeyDown(_){if(this._isDisabled()||"editing"===this.state)return;const{target:v}=_,O=(0,mt.kK)(_),{_anchorElements:D,values:w}=this,te=v["data-thumb-index"],fe=D[te],Pe=w[te],Ue=[Lu.moveAnchorUp,Lu.moveAnchorDown,Lu.moveAnchorLeft,Lu.moveAnchorRight];if(O===Lu.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=te,this.notifyChange("state");else if(Ue.includes(O)){_.preventDefault();const{steps:Xe}=this,st=O===Lu.moveAnchorUp||O===Lu.moveAnchorRight?1:-1;if((0,lt.pC)(Xe))this._toStep(te,this._isReversedLayout()?-1*st:st);else{const{precision:Ct}=this,Wt=this._getPositionOfElement(fe),Kt=this._valueFromPosition(Wt),Lt=this._isHorizontalLayout()?st:-1*st;let nr;nr=0===Ct?this._positionFromValue(Kt+Lt):1===Ct?this._positionFromValue(Kt+.1*Lt):Wt+Lt,this._toPosition(te,nr)}const vt=this.values[te];Pe!==vt&&this._emitThumbChangeEvent({index:te,oldValue:Pe,value:vt})}else if(O===Lu.moveAnchorToMax||O===Lu.moveAnchorToMin){_.preventDefault();const{min:Xe,max:st}=this._getAnchorBoundsInPixels(te),vt=this._isPositionInverted()?O===Lu.moveAnchorToMax?Xe:st:O===Lu.moveAnchorToMin?Xe:st;this._toPosition(te,vt);const Ct=this.values[te];Pe!==Ct&&this._emitThumbChangeEvent({index:te,oldValue:Pe,value:Ct})}}_onAnchorPointerDown(_){if(this._isDisabled())return;const{target:v,clientX:O,clientY:D}=_,w=v["data-thumb-index"];void 0!==w&&(_.preventDefault(),this._anchorElements[w]&&this._anchorElements[w].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:O,clientY:D,index:w,position:this._getPositionOfElement(this._anchorElements[w])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(_){if("editing"===this.state||!this._dragStartInfo)return;_.preventDefault();const{values:v,_anchorElements:O,_dragged:D,_dragStartInfo:w,_dragStartInfo:{index:te,position:fe}}=this,{clientX:Pe,clientY:Ue}=_,Xe=D?"drag":"start",vt=this._getPositionOfElement(O[te]),Ct=this._applyPrecisionToPosition(this._isHorizontalLayout()?fe+Pe-w.clientX:fe+Ue-w.clientY);if(vt===Ct)return;const Wt=v[te];this._dragged=!0,this._toPosition(te,Ct);const Kt=this.values[te];D?Wt!==Kt&&this._emitThumbDragEvent({index:te,state:Xe,value:Kt}):this._emitThumbDragEvent({index:te,state:Xe,value:Wt})}_onAnchorPointerUp(_){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;_.preventDefault();const{index:v}=this._dragStartInfo,O=this._dragged,D=this.values[v];this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=v,this.notifyChange("state"),O?this._emitThumbDragEvent({index:v,state:"stop",value:D}):(this.scheduleRender(),"editing"!==this.state&&this._emitThumbClickEvent({index:v,value:D}))}_onTrackPointerDown(_){const{_dragStartInfo:v,snapOnClickEnabled:O,state:D,values:w}=this;if(this._isDisabled()||"editing"===D||v||(document.addEventListener("pointermove",this._onTrackPointerMove),document.addEventListener("pointerup",this._onTrackPointerUp),!O||!w.length))return;const{steps:te}=this,{clientX:fe,clientY:Pe}=_,Ue=this._getCursorPositionFromEvent(_),Xe=this._valueFromPosition(Ue),st=this._getIndexOfNearestValue(Xe),vt=w[st],Ct=w.some((nr,sr)=>nr===vt&&sr!==st)&&Xe>vt?this.values.lastIndexOf(vt):st;if((0,lt.Wi)(Ct))return;const Wt=w[Ct],Kt=(0,lt.pC)(te)?this._calculateNearestStepPosition(Ue):Ue;this._toPosition(Ct,Kt),this._dragged=!0,this._dragStartInfo={clientX:fe,clientY:Pe,index:Ct,position:Kt},this._focusedAnchorIndex=Ct,this.notifyChange("state"),this._emitThumbDragEvent({index:Ct,state:"start",value:Wt});const Lt=this.values[Ct];Wt!==Lt&&this._emitThumbDragEvent({index:Ct,state:"drag",value:Lt}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onTrackPointerMove(_){_.preventDefault(),this._dragged=!0}_onTrackPointerUp(_){if(_.preventDefault(),document.removeEventListener("pointermove",this._onTrackPointerMove),document.removeEventListener("pointerup",this._onTrackPointerUp),this.snapOnClickEnabled||(this._dragged=!1),!this._dragged){const v=this._getCursorPositionFromEvent(_),O=this._valueFromPosition(v);this._emitTrackClickEvent({value:O})}}_onSegmentPointerDown(_){var Pe,Ue;_.preventDefault();const v=_.target,O=v["data-segment-index"],D=v["data-min-thumb-index"],w=v["data-max-thumb-index"];if(this._isDisabled()||(0,lt.Wi)(D)||(0,lt.Wi)(w))return;_.stopPropagation(),this._storeTrackDimensions(),document.addEventListener("pointerup",this._onSegmentPointerUp);const te=this._getAnchorDetails(D),fe=this._getAnchorDetails(w);this.syncedSegmentsEnabled?(this.segmentElements.forEach(Xe=>Xe.classList.add("esri-slider__segment--active")),this._anchorElements.forEach(Xe=>Xe.classList.add("esri-slider__anchor--active"))):(this.segmentElements.getItemAt(O).classList.add("esri-slider__segment--active"),null==(Pe=this._anchorElements[te.index])||Pe.classList.add("esri-slider__anchor--active"),null==(Ue=this._anchorElements[fe.index])||Ue.classList.add("esri-slider__anchor--active")),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(_),index:O,details:this._normalizeSegmentDetails({min:te,max:fe})},this.draggableSegmentsEnabled&&(document.addEventListener("pointermove",this._onSegmentPointerMove),this.notifyChange("state"),this._emitSegmentDragEvent({index:O,state:"start",thumbIndices:[D,w]}))}_onSegmentPointerMove(_){if(!this._segmentDragStartInfo)return;_.preventDefault();const{_trackHeight:v,_trackWidth:O,_segmentDragStartInfo:{index:D,cursorPosition:w,details:{min:te,max:fe}}}=this,{index:Pe,position:Ue,value:Xe}=te,{index:st,position:vt,value:Ct}=fe;this._dragged=!0;const Wt=this._getCursorPositionFromEvent(_);if(Wt===w)return;const Kt=this._positionToPercent(w),Lt=this._positionToPercent(Wt)-Kt,nr=this._positionToPercent(Ue)+Lt,sr=this._positionToPercent(vt)+Lt,{min:Er}=this._getAnchorBoundsAsPercents(Pe),{max:yr}=this._getAnchorBoundsAsPercents(st);let br=!1,Rr=!1;if(nr<Er?br=!0:sr>yr&&(Rr=!0),br){const{min:rs,max:Es}=this.viewModel.getBoundsForValueAtIndex(Pe),Gs=this._isPositionInverted()?Es:rs,ws=Gs,$i=Ct+(Gs-Xe),qi=$i-this.values[st];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(qi):this._updateAnchorValues([Pe,st],[ws,$i]))}if(Rr){const{min:rs,max:Es}=this.viewModel.getBoundsForValueAtIndex(st),Gs=this._isPositionInverted()?rs:Es,ws=Gs,$i=Xe+(Gs-Ct),qi=$i-this.values[Pe];return void(this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(qi):this._updateAnchorValues([Pe,st],[$i,ws]))}const $r=this._isHorizontalLayout()?O:v,si=sr/100*$r,Ti=this.values,ki=[Ti[Pe],Ti[st]],Fi=this._getValueForAnchorAtPosition(Pe,nr/100*$r),Xi=this._getValueForAnchorAtPosition(st,si);this.syncedSegmentsEnabled?this._updateAnchorValuesByDifference(Fi-ki[0]):this._updateAnchorValues([Pe,st],[Fi,Xi]),[this.values[Pe],this.values[st]].every((rs,Es)=>rs===ki[Es])||this._emitSegmentDragEvent({index:D,state:"drag",thumbIndices:[Pe,st]})}_onSegmentPointerUp(_){if(_.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{_dragged:v,max:O,min:D,values:w}=this,{index:te,details:{min:{index:fe},max:{index:Pe}}}=this._segmentDragStartInfo;if(this.segmentElements.forEach(Ue=>Ue.classList.remove("esri-slider__segment--active")),this._anchorElements.forEach(Ue=>Ue.classList.remove("esri-slider__anchor--active")),this.draggableSegmentsEnabled){const Ue=O-D,Xe=w[fe];this._lastMovedHandleIndex=Xe===w[Pe]?Xe>Ue/2?fe:Pe:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:te,state:"stop",thumbIndices:[fe,Pe]})}if(!v){const Ue=this._getCursorPositionFromEvent(_),Xe=this._valueFromPosition(Ue);this._emitSegmentClickEvent({index:te,value:Xe,thumbIndices:[fe,Pe]})}}_onTickGroupClick(_){const v=_.target;v["data-config"]&&this._emitTickClickEvent({configIndex:v["data-tick-config-index"],groupIndex:v["data-tick-group-index"],value:v["data-value"]})}_storeTrackDimensions(){if(this.trackElement){const _=this._getDimensions(this.trackElement);this._trackHeight=_.height,this._trackWidth=_.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(_){if(this._isDisabled())return;const v=_.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&(0,lt.pC)(v)&&(this._activeLabelInputIndex=v),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(_){const{_activeLabelInputIndex:v,values:O,viewModel:D}=this,w=_.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!w)return;const te=this._parseInputValue(w,"value",v),fe=O[v],{min:Pe,max:Ue}=this.viewModel.getBoundsForValueAtIndex(v);if(te<Pe||te>Ue)return;D.setValue(v,te);const Xe=this.values[v];fe!==Xe&&this._emitThumbChangeEvent({index:v,oldValue:fe,value:Xe})}_onInputKeyDown(_){if(this._isDisabled())return;const{target:v}=_,O=(0,mt.kK)(_),{hideInput1:D,hideInput2:w,hideInput3:te}=Lu,{_activeLabelInputIndex:fe,_anchorElements:Pe}=this,Ue=v;if(O===D||O===w||O===te){_.stopPropagation();const Xe=fe;Ue.blur(),(0,lt.pC)(Xe)?Pe[Xe].focus():Ue.parentElement.focus()}}_onMaxLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"max-click",value:this.max}),this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state")))}_onMaxLabelKeyDown(_){this._isDisabled()||(0,mt.kK)(_)!==Lu.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(_){const v=_.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!v)return;const O=this.max,D=this._parseInputValue(v,"max");D<=this.min||(this.viewModel.set("max",D),this.max!==O&&this._emitMaxChangeEvent({oldValue:O,value:this.max}))}_onMinLabelClick(){this._isDisabled()||(this._emitRangeLabelClickEvent({type:"min-click",value:this.min}),this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state")))}_onMinLabelKeyDown(_){this._isDisabled()||(0,mt.kK)(_)!==Lu.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(_){const v=_.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!v)return;const O=this.min,D=this._parseInputValue(v,"min");D>=this.max||(this.viewModel.set("min",D),this.min!==O&&this._emitMinChangeEvent({oldValue:O,value:this.min}))}_isDisabled(){return this.disabled||"disabled"===this.state}_positionFromValue(_){const{max:v,min:O}=this,D=v-O;if(0===D)return 0;const{_trackHeight:w,_trackWidth:te}=this,fe=this._isHorizontalLayout();let Pe=parseFloat(fe?(te*(_-O)/D).toFixed(2):(w*(v-_)/D).toFixed(2));return this._isReversedLayout()&&(Pe=fe?te-Pe:w-Pe),Pe}_valueFromPosition(_){const{_trackHeight:v,_trackWidth:O,max:D,min:w,precision:te}=this,fe=D-w;let Pe=this._isHorizontalLayout()?_*fe/O+w:fe*(1e3-_/v*1e3)/1e3+w;return this._isReversedLayout()&&(Pe=D+w-Pe),parseFloat(Pe.toFixed(te))}_positionToPercent(_){const{_trackHeight:v,_trackWidth:O}=this,D=100*_/(this._isHorizontalLayout()?O:v);return this._applyPrecisionToPosition(D)}_applyPrecisionToPosition(_){return parseFloat(_.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:_}=this;return"horizontal-reversed"===_||"vertical"===_}_isHorizontalLayout(){return this.layout.includes("horizontal")}_isReversedLayout(){return this.layout.includes("reversed")}_normalizeSegmentDetails(_){if(this._isPositionInverted()){const{min:v,max:O}=_;return{min:O,max:v}}return _}_parseInputValue(_,v,O){return this.inputParseFunction?this.inputParseFunction(_,v,O):this.viewModel.defaultInputParseFunction(_)}_formatInputValue(_,v,O){return this.inputFormatFunction?this.inputFormatFunction(_,v,O):this.viewModel.defaultInputFormatFunction(_)}_getAnchorDetails(_){const v=[...this.values].sort((D,w)=>D-w)[_],O=this.values.indexOf(v);return{index:O,position:this._getPositionOfElement(this._anchorElements[O]),value:v}}_updateAnchorStyle(_,v){const O=this._anchorElements[_];O&&(this._isHorizontalLayout()?O.style.left=`${v}`:O.style.top=`${v}`)}_getStyleForAnchor(_,v,O){const D=this._getPositionStyleForElement(_);if(1===this.values.length)return`${D}`;const w=this._zIndices[v];return`${D}; z-index: ${O?this._zIndexOffset+w:w}`}_getPositionStyleForElement(_){const v=this._positionFromValue(_),O=this._positionToPercent(v);return`${this._isHorizontalLayout()?"left":"top"}: ${O+"%"}`}_getPositionOfElement(_){const v=this._getDimensions(_.offsetParent),O=this._getDimensions(_);return this._isHorizontalLayout()?this._applyPrecisionToPosition(O.left-v.left):this._applyPrecisionToPosition(O.top-v.top)}_updateAnchorValues(_,v){_.forEach((O,D)=>this._toValue(O,v[D]))}_updateAnchorValuesByDifference(_){const{min:v,max:O,values:D}=this;D.forEach((w,te)=>this._toValue(te,Math.max(Math.min(w+_,O),v)))}_toValue(_,v){(0,lt.pC)(this.steps)&&(v=this._getStepValues()[this._getIndexOfNearestStepValue(v)]),this._updateAnchorStyle(_,this._getPositionStyleForElement(v)),this.viewModel.setValue(_,v)}_toPosition(_,v){const O=(0,lt.pC)(this.steps)?this._getStepValueForAnchorAtPosition(_,v):this._getValueForAnchorAtPosition(_,v);this._updateAnchorStyle(_,this._getPositionStyleForElement(O)),this.viewModel.setValue(_,O)}_getValueForAnchorAtPosition(_,v){const{min:O,max:D}=this._getAnchorBoundsInPixels(_),{min:w,max:te}=this.viewModel.getBoundsForValueAtIndex(_);let fe,Pe,Ue=null;return this._isPositionInverted()?(fe=w,Pe=te):(fe=te,Pe=w),Ue=v>D?fe:v<O?Pe:this._valueFromPosition(v),Ue>te?Ue=te:Ue<w&&(Ue=w),Ue}_getStepValueForAnchorAtPosition(_,v){const O=this._getStepValues(),D=this._calculateNearestStepPosition(v),w=this._getValueForAnchorAtPosition(_,D);return O[this._getIndexOfNearestStepValue(w)]}_getAnchorBoundsAsPercents(_){const{min:v,max:O}=this._getAnchorBoundsInPixels(_);return{min:this._positionToPercent(v),max:this._positionToPercent(O)}}_getAnchorBoundsInPixels(_){const{_anchorElements:v,_trackHeight:O,_trackWidth:D,effectiveMax:w,effectiveMin:te,thumbsConstrained:fe}=this,Pe=v[_-1],Ue=v[_+1],Xe=this._isHorizontalLayout()?D:O;let st,vt;return this._isPositionInverted()?(st=(0,lt.pC)(te)?this._positionFromValue(te):Xe,vt=(0,lt.pC)(w)?this._positionFromValue(w):0):(st=(0,lt.pC)(w)?this._positionFromValue(w):Xe,vt=(0,lt.pC)(te)?this._positionFromValue(te):0),fe?this._isPositionInverted()?{max:Pe?this._getPositionOfElement(Pe):st,min:Ue?this._getPositionOfElement(Ue):vt}:{max:Ue?this._getPositionOfElement(Ue):st,min:Pe?this._getPositionOfElement(Pe):vt}:{max:st,min:vt}}_getIndexOfNearestValue(_){return this.values.indexOf(this.values.reduce((v,O)=>Math.abs(O-_)<Math.abs(v-_)?O:v))}_getCursorPositionFromEvent(_){const v=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?_.clientX-v.left:_.clientY-v.top}_getStepValues(){const{steps:_}=this;if(Array.isArray(_))return _;const{max:v,min:O}=this,D=Math.ceil((v-O)/_),w=[];for(let te=0;te<=D;te++){const fe=O+_*te;w.push(fe>v?v:fe)}return w}_toStep(_,v){const{values:O,viewModel:D}=this,w=O[_],te=this._getStepValues(),fe=te.indexOf(w);let Pe=null;if(fe>-1){let Ue=te[fe+v];isNaN(Ue)&&(Ue=te[fe]);const Xe=this._positionFromValue(Ue);Pe=this._getStepValueForAnchorAtPosition(_,Xe)}else Pe=te[this._getIndexOfNearestStepValue(w)+v];D.setValue(_,Pe)}_getIndexOfNearestStepValue(_){const{steps:v}=this;if((0,lt.Wi)(v))return null;const O=this._getStepValues(),D=O.reduce((w,te)=>Math.abs(te-_)<Math.abs(w-_)?te:w);return O.indexOf(D)}_calculateNearestStepPosition(_){const v=this._valueFromPosition(_),O=this._getIndexOfNearestStepValue(v),D=this._getStepValues();return this._positionFromValue(D[O])}_getTickCounts(_,v){const{mode:O}=v;return"count"===O||"position"===O?_||0:"percent"===O&&100/_||0}_calculateTickPositions(_){return _.map(v=>this._positionFromValue(v))}_calculateEquidistantTickPositions(_){const{_trackWidth:v,_trackHeight:O}=this,D=this._isHorizontalLayout()?v:O,w=D/(_-1),te=[];if(1===_)return[D/2];for(let fe=0;fe<_;fe++){const Pe=fe*w;Pe<=D&&te.push(Pe)}return te}_getDimensions(_){try{return _.getBoundingClientRect()}catch(v){if("object"==typeof v&&null!==v)return new DOMRect(0,0,0,0);throw v}}_emitTrackClickEvent(_){this.emit("track-click",yi(or({},_),{type:"track-click"}))}_emitTickClickEvent(_){this.emit("tick-click",yi(or({},_),{type:"tick-click"}))}_emitMaxChangeEvent(_){this.emit("max-change",yi(or({},_),{type:"max-change"}))}_emitMinChangeEvent(_){this.emit("min-change",yi(or({},_),{type:"min-change"}))}_emitThumbChangeEvent(_){this.emit("thumb-change",yi(or({},_),{type:"thumb-change"}))}_emitThumbClickEvent(_){this.emit("thumb-click",yi(or({},_),{type:"thumb-click"}))}_emitThumbDragEvent(_){this.emit("thumb-drag",yi(or({},_),{type:"thumb-drag"}))}_emitSegmentClickEvent(_){this.emit("segment-click",yi(or({},_),{type:"segment-click"}))}_emitSegmentDragEvent(_){this.emit("segment-drag",yi(or({},_),{type:"segment-drag"}))}_emitRangeLabelClickEvent(_){this.emit(_.type,or({},_))}};(0,Ze._)([(0,nt.Cb)()],eo.prototype,"disabled",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"draggableSegmentsEnabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.effectiveMax")],eo.prototype,"effectiveMax",void 0),(0,Ze._)([(0,Ss.B)("viewModel.effectiveMin")],eo.prototype,"effectiveMin",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"effectiveSegmentElements",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"extraNodes",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"inputCreatedFunction",void 0),(0,Ze._)([(0,Ss.B)("viewModel.inputFormatFunction")],eo.prototype,"inputFormatFunction",void 0),(0,Ze._)([(0,Ss.B)("viewModel.inputParseFunction")],eo.prototype,"inputParseFunction",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],eo.prototype,"label",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"labelElements",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"labelInputsEnabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.labelFormatFunction")],eo.prototype,"labelFormatFunction",void 0),(0,Ze._)([(0,Ss.B)("viewModel.labels")],eo.prototype,"labels",void 0),(0,Ze._)([(0,nt.Cb)({value:"horizontal"})],eo.prototype,"layout",null),(0,Ze._)([(0,Ss.B)("viewModel.max")],eo.prototype,"max",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"maxLabelElement",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Slider/t9n/Slider")],eo.prototype,"messages",void 0),(0,Ze._)([(0,Ss.B)("viewModel.min")],eo.prototype,"min",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"minLabelElement",void 0),(0,Ze._)([(0,Ss.B)("viewModel.precision")],eo.prototype,"precision",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"rangeLabelInputsEnabled",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"segmentElements",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"snapOnClickEnabled",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"state",null),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"steps",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"syncedSegmentsEnabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.thumbsConstrained")],eo.prototype,"thumbsConstrained",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"thumbCreatedFunction",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"thumbElements",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"tickConfigs",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"tickElements",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],eo.prototype,"trackElement",void 0),(0,Ze._)([(0,Ss.B)("viewModel.values")],eo.prototype,"values",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"viewModel",void 0),(0,Ze._)([(0,nt.Cb)()],eo.prototype,"visibleElements",void 0),(0,Ze._)([(0,Ga.p)("visibleElements")],eo.prototype,"castVisibleElements",null),eo=(0,Ze._)([(0,ui.j)("esri.widgets.Slider")],eo);const wN=eo;function Ld(_){if(null==_)return window;if("[object Window]"!==_.toString()){var v=_.ownerDocument;return v&&v.defaultView||window}return _}function e_(_){return _ instanceof Ld(_).Element||_ instanceof Element}function Ud(_){return _ instanceof Ld(_).HTMLElement||_ instanceof HTMLElement}function JC(_){return"undefined"!=typeof ShadowRoot&&(_ instanceof Ld(_).ShadowRoot||_ instanceof ShadowRoot)}var t_=Math.max,LE=Math.min,cm=Math.round;function XC(){var _=navigator.userAgentData;return null!=_&&_.brands?_.brands.map(function(v){return v.brand+"/"+v.version}).join(" "):navigator.userAgent}function pA(){return!/^((?!chrome|android).)*safari/i.test(XC())}function um(_,v,O){void 0===v&&(v=!1),void 0===O&&(O=!1);var D=_.getBoundingClientRect(),w=1,te=1;v&&Ud(_)&&(w=_.offsetWidth>0&&cm(D.width)/_.offsetWidth||1,te=_.offsetHeight>0&&cm(D.height)/_.offsetHeight||1);var Pe=(e_(_)?Ld(_):window).visualViewport,Ue=!pA()&&O,Xe=(D.left+(Ue&&Pe?Pe.offsetLeft:0))/w,st=(D.top+(Ue&&Pe?Pe.offsetTop:0))/te,vt=D.width/w,Ct=D.height/te;return{width:vt,height:Ct,top:st,right:Xe+vt,bottom:st+Ct,left:Xe,x:Xe,y:st}}function QC(_){var v=Ld(_);return{scrollLeft:v.pageXOffset,scrollTop:v.pageYOffset}}function tp(_){return _?(_.nodeName||"").toLowerCase():null}function af(_){return((e_(_)?_.ownerDocument:_.document)||window.document).documentElement}function qC(_){return um(af(_)).left+QC(_).scrollLeft}function Qp(_){return Ld(_).getComputedStyle(_)}function eT(_){var v=Qp(_);return/auto|scroll|overlay|hidden/.test(v.overflow+v.overflowY+v.overflowX)}function BN(_,v,O){void 0===O&&(O=!1);var D=Ud(v),w=Ud(v)&&function UN(_){var v=_.getBoundingClientRect(),O=cm(v.width)/_.offsetWidth||1,D=cm(v.height)/_.offsetHeight||1;return 1!==O||1!==D}(v),te=af(v),fe=um(_,w,O),Pe={scrollLeft:0,scrollTop:0},Ue={x:0,y:0};return(D||!D&&!O)&&(("body"!==tp(v)||eT(te))&&(Pe=function LN(_){return _!==Ld(_)&&Ud(_)?function IN(_){return{scrollLeft:_.scrollLeft,scrollTop:_.scrollTop}}(_):QC(_)}(v)),Ud(v)?((Ue=um(v,!0)).x+=v.clientLeft,Ue.y+=v.clientTop):te&&(Ue.x=qC(te))),{x:fe.left+Pe.scrollLeft-Ue.x,y:fe.top+Pe.scrollTop-Ue.y,width:fe.width,height:fe.height}}function tT(_){var v=um(_),O=_.offsetWidth,D=_.offsetHeight;return Math.abs(v.width-O)<=1&&(O=v.width),Math.abs(v.height-D)<=1&&(D=v.height),{x:_.offsetLeft,y:_.offsetTop,width:O,height:D}}function UE(_){return"html"===tp(_)?_:_.assignedSlot||_.parentNode||(JC(_)?_.host:null)||af(_)}function fA(_){return["html","body","#document"].indexOf(tp(_))>=0?_.ownerDocument.body:Ud(_)&&eT(_)?_:fA(UE(_))}function $g(_,v){var O;void 0===v&&(v=[]);var D=fA(_),w=D===(null==(O=_.ownerDocument)?void 0:O.body),te=Ld(D),fe=w?[te].concat(te.visualViewport||[],eT(D)?D:[]):D,Pe=v.concat(fe);return w?Pe:Pe.concat($g(UE(fe)))}function NN(_){return["table","td","th"].indexOf(tp(_))>=0}function _A(_){return Ud(_)&&"fixed"!==Qp(_).position?_.offsetParent:null}function kg(_){for(var v=Ld(_),O=_A(_);O&&NN(O)&&"static"===Qp(O).position;)O=_A(O);return O&&("html"===tp(O)||"body"===tp(O)&&"static"===Qp(O).position)?v:O||function jN(_){var v=/firefox/i.test(XC());if(/Trident/i.test(XC())&&Ud(_)&&"fixed"===Qp(_).position)return null;var w=UE(_);for(JC(w)&&(w=w.host);Ud(w)&&["html","body"].indexOf(tp(w))<0;){var te=Qp(w);if("none"!==te.transform||"none"!==te.perspective||"paint"===te.contain||-1!==["transform","perspective"].indexOf(te.willChange)||v&&"filter"===te.willChange||v&&te.filter&&"none"!==te.filter)return w;w=w.parentNode}return null}(_)||v}var Uu="top",Bd="bottom",Nd="right",Bu="left",rT="auto",Yg=[Uu,Bd,Nd,Bu],dm="start",Jg="end",mA="viewport",Xg="popper",gA=Yg.reduce(function(_,v){return _.concat([v+"-"+dm,v+"-"+Jg])},[]),yA=[].concat(Yg,[rT]).reduce(function(_,v){return _.concat([v,v+"-"+dm,v+"-"+Jg])},[]),JN=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function XN(_){var v=new Map,O=new Set,D=[];function w(te){O.add(te.name),[].concat(te.requires||[],te.requiresIfExists||[]).forEach(function(Pe){if(!O.has(Pe)){var Ue=v.get(Pe);Ue&&w(Ue)}}),D.push(te)}return _.forEach(function(te){v.set(te.name,te)}),_.forEach(function(te){O.has(te.name)||w(te)}),D}function qN(_){var v;return function(){return v||(v=new Promise(function(O){Promise.resolve().then(function(){v=void 0,O(_())})})),v}}var vA={placement:"bottom",modifiers:[],strategy:"absolute"};function EA(){for(var _=arguments.length,v=new Array(_),O=0;O<_;O++)v[O]=arguments[O];return!v.some(function(D){return!(D&&"function"==typeof D.getBoundingClientRect)})}function t9(_){void 0===_&&(_={});var O=_.defaultModifiers,D=void 0===O?[]:O,w=_.defaultOptions,te=void 0===w?vA:w;return function(Pe,Ue,Xe){void 0===Xe&&(Xe=te);var st={placement:"bottom",orderedModifiers:[],options:Object.assign({},vA,te),modifiersData:{},elements:{reference:Pe,popper:Ue},attributes:{},styles:{}},vt=[],Ct=!1,Wt={state:st,setOptions:function(sr){var Er="function"==typeof sr?sr(st.options):sr;Lt(),st.options=Object.assign({},te,st.options,Er),st.scrollParents={reference:e_(Pe)?$g(Pe):Pe.contextElement?$g(Pe.contextElement):[],popper:$g(Ue)};var yr=function QN(_){var v=XN(_);return JN.reduce(function(O,D){return O.concat(v.filter(function(w){return w.phase===D}))},[])}(function e9(_){var v=_.reduce(function(O,D){var w=O[D.name];return O[D.name]=w?Object.assign({},w,D,{options:Object.assign({},w.options,D.options),data:Object.assign({},w.data,D.data)}):D,O},{});return Object.keys(v).map(function(O){return v[O]})}([].concat(D,st.options.modifiers)));return st.orderedModifiers=yr.filter(function(Fi){return Fi.enabled}),function Kt(){st.orderedModifiers.forEach(function(nr){var Er=nr.options,br=nr.effect;if("function"==typeof br){var Rr=br({state:st,name:nr.name,instance:Wt,options:void 0===Er?{}:Er});vt.push(Rr||function(){})}})}(),Wt.update()},forceUpdate:function(){if(!Ct){var sr=st.elements,Er=sr.reference,yr=sr.popper;if(EA(Er,yr)){st.rects={reference:BN(Er,kg(yr),"fixed"===st.options.strategy),popper:tT(yr)},st.reset=!1,st.placement=st.options.placement,st.orderedModifiers.forEach(function(Fi){return st.modifiersData[Fi.name]=Object.assign({},Fi.data)});for(var Rr=0;Rr<st.orderedModifiers.length;Rr++)if(!0!==st.reset){var $r=st.orderedModifiers[Rr],si=$r.fn,Ci=$r.options;"function"==typeof si&&(st=si({state:st,options:void 0===Ci?{}:Ci,name:$r.name,instance:Wt})||st)}else st.reset=!1,Rr=-1}}},update:qN(function(){return new Promise(function(nr){Wt.forceUpdate(),nr(st)})}),destroy:function(){Lt(),Ct=!0}};if(!EA(Pe,Ue))return Wt;function Lt(){vt.forEach(function(nr){return nr()}),vt=[]}return Wt.setOptions(Xe).then(function(nr){!Ct&&Xe.onFirstUpdate&&Xe.onFirstUpdate(nr)}),Wt}}var BE={passive:!0};const i9={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function r9(_){var v=_.state,O=_.instance,D=_.options,w=D.scroll,te=void 0===w||w,fe=D.resize,Pe=void 0===fe||fe,Ue=Ld(v.elements.popper),Xe=[].concat(v.scrollParents.reference,v.scrollParents.popper);return te&&Xe.forEach(function(st){st.addEventListener("scroll",O.update,BE)}),Pe&&Ue.addEventListener("resize",O.update,BE),function(){te&&Xe.forEach(function(st){st.removeEventListener("scroll",O.update,BE)}),Pe&&Ue.removeEventListener("resize",O.update,BE)}},data:{}};function rp(_){return _.split("-")[0]}function hm(_){return _.split("-")[1]}function iT(_){return["top","bottom"].indexOf(_)>=0?"x":"y"}function bA(_){var Ue,v=_.reference,O=_.element,D=_.placement,w=D?rp(D):null,te=D?hm(D):null,fe=v.x+v.width/2-O.width/2,Pe=v.y+v.height/2-O.height/2;switch(w){case Uu:Ue={x:fe,y:v.y-O.height};break;case Bd:Ue={x:fe,y:v.y+v.height};break;case Nd:Ue={x:v.x+v.width,y:Pe};break;case Bu:Ue={x:v.x-O.width,y:Pe};break;default:Ue={x:v.x,y:v.y}}var Xe=w?iT(w):null;if(null!=Xe){var st="y"===Xe?"height":"width";switch(te){case dm:Ue[Xe]=Ue[Xe]-(v[st]/2-O[st]/2);break;case Jg:Ue[Xe]=Ue[Xe]+(v[st]/2-O[st]/2)}}return Ue}const n9={name:"popperOffsets",enabled:!0,phase:"read",fn:function s9(_){var v=_.state;v.modifiersData[_.name]=bA({reference:v.rects.reference,element:v.rects.popper,strategy:"absolute",placement:v.placement})},data:{}};var o9={top:"auto",right:"auto",bottom:"auto",left:"auto"};function CA(_){var v,O=_.popper,D=_.popperRect,w=_.placement,te=_.variation,fe=_.offsets,Pe=_.position,Ue=_.gpuAcceleration,Xe=_.adaptive,st=_.roundOffsets,vt=_.isFixed,Ct=fe.x,Wt=void 0===Ct?0:Ct,Kt=fe.y,Lt=void 0===Kt?0:Kt,nr="function"==typeof st?st({x:Wt,y:Lt}):{x:Wt,y:Lt};Wt=nr.x,Lt=nr.y;var sr=fe.hasOwnProperty("x"),Er=fe.hasOwnProperty("y"),yr=Bu,br=Uu,Rr=window;if(Xe){var $r=kg(O),si="clientHeight",Ci="clientWidth";$r===Ld(O)&&"static"!==Qp($r=af(O)).position&&"absolute"===Pe&&(si="scrollHeight",Ci="scrollWidth"),(w===Uu||(w===Bu||w===Nd)&&te===Jg)&&(br=Bd,Lt-=(vt&&$r===Rr&&Rr.visualViewport?Rr.visualViewport.height:$r[si])-D.height,Lt*=Ue?1:-1),w!==Bu&&(w!==Uu&&w!==Bd||te!==Jg)||(yr=Nd,Wt-=(vt&&$r===Rr&&Rr.visualViewport?Rr.visualViewport.width:$r[Ci])-D.width,Wt*=Ue?1:-1)}var rs,Fi=Object.assign({position:Pe},Xe&&o9),Xi=!0===st?function a9(_){var O=_.y,w=window.devicePixelRatio||1;return{x:cm(_.x*w)/w||0,y:cm(O*w)/w||0}}({x:Wt,y:Lt}):{x:Wt,y:Lt};return Wt=Xi.x,Lt=Xi.y,Object.assign({},Fi,Ue?((rs={})[br]=Er?"0":"",rs[yr]=sr?"0":"",rs.transform=(Rr.devicePixelRatio||1)<=1?"translate("+Wt+"px, "+Lt+"px)":"translate3d("+Wt+"px, "+Lt+"px, 0)",rs):((v={})[br]=Er?Lt+"px":"",v[yr]=sr?Wt+"px":"",v.transform="",v))}const c9={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function l9(_){var v=_.state,O=_.options,D=O.gpuAcceleration,w=void 0===D||D,te=O.adaptive,fe=void 0===te||te,Pe=O.roundOffsets,Ue=void 0===Pe||Pe,st={placement:rp(v.placement),variation:hm(v.placement),popper:v.elements.popper,popperRect:v.rects.popper,gpuAcceleration:w,isFixed:"fixed"===v.options.strategy};null!=v.modifiersData.popperOffsets&&(v.styles.popper=Object.assign({},v.styles.popper,CA(Object.assign({},st,{offsets:v.modifiersData.popperOffsets,position:v.options.strategy,adaptive:fe,roundOffsets:Ue})))),null!=v.modifiersData.arrow&&(v.styles.arrow=Object.assign({},v.styles.arrow,CA(Object.assign({},st,{offsets:v.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:Ue})))),v.attributes.popper=Object.assign({},v.attributes.popper,{"data-popper-placement":v.placement})},data:{}},h9={name:"applyStyles",enabled:!0,phase:"write",fn:function u9(_){var v=_.state;Object.keys(v.elements).forEach(function(O){var D=v.styles[O]||{},w=v.attributes[O]||{},te=v.elements[O];!Ud(te)||!tp(te)||(Object.assign(te.style,D),Object.keys(w).forEach(function(fe){var Pe=w[fe];!1===Pe?te.removeAttribute(fe):te.setAttribute(fe,!0===Pe?"":Pe)}))})},effect:function d9(_){var v=_.state,O={popper:{position:v.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(v.elements.popper.style,O.popper),v.styles=O,v.elements.arrow&&Object.assign(v.elements.arrow.style,O.arrow),function(){Object.keys(v.elements).forEach(function(D){var w=v.elements[D],te=v.attributes[D]||{},Pe=Object.keys(v.styles.hasOwnProperty(D)?v.styles[D]:O[D]).reduce(function(Ue,Xe){return Ue[Xe]="",Ue},{});!Ud(w)||!tp(w)||(Object.assign(w.style,Pe),Object.keys(te).forEach(function(Ue){w.removeAttribute(Ue)}))})}},requires:["computeStyles"]},_9={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function f9(_){var v=_.state,D=_.name,w=_.options.offset,te=void 0===w?[0,0]:w,fe=yA.reduce(function(st,vt){return st[vt]=function p9(_,v,O){var D=rp(_),w=[Bu,Uu].indexOf(D)>=0?-1:1,te="function"==typeof O?O(Object.assign({},v,{placement:_})):O,fe=te[0],Pe=te[1];return fe=fe||0,Pe=(Pe||0)*w,[Bu,Nd].indexOf(D)>=0?{x:Pe,y:fe}:{x:fe,y:Pe}}(vt,v.rects,te),st},{}),Pe=fe[v.placement],Xe=Pe.y;null!=v.modifiersData.popperOffsets&&(v.modifiersData.popperOffsets.x+=Pe.x,v.modifiersData.popperOffsets.y+=Xe),v.modifiersData[D]=fe}};var m9={left:"right",right:"left",bottom:"top",top:"bottom"};function NE(_){return _.replace(/left|right|bottom|top/g,function(v){return m9[v]})}var g9={start:"end",end:"start"};function TA(_){return _.replace(/start|end/g,function(v){return g9[v]})}function MA(_,v){var O=v.getRootNode&&v.getRootNode();if(_.contains(v))return!0;if(O&&JC(O)){var D=v;do{if(D&&_.isSameNode(D))return!0;D=D.parentNode||D.host}while(D)}return!1}function sT(_){return Object.assign({},_,{left:_.x,top:_.y,right:_.x+_.width,bottom:_.y+_.height})}function OA(_,v,O){return v===mA?sT(function y9(_,v){var O=Ld(_),D=af(_),w=O.visualViewport,te=D.clientWidth,fe=D.clientHeight,Pe=0,Ue=0;if(w){te=w.width,fe=w.height;var Xe=pA();(Xe||!Xe&&"fixed"===v)&&(Pe=w.offsetLeft,Ue=w.offsetTop)}return{width:te,height:fe,x:Pe+qC(_),y:Ue}}(_,O)):e_(v)?function E9(_,v){var O=um(_,!1,"fixed"===v);return O.top=O.top+_.clientTop,O.left=O.left+_.clientLeft,O.bottom=O.top+_.clientHeight,O.right=O.left+_.clientWidth,O.width=_.clientWidth,O.height=_.clientHeight,O.x=O.left,O.y=O.top,O}(v,O):sT(function v9(_){var v,O=af(_),D=QC(_),w=null==(v=_.ownerDocument)?void 0:v.body,te=t_(O.scrollWidth,O.clientWidth,w?w.scrollWidth:0,w?w.clientWidth:0),fe=t_(O.scrollHeight,O.clientHeight,w?w.scrollHeight:0,w?w.clientHeight:0),Pe=-D.scrollLeft+qC(_),Ue=-D.scrollTop;return"rtl"===Qp(w||O).direction&&(Pe+=t_(O.clientWidth,w?w.clientWidth:0)-te),{width:te,height:fe,x:Pe,y:Ue}}(af(_)))}function xA(_){return Object.assign({},{top:0,right:0,bottom:0,left:0},_)}function DA(_,v){return v.reduce(function(O,D){return O[D]=_,O},{})}function Qg(_,v){void 0===v&&(v={});var D=v.placement,w=void 0===D?_.placement:D,te=v.strategy,fe=void 0===te?_.strategy:te,Pe=v.boundary,Ue=void 0===Pe?"clippingParents":Pe,Xe=v.rootBoundary,st=void 0===Xe?mA:Xe,vt=v.elementContext,Ct=void 0===vt?Xg:vt,Wt=v.altBoundary,Kt=void 0!==Wt&&Wt,Lt=v.padding,nr=void 0===Lt?0:Lt,sr=xA("number"!=typeof nr?nr:DA(nr,Yg)),yr=_.rects.popper,br=_.elements[Kt?Ct===Xg?"reference":Xg:Ct],Rr=function C9(_,v,O,D){var w="clippingParents"===v?function b9(_){var v=$g(UE(_)),D=["absolute","fixed"].indexOf(Qp(_).position)>=0&&Ud(_)?kg(_):_;return e_(D)?v.filter(function(w){return e_(w)&&MA(w,D)&&"body"!==tp(w)}):[]}(_):[].concat(v),te=[].concat(w,[O]),Pe=te.reduce(function(Ue,Xe){var st=OA(_,Xe,D);return Ue.top=t_(st.top,Ue.top),Ue.right=LE(st.right,Ue.right),Ue.bottom=LE(st.bottom,Ue.bottom),Ue.left=t_(st.left,Ue.left),Ue},OA(_,te[0],D));return Pe.width=Pe.right-Pe.left,Pe.height=Pe.bottom-Pe.top,Pe.x=Pe.left,Pe.y=Pe.top,Pe}(e_(br)?br:br.contextElement||af(_.elements.popper),Ue,st,fe),$r=um(_.elements.reference),si=bA({reference:$r,element:yr,strategy:"absolute",placement:w}),Ci=sT(Object.assign({},yr,si)),Ti=Ct===Xg?Ci:$r,ki={top:Rr.top-Ti.top+sr.top,bottom:Ti.bottom-Rr.bottom+sr.bottom,left:Rr.left-Ti.left+sr.left,right:Ti.right-Rr.right+sr.right},Fi=_.modifiersData.offset;if(Ct===Xg&&Fi){var Xi=Fi[w];Object.keys(ki).forEach(function(rs){var Es=[Nd,Bd].indexOf(rs)>=0?1:-1,Gs=[Uu,Bd].indexOf(rs)>=0?"y":"x";ki[rs]+=Xi[Gs]*Es})}return ki}const P9={name:"flip",enabled:!0,phase:"main",fn:function O9(_){var v=_.state,O=_.options,D=_.name;if(!v.modifiersData[D]._skip){for(var w=O.mainAxis,te=void 0===w||w,fe=O.altAxis,Pe=void 0===fe||fe,Ue=O.fallbackPlacements,Xe=O.padding,st=O.boundary,vt=O.rootBoundary,Ct=O.altBoundary,Wt=O.flipVariations,Kt=void 0===Wt||Wt,Lt=O.allowedAutoPlacements,nr=v.options.placement,sr=rp(nr),yr=Ue||(sr!==nr&&Kt?function M9(_){if(rp(_)===rT)return[];var v=NE(_);return[TA(_),v,TA(v)]}(nr):[NE(nr)]),br=[nr].concat(yr).reduce(function(Qi,As){return Qi.concat(rp(As)===rT?function T9(_,v){void 0===v&&(v={});var w=v.boundary,te=v.rootBoundary,fe=v.padding,Pe=v.flipVariations,Ue=v.allowedAutoPlacements,Xe=void 0===Ue?yA:Ue,st=hm(v.placement),vt=st?Pe?gA:gA.filter(function(Kt){return hm(Kt)===st}):Yg,Ct=vt.filter(function(Kt){return Xe.indexOf(Kt)>=0});0===Ct.length&&(Ct=vt);var Wt=Ct.reduce(function(Kt,Lt){return Kt[Lt]=Qg(_,{placement:Lt,boundary:w,rootBoundary:te,padding:fe})[rp(Lt)],Kt},{});return Object.keys(Wt).sort(function(Kt,Lt){return Wt[Kt]-Wt[Lt]})}(v,{placement:As,boundary:st,rootBoundary:vt,padding:Xe,flipVariations:Kt,allowedAutoPlacements:Lt}):As)},[]),Rr=v.rects.reference,$r=v.rects.popper,si=new Map,Ci=!0,Ti=br[0],ki=0;ki<br.length;ki++){var Fi=br[ki],Xi=rp(Fi),rs=hm(Fi)===dm,Es=[Uu,Bd].indexOf(Xi)>=0,Gs=Es?"width":"height",ws=Qg(v,{placement:Fi,boundary:st,rootBoundary:vt,altBoundary:Ct,padding:Xe}),$i=Es?rs?Nd:Bu:rs?Bd:Uu;Rr[Gs]>$r[Gs]&&($i=NE($i));var qi=NE($i),as=[];if(te&&as.push(ws[Xi]<=0),Pe&&as.push(ws[$i]<=0,ws[qi]<=0),as.every(function(Qi){return Qi})){Ti=Fi,Ci=!1;break}si.set(Fi,as)}if(Ci)for(var en=function(As){var Is=br.find(function(Qs){var Ns=si.get(Qs);if(Ns)return Ns.slice(0,As).every(function(an){return an})});if(Is)return Ti=Is,"break"},Cs=Kt?3:1;Cs>0&&"break"!==en(Cs);Cs--);v.placement!==Ti&&(v.modifiersData[D]._skip=!0,v.placement=Ti,v.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function qg(_,v,O){return t_(_,LE(v,O))}const S9={name:"preventOverflow",enabled:!0,phase:"main",fn:function A9(_){var v=_.state,O=_.options,D=_.name,w=O.mainAxis,te=void 0===w||w,fe=O.altAxis,Pe=void 0!==fe&&fe,Ct=O.tether,Wt=void 0===Ct||Ct,Kt=O.tetherOffset,Lt=void 0===Kt?0:Kt,nr=Qg(v,{boundary:O.boundary,rootBoundary:O.rootBoundary,padding:O.padding,altBoundary:O.altBoundary}),sr=rp(v.placement),Er=hm(v.placement),yr=!Er,br=iT(sr),Rr=function x9(_){return"x"===_?"y":"x"}(br),$r=v.modifiersData.popperOffsets,si=v.rects.reference,Ci=v.rects.popper,Ti="function"==typeof Lt?Lt(Object.assign({},v.rects,{placement:v.placement})):Lt,ki="number"==typeof Ti?{mainAxis:Ti,altAxis:Ti}:Object.assign({mainAxis:0,altAxis:0},Ti),Fi=v.modifiersData.offset?v.modifiersData.offset[v.placement]:null,Xi={x:0,y:0};if($r){if(te){var rs,Es="y"===br?Uu:Bu,Gs="y"===br?Bd:Nd,ws="y"===br?"height":"width",$i=$r[br],qi=$i+nr[Es],as=$i-nr[Gs],bs=Wt?-Ci[ws]/2:0,en=Er===dm?si[ws]:Ci[ws],Cs=Er===dm?-Ci[ws]:-si[ws],xi=v.elements.arrow,Qi=Wt&&xi?tT(xi):{width:0,height:0},As=v.modifiersData["arrow#persistent"]?v.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Is=As[Es],Qs=As[Gs],Ns=qg(0,si[ws],Qi[ws]),an=yr?si[ws]/2-bs-Ns-Is-ki.mainAxis:en-Ns-Is-ki.mainAxis,dn=yr?-si[ws]/2+bs+Ns+Qs+ki.mainAxis:Cs+Ns+Qs+ki.mainAxis,ao=v.elements.arrow&&kg(v.elements.arrow),ua=null!=(rs=null==Fi?void 0:Fi[br])?rs:0,Co=$i+dn-ua,so=qg(Wt?LE(qi,$i+an-ua-(ao?"y"===br?ao.clientTop||0:ao.clientLeft||0:0)):qi,$i,Wt?t_(as,Co):as);$r[br]=so,Xi[br]=so-$i}if(Pe){var Po,Uo=$r[Rr],ko="y"===Rr?"height":"width",yh=Uo+nr["x"===br?Uu:Bu],jd=Uo-nr["x"===br?Bd:Nd],ju=-1!==[Uu,Bu].indexOf(sr),vh=null!=(Po=null==Fi?void 0:Fi[Rr])?Po:0,Eh=ju?yh:Uo-si[ko]-Ci[ko]-vh+ki.altAxis,ap=ju?Uo+si[ko]+Ci[ko]-vh-ki.altAxis:jd,ff=Wt&&ju?function D9(_,v,O){var D=qg(_,v,O);return D>O?O:D}(Eh,Uo,ap):qg(Wt?Eh:yh,Uo,Wt?ap:jd);$r[Rr]=ff,Xi[Rr]=ff-Uo}v.modifiersData[D]=Xi}},requiresIfExists:["offset"]},L9={name:"arrow",enabled:!0,phase:"main",fn:function w9(_){var v,O=_.state,D=_.name,w=_.options,te=O.elements.arrow,fe=O.modifiersData.popperOffsets,Pe=rp(O.placement),Ue=iT(Pe),st=[Bu,Nd].indexOf(Pe)>=0?"height":"width";if(te&&fe){var vt=function(v,O){return xA("number"!=typeof(v="function"==typeof v?v(Object.assign({},O.rects,{placement:O.placement})):v)?v:DA(v,Yg))}(w.padding,O),Ct=tT(te),Wt="y"===Ue?Uu:Bu,Kt="y"===Ue?Bd:Nd,Lt=O.rects.reference[st]+O.rects.reference[Ue]-fe[Ue]-O.rects.popper[st],nr=fe[Ue]-O.rects.reference[Ue],sr=kg(te),Er=sr?"y"===Ue?sr.clientHeight||0:sr.clientWidth||0:0,$r=Er/2-Ct[st]/2+(Lt/2-nr/2),si=qg(vt[Wt],$r,Er-Ct[st]-vt[Kt]);O.modifiersData[D]=((v={})[Ue]=si,v.centerOffset=si-$r,v)}},effect:function I9(_){var v=_.state,D=_.options.element,w=void 0===D?"[data-popper-arrow]":D;null!=w&&("string"==typeof w&&!(w=v.elements.popper.querySelector(w))||!MA(v.elements.popper,w)||(v.elements.arrow=w))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function AA(_,v,O){return void 0===O&&(O={x:0,y:0}),{top:_.top-v.height-O.y,right:_.right-v.width+O.x,bottom:_.bottom-v.height+O.y,left:_.left-v.width-O.x}}function SA(_){return[Uu,Nd,Bd,Bu].some(function(v){return _[v]>=0})}var B9=[i9,n9,c9,h9,_9,P9,S9,L9,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function U9(_){var v=_.state,O=_.name,D=v.rects.reference,w=v.rects.popper,te=v.modifiersData.preventOverflow,fe=Qg(v,{elementContext:"reference"}),Pe=Qg(v,{altBoundary:!0}),Ue=AA(fe,D),Xe=AA(Pe,w,te),st=SA(Ue),vt=SA(Xe);v.modifiersData[O]={referenceClippingOffsets:Ue,popperEscapeOffsets:Xe,isReferenceHidden:st,hasPopperEscaped:vt},v.attributes.popper=Object.assign({},v.attributes.popper,{"data-popper-reference-hidden":st,"data-popper-escaped":vt})}}],N9=t9({defaultModifiers:B9});const j9=["bottom","bottom-start","bottom-end","left","left-start","left-end","right","right-start","right-end","top","top-start","top-end"],F9={position:"fixed","z-index":"1000"};let ip=class extends wu.Z{constructor(_,v){super(_,v),this._popper=null,this._contentNode=null,this._renderAttached=!1,this._rootNode=null,this.anchorElement=null,this.offset=[0,0],this.open=!1,this.renderContentFunction=null,this._afterRootCreate=O=>{this._rootNode=O},this._afterContentCreate=O=>{this._contentNode=O},this._updatePosition=()=>{(0,lt.pC)(this._popper)&&this._popper.update()}}initialize(){this.when(()=>{this.destroyed||(this._projector.append(document.body,this.render),this._renderAttached=!0)}),this.own([(0,pt.YP)(()=>[this.open,this.anchorElement],()=>this._buildPopper(),pt.nn),(0,pt.YP)(()=>[this.placement,this.offset],()=>this._setPopperOptions(),pt.nn)])}destroy(){this.owner=null,this.anchorElement=null,this.renderContentFunction=null,this._renderAttached&&(this._projector.detach(this.render),this._renderAttached=!1),(0,lt.pC)(this._rootNode)&&((0,zc.Od)(this._rootNode),this._rootNode=null),this._contentNode=null,(0,lt.pC)(this._popper)&&(this._popper.destroy(),this._popper=null)}set container(_){}set owner(_){this._set("owner",_)}get placement(){return"top"}set placement(_){j9.includes(_)?this._override("placement",_):this._clearOverride("placement")}render(){var D;const{open:_,owner:v,renderContentFunction:O}=this;return(0,pi.u)("div",{afterCreate:this._afterRootCreate,class:this.classes("esri-popover",_?"esri-popover--open":null),styles:F9},(0,pi.u)("div",{dir:(0,Nl.XP)(null==(D=this.owner)?void 0:D.container),afterCreate:this._afterContentCreate,afterUpdate:this._updatePosition},_&&(null==O?void 0:O.call(v))))}_buildPopper(){(0,lt.pC)(this._popper)&&(this._popper.destroy(),this._popper=null);const _=this._contentNode;if((0,lt.Wi)(_)||!this.open||!this.renderContentFunction)return;const v=this._getAnchor();v&&(this._popper=N9(v,_),this._setPopperOptions())}_setPopperOptions(){const{placement:_,offset:v,_popper:O}=this;(0,lt.Wi)(O)||(O.setOptions({placement:_,modifiers:[{name:"offset",options:{offset:v}}]}),O.forceUpdate())}_getAnchor(){const{anchorElement:_}=this;return(0,zc.L7)("function"==typeof _?_():_)}};(0,Ze._)([(0,nt.Cb)()],ip.prototype,"anchorElement",void 0),(0,Ze._)([(0,nt.Cb)()],ip.prototype,"container",null),(0,Ze._)([(0,nt.Cb)()],ip.prototype,"offset",void 0),(0,Ze._)([(0,nt.Cb)()],ip.prototype,"open",void 0),(0,Ze._)([(0,nt.Cb)()],ip.prototype,"owner",null),(0,Ze._)([(0,nt.Cb)()],ip.prototype,"placement",null),(0,Ze._)([(0,nt.Cb)()],ip.prototype,"renderContentFunction",void 0),ip=(0,Ze._)([(0,ui.j)("esri.widgets.support.Popover")],ip);const wA=ip;let sp=class extends wN{constructor(_,v){super(_,v),this.viewModel=new Jp,this.buttonTooltip="",this.showDropDown=!0,this.currentIndex=0,this._dropdownAnchor=null,this._dropdownElement=null,this._popover=new wA({owner:this,placement:"bottom-start",anchorElement:()=>(0,lt.Wg)(this._dropdownAnchor),renderContentFunction:()=>this._renderPopover()})}initialize(){this.own((0,pt.YP)(()=>this.viewModel.isDropdownOpen,_=>{this._popover.open=_},pt.nn))}destroy(){this._popover.destroy()}renderThumbLabel(_){return(0,pi.u)("div",{class:this.classes("esri-slider-with-dropdown__box","esri-slider__label",{"esri-slider-with-dropdown__box--drop-down-on":this.showDropDown,"esri-slider-with-dropdown__box--drop-down-off":!this.showDropDown})},super.renderThumbLabel(_),this.showDropDown&&(0,pi.u)("div",{bind:this,afterCreate:this._onDropdownAnchorAfterCreate,class:"esri-slider-with-dropdown__dropdown-root"},(0,pi.u)("button",{class:this.classes("esri-interactive"," esri-widget__anchor esri-slider-with-dropdown__anchor",this.isDropdownOpen?"esri-slider-with-dropdown__anchor--open":"esri-slider-with-dropdown__anchor--closed"),bind:this,disabled:this.disabled,onclick:this._onAnchorClick,onpointerdown:this._killEvent,"aria-label":this.buttonTooltip,title:this.buttonTooltip,"aria-expanded":this.isDropdownOpen.toString(),"aria-haspopup":"listbox",type:"button"},this.currentItem?this.currentItem.name+" ":"")))}_onDropdownAnchorAfterCreate(_){this._dropdownAnchor=_}_renderPopover(){return(0,pi.u)("ol",{role:"listbox",afterCreate:this._onDropdownAfterCreate,"aria-label":this.buttonTooltip,bind:this,class:this.classes("esri-slider-with-dropdown__list"),tabindex:"-1",onkeydown:this._onDropdownKeyDown,onfocusout:this._onDropdownFocusOut,onpointerdown:this._killEvent},this.items.map((_,v)=>(0,pi.u)("li",{class:v===this.currentIndex?this.classes("esri-interactive","esri-slider-with-dropdown__list-item","esri-slider-with-dropdown__list-item--selected"):this.classes("esri-interactive","esri-slider-with-dropdown__list-item"),bind:this,onclick:this._onDropdownItemClick,"data-result":v,"aria-label":_.label.join(" "),role:"option","aria-selected":(v===this.currentIndex).toString(),onkeydown:this._onLiKeyDown,tabindex:"0"},_.label.map(O=>(0,pi.u)("span",{bind:this},O)))))}_onDropdownAfterCreate(_){var O;this._dropdownElement=_;const v=null!=(O=_.querySelector(".esri-slider-with-dropdown__list-item--selected"))?O:_.firstChild;(0,lt.pC)(v)&&v instanceof HTMLElement&&(v.scrollIntoView(),v.focus())}_onAnchorClick(){return!this.disabled&&(this.viewModel.toggle(),!0)}_onDropdownItemClick(_){this.viewModel.selectItem(_.currentTarget["data-result"])}_onDropdownFocusOut(_){let v=_.relatedTarget;null===v&&(v=document.activeElement),(0,lt.pC)(this._dropdownElement)&&!this._dropdownElement.contains(v)&&(0,lt.pC)(this._dropdownAnchor)&&!this._dropdownAnchor.contains(v)&&(this.viewModel.isDropdownOpen=!1)}_killEvent(_){return _.stopPropagation(),!0}_onDropdownKeyDown(_){_.stopPropagation(),"Escape"===(0,mt.kK)(_)&&(this.viewModel.isDropdownOpen=!1)}_onLiKeyDown(_){const v=_.target;switch((0,mt.kK)(_)){case"ArrowUp":v.previousElementSibling&&v.previousElementSibling.focus();break;case"ArrowDown":v.nextElementSibling&&v.nextElementSibling.focus();break;case"Enter":v.click()}}};(0,Ze._)([(0,nt.Cb)()],sp.prototype,"viewModel",void 0),(0,Ze._)([(0,nt.Cb)()],sp.prototype,"buttonTooltip",void 0),(0,Ze._)([(0,nt.Cb)()],sp.prototype,"showDropDown",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"viewModel.items"})],sp.prototype,"items",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"viewModel.currentIndex"})],sp.prototype,"currentIndex",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"viewModel.currentItem"})],sp.prototype,"currentItem",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:"viewModel.isDropdownOpen"})],sp.prototype,"isDropdownOpen",void 0),sp=(0,Ze._)([(0,ui.j)("esri.widgets.Daylight.SliderWithDropdown")],sp);const W9=sp;var ey=T(56683);function nT(_){const v=[/\u0660/g,/\u0661/g,/\u0662/g,/\u0663/g,/\u0664/g,/\u0665/g,/\u0666/g,/\u0667/g,/\u0668/g,/\u0669/g];for(let O=0;O<10;O++)_=_.replace(v[O],O.toString());return Number(_)}function IA(_){return new Ls.Z(`could not parse date input, expecting the following format: ${(0,ou.p6)(Date.now(),_)}`)}const ty={ar:6,"ar-dz":6,"ar-kw":6,"ar-ly":6,"ar-ma":1,"ar-sa":7,"ar-tn":1,bg:1,bs:1,ca:1,cs:1,da:1,de:1,"de-at":1,"de-ch":1,el:1,"en-au":1,"en-ca":7,"en-gb":1,"en-ie":1,"en-il":7,"en-in":7,"en-nz":1,"en-sg":7,es:1,"es-do":7,"es-mx":7,"es-us":7,et:1,fi:1,fr:1,"fr-ca":7,"fr-ch":1,he:7,hr:1,hu:1,id:7,it:1,"it-ch":1,ja:7,ko:7,lt:1,lv:1,nb:1,nl:1,"nl-be":1,pl:1,pt:7,"pt-br":7,ro:1,ru:1,sk:1,sl:1,sr:1,"sr-cyrl":1,sv:1,th:7,tr:1,uk:1,vi:1,"zh-cn":7,"zh-hk":7,"zh-mo":7,"zh-tw":7},z9="Locale"in Intl&&"weekInfo"in Intl.Locale.prototype;function LA(_){if(_=_.toLowerCase(),ty[_])return ty[_];if(z9)try{const O=new Intl.Locale(_).weekInfo.firstDay;return ty[_]=O,O}catch(O){}const v=(0,ey.G3)(_);return ty[v]?ty[v]:7}function G9(_,v){return(v+7-LA(_))%7}var lf=T(27122);const uo_week="esri-date-picker__week-item",uo_day="esri-date-picker__day-item",uo_year="esri-date-picker__year-picker-item",uo_button="esri-widget--button",pm={year:"numeric",month:"2-digit",day:"2-digit"},H9=[" ","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","End","Enter","Home","PageDown","PageUp"],UA="esri.widgets.support.DatePicker",K9=pn.Z.getLogger(UA);let Nu=class extends wu.Z{constructor(_,v){super(_,v),this._activeDate=null,this._calendarNode=null,this._calendarPopover=new wA({owner:this,placement:"bottom-start",anchorElement:()=>this._rootNode,renderContentFunction:this._renderCalendar}),this._inputOrButtonNode=null,this._isOpen=!1,this._requestDayPickerFocusOnCreate=!1,this._rootNode=null,this.dateInputEnabled=!1,this.label=void 0,this.messages=null,this.value=null,this.commitOnMonthChange=!1,this.viewModel=new IE,this.disabled=!1,this._toggle=this._toggle.bind(this)}initialize(){this.own((0,pt.YP)(()=>{var _;return{viewModel:this.viewModel,value:null==(_=this.viewModel)?void 0:_.value}},({viewModel:_,value:v})=>{this.destroyed||!_||(0,lt.Wi)(this.onChange)||this.onChange(v)},pt.Z_))}destroy(){this._calendarPopover.destroy()}render(){return(0,pi.u)("div",{afterCreate:Nl.Yo,bind:this,class:this.classes("esri-date-picker","esri-widget"),"data-node-ref":"_rootNode"},this.dateInputEnabled?this.renderInputAndButtonMode():this.renderButtonOnlyMode())}renderButtonOnlyMode(){const _=(0,ou.p6)(this.viewModel.value,pm),{disabled:v,_isOpen:O,messages:D}=this;return(0,pi.u)("div",{key:`date-button-${v}`,afterCreate:Nl.Yo,"aria-controls":O?this._getCalendarId():null,"aria-expanded":O.toString(),"aria-haspopup":"true","aria-label":D.setDate,"aria-pressed":O.toString(),bind:this,class:this.classes(uo_button,"esri-select","esri-date-picker__calendar-toggle"),"data-node-ref":"_inputOrButtonNode",onclick:this._toggle,onkeydown:this._handleDateButtonKeyDown,role:"button",tabIndex:v?null:0},(0,pi.u)("span",{class:"esri-date-picker__date"},_))}renderInputAndButtonMode(){const _=(0,ou.p6)(this.viewModel.value,pm),{_isOpen:v,messages:O}=this;return(0,pi.u)("div",{class:this.classes("esri-date-picker__input")},(0,pi.u)("input",{afterCreate:Nl.Yo,"data-node-ref":"_inputOrButtonNode","aria-controls":v?this._getCalendarId():null,"aria-haspopup":"true","aria-label":O.setDate,bind:this,class:this.classes("esri-date-picker__text-input","esri-input"),key:"date-input",onblur:this._handleDateInputBlur,onclick:this._handleDateInputClick,onkeydown:this._handleDateInputKeyDown,type:"text",value:_}),(0,pi.u)("span",{"aria-hidden":"true",class:this.classes("esri-date-picker__icon--leading","esri-icon-calendar")}))}_handleDateInputClick(){this._open(this.viewModel.value,!1)}_handleDateInputKeyDown(_){const{key:v}=_;this._isOpen?"Enter"===v?this._handleDateText(_):"Escape"===v&&this._close():"ArrowDown"===v&&(this._open(this.viewModel.value),_.preventDefault())}_handleDateButtonKeyDown(_){const{key:v,shiftKey:O}=_;this._isOpen&&"Tab"===v&&O?this._close():(0,Nl.pf)(v)&&this._toggle()}_handleDateInputBlur(_){this._isOpen||this._handleDateText(_)}_handleDateText(_){const v=_.currentTarget;let O;try{O=function V9(_,v){const O=(0,ou.Sh)(v),D=Date.now(),w=O.formatToParts(D),te=new Set;w.filter(({type:Xe})=>"literal"===Xe).forEach(({value:Xe})=>te.add(Xe));let fe=0;const Pe={};for(;w.length>0;){const{type:Xe,value:st}=w.shift();for(let vt=0;vt<st.length;vt++,fe++){const Ct=_.charAt(fe);if(te.has(Ct)){fe++;break}if("literal"===Xe)break;Pe[Xe]||(Pe[Xe]=[]),Pe[Xe].push(Ct)}}const Ue={};try{Ue.day=nT(Pe.day.join("")),Ue.month=nT(Pe.month.join("")),Ue.year=nT((Pe.year||Pe.relatedYear).join(""))}catch(Xe){throw IA(v)}if(isNaN(Ue.day)||isNaN(Ue.month)||isNaN(Ue.year))throw IA(v);return Ue}(v.value,pm)}catch(w){return K9.warn(w),void(v.value=(0,ou.p6)(this.viewModel.value,pm))}const D=lf.ou.fromObject(O);D.isValid?(this.viewModel.value=D.toJSDate(),this._activeDate=D):v.value=(0,ou.p6)(this.viewModel.value,pm)}_handleDatePickerKeydown(_){"Escape"===(0,mt.kK)(_)&&(this._close(),_.preventDefault(),_.stopPropagation())}_renderCalendar(){const _=this._activeDate,v=lf.ou.fromJSDate(this.viewModel.value);return(0,pi.u)("div",{afterCreate:Nl.Yo,bind:this,class:this.classes("esri-date-picker__calendar","esri-widget"),"data-node-ref":"_calendarNode",id:this._getCalendarId(),key:"esri-date-picker__calendar",onkeydown:this._handleDatePickerKeydown},this._renderMonthPicker(_),this._renderDayPicker(_,v),this._renderYearPicker(_))}_getCalendarId(){return`date-picker__calendar--${this.id}`}_renderMonthPicker(_){const v=(0,Nl.dZ)(this.container),O=v?"esri-icon-right":"esri-icon-left",D=v?"esri-icon-left":"esri-icon-right",w=lf.kI.months("long",{locale:(0,ey.Kd)()}).map((Pe,Ue)=>(0,pi.u)("option",{selected:_.month-1===Ue,value:Ue.toString()},Pe)),{disabled:te,messages:fe}=this;return(0,pi.u)("div",{class:"esri-date-picker__month-picker"},(0,pi.u)("div",{key:`previous-month-${te}`,"aria-label":fe.goToPreviousMonth,bind:this,class:uo_button,onclick:this._setPreviousMonth,onkeydown:this._handlePreviousMonthKeyDown,role:"button",tabIndex:te?null:0,title:fe.goToPreviousMonth},(0,pi.u)("span",{"aria-hidden":"true",class:O})),(0,pi.u)("select",{"aria-live":"assertive","aria-label":fe.selectMonth,bind:this,class:this.classes("esri-date-picker__month-dropdown","esri-select"),disabled:te,id:`${this.id}__month-picker`,onchange:this._setMonth,onkeydown:this._setMonth,title:fe.selectMonth},w),(0,pi.u)("div",{key:`next-month-${te}`,"aria-label":fe.goToNextMonth,bind:this,class:uo_button,onclick:this._setNextMonth,onkeydown:this._setNextMonth,role:"button",tabIndex:te?null:0,title:fe.goToNextMonth},(0,pi.u)("span",{"aria-hidden":"true",class:D})))}_renderDayPicker(_,v){const O=this._getWeekLabels(),D=this._getDayId(_),w=this._renderMonth(_,v),{id:te,disabled:fe}=this;return(0,pi.u)("div",{key:`day-picker-${fe}`,afterCreate:this._handleDayPickerCreate,"aria-activedescendant":D,"aria-labelledby":`${te}__month-picker ${te}__selected-year`,bind:this,class:"esri-date-picker__day-picker",id:`${te}__day-picker`,onkeydown:this._handleDayPickerKeydown,role:"grid",tabIndex:fe?null:0},(0,pi.u)("div",{class:uo_week,role:"row"},O.map(Pe=>(0,pi.u)("div",{"aria-label":Pe.name,class:this.classes(uo_day,"esri-date-picker__day-item--header"),role:"columnheader",title:Pe.name},Pe.abbr))),w)}_getDayId(_){return`${this.id}__${(0,ou.p6)(_.valueOf(),pm)}`}_handleDayPickerCreate(_){this._requestDayPickerFocusOnCreate&&(this._requestDayPickerFocusOnCreate=!1,_.focus())}_getWeekLabels(){const _=[],v={weekday:"long"},O={weekday:"narrow"};let D=lf.ou.now().set({weekday:LA((0,ey.Kd)())});for(let w=0;w<7;w++)_.push({name:(0,ou.p6)(D.valueOf(),v),abbr:(0,ou.p6)(D.valueOf(),O)}),D=D.plus({day:1});return _}_handleDayPickerKeydown(_){const{ctrlKey:v,shiftKey:O}=_,D=(0,mt.kK)(_);if(!H9.includes(D))return;let w=this._activeDate;"ArrowLeft"===D?w=w.minus({day:1}):"ArrowRight"===D?w=w.plus({day:1}):"ArrowUp"===D?w=w.minus({week:1}):"ArrowDown"===D?w=w.plus({week:1}):"PageUp"===D?w=w.minus({[O?"year":"month"]:1}):"PageDown"===D?w=w.plus({[O?"year":"month"]:1}):"Home"===D?w=w.startOf(v?"year":"month"):"End"===D?w=w.endOf(v?"year":"month"):(0,Nl.pf)(D)&&(this.viewModel.value=w.toJSDate(),this._close()),this._activeDate=w,_.preventDefault(),_.stopPropagation()}_renderMonth(_,v){const O=lf.ou.now(),D=_.startOf("month"),w=_.endOf("month");let Pe=D.minus({day:G9((0,ey.Kd)(),D.weekday)});const Ue=[];for(let Xe=0;Xe<6;Xe++){const st=[];for(let vt=0;vt<7;vt++){const Ct=Pe.day,Wt=Pe.hasSame(_,"day"),Kt=Pe.hasSame(v,"day"),Lt=this._getDayId(Pe),sr={"esri-date-picker__day-item--nearby-month":!lf.Xp.fromDateTimes(D,w).contains(Pe),"esri-date-picker__day-item--today":Pe.hasSame(O,"day"),"esri-date-picker__day-item--active":Wt,"esri-date-picker__day-item--selected":Kt};st.push((0,pi.u)("div",{"aria-label":Ct.toString(),"aria-selected":Wt.toString(),bind:this,class:this.classes(uo_day,sr),"data-iso-date":Pe.toISO(),id:Lt,onclick:this._handleSelectedDate,onkeydown:this._handleSelectedDate,role:"gridcell"},Ct)),Pe=Pe.plus({day:1})}Ue.push((0,pi.u)("div",{class:uo_week,role:"row"},st))}return Ue}_renderYearPicker(_){const v={year:"numeric"},O=_,D=(0,ou.p6)(O.valueOf(),v),w=(0,ou.p6)(O.plus({year:1}).valueOf(),v),te=(0,ou.p6)(O.minus({year:1}).valueOf(),v),{disabled:fe,messages:Pe}=this;return(0,pi.u)("div",{class:"esri-date-picker__year-picker"},(0,pi.u)("div",{key:`previous-year-${fe}`,"aria-label":Pe.goToPreviousYear,bind:this,class:uo_year,onclick:this._setPreviousYear,onkeydown:this._setPreviousYear,tabIndex:fe?null:0,title:Pe.goToPreviousYear},te),(0,pi.u)("div",{class:this.classes(uo_year,"esri-date-picker__year-picker-item--selected"),id:`${this.id}__selected-year`},D),(0,pi.u)("div",{key:`next-year-${fe}`,"aria-label":Pe.goToNextYear,bind:this,class:uo_year,onclick:this._setNextYear,onkeydown:this._handleNextYearKeyDown,tabIndex:fe?null:0,title:Pe.goToNextYear},w))}_toggle(){this._isOpen?this._close():this._open(this.viewModel.value)}_setMonth(_){const O=Number(_.target.value)+1;this._activeDate=this._activeDate.set({month:O}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_close(_=!0){this._activeDate=null,this._isOpen=!1,this._calendarPopover.open=!1,this.pageClickHandler.pause(),_&&this._inputOrButtonNode.focus()}_open(_,v=!0){this._activeDate=lf.ou.fromJSDate(_),this._isOpen=!0,this._calendarPopover.open=!0,this._requestDayPickerFocusOnCreate=v,this.pageClickHandler||(this.pageClickHandler=(0,mt.Wy)(document,"click",({target:O})=>{var D,w;(null==(D=this._calendarNode)?void 0:D.contains(O))||(null==(w=this._rootNode)?void 0:w.contains(O))||this._close()}),this.own(this.pageClickHandler)),this.pageClickHandler.resume()}_setPreviousMonth(){this._activeDate=this._activeDate.minus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_handlePreviousMonthKeyDown(_){if("Tab"===_.key&&_.shiftKey)return _.preventDefault(),void this._close();(0,Nl.pf)(_.key)&&this._setPreviousMonth()}_setNextMonth(){this._activeDate=this._activeDate.plus({month:1}),this.commitOnMonthChange&&(this.viewModel.value=this._activeDate.toJSDate())}_setPreviousYear(){this._activeDate=this._activeDate.minus({year:1})}_setNextYear(){this._activeDate=this._activeDate.plus({year:1})}_handleNextYearKeyDown(_){if("Tab"===_.key&&!_.shiftKey)return _.preventDefault(),void this._close();(0,Nl.pf)(_.key)&&this._setNextYear()}_handleSelectedDate(_){this.viewModel.value=lf.ou.fromISO(_.target.getAttribute("data-iso-date")).toJSDate(),this._close()}};(0,Ze._)([(0,nt.Cb)()],Nu.prototype,"dateInputEnabled",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Nu.prototype,"label",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/support/t9n/DatePicker")],Nu.prototype,"messages",void 0),(0,Ze._)([(0,Ss.B)("viewModel.value")],Nu.prototype,"value",void 0),(0,Ze._)([(0,nt.Cb)()],Nu.prototype,"commitOnMonthChange",void 0),(0,Ze._)([(0,nt.Cb)({type:IE})],Nu.prototype,"viewModel",void 0),(0,Ze._)([(0,nt.Cb)()],Nu.prototype,"onChange",void 0),(0,Ze._)([(0,nt.Cb)()],Nu.prototype,"disabled",void 0),(0,Ze._)([(0,kh.h)()],Nu.prototype,"_setNextMonth",null),(0,Ze._)([(0,kh.h)()],Nu.prototype,"_setPreviousYear",null),(0,Ze._)([(0,kh.h)()],Nu.prototype,"_handleSelectedDate",null),Nu=(0,Ze._)([(0,ui.j)(UA)],Nu);const Z9=Nu,BA=/(.*)\s(.*)/,$9=pn.Z.getLogger("esri.widgets.Daylight");let jl=class extends wu.Z{constructor(_,v){var O;super(_,v),this.headingLevel=3,this.iconClass=Ma.widgetIcon,this.label=void 0,this.playSpeedMultiplier=1,this.timeSliderSteps=5,this.view=null,this.viewModel=new uA,this.visibleElements=new dA,this.dateOrSeason="date",this._timeSlider=new W9({viewModel:this.viewModel.timeSliderViewModel,labelFormatFunction:cA,inputFormatFunction:cA,min:0,max:1439,steps:null!=(O=this.timeSliderSteps)?O:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}],items:[]}),this._datePicker=new Z9({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0}),this._onPlayDayClick=()=>{this.viewModel.toggleDayPlaying()},this._onYearPlayClick=()=>{this.viewModel.toggleYearPlaying()},this._onSeasonChange=D=>{this.viewModel.currentSeason=D.target.value},this._onSunLightingCheckboxChange=()=>{this.viewModel.toggleSunLightingEnabled()},this._onShadowCheckboxChange=()=>{this.viewModel.toggleDirectShadowsEnabled()}}get gmtOffsets(){return(0,lt.yw)(this.timezoneMessages,SN)}get _useAmPm(){const _=this._timeSlider.viewModel.getLabelForValue(0,"tick");return BA.test(_)}get _labelAlignmentClass(){var D,w;const _=null!=(w=null==(D=this.viewModel.timeSliderViewModel.values)?void 0:D[0])?w:0;return _<60*(this._useAmPm?4:3)?Ma.sliderAlignLeft:_>60*(this._useAmPm?21:21.5)?Ma.sliderAlignRight:null}postInitialize(){this.viewModel.isSupported&&this.own([(0,pt.YP)(()=>this.viewModel.datePickerViewModel,_=>this._datePicker.viewModel=_,pt.tX),(0,pt.YP)(()=>this.viewModel.timeSliderViewModel,_=>this._timeSlider.viewModel=_,pt.tX),(0,pt.YP)(()=>{var _;return null==(_=this.timezoneMessages)?void 0:_.chooseTimezone},_=>this._timeSlider.buttonTooltip=_,pt.tX),(0,pt.YP)(()=>{var _;return null==(_=this.visibleElements)?void 0:_.timezone},_=>this._timeSlider.showDropDown=_,pt.tX),(0,pt.YP)(()=>!this.viewModel.sunLightingEnabled,_=>{this._datePicker.disabled=_,this._timeSlider.disabled=_},pt.tX),(0,pt.gx)(()=>this.gmtOffsets,_=>{this._timeSlider.items=_.map(v=>({utcOffset:v.utcOffset,name:v.short,label:[v.shortWithUTC,v.long]}))},pt.tX),(0,pt.YP)(()=>[this.viewModel.utcOffset,this.gmtOffsets],()=>this._onUTCOffsetChange(),pt.tX)])}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){const{messages:_,viewModel:v,visibleElements:O}=this,D=v.isSupported;return(0,pi.u)("div",{class:this.classes(Ma.base,Ma.widget)},D?(0,pi.u)(pi.D,null,O.header&&(0,pi.u)(nA.X6,{level:this.headingLevel},_.title),this._renderTimeOptions(),O.datePicker&&this._renderDateOrSeason(),O.sunLightingToggle&&this._renderSunLightingToggle(),O.shadowsToggle&&this._renderShadowsToggle()):(0,pi.u)("div",{key:"unsupported",class:Ma.panelError},(0,pi.u)("p",null,_.unsupported)))}loadDependencies(){return(0,Ai.Z)(function*(){yield Promise.all([Promise.all([T.e(797),T.e(8592),T.e(5857)]).then(T.bind(T,65857)),Promise.all([T.e(797),T.e(9488)]).then(T.bind(T,59488)),T.e(9749).then(T.bind(T,79749))])})()}_renderTimeOptions(){const{viewModel:_,visibleElements:v,messages:O}=this,{directShadowsEnabled:D,dayPlaying:w}=_,te=!_.sunLightingEnabled;return(0,pi.u)("div",{class:this.classes(Ma.dayContainer,this._labelAlignmentClass,{[Ma.shadowOn]:D,[Ma.shadowOff]:!D,[Ma.sliderDateOn]:v.datePicker,[Ma.sliderDateOff]:!v.datePicker,[Ma.sliderAmPmOn]:this._useAmPm,[Ma.containerDisabled]:te}),key:"daylight-time-options"},this._timeSlider.render(),v.playButtons&&this._renderPlayPauseButton({playing:w,disabled:te,label:null==O?void 0:O.playDay,onClick:this._onPlayDayClick}))}_renderDateOptions(){const{viewModel:_,visibleElements:v,messages:O}=this,{yearPlaying:D}=_,w=!_.sunLightingEnabled;return(0,pi.u)("div",{key:"daylight-date-options",class:this.classes(Ma.dateContainer,w&&Ma.containerDisabled)},this._datePicker.render(),v.playButtons&&this._renderPlayPauseButton({playing:D,disabled:w,label:null==O?void 0:O.playYear,onClick:this._onYearPlayClick}))}_renderPlayPauseButton({playing:_,disabled:v,label:O,onClick:D}){return(0,pi.u)("calcite-button",{appearance:"solid",class:Ma.playPauseButton,disabled:v,"icon-start":_?"pause-f":"play-f",label:O,round:!0,title:O,type:"button",onclick:D})}_renderSeasonOptions(){const{messages:_,viewModel:v}=this,O=!v.sunLightingEnabled;return(0,pi.u)("select",{class:this.classes(Ma.select,Ma.seasonPicker,O&&Ma.seasonPickerDisabled),disabled:O,value:v.currentSeason,"aria-label":_.season,onchange:this._onSeasonChange},ZC.map(D=>(0,pi.u)("option",{value:D},_[D])))}_renderDateOrSeason(){return"date"===this.dateOrSeason?this._renderDateOptions():this._renderSeasonOptions()}_renderSunLightingToggle(){var v;const _=null==(v=this.messages)?void 0:v.sunLightingToggle;return(0,pi.u)("calcite-label",{key:"date-time-toggle",layout:"inline",title:null==_?void 0:_.tooltip,scale:"s"},(0,pi.u)("calcite-checkbox",{class:Ma.sunLightingCheckbox,checked:this.viewModel.sunLightingEnabled,onCalciteCheckboxChange:this._onSunLightingCheckboxChange}),null==_?void 0:_.label)}_renderShadowsToggle(){var v;const _=null==(v=this.messages)?void 0:v.shadowsToggle;return(0,pi.u)("calcite-label",{key:"shadow-toggle",layout:"inline",title:null==_?void 0:_.tooltip,scale:"s"},(0,pi.u)("calcite-checkbox",{class:Ma.shadowsCheckbox,checked:this.viewModel.directShadowsEnabled,onCalciteCheckboxChange:this._onShadowCheckboxChange}),_.label)}_onUTCOffsetChange(){var w;const _=this.viewModel.utcOffset,v=null==(w=this._timeSlider.currentItem)?void 0:w.utcOffset,O=this.gmtOffsets;if((0,lt.Wi)(O)||v===_)return;const D=O.findIndex(({utcOffset:te})=>te===_);D>-1&&(this._timeSlider.currentIndex=D)}_onPrimaryTickCreated(_,v,O){v.classList.add(...aT,Ma.primaryTick),O.classList.add(...aT,Ma.primaryTickLabel),O.onclick=v.onclick=this._makeGoToTime(_);const D=O.textContent.match(BA);D&&(O.innerHTML=`${D[1]}<br><div class=${Ma.primaryTickAmPm}>${D[2]}</div>`)}_onSecondaryTickCreated(_,v){v.classList.add(...aT,Ma.secondaryTick),v.onclick=this._makeGoToTime(_)}_makeGoToTime(_){return()=>{this.viewModel.timeSliderPosition=_}}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],jl.prototype,"gmtOffsets",null),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Daylight/t9n/Daylight")],jl.prototype,"messages",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/support/t9n/timezone")],jl.prototype,"timezoneMessages",void 0),(0,Ze._)([(0,nt.Cb)()],jl.prototype,"headingLevel",void 0),(0,Ze._)([(0,nt.Cb)()],jl.prototype,"iconClass",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.title",overridable:!0}})],jl.prototype,"label",void 0),(0,Ze._)([(0,Ss.B)("viewModel.playSpeedMultiplier")],jl.prototype,"playSpeedMultiplier",void 0),(0,Ze._)([(0,Ss.B)("_timeSlider.steps")],jl.prototype,"timeSliderSteps",void 0),(0,Ze._)([(0,Ss.B)("viewModel.view")],jl.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:uA})],jl.prototype,"viewModel",void 0),(0,Ze._)([(0,nt.Cb)({type:dA,nonNullable:!0})],jl.prototype,"visibleElements",void 0),(0,Ze._)([(0,nt.Cb)({cast:_=>"season"===_||"date"===_?_:($9.warn(`"${_}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "date".`),"date")})],jl.prototype,"dateOrSeason",void 0),(0,Ze._)([(0,nt.Cb)()],jl.prototype,"_timeSlider",void 0),(0,Ze._)([(0,nt.Cb)()],jl.prototype,"_useAmPm",null),(0,Ze._)([(0,nt.Cb)()],jl.prototype,"_labelAlignmentClass",null),(0,Ze._)([(0,nt.Cb)()],jl.prototype,"_datePicker",void 0),jl=(0,Ze._)([(0,ui.j)("esri.widgets.Daylight")],jl);const aT=["esri-interactive","esri-widget__anchor"],k9=jl;let cf=class extends Bi.Z{constructor(_){super(_),this._viewpointHandle=null,this._handles=new cn.Z,this.group=null}initialize(){this._handles.add((0,pt.on)(()=>{var _;return null==(_=this.view)?void 0:_.ui},"expand",_=>{const{target:v}=_;v&&v!==this&&v.expanded&&v.group&&v.group===this.group&&this._collapse()}))}destroy(){this._viewpointHandle=null,this.view=null,this._handles.destroy(),this._handles=null}set autoCollapse(_){this._set("autoCollapse",_),this._watchViewpoint()}set expanded(_){const v=!!_;this._set("expanded",v);const O=this.get("view.ui");O&&O.emit("expand",{target:this}),this._viewpointHandleChange(v)}get state(){return this.get("view.ready")?"ready":"disabled"}set view(_){this._get("view")!==_&&(this._set("view",_),_&&(0,pt.gx)(()=>_.ready,()=>{this.view===_&&this._watchViewpoint()},{once:!0,initial:!0}))}_viewpointHandleChange(_){this._viewpointHandle&&(_?(0,pt.gx)(()=>this.view.stationary,()=>this._viewpointHandle.resume(),{once:!0,initial:!0}):this._viewpointHandle.pause())}_watchViewpoint(){const _="viewpoint";this._handles.remove(_),this._viewpointHandle=null;const{autoCollapse:v,view:O}=this;if(O&&v){const D=(0,pt.Wy)(()=>"3d"===O.type?O.camera:O.viewpoint,()=>this._collapse());this._handles.add(D,_),this._viewpointHandle=D}}_collapse(){this.expanded=!1}};(0,Ze._)([(0,nt.Cb)({value:!1})],cf.prototype,"autoCollapse",null),(0,Ze._)([(0,nt.Cb)({value:!1})],cf.prototype,"expanded",null),(0,Ze._)([(0,nt.Cb)()],cf.prototype,"group",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],cf.prototype,"state",null),(0,Ze._)([(0,nt.Cb)({value:null})],cf.prototype,"view",null),cf=(0,Ze._)([(0,ui.j)("esri.widgets.Expand.ExpandViewModel")],cf);const NA=cf;var lT=T(25469);let Ya=class extends wu.Z{constructor(_,v){super(_,v),this.autoCollapse=null,this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expanded=null,this.expandTooltip="",this.group=null,this.iconNumber=0,this.label=void 0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.view=null,this.viewModel=new NA,this._handleKeyDown=O=>{const{closeOnEsc:D,_toggleButtonEl:w,expanded:te}=this;!te||!D||O.target===w||"Escape"!==O.key||("function"==typeof D?D(O):D)&&(this.expanded=!1,null==w||w.focus())}}get contentId(){return`${this.id}_controls_content`}get expandTitle(){const{expanded:_,messagesCommon:v,collapseTooltip:O,expandTooltip:D}=this;return _?O||v.collapse:D||v.expand}get collapseIconClass(){return"esri-icon-collapse"}set collapseIconClass(_){_?this._override("collapseIconClass",_):this._clearOverride("collapseIconClass")}get expandIconClass(){return(0,lT.Qd)(this.content)?this.content.iconClass:"esri-icon-expand"}set expandIconClass(_){_?this._override("expandIconClass",_):this._clearOverride("expandIconClass")}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}toggle(){this.viewModel.expanded=!this.viewModel.expanded}render(){const{mode:_}=this;return(0,pi.u)("div",{class:this.classes("esri-expand esri-widget",{"esri-expand--auto":"auto"===_,"esri-expand--drawer":"drawer"===_,"esri-expand--floating":"floating"===_}),onkeydown:this._handleKeyDown},this.renderMask(),this.renderContainer())}renderContainer(){const{expanded:_}=this;return(0,pi.u)("div",{class:this.classes("esri-expand__container",{"esri-expand__container--expanded":_})},this.renderPanel(),this.renderContent())}renderMask(){const{expanded:_}=this;return(0,pi.u)("div",{bind:this,onclick:this._toggle,class:this.classes("esri-expand__mask",{"esri-expand__mask--expanded":_})})}renderBadgeNumber(){const{expanded:_,iconNumber:v}=this;return v&&!_?(0,pi.u)("span",{key:"expand__icon-number",class:"esri-expand__icon-number"},v):null}renderPanelNumber(){const{iconNumber:_,expanded:v}=this;return _&&v?(0,pi.u)("span",{key:"expand__expand-icon-number",class:this.classes("esri-expand__icon-number","esri-expand__icon-number--expanded")},_):null}renderIcon(){const{collapseIconClass:_,expandIconClass:v,expanded:O}=this,D={"esri-expand__icon--expanded":O,[_]:O,[v]:!O};return _===v&&(D[_]=!0),(0,pi.u)("span",{"aria-hidden":"true",class:this.classes("esri-collapse__icon",D)})}renderTitle(){return(0,pi.u)("span",{class:"esri-icon-font-fallback-text"},this.expandTitle)}renderExpandButton(){const{expanded:_,expandTitle:v,contentId:O}=this;return(0,pi.u)("div",{afterCreate:this._storeToggleButtonEl,"aria-controls":O,"aria-expanded":_?"true":"false",bind:this,class:"esri-widget--button",onclick:this._toggle,onkeydown:this._toggle,role:"button",tabindex:"0",title:v},this.renderBadgeNumber(),this.renderIcon(),this.renderTitle())}renderPanel(){return(0,pi.u)("div",{class:"esri-expand__panel"},this.renderExpandButton(),this.renderPanelNumber())}renderContent(){const{expanded:_,contentId:v,content:O}=this,w={id:v,role:"region",class:this.classes("esri-expand__content",{"esri-expand__content--expanded":_})};return"string"==typeof O?(0,pi.u)("div",or({key:"content__string",innerHTML:O},w)):(0,lT.Qd)(O)?(0,pi.u)("div",or({key:"content__widget"},w),O.render()):O instanceof HTMLElement?(0,pi.u)("div",or({key:"content__html-element",bind:O,afterCreate:this._attachToNode},w)):(0,lT.o)(O)?(0,pi.u)("div",or({key:"content__node",bind:O.domNode,afterCreate:this._attachToNode},w)):null}_toggle(){this.toggle()}_attachToNode(_){_.appendChild(this)}_storeToggleButtonEl(_){this._toggleButtonEl=_}};(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Ya.prototype,"contentId",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Ya.prototype,"expandTitle",null),(0,Ze._)([(0,Ss.B)("viewModel.autoCollapse")],Ya.prototype,"autoCollapse",void 0),(0,Ze._)([(0,nt.Cb)()],Ya.prototype,"closeOnEsc",void 0),(0,Ze._)([(0,nt.Cb)()],Ya.prototype,"collapseIconClass",null),(0,Ze._)([(0,nt.Cb)()],Ya.prototype,"collapseTooltip",void 0),(0,Ze._)([(0,nt.Cb)()],Ya.prototype,"content",void 0),(0,Ze._)([(0,Ss.B)("viewModel.expanded")],Ya.prototype,"expanded",void 0),(0,Ze._)([(0,nt.Cb)()],Ya.prototype,"expandIconClass",null),(0,Ze._)([(0,nt.Cb)()],Ya.prototype,"expandTooltip",void 0),(0,Ze._)([(0,Ss.B)("viewModel.group")],Ya.prototype,"group",void 0),(0,Ze._)([(0,nt.Cb)()],Ya.prototype,"iconNumber",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ya.prototype,"label",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Expand/t9n/Expand")],Ya.prototype,"messages",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/t9n/common")],Ya.prototype,"messagesCommon",void 0),(0,Ze._)([(0,nt.Cb)()],Ya.prototype,"mode",void 0),(0,Ze._)([(0,Ss.B)("viewModel.view")],Ya.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)({type:NA})],Ya.prototype,"viewModel",void 0),(0,Ze._)([(0,kh.h)()],Ya.prototype,"_toggle",null),Ya=(0,Ze._)([(0,ui.j)("esri.widgets.Expand")],Ya);const cT=Ya;var Y9=T(12874),J9=T(32258),uT=T(84792),qp=T(2618);let uf=class extends xn.wq{constructor(_){super(_),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],uf.prototype,"address",void 0),(0,Ze._)([(0,nt.Cb)({type:Object,json:{write:!0}})],uf.prototype,"attributes",void 0),(0,Ze._)([(0,nt.Cb)({type:To.Z,json:{write:!0}})],uf.prototype,"extent",void 0),(0,Ze._)([(0,nt.Cb)({type:vs.Z,json:{write:!0}})],uf.prototype,"location",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0}})],uf.prototype,"score",void 0),uf=(0,Ze._)([(0,ui.j)("esri.rest.support.AddressCandidate")],uf);const jA=uf;var dT=T(74722);let yc=class extends xn.wq{constructor(_){super(_),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};(0,Ze._)([(0,nt.Cb)({type:Object,json:{write:!0}})],yc.prototype,"address",void 0),(0,Ze._)([(0,nt.Cb)(dT.q)],yc.prototype,"apiKey",void 0),(0,Ze._)([(0,nt.Cb)({type:[String],json:{read:{source:"category",reader:_=>_?_.split(","):null},write:{target:"category",writer:(_,v)=>{v.category=_?_.join(","):null}}}})],yc.prototype,"categories",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],yc.prototype,"countryCode",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,json:{write:!0}})],yc.prototype,"forStorage",void 0),(0,Ze._)([(0,nt.Cb)({type:vs.Z,json:{write:{writer:(_,v)=>{v.location=_?_.clone().normalize():null}}}})],yc.prototype,"location",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],yc.prototype,"locationType",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],yc.prototype,"magicKey",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0}})],yc.prototype,"maxLocations",void 0),(0,Ze._)([(0,nt.Cb)({type:[String],json:{write:{writer:(_,v)=>{v.outFields=_?_.join(","):null}}}})],yc.prototype,"outFields",void 0),(0,Ze._)([(0,nt.Cb)({type:Xn.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],yc.prototype,"outSpatialReference",void 0),(0,Ze._)([(0,nt.Cb)({type:To.Z,json:{write:{writer:(_,v)=>{const O=_?_.shiftCentralMeridian():null;v.searchExtent=O}}}})],yc.prototype,"searchExtent",void 0),yc=(0,Ze._)([(0,ui.j)("esri.rest.support.AddressToLocationsParameters")],yc),yc.from=(0,Ro.se)(yc);const FA=yc;function WA(_,v,O){return hT.apply(this,arguments)}function hT(){return hT=(0,Ai.Z)(function*(_,v,O){v=FA.from(v);const D=(0,qp.en)(_),st=v.toJSON(),{address:w}=st,te=WT(st,["address"]),fe=yi(or(or({},w),te),{f:"json"}),Pe=(0,qp.cv)(or(or({},D.query),fe)),Ue=(0,qp.lA)(Pe,O);return(0,uT.default)(`${D.path}/findAddressCandidates`,Ue).then(q9)}),hT.apply(this,arguments)}function q9({data:_}){if(!_)return[];const{candidates:v,spatialReference:O}=_;return v?v.map(D=>{if(!D)return;const{extent:w,location:te}=D,fe=!w||function Q9(_){return _&&"number"==typeof _.xmin&&"number"==typeof _.ymin&&"number"==typeof _.xmax&&"number"==typeof _.ymax}(w);return function X9(_){return _&&"number"==typeof _.x&&"number"==typeof _.y}(te)&&fe?(w&&(w.spatialReference=O),te.spatialReference=O,jA.fromJSON(D)):void 0}):[]}let e0=class extends xn.wq{constructor(_){super(_),this.addresses=null,this.categories=null,this.countryCode=null,this.locationType=null,this.outSpatialReference=null}};(0,Ze._)([(0,nt.Cb)({type:[Object],json:{read:{reader:_=>_&&_.records?_.records.map(v=>v.attributes):null},write:{writer:(_,v)=>{const O=[];Array.isArray(_)&&_.forEach(D=>{O.push({attributes:D})}),v.addresses={records:O}}}}})],e0.prototype,"addresses",void 0),(0,Ze._)([(0,nt.Cb)({type:[String],json:{read:{source:"category",reader:_=>_?_.split(","):null},write:{target:"category",writer:(_,v)=>{v.category=_?_.join(","):null}}}})],e0.prototype,"categories",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{read:{source:"sourceCountry"},write:{target:"sourceCountry"}}})],e0.prototype,"countryCode",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],e0.prototype,"locationType",void 0),(0,Ze._)([(0,nt.Cb)({type:Xn.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],e0.prototype,"outSpatialReference",void 0),e0=(0,Ze._)([(0,ui.j)("esri.rest.support.AddressesToLocationsParameters")],e0),e0.from=(0,Ro.se)(e0);let t0=class extends xn.wq{constructor(_){super(_),this.apiKey=null,this.location=null,this.locationType=null,this.outSpatialReference=null}};(0,Ze._)([(0,nt.Cb)(dT.q)],t0.prototype,"apiKey",void 0),(0,Ze._)([(0,nt.Cb)({type:vs.Z,json:{write:{writer:(_,v)=>{const O=_?_.clone().normalize():null;v.location=void 0!==O?O:null}}}})],t0.prototype,"location",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],t0.prototype,"locationType",void 0),(0,Ze._)([(0,nt.Cb)({type:Xn.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],t0.prototype,"outSpatialReference",void 0),t0=(0,Ze._)([(0,ui.j)("esri.rest.support.LocationToAddressParameters")],t0),t0.from=(0,Ro.se)(t0);const VA=t0;function fT(){return fT=(0,Ai.Z)(function*(_,v,O){v=VA.from(v);const D=(0,qp.en)(_),w=yi(or({},v.toJSON()),{f:"json"}),te=(0,qp.cv)(or(or({},D.query),w)),fe=(0,qp.lA)(te,O);return(0,uT.default)(`${D.path}/reverseGeocode`,fe).then(rj)}),fT.apply(this,arguments)}function rj({data:_}){if(!_)return;const{address:v,location:O}=_;return jA.fromJSON({address:v&&v.Match_addr||"",attributes:v||{},location:O,score:100})}let fm=class extends xn.wq{constructor(_){super(_),this.isCollection=null,this.magicKey=null,this.text=null}};(0,Ze._)([(0,nt.Cb)({type:Boolean,json:{write:!0}})],fm.prototype,"isCollection",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],fm.prototype,"magicKey",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],fm.prototype,"text",void 0),fm=(0,Ze._)([(0,ui.j)("esri.rest.support.SuggestionCandidate")],fm);const ij=fm;let cd=class extends xn.wq{constructor(_){super(_),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};(0,Ze._)([(0,nt.Cb)(dT.q)],cd.prototype,"apiKey",void 0),(0,Ze._)([(0,nt.Cb)({type:[String],json:{read:{source:"category",reader:_=>_?_.split(","):null},write:{target:"category",writer:(_,v)=>{v.category=_?_.join(","):null}}}})],cd.prototype,"categories",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],cd.prototype,"countryCode",void 0),(0,Ze._)([(0,nt.Cb)({type:vs.Z,json:{write:{writer:(_,v)=>{v.location=_?_.clone().normalize():null}}}})],cd.prototype,"location",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0}})],cd.prototype,"maxSuggestions",void 0),(0,Ze._)([(0,nt.Cb)({type:Xn.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],cd.prototype,"outSpatialReference",void 0),(0,Ze._)([(0,nt.Cb)({type:To.Z,json:{write:{writer:(_,v)=>{const O=_?_.shiftCentralMeridian():null;v.searchExtent=JSON.stringify(O)}}}})],cd.prototype,"searchExtent",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],cd.prototype,"text",void 0),cd=(0,Ze._)([(0,ui.j)("esri.rest.support.SuggestLocationsParameters")],cd),cd.from=(0,Ro.se)(cd);const zA=cd;function _T(){return _T=(0,Ai.Z)(function*(_,v,O){const D=(0,qp.en)(_),w=yi(or({},(v=zA.from(v)).toJSON()),{f:"json"}),te=(0,qp.cv)(or(or({},D.query),w)),fe=(0,qp.lA)(te,O);return(0,uT.default)(`${D.path}/suggest`,fe).then(nj)}),_T.apply(this,arguments)}function nj(_){const{data:v}=_;if(!v)return[];const{suggestions:O}=v;return O?O.map(D=>new ij(D)):[]}var oj=T(54176),aj=T(46468),lj=T(17253),cj=T(40445),GA={update:null,begin:null,loopBegin:null,changeBegin:null,change:null,changeComplete:null,loopComplete:null,complete:null,loop:1,direction:"normal",autoplay:!0,timelineOffset:0},mT={duration:1e3,delay:0,endDelay:0,easing:"easeOutElastic(1, .5)",round:0},uj=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","scale","scaleX","scaleY","scaleZ","skew","skewX","skewY","perspective","matrix","matrix3d"],FE={CSS:{},springs:{}};function np(_,v,O){return Math.min(Math.max(_,v),O)}function ry(_,v){return _.indexOf(v)>-1}function gT(_,v){return _.apply(null,v)}var sn={arr:function(_){return Array.isArray(_)},obj:function(_){return ry(Object.prototype.toString.call(_),"Object")},pth:function(_){return sn.obj(_)&&_.hasOwnProperty("totalLength")},svg:function(_){return _ instanceof SVGElement},inp:function(_){return _ instanceof HTMLInputElement},dom:function(_){return _.nodeType||sn.svg(_)},str:function(_){return"string"==typeof _},fnc:function(_){return"function"==typeof _},und:function(_){return void 0===_},nil:function(_){return sn.und(_)||null===_},hex:function(_){return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(_)},rgb:function(_){return/^rgb/.test(_)},hsl:function(_){return/^hsl/.test(_)},col:function(_){return sn.hex(_)||sn.rgb(_)||sn.hsl(_)},key:function(_){return!GA.hasOwnProperty(_)&&!mT.hasOwnProperty(_)&&"targets"!==_&&"keyframes"!==_}};function HA(_){var v=/\(([^)]+)\)/.exec(_);return v?v[1].split(",").map(function(O){return parseFloat(O)}):[]}function KA(_,v){var O=HA(_),D=np(sn.und(O[0])?1:O[0],.1,100),w=np(sn.und(O[1])?100:O[1],.1,100),te=np(sn.und(O[2])?10:O[2],.1,100),fe=np(sn.und(O[3])?0:O[3],.1,100),Pe=Math.sqrt(w/D),Ue=te/(2*Math.sqrt(w*D)),Xe=Ue<1?Pe*Math.sqrt(1-Ue*Ue):0,vt=Ue<1?(Ue*Pe-fe)/Xe:-fe+Pe;function Ct(Kt){var Lt=v?v*Kt/1e3:Kt;return Lt=Ue<1?Math.exp(-Lt*Ue*Pe)*(1*Math.cos(Xe*Lt)+vt*Math.sin(Xe*Lt)):(1+vt*Lt)*Math.exp(-Lt*Pe),0===Kt||1===Kt?Kt:1-Lt}return v?Ct:function Wt(){var Kt=FE.springs[_];if(Kt)return Kt;for(var Lt=1/6,nr=0,sr=0;;)if(1===Ct(nr+=Lt)){if(++sr>=16)break}else sr=0;var Er=nr*Lt*1e3;return FE.springs[_]=Er,Er}}function dj(_){return void 0===_&&(_=10),function(v){return Math.ceil(np(v,1e-6,1)*_)*(1/_)}}var hj=function(){var v=.1;function O(st,vt){return 1-3*vt+3*st}function D(st,vt){return 3*vt-6*st}function w(st){return 3*st}function te(st,vt,Ct){return((O(vt,Ct)*st+D(vt,Ct))*st+w(vt))*st}function fe(st,vt,Ct){return 3*O(vt,Ct)*st*st+2*D(vt,Ct)*st+w(vt)}return function Xe(st,vt,Ct,Wt){if(0<=st&&st<=1&&0<=Ct&&Ct<=1){var Kt=new Float32Array(11);if(st!==vt||Ct!==Wt)for(var Lt=0;Lt<11;++Lt)Kt[Lt]=te(Lt*v,st,Ct);return function(sr){return st===vt&&Ct===Wt||0===sr||1===sr?sr:te(function nr(sr){for(var Er=0,yr=1;10!==yr&&Kt[yr]<=sr;++yr)Er+=v;--yr;var $r=Er+(sr-Kt[yr])/(Kt[yr+1]-Kt[yr])*v,si=fe($r,st,Ct);return si>=.001?function Ue(st,vt,Ct,Wt){for(var Kt=0;Kt<4;++Kt){var Lt=fe(vt,Ct,Wt);if(0===Lt)return vt;vt-=(te(vt,Ct,Wt)-st)/Lt}return vt}(sr,$r,st,Ct):0===si?$r:function Pe(st,vt,Ct,Wt,Kt){var Lt,nr,sr=0;do{(Lt=te(nr=vt+(Ct-vt)/2,Wt,Kt)-st)>0?Ct=nr:vt=nr}while(Math.abs(Lt)>1e-7&&++sr<10);return nr}(sr,Er,Er+v,st,Ct)}(sr),vt,Wt)}}}}(),ZA=function(){var _={linear:function(){return function(D){return D}}},v={Sine:function(){return function(D){return 1-Math.cos(D*Math.PI/2)}},Circ:function(){return function(D){return 1-Math.sqrt(1-D*D)}},Back:function(){return function(D){return D*D*(3*D-2)}},Bounce:function(){return function(D){for(var w,te=4;D<((w=Math.pow(2,--te))-1)/11;);return 1/Math.pow(4,3-te)-7.5625*Math.pow((3*w-2)/22-D,2)}},Elastic:function(D,w){void 0===D&&(D=1),void 0===w&&(w=.5);var te=np(D,1,10),fe=np(w,.1,2);return function(Pe){return 0===Pe||1===Pe?Pe:-te*Math.pow(2,10*(Pe-1))*Math.sin((Pe-1-fe/(2*Math.PI)*Math.asin(1/te))*(2*Math.PI)/fe)}}};return["Quad","Cubic","Quart","Quint","Expo"].forEach(function(D,w){v[D]=function(){return function(te){return Math.pow(te,w+2)}}}),Object.keys(v).forEach(function(D){var w=v[D];_["easeIn"+D]=w,_["easeOut"+D]=function(te,fe){return function(Pe){return 1-w(te,fe)(1-Pe)}},_["easeInOut"+D]=function(te,fe){return function(Pe){return Pe<.5?w(te,fe)(2*Pe)/2:1-w(te,fe)(-2*Pe+2)/2}},_["easeOutIn"+D]=function(te,fe){return function(Pe){return Pe<.5?(1-w(te,fe)(1-2*Pe))/2:(w(te,fe)(2*Pe-1)+1)/2}}}),_}();function yT(_,v){if(sn.fnc(_))return _;var O=_.split("(")[0],D=ZA[O],w=HA(_);switch(O){case"spring":return KA(_,v);case"cubicBezier":return gT(hj,w);case"steps":return gT(dj,w);default:return gT(D,w)}}function $A(_){try{return document.querySelectorAll(_)}catch(O){return}}function WE(_,v){for(var O=_.length,D=arguments.length>=2?arguments[1]:void 0,w=[],te=0;te<O;te++)if(te in _){var fe=_[te];v.call(D,fe,te,_)&&w.push(fe)}return w}function VE(_){return _.reduce(function(v,O){return v.concat(sn.arr(O)?VE(O):O)},[])}function kA(_){return sn.arr(_)?_:(sn.str(_)&&(_=$A(_)||_),_ instanceof NodeList||_ instanceof HTMLCollection?[].slice.call(_):[_])}function vT(_,v){return _.some(function(O){return O===v})}function ET(_){var v={};for(var O in _)v[O]=_[O];return v}function bT(_,v){var O=ET(_);for(var D in _)O[D]=v.hasOwnProperty(D)?v[D]:_[D];return O}function zE(_,v){var O=ET(_);for(var D in v)O[D]=sn.und(_[D])?v[D]:_[D];return O}function r0(_){var v=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?(%|px|pt|em|rem|in|cm|mm|ex|ch|pc|vw|vh|vmin|vmax|deg|rad|turn)?$/.exec(_);if(v)return v[1]}function CT(_,v){return sn.fnc(_)?_(v.target,v.id,v.total):_}function op(_,v){return _.getAttribute(v)}function TT(_,v,O){if(vT([O,"deg","rad","turn"],r0(v)))return v;var w=FE.CSS[v+O];if(!sn.und(w))return w;var fe=document.createElement(_.tagName),Pe=_.parentNode&&_.parentNode!==document?_.parentNode:document.body;Pe.appendChild(fe),fe.style.position="absolute",fe.style.width=100+O;var Ue=100/fe.offsetWidth;Pe.removeChild(fe);var Xe=Ue*parseFloat(v);return FE.CSS[v+O]=Xe,Xe}function YA(_,v,O){if(v in _.style){var D=v.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),w=_.style[v]||getComputedStyle(_).getPropertyValue(D)||"0";return O?TT(_,w,O):w}}function MT(_,v){return sn.dom(_)&&!sn.inp(_)&&(!sn.nil(op(_,v))||sn.svg(_)&&_[v])?"attribute":sn.dom(_)&&vT(uj,v)?"transform":sn.dom(_)&&"transform"!==v&&YA(_,v)?"css":null!=_[v]?"object":void 0}function JA(_){if(sn.dom(_)){for(var w,v=_.style.transform||"",O=/(\w+)\(([^)]*)\)/g,D=new Map;w=O.exec(v);)D.set(w[1],w[2]);return D}}function OT(_,v,O,D){switch(MT(_,v)){case"transform":return function yj(_,v,O,D){var w=ry(v,"scale")?1:0+function gj(_){return ry(_,"translate")||"perspective"===_?"px":ry(_,"rotate")||ry(_,"skew")?"deg":void 0}(v),te=JA(_).get(v)||w;return O&&(O.transforms.list.set(v,te),O.transforms.last=v),D?TT(_,te,D):te}(_,v,D,O);case"css":return YA(_,v,O);case"attribute":return op(_,v);default:return _[v]||0}}function PT(_,v){var O=/^(\*=|\+=|-=)/.exec(_);if(!O)return _;var D=r0(_)||0,w=parseFloat(v),te=parseFloat(_.replace(O[0],""));switch(O[0][0]){case"+":return w+te+D;case"-":return w-te+D;case"*":return w*te+D}}function XA(_,v){if(sn.col(_))return function mj(_){return sn.rgb(_)?function pj(_){var v=/rgb\((\d+,\s*[\d]+,\s*[\d]+)\)/g.exec(_);return v?"rgba("+v[1]+",1)":_}(_):sn.hex(_)?function fj(_){var O=_.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(Pe,Ue,Xe,st){return Ue+Ue+Xe+Xe+st+st}),D=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(O);return"rgba("+parseInt(D[1],16)+","+parseInt(D[2],16)+","+parseInt(D[3],16)+",1)"}(_):sn.hsl(_)?function _j(_){var Pe,Ue,Xe,v=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(_)||/hsla\((\d+),\s*([\d.]+)%,\s*([\d.]+)%,\s*([\d.]+)\)/g.exec(_),O=parseInt(v[1],10)/360,D=parseInt(v[2],10)/100,w=parseInt(v[3],10)/100,te=v[4]||1;function fe(Ct,Wt,Kt){return Kt<0&&(Kt+=1),Kt>1&&(Kt-=1),Kt<1/6?Ct+6*(Wt-Ct)*Kt:Kt<.5?Wt:Kt<2/3?Ct+(Wt-Ct)*(2/3-Kt)*6:Ct}if(0==D)Pe=Ue=Xe=w;else{var st=w<.5?w*(1+D):w+D-w*D,vt=2*w-st;Pe=fe(vt,st,O+1/3),Ue=fe(vt,st,O),Xe=fe(vt,st,O-1/3)}return"rgba("+255*Pe+","+255*Ue+","+255*Xe+","+te+")"}(_):void 0}(_);if(/\s/g.test(_))return _;var O=r0(_),D=O?_.substr(0,_.length-O.length):_;return v?D+v:D}function xT(_,v){return Math.sqrt(Math.pow(v.x-_.x,2)+Math.pow(v.y-_.y,2))}function QA(_){for(var D,v=_.points,O=0,w=0;w<v.numberOfItems;w++){var te=v.getItem(w);w>0&&(O+=xT(D,te)),D=te}return O}function qA(_){if(_.getTotalLength)return _.getTotalLength();switch(_.tagName.toLowerCase()){case"circle":return function vj(_){return 2*Math.PI*op(_,"r")}(_);case"rect":return function Ej(_){return 2*op(_,"width")+2*op(_,"height")}(_);case"line":return function bj(_){return xT({x:op(_,"x1"),y:op(_,"y1")},{x:op(_,"x2"),y:op(_,"y2")})}(_);case"polyline":return QA(_);case"polygon":return function Cj(_){var v=_.points;return QA(_)+xT(v.getItem(v.numberOfItems-1),v.getItem(0))}(_)}}function e2(_,v){var O=v||{},D=O.el||function Mj(_){for(var v=_.parentNode;sn.svg(v)&&sn.svg(v.parentNode);)v=v.parentNode;return v}(_),w=D.getBoundingClientRect(),te=op(D,"viewBox"),fe=w.width,Pe=w.height,Ue=O.viewBox||(te?te.split(" "):[0,0,fe,Pe]);return{el:D,viewBox:Ue,x:Ue[0]/1,y:Ue[1]/1,w:fe,h:Pe,vW:Ue[2],vH:Ue[3]}}function Pj(_,v,O){function D(st){return void 0===st&&(st=0),_.el.getPointAtLength(v+st>=1?v+st:0)}var w=e2(_.el,_.svg),te=D(),fe=D(-1),Pe=D(1),Ue=O?1:w.w/w.vW,Xe=O?1:w.h/w.vH;switch(_.property){case"x":return(te.x-w.x)*Ue;case"y":return(te.y-w.y)*Xe;case"angle":return 180*Math.atan2(Pe.y-fe.y,Pe.x-fe.x)/Math.PI}}function t2(_,v){var O=/[+-]?\d*\.?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g,D=XA(sn.pth(_)?_.totalLength:_,v)+"";return{original:D,numbers:D.match(O)?D.match(O).map(Number):[0],strings:sn.str(_)||v?D.split(O):[]}}function DT(_){return WE(_?VE(sn.arr(_)?_.map(kA):kA(_)):[],function(O,D,w){return w.indexOf(O)===D})}function r2(_){var v=DT(_);return v.map(function(O,D){return{target:O,id:D,total:v.length,transforms:{list:JA(O)}}})}function xj(_,v){var O=ET(v);if(/^spring/.test(O.easing)&&(O.duration=KA(O.easing)),sn.arr(_)){var D=_.length;2!==D||sn.obj(_[0])?sn.fnc(v.duration)||(O.duration=v.duration/D):_={value:_}}var te=sn.arr(_)?_:[_];return te.map(function(fe,Pe){var Ue=sn.obj(fe)&&!sn.pth(fe)?fe:{value:fe};return sn.und(Ue.delay)&&(Ue.delay=Pe?0:v.delay),sn.und(Ue.endDelay)&&(Ue.endDelay=Pe===te.length-1?v.endDelay:0),Ue}).map(function(fe){return zE(fe,O)})}var i2={css:function(_,v,O){return _.style[v]=O},attribute:function(_,v,O){return _.setAttribute(v,O)},object:function(_,v,O){return _[v]=O},transform:function(_,v,O,D,w){if(D.list.set(v,O),v===D.last||w){var te="";D.list.forEach(function(fe,Pe){te+=Pe+"("+fe+") "}),_.style.transform=te}}};function s2(_,v){r2(_).forEach(function(D){for(var w in v){var te=CT(v[w],D),fe=D.target,Pe=r0(te),Ue=OT(fe,w,Pe,D),st=PT(XA(te,Pe||r0(Ue)),Ue),vt=MT(fe,w);i2[vt](fe,w,st,D.transforms,!0)}})}function Ij(_,v){return WE(VE(_.map(function(O){return v.map(function(D){return function wj(_,v){var O=MT(_.target,v.name);if(O){var D=function Rj(_,v){var O;return _.tweens.map(function(D){var w=function Sj(_,v){var O={};for(var D in _){var w=CT(_[D],v);sn.arr(w)&&1===(w=w.map(function(te){return CT(te,v)})).length&&(w=w[0]),O[D]=w}return O.duration=parseFloat(O.duration),O.delay=parseFloat(O.delay),O}(D,v),te=w.value,fe=sn.arr(te)?te[1]:te,Pe=r0(fe),Ue=OT(v.target,_.name,Pe,v),Xe=O?O.to.original:Ue,st=sn.arr(te)?te[0]:Xe,vt=r0(st)||r0(Ue),Ct=Pe||vt;return sn.und(fe)&&(fe=Xe),w.from=t2(st,Ct),w.to=t2(PT(fe,st),Ct),w.start=O?O.end:0,w.end=w.start+w.delay+w.duration+w.endDelay,w.easing=yT(w.easing,w.duration),w.isPath=sn.pth(te),w.isPathTargetInsideSVG=w.isPath&&sn.svg(v.target),w.isColor=sn.col(w.from.original),w.isColor&&(w.round=1),O=w,w})}(v,_),w=D[D.length-1];return{type:O,property:v.name,animatable:_,tweens:D,duration:w.end,delay:D[0].delay,endDelay:w.endDelay}}}(O,D)})})),function(O){return!sn.und(O)})}function n2(_,v){var O=_.length,D=function(te){return te.timelineOffset?te.timelineOffset:0},w={};return w.duration=O?Math.max.apply(Math,_.map(function(te){return D(te)+te.duration})):v.duration,w.delay=O?Math.min.apply(Math,_.map(function(te){return D(te)+te.delay})):v.delay,w.endDelay=O?w.duration-Math.max.apply(Math,_.map(function(te){return D(te)+te.duration-te.endDelay})):v.endDelay,w}var o2=0,_h=[],a2=function(){var _;function O(w){for(var te=_h.length,fe=0;fe<te;){var Pe=_h[fe];Pe.paused?(_h.splice(fe,1),te--):(Pe.tick(w),fe++)}_=fe>0?requestAnimationFrame(O):void 0}return"undefined"!=typeof document&&document.addEventListener("visibilitychange",function D(){!Ja.suspendWhenDocumentHidden||(l2()?_=cancelAnimationFrame(_):(_h.forEach(function(w){return w._onDocumentVisibility()}),a2()))}),function v(){!_&&(!l2()||!Ja.suspendWhenDocumentHidden)&&_h.length>0&&(_=requestAnimationFrame(O))}}();function l2(){return!!document&&document.hidden}function Ja(_){void 0===_&&(_={});var w,v=0,O=0,D=0,te=0,fe=null;function Pe(yr){var br=window.Promise&&new Promise(function(Rr){return fe=Rr});return yr.finished=br,br}var Ue=function Lj(_){var v=bT(GA,_),O=bT(mT,_),D=function Aj(_,v){var O=[],D=v.keyframes;for(var w in D&&(v=zE(function Dj(_){for(var v=WE(VE(_.map(function(te){return Object.keys(te)})),function(te){return sn.key(te)}).reduce(function(te,fe){return te.indexOf(fe)<0&&te.push(fe),te},[]),O={},D=function(te){var fe=v[te];O[fe]=_.map(function(Pe){var Ue={};for(var Xe in Pe)sn.key(Xe)?Xe==fe&&(Ue.value=Pe[Xe]):Ue[Xe]=Pe[Xe];return Ue})},w=0;w<v.length;w++)D(w);return O}(D),v)),v)sn.key(w)&&O.push({name:w,tweens:xj(v[w],_)});return O}(O,_),w=r2(_.targets),te=Ij(w,D),fe=n2(te,O),Pe=o2;return o2++,zE(v,{id:Pe,children:[],animatables:w,animations:te,duration:fe.duration,delay:fe.delay,endDelay:fe.endDelay})}(_);function st(){var yr=Ue.direction;"alternate"!==yr&&(Ue.direction="normal"!==yr?"normal":"reverse"),Ue.reversed=!Ue.reversed,w.forEach(function(br){return br.reversed=Ue.reversed})}function vt(yr){return Ue.reversed?Ue.duration-yr:yr}function Ct(){v=0,O=vt(Ue.currentTime)*(1/Ja.speed)}function Wt(yr,br){br&&br.seek(yr-br.timelineOffset)}function Lt(yr){for(var br=0,Rr=Ue.animations,$r=Rr.length;br<$r;){var si=Rr[br],Ci=si.animatable,Ti=si.tweens,ki=Ti.length-1,Fi=Ti[ki];ki&&(Fi=WE(Ti,function(Ns){return yr<Ns.end})[0]||Fi);for(var Xi=np(yr-Fi.start-Fi.delay,0,Fi.duration)/Fi.duration,rs=isNaN(Xi)?1:Fi.easing(Xi),Es=Fi.to.strings,Gs=Fi.round,ws=[],$i=Fi.to.numbers.length,qi=void 0,as=0;as<$i;as++){var bs=void 0,en=Fi.to.numbers[as],Cs=Fi.from.numbers[as]||0;bs=Fi.isPath?Pj(Fi.value,rs*en,Fi.isPathTargetInsideSVG):Cs+rs*(en-Cs),Gs&&(Fi.isColor&&as>2||(bs=Math.round(bs*Gs)/Gs)),ws.push(bs)}var xi=Es.length;if(xi){qi=Es[0];for(var Qi=0;Qi<xi;Qi++){var Is=Es[Qi+1],Qs=ws[Qi];isNaN(Qs)||(qi+=Is?Qs+Is:Qs+" ")}}else qi=ws[0];i2[si.type](Ci.target,si.property,qi,Ci.transforms),si.currentValue=qi,br++}}function nr(yr){Ue[yr]&&!Ue.passThrough&&Ue[yr](Ue)}function Er(yr){var br=Ue.duration,Rr=Ue.delay,$r=br-Ue.endDelay,si=vt(yr);Ue.progress=np(si/br*100,0,100),Ue.reversePlayback=si<Ue.currentTime,w&&function Kt(yr){if(Ue.reversePlayback)for(var Rr=te;Rr--;)Wt(yr,w[Rr]);else for(var br=0;br<te;br++)Wt(yr,w[br])}(si),!Ue.began&&Ue.currentTime>0&&(Ue.began=!0,nr("begin")),!Ue.loopBegan&&Ue.currentTime>0&&(Ue.loopBegan=!0,nr("loopBegin")),si<=Rr&&0!==Ue.currentTime&&Lt(0),(si>=$r&&Ue.currentTime!==br||!br)&&Lt(br),si>Rr&&si<$r?(Ue.changeBegan||(Ue.changeBegan=!0,Ue.changeCompleted=!1,nr("changeBegin")),nr("change"),Lt(si)):Ue.changeBegan&&(Ue.changeCompleted=!0,Ue.changeBegan=!1,nr("changeComplete")),Ue.currentTime=np(si,0,br),Ue.began&&nr("update"),yr>=br&&(O=0,function sr(){Ue.remaining&&!0!==Ue.remaining&&Ue.remaining--}(),Ue.remaining?(v=D,nr("loopComplete"),Ue.loopBegan=!1,"alternate"===Ue.direction&&st()):(Ue.paused=!0,Ue.completed||(Ue.completed=!0,nr("loopComplete"),nr("complete"),!Ue.passThrough&&"Promise"in window&&(fe(),Pe(Ue)))))}return Pe(Ue),Ue.reset=function(){var yr=Ue.direction;Ue.passThrough=!1,Ue.currentTime=0,Ue.progress=0,Ue.paused=!0,Ue.began=!1,Ue.loopBegan=!1,Ue.changeBegan=!1,Ue.completed=!1,Ue.changeCompleted=!1,Ue.reversePlayback=!1,Ue.reversed="reverse"===yr,Ue.remaining=Ue.loop;for(var br=te=(w=Ue.children).length;br--;)Ue.children[br].reset();(Ue.reversed&&!0!==Ue.loop||"alternate"===yr&&1===Ue.loop)&&Ue.remaining++,Lt(Ue.reversed?Ue.duration:0)},Ue._onDocumentVisibility=Ct,Ue.set=function(yr,br){return s2(yr,br),Ue},Ue.tick=function(yr){D=yr,v||(v=D),Er((D+(O-v))*Ja.speed)},Ue.seek=function(yr){Er(vt(yr))},Ue.pause=function(){Ue.paused=!0,Ct()},Ue.play=function(){!Ue.paused||(Ue.completed&&Ue.reset(),Ue.paused=!1,_h.push(Ue),Ct(),a2())},Ue.reverse=function(){st(),Ue.completed=!Ue.reversed,Ct()},Ue.restart=function(){Ue.reset(),Ue.play()},Ue.remove=function(yr){u2(DT(yr),Ue)},Ue.reset(),Ue.autoplay&&Ue.play(),Ue}function c2(_,v){for(var O=v.length;O--;)vT(_,v[O].animatable.target)&&v.splice(O,1)}function u2(_,v){var O=v.animations,D=v.children;c2(_,O);for(var w=D.length;w--;){var te=D[w],fe=te.animations;c2(_,fe),!fe.length&&!te.children.length&&D.splice(w,1)}!O.length&&!D.length&&v.pause()}Ja.version="3.2.1",Ja.speed=1,Ja.suspendWhenDocumentHidden=!0,Ja.running=_h,Ja.remove=function Uj(_){for(var v=DT(_),O=_h.length;O--;)u2(v,_h[O])},Ja.get=OT,Ja.set=s2,Ja.convertPx=TT,Ja.path=function Oj(_,v){var O=sn.str(_)?$A(_)[0]:_,D=v||100;return function(w){return{property:w,el:O,svg:e2(O),totalLength:qA(O)*(D/100)}}},Ja.setDashoffset=function Tj(_){var v=qA(_);return _.setAttribute("stroke-dasharray",v),v},Ja.stagger=function Bj(_,v){void 0===v&&(v={});var O=v.direction||"normal",D=v.easing?yT(v.easing):null,w=v.grid,te=v.axis,fe=v.from||0,Pe="first"===fe,Ue="center"===fe,Xe="last"===fe,st=sn.arr(_),vt=parseFloat(st?_[0]:_),Ct=st?parseFloat(_[1]):0,Wt=r0(st?_[1]:_)||0,Kt=v.start||0+(st?vt:0),Lt=[],nr=0;return function(sr,Er,yr){if(Pe&&(fe=0),Ue&&(fe=(yr-1)/2),Xe&&(fe=yr-1),!Lt.length){for(var br=0;br<yr;br++){if(w){var Rr=Ue?(w[0]-1)/2:fe%w[0],$r=Ue?(w[1]-1)/2:Math.floor(fe/w[0]),Ti=Rr-br%w[0],ki=$r-Math.floor(br/w[0]),Fi=Math.sqrt(Ti*Ti+ki*ki);"x"===te&&(Fi=-Ti),"y"===te&&(Fi=-ki),Lt.push(Fi)}else Lt.push(Math.abs(fe-br));nr=Math.max.apply(Math,Lt)}D&&(Lt=Lt.map(function(rs){return D(rs/nr)*nr})),"reverse"===O&&(Lt=Lt.map(function(rs){return te?rs<0?-1*rs:-rs:Math.abs(nr-rs)}))}return Kt+(st?(Ct-vt)/nr:vt)*(Math.round(100*Lt[Er])/100)+Wt}},Ja.timeline=function Nj(_){void 0===_&&(_={});var v=Ja(_);return v.duration=0,v.add=function(O,D){var w=_h.indexOf(v),te=v.children;function fe(Ct){Ct.passThrough=!0}w>-1&&_h.splice(w,1);for(var Pe=0;Pe<te.length;Pe++)fe(te[Pe]);var Ue=zE(O,bT(mT,_));Ue.targets=Ue.targets||_.targets;var Xe=v.duration;Ue.autoplay=!1,Ue.direction=v.direction,Ue.timelineOffset=sn.und(D)?Xe:PT(D,Xe),fe(v),v.seek(Ue.timelineOffset);var st=Ja(Ue);fe(st),te.push(st);var vt=n2(te,_);return v.delay=vt.delay,v.endDelay=vt.endDelay,v.duration=vt.duration,v.seek(0),v.reset(),v.autoplay&&v.play(),v},v},Ja.easing=yT,Ja.penner=ZA,Ja.random=function(_,v){return Math.floor(Math.random()*(v-_+1))+_};const jj=Ja;var Fj=T(77275),d2=T(73281),h2=T(55538),Wj=T(41840),AT=T(84687),Vj=T(61996);let nl=class extends((0,Vj.IG)(xn.wq)){constructor(_){super(_),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suggestionsEnabled=null,this.suffix="",this.withinViewEnabled=!1,this.zoomScale=null}};(0,Ze._)([(0,nt.Cb)()],nl.prototype,"autoNavigate",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"filter",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"getResults",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"getSuggestions",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"maxResults",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"maxSuggestions",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"minSuggestCharacters",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"outFields",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"placeholder",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"popupEnabled",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"popupTemplate",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"prefix",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"resultGraphicEnabled",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"resultSymbol",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"suggestionsEnabled",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"suffix",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"withinViewEnabled",void 0),(0,Ze._)([(0,nt.Cb)()],nl.prototype,"zoomScale",void 0),nl=(0,Ze._)([(0,ui.j)("esri.widgets.Search.SearchSource")],nl);const ST=nl,p2=pn.Z.getLogger("esri.widgets.Search.support.geometryUtils");function zj(_,v){var D,w;if(!v)return p2.error("missing-parameter: view is missing."),Promise.reject(new Ls.Z("searchgeometryutils:missing-parameter","view is missing."));if(!_)return p2.error("missing-parameter: point is missing."),Promise.reject(new Ls.Z("searchgeometryutils:missing-parameter","point is missing."));if(_.hasZ||"2d"===v.type)return Promise.resolve(_);const O=null==(D=null==v?void 0:v.map)?void 0:D.ground;return O&&O.layers.length?O.queryElevation(_,{cache:null==(w=v.basemapTerrain)?void 0:w.elevationQueryCache}).then(te=>te.geometry):Promise.resolve(_)}function f2(_){if((0,lt.Wi)(_))return null;switch(_.type){case"point":return _;case"extent":return _.center;case"polygon":return _.centroid;case"multipoint":return _.getPoint(0);case"polyline":return _.getPoint(0,0)}return null}function RT(_,v,O){return(0,lt.Wi)(_)?null:"extent"===_.type?_:"multipoint"===_.type||"polygon"===_.type||"polyline"===_.type?_.extent:"point"===_.type?_2(_,v,O):void 0}function wT(_,v,O){return(0,lt.Wi)(_)||(0,lt.Wi)(v)?null:_2(_.center,v,O)}function _2(_,v,O){const D=_.hasZ?_.z:void 0;return v&&v.map?(O?(0,Ri.D9)(v,O):v.extent).clone().centerAt(_).set({zmax:D,zmin:D}):new To.Z({xmin:_.x-.25,ymin:_.y-.25,xmax:_.x+.25,ymax:_.y+.25,spatialReference:_.spatialReference,zmin:D,zmax:D})}const Gj=/https?:\/\/services.*\.arcgis\.com/i,Hj=/(?:\{([^}]+)\})/g,_m=pn.Z.getLogger("esri.widgets.Search.support.layerSearchUtils");function m2(_,v){const{filter:O,withinViewEnabled:D}=_,w=v&&v.extent;return O&&O.geometry||(D&&w?w:void 0)}function g2(_){return _&&_.includes("*")}function y2(_){return IT.apply(this,arguments)}function IT(){return IT=(0,Ai.Z)(function*(_){_&&(yield _.load())}),IT.apply(this,arguments)}function v2(_){var v,O,D;return null!=(D=null==(O=null==(v=null==_?void 0:_.capabilities)?void 0:v.query)?void 0:O.supportsPagination)&&D}function E2(_){return _.displayField||_.layer.displayField||function $j(_){var v,O,D,w;return null!=(w=null==(D=null==(O=null==(v=null==_?void 0:_.fieldsIndex)?void 0:v.fields)?void 0:O.find(te=>"string"===te.type))?void 0:D.name)?w:""}(_.layer)}function GE(_,v){return!(!_||!v)&&v.every(O=>LT(_,O))}function LT(_,v){return!!_.getField(v)}function b2(_){return _.replace(/\'/g,"''")}function HE(_,v){const O=v&&v.where;return O?`(${_}) AND (${O})`:_}function C2({searchTerm:_,layer:v,searchFields:O,filter:D,exactMatch:w,type:te}){const{definitionExpression:fe,url:Pe}=v;let Ue="";return _&&O&&O.forEach(Xe=>{const st=v.getField(Xe),vt="function"==typeof v.getFieldDomain&&v.getFieldDomain(Xe),Ct=(vt&&"coded-value"===vt.type?function Yj(_,v,O){let D=null;const{codedValues:w}=_;return w&&w.some(te=>{const fe=te.name,Pe=O?fe:fe.toLowerCase();return(O?v:v.toLowerCase())===Pe&&(D=te.code.toString(),!0)}),D}(vt,_,w):null)||_||null;if(null!==Ct){const Wt=function Jj({currentTerm:_,field:v,filter:O,exactMatch:D,url:w,type:te}){const fe=v.type,Pe=v.name;if("string"===fe||"date"===fe||"global-id"===fe){const Ue=Gj.test(w),Xe=Ue&&function kj(_){for(let v=0;v<_.length;v++)if(_.charCodeAt(v)>255)return!0;return!1}(_)?"N":"";if(D&&"search"===te)return HE(`${Pe} = ${Xe}'${_}'`,O);const st=Ue?Pe:`UPPER(${Pe})`,vt=Ue?_:_.toUpperCase();return HE(`${st} LIKE ${Xe}${D?`'${vt}%'`:`'%${vt}%'`}`,O)}if("oid"===fe||"small-integer"===fe||"integer"===fe||"single"===fe||"double"===fe){const Ue=Number(_);return isNaN(Ue)?null:HE(`${Pe} = ${Ue}`,O)}return HE(`${Pe} = ${_}`,O)}({currentTerm:Ct,field:st,filter:D,exactMatch:w,url:Pe,type:te});Wt&&(Ue+=function Xj(_,v){return _?` OR (${v})`:`(${v})`}(Ue,Wt))}}),fe?`(${fe}) AND (${Ue})`:Ue}function T2(_,v,O){const D=_.sourceLayer,{attributes:w}=_,te="function"==typeof D.getFieldDomain&&D.getFieldDomain(O);if(v)return(0,YC.n)(v,w);if(O&&w){const fe=D.getField(O),Pe=function qj(_,v){return _[Object.keys(_).find(O=>O.toLowerCase()===v.toLowerCase())]}(w,O);return null==Pe?"":te&&"coded-value"===te.type?function Qj(_,v){let O=null;const{codedValues:D}=_;return D&&D.length&&D.some(w=>w.code===v&&(O=w.name,!0)),O}(te,Pe):"date"===(null==fe?void 0:fe.type)?(0,ou.p6)(new Date(Pe)):"number"==typeof Pe?Pe.toString():"string"!=typeof Pe?"":Pe.trim()}return""}var UT;let mh=UT=class extends ST{constructor(_){super(_),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(v,O)=>function Kj(_,v){const{exactMatch:O=!1,location:D,maxResults:w,spatialReference:te,source:fe,sourceIndex:Pe,suggestResult:Ue,view:Xe}=_,{layer:st,filter:vt,zoomScale:Ct}=fe,Wt=Xe&&Xe.scale,Kt=m2(fe,Xe),Lt=v&&v.signal;return y2(st).then(()=>{const nr=st.popupTemplate;return nr?nr.getRequiredFields(st.fieldsIndex):null}).then(nr=>{var Fi,Xi,rs;const{objectIdField:sr,returnZ:Er}=st,yr=E2(fe);if(!LT(st,yr))throw _m.error("invalid-field: displayField is invalid."),new Ls.Z("getResults():invalid-field","displayField is invalid.");const Rr=fe.outFields||(nr&&nr.length?nr:[yr]),$r=g2(Rr);if(Rr.includes(sr)||$r||Rr.push(sr),(null==(Fi=st.floorInfo)?void 0:Fi.floorField)&&Rr.push(st.floorInfo.floorField),!$r&&!GE(st,Rr))throw _m.error("invalid-field: outField is invalid."),new Ls.Z("getResults():invalid-field","outField is invalid.");const si=st.createQuery(),{orderByFields:Ci}=fe;if(Ci&&(si.orderByFields=Ci),te){si.outSpatialReference=te;const Es=1/(0,uv.c9)(te);Es&&(si.maxAllowableOffset=Es)}const Ti="mesh"===st.geometryType||"multipatch"===st.geometryType,ki=(null==(rs=null==(Xi=st.capabilities)?void 0:Xi.data)?void 0:rs.supportsZ)&&!Ti;if(si.returnZ=ki&&!1!==Er,si.returnGeometry=!0,si.multipatchOption=Ti?"xyFootprint":null,Rr&&(si.outFields=Rr),D)si.geometry=D;else if(Ue.key)si.objectIds=[Ue.key];else{const Es=fe.searchFields||[yr];if(!GE(st,Es))throw _m.error("invalid-field: search field is invalid."),new Ls.Z("getResults():invalid-field","search field is invalid.");if(v2(st)&&(si.num=w),Kt&&(si.geometry=Kt),!Ue.text.trim())return[];const{prefix:Gs="",suffix:ws=""}=fe,$i=C2({searchTerm:b2(`${Gs}${Ue.text}${ws}`),layer:st,searchFields:Es,filter:vt,exactMatch:O,type:"search"});if(!$i)return[];si.where=$i}return st.queryFeatures(si,{signal:Lt}).then(Es=>function iF(_,v,O,D,w,te,fe){return _.features.map(Pe=>function rF(_,v,O,D,w,te,fe){const Pe=_.clone(),Ue=_.sourceLayer,Xe=Ue&&Ue.objectIdField,st=Xe&&_.attributes[Xe],vt=T2(_,O.searchTemplate,w),Ct=RT(Pe.geometry,v,te),Wt="number"==typeof fe?wT((0,al.d9)(Ct),v,fe):Ct,Kt=_.clone();return(0,lt.pC)(Wt)&&(Kt.geometry=LP.Z.fromExtent(Wt)),{extent:Wt,target:Kt,feature:Pe,key:st,name:vt,sourceIndex:D}}(Pe,v,O,D,w,te,fe))}(Es,Xe,fe,Pe,yr,Wt,Ct))})}(or({source:this},v),O),this.getSuggestions=(v,O)=>function Zj(_,v){const{source:O,spatialReference:D,view:w,suggestTerm:te,maxSuggestions:fe,sourceIndex:Pe,exactMatch:Ue}=_,{layer:Xe,filter:st}=O,vt=v&&v.signal,Ct=m2(O,w);return y2(Xe).then(()=>{if(!v2(Xe))return[];const Wt=E2(O),Kt=O.searchFields||[Wt],Lt=[];O.suggestionTemplate?O.suggestionTemplate.replace(Hj,(Ti,ki)=>(Lt.push(ki),Ti)):Lt.push(Wt);const nr=g2(Lt);Lt.includes(Xe.objectIdField)||nr||Lt.push(Xe.objectIdField);const sr=LT(Xe,Wt),Er=nr||GE(Xe,Lt),yr=GE(Xe,Kt);if(!sr)throw _m.error("invalid-field: displayField is invalid."),new Ls.Z("getSuggestions():invalid-field","displayField is invalid.");if(!Er)throw _m.error("invalid-field: outField is invalid."),new Ls.Z("getSuggestions():invalid-field","outField is invalid.");if(!yr)throw _m.error("invalid-field: search field is invalid."),new Ls.Z("getSuggestions():invalid-field","search field is invalid.");const br=Xe.createQuery(),{orderByFields:Rr}=O;if(Rr&&(br.orderByFields=Rr),br.outSpatialReference=D,br.returnGeometry=!1,br.num=fe,br.outFields=Lt,Ct&&(br.geometry=Ct),!te.trim())return[];const{prefix:$r="",suffix:si=""}=O,Ci=C2({searchTerm:b2(`${$r}${te}${si}`),layer:Xe,searchFields:Kt,filter:st,exactMatch:Ue,type:"suggest"});return Ci?(br.where=Ci,Xe.queryFeatures(br,{signal:vt}).then(Ti=>function tF(_,v,O,D){return _.features.map(w=>function eF(_,v,O,D){const w=_.sourceLayer,{attributes:te}=_,{objectIdField:fe}=w,Pe=te[fe];return{text:T2(_,v.suggestionTemplate,D),key:Pe,sourceIndex:O}}(w,v,O,D))}(Ti,O,Pe,Wt))):[]})}(or({source:this},v),O)}set layer(_){this._set("layer",_),_&&_.load().catch(()=>{})}get name(){return this._getLayerTitle()||""}set name(_){void 0!==_?this._override("name",_):this._clearOverride("name")}clone(){return new UT({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,al.d9)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?(0,al.d9)(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){var _,v;return null!=(v=null==(_=this.layer.fieldsIndex.fields.find(O=>"string"===O.type))?void 0:_.name)?v:""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:_,searchFields:v}=this;return _.loaded?`: ${(v||[this._getDisplayField()]).map(O=>{const D=_.getField(O);return D&&D.alias||O}).join(", ")}`:""}_getLayerTitle(){const{layer:_}=this;if(!_)return;const{title:v}=_;return v?`${v}${this._getSearchFieldsString()}`:void 0}};(0,Ze._)([(0,nt.Cb)({json:{read:{source:"field.name"},write:{target:"field.name"}}})],mh.prototype,"displayField",void 0),(0,Ze._)([(0,nt.Cb)({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],mh.prototype,"exactMatch",void 0),(0,Ze._)([(0,nt.Cb)({value:null})],mh.prototype,"layer",null),(0,Ze._)([(0,nt.Cb)()],mh.prototype,"name",null),(0,Ze._)([(0,nt.Cb)({type:[String],json:{write:!0}})],mh.prototype,"orderByFields",void 0),(0,Ze._)([(0,nt.Cb)()],mh.prototype,"searchFields",void 0),(0,Ze._)([(0,nt.Cb)()],mh.prototype,"searchTemplate",void 0),(0,Ze._)([(0,nt.Cb)()],mh.prototype,"suggestionTemplate",void 0),mh=UT=(0,Ze._)([(0,ui.j)("esri.widgets.Search.LayerSearchSource")],mh);const mm=mh;function M2(_,v){if(v.localSearchDisabled)return null;const O=null==_?void 0:_.scale;return"number"==typeof O&&O<=3e5?_.get("extent.center"):null}function O2(_){return!!_&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(_)}function P2(_,v){const{filter:O,withinViewEnabled:D}=_,te=v&&v.extent;return RT(O&&O.geometry,v,v&&v.scale)||(D&&te?te:void 0)}function x2(_,v){return _.filter(Boolean).map(O=>function _F(_,v){const{key:O,scale:D,sourceIndex:w,view:te,zoomScale:fe,defaultZoomScale:Pe}=v,{attributes:Ue,extent:Xe,location:st,address:vt}=_,Ct=new Dn.Z({geometry:st,attributes:Ue}),Wt=Xe||st,Kt=RT(Wt,te,D),Lt="number"==typeof fe?wT(Kt,te,fe):"number"==typeof Pe&&"point"===Wt.type?wT(Kt,te,Pe):Kt,sr=vt||(st?`${st.x},${st.y}`:""),Er=Ct.clone();return(0,lt.pC)(Lt)&&(Er.geometry=LP.Z.fromExtent(Lt)),{extent:Lt,feature:Ct,target:Er,key:O,name:sr,sourceIndex:w}}(O,v))}var BT;let Ic=BT=class extends ST{constructor(_){super(_),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(v,O)=>function oF(_,v){return _.location?function dF(_,v){const{source:O,spatialReference:D,location:w,sourceIndex:te,view:fe}=_,{apiKey:Pe,url:Ue,zoomScale:Xe,defaultZoomScale:st}=O,vt=fe&&fe.scale,Ct=v&&v.signal,Wt=new VA;return Wt.location=w,Pe&&(Wt.apiKey=Pe),D&&(Wt.outSpatialReference=D),function tj(_,v,O){return fT.apply(this,arguments)}(Ue,Wt,{signal:Ct}).then(Kt=>x2([Kt],{sourceIndex:te,scale:vt,view:fe,zoomScale:Xe,defaultZoomScale:st})).catch(()=>[])}(_,v):function hF(_,v){const{source:O,suggestResult:D,spatialReference:w,view:te,maxResults:fe,sourceIndex:Pe}=_,Ue=O&&O.zoomScale,Xe=O&&O.defaultZoomScale;if(!D.text.trim())return Promise.resolve(null);const Ct=`${!D.key&&O.prefix?O.prefix:""}${D.text}${!D.key&&O.suffix?O.suffix:""}`,Wt=new FA,{apiKey:Kt,url:Lt}=O,nr=te&&te.scale,sr=P2(O,te),Er=v&&v.signal;if(Kt&&(Wt.apiKey=Kt),!Lt)return Promise.resolve(null);O.categories&&(Wt.categories=O.categories),O.locationType&&(Wt.locationType=O.locationType),w&&(Wt.outSpatialReference=w);const yr=M2(te,O);yr&&(Wt.location=yr),Wt.maxLocations=fe,sr&&(Wt.searchExtent=(0,lt.Wg)(sr)),O.countryCode&&(Wt.countryCode=O.countryCode);const{key:br}=D,Rr=`${br}`;return br&&(Wt.magicKey=Rr),Wt.address={},Wt.address[O.singleLineFieldName||"Single Line Input"]=Ct,O.outFields&&(Wt.outFields=O.outFields),WA(Lt,Wt,{signal:Er}).then($r=>x2($r,{key:Rr,scale:nr,sourceIndex:Pe,view:te,zoomScale:Ue,defaultZoomScale:Xe}))}(_,v)}(or({source:this},v),O),this.getSuggestions=(v,O)=>function aF(_,v){const{source:O,spatialReference:D,view:w,suggestTerm:te,maxSuggestions:fe,sourceIndex:Pe}=_,Ue=new zA,{apiKey:Xe,url:st}=O,vt=P2(O,w),Ct=v&&v.signal;if(!st)return Promise.resolve(null);Xe&&(Ue.apiKey=Xe),O.categories&&(Ue.categories=O.categories),D&&(Ue.outSpatialReference=D);const Wt=M2(w,O);if(Wt&&(Ue.location=Wt),!te.trim())return Promise.resolve(null);const{prefix:Kt="",suffix:Lt=""}=O;return Ue.text=`${Kt}${te}${Lt}`,vt&&(Ue.searchExtent=(0,lt.Wg)(vt)),Ue.maxSuggestions=fe,O.countryCode&&(Ue.countryCode=O.countryCode),function sj(_,v,O){return _T.apply(this,arguments)}(st,Ue,{signal:Ct}).then(sr=>function fF(_,v){return _.map(O=>function pF(_,v){return{text:_.text,key:_.magicKey,sourceIndex:v}}(O,v))}(sr,Pe))}(or({source:this},v),O)}clone(){return new BT({apiKey:this.apiKey,autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?(0,al.d9)(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?(0,al.d9)(this.categories):null,countryCode:this.countryCode,locationType:this.locationType,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})}};(0,Ze._)([(0,nt.Cb)()],Ic.prototype,"apiKey",void 0),(0,Ze._)([(0,nt.Cb)()],Ic.prototype,"categories",void 0),(0,Ze._)([(0,nt.Cb)()],Ic.prototype,"countryCode",void 0),(0,Ze._)([(0,nt.Cb)({json:{write:!0}})],Ic.prototype,"defaultZoomScale",void 0),(0,Ze._)([(0,nt.Cb)()],Ic.prototype,"localSearchDisabled",void 0),(0,Ze._)([(0,nt.Cb)()],Ic.prototype,"locationType",void 0),(0,Ze._)([(0,nt.Cb)({json:{write:!0}})],Ic.prototype,"name",void 0),(0,Ze._)([(0,nt.Cb)({json:{write:!0}})],Ic.prototype,"placeholder",void 0),(0,Ze._)([(0,nt.Cb)()],Ic.prototype,"searchTemplate",void 0),(0,Ze._)([(0,nt.Cb)({json:{write:!0}})],Ic.prototype,"singleLineFieldName",void 0),(0,Ze._)([(0,nt.Cb)({json:{read:{source:"suggest"},write:{target:"suggest"}}})],Ic.prototype,"suggestionsEnabled",void 0),(0,Ze._)([(0,nt.Cb)({json:{write:!0}})],Ic.prototype,"url",void 0),(0,Ze._)([(0,nt.Cb)({json:{write:!0}})],Ic.prototype,"zoomScale",void 0),Ic=BT=(0,Ze._)([(0,ui.j)("esri.widgets.Search.LocatorSearchSource")],Ic);const D2=Ic;T(72854);var A2=T(55214),r_=T(2076);new r_.X({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"}),new r_.X({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});let i_=class extends xn.wq{constructor(_){super(_),this.deviationUnit=null,this.geometries=null,this.maxDeviation=null}};(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],i_.prototype,"deviationUnit",void 0),(0,Ze._)([(0,nt.Cb)({json:{read:{reader:_=>_?_.map(v=>(0,Wl.im)(v)):null},write:{writer:(_,v)=>{v.geometries=_.map(O=>O.toJSON())}}}})],i_.prototype,"geometries",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0}})],i_.prototype,"maxDeviation",void 0),i_=(0,Ze._)([(0,ui.j)("esri.rest.support.GeneralizeParameters")],i_),i_.from=(0,Ro.se)(i_),new r_.X({preserveShape:"preserve-shape"});let df=class extends xn.wq{constructor(_){super(_),this.calculationType=null,this.geodesic=null,this.lengthUnit=null,this.polylines=null}};(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],df.prototype,"calculationType",void 0),(0,Ze._)([(0,nt.Cb)({type:Boolean,json:{write:!0}})],df.prototype,"geodesic",void 0),(0,Ze._)([(0,nt.Cb)({json:{write:!0}})],df.prototype,"lengthUnit",void 0),(0,Ze._)([(0,nt.Cb)({type:[A2.Z],json:{read:{reader:_=>_?_.map(v=>(0,Wl.im)(v)):null},write:{writer:(_,v)=>{v.polylines=_.map(O=>O.toJSON())}}}})],df.prototype,"polylines",void 0),df=(0,Ze._)([(0,ui.j)("esri.rest.support.LengthsParameters")],df),df.from=(0,Ro.se)(df),new r_.X({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),new r_.X({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});let s0=class extends xn.wq{constructor(_){super(_),this.bevelRatio=null,this.geometries=null,this.offsetDistance=null,this.offsetHow=null,this.offsetUnit=null}};(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0}})],s0.prototype,"bevelRatio",void 0),(0,Ze._)([(0,nt.Cb)({json:{read:{reader:_=>_?_.map(v=>(0,Wl.im)(v)):null},write:{writer:(_,v)=>{v.geometries=_.map(O=>O.toJSON())}}}})],s0.prototype,"geometries",void 0),(0,Ze._)([(0,nt.Cb)({type:Number,json:{write:!0}})],s0.prototype,"offsetDistance",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],s0.prototype,"offsetHow",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],s0.prototype,"offsetUnit",void 0),s0=(0,Ze._)([(0,ui.j)("esri.rest.support.OffsetParameters")],s0),s0.from=(0,Ro.se)(s0),new r_.X({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});let hf=class extends xn.wq{constructor(_){super(_),this.geometries1=null,this.geometries2=null,this.relation=null,this.relationParameter=null}};(0,Ze._)([(0,nt.Cb)({json:{read:{reader:_=>_?_.map(v=>(0,Wl.im)(v)):null},write:{writer:(_,v)=>{v.geometries1=_.map(O=>O.toJSON())}}}})],hf.prototype,"geometries1",void 0),(0,Ze._)([(0,nt.Cb)({json:{read:{reader:_=>_?_.map(v=>(0,Wl.im)(v)):null},write:{writer:(_,v)=>{v.geometries2=_.map(O=>O.toJSON())}}}})],hf.prototype,"geometries2",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],hf.prototype,"relation",void 0),(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],hf.prototype,"relationParameter",void 0),hf=(0,Ze._)([(0,ui.j)("esri.rest.support.RelationParameters")],hf),hf.from=(0,Ro.se)(hf),new r_.X({0:"default-curve-extension",1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});let s_=class extends xn.wq{constructor(_){super(_),this.extendHow="default-curve-extension",this.polylines=null,this.trimExtendTo=null}};(0,Ze._)([(0,nt.Cb)({type:String,json:{write:!0}})],s_.prototype,"extendHow",void 0),(0,Ze._)([(0,nt.Cb)({type:[A2.Z],json:{read:{reader:_=>_?_.map(v=>(0,Wl.im)(v)):null},write:{writer:(_,v)=>{v.polylines=_.map(O=>O.toJSON())}}}})],s_.prototype,"polylines",void 0),(0,Ze._)([(0,nt.Cb)({json:{read:{reader:_=>_?(0,Wl.im)(_):null},write:{writer:(_,v)=>{v.trimExtendTo=_.toJSON()}}}})],s_.prototype,"trimExtendTo",void 0),s_=(0,Ze._)([(0,ui.j)("esri.rest.support.TrimExtendParameters")],s_),s_.from=(0,Ro.se)(s_);const S2=pn.Z.getLogger("esri.widgets.support.geolocationUtils"),TF={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};function R2(){return function MF(){const _=(0,Jo.Z)("esri-geolocation");return _||S2.warn("geolocation-unsupported","Geolocation unsupported."),_}()&&function OF(){const _=window.isSecureContext;return _||S2.warn("insecure-context","Geolocation requires a secure origin."),_}()}var wF=T(13546),IF=T(35540);function Lc(_,v){return _.hasOwnProperty(v)&&null!=_[v]&&""!==_[v]}const w2="esri.widgets.Search.SearchViewModel",gh=pn.Z.getLogger(w2),I2="highlight",KE=Pn.Z.ofType({key:_=>_.layer?"layer":"locator",base:ST,typeMap:{layer:mm,locator:D2}}),L2=Xn.Z.WGS84,BF=/<(?:.|\s)*?>/g;let Wn=class extends((0,zD._)(sa.Z.EventedMixin(Bi.Z))){constructor(_){super(_),this._handles=new cn.Z,this._gotoController=null,this._searching=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new KE,this.defaultSymbols={point:new wF.Z({url:(0,hy.V)("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new HC.Z({color:[130,130,130,1],width:2}),polygon:new GC.Z({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=AT.Z.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new KE,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){var _=this;const v=function(){var O=(0,Ai.Z)(function*(){const D=yield(0,Wj.ME)("esri/widgets/Search/t9n/Search");_.messages=D,_.defaultPopupTemplate=new d2.Z({title:D.searchResult,content:"{Match_addr}"})});return function(){return O.apply(this,arguments)}}();v(),this._handles.add([(0,pt.YP)(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),pt.nn),(0,ey.qe)(v)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics(),this._handles.destroy(),this._handles=null}get activeSource(){return this.allSources.getItemAt(this.activeSourceIndex)||null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?-1:0}set activeSourceIndex(_){void 0!==_?this._override("activeSourceIndex",_):this._clearOverride("activeSourceIndex")}get allPlaceholder(){var _;return null==(_=this.messages)?void 0:_.allPlaceholder}set allPlaceholder(_){_?this._override("allPlaceholder",_):this._clearOverride("allPlaceholder")}get allSources(){const{sources:_,defaultSources:v,includeDefaultSources:O}=this,D="function"==typeof O?O.call(null,{sources:_,defaultSources:v}):O?v.concat(_):_,w=this._get("allSources")||new KE;return w.removeAll(),w.addMany(D.filter(Boolean)),w}get defaultSymbol(){return(0,h2.Mr)(gh,"defaultSymbol",{replacement:"defaultSymbols",version:"4.22"}),this._get("defaultSymbol")}set defaultSymbol(_){(0,h2.Mr)(gh,"defaultSymbol",{replacement:"defaultSymbols",version:"4.22"}),this._set("defaultSymbol",_)}get locationEnabled(){return this._get("locationEnabled")||R2()}set locationEnabled(_){if(void 0===_)return void this._clearOverride("locationEnabled");const v=R2();if(_&&!v){const O=new Ls.Z("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});gh.error(O)}this._override("locationEnabled",_&&v)}get placeholder(){const{allSources:_,activeSourceIndex:v,allPlaceholder:O}=this;if(-1===v)return O;const D=_.getItemAt(v);return D?D.placeholder:""}set searchTerm(_){this._set("searchTerm",_||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==_&&this._set("selectedSuggestion",null),""===_&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup(),this.view&&this.view.graphics.remove(this.resultGraphic),this._set("resultGraphic",null)}search(_,v){this.emit("search-start"),this.clearGraphics();const O=this._createSuggestionForSearch(_),D=this.when().then(()=>this._getResultsFromSources(O,v).then(w=>{var Ue;if(null==(Ue=(0,lt.Wg)(null==v?void 0:v.signal))?void 0:Ue.aborted)return null;const te={activeSourceIndex:this.activeSourceIndex,searchTerm:O.text,numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(te,w,O);const fe=this._getFirstResult(te.results),Pe=(O.location&&fe?fe.name:O.text).replace(BF,"");return this._set("searchTerm",Pe),(O.key&&"number"==typeof O.sourceIndex||O.location)&&this._set("selectedSuggestion",O),this._set("results",te.results),this._set("resultCount",te.results.reduce((Xe,st)=>Xe+st.results.length,0)),this.emit("search-complete",te),this._selectFirstResult(fe).then(()=>te)})).then(w=>(this._clearSearching(),w),w=>{throw this._clearSearching(),w});return this._searching=D,D}searchNearby(_){if(!this.locationEnabled){const O=new Ls.Z("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});return gh.error(O),Promise.reject(O)}const v=function PF(_){return _||(_=TF),new Promise((O,D)=>{setTimeout(()=>D(new Ls.Z("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(O,D,_)})}().then(O=>function xF(_,v){const{position:O,view:D}=_;return function SF(_,v,O){if(!v)return Promise.resolve(_);const D=v.spatialReference;return D.isWGS84?Promise.resolve(_):D.isWebMercator?Promise.resolve((0,sh.$)(_)):function RF(_){if(Ha.Z.geometryServiceUrl)return Promise.resolve(Ha.Z.geometryServiceUrl);const v=AT.Z.getDefault();return v.load(_).catch(()=>{}).then(()=>v.get("helperServices.geometry.url"))}(O).then(w=>{if(!w)throw new Ls.Z("geometry-service:missing-url","Geometry service URL is missing");const te=new AP.Z({geometries:[_],outSpatialReference:D});return(0,DP.i)(w,te,O).then(fe=>fe[0])})}(function AF(_){const v=_&&_.coords;return v?new vs.Z({longitude:v.longitude,latitude:v.latitude,z:v.altitude||null,spatialReference:{wkid:4326}}):null}(function DF(_){const v=_&&_.coords||{};return _&&{coords:{accuracy:v.accuracy,altitude:v.altitude,altitudeAccuracy:v.altitudeAccuracy,heading:v.heading,latitude:v.latitude,longitude:v.longitude,speed:v.speed},timestamp:_.timestamp}}(O)),D,v)}({position:O,view:this.view},_)).then(O=>this.search(O,_));return this._searching=v,v.catch(()=>{}).then(()=>this._clearSearching()),v}select(_){if(this.clearGraphics(),!_){const sr=new Ls.Z("select:missing-parameter","Cannot select without a searchResult.",{searchResult:_});return gh.error(sr),Promise.reject(sr)}const{view:v}=this,O=Lc(_,"sourceIndex")?_.sourceIndex:this._getSourceIndexOfResult(_),D=this.allSources.getItemAt(O);if(!D){const sr=new Ls.Z("select:missing-source","Cannot select without a source.",{source:D});return gh.error(sr),Promise.reject(sr)}const w=D instanceof mm?this._getLayerSourcePopupTemplate(D):D.popupTemplate,te=D.resultSymbol||this._getDefaultSymbol(_),fe=Lc(D,"resultGraphicEnabled")?D.resultGraphicEnabled:this.resultGraphicEnabled,Pe=Lc(D,"autoNavigate")?D.autoNavigate:this.autoNavigate,Ue=Lc(D,"popupEnabled")?D.popupEnabled:this.popupEnabled,Xe=Ue?w||this.popupTemplate||this.defaultPopupTemplate:null,{feature:st}=_;if(!st){const sr=new Ls.Z("select:missing-feature","Cannot select without a feature.",{feature:st});return gh.error(sr),Promise.reject(sr)}const{attributes:vt,geometry:Ct,layer:Wt,sourceLayer:Kt}=st,Lt=f2(Ct),nr={layerViewQuery:this._getLayerView(st),elevationQuery:v&&(0,lt.pC)(Lt)?zj(Lt,v).catch(()=>Lt):Promise.resolve(Lt)};return(0,zi.as)(nr).then(sr=>{const Er=sr.layerViewQuery.value,yr=sr.elevationQuery.value;te instanceof IF.Z&&(te.text=_.name);const br=v&&Pe?_.target||_.extent:null;return((0,lt.pC)(br)?this._goToSearchResult(br):Promise.resolve()).then(()=>{var Ci;const Rr=Er?st:new Dn.Z({geometry:Ct,symbol:te,attributes:vt,layer:Wt,sourceLayer:Kt,popupTemplate:Xe}),$r=Ue&&(null==(Ci=this.view)?void 0:Ci.popup),si=$r&&Rr.getEffectivePopupTemplate($r.defaultPopupTemplateEnabled);return si&&v.popup.open({features:[Rr],location:yr}),Er&&(0,ND.tl)(Er)&&!si&&this._highlightFeature({graphic:Rr,layerView:Er}),!Er&&fe&&v&&v.graphics.push(Rr),this._setResultFloor(_),this._set("selectedResult",_),this._set("resultGraphic",Rr),this.emit("select-result",{result:_,source:D,sourceIndex:O}),_})})}suggest(_,v,O){const D=_||this.searchTerm;return this.emit("suggest-start",{searchTerm:D}),this._suggestTimer(v,O).then(()=>this._suggestImmediate(D,O).then(w=>(this._set("suggestions",w.results),this._set("suggestionCount",w.results.reduce((te,fe)=>te+fe.results.length,0)),this.emit("suggest-complete",w),w)))}when(){var _=this;return(0,Ai.Z)(function*(){yield(0,pt.N1)(()=>!_.updating)})()}_update(){var _=this;return(0,Ai.Z)(function*(){const{portal:v,view:O}=_;if(_.includeDefaultSources){const D=_._updatingPromise=(0,zi.as)([null==v?void 0:v.load(),null==O?void 0:O.when()]);if(_.destroyed||(yield D,D!==_._updatingPromise))return}yield(0,pt.N1)(()=>_.messages),_.destroyed||_._updateDefaultSources(),_._updatingPromise=null})()}_clearSearching(){this._searching=null}_convertHelperServices(){var v,O;const _=null==(O=null==(v=this.portal)?void 0:v.helperServices)?void 0:O.geocode;return _?_.map(D=>{if(!1===D.placefinding)return;const w=Ha.Z.apiKey&&O2(D.url)?{url:"https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer"}:null,te=D2.fromJSON(or(or({},D),w)),fe=te.url;return(O2(fe)||function cF(_){return!!_&&/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/i.test(_)}(fe)||function lF(_){return!!_&&/(?:geocode\-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(_)}(fe))&&te.set({singleLineFieldName:"SingleLine",outFields:te.outFields||["Addr_type","Match_addr","StAddr","City"],placeholder:te.placeholder||this.messages.placeholder,defaultZoomScale:"number"==typeof te.defaultZoomScale?te.defaultZoomScale:2500}),te.singleLineFieldName?te:void 0}).filter(Boolean):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(_=>null==_?void 0:_.destroy()),this._createdFeatureLayers=[]}_getLayerSources(_,v){var D;const O=null==(D=this.view)?void 0:D.map;return _.map(w=>{const te=O.findLayerById(w.id);if(!te)return;const fe=this._getLayerJSON(w),Pe=mm.fromJSON(fe);return Pe.placeholder=v,this._getLayer(te,fe).then(Ue=>{Pe.layer=Ue}),Pe}).filter(Boolean).toArray()}_getTableSources(_,v){var D;const O=null==(D=this.view)?void 0:D.map;return _.map(w=>{const te=O.findTableById(w.id);if(!te)return;const fe=this._getLayerJSON(w),Pe=mm.fromJSON(fe);return Pe.placeholder=v,this._getLayer(te,fe).then(Ue=>{Pe.layer=Ue}),Pe}).filter(Boolean).toArray()}_convertApplicationProperties(){var fe,Pe,Ue;const _=null==(fe=this.view)?void 0:fe.map,v=null==(Ue=null==(Pe=null==_?void 0:_.applicationProperties)?void 0:Pe.viewing)?void 0:Ue.search;if(!v)return[];const{enabled:O,hintText:D,layers:w,tables:te}=v;return O?[...this._getLayerSources(w,D),...this._getTableSources(te,D)]:[]}_getSubLayer(_,v){var O=this;return(0,Ai.Z)(function*(){if(yield _.load(),!_.allSublayers)throw new Error;const D=_.allSublayers.find(te=>te.id===v.subLayer);if(!D)throw new Error;const w=yield D.createFeatureLayer();return O._createdFeatureLayers.push(w),w})()}_getBuildingSubLayer(_,v){return(0,Ai.Z)(function*(){yield _.load();const O=_.allSublayers.find(D=>D.id===v.subLayer);if("building-component"!==(null==O?void 0:O.type))throw new Error;if(yield O.load(),null==O.associatedLayer)throw new Error;return yield O.associatedLayer.load(),O})()}_getLayer(_,v){return"feature"===_.type||"scene"===_.type||"csv"===_.type||"geojson"===_.type||"ogc-feature"===_.type?Promise.resolve(_):"map-image"===_.type?this._getSubLayer(_,v).catch(()=>{const O=new Ls.Z("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:_});return gh.error(O),null}):"building-scene"===_.type?this._getBuildingSubLayer(_,v):Promise.resolve(null)}_getLayerJSON(_){return"function"==typeof _.toJSON?_.toJSON():_}_updateDefaultSources(){const{defaultSources:_,includeDefaultSources:v}=this;this._destroyFeatureLayers(),_.removeAll(),v&&_.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){var D;const _=null==(D=this.view)?void 0:D.popup,{resultGraphic:v}=this;if(!_||!v)return;const{selectedFeature:O}=_;O&&O===v&&_.close()}_suggestTimer(_,v){return(0,zi.e4)(null!=_?_:this.suggestionDelay,null,v&&v.signal)}_createLocationForSearch(_){return _ instanceof Dn.Z?f2(_.geometry):_ instanceof vs.Z?_:Array.isArray(_)&&2===_.length?new vs.Z({longitude:_[0],latitude:_[1]}):null}_createSuggestionForSearch(_){if(_&&Lc(_,"key")&&Lc(_,"text")&&Lc(_,"sourceIndex"))return _;const v=this._createLocationForSearch(_),O="string"==typeof _?_:this.searchTerm,{selectedSuggestion:D,selectedResult:w}=this,te=!_&&D&&w;return te&&D.key===w.key&&D.sourceIndex===w.sourceIndex||te&&D.location?D:{location:(0,lt.Wg)(v),text:v?"":O,sourceIndex:null,key:null}}_getFirstResult(_){let v=null;return _&&_.some(O=>{const{results:D}=O,w=D[0],te=!!w;return te&&(v=w),te}),v}_selectFirstResult(_){return this.autoSelect&&_?this.select(_):Promise.resolve(null)}_suggestImmediate(_,v){return this.when().then(()=>this._getSuggestionsFromSources(_,v)).then(O=>{var w;if(null==(w=(0,lt.Wg)(null==v?void 0:v.signal))?void 0:w.aborted)return null;const D={activeSourceIndex:this.activeSourceIndex,searchTerm:_,numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(D,O),D})}_formatSourceResponse(_,v,O){const D=v&&v.value||[],w=v&&v.error,te=this.allSources.getItemAt(O);w?(_.errors.push({sourceIndex:O,source:te,error:w}),gh.error(w),_.numErrors++):(_.results.push({sourceIndex:O,source:te,results:D}),_.numResults+=D.length)}_formatResponse(_,v,O){if(v)if(-1===_.activeSourceIndex){const D=O&&Lc(O,"sourceIndex")&&-1!==O.sourceIndex?O.sourceIndex:void 0;v.forEach((w,te)=>{this._formatSourceResponse(_,w,void 0!==D?D:te)})}else this._formatSourceResponse(_,v[0],_.activeSourceIndex)}_getResultsFromSources(_,v){const{allSources:O}=this,D=!_.location&&Lc(_,"sourceIndex")?_.sourceIndex:this.activeSourceIndex,w=[];if(!O.length){const te=new Ls.Z("search:no-sources-defined","At least one source is required.",{allSources:O});return gh.error(te),Promise.reject(te)}return-1===D?O.forEach((te,fe)=>{w.push(this._getResultsFromSource(_,fe,v))}):w.push(this._getResultsFromSource(_,D,v)),(0,zi.as)(w)}_getSuggestionsFromSources(_,v){const{allSources:O,activeSourceIndex:D}=this,w=[];if(!O.length){const te=new Ls.Z("suggest:no-sources-defined","At least one source is required.",{allSources:O});return gh.error(te),Promise.reject(te)}return-1===D?O.forEach((te,fe)=>{w.push(this._getSuggestionsFromSource(_,fe,v))}):w.push(this._getSuggestionsFromSource(_,D,v)),(0,zi.as)(w)}_getResultsFromSource(_,v,O){var Xe;const D=this.allSources.getItemAt(v),{location:w=null}=_,te=(null==(Xe=this.view)?void 0:Xe.spatialReference)||L2,fe=Lc(D,"maxResults")?D.maxResults:this.maxResults,Pe=!!(D instanceof mm&&Lc(D,"exactMatch"))&&D.exactMatch,{view:Ue}=this;return D.getResults({view:Ue,sourceIndex:v,location:w,suggestResult:_,spatialReference:te,exactMatch:Pe,maxResults:fe},O)}_getSuggestionsFromSource(_,v,O){var Pe;const D=this.allSources.getItemAt(v),w=Lc(D,"suggestionsEnabled")?D.suggestionsEnabled:this.suggestionsEnabled,te=_.length,fe=Lc(D,"minSuggestCharacters")?D.minSuggestCharacters:this.minSuggestCharacters;if(w&&_.trim()&&te>=fe){const Ue=(null==(Pe=this.view)?void 0:Pe.spatialReference)||L2,Xe=Lc(D,"maxSuggestions")?D.maxSuggestions:this.maxSuggestions,{view:st}=this,vt=!!(D instanceof mm&&Lc(D,"exactMatch"))&&D.exactMatch;return D.getSuggestions({view:st,sourceIndex:v,suggestTerm:_,spatialReference:Ue,maxSuggestions:Xe,exactMatch:vt},O)}return Promise.resolve(null)}_getLayerSourcePopupTemplate(_){const{layer:v}=_;if(v)return Lc(_,"popupTemplate")?_.popupTemplate:v.popupTemplate}_getSourceIndexOfResult(_){let O=null;return this.results.some(D=>D.results.some(w=>w===_&&(O=D.sourceIndex,!0))),O}_goToSearchResult(_){var v=this;return(0,Ai.Z)(function*(){const O=!!_;v._abortGoTo();const D=new AbortController;v._gotoController=D;const w={target:{target:_},options:{animate:O,signal:D.signal}};yield v.callGoTo(w),v._gotoController=null})()}_getDefaultSymbol(_){var w;const{defaultSymbols:v}=this,O=null==(w=_.feature)?void 0:w.geometry;if((0,lt.Wi)(O))return null;const D=this._get("defaultSymbol");if(D&&("point"===O.type||"multipoint"===O.type))return D;switch(O.type){case"point":case"multipoint":return v.point;case"polyline":return v.polyline;case"extent":case"polygon":return v.polygon;default:return null}}_removeHighlight(){this._handles.remove(I2)}_getLayerView(_){var v=this;return(0,Ai.Z)(function*(){const{view:O}=v;if(!_||!O||"building-component"===_.layer.type||"subtype-sublayer"===_.layer.type)return null;const{layer:D}=_;return yield O.when(),O.whenLayerView(D)})()}_highlightFeature(_){const{graphic:v,layerView:O}=_,{attributes:D,layer:w}=v,{objectIdField:te}=w,Pe=O.highlight(D&&D[te]||v);this._handles.add(Pe,I2)}_setResultFloor(_){var w,te,fe;const{view:v}=this,O=null==(w=_.feature)?void 0:w.attributes,D=null==(te=_.feature)?void 0:te.sourceLayer;D&&"floorInfo"in D&&(null==(fe=null==D?void 0:D.floorInfo)?void 0:fe.floorField)&&O&&v.emit("select-result-floor",O[D.floorInfo.floorField])}};Wn.ALL_INDEX=-1,(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"_searching",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"_updatingPromise",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0,value:null})],Wn.prototype,"activeSource",null),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"activeSourceIndex",null),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"allPlaceholder",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"allSources",null),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"autoNavigate",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"autoSelect",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"defaultPopupTemplate",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"defaultSources",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"defaultSymbol",null),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"defaultSymbols",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"includeDefaultSources",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"locationEnabled",null),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"maxInputLength",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"maxResults",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"maxSuggestions",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"messages",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"minSuggestCharacters",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"placeholder",null),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"popupEnabled",void 0),(0,Ze._)([(0,nt.Cb)({type:d2.Z})],Wn.prototype,"popupTemplate",void 0),(0,Ze._)([(0,nt.Cb)({type:AT.Z})],Wn.prototype,"portal",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"resultCount",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"resultGraphicEnabled",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"resultGraphic",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"results",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"selectedSuggestion",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"searchAllEnabled",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"selectedResult",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"searchTerm",null),(0,Ze._)([(0,nt.Cb)({type:KE})],Wn.prototype,"sources",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"state",null),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"suggestionDelay",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"suggestionCount",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"suggestions",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"suggestionsEnabled",void 0),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Wn.prototype,"updating",null),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"view",void 0),(0,Ze._)([(0,nt.Cb)()],Wn.prototype,"clear",null),Wn=(0,Ze._)([(0,ui.j)(w2)],Wn);const ym=Wn;let pf=class extends wu.Z{constructor(_,v){super(_,v),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}render(){return(0,pi.u)("div",{class:"esri-search-result-renderer esri-widget"},(0,pi.u)("div",{key:"esri-search-renderer__container",class:this.classes("esri-search-result-renderer__more-results",{"esri-search-result-renderer__more-results--show-more-results":this.showMoreResultsOpen})},this.renderSearchResultName(),this.renderMoreResults()))}renderMoreResults(){return(0,pi.u)("div",{key:"esri-search-renderer__more-results"},this.renderMoreResultsButton(),this.renderMoreResultsLists())}renderSearchResultName(){var O;const _=null==(O=this.viewModel)?void 0:O.selectedResult;return(0,pi.u)("div",{key:"esri-search-renderer__result-name",class:"esri-search-result-renderer__more-results-item"},_&&_.name||"")}renderMoreResultsLists(){var D;const _=null==(D=this.viewModel)?void 0:D.results,{resultCount:v}=this.viewModel;if(v<2)return null;const O=_.map(w=>this.renderMoreResultsList(w));return(0,pi.u)("div",{key:"esri-search-renderer__more-results-container",class:"esri-search-result-renderer__more-results-list"},O)}renderMoreResultsButton(){const{messages:_}=this,{resultCount:v}=this.viewModel;return v<2?null:(0,pi.u)("div",{key:"esri-search-renderer__more-results-button",class:"esri-search-result-renderer__more-results-item"},(0,pi.u)("a",{class:"esri-widget__anchor",href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?_.hideMoreResults:_.showMoreResults))}renderMoreResultsHeader(_,v){return(0,pi.u)("div",{key:`esri-search-result-renderer__header-${v}`,class:"esri-search-result-renderer__more-results-list-header"},_)}renderMoreResultsList(_){var st,vt;const{results:v}=_,O=v.length,D=!!O,w=null==(st=this.viewModel)?void 0:st.selectedResult,te=1===O&&v[0]===w,fe=this._getSourceName(_.source,_.sourceIndex),Pe=(null==(vt=this.viewModel)?void 0:vt.results.length)>1&&!te?this.renderMoreResultsHeader(fe,_.sourceIndex):null,Ue=D&&v.map((Ct,Wt)=>this.renderMoreResultsListItem(Ct,Wt)),Xe=D&&!te?(0,pi.u)("ul",{key:`esri-search-result-renderer__list-${_.sourceIndex}`},Ue):null;return D?(0,pi.u)("div",{key:`esri-search-result-renderer__results-${_.sourceIndex}`},Pe,Xe):null}renderMoreResultsListItem(_,v){return _!==this.get("viewModel.selectedResult")?(0,pi.u)("li",{key:`esri-search-result-renderer__list-item-${v}`},(0,pi.u)("a",{class:"esri-widget__anchor",href:"#",tabindex:"0",bind:this,"data-result":_,onclick:this._selectResultClick,onkeydown:this._selectResultClick},_.name)):null}_showMoreResultsClick(_){_.preventDefault(),this.showMoreResultsOpen=!this.showMoreResultsOpen;const v=this.get("viewModel.view.popup");v&&v.reposition()}_selectResultClick(_){_.preventDefault(),this.viewModel&&this.viewModel.select(_.currentTarget["data-result"])}_getSourceName(_,v){return v===ym.ALL_INDEX?this.messages.all:_.name}};(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Search/t9n/Search")],pf.prototype,"messages",void 0),(0,Ze._)([(0,nt.Cb)()],pf.prototype,"showMoreResultsOpen",void 0),(0,Ze._)([(0,nt.Cb)()],pf.prototype,"viewModel",void 0),(0,Ze._)([(0,kh.h)()],pf.prototype,"_showMoreResultsClick",null),(0,Ze._)([(0,kh.h)()],pf.prototype,"_selectResultClick",null),pf=(0,Ze._)([(0,ui.j)("esri.widgets.Search.SearchResultRenderer")],pf);const NF=pf;var jF=T(78745);const Js_button="esri-widget--button",FF=/<[a-z/][\s\S]*>/i;let Hn=class extends wu.Z{constructor(_,v){super(_,v),this._activeMenuItemIndex=-1,this._handles=new cn.Z,this._inputNode=null,this._menuItemCount=0,this._sourceMenuButtonNode=null,this._sourceListNode=null,this._suggestionListNode=null,this._searchResultRenderer=new NF,this._locateFailed=null,this._container=null,this.activeMenu="none",this.activeSource=null,this.activeSourceIndex=null,this.allPlaceholder=null,this.allSources=null,this.autoNavigate=null,this.autoSelect=null,this.defaultSources=null,this.disabled=!1,this.goToOverride=null,this.iconClass="esri-icon-search",this.includeDefaultSources=null,this.label=void 0,this.locationEnabled=null,this.maxResults=null,this.maxSuggestions=null,this.messages=null,this.messagesCommon=null,this.minSuggestCharacters=null,this.popupEnabled=null,this.popupTemplate=null,this.portal=null,this.resultGraphic=null,this.resultGraphicEnabled=null,this.results=null,this.searchAllEnabled=null,this.searchTerm=null,this.selectedResult=null,this.sources=null,this.suggestions=null,this.suggestionsEnabled=null,this.view=null,this.viewModel=new ym,this._clearActiveMenu=()=>{this.activeMenu="none"},this._removeActiveMenu=O=>{var w;const D=O.relatedTarget;D&&(null==(w=this._container)?void 0:w.contains(D))||this._clearActiveMenu()},this.own([(0,pt.YP)(()=>this.searchTerm,O=>{(O&&"warning"===this.activeMenu||!O&&!this.get("viewModel.selectedSuggestion.location"))&&this._clearActiveMenu()}),(0,pt.on)(()=>{var O;return null==(O=this.viewModel)?void 0:O.allSources},"change",()=>this._watchSourceChanges()),(0,pt.YP)(()=>this.activeMenu,()=>this._resetActiveMenuItemIndex(),pt.nn),(0,pt.YP)(()=>{var O;return null==(O=this.viewModel)?void 0:O.defaultPopupTemplate},O=>{O&&(O.content=this._renderSearchResultsContent.bind(this))},pt.nn)])}destroy(){this._handles.destroy(),this._handles=null,this._cancelSuggest(),this._cancelSearch(),this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=null)}get displayedSearchTerm(){return`${this.viewModel.searchTerm}`.trim()}get inputId(){return this._buildId("input")}get suggestionsMenuId(){return this._buildId("suggest-menu")}get sourceMenuId(){return this._buildId("source-menu")}get sourceMenuButtonId(){return this._buildId("source-menu-button")}clear(){}focus(){var _;null==(_=this._inputNode)||_.focus(),this.emit("search-focus")}blur(){var _;null==(_=this._inputNode)||_.blur(),this.emit("search-blur")}search(_){this._clearActiveMenu(),this._cancelSuggest(),this._cancelSearch();const v=new AbortController,{signal:O}=v;return this._searchController=v,this.viewModel.search(_,{signal:O}).catch(D=>{if(this._searchController===v)return this._clearActiveMenu(),this._searchController=null,D}).then(D=>{if(this._searchController===v)return this.activeMenu=D.numResults?"none":"warning",this._searchController=null,D})}suggest(_){this._cancelSuggest();const v=new AbortController,{signal:O}=v;return this._suggestController=v,this.viewModel.suggest(_,null,{signal:O}).then(D=>{if(this._suggestController===v)return this._suggestController=null,D.numResults&&this._openSuggestionMenu(),this._scrollToTopSuggestion(),D}).catch(()=>{if(this._suggestController===v)return this._suggestController=null,null})}render(){const{state:_}=this.viewModel;return(0,pi.u)("div",{class:this.classes("esri-search esri-widget",{"esri-disabled":"disabled"===_,"esri-widget--disabled":this.disabled})},"loading"===_?this.renderLoader():this.renderContainer())}renderSubmitButton(){const{messages:_,disabled:v}=this;return(0,pi.u)("button",{"aria-label":_.searchButtonTitle,bind:this,disabled:v,class:this.classes("esri-search__submit-button",Js_button),key:"esri-search__submit-button",onclick:this._handleSearchButtonClick,title:_.searchButtonTitle,type:"button"},(0,pi.u)("span",{"aria-hidden":"true",class:"esri-icon-search"}))}renderWarningMenu(){return(0,pi.u)("div",{key:"esri-search__error-menu",class:this.classes("esri-menu","esri-search__warning-menu")},(0,pi.u)("div",{class:"esri-search__warning-body"},this.renderWarning()))}renderSourceMenuButton(){const{messages:_,activeMenu:v,sourceMenuId:O,sourceMenuButtonId:D,disabled:w}=this,{activeSourceIndex:te,allSources:fe}=this.viewModel;return fe.length>1?(0,pi.u)("button",{id:D,key:"esri-search__source-menu-button",bind:this,disabled:w,"aria-label":_.searchIn,title:_.searchIn,"aria-haspopup":"true","aria-expanded":("source"===v).toString(),"aria-controls":O,class:this.classes("esri-search__sources-button",Js_button),onclick:this._handleSourcesMenuToggleClick,onfocus:this._handleSourcesMenuToggleFocus,afterCreate:Nl.Yo,"data-node-ref":"_sourceMenuButtonNode",type:"button"},(0,pi.u)("span",{"aria-hidden":"true",class:"esri-icon-down-arrow esri-search__sources-button--down"}),(0,pi.u)("span",{"aria-hidden":"true",class:"esri-icon-up-arrow esri-search__sources-button--up"}),(0,pi.u)("span",{class:"esri-search__source-name"},this._getSourceName(te))):null}renderSourcesList(){const{allSources:_,searchAllEnabled:v}=this.viewModel,{_activeMenuItemIndex:O,activeMenu:D,sourceMenuId:w,sourceMenuButtonId:te}=this,fe="source"===D&&O>-1?this._buildId("source-item",O):null;return _.length>1?(0,pi.u)("ul",{"aria-activedescendant":fe,"aria-labelledby":te,id:w,role:"menu",bind:this,afterCreate:Nl.Yo,onkeydown:this._handleSourceMenuKeydown,onkeyup:this._handleSourceMenuKeyup,"data-node-ref":"_sourceListNode",class:"esri-menu__list",tabIndex:-1},v?this.renderSource(ym.ALL_INDEX):null,_.map((Pe,Ue)=>this.renderSource(Ue)).toArray()):null}renderSourcesMenu(){const{allSources:_}=this.viewModel;return _.length>1?(0,pi.u)("div",{key:"esri-search__source-menu",class:this.classes("esri-menu","esri-search__sources-menu")},this.renderSourcesList()):null}renderLoader(){const{messages:_,messagesCommon:v,disabled:O}=this;return(0,pi.u)("div",{class:"esri-widget__loader",key:"base-loader",tabIndex:O?-1:null},(0,pi.u)("span",{"aria-hidden":"true",class:"esri-widget__loader-animation"}),(0,pi.u)("span",{class:"esri-icon-font-fallback-text"},_.searchButtonTitle),(0,pi.u)("span",{class:"esri-widget__loader-text"},v.loading))}renderContainer(){const{allSources:_,state:v}=this.viewModel,{activeMenu:O}=this;return(0,pi.u)("div",{tabIndex:-1,afterCreate:w=>{this._container=w,w.addEventListener("focusout",this._removeActiveMenu)},afterRemoved:w=>{w.removeEventListener("focusout",this._removeActiveMenu)},class:this.classes({"esri-search--multiple-sources":_.length>1,"esri-search--loading":"loading"===v,"esri-search--searching":"searching"===v,"esri-search--warning":"warning"===O,"esri-search--sources":"source"===O,"esri-search--show-suggestions":"suggestion"===O},"esri-search__container"),key:"base-container"},this.renderSourceMenuButton(),this.renderSourcesMenu(),this.renderInputContainer(),this.renderSubmitButton(),this.renderWarningMenu())}renderClearButton(){return this.searchTerm?(0,pi.u)("button",{bind:this,disabled:this.disabled,class:this.classes("esri-search__clear-button",Js_button),key:"esri-search__clear-button",onclick:this._handleClearButtonClick,onfocus:this._clearActiveMenu,title:this.messages.clearButtonTitle,type:"button"},(0,pi.u)("span",{"aria-hidden":"true",class:"esri-icon-close"})):null}renderLocationGroup(){const{messages:_,locationEnabled:v,displayedSearchTerm:O}=this,w="suggestion"===this.activeMenu&&0===this._activeMenuItemIndex;return v&&!O?(0,pi.u)("ul",{role:"group",key:"esri-search__suggestion-list-current-location",class:this.classes("esri-menu__list","esri-search__suggestions-list","esri-search__suggestions-list--current-location")},(0,pi.u)("li",{bind:this,"data-current-location-item":!0,onclick:this._handleUseCurrentLocationClick,id:this._buildId("suggestion-item",0),"aria-selected":("suggestion"===this.activeMenu&&0===this._activeMenuItemIndex).toString(),role:"option",class:this.classes("esri-menu__list-item",w?"esri-menu__list-item--focus":null)},(0,pi.u)("span",{"aria-hidden":"true",class:"esri-icon-locate-circled"})," ",_.useCurrentLocation)):null}renderInput(){const{activeMenu:_,locationEnabled:v,displayedSearchTerm:O,messages:D,suggestionsMenuId:w,inputId:te,_activeMenuItemIndex:fe,disabled:Pe}=this,{maxInputLength:Ue,placeholder:Xe,searchTerm:st,suggestionCount:vt}=this.viewModel,Ct=!((!v||O)&&!vt),Wt="suggestion"===_&&fe>-1?this._buildId("suggestion-item",fe):null;return(0,pi.u)("input",{"aria-activedescendant":Wt,"aria-autocomplete":"list","aria-expanded":(Ct&&"suggestion"===_).toString(),"aria-controls":Ct?w:null,"aria-haspopup":"listbox","aria-label":D.searchButtonTitle,bind:this,disabled:Pe,placeholder:Xe,maxlength:Ue,autocomplete:"off",type:"text",class:this.classes("esri-input","esri-search__input"),value:st,id:te,role:"combobox",onkeyup:this._handleInputKeyup,onclick:this._openSuggestionMenu,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:Nl.Yo,"data-node-ref":"_inputNode",onfocus:this.focus,onblur:this.blur,title:st?"":Xe})}renderForm(){return(0,pi.u)("form",{key:"esri-search__form",bind:this,disabled:this.disabled,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},this.renderInput())}renderSuggestList(_){const{sourceIndex:v}=_,D=_.results;return _.results.length?(0,pi.u)("ul",{role:"group",key:`esri-search__suggestion-list-${v}`,class:this.classes("esri-menu__list","esri-search__suggestions-list")},D.map(w=>this.renderSuggestion(w,this._menuItemCount++))):null}renderSuggestionsGroup(){const{suggestions:_}=this.viewModel;return _?_.map(v=>[this.renderSuggestionHeader(v),this.renderSuggestList(v)]):null}renderSuggestionsMenu(){const{displayedSearchTerm:_,locationEnabled:v,suggestionsMenuId:O,inputId:D}=this,{suggestionCount:w}=this.viewModel,te=v&&!_||w;return this._menuItemCount=0,te?(0,pi.u)("div",{id:O,key:"esri-search__suggestions-menu",class:this.classes("esri-menu","esri-search__suggestions-menu"),role:"listbox","aria-labelledby":D,bind:this,afterCreate:Nl.Yo,"data-node-ref":"_suggestionListNode"},this.renderLocationGroup(),this.renderSuggestionsGroup()):null}renderInputContainer(){return(0,pi.u)("div",{key:"esri-search__input-container",class:"esri-search__input-container"},this.renderForm(),this.renderSuggestionsMenu(),this.renderClearButton())}renderSuggestionHeader(_){const{allSources:v,activeSourceIndex:O}=this.viewModel,{sourceIndex:D}=_;return _.results.length&&v.length>1&&O===ym.ALL_INDEX?(0,pi.u)("div",{key:`esri-search__suggestion-header-${D}`,class:"esri-menu__header"},this._getSourceName(D)):null}renderSuggestion(_,v){const{_activeMenuItemIndex:O,messages:D}=this,{searchTerm:w}=this.viewModel;if(w){const{text:te}=_,fe=te||D.untitledResult,Pe=FF.test(fe),Ue=[];if(Pe)Ue.push((0,pi.u)("div",{innerHTML:fe}));else{const st=this._splitResult(fe,w),vt=w.toLowerCase();st.forEach((Ct,Wt)=>{Ct&&Ct.length&&(Ct.toLowerCase()===vt?Ue.push((0,pi.u)("strong",{key:Wt},Ct)):Ue.push(Ct))})}const Xe="suggestion"===this.activeMenu&&O===v;return(0,pi.u)("li",{bind:this,id:this._buildId("suggestion-item",v),"aria-selected":("suggestion"===this.activeMenu&&this._activeMenuItemIndex===v).toString(),onclick:this._handleSuggestionClick,key:`esri-search__suggestion_${v}`,"data-suggestion":_,role:"option",class:this.classes("esri-menu__list-item",Xe?"esri-menu__list-item--focus":null)},Ue)}}renderSource(_){const{activeSourceIndex:v,searchAllEnabled:O}=this.viewModel,D={"esri-menu__list-item--active":_===v,"esri-menu__list-item--focus":"source"===this.activeMenu&&_===(O?this._activeMenuItemIndex-1:this._activeMenuItemIndex)};return(0,pi.u)("li",{bind:this,key:`esri-search__source-${_}`,id:this._buildId("source-item",O?_+1:_),"aria-checked":(_===v).toString(),onclick:this._handleSourceClick,"data-source-index":_,role:"menuitemradio",class:this.classes("esri-search__source","esri-menu__list-item",D)},this._getSourceName(_))}renderNoResultsWarning(_){const{messages:v}=this,O=_?(0,YC.n)(v.noResultsFoundForValue,{value:`"${_}"`}):v.noResultsFound;return(0,pi.u)("div",{key:"esri-search__no_results"},(0,pi.u)("div",{class:"esri-search__warning-header"},v.noResults),(0,pi.u)("div",{class:"esri-search__warning-text"},O))}renderEmptySearchWarning(){const{messages:_}=this;return(0,pi.u)("div",{key:"esri-search__empty-search"},(0,pi.u)("span",{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),(0,pi.u)("span",{class:"esri-search__no-value-text"},_.emptyValue))}renderLocateWarning(){const{messages:_}=this;return(0,pi.u)("div",{key:"esri-search__locate-error"},(0,pi.u)("span",{"aria-hidden":"true",class:"esri-icon-notice-triangle"}),(0,pi.u)("span",{class:"esri-search__no-value-text"},_.locateError))}renderWarning(){var D;const{displayedSearchTerm:_,_locateFailed:v}=this,{viewModel:O}=this;return v?this.renderLocateWarning():(null==(D=O.selectedSuggestion)?void 0:D.location)||_?this.renderNoResultsWarning(_):this.renderEmptySearchWarning()}_resetActiveMenuItemIndex(){this._activeMenuItemIndex=-1}_buildId(_,v){return`${this.id}-${_}${void 0===v?"":`-${v}`}`}_watchSourceChanges(){const{_handles:_,viewModel:{allSources:v}}=this,O="sources";_.remove(O),v.forEach(D=>_.add((0,pt.YP)(()=>D.name,()=>this.scheduleRender()),O))}_handleSourcesMenuToggleFocus(){"source"!==this.activeMenu&&this._clearActiveMenu()}_handleSourcesMenuToggleClick(){var v;this.activeMenu="source"===this.activeMenu?"none":"source",this.renderNow(),"source"===this.activeMenu&&(null==(v=this._sourceListNode)||v.focus())}_handleClearButtonClick(){this.viewModel.clear(),this._focus()}_handleSearchButtonClick(){this.search()}_handleSuggestionClick(_){const v=_.currentTarget["data-suggestion"];v&&(this._focus(),this.search(v))}_handleUseCurrentLocationClick(){this._useCurrentLocation()}_useCurrentLocation(){this._focus("none"),this._cancelSuggest(),this._cancelSearch();const _=new AbortController,{signal:v}=_;this._searchController=_,this.viewModel.searchNearby({signal:v}).then(O=>{this.activeMenu=O.numResults?"none":"warning"}).catch(()=>{this._locateFailed=!0,this.activeMenu="warning"}).then(()=>{this._searchController=null})}_handleSourceClick(_){this._setSourceFromMenuItem(_.currentTarget)}_setSourceFromMenuItem(_){var O;_&&(this.viewModel.activeSourceIndex=_["data-source-index"],this._clearActiveMenu(),null==(O=this._sourceMenuButtonNode)||O.focus())}_cancelSuggest(){this._suggestController&&(this._suggestController.abort(),this._suggestController=null)}_cancelSearch(){this._searchController&&(this._searchController.abort(),this._searchController=null),this._locateFailed=!1}_handleInputKeyup(_){var w;const v=(0,mt.kK)(_);if(_.ctrlKey||_.metaKey||"Copy"===v||"ArrowLeft"===v||"ArrowRight"===v||"Shift"===v)return;if("Tab"===v||"Escape"===v||_.shiftKey&&"Tab"===v)return this._cancelSuggest(),void("Escape"===v&&this._clearActiveMenu());const O="Home"===v||"End"===v||"ArrowUp"===v||"ArrowDown"===v;if("Enter"===v&&this._activeMenuItemIndex<0)return void this._cancelSuggest();const D=null==(w=this._suggestionListNode)?void 0:w.getElementsByTagName("li");if(null==D?void 0:D.length){if("suggestion"!==this.activeMenu&&this._openSuggestionMenu(),O)return _.preventDefault(),this._cancelSuggest(),void this._handleItemNavigation(v,D,this._suggestionListNode);const te=D[this._activeMenuItemIndex];if("Enter"===v&&te){const fe=te["data-suggestion"];return void(fe?(this._focus(),this.search(fe)):te["data-current-location-item"]&&this._useCurrentLocation())}}this.viewModel.searchTerm&&this.suggest()}_handleItemNavigation(_,v,O){const D=this._activeMenuItemIndex;"Home"===_&&(this._activeMenuItemIndex=0),"End"===_&&(this._activeMenuItemIndex=v.length-1),"ArrowUp"===_&&(this._activeMenuItemIndex=this._activeMenuItemIndex<=0?v.length-1:this._activeMenuItemIndex-1),"ArrowDown"===_&&(this._activeMenuItemIndex=this._activeMenuItemIndex===v.length-1?0:this._activeMenuItemIndex+1),D!==this._activeMenuItemIndex&&(0,Nl._q)(v[this._activeMenuItemIndex],O)}_scrollToTopSuggestion(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)}_openSuggestionMenu(){this.activeMenu="suggestion"}_handleInputPaste(_){const v=_.target;this.viewModel.searchTerm!==v.value&&(this.viewModel.searchTerm=v.value),this.viewModel.searchTerm&&this.suggest()}_handleSourceMenuKeydown(_){const v=(0,mt.kK)(_);if((0,Nl.pf)(v)){_.preventDefault();const O=this._sourceListNode.getElementsByTagName("li")[this._activeMenuItemIndex];this._setSourceFromMenuItem(O)}else"ArrowUp"!==v&&"ArrowDown"!==v&&"End"!==v&&"Home"!==v||_.preventDefault()}_handleSourceMenuKeyup(_){var w,te;const v=(0,mt.kK)(_),O="ArrowUp"===v||"ArrowDown"===v||"End"===v||"Home"===v;if(O&&_.preventDefault(),"Escape"===v)return this._clearActiveMenu(),void(null==(w=this._sourceMenuButtonNode)||w.focus());const D=null==(te=this._sourceListNode)?void 0:te.getElementsByTagName("li");return D&&0!==D.length&&O?("source"!==this.activeMenu&&(this.activeMenu="source"),void this._handleItemNavigation(v,D,this._sourceListNode.parentElement)):void 0}_focus(_){this.focus(),_&&(this.activeMenu=_)}_formSubmit(_){_.preventDefault(),-1===this._activeMenuItemIndex&&this.search()}_getSourceName(_){const{messages:v}=this,O=this.viewModel,{allSources:D}=O,w=D.getItemAt(_);return _===ym.ALL_INDEX?v.all:w&&w.name||v.untitledSource}_splitResult(_,v){const O=(0,Fj.Qs)(v);return _.replace(new RegExp(`(^|)(${O})(|$)`,"ig"),"$1|$2|$3").split("|")}_renderSearchResultsContent(){return this._searchResultRenderer.showMoreResultsOpen=!1,this._searchResultRenderer.viewModel=this.viewModel,this._searchResultRenderer}};(0,Ze._)([(0,nt.Cb)()],Hn.prototype,"_activeMenuItemIndex",void 0),(0,Ze._)([(0,nt.Cb)()],Hn.prototype,"displayedSearchTerm",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Hn.prototype,"inputId",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Hn.prototype,"suggestionsMenuId",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Hn.prototype,"sourceMenuId",null),(0,Ze._)([(0,nt.Cb)({readOnly:!0})],Hn.prototype,"sourceMenuButtonId",null),(0,Ze._)([(0,nt.Cb)()],Hn.prototype,"activeMenu",void 0),(0,Ze._)([(0,Ss.B)("viewModel.activeSource")],Hn.prototype,"activeSource",void 0),(0,Ze._)([(0,Ss.B)("viewModel.activeSourceIndex")],Hn.prototype,"activeSourceIndex",void 0),(0,Ze._)([(0,Ss.B)("viewModel.allPlaceholder")],Hn.prototype,"allPlaceholder",void 0),(0,Ze._)([(0,Ss.B)("viewModel.allSources")],Hn.prototype,"allSources",void 0),(0,Ze._)([(0,Ss.B)("viewModel.autoNavigate")],Hn.prototype,"autoNavigate",void 0),(0,Ze._)([(0,Ss.B)("viewModel.autoSelect")],Hn.prototype,"autoSelect",void 0),(0,Ze._)([(0,Ss.B)("viewModel.defaultSources")],Hn.prototype,"defaultSources",void 0),(0,Ze._)([(0,nt.Cb)()],Hn.prototype,"disabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.goToOverride")],Hn.prototype,"goToOverride",void 0),(0,Ze._)([(0,nt.Cb)()],Hn.prototype,"iconClass",void 0),(0,Ze._)([(0,Ss.B)("viewModel.includeDefaultSources")],Hn.prototype,"includeDefaultSources",void 0),(0,Ze._)([(0,nt.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Hn.prototype,"label",void 0),(0,Ze._)([(0,Ss.B)("viewModel.locationEnabled")],Hn.prototype,"locationEnabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.maxResults")],Hn.prototype,"maxResults",void 0),(0,Ze._)([(0,Ss.B)("viewModel.maxSuggestions")],Hn.prototype,"maxSuggestions",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/widgets/Search/t9n/Search")],Hn.prototype,"messages",void 0),(0,Ze._)([(0,nt.Cb)(),(0,Iu.H)("esri/t9n/common")],Hn.prototype,"messagesCommon",void 0),(0,Ze._)([(0,Ss.B)("viewModel.minSuggestCharacters")],Hn.prototype,"minSuggestCharacters",void 0),(0,Ze._)([(0,Ss.B)("viewModel.popupEnabled")],Hn.prototype,"popupEnabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.popupTemplate")],Hn.prototype,"popupTemplate",void 0),(0,Ze._)([(0,Ss.B)("viewModel.portal")],Hn.prototype,"portal",void 0),(0,Ze._)([(0,Ss.B)("viewModel.resultGraphic")],Hn.prototype,"resultGraphic",void 0),(0,Ze._)([(0,Ss.B)("viewModel.resultGraphicEnabled")],Hn.prototype,"resultGraphicEnabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.results")],Hn.prototype,"results",void 0),(0,Ze._)([(0,Ss.B)("viewModel.searchAllEnabled")],Hn.prototype,"searchAllEnabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.searchTerm")],Hn.prototype,"searchTerm",void 0),(0,Ze._)([(0,Ss.B)("viewModel.selectedResult")],Hn.prototype,"selectedResult",void 0),(0,Ze._)([(0,Ss.B)("viewModel.sources")],Hn.prototype,"sources",void 0),(0,Ze._)([(0,Ss.B)("viewModel.suggestions")],Hn.prototype,"suggestions",void 0),(0,Ze._)([(0,Ss.B)("viewModel.suggestionsEnabled")],Hn.prototype,"suggestionsEnabled",void 0),(0,Ze._)([(0,Ss.B)("viewModel.view")],Hn.prototype,"view",void 0),(0,Ze._)([(0,jF.s)(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),(0,nt.Cb)({type:ym})],Hn.prototype,"viewModel",void 0),(0,Ze._)([(0,Ss.B)("viewModel.clear")],Hn.prototype,"clear",null),Hn=(0,Ze._)([(0,ui.j)("esri.widgets.Search")],Hn);const WF=Hn;var VF=T(87080),U2=T(40520),iy=T(70262),sy=T(62843);let zF=(()=>{class _{constructor(O){this.http=O}get(O,D,w){let te=this.getUrl(O),fe=this.setHeaders(D),Pe=this.setRequestOptions(fe,w);return this.http.get(te,Pe).pipe((0,ue.U)(Ue=>Ue),(0,iy.K)(Ue=>(0,sy._)(Ue)))}post(O,D,w,te){let fe=this.getUrl(O),Pe=this.setHeaders(w),Ue=this.setRequestOptions(Pe,te);return this.http.post(fe,D,Ue).pipe((0,ue.U)(Xe=>Xe),(0,iy.K)(Xe=>(0,sy._)(Xe)))}delete(O,D,w){let te=this.getUrl(O),fe=this.setHeaders(D),Pe=this.setRequestOptions(fe,w);return this.http.delete(te,Pe).pipe((0,ue.U)(Ue=>Ue),(0,iy.K)(Ue=>(0,sy._)(Ue)))}patch(O,D,w,te){let fe=this.getUrl(O),Pe=this.setHeaders(w),Ue=this.setRequestOptions(Pe,te);return this.http.patch(fe,D,Ue).pipe((0,ue.U)(Xe=>Xe),(0,iy.K)(Xe=>(0,sy._)(Xe)))}put(O,D,w,te){let fe=this.getUrl(O),Pe=this.setHeaders(w),Ue=this.setRequestOptions(Pe,te);return this.http.put(fe,D,Ue).pipe((0,ue.U)(Xe=>Xe),(0,iy.K)(Xe=>(0,sy._)(Xe)))}getUrl(O){return O}setHeaders(O){let D=new U2.WM({"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Credentials":"true","Access-Control-Allow-Headers":"Content-Type","Access-Control-Allow-Methods":"GET,PUT,POST,DELETE"});if(O)for(let w in O)D.has(w)||(D=D.append(w,O[w]));return D}setRequestOptions(O,D){let w={headers:O};return D&&(w=Object.assign(w,D)),w}}return _.\u0275fac=function(O){return new(O||_)(A.LFG(U2.eN))},_.\u0275prov=A.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})(),NT=(()=>{class _{constructor(O,D,w,te){this.router=O,this.activeRoute=D,this.service=w,this.http=te,this.basketballCoordinates=[],this.boxingCoordinates=[],this.golfCoordinates=[],this.footballCoordinates=[],this.swimmingCoordinates=[],this.billiardCoordinates=[],this.jetSkiCoordinates=[],this.badmintonCoordinates=[],this.baseballCoordinates=[],this.cyclingCoordinates=[],this.tennisCoordinates=[],this.badmintonhtml='<img src="assets/img/gifs/Badminton.gif" width=55px" height="50px">',this.baseballhtml='<img src="assets/img/gifs/Baseball.gif" width=55px" height="50px">',this.basketballhtml='<img src="assets/img/gifs/Basketball.gif" width=55px" height="50px">',this.boxinghtml='<img src="assets/img/gifs/Boxing.gif" width=55px" height="50px">',this.footballhtml='<img src="assets/img/gifs/Football.gif" width=55px" height="50px">',this.golfhtml='<img src="assets/img/gifs/Golf-2.gif" width=55px" height="50px">',this.jetskihtml='<img src="assets/img/gifs/Jetski.gif" width=55px" height="50px">',this.billiardhtml='<img src="assets/img/gifs/Snooker.gif" width=55px" height="50px" style="vertical-align:middle">',this.swimminghtml='<img src="assets/img/gifs/Swimming.gif" width=55px" height="50px">',this.cyclinghtml='<img src="assets/img/gifs/Cycling.gif" width=55px" height="50px">',this.paddletennishtml='<img src="assets/img/paddletennismarker.png" width=35px" height="40px">',this.tennishtml='<img src="assets/img/tennismarker.png" width=35px" height="45px">',this.map=new nc,this.view=new xE({qualityProfile:"high"}),this.dubaiSceneLayer=new lm.default,this.newyorkSceneLayer=new lm.default,this.buildingDetailsType1=[],this.buildingDetailsType2=[],this.buildingDetailsType3=[],this.buildingDetailsType4=[],this.planeDetails=[],this.lawnDetails=[],this.buildingColor="gold",this.currentRoute="",this.buildingDetailsType5=[],this.route_layer=new qf.Z,this.markerLayer=new qf.Z,this.buildingsLayer=[],this.dub_renderer=new sN.Z,this.hotels_layer=new qf.Z,this.places=["Choose a place type...","Parks and Outdoors","Coffee shop","Gas station","Food","Hotel"],this.Img=""}ngOnInit(){this.initialSetup(),this.loadDubaiSceneLayer(),this.loadCoordinates(),this.addPointsLayer(),this.addBurj(),this.loadObjectsOnMap(),this.loadGameOnMap(),this.loadRoute(),this.loadPlacesDropdown(),this.view.map.add(this.markerLayer),this.view.map.add(this.hotels_layer),this.landThePlane()}ngAfterViewInit(){this.routeStarter1()}routeStarter1(){this.router.events.subscribe(O=>{this.game=this.activeRoute.snapshot.queryParamMap.get("game");let D=this.activeRoute.snapshot.queryParamMap.get("lat"),w=this.activeRoute.snapshot.queryParamMap.get("lng");O instanceof bl.OD&&console.log("Route change detected"),O instanceof bl.m2&&(this.currentRoute=O.url,console.log(this.currentRoute),this.map&&(D&&w?(console.log("inside router"),console.log(D,w),this.goTomarker(this.game,D,w)):this.activateSport(this.game)))})}panCamera(O,D){let w=this.view.camera.clone();return w.tilt=0,w.position={latitude:O,longitude:D,z:2e3},console.log("panning"),w}tiltView(O,D){console.log("first"),this.view.goTo(this.panCamera(O,D),{speedFactor:.5,easing:"linear",duration:8e3,maxDuration:9e3}).then(()=>{console.log("third"),this.view.goTo({tilt:60,heading:this.view.camera.heading+=60},{speedFactor:.5,easing:"linear",duration:4e3,maxDuration:8e3}).catch(w=>{"AbortError"!=w.name&&console.error(w)})}).catch(w=>{"AbortError"!=w.name&&console.error(w)})}goTomarker(O,D,w){if(this.tiltView(D,w),"basketball"===O){let te;this.RemoveAllMarker(),te=this.basketballCoordinates.filter(Pe=>Pe.lat===D)[0],this.addBasketballMarkersToMap(D,w,0,te)}else if("badminton"===O){let te;this.RemoveAllMarker(),te=this.badmintonCoordinates.filter(Pe=>Pe.lat===D)[0],this.addBadmintonMarkersToMap(D,w,0,te)}else if("baseball"===O){let te;this.RemoveAllMarker(),te=this.baseballCoordinates.filter(Pe=>Pe.lat===D)[0],this.addBaseballMarkersToMap(D,w,0,te)}else if("boxing"===O){let te;this.RemoveAllMarker(),te=this.boxingCoordinates.filter(Pe=>Pe.lat===D)[0],this.addBoxingMarkersToMap(D,w,0,te)}else if("football"===O){let te;this.RemoveAllMarker(),te=this.footballCoordinates.filter(Pe=>Pe.lat===D)[0],this.addFootballMarkersToMap(D,w,0,te)}else if("golf"===O){let te;this.RemoveAllMarker(),te=this.golfCoordinates.filter(Pe=>Pe.lat===D)[0],this.addGolfMarkersToMap(D,w,0,te)}else if("jetski"===O){let te;this.RemoveAllMarker(),te=this.jetSkiCoordinates.filter(Pe=>Pe.lat===D)[0],this.addJetskiMarkersToMap(D,w,0,te)}else if("billiard"===O){let te;this.RemoveAllMarker(),te=this.billiardCoordinates.filter(Pe=>Pe.lat===D)[0],this.addBilliardMarkersToMap(D,w,0,te)}else if("swimming"===O){let te;this.RemoveAllMarker(),te=this.swimmingCoordinates.filter(Pe=>Pe.lat===D)[0],this.addSwimmingMarkersToMap(D,w,0,te)}else if("cycle"===O){let te;this.RemoveAllMarker(),te=this.cyclingCoordinates.filter(Pe=>Pe.lat===D)[0],this.addCycleMarkersToMap(D,w,0,te)}else if("tennis"===O){let te;this.RemoveAllMarker(),te=this.tennisCoordinates.filter(Pe=>Pe.lat===D)[0],this.addTennisMarkersToMap(D,w,0,te)}else console.log("no match")}activateSport(O){"all"===O?(this.loadGameOnMap(),this.view.camera=new qo({position:{x:55.275349,y:25.185865,z:2e3},tilt:45})):"basketball"===O?(this.RemoveAllMarker(),this.LoadBasketballMarkers()):"badminton"===O?(this.RemoveAllMarker(),this.LoadBadmintonMarkers()):"baseball"===O?(this.RemoveAllMarker(),this.LoadBaseballMarkers()):"boxing"===O?(this.RemoveAllMarker(),this.LoadBoxingMarkers()):"football"===O?(this.RemoveAllMarker(),this.LoadFootballMarkers()):"golf"===O?(this.RemoveAllMarker(),this.LoadGolfMarkers()):"jetski"===O?(this.RemoveAllMarker(),this.LoadJetskiMarkers()):"billiard"===O?(this.RemoveAllMarker(),this.LoadBilliardMarkers()):"swimming"===O?(this.RemoveAllMarker(),this.LoadSwimmingMarkers()):"cycle"===O?(this.RemoveAllMarker(),this.LoadCycleMarkers()):"tennis"===O?(this.RemoveAllMarker(),this.LoadTennisMarkers()):console.log("no match")}RemoveAllMarker(){this.addSwimmingMarkersToMap(0,0,0,""),this.addGolfMarkersToMap(0,0,0,""),this.addBasketballMarkersToMap(0,0,0,""),this.addBadmintonMarkersToMap(0,0,0,""),this.addBoxingMarkersToMap(0,0,0,""),this.addBaseballMarkersToMap(0,0,0,""),this.addFootballMarkersToMap(0,0,0,""),this.addCycleMarkersToMap(0,0,0,""),this.addJetskiMarkersToMap(0,0,0,""),this.addBilliardMarkersToMap(0,0,0,""),this.addTennisMarkersToMap(0,0,0,""),this.hotels_layer.removeAll()}GetWeatherDetail(){const O=new cT({view:this.view,content:new gN({view:this.view}),group:"bottom-right",expanded:!1}),D=new cT({view:this.view,content:new k9({view:this.view}),group:"bottom-right"}),w=new cT({view:this.view,content:new WF({view:this.view}),group:"bottom-right"});this.view.ui.add([O,D,w],"bottom-right")}loadCoordinates(){this.buildingDetailsType1=this.service.getBuildingDetailsType1(),this.buildingDetailsType2=this.service.getBuildingDetailsType2(),this.buildingDetailsType3=this.service.getBuildingDetailsType3(),this.buildingDetailsType4=this.service.getBuildingDetailsType4(),this.buildingDetailsType5=this.service.getBuildingDetailsType5(),this.golfCoordinates=this.service.getGolfDetails(),this.basketballCoordinates=this.service.getBasketballDetails(),this.badmintonCoordinates=this.service.getBadmintonDetails(),this.boxingCoordinates=this.service.getBoxingDetails(),this.baseballCoordinates=this.service.getBaseballDetails(),this.footballCoordinates=this.service.getFootballDetails(),this.swimmingCoordinates=this.service.getSwimmingDetails(),this.jetSkiCoordinates=this.service.getJetskiDetails(),this.cyclingCoordinates=this.service.getCyclingDetails(),this.billiardCoordinates=this.service.getBilliardDetails(),this.tennisCoordinates=this.service.getTennisDetails(),this.planeDetails=this.service.getPlaneDetails()}addBurj(){this.burj=new Dn.Z({geometry:new vs.Z({x:55.27433548957757,y:25.197348634357216,z:500}),symbol:new Wo.Z({symbolLayers:[{type:"object",width:270,height:1e3,depth:255,anchor:"center",resource:{href:"assets/models/burj_khalifa_dubai.glb"},heading:240}]})}),this.view.graphics.add(this.burj)}loadPlacesDropdown(){const O=document.createElement("select");O.setAttribute("id","places-dropdown"),O.setAttribute("class","esri-widget esri-select"),O.setAttribute("style","width: 275px; margin-top:-100px; font-family: Avenir Next W00; font-size: 1em"),this.places.forEach(D=>{const w=document.createElement("option");w.value=D,w.innerHTML=D,O.appendChild(w)}),this.view.ui.add(O,"top-right"),O.addEventListener("change",()=>{"Choose a place type..."==O.value?this.hotels_layer.removeAll():this.findPlaces(O.value,this.view.center)})}cofeeMarker(){return JSON.parse('{"name":"Coffee","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":20,"anchor":"bottom","material":{"color":[139,69,19],"transparency":0},"resource":{"href":"https://static.arcgis.com/arcgis/styleItems/Icons/web/resource/Coffee.svg"}}]}').symbolLayers[0]}parkMarker(){return JSON.parse('{"name":"Park","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":20,"anchor":"bottom","material":{"color":[113,203,110],"transparency":0},"resource":{"href":"https://static.arcgis.com/arcgis/styleItems/Icons/web/resource/Park.svg"}}]}').symbolLayers[0]}gasStationMarker(){return JSON.parse('{"name":"Fuel","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":20,"anchor":"bottom","material":{"color":[201,49,0],"transparency":0},"resource":{"href":"https://static.arcgis.com/arcgis/styleItems/Icons/web/resource/Fuel.svg"}}]}').symbolLayers[0]}foodMarker(){return JSON.parse('{"name":"Restaurant","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"color":[0,191,255],"transparency":0},"resource":{"href":"https://static.arcgis.com/arcgis/styleItems/Icons/web/resource/Restaurant.svg"}}]}').symbolLayers[0]}hotelMarker(){return JSON.parse('{"name":"Hotel","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"color":[255, 102, 102],"transparency":0},"resource":{"href":"https://static.arcgis.com/arcgis/styleItems/Icons/web/resource/Hotel.svg"}}]}').symbolLayers[0]}findPlaces(O,D){WA("http://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer",{location:D,categories:[O],maxLocations:50,outFields:["*"],address:void 0}).then(w=>{this.hotels_layer.removeAll(),w.forEach((te,fe)=>{let Pe="";var Ue=[];"Parks and Outdoors"==O?(Ue=this.parkMarker(),Pe="parks"):"Coffee shop"==O?(Ue=this.cofeeMarker(),Pe="coffee"):"Gas station"==O?(Ue=this.gasStationMarker(),this.Img="",Pe="gas"):"Food"==O?(Ue=this.foodMarker(),Pe="food"):"Hotel"==O&&(Ue=this.hotelMarker(),Pe="hotel");const st=new Dn.Z({geometry:te.location,attributes:te.attributes,symbol:new Wo.Z({symbolLayers:[{type:"icon",size:Ue.size,material:Ue.material,anchor:Ue.anchor,resource:Ue.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.attributes.PlaceName,content:function(){var vt=document.createElement("div");return vt.innerHTML=`<div><img src="assets/img/places/${Pe}/${fe%4}.jpg" alt="" width=300> </div>\n                                <div>${te.attributes.Place_addr}</div>`,vt}}});this.hotels_layer.add(st)})})}loadRoute(){let O=new qf.Z({graphics:[]});this.route_layer=O,this.view.map.add(this.route_layer),this.view.on("click",D=>{0===this.route_layer.graphics.length?this.addGraphic("origin",D.mapPoint.longitude,D.mapPoint.latitude):1===this.route_layer.graphics.length?(this.addGraphic("destination",D.mapPoint.longitude,D.mapPoint.latitude),this.getRoute()):(this.route_layer.removeAll(),this.addGraphic("origin",D.mapPoint.longitude,D.mapPoint.latitude))})}addGraphic(O,D,w){const te=new Dn.Z({geometry:new vs.Z({x:D,y:w,z:0}),symbol:new Wo.Z({symbolLayers:[{type:"object",width:50,height:80,depth:10,anchor:"bottom",resource:{href:"assets/models/map_pointer.glb"},heading:50}]})});this.route_layer.add(te)}getRoute(){const O=new aj.Z({stops:new lj.default({features:this.route_layer.graphics.toArray()})});oj.F("https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",O).then(D=>{D.routeResults.forEach(w=>{w.route.symbol=new cj.Z({symbolLayers:[{type:"path",material:{color:"red"},width:5,height:30,castShadows:!0}]}),this.route_layer.add(w.route)})})}initialSetup(){console.log(""),Ha.Z.apiKey="";let O="";O="dark"===localStorage.getItem("mode")?"arcgis-navigation-night":"osm-standard";const D=new nc({basemap:O,ground:"world-elevation"}),w=new qo({position:{x:55.275349,y:25.185865,z:2e3},tilt:45}),te=new xE({container:"viewDiv",map:D,qualityProfile:"high",environment:{weather:{type:"cloudy",cloudCover:.3},atmosphere:{quality:"high"},lighting:{waterReflectionEnabled:!0,ambientOcclusionEnabled:!0}},camera:w,zoom:16,viewingMode:"global",popup:{defaultPopupTemplateEnabled:!0}});this.map=D,this.view=te,this.GetWeatherDetail()}loadDubaiSceneLayer(){const O=new lm.default({portalItem:{id:"962efd58b194443ea855ed1ca69fdaf5"},popupEnabled:!1});this.dub_renderer={type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",edges:{type:"solid",color:[230,115,0,.1],size:1}}]}},this.dubaiSceneLayer=O,this.dubaiSceneLayer.renderer=this.dub_renderer,this.map.add(this.dubaiSceneLayer)}loadNewYorkSceneLayer(){const O=new lm.default({portalItem:{id:"2e0761b9a4274b8db52c4bf34356911e"},popupEnabled:!1});this.newyorkSceneLayer=O,this.map.add(this.newyorkSceneLayer)}addPointsLayer(){const O=new J9.default({url:"http://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/LyonPointsOfInterest/FeatureServer",title:"Touristic attractions",elevationInfo:{mode:"relative-to-scene"},renderer:new iN.Z,outFields:["*"],featureReduction:{type:"selection"}});this.map.add(O)}loadObjectsOnMap(){console.log("loadmap"),this.view.when(()=>{console.log("Map is loaded");for(let O of this.buildingDetailsType1)this.addCustomBuildingModelsToMap(O.lat,O.lng,O.base,O.height,O.width,O.depth,O.heading,5);for(let O of this.buildingDetailsType2)this.addCustomBuildingModelsToMap(O.lat,O.lng,O.base,O.height,O.width,O.depth,O.heading,1);for(let O of this.buildingDetailsType3)this.addCustomBuildingModelsToMap(O.lat,O.lng,O.base,O.height,O.width,O.depth,O.heading,2);for(let O of this.buildingDetailsType4)this.addCustomBuildingModelsToMap(O.lat,O.lng,O.base,O.height,O.width,O.depth,O.heading,3);for(let O of this.buildingDetailsType5)this.addCustomBuildingModelsToMap(O.lat,O.lng,O.base,O.height,O.width,O.depth,O.heading,4)})}loadGameOnMap(){this.LoadGolfMarkers(),this.LoadSwimmingMarkers(),this.LoadBasketballMarkers(),this.LoadBadmintonMarkers(),this.LoadBoxingMarkers(),this.LoadBaseballMarkers(),this.LoadFootballMarkers(),this.LoadCycleMarkers(),this.LoadJetskiMarkers(),this.LoadBilliardMarkers(),this.LoadTennisMarkers()}LoadGolfMarkers(){for(let O of this.golfCoordinates)this.addGolfMarkersToMap(O.lat,O.lng,0,O)}LoadSwimmingMarkers(){for(let O of this.swimmingCoordinates)this.addSwimmingMarkersToMap(O.lat,O.lng,0,O)}LoadBasketballMarkers(){for(let O of this.basketballCoordinates)this.addBasketballMarkersToMap(O.lat,O.lng,0,O)}LoadBadmintonMarkers(){for(let O of this.badmintonCoordinates)this.addBadmintonMarkersToMap(O.lat,O.lng,0,O)}LoadBoxingMarkers(){for(let O of this.boxingCoordinates)this.addBoxingMarkersToMap(O.lat,O.lng,0,O)}LoadBaseballMarkers(){for(let O of this.baseballCoordinates)this.addBaseballMarkersToMap(O.lat,O.lng,0,O)}LoadFootballMarkers(){for(let O of this.footballCoordinates)this.addFootballMarkersToMap(O.lat,O.lng,0,O)}LoadCycleMarkers(){for(let O of this.cyclingCoordinates)this.addCycleMarkersToMap(O.lat,O.lng,0,O)}LoadJetskiMarkers(){for(let O of this.jetSkiCoordinates)this.addJetskiMarkersToMap(O.lat,O.lng,0,O)}LoadBilliardMarkers(){for(let O of this.billiardCoordinates)this.addBilliardMarkersToMap(O.lat,O.lng,0,O)}LoadTennisMarkers(){for(let O of this.tennisCoordinates)this.addTennisMarkersToMap(O.lat,O.lng,0,O)}getPlaneModelDetails(){return JSON.parse('{"name":"Airplane_Large_Passenger","type":"PointSymbol3D","symbolLayers":[{"type":"Object","width":21.539997100830078,"height":7.0347914695739746,"depth":25.677627563476563,"anchor":"origin","resource":{"href":"https://static.arcgis.com/arcgis/styleItems/RealisticTransportation/web/resource/Airplane_Large_Passenger.json"}}]}').symbolLayers[0]}getGolfMarkerDetails(){return JSON.parse('{"name":"Golf Course","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Golf-2.png"}}]}').symbolLayers[0]}getSwimmingMarkerDetails(){return JSON.parse('{"name":"Beach","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Swimming.png"}}]}').symbolLayers[0]}getBasketballMarkerDetails(){return JSON.parse('{"name":"Airport","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Basketball.png"}}]}').symbolLayers[0]}getBadmintonMarkerDetails(){return JSON.parse('{"name":"Vineyard","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Badminton.png"}}]}').symbolLayers[0]}getBoxingMarkerDetails(){return JSON.parse('{"name":"Vineyard","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Boxing.png"}}]}').symbolLayers[0]}getBaseballMarkerDetails(){return JSON.parse('{"name":"Vineyard","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Baseball.png"}}]}').symbolLayers[0]}getFootballMarkerDetails(){return JSON.parse('{"name":"Vineyard","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Football.png"}}]}').symbolLayers[0]}getCycleMarkerDetails(){return JSON.parse('{"name":"Vineyard","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Cycling.png"}}]}').symbolLayers[0]}getJetskiMarkerDetails(){return JSON.parse('{"name":"Vineyard","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Jetski.png"}}]}').symbolLayers[0]}getBilliardMarkerDetails(){return JSON.parse('{"name":"Vineyard","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":30,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/gifs/Snooker.png"}}]}').symbolLayers[0]}getTennisMarkerDetails(){return JSON.parse('{"name":"Vineyard","type":"PointSymbol3D","symbolLayers":[{"type":"Icon","size":20,"anchor":"bottom","material":{"transparency":0},"resource":{"href":"assets/img/tennis.png"}}]}').symbolLayers[0]}addTennisMarkersToMap(O,D,w,te){let fe=this.getTennisMarkerDetails(),Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addBilliardMarkersToMap(O,D,w,te){let fe=this.getBilliardMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addJetskiMarkersToMap(O,D,w,te){let fe=this.getJetskiMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addCycleMarkersToMap(O,D,w,te){let fe=this.getCycleMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addFootballMarkersToMap(O,D,w,te){let fe=this.getFootballMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addBaseballMarkersToMap(O,D,w,te){let fe=this.getBaseballMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addBoxingMarkersToMap(O,D,w,te){let fe=this.getBoxingMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addBasketballMarkersToMap(O,D,w,te){let fe=this.getBasketballMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:500,minWorldLength:50},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addBadmintonMarkersToMap(O,D,w,te){let fe=this.getBadmintonMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addSwimmingMarkersToMap(O,D,w,te){let fe=this.getSwimmingMarkerDetails();const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addGolfMarkersToMap(O,D,w,te){const fe=this.getGolfMarkerDetails(),Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"icon",size:fe.size,material:fe.material,anchor:fe.anchor,resource:fe.resource}],verticalOffset:{screenLength:40,maxWorldLength:200,minWorldLength:35},callout:{type:"line",color:[135,206,250],size:.8}}),popupTemplate:{title:te.name,content:function(){var Xe=document.createElement("div");return Xe.innerHTML=te.html,Xe}}});0===O?this.markerLayer.graphics.removeAll():this.markerLayer.graphics.add(Ue)}addPlanesToMap(O,D,w){const te=this.getPlaneModelDetails(),fe=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"object",width:te.width,height:te.height,depth:te.depth,anchor:te.anchor,resource:te.resource}]})});this.view.graphics.add(fe)}addType1BuildingToMap(O,D,w,te,fe,Pe){const Ue=new Dn.Z({geometry:new vs.Z({x:D,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe,height:te,depth:Pe,resource:{primitive:"cube"},material:{color:this.buildingColor}}]})});this.view.graphics.add(Ue)}addType2BuildingToMap(O,D,w,te,fe,Pe){let Ue=new vs.Z({x:D,y:O,z:w});const Xe=new Dn.Z({geometry:Ue,symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe,height:te,depth:Pe,resource:{primitive:"cube"},material:{color:this.buildingColor}}]})}),st=new Dn.Z({geometry:Ue,symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe-15,height:te+30,depth:Pe-15,resource:{primitive:"cube"},material:{color:this.buildingColor}}]})}),vt=new Dn.Z({geometry:Ue,symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe-25,height:te+60,depth:Pe-25,resource:{primitive:"cube"},material:{color:this.buildingColor}}]})});this.view.graphics.add(Xe),this.view.graphics.add(st),this.view.graphics.add(vt)}addType3BuildingToMap(O,D,w,te,fe,Pe){let Ue=new vs.Z({x:D,y:O,z:w});const Xe=new Dn.Z({geometry:Ue,symbol:new Wo.Z({symbolLayers:[{type:"object",width:3*fe,height:te,depth:Pe,resource:{primitive:"cylinder"},material:{color:this.buildingColor}}]})}),st=new Dn.Z({geometry:new vs.Z({x:D+1e-4,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"object",width:2*fe,height:te+30,depth:Pe,resource:{primitive:"cylinder"},material:{color:this.buildingColor}}]})}),vt=new Dn.Z({geometry:new vs.Z({x:D,y:O+1e-4,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe,height:te+45,depth:Pe,resource:{primitive:"cylinder"},material:{color:this.buildingColor}}]})});this.view.graphics.add(Xe),this.view.graphics.add(st),this.view.graphics.add(vt)}addType4BuildingToMap(O,D,w,te,fe,Pe){let Ue=new vs.Z({x:D,y:O,z:w});const Xe=new Dn.Z({geometry:Ue,symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe,height:te,depth:2*Pe,resource:{primitive:"cube"},material:{color:this.buildingColor}}]})}),st=new Dn.Z({geometry:new vs.Z({x:D+2e-4,y:O,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe,height:te-50,depth:Pe,resource:{primitive:"cube"},material:{color:this.buildingColor}}]})}),vt=new Dn.Z({geometry:new vs.Z({x:D-2e-4,y:O+2e-4,z:w}),symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe,height:te+50,depth:Pe,resource:{primitive:"cube"},material:{color:this.buildingColor}}]})});this.view.graphics.add(st),this.view.graphics.add(Xe),this.view.graphics.add(vt)}startUp(){Ha.Z.apiKey="";const O=new nc({basemap:"arcgis-navigation-night",ground:"world-elevation"}),D=new xE({container:"viewDiv",map:O,qualityProfile:"high",environment:{weather:{type:"cloudy",cloudCover:.3},atmosphere:{quality:"high"},lighting:{waterReflectionEnabled:!0,ambientOcclusionEnabled:!0}},camera:new qo({position:{x:55.274349,y:25.196865,z:2e3},tilt:45}),zoom:16,viewingMode:"local"}),w=new qf.Z({elevationInfo:{mode:"on-the-ground"}});D.map.add(w);const te=new lm.default({portalItem:{id:"962efd58b194443ea855ed1ca69fdaf5"},popupEnabled:!1});O.add(te);const fe={type:"solid",color:[0,0,0,.2],size:1};new lm.default({portalItem:{id:"962efd58b194443ea855ed1ca69fdaf5"},popupEnabled:!1}).renderer={type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[222,171,2]},edges:fe}]}},te.renderer={type:"simple",symbol:{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[242,255,255]},edges:fe}]}},D.when(()=>{console.log("Map is loaded"),new uN({layer:w,view:D});const Wt=new Wo.Z({symbolLayers:[{type:"object",width:21.539997100830078,height:7.034791469573975,depth:22.36718463897705,anchor:"origin",resource:{href:"https://static.arcgis.com/arcgis/styleItems/RealisticTransportation/web/resource/Airplane_Large_Passenger.json"}}]}),Kt=new bU.Z({symbolLayers:[{type:"object",width:100,height:850,depth:100,material:{color:"#FFFFFF"},edges:{type:"solid",color:[100,100,100]},size:10}]}),nr=(new Wo.Z({symbolLayers:[{type:"object",width:100,height:850,depth:50,resource:{href:"assets/models/scene.glb"},material:{color:"gold"}}]}),new vs.Z({x:55.2683561,y:25.1971477,z:5})),sr=new Dn.Z({geometry:nr,symbol:Wt}),yr=(new vs.Z({x:55.2941723,y:26.1971553,z:100}),new Dn.Z({geometry:nr,symbol:Kt}));D.graphics.add(sr),D.graphics.add(yr),new Wo.Z({symbolLayers:[{type:"object",resource:{href:"https://developers.arcgis.com/javascript/latest/sample-code/import-gltf/live/tent.glb"},width:300,height:900,depth:50}]});const si=new Dn.Z({geometry:{type:"polygon",rings:[[55.271751,25.198344,0],[55.27605,25.19948,0],[55.27649,25.19681,0],[55.27345,25.195356,0]]},symbol:{type:"simple-fill",color:[227,139,79,.8],outline:{color:[255,255,255],width:0}}});w.add(si);const ki=new vs.Z({x:-74.033885,y:40.6913,z:2});new Dn.Z({geometry:ki,symbol:{type:"simple-marker",color:[226,119,40],outline:{color:[255,255,255],width:2}}}),D.graphics.add(sr)})}addCustomBuildingModelsToMap(O,D,w,te,fe,Pe,Ue,Xe){let st=new vs.Z({x:D,y:O,z:w}),vt={};1==Xe?vt={href:"assets/models/Building_1_Red.glb"}:2==Xe?vt={href:"assets/models/Building_2_Gold.glb"}:3==Xe?vt={href:"assets/models/Building_1_Green.glb"}:4==Xe?vt={href:"assets/models/Building_3_Gold.glb"}:5==Xe&&(vt={href:"assets/models/Building_4_Red.glb"});const sr=new Dn.Z({geometry:st,symbol:new Wo.Z({symbolLayers:[{type:"object",width:fe,height:te,depth:Pe,resource:vt,heading:Ue}]})});this.view.graphics.add(sr)}landThePlane(){var O=this;let Pe=new qf.Z({elevationInfo:{mode:"relative-to-ground"}}),Ue=new Dn.Z({geometry:new vs.Z(Object.assign(Object.assign({},{longitude:55.347600511426386,latitude:25.26178073853431}),{z:100}))});(0,Ai.Z)(function*(){var vt=new Y9.Z({name:"Airplane_Large_Passenger_With_Wheels",styleName:"EsriRealisticTransportationStyle"});let Ct=yield vt.fetchSymbol();console.log("printingsymbol",Ct),Ct.symbolLayers.items[0].heading=125,Ct.symbolLayers.items[0].height*=1.5,Ct.symbolLayers.items[0].depth*=1.5,Ct.symbolLayers.items[0].width*=1.5,Ue.symbol=Ct,Pe.add(Ue)})(),(0,Ai.Z)(function*(){yield O.view.when(),O.view.map.basemap.referenceLayers=[],O.view.map.add(Pe),O.view.environment.atmosphere.quality="high"})();let Xe=Ue.geometry.clone();jj.timeline({autoplay:!1,targets:Xe,loop:!0,duration:5e3,update:function(){Ue.geometry=Xe.clone()}}).add(Object.assign(Object.assign({},{longitude:55.36764197650612,latitude:25.250913105474755}),{easing:"linear"})).add({z:0,easing:"easeOutSine"},0).add(Object.assign(Object.assign({},{longitude:55.38952880092984,latitude:25.238841130493785}),{easing:"easeOutSine"})).play()}}return _.\u0275fac=function(O){return new(O||_)(A.Y36(bl.F0),A.Y36(bl.gz),A.Y36(VF.a),A.Y36(zF))},_.\u0275cmp=A.Xpm({type:_,selectors:[["app-arcgis"]],decls:1,vars:0,consts:[["id","viewDiv"]],template:function(O,D){1&O&&A._UZ(0,"div",0)},styles:["#viewDiv[_ngcontent-%COMP%]{padding:0;margin:0;height:100vh;width:100vw}"]}),_})();const GF=[{path:"",component:NT},{path:":item",component:NT},{path:":item/:lat/:lng",component:NT}];let HF=(()=>{class _{}return _.\u0275fac=function(O){return new(O||_)},_.\u0275mod=A.oAB({type:_}),_.\u0275inj=A.cJS({imports:[[bl.Bz.forChild(GF)],bl.Bz]}),_})(),KF=(()=>{class _{}return _.\u0275fac=function(O){return new(O||_)},_.\u0275mod=A.oAB({type:_}),_.\u0275inj=A.cJS({imports:[[x.ez,HF,Do]]}),_})()},76210:(dt,Re,T)=>{"use strict";T.d(Re,{Z5:()=>ma,mv:()=>ee,AA:()=>yt,yM:()=>lr,xE:()=>wi,K3:()=>Sr,h:()=>ot,GH:()=>Ui,YY:()=>mr});var x=T(15861);let H,re,J,Z=!1,ie=!1,ue=!1,ce=!1,oe=null,Y=!1;const j="undefined"!=typeof window?window:{},U=j.document||{head:{}},ee=j.HTMLElement||class{},$={$flags$:0,$resourcesUrl$:"",jmp:Ht=>Ht(),raf:Ht=>requestAnimationFrame(Ht),ael:(Ht,kt,ur,Tr)=>Ht.addEventListener(kt,ur,Tr),rel:(Ht,kt,ur,Tr)=>Ht.removeEventListener(kt,ur,Tr),ce:(Ht,kt)=>new CustomEvent(Ht,kt)},ae=(()=>{let Ht=!1;try{U.addEventListener("e",null,Object.defineProperty({},"passive",{get(){Ht=!0}}))}catch(kt){}return Ht})(),_e=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replace}catch(Ht){}return!1})(),he=(Ht,kt,ur,Tr)=>{ur&&ur.map(([_r,Gr,oi])=>{const At=ye(Ht,_r),Bt=ge(kt,oi),vr=Me(_r);$.ael(At,Gr,Bt,vr),(kt.$rmListeners$=kt.$rmListeners$||[]).push(()=>$.rel(At,Gr,Bt,vr))})},ge=(Ht,kt)=>ur=>{try{Ht.$hostElement$[kt](ur)}catch(Tr){to(Tr)}},ye=(Ht,kt)=>4&kt?U:8&kt?j:16&kt?U.body:Ht,Me=Ht=>ae?{passive:0!=(1&Ht),capture:0!=(2&Ht)}:0!=(2&Ht),je="http://www.w3.org/1999/xlink",$e=new WeakMap,Se=(Ht,kt,ur,Tr)=>{let _r=Fe(kt,ur),Gr=ro.get(_r);if(Ht=11===Ht.nodeType?Ht:U,Gr)if("string"==typeof Gr){let At,oi=$e.get(Ht=Ht.head||Ht);oi||$e.set(Ht,oi=new Set),oi.has(_r)||(At=U.createElement("style"),At.innerHTML=Gr,Ht.insertBefore(At,Ht.querySelector("link")),oi&&oi.add(_r))}else!Ht.adoptedStyleSheets.includes(Gr)&&(Ht.adoptedStyleSheets=[...Ht.adoptedStyleSheets,Gr]);return _r},Fe=(Ht,kt)=>"sc-"+(kt&&32&Ht.$flags$?Ht.$tagName$+"-"+kt:Ht.$tagName$),tt={},ke=Ht=>"object"==(Ht=typeof Ht)||"function"===Ht,ot=(Ht,kt,...ur)=>{let Tr=null,_r=null,Gr=null,oi=!1,At=!1,Bt=[];const vr=ai=>{for(let Hi=0;Hi<ai.length;Hi++)Tr=ai[Hi],Array.isArray(Tr)?vr(Tr):null!=Tr&&"boolean"!=typeof Tr&&((oi="function"!=typeof Ht&&!ke(Tr))&&(Tr=String(Tr)),oi&&At?Bt[Bt.length-1].$text$+=Tr:Bt.push(oi?at(null,Tr):Tr),At=oi)};if(vr(ur),kt&&(kt.key&&(_r=kt.key),kt.name&&(Gr=kt.name),true)){const ai=kt.className||kt.class;ai&&(kt.class="object"!=typeof ai?ai:Object.keys(ai).filter(Hi=>ai[Hi]).join(" "))}if("function"==typeof Ht)return Ht(null===kt?{}:kt,Bt,zt);const kr=at(Ht,null);return kr.$attrs$=kt,Bt.length>0&&(kr.$children$=Bt),kr.$key$=_r,kr.$name$=Gr,kr},at=(Ht,kt)=>{const ur={$flags$:0,$tag$:Ht,$text$:kt,$elm$:null,$children$:null,$attrs$:null,$key$:null,$name$:null};return ur},yt={},wt=Ht=>Ht&&Ht.$tag$===yt,zt={forEach:(Ht,kt)=>Ht.map(Rt).forEach(kt),map:(Ht,kt)=>Ht.map(Rt).map(kt).map(Ft)},Rt=Ht=>({vattrs:Ht.$attrs$,vchildren:Ht.$children$,vkey:Ht.$key$,vname:Ht.$name$,vtag:Ht.$tag$,vtext:Ht.$text$}),Ft=Ht=>{if("function"==typeof Ht.vtag){const ur=Object.assign({},Ht.vattrs);return Ht.vkey&&(ur.key=Ht.vkey),Ht.vname&&(ur.name=Ht.vname),ot(Ht.vtag,ur,...Ht.vchildren||[])}const kt=at(Ht.vtag,Ht.vtext);return kt.$attrs$=Ht.vattrs,kt.$children$=Ht.vchildren,kt.$key$=Ht.vkey,kt.$name$=Ht.vname,kt},St=(Ht,kt,ur,Tr,_r,Gr)=>{if(ur!==Tr){let oi=_o(Ht,kt),At=kt.toLowerCase();if("class"===kt){const Bt=Ht.classList,vr=Mr(ur),kr=Mr(Tr);Bt.remove(...vr.filter(ai=>ai&&!kr.includes(ai))),Bt.add(...kr.filter(ai=>ai&&!vr.includes(ai)))}else if("style"===kt){for(const Bt in ur)(!Tr||null==Tr[Bt])&&(Bt.includes("-")?Ht.style.removeProperty(Bt):Ht.style[Bt]="");for(const Bt in Tr)(!ur||Tr[Bt]!==ur[Bt])&&(Bt.includes("-")?Ht.style.setProperty(Bt,Tr[Bt]):Ht.style[Bt]=Tr[Bt])}else if("key"!==kt)if("ref"===kt)Tr&&Tr(Ht);else if(Ht.__lookupSetter__(kt)||"o"!==kt[0]||"n"!==kt[1]){{const Bt=ke(Tr);if((oi||Bt&&null!==Tr)&&!_r)try{if(Ht.tagName.includes("-"))Ht[kt]=Tr;else{let kr=null==Tr?"":Tr;"list"===kt?oi=!1:(null==ur||Ht[kt]!=kr)&&(Ht[kt]=kr)}}catch(kr){}let vr=!1;At!==(At=At.replace(/^xlink\:?/,""))&&(kt=At,vr=!0),null==Tr||!1===Tr?(!1!==Tr||""===Ht.getAttribute(kt))&&(vr?Ht.removeAttributeNS(je,kt):Ht.removeAttribute(kt)):(!oi||4&Gr||_r)&&!Bt&&(Tr=!0===Tr?"":Tr,vr?Ht.setAttributeNS(je,kt,Tr):Ht.setAttribute(kt,Tr))}}else kt="-"===kt[2]?kt.slice(3):_o(j,At)?At.slice(2):At[2]+kt.slice(3),ur&&$.rel(Ht,kt,ur,!1),Tr&&$.ael(Ht,kt,Tr,!1)}},Xt=/\s/,Mr=Ht=>Ht?Ht.split(Xt):[],Cr=(Ht,kt,ur,Tr)=>{const _r=11===kt.$elm$.nodeType&&kt.$elm$.host?kt.$elm$.host:kt.$elm$,Gr=Ht&&Ht.$attrs$||tt,oi=kt.$attrs$||tt;for(Tr in Gr)Tr in oi||St(_r,Tr,Gr[Tr],void 0,ur,kt.$flags$);for(Tr in oi)St(_r,Tr,Gr[Tr],oi[Tr],ur,kt.$flags$)},Yr=(Ht,kt,ur,Tr)=>{let oi,At,Bt,_r=kt.$children$[ur],Gr=0;if(!Z&&(ue=!0,"slot"===_r.$tag$&&(H&&Tr.classList.add(H+"-s"),_r.$flags$|=_r.$children$?2:1)),null!==_r.$text$)oi=_r.$elm$=U.createTextNode(_r.$text$);else if(1&_r.$flags$)oi=_r.$elm$=U.createTextNode("");else{if(!ce&&(ce="svg"===_r.$tag$),oi=_r.$elm$=U.createElementNS(ce?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",2&_r.$flags$?"slot-fb":_r.$tag$),ce&&"foreignObject"===_r.$tag$&&(ce=!1),Cr(null,_r,ce),(Ht=>null!=Ht)(H)&&oi["s-si"]!==H&&oi.classList.add(oi["s-si"]=H),_r.$children$)for(Gr=0;Gr<_r.$children$.length;++Gr)At=Yr(Ht,_r,Gr,oi),At&&oi.appendChild(At);"svg"===_r.$tag$?ce=!1:"foreignObject"===oi.tagName&&(ce=!0)}return oi["s-hn"]=J,3&_r.$flags$&&(oi["s-sr"]=!0,oi["s-cr"]=re,oi["s-sn"]=_r.$name$||"",Bt=Ht&&Ht.$children$&&Ht.$children$[ur],Bt&&Bt.$tag$===_r.$tag$&&Ht.$elm$&&Lr(Ht.$elm$,!1)),oi},Lr=(Ht,kt)=>{$.$flags$|=1;const ur=Ht.childNodes;for(let Tr=ur.length-1;Tr>=0;Tr--){const _r=ur[Tr];_r["s-hn"]!==J&&_r["s-ol"]&&(tr(_r).insertBefore(_r,Zt(_r)),_r["s-ol"].remove(),_r["s-ol"]=void 0,ue=!0),kt&&Lr(_r,kt)}$.$flags$&=-2},ct=(Ht,kt,ur,Tr,_r,Gr)=>{let At,oi=Ht["s-cr"]&&Ht["s-cr"].parentNode||Ht;for(oi.shadowRoot&&oi.tagName===J&&(oi=oi.shadowRoot);_r<=Gr;++_r)Tr[_r]&&(At=Yr(null,ur,_r,Ht),At&&(Tr[_r].$elm$=At,oi.insertBefore(At,Zt(kt))))},jt=(Ht,kt,ur,Tr,_r)=>{for(;kt<=ur;++kt)(Tr=Ht[kt])&&(_r=Tr.$elm$,ri(Tr),ie=!0,_r["s-ol"]?_r["s-ol"].remove():Lr(_r,!0),_r.remove())},er=(Ht,kt)=>Ht.$tag$===kt.$tag$&&("slot"===Ht.$tag$?Ht.$name$===kt.$name$:Ht.$key$===kt.$key$),Zt=Ht=>Ht&&Ht["s-ol"]||Ht,tr=Ht=>(Ht["s-ol"]?Ht["s-ol"]:Ht).parentNode,ir=(Ht,kt)=>{const ur=kt.$elm$=Ht.$elm$,Tr=Ht.$children$,_r=kt.$children$,Gr=kt.$tag$,oi=kt.$text$;let At;null!==oi?(At=ur["s-cr"])?At.parentNode.textContent=oi:Ht.$text$!==oi&&(ur.data=oi):(ce="svg"===Gr||"foreignObject"!==Gr&&ce,"slot"===Gr||Cr(Ht,kt,ce),null!==Tr&&null!==_r?((Ht,kt,ur,Tr)=>{let Tn,On,_r=0,Gr=0,oi=0,At=0,Bt=kt.length-1,vr=kt[0],kr=kt[Bt],ai=Tr.length-1,Hi=Tr[0],fs=Tr[ai];for(;_r<=Bt&&Gr<=ai;)if(null==vr)vr=kt[++_r];else if(null==kr)kr=kt[--Bt];else if(null==Hi)Hi=Tr[++Gr];else if(null==fs)fs=Tr[--ai];else if(er(vr,Hi))ir(vr,Hi),vr=kt[++_r],Hi=Tr[++Gr];else if(er(kr,fs))ir(kr,fs),kr=kt[--Bt],fs=Tr[--ai];else if(er(vr,fs))("slot"===vr.$tag$||"slot"===fs.$tag$)&&Lr(vr.$elm$.parentNode,!1),ir(vr,fs),Ht.insertBefore(vr.$elm$,kr.$elm$.nextSibling),vr=kt[++_r],fs=Tr[--ai];else if(er(kr,Hi))("slot"===vr.$tag$||"slot"===fs.$tag$)&&Lr(kr.$elm$.parentNode,!1),ir(kr,Hi),Ht.insertBefore(kr.$elm$,vr.$elm$),kr=kt[--Bt],Hi=Tr[++Gr];else{for(oi=-1,At=_r;At<=Bt;++At)if(kt[At]&&null!==kt[At].$key$&&kt[At].$key$===Hi.$key$){oi=At;break}oi>=0?(On=kt[oi],On.$tag$!==Hi.$tag$?Tn=Yr(kt&&kt[Gr],ur,oi,Ht):(ir(On,Hi),kt[oi]=void 0,Tn=On.$elm$),Hi=Tr[++Gr]):(Tn=Yr(kt&&kt[Gr],ur,Gr,Ht),Hi=Tr[++Gr]),Tn&&tr(vr.$elm$).insertBefore(Tn,Zt(vr.$elm$))}_r>Bt?ct(Ht,null==Tr[ai+1]?null:Tr[ai+1].$elm$,ur,Tr,Gr,ai):Gr>ai&&jt(kt,_r,Bt)})(ur,Tr,kt,_r):null!==_r?(null!==Ht.$text$&&(ur.textContent=""),ct(ur,null,kt,_r,0,_r.length-1)):null!==Tr&&jt(Tr,0,Tr.length-1),ce&&"svg"===Gr&&(ce=!1))},fr=Ht=>{let ur,Tr,_r,Gr,oi,At,kt=Ht.childNodes;for(Tr=0,_r=kt.length;Tr<_r;Tr++)if(ur=kt[Tr],1===ur.nodeType){if(ur["s-sr"])for(oi=ur["s-sn"],ur.hidden=!1,Gr=0;Gr<_r;Gr++)if(At=kt[Gr].nodeType,kt[Gr]["s-hn"]!==ur["s-hn"]||""!==oi){if(1===At&&oi===kt[Gr].getAttribute("slot")){ur.hidden=!0;break}}else if(1===At||3===At&&""!==kt[Gr].textContent.trim()){ur.hidden=!0;break}fr(ur)}},Ur=[],Br=Ht=>{let kt,ur,Tr,_r,Gr,oi,At=0,Bt=Ht.childNodes,vr=Bt.length;for(;At<vr;At++){if(kt=Bt[At],kt["s-sr"]&&(ur=kt["s-cr"])&&ur.parentNode)for(Tr=ur.parentNode.childNodes,_r=kt["s-sn"],oi=Tr.length-1;oi>=0;oi--)ur=Tr[oi],!ur["s-cn"]&&!ur["s-nr"]&&ur["s-hn"]!==kt["s-hn"]&&(Zr(ur,_r)?(Gr=Ur.find(kr=>kr.$nodeToRelocate$===ur),ie=!0,ur["s-sn"]=ur["s-sn"]||_r,Gr?Gr.$slotRefNode$=kt:Ur.push({$slotRefNode$:kt,$nodeToRelocate$:ur}),ur["s-sr"]&&Ur.map(kr=>{Zr(kr.$nodeToRelocate$,ur["s-sn"])&&(Gr=Ur.find(ai=>ai.$nodeToRelocate$===ur),Gr&&!kr.$slotRefNode$&&(kr.$slotRefNode$=Gr.$slotRefNode$))})):Ur.some(kr=>kr.$nodeToRelocate$===ur)||Ur.push({$nodeToRelocate$:ur}));1===kt.nodeType&&Br(kt)}},Zr=(Ht,kt)=>1===Ht.nodeType?null===Ht.getAttribute("slot")&&""===kt||Ht.getAttribute("slot")===kt:Ht["s-sn"]===kt||""===kt,ri=Ht=>{Ht.$attrs$&&Ht.$attrs$.ref&&Ht.$attrs$.ref(null),Ht.$children$&&Ht.$children$.map(ri)},hr=(Ht,kt)=>{const ur=Ht.$hostElement$,Tr=Ht.$cmpMeta$,_r=Ht.$vnode$||at(null,null),Gr=wt(kt)?kt:ot(null,null,kt);if(J=ur.tagName,Tr.$attrsToReflect$&&(Gr.$attrs$=Gr.$attrs$||{},Tr.$attrsToReflect$.map(([oi,At])=>Gr.$attrs$[At]=ur[oi])),Gr.$tag$=null,Gr.$flags$|=4,Ht.$vnode$=Gr,Gr.$elm$=_r.$elm$=ur.shadowRoot||ur,H=ur["s-sc"],re=ur["s-cr"],Z=0!=(1&Tr.$flags$),ie=!1,ir(_r,Gr),$.$flags$|=1,ue){Br(Gr.$elm$);let oi,At,Bt,vr,kr,ai,Hi=0;for(;Hi<Ur.length;Hi++)oi=Ur[Hi],At=oi.$nodeToRelocate$,At["s-ol"]||(Bt=U.createTextNode(""),Bt["s-nr"]=At,At.parentNode.insertBefore(At["s-ol"]=Bt,At));for(Hi=0;Hi<Ur.length;Hi++)if(oi=Ur[Hi],At=oi.$nodeToRelocate$,oi.$slotRefNode$){for(vr=oi.$slotRefNode$.parentNode,kr=oi.$slotRefNode$.nextSibling,Bt=At["s-ol"];Bt=Bt.previousSibling;)if(ai=Bt["s-nr"],ai&&ai["s-sn"]===At["s-sn"]&&vr===ai.parentNode&&(ai=ai.nextSibling,!ai||!ai["s-nr"])){kr=ai;break}(!kr&&vr!==At.parentNode||At.nextSibling!==kr)&&At!==kr&&(!At["s-hn"]&&At["s-ol"]&&(At["s-hn"]=At["s-ol"].parentNode.nodeName),vr.insertBefore(At,kr))}else 1===At.nodeType&&(At.hidden=!0)}ie&&fr(Gr.$elm$),$.$flags$&=-2,Ur.length=0},lr=(Ht,kt,ur)=>{const Tr=Ht;return{emit:_r=>jr(Tr,kt,{bubbles:!!(4&ur),composed:!!(2&ur),cancelable:!!(1&ur),detail:_r})}},jr=(Ht,kt,ur)=>{const Tr=$.ce(kt,ur);return Ht.dispatchEvent(Tr),Tr},rr=(Ht,kt)=>{Ht.$flags$|=16;const ur=()=>pr(Ht,kt);return us(ur)},pr=(Ht,kt)=>{const ur=Ht.$hostElement$,Tr=()=>{},_r=ur;let Gr;return kt?(Ar(ur,"componentWillLoad"),Gr=Ni(_r,"componentWillLoad")):(Ar(ur,"componentWillUpdate"),Gr=Ni(_r,"componentWillUpdate")),Ar(ur,"componentWillRender"),Gr=Hs(Gr,()=>Ni(_r,"componentWillRender")),Tr(),Hs(Gr,()=>Pr(Ht,_r,kt))},Pr=function(){var Ht=(0,x.Z)(function*(kt,ur,Tr){const _r=kt.$hostElement$,Gr=()=>{};Tr&&(Ht=>{const kt=Ht.$cmpMeta$,ur=Ht.$hostElement$,Tr=kt.$flags$,_r=()=>{},Gr=Se(ur.shadowRoot?ur.shadowRoot:ur.getRootNode(),kt,Ht.$modeName$);10&Tr&&(ur["s-sc"]=Gr,ur.classList.add(Gr+"-h"),2&Tr&&ur.classList.add(Gr+"-s")),_r()})(kt);const At=()=>{};Fr(kt,ur,_r),At(),Gr(),mi(kt)});return function(ur,Tr,_r){return Ht.apply(this,arguments)}}(),Fr=(Ht,kt,ur)=>{try{oe=kt,kt=kt.render&&kt.render(),Ht.$flags$&=-17,Ht.$flags$|=2,hr(Ht,kt)}catch(At){to(At,Ht.$hostElement$)}return oe=null,null},mi=Ht=>{const ur=Ht.$hostElement$,Tr=()=>{},_r=ur;Ni(_r,"componentDidRender"),Ar(ur,"componentDidRender"),64&Ht.$flags$?(Ni(_r,"componentDidUpdate"),Ar(ur,"componentDidUpdate"),Tr()):(Ht.$flags$|=64,Ni(_r,"componentDidLoad"),Ar(ur,"componentDidLoad"),Tr())},wi=Ht=>{{const kt=tn(Ht),ur=kt.$hostElement$.isConnected;return ur&&2==(18&kt.$flags$)&&rr(kt,!1),ur}},Ni=(Ht,kt,ur)=>{if(Ht&&Ht[kt])try{return Ht[kt](ur)}catch(Tr){to(Tr)}},Hs=(Ht,kt)=>Ht&&Ht.then?Ht.then(kt):kt(),Ar=(Ht,kt)=>{},hi=(Ht,kt,ur)=>{if(kt.$members$){Ht.watchers&&(kt.$watchers$=Ht.watchers);const Tr=Object.entries(kt.$members$),_r=Ht.prototype;Tr.map(([Gr,[oi]])=>{(31&oi||32&oi)&&Object.defineProperty(_r,Gr,{get(){return((Ht,kt)=>tn(this).$instanceValues$.get(kt))(0,Gr)},set(At){((Ht,kt,ur,Tr)=>{const _r=tn(Ht),Gr=Ht,oi=_r.$instanceValues$.get(kt),At=_r.$flags$,Bt=Gr;ur=((Ht,kt)=>null==Ht||ke(Ht)?Ht:4&kt?"false"!==Ht&&(""===Ht||!!Ht):2&kt?parseFloat(Ht):1&kt?String(Ht):Ht)(ur,Tr.$members$[kt][0]);const vr=Number.isNaN(oi)&&Number.isNaN(ur);if(ur!==oi&&!vr&&(_r.$instanceValues$.set(kt,ur),1)){if(Tr.$watchers$&&128&At){const ai=Tr.$watchers$[kt];ai&&ai.map(Hi=>{try{Bt[Hi](ur,oi,kt)}catch(fs){to(fs,Gr)}})}if(2==(18&At)){if(Bt.componentShouldUpdate&&!1===Bt.componentShouldUpdate(ur,oi,kt))return;rr(_r,!1)}}})(this,Gr,At,kt)},configurable:!0,enumerable:!0})});{const Gr=new Map;_r.attributeChangedCallback=function(oi,At,Bt){$.jmp(()=>{const vr=Gr.get(oi);if(this.hasOwnProperty(vr))Bt=this[vr],delete this[vr];else if(_r.hasOwnProperty(vr)&&"number"==typeof this[vr]&&this[vr]==Bt)return;this[vr]=(null!==Bt||"boolean"!=typeof this[vr])&&Bt})},Ht.observedAttributes=Tr.filter(([oi,At])=>15&At[0]).map(([oi,At])=>{const Bt=At[1]||oi;return Gr.set(Bt,oi),512&At[0]&&kt.$attrsToReflect$.push([oi,Bt]),Bt})}}return Ht},ln=function(){var Ht=(0,x.Z)(function*(kt,ur,Tr,_r,Gr){if(0==(32&ur.$flags$)&&(Gr=kt.constructor,ur.$flags$|=32,customElements.whenDefined(Tr.$tagName$).then(()=>ur.$flags$|=128),Gr.style)){let Bt=Gr.style;"string"!=typeof Bt&&(Bt=Bt[ur.$modeName$=(Ht=>xa.map(kt=>kt(Ht)).find(kt=>!!kt))(kt)]);const vr=Fe(Tr,ur.$modeName$);if(!ro.has(vr)){const kr=()=>{};((Ht,kt,ur)=>{let Tr=ro.get(Ht);_e&&ur?(Tr=Tr||new CSSStyleSheet,Tr.replace(kt)):Tr=kt,ro.set(Ht,Tr)})(vr,Bt,!!(1&Tr.$flags$)),kr()}}const At=()=>rr(ur,!0);At()});return function(ur,Tr,_r,Gr,oi){return Ht.apply(this,arguments)}}(),ds=Ht=>{},Hr=Ht=>{const kt=Ht["s-cr"]=U.createComment("");kt["s-cn"]=!0,Ht.insertBefore(kt,Ht.firstChild)},Ui=(Ht,kt)=>{const ur={$flags$:kt[0],$tagName$:kt[1]};ur.$members$=kt[2],ur.$listeners$=kt[3],ur.$watchers$=Ht.$watchers$,ur.$attrsToReflect$=[];const Tr=Ht.prototype.connectedCallback,_r=Ht.prototype.disconnectedCallback;return Object.assign(Ht.prototype,{__registerHost(){Bn(this,ur)},connectedCallback(){(Ht=>{if(0==(1&$.$flags$)){const kt=tn(Ht),ur=kt.$cmpMeta$,Tr=()=>{};if(1&kt.$flags$)he(Ht,kt,ur.$listeners$),ds(kt.$lazyInstance$);else{let _r;kt.$flags$|=1,!_r&&12&ur.$flags$&&Hr(Ht),ur.$members$&&Object.entries(ur.$members$).map(([Gr,[oi]])=>{if(31&oi&&Ht.hasOwnProperty(Gr)){const At=Ht[Gr];delete Ht[Gr],Ht[Gr]=At}}),ln(Ht,kt,ur)}Tr()}})(this),Tr&&Tr.call(this)},disconnectedCallback(){(Ht=>{if(0==(1&$.$flags$)){const kt=tn(Ht);kt.$rmListeners$&&(kt.$rmListeners$.map(Tr=>Tr()),kt.$rmListeners$=void 0)}})(this),_r&&_r.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(16&ur.$flags$)})}}),Ht.is=ur.$tagName$,hi(Ht,ur)},Sr=Ht=>{const kt=new URL(Ht,$.$resourcesUrl$);return kt.origin!==j.location.origin?kt.href:kt.pathname},mr=Ht=>$.$resourcesUrl$=Ht,Zs=new WeakMap,tn=Ht=>Zs.get(Ht),Bn=(Ht,kt)=>{const ur={$flags$:0,$hostElement$:Ht,$cmpMeta$:kt,$instanceValues$:new Map};return he(Ht,ur,kt.$listeners$),Zs.set(Ht,ur)},_o=(Ht,kt)=>kt in Ht,to=(Ht,kt)=>(0,console.error)(Ht,kt),ro=new Map,xa=[],xo=[],ti=[],Wa=(Ht,kt)=>ur=>{Ht.push(ur),Y||(Y=!0,kt&&4&$.$flags$?Yn(cs):$.raf(cs))},zo=Ht=>{for(let kt=0;kt<Ht.length;kt++)try{Ht[kt](performance.now())}catch(ur){to(ur)}Ht.length=0},cs=()=>{zo(xo),zo(ti),(Y=xo.length>0)&&$.raf(cs)},Yn=Ht=>Promise.resolve(void 0).then(Ht),us=Wa(ti,!0),ma={isDev:!1,isBrowser:!0,isServer:!1,isTesting:!1}},27122:(dt,Re)=>{"use strict";function x(mt,Ut){for(var Tt=0;Tt<Ut.length;Tt++){var ft=Ut[Tt];ft.enumerable=ft.enumerable||!1,ft.configurable=!0,"value"in ft&&(ft.writable=!0),Object.defineProperty(mt,ft.key,ft)}}function A(mt,Ut,Tt){return Ut&&x(mt.prototype,Ut),Tt&&x(mt,Tt),mt}function G(){return G=Object.assign||function(mt){for(var Ut=1;Ut<arguments.length;Ut++){var Tt=arguments[Ut];for(var ft in Tt)Object.prototype.hasOwnProperty.call(Tt,ft)&&(mt[ft]=Tt[ft])}return mt},G.apply(this,arguments)}function Q(mt,Ut){mt.prototype=Object.create(Ut.prototype),mt.prototype.constructor=mt,re(mt,Ut)}function H(mt){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(Tt){return Tt.__proto__||Object.getPrototypeOf(Tt)})(mt)}function re(mt,Ut){return(re=Object.setPrototypeOf||function(ft,pt){return ft.__proto__=pt,ft})(mt,Ut)}function J(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(mt){return!1}}function W(mt,Ut,Tt){return(W=J()?Reflect.construct:function(pt,rt,dr){var wr=[null];wr.push.apply(wr,rt);var Or=new(Function.bind.apply(pt,wr));return dr&&re(Or,dr.prototype),Or}).apply(null,arguments)}function Z(mt){var Ut="function"==typeof Map?new Map:void 0;return Z=function(ft){if(null===ft||!function B(mt){return-1!==Function.toString.call(mt).indexOf("[native code]")}(ft))return ft;if("function"!=typeof ft)throw new TypeError("Super expression must either be null or a function");if(void 0!==Ut){if(Ut.has(ft))return Ut.get(ft);Ut.set(ft,pt)}function pt(){return W(ft,arguments,H(this).constructor)}return pt.prototype=Object.create(ft.prototype,{constructor:{value:pt,enumerable:!1,writable:!0,configurable:!0}}),re(pt,ft)},Z(mt)}function ie(mt,Ut){if(null==mt)return{};var pt,rt,Tt={},ft=Object.keys(mt);for(rt=0;rt<ft.length;rt++)!(Ut.indexOf(pt=ft[rt])>=0)&&(Tt[pt]=mt[pt]);return Tt}function ce(mt,Ut){(null==Ut||Ut>mt.length)&&(Ut=mt.length);for(var Tt=0,ft=new Array(Ut);Tt<Ut;Tt++)ft[Tt]=mt[Tt];return ft}function oe(mt,Ut){var Tt="undefined"!=typeof Symbol&&mt[Symbol.iterator]||mt["@@iterator"];if(Tt)return(Tt=Tt.call(mt)).next.bind(Tt);if(Array.isArray(mt)||(Tt=function ue(mt,Ut){if(mt){if("string"==typeof mt)return ce(mt,Ut);var Tt=Object.prototype.toString.call(mt).slice(8,-1);if("Object"===Tt&&mt.constructor&&(Tt=mt.constructor.name),"Map"===Tt||"Set"===Tt)return Array.from(mt);if("Arguments"===Tt||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Tt))return ce(mt,Ut)}}(mt))||Ut&&mt&&"number"==typeof mt.length){Tt&&(mt=Tt);var ft=0;return function(){return ft>=mt.length?{done:!0}:{done:!1,value:mt[ft++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var le=function(mt){function Ut(){return mt.apply(this,arguments)||this}return Q(Ut,mt),Ut}(Z(Error)),Y=function(mt){function Ut(Tt){return mt.call(this,"Invalid DateTime: "+Tt.toMessage())||this}return Q(Ut,mt),Ut}(le),j=function(mt){function Ut(Tt){return mt.call(this,"Invalid Interval: "+Tt.toMessage())||this}return Q(Ut,mt),Ut}(le),X=function(mt){function Ut(Tt){return mt.call(this,"Invalid Duration: "+Tt.toMessage())||this}return Q(Ut,mt),Ut}(le),U=function(mt){function Ut(){return mt.apply(this,arguments)||this}return Q(Ut,mt),Ut}(le),ee=function(mt){function Ut(Tt){return mt.call(this,"Invalid unit "+Tt)||this}return Q(Ut,mt),Ut}(le),$=function(mt){function Ut(){return mt.apply(this,arguments)||this}return Q(Ut,mt),Ut}(le),ne=function(mt){function Ut(){return mt.call(this,"Zone is an abstract class")||this}return Q(Ut,mt),Ut}(le),se="numeric",ae="short",de="long",_e={year:se,month:se,day:se},pe={year:se,month:ae,day:se},he={year:se,month:ae,day:se,weekday:ae},ge={year:se,month:de,day:se},ye={year:se,month:de,day:se,weekday:de},Me={hour:se,minute:se},Ee={hour:se,minute:se,second:se},Te={hour:se,minute:se,second:se,timeZoneName:ae},me={hour:se,minute:se,second:se,timeZoneName:de},Ce={hour:se,minute:se,hourCycle:"h23"},Ie={hour:se,minute:se,second:se,hourCycle:"h23"},Ge={hour:se,minute:se,second:se,hourCycle:"h23",timeZoneName:ae},Je={hour:se,minute:se,second:se,hourCycle:"h23",timeZoneName:de},xe={year:se,month:se,day:se,hour:se,minute:se},je={year:se,month:se,day:se,hour:se,minute:se,second:se},We={year:se,month:ae,day:se,hour:se,minute:se},Ne={year:se,month:ae,day:se,hour:se,minute:se,second:se},we={year:se,month:ae,day:se,weekday:ae,hour:se,minute:se},Oe={year:se,month:de,day:se,hour:se,minute:se,timeZoneName:ae},$e={year:se,month:de,day:se,hour:se,minute:se,second:se,timeZoneName:ae},Be={year:se,month:de,day:se,weekday:de,hour:se,minute:se,timeZoneName:de},Se={year:se,month:de,day:se,weekday:de,hour:se,minute:se,second:se,timeZoneName:de};function De(mt){return void 0===mt}function Fe(mt){return"number"==typeof mt}function ve(mt){return"number"==typeof mt&&mt%1==0}function be(){try{return"undefined"!=typeof Intl&&!!Intl.RelativeTimeFormat}catch(mt){return!1}}function Ye(mt,Ut,Tt){if(0!==mt.length)return mt.reduce(function(ft,pt){var rt=[Ut(pt),pt];return ft&&Tt(ft[0],rt[0])===ft[0]?ft:rt},null)[1]}function et(mt,Ut){return Object.prototype.hasOwnProperty.call(mt,Ut)}function ke(mt,Ut,Tt){return ve(mt)&&mt>=Ut&&mt<=Tt}function at(mt,Ut){return void 0===Ut&&(Ut=2),mt<0?"-"+(""+-mt).padStart(Ut,"0"):(""+mt).padStart(Ut,"0")}function yt(mt){if(!De(mt)&&null!==mt&&""!==mt)return parseInt(mt,10)}function wt(mt){if(!De(mt)&&null!==mt&&""!==mt)return parseFloat(mt)}function zt(mt){if(!De(mt)&&null!==mt&&""!==mt){var Ut=1e3*parseFloat("0."+mt);return Math.floor(Ut)}}function Rt(mt,Ut,Tt){void 0===Tt&&(Tt=!1);var ft=Math.pow(10,Ut);return(Tt?Math.trunc:Math.round)(mt*ft)/ft}function Ft(mt){return mt%4==0&&(mt%100!=0||mt%400==0)}function bt(mt){return Ft(mt)?366:365}function St(mt,Ut){var Tt=function ot(mt,Ut){return mt-Ut*Math.floor(mt/Ut)}(Ut-1,12)+1;return 2===Tt?Ft(mt+(Ut-Tt)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][Tt-1]}function Xt(mt){var Ut=Date.UTC(mt.year,mt.month-1,mt.day,mt.hour,mt.minute,mt.second,mt.millisecond);return mt.year<100&&mt.year>=0&&(Ut=new Date(Ut)).setUTCFullYear(Ut.getUTCFullYear()-1900),+Ut}function Mr(mt){var Ut=(mt+Math.floor(mt/4)-Math.floor(mt/100)+Math.floor(mt/400))%7,Tt=mt-1,ft=(Tt+Math.floor(Tt/4)-Math.floor(Tt/100)+Math.floor(Tt/400))%7;return 4===Ut||3===ft?53:52}function Cr(mt){return mt>99?mt:mt>60?1900+mt:2e3+mt}function Yr(mt,Ut,Tt,ft){void 0===ft&&(ft=null);var pt=new Date(mt),rt={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};ft&&(rt.timeZone=ft);var dr=G({timeZoneName:Ut},rt),wr=new Intl.DateTimeFormat(Tt,dr).formatToParts(pt).find(function($t){return"timezonename"===$t.type.toLowerCase()});return wr?wr.value:null}function Lr(mt,Ut){var Tt=parseInt(mt,10);Number.isNaN(Tt)&&(Tt=0);var ft=parseInt(Ut,10)||0;return 60*Tt+(Tt<0||Object.is(Tt,-0)?-ft:ft)}function ct(mt){var Ut=Number(mt);if("boolean"==typeof mt||""===mt||Number.isNaN(Ut))throw new $("Invalid unit value "+mt);return Ut}function jt(mt,Ut){var Tt={};for(var ft in mt)if(et(mt,ft)){var pt=mt[ft];if(null==pt)continue;Tt[Ut(ft)]=ct(pt)}return Tt}function qt(mt,Ut){var Tt=Math.trunc(Math.abs(mt/60)),ft=Math.trunc(Math.abs(mt%60)),pt=mt>=0?"+":"-";switch(Ut){case"short":return""+pt+at(Tt,2)+":"+at(ft,2);case"narrow":return""+pt+Tt+(ft>0?":"+ft:"");case"techie":return""+pt+at(Tt,2)+at(ft,2);default:throw new RangeError("Value format "+Ut+" is out of range for property format")}}function er(mt){return function ze(mt,Ut){return Ut.reduce(function(Tt,ft){return Tt[ft]=mt[ft],Tt},{})}(mt,["hour","minute","second","millisecond"])}var Zt=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,tr=["January","February","March","April","May","June","July","August","September","October","November","December"],ir=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fr=["J","F","M","A","M","J","J","A","S","O","N","D"];function Ur(mt){switch(mt){case"narrow":return[].concat(fr);case"short":return[].concat(ir);case"long":return[].concat(tr);case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}var Br=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],Zr=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],ri=["M","T","W","T","F","S","S"];function hr(mt){switch(mt){case"narrow":return[].concat(ri);case"short":return[].concat(Zr);case"long":return[].concat(Br);case"numeric":return["1","2","3","4","5","6","7"];default:return null}}var Dr=["AM","PM"],Kr=["Before Christ","Anno Domini"],Nt=["BC","AD"],lr=["B","A"];function jr(mt){switch(mt){case"narrow":return[].concat(lr);case"short":return[].concat(Nt);case"long":return[].concat(Kr);default:return null}}function ii(mt,Ut){for(var pt,Tt="",ft=oe(mt);!(pt=ft()).done;){var rt=pt.value;Tt+=rt.literal?rt.val:Ut(rt.val)}return Tt}var mi={D:_e,DD:pe,DDD:ge,DDDD:ye,t:Me,tt:Ee,ttt:Te,tttt:me,T:Ce,TT:Ie,TTT:Ge,TTTT:Je,f:xe,ff:We,fff:Oe,ffff:Be,F:je,FF:Ne,FFF:$e,FFFF:Se},wi=function(){function mt(Tt,ft){this.opts=ft,this.loc=Tt,this.systemLoc=null}mt.create=function(ft,pt){return void 0===pt&&(pt={}),new mt(ft,pt)},mt.parseFormat=function(ft){for(var pt=null,rt="",dr=!1,wr=[],$t=0;$t<ft.length;$t++){var Or=ft.charAt($t);"'"===Or?(rt.length>0&&wr.push({literal:dr,val:rt}),pt=null,rt="",dr=!dr):dr||Or===pt?rt+=Or:(rt.length>0&&wr.push({literal:!1,val:rt}),rt=Or,pt=Or)}return rt.length>0&&wr.push({literal:dr,val:rt}),wr},mt.macroTokenToFormatOpts=function(ft){return mi[ft]};var Ut=mt.prototype;return Ut.formatWithSystemDefault=function(ft,pt){return null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(ft,G({},this.opts,pt)).format()},Ut.formatDateTime=function(ft,pt){return void 0===pt&&(pt={}),this.loc.dtFormatter(ft,G({},this.opts,pt)).format()},Ut.formatDateTimeParts=function(ft,pt){return void 0===pt&&(pt={}),this.loc.dtFormatter(ft,G({},this.opts,pt)).formatToParts()},Ut.resolvedOptions=function(ft,pt){return void 0===pt&&(pt={}),this.loc.dtFormatter(ft,G({},this.opts,pt)).resolvedOptions()},Ut.num=function(ft,pt){if(void 0===pt&&(pt=0),this.opts.forceSimple)return at(ft,pt);var rt=G({},this.opts);return pt>0&&(rt.padTo=pt),this.loc.numberFormatter(rt).format(ft)},Ut.formatDateTimeFromString=function(ft,pt){var rt=this,dr="en"===this.loc.listingMode(),wr=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,$t=function(Vs,po){return rt.loc.extract(ft,Vs,po)},Or=function(Vs){return ft.isOffsetFixed&&0===ft.offset&&Vs.allowZ?"Z":ft.isValid?ft.zone.formatOffset(ft.ts,Vs.format):""},ci=function(Vs,po){return dr?function pr(mt,Ut){return Ur(Ut)[mt.month-1]}(ft,Vs):$t(po?{month:Vs}:{month:Vs,day:"numeric"},"month")},qr=function(Vs,po){return dr?function rr(mt,Ut){return hr(Ut)[mt.weekday-1]}(ft,Vs):$t(po?{weekday:Vs}:{weekday:Vs,month:"long",day:"numeric"},"weekday")},$s=function(Vs){return dr?function Pr(mt,Ut){return jr(Ut)[mt.year<0?0:1]}(ft,Vs):$t({era:Vs},"era")};return ii(mt.parseFormat(pt),function(Vs){switch(Vs){case"S":return rt.num(ft.millisecond);case"u":case"SSS":return rt.num(ft.millisecond,3);case"s":return rt.num(ft.second);case"ss":return rt.num(ft.second,2);case"uu":return rt.num(Math.floor(ft.millisecond/10),2);case"uuu":return rt.num(Math.floor(ft.millisecond/100));case"m":return rt.num(ft.minute);case"mm":return rt.num(ft.minute,2);case"h":return rt.num(ft.hour%12==0?12:ft.hour%12);case"hh":return rt.num(ft.hour%12==0?12:ft.hour%12,2);case"H":return rt.num(ft.hour);case"HH":return rt.num(ft.hour,2);case"Z":return Or({format:"narrow",allowZ:rt.opts.allowZ});case"ZZ":return Or({format:"short",allowZ:rt.opts.allowZ});case"ZZZ":return Or({format:"techie",allowZ:rt.opts.allowZ});case"ZZZZ":return ft.zone.offsetName(ft.ts,{format:"short",locale:rt.loc.locale});case"ZZZZZ":return ft.zone.offsetName(ft.ts,{format:"long",locale:rt.loc.locale});case"z":return ft.zoneName;case"a":return dr?function Ot(mt){return Dr[mt.hour<12?0:1]}(ft):$t({hour:"numeric",hourCycle:"h12"},"dayperiod");case"d":return wr?$t({day:"numeric"},"day"):rt.num(ft.day);case"dd":return wr?$t({day:"2-digit"},"day"):rt.num(ft.day,2);case"c":case"E":return rt.num(ft.weekday);case"ccc":return qr("short",!0);case"cccc":return qr("long",!0);case"ccccc":return qr("narrow",!0);case"EEE":return qr("short",!1);case"EEEE":return qr("long",!1);case"EEEEE":return qr("narrow",!1);case"L":return wr?$t({month:"numeric",day:"numeric"},"month"):rt.num(ft.month);case"LL":return wr?$t({month:"2-digit",day:"numeric"},"month"):rt.num(ft.month,2);case"LLL":return ci("short",!0);case"LLLL":return ci("long",!0);case"LLLLL":return ci("narrow",!0);case"M":return wr?$t({month:"numeric"},"month"):rt.num(ft.month);case"MM":return wr?$t({month:"2-digit"},"month"):rt.num(ft.month,2);case"MMM":return ci("short",!1);case"MMMM":return ci("long",!1);case"MMMMM":return ci("narrow",!1);case"y":return wr?$t({year:"numeric"},"year"):rt.num(ft.year);case"yy":return wr?$t({year:"2-digit"},"year"):rt.num(ft.year.toString().slice(-2),2);case"yyyy":return wr?$t({year:"numeric"},"year"):rt.num(ft.year,4);case"yyyyyy":return wr?$t({year:"numeric"},"year"):rt.num(ft.year,6);case"G":return $s("short");case"GG":return $s("long");case"GGGGG":return $s("narrow");case"kk":return rt.num(ft.weekYear.toString().slice(-2),2);case"kkkk":return rt.num(ft.weekYear,4);case"W":return rt.num(ft.weekNumber);case"WW":return rt.num(ft.weekNumber,2);case"o":return rt.num(ft.ordinal);case"ooo":return rt.num(ft.ordinal,3);case"q":return rt.num(ft.quarter);case"qq":return rt.num(ft.quarter,2);case"X":return rt.num(Math.floor(ft.ts/1e3));case"x":return rt.num(ft.ts);default:return function(Vs){var po=mt.macroTokenToFormatOpts(Vs);return po?rt.formatWithSystemDefault(ft,po):Vs}(Vs)}})},Ut.formatDurationFromString=function(ft,pt){var qr,rt=this,dr=function(qr){switch(qr[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},$t=mt.parseFormat(pt),Or=$t.reduce(function(ci,qr){return qr.literal?ci:ci.concat(qr.val)},[]),fi=ft.shiftTo.apply(ft,Or.map(dr).filter(function(ci){return ci}));return ii($t,(qr=fi,function(_s){var $s=dr(_s);return $s?rt.num(qr.get($s),_s.length):_s}))},mt}(),Qr=function(){function mt(Tt,ft){this.reason=Tt,this.explanation=ft}return mt.prototype.toMessage=function(){return this.explanation?this.reason+": "+this.explanation:this.reason},mt}(),Ni=function(){function mt(){}var Ut=mt.prototype;return Ut.offsetName=function(ft,pt){throw new ne},Ut.formatOffset=function(ft,pt){throw new ne},Ut.offset=function(ft){throw new ne},Ut.equals=function(ft){throw new ne},A(mt,[{key:"type",get:function(){throw new ne}},{key:"name",get:function(){throw new ne}},{key:"ianaName",get:function(){return this.name}},{key:"isUniversal",get:function(){throw new ne}},{key:"isValid",get:function(){throw new ne}}]),mt}(),Hs=null,Ar=function(mt){function Ut(){return mt.apply(this,arguments)||this}Q(Ut,mt);var Tt=Ut.prototype;return Tt.offsetName=function(pt,rt){return Yr(pt,rt.format,rt.locale)},Tt.formatOffset=function(pt,rt){return qt(this.offset(pt),rt)},Tt.offset=function(pt){return-new Date(pt).getTimezoneOffset()},Tt.equals=function(pt){return"system"===pt.type},A(Ut,[{key:"type",get:function(){return"system"}},{key:"name",get:function(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return!0}}],[{key:"instance",get:function(){return null===Hs&&(Hs=new Ut),Hs}}]),Ut}(Ni),ni={},Ii={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6},es={},zr=function(mt){function Ut(ft){var pt;return(pt=mt.call(this)||this).zoneName=ft,pt.valid=Ut.isValidZone(ft),pt}Q(Ut,mt),Ut.create=function(pt){return es[pt]||(es[pt]=new Ut(pt)),es[pt]},Ut.resetCache=function(){es={},ni={}},Ut.isValidSpecifier=function(pt){return this.isValidZone(pt)},Ut.isValidZone=function(pt){if(!pt)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:pt}).format(),!0}catch(rt){return!1}};var Tt=Ut.prototype;return Tt.offsetName=function(pt,rt){return Yr(pt,rt.format,rt.locale,this.name)},Tt.formatOffset=function(pt,rt){return qt(this.offset(pt),rt)},Tt.offset=function(pt){var rt=new Date(pt);if(isNaN(rt))return NaN;var dr=function _i(mt){return ni[mt]||(ni[mt]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:mt,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),ni[mt]}(this.name),wr=dr.formatToParts?function Gi(mt,Ut){for(var Tt=mt.formatToParts(Ut),ft=[],pt=0;pt<Tt.length;pt++){var rt=Tt[pt],dr=rt.type,wr=rt.value,$t=Ii[dr];"era"===dr?ft[$t]=wr:De($t)||(ft[$t]=parseInt(wr,10))}return ft}(dr,rt):function ji(mt,Ut){var Tt=mt.format(Ut).replace(/\u200E/g,""),ft=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(Tt);return[ft[3],ft[1],ft[2],ft[4],ft[5],ft[6],ft[7]]}(dr,rt),$t=wr[0],Or=wr[1],fi=wr[2],qr=wr[4],_s=wr[5],$s=wr[6];"BC"===wr[3]&&($t=1-Math.abs($t));var Vs=+rt,po=Vs%1e3;return(Xt({year:$t,month:Or,day:fi,hour:24===qr?0:qr,minute:_s,second:$s,millisecond:0})-(Vs-=po>=0?po:1e3+po))/6e4},Tt.equals=function(pt){return"iana"===pt.type&&pt.name===this.name},A(Ut,[{key:"type",get:function(){return"iana"}},{key:"name",get:function(){return this.zoneName}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return this.valid}}]),Ut}(Ni),gs=null,hi=function(mt){function Ut(ft){var pt;return(pt=mt.call(this)||this).fixed=ft,pt}Q(Ut,mt),Ut.instance=function(pt){return 0===pt?Ut.utcInstance:new Ut(pt)},Ut.parseSpecifier=function(pt){if(pt){var rt=pt.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(rt)return new Ut(Lr(rt[1],rt[2]))}return null};var Tt=Ut.prototype;return Tt.offsetName=function(){return this.name},Tt.formatOffset=function(pt,rt){return qt(this.fixed,rt)},Tt.offset=function(){return this.fixed},Tt.equals=function(pt){return"fixed"===pt.type&&pt.fixed===this.fixed},A(Ut,[{key:"type",get:function(){return"fixed"}},{key:"name",get:function(){return 0===this.fixed?"UTC":"UTC"+qt(this.fixed,"narrow")}},{key:"ianaName",get:function(){return 0===this.fixed?"Etc/UTC":"Etc/GMT"+qt(-this.fixed,"narrow")}},{key:"isUniversal",get:function(){return!0}},{key:"isValid",get:function(){return!0}}],[{key:"utcInstance",get:function(){return null===gs&&(gs=new Ut(0)),gs}}]),Ut}(Ni),ln=function(mt){function Ut(ft){var pt;return(pt=mt.call(this)||this).zoneName=ft,pt}Q(Ut,mt);var Tt=Ut.prototype;return Tt.offsetName=function(){return null},Tt.formatOffset=function(){return""},Tt.offset=function(){return NaN},Tt.equals=function(){return!1},A(Ut,[{key:"type",get:function(){return"invalid"}},{key:"name",get:function(){return this.zoneName}},{key:"isUniversal",get:function(){return!1}},{key:"isValid",get:function(){return!1}}]),Ut}(Ni);function ds(mt,Ut){if(De(mt)||null===mt)return Ut;if(mt instanceof Ni)return mt;if(function Ke(mt){return"string"==typeof mt}(mt)){var Tt=mt.toLowerCase();return"local"===Tt||"system"===Tt?Ut:"utc"===Tt||"gmt"===Tt?hi.utcInstance:hi.parseSpecifier(Tt)||zr.create(mt)}return Fe(mt)?hi.instance(mt):"object"==typeof mt&&mt.offset&&"number"==typeof mt.offset?mt:new ln(mt)}var is,Mt=function(){return Date.now()},Hr="system",Ir=null,gi=null,Ui=null,ss=function(){function mt(){}return mt.resetCaches=function(){Bn.resetCache(),zr.resetCache()},A(mt,null,[{key:"now",get:function(){return Mt},set:function(Tt){Mt=Tt}},{key:"defaultZone",get:function(){return ds(Hr,Ar.instance)},set:function(Tt){Hr=Tt}},{key:"defaultLocale",get:function(){return Ir},set:function(Tt){Ir=Tt}},{key:"defaultNumberingSystem",get:function(){return gi},set:function(Tt){gi=Tt}},{key:"defaultOutputCalendar",get:function(){return Ui},set:function(Tt){Ui=Tt}},{key:"throwOnInvalid",get:function(){return is},set:function(Tt){is=Tt}}]),mt}(),ts=["base"],ys=["padTo","floor"],ps={},Ps={};function ms(mt,Ut){void 0===Ut&&(Ut={});var Tt=JSON.stringify([mt,Ut]),ft=Ps[Tt];return ft||(ft=new Intl.DateTimeFormat(mt,Ut),Ps[Tt]=ft),ft}var Un={},Sr={},Wr=null;function Ks(mt,Ut,Tt,ft,pt){var rt=mt.listingMode(Tt);return"error"===rt?null:"en"===rt?ft(Ut):pt(Ut)}var Zs=function(){function mt(Tt,ft,pt){this.padTo=pt.padTo||0,this.floor=pt.floor||!1;var rt=ie(pt,ys);if(!ft||Object.keys(rt).length>0){var dr=G({useGrouping:!1},pt);pt.padTo>0&&(dr.minimumIntegerDigits=pt.padTo),this.inf=function gr(mt,Ut){void 0===Ut&&(Ut={});var Tt=JSON.stringify([mt,Ut]),ft=Un[Tt];return ft||(ft=new Intl.NumberFormat(mt,Ut),Un[Tt]=ft),ft}(Tt,dr)}}return mt.prototype.format=function(ft){if(this.inf){var pt=this.floor?Math.floor(ft):ft;return this.inf.format(pt)}return at(this.floor?Math.floor(ft):Rt(ft,3),this.padTo)},mt}(),tn=function(){function mt(Tt,ft,pt){var rt;if(this.opts=pt,Tt.zone.isUniversal){var dr=Tt.offset/60*-1,wr=dr>=0?"Etc/GMT+"+dr:"Etc/GMT"+dr;0!==Tt.offset&&zr.create(wr).valid?(rt=wr,this.dt=Tt):(rt="UTC",this.dt=pt.timeZoneName||0===Tt.offset?Tt:Bo.fromMillis(Tt.ts+60*Tt.offset*1e3))}else"system"===Tt.zone.type?this.dt=Tt:(this.dt=Tt,rt=Tt.zone.name);var $t=G({},this.opts);rt&&($t.timeZone=rt),this.dtf=ms(ft,$t)}var Ut=mt.prototype;return Ut.format=function(){return this.dtf.format(this.dt.toJSDate())},Ut.formatToParts=function(){return this.dtf.formatToParts(this.dt.toJSDate())},Ut.resolvedOptions=function(){return this.dtf.resolvedOptions()},mt}(),So=function(){function mt(Tt,ft,pt){this.opts=G({style:"long"},pt),!ft&&be()&&(this.rtf=function mr(mt,Ut){void 0===Ut&&(Ut={});var ft=ie(Ut,ts),pt=JSON.stringify([mt,ft]),rt=Sr[pt];return rt||(rt=new Intl.RelativeTimeFormat(mt,Ut),Sr[pt]=rt),rt}(Tt,pt))}var Ut=mt.prototype;return Ut.format=function(ft,pt){return this.rtf?this.rtf.format(ft,pt):function Fr(mt,Ut,Tt,ft){void 0===Tt&&(Tt="always"),void 0===ft&&(ft=!1);var pt={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},rt=-1===["hours","minutes","seconds"].indexOf(mt);if("auto"===Tt&&rt){var dr="days"===mt;switch(Ut){case 1:return dr?"tomorrow":"next "+pt[mt][0];case-1:return dr?"yesterday":"last "+pt[mt][0];case 0:return dr?"today":"this "+pt[mt][0]}}var wr=Object.is(Ut,-0)||Ut<0,$t=Math.abs(Ut),Or=1===$t,fi=pt[mt],ci=ft?Or?fi[1]:fi[2]||fi[1]:Or?pt[mt][0]:mt;return wr?$t+" "+ci+" ago":"in "+$t+" "+ci}(pt,ft,this.opts.numeric,"long"!==this.opts.style)},Ut.formatToParts=function(ft,pt){return this.rtf?this.rtf.formatToParts(ft,pt):[]},mt}(),Bn=function(){function mt(Tt,ft,pt,rt){var dr=function Wi(mt){var Ut=mt.indexOf("-u-");if(-1===Ut)return[mt];var Tt,ft=mt.substring(0,Ut);try{Tt=ms(mt).resolvedOptions()}catch(wr){Tt=ms(ft).resolvedOptions()}return[ft,Tt.numberingSystem,Tt.calendar]}(Tt),$t=dr[1],Or=dr[2];this.locale=dr[0],this.numberingSystem=ft||$t||null,this.outputCalendar=pt||Or||null,this.intl=function ns(mt,Ut,Tt){return(Tt||Ut)&&(mt+="-u",Tt&&(mt+="-ca-"+Tt),Ut&&(mt+="-nu-"+Ut)),mt}(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=rt,this.fastNumbersCached=null}mt.fromOpts=function(ft){return mt.create(ft.locale,ft.numberingSystem,ft.outputCalendar,ft.defaultToEN)},mt.create=function(ft,pt,rt,dr){void 0===dr&&(dr=!1);var wr=ft||ss.defaultLocale;return new mt(wr||(dr?"en-US":function Di(){return Wr||(Wr=(new Intl.DateTimeFormat).resolvedOptions().locale)}()),pt||ss.defaultNumberingSystem,rt||ss.defaultOutputCalendar,wr)},mt.resetCache=function(){Wr=null,Ps={},Un={},Sr={}},mt.fromObject=function(ft){var pt=void 0===ft?{}:ft;return mt.create(pt.locale,pt.numberingSystem,pt.outputCalendar)};var Ut=mt.prototype;return Ut.listingMode=function(){return this.isEnglish()&&!(null!==this.numberingSystem&&"latn"!==this.numberingSystem||null!==this.outputCalendar&&"gregory"!==this.outputCalendar)?"en":"intl"},Ut.clone=function(ft){return ft&&0!==Object.getOwnPropertyNames(ft).length?mt.create(ft.locale||this.specifiedLocale,ft.numberingSystem||this.numberingSystem,ft.outputCalendar||this.outputCalendar,ft.defaultToEN||!1):this},Ut.redefaultToEN=function(ft){return void 0===ft&&(ft={}),this.clone(G({},ft,{defaultToEN:!0}))},Ut.redefaultToSystem=function(ft){return void 0===ft&&(ft={}),this.clone(G({},ft,{defaultToEN:!1}))},Ut.months=function(ft,pt,rt){var dr=this;return void 0===pt&&(pt=!1),void 0===rt&&(rt=!0),Ks(this,ft,rt,Ur,function(){var wr=pt?{month:ft,day:"numeric"}:{month:ft},$t=pt?"format":"standalone";return dr.monthsCache[$t][ft]||(dr.monthsCache[$t][ft]=function Yi(mt){for(var Ut=[],Tt=1;Tt<=12;Tt++){var ft=Bo.utc(2016,Tt,1);Ut.push(mt(ft))}return Ut}(function(Or){return dr.extract(Or,wr,"month")})),dr.monthsCache[$t][ft]})},Ut.weekdays=function(ft,pt,rt){var dr=this;return void 0===pt&&(pt=!1),void 0===rt&&(rt=!0),Ks(this,ft,rt,hr,function(){var wr=pt?{weekday:ft,year:"numeric",month:"long",day:"numeric"}:{weekday:ft},$t=pt?"format":"standalone";return dr.weekdaysCache[$t][ft]||(dr.weekdaysCache[$t][ft]=function hs(mt){for(var Ut=[],Tt=1;Tt<=7;Tt++){var ft=Bo.utc(2016,11,13+Tt);Ut.push(mt(ft))}return Ut}(function(Or){return dr.extract(Or,wr,"weekday")})),dr.weekdaysCache[$t][ft]})},Ut.meridiems=function(ft){var pt=this;return void 0===ft&&(ft=!0),Ks(this,void 0,ft,function(){return Dr},function(){if(!pt.meridiemCache){var rt={hour:"numeric",hourCycle:"h12"};pt.meridiemCache=[Bo.utc(2016,11,13,9),Bo.utc(2016,11,13,19)].map(function(dr){return pt.extract(dr,rt,"dayperiod")})}return pt.meridiemCache})},Ut.eras=function(ft,pt){var rt=this;return void 0===pt&&(pt=!0),Ks(this,ft,pt,jr,function(){var dr={era:ft};return rt.eraCache[ft]||(rt.eraCache[ft]=[Bo.utc(-40,1,1),Bo.utc(2017,1,1)].map(function(wr){return rt.extract(wr,dr,"era")})),rt.eraCache[ft]})},Ut.extract=function(ft,pt,rt){var $t=this.dtFormatter(ft,pt).formatToParts().find(function(Or){return Or.type.toLowerCase()===rt});return $t?$t.value:null},Ut.numberFormatter=function(ft){return void 0===ft&&(ft={}),new Zs(this.intl,ft.forceSimple||this.fastNumbers,ft)},Ut.dtFormatter=function(ft,pt){return void 0===pt&&(pt={}),new tn(ft,this.intl,pt)},Ut.relFormatter=function(ft){return void 0===ft&&(ft={}),new So(this.intl,this.isEnglish(),ft)},Ut.listFormatter=function(ft){return void 0===ft&&(ft={}),function Ds(mt,Ut){void 0===Ut&&(Ut={});var Tt=JSON.stringify([mt,Ut]),ft=ps[Tt];return ft||(ft=new Intl.ListFormat(mt,Ut),ps[Tt]=ft),ft}(this.intl,ft)},Ut.isEnglish=function(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")},Ut.equals=function(ft){return this.locale===ft.locale&&this.numberingSystem===ft.numberingSystem&&this.outputCalendar===ft.outputCalendar},A(mt,[{key:"fastNumbers",get:function(){return null==this.fastNumbersCached&&(this.fastNumbersCached=function Ms(mt){return(!mt.numberingSystem||"latn"===mt.numberingSystem)&&("latn"===mt.numberingSystem||!mt.locale||mt.locale.startsWith("en")||"latn"===new Intl.DateTimeFormat(mt.intl).resolvedOptions().numberingSystem)}(this)),this.fastNumbersCached}}]),mt}();function _o(){for(var mt=arguments.length,Ut=new Array(mt),Tt=0;Tt<mt;Tt++)Ut[Tt]=arguments[Tt];var ft=Ut.reduce(function(pt,rt){return pt+rt.source},"");return RegExp("^"+ft+"$")}function to(){for(var mt=arguments.length,Ut=new Array(mt),Tt=0;Tt<mt;Tt++)Ut[Tt]=arguments[Tt];return function(ft){return Ut.reduce(function(pt,rt){var dr=pt[0],wr=pt[1],Or=rt(ft,pt[2]),ci=Or[1],qr=Or[2];return[G({},dr,Or[0]),ci||wr,qr]},[{},null,1]).slice(0,2)}}function Vn(mt){if(null==mt)return[null,null];for(var Ut=arguments.length,Tt=new Array(Ut>1?Ut-1:0),ft=1;ft<Ut;ft++)Tt[ft-1]=arguments[ft];for(var pt=0,rt=Tt;pt<rt.length;pt++){var dr=rt[pt],wr=dr[0],$t=dr[1],Or=wr.exec(mt);if(Or)return $t(Or)}return[null,null]}function Pa(){for(var mt=arguments.length,Ut=new Array(mt),Tt=0;Tt<mt;Tt++)Ut[Tt]=arguments[Tt];return function(ft,pt){var dr,rt={};for(dr=0;dr<Ut.length;dr++)rt[Ut[dr]]=yt(ft[pt+dr]);return[rt,null,pt+dr]}}var fa=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,_a=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,ia=RegExp(_a.source+("(?:"+fa.source+"?(?:\\[("+Zt.source+")\\])?)?")),Xs=RegExp("(?:T"+ia.source+")?"),ti=Pa("weekYear","weekNumber","weekDay"),Nn=Pa("year","ordinal"),zo=RegExp(_a.source+" ?(?:"+fa.source+"|("+Zt.source+"))?"),nn=RegExp("(?: "+zo.source+")?");function cs(mt,Ut,Tt){var ft=mt[Ut];return De(ft)?Tt:yt(ft)}function Jn(mt,Ut){return[{hours:cs(mt,Ut,0),minutes:cs(mt,Ut+1,0),seconds:cs(mt,Ut+2,0),milliseconds:zt(mt[Ut+3])},null,Ut+4]}function us(mt,Ut){var Tt=!mt[Ut]&&!mt[Ut+1],ft=Lr(mt[Ut+1],mt[Ut+2]);return[{},Tt?null:hi.instance(ft),Ut+3]}function ma(mt,Ut){return[{},mt[Ut]?zr.create(mt[Ut]):null,Ut+1]}var Ht=RegExp("^T?"+_a.source+"$"),kt=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/;function ur(mt){var ft=mt[2],pt=mt[3],rt=mt[4],dr=mt[5],wr=mt[6],$t=mt[7],Or=mt[8],fi="-"===mt[0][0],ci=$t&&"-"===$t[0],qr=function($s,Ri){return void 0===Ri&&(Ri=!1),void 0!==$s&&(Ri||$s&&fi)?-$s:$s};return[{years:qr(wt(mt[1])),months:qr(wt(ft)),weeks:qr(wt(pt)),days:qr(wt(rt)),hours:qr(wt(dr)),minutes:qr(wt(wr)),seconds:qr(wt($t),"-0"===$t),milliseconds:qr(zt(Or),ci)}]}var Tr={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function _r(mt,Ut,Tt,ft,pt,rt,dr){var wr={year:2===Ut.length?Cr(yt(Ut)):yt(Ut),month:ir.indexOf(Tt)+1,day:yt(ft),hour:yt(pt),minute:yt(rt)};return dr&&(wr.second=yt(dr)),mt&&(wr.weekday=mt.length>3?Br.indexOf(mt)+1:Zr.indexOf(mt)+1),wr}var Gr=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function oi(mt){var _s,$t=mt[8],Or=mt[9],fi=mt[10],ci=mt[11],qr=_r(mt[1],mt[4],mt[3],mt[2],mt[5],mt[6],mt[7]);return _s=$t?Tr[$t]:Or?0:Lr(fi,ci),[qr,new hi(_s)]}var Bt=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,vr=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,kr=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function ai(mt){return[_r(mt[1],mt[4],mt[3],mt[2],mt[5],mt[6],mt[7]),hi.utcInstance]}function Hi(mt){return[_r(mt[1],mt[7],mt[2],mt[3],mt[4],mt[5],mt[6]),hi.utcInstance]}var fs=_o(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,Xs),Tn=_o(/(\d{4})-?W(\d\d)(?:-?(\d))?/,Xs),On=_o(/(\d{4})-?(\d{3})/,Xs),rn=_o(ia),hn=to(function Yn(mt,Ut){return[{year:cs(mt,Ut),month:cs(mt,Ut+1,1),day:cs(mt,Ut+2,1)},null,Ut+3]},Jn,us,ma),no=to(ti,Jn,us,ma),Sn=to(Nn,Jn,us,ma),Va=to(Jn,us,ma),yn=to(Jn),Cn=_o(/(\d{4})-(\d\d)-(\d\d)/,nn),Do=_o(zo),El=to(Jn,us,ma),bl={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048e5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864e5},hours:{minutes:60,seconds:3600,milliseconds:36e5},minutes:{seconds:60,milliseconds:6e4},seconds:{milliseconds:1e3}},Ai=G({years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536e3,milliseconds:31536e6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624e5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592e3,milliseconds:2592e6}},bl),Ze=365.2425,lo=30.436875,ol=G({years:{quarters:4,months:12,weeks:Ze/7,days:Ze,hours:24*Ze,minutes:525949.2,seconds:525949.2*60,milliseconds:525949.2*60*1e3},quarters:{months:3,weeks:Ze/28,days:Ze/4,hours:24*Ze/4,minutes:131487.3,seconds:525949.2*60/4,milliseconds:7889237999.999999},months:{weeks:lo/7,days:lo,hours:24*lo,minutes:43829.1,seconds:2629746,milliseconds:2629746e3}},bl),Pn=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],o0=Pn.slice(0).reverse();function Fl(mt,Ut,Tt){void 0===Tt&&(Tt=!1);var ft={values:Tt?Ut.values:G({},mt.values,Ut.values||{}),loc:mt.loc.clone(Ut.loc),conversionAccuracy:Ut.conversionAccuracy||mt.conversionAccuracy};return new da(ft)}function xn(mt,Ut,Tt,ft,pt){var rt=mt[pt][Tt],dr=Ut[Tt]/rt,$t=Math.sign(dr)!==Math.sign(ft[pt])&&0!==ft[pt]&&Math.abs(dr)<=1?function Ls(mt){return mt<0?Math.floor(mt):Math.ceil(mt)}(dr):Math.trunc(dr);ft[pt]+=$t,Ut[Tt]-=$t*rt}var da=function(){function mt(Tt){var ft="longterm"===Tt.conversionAccuracy||!1;this.values=Tt.values,this.loc=Tt.loc||Bn.create(),this.conversionAccuracy=ft?"longterm":"casual",this.invalid=Tt.invalid||null,this.matrix=ft?ol:Ai,this.isLuxonDuration=!0}mt.fromMillis=function(ft,pt){return mt.fromObject({milliseconds:ft},pt)},mt.fromObject=function(ft,pt){if(void 0===pt&&(pt={}),null==ft||"object"!=typeof ft)throw new $("Duration.fromObject: argument expected to be an object, got "+(null===ft?"null":typeof ft));return new mt({values:jt(ft,mt.normalizeUnit),loc:Bn.fromObject(pt),conversionAccuracy:pt.conversionAccuracy})},mt.fromDurationLike=function(ft){if(Fe(ft))return mt.fromMillis(ft);if(mt.isDuration(ft))return ft;if("object"==typeof ft)return mt.fromObject(ft);throw new $("Unknown duration argument "+ft+" of type "+typeof ft)},mt.fromISO=function(ft,pt){var rt=function Vi(mt){return Vn(mt,[kt,ur])}(ft),dr=rt[0];return dr?mt.fromObject(dr,pt):mt.invalid("unparsable",'the input "'+ft+"\" can't be parsed as ISO 8601")},mt.fromISOTime=function(ft,pt){var rt=function Go(mt){return Vn(mt,[Ht,yn])}(ft),dr=rt[0];return dr?mt.fromObject(dr,pt):mt.invalid("unparsable",'the input "'+ft+"\" can't be parsed as ISO 8601")},mt.invalid=function(ft,pt){if(void 0===pt&&(pt=null),!ft)throw new $("need to specify a reason the Duration is invalid");var rt=ft instanceof Qr?ft:new Qr(ft,pt);if(ss.throwOnInvalid)throw new X(rt);return new mt({invalid:rt})},mt.normalizeUnit=function(ft){var pt={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[ft&&ft.toLowerCase()];if(!pt)throw new ee(ft);return pt},mt.isDuration=function(ft){return ft&&ft.isLuxonDuration||!1};var Ut=mt.prototype;return Ut.toFormat=function(ft,pt){void 0===pt&&(pt={});var rt=G({},pt,{floor:!1!==pt.round&&!1!==pt.floor});return this.isValid?wi.create(this.loc,rt).formatDurationFromString(this,ft):"Invalid Duration"},Ut.toHuman=function(ft){var pt=this;void 0===ft&&(ft={});var rt=Pn.map(function(dr){var wr=pt.values[dr];return De(wr)?null:pt.loc.numberFormatter(G({style:"unit",unitDisplay:"long"},ft,{unit:dr.slice(0,-1)})).format(wr)}).filter(function(dr){return dr});return this.loc.listFormatter(G({type:"conjunction",style:ft.listStyle||"narrow"},ft)).format(rt)},Ut.toObject=function(){return this.isValid?G({},this.values):{}},Ut.toISO=function(){if(!this.isValid)return null;var ft="P";return 0!==this.years&&(ft+=this.years+"Y"),(0!==this.months||0!==this.quarters)&&(ft+=this.months+3*this.quarters+"M"),0!==this.weeks&&(ft+=this.weeks+"W"),0!==this.days&&(ft+=this.days+"D"),(0!==this.hours||0!==this.minutes||0!==this.seconds||0!==this.milliseconds)&&(ft+="T"),0!==this.hours&&(ft+=this.hours+"H"),0!==this.minutes&&(ft+=this.minutes+"M"),(0!==this.seconds||0!==this.milliseconds)&&(ft+=Rt(this.seconds+this.milliseconds/1e3,3)+"S"),"P"===ft&&(ft+="T0S"),ft},Ut.toISOTime=function(ft){if(void 0===ft&&(ft={}),!this.isValid)return null;var pt=this.toMillis();if(pt<0||pt>=864e5)return null;ft=G({suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended"},ft);var rt=this.shiftTo("hours","minutes","seconds","milliseconds"),dr="basic"===ft.format?"hhmm":"hh:mm";(!ft.suppressSeconds||0!==rt.seconds||0!==rt.milliseconds)&&(dr+="basic"===ft.format?"ss":":ss",(!ft.suppressMilliseconds||0!==rt.milliseconds)&&(dr+=".SSS"));var wr=rt.toFormat(dr);return ft.includePrefix&&(wr="T"+wr),wr},Ut.toJSON=function(){return this.toISO()},Ut.toString=function(){return this.toISO()},Ut.toMillis=function(){return this.as("milliseconds")},Ut.valueOf=function(){return this.toMillis()},Ut.plus=function(ft){if(!this.isValid)return this;for(var wr,pt=mt.fromDurationLike(ft),rt={},dr=oe(Pn);!(wr=dr()).done;){var $t=wr.value;(et(pt.values,$t)||et(this.values,$t))&&(rt[$t]=pt.get($t)+this.get($t))}return Fl(this,{values:rt},!0)},Ut.minus=function(ft){if(!this.isValid)return this;var pt=mt.fromDurationLike(ft);return this.plus(pt.negate())},Ut.mapUnits=function(ft){if(!this.isValid)return this;for(var pt={},rt=0,dr=Object.keys(this.values);rt<dr.length;rt++){var wr=dr[rt];pt[wr]=ct(ft(this.values[wr],wr))}return Fl(this,{values:pt},!0)},Ut.get=function(ft){return this[mt.normalizeUnit(ft)]},Ut.set=function(ft){return this.isValid?Fl(this,{values:G({},this.values,jt(ft,mt.normalizeUnit))}):this},Ut.reconfigure=function(ft){var pt=void 0===ft?{}:ft,wr=pt.conversionAccuracy,Or={loc:this.loc.clone({locale:pt.locale,numberingSystem:pt.numberingSystem})};return wr&&(Or.conversionAccuracy=wr),Fl(this,Or)},Ut.as=function(ft){return this.isValid?this.shiftTo(ft).get(ft):NaN},Ut.normalize=function(){if(!this.isValid)return this;var ft=this.toObject();return function al(mt,Ut){o0.reduce(function(Tt,ft){return De(Ut[ft])?Tt:(Tt&&xn(mt,Ut,Tt,Ut,ft),ft)},null)}(this.matrix,ft),Fl(this,{values:ft},!0)},Ut.shiftTo=function(){for(var ft=arguments.length,pt=new Array(ft),rt=0;rt<ft;rt++)pt[rt]=arguments[rt];if(!this.isValid)return this;if(0===pt.length)return this;pt=pt.map(function(po){return mt.normalizeUnit(po)});for(var Or,ci,dr={},wr={},$t=this.toObject(),fi=oe(Pn);!(ci=fi()).done;){var qr=ci.value;if(pt.indexOf(qr)>=0){Or=qr;var _s=0;for(var $s in wr)_s+=this.matrix[$s][qr]*wr[$s],wr[$s]=0;Fe($t[qr])&&(_s+=$t[qr]);var Ri=Math.trunc(_s);for(var Ws in dr[qr]=Ri,wr[qr]=(1e3*_s-1e3*Ri)/1e3,$t)Pn.indexOf(Ws)>Pn.indexOf(qr)&&xn(this.matrix,$t,Ws,dr,qr)}else Fe($t[qr])&&(wr[qr]=$t[qr])}for(var Vs in wr)0!==wr[Vs]&&(dr[Or]+=Vs===Or?wr[Vs]:wr[Vs]/this.matrix[Or][Vs]);return Fl(this,{values:dr},!0).normalize()},Ut.negate=function(){if(!this.isValid)return this;for(var ft={},pt=0,rt=Object.keys(this.values);pt<rt.length;pt++){var dr=rt[pt];ft[dr]=0===this.values[dr]?0:-this.values[dr]}return Fl(this,{values:ft},!0)},Ut.equals=function(ft){if(!this.isValid||!ft.isValid||!this.loc.equals(ft.loc))return!1;for(var dr,rt=oe(Pn);!(dr=rt()).done;){var wr=dr.value;if(Or=ft.values[wr],!(void 0===($t=this.values[wr])||0===$t?void 0===Or||0===Or:$t===Or))return!1}var $t,Or;return!0},A(mt,[{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"years",get:function(){return this.isValid?this.values.years||0:NaN}},{key:"quarters",get:function(){return this.isValid?this.values.quarters||0:NaN}},{key:"months",get:function(){return this.isValid?this.values.months||0:NaN}},{key:"weeks",get:function(){return this.isValid?this.values.weeks||0:NaN}},{key:"days",get:function(){return this.isValid?this.values.days||0:NaN}},{key:"hours",get:function(){return this.isValid?this.values.hours||0:NaN}},{key:"minutes",get:function(){return this.isValid?this.values.minutes||0:NaN}},{key:"seconds",get:function(){return this.isValid?this.values.seconds||0:NaN}},{key:"milliseconds",get:function(){return this.isValid?this.values.milliseconds||0:NaN}},{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),mt}(),Xa="Invalid Interval",zi=function(){function mt(Tt){this.s=Tt.start,this.e=Tt.end,this.invalid=Tt.invalid||null,this.isLuxonInterval=!0}mt.invalid=function(ft,pt){if(void 0===pt&&(pt=null),!ft)throw new $("need to specify a reason the Interval is invalid");var rt=ft instanceof Qr?ft:new Qr(ft,pt);if(ss.throwOnInvalid)throw new j(rt);return new mt({invalid:rt})},mt.fromDateTimes=function(ft,pt){var rt=Ra(ft),dr=Ra(pt),wr=function pn(mt,Ut){return mt&&mt.isValid?Ut&&Ut.isValid?Ut<mt?zi.invalid("end before start","The end of an interval must be after its start, but you had start="+mt.toISO()+" and end="+Ut.toISO()):null:zi.invalid("missing or invalid end"):zi.invalid("missing or invalid start")}(rt,dr);return null==wr?new mt({start:rt,end:dr}):wr},mt.after=function(ft,pt){var rt=da.fromDurationLike(pt),dr=Ra(ft);return mt.fromDateTimes(dr,dr.plus(rt))},mt.before=function(ft,pt){var rt=da.fromDurationLike(pt),dr=Ra(ft);return mt.fromDateTimes(dr.minus(rt),dr)},mt.fromISO=function(ft,pt){var rt=(ft||"").split("/",2),dr=rt[0],wr=rt[1];if(dr&&wr){var $t,Or,fi,ci;try{Or=($t=Bo.fromISO(dr,pt)).isValid}catch($s){Or=!1}try{ci=(fi=Bo.fromISO(wr,pt)).isValid}catch($s){ci=!1}if(Or&&ci)return mt.fromDateTimes($t,fi);if(Or){var qr=da.fromISO(wr,pt);if(qr.isValid)return mt.after($t,qr)}else if(ci){var _s=da.fromISO(dr,pt);if(_s.isValid)return mt.before(fi,_s)}}return mt.invalid("unparsable",'the input "'+ft+"\" can't be parsed as ISO 8601")},mt.isInterval=function(ft){return ft&&ft.isLuxonInterval||!1};var Ut=mt.prototype;return Ut.length=function(ft){return void 0===ft&&(ft="milliseconds"),this.isValid?this.toDuration.apply(this,[ft]).get(ft):NaN},Ut.count=function(ft){if(void 0===ft&&(ft="milliseconds"),!this.isValid)return NaN;var pt=this.start.startOf(ft),rt=this.end.startOf(ft);return Math.floor(rt.diff(pt,ft).get(ft))+1},Ut.hasSame=function(ft){return!!this.isValid&&(this.isEmpty()||this.e.minus(1).hasSame(this.s,ft))},Ut.isEmpty=function(){return this.s.valueOf()===this.e.valueOf()},Ut.isAfter=function(ft){return!!this.isValid&&this.s>ft},Ut.isBefore=function(ft){return!!this.isValid&&this.e<=ft},Ut.contains=function(ft){return!!this.isValid&&this.s<=ft&&this.e>ft},Ut.set=function(ft){var pt=void 0===ft?{}:ft;return this.isValid?mt.fromDateTimes(pt.start||this.s,pt.end||this.e):this},Ut.splitAt=function(){var ft=this;if(!this.isValid)return[];for(var pt=arguments.length,rt=new Array(pt),dr=0;dr<pt;dr++)rt[dr]=arguments[dr];for(var wr=rt.map(Ra).filter(function(_s){return ft.contains(_s)}).sort(),$t=[],Or=this.s,fi=0;Or<this.e;){var ci=wr[fi]||this.e,qr=+ci>+this.e?this.e:ci;$t.push(mt.fromDateTimes(Or,qr)),Or=qr,fi+=1}return $t},Ut.splitBy=function(ft){var pt=da.fromDurationLike(ft);if(!this.isValid||!pt.isValid||0===pt.as("milliseconds"))return[];for(var wr,rt=this.s,dr=1,$t=[];rt<this.e;){var Or=this.start.plus(pt.mapUnits(function(fi){return fi*dr}));$t.push(mt.fromDateTimes(rt,wr=+Or>+this.e?this.e:Or)),rt=wr,dr+=1}return $t},Ut.divideEqually=function(ft){return this.isValid?this.splitBy(this.length()/ft).slice(0,ft):[]},Ut.overlaps=function(ft){return this.e>ft.s&&this.s<ft.e},Ut.abutsStart=function(ft){return!!this.isValid&&+this.e==+ft.s},Ut.abutsEnd=function(ft){return!!this.isValid&&+ft.e==+this.s},Ut.engulfs=function(ft){return!!this.isValid&&this.s<=ft.s&&this.e>=ft.e},Ut.equals=function(ft){return!(!this.isValid||!ft.isValid)&&this.s.equals(ft.s)&&this.e.equals(ft.e)},Ut.intersection=function(ft){if(!this.isValid)return this;var pt=this.s>ft.s?this.s:ft.s,rt=this.e<ft.e?this.e:ft.e;return pt>=rt?null:mt.fromDateTimes(pt,rt)},Ut.union=function(ft){return this.isValid?mt.fromDateTimes(this.s<ft.s?this.s:ft.s,this.e>ft.e?this.e:ft.e):this},mt.merge=function(ft){var pt=ft.sort(function(wr,$t){return wr.s-$t.s}).reduce(function(wr,$t){var Or=wr[0],fi=wr[1];return fi?fi.overlaps($t)||fi.abutsStart($t)?[Or,fi.union($t)]:[Or.concat([fi]),$t]:[Or,$t]},[[],null]),rt=pt[0],dr=pt[1];return dr&&rt.push(dr),rt},mt.xor=function(ft){for(var pt,qr,rt=null,dr=0,wr=[],$t=ft.map(function($s){return[{time:$s.s,type:"s"},{time:$s.e,type:"e"}]}),ci=oe((pt=Array.prototype).concat.apply(pt,$t).sort(function($s,Ri){return $s.time-Ri.time}));!(qr=ci()).done;){var _s=qr.value;1===(dr+="s"===_s.type?1:-1)?rt=_s.time:(rt&&+rt!=+_s.time&&wr.push(mt.fromDateTimes(rt,_s.time)),rt=null)}return mt.merge(wr)},Ut.difference=function(){for(var ft=this,pt=arguments.length,rt=new Array(pt),dr=0;dr<pt;dr++)rt[dr]=arguments[dr];return mt.xor([this].concat(rt)).map(function(wr){return ft.intersection(wr)}).filter(function(wr){return wr&&!wr.isEmpty()})},Ut.toString=function(){return this.isValid?"["+this.s.toISO()+" \u2013 "+this.e.toISO()+")":Xa},Ut.toISO=function(ft){return this.isValid?this.s.toISO(ft)+"/"+this.e.toISO(ft):Xa},Ut.toISODate=function(){return this.isValid?this.s.toISODate()+"/"+this.e.toISODate():Xa},Ut.toISOTime=function(ft){return this.isValid?this.s.toISOTime(ft)+"/"+this.e.toISOTime(ft):Xa},Ut.toFormat=function(ft,pt){var dr=(void 0===pt?{}:pt).separator,wr=void 0===dr?" \u2013 ":dr;return this.isValid?""+this.s.toFormat(ft)+wr+this.e.toFormat(ft):Xa},Ut.toDuration=function(ft,pt){return this.isValid?this.e.diff(this.s,ft,pt):da.invalid(this.invalidReason)},Ut.mapEndpoints=function(ft){return mt.fromDateTimes(ft(this.s),ft(this.e))},A(mt,[{key:"start",get:function(){return this.isValid?this.s:null}},{key:"end",get:function(){return this.isValid?this.e:null}},{key:"isValid",get:function(){return null===this.invalidReason}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}}]),mt}(),nt=function(){function mt(){}return mt.hasDST=function(Tt){void 0===Tt&&(Tt=ss.defaultZone);var ft=Bo.now().setZone(Tt).set({month:12});return!Tt.isUniversal&&ft.offset!==ft.set({month:6}).offset},mt.isValidIANAZone=function(Tt){return zr.isValidZone(Tt)},mt.normalizeZone=function(Tt){return ds(Tt,ss.defaultZone)},mt.months=function(Tt,ft){void 0===Tt&&(Tt="long");var pt=void 0===ft?{}:ft,rt=pt.locale,wr=pt.numberingSystem,Or=pt.locObj,ci=pt.outputCalendar;return((void 0===Or?null:Or)||Bn.create(void 0===rt?null:rt,void 0===wr?null:wr,void 0===ci?"gregory":ci)).months(Tt)},mt.monthsFormat=function(Tt,ft){void 0===Tt&&(Tt="long");var pt=void 0===ft?{}:ft,rt=pt.locale,wr=pt.numberingSystem,Or=pt.locObj,ci=pt.outputCalendar;return((void 0===Or?null:Or)||Bn.create(void 0===rt?null:rt,void 0===wr?null:wr,void 0===ci?"gregory":ci)).months(Tt,!0)},mt.weekdays=function(Tt,ft){void 0===Tt&&(Tt="long");var pt=void 0===ft?{}:ft,rt=pt.locale,wr=pt.numberingSystem,Or=pt.locObj;return((void 0===Or?null:Or)||Bn.create(void 0===rt?null:rt,void 0===wr?null:wr,null)).weekdays(Tt)},mt.weekdaysFormat=function(Tt,ft){void 0===Tt&&(Tt="long");var pt=void 0===ft?{}:ft,rt=pt.locale,wr=pt.numberingSystem,Or=pt.locObj;return((void 0===Or?null:Or)||Bn.create(void 0===rt?null:rt,void 0===wr?null:wr,null)).weekdays(Tt,!0)},mt.meridiems=function(Tt){var pt=(void 0===Tt?{}:Tt).locale;return Bn.create(void 0===pt?null:pt).meridiems()},mt.eras=function(Tt,ft){void 0===Tt&&(Tt="short");var rt=(void 0===ft?{}:ft).locale;return Bn.create(void 0===rt?null:rt,null,"gregory").eras(Tt)},mt.features=function(){return{relative:be()}},mt}();function Ro(mt,Ut){var Tt=function(rt){return rt.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()},ft=Tt(Ut)-Tt(mt);return Math.floor(da.fromMillis(ft).as("days"))}var Cl={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",tibt:"[\u0f20-\u0f29]",latn:"\\d"},Jo={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},a0=Cl.hanidec.replace(/[\[|\]]/g,"").split("");function za(mt,Ut){return void 0===Ut&&(Ut=""),new RegExp(""+Cl[mt.numberingSystem||"latn"]+Ut)}function zn(mt,Ut){return void 0===Ut&&(Ut=function(ft){return ft}),{regex:mt,deser:function(ft){return Ut(function vc(mt){var Ut=parseInt(mt,10);if(isNaN(Ut)){Ut="";for(var Tt=0;Tt<mt.length;Tt++){var ft=mt.charCodeAt(Tt);if(-1!==mt[Tt].search(Cl.hanidec))Ut+=a0.indexOf(mt[Tt]);else for(var pt in Jo){var rt=Jo[pt],dr=rt[0];ft>=dr&&ft<=rt[1]&&(Ut+=ft-dr)}}return parseInt(Ut,10)}return Ut}(ft[0]))}}}var lu="[ "+String.fromCharCode(160)+"]",ha=new RegExp(lu,"g");function Xo(mt){return mt.replace(/\./g,"\\.?").replace(ha,lu)}function Wd(mt){return mt.replace(/\./g,"").replace(ha," ").toLowerCase()}function Sa(mt,Ut){return null===mt?null:{regex:RegExp(mt.map(Xo).join("|")),deser:function(ft){var pt=ft[0];return mt.findIndex(function(rt){return Wd(pt)===Wd(rt)})+Ut}}}function Bi(mt,Ut){return{regex:mt,deser:function(ft){return Lr(ft[1],ft[2])},groups:Ut}}function Bc(mt){return{regex:mt,deser:function(Tt){return Tt[0]}}}function sa(mt){return mt.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var Ga={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}},Nc=null;function jc(mt,Ut,Tt){var ft=function Qo(mt,Ut){var Tt;return(Tt=Array.prototype).concat.apply(Tt,mt.map(function(ft){return function Ch(mt,Ut){if(mt.literal)return mt;var Tt=wi.macroTokenToFormatOpts(mt.val);if(!Tt)return mt;var rt=wi.create(Ut,Tt).formatDateTimeParts(function bh(){return Nc||(Nc=Bo.fromMillis(1555555555555)),Nc}()).map(function(dr){return function Vd(mt,Ut,Tt){var ft=mt.type;if("literal"===ft)return{literal:!0,val:mt.value};var dr=Ga[ft];return"object"==typeof dr&&(dr=dr[Tt[ft]]),dr?{literal:!1,val:dr}:void 0}(dr,0,Tt)});return rt.includes(void 0)?mt:rt}(ft,Ut)}))}(wi.parseFormat(Tt),mt),pt=ft.map(function(Vs){return function lt(mt,Ut){var Tt=za(Ut),ft=za(Ut,"{2}"),pt=za(Ut,"{3}"),rt=za(Ut,"{4}"),dr=za(Ut,"{6}"),wr=za(Ut,"{1,2}"),$t=za(Ut,"{1,3}"),Or=za(Ut,"{1,6}"),fi=za(Ut,"{1,9}"),ci=za(Ut,"{2,4}"),qr=za(Ut,"{4,6}"),_s=function(Vs){return{regex:RegExp(sa(Vs.val)),deser:function(co){return co[0]},literal:!0}},Ri=function(Vs){if(mt.literal)return _s(Vs);switch(Vs.val){case"G":return Sa(Ut.eras("short",!1),0);case"GG":return Sa(Ut.eras("long",!1),0);case"y":return zn(Or);case"yy":case"kk":return zn(ci,Cr);case"yyyy":case"kkkk":return zn(rt);case"yyyyy":return zn(qr);case"yyyyyy":return zn(dr);case"M":case"L":case"d":case"H":case"h":case"m":case"q":case"s":case"W":return zn(wr);case"MM":case"LL":case"dd":case"HH":case"hh":case"mm":case"qq":case"ss":case"WW":return zn(ft);case"MMM":return Sa(Ut.months("short",!0,!1),1);case"MMMM":return Sa(Ut.months("long",!0,!1),1);case"LLL":return Sa(Ut.months("short",!1,!1),1);case"LLLL":return Sa(Ut.months("long",!1,!1),1);case"o":case"S":return zn($t);case"ooo":case"SSS":return zn(pt);case"u":return Bc(fi);case"uu":return Bc(wr);case"uuu":case"E":case"c":return zn(Tt);case"a":return Sa(Ut.meridiems(),0);case"EEE":return Sa(Ut.weekdays("short",!1,!1),1);case"EEEE":return Sa(Ut.weekdays("long",!1,!1),1);case"ccc":return Sa(Ut.weekdays("short",!0,!1),1);case"cccc":return Sa(Ut.weekdays("long",!0,!1),1);case"Z":case"ZZ":return Bi(new RegExp("([+-]"+wr.source+")(?::("+ft.source+"))?"),2);case"ZZZ":return Bi(new RegExp("([+-]"+wr.source+")("+ft.source+")?"),2);case"z":return Bc(/[a-z_+-/]{1,256}?/i);default:return _s(Vs)}}(mt)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};return Ri.token=mt,Ri}(Vs,mt)}),rt=pt.find(function(Vs){return Vs.invalidReason});if(rt)return{input:Ut,tokens:ft,invalidReason:rt.invalidReason};var dr=function Ha(mt){return["^"+mt.map(function(Tt){return Tt.regex}).reduce(function(Tt,ft){return Tt+"("+ft.source+")"},"")+"$",mt]}(pt),$t=dr[1],Or=RegExp(dr[0],"i"),fi=function ll(mt,Ut,Tt){var ft=mt.match(Ut);if(ft){var pt={},rt=1;for(var dr in Tt)if(et(Tt,dr)){var wr=Tt[dr],$t=wr.groups?wr.groups+1:1;!wr.literal&&wr.token&&(pt[wr.token.val[0]]=wr.deser(ft.slice(rt,rt+$t))),rt+=$t}return[ft,pt]}return[ft,{}]}(Ut,Or,$t),ci=fi[0],qr=fi[1],_s=qr?function zd(mt){var ft,Tt=null;return De(mt.z)||(Tt=zr.create(mt.z)),De(mt.Z)||(Tt||(Tt=new hi(mt.Z)),ft=mt.Z),De(mt.q)||(mt.M=3*(mt.q-1)+1),De(mt.h)||(mt.h<12&&1===mt.a?mt.h+=12:12===mt.h&&0===mt.a&&(mt.h=0)),0===mt.G&&mt.y&&(mt.y=-mt.y),De(mt.u)||(mt.S=zt(mt.u)),[Object.keys(mt).reduce(function(rt,dr){var wr=function(dr){switch(dr){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}}(dr);return wr&&(rt[wr]=mt[dr]),rt},{}),Tt,ft]}(qr):[null,null,void 0],$s=_s[0],Ri=_s[1],Ws=_s[2];if(et(qr,"a")&&et(qr,"H"))throw new U("Can't include meridiem when specifying 24-hour format");return{input:Ut,tokens:ft,regex:Or,rawMatches:ci,matches:qr,result:$s,zone:Ri,specificOffset:Ws}}var Mh=[0,31,59,90,120,151,181,212,243,273,304,334],Gd=[0,31,60,91,121,152,182,213,244,274,305,335];function cl(mt,Ut){return new Qr("unit out of range","you specified "+Ut+" (of type "+typeof Ut+") as a "+mt+", which is invalid")}function cp(mt,Ut,Tt){var ft=new Date(Date.UTC(mt,Ut-1,Tt));mt<100&&mt>=0&&ft.setUTCFullYear(ft.getUTCFullYear()-1900);var pt=ft.getUTCDay();return 0===pt?7:pt}function up(mt,Ut,Tt){return Tt+(Ft(mt)?Gd:Mh)[Ut-1]}function hd(mt,Ut){var Tt=Ft(mt)?Gd:Mh,ft=Tt.findIndex(function(rt){return rt<Ut});return{month:ft+1,day:Ut-Tt[ft]}}function Fc(mt){var wr,Ut=mt.year,Tt=mt.month,ft=mt.day,pt=up(Ut,Tt,ft),rt=cp(Ut,Tt,ft),dr=Math.floor((pt-rt+10)/7);return dr<1?dr=Mr(wr=Ut-1):dr>Mr(Ut)?(wr=Ut+1,dr=1):wr=Ut,G({weekYear:wr,weekNumber:dr,weekday:rt},er(mt))}function pd(mt){var wr,Ut=mt.weekYear,Tt=mt.weekNumber,ft=mt.weekday,pt=cp(Ut,1,4),rt=bt(Ut),dr=7*Tt+ft-pt-3;dr<1?dr+=bt(wr=Ut-1):dr>rt?(wr=Ut+1,dr-=bt(Ut)):wr=Ut;var $t=hd(wr,dr);return G({year:wr,month:$t.month,day:$t.day},er(mt))}function fd(mt){var Ut=mt.year;return G({year:Ut,ordinal:up(Ut,mt.month,mt.day)},er(mt))}function rc(mt){var Ut=mt.year,ft=hd(Ut,mt.ordinal);return G({year:Ut,month:ft.month,day:ft.day},er(mt))}function _d(mt){var Ut=ve(mt.year),Tt=ke(mt.month,1,12),ft=ke(mt.day,1,St(mt.year,mt.month));return Ut?Tt?!ft&&cl("day",mt.day):cl("month",mt.month):cl("year",mt.year)}function md(mt){var Ut=mt.hour,Tt=mt.minute,ft=mt.second,pt=mt.millisecond,rt=ke(Ut,0,23)||24===Ut&&0===Tt&&0===ft&&0===pt,dr=ke(Tt,0,59),wr=ke(ft,0,59),$t=ke(pt,0,999);return rt?dr?wr?!$t&&cl("millisecond",pt):cl("second",ft):cl("minute",Tt):cl("hour",Ut)}var Vu="Invalid DateTime",Ao=864e13;function Wc(mt){return new Qr("unsupported zone",'the zone "'+mt.name+'" is not supported')}function cu(mt){return null===mt.weekData&&(mt.weekData=Fc(mt.c)),mt.weekData}function Vc(mt,Ut){var Tt={ts:mt.ts,zone:mt.zone,c:mt.c,o:mt.o,loc:mt.loc,invalid:mt.invalid};return new Bo(G({},Tt,Ut,{old:Tt}))}function ul(mt,Ut,Tt){var ft=mt-60*Ut*1e3,pt=Tt.offset(ft);if(Ut===pt)return[ft,Ut];var rt=Tt.offset(ft-=60*(pt-Ut)*1e3);return pt===rt?[ft,pt]:[mt-60*Math.min(pt,rt)*1e3,Math.max(pt,rt)]}function pa(mt,Ut){var Tt=new Date(mt+=60*Ut*1e3);return{year:Tt.getUTCFullYear(),month:Tt.getUTCMonth()+1,day:Tt.getUTCDate(),hour:Tt.getUTCHours(),minute:Tt.getUTCMinutes(),second:Tt.getUTCSeconds(),millisecond:Tt.getUTCMilliseconds()}}function sc(mt,Ut,Tt){return ul(Xt(mt),Ut,Tt)}function gd(mt,Ut){var Tt=mt.o,ft=mt.c.year+Math.trunc(Ut.years),pt=mt.c.month+Math.trunc(Ut.months)+3*Math.trunc(Ut.quarters),rt=G({},mt.c,{year:ft,month:pt,day:Math.min(mt.c.day,St(ft,pt))+Math.trunc(Ut.days)+7*Math.trunc(Ut.weeks)}),dr=da.fromObject({years:Ut.years-Math.trunc(Ut.years),quarters:Ut.quarters-Math.trunc(Ut.quarters),months:Ut.months-Math.trunc(Ut.months),weeks:Ut.weeks-Math.trunc(Ut.weeks),days:Ut.days-Math.trunc(Ut.days),hours:Ut.hours,minutes:Ut.minutes,seconds:Ut.seconds,milliseconds:Ut.milliseconds}).as("milliseconds"),$t=ul(Xt(rt),Tt,mt.zone),Or=$t[0],fi=$t[1];return 0!==dr&&(fi=mt.zone.offset(Or+=dr)),{ts:Or,o:fi}}function ho(mt,Ut,Tt,ft,pt,rt){var dr=Tt.setZone,wr=Tt.zone;if(mt&&0!==Object.keys(mt).length){var Or=Bo.fromObject(mt,G({},Tt,{zone:Ut||wr,specificOffset:rt}));return dr?Or:Or.setZone(wr)}return Bo.invalid(new Qr("unparsable",'the input "'+pt+"\" can't be parsed as "+ft))}function nc(mt,Ut,Tt){return void 0===Tt&&(Tt=!0),mt.isValid?wi.create(Bn.create("en-US"),{allowZ:Tt,forceSimple:!0}).formatDateTimeFromString(mt,Ut):null}function Hd(mt,Ut){var Tt=mt.c.year>9999||mt.c.year<0,ft="";return Tt&&mt.c.year>=0&&(ft+="+"),ft+=at(mt.c.year,Tt?6:4),Ut?(ft+="-",ft+=at(mt.c.month),ft+="-",ft+=at(mt.c.day)):(ft+=at(mt.c.month),ft+=at(mt.c.day)),ft}function ga(mt,Ut,Tt,ft,pt,rt){var dr=at(mt.c.hour);return Ut?(dr+=":",dr+=at(mt.c.minute),(0!==mt.c.second||!Tt)&&(dr+=":")):dr+=at(mt.c.minute),(0!==mt.c.second||!Tt)&&(dr+=at(mt.c.second),(0!==mt.c.millisecond||!ft)&&(dr+=".",dr+=at(mt.c.millisecond,3))),pt&&(mt.isOffsetFixed&&0===mt.offset&&!rt?dr+="Z":mt.o<0?(dr+="-",dr+=at(Math.trunc(-mt.o/60)),dr+=":",dr+=at(Math.trunc(-mt.o%60))):(dr+="+",dr+=at(Math.trunc(mt.o/60)),dr+=":",dr+=at(Math.trunc(mt.o%60)))),rt&&(dr+="["+mt.zone.ianaName+"]"),dr}var li={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Kd={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},vs={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Qa=["year","month","day","hour","minute","second","millisecond"],qo=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],uu=["year","ordinal","hour","minute","second","millisecond"];function Dn(mt){var Ut={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[mt.toLowerCase()];if(!Ut)throw new ee(mt);return Ut}function Wl(mt,Ut){var rt,dr,Tt=ds(Ut.zone,ss.defaultZone),ft=Bn.fromObject(Ut),pt=ss.now();if(De(mt.year))rt=pt;else{for(var $t,wr=oe(Qa);!($t=wr()).done;){var Or=$t.value;De(mt[Or])&&(mt[Or]=li[Or])}var fi=_d(mt)||md(mt);if(fi)return Bo.invalid(fi);var qr=sc(mt,Tt.offset(pt),Tt);rt=qr[0],dr=qr[1]}return new Bo({ts:rt,zone:Tt,loc:ft,o:dr})}function du(mt,Ut,Tt){var ft=!!De(Tt.round)||Tt.round,pt=function(ci,qr){return ci=Rt(ci,ft||Tt.calendary?0:2,!0),Ut.loc.clone(Tt).relFormatter(Tt).format(ci,qr)},rt=function(ci){return Tt.calendary?Ut.hasSame(mt,ci)?0:Ut.startOf(ci).diff(mt.startOf(ci),ci).get(ci):Ut.diff(mt,ci).get(ci)};if(Tt.unit)return pt(rt(Tt.unit),Tt.unit);for(var wr,dr=oe(Tt.units);!(wr=dr()).done;){var $t=wr.value,Or=rt($t);if(Math.abs(Or)>=1)return pt(Or,$t)}return pt(mt>Ut?-0:0,Tt.units[Tt.units.length-1])}function oc(mt){var Tt,Ut={};return mt.length>0&&"object"==typeof mt[mt.length-1]?(Ut=mt[mt.length-1],Tt=Array.from(mt).slice(0,mt.length-1)):Tt=Array.from(mt),[Ut,Tt]}var Bo=function(){function mt(Tt){var ft=Tt.zone||ss.defaultZone,pt=Tt.invalid||(Number.isNaN(Tt.ts)?new Qr("invalid input"):null)||(ft.isValid?null:Wc(ft));this.ts=De(Tt.ts)?ss.now():Tt.ts;var rt=null,dr=null;if(!pt)if(Tt.old&&Tt.old.ts===this.ts&&Tt.old.zone.equals(ft)){var $t=[Tt.old.c,Tt.old.o];rt=$t[0],dr=$t[1]}else{var Or=ft.offset(this.ts);rt=pa(this.ts,Or),rt=(pt=Number.isNaN(rt.year)?new Qr("invalid input"):null)?null:rt,dr=pt?null:Or}this._zone=ft,this.loc=Tt.loc||Bn.create(),this.invalid=pt,this.weekData=null,this.c=rt,this.o=dr,this.isLuxonDateTime=!0}mt.now=function(){return new mt({})},mt.local=function(){var ft=oc(arguments),pt=ft[0],rt=ft[1],dr=rt[0],wr=rt[1],$t=rt[2],Or=rt[3],fi=rt[4],ci=rt[5],qr=rt[6];return Wl({year:dr,month:wr,day:$t,hour:Or,minute:fi,second:ci,millisecond:qr},pt)},mt.utc=function(){var ft=oc(arguments),pt=ft[0],rt=ft[1],dr=rt[0],wr=rt[1],$t=rt[2],Or=rt[3],fi=rt[4],ci=rt[5],qr=rt[6];return pt.zone=hi.utcInstance,Wl({year:dr,month:wr,day:$t,hour:Or,minute:fi,second:ci,millisecond:qr},pt)},mt.fromJSDate=function(ft,pt){void 0===pt&&(pt={});var rt=function qe(mt){return"[object Date]"===Object.prototype.toString.call(mt)}(ft)?ft.valueOf():NaN;if(Number.isNaN(rt))return mt.invalid("invalid input");var dr=ds(pt.zone,ss.defaultZone);return dr.isValid?new mt({ts:rt,zone:dr,loc:Bn.fromObject(pt)}):mt.invalid(Wc(dr))},mt.fromMillis=function(ft,pt){if(void 0===pt&&(pt={}),Fe(ft))return ft<-Ao||ft>Ao?mt.invalid("Timestamp out of range"):new mt({ts:ft,zone:ds(pt.zone,ss.defaultZone),loc:Bn.fromObject(pt)});throw new $("fromMillis requires a numerical input, but received a "+typeof ft+" with value "+ft)},mt.fromSeconds=function(ft,pt){if(void 0===pt&&(pt={}),Fe(ft))return new mt({ts:1e3*ft,zone:ds(pt.zone,ss.defaultZone),loc:Bn.fromObject(pt)});throw new $("fromSeconds requires a numerical input")},mt.fromObject=function(ft,pt){void 0===pt&&(pt={}),ft=ft||{};var rt=ds(pt.zone,ss.defaultZone);if(!rt.isValid)return mt.invalid(Wc(rt));var dr=ss.now(),wr=De(pt.specificOffset)?rt.offset(dr):pt.specificOffset,$t=jt(ft,Dn),Or=!De($t.ordinal),fi=!De($t.year),ci=!De($t.month)||!De($t.day),qr=fi||ci,_s=$t.weekYear||$t.weekNumber,$s=Bn.fromObject(pt);if((qr||Or)&&_s)throw new U("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(ci&&Or)throw new U("Can't mix ordinal dates with month/day");var Ws,Vs,Ri=_s||$t.weekday&&!qr,po=pa(dr,wr);Ri?(Ws=qo,Vs=Kd,po=Fc(po)):Or?(Ws=uu,Vs=vs,po=fd(po)):(Ws=Qa,Vs=li);for(var ac,co=!1,cn=oe(Ws);!(ac=cn()).done;){var oo=ac.value;De($t[oo])?$t[oo]=co?Vs[oo]:po[oo]:co=!0}var dp=Ri?function ic(mt){var Ut=ve(mt.weekYear),Tt=ke(mt.weekNumber,1,Mr(mt.weekYear)),ft=ke(mt.weekday,1,7);return Ut?Tt?!ft&&cl("weekday",mt.weekday):cl("week",mt.week):cl("weekYear",mt.weekYear)}($t):Or?function Oh(mt){var Ut=ve(mt.year),Tt=ke(mt.ordinal,1,bt(mt.year));return Ut?!Tt&&cl("ordinal",mt.ordinal):cl("year",mt.year)}($t):_d($t),lc=dp||md($t);if(lc)return mt.invalid(lc);var Ho=sc(Ri?pd($t):Or?rc($t):$t,wr,rt),kd=new mt({ts:Ho[0],zone:rt,o:Ho[1],loc:$s});return $t.weekday&&qr&&ft.weekday!==kd.weekday?mt.invalid("mismatched weekday","you can't specify both a weekday of "+$t.weekday+" and a date of "+kd.toISO()):kd},mt.fromISO=function(ft,pt){void 0===pt&&(pt={});var rt=function ud(mt){return Vn(mt,[fs,hn],[Tn,no],[On,Sn],[rn,Va])}(ft);return ho(rt[0],rt[1],pt,"ISO 8601",ft)},mt.fromRFC2822=function(ft,pt){void 0===pt&&(pt={});var rt=function Nr(mt){return Vn(function At(mt){return mt.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}(mt),[Gr,oi])}(ft);return ho(rt[0],rt[1],pt,"RFC 2822",ft)},mt.fromHTTP=function(ft,pt){void 0===pt&&(pt={});var rt=function Ei(mt){return Vn(mt,[Bt,ai],[vr,ai],[kr,Hi])}(ft);return ho(rt[0],rt[1],pt,"HTTP",pt)},mt.fromFormat=function(ft,pt,rt){if(void 0===rt&&(rt={}),De(ft)||De(pt))throw new $("fromFormat requires an input string and a format");var wr=rt.locale,Or=rt.numberingSystem,qr=function Th(mt,Ut,Tt){var ft=jc(mt,Ut,Tt);return[ft.result,ft.zone,ft.specificOffset,ft.invalidReason]}(Bn.fromOpts({locale:void 0===wr?null:wr,numberingSystem:void 0===Or?null:Or,defaultToEN:!0}),ft,pt),_s=qr[0],$s=qr[1],Ri=qr[2],Ws=qr[3];return Ws?mt.invalid(Ws):ho(_s,$s,rt,"format "+pt,ft,Ri)},mt.fromString=function(ft,pt,rt){return void 0===rt&&(rt={}),mt.fromFormat(ft,pt,rt)},mt.fromSQL=function(ft,pt){void 0===pt&&(pt={});var rt=function Fu(mt){return Vn(mt,[Cn,hn],[Do,El])}(ft);return ho(rt[0],rt[1],pt,"SQL",ft)},mt.invalid=function(ft,pt){if(void 0===pt&&(pt=null),!ft)throw new $("need to specify a reason the DateTime is invalid");var rt=ft instanceof Qr?ft:new Qr(ft,pt);if(ss.throwOnInvalid)throw new Y(rt);return new mt({invalid:rt})},mt.isDateTime=function(ft){return ft&&ft.isLuxonDateTime||!1};var Ut=mt.prototype;return Ut.get=function(ft){return this[ft]},Ut.resolvedLocaleOptions=function(ft){void 0===ft&&(ft={});var pt=wi.create(this.loc.clone(ft),ft).resolvedOptions(this);return{locale:pt.locale,numberingSystem:pt.numberingSystem,outputCalendar:pt.calendar}},Ut.toUTC=function(ft,pt){return void 0===ft&&(ft=0),void 0===pt&&(pt={}),this.setZone(hi.instance(ft),pt)},Ut.toLocal=function(){return this.setZone(ss.defaultZone)},Ut.setZone=function(ft,pt){var rt=void 0===pt?{}:pt,dr=rt.keepLocalTime,wr=void 0!==dr&&dr,$t=rt.keepCalendarTime,Or=void 0!==$t&&$t;if((ft=ds(ft,ss.defaultZone)).equals(this.zone))return this;if(ft.isValid){var fi=this.ts;if(wr||Or){var ci=ft.offset(this.ts);fi=sc(this.toObject(),ci,ft)[0]}return Vc(this,{ts:fi,zone:ft})}return mt.invalid(Wc(ft))},Ut.reconfigure=function(ft){var pt=void 0===ft?{}:ft;return Vc(this,{loc:this.loc.clone({locale:pt.locale,numberingSystem:pt.numberingSystem,outputCalendar:pt.outputCalendar})})},Ut.setLocale=function(ft){return this.reconfigure({locale:ft})},Ut.set=function(ft){if(!this.isValid)return this;var ci,pt=jt(ft,Dn),rt=!De(pt.weekYear)||!De(pt.weekNumber)||!De(pt.weekday),dr=!De(pt.ordinal),wr=!De(pt.year),$t=!De(pt.month)||!De(pt.day);if((wr||$t||dr)&&(pt.weekYear||pt.weekNumber))throw new U("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if($t&&dr)throw new U("Can't mix ordinal dates with month/day");rt?ci=pd(G({},Fc(this.c),pt)):De(pt.ordinal)?(ci=G({},this.toObject(),pt),De(pt.day)&&(ci.day=Math.min(St(ci.year,ci.month),ci.day))):ci=rc(G({},fd(this.c),pt));var qr=sc(ci,this.o,this.zone);return Vc(this,{ts:qr[0],o:qr[1]})},Ut.plus=function(ft){return this.isValid?Vc(this,gd(this,da.fromDurationLike(ft))):this},Ut.minus=function(ft){return this.isValid?Vc(this,gd(this,da.fromDurationLike(ft).negate())):this},Ut.startOf=function(ft){if(!this.isValid)return this;var pt={},rt=da.normalizeUnit(ft);switch(rt){case"years":pt.month=1;case"quarters":case"months":pt.day=1;case"weeks":case"days":pt.hour=0;case"hours":pt.minute=0;case"minutes":pt.second=0;case"seconds":pt.millisecond=0}if("weeks"===rt&&(pt.weekday=1),"quarters"===rt){var dr=Math.ceil(this.month/3);pt.month=3*(dr-1)+1}return this.set(pt)},Ut.endOf=function(ft){var pt;return this.isValid?this.plus((pt={},pt[ft]=1,pt)).startOf(ft).minus(1):this},Ut.toFormat=function(ft,pt){return void 0===pt&&(pt={}),this.isValid?wi.create(this.loc.redefaultToEN(pt)).formatDateTimeFromString(this,ft):Vu},Ut.toLocaleString=function(ft,pt){return void 0===ft&&(ft=_e),void 0===pt&&(pt={}),this.isValid?wi.create(this.loc.clone(pt),ft).formatDateTime(this):Vu},Ut.toLocaleParts=function(ft){return void 0===ft&&(ft={}),this.isValid?wi.create(this.loc.clone(ft),ft).formatDateTimeParts(this):[]},Ut.toISO=function(ft){var pt=void 0===ft?{}:ft,rt=pt.format,wr=pt.suppressSeconds,$t=void 0!==wr&&wr,Or=pt.suppressMilliseconds,fi=void 0!==Or&&Or,ci=pt.includeOffset,qr=void 0===ci||ci,_s=pt.extendedZone,$s=void 0!==_s&&_s;if(!this.isValid)return null;var Ri="extended"===(void 0===rt?"extended":rt),Ws=Hd(this,Ri);return(Ws+="T")+ga(this,Ri,$t,fi,qr,$s)},Ut.toISODate=function(ft){var rt=(void 0===ft?{}:ft).format;return this.isValid?Hd(this,"extended"===(void 0===rt?"extended":rt)):null},Ut.toISOWeekDate=function(){return nc(this,"kkkk-'W'WW-c")},Ut.toISOTime=function(ft){var pt=void 0===ft?{}:ft,rt=pt.suppressMilliseconds,wr=pt.suppressSeconds,Or=pt.includeOffset,ci=pt.includePrefix,_s=pt.extendedZone,Ri=pt.format;return this.isValid?(void 0!==ci&&ci?"T":"")+ga(this,"extended"===(void 0===Ri?"extended":Ri),void 0!==wr&&wr,void 0!==rt&&rt,void 0===Or||Or,void 0!==_s&&_s):null},Ut.toRFC2822=function(){return nc(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)},Ut.toHTTP=function(){return nc(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")},Ut.toSQLDate=function(){return this.isValid?Hd(this,!0):null},Ut.toSQLTime=function(ft){var pt=void 0===ft?{}:ft,rt=pt.includeOffset,dr=void 0===rt||rt,wr=pt.includeZone,$t=void 0!==wr&&wr,Or=pt.includeOffsetSpace,ci="HH:mm:ss.SSS";return($t||dr)&&((void 0===Or||Or)&&(ci+=" "),$t?ci+="z":dr&&(ci+="ZZ")),nc(this,ci,!0)},Ut.toSQL=function(ft){return void 0===ft&&(ft={}),this.isValid?this.toSQLDate()+" "+this.toSQLTime(ft):null},Ut.toString=function(){return this.isValid?this.toISO():Vu},Ut.valueOf=function(){return this.toMillis()},Ut.toMillis=function(){return this.isValid?this.ts:NaN},Ut.toSeconds=function(){return this.isValid?this.ts/1e3:NaN},Ut.toUnixInteger=function(){return this.isValid?Math.floor(this.ts/1e3):NaN},Ut.toJSON=function(){return this.toISO()},Ut.toBSON=function(){return this.toJSDate()},Ut.toObject=function(ft){if(void 0===ft&&(ft={}),!this.isValid)return{};var pt=G({},this.c);return ft.includeConfig&&(pt.outputCalendar=this.outputCalendar,pt.numberingSystem=this.loc.numberingSystem,pt.locale=this.loc.locale),pt},Ut.toJSDate=function(){return new Date(this.isValid?this.ts:NaN)},Ut.diff=function(ft,pt,rt){if(void 0===pt&&(pt="milliseconds"),void 0===rt&&(rt={}),!this.isValid||!ft.isValid)return da.invalid("created by diffing an invalid DateTime");var dr=G({locale:this.locale,numberingSystem:this.numberingSystem},rt),wr=function tt(mt){return Array.isArray(mt)?mt:[mt]}(pt).map(da.normalizeUnit),$t=ft.valueOf()>this.valueOf(),ci=function dd(mt,Ut,Tt,ft){var ci,pt=function ui(mt,Ut,Tt){for(var rt,dr,pt={},wr=0,$t=[["years",function(Ri,Ws){return Ws.year-Ri.year}],["quarters",function(Ri,Ws){return Ws.quarter-Ri.quarter}],["months",function(Ri,Ws){return Ws.month-Ri.month+12*(Ws.year-Ri.year)}],["weeks",function(Ri,Ws){var Vs=Ro(Ri,Ws);return(Vs-Vs%7)/7}],["days",Ro]];wr<$t.length;wr++){var Or=$t[wr],fi=Or[0],ci=Or[1];if(Tt.indexOf(fi)>=0){var qr;rt=fi;var $s,_s=ci(mt,Ut);(dr=mt.plus(((qr={})[fi]=_s,qr)))>Ut?(mt=mt.plus((($s={})[fi]=_s-1,$s)),_s-=1):mt=dr,pt[fi]=_s}}return[mt,pt,dr,rt]}(mt,Ut,Tt),rt=pt[0],dr=pt[1],wr=pt[2],$t=pt[3],Or=Ut-rt,fi=Tt.filter(function($s){return["hours","minutes","seconds","milliseconds"].indexOf($s)>=0});0===fi.length&&(wr<Ut&&(wr=rt.plus(((ci={})[$t]=1,ci))),wr!==rt&&(dr[$t]=(dr[$t]||0)+Or/(wr-rt)));var _s,qr=da.fromObject(dr,ft);return fi.length>0?(_s=da.fromMillis(Or,ft)).shiftTo.apply(_s,fi).plus(qr):qr}($t?this:ft,$t?ft:this,wr,dr);return $t?ci.negate():ci},Ut.diffNow=function(ft,pt){return void 0===ft&&(ft="milliseconds"),void 0===pt&&(pt={}),this.diff(mt.now(),ft,pt)},Ut.until=function(ft){return this.isValid?zi.fromDateTimes(this,ft):this},Ut.hasSame=function(ft,pt){if(!this.isValid)return!1;var rt=ft.valueOf(),dr=this.setZone(ft.zone,{keepLocalTime:!0});return dr.startOf(pt)<=rt&&rt<=dr.endOf(pt)},Ut.equals=function(ft){return this.isValid&&ft.isValid&&this.valueOf()===ft.valueOf()&&this.zone.equals(ft.zone)&&this.loc.equals(ft.loc)},Ut.toRelative=function(ft){if(void 0===ft&&(ft={}),!this.isValid)return null;var pt=ft.base||mt.fromObject({},{zone:this.zone}),rt=ft.padding?this<pt?-ft.padding:ft.padding:0,dr=["years","months","days","hours","minutes","seconds"],wr=ft.unit;return Array.isArray(ft.unit)&&(dr=ft.unit,wr=void 0),du(pt,this.plus(rt),G({},ft,{numeric:"always",units:dr,unit:wr}))},Ut.toRelativeCalendar=function(ft){return void 0===ft&&(ft={}),this.isValid?du(ft.base||mt.fromObject({},{zone:this.zone}),this,G({},ft,{numeric:"auto",units:["years","months","days"],calendary:!0})):null},mt.min=function(){for(var ft=arguments.length,pt=new Array(ft),rt=0;rt<ft;rt++)pt[rt]=arguments[rt];if(!pt.every(mt.isDateTime))throw new $("min requires all arguments be DateTimes");return Ye(pt,function(dr){return dr.valueOf()},Math.min)},mt.max=function(){for(var ft=arguments.length,pt=new Array(ft),rt=0;rt<ft;rt++)pt[rt]=arguments[rt];if(!pt.every(mt.isDateTime))throw new $("max requires all arguments be DateTimes");return Ye(pt,function(dr){return dr.valueOf()},Math.max)},mt.fromFormatExplain=function(ft,pt,rt){void 0===rt&&(rt={});var wr=rt.locale,Or=rt.numberingSystem;return jc(Bn.fromOpts({locale:void 0===wr?null:wr,numberingSystem:void 0===Or?null:Or,defaultToEN:!0}),ft,pt)},mt.fromStringExplain=function(ft,pt,rt){return void 0===rt&&(rt={}),mt.fromFormatExplain(ft,pt,rt)},A(mt,[{key:"isValid",get:function(){return null===this.invalid}},{key:"invalidReason",get:function(){return this.invalid?this.invalid.reason:null}},{key:"invalidExplanation",get:function(){return this.invalid?this.invalid.explanation:null}},{key:"locale",get:function(){return this.isValid?this.loc.locale:null}},{key:"numberingSystem",get:function(){return this.isValid?this.loc.numberingSystem:null}},{key:"outputCalendar",get:function(){return this.isValid?this.loc.outputCalendar:null}},{key:"zone",get:function(){return this._zone}},{key:"zoneName",get:function(){return this.isValid?this.zone.name:null}},{key:"year",get:function(){return this.isValid?this.c.year:NaN}},{key:"quarter",get:function(){return this.isValid?Math.ceil(this.c.month/3):NaN}},{key:"month",get:function(){return this.isValid?this.c.month:NaN}},{key:"day",get:function(){return this.isValid?this.c.day:NaN}},{key:"hour",get:function(){return this.isValid?this.c.hour:NaN}},{key:"minute",get:function(){return this.isValid?this.c.minute:NaN}},{key:"second",get:function(){return this.isValid?this.c.second:NaN}},{key:"millisecond",get:function(){return this.isValid?this.c.millisecond:NaN}},{key:"weekYear",get:function(){return this.isValid?cu(this).weekYear:NaN}},{key:"weekNumber",get:function(){return this.isValid?cu(this).weekNumber:NaN}},{key:"weekday",get:function(){return this.isValid?cu(this).weekday:NaN}},{key:"ordinal",get:function(){return this.isValid?fd(this.c).ordinal:NaN}},{key:"monthShort",get:function(){return this.isValid?nt.months("short",{locObj:this.loc})[this.month-1]:null}},{key:"monthLong",get:function(){return this.isValid?nt.months("long",{locObj:this.loc})[this.month-1]:null}},{key:"weekdayShort",get:function(){return this.isValid?nt.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}},{key:"weekdayLong",get:function(){return this.isValid?nt.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}},{key:"offset",get:function(){return this.isValid?+this.o:NaN}},{key:"offsetNameShort",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}},{key:"offsetNameLong",get:function(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}},{key:"isOffsetFixed",get:function(){return this.isValid?this.zone.isUniversal:null}},{key:"isInDST",get:function(){return!this.isOffsetFixed&&(this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset)}},{key:"isInLeapYear",get:function(){return Ft(this.year)}},{key:"daysInMonth",get:function(){return St(this.year,this.month)}},{key:"daysInYear",get:function(){return this.isValid?bt(this.year):NaN}},{key:"weeksInWeekYear",get:function(){return this.isValid?Mr(this.weekYear):NaN}}],[{key:"DATE_SHORT",get:function(){return _e}},{key:"DATE_MED",get:function(){return pe}},{key:"DATE_MED_WITH_WEEKDAY",get:function(){return he}},{key:"DATE_FULL",get:function(){return ge}},{key:"DATE_HUGE",get:function(){return ye}},{key:"TIME_SIMPLE",get:function(){return Me}},{key:"TIME_WITH_SECONDS",get:function(){return Ee}},{key:"TIME_WITH_SHORT_OFFSET",get:function(){return Te}},{key:"TIME_WITH_LONG_OFFSET",get:function(){return me}},{key:"TIME_24_SIMPLE",get:function(){return Ce}},{key:"TIME_24_WITH_SECONDS",get:function(){return Ie}},{key:"TIME_24_WITH_SHORT_OFFSET",get:function(){return Ge}},{key:"TIME_24_WITH_LONG_OFFSET",get:function(){return Je}},{key:"DATETIME_SHORT",get:function(){return xe}},{key:"DATETIME_SHORT_WITH_SECONDS",get:function(){return je}},{key:"DATETIME_MED",get:function(){return We}},{key:"DATETIME_MED_WITH_SECONDS",get:function(){return Ne}},{key:"DATETIME_MED_WITH_WEEKDAY",get:function(){return we}},{key:"DATETIME_FULL",get:function(){return Oe}},{key:"DATETIME_FULL_WITH_SECONDS",get:function(){return $e}},{key:"DATETIME_HUGE",get:function(){return Be}},{key:"DATETIME_HUGE_WITH_SECONDS",get:function(){return Se}}]),mt}();function Ra(mt){if(Bo.isDateTime(mt))return mt;if(mt&&mt.valueOf&&Fe(mt.valueOf()))return Bo.fromJSDate(mt);if(mt&&"object"==typeof mt)return Bo.fromObject(mt);throw new $("Unknown datetime argument: "+mt+", of type "+typeof mt)}Re.ou=Bo,Re.kI=nt,Re.Xp=zi},41993:dt=>{function Re(T){return Promise.resolve().then(()=>{var x=new Error("Cannot find module '"+T+"'");throw x.code="MODULE_NOT_FOUND",x})}Re.keys=()=>[],Re.resolve=Re,Re.id=41993,dt.exports=Re},73386:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{default:()=>pe});var se,x=T(15861),A=T(17626),G=T(46160),Q=T(89726),H=T(55538),re=T(86810),J=T(58817),W=T(47996),B=T(47877),Z=T(63290),ie=T(62208),ue=T(10699),ce=T(21726),oe=T(77712),Y=(T(90912),T(76898)),j=T(99433),X=T(65234),U=T(84687),ee=T(55463),$=T(33954),ne=T(32584);let ae=0;const de=Z.Z.getLogger("esri.Basemap");let _e=se=class extends((0,re.eC)(W.Z)){constructor(he){super(he),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+ae++,this.baseLayers=new G.Z,this.referenceLayers=new G.Z;const ge=Me=>{Me.parent&&Me.parent!==this&&"remove"in Me.parent&&Me.parent.remove(Me),Me.parent=this,"elevation"===Me.type&&de.error(`Layer '${Me.title}, id:${Me.id}' of type '${Me.type}' is not supported as a basemap layer and will therefore be ignored.`)},ye=Me=>{Me.parent=null};this.baseLayers.on("after-add",Me=>ge(Me.item)),this.referenceLayers.on("after-add",Me=>ge(Me.item)),this.baseLayers.on("after-remove",Me=>ye(Me.item)),this.referenceLayers.on("after-remove",Me=>ye(Me.item))}initialize(){this.when().catch(he=>{de.error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,he)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var ye;const he=this.baseLayers.removeAll();for(const Me of he)Me.destroy();const ge=this.referenceLayers.removeAll();for(const Me of ge)Me.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),null==(ye=this.portalItem)||ye.destroy(),this.portalItem=null}normalizeCtorArgs(he){return he&&"resourceInfo"in he&&(this._set("resourceInfo",he.resourceInfo),delete(he=or({},he)).resourceInfo),he}set baseLayers(he){this._set("baseLayers",(0,Q.Z)(he,this._get("baseLayers")))}_writeBaseLayers(he,ge,ye){const Me=[];he&&(ye=yi(or({},ye),{layerContainerType:"basemap"}),this.baseLayers.forEach(Ee=>{const Te=(0,ne.Nw)(Ee,ye.webmap?ye.webmap.getLayerJSONFromResourceInfo(Ee):null,ye);(0,ie.pC)(Te)&&Me.push(Te)}),this.referenceLayers.forEach(Ee=>{const Te=(0,ne.Nw)(Ee,ye.webmap?ye.webmap.getLayerJSONFromResourceInfo(Ee):null,ye);(0,ie.pC)(Te)&&(Te.isReference=!0,Me.push(Te))})),ge.baseMapLayers=Me}set referenceLayers(he){this._set("referenceLayers",(0,Q.Z)(he,this._get("referenceLayers")))}writeTitle(he,ge){ge.title=he||"Basemap"}load(he){return this.addResolvingPromise(this._loadFromSource(he)),Promise.resolve(this)}loadAll(){return(0,B.G)(this,he=>{he(this.baseLayers,this.referenceLayers)})}clone(){const he={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};return this.loaded&&(he.loadStatus="loaded"),new se({resourceInfo:this.resourceInfo}).set(he)}read(he,ge){this.resourceInfo||this._set("resourceInfo",{data:he,context:ge}),super.read(he,ge)}write(he,ge){return he=he||{},ge&&ge.origin||(ge=or({origin:"web-map"},ge)),super.write(he,ge),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(he.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(ye=>{const Me=(0,J.d9)(ye);return Me.url&&(0,ce.oC)(Me.url)&&(Me.url=`https:${Me.url}`),Me.templateUrl&&(0,ce.oC)(Me.templateUrl)&&(Me.templateUrl=`https:${Me.templateUrl}`),Me})),he}_loadFromSource(he){var ge=this;return(0,x.Z)(function*(){const{resourceInfo:ye,portalItem:Me}=ge;(0,ue.k_)(he);const Ee=[];ye?(Ee.push(ge._loadLayersFromJSON(ye.data,ye.context?ye.context.url:null,he)),ye.data.id&&!ye.data.title&&Ee.push((0,$.g)(ye.data.id).then(Ce=>{Ce&&ge.read({title:Ce},ye.context)}))):Me&&Ee.push(ge._loadFromItem(Me,he)),yield Promise.all(Ee)})()}_loadLayersFromJSON(he,ge,ye){var Me=this;return(0,x.Z)(function*(){const Ee=Me.resourceInfo&&Me.resourceInfo.context,Te=Me.portalItem&&Me.portalItem.portal||Ee&&Ee.portal||null,me=Ee&&"web-scene"===Ee.origin?"web-scene":"web-map",{populateOperationalLayers:Ce}=yield Promise.all([T.e(7534),T.e(1074)]).then(T.bind(T,71074)),Ie=[];if((0,ue.k_)(ye),he.baseMapLayers&&Array.isArray(he.baseMapLayers)){const Ge={context:{origin:me,url:ge,portal:Te,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},Je=Ce(Me.baseLayers,he.baseMapLayers.filter(je=>!je.isReference),Ge);Ie.push(Je);const xe=Ce(Me.referenceLayers,he.baseMapLayers.filter(je=>je.isReference),Ge);Ie.push(xe)}yield(0,ue.as)(Ie)})()}_loadFromItem(he,ge){var ye=this;return(0,x.Z)(function*(){const Me=yield he.load(ge),Ee=yield Me.fetchData("json",ge),Te=(0,ce.mN)(he.itemUrl);return ye._set("resourceInfo",{data:Ee.baseMap,context:{origin:"web-map",portal:he.portal||U.Z.getDefault(),url:Te}}),ye.read(ye.resourceInfo.data,ye.resourceInfo.context),ye.read({spatialReference:Ee.spatialReference},ye.resourceInfo.context),ye.read({title:he.title,thumbnailUrl:he.thumbnailUrl},{origin:"portal-item",portal:he.portal||U.Z.getDefault(),url:Te}),ye._loadLayersFromJSON(ye.resourceInfo.data,Te,ge)})()}static fromId(he){const ge=$.s[he];if(ge){if(ge.deprecated){let ye=null;"dark-gray"===he?ye="dark-gray-vector":"gray"===he?ye="gray-vector":"streets"===he?ye="streets-vector":"topo"===he&&(ye="topo-vector"),(0,H.x9)(de,`The ${he} basemap has entered mature support and is no longer being updated.`,{replacement:ye,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return se.fromJSON(ge)}return null}};(0,A._)([(0,oe.Cb)({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(he,ge,ye,Me){this._writeBaseLayers(he,ge,Me)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:G.Z}},writer(he,ge,ye,Me){this._writeBaseLayers(he,ge,Me)}}}}}})],_e.prototype,"baseLayers",null),(0,A._)([(0,oe.Cb)({type:String,json:{origins:{"web-scene":{write:!0}}}})],_e.prototype,"id",void 0),(0,A._)([(0,oe.Cb)({type:ee.default})],_e.prototype,"portalItem",void 0),(0,A._)([(0,oe.Cb)()],_e.prototype,"referenceLayers",null),(0,A._)([(0,oe.Cb)({readOnly:!0})],_e.prototype,"resourceInfo",void 0),(0,A._)([(0,oe.Cb)({type:X.Z})],_e.prototype,"spatialReference",void 0),(0,A._)([(0,oe.Cb)()],_e.prototype,"thumbnailUrl",void 0),(0,A._)([(0,oe.Cb)({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],_e.prototype,"title",void 0),(0,A._)([(0,j.c)("title")],_e.prototype,"writeTitle",null),_e=se=(0,A._)([(0,Y.j)("esri.Basemap")],_e);const pe=_e},91558:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>W});var B,Z,x=T(20414),A=T(21286),G=T(62208),Q=T(90912);function H(B){return(0,A.uZ)((0,Q.vU)(B),0,255)}function re(B,Z,ie){return B=Number(B),isNaN(B)?ie:B<Z?Z:B>ie?ie:B}class J{constructor(Z){this.r=255,this.g=255,this.b=255,this.a=1,Z&&this.setColor(Z)}static blendColors(Z,ie,ue,ce=new J){return ce.r=Math.round(Z.r+(ie.r-Z.r)*ue),ce.g=Math.round(Z.g+(ie.g-Z.g)*ue),ce.b=Math.round(Z.b+(ie.b-Z.b)*ue),ce.a=Z.a+(ie.a-Z.a)*ue,ce._sanitize()}static fromRgb(Z,ie){const ue=Z.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(ue){const ce=ue[2].split(/\s*,\s*/),oe=ue[1];if("rgb"===oe&&3===ce.length||"rgba"===oe&&4===ce.length){const le=ce[0];if("%"===le.charAt(le.length-1)){const Y=ce.map(j=>2.56*parseFloat(j));return 4===ce.length&&(Y[3]=parseFloat(ce[3])),J.fromArray(Y,ie)}return J.fromArray(ce.map(Y=>parseFloat(Y)),ie)}if("hsl"===oe&&3===ce.length||"hsla"===oe&&4===ce.length)return J.fromArray((0,x.B7)(parseFloat(ce[0]),parseFloat(ce[1])/100,parseFloat(ce[2])/100,parseFloat(ce[3])),ie)}return null}static fromHex(Z,ie=new J){if(4!==Z.length&&7!==Z.length||"#"!==Z[0])return null;const ue=4===Z.length?4:8,ce=(1<<ue)-1;let oe=Number("0x"+Z.substr(1));return isNaN(oe)?null:(["b","g","r"].forEach(le=>{const Y=oe&ce;oe>>=ue,ie[le]=4===ue?17*Y:Y}),ie.a=1,ie)}static fromArray(Z,ie=new J){return ie._set(Number(Z[0]),Number(Z[1]),Number(Z[2]),Number(Z[3])),isNaN(ie.a)&&(ie.a=1),ie._sanitize()}static fromString(Z,ie){const ue=(0,x.St)(Z)?(0,x.h$)(Z):null;return ue&&J.fromArray(ue,ie)||J.fromRgb(Z,ie)||J.fromHex(Z,ie)}static fromJSON(Z){return Z&&new J([Z[0],Z[1],Z[2],Z[3]/255])}static toUnitRGB(Z){return(0,G.pC)(Z)?[Z.r/255,Z.g/255,Z.b/255]:null}static toUnitRGBA(Z){return(0,G.pC)(Z)?[Z.r/255,Z.g/255,Z.b/255,null!=Z.a?Z.a:1]:null}get isBright(){return.299*this.r+.587*this.g+.114*this.b>=127}setColor(Z){var ie,ue,ce,oe;return"string"==typeof Z?J.fromString(Z,this):Array.isArray(Z)?J.fromArray(Z,this):(this._set(null!=(ie=Z.r)?ie:0,null!=(ue=Z.g)?ue:0,null!=(ce=Z.b)?ce:0,null!=(oe=Z.a)?oe:1),Z instanceof J||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const Z=this.r.toString(16),ie=this.g.toString(16),ue=this.b.toString(16);return`#${Z.length<2?"0"+Z:Z}${ie.length<2?"0"+ie:ie}${ue.length<2?"0"+ue:ue}`}toCss(Z=!1){const ie=this.r+", "+this.g+", "+this.b;return Z?`rgba(${ie}, ${this.a})`:`rgb(${ie})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(Z=J.AlphaMode.ALWAYS){const ie=H(this.r),ue=H(this.g),ce=H(this.b);return Z===J.AlphaMode.ALWAYS||1!==this.a?[ie,ue,ce,H(255*this.a)]:[ie,ue,ce]}clone(){return new J(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(Z){return(0,G.pC)(Z)&&Z.r===this.r&&Z.g===this.g&&Z.b===this.b&&Z.a===this.a}_sanitize(){return this.r=Math.round(re(this.r,0,255)),this.g=Math.round(re(this.g,0,255)),this.b=Math.round(re(this.b,0,255)),this.a=re(this.a,0,1),this}_set(Z,ie,ue,ce){this.r=Z,this.g=ie,this.b=ue,this.a=ce}}J.prototype.declaredClass="esri.Color",(Z=(B=J||(J={})).AlphaMode||(B.AlphaMode={}))[Z.ALWAYS=0]="ALWAYS",Z[Z.UNLESS_OPAQUE=1]="UNLESS_OPAQUE";const W=J},88879:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>X});var x=T(17626),A=T(29132),G=T(73281),Q=T(20383),H=T(79608),re=T(86810),J=T(62208),W=T(86236),B=T(77712),ce=(T(85931),T(8314),T(90912),T(76898)),oe=T(91179);function Y(U){if(!(0,J.pC)(U))return null;const ee={};for(const $ in U){const ne=U[$];ne&&(ee[$]=ne.toJSON())}return 0!==Object.keys(ee).length?ee:null}let j=class extends((0,H.J)(re.wq)){constructor(...U){super(...U),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:(0,W.D)(),configurable:!0})}normalizeCtorArgs(U,ee,$,ne){return U&&!U.declaredClass?U:{geometry:U,symbol:ee,attributes:$,popupTemplate:ne}}set aggregateGeometries(U){const ee=this._get("aggregateGeometries");JSON.stringify(ee)!==JSON.stringify(U)&&this._set("aggregateGeometries",U)}set attributes(U){const ee=this._get("attributes");ee!==U&&(this._set("attributes",U),this._notifyLayer("attributes",ee,U))}set geometry(U){const ee=this._get("geometry");ee!==U&&(this._set("geometry",U),this._notifyLayer("geometry",ee,U))}set symbol(U){const ee=this._get("symbol");ee!==U&&(this._set("symbol",U),this._notifyLayer("symbol",ee,U))}set visible(U){const ee=this._get("visible");ee!==U&&(this._set("visible",U),this._notifyLayer("visible",ee,U))}getEffectivePopupTemplate(U=!1){if(this.popupTemplate)return this.popupTemplate;for(const ee of[this.sourceLayer,this.layer])if(ee){if("popupTemplate"in ee&&ee.popupTemplate)return ee.popupTemplate;if(U&&"defaultPopupTemplate"in ee&&(0,J.pC)(ee.defaultPopupTemplate))return ee.defaultPopupTemplate}return null}getAttribute(U){return this.attributes&&this.attributes[U]}setAttribute(U,ee){if(this.attributes){const $=this.getAttribute(U);this.attributes[U]=ee,this._notifyLayer("attributes",$,ee,U)}else this.attributes={[U]:ee},this._notifyLayer("attributes",void 0,ee,U)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:Y(this.aggregateGeometries),geometry:(0,J.pC)(this.geometry)?this.geometry.toJSON():null,symbol:(0,J.pC)(this.symbol)?this.symbol.toJSON():null,attributes:or({},this.attributes),popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(){(0,J.pC)(this.geometry)&&"mesh"===this.geometry.type&&this._notifyLayer("transform",this.geometry.transform,this.geometry.transform)}_notifyLayer(U,ee,$,ne){if(!this.layer||!("graphicChanged"in this.layer))return;const se={graphic:this,property:U,oldValue:ee,newValue:$};"attributes"===U&&(se.attributeName=ne),this.layer.graphicChanged(se)}};(0,x._)([(0,B.Cb)({value:null,json:{read:function le(U){if(!U)return null;const ee={};for(const $ in U){const ne=(0,oe.im)(U[$]);ne&&(ee[$]=ne)}return 0!==Object.keys(ee).length?ee:null}}})],j.prototype,"aggregateGeometries",null),(0,x._)([(0,B.Cb)({value:null})],j.prototype,"attributes",null),(0,x._)([(0,B.Cb)({value:null,types:A.qM,json:{read:oe.im}})],j.prototype,"geometry",null),(0,x._)([(0,B.Cb)({type:Boolean})],j.prototype,"isAggregate",void 0),(0,x._)([(0,B.Cb)({clonable:"reference"})],j.prototype,"layer",void 0),(0,x._)([(0,B.Cb)({type:G.Z})],j.prototype,"popupTemplate",void 0),(0,x._)([(0,B.Cb)({clonable:"reference"})],j.prototype,"sourceLayer",void 0),(0,x._)([(0,B.Cb)({value:null,types:Q.LB})],j.prototype,"symbol",null),(0,x._)([(0,B.Cb)({type:Boolean,value:!0})],j.prototype,"visible",null),j=(0,x._)([(0,ce.j)("esri.Graphic")],j),(j||(j={})).generateUID=W.D;const X=j},73281:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Be});var x=T(15861),A=T(17626),G=T(46160),Q=T(86810),H=T(58817),re=T(63290),J=T(10699),W=T(77712),B=T(66656),Z=T(68653),ie=T(76898),ue=T(99433),ce=T(90912),oe=T(36630),le=T(55664),Y=T(55013),j=T(16615),X=T(82561),U=T(75484),ee=T(64531),$=T(501);const se={base:null,key:"type",typeMap:{attachment:le.Z,media:ee.Z,text:$.Z,expression:X.Z,field:U.Z}};var he,ae=T(38439),de=T(25621);T(85931),T(8314);let ge=he=class extends Q.wq{constructor(Se){super(Se),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new he({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};(0,A._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],ge.prototype,"returnTopmostRaster",void 0),(0,A._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],ge.prototype,"showNoDataRecords",void 0),ge=he=(0,A._)([(0,ie.j)("esri.popup.LayerOptions")],ge);const ye=ge;var Ee,Me=T(51686);let Te=Ee=class extends Q.wq{constructor(Se){super(Se),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new Ee({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?(0,H.d9)(this.orderByFields):null})}};(0,A._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],Te.prototype,"showRelatedRecords",void 0),(0,A._)([(0,W.Cb)({type:[Me.Z],json:{write:!0}})],Te.prototype,"orderByFields",void 0),Te=Ee=(0,A._)([(0,ie.j)("esri.popup.RelatedRecordsInfo")],Te);const me=Te;var xe,Ce=T(65560),Ie=T(59397),Ge=T(48753),Je=T(10671);const je=G.Z.ofType({key:"type",defaultKeyValue:"button",base:Ie.Z,typeMap:{button:Ge.Z,toggle:Je.Z}}),We={base:Y.Z,key:"type",typeMap:{media:ee.Z,custom:j.Z,text:$.Z,attachments:le.Z,fields:U.Z,expression:X.Z}},Ne="esri.PopupTemplate",we=re.Z.getLogger(Ne),Oe=["attachments","fields","media","text","expression"];let $e=xe=class extends Q.wq{constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title="",this.relatedRecordsInfo=null}castContent(Se){return Array.isArray(Se)?Se.map(De=>(0,ce.N7)(We,De)):"string"==typeof Se||"function"==typeof Se||Se instanceof HTMLElement||(0,J.y8)(Se)?Se:(we.error("content error","unsupported content value",{value:Se}),null)}readContent(Se,De){const{popupElements:Fe}=De;return Array.isArray(Fe)&&Fe.length>0?this._readPopupInfoElements(De):this._readPopupInfo(De)}writeContent(Se,De,Fe,ve){"string"!=typeof Se?Array.isArray(Se)&&(De.popupElements=Se.filter(Ke=>Oe.includes(Ke.type)).map(Ke=>Ke&&Ke.toJSON(ve)),De.popupElements.forEach(Ke=>{"attachments"===Ke.type?this._writeAttachmentContent(De):"media"===Ke.type?this._writeMediaContent(Ke,De):"text"===Ke.type&&this._writeTextContent(Ke,De)})):De.description=Se}writeFieldInfos(Se,De,Fe,ve){const{content:Ke}=this,qe=Array.isArray(Ke)?Ke:null;if(Se){const be=qe?qe.filter(Ye=>"fields"===Ye.type):[],tt=be.length&&be.every(Ye=>{var ze;return null==(ze=Ye.fieldInfos)?void 0:ze.length});De.fieldInfos=Se.filter(Boolean).map(Ye=>{const ze=Ye.toJSON(ve);return tt&&(ze.visible=!1),ze})}if(qe)for(const be of qe)"fields"===be.type&&this._writeFieldsContent(be,De)}writeLayerOptions(Se,De,Fe,ve){De[Fe]=!Se||null===Se.showNoDataRecords&&null===Se.returnTopmostRaster?null:Se.toJSON(ve)}writeTitle(Se,De){De.title=Se||""}clone(){const{actions:Se}=this,De=Se?(0,H.d9)(Se.toArray()):[];return new xe({actions:De,content:Array.isArray(this.content)?(0,H.d9)(this.content):this.content,expressionInfos:Array.isArray(this.expressionInfos)?(0,H.d9)(this.expressionInfos):null,fieldInfos:Array.isArray(this.fieldInfos)?(0,H.d9)(this.fieldInfos):null,layerOptions:this.layerOptions?(0,H.d9)(this.layerOptions):null,lastEditInfoEnabled:this.lastEditInfoEnabled,outFields:Array.isArray(this.outFields)?(0,H.d9)(this.outFields):null,overwriteActions:this.overwriteActions,returnGeometry:this.returnGeometry,title:this.title,relatedRecordsInfo:this.relatedRecordsInfo?(0,H.d9)(this.relatedRecordsInfo):null})}collectRequiredFields(Se,De){var Fe=this;return(0,x.Z)(function*(){const ve=Fe.expressionInfos||[];yield Fe._collectExpressionInfoFields(Se,De,[...ve,...Fe._getContentExpressionInfos(Fe.content,ve)]),(0,oe.gd)(Se,De,[...Fe.outFields||[],...Fe._getActionsFields(Fe.actions),...Fe._getTitleFields(Fe.title),...Fe._getContentFields(Fe.content)])})()}getRequiredFields(Se){var De=this;return(0,x.Z)(function*(){const Fe=new Set;return yield De.collectRequiredFields(Fe,Se),[...Fe].sort()})()}_writeFieldsContent(Se,De){if(!Array.isArray(Se.fieldInfos)||!Se.fieldInfos.length)return;const Fe=(0,H.d9)(Se.fieldInfos);Array.isArray(De.fieldInfos)?Fe.forEach(ve=>{const Ke=De.fieldInfos.find(qe=>qe.fieldName.toLowerCase()===ve.fieldName.toLowerCase());Ke?Ke.visible=!0:De.fieldInfos.push(ve)}):De.fieldInfos=Fe}_writeAttachmentContent(Se){Se.showAttachments||(Se.showAttachments=!0)}_writeTextContent(Se,De){!De.description&&Se.text&&(De.description=Se.text)}_writeMediaContent(Se,De){if(!Array.isArray(Se.mediaInfos)||!Se.mediaInfos.length)return;const Fe=(0,H.d9)(Se.mediaInfos);De.mediaInfos=Array.isArray(De.mediaInfos)?[...De.mediaInfos,...Fe]:Fe}_readPopupInfoElements({description:Se,mediaInfos:De,popupElements:Fe}){const ve={description:!1,mediaInfos:!1};return Fe.map(Ke=>"media"===Ke.type?(Ke.mediaInfos||!De||ve.mediaInfos||(Ke.mediaInfos=De,ve.mediaInfos=!0),ee.Z.fromJSON(Ke)):"text"===Ke.type?(Ke.text||!Se||ve.description||(Ke.text=Se,ve.description=!0),$.Z.fromJSON(Ke)):"attachments"===Ke.type?le.Z.fromJSON(Ke):"fields"===Ke.type?U.Z.fromJSON(Ke):"expression"===Ke.type?X.Z.fromJSON(Ke):void 0).filter(Boolean)}_readPopupInfo({description:Se,mediaInfos:De,showAttachments:Fe}){const ve=[];return ve.push(Se?new $.Z({text:Se}):new U.Z),Array.isArray(De)&&De.length&&ve.push(ee.Z.fromJSON({mediaInfos:De})),Fe&&ve.push(le.Z.fromJSON({displayType:"auto"})),ve.length?ve:Se}_getContentElementFields(Se){const De=null==Se?void 0:Se.type;if("attachments"===De)return[...this._extractFieldNames(Se.title),...this._extractFieldNames(Se.description)];if("custom"===De)return Se.outFields||[];if("fields"===De)return[...this._extractFieldNames(Se.title),...this._extractFieldNames(Se.description),...this._getFieldInfoFields(Se.fieldInfos||this.fieldInfos)];if("media"===De){const Fe=Se.mediaInfos||[];return[...this._extractFieldNames(Se.title),...this._extractFieldNames(Se.description),...Fe.reduce((ve,Ke)=>[...ve,...this._getMediaInfoFields(Ke)],[])]}return"text"===De?this._extractFieldNames(Se.text):[]}_getMediaInfoFields(Se){const{caption:De,title:Fe,value:ve}=Se,Ke=ve||{},{fields:qe=[],normalizeField:be,tooltipField:tt,sourceURL:Ye,linkURL:ze}=Ke,et=[...this._extractFieldNames(Fe),...this._extractFieldNames(De),...this._extractFieldNames(Ye),...this._extractFieldNames(ze),...qe];return be&&et.push(be),tt&&et.push(tt),et}_getContentExpressionInfos(Se,De){return Array.isArray(Se)?Se.reduce((Fe,ve)=>[...Fe,..."expression"===ve.type&&ve.expressionInfo?[ve.expressionInfo]:[]],De):[]}_getContentFields(Se){return"string"==typeof Se?this._extractFieldNames(Se):Array.isArray(Se)?Se.reduce((De,Fe)=>[...De,...this._getContentElementFields(Fe)],[]):[]}_collectExpressionInfoFields(Se,De,Fe){return(0,x.Z)(function*(){Fe&&(yield Promise.all(Fe.map(ve=>(0,oe.io)(Se,De,ve.expression))))})()}_getFieldInfoFields(Se){return Se?Se.filter(De=>void 0===De.visible||!!De.visible).map(De=>De.fieldName).filter(De=>!De.includes("relationships/")&&!De.includes("expression/")):[]}_getActionsFields(Se){return Se?Se.toArray().reduce((De,Fe)=>[...De,...this._getActionFields(Fe)],[]):[]}_getActionFields(Se){const{className:De,title:Fe,type:ve}=Se,Ke="button"===ve||"toggle"===ve?Se.image:"";return[...this._extractFieldNames(Fe),...this._extractFieldNames(De),...this._extractFieldNames(Ke)]}_getTitleFields(Se){return"string"==typeof Se?this._extractFieldNames(Se):[]}_extractFieldNames(Se){if(!Se||"string"!=typeof Se)return[];const Fe=Se.match(/{[^}]*}/g);if(!Fe)return[];const ve=/\{(\w+):.+\}/,Ke=Fe.filter(qe=>!(0===qe.indexOf("{relationships/")||0===qe.indexOf("{expression/"))).map(qe=>qe.replace(ve,"{$1}"));return Ke?Ke.map(qe=>qe.slice(1,-1)):[]}};(0,A._)([(0,W.Cb)({type:je})],$e.prototype,"actions",void 0),(0,A._)([(0,W.Cb)()],$e.prototype,"content",void 0),(0,A._)([(0,B.p)("content")],$e.prototype,"castContent",null),(0,A._)([(0,Z.r)("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments"])],$e.prototype,"readContent",null),(0,A._)([(0,ue.c)("content",{popupElements:{type:G.Z.ofType(se)},showAttachments:{type:Boolean},mediaInfos:{type:G.Z.ofType(Ce.V)},description:{type:String}})],$e.prototype,"writeContent",null),(0,A._)([(0,W.Cb)({type:[ae.Z],json:{write:!0}})],$e.prototype,"expressionInfos",void 0),(0,A._)([(0,W.Cb)({type:[de.Z]})],$e.prototype,"fieldInfos",void 0),(0,A._)([(0,ue.c)("fieldInfos")],$e.prototype,"writeFieldInfos",null),(0,A._)([(0,W.Cb)({type:ye})],$e.prototype,"layerOptions",void 0),(0,A._)([(0,ue.c)("layerOptions")],$e.prototype,"writeLayerOptions",null),(0,A._)([(0,W.Cb)({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],$e.prototype,"lastEditInfoEnabled",void 0),(0,A._)([(0,W.Cb)()],$e.prototype,"outFields",void 0),(0,A._)([(0,W.Cb)()],$e.prototype,"overwriteActions",void 0),(0,A._)([(0,W.Cb)()],$e.prototype,"returnGeometry",void 0),(0,A._)([(0,W.Cb)({json:{type:String}})],$e.prototype,"title",void 0),(0,A._)([(0,ue.c)("title")],$e.prototype,"writeTitle",null),(0,A._)([(0,W.Cb)({type:me,json:{write:!0}})],$e.prototype,"relatedRecordsInfo",void 0),$e=xe=(0,A._)([(0,ie.j)(Ne)],$e);const Be=$e},97478:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Y});var ue,x=T(17626),A=T(86810),G=T(62208),Q=T(28170),H=T(77712),B=(T(85931),T(8314),T(90912),T(68653)),Z=T(76898),ie=T(99433);let ce=ue=class extends A.wq{constructor(j){super(j),this.end=null,this.start=null}static get allTime(){return oe}static get empty(){return le}readEnd(j,X){return null!=X.end?new Date(X.end):null}writeEnd(j,X){X.end=j?j.getTime():null}get isAllTime(){return this.equals(ue.allTime)}get isEmpty(){return this.equals(ue.empty)}readStart(j,X){return null!=X.start?new Date(X.start):null}writeStart(j,X){X.start=j?j.getTime():null}clone(){return new ue({end:this.end,start:this.start})}equals(j){if(!j)return!1;const X=(0,G.pC)(this.start)?this.start.getTime():this.start,U=(0,G.pC)(this.end)?this.end.getTime():this.end,ee=(0,G.pC)(j.start)?j.start.getTime():j.start,$=(0,G.pC)(j.end)?j.end.getTime():j.end;return X===ee&&U===$}expandTo(j){if(this.isEmpty||this.isAllTime)return this.clone();const X=(0,G.yw)(this.start,ee=>(0,Q.JE)(ee,j)),U=(0,G.yw)(this.end,ee=>(0,Q.Nm)((0,Q.JE)(ee,j),1,j));return new ue({start:X,end:U})}intersection(j){if(!j)return this.clone();if(this.isEmpty||j.isEmpty)return ue.empty;if(this.isAllTime)return j.clone();if(j.isAllTime)return this.clone();const X=(0,G.R2)(this.start,-1/0,ae=>ae.getTime()),U=(0,G.R2)(this.end,1/0,ae=>ae.getTime()),ee=(0,G.R2)(j.start,-1/0,ae=>ae.getTime()),$=(0,G.R2)(j.end,1/0,ae=>ae.getTime());let ne,se;if(ee>=X&&ee<=U?ne=ee:X>=ee&&X<=$&&(ne=X),U>=ee&&U<=$?se=U:$>=X&&$<=U&&(se=$),!isNaN(ne)&&!isNaN(se)){const ae=new ue;return ae.start=ne===-1/0?null:new Date(ne),ae.end=se===1/0?null:new Date(se),ae}return ue.empty}offset(j,X){if(this.isEmpty||this.isAllTime)return this.clone();const U=new ue,{start:ee,end:$}=this;return(0,G.pC)(ee)&&(U.start=(0,Q.Nm)(ee,j,X)),(0,G.pC)($)&&(U.end=(0,Q.Nm)($,j,X)),U}union(j){if(!j||j.isEmpty)return this.clone();if(this.isEmpty)return j.clone();if(this.isAllTime||j.isAllTime)return oe.clone();const X=(0,G.pC)(this.start)&&(0,G.pC)(j.start)?new Date(Math.min(this.start.getTime(),j.start.getTime())):null,U=(0,G.pC)(this.end)&&(0,G.pC)(j.end)?new Date(Math.max(this.end.getTime(),j.end.getTime())):null;return new ue({start:X,end:U})}};(0,x._)([(0,H.Cb)({type:Date,json:{write:{allowNull:!0}}})],ce.prototype,"end",void 0),(0,x._)([(0,B.r)("end")],ce.prototype,"readEnd",null),(0,x._)([(0,ie.c)("end")],ce.prototype,"writeEnd",null),(0,x._)([(0,H.Cb)({readOnly:!0,json:{read:!1}})],ce.prototype,"isAllTime",null),(0,x._)([(0,H.Cb)({readOnly:!0,json:{read:!1}})],ce.prototype,"isEmpty",null),(0,x._)([(0,H.Cb)({type:Date,json:{write:{allowNull:!0}}})],ce.prototype,"start",void 0),(0,x._)([(0,B.r)("start")],ce.prototype,"readStart",null),(0,x._)([(0,ie.c)("start")],ce.prototype,"writeStart",null),ce=ue=(0,x._)([(0,Z.j)("esri.TimeExtent")],ce);const oe=new ce,le=new ce({start:void 0,end:void 0}),Y=ce},20849:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var Z,x=T(17626),A=T(86810),G=T(28170),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898)),B=T(58926);let ie=Z=class extends A.wq{constructor(ce){super(ce),this.value=0,this.unit="milliseconds"}toMilliseconds(){return(0,G.rJ)(this.value,this.unit,"milliseconds")}clone(){return new Z({value:this.value,unit:this.unit})}};(0,x._)([(0,Q.Cb)({type:Number,json:{write:!0},nonNullable:!0})],ie.prototype,"value",void 0),(0,x._)([(0,Q.Cb)({type:B.v.apiValues,json:{type:B.v.jsonValues,read:B.v.read,write:B.v.write},nonNullable:!0})],ie.prototype,"unit",void 0),ie=Z=(0,x._)([(0,W.j)("esri.TimeInterval")],ie);const ue=ie},7652:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>x});class x{constructor(G,Q){this.definition=null,this.context=null,this.definition=G,this.context=Q}}},98362:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>x});class x{constructor(G=[]){this._elements=G}length(){return this._elements.length}get(G){return this._elements[G]}toArray(){const G=[];for(let Q=0;Q<this.length();Q++)G.push(this.get(Q));return G}}},5371:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>G});var x=T(98362),A=T(26685);class G extends x.Z{constructor(H,re,J,W,B){super(H),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=J,this._hasM=W,this._spRef=re,this._cacheId=B}get(H){if(void 0===this._lazyPath[H]){const re=this._elements[H];if(void 0===re)return;this._lazyPath[H]=new A.Z(re,this._spRef,this._hasZ,this._hasM,this._cacheId,H)}return this._lazyPath[H]}equalityTest(H){return H===this||null!==H&&H instanceof G&&H.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}},26685:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>G});var x=T(98362),A=T(49672);class G extends x.Z{constructor(H,re,J,W,B,Z){super(H),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=re,this._hasZ=J,this._hasM=W,this._cacheId=B,this._partId=Z}get(H){if(void 0===this._lazyPt[H]){const re=this._elements[H];if(void 0===re)return;const J=this._hasZ,W=this._hasM;let B=null;B=J&&!W?new A.Z(re[0],re[1],re[2],void 0,this._spRef):W&&!J?new A.Z(re[0],re[1],void 0,re[2],this._spRef):J&&W?new A.Z(re[0],re[1],re[2],re[3],this._spRef):new A.Z(re[0],re[1],this._spRef),B.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+H.toString(),this._lazyPt[H]=B}return this._lazyPt[H]}equalityTest(H){return H===this||null!==H&&H instanceof G&&H.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}}},77132:(dt,Re,T)=>{"use strict";T.d(Re,{Bj:()=>G,EI:()=>oe,HD:()=>J,JW:()=>H,Lz:()=>Y,Qk:()=>$,SV:()=>le,Sh:()=>re,US:()=>de,dj:()=>Q,hd:()=>_e,hj:()=>B,q2:()=>ne,tI:()=>X,tt:()=>ue,yE:()=>se});var G,Q,pe,x=T(2004),A=T(36255);function H(pe){return A.Z.fromJSON(pe.toJSON())}function re(pe){return pe.toJSON?pe.toJSON():pe}function J(pe){return"string"==typeof pe||pe instanceof String}function B(pe){return"number"==typeof pe}function ie(pe){return pe instanceof Date}function ue(pe,he){return pe===he||!(!ie(pe)||!ie(he))&&pe.getTime()===he.getTime()}function oe(pe){if(void 0===pe)return null;if("number"==typeof pe)return pe;switch(pe.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null}function le(pe){if(null===pe)return null;switch(pe.type){case"polygon":case"multipoint":case"polyline":return pe.extent;case"point":return new x.Z({xmin:pe.x,ymin:pe.y,xmax:pe.x,ymax:pe.y,spatialReference:pe.spatialReference});case"extent":return pe}return null}function Y(pe){if(void 0===pe)return null;if("number"==typeof pe||"number"==typeof pe)return pe;switch(pe.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null}(pe=G||(G={}))[pe.Standardised=0]="Standardised",pe[pe.StandardisedNoInterval=1]="StandardisedNoInterval",pe[pe.SqlServer=2]="SqlServer",pe[pe.Oracle=3]="Oracle",pe[pe.Postgres=4]="Postgres",pe[pe.PGDB=5]="PGDB",pe[pe.FILEGDB=6]="FILEGDB",pe[pe.NotEvaluated=7]="NotEvaluated",function(pe){pe[pe.InFeatureSet=0]="InFeatureSet",pe[pe.NotInFeatureSet=1]="NotInFeatureSet",pe[pe.Unknown=2]="Unknown"}(Q||(Q={}));const X=1e3,$={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},ne={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"},se={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID","global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};function de(pe){return void 0===pe?"":pe=(pe=(pe=pe.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]}function _e(pe,he){he||(he={}),"function"==typeof he&&(he={cmp:he});const ge="boolean"==typeof he.cycles&&he.cycles,ye=he.cmp&&(Me=he.cmp,function(Te){return function(me,Ce){return Me({key:me,value:Te[me]},{key:Ce,value:Te[Ce]})}});var Me;const Ee=[];return function Te(me){if(me&&me.toJSON&&"function"==typeof me.toJSON&&(me=me.toJSON()),void 0===me)return;if("number"==typeof me)return isFinite(me)?""+me:"null";if("object"!=typeof me)return JSON.stringify(me);let Ce,Ie;if(Array.isArray(me)){for(Ie="[",Ce=0;Ce<me.length;Ce++)Ce&&(Ie+=","),Ie+=Te(me[Ce])||"null";return Ie+"]"}if(null===me)return"null";if(Ee.includes(me)){if(ge)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const Ge=Ee.push(me)-1,Je=Object.keys(me).sort(ye&&ye(me));for(Ie="",Ce=0;Ce<Je.length;Ce++){const xe=Je[Ce],je=Te(me[xe]);je&&(Ie&&(Ie+=","),Ie+=JSON.stringify(xe)+":"+je)}return Ee.splice(Ge,1),"{"+Ie+"}"}(pe)}},54346:(dt,Re,T)=>{"use strict";T.d(Re,{V:()=>W,b:()=>J});var x=T(59318),A=T(84792),G=T(26584),Q=T(63290),H=T(21726);const re=Q.Z.getLogger("esri.assets");function J(B,Z){return(0,A.default)(W(B),Z)}function W(B){if(!x.Z.assetsPath)throw re.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new G.Z("assets:path-not-set","config.assetsPath is not set");return(0,H.v_)(x.Z.assetsPath,B)}},87204:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>ie,a:()=>ue,b:()=>oe,c:()=>ce});var ie,ue,le,x=T(62208),A=T(7699),G=T(89798),Q=T(14273),H=T(67668),re=T(97139),J=T(65787),W=T(17625),B=T(22355),Z=T(35387);function ce(le){const Y=new B.kG,j=le.output===ie.GridOnly,X=le.output===ie.GridComposite,U=X||j,ee=le.output===ie.ColorOnly,$=le.output===ie.ColorComposite,ne=$||ee,se=X||$;if(Y.include(Q.T),ne&&Y.fragment.uniforms.add(new re.J("backgroundColor",he=>he.backgroundColor)),le.baseOpacityMode!==ue.One&&Y.fragment.uniforms.add(new J.p("baseOpacity",he=>he.baseOpacity)),U&&(Y.extensions.add("GL_OES_standard_derivatives"),Y.fragment.include(G.H)),j||ee)return Y.fragment.code.add(W.H`
    void main() {
      gl_FragColor = ${ee?W.H`vec4(backgroundColor, 1.0)`:W.H`gridColor(uv)`};
    }
  `),Y;const ae=le.blendMode!==A.iM.Normal,de=le.baseOpacityMode===ue.OnBaseLayer,_e=le.baseOpacityMode===ue.OnBackground||le.baseOpacityMode===ue.OnBaseLayer,pe=le.premultipliedSource;return Y.fragment.uniforms.add(new Z.A("tex",he=>he.texture)),Y.fragment.uniforms.add(new J.p("opacity",he=>he.opacity)),(ae||de||pe)&&(Y.fragment.uniforms.add(new Z.A("fboColor",he=>he.fboTexture)),Y.fragment.uniforms.add(new J.p("tileSize",he=>(0,x.pC)(he.fboTexture)?he.fboTexture.descriptor.width:1))),Y.fragment.include(H.d,le),Y.fragment.code.add(W.H`
    void main() {
      ${se||de||pe?W.H`
      vec4 bgColor = ${$?W.H`vec4(backgroundColor, 1.0)`:X?W.H`gridColor(uv)`:W.H`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${_e?W.H`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${ae?W.H`
          vec4 fboTex = ${se?W.H`bgColor;`:W.H`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${de?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:W.H`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${pe?W.H`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:se||de?W.H`mix(bgColor, pmColorLayer, composeAlpha);`:W.H`pmColorLayer * composeAlpha;`}`}
    }
  `),Y}(le=ie||(ie={}))[le.Composite=0]="Composite",le[le.ColorOnly=1]="ColorOnly",le[le.GridOnly=2]="GridOnly",le[le.ColorComposite=3]="ColorComposite",le[le.GridComposite=4]="GridComposite",le[le.COUNT=5]="COUNT",function(le){le[le.One=0]="One",le[le.OnBackground=1]="OnBackground",le[le.OnBaseLayer=2]="OnBaseLayer",le[le.COUNT=3]="COUNT"}(ue||(ue={}));const oe=Object.freeze(Object.defineProperty({__proto__:null,get BlendLayersOutput(){return ie},get BaseOpacityMode(){return ue},build:ce},Symbol.toStringTag,{value:"Module"}))},56598:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>U,b:()=>j});var x=T(28347),A=T(43703),G=T(36603),Q=T(47923),H=T(96896),re=T(95285),J=T(65364),W=T(97139),B=T(39704),Z=T(66054),ie=T(84178),ue=T(17625),ce=T(63123),oe=T(22355),le=T(66838),Y=T(16396);function j(ee){const $=new oe.kG;$.attributes.add(Y.T.POSITION,"vec2"),$.include(G.D,{textureCoordinateType:G.N.Default}),$.varyings.add("worldRay","vec3"),$.varyings.add("eyeDir","vec3");const{vertex:ne,fragment:se}=$;return ne.uniforms.add([new ce.g("inverseProjectionMatrix",(ae,de)=>de.camera.inverseProjectionMatrix),new ce.g("inverseViewMatrix",(ae,de)=>(0,x.a)(X,de.camera.viewMatrix))]),ne.code.add(ue.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),se.uniforms.add([new W.J("lightingMainDirection",(ae,de)=>de.lighting.lightingMainDirection),new J.e("radii"),new ie.d("scaleHeight"),new B.K("cameraPosition"),new Z.y("heightParameters"),new ie.d("innerFadeDistance"),new ie.d("altitudeFade"),new le.Q("depthTex"),new B.K("betaRayleigh"),new B.K("betaCombined"),new ie.d("betaMie"),new ie.d("hazeStrength")]),$.include(H.D),ee.haze&&(se.include(Q.S),se.uniforms.add(new re.A("nearFar",(ae,de)=>de.camera.nearFar))),se.code.add(ue.H`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),se.code.add(ue.H`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),se.code.add(ue.H`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),se.code.add(ue.H`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${ee.haze?ue.H`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${ee.haze?ue.H``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${ee.haze?"":ue.H`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${ee.haze?ue.H`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:ue.H`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${ee.haze?ue.H`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:ue.H`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${ee.haze?ue.H`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:ue.H`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${ee.haze?"":ue.H`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `),$}const X=(0,A.c)(),U=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},89803:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>Z,a:()=>ue,b:()=>ie});var x=T(550),A=T(32849),G=T(85755),Q=T(98071),H=T(84178),re=T(17625),J=T(9546),W=T(22355),B=T(66838);class Z extends re.K{constructor(){super(...arguments),this.viewMatrix=(0,x.c)()}}function ie(ce){const oe=new W.kG;return oe.include(Q.k,!1),oe.fragment.uniforms.add(new H.d("cloudRadius")),oe.fragment.uniforms.add(new H.d("halfCubeMapSize")),oe.fragment.uniforms.add(new H.d("power")),oe.fragment.uniforms.add(new H.d("sigmaE")),oe.fragment.uniforms.add(new H.d("density")),oe.fragment.uniforms.add(new H.d("cloudSize")),oe.fragment.uniforms.add(new H.d("detailSize")),oe.fragment.uniforms.add(new H.d("smoothness")),oe.fragment.uniforms.add(new H.d("cloudHeight")),oe.fragment.uniforms.add(new H.d("coverage")),oe.fragment.uniforms.add(new J.j("view",le=>le.viewMatrix)),oe.fragment.uniforms.add(new B.Q("cloudShapeTexture")),oe.fragment.code.add(re.H`
    const int STEPS = ${ce.steps===A.p.SIXTEEN?re.H`16`:ce.steps===A.p.HUNDRED?re.H`100`:re.H`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),oe.fragment.code.add(re.H`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${re.H.float(G.IQ)};
      const float dataWidth = ${re.H.float(G.IQ)};
      const float tileRows = ${re.H.float(G.jy)};
      const vec3 atlasDimensions = vec3(${re.H.float(G.I_)}, ${re.H.float(G.I_)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${re.H.float(G.kR)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${re.H.float(G.QZ)} * p) / ${re.H.float(G.IQ)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `),oe.fragment.code.add(re.H`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),oe.fragment.code.add(re.H`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),oe.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation = 1.0;\n      float contribution = 1.0;\n      float phaseAttenuation = 1.0;\n      vec3 luminance = vec3(0);\n\n      for (int i = 0; i < 4; i++) {\n        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *= 0.2;\n        contribution *= 0.6;\n        phaseAttenuation *= 0.5;\n      }\n\n      return luminance;\n    }"),oe.fragment.code.add(re.H`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),oe.fragment.code.add(re.H`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`),oe.fragment.code.add(re.H`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`),oe}const ue=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:Z,build:ie},Symbol.toStringTag,{value:"Module"}))},50722:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>X,b:()=>Y});var x=T(28347),A=T(43703),G=T(44965),Q=T(96896),H=T(31166),re=T(92724),J=T(39337),W=T(69602),B=T(33726),Z=T(19278),ie=T(97139),ue=T(17625),ce=T(63123),oe=T(22355),le=T(16396);function Y(){const U=new oe.kG;U.attributes.add(le.T.POSITION,"vec2"),U.varyings.add("worldRay","vec3");const{vertex:ee,fragment:$}=U;return ee.uniforms.add([new ce.g("inverseProjectionMatrix",(ne,se)=>se.camera.inverseProjectionMatrix),new ce.g("inverseViewMatrix",(ne,se)=>(0,x.a)(j,se.camera.viewMatrix))]),ee.code.add(ue.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),$.include(B.Y),$.include(Z.n),U.include(G._,{pbrMode:re.f7.Disabled,lightingSphericalHarmonicsOrder:2}),U.include(J.e),U.include(Q.D),U.include(H.k,{isGround:!1}),U.include(W.j,{instancedDoublePrecision:!1,isGround:!1}),$.uniforms.add([new ie.J("cameraPosition",(ne,se)=>se.camera.eye)]),$.code.add(ue.H`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),U}const j=(0,A.c)(),X=Object.freeze(Object.defineProperty({__proto__:null,build:Y},Symbol.toStringTag,{value:"Module"}))},89652:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>X,b:()=>j});var x=T(6945),A=T(78925),G=T(24255),Q=T(58173),H=T(54120),re=T(62952),J=T(10109),W=T(67022),B=T(33726),Z=T(2166),ie=T(95285),ue=T(69960),ce=T(17625),oe=T(22355),le=T(42743),Y=T(16396);function j(U){const ee=new oe.kG,$=U.output===x.H.Depth,ne=U.hasMultipassTerrain&&(U.output===x.H.Color||U.output===x.H.Alpha);(0,Z.S)(ee,U),ee.include(G.w,{hasModelTransformation:!1,linearDepth:$}),ee.include(Q.c,U),ee.attributes.add(Y.T.POSITION,"vec3"),ee.varyings.add("vpos","vec3"),ne&&ee.varyings.add("depth","float");const{vertex:se,fragment:ae}=ee;return $&&(ee.include(H.F,U),se.uniforms.add(new ie.A("nearFar",(de,_e)=>_e.camera.nearFar)),ee.varyings.add("linearDepth","float")),se.code.add(ce.H`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${ne?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${$?ce.H`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:ce.H`transformPosition(proj, view, vpos);`}
    }
  `),ee.include(A.f5,U),ne&&ee.include(J.l,U),ae.include(B.Y),ae.uniforms.add(new ue.N("eColor",de=>de.color)),U.output===x.H.Highlight&&ee.include(re.bA),ae.code.add(ce.H`
  void main() {
    discardBySlice(vpos);
    ${ne?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${U.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${ce.H.float(W.b)}) {
      discard;
    }

    ${U.output===x.H.Alpha?ce.H`gl_FragColor = vec4(fColor.a);`:""}

    ${U.output===x.H.Color?ce.H`gl_FragColor = highlightSlice(fColor, vpos); ${U.transparencyPassType===le.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    ${U.output===x.H.Highlight?ce.H`outputHighlight();`:""};
    ${U.output===x.H.Depth?ce.H`outputDepth(linearDepth);`:""};
  }
  `),ee}const X=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}))},15261:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>je,a:()=>Ge,b:()=>Je,g:()=>xe});var x=T(94425),A=T(75224),G=T(75550),Q=T(35357),H=T(50574),re=T(52382),J=T(6945),W=T(78925),B=T(26859),Z=T(36603),ie=T(58173),ue=T(21799),ce=T(51040),oe=T(54120),le=T(62952),Y=T(47923),j=T(2122),X=T(29052),U=T(75819),ee=T(13146),$=T(10109),ne=T(92724),se=T(37926),ae=T(56693),de=T(30249),_e=T(67022),pe=T(93609),he=T(22799),ge=T(97139),ye=T(65787),Me=T(17625),Ee=T(46524),Te=T(22355),me=T(35387),Ce=T(42743),Ie=T(16396);const Ge=new Map([[Ie.T.POSITION,0],[Ie.T.NORMAL,1],[Ie.T.NORMALCOMPRESSED,1],[Ie.T.COLOR,2],[Ie.T.UV0,3],[Ie.T.UVREGION,4],[Ie.T.COMPONENTINDEX,5]]);function Je(We){const Ne=new Te.kG;Ne.include(ce.up,We),Ne.include(ue.Bb,We),Ne.include(ie.c,We),Ne.include(Z.D,We),Ne.include(re.q,We),Ne.include(Q.AD,We),Ne.include(pe.o,We),Ne.include(W.P_,We),Ne.include(se.s,We),Ne.include(H.z,We);const{vertex:we,fragment:Oe}=Ne;Oe.uniforms.add(new Ee.B("view")),We.pbrMode!==ne.f7.Normal&&We.pbrMode!==ne.f7.Schematic||(Ne.include(ne.jV,We),We.hasNormalTexture&&Ne.include(X.Q,We)),we.code.add(We.output===J.H.Shadow&&We.componentData===Q._N.Varying?Me.H`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`:Me.H`#define discardShadows(castShadows) {}`);const $e=We.integratedMeshMode===G.OH.ColorOverlay||We.integratedMeshMode===G.OH.ColorOverlayWithWater,Be=$e&&We.output===J.H.Color&&We.pbrMode===ne.f7.WaterOnIntegratedMesh;return $e&&(Ne.include(ee.X,We),Ne.include(de.WB,We),we.code.add(We.spherical?Me.H`
      const float invEllipsoidRadius = ${Me.H.float(1/(We.ellipsoidMode===he.U.Earth?x.sv.radius:We.ellipsoidMode===he.U.Mars?x.yr.radius:x.Z1.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `:Me.H`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),Be&&(Ne.varyings.add("tbnTangent","vec3"),Ne.varyings.add("tbnBiTangent","vec3"),Ne.varyings.add("groundNormal","vec3")),we.code.add(Me.H`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${Me.H.float(_e.b)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${Be?We.spherical?Me.H`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:Me.H`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${$e?Me.H`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),We.output===J.H.Alpha&&(Oe.include(Y.S),Ne.include($.l,We),Ne.include(j.P,We),$e&&Oe.uniforms.add(new me.A("ovColorTex",(Se,De)=>(0,de.Tw)(Se,De))),Oe.code.add(Me.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${We.hasMultipassTerrain?Me.H`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${$e?Me.H`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `)),We.output===J.H.Color&&(Oe.include(Y.S),Ne.include($.l,We),Ne.include(j.P,We),Ne.include(U.B,We),Ne.include(ee.X,We),We.receiveShadows?(Ne.include(ae.hb,We),Oe.code.add(Me.H`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):Oe.code.add(Me.H`float evaluateShadow() { return 0.0; }`),$e&&Oe.uniforms.add(new me.A("ovColorTex",(Se,De)=>(0,de.Tw)(Se,De))),Oe.code.add(Me.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${We.hasMultipassTerrain?Me.H`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${$e?Me.H`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),We.pbrMode===ne.f7.Normal||We.pbrMode===ne.f7.Schematic?(Oe.uniforms.add(new ge.J("lightingMainIntensity",(Se,De)=>De.lighting.mainLight.intensity)),Oe.code.add(Me.H`
        ${We.pbrMode===ne.f7.Normal?Me.H`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),Oe.code.add(We.hasNormalTexture?Me.H`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:Me.H`vec3 shadingNormal = normalVertex;`),Oe.code.add(Me.H`${We.spherical?Me.H`vec3 normalGround = normalize(positionWorld());`:Me.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),Oe.code.add(Me.H`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${We.snowCover?Me.H`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${$e?Me.H` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(We.receiveShadows?Oe.code.add(Me.H`float shadow = evaluateShadow();`):We.spherical?(Oe.uniforms.add(new ye.p("lightingGlobalFactor",(Se,De)=>De.lighting.globalFactor)),Oe.code.add(Me.H`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):Oe.code.add(Me.H`float shadow = 0.0;`),Be&&Oe.uniforms.add(new me.A("ovNormalTex",(Se,De)=>xe(De))),We.snowCover&&(Ne.extensions.add("GL_OES_standard_derivatives"),Oe.code.add(Me.H`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),Oe.code.add(Me.H`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${$e?Me.H` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${Be?Me.H`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),Oe.code.add(Me.H`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${We.transparencyPassType===Ce.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),We.output!==J.H.Depth&&We.output!==J.H.Shadow||(Ne.include(oe.F,We),Oe.code.add(Me.H`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),We.output===J.H.Normal&&(Ne.include(U.B,We),Oe.code.add(Me.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${We.normalType===B.h.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),We.output===J.H.Highlight&&(Ne.include(le.bA),Oe.code.add(Me.H`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${$e?Me.H`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),Ne}function xe(We){return 0===We.overlays.length?null:We.overlays[A.fu.INNER].getValidTexture(A.NH.Water)}const je=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:Ge,build:Je,getOverlayNormalTexture:xe},Symbol.toStringTag,{value:"Module"}))},70264:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>B,a:()=>ie,b:()=>Z});var x=T(94573),A=T(98071),G=T(65787),Q=T(18952),H=T(17625),re=T(22355),J=T(35387),W=T(54580);class B extends H.K{constructor(){super(...arguments),this.overlayIndex=0,this.opacity=1}}function Z(ue){const ce=new re.kG;ce.include(A.k);const oe=ce.fragment;switch(ue.function){case W.v3.Standard:oe.uniforms.add(new J.A("tex",le=>le.texture)),ue.hasOpacityFactor?(oe.uniforms.add(new G.p("opacity",le=>le.opacity)),oe.code.add(H.H`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):oe.code.add(H.H`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case W.v3.OverlayWithTransparency:oe.uniforms.add(new J.A("tex",le=>le.texture)),oe.uniforms.add(new Q._("overlayIdx",le=>le.overlayIndex)),ue.hasOpacityFactor&&oe.uniforms.add(new G.p("opacity",le=>le.opacity)),oe.code.add(H.H`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${ue.hasOpacityFactor?"* opacity":""};
        }`);break;case W.v3.TransparentToHUDVisibility:oe.uniforms.add(new J.A("tex",le=>le.texture)),oe.code.add(H.H`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case W.v3.Transparency:oe.uniforms.add([new J.A("colorTexture",le=>le.colorTexture),new J.A("alphaTexture",le=>le.alphaTexture),new J.A("frontFaceTexture",le=>le.frontFaceTexture)]),oe.code.add(H.H`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case W.v3.COUNT:break;default:(0,x.Bg)(ue.function)}return ce}const ie=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:B,build:Z},Symbol.toStringTag,{value:"Module"}))},96160:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>Ne,b:()=>We});var x=T(62208),A=T(43703),G=T(52382),Q=T(73132),H=T(6945),re=T(78925),J=T(24255),W=T(60355),B=T(26859),Z=T(84833),ie=T(99579),ue=T(36603),ce=T(58173),oe=T(21799),le=T(66085),Y=T(58208),j=T(29052),X=T(54662),U=T(13146),ee=T(10109),$=T(96395),ne=T(98898),se=T(92724),ae=T(56693),de=T(92836),_e=T(67022),pe=T(93609),he=T(411),ge=T(28137),ye=T(2166),Me=T(97139),Ee=T(69960),Te=T(65787),me=T(17625),Ce=T(63123),Ie=T(22355),Ge=T(35387),Je=T(42743),xe=T(16396),je=T(95279);function We(we){const Oe=new Ie.kG,$e=Oe.vertex.code,Be=Oe.fragment.code;Oe.include(he.a,{name:"Default Material Shader",output:we.output});const Se=(0,ye.S)(Oe,we);return Oe.include(Z.f),Oe.varyings.add("vpos","vec3"),Oe.include(de.k,we),Oe.include(W.f,we),Oe.include(le.L,we),we.output!==H.H.Color&&we.output!==H.H.Alpha||((0,ye.h)(Oe.vertex,we),Oe.include(B.O,we),Oe.include(J.w,{linearDepth:!1,hasModelTransformation:we.hasModelTransformation}),we.normalType===B.h.Attribute&&we.offsetBackfaces&&Oe.include(Q.w),Oe.include(j.Q,we),Oe.include(oe.Bb,we),we.instancedColor&&Oe.attributes.add(xe.T.INSTANCECOLOR,"vec4"),Oe.varyings.add("localvpos","vec3"),Oe.include(ue.D,we),Oe.include(G.q,we),Oe.include(ie.R,we),Oe.include(ce.c,we),Oe.vertex.uniforms.add(new Ee.N("externalColor",De=>De.externalColor)),Oe.varyings.add("vcolorExt","vec4"),we.hasMultipassTerrain&&Oe.varyings.add("depth","float"),we.hasModelTransformation&&Oe.vertex.uniforms.add(new Ce.g("model",De=>(0,x.pC)(De.modelTransformation)?De.modelTransformation:A.I)),$e.add(me.H`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${we.instancedColor?"vcolorExt *= instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${me.H.float(_e.b)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${we.normalType===B.h.Attribute?me.H`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${we.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${we.hasModelTransformation?"model,":""} vpos);
          ${we.normalType===B.h.Attribute&&we.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${we.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `)),we.output===H.H.Alpha&&(Oe.include(re.f5,we),Oe.include(pe.z,we),Oe.include(ee.l,we),Oe.fragment.uniforms.add([new Te.p("opacity",De=>De.opacity),new Te.p("layerOpacity",De=>De.layerOpacity)]),we.hasColorTexture&&Oe.fragment.uniforms.add(new Ge.A("tex",De=>De.texture)),Oe.fragment.include(ge.y),Be.add(me.H`
      void main() {
        discardBySlice(vpos);
        ${we.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${we.hasColorTexture?me.H`
                vec4 texColor = texture2D(tex, vuv0);
                ${we.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:me.H`vec4 texColor = vec4(1.0);`}
        ${we.hasVertexColors?me.H`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:me.H`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `)),we.output===H.H.Color&&(Oe.include(re.f5,we),Oe.include(U.X,we),Oe.include(X.K,we),Oe.include(pe.z,we),Oe.include(we.instancedDoublePrecision?ae.hb:ae.XE,we),Oe.include(ee.l,we),(0,ye.h)(Oe.fragment,we),Oe.fragment.uniforms.add([Se,new Me.J("ambient",De=>De.ambient),new Me.J("diffuse",De=>De.diffuse),new Te.p("opacity",De=>De.opacity),new Te.p("layerOpacity",De=>De.layerOpacity),new Te.p("lightingGlobalFactor",(De,Fe)=>Fe.lighting.globalFactor),new Me.J("lightingMainIntensity",(De,Fe)=>Fe.lighting.mainLight.intensity)]),Oe.fragment.constants.add("ambientBoostFactor","float",je.V),we.hasColorTexture&&Oe.fragment.uniforms.add(new Ge.A("tex",De=>De.texture)),Oe.include(se.jV,we),Oe.include(ne.T,we),Oe.fragment.include(ge.y),Oe.include($.k,we),Be.add(me.H`
      void main() {
        discardBySlice(vpos);
        ${we.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${we.hasColorTexture?me.H`
                vec4 texColor = texture2D(tex, vuv0);
                ${we.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:me.H`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${we.normalType===B.h.ScreenDerivative?me.H`
                vec3 normal = screenDerivativeNormal(localvpos);`:me.H`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${we.pbrMode===se.f7.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${we.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":we.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${we.hasVertexColors?me.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:me.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${we.hasNormalTexture?me.H`
                mat3 tangentSpace = ${we.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:me.H`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${we.spherical?me.H`normalize(vpos + localOrigin);`:me.H`vec3(0.0, 0.0, 1.0);`}

        ${we.snowCover?me.H`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${we.pbrMode===se.f7.Normal||we.pbrMode===se.f7.Schematic?me.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${we.snowCover?me.H`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:me.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${we.transparencyPassType===Je.Am.Color?me.H`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `)),Oe.include(Y.s,we),Oe}const Ne=Object.freeze(Object.defineProperty({__proto__:null,build:We},Symbol.toStringTag,{value:"Module"}))},71964:(dt,Re,T)=>{"use strict";T.d(Re,{E:()=>ne,b:()=>ee});var x=T(67831),A=T(99770),G=T(78925),Q=T(10109),H=T(95285),re=T(69960),J=T(65787),W=T(17625),B=T(46524),Z=T(22355),ie=T(16396),ue=T(57008),ce=T(98828),oe=T(72175),le=T(98412),Y=T(73105),j=T(10967),X=T(82716),U=T(69276);function ee(se){const ae=new Z.kG,de=ae.vertex,_e=ae.fragment;return se.legacy&&de.uniforms.add(new B.B("model")),se.antialiasing&&(de.code.add(W.H`#define ANTIALIASING 1`),_e.code.add(W.H`#define ANTIALIASING 1`)),ae.include(ue.g,se),ae.include(Y.UR,se),ae.include(j.B,se),ae.include(U.H,se),ae.include(X.N,se),ae.include(G.f5,se),ae.include(oe.o,se),ae.include(ce.S,se),ae.include(le.l,se),ae.include(Q.l,se),ae.varyings.add("vColor","vec4"),ae.varyings.add("vRadius","float"),ae.varyings.add("vPosition","vec3"),ae.varyings.add("vWorldPosition","vec3"),ae.varyings.add("vViewPos","vec3"),ae.varyings.add("vLineLengthPixels","float"),ae.varyings.add("vSizeFalloffFactor","float"),de.uniforms.add(new H.A("pixelToNDC",(pe,he)=>(0,x.a)($,2/he.camera.fullViewport[2],2/he.camera.fullViewport[3]))),de.uniforms.add(new re.N("viewport",(pe,he)=>he.camera.fullViewport)),de.uniforms.add(new J.p("pixelRatio",(pe,he)=>he.camera.pixelRatio)),ae.attributes.add(ie.T.POSITION0,"vec3"),ae.attributes.add(ie.T.POSITION1,"vec3"),ae.attributes.add(ie.T.VARIANTOFFSET,"float"),ae.attributes.add(ie.T.VARIANTSTROKE,"float"),ae.attributes.add(ie.T.VARIANTEXTENSION,"float"),de.code.add(W.H`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`),ae.fragment.code.add(W.H`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${se.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `),ae}const $=(0,A.a)(),ne=Object.freeze(Object.defineProperty({__proto__:null,build:ee},Symbol.toStringTag,{value:"Module"}))},50570:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>Y,b:()=>oe});var x=T(28347),A=T(43703),G=T(36603),Q=T(47923),H=T(96896),re=T(95285),J=T(39704),W=T(84178),B=T(17625),Z=T(63123),ie=T(22355),ue=T(66838),ce=T(16396);function oe(j){const X=new ie.kG;X.attributes.add(ce.T.POSITION,"vec2"),X.include(G.D,{textureCoordinateType:G.N.Default}),X.varyings.add("worldRay","vec3"),X.varyings.add("eyeDir","vec3");const{vertex:U,fragment:ee}=X;return U.uniforms.add([new Z.g("inverseProjectionMatrix",($,ne)=>ne.camera.inverseProjectionMatrix),new Z.g("inverseViewMatrix",($,ne)=>(0,x.a)(le,ne.camera.viewMatrix))]),U.code.add(B.H`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),ee.uniforms.add(new W.d("atmosphereC")),ee.uniforms.add(new J.K("cameraPosition")),ee.uniforms.add(new re.A("nearFar",($,ne)=>ne.camera.nearFar)),ee.uniforms.add(new ue.Q("depthTex")),ee.uniforms.add(new W.d("fogStrength")),ee.uniforms.add(new W.d("fogAmount")),ee.uniforms.add(new J.K("fogColor")),X.include(H.D),ee.include(Q.S),ee.code.add(B.H`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),ee.code.add(B.H`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),ee.code.add(B.H`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${j.haze?B.H`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `),X}const le=(0,A.c)(),Y=Object.freeze(Object.defineProperty({__proto__:null,build:oe},Symbol.toStringTag,{value:"Module"}))},6467:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>Te,b:()=>he,c:()=>ye});var x=T(62208),A=T(67831),G=T(99770),Q=T(4794),H=T(10596),re=T(6945),J=T(78925),W=T(35283),B=T(97347),Z=T(27776),ie=T(62952),ue=T(92836),ce=T(67022),oe=T(33726),le=T(19278),Y=T(71850),j=T(95285),X=T(69960),U=T(48565),ee=T(65787),$=T(7090),ne=T(17625),se=T(22355),ae=T(35387),de=T(42743),_e=T(16396),pe=T(41857);function he(me){const Ce=new se.kG,Ie=me.signedDistanceFieldEnabled;if(Ce.include(W.H),Ce.include(B.R,me),Ce.include(J.f5,me),me.output===re.H.Occlusion)return Ce.include(Z.R,me),Ce;const{vertex:Ge,fragment:Je}=Ce;Ce.include(Y.cK),Je.include(le.n),Je.include(oe.Y),Ce.include(ue.k,me),Ce.varyings.add("vcolor","vec4"),Ce.varyings.add("vtc","vec2"),Ce.varyings.add("vsize","vec2"),me.binaryHighlightOcclusionEnabled&&Ce.varyings.add("voccluded","float"),Ge.uniforms.add([new X.N("viewport",(we,Oe)=>Oe.camera.fullViewport),new j.A("screenOffset",(we,Oe)=>(0,A.a)(Ee,2*we.screenOffset[0]*Oe.camera.pixelRatio,2*we.screenOffset[1]*Oe.camera.pixelRatio)),new j.A("anchorPosition",we=>ye(we)),new X.N("materialColor",we=>we.color),new ee.p("pixelRatio",(we,Oe)=>Oe.camera.pixelRatio)]),Ie&&(Ge.uniforms.add(new X.N("outlineColor",we=>we.outlineColor)),Je.uniforms.add([new X.N("outlineColor",we=>ge(we)?we.outlineColor:Q.Z),new ee.p("outlineSize",we=>ge(we)?we.outlineSize:0)])),me.hasScreenSizePerspective&&((0,Y.ww)(Ge),(0,Y.m8)(Ge)),(me.debugDrawLabelBorder||me.binaryHighlightOcclusionEnabled)&&Ce.varyings.add("debugBorderCoords","vec4"),Ce.attributes.add(_e.T.UV0,"vec2"),Ce.attributes.add(_e.T.COLOR,"vec4"),Ce.attributes.add(_e.T.SIZE,"vec2"),Ce.attributes.add(_e.T.AUXPOS2,"vec4"),Ge.code.add(ne.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${me.hasScreenSizePerspective?ne.H`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:ne.H`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${me.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${me.occlusionTestEnabled||me.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${me.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const xe=ne.H`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`,je=me.pixelSnappingEnabled?Ie?ne.H`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:ne.H`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:ne.H`posProj += quadOffset;`;me.vvColor&&Ge.uniforms.add([new U.b("vvColorColors",we=>we.vvColorColors,pe.x),new $.O("vvColorValues",we=>we.vvColorValues,pe.x)]),Ge.uniforms.add(new j.A("textureCoordinateScaleFactor",we=>(0,x.pC)(we.texture)&&(0,x.pC)(we.texture.descriptor.textureCoordinateScaleFactor)?we.texture.descriptor.textureCoordinateScaleFactor:G.O)),Ge.code.add(ne.H`
    ${me.occlusionTestEnabled?"if (visible) {":""}
    ${xe}
    ${me.vvColor?"vcolor = vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${ne.H.float(ce.b)};
    ${Ie?`alphaDiscard = alphaDiscard && outlineColor.a < ${ne.H.float(ce.b)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${je}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${me.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${me.occlusionTestEnabled?ne.H`} else { vtc = vec2(0.0);
      ${me.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),Je.uniforms.add(new ae.A("tex",we=>we.texture));const We=me.debugDrawLabelBorder?ne.H`(isBorder > 0.0 ? 0.0 : ${ne.H.float(ce.F)})`:ne.H.float(ce.F),Ne=ne.H`
    ${me.debugDrawLabelBorder?ne.H`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${Ie?ne.H`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${ne.H.float(H.Ph)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${We} ||
          fillPixelColor.a + outlinePixelColor.a < ${ne.H.float(ce.b)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${We}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:ne.H`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${We}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${me.debugDrawLabelBorder?ne.H`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return me.output===re.H.Alpha&&Je.code.add(ne.H`
      void main() {
        ${Ne}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `),me.output===re.H.Color&&Je.code.add(ne.H`
    void main() {
      ${Ne}
      ${me.transparencyPassType===de.Am.FrontFace?"gl_FragColor.rgb /= gl_FragColor.a;":""}
    }
    `),me.output===re.H.Highlight&&(Ce.include(ie.bA),Je.code.add(ne.H`
    void main() {
      ${Ne}
      ${me.binaryHighlightOcclusionEnabled?ne.H`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),Ce}function ge(me){return me.outlineColor[3]>0&&me.outlineSize>0}function ye(me,Ce=Ee){return me.textureIsSignedDistanceField?function Me(me,Ce,Ie){(0,x.pC)(Ce)?(0,A.a)(Ie,me[0]*(Ce[2]-Ce[0])+Ce[0],me[1]*(Ce[3]-Ce[1])+Ce[1]):(0,A.a)(Ie,0,0)}(me.anchorPosition,me.distanceFieldBoundingBox,Ce):(0,A.c)(Ce,me.anchorPosition),Ce}const Ee=(0,G.a)(),Te=Object.freeze(Object.defineProperty({__proto__:null,build:he,calculateAnchorPosForRendering:ye},Symbol.toStringTag,{value:"Module"}))},17923:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>ue,b:()=>Z});var x=T(993),A=T(4794),G=T(69960),Q=T(17625),H=T(22355),re=T(35387),J=T(16396);function Z(){const ce=new H.kG,{vertex:oe,fragment:le}=ce,Y=oe.code,j=le.code;return ce.attributes.add(J.T.POSITION,"vec2"),ce.varyings.add("uv","vec2"),ce.attributes.add(J.T.UV0,"vec2"),oe.uniforms.add(new re.A("coverageTex",X=>X.coverageTexture)),Y.add(Q.H`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),le.uniforms.add(new re.A("tex",X=>X.blurColorTexture)),le.uniforms.add(new re.A("origin",X=>X.highlightColorTexture)),le.uniforms.add(new G.N("uColor",X=>X.color)),le.uniforms.add(new G.N("haloColor",X=>X.haloColor)),le.uniforms.add(new G.N("opacities",X=>(0,x.s)(ie,X.haloOpacity,X.haloOpacityOccluded,X.fillOpacity,X.fillOpacityOccluded))),le.constants.add("outlineSize","float",8.6),le.constants.add("blurSize","float",.4),j.add(Q.H`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),ce}const ie=(0,A.c)(),ue=Object.freeze(Object.defineProperty({__proto__:null,build:Z},Symbol.toStringTag,{value:"Module"}))},47482:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>W,a:()=>Z,b:()=>B});var x=T(99770),A=T(32181),G=T(17625),Q=T(22355),H=T(5864),re=T(35387),J=T(16396);class W extends G.K{constructor(){super(...arguments),this.blurSize=(0,x.a)()}}function B(){const ie=new Q.kG,{vertex:ue,fragment:ce}=ie,oe=ue.code,le=ce.code;return ie.attributes.add(J.T.POSITION,"vec2"),ie.attributes.add(J.T.UV0,"vec2"),ie.varyings.add("blurCoordinate","vec3"),ue.uniforms.add(new re.A("coverageTex",Y=>Y.coverageTexture)),ce.uniforms.add(new A.q("blurSize",Y=>Y.blurSize)),oe.add(G.H`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),ce.uniforms.add(new H.R("tex",Y=>Y.blurInputTexture)),le.add(G.H`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`),ie}const Z=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:W,build:B},Symbol.toStringTag,{value:"Module"}))},36227:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>J,a:()=>B,b:()=>W});var x=T(99770),A=T(32181),G=T(17625),Q=T(22355),H=T(5864),re=T(16396);class J extends G.K{constructor(){super(...arguments),this.invFramebufferDim=(0,x.a)()}}function W(){const Z=new Q.kG,{vertex:ie,fragment:ue}=Z,ce=ie.code,oe=ue.code;return Z.attributes.add(re.T.POSITION,"vec2"),ce.add(G.H`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),ue.uniforms.add(new H.R("tex",le=>le.inputTexture)),ue.uniforms.add(new A.q("invFramebufferDim",le=>le.invFramebufferDim)),oe.add(G.H`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),Z}const B=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:J,build:W},Symbol.toStringTag,{value:"Module"}))},76269:(dt,Re,T)=>{"use strict";T.d(Re,{L:()=>U,b:()=>Y});var x=T(62208),A=T(67831),G=T(99770),Q=T(4794),H=T(78925),re=T(35283),J=T(97347),W=T(82793),B=T(71850),Z=T(95285),ie=T(69960),ue=T(65787),ce=T(17625),oe=T(22355),le=T(16396);function Y(ee){const $=new oe.kG;$.include(re.H),$.include(J.R,ee),$.include(H.f5,ee),$.attributes.add(le.T.UV0,"vec2");const{vertex:ne,fragment:se}=$;return ne.uniforms.add([new ie.N("viewport",(ae,de)=>de.camera.fullViewport),new ue.p("lineSize",(ae,de)=>Math.ceil(ae.size)*de.camera.pixelRatio),new Z.A("pixelToNDC",(ae,de)=>(0,A.a)(X,2/de.camera.fullViewport[2],2/de.camera.fullViewport[3])),new ue.p("borderSize",(ae,de)=>(0,x.pC)(ae.borderColor)?de.camera.pixelRatio:0),new Z.A("screenOffset",(ae,de)=>(0,A.a)(X,ae.screenOffset[0]*de.camera.pixelRatio,ae.screenOffset[1]*de.camera.pixelRatio))]),$.varyings.add("coverageSampling","vec4"),$.varyings.add("lineSizes","vec2"),ee.hasMultipassGeometry&&$.varyings.add("depth","float"),ee.hasScreenSizePerspective&&(0,B.m8)(ne),ne.code.add(ce.H`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${ee.occlusionTestEnabled?ce.H`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${ee.hasScreenSizePerspective?ce.H`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:ce.H`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${ee.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${ee.depthHudEnabled?ee.depthHudAlignStartEnabled?ce.H`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:ce.H`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${ee.hasScreenSizePerspective?ce.H`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:ce.H`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),se.uniforms.add([new ie.N("uColor",ae=>j(ae.color)),new ie.N("borderColor",ae=>j(ae.borderColor))]),ee.hasMultipassGeometry&&(se.include(W.S,ee),se.uniforms.add(new Z.A("inverseViewport",(ae,de)=>de.inverseViewport))),se.code.add(ce.H`
    void main() {
      ${ee.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${ee.depthHudEnabled?ce.H`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:ce.H`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),$}function j(ee){return(0,x.pC)(ee)?ee:Q.Z}const X=(0,G.a)(),U=Object.freeze(Object.defineProperty({__proto__:null,build:Y},Symbol.toStringTag,{value:"Module"}))},71530:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>ie});var B,x=T(17626),A=T(91558),G=T(86810),Q=T(58817),H=T(77712),J=(T(90912),T(76898)),W=T(60958);let Z=B=class extends G.wq{constructor(){super(...arguments),this.color=new A.Z("white")}clone(){return new B({color:(0,Q.d9)(this.color)})}};(0,x._)([(0,H.Cb)(W.a)],Z.prototype,"color",void 0),Z=B=(0,x._)([(0,J.j)("esri.symbols.callouts.LineCallout3DBorder")],Z);const ie=Z;Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"}))},62718:(dt,Re,T)=>{"use strict";T.d(Re,{L:()=>$,b:()=>ee});var x=T(30764),A=T(6945),G=T(78925),Q=T(39645),H=T(54120),re=T(10109),J=T(67022),W=T(33726),B=T(19278),Z=T(2166),ie=T(95285),ue=T(69960),ce=T(65787),oe=T(17625),le=T(63123),Y=T(22355),j=T(35387),X=T(42743),U=T(16396);function ee(ne){const se=new Y.kG,ae=ne.hasMultipassTerrain&&(ne.output===A.H.Color||ne.output===A.H.Alpha);se.include(Q.U,ne),ne.output===A.H.Depth&&se.include(H.F,ne);const{vertex:de,fragment:_e}=se;return _e.include(B.n),(0,Z.S)(se,ne),se.attributes.add(U.T.POSITION,"vec3"),se.attributes.add(U.T.UV0,"vec2"),se.attributes.add(U.T.AUXPOS1,"vec3"),se.varyings.add("vColor","vec4"),se.varyings.add("vpos","vec3"),se.varyings.add("vUV","vec2"),se.varyings.add("vSize","float"),se.varyings.add("linearDepth","float"),ae&&se.varyings.add("depth","float"),de.code.add(oe.H`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`),de.uniforms.add([new ie.A("nearFar",(pe,he)=>he.camera.nearFar),new ue.N("viewport",(pe,he)=>he.camera.fullViewport)]),de.code.add(oe.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),de.code.add(oe.H`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`),ne.draped||(de.uniforms.add(new le.g("inverseProjectionMatrix",(pe,he)=>he.camera.inverseProjectionMatrix)),de.code.add(oe.H`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),de.code.add(oe.H`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),de.uniforms.add(new ce.p("perScreenPixelRatio",(pe,he)=>he.camera.perScreenPixelRatio)),de.code.add(oe.H`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${ne.hasCap?"\n                if(prev.z > posLeft.z) {\n                  vec2 diff = posLeft.xy - posRight.xy;\n                  planeOrigin.xy += PERPENDICULAR(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),de.uniforms.add(new ce.p("pixelRatio",(pe,he)=>he.camera.pixelRatio)),de.code.add(oe.H`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${oe.H.float(x.vT/x.CM)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `),ne.draped||de.code.add(oe.H`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`),de.code.add(oe.H`
        ${ae?"depth = pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),ae&&se.include(re.l,ne),se.include(G.f5,ne),_e.uniforms.add([new ue.N("intrinsicColor",pe=>pe.color),new j.A("tex",pe=>pe.texture)]),_e.include(W.Y),_e.code.add(oe.H`
  void main() {
    discardBySlice(vpos);
    ${ae?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${oe.H.float(1/x.vT)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${oe.H.float(J.b)}) {
      discard;
    }

    ${ne.output===A.H.Alpha?oe.H`gl_FragColor = vec4(finalColor.a);`:""}
    ${ne.output===A.H.Color?oe.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${ne.output===A.H.Color&&ne.transparencyPassType===X.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${ne.output===A.H.Highlight?oe.H`gl_FragColor = vec4(1.0);`:""}
    ${ne.output===A.H.Depth?oe.H`outputDepth(linearDepth);`:""}
  }
  `),se}const $=Object.freeze(Object.defineProperty({__proto__:null,build:ee},Symbol.toStringTag,{value:"Module"}))},32616:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>le,b:()=>oe});var x=T(6945),A=T(78925),G=T(24255),Q=T(58173),H=T(62952),re=T(92484),J=T(67022),W=T(2166),B=T(69960),Z=T(65787),ie=T(17625),ue=T(22355),ce=T(16396);function oe(Y){const j=new ue.kG;j.include(G.w),j.include(Q.c,Y),j.include(re.q,Y),(0,W.S)(j,Y);const{vertex:X,fragment:U}=j;return Y.stippleEnabled&&(j.attributes.add(ce.T.UV0,"vec2"),j.attributes.add(ce.T.AUXPOS1,"vec3"),X.uniforms.add(new B.N("viewport",(ee,$)=>$.camera.fullViewport))),j.attributes.add(ce.T.POSITION,"vec3"),j.varyings.add("vpos","vec3"),X.code.add(ie.H`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),Y.stippleEnabled&&(X.code.add(ie.H`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),Y.draped?X.uniforms.add(new Z.p("worldToScreenRatio",(ee,$)=>1/$.screenToPCSRatio)):X.code.add(ie.H`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),X.code.add(ie.H`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),X.code.add(Y.draped?ie.H`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`:ie.H`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),X.code.add(ie.H`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),X.code.add(ie.H`}`),Y.output===x.H.Highlight&&j.include(H.bA),j.include(A.f5,Y),U.uniforms.add(new Z.p("alphaCoverage",(ee,$)=>Math.min(1,ee.width*$.camera.pixelRatio))),Y.hasVertexColors||U.uniforms.add(new B.N("constantColor",ee=>ee.color)),U.code.add(ie.H`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${Y.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${ie.H.float(J.b)}) {
      discard;
    }

    ${Y.output===x.H.Color?ie.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${Y.output===x.H.Highlight?ie.H`outputHighlight();`:""}
  }
  `),j}const le=Object.freeze(Object.defineProperty({__proto__:null,build:oe},Symbol.toStringTag,{value:"Module"}))},42474:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>W,b:()=>J});var x=T(64312),A=T(85755),G=T(98071),Q=T(65364),H=T(17625),re=T(22355);function J(B){const Z=new re.kG;return Z.include(G.k,!1),Z.fragment.code.add(H.H`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),Z.fragment.uniforms.add(new Q.e("weatherTile")),B.mode===x.u.Full&&Z.fragment.code.add(H.H`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${H.H.float(A.jy)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${H.H.float(8)});

      float worley0 = worley(p, ${H.H.float(2)} * 2.0);
      float worley1 = worley(p, ${H.H.float(2)} * 8.0);
      float worley2 = worley(p, ${H.H.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${H.H.float(2)});
      float worley1 = worley(p, ${H.H.float(2)} * 2.0);
      float worley2 = worley(p, ${H.H.float(2)} * 4.0);
      float worley3 = worley(p, ${H.H.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),Z.fragment.code.add(H.H`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${H.H.float(A.A)});

      // Get global coordinates of p
      p += weatherTile * ${H.H.float(A.A)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${H.H.float(A.iZ)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),Z.fragment.code.add(H.H`void main() {`),B.mode===x.u.Full&&Z.fragment.code.add(H.H`
        float padWidth = 1.0;
        float paddedSize = ${H.H.float(A.I_)} + 2.0 * padWidth;
        float tileCount = ${H.H.float(A.jy)} * ${H.H.float(A.jy)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${H.H.float(A.I_)};
          }

          if (startPadY) {
            pixel.y += ${H.H.float(A.I_)};
          }

          if (endPadX) {
            pixel.x -= ${H.H.float(A.I_)};
          }

          if (endPadY) {
            pixel.y -= ${H.H.float(A.I_)};
          }

          uv = vec2(pixel.xy / ${H.H.float(A.I_)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${H.H.float(A.I_)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${H.H.float(A.jy)} * ${H.H.float(A.jy)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${H.H.float(A.jy)} * ${H.H.float(A.jy)});
        p = p_;
        p.z /= (${H.H.float(A.jy)} * ${H.H.float(A.jy)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),Z.fragment.code.add(H.H`
      vec2 mapUV = ${H.H.float(A.A)} * (gl_FragCoord.xy / ${H.H.float(A.IQ)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${B.mode===x.u.Full?H.H`gl_FragColor.ba = vec2(0.0, map);`:H.H`gl_FragColor = vec4(map);`};
    }
  `),Z}const W=Object.freeze(Object.defineProperty({__proto__:null,build:J},Symbol.toStringTag,{value:"Module"}))},24079:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>_e,b:()=>de});var x=T(52382),A=T(6945),G=T(78925),Q=T(24255),H=T(68565),re=T(54120),J=T(62952),W=T(54662),B=T(13146),Z=T(10109),ie=T(96395),ue=T(7025),ce=T(56693),oe=T(33726),le=T(2166),Y=T(95285),j=T(97139),X=T(66054),U=T(65787),ee=T(17625),$=T(63123),ne=T(22355),se=T(42743),ae=T(95279);function de(pe){const he=new ne.kG,ge=(0,le.S)(he,pe),{vertex:ye,fragment:Me}=he;return he.varyings.add("vpos","vec3"),he.include(H.W,pe),pe.output!==A.H.Color&&pe.output!==A.H.Alpha||(he.include(Q.w),he.include(ce.XE,pe),he.include(x.q,pe),he.varyings.add("vnormal","vec3"),he.varyings.add("vcolor","vec4"),pe.hasMultipassTerrain&&he.varyings.add("depth","float"),ye.code.add(ee.H`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${pe.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${pe.output===A.H.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),he.include(Z.l,pe),pe.output===A.H.Alpha&&(he.include(G.f5,pe),Me.uniforms.add(new U.p("opacity",Ee=>Ee.opacity)),Me.code.add(ee.H`
      void main() {
        discardBySlice(vpos);
        ${pe.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `)),pe.output===A.H.Color&&(he.include(G.f5,pe),he.include(B.X,pe),he.include(W.K,pe),he.include(ce.XE,pe),he.include(ie.k,pe),(0,le.h)(Me,pe),Me.uniforms.add([ge,new j.J("ambient",Ee=>Ee.ambient),new j.J("diffuse",Ee=>Ee.diffuse),new j.J("specular",Ee=>Ee.specular),new U.p("opacity",Ee=>Ee.opacity),new U.p("lightingGlobalFactor",(Ee,Te)=>Te.lighting.globalFactor),new j.J("lightingMainIntensity",(Ee,Te)=>Te.lighting.mainLight.intensity)]),Me.constants.add("ambientBoostFactor","float",ae.V),Me.include(oe.Y),Me.code.add(ee.H`
      void main() {
        discardBySlice(vpos);
        ${pe.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${pe.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":pe.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${pe.transparencyPassType===se.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),pe.output!==A.H.Depth&&pe.output!==A.H.Shadow||(he.include(Q.w,{hasModelTransformation:!1,linearDepth:!0}),ye.uniforms.add(new Y.A("nearFar",(Ee,Te)=>Te.camera.nearFar)),he.varyings.add("depth","float"),ye.code.add(ee.H`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),he.include(G.f5,pe),he.include(re.F,pe),Me.code.add(ee.H`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`)),pe.output===A.H.Normal&&(he.include(Q.w),he.include(ue.n,pe),ye.uniforms.add(new $.g("viewNormal",(Ee,Te)=>Te.camera.viewInverseTransposeMatrix)),he.varyings.add("vnormal","vec3"),ye.code.add(ee.H`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),he.include(G.f5,pe),Me.uniforms.add(new X.y("waterColor")),Me.code.add(ee.H`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`)),pe.output===A.H.Highlight&&(he.include(Q.w),he.include(ue.n,pe),he.varyings.add("vnormal","vec3"),ye.code.add(ee.H`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),he.include(G.f5,pe),he.include(J.bA),Me.code.add(ee.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),he}const _e=Object.freeze(Object.defineProperty({__proto__:null,build:de},Symbol.toStringTag,{value:"Module"}))},66401:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>ae,b:()=>ne});var x=T(6945),A=T(78925),G=T(24255),Q=T(58173),H=T(54120),re=T(62952),J=T(10109),W=T(67022),B=T(33726),Z=T(2166),ie=T(95285),ue=T(69960),ce=T(65787),oe=T(17625),le=T(22355),Y=T(42743),j=T(16396),X=T(95402);const U=.70710678118,ee=U;function ne(de){const _e=new le.kG,pe=de.hasMultipassTerrain&&(de.output===x.H.Color||de.output===x.H.Alpha);de.draped||_e.extensions.add("GL_OES_standard_derivatives");const he=de.output===x.H.Depth,{vertex:ge,fragment:ye}=_e;(0,Z.S)(_e,de),_e.include(G.w,{hasModelTransformation:!1,linearDepth:he}),_e.include(Q.c,de),he&&(_e.include(H.F,de),ge.uniforms.add(new ie.A("nearFar",(Ee,Te)=>Te.camera.nearFar)),_e.varyings.add("linearDepth","float")),de.draped?ge.uniforms.add(new ce.p("worldToScreenRatio",(Ee,Te)=>1/Te.screenToPCSRatio)):_e.attributes.add(j.T.BOUNDINGRECT,"mat3"),_e.attributes.add(j.T.POSITION,"vec3"),_e.attributes.add(j.T.UVMAPSPACE,"vec4"),_e.varyings.add("vpos","vec3"),_e.varyings.add("vuv","vec2"),pe&&_e.varyings.add("depth","float");const Me=de.style===X.b.ForwardDiagonal||de.style===X.b.BackwardDiagonal||de.style===X.b.DiagonalCross;return Me&&ge.code.add(oe.H`
      const mat2 rotate45 = mat2(${oe.H.float(U)}, ${oe.H.float(-ee)},
                                 ${oe.H.float(ee)}, ${oe.H.float(U)});
    `),de.draped||((0,Z.h)(ge,de),ge.uniforms.add(new ce.p("worldToScreenPerDistanceRatio",(Ee,Te)=>1/Te.camera.perScreenPixelRatio)),ge.code.add(oe.H`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),ge.code.add(oe.H`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),ge.code.add(oe.H`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${oe.H.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),ge.code.add(oe.H`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${Me?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${Me?" * rotate45":""};

      ${de.draped?"":oe.H`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${oe.H.float(de.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `),ge.code.add(oe.H`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${pe?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${he?oe.H`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:oe.H`transformPosition(proj, view, vpos);`}
    }
  `),_e.include(A.f5,de),ye.include(B.Y),de.draped&&ye.uniforms.add(new ce.p("texelSize",(Ee,Te)=>1/Te.camera.pixelRatio)),de.output===x.H.Highlight&&_e.include(re.bA),pe&&_e.include(J.l,de),de.output!==x.H.Highlight&&(ye.code.add(oe.H`
      const float lineWidth = ${oe.H.float(de.lineWidth)};
      const float spacing = ${oe.H.float(de.patternSpacing)};
      const float spacingINV = ${oe.H.float(1/de.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),de.draped||ye.code.add(oe.H`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),ye.uniforms.add(new ue.N("uColor",Ee=>Ee.color)),ye.code.add(oe.H`
    void main() {
      discardBySlice(vpos);
      ${pe?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${de.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${de.output!==x.H.Highlight?oe.H`color.a *= ${function se(de){function _e(pe){return de.draped?oe.H`coverage(vuv.${pe}, texelSize)`:oe.H`sample(vuv.${pe})`}switch(de.style){case X.b.ForwardDiagonal:case X.b.Horizontal:return _e("y");case X.b.BackwardDiagonal:case X.b.Vertical:return _e("x");case X.b.DiagonalCross:case X.b.Cross:return oe.H`
        1.0 - (1.0 - ${_e("x")}) * (1.0 - ${_e("y")})
      `;default:return"0.0"}}(de)};`:""}

      if (color.a < ${oe.H.float(W.b)}) {
        discard;
      }

      ${de.output===x.H.Alpha?oe.H`gl_FragColor = vec4(color.a);`:""}

      ${de.output===x.H.Color?oe.H`gl_FragColor = color; ${de.transparencyPassType===Y.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
      ${de.output===x.H.Highlight?oe.H`outputHighlight();`:""}
      ${de.output===x.H.Depth?oe.H`outputDepth(linearDepth);`:""};
    }
  `),_e}const ae=Object.freeze(Object.defineProperty({__proto__:null,build:ne},Symbol.toStringTag,{value:"Module"}))},5585:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>Z,b:()=>B});var x=T(6067),A=T(39704),G=T(84178),Q=T(17625),H=T(63123),re=T(46524),J=T(22355),W=T(16396);function B(ie){const ue=new J.kG;return ue.attributes.add(W.T.POSITION,"vec3"),ue.attributes.add(W.T.INSTANCEFEATUREATTRIBUTE,"float"),ue.vertex.uniforms.add(new A.K("cameraPosition")),ue.vertex.uniforms.add(new A.K("offset")),ue.vertex.uniforms.add(new G.d("width")),ue.vertex.uniforms.add(new H.g("proj",(ce,oe)=>oe.camera.projectionMatrix)),ue.vertex.uniforms.add(new re.B("view")),ue.vertex.uniforms.add(new G.d("time")),ue.varyings.add("vUv","vec2"),ue.vertex.code.add(Q.H`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${ie.type===x.H.Rain?Q.H`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:Q.H`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),ue.fragment.uniforms.add(new G.d("opacity")),ue.fragment.uniforms.add(new A.K("particleColor")),ue.fragment.code.add(Q.H`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${ie.type===x.H.Rain?Q.H`d = 0.35 * smoothstep(0.5, 0.0, d);`:Q.H`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `),ue}const Z=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}))},44796:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>ne,R:()=>ge,a:()=>se,b:()=>ae,c:()=>de});var x=T(62208),A=T(28093),G=T(62449),Q=T(7699),H=T(3802),re=T(76301),J=T(89798),W=T(87633),B=T(14273),Z=T(87204),ie=T(67668),ue=T(33726),ce=T(78038),oe=T(95285),le=T(97139),Y=T(65787),j=T(7090),X=T(18952),U=T(17625),ee=T(22355),$=T(35387);class ne extends re.J{constructor(Me,Ee,Te,me,Ce,Ie){super(Me,me,Ce),this.colormap=Ee,this.symbolizer=Te,this.u_colormap=Ie,this.backgroundColor=A.Z,this.fboTexture=null,this.baseOpacity=1}}class se extends ne{}class ae extends ne{}function de(ye){const Me=new ee.kG;Me.include(B.T),Me.include(re.G),Me.include(H.i),ye.tileBlendInput===W.R.GridComposite&&(Me.extensions.add("GL_OES_standard_derivatives"),Me.fragment.include(J.H));const Ee=ye.tileBlendInput===W.R.ColorComposite;Ee&&Me.fragment.uniforms.add(new le.J("backgroundColor",Ge=>Ge.backgroundColor)),ye.baseOpacityMode!==Z.a.One&&Me.fragment.uniforms.add(new Y.p("baseOpacity",Ge=>Ge.baseOpacity));const Te=ye.baseOpacityMode===Z.a.OnBaseLayer,me=ye.baseOpacityMode===Z.a.OnBackground||ye.baseOpacityMode===Z.a.OnBaseLayer,Ce=ye.blendMode!==Q.iM.Normal;Me.fragment.include(ie.d,ye);const Ie=ye.tileBlendInput!==W.R.LayerOnly;return(Ce&&!Ie||Te)&&(Me.fragment.uniforms.add(new $.A("fboColor",Ge=>Ge.fboTexture)),Me.fragment.uniforms.add(new Y.p("tileSize",Ge=>(0,x.pC)(Ge.fboTexture)?Ge.fboTexture.descriptor.width:1))),Me.fragment.code.add(U.H`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${Ie||Te?U.H`
          vec4 bgColor = ${Te?U.H`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:Ee?U.H`vec4(backgroundColor, 1.0)`:U.H`gridColor(vuv)`};
          ${me?U.H`bgColor *= baseOpacity;`:""}`:""}
      ${Ce?U.H`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${Ie?U.H`bgColor;`:U.H`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${Te?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:Ie||Te?U.H`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:U.H`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `),ye.colorizerType===G.U.Stretch?function pe(ye,Me){ye.fragment.uniforms.add([new X._("u_bandCount",Te=>Te.symbolizer.u_bandCount),new j.O("u_minCutOff",Te=>Te.symbolizer.u_minCutOff,3),new j.O("u_maxCutOff",Te=>Te.symbolizer.u_maxCutOff,3),new j.O("u_factor",Te=>Te.symbolizer.u_factor,3),new Y.p("u_minOutput",Te=>Te.symbolizer.u_minOutput),new Y.p("u_maxOutput",Te=>Te.symbolizer.u_maxOutput),new ce.U("u_useGamma",Te=>Te.symbolizer.u_useGamma),new j.O("u_gamma",Te=>Te.symbolizer.u_gamma,3),new j.O("u_gammaCorrection",Te=>Te.symbolizer.u_gammaCorrection,3),new Y.p("u_opacity",Te=>Te.common.u_opacity)]),ye.fragment.code.add(U.H`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const Ee=Me.applyColormap?U.H`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:U.H`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;ye.fragment.code.add(U.H`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${Me.stretchType===G.H.Noop?U.H`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:U.H`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${Ee}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}(Me,ye):ye.colorizerType===G.U.Lut?function _e(ye){ye.fragment.code.add(U.H`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}(Me):ye.colorizerType===G.U.Hillshade&&function he(ye,Me){const Ee=ye.fragment;Ee.uniforms.add([new $.A("u_image",me=>me.u_image),new X._("u_hillshadeType",me=>me.symbolizer.u_hillshadeType),new j.O("u_sinZcosAs",me=>me.symbolizer.u_sinZcosAs,6),new j.O("u_sinZsinAs",me=>me.symbolizer.u_sinZsinAs,6),new j.O("u_cosZs",me=>me.symbolizer.u_cosZs,6),new j.O("u_weights",me=>me.symbolizer.u_weights,6),new oe.A("u_factor",me=>me.symbolizer.u_factor),new Y.p("u_minValue",me=>me.symbolizer.u_minValue),new Y.p("u_maxValue",me=>me.symbolizer.u_maxValue),new oe.A("u_srcImageSize",me=>me.common.u_srcImageSize)]),Ee.include(ue.Y),Ee.code.add(U.H`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`),Ee.code.add(U.H`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const Te=Me.applyColormap?U.H`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:U.H`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;Ee.code.add(U.H`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${Te}
    }
  `)}(Me,ye),Me}const ge=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:ne,ColorizerStretchUniforms:se,ColorizerHillshadeUniforms:ae,build:de},Symbol.toStringTag,{value:"Module"}))},77133:(dt,Re,T)=>{"use strict";T.d(Re,{R:()=>Ie,b:()=>Ce});var x=T(52382),A=T(73132),G=T(6945),Q=T(78925),H=T(24255),re=T(60355),J=T(26859),W=T(84833),B=T(99579),Z=T(36603),ie=T(58173),ue=T(66085),ce=T(58208),oe=T(54662),le=T(13146),Y=T(10109),j=T(98898),X=T(92724),U=T(56693),ee=T(92836),$=T(67022),ne=T(93609),se=T(28137),ae=T(2166),de=T(97139),_e=T(69960),pe=T(65787),he=T(17625),ge=T(46524),ye=T(22355),Me=T(35387),Ee=T(42743),Te=T(16396),me=T(95279);function Ce(Ge){const Je=new ye.kG,xe=Je.vertex.code,je=Je.fragment.code,We=(0,ae.S)(Je,Ge);return Je.include(W.f),Je.varyings.add("vpos","vec3"),Je.include(ee.k,Ge),Je.include(re.f,Ge),Je.include(ue.L,Ge),Ge.output!==G.H.Color&&Ge.output!==G.H.Alpha||((0,ae.h)(Je.vertex,Ge),Je.include(J.O,Ge),Je.include(H.w),Ge.offsetBackfaces&&Je.include(A.w),Ge.instancedColor&&Je.attributes.add(Te.T.INSTANCECOLOR,"vec4"),Je.varyings.add("vNormalWorld","vec3"),Je.varyings.add("localvpos","vec3"),Ge.hasMultipassTerrain&&Je.varyings.add("depth","float"),Je.include(Z.D,Ge),Je.include(x.q,Ge),Je.include(B.R,Ge),Je.include(ie.c,Ge),Je.vertex.uniforms.add(new _e.N("externalColor",Ne=>Ne.externalColor)),Je.varyings.add("vcolorExt","vec4"),xe.add(he.H`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${Ge.instancedColor?"vcolorExt *= instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${he.H.float($.b)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${Ge.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${Ge.hasMultipassTerrain?he.H`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),Ge.output===G.H.Alpha&&(Je.include(Q.f5,Ge),Je.include(ne.z,Ge),Je.include(Y.l,Ge),Je.fragment.uniforms.add([new pe.p("opacity",Ne=>Ne.opacity),new pe.p("layerOpacity",Ne=>Ne.layerOpacity),new ge.B("view")]),Ge.hasColorTexture&&Je.fragment.uniforms.add(new Me.A("tex",Ne=>Ne.texture)),Je.fragment.include(se.y),je.add(he.H`
      void main() {
        discardBySlice(vpos);
        ${Ge.hasMultipassTerrain?he.H`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${Ge.hasColorTexture?he.H`
                vec4 texColor = texture2D(tex, vuv0);
                ${Ge.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:he.H`vec4 texColor = vec4(1.0);`}
        ${Ge.hasVertexColors?he.H`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:he.H`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `)),Ge.output===G.H.Color&&(Je.include(Q.f5,Ge),Je.include(le.X,Ge),Je.include(oe.K,Ge),Je.include(ne.z,Ge),Je.include(Ge.instancedDoublePrecision?U.hb:U.XE,Ge),Je.include(Y.l,Ge),(0,ae.h)(Je.fragment,Ge),Je.fragment.uniforms.add([We,new de.J("ambient",Ne=>Ne.ambient),new de.J("diffuse",Ne=>Ne.diffuse),new pe.p("opacity",Ne=>Ne.opacity),new pe.p("layerOpacity",Ne=>Ne.layerOpacity),new ge.B("view"),new pe.p("lightingGlobalFactor",(Ne,we)=>we.lighting.globalFactor),new de.J("lightingMainIntensity",(Ne,we)=>we.lighting.mainLight.intensity)]),Je.fragment.constants.add("ambientBoostFactor","float",me.V),Ge.hasColorTexture&&Je.fragment.uniforms.add(new Me.A("tex",Ne=>Ne.texture)),Je.include(X.jV,Ge),Je.include(j.T,Ge),Je.fragment.include(se.y),Je.extensions.add("GL_OES_standard_derivatives"),je.add(he.H`
      void main() {
        discardBySlice(vpos);
        ${Ge.hasMultipassTerrain?he.H`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${Ge.hasColorTexture?he.H`
                vec4 texColor = texture2D(tex, vuv0);
                ${Ge.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:he.H`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${Ge.pbrMode===X.f7.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${Ge.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":Ge.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${Ge.hasVertexColors?he.H`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:he.H`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${Ge.snowCover?he.H`albedo = mix(albedo, vec3(1), 0.9);`:he.H``}
        ${he.H`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${Ge.pbrMode===X.f7.Normal||Ge.pbrMode===X.f7.Schematic?Ge.spherical?he.H`vec3 normalGround = normalize(vpos + localOrigin);`:he.H`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:he.H``}
        ${Ge.pbrMode===X.f7.Normal||Ge.pbrMode===X.f7.Schematic?he.H`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${Ge.snowCover?he.H`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:he.H`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${Ge.transparencyPassType===Ee.Am.Color?he.H`gl_FragColor = premultiplyAlpha(gl_FragColor);`:he.H``}
      }
    `)),Je.include(ce.s,Ge),Je}const Ie=Object.freeze(Object.defineProperty({__proto__:null,build:Ce},Symbol.toStringTag,{value:"Module"}))},3393:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>$,R:()=>se,b:()=>ne});var x=T(62208),A=T(6945),G=T(78925),Q=T(39645),H=T(54120),re=T(92484),J=T(10109),W=T(39337),B=T(67022),Z=T(33726),ie=T(2166),ue=T(95285),ce=T(69960),oe=T(65787),le=T(17625),Y=T(63123),j=T(22355),X=T(42743),U=T(16396),ee=T(39401);const $=1;function ne(ae){const de=new j.kG,_e=ae.hasMultipassTerrain&&(ae.output===A.H.Color||ae.output===A.H.Alpha);de.include(W.e),de.include(Q.U,ae),de.include(re.q,ae),ae.output===A.H.Depth&&de.include(H.F,ae),(0,ie.S)(de,ae);const{vertex:pe,fragment:he}=de;pe.uniforms.add([new Y.g("inverseProjectionMatrix",(Ie,Ge)=>Ge.camera.inverseProjectionMatrix),new ue.A("nearFar",(Ie,Ge)=>Ge.camera.nearFar),new oe.p("miterLimit",Ie=>"miter"!==Ie.join?0:Ie.miterLimit),new ce.N("viewport",(Ie,Ge)=>Ge.camera.fullViewport)]),pe.constants.add("LARGE_HALF_FLOAT","float",65500),de.attributes.add(U.T.POSITION,"vec3"),de.attributes.add(U.T.SUBDIVISIONFACTOR,"float"),de.attributes.add(U.T.UV0,"vec2"),de.attributes.add(U.T.AUXPOS1,"vec3"),de.attributes.add(U.T.AUXPOS2,"vec3"),de.varyings.add("vColor","vec4"),de.varyings.add("vpos","vec3"),de.varyings.add("linearDepth","float"),_e&&de.varyings.add("depth","float");const ge=ae.capType===ee.R.ROUND,ye=ae.stippleEnabled&&ae.stippleScaleWithLineWidth||ge;ye&&de.varyings.add("vLineWidth","float");const Me=ae.stippleEnabled&&ae.stippleScaleWithLineWidth;Me&&de.varyings.add("vLineSizeInv","float");const Ee=ae.innerColorEnabled||ge;Ee&&de.varyings.add("vLineDistance","float");const Te=ae.stippleEnabled&&ge,me=ae.falloffEnabled||Te;return me&&de.varyings.add("vLineDistanceNorm","float"),ge&&(de.varyings.add("vSegmentSDF","float"),de.varyings.add("vReverseSegmentSDF","float")),pe.code.add(le.H`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),pe.code.add(le.H`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),pe.code.add(le.H`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${_e?"depth = pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),pe.uniforms.add(new oe.p("pixelRatio",(Ie,Ge)=>Ge.camera.pixelRatio)),pe.code.add(le.H`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${ye?le.H`vLineWidth = lineWidth;`:""}
      ${Me?le.H`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `),(ae.stippleEnabled||ge)&&pe.code.add(le.H`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${ge?le.H`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),pe.code.add(le.H`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),pe.code.add(ae.roundJoins?le.H`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${ae.stippleEnabled?le.H`min(1.0, subdivisionFactor * ${le.H.float(($+2)/($+1))})`:le.H`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `:le.H`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`),pe.code.add(le.H`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${ae.capType!==ee.R.BUTT?le.H`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),pe.code.add(le.H`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${me||Ee?le.H`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${Ee?le.H`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${me?le.H`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),ge&&pe.code.add(le.H`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),ae.stippleEnabled&&(ae.draped?pe.uniforms.add(new oe.p("worldToScreenRatio",(Ie,Ge)=>1/Ge.screenToPCSRatio)):pe.code.add(le.H`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),pe.code.add(le.H`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),pe.code.add(ae.draped?le.H`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`:le.H`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),pe.code.add(le.H`
      float patternLength = ${ae.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),pe.code.add(le.H`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${ae.wireframe&&!ae.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `),_e&&de.include(J.l,ae),de.include(G.f5,ae),he.include(Z.Y),he.code.add(le.H`
  void main() {
    discardBySlice(vpos);
    ${_e?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),ae.wireframe?he.code.add(le.H`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(ge&&he.code.add(le.H`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${le.H.float(B.b)}) {
        discard;
      }
    `),he.code.add(Te?le.H`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${le.H.float(B.b)}, stippleCoverage);
      `:le.H`float stippleAlpha = getStippleAlpha();`),he.uniforms.add(new ce.N("intrinsicColor",Ie=>Ie.color)),he.code.add(le.H`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),ae.innerColorEnabled&&(he.uniforms.add(new ce.N("innerColor",Ie=>(0,x.Pt)(Ie.innerColor,Ie.color))),he.uniforms.add(new oe.p("innerWidth",(Ie,Ge)=>Ie.innerWidth*Ge.camera.pixelRatio)),he.code.add(le.H`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),he.code.add(le.H`vec4 finalColor = blendStipple(color, stippleAlpha);`),ae.falloffEnabled&&(he.uniforms.add(new oe.p("falloff",Ie=>Ie.falloff)),he.code.add(le.H`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),he.code.add(le.H`
    if (finalColor.a < ${le.H.float(B.b)}) {
      discard;
    }

    ${ae.output===A.H.Alpha?le.H`gl_FragColor = vec4(finalColor.a);`:""}
    ${ae.output===A.H.Color?le.H`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${ae.output===A.H.Color&&ae.transparencyPassType===X.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    ${ae.output===A.H.Highlight?le.H`gl_FragColor = vec4(1.0);`:""}
    ${ae.output===A.H.Depth?le.H`outputDepth(linearDepth);`:""}
  }
  `),de}const se=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:$,build:ne},Symbol.toStringTag,{value:"Module"}))},7508:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>B,b:()=>W});var x=T(66054),A=T(17625),G=T(22355),Q=T(66838),H=T(53218),re=T(16396);function W(Z){const ie=new G.kG;return Z.output===H.f.EdgeDetector&&(ie.attributes.add(re.T.POSITION,"vec2"),ie.vertex.uniforms.add(new x.y("resolution")),ie.varyings.add("fTexCoord","vec2"),ie.varyings.add("fOffset[3]","vec4"),ie.vertex.code.add(A.H`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),ie.fragment.uniforms.add(new Q.Q("tColor")),ie.fragment.code.add(A.H`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${A.H.float(.05)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${A.H.float(2)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `)),Z.output===H.f.BlendWeight&&(ie.attributes.add(re.T.POSITION,"vec2"),ie.vertex.uniforms.add(new x.y("resolution")),ie.varyings.add("fTexCoord","vec2"),ie.varyings.add("fOffset[3]","vec4"),ie.varyings.add("fPixCoord","vec2"),ie.vertex.code.add(A.H`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${A.H.int(8)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),ie.fragment.uniforms.add(new Q.Q("tEdges")),ie.fragment.uniforms.add(new Q.Q("tArea")),ie.fragment.uniforms.add(new Q.Q("tSearch")),ie.fragment.uniforms.add(new Q.Q("tColor")),ie.fragment.uniforms.add(new x.y("resolution")),ie.fragment.code.add(A.H`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${A.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${A.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${A.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${A.H.int(8)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${A.H.int(16)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `)),Z.output===H.f.Blur&&(ie.attributes.add(re.T.POSITION,"vec2"),ie.vertex.uniforms.add(new x.y("resolution")),ie.varyings.add("fTexCoord","vec2"),ie.varyings.add("fOffset[2]","vec4"),ie.vertex.code.add(A.H`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),ie.fragment.uniforms.add(new Q.Q("tBlendWeights")),ie.fragment.uniforms.add(new Q.Q("tColor")),ie.fragment.uniforms.add(new x.y("resolution")),ie.fragment.code.add(A.H`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`)),ie}const B=Object.freeze(Object.defineProperty({__proto__:null,build:W},Symbol.toStringTag,{value:"Module"}))},52376:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>ce,b:()=>ue});var x=T(98071),A=T(47923),G=T(39832),Q=T(95285),H=T(65364),re=T(84178),J=T(17625),W=T(22355),B=T(66838),Z=T(76217);function ue(oe){const le=new W.kG,Y=le.fragment;if(le.include(x.k),oe.output===Z.Q.Blur){const j=2.5,X=1/(2*j*j);Y.include(A.S),Y.uniforms.add([new B.Q("normalMap"),new B.Q("depthMap"),new B.Q("tex"),new H.e("blurSize"),new re.d("projScale"),new Q.A("nearFar",(U,ee)=>ee.camera.nearFar)]),Y.code.add(J.H`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${J.H.float(X)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `),Y.code.add(J.H`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${J.H.int(4)}; r <= ${J.H.int(4)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}return oe.output===Z.Q.SSAO&&(Y.include(A.S),le.include(G.G),Y.uniforms.add(new B.Q("normalMap")),Y.uniforms.add(new B.Q("depthMap")),Y.uniforms.add(new B.Q("rnm")),Y.uniforms.add(new re.d("intensity")),Y.uniforms.add(new re.d("projScale")),Y.uniforms.add(new re.d("radius")),Y.uniforms.add(new Q.A("nearFar",(j,X)=>X.camera.nearFar)),Y.uniforms.add(new H.e("screenSize")),Y.uniforms.add(new H.e("rnmScale")),Y.code.add(J.H`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),Y.code.add(J.H`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),le.fragment.uniforms.add(new Q.A("zScale",(j,X)=>(0,G.R)(X))),Y.code.add(J.H`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${J.H.int(16)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${J.H.int(16)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `)),le}const ce=Object.freeze(Object.defineProperty({__proto__:null,build:ue},Symbol.toStringTag,{value:"Module"}))},94195:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>ce,a:()=>X,b:()=>Y,s:()=>oe});var x=T(28347),A=T(43703),G=T(98071),Q=T(47923),H=T(56693),re=T(39832),J=T(19278),W=T(95285),B=T(17625),Z=T(63123),ie=T(22355),ue=T(35387);class ce extends H.ry{}const oe=255,le=1/oe;function Y(){const U=new ie.kG,ee=U.fragment;return ee.include(J.n),ee.include(Q.S),U.include(re.G),U.include(G.k),U.include(H.hb,{receiveShadows:!0}),ee.uniforms.add([new ue.A("depthMap",$=>$.linearDepthTexture),new Z.g("inverseViewMatrix",($,ne)=>(0,x.a)(j,(0,x.j)(j,ne.camera.viewMatrix,ne.camera.center))),new W.A("nearFar",($,ne)=>ne.camera.nearFar)]),ee.constants.add("sampleValue","float",le),ee.code.add(B.H`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`),U}const j=(0,A.c)(),X=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:ce,shadowCastMaxSamples:oe,build:Y},Symbol.toStringTag,{value:"Module"}))},82148:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>ce,b:()=>ue});var x=T(98071),A=T(47923),G=T(39832),Q=T(19278),H=T(69960),re=T(65787),J=T(17625),W=T(22355),B=T(35387),Z=T(94195),ie=T(69828);function ue(oe){const le=new W.kG,Y=le.fragment;Y.include(Q.n),Y.include(A.S),le.include(G.G),le.include(x.k);const{visualization:j,bandsEnabled:X}=oe;Y.constants.add("inverseSampleValue","float",Z.s),Y.uniforms.add([new B.A("shadowCastMap",$=>$.shadowCastMap),new re.p("sampleScale",$=>$.sampleScale),new re.p("opacityFromElevation",$=>$.opacityFromElevation),new H.N("uColor",$=>$.color)]);const U=j===ie.w.Gradient,ee=j===ie.w.Threshold;return U&&X?Y.uniforms.add(new re.p("bandSize",$=>$.bandSize)):ee&&Y.uniforms.add(new re.p("threshold",$=>$.threshold)),Y.code.add(J.H`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${ee?J.H`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${U&&X?J.H`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${U?J.H`* strength`:""});
      }
    `),le}const ce=Object.freeze(Object.defineProperty({__proto__:null,build:ue},Symbol.toStringTag,{value:"Module"}))},19263:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>he,b:()=>ae});var x=T(62208),A=T(28347),G=T(43703),Q=T(67831),H=T(99770),re=T(84161),J=T(28093),W=T(98071),B=T(62952),Z=T(47923),ie=T(56693),ue=T(39832),ce=T(19278),oe=T(95285),le=T(97139),Y=T(69960),j=T(65787),X=T(17625),U=T(63123),ee=T(22355),$=T(35387),ne=T(53319);function ae(){const ge=new ee.kG;ge.include(ie.XE,{receiveShadows:!0});const ye=ge.fragment;return ye.include(ce.n),ye.include(Z.S),ge.include(ue.G),ge.include(W.k),ye.uniforms.add([new $.A("defaultDepthTex",(Me,Ee)=>Ee.shadowMap.getSnapshot(ne.i.Default)),new $.A("highlightDepthTex",(Me,Ee)=>Ee.shadowMap.getSnapshot(ne.i.Highlight)),new $.A("depthMap",(Me,Ee)=>Ee.linearDepthTexture),new $.A("highlightMap",(Me,Ee)=>Ee.highlightColorTexture),new Y.N("uColor",Me=>Me.shadowColor),new oe.A("nearFar",(Me,Ee)=>Ee.camera.nearFar),new j.p("opacity",Me=>Me.shadowOpacity),new j.p("occludedOpacity",Me=>Me.occludedShadowOpacity),new j.p("terminationFactor",Me=>Me.opacityElevation*Me.dayNightTerminator),new le.J("lightingMainDirectionView",(Me,Ee)=>(0,re.n)(_e,(0,re.m)(_e,Ee.lighting.lightingMainDirection,Ee.camera.viewInverseTransposeMatrix))),new oe.A("texelSize",(Me,Ee)=>(0,x.pC)(Ee.linearDepthTexture)?(0,Q.a)(pe,1/Ee.linearDepthTexture.descriptor.width,1/Ee.linearDepthTexture.descriptor.height):H.Z),new U.g("inverseViewMatrix",(Me,Ee)=>(0,A.a)(de,(0,A.j)(de,Ee.camera.viewMatrix,Ee.camera.center)))]),ye.constants.add("unoccludedHighlightFlag","vec4",B.ck).add("highlightedThreshold","float",.99999).add("selfShadowThreshold","float",.025),ye.code.add(X.H`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),ye.code.add(X.H`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),ge}const de=(0,G.c)(),_e=(0,J.c)(),pe=(0,H.a)(),he=Object.freeze(Object.defineProperty({__proto__:null,build:ae},Symbol.toStringTag,{value:"Module"}))},4300:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>ce,a:()=>le,b:()=>oe});var x=T(49115),A=T(24255),G=T(65364),Q=T(97139),H=T(39704),re=T(84178),J=T(17625),W=T(63123),B=T(46524),Z=T(22355),ie=T(35387),ue=T(16396);class ce extends J.K{}function oe(Y){const j=new Z.kG,{vertex:X,fragment:U}=j;if(Y.geometry===x.n.Underground)j.attributes.add(ue.T.POSITION,"vec2"),j.varyings.add("color","vec4"),X.uniforms.add([new Q.J("lightingMainDirection",(ee,$)=>$.lighting.lightingMainDirection),new H.K("cameraPosition"),new re.d("undergroundFadeAlpha")]),X.code.add(J.H`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),U.code.add(J.H`void main() {
gl_FragColor = color;
}`);else{j.include(A.w),j.attributes.add(ue.T.POSITION,"vec3"),j.varyings.add("vtc","vec2"),j.varyings.add("falloff","float");const ee=Y.geometry===x.n.Cylinder;X.uniforms.add([new W.g("proj",(se,ae)=>ae.camera.projectionMatrix),new B.B("view"),new Q.J("lightingMainDirection",(se,ae)=>ae.lighting.lightingMainDirection)]),ee||(j.varyings.add("innerFactor","float"),X.uniforms.add(new H.K("silCircleCenter")),X.uniforms.add(new H.K("silCircleV1")),X.uniforms.add(new H.K("silCircleV2")),X.uniforms.add(new G.e("texV")),X.uniforms.add(new re.d("innerScale")));const $=6.2831853,ne=1/128;X.code.add(J.H`
		void main(void) {
      ${ee?J.H`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:J.H`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${J.H.float($*ne)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${J.H.float(ne)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),U.uniforms.add(new ie.A("tex",se=>se.texture)),ee||U.uniforms.add(new re.d("altitudeFade")),U.code.add(J.H`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${ee?J.H`gl_FragColor = atmosphereColor;`:J.H`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return j}const le=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:ce,build:oe},Symbol.toStringTag,{value:"Module"}))},45695:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>ce,b:()=>Z});var x=T(28347),A=T(43703),G=T(35283),Q=T(69960),H=T(65787),re=T(17625),J=T(63123),W=T(22355),B=T(16396);function Z(){const oe=new W.kG;return oe.attributes.add(B.T.POSITION,"vec3"),oe.attributes.add(B.T.COLOR,"vec4"),oe.attributes.add(B.T.SIZE,"float"),oe.varyings.add("vcolor","vec4"),oe.varyings.add("vsize","float"),oe.vertex.uniforms.add([new J.g("transform",(le,Y)=>function ie(oe,le){return(0,x.c)(ue,le.camera.projectionMatrix),ue[10]=24e-8-1,ue[11]=-1,ue[14]=(24e-8-2)*le.camera.near,(0,x.m)(ue,ue,le.camera.viewMatrix),(0,x.m)(ue,ue,oe.modelMatrix)}(le,Y)),new Q.N("viewport",(le,Y)=>Y.camera.fullViewport),new H.p("pixelRatio",(le,Y)=>Y.camera.pixelRatio)]),oe.include(G.H),oe.vertex.code.add(re.H`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),oe.fragment.code.add(re.H`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`),oe}const ue=(0,A.c)(),ce=Object.freeze(Object.defineProperty({__proto__:null,build:Z},Symbol.toStringTag,{value:"Module"}))},73693:(dt,Re,T)=>{"use strict";T.d(Re,{T:()=>Me,a:()=>Ce,b:()=>Ee});var x=T(28347),A=T(43703),G=T(84161),Q=T(28093),H=T(75224),re=T(6945),J=T(78925),W=T(24255),B=T(43880),Z=T(54120),ie=T(62952),ue=T(54662),ce=T(13146),oe=T(7025),le=T(92724),Y=T(56693),j=T(30249),X=T(91528),U=T(411),ee=T(95285),$=T(77739),ne=T(97139),se=T(65787),ae=T(17625),de=T(47205),_e=T(63123),pe=T(22355),he=T(35387),ge=T(16396),ye=T(95279);class Me extends j.uS{}function Ee(Ie){const Ge=new pe.kG;Ge.include(U.a,{name:"Terrain Shader",output:Ie.output}),Ge.attributes.add(ge.T.POSITION,"vec3"),Ge.attributes.add(ge.T.UV0,"vec2"),Ge.attributes.add(ge.T.NORMAL,"vec3");const{vertex:Je,fragment:xe}=Ge;if(Je.uniforms.add([new _e.g("proj",(je,We)=>We.camera.projectionMatrix),new de.K("view",(je,We)=>(0,x.j)(Te,We.camera.viewMatrix,je.origin)),new $.B("origin",je=>je.origin)]),xe.uniforms.add(new $.B("origin",je=>je.origin)),Ie.output===re.H.Color){Ge.include(W.w),Ge.include(oe.n,Ie),Ge.include(X.E,Ie),Ge.include(ce.X,Ie);const je=Ie.overlayMode!==j.gT.Disabled,We=Ie.overlayMode===j.gT.EnabledWithWater;je&&Ge.include(j.yl,yi(or({},Ie),{pbrMode:le.f7.Water})),We&&Ge.include(B.M,Ie),Ge.varyings.add("vnormal","vec3"),Ge.varyings.add("vpos","vec3"),(Ie.atmosphere||Ie.screenSizePerspective)&&Je.uniforms.add(new _e.g("viewNormal",(we,Oe)=>Oe.camera.viewInverseTransposeMatrix));const Ne=Ie.receiveShadows&&!Ie.renderOccluded;Ne&&Ge.varyings.add("linearDepth","float"),Ie.tileBorders&&Ge.varyings.add("vuv","vec2"),Ie.atmosphere&&(Je.uniforms.add(new ne.J("lightingMainDirection",(we,Oe)=>Oe.lighting.lightingMainDirection)),Ge.varyings.add("wnormal","vec3"),Ge.varyings.add("wlight","vec3")),Ie.screenSizePerspective&&(Ge.varyings.add("screenSizeDistanceToCamera","float"),Ge.varyings.add("screenSizeCosAngle","float")),Je.code.add(ae.H`
      void main(void) {
        vpos = position;
        vnormal = ${Ie.shading?ae.H`normal`:ae.H`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${Ie.atmosphere?ae.H`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${Ie.tileBorders?ae.H`vuv = uv;`:""}
        ${Ie.screenSizePerspective?ae.H`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${Ne?ae.H`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${je?ae.H`setOverlayVTC(uv);`:""}
        ${We?ae.H`forwardVertexTangent(vnormal);`:ae.H``}
      }
    `),Ge.extensions.add("GL_OES_standard_derivatives"),Ge.extensions.add("GL_EXT_shader_texture_lod"),Ge.include(J.f5,Ie),Ge.include(ce.X,Ie),Ge.include(ue.K,Ie),Ge.include(Y.XE,Ie),xe.uniforms.add([new $.B("cameraPosition",(we,Oe)=>(0,G.b)(me,Oe.camera.eye,we.origin)),new ne.J("viewDirection",(we,Oe)=>(0,G.n)(me,(0,G.s)(me,Oe.camera.viewMatrix[12],Oe.camera.viewMatrix[13],Oe.camera.viewMatrix[14]))),new se.p("lightingGlobalFactor",(we,Oe)=>Oe.lighting.globalFactor),new ne.J("lightingMainDirection",(we,Oe)=>Oe.lighting.lightingMainDirection),new ne.J("lightingMainIntensity",(we,Oe)=>Oe.lighting.mainLight.intensity)]),xe.constants.add("ambientBoostFactor","float",ye.V),We&&xe.uniforms.add([new he.A("ovWaterTex",(we,Oe)=>0===Oe.overlays.length?null:Oe.overlays[H.fu.INNER].getNormalTexture(we.overlaySource)),new de.K("view",(we,Oe)=>(0,x.j)(Te,Oe.camera.viewMatrix,we.origin))]),xe.code.add(ae.H`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),xe.code.add(ae.H`
      void main() {
        ${Ne?ae.H`float shadow = readShadowMap(vpos, linearDepth);`:ae.H`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${je?ae.H`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${Ie.atmosphere?ae.H`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${Ie.atmosphere?ae.H`atm + tileColor.rgb;`:ae.H`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${Ie.shading?"":ae.H`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${Ie.shading?"":ae.H`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${We?ae.H`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${Ie.screenSizePerspective?ae.H`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${Ie.tileBorders?ae.H`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}return Ie.output!==re.H.Depth&&Ie.output!==re.H.Shadow||(Ge.include(W.w,{hasModelTransformation:!1,linearDepth:!0}),Ge.include(Z.F,{output:Ie.output}),Ge.include(oe.n,Ie),Ge.varyings.add("linearDepth","float"),Je.uniforms.add(new ee.A("nearFar",(je,We)=>We.camera.nearFar)),Je.code.add(ae.H`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),xe.code.add(ae.H`void main() {
outputDepth(linearDepth);
}`)),Ie.output===re.H.Normal&&(Ge.include(W.w),Ge.include(oe.n,Ie),Ge.varyings.add("vnormal","vec3"),Ge.varyings.add("vpos","vec3"),Je.uniforms.add(new _e.g("viewNormal",(je,We)=>We.camera.viewInverseTransposeMatrix)),Je.code.add(ae.H`
        void main(void) {
          vec3 normal = ${Ie.shading?ae.H`normal`:ae.H`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),xe.code.add(ae.H`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`)),Ie.output===re.H.Highlight&&(Ge.include(W.w),Ge.include(oe.n,Ie),Ge.include(j.yl,Ie),Je.code.add(ae.H`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),Ge.include(ie.bA),xe.code.add(ae.H`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`)),Ge}const Te=(0,A.c)(),me=(0,Q.c)(),Ce=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:Me,build:Ee},Symbol.toStringTag,{value:"Module"}))},98361:(dt,Re,T)=>{"use strict";T.d(Re,{T:()=>J,b:()=>re});var x=T(98071),A=T(66054),G=T(17625),Q=T(22355),H=T(66838);function re(){const W=new Q.kG;return W.include(x.k),W.fragment.uniforms.add([new H.Q("tex"),new A.y("uColor")]),W.fragment.code.add(G.H`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`),W}const J=Object.freeze(Object.defineProperty({__proto__:null,build:re},Symbol.toStringTag,{value:"Module"}))},61584:(dt,Re,T)=>{"use strict";T.d(Re,{W:()=>pe,b:()=>_e});var x=T(52382),A=T(6945),G=T(78925),Q=T(24255),H=T(62952),re=T(44965),J=T(31166),W=T(10109),B=T(7025),Z=T(92724),ie=T(56693),ue=T(69117),ce=T(45780),oe=T(67022),le=T(33726),Y=T(2166),j=T(97139),X=T(69960),U=T(66054),ee=T(65787),$=T(17625),ne=T(46524),se=T(22355),ae=T(42743),de=T(16396);function _e(he){const ge=new se.kG,{vertex:ye,fragment:Me}=ge,Ee=(0,Y.S)(ge,he);return ge.include(Q.w),ge.attributes.add(de.T.POSITION,"vec3"),ge.attributes.add(de.T.UV0,"vec2"),ye.uniforms.add(new X.N("waterColor",Te=>Te.color)),he.output!==A.H.Color&&he.output!==A.H.Alpha||(ge.include(B.n,he),ge.include(x.q,he),ge.varyings.add("vuv","vec2"),ge.varyings.add("vpos","vec3"),ge.varyings.add("vnormal","vec3"),ge.varyings.add("vtbnMatrix","mat3"),Me.uniforms.add(Ee),he.hasMultipassTerrain&&ge.varyings.add("depth","float"),ye.code.add($.H`
      void main(void) {
        if (waterColor.a < ${$.H.float(oe.b)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${he.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${he.output===A.H.Color?"forwardLinearDepth();":""}
      }
    `)),ge.include(W.l,he),he.output===A.H.Alpha&&(ge.include(G.f5,he),Me.uniforms.add(new U.y("waterColor")),Me.code.add($.H`
        void main() {
          discardBySlice(vpos);
          ${he.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `)),he.output===A.H.Color&&(ge.include(J.k,{isGround:!1}),ge.include(re._,{pbrMode:Z.f7.Disabled,lightingSphericalHarmonicsOrder:2}),ge.include(ce.M),ge.include(G.f5,he),ge.include(ie.XE,he),ge.include(ue.B,he),Me.uniforms.add([new U.y("waterColor"),new j.J("lightingMainDirection",(Te,me)=>me.lighting.lightingMainDirection),new j.J("lightingMainIntensity",(Te,me)=>me.lighting.mainLight.intensity),new ee.p("timeElapsed",Te=>Te.timeElapsed),new ne.B("view")]),(0,Y.h)(Me,he),Me.include(le.Y),Me.code.add($.H`
      void main() {
        discardBySlice(vpos);
        ${he.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${he.receiveShadows?$.H`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${he.transparencyPassType===ae.Am.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
      }
    `)),he.output===A.H.Normal&&(ge.include(B.n,he),ge.include(ce.M,he),ge.include(G.f5,he),ge.varyings.add("vpos","vec3"),ge.varyings.add("vuv","vec2"),ye.code.add($.H`
        void main(void) {
          if (waterColor.a < ${$.H.float(oe.b)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),Me.uniforms.add(new ee.p("timeElapsed",Te=>Te.timeElapsed)),Me.code.add($.H`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`)),he.output===A.H.Draped&&(ge.varyings.add("vpos","vec3"),ye.code.add($.H`
        void main(void) {
          if (waterColor.a < ${$.H.float(oe.b)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),Me.uniforms.add(new U.y("waterColor")),Me.code.add($.H`void main() {
gl_FragColor = waterColor;
}`)),he.output===A.H.Highlight&&(ge.include(H.bA),ge.varyings.add("vpos","vec3"),ye.code.add($.H`
      void main(void) {
        if (waterColor.a < ${$.H.float(oe.b)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),ge.include(G.f5,he),Me.code.add($.H`void main() {
discardBySlice(vpos);
outputHighlight();
}`)),ge}const pe=Object.freeze(Object.defineProperty({__proto__:null,build:_e},Symbol.toStringTag,{value:"Module"}))},1719:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>G,c:()=>x,g:()=>A});var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function A(Q){return Q&&Q.__esModule&&Object.prototype.hasOwnProperty.call(Q,"default")?Q.default:Q}function G(Q){throw new Error('Could not dynamically require "'+Q+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}},41743:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>Y,a:()=>U,b:()=>et,c:()=>j,d:()=>xe,e:()=>Ce,f:()=>$,g:()=>de,h:()=>Te,i:()=>_e,n:()=>Ne,r:()=>We,t:()=>je,u:()=>ne}),T(8314);var A=T(63290),G=T(21286),Q=T(97535),H=T(28347),re=T(43703),J=T(84161),W=T(28093),B=T(78172),Z=T(13777),ie=T(90014),ue=T(70562),ce=T(34054),oe=T(26242);const le=A.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class Y{constructor(){this.plane=(0,ie.Ue)(),this.origin=(0,W.c)(),this.basis1=(0,W.c)(),this.basis2=(0,W.c)()}}function j(ke=Fe){return{plane:(0,ie.Ue)(ke.plane),origin:(0,W.a)(ke.origin),basis1:(0,W.a)(ke.basis1),basis2:(0,W.a)(ke.basis2)}}function U(ke,ot=j()){return $(ke.origin,ke.basis1,ke.basis2,ot)}function $(ke,ot,at,yt=j()){return(0,J.c)(yt.origin,ke),(0,J.c)(yt.basis1,ot),(0,J.c)(yt.basis2,at),ne(yt),function Se(ke,ot){Math.abs((0,J.e)(ke.basis1,ke.basis2)/((0,J.l)(ke.basis1)*(0,J.l)(ke.basis2)))>1e-6&&le.warn(ot,"Provided basis vectors are not perpendicular"),Math.abs((0,J.e)(ke.basis1,Ne(ke)))>1e-6&&le.warn(ot,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,J.e)(Ne(ke),ke.origin)-ke.plane[3])>1e-6&&le.warn(ot,"Plane offset is not consistent with plane origin")}(yt,"fromValues()"),yt}function ne(ke){(0,ie.my)(ke.basis2,ke.basis1,ke.origin,ke.plane)}function se(ke,ot,at){ke!==at&&U(ke,at);const yt=(0,J.g)(oe.WM.get(),Ne(ke),ot);return(0,J.a)(at.origin,at.origin,yt),at.plane[3]-=ot,at}function de(ke,ot=j()){const at=(ke[2]-ke[0])/2,yt=(ke[3]-ke[1])/2;return(0,J.s)(ot.origin,ke[0]+at,ke[1]+yt,0),(0,J.s)(ot.basis1,at,0,0),(0,J.s)(ot.basis2,0,yt,0),(0,ie.al)(0,0,1,0,ot.plane),ot}function _e(ke,ot,at){return!!(0,ie.BR)(ke.plane,ot,at)&&Oe(ke,at)}function he(ke,ot,at){const yt=ve.get();De(ke,ot,yt,ve.get());let wt=Number.POSITIVE_INFINITY;for(const zt of tt){const Rt=Be(ke,zt,Ke.get()),Ft=oe.WM.get();if((0,ie.rx)(yt,Rt,Ft)){const bt=(0,J.r)(oe.WM.get(),ot.origin,Ft),St=Math.abs((0,G.ZF)((0,J.e)(ot.direction,bt)));St<wt&&(wt=St,(0,J.c)(at,Ft))}}return wt===Number.POSITIVE_INFINITY?ge(ke,ot,at):at}function ge(ke,ot,at){if(_e(ke,ot,at))return at;const yt=ve.get(),wt=ve.get();De(ke,ot,yt,wt);let zt=Number.POSITIVE_INFINITY;for(const Rt of tt){const Ft=Be(ke,Rt,Ke.get()),bt=oe.WM.get();if((0,ie.dZ)(yt,Ft,bt)){const St=(0,ue.Jk)(ot,bt);if(!(0,ie.Ac)(wt,bt))continue;St<zt&&(zt=St,(0,J.c)(at,bt))}}return Ee(ke,ot.origin)<zt&&ye(ke,ot.origin,at),at}function ye(ke,ot,at){const yt=(0,ie.nF)(ke.plane,ot,oe.WM.get()),wt=(0,Z.ct)($e(ke,ke.basis1),yt,-1,1,oe.WM.get()),zt=(0,Z.ct)($e(ke,ke.basis2),yt,-1,1,oe.WM.get());return(0,J.b)(at,(0,J.a)(oe.WM.get(),wt,zt),ke.origin),at}function Me(ke,ot,at){const{origin:yt,basis1:wt,basis2:zt}=ke,Rt=(0,J.b)(oe.WM.get(),ot,yt),Ft=(0,ce.SR)(wt,Rt),bt=(0,ce.SR)(zt,Rt),St=(0,ce.SR)(Ne(ke),Rt);return(0,J.s)(at,Ft,bt,St)}function Ee(ke,ot){const at=Me(ke,ot,oe.WM.get()),{basis1:yt,basis2:wt}=ke,zt=(0,J.l)(yt),Rt=(0,J.l)(wt),Ft=Math.max(Math.abs(at[0])-zt,0),bt=Math.max(Math.abs(at[1])-Rt,0),St=at[2];return Ft*Ft+bt*bt+St*St}function Te(ke,ot){return Math.sqrt(Ee(ke,ot))}function Ce(ke,ot){return(0,ie.Ac)(ke.plane,ot)&&Oe(ke,ot)}function Ge(ke,ot){const at=-ke.plane[3];return(0,ce.SR)(Ne(ke),ot)-at}function xe(ke,ot){return(0,J.k)(ke.basis1,ot.basis1)&&(0,J.k)(ke.basis2,ot.basis2)&&(0,J.k)(ke.origin,ot.origin)}function je(ke,ot,at){return ke!==at&&U(ke,at),(0,H.a)(Ye,ot),(0,H.t)(Ye,Ye),(0,J.m)(at.basis1,ke.basis1,Ye),(0,J.m)(at.basis2,ke.basis2,Ye),(0,J.m)((0,ie.mJ)(at.plane),(0,ie.mJ)(ke.plane),Ye),(0,J.m)(at.origin,ke.origin,ot),(0,ie.T5)(at.plane,at.plane,at.origin),at}function We(ke,ot,at,yt){return ke!==yt&&U(ke,yt),(0,H.d)(ze,ot,at),(0,J.m)(yt.basis1,ke.basis1,ze),(0,J.m)(yt.basis2,ke.basis2,ze),ne(yt),yt}function Ne(ke){return(0,ie.mJ)(ke.plane)}function Oe(ke,ot){const at=(0,J.b)(oe.WM.get(),ot,ke.origin),yt=(0,J.p)(ke.basis1),wt=(0,J.p)(ke.basis2),zt=(0,J.e)(ke.basis1,at),Rt=(0,J.e)(ke.basis2,at);return-zt-yt<0&&zt-yt<0&&-Rt-wt<0&&Rt-wt<0}function $e(ke,ot){const at=Ke.get();return(0,J.c)(at.origin,ke.origin),(0,J.c)(at.vector,ot),at}function Be(ke,ot,at){const{basis1:yt,basis2:wt,origin:zt}=ke,Rt=(0,J.g)(oe.WM.get(),yt,ot.origin[0]),Ft=(0,J.g)(oe.WM.get(),wt,ot.origin[1]);(0,J.a)(at.origin,Rt,Ft),(0,J.a)(at.origin,at.origin,zt);const bt=(0,J.g)(oe.WM.get(),yt,ot.direction[0]),St=(0,J.g)(oe.WM.get(),wt,ot.direction[1]);return(0,J.g)(at.vector,(0,J.a)(bt,bt,St),2),at}function De(ke,ot,at,yt){const wt=Ne(ke);(0,ie.my)(wt,ot.direction,ot.origin,at),(0,ie.my)((0,ie.mJ)(at),wt,ot.origin,yt)}const Fe={plane:(0,ie.Ue)(),origin:(0,W.f)(0,0,0),basis1:(0,W.f)(1,0,0),basis2:(0,W.f)(0,1,0)},ve=new Q.x(ie.Ue),Ke=new Q.x(Z.Ue),qe=(0,W.c)(),be=new Q.x(()=>({origin:null,basis1:null,basis2:null,plane:null})),tt=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Ye=(0,re.c)(),ze=(0,re.c)(),et=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:Y,create:j,wrap:function X(ke,ot,at){const yt=be.get();return yt.origin=ke,yt.basis1=ot,yt.basis2=at,yt.plane=(0,ie.re)(0,0,0,0),ne(yt),yt},copy:U,copyWithoutVerify:function ee(ke,ot){(0,J.c)(ot.origin,ke.origin),(0,J.c)(ot.basis1,ke.basis1),(0,J.c)(ot.basis2,ke.basis2),(0,ie.JG)(ot.plane,ke.plane)},fromValues:$,updateUnboundedPlane:ne,elevate:se,setExtent:function ae(ke,ot,at){return de(ot,at),se(at,Ge(ke,ke.origin),at),at},fromAABoundingRect:de,intersectRay:_e,intersectRayClosestSilhouette:function pe(ke,ot,at){if(_e(ke,ot,at))return at;const yt=he(ke,ot,oe.WM.get());return(0,J.a)(at,ot.origin,(0,J.g)(oe.WM.get(),ot.direction,(0,J.i)(ot.origin,yt)/(0,J.l)(ot.direction))),at},closestPointOnSilhouette:he,closestPoint:ge,projectPoint:ye,projectPointLocal:Me,distance2:Ee,distance:Te,distanceToSilhouette:function me(ke,ot){let at=Number.NEGATIVE_INFINITY;for(const yt of tt){const wt=Be(ke,yt,Ke.get()),zt=(0,Z.Jk)(wt,ot);zt>at&&(at=zt)}return Math.sqrt(at)},extrusionContainsPoint:Ce,axisAt:function Ie(ke,ot,at,yt){return function we(ke,ot,at){switch(ot){case B.R.X:(0,J.c)(at,ke.basis1),(0,J.n)(at,at);break;case B.R.Y:(0,J.c)(at,ke.basis2),(0,J.n)(at,at);break;case B.R.Z:(0,J.c)(at,Ne(ke))}return at}(ke,at,yt)},altitudeAt:Ge,setAltitudeAt:function Je(ke,ot,at,yt){const wt=Ge(ke,ot),zt=(0,J.g)(qe,Ne(ke),at-wt);return(0,J.a)(yt,ot,zt),yt},equals:xe,transform:je,rotate:We,normal:Ne,UP:Fe},Symbol.toStringTag,{value:"Module"}))},39863:(dt,Re,T)=>{"use strict";T.d(Re,{E:()=>x,R:()=>A,t:()=>H});const x=1e-6,A=Math.random,G=Math.PI/180,Q=180/Math.PI;function H(B){return B*G}Object.freeze(Object.defineProperty({__proto__:null,EPSILON:x,RANDOM:A,toRadian:H,toDegree:function re(B){return B*Q},equals:function J(B,Z){return Math.abs(B-Z)<=x*Math.max(1,Math.abs(B),Math.abs(Z))}},Symbol.toStringTag,{value:"Module"}))},11915:(dt,Re,T)=>{"use strict";T.d(Re,{e:()=>H});var x,G,Q={exports:{}};x=Q,void 0!==(G=function(){function re(xe,je,We){We=We||2;var Ne,we,Oe,$e,Be,Se,De,Fe=je&&je.length,ve=Fe?je[0]*We:xe.length,Ke=J(xe,0,ve,We,!0),qe=[];if(!Ke||Ke.next===Ke.prev)return qe;if(Fe&&(Ke=function oe(xe,je,We,Ne){var we,Oe,$e,Be=[];for(we=0,Oe=je.length;we<Oe;we++)($e=J(xe,je[we]*Ne,we<Oe-1?je[we+1]*Ne:xe.length,Ne,!1))===$e.next&&($e.steiner=!0),Be.push(se($e));for(Be.sort(le),we=0;we<Be.length;we++)We=W(We=j(Be[we],We),We.next);return We}(xe,je,Ke,We)),xe.length>80*We){Ne=Oe=xe[0],we=$e=xe[1];for(var be=We;be<ve;be+=We)(Be=xe[be])<Ne&&(Ne=Be),(Se=xe[be+1])<we&&(we=Se),Be>Oe&&(Oe=Be),Se>$e&&($e=Se);De=0!==(De=Math.max(Oe-Ne,$e-we))?1/De:0}return B(Ke,qe,We,Ne,we,De),qe}function J(xe,je,We,Ne,we){var Oe,$e;if(we===Je(xe,je,We,Ne)>0)for(Oe=je;Oe<We;Oe+=Ne)$e=Ce(Oe,xe[Oe],xe[Oe+1],$e);else for(Oe=We-Ne;Oe>=je;Oe-=Ne)$e=Ce(Oe,xe[Oe],xe[Oe+1],$e);if($e&&pe($e,$e.next)){var Be=$e.next;Ie($e),$e=Be}return $e}function W(xe,je){if(!xe)return xe;je||(je=xe);var We,Ne=xe;do{if(We=!1,Ne.steiner||!pe(Ne,Ne.next)&&0!==_e(Ne.prev,Ne,Ne.next))Ne=Ne.next;else{var we=Ne.prev;if(Ie(Ne),(Ne=je=we)===Ne.next)break;We=!0}}while(We||Ne!==je);return je}function B(xe,je,We,Ne,we,Oe,$e){if(xe){!$e&&Oe&&function ee(xe,je,We,Ne){var we=xe;do{null===we.z&&(we.z=ne(we.x,we.y,je,We,Ne)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next}while(we!==xe);we.prevZ.nextZ=null,we.prevZ=null,function $(xe){var je,We,Ne,we,Oe,$e,Be,Se,De=1;do{for(We=xe,xe=null,Oe=null,$e=0;We;){for($e++,Ne=We,Be=0,je=0;je<De&&(Be++,Ne=Ne.nextZ);je++);for(Se=De;Be>0||Se>0&&Ne;)0!==Be&&(0===Se||!Ne||We.z<=Ne.z)?(we=We,We=We.nextZ,Be--):(we=Ne,Ne=Ne.nextZ,Se--),Oe?Oe.nextZ=we:xe=we,we.prevZ=Oe,Oe=we;We=Ne}Oe.nextZ=null,De*=2}while($e>1)}(we)}(xe,Ne,we,Oe);for(var Be,Se,De=xe;xe.prev!==xe.next;)if(Be=xe.prev,Se=xe.next,Oe?ie(xe,Ne,we,Oe):Z(xe))je.push(Be.i/We),je.push(xe.i/We),je.push(Se.i/We),Ie(xe),xe=Se.next,De=Se.next;else if((xe=Se)===De){$e?1===$e?B(xe=ue(W(xe),je,We),je,We,Ne,we,Oe,2):2===$e&&ce(xe,je,We,Ne,we,Oe):B(W(xe),je,We,Ne,we,Oe,1);break}}}function Z(xe){var je=xe.prev,We=xe,Ne=xe.next;if(_e(je,We,Ne)>=0)return!1;for(var we=xe.next.next;we!==xe.prev;){if(ae(je.x,je.y,We.x,We.y,Ne.x,Ne.y,we.x,we.y)&&_e(we.prev,we,we.next)>=0)return!1;we=we.next}return!0}function ie(xe,je,We,Ne){var we=xe.prev,Oe=xe,$e=xe.next;if(_e(we,Oe,$e)>=0)return!1;for(var De=we.x>Oe.x?we.x>$e.x?we.x:$e.x:Oe.x>$e.x?Oe.x:$e.x,Fe=we.y>Oe.y?we.y>$e.y?we.y:$e.y:Oe.y>$e.y?Oe.y:$e.y,ve=ne(we.x<Oe.x?we.x<$e.x?we.x:$e.x:Oe.x<$e.x?Oe.x:$e.x,we.y<Oe.y?we.y<$e.y?we.y:$e.y:Oe.y<$e.y?Oe.y:$e.y,je,We,Ne),Ke=ne(De,Fe,je,We,Ne),qe=xe.prevZ,be=xe.nextZ;qe&&qe.z>=ve&&be&&be.z<=Ke;){if(qe!==xe.prev&&qe!==xe.next&&ae(we.x,we.y,Oe.x,Oe.y,$e.x,$e.y,qe.x,qe.y)&&_e(qe.prev,qe,qe.next)>=0||(qe=qe.prevZ,be!==xe.prev&&be!==xe.next&&ae(we.x,we.y,Oe.x,Oe.y,$e.x,$e.y,be.x,be.y)&&_e(be.prev,be,be.next)>=0))return!1;be=be.nextZ}for(;qe&&qe.z>=ve;){if(qe!==xe.prev&&qe!==xe.next&&ae(we.x,we.y,Oe.x,Oe.y,$e.x,$e.y,qe.x,qe.y)&&_e(qe.prev,qe,qe.next)>=0)return!1;qe=qe.prevZ}for(;be&&be.z<=Ke;){if(be!==xe.prev&&be!==xe.next&&ae(we.x,we.y,Oe.x,Oe.y,$e.x,$e.y,be.x,be.y)&&_e(be.prev,be,be.next)>=0)return!1;be=be.nextZ}return!0}function ue(xe,je,We){var Ne=xe;do{var we=Ne.prev,Oe=Ne.next.next;!pe(we,Oe)&&he(we,Ne,Ne.next,Oe)&&Ee(we,Oe)&&Ee(Oe,we)&&(je.push(we.i/We),je.push(Ne.i/We),je.push(Oe.i/We),Ie(Ne),Ie(Ne.next),Ne=xe=Oe),Ne=Ne.next}while(Ne!==xe);return W(Ne)}function ce(xe,je,We,Ne,we,Oe){var $e=xe;do{for(var Be=$e.next.next;Be!==$e.prev;){if($e.i!==Be.i&&de($e,Be)){var Se=me($e,Be);return $e=W($e,$e.next),Se=W(Se,Se.next),B($e,je,We,Ne,we,Oe),void B(Se,je,We,Ne,we,Oe)}Be=Be.next}$e=$e.next}while($e!==xe)}function le(xe,je){return xe.x-je.x}function Y(xe){if(xe.next.prev===xe)return xe;let je=xe;for(;;){const We=je.next;if(We.prev===je||We===je||We===xe)break;je=We}return je}function j(xe,je){var We=function X(xe,je){var We,Ne=je,we=xe.x,Oe=xe.y,$e=-1/0;do{if(Oe<=Ne.y&&Oe>=Ne.next.y&&Ne.next.y!==Ne.y){var Be=Ne.x+(Oe-Ne.y)*(Ne.next.x-Ne.x)/(Ne.next.y-Ne.y);if(Be<=we&&Be>$e){if($e=Be,Be===we){if(Oe===Ne.y)return Ne;if(Oe===Ne.next.y)return Ne.next}We=Ne.x<Ne.next.x?Ne:Ne.next}}Ne=Ne.next}while(Ne!==je);if(!We)return null;if(we===$e)return We;var Se,De=We,Fe=We.x,ve=We.y,Ke=1/0;Ne=We;do{we>=Ne.x&&Ne.x>=Fe&&we!==Ne.x&&ae(Oe<ve?we:$e,Oe,Fe,ve,Oe<ve?$e:we,Oe,Ne.x,Ne.y)&&(Se=Math.abs(Oe-Ne.y)/(we-Ne.x),Ee(Ne,xe)&&(Se<Ke||Se===Ke&&(Ne.x>We.x||Ne.x===We.x&&U(We,Ne)))&&(We=Ne,Ke=Se)),Ne=Ne.next}while(Ne!==De);return We}(xe,je);if(!We)return je;var Ne=me(We,xe),we=W(We,We.next);let Oe=Y(Ne);return W(Oe,Oe.next),we=Y(we),Y(je===We?we:je)}function U(xe,je){return _e(xe.prev,xe,je.prev)<0&&_e(je.next,xe,xe.next)<0}function ne(xe,je,We,Ne,we){return(xe=1431655765&((xe=858993459&((xe=252645135&((xe=16711935&((xe=32767*(xe-We)*we)|xe<<8))|xe<<4))|xe<<2))|xe<<1))|(je=1431655765&((je=858993459&((je=252645135&((je=16711935&((je=32767*(je-Ne)*we)|je<<8))|je<<4))|je<<2))|je<<1))<<1}function se(xe){var je=xe,We=xe;do{(je.x<We.x||je.x===We.x&&je.y<We.y)&&(We=je),je=je.next}while(je!==xe);return We}function ae(xe,je,We,Ne,we,Oe,$e,Be){return(we-$e)*(je-Be)-(xe-$e)*(Oe-Be)>=0&&(xe-$e)*(Ne-Be)-(We-$e)*(je-Be)>=0&&(We-$e)*(Oe-Be)-(we-$e)*(Ne-Be)>=0}function de(xe,je){return xe.next.i!==je.i&&xe.prev.i!==je.i&&!function Me(xe,je){var We=xe;do{if(We.i!==xe.i&&We.next.i!==xe.i&&We.i!==je.i&&We.next.i!==je.i&&he(We,We.next,xe,je))return!0;We=We.next}while(We!==xe);return!1}(xe,je)&&(Ee(xe,je)&&Ee(je,xe)&&function Te(xe,je){var We=xe,Ne=!1,we=(xe.x+je.x)/2,Oe=(xe.y+je.y)/2;do{We.y>Oe!=We.next.y>Oe&&We.next.y!==We.y&&we<(We.next.x-We.x)*(Oe-We.y)/(We.next.y-We.y)+We.x&&(Ne=!Ne),We=We.next}while(We!==xe);return Ne}(xe,je)&&(_e(xe.prev,xe,je.prev)||_e(xe,je.prev,je))||pe(xe,je)&&_e(xe.prev,xe,xe.next)>0&&_e(je.prev,je,je.next)>0)}function _e(xe,je,We){return(je.y-xe.y)*(We.x-je.x)-(je.x-xe.x)*(We.y-je.y)}function pe(xe,je){return xe.x===je.x&&xe.y===je.y}function he(xe,je,We,Ne){var we=ye(_e(xe,je,We)),Oe=ye(_e(xe,je,Ne)),$e=ye(_e(We,Ne,xe)),Be=ye(_e(We,Ne,je));return we!==Oe&&$e!==Be||!(0!==we||!ge(xe,We,je))||!(0!==Oe||!ge(xe,Ne,je))||!(0!==$e||!ge(We,xe,Ne))||!(0!==Be||!ge(We,je,Ne))}function ge(xe,je,We){return je.x<=Math.max(xe.x,We.x)&&je.x>=Math.min(xe.x,We.x)&&je.y<=Math.max(xe.y,We.y)&&je.y>=Math.min(xe.y,We.y)}function ye(xe){return xe>0?1:xe<0?-1:0}function Ee(xe,je){return _e(xe.prev,xe,xe.next)<0?_e(xe,je,xe.next)>=0&&_e(xe,xe.prev,je)>=0:_e(xe,je,xe.prev)<0||_e(xe,xe.next,je)<0}function me(xe,je){var We=new Ge(xe.i,xe.x,xe.y),Ne=new Ge(je.i,je.x,je.y),we=xe.next,Oe=je.prev;return xe.next=je,je.prev=xe,We.next=we,we.prev=We,Ne.next=We,We.prev=Ne,Oe.next=Ne,Ne.prev=Oe,Ne}function Ce(xe,je,We,Ne){var we=new Ge(xe,je,We);return Ne?(we.next=Ne.next,we.prev=Ne,Ne.next.prev=we,Ne.next=we):(we.prev=we,we.next=we),we}function Ie(xe){xe.next.prev=xe.prev,xe.prev.next=xe.next,xe.prevZ&&(xe.prevZ.nextZ=xe.nextZ),xe.nextZ&&(xe.nextZ.prevZ=xe.prevZ)}function Ge(xe,je,We){this.i=xe,this.x=je,this.y=We,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Je(xe,je,We,Ne){for(var we=0,Oe=je,$e=We-Ne;Oe<We;Oe+=Ne)we+=(xe[$e]-xe[Oe])*(xe[Oe+1]+xe[$e+1]),$e=Oe;return we}return re.deviation=function(xe,je,We,Ne){var we=je&&je.length,$e=Math.abs(Je(xe,0,we?je[0]*We:xe.length,We));if(we)for(var Be=0,Se=je.length;Be<Se;Be++)$e-=Math.abs(Je(xe,je[Be]*We,Be<Se-1?je[Be+1]*We:xe.length,We));var ve=0;for(Be=0;Be<Ne.length;Be+=3){var Ke=Ne[Be]*We,qe=Ne[Be+1]*We,be=Ne[Be+2]*We;ve+=Math.abs((xe[Ke]-xe[be])*(xe[qe+1]-xe[Ke+1])-(xe[Ke]-xe[qe])*(xe[be+1]-xe[Ke+1]))}return 0===$e&&0===ve?0:Math.abs((ve-$e)/$e)},re.flatten=function(xe){for(var je=xe[0][0].length,We={vertices:[],holes:[],dimensions:je},Ne=0,we=0;we<xe.length;we++){for(var Oe=0;Oe<xe[we].length;Oe++)for(var $e=0;$e<je;$e++)We.vertices.push(xe[we][Oe][$e]);we>0&&We.holes.push(Ne+=xe[we-1].length)}return We},re}())&&(x.exports=G);const H=Q.exports},47562:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>Rt,A:()=>yt,B:()=>Ie,C:()=>Ee,D:()=>De,E:()=>ke,F:()=>Oe,G:()=>wt,H:()=>Xt,I:()=>se,J:()=>Yr,K:()=>Cr,L:()=>Lr,M:()=>ge,N:()=>ne,O:()=>$e,P:()=>Dr,Q:()=>Zr,R:()=>ae,S:()=>de,T:()=>Br,U:()=>ri,V:()=>hr,W:()=>be,X:()=>qt,Y:()=>ct,Z:()=>Ft,_:()=>zt,a:()=>Ce,b:()=>Te,c:()=>Zt,d:()=>fr,e:()=>Me,f:()=>ze,g:()=>at,h:()=>qe,i:()=>me,j:()=>Ne,k:()=>et,l:()=>Ge,m:()=>Ke,n:()=>We,o:()=>ye,p:()=>we,q:()=>ve,r:()=>er,s:()=>Je,t:()=>tt,u:()=>Kr,v:()=>_e,w:()=>pe,x:()=>he,y:()=>xe,z:()=>je});var x=T(15861),A=T(7652),G=T(98362),Q=T(5371),H=T(26685),re=T(2004),J=T(21674),W=T(72854),B=T(49672),Z=T(37118),ie=T(55214),ue=T(27122),ce=T(62208),oe=T(75327),le=T(25748),Y=T(56683),j=T(77132);class X{constructor(lr){this.value=lr}}class U{constructor(lr){this.value=lr}}class ee{constructor(lr){this.fn=lr}}class ${constructor(lr,jr){this.paramCount=jr,this.fn=lr}}const ne=ee,se=U,ae=X,de=$,_e={type:"VOID"},pe={type:"BREAK"},he={type:"CONTINUE"};function ge(Nt,lr,jr){return""===lr||null==lr||lr===jr||lr===jr?Nt:Nt=Nt.split(lr).join(jr)}function ye(Nt){return Nt instanceof ee||Nt instanceof A.Z||Nt instanceof $}function Me(Nt){return!!(Te(Nt)||Ce(Nt)||Ne(Nt)||me(Nt)||null===Nt||Nt===_e||"number"==typeof Nt)}function Ee(Nt,lr){return void 0===Nt?lr:Nt}function Te(Nt){return"string"==typeof Nt||Nt instanceof String}function me(Nt){return"boolean"==typeof Nt}function Ce(Nt){return"number"==typeof Nt}function Ie(Nt){return"number"==typeof Nt&&isFinite(Nt)&&Math.floor(Nt)===Nt}function Ge(Nt){return Nt instanceof Array}function Je(Nt){return"esri.arcade.Feature"===(null==Nt?void 0:Nt.arcadeDeclaredClass)}function xe(Nt){return!0===(Nt&&Nt.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===Nt.declaredRootClass)}function je(Nt){return!0===(Nt&&Nt.declaredRootClass&&"esri.arcade.featureSetCollection"===Nt.declaredRootClass)}function We(Nt){return Nt instanceof G.Z}function Ne(Nt){return Nt instanceof Date}function we(Nt,lr,jr){if(Nt.length<lr||Nt.length>jr)throw new Error("Function called with wrong number of Parameters")}function Oe(Nt){return Nt<0?-Math.round(-Nt):Math.round(Nt)}function $e(){let Nt=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(lr){const jr=(Nt+16*Math.random())%16|0;return Nt=Math.floor(Nt/16),("x"===lr?jr:3&jr|8).toString(16)})}function Be(Nt,lr){return!1===isNaN(Nt)?null==lr||""===lr?Nt.toString():(lr=ge(lr,"\u2030",""),lr=ge(lr,"\xa4",""),(0,oe.WU)(Nt,{pattern:lr})):Nt.toString()}function Se(Nt,lr){const jr=ue.ou.fromJSDate(Nt);return null==lr||""===lr?jr.toISO({suppressMilliseconds:!0}):jr.toFormat(De(lr),{locale:(0,Y.Kd)(),numberingSystem:"latn"})}function De(Nt){Nt=Nt.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$&]");let lr="";const jr=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;for(const Ot of Nt.match(jr))switch(Ot){case"D":lr+="d";break;case"DD":lr+="dd";break;case"DDD":lr+="o";break;case"d":lr+="c";break;case"ddd":lr+="ccc";break;case"dddd":lr+="cccc";break;case"M":lr+="L";break;case"MM":lr+="LL";break;case"MMM":lr+="LLL";break;case"MMMM":lr+="LLLL";break;case"YY":lr+="yy";break;case"Y":case"YYYY":lr+="yyyy";break;case"Q":lr+="q";break;case"Z":lr+="ZZ";break;case"ZZ":lr+="ZZZ";break;case"S":lr+="'S'";break;case"SS":lr+="'SS'";break;case"SSS":lr+="u";break;case"A":case"a":lr+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":lr+=Ot;break;default:Ot.length>=2&&"["===Ot.slice(0,1)&&"]"===Ot.slice(-1)?lr+=`'${Ot.slice(1,-1)}'`:lr+=`'${Ot}'`}return lr}function Fe(Nt,lr,jr){switch(jr){case">":return Nt>lr;case"<":return Nt<lr;case">=":return Nt>=lr;case"<=":return Nt<=lr}return!1}function ve(Nt,lr,jr){if(null===Nt){if(null===lr||lr===_e)return Fe(null,null,jr);if(Ce(lr))return Fe(0,lr,jr);if(Te(lr)||me(lr))return Fe(0,ze(lr),jr);if(Ne(lr))return Fe(0,lr.getTime(),jr)}if(Nt===_e){if(null===lr||lr===_e)return Fe(null,null,jr);if(Ce(lr))return Fe(0,lr,jr);if(Te(lr)||me(lr))return Fe(0,ze(lr),jr);if(Ne(lr))return Fe(0,lr.getTime(),jr)}else if(Ce(Nt)){if(Ce(lr))return Fe(Nt,lr,jr);if(me(lr))return Fe(Nt,ze(lr),jr);if(null===lr||lr===_e)return Fe(Nt,0,jr);if(Te(lr))return Fe(Nt,ze(lr),jr);if(Ne(lr))return Fe(Nt,lr.getTime(),jr)}else if(Te(Nt)){if(Te(lr))return Fe(qe(Nt),qe(lr),jr);if(Ne(lr))return Fe(ze(Nt),lr.getTime(),jr);if(Ce(lr))return Fe(ze(Nt),lr,jr);if(null===lr||lr===_e)return Fe(ze(Nt),0,jr);if(me(lr))return Fe(ze(Nt),ze(lr),jr)}else if(Ne(Nt)){if(Ne(lr))return Fe(Nt,lr,jr);if(null===lr||lr===_e)return Fe(Nt.getTime(),0,jr);if(Ce(lr))return Fe(Nt.getTime(),lr,jr);if(me(lr)||Te(lr))return Fe(Nt.getTime(),ze(lr),jr)}else if(me(Nt)){if(me(lr))return Fe(Nt,lr,jr);if(Ce(lr))return Fe(ze(Nt),ze(lr),jr);if(Ne(lr))return Fe(ze(Nt),lr.getTime(),jr);if(null===lr||lr===_e)return Fe(ze(Nt),0,jr);if(Te(lr))return Fe(ze(Nt),ze(lr),jr)}return!!Ke(Nt,lr)&&("<="===jr||">="===jr)}function Ke(Nt,lr){if(Nt===lr||null===Nt&&lr===_e||null===lr&&Nt===_e)return!0;if(Ne(Nt)&&Ne(lr))return Nt.getTime()===lr.getTime();if(Nt instanceof Q.Z||Nt instanceof H.Z)return Nt.equalityTest(lr);if(Nt instanceof B.Z&&lr instanceof B.Z){const jr=Nt.cache._arcadeCacheId,Ot=lr.cache._arcadeCacheId;if(null!=jr)return jr===Ot}return void 0!==Nt&&void 0!==lr&&null!==Nt&&null!==lr&&"object"==typeof Nt&&"object"==typeof lr&&(Nt._arcadeCacheId===lr._arcadeCacheId&&null!=Nt._arcadeCacheId||Nt._underlyingGraphic===lr._underlyingGraphic&&null!=Nt._underlyingGraphic)}function qe(Nt,lr){if(Te(Nt))return Nt;if(null===Nt)return"";if(Ce(Nt))return Be(Nt,lr);if(me(Nt))return Nt.toString();if(Ne(Nt))return Se(Nt,lr);if(Nt instanceof J.Z)return JSON.stringify(Nt.toJSON());if(Ge(Nt)){const jr=[];for(let Ot=0;Ot<Nt.length;Ot++)jr[Ot]=Ye(Nt[Ot]);return"["+jr.join(",")+"]"}if(Nt instanceof G.Z){const jr=[];for(let Ot=0;Ot<Nt.length();Ot++)jr[Ot]=Ye(Nt.get(Ot));return"["+jr.join(",")+"]"}return null!==Nt&&"object"==typeof Nt&&void 0!==Nt.castToText?Nt.castToText():ye(Nt)?"object, Function":""}function be(Nt){const lr=[];if(!1===Ge(Nt))return null;if(Nt instanceof G.Z){for(let jr=0;jr<Nt.length();jr++)lr[jr]=ze(Nt.get(jr));return lr}for(let jr=0;jr<Nt.length;jr++)lr[jr]=ze(Nt[jr]);return lr}function tt(Nt,lr){if(Te(Nt))return Nt;if(null===Nt)return"";if(Ce(Nt))return Be(Nt,lr);if(me(Nt))return Nt.toString();if(Ne(Nt))return Se(Nt,lr);if(Nt instanceof J.Z)return Nt instanceof re.Z?'{"xmin":'+Nt.xmin.toString()+',"ymin":'+Nt.ymin.toString()+","+(Nt.hasZ?'"zmin":'+Nt.zmin.toString()+",":"")+(Nt.hasM?'"mmin":'+Nt.mmin.toString()+",":"")+'"xmax":'+Nt.xmax.toString()+',"ymax":'+Nt.ymax.toString()+","+(Nt.hasZ?'"zmax":'+Nt.zmax.toString()+",":"")+(Nt.hasM?'"mmax":'+Nt.mmax.toString()+",":"")+'"spatialReference":'+St(Nt.spatialReference)+"}":St(Nt.toJSON(),(jr,Ot)=>jr.key===Ot.key?0:"spatialReference"===jr.key?1:"spatialReference"===Ot.key||jr.key<Ot.key?-1:jr.key>Ot.key?1:0);if(Ge(Nt)){const jr=[];for(let Ot=0;Ot<Nt.length;Ot++)jr[Ot]=Ye(Nt[Ot]);return"["+jr.join(",")+"]"}if(Nt instanceof G.Z){const jr=[];for(let Ot=0;Ot<Nt.length();Ot++)jr[Ot]=Ye(Nt.get(Ot));return"["+jr.join(",")+"]"}return null!==Nt&&"object"==typeof Nt&&void 0!==Nt.castToText?Nt.castToText():ye(Nt)?"object, Function":""}function Ye(Nt){if(null===Nt)return"null";if(me(Nt)||Ce(Nt)||Te(Nt))return JSON.stringify(Nt);if(Nt instanceof J.Z||Nt instanceof G.Z||Nt instanceof Array)return tt(Nt);if(Nt instanceof Date)return JSON.stringify(Se(Nt,""));if(null!==Nt&&"object"==typeof Nt){if(void 0!==Nt.castToText)return Nt.castToText()}else if(Nt===_e)return"null";return"null"}function ze(Nt,lr){return Ce(Nt)?Nt:null===Nt||""===Nt?0:Ne(Nt)?NaN:me(Nt)?Nt?1:0:Ge(Nt)||""===Nt||void 0===Nt?NaN:void 0!==lr&&Te(Nt)?(lr=ge(lr,"\u2030",""),lr=ge(lr,"\xa4",""),(0,oe.Qc)(Nt,{pattern:lr})):Nt===_e?0:Number(Nt)}function et(Nt){if(Ne(Nt))return Nt;if(Te(Nt)){const lr=ot(Nt);if(lr)return lr.toJSDate()}return null}function ke(Nt){return Ne(Nt)?ue.ou.fromJSDate(Nt):Te(Nt)?ot(Nt):null}function ot(Nt){const lr=/ (\d\d)/;let jr=ue.ou.fromISO(Nt);return jr.isValid||lr.test(Nt)&&(Nt=Nt.replace(lr,"T$1"),jr=ue.ou.fromISO(Nt),jr.isValid)?jr:null}function at(Nt){return me(Nt)?Nt:Te(Nt)?"true"===(Nt=Nt.toLowerCase()):!!Ce(Nt)&&0!==Nt&&!isNaN(Nt)}function yt(Nt,lr){return(0,ce.Wi)(Nt)?null:(null!=Nt.spatialReference||(Nt.spatialReference=lr),Nt)}function wt(Nt){if(null===Nt)return null;if(Nt instanceof B.Z)return"NaN"===Nt.x||null===Nt.x||isNaN(Nt.x)?null:Nt;if(Nt instanceof Z.Z){if(0===Nt.rings.length)return null;for(const lr of Nt.rings)if(lr.length>0)return Nt;return null}if(Nt instanceof ie.Z){if(0===Nt.paths.length)return null;for(const lr of Nt.paths)if(lr.length>0)return Nt;return null}return Nt instanceof W.Z?0===Nt.points.length?null:Nt:Nt instanceof re.Z?"NaN"===Nt.xmin||null===Nt.xmin||isNaN(Nt.xmin)?null:Nt:null}function zt(Nt,lr){if(!Nt||!Nt.domain)return lr;let jr=null;if("string"===Nt.field.type||"esriFieldTypeString"===Nt.field.type)lr=qe(lr);else{if(null==lr)return null;if(""===lr)return lr;lr=ze(lr)}for(let Ot=0;Ot<Nt.domain.codedValues.length;Ot++){const rr=Nt.domain.codedValues[Ot];rr.code===lr&&(jr=rr)}return null===jr?lr:jr.name}function Rt(Nt,lr){if(!Nt||!Nt.domain)return lr;let jr=null;lr=qe(lr);for(let Ot=0;Ot<Nt.domain.codedValues.length;Ot++){const rr=Nt.domain.codedValues[Ot];rr.name===lr&&(jr=rr)}return null===jr?lr:jr.code}function Ft(Nt,lr,jr=null,Ot=null){if(!lr||!lr.fields)return null;let rr,pr,Pr=null;for(let Fr=0;Fr<lr.fields.length;Fr++){const ii=lr.fields[Fr];ii.name.toLowerCase()===Nt.toString().toLowerCase()&&(Pr=ii)}if(null===Pr)throw new Error("Field not found");return null===Ot&&jr&&lr.typeIdField&&(Ot=jr.hasField(lr.typeIdField)?jr.field(lr.typeIdField):null),null!=Ot&&lr.types.some(function(Fr){return Fr.id===Ot&&(rr=Fr.domains&&Fr.domains[Pr.name],rr&&"inherited"===rr.type&&(rr=bt(Pr.name,lr),pr=!0),!0)}),pr||rr||(rr=bt(Nt,lr)),{field:Pr,domain:rr}}function bt(Nt,lr){let jr;return lr.fields.some(function(Ot){return Ot.name.toLowerCase()===Nt.toLowerCase()&&(jr=Ot.domain),!!jr}),jr}function St(Nt,lr){lr||(lr={}),"function"==typeof lr&&(lr={cmp:lr});const jr="boolean"==typeof lr.cycles&&lr.cycles,Ot=lr.cmp&&(rr=lr.cmp,function(Pr){return function(Fr,ii){return rr({key:Fr,value:Pr[Fr]},{key:ii,value:Pr[ii]})}});var rr;const pr=[];return function Pr(Fr){if(Fr&&Fr.toJSON&&"function"==typeof Fr.toJSON&&(Fr=Fr.toJSON()),void 0===Fr)return;if("number"==typeof Fr)return isFinite(Fr)?""+Fr:"null";if("object"!=typeof Fr)return JSON.stringify(Fr);let ii,mi;if(Array.isArray(Fr)){for(mi="[",ii=0;ii<Fr.length;ii++)ii&&(mi+=","),mi+=Pr(Fr[ii])||"null";return mi+"]"}if(null===Fr)return"null";if(pr.includes(Fr)){if(jr)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const wi=pr.push(Fr)-1,Qr=Object.keys(Fr).sort(Ot&&Ot(Fr));for(mi="",ii=0;ii<Qr.length;ii++){const Ni=Qr[ii],Hs=Pr(Fr[Ni]);Hs&&(mi&&(mi+=","),mi+=JSON.stringify(Ni)+":"+Hs)}return pr.splice(wi,1),"{"+mi+"}"}(Nt)}function Xt(Nt){if(null===Nt)return null;const lr=[];for(const jr of Nt)lr.push(jr&&jr.arcadeDeclaredClass&&"esri.arcade.Feature"===jr.arcadeDeclaredClass?jr.geometry():jr);return lr}function Mr(Nt,lr){if(!(lr instanceof B.Z))throw new Error("Invalid Argument");Nt.push(lr.hasZ?lr.hasM?[lr.x,lr.y,lr.z,lr.m]:[lr.x,lr.y,lr.z]:[lr.x,lr.y])}function Cr(Nt,lr){if(Ge(Nt)||We(Nt)){let jr=!1,Ot=!1,rr=[],pr=lr;if(Ge(Nt)){for(const Pr of Nt)Mr(rr,Pr);rr.length>0&&(pr=Nt[0].spatialReference,jr=Nt[0].hasZ,Ot=Nt[0].hasM)}else if(Nt instanceof H.Z)rr=Nt._elements,rr.length>0&&(jr=Nt._hasZ,Ot=Nt._hasM,pr=Nt.get(0).spatialReference);else{if(!We(Nt))throw new Error("Invalid Argument");for(const Pr of Nt.toArray())Mr(rr,Pr);rr.length>0&&(pr=Nt.get(0).spatialReference,jr=!0===Nt.get(0).hasZ,Ot=!0===Nt.get(0).hasM)}return 0===rr.length?null:(!1===(0,le.bu)(rr,Ot,jr)&&(rr=rr.slice(0).reverse()),new Z.Z({rings:[rr],spatialReference:pr,hasZ:jr,hasM:Ot}))}return Nt}function Yr(Nt,lr){if(Ge(Nt)||We(Nt)){let jr=!1,Ot=!1,rr=[],pr=lr;if(Ge(Nt)){for(const Pr of Nt)Mr(rr,Pr);rr.length>0&&(pr=Nt[0].spatialReference,jr=!0===Nt[0].hasZ,Ot=!0===Nt[0].hasM)}else if(Nt instanceof H.Z)rr=Nt._elements,rr.length>0&&(jr=Nt._hasZ,Ot=Nt._hasM,pr=Nt.get(0).spatialReference);else if(We(Nt)){for(const Pr of Nt.toArray())Mr(rr,Pr);rr.length>0&&(pr=Nt.get(0).spatialReference,jr=!0===Nt.get(0).hasZ,Ot=!0===Nt.get(0).hasM)}return 0===rr.length?null:new ie.Z({paths:[rr],spatialReference:pr,hasZ:jr,hasM:Ot})}return Nt}function Lr(Nt,lr){if(Ge(Nt)||We(Nt)){let jr=!1,Ot=!1,rr=[],pr=lr;if(Ge(Nt)){for(const Pr of Nt)Mr(rr,Pr);rr.length>0&&(pr=Nt[0].spatialReference,jr=!0===Nt[0].hasZ,Ot=!0===Nt[0].hasM)}else if(Nt instanceof H.Z)rr=Nt._elements,rr.length>0&&(jr=Nt._hasZ,Ot=Nt._hasM,pr=Nt.get(0).spatialReference);else if(We(Nt)){for(const Pr of Nt.toArray())Mr(rr,Pr);rr.length>0&&(pr=Nt.get(0).spatialReference,jr=!0===Nt.get(0).hasZ,Ot=!0===Nt.get(0).hasM)}return 0===rr.length?null:new W.Z({points:rr,spatialReference:pr,hasZ:jr,hasM:Ot})}return Nt}function ct(Nt,lr=!1){const jr=[];if(null===Nt)return jr;if(!0===Ge(Nt)){for(let Ot=0;Ot<Nt.length;Ot++){const rr=qe(Nt[Ot]);""===rr&&!0!==lr||jr.push(rr)}return jr}if(Nt instanceof G.Z){for(let Ot=0;Ot<Nt.length();Ot++){const rr=qe(Nt.get(Ot));""===rr&&!0!==lr||jr.push(rr)}return jr}if(Me(Nt)){const Ot=qe(Nt);return""===Ot&&!0!==lr||jr.push(Ot),jr}return[]}let jt=0;function qt(Nt){return jt++,jt%100==0?(jt=0,new Promise(lr=>{setTimeout(()=>{lr(Nt)},0)})):Nt}function er(Nt,lr,jr){switch(jr){case"&":return Nt&lr;case"|":return Nt|lr;case"^":return Nt^lr;case"<<":return Nt<<lr;case">>":return Nt>>lr;case">>>":return Nt>>>lr}}function Zt(Nt,lr=null){return null==Nt?null:me(Nt)||Ce(Nt)||Te(Nt)?Nt:Nt instanceof J.Z?!0===(null==lr?void 0:lr.keepGeometryType)?Nt:Nt.toJSON():Nt instanceof G.Z?Nt.toArray().map(jr=>Zt(jr,lr)):Nt instanceof Array?Nt.map(jr=>Zt(jr,lr)):Nt instanceof Date?Nt:null!==Nt&&"object"==typeof Nt&&void 0!==Nt.castAsJson?Nt.castAsJson(lr):null}function tr(Nt,lr,jr,Ot,rr){return ir.apply(this,arguments)}function ir(){return(ir=(0,x.Z)(function*(Nt,lr,jr,Ot,rr){const pr=yield fr(Nt,lr,jr);rr[Ot]=pr})).apply(this,arguments)}function fr(Nt){return Ur.apply(this,arguments)}function Ur(){return(Ur=(0,x.Z)(function*(Nt,lr=null,jr=null){if(Nt instanceof G.Z&&(Nt=Nt.toArray()),null==Nt)return null;if(Me(Nt)||Nt instanceof J.Z||Nt instanceof Date)return Zt(Nt,jr);if(Nt instanceof Array){const Ot=[],rr=[];for(const pr of Nt)null===pr||Me(pr)||pr instanceof J.Z||pr instanceof Date?rr.push(Zt(pr,jr)):(rr.push(null),Ot.push(tr(pr,lr,jr,rr.length-1,rr)));return Ot.length>0&&(yield Promise.all(Ot)),rr}return null!==Nt&&"object"==typeof Nt&&void 0!==Nt.castAsJsonAsync?Nt.castAsJsonAsync(lr,jr):null})).apply(this,arguments)}function Br(Nt,lr,jr){const Ot=Nt.fullSchema();return null!==Ot&&Ot.fields?Ft(lr,Ot,Nt,jr):null}function Zr(Nt){const lr=Nt.fullSchema();return null===lr?null:lr.fields&&lr.typeIdField?{subtypeField:lr.typeIdField,subtypes:lr.types?lr.types.map(jr=>({name:jr.name,code:jr.id})):[]}:null}function ri(Nt,lr,jr,Ot){const rr=Nt.fullSchema();if(null===rr||!rr.fields)return null;const pr=Ft(lr,rr,Nt,Ot);if(void 0===jr)try{jr=Nt.field(lr)}catch(Pr){return null}return zt(pr,jr)}function hr(Nt,lr,jr,Ot){const rr=Nt.fullSchema();if(null===rr||!rr.fields)return null;if(void 0===jr){try{jr=Nt.field(lr)}catch(pr){return null}return jr}return Rt(Ft(lr,rr,Nt,Ot),jr)}function Dr(Nt){const lr=Nt.fullSchema();if(null===lr||!lr.fields)return null;const jr=[];for(const Ot of lr.fields)jr.push((0,j.Sh)(Ot));return{objectIdField:lr.objectIdField,globalIdField:lr.globalIdField,geometryType:void 0===j.q2[lr.geometryType]?"":j.q2[lr.geometryType],fields:jr}}const Kr=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:X,ImplicitResultE:U,NativeFunctionE:ee,SizzleFunctionE:$,NativeFunction:ne,ImplicitResult:se,ReturnResult:ae,SizzleFunction:de,voidOperation:_e,breakResult:pe,continueResult:he,multiReplace:ge,isFunctionParameter:ye,isSimpleType:Me,defaultUndefined:Ee,isString:Te,isBoolean:me,isNumber:Ce,isInteger:Ie,isArray:Ge,isFeature:Je,isFeatureSet:xe,isFeatureSetCollection:je,isImmutableArray:We,isDate:Ne,pcCheck:we,absRound:Oe,generateUUID:$e,formatNumber:Be,formatDate:Se,standardiseDateFormat:De,greaterThanLessThan:ve,equalityTest:Ke,toString:qe,toNumberArray:be,toStringExplicit:tt,toNumber:ze,toDate:et,toDateTime:ke,toBoolean:at,fixSpatialReference:yt,fixNullGeometry:wt,getDomainValue:zt,getDomainCode:Rt,getDomain:Ft,stableStringify:St,autoCastFeatureToGeometry:Xt,autoCastArrayOfPointsToPolygon:Cr,autoCastArrayOfPointsToPolyline:Yr,autoCastArrayOfPointsToMultiPoint:Lr,toStringArray:ct,tick:qt,binaryOperator:er,castAsJson:Zt,castAsJsonAsync:fr,featureFullDomain:Br,featureSubtypes:Zr,featureDomainValueLookup:ri,featureDomainCodeLookup:hr,featureSchema:Dr},Symbol.toStringTag,{value:"Module"}))},31478:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>ce,b:()=>H,c:()=>ie,f:()=>ue,i:()=>G,m:()=>J,r:()=>W,s:()=>B,t:()=>Z});var x=T(39863);function G(de){return de[0]=1,de[1]=0,de[2]=0,de[3]=1,de[4]=0,de[5]=0,de}function H(de,_e){const pe=_e[0],he=_e[1],ge=_e[2],ye=_e[3],Me=_e[4],Ee=_e[5];let Te=pe*ye-he*ge;return Te?(Te=1/Te,de[0]=ye*Te,de[1]=-he*Te,de[2]=-ge*Te,de[3]=pe*Te,de[4]=(ge*Ee-ye*Me)*Te,de[5]=(he*Me-pe*Ee)*Te,de):null}function J(de,_e,pe){const he=_e[0],ge=_e[1],ye=_e[2],Me=_e[3],Ee=_e[4],Te=_e[5],me=pe[0],Ce=pe[1],Ie=pe[2],Ge=pe[3],Je=pe[4],xe=pe[5];return de[0]=he*me+ye*Ce,de[1]=ge*me+Me*Ce,de[2]=he*Ie+ye*Ge,de[3]=ge*Ie+Me*Ge,de[4]=he*Je+ye*xe+Ee,de[5]=ge*Je+Me*xe+Te,de}function W(de,_e,pe){const he=_e[0],ge=_e[1],ye=_e[2],Me=_e[3],Ee=_e[4],Te=_e[5],me=Math.sin(pe),Ce=Math.cos(pe);return de[0]=he*Ce+ye*me,de[1]=ge*Ce+Me*me,de[2]=he*-me+ye*Ce,de[3]=ge*-me+Me*Ce,de[4]=Ee,de[5]=Te,de}function B(de,_e,pe){const ge=_e[1],ye=_e[2],Me=_e[3],Ee=_e[4],Te=_e[5],me=pe[0],Ce=pe[1];return de[0]=_e[0]*me,de[1]=ge*me,de[2]=ye*Ce,de[3]=Me*Ce,de[4]=Ee,de[5]=Te,de}function Z(de,_e,pe){const he=_e[0],ge=_e[1],ye=_e[2],Me=_e[3],Ee=_e[4],Te=_e[5],me=pe[0],Ce=pe[1];return de[0]=he,de[1]=ge,de[2]=ye,de[3]=Me,de[4]=he*me+ye*Ce+Ee,de[5]=ge*me+Me*Ce+Te,de}function ie(de,_e){const pe=Math.sin(_e),he=Math.cos(_e);return de[0]=he,de[1]=pe,de[2]=-pe,de[3]=he,de[4]=0,de[5]=0,de}function ue(de,_e){return de[0]=_e[0],de[1]=0,de[2]=0,de[3]=_e[1],de[4]=0,de[5]=0,de}function ce(de,_e){return de[0]=1,de[1]=0,de[2]=0,de[3]=1,de[4]=_e[0],de[5]=_e[1],de}function j(de,_e,pe){return de[0]=_e[0]-pe[0],de[1]=_e[1]-pe[1],de[2]=_e[2]-pe[2],de[3]=_e[3]-pe[3],de[4]=_e[4]-pe[4],de[5]=_e[5]-pe[5],de}Object.freeze(Object.defineProperty({__proto__:null,copy:function A(de,_e){return de[0]=_e[0],de[1]=_e[1],de[2]=_e[2],de[3]=_e[3],de[4]=_e[4],de[5]=_e[5],de},identity:G,set:function Q(de,_e,pe,he,ge,ye,Me){return de[0]=_e,de[1]=pe,de[2]=he,de[3]=ge,de[4]=ye,de[5]=Me,de},invert:H,determinant:function re(de){return de[0]*de[3]-de[1]*de[2]},multiply:J,rotate:W,scale:B,translate:Z,fromRotation:ie,fromScaling:ue,fromTranslation:ce,str:function oe(de){return"mat2d("+de[0]+", "+de[1]+", "+de[2]+", "+de[3]+", "+de[4]+", "+de[5]+")"},frob:function le(de){return Math.sqrt(de[0]**2+de[1]**2+de[2]**2+de[3]**2+de[4]**2+de[5]**2+1)},add:function Y(de,_e,pe){return de[0]=_e[0]+pe[0],de[1]=_e[1]+pe[1],de[2]=_e[2]+pe[2],de[3]=_e[3]+pe[3],de[4]=_e[4]+pe[4],de[5]=_e[5]+pe[5],de},subtract:j,multiplyScalar:function X(de,_e,pe){return de[0]=_e[0]*pe,de[1]=_e[1]*pe,de[2]=_e[2]*pe,de[3]=_e[3]*pe,de[4]=_e[4]*pe,de[5]=_e[5]*pe,de},multiplyScalarAndAdd:function U(de,_e,pe,he){return de[0]=_e[0]+pe[0]*he,de[1]=_e[1]+pe[1]*he,de[2]=_e[2]+pe[2]*he,de[3]=_e[3]+pe[3]*he,de[4]=_e[4]+pe[4]*he,de[5]=_e[5]+pe[5]*he,de},exactEquals:function ee(de,_e){return de[0]===_e[0]&&de[1]===_e[1]&&de[2]===_e[2]&&de[3]===_e[3]&&de[4]===_e[4]&&de[5]===_e[5]},equals:function $(de,_e){const pe=de[0],he=de[1],ge=de[2],ye=de[3],Me=de[4],Ee=de[5],Te=_e[0],me=_e[1],Ce=_e[2],Ie=_e[3],Ge=_e[4],Je=_e[5];return Math.abs(pe-Te)<=x.E*Math.max(1,Math.abs(pe),Math.abs(Te))&&Math.abs(he-me)<=x.E*Math.max(1,Math.abs(he),Math.abs(me))&&Math.abs(ge-Ce)<=x.E*Math.max(1,Math.abs(ge),Math.abs(Ce))&&Math.abs(ye-Ie)<=x.E*Math.max(1,Math.abs(ye),Math.abs(Ie))&&Math.abs(Me-Ge)<=x.E*Math.max(1,Math.abs(Me),Math.abs(Ge))&&Math.abs(Ee-Je)<=x.E*Math.max(1,Math.abs(Ee),Math.abs(Je))},mul:J,sub:j},Symbol.toStringTag,{value:"Module"}))},12225:(dt,Re,T)=>{"use strict";function x(){const W=new Float32Array(6);return W[0]=1,W[3]=1,W}function H(W,B,Z,ie){const ue=B[ie],ce=B[ie+1];W[ie]=Z[0]*ue+Z[2]*ce+Z[4],W[ie+1]=Z[1]*ue+Z[3]*ce+Z[5]}function re(W,B,Z,ie=0,ue=0,ce=2){const oe=ue||B.length/ce;for(let le=ie;le<oe;le++)H(W,B,Z,le*ce)}T.d(Re,{c:()=>x,t:()=>re}),Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:function A(W){const B=new Float32Array(6);return B[0]=W[0],B[1]=W[1],B[2]=W[2],B[3]=W[3],B[4]=W[4],B[5]=W[5],B},fromValues:function G(W,B,Z,ie,ue,ce){const oe=new Float32Array(6);return oe[0]=W,oe[1]=B,oe[2]=Z,oe[3]=ie,oe[4]=ue,oe[5]=ce,oe},createView:function Q(W,B){return new Float32Array(W,B,6)},transform:H,transformMany:re},Symbol.toStringTag,{value:"Module"}))},46342:(dt,Re,T)=>{"use strict";function x(){return[1,0,0,1,0,0]}function A(re){return[re[0],re[1],re[2],re[3],re[4],re[5]]}T.d(Re,{a:()=>A,c:()=>x}),Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:function G(re,J,W,B,Z,ie){return[re,J,W,B,Z,ie]},createView:function Q(re,J){return new Float64Array(re,J,6)}},Symbol.toStringTag,{value:"Module"}))},30217:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>$,b:()=>H,c:()=>ie,d:()=>ce,e:()=>J,f:()=>A,g:()=>U,i:()=>Me,m:()=>Z,n:()=>ee,r:()=>ue,s:()=>Q,t:()=>re});var x=T(39863);function A(Ce,Ie){return Ce[0]=Ie[0],Ce[1]=Ie[1],Ce[2]=Ie[2],Ce[3]=Ie[4],Ce[4]=Ie[5],Ce[5]=Ie[6],Ce[6]=Ie[8],Ce[7]=Ie[9],Ce[8]=Ie[10],Ce}function Q(Ce,Ie,Ge,Je,xe,je,We,Ne,we,Oe){return Ce[0]=Ie,Ce[1]=Ge,Ce[2]=Je,Ce[3]=xe,Ce[4]=je,Ce[5]=We,Ce[6]=Ne,Ce[7]=we,Ce[8]=Oe,Ce}function H(Ce){return Ce[0]=1,Ce[1]=0,Ce[2]=0,Ce[3]=0,Ce[4]=1,Ce[5]=0,Ce[6]=0,Ce[7]=0,Ce[8]=1,Ce}function re(Ce,Ie){if(Ce===Ie){const Ge=Ie[1],Je=Ie[2],xe=Ie[5];Ce[1]=Ie[3],Ce[2]=Ie[6],Ce[3]=Ge,Ce[5]=Ie[7],Ce[6]=Je,Ce[7]=xe}else Ce[0]=Ie[0],Ce[1]=Ie[3],Ce[2]=Ie[6],Ce[3]=Ie[1],Ce[4]=Ie[4],Ce[5]=Ie[7],Ce[6]=Ie[2],Ce[7]=Ie[5],Ce[8]=Ie[8];return Ce}function J(Ce,Ie){const Ge=Ie[0],Je=Ie[1],xe=Ie[2],je=Ie[3],We=Ie[4],Ne=Ie[5],we=Ie[6],Oe=Ie[7],$e=Ie[8],Be=$e*We-Ne*Oe,Se=-$e*je+Ne*we,De=Oe*je-We*we;let Fe=Ge*Be+Je*Se+xe*De;return Fe?(Fe=1/Fe,Ce[0]=Be*Fe,Ce[1]=(-$e*Je+xe*Oe)*Fe,Ce[2]=(Ne*Je-xe*We)*Fe,Ce[3]=Se*Fe,Ce[4]=($e*Ge-xe*we)*Fe,Ce[5]=(-Ne*Ge+xe*je)*Fe,Ce[6]=De*Fe,Ce[7]=(-Oe*Ge+Je*we)*Fe,Ce[8]=(We*Ge-Je*je)*Fe,Ce):null}function Z(Ce,Ie,Ge){const Je=Ie[0],xe=Ie[1],je=Ie[2],We=Ie[3],Ne=Ie[4],we=Ie[5],Oe=Ie[6],$e=Ie[7],Be=Ie[8],Se=Ge[0],De=Ge[1],Fe=Ge[2],ve=Ge[3],Ke=Ge[4],qe=Ge[5],be=Ge[6],tt=Ge[7],Ye=Ge[8];return Ce[0]=Se*Je+De*We+Fe*Oe,Ce[1]=Se*xe+De*Ne+Fe*$e,Ce[2]=Se*je+De*we+Fe*Be,Ce[3]=ve*Je+Ke*We+qe*Oe,Ce[4]=ve*xe+Ke*Ne+qe*$e,Ce[5]=ve*je+Ke*we+qe*Be,Ce[6]=be*Je+tt*We+Ye*Oe,Ce[7]=be*xe+tt*Ne+Ye*$e,Ce[8]=be*je+tt*we+Ye*Be,Ce}function ie(Ce,Ie,Ge){const Je=Ie[0],xe=Ie[1],je=Ie[2],We=Ie[3],Ne=Ie[4],we=Ie[5],Oe=Ie[6],$e=Ie[7],Be=Ie[8],Se=Ge[0],De=Ge[1];return Ce[0]=Je,Ce[1]=xe,Ce[2]=je,Ce[3]=We,Ce[4]=Ne,Ce[5]=we,Ce[6]=Se*Je+De*We+Oe,Ce[7]=Se*xe+De*Ne+$e,Ce[8]=Se*je+De*we+Be,Ce}function ue(Ce,Ie,Ge){const Je=Ie[0],xe=Ie[1],je=Ie[2],We=Ie[3],Ne=Ie[4],we=Ie[5],Oe=Ie[6],$e=Ie[7],Be=Ie[8],Se=Math.sin(Ge),De=Math.cos(Ge);return Ce[0]=De*Je+Se*We,Ce[1]=De*xe+Se*Ne,Ce[2]=De*je+Se*we,Ce[3]=De*We-Se*Je,Ce[4]=De*Ne-Se*xe,Ce[5]=De*we-Se*je,Ce[6]=Oe,Ce[7]=$e,Ce[8]=Be,Ce}function ce(Ce,Ie,Ge){const Je=Ge[0],xe=Ge[1],je=Ge[2];return Ce[0]=Je*Ie[0],Ce[1]=Je*Ie[1],Ce[2]=Je*Ie[2],Ce[3]=xe*Ie[3],Ce[4]=xe*Ie[4],Ce[5]=xe*Ie[5],Ce[6]=je*Ie[6],Ce[7]=je*Ie[7],Ce[8]=je*Ie[8],Ce}function U(Ce,Ie){const Ge=Ie[0],Je=Ie[1],xe=Ie[2],je=Ie[3],We=Ge+Ge,Ne=Je+Je,we=xe+xe,Oe=Ge*We,$e=Je*We,Be=Je*Ne,Se=xe*We,De=xe*Ne,Fe=xe*we,ve=je*We,Ke=je*Ne,qe=je*we;return Ce[0]=1-Be-Fe,Ce[3]=$e-qe,Ce[6]=Se+Ke,Ce[1]=$e+qe,Ce[4]=1-Oe-Fe,Ce[7]=De-ve,Ce[2]=Se-Ke,Ce[5]=De+ve,Ce[8]=1-Oe-Be,Ce}function ee(Ce,Ie){const Ge=Ie[0],Je=Ie[1],xe=Ie[2],je=Ie[4],We=Ie[5],Ne=Ie[6],we=Ie[8],Oe=Ie[9],$e=Ie[10],Be=$e*We-Ne*Oe,Se=-$e*je+Ne*we,De=Oe*je-We*we,Fe=Ge*Be+Je*Se+xe*De;if(!Fe)return null;const ve=1/Fe;return Ce[0]=Be*ve,Ce[1]=(-$e*Je+xe*Oe)*ve,Ce[2]=(Ne*Je-xe*We)*ve,Ce[3]=Se*ve,Ce[4]=($e*Ge-xe*we)*ve,Ce[5]=(-Ne*Ge+xe*je)*ve,Ce[6]=De*ve,Ce[7]=(-Oe*Ge+Je*we)*ve,Ce[8]=(We*Ge-Je*je)*ve,Ce}function $(Ce,Ie){const Ge=Ie[0],Je=Ie[1],xe=Ie[2],je=Ie[3],We=Ie[4],Ne=Ie[5],we=Ie[6],Oe=Ie[7],$e=Ie[8],Be=Ie[9],Se=Ie[10],De=Ie[11],Fe=Ie[12],ve=Ie[13],Ke=Ie[14],qe=Ie[15],be=Ge*Ne-Je*We,tt=Ge*we-xe*We,Ye=Ge*Oe-je*We,ze=Je*we-xe*Ne,et=Je*Oe-je*Ne,ke=xe*Oe-je*we,ot=$e*ve-Be*Fe,at=$e*Ke-Se*Fe,yt=$e*qe-De*Fe,wt=Be*Ke-Se*ve,zt=Be*qe-De*ve,Rt=Se*qe-De*Ke;let Ft=be*Rt-tt*zt+Ye*wt+ze*yt-et*at+ke*ot;return Ft?(Ft=1/Ft,Ce[0]=(Ne*Rt-we*zt+Oe*wt)*Ft,Ce[1]=(we*yt-We*Rt-Oe*at)*Ft,Ce[2]=(We*zt-Ne*yt+Oe*ot)*Ft,Ce[3]=(xe*zt-Je*Rt-je*wt)*Ft,Ce[4]=(Ge*Rt-xe*yt+je*at)*Ft,Ce[5]=(Je*yt-Ge*zt-je*ot)*Ft,Ce[6]=(ve*ke-Ke*et+qe*ze)*Ft,Ce[7]=(Ke*Ye-Fe*ke-qe*tt)*Ft,Ce[8]=(Fe*et-ve*Ye+qe*be)*Ft,Ce):null}function _e(Ce,Ie,Ge){return Ce[0]=Ie[0]-Ge[0],Ce[1]=Ie[1]-Ge[1],Ce[2]=Ie[2]-Ge[2],Ce[3]=Ie[3]-Ge[3],Ce[4]=Ie[4]-Ge[4],Ce[5]=Ie[5]-Ge[5],Ce[6]=Ie[6]-Ge[6],Ce[7]=Ie[7]-Ge[7],Ce[8]=Ie[8]-Ge[8],Ce}function Me(Ce){const Ie=x.E,Ge=Ce[0],Je=Ce[1],xe=Ce[2],je=Ce[3],We=Ce[4],Ne=Ce[5],we=Ce[6],Oe=Ce[7],$e=Ce[8];return Math.abs(1-(Ge*Ge+je*je+we*we))<=Ie&&Math.abs(1-(Je*Je+We*We+Oe*Oe))<=Ie&&Math.abs(1-(xe*xe+Ne*Ne+$e*$e))<=Ie}Object.freeze(Object.defineProperty({__proto__:null,fromMat4:A,copy:function G(Ce,Ie){return Ce[0]=Ie[0],Ce[1]=Ie[1],Ce[2]=Ie[2],Ce[3]=Ie[3],Ce[4]=Ie[4],Ce[5]=Ie[5],Ce[6]=Ie[6],Ce[7]=Ie[7],Ce[8]=Ie[8],Ce},set:Q,identity:H,transpose:re,invert:J,adjoint:function W(Ce,Ie){const Ge=Ie[0],Je=Ie[1],xe=Ie[2],je=Ie[3],We=Ie[4],Ne=Ie[5],we=Ie[6],Oe=Ie[7],$e=Ie[8];return Ce[0]=We*$e-Ne*Oe,Ce[1]=xe*Oe-Je*$e,Ce[2]=Je*Ne-xe*We,Ce[3]=Ne*we-je*$e,Ce[4]=Ge*$e-xe*we,Ce[5]=xe*je-Ge*Ne,Ce[6]=je*Oe-We*we,Ce[7]=Je*we-Ge*Oe,Ce[8]=Ge*We-Je*je,Ce},determinant:function B(Ce){const xe=Ce[3],je=Ce[4],We=Ce[5],Ne=Ce[6],we=Ce[7],Oe=Ce[8];return Ce[0]*(Oe*je-We*we)+Ce[1]*(-Oe*xe+We*Ne)+Ce[2]*(we*xe-je*Ne)},multiply:Z,translate:ie,rotate:ue,scale:ce,scaleByVec2:function oe(Ce,Ie,Ge){const Je=Ge[0],xe=Ge[1];return Ce[0]=Je*Ie[0],Ce[1]=Je*Ie[1],Ce[2]=Je*Ie[2],Ce[3]=xe*Ie[3],Ce[4]=xe*Ie[4],Ce[5]=xe*Ie[5],Ce},fromTranslation:function le(Ce,Ie){return Ce[0]=1,Ce[1]=0,Ce[2]=0,Ce[3]=0,Ce[4]=1,Ce[5]=0,Ce[6]=Ie[0],Ce[7]=Ie[1],Ce[8]=1,Ce},fromRotation:function Y(Ce,Ie){const Ge=Math.sin(Ie),Je=Math.cos(Ie);return Ce[0]=Je,Ce[1]=Ge,Ce[2]=0,Ce[3]=-Ge,Ce[4]=Je,Ce[5]=0,Ce[6]=0,Ce[7]=0,Ce[8]=1,Ce},fromScaling:function j(Ce,Ie){return Ce[0]=Ie[0],Ce[1]=0,Ce[2]=0,Ce[3]=0,Ce[4]=Ie[1],Ce[5]=0,Ce[6]=0,Ce[7]=0,Ce[8]=1,Ce},fromMat2d:function X(Ce,Ie){return Ce[0]=Ie[0],Ce[1]=Ie[1],Ce[2]=0,Ce[3]=Ie[2],Ce[4]=Ie[3],Ce[5]=0,Ce[6]=Ie[4],Ce[7]=Ie[5],Ce[8]=1,Ce},fromQuat:U,normalFromMat4Legacy:ee,normalFromMat4:$,projection:function ne(Ce,Ie,Ge){return Ce[0]=2/Ie,Ce[1]=0,Ce[2]=0,Ce[3]=0,Ce[4]=-2/Ge,Ce[5]=0,Ce[6]=-1,Ce[7]=1,Ce[8]=1,Ce},str:function se(Ce){return"mat3("+Ce[0]+", "+Ce[1]+", "+Ce[2]+", "+Ce[3]+", "+Ce[4]+", "+Ce[5]+", "+Ce[6]+", "+Ce[7]+", "+Ce[8]+")"},frob:function ae(Ce){return Math.sqrt(Ce[0]**2+Ce[1]**2+Ce[2]**2+Ce[3]**2+Ce[4]**2+Ce[5]**2+Ce[6]**2+Ce[7]**2+Ce[8]**2)},add:function de(Ce,Ie,Ge){return Ce[0]=Ie[0]+Ge[0],Ce[1]=Ie[1]+Ge[1],Ce[2]=Ie[2]+Ge[2],Ce[3]=Ie[3]+Ge[3],Ce[4]=Ie[4]+Ge[4],Ce[5]=Ie[5]+Ge[5],Ce[6]=Ie[6]+Ge[6],Ce[7]=Ie[7]+Ge[7],Ce[8]=Ie[8]+Ge[8],Ce},subtract:_e,multiplyScalar:function pe(Ce,Ie,Ge){return Ce[0]=Ie[0]*Ge,Ce[1]=Ie[1]*Ge,Ce[2]=Ie[2]*Ge,Ce[3]=Ie[3]*Ge,Ce[4]=Ie[4]*Ge,Ce[5]=Ie[5]*Ge,Ce[6]=Ie[6]*Ge,Ce[7]=Ie[7]*Ge,Ce[8]=Ie[8]*Ge,Ce},multiplyScalarAndAdd:function he(Ce,Ie,Ge,Je){return Ce[0]=Ie[0]+Ge[0]*Je,Ce[1]=Ie[1]+Ge[1]*Je,Ce[2]=Ie[2]+Ge[2]*Je,Ce[3]=Ie[3]+Ge[3]*Je,Ce[4]=Ie[4]+Ge[4]*Je,Ce[5]=Ie[5]+Ge[5]*Je,Ce[6]=Ie[6]+Ge[6]*Je,Ce[7]=Ie[7]+Ge[7]*Je,Ce[8]=Ie[8]+Ge[8]*Je,Ce},exactEquals:function ge(Ce,Ie){return Ce[0]===Ie[0]&&Ce[1]===Ie[1]&&Ce[2]===Ie[2]&&Ce[3]===Ie[3]&&Ce[4]===Ie[4]&&Ce[5]===Ie[5]&&Ce[6]===Ie[6]&&Ce[7]===Ie[7]&&Ce[8]===Ie[8]},equals:function ye(Ce,Ie){const Ge=Ce[0],Je=Ce[1],xe=Ce[2],je=Ce[3],We=Ce[4],Ne=Ce[5],we=Ce[6],Oe=Ce[7],$e=Ce[8],Be=Ie[0],Se=Ie[1],De=Ie[2],Fe=Ie[3],ve=Ie[4],Ke=Ie[5],qe=Ie[6],be=Ie[7],tt=Ie[8];return Math.abs(Ge-Be)<=x.E*Math.max(1,Math.abs(Ge),Math.abs(Be))&&Math.abs(Je-Se)<=x.E*Math.max(1,Math.abs(Je),Math.abs(Se))&&Math.abs(xe-De)<=x.E*Math.max(1,Math.abs(xe),Math.abs(De))&&Math.abs(je-Fe)<=x.E*Math.max(1,Math.abs(je),Math.abs(Fe))&&Math.abs(We-ve)<=x.E*Math.max(1,Math.abs(We),Math.abs(ve))&&Math.abs(Ne-Ke)<=x.E*Math.max(1,Math.abs(Ne),Math.abs(Ke))&&Math.abs(we-qe)<=x.E*Math.max(1,Math.abs(we),Math.abs(qe))&&Math.abs(Oe-be)<=x.E*Math.max(1,Math.abs(Oe),Math.abs(be))&&Math.abs($e-tt)<=x.E*Math.max(1,Math.abs($e),Math.abs(tt))},isOrthoNormal:Me,mul:Z,sub:_e},Symbol.toStringTag,{value:"Module"}))},49966:(dt,Re,T)=>{"use strict";function x(){const re=new Float32Array(9);return re[0]=1,re[4]=1,re[8]=1,re}function A(re){const J=new Float32Array(9);return J[0]=re[0],J[1]=re[1],J[2]=re[2],J[3]=re[3],J[4]=re[4],J[5]=re[5],J[6]=re[6],J[7]=re[7],J[8]=re[8],J}function G(re,J,W,B,Z,ie,ue,ce,oe){const le=new Float32Array(9);return le[0]=re,le[1]=J,le[2]=W,le[3]=B,le[4]=Z,le[5]=ie,le[6]=ue,le[7]=ce,le[8]=oe,le}T.d(Re,{a:()=>A,c:()=>x,f:()=>G}),Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:G,createView:function Q(re,J){return new Float32Array(re,J,9)}},Symbol.toStringTag,{value:"Module"}))},550:(dt,Re,T)=>{"use strict";function x(){return[1,0,0,0,1,0,0,0,1]}function Q(re,J){return new Float64Array(re,J,9)}T.d(Re,{a:()=>Q,c:()=>x}),Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:function A(re){return[re[0],re[1],re[2],re[3],re[4],re[5],re[6],re[7],re[8]]},fromValues:function G(re,J,W,B,Z,ie,ue,ce,oe){return[re,J,W,B,Z,ie,ue,ce,oe]},createView:Q},Symbol.toStringTag,{value:"Module"}))},28347:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>_e,a:()=>J,b:()=>ne,c:()=>G,d:()=>U,e:()=>ce,f:()=>j,g:()=>Y,h:()=>ue,i:()=>H,j:()=>ie,k:()=>Me,l:()=>Ee,m:()=>Z,n:()=>Ie,o:()=>le,p:()=>Be,q:()=>Ce,r:()=>oe,s:()=>Q,t:()=>re,u:()=>X,v:()=>$e,w:()=>Oe,x:()=>pe,y:()=>Ge,z:()=>ee});var x=T(28093),A=T(39863);function G(ve,Ke){return ve[0]=Ke[0],ve[1]=Ke[1],ve[2]=Ke[2],ve[3]=Ke[3],ve[4]=Ke[4],ve[5]=Ke[5],ve[6]=Ke[6],ve[7]=Ke[7],ve[8]=Ke[8],ve[9]=Ke[9],ve[10]=Ke[10],ve[11]=Ke[11],ve[12]=Ke[12],ve[13]=Ke[13],ve[14]=Ke[14],ve[15]=Ke[15],ve}function Q(ve,Ke,qe,be,tt,Ye,ze,et,ke,ot,at,yt,wt,zt,Rt,Ft,bt){return ve[0]=Ke,ve[1]=qe,ve[2]=be,ve[3]=tt,ve[4]=Ye,ve[5]=ze,ve[6]=et,ve[7]=ke,ve[8]=ot,ve[9]=at,ve[10]=yt,ve[11]=wt,ve[12]=zt,ve[13]=Rt,ve[14]=Ft,ve[15]=bt,ve}function H(ve){return ve[0]=1,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=0,ve[5]=1,ve[6]=0,ve[7]=0,ve[8]=0,ve[9]=0,ve[10]=1,ve[11]=0,ve[12]=0,ve[13]=0,ve[14]=0,ve[15]=1,ve}function re(ve,Ke){if(ve===Ke){const qe=Ke[1],be=Ke[2],tt=Ke[3],Ye=Ke[6],ze=Ke[7],et=Ke[11];ve[1]=Ke[4],ve[2]=Ke[8],ve[3]=Ke[12],ve[4]=qe,ve[6]=Ke[9],ve[7]=Ke[13],ve[8]=be,ve[9]=Ye,ve[11]=Ke[14],ve[12]=tt,ve[13]=ze,ve[14]=et}else ve[0]=Ke[0],ve[1]=Ke[4],ve[2]=Ke[8],ve[3]=Ke[12],ve[4]=Ke[1],ve[5]=Ke[5],ve[6]=Ke[9],ve[7]=Ke[13],ve[8]=Ke[2],ve[9]=Ke[6],ve[10]=Ke[10],ve[11]=Ke[14],ve[12]=Ke[3],ve[13]=Ke[7],ve[14]=Ke[11],ve[15]=Ke[15];return ve}function J(ve,Ke){const qe=Ke[0],be=Ke[1],tt=Ke[2],Ye=Ke[3],ze=Ke[4],et=Ke[5],ke=Ke[6],ot=Ke[7],at=Ke[8],yt=Ke[9],wt=Ke[10],zt=Ke[11],Rt=Ke[12],Ft=Ke[13],bt=Ke[14],St=Ke[15],Xt=qe*et-be*ze,Mr=qe*ke-tt*ze,Cr=qe*ot-Ye*ze,Yr=be*ke-tt*et,Lr=be*ot-Ye*et,ct=tt*ot-Ye*ke,jt=at*Ft-yt*Rt,qt=at*bt-wt*Rt,er=at*St-zt*Rt,Zt=yt*bt-wt*Ft,tr=yt*St-zt*Ft,ir=wt*St-zt*bt;let fr=Xt*ir-Mr*tr+Cr*Zt+Yr*er-Lr*qt+ct*jt;return fr?(fr=1/fr,ve[0]=(et*ir-ke*tr+ot*Zt)*fr,ve[1]=(tt*tr-be*ir-Ye*Zt)*fr,ve[2]=(Ft*ct-bt*Lr+St*Yr)*fr,ve[3]=(wt*Lr-yt*ct-zt*Yr)*fr,ve[4]=(ke*er-ze*ir-ot*qt)*fr,ve[5]=(qe*ir-tt*er+Ye*qt)*fr,ve[6]=(bt*Cr-Rt*ct-St*Mr)*fr,ve[7]=(at*ct-wt*Cr+zt*Mr)*fr,ve[8]=(ze*tr-et*er+ot*jt)*fr,ve[9]=(be*er-qe*tr-Ye*jt)*fr,ve[10]=(Rt*Lr-Ft*Cr+St*Xt)*fr,ve[11]=(yt*Cr-at*Lr-zt*Xt)*fr,ve[12]=(et*qt-ze*Zt-ke*jt)*fr,ve[13]=(qe*Zt-be*qt+tt*jt)*fr,ve[14]=(Ft*Mr-Rt*Yr-bt*Xt)*fr,ve[15]=(at*Yr-yt*Mr+wt*Xt)*fr,ve):null}function Z(ve,Ke,qe){const be=Ke[0],tt=Ke[1],Ye=Ke[2],ze=Ke[3],et=Ke[4],ke=Ke[5],ot=Ke[6],at=Ke[7],yt=Ke[8],wt=Ke[9],zt=Ke[10],Rt=Ke[11],Ft=Ke[12],bt=Ke[13],St=Ke[14],Xt=Ke[15];let Mr=qe[0],Cr=qe[1],Yr=qe[2],Lr=qe[3];return ve[0]=Mr*be+Cr*et+Yr*yt+Lr*Ft,ve[1]=Mr*tt+Cr*ke+Yr*wt+Lr*bt,ve[2]=Mr*Ye+Cr*ot+Yr*zt+Lr*St,ve[3]=Mr*ze+Cr*at+Yr*Rt+Lr*Xt,Mr=qe[4],Cr=qe[5],Yr=qe[6],Lr=qe[7],ve[4]=Mr*be+Cr*et+Yr*yt+Lr*Ft,ve[5]=Mr*tt+Cr*ke+Yr*wt+Lr*bt,ve[6]=Mr*Ye+Cr*ot+Yr*zt+Lr*St,ve[7]=Mr*ze+Cr*at+Yr*Rt+Lr*Xt,Mr=qe[8],Cr=qe[9],Yr=qe[10],Lr=qe[11],ve[8]=Mr*be+Cr*et+Yr*yt+Lr*Ft,ve[9]=Mr*tt+Cr*ke+Yr*wt+Lr*bt,ve[10]=Mr*Ye+Cr*ot+Yr*zt+Lr*St,ve[11]=Mr*ze+Cr*at+Yr*Rt+Lr*Xt,Mr=qe[12],Cr=qe[13],Yr=qe[14],Lr=qe[15],ve[12]=Mr*be+Cr*et+Yr*yt+Lr*Ft,ve[13]=Mr*tt+Cr*ke+Yr*wt+Lr*bt,ve[14]=Mr*Ye+Cr*ot+Yr*zt+Lr*St,ve[15]=Mr*ze+Cr*at+Yr*Rt+Lr*Xt,ve}function ie(ve,Ke,qe){const be=qe[0],tt=qe[1],Ye=qe[2];if(Ke===ve)ve[12]=Ke[0]*be+Ke[4]*tt+Ke[8]*Ye+Ke[12],ve[13]=Ke[1]*be+Ke[5]*tt+Ke[9]*Ye+Ke[13],ve[14]=Ke[2]*be+Ke[6]*tt+Ke[10]*Ye+Ke[14],ve[15]=Ke[3]*be+Ke[7]*tt+Ke[11]*Ye+Ke[15];else{const ze=Ke[0],et=Ke[1],ke=Ke[2],ot=Ke[3],at=Ke[4],yt=Ke[5],wt=Ke[6],zt=Ke[7],Rt=Ke[8],Ft=Ke[9],bt=Ke[10],St=Ke[11];ve[0]=ze,ve[1]=et,ve[2]=ke,ve[3]=ot,ve[4]=at,ve[5]=yt,ve[6]=wt,ve[7]=zt,ve[8]=Rt,ve[9]=Ft,ve[10]=bt,ve[11]=St,ve[12]=ze*be+at*tt+Rt*Ye+Ke[12],ve[13]=et*be+yt*tt+Ft*Ye+Ke[13],ve[14]=ke*be+wt*tt+bt*Ye+Ke[14],ve[15]=ot*be+zt*tt+St*Ye+Ke[15]}return ve}function ue(ve,Ke,qe){const be=qe[0],tt=qe[1],Ye=qe[2];return ve[0]=Ke[0]*be,ve[1]=Ke[1]*be,ve[2]=Ke[2]*be,ve[3]=Ke[3]*be,ve[4]=Ke[4]*tt,ve[5]=Ke[5]*tt,ve[6]=Ke[6]*tt,ve[7]=Ke[7]*tt,ve[8]=Ke[8]*Ye,ve[9]=Ke[9]*Ye,ve[10]=Ke[10]*Ye,ve[11]=Ke[11]*Ye,ve[12]=Ke[12],ve[13]=Ke[13],ve[14]=Ke[14],ve[15]=Ke[15],ve}function ce(ve,Ke,qe,be){let tt,Ye,ze,et,ke,ot,at,yt,wt,zt,Rt,Ft,bt,St,Xt,Mr,Cr,Yr,Lr,ct,jt,qt,er,Zt,tr=be[0],ir=be[1],fr=be[2],Ur=Math.sqrt(tr*tr+ir*ir+fr*fr);return Ur<A.E?null:(Ur=1/Ur,tr*=Ur,ir*=Ur,fr*=Ur,tt=Math.sin(qe),Ye=Math.cos(qe),ze=1-Ye,et=Ke[0],ke=Ke[1],ot=Ke[2],at=Ke[3],yt=Ke[4],wt=Ke[5],zt=Ke[6],Rt=Ke[7],Ft=Ke[8],bt=Ke[9],St=Ke[10],Xt=Ke[11],Mr=tr*tr*ze+Ye,Cr=ir*tr*ze+fr*tt,Yr=fr*tr*ze-ir*tt,Lr=tr*ir*ze-fr*tt,ct=ir*ir*ze+Ye,jt=fr*ir*ze+tr*tt,qt=tr*fr*ze+ir*tt,er=ir*fr*ze-tr*tt,Zt=fr*fr*ze+Ye,ve[0]=et*Mr+yt*Cr+Ft*Yr,ve[1]=ke*Mr+wt*Cr+bt*Yr,ve[2]=ot*Mr+zt*Cr+St*Yr,ve[3]=at*Mr+Rt*Cr+Xt*Yr,ve[4]=et*Lr+yt*ct+Ft*jt,ve[5]=ke*Lr+wt*ct+bt*jt,ve[6]=ot*Lr+zt*ct+St*jt,ve[7]=at*Lr+Rt*ct+Xt*jt,ve[8]=et*qt+yt*er+Ft*Zt,ve[9]=ke*qt+wt*er+bt*Zt,ve[10]=ot*qt+zt*er+St*Zt,ve[11]=at*qt+Rt*er+Xt*Zt,Ke!==ve&&(ve[12]=Ke[12],ve[13]=Ke[13],ve[14]=Ke[14],ve[15]=Ke[15]),ve)}function oe(ve,Ke,qe){const be=Math.sin(qe),tt=Math.cos(qe),Ye=Ke[4],ze=Ke[5],et=Ke[6],ke=Ke[7],ot=Ke[8],at=Ke[9],yt=Ke[10],wt=Ke[11];return Ke!==ve&&(ve[0]=Ke[0],ve[1]=Ke[1],ve[2]=Ke[2],ve[3]=Ke[3],ve[12]=Ke[12],ve[13]=Ke[13],ve[14]=Ke[14],ve[15]=Ke[15]),ve[4]=Ye*tt+ot*be,ve[5]=ze*tt+at*be,ve[6]=et*tt+yt*be,ve[7]=ke*tt+wt*be,ve[8]=ot*tt-Ye*be,ve[9]=at*tt-ze*be,ve[10]=yt*tt-et*be,ve[11]=wt*tt-ke*be,ve}function le(ve,Ke,qe){const be=Math.sin(qe),tt=Math.cos(qe),Ye=Ke[0],ze=Ke[1],et=Ke[2],ke=Ke[3],ot=Ke[8],at=Ke[9],yt=Ke[10],wt=Ke[11];return Ke!==ve&&(ve[4]=Ke[4],ve[5]=Ke[5],ve[6]=Ke[6],ve[7]=Ke[7],ve[12]=Ke[12],ve[13]=Ke[13],ve[14]=Ke[14],ve[15]=Ke[15]),ve[0]=Ye*tt-ot*be,ve[1]=ze*tt-at*be,ve[2]=et*tt-yt*be,ve[3]=ke*tt-wt*be,ve[8]=Ye*be+ot*tt,ve[9]=ze*be+at*tt,ve[10]=et*be+yt*tt,ve[11]=ke*be+wt*tt,ve}function Y(ve,Ke,qe){const be=Math.sin(qe),tt=Math.cos(qe),Ye=Ke[0],ze=Ke[1],et=Ke[2],ke=Ke[3],ot=Ke[4],at=Ke[5],yt=Ke[6],wt=Ke[7];return Ke!==ve&&(ve[8]=Ke[8],ve[9]=Ke[9],ve[10]=Ke[10],ve[11]=Ke[11],ve[12]=Ke[12],ve[13]=Ke[13],ve[14]=Ke[14],ve[15]=Ke[15]),ve[0]=Ye*tt+ot*be,ve[1]=ze*tt+at*be,ve[2]=et*tt+yt*be,ve[3]=ke*tt+wt*be,ve[4]=ot*tt-Ye*be,ve[5]=at*tt-ze*be,ve[6]=yt*tt-et*be,ve[7]=wt*tt-ke*be,ve}function j(ve,Ke){return ve[0]=1,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=0,ve[5]=1,ve[6]=0,ve[7]=0,ve[8]=0,ve[9]=0,ve[10]=1,ve[11]=0,ve[12]=Ke[0],ve[13]=Ke[1],ve[14]=Ke[2],ve[15]=1,ve}function X(ve,Ke){return ve[0]=Ke[0],ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=0,ve[5]=Ke[1],ve[6]=0,ve[7]=0,ve[8]=0,ve[9]=0,ve[10]=Ke[2],ve[11]=0,ve[12]=0,ve[13]=0,ve[14]=0,ve[15]=1,ve}function U(ve,Ke,qe){let be,tt,Ye,ze=qe[0],et=qe[1],ke=qe[2],ot=Math.sqrt(ze*ze+et*et+ke*ke);return ot<A.E?null:(ot=1/ot,ze*=ot,et*=ot,ke*=ot,be=Math.sin(Ke),tt=Math.cos(Ke),Ye=1-tt,ve[0]=ze*ze*Ye+tt,ve[1]=et*ze*Ye+ke*be,ve[2]=ke*ze*Ye-et*be,ve[3]=0,ve[4]=ze*et*Ye-ke*be,ve[5]=et*et*Ye+tt,ve[6]=ke*et*Ye+ze*be,ve[7]=0,ve[8]=ze*ke*Ye+et*be,ve[9]=et*ke*Ye-ze*be,ve[10]=ke*ke*Ye+tt,ve[11]=0,ve[12]=0,ve[13]=0,ve[14]=0,ve[15]=1,ve)}function ee(ve,Ke){const qe=Math.sin(Ke),be=Math.cos(Ke);return ve[0]=1,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=0,ve[5]=be,ve[6]=qe,ve[7]=0,ve[8]=0,ve[9]=-qe,ve[10]=be,ve[11]=0,ve[12]=0,ve[13]=0,ve[14]=0,ve[15]=1,ve}function ne(ve,Ke){const qe=Math.sin(Ke),be=Math.cos(Ke);return ve[0]=be,ve[1]=qe,ve[2]=0,ve[3]=0,ve[4]=-qe,ve[5]=be,ve[6]=0,ve[7]=0,ve[8]=0,ve[9]=0,ve[10]=1,ve[11]=0,ve[12]=0,ve[13]=0,ve[14]=0,ve[15]=1,ve}function se(ve,Ke,qe){const be=Ke[0],tt=Ke[1],Ye=Ke[2],ze=Ke[3],et=be+be,ke=tt+tt,ot=Ye+Ye,at=be*et,yt=be*ke,wt=be*ot,zt=tt*ke,Rt=tt*ot,Ft=Ye*ot,bt=ze*et,St=ze*ke,Xt=ze*ot;return ve[0]=1-(zt+Ft),ve[1]=yt+Xt,ve[2]=wt-St,ve[3]=0,ve[4]=yt-Xt,ve[5]=1-(at+Ft),ve[6]=Rt+bt,ve[7]=0,ve[8]=wt+St,ve[9]=Rt-bt,ve[10]=1-(at+zt),ve[11]=0,ve[12]=qe[0],ve[13]=qe[1],ve[14]=qe[2],ve[15]=1,ve}const de=(0,x.c)();function _e(ve,Ke){return ve[0]=Ke[12],ve[1]=Ke[13],ve[2]=Ke[14],ve}function pe(ve,Ke){const qe=Ke[0],be=Ke[1],tt=Ke[2],Ye=Ke[4],ze=Ke[5],et=Ke[6],ke=Ke[8],ot=Ke[9],at=Ke[10];return ve[0]=Math.sqrt(qe*qe+be*be+tt*tt),ve[1]=Math.sqrt(Ye*Ye+ze*ze+et*et),ve[2]=Math.sqrt(ke*ke+ot*ot+at*at),ve}function Me(ve,Ke){const qe=Ke[0],be=Ke[1],tt=Ke[2],Ye=Ke[3],ze=qe+qe,et=be+be,ke=tt+tt,ot=qe*ze,at=be*ze,yt=be*et,wt=tt*ze,zt=tt*et,Rt=tt*ke,Ft=Ye*ze,bt=Ye*et,St=Ye*ke;return ve[0]=1-yt-Rt,ve[1]=at+St,ve[2]=wt-bt,ve[3]=0,ve[4]=at-St,ve[5]=1-ot-Rt,ve[6]=zt+Ft,ve[7]=0,ve[8]=wt+bt,ve[9]=zt-Ft,ve[10]=1-ot-yt,ve[11]=0,ve[12]=0,ve[13]=0,ve[14]=0,ve[15]=1,ve}function Ee(ve,Ke,qe,be,tt,Ye,ze){const et=1/(qe-Ke),ke=1/(tt-be),ot=1/(Ye-ze);return ve[0]=2*Ye*et,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=0,ve[5]=2*Ye*ke,ve[6]=0,ve[7]=0,ve[8]=(qe+Ke)*et,ve[9]=(tt+be)*ke,ve[10]=(ze+Ye)*ot,ve[11]=-1,ve[12]=0,ve[13]=0,ve[14]=ze*Ye*2*ot,ve[15]=0,ve}function Ce(ve,Ke,qe,be,tt,Ye,ze){const et=1/(Ke-qe),ke=1/(be-tt),ot=1/(Ye-ze);return ve[0]=-2*et,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=0,ve[5]=-2*ke,ve[6]=0,ve[7]=0,ve[8]=0,ve[9]=0,ve[10]=2*ot,ve[11]=0,ve[12]=(Ke+qe)*et,ve[13]=(tt+be)*ke,ve[14]=(ze+Ye)*ot,ve[15]=1,ve}function Ie(ve,Ke,qe,be){let tt,Ye,ze,et,ke,ot,at,yt,wt,zt;const Rt=Ke[0],Ft=Ke[1],bt=Ke[2],St=be[0],Xt=be[1],Mr=be[2],Cr=qe[0],Yr=qe[1],Lr=qe[2];return Math.abs(Rt-Cr)<A.E&&Math.abs(Ft-Yr)<A.E&&Math.abs(bt-Lr)<A.E?H(ve):(at=Rt-Cr,yt=Ft-Yr,wt=bt-Lr,zt=1/Math.sqrt(at*at+yt*yt+wt*wt),at*=zt,yt*=zt,wt*=zt,tt=Xt*wt-Mr*yt,Ye=Mr*at-St*wt,ze=St*yt-Xt*at,zt=Math.sqrt(tt*tt+Ye*Ye+ze*ze),zt?(zt=1/zt,tt*=zt,Ye*=zt,ze*=zt):(tt=0,Ye=0,ze=0),et=yt*ze-wt*Ye,ke=wt*tt-at*ze,ot=at*Ye-yt*tt,zt=Math.sqrt(et*et+ke*ke+ot*ot),zt?(zt=1/zt,et*=zt,ke*=zt,ot*=zt):(et=0,ke=0,ot=0),ve[0]=tt,ve[1]=et,ve[2]=at,ve[3]=0,ve[4]=Ye,ve[5]=ke,ve[6]=yt,ve[7]=0,ve[8]=ze,ve[9]=ot,ve[10]=wt,ve[11]=0,ve[12]=-(tt*Rt+Ye*Ft+ze*bt),ve[13]=-(et*Rt+ke*Ft+ot*bt),ve[14]=-(at*Rt+yt*Ft+wt*bt),ve[15]=1,ve)}function Ge(ve,Ke,qe,be){const tt=Ke[0],Ye=Ke[1],ze=Ke[2],et=be[0],ke=be[1],ot=be[2];let at=tt-qe[0],yt=Ye-qe[1],wt=ze-qe[2],zt=at*at+yt*yt+wt*wt;zt>0&&(zt=1/Math.sqrt(zt),at*=zt,yt*=zt,wt*=zt);let Rt=ke*wt-ot*yt,Ft=ot*at-et*wt,bt=et*yt-ke*at;return zt=Rt*Rt+Ft*Ft+bt*bt,zt>0&&(zt=1/Math.sqrt(zt),Rt*=zt,Ft*=zt,bt*=zt),ve[0]=Rt,ve[1]=Ft,ve[2]=bt,ve[3]=0,ve[4]=yt*bt-wt*Ft,ve[5]=wt*Rt-at*bt,ve[6]=at*Ft-yt*Rt,ve[7]=0,ve[8]=at,ve[9]=yt,ve[10]=wt,ve[11]=0,ve[12]=tt,ve[13]=Ye,ve[14]=ze,ve[15]=1,ve}function We(ve,Ke,qe){return ve[0]=Ke[0]-qe[0],ve[1]=Ke[1]-qe[1],ve[2]=Ke[2]-qe[2],ve[3]=Ke[3]-qe[3],ve[4]=Ke[4]-qe[4],ve[5]=Ke[5]-qe[5],ve[6]=Ke[6]-qe[6],ve[7]=Ke[7]-qe[7],ve[8]=Ke[8]-qe[8],ve[9]=Ke[9]-qe[9],ve[10]=Ke[10]-qe[10],ve[11]=Ke[11]-qe[11],ve[12]=Ke[12]-qe[12],ve[13]=Ke[13]-qe[13],ve[14]=Ke[14]-qe[14],ve[15]=Ke[15]-qe[15],ve}function Oe(ve,Ke){return ve[0]===Ke[0]&&ve[1]===Ke[1]&&ve[2]===Ke[2]&&ve[3]===Ke[3]&&ve[4]===Ke[4]&&ve[5]===Ke[5]&&ve[6]===Ke[6]&&ve[7]===Ke[7]&&ve[8]===Ke[8]&&ve[9]===Ke[9]&&ve[10]===Ke[10]&&ve[11]===Ke[11]&&ve[12]===Ke[12]&&ve[13]===Ke[13]&&ve[14]===Ke[14]&&ve[15]===Ke[15]}function $e(ve,Ke){if(ve===Ke)return!0;const qe=ve[0],be=ve[1],tt=ve[2],Ye=ve[3],ze=ve[4],et=ve[5],ke=ve[6],ot=ve[7],at=ve[8],yt=ve[9],wt=ve[10],zt=ve[11],Rt=ve[12],Ft=ve[13],bt=ve[14],St=ve[15],Xt=Ke[0],Mr=Ke[1],Cr=Ke[2],Yr=Ke[3],Lr=Ke[4],ct=Ke[5],jt=Ke[6],qt=Ke[7],er=Ke[8],Zt=Ke[9],tr=Ke[10],ir=Ke[11],fr=Ke[12],Ur=Ke[13],Br=Ke[14],Zr=Ke[15];return Math.abs(qe-Xt)<=A.E*Math.max(1,Math.abs(qe),Math.abs(Xt))&&Math.abs(be-Mr)<=A.E*Math.max(1,Math.abs(be),Math.abs(Mr))&&Math.abs(tt-Cr)<=A.E*Math.max(1,Math.abs(tt),Math.abs(Cr))&&Math.abs(Ye-Yr)<=A.E*Math.max(1,Math.abs(Ye),Math.abs(Yr))&&Math.abs(ze-Lr)<=A.E*Math.max(1,Math.abs(ze),Math.abs(Lr))&&Math.abs(et-ct)<=A.E*Math.max(1,Math.abs(et),Math.abs(ct))&&Math.abs(ke-jt)<=A.E*Math.max(1,Math.abs(ke),Math.abs(jt))&&Math.abs(ot-qt)<=A.E*Math.max(1,Math.abs(ot),Math.abs(qt))&&Math.abs(at-er)<=A.E*Math.max(1,Math.abs(at),Math.abs(er))&&Math.abs(yt-Zt)<=A.E*Math.max(1,Math.abs(yt),Math.abs(Zt))&&Math.abs(wt-tr)<=A.E*Math.max(1,Math.abs(wt),Math.abs(tr))&&Math.abs(zt-ir)<=A.E*Math.max(1,Math.abs(zt),Math.abs(ir))&&Math.abs(Rt-fr)<=A.E*Math.max(1,Math.abs(Rt),Math.abs(fr))&&Math.abs(Ft-Ur)<=A.E*Math.max(1,Math.abs(Ft),Math.abs(Ur))&&Math.abs(bt-Br)<=A.E*Math.max(1,Math.abs(bt),Math.abs(Br))&&Math.abs(St-Zr)<=A.E*Math.max(1,Math.abs(St),Math.abs(Zr))}function Be(ve){const Ke=A.E,qe=ve[0],be=ve[1],tt=ve[2],Ye=ve[4],ze=ve[5],et=ve[6],ke=ve[8],ot=ve[9],at=ve[10];return Math.abs(1-(qe*qe+Ye*Ye+ke*ke))<=Ke&&Math.abs(1-(be*be+ze*ze+ot*ot))<=Ke&&Math.abs(1-(tt*tt+et*et+at*at))<=Ke}Object.freeze(Object.defineProperty({__proto__:null,copy:G,set:Q,identity:H,transpose:re,invert:J,adjoint:function W(ve,Ke){const qe=Ke[0],be=Ke[1],tt=Ke[2],Ye=Ke[3],ze=Ke[4],et=Ke[5],ke=Ke[6],ot=Ke[7],at=Ke[8],yt=Ke[9],wt=Ke[10],zt=Ke[11],Rt=Ke[12],Ft=Ke[13],bt=Ke[14],St=Ke[15];return ve[0]=et*(wt*St-zt*bt)-yt*(ke*St-ot*bt)+Ft*(ke*zt-ot*wt),ve[1]=-(be*(wt*St-zt*bt)-yt*(tt*St-Ye*bt)+Ft*(tt*zt-Ye*wt)),ve[2]=be*(ke*St-ot*bt)-et*(tt*St-Ye*bt)+Ft*(tt*ot-Ye*ke),ve[3]=-(be*(ke*zt-ot*wt)-et*(tt*zt-Ye*wt)+yt*(tt*ot-Ye*ke)),ve[4]=-(ze*(wt*St-zt*bt)-at*(ke*St-ot*bt)+Rt*(ke*zt-ot*wt)),ve[5]=qe*(wt*St-zt*bt)-at*(tt*St-Ye*bt)+Rt*(tt*zt-Ye*wt),ve[6]=-(qe*(ke*St-ot*bt)-ze*(tt*St-Ye*bt)+Rt*(tt*ot-Ye*ke)),ve[7]=qe*(ke*zt-ot*wt)-ze*(tt*zt-Ye*wt)+at*(tt*ot-Ye*ke),ve[8]=ze*(yt*St-zt*Ft)-at*(et*St-ot*Ft)+Rt*(et*zt-ot*yt),ve[9]=-(qe*(yt*St-zt*Ft)-at*(be*St-Ye*Ft)+Rt*(be*zt-Ye*yt)),ve[10]=qe*(et*St-ot*Ft)-ze*(be*St-Ye*Ft)+Rt*(be*ot-Ye*et),ve[11]=-(qe*(et*zt-ot*yt)-ze*(be*zt-Ye*yt)+at*(be*ot-Ye*et)),ve[12]=-(ze*(yt*bt-wt*Ft)-at*(et*bt-ke*Ft)+Rt*(et*wt-ke*yt)),ve[13]=qe*(yt*bt-wt*Ft)-at*(be*bt-tt*Ft)+Rt*(be*wt-tt*yt),ve[14]=-(qe*(et*bt-ke*Ft)-ze*(be*bt-tt*Ft)+Rt*(be*ke-tt*et)),ve[15]=qe*(et*wt-ke*yt)-ze*(be*wt-tt*yt)+at*(be*ke-tt*et),ve},determinant:function B(ve){const Ke=ve[0],qe=ve[1],be=ve[2],tt=ve[3],Ye=ve[4],ze=ve[5],et=ve[6],ke=ve[7],ot=ve[8],at=ve[9],yt=ve[10],wt=ve[11],zt=ve[12],Rt=ve[13],Ft=ve[14],bt=ve[15];return(Ke*ze-qe*Ye)*(yt*bt-wt*Ft)-(Ke*et-be*Ye)*(at*bt-wt*Rt)+(Ke*ke-tt*Ye)*(at*Ft-yt*Rt)+(qe*et-be*ze)*(ot*bt-wt*zt)-(qe*ke-tt*ze)*(ot*Ft-yt*zt)+(be*ke-tt*et)*(ot*Rt-at*zt)},multiply:Z,translate:ie,scale:ue,rotate:ce,rotateX:oe,rotateY:le,rotateZ:Y,fromTranslation:j,fromScaling:X,fromRotation:U,fromXRotation:ee,fromYRotation:function $(ve,Ke){const qe=Math.sin(Ke),be=Math.cos(Ke);return ve[0]=be,ve[1]=0,ve[2]=-qe,ve[3]=0,ve[4]=0,ve[5]=1,ve[6]=0,ve[7]=0,ve[8]=qe,ve[9]=0,ve[10]=be,ve[11]=0,ve[12]=0,ve[13]=0,ve[14]=0,ve[15]=1,ve},fromZRotation:ne,fromRotationTranslation:se,fromQuat2:function ae(ve,Ke){const qe=de,be=-Ke[0],tt=-Ke[1],Ye=-Ke[2],ze=Ke[3],et=Ke[4],ke=Ke[5],ot=Ke[6],at=Ke[7],yt=be*be+tt*tt+Ye*Ye+ze*ze;return yt>0?(qe[0]=2*(et*ze+at*be+ke*Ye-ot*tt)/yt,qe[1]=2*(ke*ze+at*tt+ot*be-et*Ye)/yt,qe[2]=2*(ot*ze+at*Ye+et*tt-ke*be)/yt):(qe[0]=2*(et*ze+at*be+ke*Ye-ot*tt),qe[1]=2*(ke*ze+at*tt+ot*be-et*Ye),qe[2]=2*(ot*ze+at*Ye+et*tt-ke*be)),se(ve,Ke,qe),ve},getTranslation:_e,getScaling:pe,getRotation:function he(ve,Ke){const qe=Ke[0]+Ke[5]+Ke[10];let be=0;return qe>0?(be=2*Math.sqrt(qe+1),ve[3]=.25*be,ve[0]=(Ke[6]-Ke[9])/be,ve[1]=(Ke[8]-Ke[2])/be,ve[2]=(Ke[1]-Ke[4])/be):Ke[0]>Ke[5]&&Ke[0]>Ke[10]?(be=2*Math.sqrt(1+Ke[0]-Ke[5]-Ke[10]),ve[3]=(Ke[6]-Ke[9])/be,ve[0]=.25*be,ve[1]=(Ke[1]+Ke[4])/be,ve[2]=(Ke[8]+Ke[2])/be):Ke[5]>Ke[10]?(be=2*Math.sqrt(1+Ke[5]-Ke[0]-Ke[10]),ve[3]=(Ke[8]-Ke[2])/be,ve[0]=(Ke[1]+Ke[4])/be,ve[1]=.25*be,ve[2]=(Ke[6]+Ke[9])/be):(be=2*Math.sqrt(1+Ke[10]-Ke[0]-Ke[5]),ve[3]=(Ke[1]-Ke[4])/be,ve[0]=(Ke[8]+Ke[2])/be,ve[1]=(Ke[6]+Ke[9])/be,ve[2]=.25*be),ve},fromRotationTranslationScale:function ge(ve,Ke,qe,be){const tt=Ke[0],Ye=Ke[1],ze=Ke[2],et=Ke[3],ke=tt+tt,ot=Ye+Ye,at=ze+ze,yt=tt*ke,wt=tt*ot,zt=tt*at,Rt=Ye*ot,Ft=Ye*at,bt=ze*at,St=et*ke,Xt=et*ot,Mr=et*at,Cr=be[0],Yr=be[1],Lr=be[2];return ve[0]=(1-(Rt+bt))*Cr,ve[1]=(wt+Mr)*Cr,ve[2]=(zt-Xt)*Cr,ve[3]=0,ve[4]=(wt-Mr)*Yr,ve[5]=(1-(yt+bt))*Yr,ve[6]=(Ft+St)*Yr,ve[7]=0,ve[8]=(zt+Xt)*Lr,ve[9]=(Ft-St)*Lr,ve[10]=(1-(yt+Rt))*Lr,ve[11]=0,ve[12]=qe[0],ve[13]=qe[1],ve[14]=qe[2],ve[15]=1,ve},fromRotationTranslationScaleOrigin:function ye(ve,Ke,qe,be,tt){const Ye=Ke[0],ze=Ke[1],et=Ke[2],ke=Ke[3],ot=Ye+Ye,at=ze+ze,yt=et+et,wt=Ye*ot,zt=Ye*at,Rt=Ye*yt,Ft=ze*at,bt=ze*yt,St=et*yt,Xt=ke*ot,Mr=ke*at,Cr=ke*yt,Yr=be[0],Lr=be[1],ct=be[2],jt=tt[0],qt=tt[1],er=tt[2],Zt=(1-(Ft+St))*Yr,tr=(zt+Cr)*Yr,ir=(Rt-Mr)*Yr,fr=(zt-Cr)*Lr,Ur=(1-(wt+St))*Lr,Br=(bt+Xt)*Lr,Zr=(Rt+Mr)*ct,ri=(bt-Xt)*ct,hr=(1-(wt+Ft))*ct;return ve[0]=Zt,ve[1]=tr,ve[2]=ir,ve[3]=0,ve[4]=fr,ve[5]=Ur,ve[6]=Br,ve[7]=0,ve[8]=Zr,ve[9]=ri,ve[10]=hr,ve[11]=0,ve[12]=qe[0]+jt-(Zt*jt+fr*qt+Zr*er),ve[13]=qe[1]+qt-(tr*jt+Ur*qt+ri*er),ve[14]=qe[2]+er-(ir*jt+Br*qt+hr*er),ve[15]=1,ve},fromQuat:Me,frustum:Ee,perspective:function Te(ve,Ke,qe,be,tt){const Ye=1/Math.tan(Ke/2);let ze;return ve[0]=Ye/qe,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=0,ve[5]=Ye,ve[6]=0,ve[7]=0,ve[8]=0,ve[9]=0,ve[11]=-1,ve[12]=0,ve[13]=0,ve[15]=0,null!=tt&&tt!==1/0?(ze=1/(be-tt),ve[10]=(tt+be)*ze,ve[14]=2*tt*be*ze):(ve[10]=-1,ve[14]=-2*be),ve},perspectiveFromFieldOfView:function me(ve,Ke,qe,be){const tt=Math.tan(Ke.upDegrees*Math.PI/180),Ye=Math.tan(Ke.downDegrees*Math.PI/180),ze=Math.tan(Ke.leftDegrees*Math.PI/180),et=Math.tan(Ke.rightDegrees*Math.PI/180),ke=2/(ze+et),ot=2/(tt+Ye);return ve[0]=ke,ve[1]=0,ve[2]=0,ve[3]=0,ve[4]=0,ve[5]=ot,ve[6]=0,ve[7]=0,ve[8]=-(ze-et)*ke*.5,ve[9]=(tt-Ye)*ot*.5,ve[10]=be/(qe-be),ve[11]=-1,ve[12]=0,ve[13]=0,ve[14]=be*qe/(qe-be),ve[15]=0,ve},ortho:Ce,lookAt:Ie,targetTo:Ge,str:function Je(ve){return"mat4("+ve[0]+", "+ve[1]+", "+ve[2]+", "+ve[3]+", "+ve[4]+", "+ve[5]+", "+ve[6]+", "+ve[7]+", "+ve[8]+", "+ve[9]+", "+ve[10]+", "+ve[11]+", "+ve[12]+", "+ve[13]+", "+ve[14]+", "+ve[15]+")"},frob:function xe(ve){return Math.sqrt(ve[0]**2+ve[1]**2+ve[2]**2+ve[3]**2+ve[4]**2+ve[5]**2+ve[6]**2+ve[7]**2+ve[8]**2+ve[9]**2+ve[10]**2+ve[11]**2+ve[12]**2+ve[13]**2+ve[14]**2+ve[15]**2)},add:function je(ve,Ke,qe){return ve[0]=Ke[0]+qe[0],ve[1]=Ke[1]+qe[1],ve[2]=Ke[2]+qe[2],ve[3]=Ke[3]+qe[3],ve[4]=Ke[4]+qe[4],ve[5]=Ke[5]+qe[5],ve[6]=Ke[6]+qe[6],ve[7]=Ke[7]+qe[7],ve[8]=Ke[8]+qe[8],ve[9]=Ke[9]+qe[9],ve[10]=Ke[10]+qe[10],ve[11]=Ke[11]+qe[11],ve[12]=Ke[12]+qe[12],ve[13]=Ke[13]+qe[13],ve[14]=Ke[14]+qe[14],ve[15]=Ke[15]+qe[15],ve},subtract:We,multiplyScalar:function Ne(ve,Ke,qe){return ve[0]=Ke[0]*qe,ve[1]=Ke[1]*qe,ve[2]=Ke[2]*qe,ve[3]=Ke[3]*qe,ve[4]=Ke[4]*qe,ve[5]=Ke[5]*qe,ve[6]=Ke[6]*qe,ve[7]=Ke[7]*qe,ve[8]=Ke[8]*qe,ve[9]=Ke[9]*qe,ve[10]=Ke[10]*qe,ve[11]=Ke[11]*qe,ve[12]=Ke[12]*qe,ve[13]=Ke[13]*qe,ve[14]=Ke[14]*qe,ve[15]=Ke[15]*qe,ve},multiplyScalarAndAdd:function we(ve,Ke,qe,be){return ve[0]=Ke[0]+qe[0]*be,ve[1]=Ke[1]+qe[1]*be,ve[2]=Ke[2]+qe[2]*be,ve[3]=Ke[3]+qe[3]*be,ve[4]=Ke[4]+qe[4]*be,ve[5]=Ke[5]+qe[5]*be,ve[6]=Ke[6]+qe[6]*be,ve[7]=Ke[7]+qe[7]*be,ve[8]=Ke[8]+qe[8]*be,ve[9]=Ke[9]+qe[9]*be,ve[10]=Ke[10]+qe[10]*be,ve[11]=Ke[11]+qe[11]*be,ve[12]=Ke[12]+qe[12]*be,ve[13]=Ke[13]+qe[13]*be,ve[14]=Ke[14]+qe[14]*be,ve[15]=Ke[15]+qe[15]*be,ve},exactEquals:Oe,equals:$e,isOrthoNormal:Be,mul:Z,sub:We},Symbol.toStringTag,{value:"Module"}))},55494:(dt,Re,T)=>{"use strict";function x(){const J=new Float32Array(16);return J[0]=1,J[5]=1,J[10]=1,J[15]=1,J}T.d(Re,{c:()=>x});const H=x();Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:function A(J){const W=new Float32Array(16);return W[0]=J[0],W[1]=J[1],W[2]=J[2],W[3]=J[3],W[4]=J[4],W[5]=J[5],W[6]=J[6],W[7]=J[7],W[8]=J[8],W[9]=J[9],W[10]=J[10],W[11]=J[11],W[12]=J[12],W[13]=J[13],W[14]=J[14],W[15]=J[15],W},fromValues:function G(J,W,B,Z,ie,ue,ce,oe,le,Y,j,X,U,ee,$,ne){const se=new Float32Array(16);return se[0]=J,se[1]=W,se[2]=B,se[3]=Z,se[4]=ie,se[5]=ue,se[6]=ce,se[7]=oe,se[8]=le,se[9]=Y,se[10]=j,se[11]=X,se[12]=U,se[13]=ee,se[14]=$,se[15]=ne,se},createView:function Q(J,W){return new Float32Array(J,W,16)},IDENTITY:H},Symbol.toStringTag,{value:"Module"}))},43703:(dt,Re,T)=>{"use strict";function x(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function A(J){return[J[0],J[1],J[2],J[3],J[4],J[5],J[6],J[7],J[8],J[9],J[10],J[11],J[12],J[13],J[14],J[15]]}function G(J,W,B,Z,ie,ue,ce,oe,le,Y,j,X,U,ee,$,ne){return[J,W,B,Z,ie,ue,ce,oe,le,Y,j,X,U,ee,$,ne]}function Q(J,W){return new Float64Array(J,W,16)}T.d(Re,{I:()=>H,a:()=>Q,b:()=>A,c:()=>x,f:()=>G});const H=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:G,createView:Q,IDENTITY:H},Symbol.toStringTag,{value:"Module"}))},44956:(dt,Re,T)=>{"use strict";T.d(Re,{e:()=>Z,f:()=>B,g:()=>W,h:()=>oe,i:()=>H,j:()=>U,l:()=>J,p:()=>_e});var x=T(54346),A=T(8314);let G,Q=null;function H(){return!!Q}function J(){return G||(G=T.e(3714).then(T.bind(T,73714)).then(pe=>pe.p).then(({default:pe})=>pe({locateFile:he=>(0,x.V)(`esri/geometry/support/${he}`)})).then(pe=>{$(pe)}),G)}var W,B,Z,pe;(function(pe){function he(Ee,Te,me){Q.ensureCache.prepare();const Ce=ae(me),Ie=me===Ce,Ge=Q.ensureFloat64(Ce),Je=Q._pe_geog_to_proj(Q.getPointer(Ee),Te,Ge);return Je&&de(me,Te,Ge,Ie),Je}function ye(Ee,Te,me){return Me(Ee,Te,me,0)}function Me(Ee,Te,me,Ce){Q.ensureCache.prepare();const Ie=ae(me),Ge=me===Ie,Je=Q.ensureFloat64(Ie),xe=Q._pe_proj_to_geog_center(Q.getPointer(Ee),Te,Je,Ce);return xe&&de(me,Te,Je,Ge),xe}pe.geogToProj=he,pe.projGeog=function ge(Ee,Te,me,Ce){switch(Ce){case B.PE_TRANSFORM_P_TO_G:return ye(Ee,Te,me);case B.PE_TRANSFORM_G_TO_P:return he(Ee,Te,me)}return 0},pe.projToGeog=ye,pe.projToGeogCenter=Me})(W||(W={})),(pe=B||(B={})).init=function he(){pe.PE_BUFFER_MAX=Q.PeDefs.prototype.PE_BUFFER_MAX,pe.PE_NAME_MAX=Q.PeDefs.prototype.PE_NAME_MAX,pe.PE_MGRS_MAX=Q.PeDefs.prototype.PE_MGRS_MAX,pe.PE_USNG_MAX=Q.PeDefs.prototype.PE_USNG_MAX,pe.PE_DD_MAX=Q.PeDefs.prototype.PE_DD_MAX,pe.PE_DDM_MAX=Q.PeDefs.prototype.PE_DDM_MAX,pe.PE_DMS_MAX=Q.PeDefs.prototype.PE_DMS_MAX,pe.PE_UTM_MAX=Q.PeDefs.prototype.PE_UTM_MAX,pe.PE_PARM_MAX=Q.PeDefs.prototype.PE_PARM_MAX,pe.PE_TYPE_NONE=Q.PeDefs.prototype.PE_TYPE_NONE,pe.PE_TYPE_GEOGCS=Q.PeDefs.prototype.PE_TYPE_GEOGCS,pe.PE_TYPE_PROJCS=Q.PeDefs.prototype.PE_TYPE_PROJCS,pe.PE_TYPE_GEOGTRAN=Q.PeDefs.prototype.PE_TYPE_GEOGTRAN,pe.PE_TYPE_COORDSYS=Q.PeDefs.prototype.PE_TYPE_COORDSYS,pe.PE_TYPE_UNIT=Q.PeDefs.prototype.PE_TYPE_UNIT,pe.PE_TYPE_LINUNIT=Q.PeDefs.prototype.PE_TYPE_LINUNIT,pe.PE_STR_OPTS_NONE=Q.PeDefs.prototype.PE_STR_OPTS_NONE,pe.PE_STR_AUTH_NONE=Q.PeDefs.prototype.PE_STR_AUTH_NONE,pe.PE_STR_AUTH_TOP=Q.PeDefs.prototype.PE_STR_AUTH_TOP,pe.PE_STR_NAME_CANON=Q.PeDefs.prototype.PE_STR_NAME_CANON,pe.PE_PARM_X0=Q.PeDefs.prototype.PE_PARM_X0,pe.PE_PARM_ND=Q.PeDefs.prototype.PE_PARM_ND,pe.PE_TRANSFORM_1_TO_2=Q.PeDefs.prototype.PE_TRANSFORM_1_TO_2,pe.PE_TRANSFORM_2_TO_1=Q.PeDefs.prototype.PE_TRANSFORM_2_TO_1,pe.PE_TRANSFORM_P_TO_G=Q.PeDefs.prototype.PE_TRANSFORM_P_TO_G,pe.PE_TRANSFORM_G_TO_P=Q.PeDefs.prototype.PE_TRANSFORM_G_TO_P,pe.PE_HORIZON_RECT=Q.PeDefs.prototype.PE_HORIZON_RECT,pe.PE_HORIZON_POLY=Q.PeDefs.prototype.PE_HORIZON_POLY,pe.PE_HORIZON_LINE=Q.PeDefs.prototype.PE_HORIZON_LINE,pe.PE_HORIZON_DELTA=Q.PeDefs.prototype.PE_HORIZON_DELTA},function(pe){const he={},ge={},ye=je=>{if(je){const We=je.getType();switch(We){case B.PE_TYPE_GEOGCS:je=Q.castObject(je,Q.PeGeogcs);break;case B.PE_TYPE_PROJCS:je=Q.castObject(je,Q.PeProjcs);break;case B.PE_TYPE_GEOGTRAN:je=Q.castObject(je,Q.PeGeogtran);break;default:We&B.PE_TYPE_UNIT&&(je=Q.castObject(je,Q.PeUnit))}}return je};function Te(je,We){let Ne=null,we=he[je];if(we||(we={},he[je]=we),we.hasOwnProperty(String(We)))Ne=we[We];else{const Oe=Q.PeFactory.prototype.factoryByType(je,We);Q.compare(Oe,Q.NULL)||(Ne=Oe,we[We]=Ne)}return Ne=ye(Ne),Ne}pe.initialize=function Me(){Q.PeFactory.prototype.initialize(null)},pe.coordsys=function Ee(je){return Te(B.PE_TYPE_COORDSYS,je)},pe.factoryByType=Te,pe.fromString=function me(je,We){let Ne=null,we=ge[je];if(we||(we={},ge[je]=we),we.hasOwnProperty(We))Ne=we[We];else{const Oe=Q.PeFactory.prototype.fromString(je,We);Q.compare(Oe,Q.NULL)||(Ne=Oe,we[We]=Ne)}return Ne=ye(Ne),Ne},pe.geogcs=function Ce(je){return Te(B.PE_TYPE_GEOGCS,je)},pe.geogtran=function Ie(je){return Te(B.PE_TYPE_GEOGTRAN,je)},pe.getCode=function Ge(je){return Q.PeFactory.prototype.getCode(je)},pe.projcs=function Je(je){return Te(B.PE_TYPE_PROJCS,je)},pe.unit=function xe(je){return Te(B.PE_TYPE_UNIT,je)}}(Z||(Z={}));let ie=null;var ue,ce,oe,le,Y,j,X,U,ee;function $(pe){function he(Ee,Te,me){Ee[Te]=me(Ee[Te])}Q=pe,B.init(),ue.init(),Y.init(),X.init(),U.init(),ie=class extends Q.PeGCSExtent{destroy(){Q.destroy(this)}};const ge=[Q.PeDatum,Q.PeGeogcs,Q.PeGeogtran,Q.PeObject,Q.PeParameter,Q.PePrimem,Q.PeProjcs,Q.PeSpheroid,Q.PeUnit];for(const Ee of ge)he(Ee.prototype,"getName",Te=>function(){return Te.call(this,new Array(B.PE_NAME_MAX))});for(const Ee of[Q.PeGeogtran,Q.PeProjcs])he(Ee.prototype,"getParameters",Te=>function(){const me=new Array(B.PE_PARM_MAX);let Ce=Te.call(this);for(let Ie=0;Ie<me.length;Ie++){const Ge=Q.getValue(Ce,"*");me[Ie]=Ge?Q.wrapPointer(Ge,Q.PeParameter):null,Ce+=Int32Array.BYTES_PER_ELEMENT}return me});he(Q.PeHorizon.prototype,"getCoord",Ee=>function(){const Te=this.getSize();if(!Te)return null;const me=[];return de(me,Te,Ee.call(this)),me}),he(Q.PeGTlistExtendedEntry.prototype,"getEntries",Ee=>{const Te=Q._pe_getPeGTlistExtendedGTsSize();return function(){let me=null;const Ce=Ee.call(this);if(!Q.compare(Ce,Q.NULL)){me=[Ce];const Ie=this.getSteps();if(Ie>1){const Ge=Q.getPointer(Ce);for(let Je=1;Je<Ie;Je++)me.push(Q.wrapPointer(Ge+Te*Je,Q.PeGTlistExtendedGTs))}}return me}});const ye=Q._pe_getPeHorizonSize(),Me=Ee=>function(){let Te=this._cache;if(Te||(Te=new Map,this._cache=Te),Te.has(Ee))return Te.get(Ee);let me=null;const Ce=Ee.call(this);if(!Q.compare(Ce,Q.NULL)){me=[Ce];const Ie=Ce.getNump();if(Ie>1){const Ge=Q.getPointer(Ce);for(let Je=1;Je<Ie;Je++)me.push(Q.wrapPointer(Ge+ye*Je,Q.PeHorizon))}}return Te.set(Ee,me),me};he(Q.PeProjcs.prototype,"horizonGcsGenerate",Me),he(Q.PeProjcs.prototype,"horizonPcsGenerate",Me),Q.PeObject.prototype.toString=function(Ee=B.PE_STR_OPTS_NONE){Q.ensureCache.prepare();const Te=Q.getPointer(this),me=Q.ensureInt8(new Array(B.PE_BUFFER_MAX));return Q.UTF8ToString(Q._pe_object_to_string_ext(Te,Ee,me))}}function ne(pe){if(!pe)return;const he=Q.getClass(pe);if(!he)return;const ge=Q.getCache(he);if(!ge)return;const ye=Q.getPointer(pe);ye&&delete ge[ye]}function se(pe,he){const ge=[],ye=new Array(he);for(let Me=0;Me<pe;Me++)ge.push(Q.ensureInt8(ye));return ge}function ae(pe){let he;return Array.isArray(pe[0])?(he=[],pe.forEach(ge=>{he.push(ge[0],ge[1])})):he=pe,he}function de(pe,he,ge,ye=!1){if(ye)for(let Me=0;Me<2*he;Me++)pe[Me]=Q.getValue(ge+Me*Float64Array.BYTES_PER_ELEMENT,"double");else{const Me=0===pe.length;for(let Ee=0;Ee<he;Ee++)Me&&(pe[Ee]=new Array(2)),pe[Ee][0]=Q.getValue(ge,"double"),pe[Ee][1]=Q.getValue(ge+Float64Array.BYTES_PER_ELEMENT,"double"),ge+=2*Float64Array.BYTES_PER_ELEMENT}}(function(pe){let he;pe.init=function ge(){pe.PE_GTLIST_OPTS_COMMON=Q.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,he=Q._pe_getPeGTlistExtendedEntrySize()},pe.getGTlist=function ye(Me,Ee,Te,me,Ce,Ie){let Ge=null;const Je=new Q.PeInteger(Ie);try{const xe=Q.PeGTlistExtended.prototype.getGTlist(Me,Ee,Te,me,Ce,Je);if((Ie=Je.val)&&(Ge=[xe],Ie>1)){const je=Q.getPointer(xe);for(let We=1;We<Ie;We++)Ge.push(Q.wrapPointer(je+he*We,Q.PeGTlistExtendedEntry))}}finally{Q.destroy(Je)}return Ge}})(ue||(ue={})),function(pe){pe.destroy=function he(ge){if(ge&&ge.length){for(const ye of ge)ne(ye),ye.getEntries().forEach(Me=>{ne(Me);const Ee=Me.getGeogtran();ne(Ee),Ee.getParameters().forEach(ne),[Ee.getGeogcs1(),Ee.getGeogcs2()].forEach(Te=>{ne(Te);const me=Te.getDatum();ne(me),ne(me.getSpheroid()),ne(Te.getPrimem()),ne(Te.getUnit())})});Q.PeGTlistExtendedEntry.prototype.Delete(ge[0])}}}(ce||(ce={})),function(pe){pe.geogToGeog=function he(ge,ye,Me,Ee,Te){Q.ensureCache.prepare();const me=ae(Me),Ce=Me===me,Ie=Q.ensureFloat64(me);let Ge=0;Ee&&(Ge=Q.ensureFloat64(Ee));const Je=Q._pe_geog_to_geog(Q.getPointer(ge),ye,Ie,Ge,Te);return Je&&de(Me,ye,Ie,Ce),Je}}(oe||(oe={})),function(pe){const he=(Ie,Ge,Je,xe,je,We)=>{let Ne,we;switch(Q.ensureCache.prepare(),Ie){case"dd":Ne=Q._pe_geog_to_dd,we=B.PE_DD_MAX;break;case"ddm":Ne=Q._pe_geog_to_ddm,we=B.PE_DDM_MAX;break;case"dms":Ne=Q._pe_geog_to_dms,we=B.PE_DMS_MAX}let Oe=0;Ge&&(Oe=Q.getPointer(Ge));const $e=ae(xe),Be=Q.ensureFloat64($e),Se=se(Je,we),De=Ne(Oe,Je,Be,je,Q.ensureInt32(Se));if(De)for(let Fe=0;Fe<Je;Fe++)We[Fe]=Q.UTF8ToString(Se[Fe]);return De},ge=(Ie,Ge,Je,xe,je)=>{let We;switch(Q.ensureCache.prepare(),Ie){case"dd":We=Q._pe_dd_to_geog;break;case"ddm":We=Q._pe_ddm_to_geog;break;case"dms":We=Q._pe_dms_to_geog}let Ne=0;Ge&&(Ne=Q.getPointer(Ge));const we=xe.map(Se=>Q.ensureString(Se)),Oe=Q.ensureInt32(we),$e=Q.ensureFloat64(new Array(2*Je)),Be=We(Ne,Je,Oe,$e);return Be&&de(je,Je,$e),Be};pe.geogToDms=function ye(Ie,Ge,Je,xe,je){return he("dms",Ie,Ge,Je,xe,je)},pe.dmsToGeog=function Me(Ie,Ge,Je,xe){return ge("dms",Ie,Ge,Je,xe)},pe.geogToDdm=function Ee(Ie,Ge,Je,xe,je){return he("ddm",Ie,Ge,Je,xe,je)},pe.ddmToGeog=function Te(Ie,Ge,Je,xe){return ge("ddm",Ie,Ge,Je,xe)},pe.geogToDd=function me(Ie,Ge,Je,xe,je){return he("dd",Ie,Ge,Je,xe,je)},pe.ddToGeog=function Ce(Ie,Ge,Je,xe){return ge("dd",Ie,Ge,Je,xe)}}(le||(le={})),function(pe){pe.init=function he(){pe.PE_MGRS_STYLE_NEW=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,pe.PE_MGRS_STYLE_OLD=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,pe.PE_MGRS_STYLE_AUTO=Q.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,pe.PE_MGRS_180_ZONE_1_PLUS=Q.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,pe.PE_MGRS_ADD_SPACES=Q.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES},pe.geogToMgrsExtended=function ge(Me,Ee,Te,me,Ce,Ie,Ge){Q.ensureCache.prepare();let Je=0;Me&&(Je=Q.getPointer(Me));const xe=ae(Te),je=Q.ensureFloat64(xe),We=se(Ee,B.PE_MGRS_MAX),Ne=Q.ensureInt32(We),we=Q._pe_geog_to_mgrs_extended(Je,Ee,je,me,Ce,Ie,Ne);if(we)for(let Oe=0;Oe<Ee;Oe++)Ge[Oe]=Q.UTF8ToString(We[Oe]);return we},pe.mgrsToGeogExtended=function ye(Me,Ee,Te,me,Ce){Q.ensureCache.prepare();let Ie=0;Me&&(Ie=Q.getPointer(Me));const Ge=Te.map(We=>Q.ensureString(We)),Je=Q.ensureInt32(Ge),xe=Q.ensureFloat64(new Array(2*Ee)),je=Q._pe_mgrs_to_geog_extended(Ie,Ee,Je,me,xe);return je&&de(Ce,Ee,xe),je}}(Y||(Y={})),function(pe){pe.geogToUsng=function he(ye,Me,Ee,Te,me,Ce,Ie){Q.ensureCache.prepare();let Ge=0;ye&&(Ge=Q.getPointer(ye));const Je=ae(Ee),xe=Q.ensureFloat64(Je),je=se(Me,B.PE_MGRS_MAX),We=Q.ensureInt32(je),Ne=Q._pe_geog_to_usng(Ge,Me,xe,Te,me,Ce,We);if(Ne)for(let we=0;we<Me;we++)Ie[we]=Q.UTF8ToString(je[we]);return Ne},pe.usngToGeog=function ge(ye,Me,Ee,Te){Q.ensureCache.prepare();let me=0;ye&&(me=Q.getPointer(ye));const Ce=Ee.map(xe=>Q.ensureString(xe)),Ie=Q.ensureInt32(Ce),Ge=Q.ensureFloat64(new Array(2*Me)),Je=Q._pe_usng_to_geog(me,Me,Ie,Ge);return Je&&de(Te,Me,Ge),Je}}(j||(j={})),function(pe){pe.init=function he(){pe.PE_UTM_OPTS_NONE=Q.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,pe.PE_UTM_OPTS_ADD_SPACES=Q.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,pe.PE_UTM_OPTS_NS=Q.PeNotationUtm.prototype.PE_UTM_OPTS_NS},pe.geogToUtm=function ge(Me,Ee,Te,me,Ce){Q.ensureCache.prepare();let Ie=0;Me&&(Ie=Q.getPointer(Me));const Ge=ae(Te),Je=Q.ensureFloat64(Ge),xe=se(Ee,B.PE_UTM_MAX),je=Q.ensureInt32(xe),We=Q._pe_geog_to_utm(Ie,Ee,Je,me,je);if(We)for(let Ne=0;Ne<Ee;Ne++)Ce[Ne]=Q.UTF8ToString(xe[Ne]);return We},pe.utmToGeog=function ye(Me,Ee,Te,me,Ce){Q.ensureCache.prepare();let Ie=0;Me&&(Ie=Q.getPointer(Me));const Ge=Te.map(We=>Q.ensureString(We)),Je=Q.ensureInt32(Ge),xe=Q.ensureFloat64(new Array(2*Ee)),je=Q._pe_utm_to_geog(Ie,Ee,Je,me,xe);return je&&de(Ce,Ee,xe),je}}(X||(X={})),function(pe){const he=new Map;pe.init=function ge(){pe.PE_PCSINFO_OPTION_NONE=Q.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,pe.PE_PCSINFO_OPTION_DOMAIN=Q.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,pe.PE_POLE_OUTSIDE_BOUNDARY=Q.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,pe.PE_POLE_POINT=Q.PePCSInfo.prototype.PE_POLE_POINT},pe.generate=function ye(Me,Ee=pe.PE_PCSINFO_OPTION_DOMAIN){let Te,me;return he.has(Me)&&(me=he.get(Me),me[Ee]&&(Te=me[Ee])),Te||(Te=Q.PePCSInfo.prototype.generate(Me,Ee),me||(me=[],he.set(Me,me)),me[Ee]=Te),Te}}(U||(U={})),function(pe){pe.versionString=function he(){return Q.PeVersion.prototype.version_string()}}(ee||(ee={}));const _e=Object.freeze(Object.defineProperty({__proto__:null,get _pe(){return Q},isLoaded:H,isSupported:function re(){return!!(0,A.Z)("esri-wasm")},load:J,get PeCSTransformations(){return W},get PeDefs(){return B},get PeFactory(){return Z},get PeGCSExtent(){return ie},get PeGTlistExtended(){return ue},get PeGTlistExtendedEntry(){return ce},get PeGTTransformations(){return oe},get PeNotationDms(){return le},get PeNotationMgrs(){return Y},get PeNotationUsng(){return j},get PeNotationUtm(){return X},get PePCSInfo(){return U},get PeVersion(){return ee},_init:$},Symbol.toStringTag,{value:"Module"}))},29840:(dt,Re,T)=>{"use strict";T.d(Re,{M:()=>ue,e:()=>Z,f:()=>G,i:()=>B,p:()=>ce,r:()=>H,t:()=>Q,w:()=>re});var x=T(62208),A=T(21726);function G(oe,le){const Y=le&&le.url&&le.url.path;if(oe&&Y&&(oe=(0,A.hF)(oe,Y,{preserveProtocolRelative:!0}),le.portalItem&&le.readResourcePaths)){const j=(0,A.PF)(oe,le.portalItem.itemUrl);W.test(j)&&le.readResourcePaths.push(le.portalItem.resourceFromPath(j).path)}return ie(oe,le&&le.portal)}function Q(oe,le,Y=ue.YES){if(!oe)return oe;!(0,A.YP)(oe)&&le&&le.blockedRelativeUrls&&le.blockedRelativeUrls.push(oe);let j=(0,A.hF)(oe);if(le){const X=le.verifyItemRelativeUrls&&le.verifyItemRelativeUrls.rootPath||le.url&&le.url.path;if(X){const U=ie(X,le.portal);j=(0,A.PF)(ie(j,le.portal),U,U),j!==oe&&le.verifyItemRelativeUrls&&le.verifyItemRelativeUrls.writtenUrls.push(j)}}return j=Z(j,le&&le.portal),(0,A.YP)(j)&&(j=(0,A.Fv)(j)),(null==le?void 0:le.resources)&&(null==le?void 0:le.portalItem)&&!(0,A.YP)(j)&&!(0,A.HK)(j)&&Y===ue.YES&&le.resources.toKeep.push({resource:le.portalItem.resourceFromPath(j)}),j}function H(oe,le,Y){return G(oe,Y)}function re(oe,le,Y,j){const X=Q(oe,j);void 0!==X&&(le[Y]=X)}const J=/\/items\/([^\/]+)\/resources\//,W=/^\.\/resources\//;function B(oe){const le=(0,x.pC)(oe)?oe.match(J):null;return(0,x.pC)(le)?le[1]:null}function Z(oe,le){return le&&!le.isPortal&&le.urlKey&&le.customBaseUrl?(0,A.Ie)(oe,`${le.urlKey}.${le.customBaseUrl}`,le.portalHostname):oe}function ie(oe,le){if(!le||le.isPortal||!le.urlKey||!le.customBaseUrl)return oe;const Y=`${le.urlKey}.${le.customBaseUrl}`,j=(0,A.TI)();return(0,A.D6)(j,`${j.scheme}://${Y}`)?(0,A.Ie)(oe,le.portalHostname,Y):(0,A.Ie)(oe,Y,le.portalHostname)}var ue,oe;(oe=ue||(ue={}))[oe.YES=0]="YES",oe[oe.NO=1]="NO";const ce=Object.freeze(Object.defineProperty({__proto__:null,fromJSON:G,toJSON:Q,read:H,write:re,itemIdFromResourceUrl:B,ensureMainOnlineDomain:Z,get MarkKeep(){return ue}},Symbol.toStringTag,{value:"Module"}))},48977:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>ne,c:()=>X,g:()=>B,i:()=>j,j:()=>me,k:()=>ee,m:()=>Z,r:()=>Ie,s:()=>W});var x=T(550),A=T(78451),G=T(28093),Q=T(39863),H=T(84161),re=T(993);function W(Be,Se,De){De*=.5;const Fe=Math.sin(De);return Be[0]=Fe*Se[0],Be[1]=Fe*Se[1],Be[2]=Fe*Se[2],Be[3]=Math.cos(De),Be}function B(Be,Se){const De=2*Math.acos(Se[3]),Fe=Math.sin(De/2);return Fe>Q.E?(Be[0]=Se[0]/Fe,Be[1]=Se[1]/Fe,Be[2]=Se[2]/Fe):(Be[0]=1,Be[1]=0,Be[2]=0),De}function Z(Be,Se,De){const Fe=Se[0],ve=Se[1],Ke=Se[2],qe=Se[3],be=De[0],tt=De[1],Ye=De[2],ze=De[3];return Be[0]=Fe*ze+qe*be+ve*Ye-Ke*tt,Be[1]=ve*ze+qe*tt+Ke*be-Fe*Ye,Be[2]=Ke*ze+qe*Ye+Fe*tt-ve*be,Be[3]=qe*ze-Fe*be-ve*tt-Ke*Ye,Be}function le(Be,Se,De,Fe){const ve=Se[0],Ke=Se[1],qe=Se[2],be=Se[3];let tt,Ye,ze,et,ke,ot=De[0],at=De[1],yt=De[2],wt=De[3];return Ye=ve*ot+Ke*at+qe*yt+be*wt,Ye<0&&(Ye=-Ye,ot=-ot,at=-at,yt=-yt,wt=-wt),1-Ye>Q.E?(tt=Math.acos(Ye),ze=Math.sin(tt),et=Math.sin((1-Fe)*tt)/ze,ke=Math.sin(Fe*tt)/ze):(et=1-Fe,ke=Fe),Be[0]=et*ve+ke*ot,Be[1]=et*Ke+ke*at,Be[2]=et*qe+ke*yt,Be[3]=et*be+ke*wt,Be}function j(Be,Se){const De=Se[0],Fe=Se[1],ve=Se[2],Ke=Se[3],qe=De*De+Fe*Fe+ve*ve+Ke*Ke,be=qe?1/qe:0;return Be[0]=-De*be,Be[1]=-Fe*be,Be[2]=-ve*be,Be[3]=Ke*be,Be}function X(Be,Se){return Be[0]=-Se[0],Be[1]=-Se[1],Be[2]=-Se[2],Be[3]=Se[3],Be}function U(Be,Se){const De=Se[0]+Se[4]+Se[8];let Fe;if(De>0)Fe=Math.sqrt(De+1),Be[3]=.5*Fe,Fe=.5/Fe,Be[0]=(Se[5]-Se[7])*Fe,Be[1]=(Se[6]-Se[2])*Fe,Be[2]=(Se[1]-Se[3])*Fe;else{let ve=0;Se[4]>Se[0]&&(ve=1),Se[8]>Se[3*ve+ve]&&(ve=2);const Ke=(ve+1)%3,qe=(ve+2)%3;Fe=Math.sqrt(Se[3*ve+ve]-Se[3*Ke+Ke]-Se[3*qe+qe]+1),Be[ve]=.5*Fe,Fe=.5/Fe,Be[3]=(Se[3*Ke+qe]-Se[3*qe+Ke])*Fe,Be[Ke]=(Se[3*Ke+ve]+Se[3*ve+Ke])*Fe,Be[qe]=(Se[3*qe+ve]+Se[3*ve+qe])*Fe}return Be}function ee(Be,Se,De,Fe){const ve=.5*Math.PI/180;Se*=ve,De*=ve,Fe*=ve;const Ke=Math.sin(Se),qe=Math.cos(Se),be=Math.sin(De),tt=Math.cos(De),Ye=Math.sin(Fe),ze=Math.cos(Fe);return Be[0]=Ke*tt*ze-qe*be*Ye,Be[1]=qe*be*ze+Ke*tt*Ye,Be[2]=qe*tt*Ye-Ke*be*ze,Be[3]=qe*tt*ze+Ke*be*Ye,Be}const ne=re.c,se=re.s,ae=re.a,de=Z,_e=re.b,pe=re.d,he=re.l,ge=re.e,ye=ge,Me=re.f,Ee=Me,Te=re.n,me=re.g,Ce=re.h;function Ie(Be,Se,De){const Fe=(0,H.e)(Se,De);return Fe<-.999999?((0,H.f)(Ge,Je,Se),(0,H.u)(Ge)<1e-6&&(0,H.f)(Ge,xe,Se),(0,H.n)(Ge,Ge),W(Be,Ge,Math.PI),Be):Fe>.999999?(Be[0]=0,Be[1]=0,Be[2]=0,Be[3]=1,Be):((0,H.f)(Ge,Se,De),Be[0]=Ge[0],Be[1]=Ge[1],Be[2]=Ge[2],Be[3]=1+Fe,Te(Be,Be))}const Ge=(0,G.c)(),Je=(0,G.f)(1,0,0),xe=(0,G.f)(0,1,0),We=(0,A.a)(),Ne=(0,A.a)(),Oe=(0,x.c)();Object.freeze(Object.defineProperty({__proto__:null,identity:function J(Be){return Be[0]=0,Be[1]=0,Be[2]=0,Be[3]=1,Be},setAxisAngle:W,getAxisAngle:B,multiply:Z,rotateX:function ie(Be,Se,De){De*=.5;const Fe=Se[0],ve=Se[1],Ke=Se[2],qe=Se[3],be=Math.sin(De),tt=Math.cos(De);return Be[0]=Fe*tt+qe*be,Be[1]=ve*tt+Ke*be,Be[2]=Ke*tt-ve*be,Be[3]=qe*tt-Fe*be,Be},rotateY:function ue(Be,Se,De){De*=.5;const Fe=Se[0],ve=Se[1],Ke=Se[2],qe=Se[3],be=Math.sin(De),tt=Math.cos(De);return Be[0]=Fe*tt-Ke*be,Be[1]=ve*tt+qe*be,Be[2]=Ke*tt+Fe*be,Be[3]=qe*tt-ve*be,Be},rotateZ:function ce(Be,Se,De){De*=.5;const Fe=Se[0],ve=Se[1],Ke=Se[2],qe=Se[3],be=Math.sin(De),tt=Math.cos(De);return Be[0]=Fe*tt+ve*be,Be[1]=ve*tt-Fe*be,Be[2]=Ke*tt+qe*be,Be[3]=qe*tt-Ke*be,Be},calculateW:function oe(Be,Se){const De=Se[0],Fe=Se[1],ve=Se[2];return Be[0]=De,Be[1]=Fe,Be[2]=ve,Be[3]=Math.sqrt(Math.abs(1-De*De-Fe*Fe-ve*ve)),Be},slerp:le,random:function Y(Be){const Se=(0,Q.R)(),De=(0,Q.R)(),Fe=(0,Q.R)(),ve=Math.sqrt(1-Se),Ke=Math.sqrt(Se);return Be[0]=ve*Math.sin(2*Math.PI*De),Be[1]=ve*Math.cos(2*Math.PI*De),Be[2]=Ke*Math.sin(2*Math.PI*Fe),Be[3]=Ke*Math.cos(2*Math.PI*Fe),Be},invert:j,conjugate:X,fromMat3:U,fromEuler:ee,str:function $(Be){return"quat("+Be[0]+", "+Be[1]+", "+Be[2]+", "+Be[3]+")"},copy:ne,set:se,add:ae,mul:de,scale:_e,dot:pe,lerp:he,length:ge,len:ye,squaredLength:Me,sqrLen:Ee,normalize:Te,exactEquals:me,equals:Ce,rotationTo:Ie,sqlerp:function je(Be,Se,De,Fe,ve,Ke){return le(We,Se,ve,Ke),le(Ne,De,Fe,Ke),le(Be,We,Ne,2*Ke*(1-Ke)),Be},setAxes:function we(Be,Se,De,Fe){const ve=Oe;return ve[0]=De[0],ve[3]=De[1],ve[6]=De[2],ve[1]=Fe[0],ve[4]=Fe[1],ve[7]=Fe[2],ve[2]=-Se[0],ve[5]=-Se[1],ve[8]=-Se[2],Te(Be,U(Be,ve))}},Symbol.toStringTag,{value:"Module"}))},56729:(dt,Re,T)=>{"use strict";function x(){const re=new Float32Array(4);return re[3]=1,re}function A(re){const J=new Float32Array(4);return J[0]=re[0],J[1]=re[1],J[2]=re[2],J[3]=re[3],J}function Q(re,J){return new Float32Array(re,J,4)}T.d(Re,{a:()=>A,b:()=>Q,c:()=>x}),Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:function G(re,J,W,B){const Z=new Float32Array(4);return Z[0]=re,Z[1]=J,Z[2]=W,Z[3]=B,Z},createView:Q},Symbol.toStringTag,{value:"Module"}))},78451:(dt,Re,T)=>{"use strict";function x(){return[0,0,0,1]}function A(J){return[J[0],J[1],J[2],J[3]]}function Q(J,W){return new Float64Array(J,W,4)}T.d(Re,{I:()=>H,a:()=>x,b:()=>A,c:()=>Q});const H=[0,0,0,1];Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:function G(J,W,B,Z){return[J,W,B,Z]},createView:Q,IDENTITY:H},Symbol.toStringTag,{value:"Module"}))},98148:(dt,Re,T)=>{"use strict";function A(Q,H){const re=Q.count;H||(H=new Q.TypedArrayConstructor(re));for(let J=0;J<re;J++)H[J]=Q.get(J);return H}T.d(Re,{m:()=>A}),Object.freeze(Object.defineProperty({__proto__:null,copy:function x(Q,H,re){const J=Q.typedBuffer,W=Q.typedBufferStride,B=H.typedBuffer,Z=H.typedBufferStride,ie=re?re.count:H.count;let ue=(re&&re.dstIndex?re.dstIndex:0)*W,ce=(re&&re.srcIndex?re.srcIndex:0)*Z;for(let oe=0;oe<ie;++oe)J[ue]=B[ce],ue+=W,ce+=Z},makeDense:A},Symbol.toStringTag,{value:"Module"}))},97126:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>U,b:()=>Y,c:()=>le,d:()=>$,e:()=>Te,f:()=>se,g:()=>ne,h:()=>_e,i:()=>he,j:()=>ye,k:()=>ee,l:()=>j,m:()=>xe,s:()=>Ne,t:()=>We,w:()=>X}),T(8314);var A=T(63290),G=T(21286),Q=T(62208),H=T(28347),re=T(84161),J=T(28093),W=T(993),B=T(4794),Z=T(78172),ie=T(70562),ue=T(34054),ce=T(26242);const oe=A.Z.getLogger("esri.geometry.support.sphere");function le(){return(0,B.c)()}function Y(we,Oe=le()){return(0,W.c)(Oe,we)}function j(we,Oe){return(0,B.f)(we[0],we[1],we[2],Oe)}function X(we){return we}function U(we){we[0]=we[1]=we[2]=we[3]=0}function ee(we,Oe){return we[0]=we[1]=we[2]=0,we[3]=Oe,we}function $(we){return we[3]}function ne(we){return we}function se(we,Oe,$e,Be){return(0,B.f)(we,Oe,$e,Be)}function _e(we,Oe,$e){if((0,Q.Wi)(Oe))return!1;const{origin:Be,direction:Se}=Oe,De=pe;De[0]=Be[0]-we[0],De[1]=Be[1]-we[1],De[2]=Be[2]-we[2];const Fe=Se[0]*Se[0]+Se[1]*Se[1]+Se[2]*Se[2],ve=2*(Se[0]*De[0]+Se[1]*De[1]+Se[2]*De[2]),Ke=ve*ve-4*Fe*(De[0]*De[0]+De[1]*De[1]+De[2]*De[2]-we[3]*we[3]);if(Ke<0)return!1;const qe=Math.sqrt(Ke);let be=(-ve-qe)/(2*Fe);const tt=(-ve+qe)/(2*Fe);return(be<0||tt<be&&tt>0)&&(be=tt),!(be<0||($e&&($e[0]=Be[0]+Se[0]*be,$e[1]=Be[1]+Se[1]*be,$e[2]=Be[2]+Se[2]*be),0))}const pe=(0,J.c)();function he(we,Oe){return _e(we,Oe,null)}function ye(we,Oe,$e){const Be=ce.WM.get(),Se=ce.MP.get();(0,re.f)(Be,Oe.origin,Oe.direction);const De=$(we);(0,re.f)($e,Be,Oe.origin),(0,re.g)($e,$e,1/(0,re.l)($e)*De);const Fe=me(we,Oe.origin),ve=(0,ue.EU)(Oe.origin,$e);return(0,H.d)(Se,ve+Fe,Be),(0,re.m)($e,$e,Se),$e}function Ee(we,Oe,$e){const Be=(0,re.b)(ce.WM.get(),Oe,we),Se=(0,re.g)(ce.WM.get(),Be,we[3]/(0,re.l)(Be));return(0,re.a)($e,Se,we)}function Te(we,Oe){const $e=(0,re.b)(ce.WM.get(),Oe,we),Be=(0,re.p)($e);return Math.sqrt(Math.abs(Be-we[3]*we[3]))}function me(we,Oe){const $e=(0,re.b)(ce.WM.get(),Oe,we),Be=(0,re.l)($e),Se=$(we),De=Se+Math.abs(Se-Be);return(0,G.ZF)(Se/De)}const Ce=(0,J.c)();function Ie(we,Oe,$e,Be){const Se=(0,re.b)(Ce,Oe,we);switch($e){case Z.R.X:{const De=(0,G.jE)(Se,Ce)[2];return(0,re.s)(Be,-Math.sin(De),Math.cos(De),0)}case Z.R.Y:{const De=(0,G.jE)(Se,Ce),Fe=De[1],ve=De[2],Ke=Math.sin(Fe);return(0,re.s)(Be,-Ke*Math.cos(ve),-Ke*Math.sin(ve),Math.cos(Fe))}case Z.R.Z:return(0,re.n)(Be,Se);default:return}}function Ge(we,Oe){const $e=(0,re.b)(je,Oe,we);return(0,re.l)($e)-we[3]}function xe(we,Oe){const $e=(0,re.d)(we,Oe),Be=$(we);return $e<=Be*Be}const je=(0,J.c)(),We=le(),Ne=Object.freeze(Object.defineProperty({__proto__:null,create:le,copy:Y,fromCenterAndRadius:j,wrap:X,clear:U,fromRadius:ee,getRadius:$,getCenter:ne,fromValues:se,elevate:function ae(we,Oe,$e){return we!==$e&&(0,re.c)($e,we),$e[3]=we[3]+Oe,$e},setExtent:function de(we,Oe,$e){return oe.error("sphere.setExtent is not yet supported"),we===$e?$e:Y(we,$e)},intersectRay:_e,intersectsRay:he,intersectRayClosestSilhouette:function ge(we,Oe,$e){if(_e(we,Oe,$e))return $e;const Be=ye(we,Oe,ce.WM.get());return(0,re.a)($e,Oe.origin,(0,re.g)(ce.WM.get(),Oe.direction,(0,re.i)(Oe.origin,Be)/(0,re.l)(Oe.direction))),$e},closestPointOnSilhouette:ye,closestPoint:function Me(we,Oe,$e){return _e(we,Oe,$e)?$e:((0,ie.JI)(Oe,we,$e),Ee(we,$e,$e))},projectPoint:Ee,distanceToSilhouette:Te,angleToSilhouette:me,axisAt:Ie,altitudeAt:Ge,setAltitudeAt:function Je(we,Oe,$e,Be){const Se=Ge(we,Oe),De=Ie(we,Oe,Z.R.Z,je),Fe=(0,re.g)(je,De,$e-Se);return(0,re.a)(Be,Oe,Fe)},containsPoint:xe,tmpSphere:We},Symbol.toStringTag,{value:"Module"}))},17626:(dt,Re,T)=>{"use strict";function x(A,G,Q,H){var re,J=arguments.length,W=J<3?G:null===H?H=Object.getOwnPropertyDescriptor(G,Q):H;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)W=Reflect.decorate(A,G,Q,H);else for(var B=A.length-1;B>=0;B--)(re=A[B])&&(W=(J<3?re(W):J>3?re(G,Q,W):re(G,Q))||W);return J>3&&W&&Object.defineProperty(G,Q,W),W}T.d(Re,{_:()=>x})},67831:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>G,b:()=>Q,c:()=>A,d:()=>je,e:()=>Te,f:()=>ce,g:()=>H,h:()=>ne,i:()=>$,j:()=>le,k:()=>Ge,l:()=>ae,m:()=>se,n:()=>U,o:()=>j,p:()=>_e,q:()=>Ce,r:()=>ye,s:()=>Y,t:()=>pe,u:()=>X,v:()=>oe,x:()=>Z,y:()=>ie});var x=T(39863);function A(Oe,$e){return Oe[0]=$e[0],Oe[1]=$e[1],Oe}function G(Oe,$e,Be){return Oe[0]=$e,Oe[1]=Be,Oe}function Q(Oe,$e,Be){return Oe[0]=$e[0]+Be[0],Oe[1]=$e[1]+Be[1],Oe}function H(Oe,$e,Be){return Oe[0]=$e[0]-Be[0],Oe[1]=$e[1]-Be[1],Oe}function re(Oe,$e,Be){return Oe[0]=$e[0]*Be[0],Oe[1]=$e[1]*Be[1],Oe}function J(Oe,$e,Be){return Oe[0]=$e[0]/Be[0],Oe[1]=$e[1]/Be[1],Oe}function Z(Oe,$e,Be){return Oe[0]=Math.min($e[0],Be[0]),Oe[1]=Math.min($e[1],Be[1]),Oe}function ie(Oe,$e,Be){return Oe[0]=Math.max($e[0],Be[0]),Oe[1]=Math.max($e[1],Be[1]),Oe}function ce(Oe,$e,Be){return Oe[0]=$e[0]*Be,Oe[1]=$e[1]*Be,Oe}function oe(Oe,$e,Be,Se){return Oe[0]=$e[0]+Be[0]*Se,Oe[1]=$e[1]+Be[1]*Se,Oe}function le(Oe,$e){const Be=$e[0]-Oe[0],Se=$e[1]-Oe[1];return Math.sqrt(Be*Be+Se*Se)}function Y(Oe,$e){const Be=$e[0]-Oe[0],Se=$e[1]-Oe[1];return Be*Be+Se*Se}function j(Oe){const $e=Oe[0],Be=Oe[1];return Math.sqrt($e*$e+Be*Be)}function X(Oe){const $e=Oe[0],Be=Oe[1];return $e*$e+Be*Be}function U(Oe,$e){return Oe[0]=-$e[0],Oe[1]=-$e[1],Oe}function $(Oe,$e){const Be=$e[0],Se=$e[1];let De=Be*Be+Se*Se;return De>0&&(De=1/Math.sqrt(De),Oe[0]=$e[0]*De,Oe[1]=$e[1]*De),Oe}function ne(Oe,$e){return Oe[0]*$e[0]+Oe[1]*$e[1]}function se(Oe,$e,Be){const Se=$e[0]*Be[1]-$e[1]*Be[0];return Oe[0]=Oe[1]=0,Oe[2]=Se,Oe}function ae(Oe,$e,Be,Se){const De=$e[0],Fe=$e[1];return Oe[0]=De+Se*(Be[0]-De),Oe[1]=Fe+Se*(Be[1]-Fe),Oe}function _e(Oe,$e,Be){const Se=$e[0],De=$e[1];return Oe[0]=Be[0]*Se+Be[2]*De,Oe[1]=Be[1]*Se+Be[3]*De,Oe}function pe(Oe,$e,Be){const Se=$e[0],De=$e[1];return Oe[0]=Be[0]*Se+Be[2]*De+Be[4],Oe[1]=Be[1]*Se+Be[3]*De+Be[5],Oe}function ye(Oe,$e,Be,Se){const De=$e[0]-Be[0],Fe=$e[1]-Be[1],ve=Math.sin(Se),Ke=Math.cos(Se);return Oe[0]=De*Ke-Fe*ve+Be[0],Oe[1]=De*ve+Fe*Ke+Be[1],Oe}function Te(Oe,$e){return Oe[0]===$e[0]&&Oe[1]===$e[1]}function Ce(Oe,$e,Be,Se,De){let Fe=$e[0]-Be[0],ve=$e[1]-Be[1];const Ke=(Se[0]*Fe+Se[1]*ve)*(De-1);return Fe=Se[0]*Ke,ve=Se[1]*Ke,Oe[0]=$e[0]+Fe,Oe[1]=$e[1]+ve,Oe}const Ge=H,je=le;Object.freeze(Object.defineProperty({__proto__:null,copy:A,set:G,add:Q,subtract:H,multiply:re,divide:J,ceil:function W(Oe,$e){return Oe[0]=Math.ceil($e[0]),Oe[1]=Math.ceil($e[1]),Oe},floor:function B(Oe,$e){return Oe[0]=Math.floor($e[0]),Oe[1]=Math.floor($e[1]),Oe},min:Z,max:ie,round:function ue(Oe,$e){return Oe[0]=Math.round($e[0]),Oe[1]=Math.round($e[1]),Oe},scale:ce,scaleAndAdd:oe,distance:le,squaredDistance:Y,length:j,squaredLength:X,negate:U,inverse:function ee(Oe,$e){return Oe[0]=1/$e[0],Oe[1]=1/$e[1],Oe},normalize:$,dot:ne,cross:se,lerp:ae,random:function de(Oe,$e){$e=$e||1;const Be=2*(0,x.R)()*Math.PI;return Oe[0]=Math.cos(Be)*$e,Oe[1]=Math.sin(Be)*$e,Oe},transformMat2:_e,transformMat2d:pe,transformMat3:function he(Oe,$e,Be){const Se=$e[0],De=$e[1];return Oe[0]=Be[0]*Se+Be[3]*De+Be[6],Oe[1]=Be[1]*Se+Be[4]*De+Be[7],Oe},transformMat4:function ge(Oe,$e,Be){const Se=$e[0],De=$e[1];return Oe[0]=Be[0]*Se+Be[4]*De+Be[12],Oe[1]=Be[1]*Se+Be[5]*De+Be[13],Oe},rotate:ye,angle:function Me(Oe,$e){const Be=Oe[0],Se=Oe[1],De=$e[0],Fe=$e[1];let ve=Be*Be+Se*Se;ve>0&&(ve=1/Math.sqrt(ve));let Ke=De*De+Fe*Fe;Ke>0&&(Ke=1/Math.sqrt(Ke));const qe=(Be*De+Se*Fe)*ve*Ke;return qe>1?0:qe<-1?Math.PI:Math.acos(qe)},str:function Ee(Oe){return"vec2("+Oe[0]+", "+Oe[1]+")"},exactEquals:Te,equals:function me(Oe,$e){const Be=Oe[0],Se=Oe[1],De=$e[0],Fe=$e[1];return Math.abs(Be-De)<=x.E*Math.max(1,Math.abs(Be),Math.abs(De))&&Math.abs(Se-Fe)<=x.E*Math.max(1,Math.abs(Se),Math.abs(Fe))},projectAndScale:Ce,len:j,sub:Ge,mul:re,div:J,dist:je,sqrDist:Y,sqrLen:X},Symbol.toStringTag,{value:"Module"}))},35995:(dt,Re,T)=>{"use strict";T.d(Re,{f:()=>Q,n:()=>G});var x=T(81096);function A(re,J,W){const B=re.typedBuffer,Z=re.typedBufferStride,ie=J.typedBuffer,ue=J.typedBufferStride,ce=W?W.count:J.count;let oe=(W&&W.dstIndex?W.dstIndex:0)*Z,le=(W&&W.srcIndex?W.srcIndex:0)*ue;for(let Y=0;Y<ce;++Y)B[oe]=ie[le],B[oe+1]=ie[le+1],oe+=Z,le+=ue}function G(re,J,W){const B=re.typedBuffer,Z=re.typedBufferStride,ie=J.typedBuffer,ue=J.typedBufferStride,ce=W?W.count:J.count;let oe=(W&&W.dstIndex?W.dstIndex:0)*Z,le=(W&&W.srcIndex?W.srcIndex:0)*ue;if((0,x.U)(J.elementType)){const Y=(0,x.Op)(J.elementType);if((0,x.B3)(J.elementType))for(let j=0;j<ce;++j)B[oe]=Math.max(ie[le]/Y,-1),B[oe+1]=Math.max(ie[le+1]/Y,-1),oe+=Z,le+=ue;else for(let j=0;j<ce;++j)B[oe]=ie[le]/Y,B[oe+1]=ie[le+1]/Y,oe+=Z,le+=ue}else A(re,J,W);return re}function Q(re,J,W,B){var oe,le;const Z=re.typedBuffer,ie=re.typedBufferStride,ue=null!=(oe=null==B?void 0:B.count)?oe:re.count;let ce=(null!=(le=null==B?void 0:B.dstIndex)?le:0)*ie;for(let Y=0;Y<ue;++Y)Z[ce]=J,Z[ce+1]=W,ce+=ie}Object.freeze(Object.defineProperty({__proto__:null,copy:A,normalizeIntegerBuffer:G,fill:Q},Symbol.toStringTag,{value:"Module"}))},9545:(dt,Re,T)=>{"use strict";function x(){return new Float32Array(2)}function G(oe,le){const Y=new Float32Array(2);return Y[0]=oe,Y[1]=le,Y}function H(){return x()}function re(){return G(1,1)}function J(){return G(1,0)}function W(){return G(0,1)}T.d(Re,{c:()=>x,f:()=>G});const B=H(),Z=re(),ie=J(),ue=W();Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:function A(oe){const le=new Float32Array(2);return le[0]=oe[0],le[1]=oe[1],le},fromValues:G,createView:function Q(oe,le){return new Float32Array(oe,le,2)},zeros:H,ones:re,unitX:J,unitY:W,ZEROS:B,ONES:Z,UNIT_X:ie,UNIT_Y:ue},Symbol.toStringTag,{value:"Module"}))},99770:(dt,Re,T)=>{"use strict";function x(){return[0,0]}function A(le){return[le[0],le[1]]}function G(le,Y){return[le,Y]}function Q(le){const Y=[0,0],j=Math.min(2,le.length);for(let X=0;X<j;++X)Y[X]=le[X];return Y}function H(le,Y){return new Float64Array(le,Y,2)}function J(){return G(1,1)}function W(){return G(1,0)}function B(){return G(0,1)}T.d(Re,{O:()=>ie,Z:()=>Z,a:()=>x,b:()=>Q,c:()=>H,d:()=>A,f:()=>G});const Z=[0,0],ie=J(),ue=W(),ce=B();Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:G,fromArray:Q,createView:H,zeros:function re(){return[0,0]},ones:J,unitX:W,unitY:B,ZEROS:Z,ONES:ie,UNIT_X:ue,UNIT_Y:ce},Symbol.toStringTag,{value:"Module"}))},84161:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>ue,B:()=>oe,C:()=>X,D:()=>ce,E:()=>W,F:()=>Ke,G:()=>B,H:()=>Ie,a:()=>re,b:()=>J,c:()=>Q,d:()=>ee,e:()=>de,f:()=>_e,g:()=>j,h:()=>pe,i:()=>U,j:()=>Se,k:()=>We,l:()=>G,m:()=>Me,n:()=>ae,o:()=>ne,p:()=>$,q:()=>Te,r:()=>we,s:()=>H,t:()=>Ee,u:()=>Fe,v:()=>Oe,w:()=>ve,x:()=>De,z:()=>Ne});var x=T(28093),A=T(39863);function G(qe){const be=qe[0],tt=qe[1],Ye=qe[2];return Math.sqrt(be*be+tt*tt+Ye*Ye)}function Q(qe,be){return qe[0]=be[0],qe[1]=be[1],qe[2]=be[2],qe}function H(qe,be,tt,Ye){return qe[0]=be,qe[1]=tt,qe[2]=Ye,qe}function re(qe,be,tt){return qe[0]=be[0]+tt[0],qe[1]=be[1]+tt[1],qe[2]=be[2]+tt[2],qe}function J(qe,be,tt){return qe[0]=be[0]-tt[0],qe[1]=be[1]-tt[1],qe[2]=be[2]-tt[2],qe}function W(qe,be,tt){return qe[0]=be[0]*tt[0],qe[1]=be[1]*tt[1],qe[2]=be[2]*tt[2],qe}function B(qe,be,tt){return qe[0]=be[0]/tt[0],qe[1]=be[1]/tt[1],qe[2]=be[2]/tt[2],qe}function ue(qe,be){return qe[0]=Math.abs(be[0]),qe[1]=Math.abs(be[1]),qe[2]=Math.abs(be[2]),qe}function ce(qe,be){return qe[0]=Math.sign(be[0]),qe[1]=Math.sign(be[1]),qe[2]=Math.sign(be[2]),qe}function oe(qe,be,tt){return qe[0]=Math.min(be[0],tt[0]),qe[1]=Math.min(be[1],tt[1]),qe[2]=Math.min(be[2],tt[2]),qe}function j(qe,be,tt){return qe[0]=be[0]*tt,qe[1]=be[1]*tt,qe[2]=be[2]*tt,qe}function X(qe,be,tt,Ye){return qe[0]=be[0]+tt[0]*Ye,qe[1]=be[1]+tt[1]*Ye,qe[2]=be[2]+tt[2]*Ye,qe}function U(qe,be){const tt=be[0]-qe[0],Ye=be[1]-qe[1],ze=be[2]-qe[2];return Math.sqrt(tt*tt+Ye*Ye+ze*ze)}function ee(qe,be){const tt=be[0]-qe[0],Ye=be[1]-qe[1],ze=be[2]-qe[2];return tt*tt+Ye*Ye+ze*ze}function $(qe){const be=qe[0],tt=qe[1],Ye=qe[2];return be*be+tt*tt+Ye*Ye}function ne(qe,be){return qe[0]=-be[0],qe[1]=-be[1],qe[2]=-be[2],qe}function ae(qe,be){const tt=be[0],Ye=be[1],ze=be[2];let et=tt*tt+Ye*Ye+ze*ze;return et>0&&(et=1/Math.sqrt(et),qe[0]=be[0]*et,qe[1]=be[1]*et,qe[2]=be[2]*et),qe}function de(qe,be){return qe[0]*be[0]+qe[1]*be[1]+qe[2]*be[2]}function _e(qe,be,tt){const Ye=be[0],ze=be[1],et=be[2],ke=tt[0],ot=tt[1],at=tt[2];return qe[0]=ze*at-et*ot,qe[1]=et*ke-Ye*at,qe[2]=Ye*ot-ze*ke,qe}function pe(qe,be,tt,Ye){const ze=be[0],et=be[1],ke=be[2];return qe[0]=ze+Ye*(tt[0]-ze),qe[1]=et+Ye*(tt[1]-et),qe[2]=ke+Ye*(tt[2]-ke),qe}function Me(qe,be,tt){const Ye=be[0],ze=be[1],et=be[2];return qe[0]=tt[0]*Ye+tt[4]*ze+tt[8]*et+tt[12],qe[1]=tt[1]*Ye+tt[5]*ze+tt[9]*et+tt[13],qe[2]=tt[2]*Ye+tt[6]*ze+tt[10]*et+tt[14],qe}function Ee(qe,be,tt){const Ye=be[0],ze=be[1],et=be[2];return qe[0]=Ye*tt[0]+ze*tt[3]+et*tt[6],qe[1]=Ye*tt[1]+ze*tt[4]+et*tt[7],qe[2]=Ye*tt[2]+ze*tt[5]+et*tt[8],qe}function Te(qe,be,tt){const Ye=tt[0],ze=tt[1],et=tt[2],ot=be[0],at=be[1],yt=be[2];let wt=ze*yt-et*at,zt=et*ot-Ye*yt,Rt=Ye*at-ze*ot,Ft=ze*Rt-et*zt,bt=et*wt-Ye*Rt,St=Ye*zt-ze*wt;const Xt=2*tt[3];return wt*=Xt,zt*=Xt,Rt*=Xt,Ft*=2,bt*=2,St*=2,qe[0]=ot+wt+Ft,qe[1]=at+zt+bt,qe[2]=yt+Rt+St,qe}function Ie(qe,be,tt,Ye){const ze=[],et=[];return ze[0]=be[0]-tt[0],ze[1]=be[1]-tt[1],ze[2]=be[2]-tt[2],et[0]=ze[0]*Math.cos(Ye)-ze[1]*Math.sin(Ye),et[1]=ze[0]*Math.sin(Ye)+ze[1]*Math.cos(Ye),et[2]=ze[2],qe[0]=et[0]+tt[0],qe[1]=et[1]+tt[1],qe[2]=et[2]+tt[2],qe}const Je=(0,x.c)(),xe=(0,x.c)();function We(qe,be){return qe[0]===be[0]&&qe[1]===be[1]&&qe[2]===be[2]}function Ne(qe,be){if(qe===be)return!0;const tt=qe[0],Ye=qe[1],ze=qe[2],et=be[0],ke=be[1],ot=be[2];return Math.abs(tt-et)<=A.E*Math.max(1,Math.abs(tt),Math.abs(et))&&Math.abs(Ye-ke)<=A.E*Math.max(1,Math.abs(Ye),Math.abs(ke))&&Math.abs(ze-ot)<=A.E*Math.max(1,Math.abs(ze),Math.abs(ot))}function we(qe,be,tt){const Ye=tt[0]-be[0],ze=tt[1]-be[1],et=tt[2]-be[2];let ke=Ye*Ye+ze*ze+et*et;return ke>0?(ke=1/Math.sqrt(ke),qe[0]=Ye*ke,qe[1]=ze*ke,qe[2]=et*ke,qe):(qe[0]=0,qe[1]=0,qe[2]=0,qe)}const Oe=J,Se=U,De=ee,Fe=G,ve=$,Ke=Object.freeze(Object.defineProperty({__proto__:null,length:G,copy:Q,set:H,add:re,subtract:J,multiply:W,divide:B,ceil:function Z(qe,be){return qe[0]=Math.ceil(be[0]),qe[1]=Math.ceil(be[1]),qe[2]=Math.ceil(be[2]),qe},floor:function ie(qe,be){return qe[0]=Math.floor(be[0]),qe[1]=Math.floor(be[1]),qe[2]=Math.floor(be[2]),qe},abs:ue,sign:ce,min:oe,max:function le(qe,be,tt){return qe[0]=Math.max(be[0],tt[0]),qe[1]=Math.max(be[1],tt[1]),qe[2]=Math.max(be[2],tt[2]),qe},round:function Y(qe,be){return qe[0]=Math.round(be[0]),qe[1]=Math.round(be[1]),qe[2]=Math.round(be[2]),qe},scale:j,scaleAndAdd:X,distance:U,squaredDistance:ee,squaredLength:$,negate:ne,inverse:function se(qe,be){return qe[0]=1/be[0],qe[1]=1/be[1],qe[2]=1/be[2],qe},normalize:ae,dot:de,cross:_e,lerp:pe,hermite:function he(qe,be,tt,Ye,ze,et){const ke=et*et,ot=ke*(2*et-3)+1,at=ke*(et-2)+et,yt=ke*(et-1),wt=ke*(3-2*et);return qe[0]=be[0]*ot+tt[0]*at+Ye[0]*yt+ze[0]*wt,qe[1]=be[1]*ot+tt[1]*at+Ye[1]*yt+ze[1]*wt,qe[2]=be[2]*ot+tt[2]*at+Ye[2]*yt+ze[2]*wt,qe},bezier:function ge(qe,be,tt,Ye,ze,et){const ke=1-et,ot=ke*ke,at=et*et,yt=ot*ke,wt=3*et*ot,zt=3*at*ke,Rt=at*et;return qe[0]=be[0]*yt+tt[0]*wt+Ye[0]*zt+ze[0]*Rt,qe[1]=be[1]*yt+tt[1]*wt+Ye[1]*zt+ze[1]*Rt,qe[2]=be[2]*yt+tt[2]*wt+Ye[2]*zt+ze[2]*Rt,qe},random:function ye(qe,be){be=be||1;const tt=2*(0,A.R)()*Math.PI,Ye=2*(0,A.R)()-1,ze=Math.sqrt(1-Ye*Ye)*be;return qe[0]=Math.cos(tt)*ze,qe[1]=Math.sin(tt)*ze,qe[2]=Ye*be,qe},transformMat4:Me,transformMat3:Ee,transformQuat:Te,rotateX:function me(qe,be,tt,Ye){const ze=[],et=[];return ze[0]=be[0]-tt[0],ze[1]=be[1]-tt[1],ze[2]=be[2]-tt[2],et[0]=ze[0],et[1]=ze[1]*Math.cos(Ye)-ze[2]*Math.sin(Ye),et[2]=ze[1]*Math.sin(Ye)+ze[2]*Math.cos(Ye),qe[0]=et[0]+tt[0],qe[1]=et[1]+tt[1],qe[2]=et[2]+tt[2],qe},rotateY:function Ce(qe,be,tt,Ye){const ze=[],et=[];return ze[0]=be[0]-tt[0],ze[1]=be[1]-tt[1],ze[2]=be[2]-tt[2],et[0]=ze[2]*Math.sin(Ye)+ze[0]*Math.cos(Ye),et[1]=ze[1],et[2]=ze[2]*Math.cos(Ye)-ze[0]*Math.sin(Ye),qe[0]=et[0]+tt[0],qe[1]=et[1]+tt[1],qe[2]=et[2]+tt[2],qe},rotateZ:Ie,angle:function Ge(qe,be){Q(Je,qe),Q(xe,be),ae(Je,Je),ae(xe,xe);const tt=de(Je,xe);return tt>1?0:tt<-1?Math.PI:Math.acos(tt)},str:function je(qe){return"vec3("+qe[0]+", "+qe[1]+", "+qe[2]+")"},exactEquals:We,equals:Ne,direction:we,sub:Oe,mul:W,div:B,dist:Se,sqrDist:De,len:Fe,sqrLen:ve},Symbol.toStringTag,{value:"Module"}))},79800:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>G,b:()=>re,n:()=>H,s:()=>Q,t:()=>A});var x=T(96286);function A(W,B,Z){if(W.count!==B.count)return void x.c.error("source and destination buffers need to have the same number of elements");const ie=W.count,ue=Z[0],ce=Z[1],oe=Z[2],le=Z[4],Y=Z[5],j=Z[6],X=Z[8],U=Z[9],ee=Z[10],$=Z[12],ne=Z[13],se=Z[14],ae=W.typedBuffer,de=W.typedBufferStride,_e=B.typedBuffer,pe=B.typedBufferStride;for(let he=0;he<ie;he++){const ge=he*de,ye=he*pe,Me=_e[ye],Ee=_e[ye+1],Te=_e[ye+2];ae[ge]=ue*Me+le*Ee+X*Te+$,ae[ge+1]=ce*Me+Y*Ee+U*Te+ne,ae[ge+2]=oe*Me+j*Ee+ee*Te+se}}function G(W,B,Z){if(W.count!==B.count)return void x.c.error("source and destination buffers need to have the same number of elements");const ie=W.count,ue=Z[0],ce=Z[1],oe=Z[2],le=Z[3],Y=Z[4],j=Z[5],X=Z[6],U=Z[7],ee=Z[8],$=W.typedBuffer,ne=W.typedBufferStride,se=B.typedBuffer,ae=B.typedBufferStride;for(let de=0;de<ie;de++){const _e=de*ne,pe=de*ae,he=se[pe],ge=se[pe+1],ye=se[pe+2];$[_e]=ue*he+le*ge+X*ye,$[_e+1]=ce*he+Y*ge+U*ye,$[_e+2]=oe*he+j*ge+ee*ye}}function Q(W,B,Z){const ie=Math.min(W.count,B.count),ue=W.typedBuffer,ce=W.typedBufferStride,oe=B.typedBuffer,le=B.typedBufferStride;for(let Y=0;Y<ie;Y++){const j=Y*ce,X=Y*le;ue[j]=Z*oe[X],ue[j+1]=Z*oe[X+1],ue[j+2]=Z*oe[X+2]}}function H(W,B){const Z=Math.min(W.count,B.count),ie=W.typedBuffer,ue=W.typedBufferStride,ce=B.typedBuffer,oe=B.typedBufferStride;for(let le=0;le<Z;le++){const Y=le*ue,j=le*oe,X=ce[j],U=ce[j+1],ee=ce[j+2],$=X*X+U*U+ee*ee;if($>0){const ne=1/Math.sqrt($);ie[Y]=ne*X,ie[Y+1]=ne*U,ie[Y+2]=ne*ee}}}function re(W,B,Z){const ie=Math.min(W.count,B.count),ue=W.typedBuffer,ce=W.typedBufferStride,oe=B.typedBuffer,le=B.typedBufferStride;for(let Y=0;Y<ie;Y++){const j=Y*ce,X=Y*le;ue[j]=oe[X]>>Z,ue[j+1]=oe[X+1]>>Z,ue[j+2]=oe[X+2]>>Z}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:A,transformMat3:G,scale:Q,normalize:H,shiftRight:re},Symbol.toStringTag,{value:"Module"}))},9554:(dt,Re,T)=>{"use strict";function x(Q,H,re){const J=Q.typedBuffer,W=Q.typedBufferStride,B=H.typedBuffer,Z=H.typedBufferStride,ie=re?re.count:H.count;let ue=(re&&re.dstIndex?re.dstIndex:0)*W,ce=(re&&re.srcIndex?re.srcIndex:0)*Z;for(let oe=0;oe<ie;++oe)J[ue]=B[ce],J[ue+1]=B[ce+1],J[ue+2]=B[ce+2],ue+=W,ce+=Z}function A(Q,H,re,J,W){var ce,oe;const B=Q.typedBuffer,Z=Q.typedBufferStride,ie=null!=(ce=null==W?void 0:W.count)?ce:Q.count;let ue=(null!=(oe=null==W?void 0:W.dstIndex)?oe:0)*Z;for(let le=0;le<ie;++le)B[ue]=H,B[ue+1]=re,B[ue+2]=J,ue+=Z}T.d(Re,{c:()=>x,f:()=>A}),Object.freeze(Object.defineProperty({__proto__:null,copy:x,fill:A},Symbol.toStringTag,{value:"Module"}))},14658:(dt,Re,T)=>{"use strict";function x(){return new Float32Array(3)}function A(Y){const j=new Float32Array(3);return j[0]=Y[0],j[1]=Y[1],j[2]=Y[2],j}function G(Y,j,X){const U=new Float32Array(3);return U[0]=Y,U[1]=j,U[2]=X,U}function Q(Y,j){return new Float32Array(Y,j,3)}function H(){return x()}function re(){return G(1,1,1)}function J(){return G(1,0,0)}function W(){return G(0,1,0)}function B(){return G(0,0,1)}T.d(Re,{a:()=>A,b:()=>Q,c:()=>x,f:()=>G,z:()=>H});const Z=H(),ie=re(),ue=J(),ce=W(),oe=B();Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:G,createView:Q,zeros:H,ones:re,unitX:J,unitY:W,unitZ:B,ZEROS:Z,ONES:ie,UNIT_X:ue,UNIT_Y:ce,UNIT_Z:oe},Symbol.toStringTag,{value:"Module"}))},28093:(dt,Re,T)=>{"use strict";function x(){return[0,0,0]}function A(j){return[j[0],j[1],j[2]]}function G(j,X,U){return[j,X,U]}function Q(j){const X=[0,0,0],U=Math.min(3,j.length);for(let ee=0;ee<U;++ee)X[ee]=j[ee];return X}function H(j,X){return new Float64Array(j,X,3)}function J(){return G(1,1,1)}function W(){return G(1,0,0)}function B(){return G(0,1,0)}function Z(){return G(0,0,1)}T.d(Re,{O:()=>ue,U:()=>le,Z:()=>ie,a:()=>A,b:()=>H,c:()=>x,d:()=>Q,f:()=>G,u:()=>Z});const ie=[0,0,0],ue=J(),ce=W(),oe=B(),le=Z();Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:G,fromArray:Q,createView:H,zeros:function re(){return[0,0,0]},ones:J,unitX:W,unitY:B,unitZ:Z,ZEROS:ie,ONES:ue,UNIT_X:ce,UNIT_Y:oe,UNIT_Z:le},Symbol.toStringTag,{value:"Module"}))},993:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>Q,b:()=>ce,c:()=>A,d:()=>ne,e:()=>j,f:()=>X,g:()=>he,h:()=>ge,i:()=>Y,l:()=>se,n:()=>$,s:()=>G,t:()=>de,v:()=>Ge});var x=T(39863);function A(Je,xe){return Je[0]=xe[0],Je[1]=xe[1],Je[2]=xe[2],Je[3]=xe[3],Je}function G(Je,xe,je,We,Ne){return Je[0]=xe,Je[1]=je,Je[2]=We,Je[3]=Ne,Je}function Q(Je,xe,je){return Je[0]=xe[0]+je[0],Je[1]=xe[1]+je[1],Je[2]=xe[2]+je[2],Je[3]=xe[3]+je[3],Je}function H(Je,xe,je){return Je[0]=xe[0]-je[0],Je[1]=xe[1]-je[1],Je[2]=xe[2]-je[2],Je[3]=xe[3]-je[3],Je}function re(Je,xe,je){return Je[0]=xe[0]*je[0],Je[1]=xe[1]*je[1],Je[2]=xe[2]*je[2],Je[3]=xe[3]*je[3],Je}function J(Je,xe,je){return Je[0]=xe[0]/je[0],Je[1]=xe[1]/je[1],Je[2]=xe[2]/je[2],Je[3]=xe[3]/je[3],Je}function ce(Je,xe,je){return Je[0]=xe[0]*je,Je[1]=xe[1]*je,Je[2]=xe[2]*je,Je[3]=xe[3]*je,Je}function le(Je,xe){const je=xe[0]-Je[0],We=xe[1]-Je[1],Ne=xe[2]-Je[2],we=xe[3]-Je[3];return Math.sqrt(je*je+We*We+Ne*Ne+we*we)}function Y(Je,xe){const je=xe[0]-Je[0],We=xe[1]-Je[1],Ne=xe[2]-Je[2],we=xe[3]-Je[3];return je*je+We*We+Ne*Ne+we*we}function j(Je){const xe=Je[0],je=Je[1],We=Je[2],Ne=Je[3];return Math.sqrt(xe*xe+je*je+We*We+Ne*Ne)}function X(Je){const xe=Je[0],je=Je[1],We=Je[2],Ne=Je[3];return xe*xe+je*je+We*We+Ne*Ne}function $(Je,xe){const je=xe[0],We=xe[1],Ne=xe[2],we=xe[3];let Oe=je*je+We*We+Ne*Ne+we*we;return Oe>0&&(Oe=1/Math.sqrt(Oe),Je[0]=je*Oe,Je[1]=We*Oe,Je[2]=Ne*Oe,Je[3]=we*Oe),Je}function ne(Je,xe){return Je[0]*xe[0]+Je[1]*xe[1]+Je[2]*xe[2]+Je[3]*xe[3]}function se(Je,xe,je,We){const Ne=xe[0],we=xe[1],Oe=xe[2],$e=xe[3];return Je[0]=Ne+We*(je[0]-Ne),Je[1]=we+We*(je[1]-we),Je[2]=Oe+We*(je[2]-Oe),Je[3]=$e+We*(je[3]-$e),Je}function de(Je,xe,je){const We=xe[0],Ne=xe[1],we=xe[2],Oe=xe[3];return Je[0]=je[0]*We+je[4]*Ne+je[8]*we+je[12]*Oe,Je[1]=je[1]*We+je[5]*Ne+je[9]*we+je[13]*Oe,Je[2]=je[2]*We+je[6]*Ne+je[10]*we+je[14]*Oe,Je[3]=je[3]*We+je[7]*Ne+je[11]*we+je[15]*Oe,Je}function he(Je,xe){return Je[0]===xe[0]&&Je[1]===xe[1]&&Je[2]===xe[2]&&Je[3]===xe[3]}function ge(Je,xe){const je=Je[0],We=Je[1],Ne=Je[2],we=Je[3],Oe=xe[0],$e=xe[1],Be=xe[2],Se=xe[3];return Math.abs(je-Oe)<=x.E*Math.max(1,Math.abs(je),Math.abs(Oe))&&Math.abs(We-$e)<=x.E*Math.max(1,Math.abs(We),Math.abs($e))&&Math.abs(Ne-Be)<=x.E*Math.max(1,Math.abs(Ne),Math.abs(Be))&&Math.abs(we-Se)<=x.E*Math.max(1,Math.abs(we),Math.abs(Se))}const Ge=Object.freeze(Object.defineProperty({__proto__:null,copy:A,set:G,add:Q,subtract:H,multiply:re,divide:J,ceil:function W(Je,xe){return Je[0]=Math.ceil(xe[0]),Je[1]=Math.ceil(xe[1]),Je[2]=Math.ceil(xe[2]),Je[3]=Math.ceil(xe[3]),Je},floor:function B(Je,xe){return Je[0]=Math.floor(xe[0]),Je[1]=Math.floor(xe[1]),Je[2]=Math.floor(xe[2]),Je[3]=Math.floor(xe[3]),Je},min:function Z(Je,xe,je){return Je[0]=Math.min(xe[0],je[0]),Je[1]=Math.min(xe[1],je[1]),Je[2]=Math.min(xe[2],je[2]),Je[3]=Math.min(xe[3],je[3]),Je},max:function ie(Je,xe,je){return Je[0]=Math.max(xe[0],je[0]),Je[1]=Math.max(xe[1],je[1]),Je[2]=Math.max(xe[2],je[2]),Je[3]=Math.max(xe[3],je[3]),Je},round:function ue(Je,xe){return Je[0]=Math.round(xe[0]),Je[1]=Math.round(xe[1]),Je[2]=Math.round(xe[2]),Je[3]=Math.round(xe[3]),Je},scale:ce,scaleAndAdd:function oe(Je,xe,je,We){return Je[0]=xe[0]+je[0]*We,Je[1]=xe[1]+je[1]*We,Je[2]=xe[2]+je[2]*We,Je[3]=xe[3]+je[3]*We,Je},distance:le,squaredDistance:Y,length:j,squaredLength:X,negate:function U(Je,xe){return Je[0]=-xe[0],Je[1]=-xe[1],Je[2]=-xe[2],Je[3]=-xe[3],Je},inverse:function ee(Je,xe){return Je[0]=1/xe[0],Je[1]=1/xe[1],Je[2]=1/xe[2],Je[3]=1/xe[3],Je},normalize:$,dot:ne,lerp:se,random:function ae(Je,xe){let je,We,Ne,we,Oe,$e;xe=xe||1;do{je=2*(0,x.R)()-1,We=2*(0,x.R)()-1,Oe=je*je+We*We}while(Oe>=1);do{Ne=2*(0,x.R)()-1,we=2*(0,x.R)()-1,$e=Ne*Ne+we*we}while($e>=1);const Be=Math.sqrt((1-Oe)/$e);return Je[0]=xe*je,Je[1]=xe*We,Je[2]=xe*Ne*Be,Je[3]=xe*we*Be,Je},transformMat4:de,transformQuat:function _e(Je,xe,je){const We=xe[0],Ne=xe[1],we=xe[2],Oe=je[0],$e=je[1],Be=je[2],Se=je[3],De=Se*We+$e*we-Be*Ne,Fe=Se*Ne+Be*We-Oe*we,ve=Se*we+Oe*Ne-$e*We,Ke=-Oe*We-$e*Ne-Be*we;return Je[0]=De*Se+Ke*-Oe+Fe*-Be-ve*-$e,Je[1]=Fe*Se+Ke*-$e+ve*-Oe-De*-Be,Je[2]=ve*Se+Ke*-Be+De*-$e-Fe*-Oe,Je[3]=xe[3],Je},str:function pe(Je){return"vec4("+Je[0]+", "+Je[1]+", "+Je[2]+", "+Je[3]+")"},exactEquals:he,equals:ge,sub:H,mul:re,div:J,dist:le,sqrDist:Y,len:j,sqrLen:X},Symbol.toStringTag,{value:"Module"}))},63657:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>re,n:()=>Q,s:()=>H,t:()=>G});var x=T(96286);function G(W,B,Z){if(W.count!==B.count)return void x.c.error("source and destination buffers need to have the same number of elements");const ie=W.count,ue=Z[0],ce=Z[1],oe=Z[2],le=Z[3],Y=Z[4],j=Z[5],X=Z[6],U=Z[7],ee=Z[8],$=W.typedBuffer,ne=W.typedBufferStride,se=B.typedBuffer,ae=B.typedBufferStride;for(let de=0;de<ie;de++){const _e=de*ne,pe=de*ae,he=se[pe],ge=se[pe+1],ye=se[pe+2],Me=se[pe+3];$[_e]=ue*he+le*ge+X*ye,$[_e+1]=ce*he+Y*ge+U*ye,$[_e+2]=oe*he+j*ge+ee*ye,$[_e+3]=Me}}function Q(W,B){const Z=Math.min(W.count,B.count),ie=W.typedBuffer,ue=W.typedBufferStride,ce=B.typedBuffer,oe=B.typedBufferStride;for(let le=0;le<Z;le++){const Y=le*ue,j=le*oe,X=ce[j],U=ce[j+1],ee=ce[j+2],$=X*X+U*U+ee*ee;if($>0){const ne=1/Math.sqrt($);ie[Y]=ne*X,ie[Y+1]=ne*U,ie[Y+2]=ne*ee}}}function H(W,B,Z){const ie=Math.min(W.count,B.count),ue=W.typedBuffer,ce=W.typedBufferStride,oe=B.typedBuffer,le=B.typedBufferStride;for(let Y=0;Y<ie;Y++){const j=Y*ce,X=Y*le;ue[j]=Z*oe[X],ue[j+1]=Z*oe[X+1],ue[j+2]=Z*oe[X+2],ue[j+3]=Z*oe[X+3]}}function re(W,B,Z){const ie=Math.min(W.count,B.count),ue=W.typedBuffer,ce=W.typedBufferStride,oe=B.typedBuffer,le=B.typedBufferStride;for(let Y=0;Y<ie;Y++){const j=Y*ce,X=Y*le;ue[j]=oe[X]>>Z,ue[j+1]=oe[X+1]>>Z,ue[j+2]=oe[X+2]>>Z,ue[j+3]=oe[X+3]>>Z}}Object.freeze(Object.defineProperty({__proto__:null,transformMat4:function A(W,B,Z){if(W.count!==B.count)return void x.c.error("source and destination buffers need to have the same number of elements");const ie=W.count,ue=Z[0],ce=Z[1],oe=Z[2],le=Z[3],Y=Z[4],j=Z[5],X=Z[6],U=Z[7],ee=Z[8],$=Z[9],ne=Z[10],se=Z[11],ae=Z[12],de=Z[13],_e=Z[14],pe=Z[15],he=W.typedBuffer,ge=W.typedBufferStride,ye=B.typedBuffer,Me=B.typedBufferStride;for(let Ee=0;Ee<ie;Ee++){const Te=Ee*ge,me=Ee*Me,Ce=ye[me],Ie=ye[me+1],Ge=ye[me+2],Je=ye[me+3];he[Te]=ue*Ce+Y*Ie+ee*Ge+ae*Je,he[Te+1]=ce*Ce+j*Ie+$*Ge+de*Je,he[Te+2]=oe*Ce+X*Ie+ne*Ge+_e*Je,he[Te+3]=le*Ce+U*Ie+se*Ge+pe*Je}},transformMat3:G,normalize:Q,scale:H,shiftRight:re},Symbol.toStringTag,{value:"Module"}))},63470:(dt,Re,T)=>{"use strict";function x(Q,H,re){const J=Q.typedBuffer,W=Q.typedBufferStride,B=H.typedBuffer,Z=H.typedBufferStride,ie=re?re.count:H.count;let ue=(re&&re.dstIndex?re.dstIndex:0)*W,ce=(re&&re.srcIndex?re.srcIndex:0)*Z;for(let oe=0;oe<ie;++oe)J[ue]=B[ce],J[ue+1]=B[ce+1],J[ue+2]=B[ce+2],J[ue+3]=B[ce+3],ue+=W,ce+=Z}function A(Q,H,re,J,W,B){var oe,le;const Z=Q.typedBuffer,ie=Q.typedBufferStride,ue=null!=(oe=null==B?void 0:B.count)?oe:Q.count;let ce=(null!=(le=null==B?void 0:B.dstIndex)?le:0)*ie;for(let Y=0;Y<ue;++Y)Z[ce]=H,Z[ce+1]=re,Z[ce+2]=J,Z[ce+3]=W,ce+=ie}T.d(Re,{c:()=>x,f:()=>A}),Object.freeze(Object.defineProperty({__proto__:null,copy:x,fill:A},Symbol.toStringTag,{value:"Module"}))},67709:(dt,Re,T)=>{"use strict";function x(){return new Float32Array(4)}function A(X){const U=new Float32Array(4);return U[0]=X[0],U[1]=X[1],U[2]=X[2],U[3]=X[3],U}function G(X,U,ee,$){const ne=new Float32Array(4);return ne[0]=X,ne[1]=U,ne[2]=ee,ne[3]=$,ne}function H(){return x()}function re(){return G(1,1,1,1)}function J(){return G(1,0,0,0)}function W(){return G(0,1,0,0)}function B(){return G(0,0,1,0)}function Z(){return G(0,0,0,1)}T.d(Re,{a:()=>A,c:()=>x,f:()=>G});const ie=H(),ue=re(),ce=J(),oe=W(),le=B(),Y=Z();Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:G,createView:function Q(X,U){return new Float32Array(X,U,4)},zeros:H,ones:re,unitX:J,unitY:W,unitZ:B,unitW:Z,ZEROS:ie,ONES:ue,UNIT_X:ce,UNIT_Y:oe,UNIT_Z:le,UNIT_W:Y},Symbol.toStringTag,{value:"Module"}))},4794:(dt,Re,T)=>{"use strict";function x(){return[0,0,0,0]}function A(U){return[U[0],U[1],U[2],U[3]]}function G(U,ee,$,ne){return[U,ee,$,ne]}function Q(U){const ee=[0,0,0,0],$=Math.min(4,U.length);for(let ne=0;ne<$;++ne)ee[ne]=U[ne];return ee}function H(U,ee){return new Float64Array(U,ee,4)}function J(){return G(1,1,1,1)}function W(){return G(1,0,0,0)}function B(){return G(0,1,0,0)}function Z(){return G(0,0,1,0)}function ie(){return G(0,0,0,1)}T.d(Re,{O:()=>ce,Z:()=>ue,a:()=>H,b:()=>Q,c:()=>x,d:()=>A,f:()=>G});const ue=[0,0,0,0],ce=J(),oe=W(),le=B(),Y=Z(),j=ie();Object.freeze(Object.defineProperty({__proto__:null,create:x,clone:A,fromValues:G,fromArray:Q,createView:H,zeros:function re(){return[0,0,0,0]},ones:J,unitX:W,unitY:B,unitZ:Z,unitW:ie,ZEROS:ue,ONES:ce,UNIT_X:oe,UNIT_Y:le,UNIT_Z:Y,UNIT_W:j},Symbol.toStringTag,{value:"Module"}))},20414:(dt,Re,T)=>{"use strict";T.d(Re,{B7:()=>re,St:()=>A,VL:()=>Q,h$:()=>G,rW:()=>J});const x={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function A(W){return x[W]||x[W.toLowerCase()]}function G(W){var B;return null!=(B=x[W])?B:x[W.toLowerCase()]}function Q(W){return[...G(W)]}function H(W,B,Z){Z<0&&++Z,Z>1&&--Z;const ie=6*Z;return ie<1?W+(B-W)*ie:2*Z<1?B:3*Z<2?W+(B-W)*(2/3-Z)*6:W}function re(W,B,Z,ie=1){const ue=(W%360+360)%360/360,ce=Z<=.5?Z*(B+1):Z+B-Z*B,oe=2*Z-ce;return[Math.round(255*H(oe,ce,ue+1/3)),Math.round(255*H(oe,ce,ue)),Math.round(255*H(oe,ce,ue-1/3)),ie]}function J(W){const B=W.length>5,Z=B?8:4,ie=(1<<Z)-1,ue=B?1:17,ce=B?9===W.length:5===W.length;let oe=Number("0x"+W.substr(1));if(isNaN(oe))return null;const le=[0,0,0,1];let Y;return ce&&(Y=oe&ie,oe>>=Z,le[3]=ue*Y/255),Y=oe&ie,oe>>=Z,le[2]=ue*Y,Y=oe&ie,oe>>=Z,le[1]=ue*Y,Y=oe&ie,oe>>=Z,le[0]=ue*Y,le}},59318:(dt,Re,T)=>{var Q;T.d(Re,{Z:()=>G}),T(8314);var A=T(94113);const G={apiKey:void 0,applicationUrl:null==(Q=globalThis.location)?void 0:Q.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};globalThis.esriConfig&&((0,A.RH)(G,globalThis.esriConfig,!0),delete G.has),G.assetsPath||(G.assetsPath=`https://js.arcgis.com/${"4.24.7".slice(0,-2)}/@arcgis/core/assets`),G.baseUrl&&console.warn("[esri.config]","baseUrl has been replaced by assetsPath"),Object.defineProperty(G,"baseUrl",{set(){console.warn("[esri.config]","baseUrl has been replaced by assetsPath")}}),G.request.corsEnabledServers=[],G.request.corsEnabledServers.push=function(){return console.warn("[esri.config]","request.corsEnabledServers is not supported and will be removed in a future release. See http://esriurl.com/cors8664"),0}},14517:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ye});var x=T(56354),A=T(62208),G=T(34595),Q=T(44648),H=T(34117),J=(T(8314),T(58817)),W=T(63290),B=T(27899),Z=T(31283),ie=T(36082),ue=T(2345),ce=T(12196);class oe{constructor(Ee,Te,me){this.properties=Ee,this.propertyName=Te,this.metadata=me,this._observers=null,this._accessed=null,this._handles=null,this.flags=ue.v.Dirty|(me.nonNullable?ue.v.NonNullable:0)|(me.hasOwnProperty("value")?ue.v.HasDefaultValue:0)|(void 0===me.get?ue.v.DepTrackingInitialized:0)|(void 0===me.dependsOn?ue.v.AutoTracked:0)}destroy(){if(this.flags&ue.v.Dirty&&this._observers){const Ee=this._observers.slice();for(const Te of Ee)Te.onCommitted()}this._accessed=null,this._observers=null,this._clearObservationHandles()}getComputed(){(0,ie.it)(this);const Ee=this.properties.store,Te=this.propertyName,me=this.flags,Ce=Ee.get(Te);if(me&ue.v.Computing||~me&ue.v.Dirty&&Ee.has(Te))return Ce;this.flags|=ue.v.Computing;const Ie=this.properties.host;let Ge;me&ue.v.AutoTracked?Ge=(0,ie.LJ)(this,this.metadata.get,Ie):((0,ie.GF)(Ie,this),Ge=this.metadata.get.call(Ie)),Ee.set(Te,Ge,Z.s3.COMPUTED);const Je=Ee.get(Te);return Je===Ce?this.flags&=~ue.v.Dirty:(0,ie.gb)(this.commit,this),this.flags&=~ue.v.Computing,Je}onObservableAccessed(Ee){Ee!==this&&(null===this._accessed&&(this._accessed=[]),this._accessed.includes(Ee)||this._accessed.push(Ee))}onTrackingEnd(){this._clearObservationHandles(),this.flags|=ue.v.DepTrackingInitialized;const Ee=this._accessed;if(null===Ee)return;let Te=this._handles;null===Te&&(Te=this._handles=[]);for(let me=0;me<Ee.length;++me)Te.push(Ee[me].observe(this));Ee.length=0}observe(Ee){return null===this._observers&&(this._observers=[]),this._observers.includes(Ee)||this._observers.push(Ee),new ce.X(this._observers,Ee)}notifyChange(){this.onInvalidated(),this.onCommitted()}invalidate(){this.onInvalidated()}onInvalidated(){~this.flags&ue.v.Overriden&&(this.flags|=ue.v.Dirty);const Ee=this._observers;if(null!==Ee)for(let Te=0;Te<Ee.length;++Te)Ee[Te].onInvalidated()}commit(){this.flags&=~ue.v.Dirty,this.onCommitted()}onCommitted(){if(null===this._observers)return;const Ee=this._observers.slice();for(let Te=0;Te<Ee.length;++Te)Ee[Te].onCommitted()}_clearObservationHandles(){const Ee=this._handles;if(null!==Ee){for(let Te=0;Te<Ee.length;++Te)Ee[Te].remove();Ee.length=0}}}class le{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(Ee){const Te=new le;return this._values.forEach((me,Ce)=>{Ee&&Ee.has(Ce)||Te.set(Ce,(0,J.d9)(me))}),Te}get(Ee){return this._values.get(Ee)}originOf(){return Z.s3.USER}keys(){return[...this._values.keys()]}set(Ee,Te){this._values.set(Ee,Te)}delete(Ee){this._values.delete(Ee)}has(Ee){return this._values.has(Ee)}forEach(Ee){this._values.forEach(Ee)}}var Y=T(52323);function j(Me,Ee,Te){return void 0!==Me}function X(Me,Ee,Te,me){return!(void 0===Me||null==Te&&Me.flags&ue.v.NonNullable)}W.Z.getLogger("esri.core.accessorSupport.Properties");class ee{constructor(Ee){this.host=Ee,this.properties=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Q.F.INITIALIZING,this.store=new le,this._origin=Z.s3.USER;const Te=this.host.constructor.__accessorMetadata__,me=Te.properties;for(const Ce in me){const Ie=new oe(this,Ce,me[Ce]);this.properties.set(Ce,Ie)}this.metadatas=me,this._autoDestroy=Te.autoDestroy}initialize(){this.lifecycle=Q.F.CONSTRUCTING}constructed(){this.lifecycle=Q.F.CONSTRUCTED}destroy(){if(this.destroyed=!0,this._autoDestroy)for(const[Ee,Te]of this.properties){const me=this.internalGet(Ee);me&&(Me=me)&&"function"==typeof Me.destroy&&(me.destroy(),~Te.flags&ue.v.NonNullable&&this._internalSet(Te,null)),Te.destroy()}else for(const[Ee,Te]of this.properties)Te.destroy();var Me}get initialized(){return this.lifecycle!==Q.F.INITIALIZING}get(Ee){const Te=this.properties.get(Ee);if(Te.metadata.get)return Te.getComputed();(0,ie.it)(Te);const me=this.store;return me.has(Ee)?me.get(Ee):Te.metadata.value}originOf(Ee){const Te=this.store.originOf(Ee);if(void 0===Te){const me=this.properties.get(Ee);if(void 0!==me&&me.flags&ue.v.HasDefaultValue)return"defaults"}return(0,Z.x3)(Te)}has(Ee){return!!this.properties.has(Ee)&&this.store.has(Ee)}keys(){return[...this.properties.keys()]}internalGet(Ee){const Te=this.properties.get(Ee);if(j(Te))return this.store.has(Ee)?this.store.get(Ee):Te.metadata.value}internalSet(Ee,Te){const me=this.properties.get(Ee);j(me)&&this._internalSet(me,Te)}getDependsInfo(Ee,Te,me){const Ce=this.properties.get(Te);if(!j(Ce))return"";const Ie=new Set,Ge=(0,ie.LJ)({onObservableAccessed:xe=>Ie.add(xe),onTrackingEnd:()=>{}},()=>{var xe;return null==(xe=Ce.metadata.get)?void 0:xe.call(Ee)});let Je=`${me}${Ee.declaredClass.split(".").pop()}.${Te}: ${Ge}\n`;if(0===Ie.size)return Je;me+="  ";for(const xe of Ie){if(!(xe instanceof oe))continue;const je=xe.properties.host,We=xe.propertyName,Ne=(0,Y.vw)(je);Je+=Ne?Ne.getDependsInfo(je,We,me):`${me}${We}: undefined\n`}return Je}setAtOrigin(Ee,Te,me){const Ce=this.properties.get(Ee);if(j(Ce))return this._setAtOrigin(Ce,Te,me)}isOverridden(Ee){const Te=this.properties.get(Ee);return void 0!==Te&&!!(Te.flags&ue.v.Overriden)}clearOverride(Ee){const Te=this.properties.get(Ee);void 0!==Te&&Te.flags&ue.v.Overriden&&(Te.flags&=~ue.v.Overriden,Te.notifyChange())}override(Ee,Te){const me=this.properties.get(Ee);if(!X(me,0,Te))return;const Ce=me.metadata.cast;if(Ce){const Ie=this._cast(Ce,Te),{valid:Ge,value:Je}=Ie;if(ne.release(Ie),!Ge)return;Te=Je}me.flags|=ue.v.Overriden,this._internalSet(me,Te)}set(Ee,Te){const me=this.properties.get(Ee);if(!X(me,0,Te))return;const Ce=me.metadata.cast;if(Ce){const Ge=this._cast(Ce,Te),{valid:Je,value:xe}=Ge;if(ne.release(Ge),!Je)return;Te=xe}const Ie=me.metadata.set;Ie?Ie.call(this.host,Te):this._internalSet(me,Te)}setDefaultOrigin(Ee){this._origin=(0,Z.M9)(Ee)}getDefaultOrigin(){return(0,Z.x3)(this._origin)}notifyChange(Ee){const Te=this.properties.get(Ee);void 0!==Te&&Te.notifyChange()}invalidate(Ee){const Te=this.properties.get(Ee);void 0!==Te&&Te.invalidate()}commit(Ee){const Te=this.properties.get(Ee);void 0!==Te&&Te.commit()}_internalSet(Ee,Te){this._setAtOrigin(Ee,Te,this.lifecycle!==Q.F.INITIALIZING?this._origin:Z.s3.DEFAULTS)}_setAtOrigin(Ee,Te,me){const Ce=this.store,Ie=Ee.propertyName;Ce.has(Ie,me)&&(0,J.fS)(Te,Ce.get(Ie))&&~Ee.flags&ue.v.Overriden&&me===Ce.originOf(Ie)||(Ee.invalidate(),Ce.set(Ie,Te,me),Ee.commit(),(0,ie.mS)(this.host,Ee))}_cast(Ee,Te){const me=ne.acquire();return me.valid=!0,me.value=Te,Ee&&(me.value=Ee.call(this.host,Te,me)),me}}const ne=new B.Z(class ${constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}});var pe,se=T(82255),ae=T(30755),de=T(77712),_e=T(76898);function he(Me){var Ee;if(null==Me)return{value:Me};if(Array.isArray(Me))return{type:[Me[0]],value:null};switch(typeof Me){case"object":return(null==(Ee=Me.constructor)?void 0:Ee.__accessorMetadata__)||Me instanceof Date?{type:Me.constructor,value:Me}:Me;case"boolean":return{type:Boolean,value:Me};case"string":return{type:String,value:Me};case"number":return{type:Number,value:Me};case"function":return{type:Me,value:null};default:return}}const ge=Symbol("Accessor-Handles");class ye{constructor(...Ee){if(this[pe]=null,this.constructor===ye)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");Object.defineProperty(this,"__accessor__",{enumerable:!1,value:new ee(this)}),Ee.length>0&&this.normalizeCtorArgs&&(this.__accessor__.ctorArgs=this.normalizeCtorArgs.apply(this,Ee))}static createSubclass(Ee={}){if(Array.isArray(Ee))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:Te,declaredClass:me,constructor:Ce}=Ee;delete Ee.declaredClass,delete Ee.properties,delete Ee.constructor;const Ie=this;class Ge extends Ie{constructor(...xe){super(...xe),this.inherited=null,Ce&&Ce.apply(this,xe)}}(0,H.JT)(Ge.prototype);for(const Je in Ee){const xe=Ee[Je];Ge.prototype[Je]="function"==typeof xe?function(...je){const We=this.inherited;let Ne;this.inherited=function(...we){if(Ie.prototype[Je])return Ie.prototype[Je].apply(this,we)};try{Ne=xe.apply(this,je)}catch(we){throw this.inherited=We,we}return this.inherited=We,Ne}:Ee[Je]}for(const Je in Te){const xe=he(Te[Je]);(0,de.Cb)(xe)(Ge.prototype,Je)}return(0,_e.j)(me)(Ge)}postscript(Ee){const Te=this.__accessor__,me=Te.ctorArgs||Ee;Te.initialize(),me&&(this.set(me),Te.ctorArgs=null),Te.constructed(),this.initialize()}initialize(){}destroy(){this.destroyed||((0,A.yw)(this[ge],Ee=>{Ee.forEach(Te=>Te.remove())}),this[ge]=null,(0,ae.BT)(this),this.__accessor__.destroy())}get initialized(){return this.__accessor__&&this.__accessor__.initialized||!1}get constructed(){return this.__accessor__&&this.__accessor__.lifecycle===Q.F.CONSTRUCTED||!1}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(Ee){this.get(Ee)}get(Ee){return(0,G.U2)(this,Ee)}hasOwnProperty(Ee){return this.__accessor__?this.__accessor__.has(Ee):Object.prototype.hasOwnProperty.call(this,Ee)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(Ee,Te){return(0,se.t)(this,Ee,Te),this}watch(Ee,Te,me){return(0,ae.YP)(this,Ee,Te,me)}own(Ee){let Te=this[ge];if((0,A.Wi)(Te)&&(Te=this[ge]=new Set),(0,x.TW)(Ee))for(const me of Ee)Te.add(me);else Te.add(Ee)}_clearOverride(Ee){return this.__accessor__.clearOverride(Ee)}_override(Ee,Te){return this.__accessor__.override(Ee,Te)}_isOverridden(Ee){return this.__accessor__.isOverridden(Ee)}notifyChange(Ee){this.__accessor__.notifyChange(Ee)}_get(Ee){return this.__accessor__.internalGet(Ee)}_set(Ee,Te){return this.__accessor__.internalSet(Ee,Te),this}}pe=ge},35575:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>G});var x=T(27899);function A(H){H.length=0}class G{constructor(re=50,J=50){this._pool=new x.Z(Array,void 0,A,J,re)}acquire(){return this._pool.acquire()}release(re){this._pool.release(re)}prune(){this._pool.prune(0)}static acquire(){return Q.acquire()}static release(re){return Q.release(re)}static prune(){Q.prune()}}const Q=new G(100)},79608:(dt,Re,T)=>{"use strict";T.d(Re,{J:()=>Z,j:()=>ie});var x=T(17626),A=T(14517),Q=(T(8314),T(58817)),H=T(63290),re=T(62208),J=T(31283),W=T(52323),B=T(76898);H.Z.getLogger("esri.core.Clonable");const Z=ue=>{let ce=class extends ue{clone(){var ee;const oe=(0,re.s3)((0,W.vw)(this),"unable to clone instance of non-accessor class"),le=oe.metadatas,Y=oe.store,j={},X=new Map;for(const $ in le){const ne=le[$],se=null==Y?void 0:Y.originOf($),ae=ne.clonable;if(ne.readOnly||!1===ae||se!==J.s3.USER&&se!==J.s3.DEFAULTS&&se!==J.s3.WEB_MAP&&se!==J.s3.WEB_SCENE)continue;const de=this[$];let _e=null;_e="function"==typeof ae?ae(de):"reference"===ae?de:(0,Q.Vo)(de),null!=de&&null==_e||(se===J.s3.DEFAULTS?X.set($,_e):j[$]=_e)}const U=new(Object.getPrototypeOf(this).constructor)(j);if(X.size){const $=null==(ee=(0,W.vw)(U))?void 0:ee.store;if($)for(const[ne,se]of X)$.set(ne,se,J.s3.DEFAULTS)}return U}};return ce=(0,x._)([(0,B.j)("esri.core.Clonable")],ce),ce};let ie=class extends(Z(A.Z)){};ie=(0,x._)([(0,B.j)("esri.core.Clonable")],ie)},46160:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ge});var le,x=T(17626),A=T(35575),G=T(61885),Q=T(58817),H=T(62208),re=T(27899),J=T(73234),W=T(50618),B=T(77712),Z=T(90912),ie=T(61039),ue=T(76898),ce=T(36082),oe=T(48902);const j=new re.Z(class Y{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(Me){this.defaultPrevented=!1,this.item=Me}},void 0,ye=>{ye.item=null,ye.target=null,ye.defaultPrevented=!1,ye.cancellable=!1}),X=()=>{};function U(ye){return ye?ye instanceof he?ye.toArray():ye.length?Array.prototype.slice.apply(ye):[]:[]}function ee(ye){if(ye&&ye.length)return ye[0]}function $(ye,Me,Ee,Te){const me=Math.min(ye.length-Ee,Me.length-Te);let Ce=0;for(;Ce<me&&ye[Ee+Ce]===Me[Te+Ce];)Ce++;return Ce}function ne(ye,Me,Ee,Te){Me&&Me.forEach((me,Ce,Ie)=>{ye.push(me),ne(ye,Ee.call(Te,me,Ce,Ie),Ee,Te)})}const se=new Set,ae=new Set,de=new Set,_e=new Map;let pe=0,he=le=class extends G.Z.EventedAccessor{constructor(ye){super(ye),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new oe.s,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:pe++})}static isCollection(ye){return null!=ye&&ye instanceof le}normalizeCtorArgs(ye){return ye?Array.isArray(ye)||ye instanceof le?{items:ye}:ye:{}}destroy(){this.removeAll()}*[Symbol.iterator](){yield*this.items}get items(){return(0,ce.it)(this._observable),this._items}set items(ye){this._emitBeforeChanges(J.y.ADD)||(this._splice(0,this.length,U(ye)),this._emitAfterChanges(J.y.ADD))}hasEventListener(ye){return"change"===ye?this._chgListeners.length>0:this._emitter.hasEventListener(ye)}on(ye,Me){if("change"===ye){const Ee=this._chgListeners,Te={removed:!1,callback:Me};return Ee.push(Te),this._notifications&&this._notifications.push({listeners:Ee.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=X,Te.removed=!0,Ee.splice(Ee.indexOf(Te),1)}}}return this._emitter.on(ye,Me)}once(ye,Me){const Ee=this.on(ye,Me);return{remove(){Ee.remove()}}}add(ye,Me){if((0,ce.it)(this._observable),this._emitBeforeChanges(J.y.ADD))return this;const Ee=this.getNextIndex(null!=Me?Me:null);return this._splice(Ee,0,[ye]),this._emitAfterChanges(J.y.ADD),this}addMany(ye,Me=this._items.length){if((0,ce.it)(this._observable),!ye||!ye.length)return this;if(this._emitBeforeChanges(J.y.ADD))return this;const Ee=this.getNextIndex(Me);return this._splice(Ee,0,U(ye)),this._emitAfterChanges(J.y.ADD),this}at(ye){if((0,ce.it)(this._observable),(ye=Math.trunc(ye)||0)<0&&(ye+=this.length),!(ye<0||ye>=this.length))return this._items[ye]}removeAll(){if((0,ce.it)(this._observable),!this.length||this._emitBeforeChanges(J.y.REMOVE))return[];const ye=this._splice(0,this.length)||[];return this._emitAfterChanges(J.y.REMOVE),ye}clone(){return(0,ce.it)(this._observable),this._createNewInstance({items:this._items.map(Q.d9)})}concat(...ye){(0,ce.it)(this._observable);const Me=ye.map(U);return this._createNewInstance({items:this._items.concat(...Me)})}drain(ye,Me){if((0,ce.it)(this._observable),!this.length||this._emitBeforeChanges(J.y.REMOVE))return;const Ee=(0,H.j0)(this._splice(0,this.length)),Te=Ee.length;for(let me=0;me<Te;me++)ye.call(Me,Ee[me],me,Ee);this._emitAfterChanges(J.y.REMOVE)}every(ye,Me){return(0,ce.it)(this._observable),this._items.every(ye,Me)}filter(ye,Me){let Ee;return(0,ce.it)(this._observable),Ee=2===arguments.length?this._items.filter(ye,Me):this._items.filter(ye),this._createNewInstance({items:Ee})}find(ye,Me){return(0,ce.it)(this._observable),this._items.find(ye,Me)}findIndex(ye,Me){return(0,ce.it)(this._observable),this._items.findIndex(ye,Me)}flatten(ye,Me){(0,ce.it)(this._observable);const Ee=[];return ne(Ee,this,ye,Me),new le(Ee)}forEach(ye,Me){return(0,ce.it)(this._observable),this._items.forEach(ye,Me)}getItemAt(ye){return(0,ce.it)(this._observable),this._items[ye]}getNextIndex(ye){(0,ce.it)(this._observable);const Me=this.length;return(ye=null==ye?Me:ye)<0?ye=0:ye>Me&&(ye=Me),ye}includes(ye,Me=0){return(0,ce.it)(this._observable),this._items.includes(ye,Me)}indexOf(ye,Me=0){return(0,ce.it)(this._observable),this._items.indexOf(ye,Me)}join(ye=","){return(0,ce.it)(this._observable),this._items.join(ye)}lastIndexOf(ye,Me=this.length-1){return(0,ce.it)(this._observable),this._items.lastIndexOf(ye,Me)}map(ye,Me){(0,ce.it)(this._observable);const Ee=this._items.map(ye,Me);return new le({items:Ee})}reorder(ye,Me=this.length-1){(0,ce.it)(this._observable);const Ee=this.indexOf(ye);if(-1!==Ee){if(Me<0?Me=0:Me>=this.length&&(Me=this.length-1),Ee!==Me){if(this._emitBeforeChanges(J.y.MOVE))return ye;this._splice(Ee,1),this._splice(Me,0,[ye]),this._emitAfterChanges(J.y.MOVE)}return ye}}pop(){if((0,ce.it)(this._observable),!this.length||this._emitBeforeChanges(J.y.REMOVE))return;const ye=ee(this._splice(this.length-1,1));return this._emitAfterChanges(J.y.REMOVE),ye}push(...ye){return(0,ce.it)(this._observable),this._emitBeforeChanges(J.y.ADD)||(this._splice(this.length,0,ye),this._emitAfterChanges(J.y.ADD)),this.length}reduce(ye,Me){(0,ce.it)(this._observable);const Ee=this._items;return 2===arguments.length?Ee.reduce(ye,Me):Ee.reduce(ye)}reduceRight(ye,Me){(0,ce.it)(this._observable);const Ee=this._items;return 2===arguments.length?Ee.reduceRight(ye,Me):Ee.reduceRight(ye)}remove(ye){return(0,ce.it)(this._observable),this.removeAt(this.indexOf(ye))}removeAt(ye){if((0,ce.it)(this._observable),ye<0||ye>=this.length||this._emitBeforeChanges(J.y.REMOVE))return;const Me=ee(this._splice(ye,1));return this._emitAfterChanges(J.y.REMOVE),Me}removeMany(ye){if((0,ce.it)(this._observable),!ye||!ye.length||this._emitBeforeChanges(J.y.REMOVE))return[];const Me=ye instanceof le?ye.toArray():ye,Ee=this._items,Te=[],me=Me.length;for(let Ce=0;Ce<me;Ce++){const Ge=Ee.indexOf(Me[Ce]);if(Ge>-1){const Je=1+$(Me,Ee,Ce+1,Ge+1),xe=this._splice(Ge,Je);xe&&xe.length>0&&Te.push.apply(Te,xe),Ce+=Je-1}}return this._emitAfterChanges(J.y.REMOVE),Te}reverse(){if((0,ce.it)(this._observable),this._emitBeforeChanges(J.y.MOVE))return this;const ye=this._splice(0,this.length);return ye&&(ye.reverse(),this._splice(0,0,ye)),this._emitAfterChanges(J.y.MOVE),this}shift(){if((0,ce.it)(this._observable),!this.length||this._emitBeforeChanges(J.y.REMOVE))return;const ye=ee(this._splice(0,1));return this._emitAfterChanges(J.y.REMOVE),ye}slice(ye=0,Me=this.length){return(0,ce.it)(this._observable),this._createNewInstance({items:this._items.slice(ye,Me)})}some(ye,Me){return(0,ce.it)(this._observable),this._items.some(ye,Me)}sort(ye){if((0,ce.it)(this._observable),!this.length||this._emitBeforeChanges(J.y.MOVE))return this;const Me=(0,H.j0)(this._splice(0,this.length));return arguments.length?Me.sort(ye):Me.sort(),this._splice(0,0,Me),this._emitAfterChanges(J.y.MOVE),this}splice(ye,Me,...Ee){(0,ce.it)(this._observable);const Te=(Me?J.y.REMOVE:0)|(Ee.length?J.y.ADD:0);if(this._emitBeforeChanges(Te))return[];const me=this._splice(ye,Me,Ee)||[];return this._emitAfterChanges(Te),me}toArray(){return(0,ce.it)(this._observable),this._items.slice()}toJSON(){return(0,ce.it)(this._observable),this.toArray()}toLocaleString(){return(0,ce.it)(this._observable),this._items.toLocaleString()}toString(){return(0,ce.it)(this._observable),this._items.toString()}unshift(...ye){return(0,ce.it)(this._observable),!ye.length||this._emitBeforeChanges(J.y.ADD)||(this._splice(0,0,ye),this._emitAfterChanges(J.y.ADD)),this.length}_createNewInstance(ye){return new this.constructor(ye)}_splice(ye,Me,Ee){const Te=this._items,me=this.itemType;let Ce,Ie;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=(0,W.Os)(()=>this._dispatchChange())),Me){if(Ie=Te.splice(ye,Me),this.hasEventListener("before-remove")){const Ge=j.acquire();Ge.target=this,Ge.cancellable=!0;for(let Je=0,xe=Ie.length;Je<xe;Je++)Ce=Ie[Je],Ge.reset(Ce),this.emit("before-remove",Ge),Ge.defaultPrevented&&(Ie.splice(Je,1),Te.splice(ye,0,Ce),ye+=1,Je-=1,xe-=1);j.release(Ge)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const Ge=j.acquire();Ge.target=this,Ge.cancellable=!1;const Je=Ie.length;for(let xe=0;xe<Je;xe++)Ge.reset(Ie[xe]),this.emit("after-remove",Ge);j.release(Ge)}}if(Ee&&Ee.length){if(me){const je=[];for(const We of Ee){const Ne=me.ensureType(We);null==Ne&&null!=We||je.push(Ne)}Ee=je}const Ge=this.hasEventListener("before-add"),Je=this.hasEventListener("after-add"),xe=ye===this.length;if(Ge||Je){const je=j.acquire();je.target=this,je.cancellable=!0;const We=j.acquire();We.target=this,We.cancellable=!1;for(const Ne of Ee)Ge?(je.reset(Ne),this.emit("before-add",je),je.defaultPrevented||(xe?Te.push(Ne):Te.splice(ye++,0,Ne),this._set("length",Te.length),Je&&(We.reset(Ne),this.emit("after-add",We)))):(xe?Te.push(Ne):Te.splice(ye++,0,Ne),this._set("length",Te.length),We.reset(Ne),this.emit("after-add",We));j.release(We),j.release(je)}else{if(xe)for(const je of Ee)Te.push(je);else Te.splice(ye,0,...Ee);this._set("length",Te.length)}}return(Ee&&Ee.length||Ie&&Ie.length)&&this._notifyChangeEvent(Ee,Ie),Ie}_emitBeforeChanges(ye){let Me=!1;if(this.hasEventListener("before-changes")){const Ee=j.acquire();Ee.target=this,Ee.cancellable=!0,Ee.type=ye,this.emit("before-changes",Ee),Me=Ee.defaultPrevented,j.release(Ee)}return Me}_emitAfterChanges(ye){if(this.hasEventListener("after-changes")){const Me=j.acquire();Me.target=this,Me.cancellable=!1,Me.type=ye,this.emit("after-changes",Me),j.release(Me)}this._observable.notify()}_notifyChangeEvent(ye,Me){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:ye,removed:Me})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const ye=this._notifications;this._notifications=null;for(const Me of ye){const Ee=Me.changes;se.clear(),ae.clear(),de.clear();for(const{added:Je,removed:xe}of Ee){if(Je)if(0===de.size&&0===ae.size)for(const je of Je)se.add(je);else for(const je of Je)ae.has(je)?(de.add(je),ae.delete(je)):de.has(je)||se.add(je);if(xe)if(0===de.size&&0===se.size)for(const je of xe)ae.add(je);else for(const je of xe)se.has(je)?se.delete(je):(de.delete(je),ae.add(je))}const Te=A.Z.acquire();se.forEach(Je=>{Te.push(Je)});const me=A.Z.acquire();ae.forEach(Je=>{me.push(Je)});const Ce=this._items,Ie=Me.items,Ge=A.Z.acquire();if(de.forEach(Je=>{Ie.indexOf(Je)!==Ce.indexOf(Je)&&Ge.push(Je)}),Me.listeners&&(Te.length||me.length||Ge.length)){const Je={target:this,added:Te,removed:me,moved:Ge},xe=Me.listeners.length;for(let je=0;je<xe;je++){const We=Me.listeners[je];We.removed||We.callback.call(this,Je)}}A.Z.release(Te),A.Z.release(me),A.Z.release(Ge)}se.clear(),ae.clear(),de.clear()}};he.ofType=ye=>{if(!ye)return le;if(_e.has(ye))return _e.get(ye);let Me=null;if("function"==typeof ye)Me=ye.prototype.declaredClass;else if(ye.base)Me=ye.base.prototype.declaredClass;else for(const Te in ye.typeMap){const me=ye.typeMap[Te].prototype.declaredClass;Me?Me+=` | ${me}`:Me=me}let Ee=class extends le{};return(0,x._)([(0,ie.c)({Type:ye,ensureType:"function"==typeof ye?(0,Z.se)(ye):(0,Z.N7)(ye)})],Ee.prototype,"itemType",void 0),Ee=(0,x._)([(0,ue.j)(`esri.core.Collection<${Me}>`)],Ee),_e.set(ye,Ee),Ee},(0,x._)([(0,B.Cb)()],he.prototype,"length",void 0),(0,x._)([(0,B.Cb)()],he.prototype,"items",null),he=le=(0,x._)([(0,ue.j)("esri.core.Collection")],he);const ge=he},46882:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var x=T(17626),A=T(46160),G=T(80542),Q=T(62208),B=(T(8314),T(26584),T(63290),T(30755),T(21352)),Z=T(77712),ce=(T(85931),T(90912),T(76898));let oe=class extends((0,G.p)(A.Z)){constructor(Y){super(Y),this.getCollections=null}initialize(){this.handles.add((0,B.EH)(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const Y=(0,Q.pC)(this.getCollections)?this.getCollections():null;if((0,Q.Wi)(Y))return void this.removeAll();let j=0;for(const X of Y)(0,Q.pC)(X)&&(j=this._processCollection(j,X));this.splice(j,this.length)}_createNewInstance(Y){return new A.Z(Y)}_processCollection(Y,j){if(!j)return Y;const X=this.itemFilterFunction?this.itemFilterFunction:U=>!!U;for(const U of j)if(U){if(X(U)){const ee=this.indexOf(U,Y);ee>=0?ee!==Y&&this.reorder(U,Y):this.add(U,Y),++Y}if(this.getChildrenFunction){const ee=this.getChildrenFunction(U);if(Array.isArray(ee))for(const $ of ee)Y=this._processCollection(Y,$);else Y=this._processCollection(Y,ee)}}return Y}};(0,x._)([(0,Z.Cb)()],oe.prototype,"getCollections",void 0),(0,x._)([(0,Z.Cb)()],oe.prototype,"getChildrenFunction",void 0),(0,x._)([(0,Z.Cb)()],oe.prototype,"itemFilterFunction",void 0),oe=(0,x._)([(0,ce.j)("esri.core.CollectionFlattener")],oe);const le=oe},23719:(dt,Re,T)=>{"use strict";T.d(Re,{BV:()=>re,Q4:()=>H,c5:()=>Q,pE:()=>A});var x=T(21286);class A{constructor(W,B){this.min=W,this.max=B,this.range=B-W}ndiff(W,B=0){return Math.ceil((W-B)/this.range)*this.range+B}_normalize(W,B,Z,ie=0,ue=!1){return(Z-=ie)<W?Z+=this.ndiff(W-Z):Z>B&&(Z-=this.ndiff(Z-B)),ue&&Z===B&&(Z=W),Z+ie}normalize(W,B=0,Z=!1){return this._normalize(this.min,this.max,W,B,Z)}clamp(W,B=0){return(0,x.uZ)(W-B,this.min,this.max)+B}monotonic(W,B,Z){return W<B?B:B+this.ndiff(W-B,Z)}minimalMonotonic(W,B,Z){return this._normalize(W,W+this.range,B,Z)}center(W,B,Z){return B=this.monotonic(W,B,Z),this.normalize((W+B)/2,Z)}diff(W,B,Z){return this.monotonic(W,B,Z)-W}shortestSignedDiff(W,B){W=this.normalize(W);const Z=(B=this.normalize(B))-W,ie=B<W?this.minimalMonotonic(W,B)-W:B-this.minimalMonotonic(B,W);return Math.abs(Z)<Math.abs(ie)?Z:ie}contains(W,B,Z){return B=this.minimalMonotonic(W,B),(Z=this.minimalMonotonic(W,Z))>W&&Z<B}}function G(J){for(const W in J){const B=J[W];B instanceof Function&&(J[W]=B.bind(J))}return J}const Q=G(new A(0,2*Math.PI)),H=G(new A(-Math.PI,Math.PI)),re=G(new A(0,360))},26584:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Q});var x=T(58817),A=T(63290),G=T(90888);class Q extends G.Z{constructor(re,J,W){if(super(re,J,W),!(this instanceof Q))return new Q(re,J,W)}toJSON(){if(null!=this.details)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(re,J)=>{if(J&&"object"==typeof J&&"function"==typeof J.toJSON)return J;try{return(0,x.d9)(J)}catch(W){return"[object]"}}))}}catch(re){throw A.Z.getLogger("esri.core.Error").error(re),re}return{name:this.name,message:this.message,details:this.details}}static fromJSON(re){return new Q(re.name,re.message,re.details)}}Q.prototype.type="error"},61885:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>re});var x=T(17626),A=T(14517),G=T(54024),Q=T(76898);class H{constructor(){this._emitter=new H.EventEmitter(this)}emit(W,B){return this._emitter.emit(W,B)}on(W,B){return this._emitter.on(W,B)}once(W,B){return this._emitter.once(W,B)}hasEventListener(W){return this._emitter.hasEventListener(W)}}!function(J){class W{constructor(ie=null){this.target=ie,this._listenersMap=null}clear(){this._listenersMap&&this._listenersMap.clear(),this._listenersMap=null}emit(ie,ue){const ce=this._listenersMap&&this._listenersMap.get(ie);if(!ce)return!1;const oe=this.target||this;return[...ce].forEach(le=>{le.call(oe,ue)}),ce.length>0}on(ie,ue){if(Array.isArray(ie)){const oe=ie.map(le=>this.on(le,ue));return(0,G.AL)(oe)}if(ie.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const ce=this._listenersMap.get(ie)||[];return ce.push(ue),this._listenersMap.set(ie,ce),{remove:()=>{const oe=this._listenersMap&&this._listenersMap.get(ie)||[],le=oe.indexOf(ue);le>=0&&oe.splice(le,1)}}}once(ie,ue){const ce=this.on(ie,oe=>{ce.remove(),ue.call(null,oe)});return ce}hasEventListener(ie){const ue=this._listenersMap&&this._listenersMap.get(ie);return null!=ue&&ue.length>0}}J.EventEmitter=W,J.EventedMixin=Z=>{let ie=class extends Z{constructor(){super(...arguments),this._emitter=new W}destroy(){this._emitter.clear()}emit(ue,ce){return this._emitter.emit(ue,ce)}on(ue,ce){return this._emitter.on(ue,ce)}once(ue,ce){return this._emitter.once(ue,ce)}hasEventListener(ue){return this._emitter.hasEventListener(ue)}};return ie=(0,x._)([(0,Q.j)("esri.core.Evented")],ie),ie};let B=class extends A.Z{constructor(){super(...arguments),this._emitter=new H.EventEmitter(this)}destroy(){this._emitter.clear()}emit(Z,ie){return this._emitter.emit(Z,ie)}on(Z,ie){return this._emitter.on(Z,ie)}once(Z,ie){return this._emitter.once(Z,ie)}hasEventListener(Z){return this._emitter.hasEventListener(Z)}};B=(0,x._)([(0,Q.j)("esri.core.Evented")],B),J.EventedAccessor=B}(H||(H={}));const re=H},80542:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>J,r:()=>W});var x=T(17626),A=T(14517),G=T(72392),Q=T(77712),H=T(76898),re=T(17760);const J=B=>{let Z=class extends B{destroy(){var ie,ue;this.destroyed||(null==(ie=this._get("handles"))||ie.destroy(),null==(ue=this._get("updatingHandles"))||ue.destroy())}get handles(){return this._get("handles")||new G.Z}get updatingHandles(){return this._get("updatingHandles")||new re.t}};return(0,x._)([(0,Q.Cb)({readOnly:!0})],Z.prototype,"handles",null),(0,x._)([(0,Q.Cb)({readOnly:!0})],Z.prototype,"updatingHandles",null),Z=(0,x._)([(0,H.j)("esri.core.HandleOwner")],Z),Z};let W=class extends(J(A.Z)){};W=(0,x._)([(0,H.j)("esri.core.HandleOwner")],W)},72392:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>W});var x=T(17626),A=T(14517),G=T(46160),Q=T(62208),H=T(77712),re=T(76898);let J=class extends A.Z{constructor(B){super(B),this._groups=new Map}destroy(){this.removeAll()}get size(){let B=0;return this._groups.forEach(Z=>{B+=Z.length}),B}add(B,Z){if(!this._isHandle(B)&&!Array.isArray(B)&&!G.Z.isCollection(B))return this;const ie=this._getOrCreateGroup(Z);return Array.isArray(B)||G.Z.isCollection(B)?B.forEach(ue=>this._isHandle(ue)&&ie.push(ue)):ie.push(B),this.notifyChange("size"),this}forEach(B,Z){if("function"==typeof B)this._groups.forEach(ie=>ie.forEach(B));else{const ie=this._getGroup(B);ie&&Z&&ie.forEach(Z)}}has(B){return this._groups.has(this._ensureGroupKey(B))}remove(B){if(Array.isArray(B)||G.Z.isCollection(B))return B.forEach(this.remove,this),this;if(!this.has(B))return this;const Z=this._getGroup(B);for(let ie=0;ie<Z.length;ie++)Z[ie].remove();return this._deleteGroup(B),this.notifyChange("size"),this}removeAll(){return this._groups.forEach(B=>{for(let Z=0;Z<B.length;Z++)B[Z].remove()}),this._groups.clear(),this.notifyChange("size"),this}_isHandle(B){return B&&!!B.remove}_getOrCreateGroup(B){if(this.has(B))return this._getGroup(B);const Z=[];return this._groups.set(this._ensureGroupKey(B),Z),Z}_getGroup(B){return(0,Q.j0)(this._groups.get(this._ensureGroupKey(B)))}_deleteGroup(B){return this._groups.delete(this._ensureGroupKey(B))}_ensureGroupKey(B){return B||"_default_"}};(0,x._)([(0,H.Cb)({readOnly:!0})],J.prototype,"size",null),J=(0,x._)([(0,re.j)("esri.core.Handles")],J);const W=J},61996:(dt,Re,T)=>{"use strict";T.d(Re,{Ej:()=>re,IG:()=>Q});var x=T(17626),A=T(76898);let G=0;const Q=J=>{let W=class extends J{constructor(...B){super(...B),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+G++})}};return W=(0,x._)([(0,A.j)("esri.core.Identifiable")],W),W};let re=class extends(Q(class{})){};re=(0,x._)([(0,A.j)("esri.core.Identifiable")],re)},78498:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>A});var x=T(1036);class A{constructor(Q,H){this._storage=new x.WJ,this._storage.maxSize=Q,H&&this._storage.registerRemoveFunc("",H)}put(Q,H){this._storage.put(Q,H,1,1)}pop(Q){return this._storage.pop(Q)}get(Q){return this._storage.get(Q)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}}},86810:(dt,Re,T)=>{"use strict";T.d(Re,{wq:()=>Y,eC:()=>ce});var x=T(17626),A=T(14517),G=T(62208),Q=T(58817),H=T(31283);class re{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(X){const U=new re;return this._values.forEach((ee,$)=>{X&&X.has($)||U.set($,(0,Q.d9)(ee.value),ee.origin)}),U}get(X,U){U=this._normalizeOrigin(U);const ee=this._values.get(X);return null==U||(null==ee?void 0:ee.origin)===U?null==ee?void 0:ee.value:void 0}originOf(X){var U,ee;return null!=(ee=null==(U=this._values.get(X))?void 0:U.origin)?ee:H.s3.USER}keys(X){X=this._normalizeOrigin(X);const U=[...this._values.keys()];return null==X?U:U.filter(ee=>{var $;return(null==($=this._values.get(ee))?void 0:$.origin)===X})}set(X,U,ee){if((ee=this._normalizeOrigin(ee))===H.s3.DEFAULTS){const $=this._values.get(X);if($&&null!=$.origin&&$.origin>ee)return}this._values.set(X,new J(U,ee))}delete(X,U){var ee;null!=(U=this._normalizeOrigin(U))&&(null==(ee=this._values.get(X))?void 0:ee.origin)!==U||this._values.delete(X)}has(X,U){var ee;return null!=(U=this._normalizeOrigin(U))?(null==(ee=this._values.get(X))?void 0:ee.origin)===U:this._values.has(X)}forEach(X){this._values.forEach(({value:U},ee)=>X(U,ee))}_normalizeOrigin(X){if(null!=X)return X===H.s3.DEFAULTS?X:H.s3.USER}}class J{constructor(X,U){this.value=X,this.origin=U}}var W=T(12590),B=T(29338),Z=T(52323),ie=T(36054),ue=T(76898);const ce=j=>{let X=class extends j{constructor(...U){super(...U);const ee=(0,G.j0)((0,Z.vw)(this)),$=ee.store,ne=new re;ee.store=ne,(0,W.M)(ee,$,ne)}read(U,ee){(0,B.i)(this,U,ee)}write(U={},ee){return(0,ie.c)(this,U,ee)}toJSON(U){return this.write({},U)}static fromJSON(U,ee){return oe.call(this,U,ee)}};return X=(0,x._)([(0,ue.j)("esri.core.JSONSupport")],X),X.prototype.toJSON.isDefaultToJSON=!0,X};function oe(j,X){if(!j)return null;if(j.declaredClass)throw new Error("JSON object is already hydrated");const U=new this;return U.read(j,X),U}let Y=class extends(ce(A.Z)){};Y=(0,x._)([(0,ue.j)("esri.core.JSONSupport")],Y)},93961:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>A});var x=T(1036);class A{constructor(Q,H){this._storage=new x.WJ,this._storage.maxSize=Q,H&&this._storage.registerRemoveFunc("",H)}put(Q,H,re){this._storage.put(Q,H,re,1)}pop(Q){return this._storage.pop(Q)}get(Q){return this._storage.get(Q)}clear(){this._storage.clearAll()}destroy(){this._storage.destroy()}get maxSize(){return this._storage.maxSize}set maxSize(Q){this._storage.maxSize=Q}}},47996:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var x=T(17626),A=T(26584),G=T(60330),Q=T(10699),H=T(14889),re=T(77712),J=T(76898);const ue=le=>{let Y=class extends le{constructor(...j){super(...j),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(X=>{const U=this.load.bind(this);this.load=ee=>{const $=new Promise((ne,se)=>{const ae=(0,Q.$F)(ee,se);this.destroyed&&se(new A.Z("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this._promiseProps.when(ne,se).finally(()=>{ae&&ae.remove()})});if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const ne=this._loadController=new AbortController;U({signal:ne.signal}),(0,Q.fu)(ne.signal,()=>{this._promiseProps.abort()})}return X(),$}})),this.when(()=>{this._set("loadStatus","loaded"),this._loadController=null},X=>{this._set("loadStatus","failed"),this._set("loadError",X),this._loadController=null})}get loaded(){return"loaded"===this.loadStatus}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var j;return this.isFulfilled()||(this._set("loadError",new A.Z("load:cancelled","Cancelled")),null==(j=this._loadController)||j.abort()),this}};return(0,x._)([(0,re.Cb)({readOnly:!0})],Y.prototype,"loaded",null),(0,x._)([(0,re.Cb)({readOnly:!0})],Y.prototype,"loadError",void 0),(0,x._)([(0,re.Cb)({clonable:!1})],Y.prototype,"loadStatus",void 0),(0,x._)([(0,re.Cb)({type:[H.Z],readOnly:!0})],Y.prototype,"loadWarnings",null),Y=(0,x._)([(0,J.j)("esri.core.Loadable")],Y),Y};let ce=class extends(ue(G.D)){};var le;ce=(0,x._)([(0,J.j)("esri.core.Loadable")],ce),(le=ce||(ce={})).LoadableMixin=ue,le.isLoadable=function Y(j){return!(!j||!j.load)};const oe=ce},63290:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>re});var x=T(59318),G=(T(8314),T(62208)),Q=T(77275);const H={info:0,warn:1,error:2,none:3};class re{constructor(W){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},null!=W.level&&(this.level=W.level),null!=W.writer&&(this.writer=W.writer),this._module=W.module,re._loggers[this.module]=this;const B=this.module.lastIndexOf(".");-1!==B&&(this._parent=re.getLogger(this.module.slice(0,B)))}get module(){return this._module}get parent(){return this._parent}error(...W){this._log("error","always",...W)}warn(...W){this._log("warn","always",...W)}info(...W){this._log("info","always",...W)}errorOnce(...W){this._log("error","once",...W)}warnOnce(...W){this._log("warn","once",...W)}infoOnce(...W){this._log("info","once",...W)}errorOncePerTick(...W){this._log("error","oncePerTick",...W)}warnOncePerTick(...W){this._log("warn","oncePerTick",...W)}infoOncePerTick(...W){this._log("info","oncePerTick",...W)}get test(){const W=this;return{loggedMessages:W._loggedMessages,clearLoggedWarnings:()=>W._loggedMessages.warn.clear()}}static get testSingleton(){return{resetLoggers(W={}){const B=re._loggers;return re._loggers=W,B},set throttlingDisabled(W){re._throttlingDisabled=W}}}static getLogger(W){let B=re._loggers[W];return B||(B=new re({module:W})),B}_log(W,B,...Z){if(this._matchLevel(W)){if("always"!==B&&!re._throttlingDisabled){const ie=this._argsToKey(Z),ue=this._loggedMessages[W].get(ie);if("once"===B&&null!=ue||"oncePerTick"===B&&ue&&ue>=re._tickCounter)return;this._loggedMessages[W].set(ie,re._tickCounter),re._scheduleTickCounterIncrement()}for(const ie of x.Z.log.interceptors)if(ie(W,this.module,...Z))return;this._inheritedWriter()(W,this.module,...Z)}}_parentWithMember(W,B){let Z=this;for(;(0,G.pC)(Z);){const ie=Z[W];if((0,G.pC)(ie))return ie;Z=Z.parent}return B}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(W,B,...Z){console[W](`[${B}]`,...Z)}_matchLevel(W){return H[this._parentWithMember("level",x.Z.log.level?x.Z.log.level:"warn")]<=H[W]}_argsToKey(...W){return(0,Q.hP)(JSON.stringify(W,(Z,ie)=>"object"!=typeof ie||Array.isArray(ie)?ie:"[Object]"))}static _scheduleTickCounterIncrement(){re._tickCounterScheduled||(re._tickCounterScheduled=!0,Promise.resolve().then(()=>{re._tickCounter++,re._tickCounterScheduled=!1}))}}re._loggers={},re._tickCounter=0,re._tickCounterScheduled=!1,re._throttlingDisabled=!1},88159:(dt,Re,T)=>{"use strict";function x(H,re){for(const[J,W]of H)if(re(W,J))return!0;return!1}function A(H,re){for(const[J,W]of H)if(re(W,J))return W;return null}function G(H,re,J){const W=H.get(re);if(void 0!==W)return W;const B=J();return H.set(re,B),B}T.d(Re,{fQ:()=>A,oE:()=>x,s1:()=>G})},1036:(dt,Re,T)=>{"use strict";T.d(Re,{WJ:()=>re,Xq:()=>H,an:()=>G,lN:()=>Q});var x=T(62208),A=T(77029);const G=-3;var Q,J;(J=Q||(Q={}))[J.ALL=0]="ALL",J[J.SOME=1]="SOME";class H{constructor(W,B,Z){this._namespace=W,this._storage=B,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),this._namespace+=":",Z&&(this._storage.registerRemoveFunc(this._namespace,Z),this._removeFunc=!0)}destroy(){this._storage.clear(this._namespace),this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace),this._storage.deregister(this),this._storage=null}get namespace(){return this._namespace.slice(0,-1)}get hitRate(){return this._hit/(this._hit+this._miss)}get size(){return this._storage.size}get maxSize(){return this._storage.maxSize}resetHitRate(){this._hit=this._miss=0}put(W,B,Z,ie=0){this._storage.put(this._namespace+W,B,Z,ie)}get(W){const B=this._storage.get(this._namespace+W);return void 0===B?++this._miss:++this._hit,B}pop(W){const B=this._storage.pop(this._namespace+W);return void 0===B?++this._miss:++this._hit,B}updateSize(W,B,Z){this._storage.updateSize(this._namespace+W,B,Z)}clear(){this._storage.clear(this._namespace)}clearAll(){this._storage.clearAll()}getStats(){return this._storage.getStats()}resetStats(){this._storage.resetStats()}}class re{constructor(W=10485760){this._maxSize=W,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new A.Z,this._users=new A.Z}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(W){this._users.push(W)}deregister(W){this._users.removeUnordered(W)}registerRemoveFunc(W,B){this._removeFuncs.push([W,B])}deregisterRemoveFunc(W){this._removeFuncs.filterInPlace(B=>B[0]!==W)}get size(){return this._size}get maxSize(){return this._maxSize}set maxSize(W){this._maxSize=Math.max(W,0),this._checkSizeLimit()}put(W,B,Z,ie){const ue=this._db.get(W);if(ue&&(this._size-=ue.size,this._db.delete(W),ue.entry!==B&&this._notifyRemove(W,ue.entry,Q.ALL)),Z>this._maxSize)return void this._notifyRemove(W,B,Q.ALL);if(void 0===B)return void console.warn("Refusing to cache undefined entry ");if(!Z||Z<0)return void console.warn("Refusing to cache entry with invalid size "+Z);const ce=1+Math.max(ie,G)-G;this._db.set(W,{entry:B,size:Z,lifetime:ce,lives:ce}),this._size+=Z,this._checkSizeLimit()}updateSize(W,B,Z){const ie=this._db.get(W);if(ie&&ie.entry===B){for(this._size-=ie.size;Z>this._maxSize;){const ue=this._notifyRemove(W,B,Q.SOME);if(!((0,x.pC)(ue)&&ue>0))return void this._db.delete(W);Z=ue}ie.size=Z,this._size+=Z,this._checkSizeLimit()}}pop(W){const B=this._db.get(W);if(B)return this._size-=B.size,this._db.delete(W),++this._hit,B.entry;++this._miss}get(W){const B=this._db.get(W);if(void 0!==B)return this._db.delete(W),B.lives=B.lifetime,this._db.set(W,B),++this._hit,B.entry;++this._miss}getStats(){const W={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},B={},Z=new Array;this._db.forEach((ce,oe)=>{const le=ce.lifetime;Z[le]=(Z[le]||0)+ce.size,this._users.forAll(Y=>{const j=Y.namespace;oe.startsWith(j)&&(B[j]=(B[j]||0)+ce.size)})});const ie={};this._users.forAll(ce=>{const oe=ce.namespace;!isNaN(ce.hitRate)&&ce.hitRate>0?(B[oe]=B[oe]||0,ie[oe]=Math.round(100*ce.hitRate)+"%"):ie[oe]="0%"});const ue=Object.keys(B);ue.sort((ce,oe)=>B[oe]-B[ce]),ue.forEach(ce=>W[ce]=Math.round(B[ce]/2**20)+"MB / "+ie[ce]);for(let ce=Z.length-1;ce>=0;--ce){const oe=Z[ce];oe&&(W["Priority "+(ce+G-1)]=Math.round(oe/this.size*100)+"%")}return W}resetStats(){this._hit=this._miss=0,this._users.forAll(W=>W.resetHitRate())}clear(W){this._db.forEach((B,Z)=>{Z.startsWith(W)&&(this._size-=B.size,this._db.delete(Z),this._notifyRemove(Z,B.entry,Q.ALL))})}clearAll(){this._db.forEach((W,B)=>this._notifyRemove(B,W.entry,Q.ALL)),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(W,B,Z){let ie;return this._removeFuncs.some(ue=>{if(W.startsWith(ue[0])){const ce=ue[1](B,Z);return"number"==typeof ce&&(ie=ce),!0}return!1}),ie}_checkSizeLimit(){if(!(this._size<=this._maxSize))for(const[W,B]of this._db){if(this._db.delete(W),B.lives<=1){this._size-=B.size;const Z=this._notifyRemove(W,B.entry,Q.SOME);(0,x.pC)(Z)&&Z>0&&(this._size+=Z,B.lives=B.lifetime,B.size=Z,this._db.set(W,B))}else--B.lives,this._db.set(W,B);if(this._size<=.9*this.maxSize)return}}}},90888:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>G});var x=T(94113);class G{constructor(H,re,J){this.name=H,this.details=J,this.message=void 0,this instanceof G&&(this.message=re&&function A(Q,H){return Q.replace(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(re,J)=>{if(""===J)return"$";const W=(0,x.hS)(J,H),B=null==W?"":W;if(void 0===B)throw new Error(`could not find key "${J}" in template`);return B.toString()})}(re,J)||"")}toString(){return"["+this.name+"]: "+this.message}}},99959:(dt,Re,T)=>{"use strict";T.d(Re,{R:()=>j,w:()=>X});var x=T(17626),A=T(14517),G=T(62208),Q=T(12590),H=T(58817),re=T(31283);class J{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(re.kk),this._values=new Map,this.multipleOriginsSupported=!0}clone(ee){const $=new J,ne=this._originStores[re.s3.DEFAULTS];ne&&ne.forEach((se,ae)=>{$.set(ae,(0,H.d9)(se),re.s3.DEFAULTS)});for(let se=re.s3.SERVICE;se<re.kk;se++){const ae=this._originStores[se];ae&&ae.forEach((de,_e)=>{ee&&ee.has(_e)||$.set(_e,(0,H.d9)(de),se)})}return $}get(ee,$){const ne=void 0===$?this._values:this._originStores[$];return ne?ne.get(ee):void 0}keys(ee){const $=null==ee?this._values:this._originStores[ee];return $?[...$.keys()]:[]}set(ee,$,ne=re.s3.USER){let se=this._originStores[ne];if(se||(se=new Map,this._originStores[ne]=se),se.set(ee,$),!this._values.has(ee)||(0,G.j0)(this._propertyOriginMap.get(ee))<=ne){const ae=this._values.get(ee);return this._values.set(ee,$),this._propertyOriginMap.set(ee,ne),ae!==$}return!1}delete(ee,$=re.s3.USER){const ne=this._originStores[$];if(!ne)return;const se=ne.get(ee);if(ne.delete(ee),this._values.has(ee)&&this._propertyOriginMap.get(ee)===$){this._values.delete(ee);for(let ae=$-1;ae>=0;ae--){const de=this._originStores[ae];if(de&&de.has(ee)){this._values.set(ee,de.get(ee)),this._propertyOriginMap.set(ee,ae);break}}}return se}has(ee,$){const ne=void 0===$?this._values:this._originStores[$];return!!ne&&ne.has(ee)}revert(ee,$){for(;$>0&&!this.has(ee,$);)--$;const ne=this._originStores[$],se=ne&&ne.get(ee),ae=this._values.get(ee);return this._values.set(ee,se),this._propertyOriginMap.set(ee,$),ae!==se}originOf(ee){return this._propertyOriginMap.get(ee)||re.s3.DEFAULTS}forEach(ee){this._values.forEach(ee)}}var W=T(29338),B=T(52323),Z=T(76898);const ie=U=>{let ee=class extends U{constructor(...$){super(...$);const ne=(0,G.j0)((0,B.vw)(this)),se=ne.store,ae=new J;ne.store=ae,(0,Q.M)(ne,se,ae)}read($,ne){(0,W.i)(this,$,ne)}getAtOrigin($,ne){const se=ue(this),ae=(0,re.M9)(ne);if("string"==typeof $)return se.get($,ae);const de={};return $.forEach(_e=>{de[_e]=se.get(_e,ae)}),de}originOf($){return(0,re.x3)(this.originIdOf($))}originIdOf($){return ue(this).originOf($)}revert($,ne){const se=ue(this),ae=(0,re.M9)(ne),de=(0,B.vw)(this);let _e;_e="string"==typeof $?"*"===$?se.keys(ae):[$]:$,_e.forEach(pe=>{de.invalidate(pe),se.revert(pe,ae),de.commit(pe)})}};return ee=(0,x._)([(0,Z.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],ee),ee};function ue(U){return(0,B.vw)(U).store}let ce=class extends(ie(A.Z)){};ce=(0,x._)([(0,Z.j)("esri.core.ReadOnlyMultiOriginJSONSupport")],ce);var oe=T(36054);const le=U=>{let ee=class extends U{constructor(...$){super(...$)}clear($,ne="user"){return Y(this).delete($,(0,re.M9)(ne))}write($={},ne){return(0,oe.c)(this,$=$||{},ne),$}setAtOrigin($,ne,se){(0,B.vw)(this).setAtOrigin($,ne,(0,re.M9)(se))}removeOrigin($){const ne=Y(this),se=(0,re.M9)($),ae=ne.keys(se);for(const de of ae)ne.originOf(de)===se&&ne.set(de,ne.get(de,se),re.s3.USER)}updateOrigin($,ne){const se=Y(this),ae=(0,re.M9)(ne),de=this.get($);for(let _e=ae+1;_e<re.kk;++_e)se.delete($,_e);se.set($,de,ae)}toJSON($){return this.write({},$)}};return ee=(0,x._)([(0,Z.j)("esri.core.WriteableMultiOriginJSONSupport")],ee),ee.prototype.toJSON.isDefaultToJSON=!0,ee};function Y(U){return(0,B.vw)(U).store}const j=U=>{let ee=class extends(le(ie(U))){constructor(...$){super(...$)}};return ee=(0,x._)([(0,Z.j)("esri.core.MultiOriginJSONSupport")],ee),ee};let X=class extends(j(A.Z)){};X=(0,x._)([(0,Z.j)("esri.core.MultiOriginJSONSupport")],X)},1101:(dt,Re,T)=>{"use strict";T.d(Re,{r:()=>x});class x{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return 0===this._outer.size}get(G,Q){var H;return null==(H=this._outer.get(G))?void 0:H.get(Q)}set(G,Q,H){const re=this._outer.get(G);re?re.set(Q,H):this._outer.set(G,new Map([[Q,H]]))}delete(G,Q){const H=this._outer.get(G);H&&(H.delete(Q),0===H.size&&this._outer.delete(G))}forEach(G){this._outer.forEach((Q,H)=>G(Q,H))}}},27899:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>G});let G=(()=>{class Q{constructor(re,J,W,B=1,Z=0){if(this.ctor=re,this.acquireFunction=J,this.releaseFunction=W,this.allocationSize=B,this._pool=new Array(Z),this._initialSize=Z,this.ctor)for(let ie=0;ie<Z;ie++)this._pool[ie]=new this.ctor;this.allocationSize=Math.max(B,1)}destroy(){this.prune(0)}acquire(...re){let J;if(Q.test.disabled)J=new this.ctor;else{if(0===this._pool.length){const W=this.allocationSize;for(let B=0;B<W;B++)this._pool[B]=new this.ctor}J=this._pool.pop()}return this.acquireFunction?this.acquireFunction(J,...re):function A(Q){return Q&&Q.acquire&&"function"==typeof Q.acquire}(J)&&J.acquire(...re),J}release(re){re&&!Q.test.disabled&&(this.releaseFunction?this.releaseFunction(re):function x(Q){return Q&&Q.release&&"function"==typeof Q.release}(re)&&re.release(),this._pool.push(re))}prune(re=this._initialSize){if(!(re>=this._pool.length)){for(let J=re;J<this._pool.length;++J)this._dispose(this._pool[J]);this._pool.length=re}}_dispose(re){re.dispose&&"function"==typeof re.dispose&&re.dispose()}}return Q.test={disabled:!1},Q})()},97535:(dt,Re,T)=>{"use strict";T.d(Re,{x:()=>A});var x=T(79682);class A{constructor(H){this.allocator=H,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&(0,x.Y)(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const H=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*G);this._items.length=Math.min(H,this._items.length),this._itemsPtr=0}_grow(){for(let H=0;H<Math.max(8,Math.min(this._items.length,G));H++)this._items.push(this.allocator())}}const G=1024},73234:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{y:()=>x}),(A=x||(x={}))[A.ADD=1]="ADD",A[A.REMOVE=2]="REMOVE",A[A.MOVE=4]="MOVE"},73362:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>A});class A{constructor(Q,H=29){this.name=Q,this._counter=0,this._items=new Array(H)}record(Q){this._items[++this._counter%this._items.length]=Q}get median(){return this._items.slice().sort((Q,H)=>Q-H)[Math.floor(this._items.length/2)]}get average(){return this._items.reduce((Q,H)=>Q+H,0)/this._items.length}get last(){return this._items[this._counter%this._items.length]}}},77029:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>re});var A,x=T(85931);!function(W){const B=(ce,oe,le,Y)=>{let j=oe,X=oe;const U=le>>>1,ee=ce[j-1];for(;X<=U;){X=j<<1,X<le&&Y(ce[X-1],ce[X])<0&&++X;const $=ce[X-1];if(Y($,ee)<=0)break;ce[j-1]=$,j=X}ce[j-1]=ee},Z=(ce,oe)=>ce<oe?-1:ce>oe?1:0;W.sort=function ie(ce,oe,le,Y){void 0===oe&&(oe=0),void 0===le&&(le=ce.length),void 0===Y&&(Y=Z);for(let X=le>>>1;X>oe;X--)B(ce,X,le,Y);const j=oe+1;for(let X=le-1;X>oe;X--){const U=ce[oe];ce[oe]=ce[X],ce[X]=U,B(ce,j,X,Y)}},W.iterableSort=function*ue(ce,oe,le,Y){void 0===oe&&(oe=0),void 0===le&&(le=ce.length),void 0===Y&&(Y=Z);for(let X=le>>>1;X>oe;X--)B(ce,X,le,Y),yield;const j=oe+1;for(let X=le-1;X>oe;X--){const U=ce[oe];ce[oe]=ce[X],ce[X]=U,B(ce,j,X,Y),yield}}}(A||(A={}));const G=A;class re{constructor(B){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new x.SO,B&&(B.initialSize&&(this.data=new Array(B.initialSize)),B.allocator&&(this._allocator=B.allocator),void 0!==B.deallocator&&(this._deallocator=B.deallocator),B.shrink&&(this._shrink=()=>J(this)))}toArray(){return this.data.slice(0,this.length)}filter(B){const Z=new Array;for(let ie=0;ie<this._length;ie++){const ue=this.data[ie];B(ue)&&Z.push(ue)}return Z}getItemAt(B){if(!(B<0||B>=this._length))return this.data[B]}includes(B,Z){const ie=this.data.indexOf(B,Z);return-1!==ie&&ie<this.length}get length(){return this._length}set length(B){if(B>this._length){if(this._allocator){for(;this._length<B;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=B}else{if(this._deallocator)for(let Z=B;Z<this._length;++Z)this.data[Z]=this._deallocator(this.data[Z]);this._length=B,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(B){this.data[this._length++]=B}pushArray(B,Z=B.length){for(let ie=0;ie<Z;ie++)this.data[this._length++]=B[ie]}fill(B,Z){for(let ie=0;ie<Z;ie++)this.data[this._length++]=B}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const B=this.data[this._length];return++this._length,B}unshift(B){this.data.unshift(B),this._length++,J(this)}pop(){if(0===this.length)return;const B=this.data[this.length-1];return this.length=this.length-1,this._shrink(),B}remove(B){const Z=(0,x.cq)(this.data,B,this.length,this._hint);if(-1!==Z)return this.data.splice(Z,1),this.length=this.length-1,B}removeUnordered(B){const Z=(0,x.e$)(this.data,B,this.length,this._hint);return void 0!==Z&&(this.length=this.length-1),this._shrink(),Z}removeUnorderedIndex(B){if(!(B>=this.length||B<0))return this.swapElements(B,this.length-1),this.pop()}removeUnorderedMany(B,Z=B.length,ie){this.length=(0,x.FY)(this.data,B,this.length,Z,this._hint,ie),this._shrink()}front(){if(0!==this.length)return this.data[0]}back(){if(0!==this.length)return this.data[this.length-1]}swapElements(B,Z){B>=this.length||Z>=this.length||B===Z||([this.data[B],this.data[Z]]=[this.data[Z],this.data[B]])}sort(B){G.sort(this.data,0,this.length,B)}iterableSort(B){return G.iterableSort(this.data,0,this.length,B)}some(B,Z){for(let ie=0;ie<this.length;++ie)if(B.call(Z,this.data[ie],ie,this.data))return!0;return!1}filterInPlace(B,Z){let ie=0;for(let ue=0;ue<this._length;++ue){const ce=this.data[ue];B.call(Z,ce,ue,this.data)&&(this.data[ue]=this.data[ie],this.data[ie]=ce,ie++)}if(this._deallocator)for(let ue=ie;ue<this._length;ue++)this.data[ue]=this._deallocator(this.data[ue]);return this._length=ie,this._shrink(),this}forAll(B,Z){const ie=this.length,ue=this.data;for(let ce=0;ce<ie;++ce)B.call(Z,ue[ce],ce,ue)}forEach(B,Z){for(let ie=0;ie<this.length;++ie)B.call(Z,this.data[ie],ie,this.data)}map(B,Z){const ie=new Array(this.length);for(let ue=0;ue<this.length;++ue)ie[ue]=B.call(Z,this.data[ue],ue,this.data);return ie}reduce(B,Z){let ie=Z;for(let ue=0;ue<this.length;++ue)ie=B(ie,this.data[ue],ue,this.data);return ie}has(B){const Z=this.length,ie=this.data;for(let ue=0;ue<Z;++ue)if(ie[ue]===B)return!0;return!1}}function J(W){W.data.length>1.5*W.length&&(W.data.length=Math.floor(1.1*W.length))}},60330:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>B,v:()=>W});var re,Z,x=T(17626),A=T(14517),G=T(62208),Q=T(10699),H=T(76898);(Z=re||(re={}))[Z.PENDING=0]="PENDING",Z[Z.RESOLVED=1]="RESOLVED",Z[Z.REJECTED=2]="REJECTED";class J{constructor(ie){this.instance=ie,this._resolver=(0,Q.dD)(),this._status=re.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=re.RESOLVED,this._cleanUp()},()=>{this._status=re.REJECTED,this._cleanUp()})}addResolvingPromise(ie){this._resolvingPromises.push(ie),this._tryResolve()}isResolved(){return this._status===re.RESOLVED}isRejected(){return this._status===re.REJECTED}isFulfilled(){return this._status!==re.PENDING}abort(){this._resolver.reject((0,Q.zE)())}when(ie,ue){return this._resolver.promise.then(ie,ue)}_cleanUp(){this._allPromise=this._resolvingPromises=this._allPromise=null}_tryResolve(){if(this.isFulfilled())return;const ie=(0,Q.dD)(),ue=[...this._resolvingPromises,(0,G.j0)(ie.promise)],ce=this._allPromise=Promise.all(ue);ce.then(()=>{this.isFulfilled()||this._allPromise!==ce||this._resolver.resolve(this.instance)},oe=>{this.isFulfilled()||this._allPromise!==ce||(0,Q.D_)(oe)||this._resolver.reject(oe)}),ie.resolve()}}const W=Z=>{let ie=class extends Z{constructor(...ue){super(...ue),this._promiseProps=new J(this),this.addResolvingPromise(Promise.resolve())}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(ue,ce){return new Promise((oe,le)=>{this._promiseProps.when(oe,le)}).then(ue,ce)}catch(ue){return this.when(null,ue)}addResolvingPromise(ue){ue&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in ue?ue.when():ue)}};return ie=(0,x._)([(0,H.j)("esri.core.Promise")],ie),ie};let B=class extends(W(A.Z)){};B=(0,x._)([(0,H.j)("esri.core.Promise")],B)},35133:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>A});var x=T(62208);class A{constructor(Q=(H=>H.values().next().value)){this._peeker=Q,this._items=new Set}get length(){return this._items.size}clear(){this._items.clear()}last(){if(0===this._items.size)return;let Q;for(Q of this._items);return Q}peek(){if(0!==this._items.size)return this._peeker(this._items)}push(Q){this.contains(Q)||this._items.add(Q)}contains(Q){return this._items.has(Q)}pop(){if(0===this.length)return;const Q=this.peek();return this._items.delete((0,x.j0)(Q)),Q}popLast(){if(0===this.length)return;const Q=this.last();return this._items.delete((0,x.j0)(Q)),Q}remove(Q){this._items.delete(Q)}filter(Q){return this._items.forEach(H=>{Q(H)||this._items.delete(H)}),this}}},4619:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>x});class x{constructor(G=1){this._seed=G}set seed(G){this._seed=null==G?Math.random()*x._m:G}getInt(){return this._seed=(x._a*this._seed+x._c)%x._m,this._seed}getFloat(){return this.getInt()/(x._m-1)}getIntRange(G,Q){return Math.round(this.getFloatRange(G,Q))}getFloatRange(G,Q){const H=Q-G;return G+this.getInt()/x._m*H}}x._m=2147483647,x._a=48271,x._c=0},94530:(dt,Re,T)=>{"use strict";T.d(Re,{e:()=>G});var x=T(62208),A=T(27899);class G extends A.Z{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=(0,x.Bd)(this._set)}acquire(...H){const re=super.acquire(...H);return this._set.delete(re),re}release(H){H&&!this._set.has(H)&&(super.release(H),this._set.add(H))}_dispose(H){this._set.delete(H),super._dispose(H)}}},28862:(dt,Re,T)=>{"use strict";function x(G,Q){for(const H of G.entries())if(Q(H[0]))return!0;return!1}T.d(Re,{f:()=>x})},10349:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>A});var x=T(26584);class A{constructor(Q,H,re=""){this.major=Q,this.minor=H,this._context=re}lessThan(Q,H){return this.major<Q||Q===this.major&&this.minor<H}since(Q,H){return!this.lessThan(Q,H)}validate(Q){if(this.major!==Q.major)throw new x.Z((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:Q})}clone(){return new A(this.major,this.minor,this._context)}static parse(Q,H=""){const[re,J]=Q.split("."),W=/^\s*\d+\s*$/;if(!re||!re.match||!re.match(W))throw new x.Z((H&&H+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:Q});if(!J||!J.match||!J.match(W))throw new x.Z((H&&H+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:Q});const B=parseInt(re,10),Z=parseInt(J,10);return new A(B,Z,H)}}},14889:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>A});var x=T(90888);class A extends x.Z{constructor(Q,H,re){if(super(Q,H,re),!(this instanceof A))return new A(Q,H,re)}}A.prototype.type="warning"},31283:(dt,Re,T)=>{"use strict";T.d(Re,{M9:()=>Q,Wm:()=>J,kk:()=>G,s3:()=>A,x3:()=>H});var A,Z,x=T(62208);(Z=A||(A={}))[Z.DEFAULTS=0]="DEFAULTS",Z[Z.COMPUTED=1]="COMPUTED",Z[Z.SERVICE=2]="SERVICE",Z[Z.PORTAL_ITEM=3]="PORTAL_ITEM",Z[Z.WEB_SCENE=4]="WEB_SCENE",Z[Z.WEB_MAP=5]="WEB_MAP",Z[Z.USER=6]="USER";const G=A.USER+1;function Q(Z){switch(Z){case"defaults":return A.DEFAULTS;case"service":return A.SERVICE;case"portal-item":return A.PORTAL_ITEM;case"web-scene":return A.WEB_SCENE;case"web-map":return A.WEB_MAP;case"user":return A.USER}}function H(Z){switch(Z){case A.DEFAULTS:return"defaults";case A.SERVICE:return"service";case A.PORTAL_ITEM:return"portal-item";case A.WEB_SCENE:return"web-scene";case A.WEB_MAP:return"web-map";case A.USER:return"user"}return(0,x.j0)(void 0)}function J(Z){return H(Z)}},83960:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>A});var x=T(77712);function A(G,Q){const H=Q?yi(or({},Q),{source:G}):G;return(0,x.Cb)({aliasOf:H})}},66656:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>J});var x=T(90912),A=T(34117);const G=Object.prototype.toString;function Q(W){const B="__accessorMetadata__"in W?(0,x.se)(W):W;return function(...Z){if(Z.push(B),"number"==typeof Z[2])throw new Error("Using @cast has parameter decorator is not supported since 4.16");return H.apply(this,Z)}}function H(W,B,Z,ie){(0,A.VZ)(W,B).cast=ie}function J(...W){if(3!==W.length||"string"!=typeof W[1])return 1===W.length&&"[object Function]"===G.call(W[0])?Q(W[0]):1===W.length&&"string"==typeof W[0]?function re(W){return(B,Z)=>{(0,A.VZ)(B,W).cast=B[Z]}}(W[0]):void 0}},55342:(dt,Re,T)=>{"use strict";T.d(Re,{J:()=>G});var x=T(2076),A=T(77712);function G(Q,H={}){var W;const re=Q instanceof x.X?Q:new x.X(Q,H),J={type:null==(W=null==H?void 0:H.ignoreUnknown)||W?re.apiValues:String,json:{type:re.jsonValues,read:!(null==H?void 0:H.readOnly)&&{reader:re.read},write:{writer:re.write}}};return void 0!==(null==H?void 0:H.readOnly)&&(J.readOnly=!!H.readOnly),void 0!==(null==H?void 0:H.default)&&(J.json.default=H.default),void 0!==(null==H?void 0:H.name)&&(J.json.name=H.name),(0,A.Cb)(J)}},40405:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>j});var x=T(15861),A=T(62208),G=T(22558),Q=T(21726),H=T(35948),re=T(34117),J=T(31283),W=T(77712);function B(ge){return ue[function Z(ge){return ge instanceof Blob?ge.type:function ie(ge){const ye=(0,Q.Ml)(ge);return le[ye]||ce}(ge.url)}(ge)]||oe}const ue={},ce="text/plain",oe=ue[ce],le={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const ge in le)ue[le[ge]]=ge;var Y=T(29840);function j(ge){const ye=(0,A.pC)(ge)&&ge.origins?ge.origins:[void 0];return(Me,Ee)=>{const Te=function X(ge,ye,Me){if((0,A.pC)(ge)&&"resource"===ge.type)return function U(ge,ye,Me){const Ee=(0,re.VZ)(ye,Me);return{type:String,read:(Te,me,Ce)=>{const Ie=(0,Y.r)(Te,me,Ce);return Ee.type===String?Ie:"function"==typeof Ee.type?new Ee.type({url:Ie}):void 0},write:{writer(Te,me,Ce,Ie){if(!Ie||!Ie.resources)return"string"==typeof Te?void(me[Ce]=(0,Y.t)(Te,Ie)):void(me[Ce]=Te.write({},Ie));const Ge=function pe(ge){return(0,A.Wi)(ge)?null:"string"==typeof ge?ge:ge.url}(Te),Je=Ge?(0,Y.t)(Ge,yi(or({},Ie),{verifyItemRelativeUrls:Ie&&Ie.verifyItemRelativeUrls?{writtenUrls:Ie.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}),Y.M.NO):null,xe=Ee.type!==String&&(!(0,G.l)(this)||Ie&&Ie.origin&&this.originIdOf(Me)>(0,J.M9)(Ie.origin));Ie&&Ie.portalItem&&(0,A.pC)(Je)&&!(0,Q.YP)(Je)?xe?function $(ge,ye,Me,Ee,Te,me,Ce,Ie){const Ge=Ce.portalItem.resourceFromPath(Ee),Je=ae(Me,Ee,Ce);B(Je)===(0,Q.Ml)(Ge.path)?(se(ge,ye,Ge,Je,Ce.resources.toUpdate),Te[me]=Ee):ee(ge,ye,Me,Ee,Te,me,Ce,Ie)}(this,Me,Te,Je,me,Ce,Ie,ge):function ne(ge,ye,Me,Ee){Ee.resources.toKeep.push({resource:Ee.portalItem.resourceFromPath(ge)}),ye[Me]=ge}(Je,me,Ce,Ie):Ie&&Ie.portalItem&&((0,A.Wi)(Je)||(0,A.pC)((0,Y.i)(Je))||(0,Q.jc)(Je)||xe)?ee(this,Me,Te,Je,me,Ce,Ie,ge):me[Ce]=Je}}}}(ge,ye,Me);switch((0,A.pC)(ge)&&ge.type?ge.type:"other"){case"other":return{read:!0,write:!0};case"url":{const{read:Ee,write:Te}=Y.p;return{read:Ee,write:Te}}}}(ge,Me,Ee);for(const me of ye){const Ce=(0,W.CJ)(Me,me,Ee);for(const Ie in Te)Ce[Ie]=Te[Ie]}}}function ee(ge,ye,Me,Ee,Te,me,Ce,Ie){const Ge=(0,H.D)(),Je=ae(Me,Ee,Ce),xe=(0,Q.v_)((0,A.U2)(Ie,"prefix"),Ge),je=`${xe}.${B(Je)}`,We=Ce.portalItem.resourceFromPath(je);(0,Q.jc)(Ee)&&Ce.resources.pendingOperations.push(function de(ge){return _e.apply(this,arguments)}(Ee).then(Ne=>{We.path=`${xe}.${B(Ne)}`,Te[me]=We.itemRelativeUrl}).catch(()=>{})),se(ge,ye,We,Je,Ce.resources.toAdd),Te[me]=We.itemRelativeUrl}function se(ge,ye,Me,Ee,Te){Te.push({resource:Me,content:Ee,finish:me=>{!function he(ge,ye,Me){"string"==typeof ge[ye]?ge[ye]=Me.url:ge[ye].url=Me.url}(ge,ye,me)}})}function ae(ge,ye,Me){return"string"==typeof ge?{url:ye}:new Blob([JSON.stringify(ge.toJSON(Me))],{type:"application/json"})}function _e(){return(_e=(0,x.Z)(function*(ge){const ye=(yield Promise.resolve().then(T.bind(T,84792))).default,{data:Me}=yield ye(ge,{responseType:"blob"});return Me})).apply(this,arguments)}},77712:(dt,Re,T)=>{"use strict";T.d(Re,{CJ:()=>J,Cb:()=>re,Eg:()=>B});var x=T(63290),A=T(90912),G=T(34595),Q=T(34117),H=T(82255);function re(Z={}){return(ie,ue)=>{if(ie===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${ie.name}.${ue}. Accessor does not support static properties.`);const ce=Object.getOwnPropertyDescriptor(ie,ue),oe=(0,Q.VZ)(ie,ue);ce&&(ce.get||ce.set?(oe.get=ce.get||oe.get,oe.set=ce.set||oe.set):"value"in ce&&("value"in Z&&x.Z.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${ue}" on "${ie.constructor.name}" already defined in the metadata`,Z),oe.value=Z.value=ce.value)),null!=Z.readOnly&&(oe.readOnly=Z.readOnly);const le=Z.aliasOf;if(le){const X="string"==typeof le?le:le.source,U="string"==typeof le?null:!0===le.overridable;let ee;oe.dependsOn=[X],oe.get=function(){let $=(0,G.U2)(this,X);if("function"==typeof $){ee||(ee=X.split(".").slice(0,-1).join("."));const ne=(0,G.U2)(this,ee);ne&&($=$.bind(ne))}return $},oe.readOnly||(oe.set=U?function($){void 0!==$?this._override(ue,$):this._clearOverride(ue)}:function($){(0,H.t)(this,X,$)})}const Y=Z.type,j=Z.types;oe.cast||(Y?oe.cast=function W(Z){let ie=0,ue=Z;if((0,A.AY)(Z))return(0,A.sY)(Z);for(;Array.isArray(ue)&&1===ue.length&&"string"!=typeof ue[0]&&"number"!=typeof ue[0];)ue=ue[0],ie++;const ce=ue;if((0,A.gB)(ce))return 0===ie?(0,A.i$)(ce):(0,A.Iu)((0,A.i$)(ce),ie);if(1===ie)return(0,A.rY)(ce);if(ie>1)return(0,A.di)(ce,ie);return Z.from?Z.from:(0,A.se)(Z)}(Y):j&&(oe.cast=Array.isArray(j)?(0,A.Ls)((0,A.N7)(j[0])):(0,A.N7)(j))),Z.range&&(oe.cast=B(oe.cast,Z.range)),(0,Q.tz)(oe,Z)}}function J(Z,ie,ue){const ce=(0,Q.VZ)(Z,ue);ce.json||(ce.json={});let oe=ce.json;return void 0!==ie&&(oe.origins||(oe.origins={}),oe.origins[ie]||(oe.origins[ie]={}),oe=oe.origins[ie]),oe}function B(Z,ie){return ue=>{let ce=+Z(ue);return null!=ie.step&&(ce=Math.round(ce/ie.step)*ie.step),null!=ie.min&&(ce=Math.max(ie.min,ce)),null!=ie.max&&(ce=Math.min(ie.max,ce)),ce}}},68653:(dt,Re,T)=>{"use strict";T.d(Re,{r:()=>A});var x=T(77712);function A(G,Q,H){let re,J;return void 0===Q||Array.isArray(Q)?(J=G,H=Q,re=[void 0]):(J=Q,re=Array.isArray(G)?G:[G]),(W,B)=>{const Z=W.constructor.prototype;re.forEach(ie=>{const ue=(0,x.CJ)(W,ie,J);ue.read&&"object"==typeof ue.read||(ue.read={}),ue.read.reader=Z[B],H&&(ue.read.source=(ue.read.source||[]).concat(H))})}}},61039:(dt,Re,T)=>{"use strict";function x(A){return(G,Q)=>{G[Q]=A}}T.d(Re,{c:()=>x})},76898:(dt,Re,T)=>{"use strict";T.d(Re,{j:()=>W}),T(8314);var A=T(44648),G=T(34117),Q=T(36082),H=T(33794);const re=new Set,J=new Set;function W(ie){return ue=>{ue.prototype.declaredClass=ie,function Z(ie){const ce=(0,G.JT)(ie.prototype).properties,oe={};for(const le of Object.getOwnPropertyNames(ce)){const Y=ce[le];(0,H.OM)(Y),oe[le]={enumerable:!0,configurable:!0,get:B(le,Y),set(j){const X=this.__accessor__;if(void 0!==X){if(!Object.isFrozen(this)){if(X.initialized&&Y.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${le}' of ${this.declaredClass}`);if(X.lifecycle===A.F.CONSTRUCTED&&Y.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${le}' of ${this.declaredClass}`);X.set(le,j)}}else Object.defineProperty(this,le,{enumerable:!0,configurable:!0,writable:!0,value:j})}}}Object.defineProperties(ie.prototype,oe)}(ue);const ce=[],oe=[];let le=ue.prototype;for(;le;)le.hasOwnProperty("initialize")&&!re.has(le.initialize)&&(re.add(le.initialize),ce.push(le.initialize)),le.hasOwnProperty("destroy")&&!J.has(le.destroy)&&(J.add(le.destroy),oe.push(le.destroy)),le=Object.getPrototypeOf(le);re.clear(),J.clear();class Y extends ue{constructor(...X){if(super(...X),this.constructor===Y&&"function"==typeof this.postscript){if(ce.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let U=ce.length-1;U>=0;U--)ce[U].call(this)}}),oe.length){let U=!1;Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!U){U=!0;for(let ee=0;ee<oe.length;ee++)oe[ee].call(this)}}})}this.postscript(...X)}}}return Y.__accessorMetadata__=(0,G.JT)(ue.prototype),Y.prototype.declaredClass=ie,Y}}function B(ie,ue){return null==ue.get?function(){const ce=this.__accessor__.properties.get(ie);if(void 0===ce)return;(0,Q.it)(ce);const oe=this.__accessor__.store;return oe.has(ie)?oe.get(ie):ce.metadata.value}:function(){const ce=this.__accessor__.properties.get(ie);if(void 0!==ce)return ce.getComputed()}}},99433:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>A});var x=T(77712);function A(G,Q,H){let re,J;return void 0===Q?(J=G,re=[void 0]):"string"!=typeof Q?(J=G,re=[void 0],H=Q):(J=Q,re=Array.isArray(G)?G:[G]),(W,B)=>{const Z=W.constructor.prototype;for(const ie of re){const ue=(0,x.CJ)(W,ie,J);ue.write&&"object"==typeof ue.write||(ue.write={}),H&&(ue.write.target=H),ue.write.writer=Z[B]}}}},12590:(dt,Re,T)=>{"use strict";T.d(Re,{M:()=>A});var x=T(31283);function A(G,Q,H){Q.keys().forEach(J=>{H.set(J,Q.get(J),x.s3.DEFAULTS)}),Object.keys(G.metadatas).forEach(J=>{G.internalGet(J)&&H.set(J,G.internalGet(J),x.s3.DEFAULTS)})}},84682:(dt,Re,T)=>{"use strict";T.d(Re,{Hg:()=>oe,V7:()=>ce,uD:()=>ue,xb:()=>le});var x=T(14517),A=T(46160),G=T(62208),Q=T(52323);const H=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function re(Y){return Y instanceof x.Z}function J(Y){return Y instanceof A.Z?Object.keys(Y.items):re(Y)?(0,Q.vw)(Y).keys():Y?Object.keys(Y):[]}function W(Y,j){return Y instanceof A.Z?Y.items[j]:Y[j]}function Z(Y){return Y?Y.declaredClass:null}function ie(Y,j){const X=Y.diff;if(X&&"function"==typeof X)return X(Y,j);const U=J(Y),ee=J(j);if(0===U.length&&0===ee.length)return;if(!U.length||!ee.length||function B(Y,j){return!(!Array.isArray(Y)||!Array.isArray(j))&&Y.length!==j.length}(Y,j))return{type:"complete",oldValue:Y,newValue:j};const $=ee.filter(pe=>!U.includes(pe)),ne=U.filter(pe=>!ee.includes(pe)),se=U.filter(pe=>ee.includes(pe)&&W(Y,pe)!==W(j,pe)).concat($,ne).sort(),ae=Z(Y);if(ae&&H.includes(ae)&&se.length)return{type:"complete",oldValue:Y,newValue:j};let de;const _e=re(Y)&&re(j);for(const pe of se){const he=W(Y,pe),ge=W(j,pe);let ye;if((_e||"function"!=typeof he&&"function"!=typeof ge)&&he!==ge&&(null!=he||null!=ge)){if(X&&X[pe]&&"function"==typeof X[pe])ye=X[pe](he,ge);else if(he instanceof Date&&ge instanceof Date){if(he.getTime()===ge.getTime())continue;ye={type:"complete",oldValue:he,newValue:ge}}else ye="object"==typeof he&&"object"==typeof ge&&Z(he)===Z(ge)?ie(he,ge):{type:"complete",oldValue:he,newValue:ge};(0,G.pC)(ye)&&((0,G.pC)(de)?de.diff[pe]=ye:de={type:"partial",diff:{[pe]:ye}})}}return de}function ue(Y,j){if((0,G.Wi)(Y))return!1;const X=j.split(".");let U=Y;for(const ee of X){if("complete"===U.type)return!0;if("partial"!==U.type)return!1;{const $=U.diff[ee];if(!$)return!1;U=$}}return!0}function ce(Y,j){for(const X of j)if(ue(Y,X))return!0;return!1}function oe(Y,j){if(!("function"==typeof Y||"function"==typeof j||(0,G.Wi)(Y)&&(0,G.Wi)(j)))return(0,G.Wi)(Y)||(0,G.Wi)(j)||"object"==typeof Y&&"object"==typeof j&&Z(Y)!==Z(j)?{type:"complete",oldValue:Y,newValue:j}:ie(Y,j)}function le(Y){if((0,G.Wi)(Y))return!0;switch(Y.type){case"complete":return!1;case"collection":{const j=Y;for(const X of j.added)if(!le(X))return!1;for(const X of j.removed)if(!le(X))return!1;for(const X of j.changed)if(!le(X))return!1;return!0}case"partial":for(const j in Y.diff)if(!le(Y.diff[j]))return!1;return!0}}},90912:(dt,Re,T)=>{"use strict";T.d(Re,{AY:()=>Me,Iu:()=>ae,Ls:()=>$,N7:()=>he,TJ:()=>Y,V5:()=>ye,Zs:()=>J,di:()=>de,gB:()=>_e,i$:()=>pe,q9:()=>W,rY:()=>ne,sY:()=>Ee,se:()=>ee,vU:()=>B,z8:()=>ge}),T(8314);var A=T(63290),G=T(88159);const Q=A.Z.getLogger("esri.core.Accessor");function H(Ie){return null==Ie?Ie:new Date(Ie)}function re(Ie){return null==Ie?Ie:!!Ie}function J(Ie){return null==Ie?Ie:Ie.toString()}function W(Ie){return null==Ie?Ie:(Ie=parseFloat(Ie),isNaN(Ie)?0:Ie)}function B(Ie){return null==Ie?Ie:Math.round(parseFloat(Ie))}function Z(Ie){return Ie&&Ie.constructor&&void 0!==Ie.constructor.__accessorMetadata__}function ie(Ie,Ge){return null!=Ge&&Ie&&!(Ge instanceof Ie)}function ue(Ie){return Ie&&"isCollection"in Ie}function ce(Ie){return Ie&&Ie.Type?"function"==typeof Ie.Type?Ie.Type:Ie.Type.base:null}function le(Ie,Ge){return!!Z(Ge)&&(Q.error("Accessor#set","Assigning an instance of '"+(Ge.declaredClass||"unknown")+"' which is not a subclass of '"+j(Ie)+"'"),!0)}function Y(Ie,Ge){return null==Ge?Ge:ue(Ie)?function oe(Ie,Ge){if(!Ge||!Ge.constructor||!ue(Ge.constructor))return le(Ie,Ge)?Ge:new Ie(Ge);const Je=ce(Ie.prototype.itemType),xe=ce(Ge.constructor.prototype.itemType);return Je?xe?Je===xe?Ge:Je.prototype.isPrototypeOf(xe.prototype)?new Ie(Ge):(le(Ie,Ge),Ge):new Ie(Ge):Ge}(Ie,Ge):ie(Ie,Ge)?le(Ie,Ge)?Ge:new Ie(Ge):Ge}function j(Ie){return Ie&&Ie.prototype&&Ie.prototype.declaredClass||"unknown"}const X=new WeakMap;function U(Ie){switch(Ie){case Number:return W;case ge:return B;case Boolean:return re;case String:return J;case Date:return H;default:return(0,G.s1)(X,Ie,()=>Y.bind(null,Ie))}}function ee(Ie,Ge){const Je=U(Ie);return 1===arguments.length?Je:Je(Ge)}function $(Ie,Ge,Je){return 1===arguments.length?$.bind(null,Ie):Ge&&(Array.isArray(Ge)?Ge.map(xe=>Ie(xe,Je)):[Ie(Ge,Je)])}function ne(Ie,Ge){return 1===arguments.length?$(ee.bind(null,Ie)):$(ee.bind(null,Ie),Ge)}function se(Ie,Ge,Je){return 0!==Ge&&Array.isArray(Je)?Je.map(xe=>se(Ie,Ge-1,xe)):Ie(Je)}function ae(Ie,Ge,Je){if(2===arguments.length)return ae.bind(null,Ie,Ge);if(!Je)return Je;let xe=Ge,je=Je=se(Ie,Ge,Je);for(;xe>0&&Array.isArray(je);)xe--,je=je[0];if(void 0!==je)for(let We=0;We<xe;We++)Je=[Je];return Je}function de(Ie,Ge,Je){return 2===arguments.length?ae(ee.bind(null,Ie),Ge):ae(ee.bind(null,Ie),Ge,Je)}function _e(Ie){return!!Array.isArray(Ie)&&!Ie.some(Ge=>{const Je=typeof Ge;return!("string"===Je||"number"===Je||"function"===Je&&Ie.length>1)})}function pe(Ie,Ge){if(2===arguments.length)return pe(Ie).call(null,Ge);const Je=new Set,xe=Ie.filter(we=>"function"!=typeof we),je=Ie.filter(we=>"function"==typeof we);for(const we of Ie)"string"!=typeof we&&"number"!=typeof we||Je.add(we);let We=null,Ne=null;return(we,Oe)=>{if(null==we)return we;const $e=typeof we,Be="string"===$e||"number"===$e;return Be&&(Je.has(we)||je.some(Se=>"string"===$e&&Se===String||"number"===$e&&Se===Number))||"object"===$e&&je.some(Se=>!ie(we,Se))?we:(Be&&xe.length?(We||(We=xe.map(Se=>"string"==typeof Se?`'${Se}'`:`${Se}`).join(", ")),Q.error("Accessor#set",`'${we}' is not a valid value for this property, only the following values are valid: ${We}`)):"object"==typeof we&&je.length?(Ne||(Ne=je.map(Se=>j(Se)).join(", ")),Q.error("Accessor#set",`'${we}' is not a valid value for this property, value must be one of ${Ne}`)):Q.error("Accessor#set",`'${we}' is not a valid value for this property`),Oe&&(Oe.valid=!1),null)}}function he(Ie,Ge){if(2===arguments.length)return he(Ie).call(null,Ge);const Je={},xe=[],je=[];for(const Oe in Ie.typeMap){const $e=Ie.typeMap[Oe];Je[Oe]=ee($e),xe.push(j($e)),je.push(Oe)}const We=()=>`'${xe.join("', '")}'`,Ne=()=>`'${je.join("', '")}'`,we="string"==typeof Ie.key?Oe=>Oe[Ie.key]:Ie.key;return Oe=>{if(Ie.base&&!ie(Ie.base,Oe)||null==Oe)return Oe;const $e=we(Oe)||Ie.defaultKeyValue,Be=Je[$e];if(!Be)return Q.error("Accessor#set",`Invalid property value, value needs to be one of ${We()}, or a plain object that can autocast (having .type = ${Ne()})`),null;if(!ie(Ie.typeMap[$e],Oe))return Oe;if("string"==typeof Ie.key&&!Z(Oe)){const Se={};for(const De in Oe)De!==Ie.key&&(Se[De]=Oe[De]);return Be(Se)}return Be(Oe)}}class ge{}const ye={native:Ie=>({type:"native",value:Ie}),array:Ie=>({type:"array",value:Ie}),oneOf:Ie=>({type:"one-of",values:Ie})};function Me(Ie){if(!Ie||!("type"in Ie))return!1;switch(Ie.type){case"native":case"array":case"one-of":return!0}return!1}function Ee(Ie){switch(Ie.type){case"native":return ee(Ie.value);case"array":return $(Ee(Ie.value));case"one-of":return function Te(Ie){let Ge=null;return(Je,xe)=>Ce(Je,Ie)?Je:(null==Ge&&(Ge=me(Ie)),Q.error("Accessor#set",`Invalid property value, value needs to be of type ${Ge}`),xe&&(xe.valid=!1),null)}(Ie);default:return null}}function me(Ie){switch(Ie.type){case"native":switch(Ie.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case ge:return"integer";case Date:return"date";default:return j(Ie.value)}case"array":return`array of ${me(Ie.value)}`;case"one-of":{const Ge=Ie.values.map(Je=>me(Je));return`one of ${Ge.slice(0,Ge.length-1)} or ${Ge[Ge.length-1]}`}}return"unknown"}function Ce(Ie,Ge){if(null==Ie)return!0;switch(Ge.type){case"native":switch(Ge.value){case Number:case ge:return"number"==typeof Ie;case Boolean:return"boolean"==typeof Ie;case String:return"string"==typeof Ie}return Ie instanceof Ge.value;case"array":return!!Array.isArray(Ie)&&!Ie.some(Je=>!Ce(Je,Ge.value));case"one-of":return Ge.values.some(Je=>Ce(Ie,Je))}}},33794:(dt,Re,T)=>{"use strict";T.d(Re,{hk:()=>ie,HS:()=>B,Ah:()=>Z,OM:()=>j});var x=T(90912),G=T(383);function H(X){X.name&&(X.read&&"object"==typeof X.read?void 0===X.read.source&&(X.read.source=X.name):X.read={source:X.name},X.write&&"object"==typeof X.write?void 0===X.write.target&&(X.write.target=X.name):X.write={target:X.name})}function re(X){"boolean"==typeof X.read?X.read={enabled:X.read}:"function"==typeof X.read?X.read={enabled:!0,reader:X.read}:X.read&&"object"==typeof X.read&&void 0===X.read.enabled&&(X.read.enabled=!0)}function J(X){"boolean"==typeof X.write?X.write={enabled:X.write}:"function"==typeof X.write?X.write={enabled:!0,writer:X.write}:X.write&&"object"==typeof X.write&&void 0===X.write.enabled&&(X.write.enabled=!0)}var W=T(23025);function B(X,U){return ie(X,"read",U)}function Z(X,U){return ie(X,"write",U)}function ie(X,U,ee){let $=X&&X.json;if(X&&X.json&&X.json.origins&&ee){const ne=X.json.origins[ee.origin];ne&&("any"===U||U in ne)&&($=ne)}return $}function oe(X){return X.type?le(X):Y(X)}function le(X){if(!X.type)return;let U=0,ee=X.type;for(;Array.isArray(ee)&&!(0,x.gB)(ee);)ee=ee[0],U++;return{type:ee,ndimArray:U}}function Y(X){if(!X.types)return;let U=0,ee=X.types;for(;Array.isArray(ee);)ee=ee[0],U++;return{types:ee,ndimArray:U}}function j(X){(function Q(X){if(X.json||(X.json={}),re(X.json),J(X.json),H(X.json),X.json.origins)for(const U in X.json.origins)re(X.json.origins[U]),J(X.json.origins[U]),H(X.json.origins[U]);return!0})(X)&&(function A(X){if(X.json&&X.json.origins){const U=X.json.origins,ee={"web-document":["web-scene","web-map"]};for(const $ in ee)if(U[$]){const ne=U[$];ee[$].forEach(se=>{U[se]=ne}),delete U[$]}}}(X),function ue(X){const U=function ce(X){return X.json.types?Y(X.json):X.type?le(X):Y(X)}(X);if(X.json.origins)for(const ee in X.json.origins){const $=X.json.origins[ee],ne=$.types?oe($):U;(0,G.U)(ne,$,!1),$.types&&!$.write&&X.json.write&&X.json.write.enabled&&($.write=or({},X.json.write)),(0,W.U)(ne,$)}(0,G.U)(U,X.json,!0),(0,W.U)(U,X.json)}(X))}},383:(dt,Re,T)=>{"use strict";T.d(Re,{U:()=>J,d:()=>W});var x=T(63290),A=T(94113),G=T(14889),Q=T(34117),H=T(94056);const re=x.Z.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function J(ee,$,ne){var se,ae;ee&&(!ne&&!$.read||(null==(se=$.read)?void 0:se.reader)||!1===(null==(ae=$.read)?void 0:ae.enabled)||function le(ee){return"types"in ee?j(ee.types):Y(ee.type)}(ee)&&(0,A.RB)("read.reader",W(ee),$))}function W(ee){var ne,se,ae;const $=null!=(ne=ee.ndimArray)?ne:0;if($>1)return function ue(ee){var ae;const $=B(ee),ne=ie.bind(null,$),se=null!=(ae=ee.ndimArray)?ae:0;return(de,_e,pe)=>{if(null==de)return de;de=ne(de,pe,se);let he=se,ge=de;for(;he>0&&Array.isArray(ge);)he--,ge=ge[0];if(void 0!==ge)for(let ye=0;ye<he;ye++)de=[de];return de}}(ee);if(1===$)return ce(ee);if("type"in ee&&oe(ee.type)){const de=null==(ae=null==(se=ee.type.prototype)?void 0:se.itemType)?void 0:ae.Type,_e=ce("function"==typeof de?{type:de}:{types:de});return(pe,he,ge)=>{const ye=_e(pe,he,ge);return ye&&new ee.type(ye)}}return B(ee)}function B(ee){return"type"in ee?function Z(ee){return ee.prototype.read?($,ne,se)=>{if(null==$)return $;const ae=typeof $;if("object"!==ae)return void re.error(`Expected JSON value of type 'object' to deserialize type '${ee.prototype.declaredClass}', but got '${ae}'`);const de=new ee;return de.read($,se),de}:ee.fromJSON}(ee.type):function X(ee){var se;let $=null;const ne=null!=(se=ee.errorContext)?se:"type";return(ae,de,_e)=>{if(null==ae)return ae;const pe=typeof ae;if("object"!==pe)return void re.error(`Expected JSON value of type 'object' to deserialize, but got '${pe}'`);$||($=function U(ee){var ne,se;const $={};for(const ae in ee.typeMap){const de=ee.typeMap[ae],_e=(0,Q.JT)(de.prototype);if("function"==typeof ee.key)continue;const pe=_e.properties[ee.key];if(!pe)continue;(null==(ne=pe.json)?void 0:ne.type)&&Array.isArray(pe.json.type)&&1===pe.json.type.length&&"string"==typeof pe.json.type[0]&&($[pe.json.type[0]]=de);const he=null==(se=pe.json)?void 0:se.write;if(!he||!he.writer){$[ae]=de;continue}const ge=he.target,ye="string"==typeof ge?ge:ee.key,Me={};he.writer(ae,Me,ye),Me[ye]&&($[Me[ye]]=de)}return $}(ee));const he=ee.key;if("string"!=typeof he)return;const ge=ae[he],ye=ge?$[ge]:ee.defaultKeyValue?ee.typeMap[ee.defaultKeyValue]:void 0;if(!ye){const Ee=`Type '${ge||"unknown"}' is not supported`;return _e&&_e.messages&&ae&&_e.messages.push(new G.Z(`${ne}:unsupported`,Ee,{definition:ae,context:_e})),void re.error(Ee)}const Me=new ye;return Me.read(ae,_e),Me}}(ee.types)}function ie(ee,$,ne,se){return 0!==se&&Array.isArray($)?$.map(ae=>ie(ee,ae,ne,se-1)):ee($,void 0,ne)}function ce(ee){const $=B(ee);return(ne,se,ae)=>{if(null==ne)return ne;if(Array.isArray(ne)){const _e=[];for(const pe of ne){const he=$(pe,void 0,ae);void 0!==he&&_e.push(he)}return _e}const de=$(ne,void 0,ae);return void 0!==de?[de]:void 0}}function oe(ee){if(!(0,H.u)(ee))return!1;const $=ee.prototype.itemType;return!(!$||!$.Type)&&("function"==typeof $.Type?Y($.Type):j($.Type))}function Y(ee){return!Array.isArray(ee)&&!!ee&&ee.prototype&&("read"in ee.prototype||"fromJSON"in ee||oe(ee))}function j(ee){for(const $ in ee.typeMap)if(!Y(ee.typeMap[$]))return!1;return!0}},94056:(dt,Re,T)=>{"use strict";function x(A){return!!A&&A.prototype&&A.prototype.declaredClass&&0===A.prototype.declaredClass.indexOf("esri.core.Collection")}T.d(Re,{u:()=>x})},23025:(dt,Re,T)=>{"use strict";T.d(Re,{U:()=>re,k:()=>ue});var x=T(26584),A=T(63290),G=T(94113),Q=T(94056);const H=A.Z.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer");function re(Y,j){var U;if(!j.write||j.write.writer||!1===j.write.enabled&&!j.write.overridePolicy)return;const X=null!=(U=null==Y?void 0:Y.ndimArray)?U:0;j.write.writer=Y&&(1===X||"type"in Y&&(0,Q.u)(Y.type))?ce:X>1?function le(Y){return(j,X,U,ee)=>{let $;if(null===j)$=null;else{$=oe(j,ee,Y);let ne=Y,se=$;for(;ne>0&&Array.isArray(se);)ne--,se=se[0];if(void 0!==se)for(let ae=0;ae<ne;ae++)$=[$]}(0,G.RB)(U,$,X)}}(X):j.types?Array.isArray(j.types)?function B(Y){return(j,X,U,ee)=>j&&Array.isArray(j)?Z(j.filter($=>W($,Y,ee)),X,U,ee):Z(j,X,U,ee)}(j.types[0]):function J(Y){return(j,X,U,ee)=>j?W(j,Y,ee)?Z(j,X,U,ee):void 0:Z(j,X,U,ee)}(j.types):Z}function W(Y,j,X){var U,ee;for(const $ in j.typeMap)if(Y instanceof j.typeMap[$])return!0;if(null==X?void 0:X.messages){const $=null!=(U=j.errorContext)?U:"type",ne=`Values of type '${null!=(ee="function"!=typeof j.key?Y[j.key]:Y.declaredClass)?ee:"Unknown"}' cannot be written`;X&&X.messages&&Y&&X.messages.push(new x.Z(`${$}:unsupported`,ne,{definition:Y,context:X})),H.error(ne)}return!1}function Z(Y,j,X,U){(0,G.RB)(X,ie(Y,U),j)}function ie(Y,j){return Y&&"function"==typeof Y.write?Y.write({},j):Y&&"function"==typeof Y.toJSON?Y.toJSON():"number"==typeof Y?ue(Y):Y}function ue(Y){return Y===-1/0?-Number.MAX_VALUE:Y===1/0?Number.MAX_VALUE:isNaN(Y)?null:Y}function ce(Y,j,X,U){let ee;null===Y?ee=null:Y&&"function"==typeof Y.map?(ee=Y.map($=>ie($,U)),"function"==typeof ee.toArray&&(ee=ee.toArray())):ee=[ie(Y,U)],(0,G.RB)(X,ee,j)}function oe(Y,j,X){return 0!==X&&Array.isArray(Y)?Y.map(U=>oe(U,j,X-1)):ie(Y,j)}},34595:(dt,Re,T)=>{"use strict";T.d(Re,{$z:()=>Q,Gg:()=>re,U2:()=>H});var x=T(52323);function A(J,W){const B="?"===J[J.length-1]?J.slice(0,-1):J;if(null!=W.getItemAt||Array.isArray(W)){const ie=parseInt(B,10);if(!isNaN(ie))return Array.isArray(W)?W[ie]:W.getItemAt(ie)}const Z=(0,x.vw)(W);return(0,x.b6)(Z,B)?Z.get(B):W[B]}function G(J,W,B){if(null==J)return J;const Z=A(W[B],J);return!Z&&B<W.length-1?void 0:B===W.length-1?Z:G(Z,W,B+1)}function Q(J,W,B=0){return"string"!=typeof W||W.includes(".")?G(J,(0,x.NI)(W),B):A(W,J)}function H(J,W){return Q(J,W)}function re(J,W){return void 0!==Q(W,J)}},44648:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{F:()=>x}),(A=x||(x={}))[A.INITIALIZING=0]="INITIALIZING",A[A.CONSTRUCTING=1]="CONSTRUCTING",A[A.CONSTRUCTED=2]="CONSTRUCTED"},34117:(dt,Re,T)=>{"use strict";T.d(Re,{JT:()=>H,VZ:()=>J,tz:()=>Z});var x=T(58817),A=T(62208),G=T(52323);class Q{constructor(Y){this.autoDestroy=!1,this.properties=Y}}function H(le){let Y=le.constructor.__accessorMetadata__;const j=Object.prototype.hasOwnProperty.call(le.constructor,"__accessorMetadata__");if(Y){if(!j){const X=Object.create(Y.properties),U=Y.autoDestroy;for(const ee in X)X[ee]=(0,x.d9)(X[ee]);Y=new Q(X),Y.autoDestroy=U,Object.defineProperty(le.constructor,"__accessorMetadata__",{value:Y,enumerable:!1,configurable:!0,writable:!0})}}else Y=new Q({}),Object.defineProperty(le.constructor,"__accessorMetadata__",{value:Y,enumerable:!1,configurable:!0,writable:!0});return(0,A.j0)(le.constructor.__accessorMetadata__)}function J(le,Y){const j=function re(le){return H(le).properties}(le);let X=j[Y];return X||(X=j[Y]={}),X}function Z(le,Y){return(0,G.TS)(le,Y,ue)}const ie=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function ue(le){return ie.test(le)?"replace":"merge"}},52489:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>A});var x=T(22558);function A(G){G&&G.writtenProperties&&G.writtenProperties.forEach(({target:Q,propName:H,newOrigin:re})=>{(0,x.l)(Q)&&re&&Q.originOf(H)!==re&&Q.updateOrigin(H,re)})}},29338:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>Z,i:()=>B});var x=T(34595),A=T(52323),G=T(33794);function Q(ie,ue,ce){if(!ie||!ie.read||!1===ie.read.enabled||!ie.read.source)return!1;const oe=ie.read.source;if("string"==typeof oe){if(oe===ue||oe.includes(".")&&0===oe.indexOf(ue)&&(0,x.Gg)(oe,ce))return!0}else for(const le of oe)if(le===ue||le.includes(".")&&0===le.indexOf(ue)&&(0,x.Gg)(le,ce))return!0;return!1}function re(ie,ue,ce,oe,le){let Y=(0,G.HS)(ue[ce],le);(function H(ie){return ie&&(!ie.read||!1!==ie.read.enabled&&!ie.read.source)})(Y)&&(ie[ce]=!0);for(const j of Object.getOwnPropertyNames(ue))Y=(0,G.HS)(ue[j],le),Q(Y,ce,oe)&&(ie[j]=!0)}function J(ie,ue,ce,oe){const Y=(0,G.hk)(ce.metadatas[ue],"any",oe),j=Y&&Y.default;if(void 0===j)return;const X="function"==typeof j?j.call(ie,ue,oe):j;void 0!==X&&ce.set(ue,X)}const W={origin:"service"};function B(ie,ue,ce=W){if(!ue||"object"!=typeof ue)return;const oe=(0,A.vw)(ie),le=oe.metadatas,Y={};for(const j of Object.getOwnPropertyNames(ue))re(Y,le,j,ue,ce);oe.setDefaultOrigin(ce.origin);for(const j of Object.getOwnPropertyNames(Y)){const X=(0,G.HS)(le[j],ce).read,U=X&&X.source;let ee;ee=U&&"string"==typeof U?(0,x.$z)(ue,U):ue[j],X&&X.reader&&(ee=X.reader.call(ie,ee,ue,ce)),void 0!==ee&&oe.set(j,ee)}if(!ce||!ce.ignoreDefaults){oe.setDefaultOrigin("defaults");for(const j of Object.getOwnPropertyNames(le))Y[j]||J(ie,j,oe,ce)}oe.setDefaultOrigin("user")}function Z(ie,ue,ce,oe=W){var Y;const le=yi(or({},oe),{messages:[]});ce(le),null==(Y=le.messages)||Y.forEach(j=>{"warning"!==j.type||ie.loaded?oe&&oe.messages&&oe.messages.push(j):ie.loadWarnings.push(j)})}},82255:(dt,Re,T)=>{"use strict";T.d(Re,{t:()=>H});var x=T(26584),A=T(8314),G=T(63290),Q=T(34595);function H(B,Z,ie){if(B&&Z)if("object"==typeof Z)for(const ue of Object.getOwnPropertyNames(Z))H(B,ue,Z[ue]);else{if(Z.includes(".")){const ce=Z.split("."),oe=ce.splice(ce.length-1,1)[0];return void H((0,Q.U2)(B,ce),oe,ie)}const ue=B.__accessor__;null!=ue&&function re(B,Z){if((0,A.Z)("esri-unknown-property-errors")&&!function J(B,Z){return null!=Z.metadatas[B]}(B,Z))throw new x.Z("set:unknown-property",function W(B,Z){return"setting unknown property '"+B+"' on instance of "+Z.host.declaredClass}(B,Z))}(Z,ue),B[Z]=ie}}G.Z.getLogger("esri.core.accessorSupport.set")},36082:(dt,Re,T)=>{"use strict";T.d(Re,{GF:()=>U,LJ:()=>ue,gb:()=>ce,it:()=>B,mS:()=>j}),T(8314);var A=T(63290),G=T(52323),Q=T(2345);let H,re=[];const J=A.Z.getLogger("esri.core.Accessor");function B($){void 0!==H&&H.onObservableAccessed($)}let Z=!1,ie=!1;function ue($,ne,se){if(Z)return oe($,ne,se);le($);const ae=ne.call(se);return Y(),ae}function ce($,ne){return ue(void 0,$,ne)}function oe($,ne,se){const ae=Z;Z=!0,le($);let de=null;try{de=ne.call(se)}catch(_e){ie&&J.error(_e)}return Y(),Z=ae,de}function le($){H=$,re.push($)}function Y(){const $=re.pop();H=re.length>0?re[re.length-1]:void 0,void 0!==$&&$.onTrackingEnd()}function j($,ne){if(ne.flags&Q.v.DepTrackingInitialized)return;const se=ie;ie=!1,ne.flags&Q.v.AutoTracked?oe(ne,ne.metadata.get,$):U($,ne),ie=se}const X=[];function U($,ne){ne.flags&Q.v.ExplicitlyTracking||(ne.flags|=Q.v.ExplicitlyTracking,oe(ne,()=>{const se=ne.metadata.dependsOn||X;for(const ae of se)if("string"!=typeof ae||ae.includes(".")){const de=(0,G.NI)(ae);for(let _e=0,pe=$;_e<de.length&&null!=pe&&"object"==typeof pe;++_e)pe=ee(pe,de[_e],_e!==de.length-1)}else ee($,ae,!1)}),ne.flags&=~Q.v.ExplicitlyTracking)}function ee($,ne,se){var _e;const ae="?"===ne[ne.length-1]?ne.slice(0,-1):ne;if(null!=$.getItemAt||Array.isArray($)){const pe=parseInt(ae,10);if(!isNaN(pe))return Array.isArray($)?$[pe]:$.getItemAt(pe)}const de=null==(_e=(0,G.vw)($))?void 0:_e.properties.get(ae);return de&&(B(de),j($,de)),se?$[ae]:void 0}},21352:(dt,Re,T)=>{"use strict";T.d(Re,{EH:()=>J,U5:()=>H,Xz:()=>re});var x=T(36082),A=T(819);let G=!1;const Q=[];function H(Z,ie){let ue=new A.M(function le(){if(!ue||oe)return;if(G)return void W(le);const j=ce;ue.clear(),G=!0,oe=!0,ce=(0,x.LJ)(ue,Z),oe=!1,G=!1,ie(ce,j),B()}),ce=null,oe=!1;return oe=!0,ce=(0,x.LJ)(ue,Z),oe=!1,{remove:function Y(){ue&&(ue.destroy(),ue=null,ce=null)}}}function re(Z,ie){let ue=new A.M(function oe(){ie(ce,Y)}),ce=null;function Y(){return ue?(ue.clear(),ce=(0,x.LJ)(ue,Z),ce):null}return Y(),{remove:function le(){ue&&(ue.destroy(),ue=null),ce=null}}}function J(Z){let ie=new A.M(function ce(){ie&&!ue&&(G?W(ce):(ie.clear(),G=!0,ue=!0,(0,x.LJ)(ie,Z),ue=!1,G=!1,B()))}),ue=!1;return ue=!0,(0,x.LJ)(ie,Z),ue=!1,{remove:function oe(){ie&&(ie.destroy(),ie=null)}}}function W(Z){Q.includes(Z)||Q.unshift(Z)}function B(){for(;Q.length;)Q.pop()()}},2345:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{v:()=>x}),(A=x||(x={}))[A.Dirty=1]="Dirty",A[A.Overriden=2]="Overriden",A[A.Computing=4]="Computing",A[A.NonNullable=8]="NonNullable",A[A.HasDefaultValue=16]="HasDefaultValue",A[A.DepTrackingInitialized=32]="DepTrackingInitialized",A[A.AutoTracked=64]="AutoTracked",A[A.ExplicitlyTracking=128]="ExplicitlyTracking"},12196:(dt,Re,T)=>{"use strict";T.d(Re,{X:()=>A});var x=T(85931);class A{constructor(Q,H){this._observers=Q,this._observer=H}remove(){(0,x.Od)(this._observers,this._observer)}}},48902:(dt,Re,T)=>{"use strict";T.d(Re,{s:()=>A});var x=T(12196);class A{constructor(){this._observers=[]}observe(Q){return this._observers.includes(Q)||this._observers.push(Q),new x.X(this._observers,Q)}notify(){const Q=this._observers.slice();for(let H=0;H<Q.length;++H){const re=Q[H];re.onInvalidated(),re.onCommitted()}}}},819:(dt,Re,T)=>{"use strict";T.d(Re,{M:()=>x});class x{constructor(G){this._notify=G,this._accessed=[],this._handles=[],this._invalidCount=0}destroy(){this._accessed.length=0,this.clear()}onInvalidated(){this._invalidCount++}onCommitted(){const G=this._invalidCount;if(1===G)return this._invalidCount=0,void this._notify();this._invalidCount=G>0?G-1:0}onObservableAccessed(G){this._accessed.includes(G)||this._accessed.push(G)}onTrackingEnd(){const G=this._handles,Q=this._accessed;for(let H=0;H<Q.length;++H)G.push(Q[H].observe(this));Q.length=0}clear(){const G=this._handles;for(let Q=0;Q<G.length;++Q)G[Q].remove();G.length=0}}},52323:(dt,Re,T)=>{"use strict";T.d(Re,{IH:()=>le,NI:()=>Z,Qc:()=>oe,TS:()=>J,b6:()=>H,vw:()=>Q});var x=T(54024),A=T(58817),G=T(62208);function Q(Y){return Y?Y.__accessor__?Y.__accessor__:Y.propertyInvalidated?Y:null:null}function H(Y,j){return null!=Y&&Y.metadatas&&null!=Y.metadatas[j]}function J(Y,j,X){return W(Y,j,X?{policy:X,path:""}:null)}function W(Y,j,X){return j?Object.keys(j).reduce((U,ee)=>{let $=null,ne="merge";if(X&&($=X.path?`${X.path}.${ee}`:ee,ne=X.policy($)),"replace"===ne)return U[ee]=j[ee],U;if(void 0===U[ee])return U[ee]=(0,A.d9)(j[ee]),U;let se=U[ee],ae=j[ee];if(se===ae)return U;if(Array.isArray(ae)||Array.isArray(U))se=U[ee]=se?Array.isArray(se)?se.concat():[se]:[],ae&&(Array.isArray(ae)||(ae=[ae]),ae.forEach(de=>{se.includes(de)||se.push(de)}));else if(ae&&"object"==typeof ae)if(X){const de=X.path;X.path=(0,G.j0)($),U[ee]=W(se,ae,X),X.path=de}else U[ee]=W(se,ae,null);else U.hasOwnProperty(ee)&&!j.hasOwnProperty(ee)||(U[ee]=ae);return U},Y||{}):Y}function Z(Y){return Array.isArray(Y)?Y:Y.split(".")}function ie(Y){return Y.includes(",")?Y.split(",").map(j=>j.trim()):[Y.trim()]}function oe(Y,j,X,U){const ee=function ue(Y){if(Array.isArray(Y)){const j=[];for(const X of Y)j.push(...ie(X));return j}return ie(Y)}(j);if(1!==ee.length){const $=ee.map(ne=>U(Y,ne,X));return(0,x.AL)($)}return U(Y,ee[0],X)}function le(Y){let j=!1;return()=>{j||(j=!0,Y())}}},30755:(dt,Re,T)=>{"use strict";T.d(Re,{BT:()=>X,Fs:()=>ne,NC:()=>ge,YP:()=>de,aQ:()=>he});var Z,ye,x=T(35575),A=T(58817),G=T(94530),Q=T(50618),H=T(28862),re=T(86236),J=T(34595),W=T(21352),B=T(52323);(ye=Z||(Z={}))[ye.Untracked=0]="Untracked",ye[ye.Tracked=1]="Tracked";class ie{constructor(){this.uid=(0,re.D)(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(Me,Ee,Te,me,Ce){return this.pool.acquire(Z.Untracked,Me,Ee,Te,me,Ce,A.fS)}static acquireTracked(Me,Ee,Te,me){return this.pool.acquire(Z.Tracked,Me,Ee,Te,null,null,me)}notify(Me,Ee){this.type===Z.Untracked?this.callback.call(this.target,Me,Ee,this.path,this.target):this.callback.call(null,Me,Ee)}acquire(Me,Ee,Te,me,Ce,Ie,Ge){this.uid=(0,re.D)(),this.removed=!1,this.type=Me,this.oldValue=Ee,this.callback=Te,this.getValue=me,this.target=Ce,this.path=Ie,this.equals=Ge}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=(0,re.D)(),this.removed=!0}}ie.pool=new G.e(ie);const ue=new x.Z,ce=new Set;let oe;function le(ye){ce.delete(ye),ce.add(ye),oe||(oe=(0,Q.Os)(U))}function Y(ye){if(ye.removed)return;const Me=ye.oldValue,Ee=ye.getValue();ye.equals(Me,Ee)||(ye.oldValue=Ee,ye.notify(Ee,Me))}function X(ye){for(const Me of ce.values())Me.target===ye&&(Me.removed=!0)}function U(){let ye=10;for(;oe&&ye--;){oe=null;const Me=ee(),Ee=ue.acquire();for(const Te of Me){const me=Te.uid;Y(Te),me===Te.uid&&Te.removed&&Ee.push(Te)}for(const Te of ce)Te.removed&&(Ee.push(Te),ce.delete(Te));for(const Te of Ee)ie.pool.release(Te);ue.release(Ee),ue.release(Me),$.forEach(Te=>Te())}}function ee(){const ye=ue.acquire();ye.length=ce.size;let Me=0;for(const Ee of ce)ye[Me]=Ee,++Me;return ce.clear(),ye}const $=new Set;function ne(ye){return $.add(ye),{remove(){$.delete(ye)}}}function de(ye,Me,Ee,Te=!1){return!ye.__accessor__||ye.__accessor__.destroyed?{remove(){}}:Te?function ae(ye,Me,Ee){const Te=(0,B.Qc)(ye,Me,Ee,(me,Ce,Ie)=>{let Ge=!1;return(0,W.U5)(()=>(0,J.$z)(me,Ce),(Je,xe)=>{me.__accessor__.destroyed?Te.remove():Ge||(Ge=!0,(0,A.fS)(xe,Je)||Ie.call(me,Je,xe,Ce,me),Ge=!1)})});return Te}(ye,Me,Ee):function se(ye,Me,Ee){let Te=(0,B.Qc)(ye,Me,Ee,(me,Ce,Ie)=>{let Ge,Je,xe=(0,W.Xz)(()=>(0,J.$z)(me,Ce),(je,We)=>{me.__accessor__.destroyed||Ge&&Ge.uid!==Je?Te.remove():(Ge||(Ge=ie.acquireUntracked(je,Ie,We,me,Ce),Je=Ge.uid),le(Ge))});return{remove:(0,B.IH)(()=>{xe.remove(),Ge&&(Ge.uid!==Je||Ge.removed||(Ge.removed=!0,le(Ge)),Ge=null),Te=xe=null})}});return Te}(ye,Me,Ee)}function he(ye,Me,Ee=!1,Te=A.y7){return Ee?function pe(ye,Me,Ee){let Te=!1;return(0,W.U5)(ye,(me,Ce)=>{Te||(Te=!0,Ee(Ce,me)||Me(me,Ce),Te=!1)})}(ye,Me,Te):function _e(ye,Me,Ee){let Te,me,Ce=(0,W.Xz)(ye,(Ie,Ge)=>{Te&&Te.uid!==me?Ce.remove():(Te||(Te=ie.acquireTracked(Ie,Me,Ge,Ee),me=Te.uid),le(Te))});return{remove:(0,B.IH)(()=>{Ce.remove(),Te&&(Te.uid!==me||Te.removed||(Te.removed=!0,le(Te)),Te=null),Ce=null})}}(ye,Me,Te)}function ge(ye){return(0,H.f)(ce,Me=>Me.oldValue===ye)}},36054:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>ue,d:()=>ie});var x=T(85931),A=T(26584),G=T(63290),Q=T(31283),H=T(52323),re=T(33794);const J=G.Z.getLogger("esri.core.accessorSupport.write");function W(ce,oe,le,Y,j){var U,ee;const X={};return null==(ee=null==(U=oe.write)?void 0:U.writer)||ee.call(ce,Y,X,le,j),X}function B(ce,oe,le,Y,j,X){if(!Y||!Y.write)return!1;const U=ce.get(le);if(!j&&Y.write.overridePolicy){const ee=Y.write.overridePolicy.call(ce,U,le,X);void 0!==ee&&(j=ee)}if(j||(j=Y.write),!j||!1===j.enabled)return!1;if((null===U&&!j.allowNull&&!j.writerEnsuresNonNull||void 0===U)&&j.isRequired){const ee=new A.Z("web-document-write:property-required",`Missing value for required property '${le}' on '${ce.declaredClass}'`,{propertyName:le,target:ce});return ee&&X&&X.messages?X.messages.push(ee):ee&&!X&&J.error(ee.name,ee.message),!1}return!(void 0===U||null===U&&!j.allowNull&&!j.writerEnsuresNonNull||(!oe.store.multipleOriginsSupported||oe.store.originOf(le)===Q.s3.DEFAULTS)&&function Z(ce,oe,le,Y,j){const X=Y.default;if(void 0===X)return!1;if(null!=Y.defaultEquals)return Y.defaultEquals(j);if("function"==typeof X){if(Array.isArray(j)){const U=X.call(ce,oe,le);return(0,x.fS)(U,j)}return!1}return X===j}(ce,le,X,Y,U)||!j.ignoreOrigin&&X&&X.origin&&oe.store.multipleOriginsSupported&&oe.store.originOf(le)<(0,Q.M9)(X.origin))}function ie(ce,oe,le,Y){const j=(0,H.vw)(ce),U=(0,re.Ah)(j.metadatas[oe],Y);return!!U&&B(ce,j,oe,U,le,Y)}function ue(ce,oe,le){var X,U;if(ce&&"function"==typeof ce.toJSON&&(!ce.toJSON.isDefaultToJSON||!ce.write))return(0,H.TS)(oe,ce.toJSON(le));const Y=(0,H.vw)(ce),j=Y.metadatas;for(const ee in j){const $=(0,re.Ah)(j[ee],le);if(!B(ce,Y,ee,$,void 0,le))continue;const ne=ce.get(ee),se=W(ce,$,$.write&&"string"==typeof $.write.target?$.write.target:ee,ne,le);Object.keys(se).length>0&&(oe=(0,H.TS)(oe,se),(null==(U=null==(X=null==le?void 0:le.resources)?void 0:X.pendingOperations)?void 0:U.length)&&Promise.all(le.resources.pendingOperations).then(()=>(0,H.TS)(oe,se)),le&&le.writtenProperties&&le.writtenProperties.push({target:ce,propName:ee,oldOrigin:(0,Q.Wm)(Y.store.originOf(ee)),newOrigin:le.origin}))}return oe}},85931:(dt,Re,T)=>{"use strict";T.d(Re,{$A:()=>X,FY:()=>_e,Od:()=>Me,SO:()=>$,TV:()=>ge,Tw:()=>W,Vx:()=>Z,a9:()=>Y,cq:()=>se,e$:()=>ae,e5:()=>ie,fS:()=>B,vr:()=>oe,w6:()=>j,xH:()=>ee,zG:()=>ce});var x=T(62208),A=T(4619);function W(Ee,Te){return Ee.filter(Te?(me,Ce,Ie)=>Ie.findIndex(Te.bind(null,me))===Ce:(me,Ce,Ie)=>Ie.indexOf(me)===Ce)}function B(Ee,Te,me){if((0,x.Wi)(Ee)&&(0,x.Wi)(Te))return!0;if((0,x.Wi)(Ee)||(0,x.Wi)(Te)||Ee.length!==Te.length)return!1;if(me){for(let Ce=0;Ce<Ee.length;Ce++)if(!me(Ee[Ce],Te[Ce]))return!1}else for(let Ce=0;Ce<Ee.length;Ce++)if(Ee[Ce]!==Te[Ce])return!1;return!0}function Z(Ee,Te){let me=Ee.length!==Te.length;Ee.length=Te.length;for(let Ce=0;Ce<Te.length;++Ce)Ee[Ce]!==Te[Ce]&&(Ee[Ce]=Te[Ce],me=!0);return me}function ie(Ee,Te,me){let Ce,Ie;return me?(Ce=Te.filter(Ge=>!Ee.some(Je=>me(Je,Ge))),Ie=Ee.filter(Ge=>!Te.some(Je=>me(Je,Ge)))):(Ce=Te.filter(Ge=>!Ee.includes(Ge)),Ie=Ee.filter(Ge=>!Te.includes(Ge))),{added:Ce,removed:Ie}}function ce(Ee){return Ee&&"number"==typeof Ee.length}function oe(Ee,Te){const me=Ee.length;if(0===me)return[];const Ce=[];for(let Ie=0;Ie<me;Ie+=Te)Ce.push(Ee.slice(Ie,Ie+Te));return Ce}const le=!!Array.prototype.fill;function Y(Ee,Te){if(le)return new Array(Ee).fill(Te);const me=new Array(Ee);for(let Ce=0;Ce<Ee;Ce++)me[Ce]=Te;return me}function j(Ee,Te){void 0===Te&&(Te=Ee,Ee=0);const me=new Array(Te-Ee);for(let Ce=Ee;Ce<Te;Ce++)me[Ce-Ee]=Ce;return me}function X(Ee,Te,me){const Ce=Ee.length;let Ie=0,Ge=Ce-1;for(;Ie<Ge;){const xe=Ie+Math.floor((Ge-Ie)/2);Te>Ee[xe]?Ie=xe+1:Ge=xe}const Je=Ee[Ie];return me?Te>=Ee[Ce-1]?-1:Je===Te?Ie:Ie-1:Je===Te?Ie:-1}function ee(Ee){return Ee.reduce((Te,me)=>Te.concat(me||[]),[])}class ${constructor(){this.last=0}}const ne=new $;function se(Ee,Te,me,Ce){Ce=Ce||ne;const Ie=Math.max(0,Ce.last-10);for(let Je=Ie;Je<me;++Je)if(Ee[Je]===Te)return Ce.last=Je,Je;const Ge=Math.min(Ie,me);for(let Je=0;Je<Ge;++Je)if(Ee[Je]===Te)return Ce.last=Je,Je;return-1}function ae(Ee,Te,me,Ce){const Ie=null==me?Ee.length:me,Ge=se(Ee,Te,Ie,Ce);if(-1!==Ge)return Ee[Ge]=Ee[Ie-1],null==me&&Ee.pop(),Te}const de=new Set;function _e(Ee,Te,me=Ee.length,Ce=Te.length,Ie,Ge){if(0===Ce||0===me)return me;de.clear();for(let xe=0;xe<Ce;++xe)de.add(Te[xe]);Ie=Ie||ne;const Je=Math.max(0,Ie.last-10);for(let xe=Je;xe<me;++xe)if(de.has(Ee[xe])&&(Ge&&Ge.push(Ee[xe]),de.delete(Ee[xe]),Ee[xe]=Ee[me-1],--me,--xe,0===de.size||0===me))return de.clear(),me;for(let xe=0;xe<Je;++xe)if(de.has(Ee[xe])&&(Ge&&Ge.push(Ee[xe]),de.delete(Ee[xe]),Ee[xe]=Ee[me-1],--me,--xe,0===de.size||0===me))return de.clear(),me;return de.clear(),me}function ge(Ee,Te){const me=function he(Ee){return Ee?(ye.seed=Ee,()=>ye.getFloat()):Math.random}(Te);for(let Ce=Ee.length-1;Ce>0;Ce--){const Ie=Math.floor(me()*(Ce+1)),Ge=Ee[Ce];Ee[Ce]=Ee[Ie],Ee[Ie]=Ge}return Ee}const ye=new A.Z;function Me(Ee,Te){const me=Ee.indexOf(Te);return-1!==me?(Ee.splice(me,1),Te):null}},59213:(dt,Re,T)=>{"use strict";T.d(Re,{Ed:()=>Q,UI:()=>H,mt:()=>B,q6:()=>J,w6:()=>ie});var x=T(15861),A=T(62208),G=T(10699);function Q(ue,ce,oe){return(0,G.as)(ue.map((le,Y)=>ce.apply(oe,[le,Y])))}function H(ue,ce,oe){return re.apply(this,arguments)}function re(){return(re=(0,x.Z)(function*(ue,ce,oe){return(yield(0,G.as)(ue.map((le,Y)=>ce.apply(oe,[le,Y])))).map(le=>le.value)})).apply(this,arguments)}function J(ue){return W.apply(this,arguments)}function W(){return(W=(0,x.Z)(function*(ue){if((0,A.Wi)(ue))return{ok:!1,error:new Error("no promise provided")};try{return{ok:!0,value:yield ue}}catch(ce){return{ok:!1,error:ce}}})).apply(this,arguments)}function B(ue){return Z.apply(this,arguments)}function Z(){return(Z=(0,x.Z)(function*(ue){try{return{ok:!0,value:yield ue}}catch(ce){return(0,G.r9)(ce),{ok:!1,error:ce}}})).apply(this,arguments)}function ie(ue){if(!0===ue.ok)return ue.value;throw ue.error}},27306:(dt,Re,T)=>{"use strict";function x(re){return 32+re.length}function A(){return 16}function G(re){if(!re)return 0;let J=32;for(const W in re)if(re.hasOwnProperty(W)){const B=re[W];switch(typeof B){case"string":J+=x(B);break;case"number":J+=16;break;case"boolean":J+=4}}return J}function Q(re,J){return 32+re.length*J}var H,re;T.d(Re,{G3:()=>A,Y8:()=>H,do:()=>Q,f2:()=>G,hH:()=>x}),(re=H||(H={}))[re.KILOBYTES=1024]="KILOBYTES",re[re.MEGABYTES=1048576]="MEGABYTES",re[re.GIGABYTES=1073741824]="GIGABYTES"},84244:(dt,Re,T)=>{"use strict";T.d(Re,{m:()=>A});const A=function x(G){return{setTimeout:(Q,H)=>{const re=G.setTimeout(Q,H);return{remove:()=>G.clearTimeout(re)}}}}(globalThis)},89726:(dt,Re,T)=>{"use strict";T.d(Re,{R:()=>G,Z:()=>A});var x=T(46160);function A(H,re,J=x.Z){return re||(re=new J),re===H||(re.removeAll(),function Q(H){return H&&(Array.isArray(H)||"items"in H&&Array.isArray(H.items))}(H)?re.addMany(H):H&&re.add(H)),re}function G(H){return H}},78260:(dt,Re,T)=>{"use strict";function A(pe){return"h"in pe&&"s"in pe&&"v"in pe}function G(pe){return"l"in pe&&"a"in pe&&"b"in pe}function Q(pe){return"l"in pe&&"c"in pe&&"h"in pe}T.d(Re,{Y3:()=>se,_Y:()=>ne,_j:()=>_e,sJ:()=>ae,xr:()=>$});const re=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],J=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function W(pe,he){const ge=[];let ye,Me;if(pe[0].length!==he.length)throw"dimensions do not match";const Ee=pe.length,Te=pe[0].length;let me=0;for(ye=0;ye<Ee;ye++){for(me=0,Me=0;Me<Te;Me++)me+=pe[ye][Me]*he[Me];ge.push(me)}return ge}function B(pe){const he=[pe.r/255,pe.g/255,pe.b/255].map(ye=>ye<=.04045?ye/12.92:((ye+.055)/1.055)**2.4),ge=W(re,he);return{x:100*ge[0],y:100*ge[1],z:100*ge[2]}}function Z(pe){const he=W(J,[pe.x/100,pe.y/100,pe.z/100]).map(ge=>Math.min(1,Math.max(ge<=.0031308?12.92*ge:1.055*ge**.4166666666666667-.055,0)));return{r:Math.round(255*he[0]),g:Math.round(255*he[1]),b:Math.round(255*he[2])}}function ie(pe){const he=[pe.x/95.047,pe.y/100,pe.z/108.883].map(ge=>ge>.008856451679035631?ge**.3333333333333333:7.787037037037035*ge+.13793103448275862);return{l:116*he[1]-16,a:500*(he[0]-he[1]),b:200*(he[1]-he[2])}}function ue(pe){const he=pe.l,ge=[(he+16)/116+pe.a/500,(he+16)/116,(he+16)/116-pe.b/200].map(ye=>ye>6/29?ye**3:3*(6/29)**2*(ye-4/29));return{x:95.047*ge[0],y:100*ge[1],z:108.883*ge[2]}}function le(pe){return ie(B(pe))}function Y(pe){return Z(ue(pe))}function $(pe){return function x(pe){return"r"in pe&&"g"in pe&&"b"in pe}(pe)?pe:Q(pe)?function X(pe){return Z(ue(function oe(pe){const ge=pe.c,ye=pe.h;return{l:pe.l,a:ge*Math.cos(ye),b:ge*Math.sin(ye)}}(pe)))}(pe):G(pe)?Y(pe):function H(pe){return"x"in pe&&"y"in pe&&"z"in pe}(pe)?Z(pe):A(pe)?function ee(pe){const he=(pe.h+360)%360/60,ye=pe.v/100*255,Me=ye*(pe.s/100),Ee=Me*(1-Math.abs(he%2-1));let Te;switch(Math.floor(he)){case 0:Te={r:Me,g:Ee,b:0};break;case 1:Te={r:Ee,g:Me,b:0};break;case 2:Te={r:0,g:Me,b:Ee};break;case 3:Te={r:0,g:Ee,b:Me};break;case 4:Te={r:Ee,g:0,b:Me};break;case 5:case 6:Te={r:Me,g:0,b:Ee};break;default:Te={r:0,g:0,b:0}}return Te.r=Math.round(Te.r+ye-Me),Te.g=Math.round(Te.g+ye-Me),Te.b=Math.round(Te.b+ye-Me),Te}(pe):pe}function ne(pe){return A(pe)?pe:function U(pe){const he=pe.r,ge=pe.g,ye=pe.b,Me=Math.max(he,ge,ye),Ee=Me-Math.min(he,ge,ye);let Te=Me,me=0===Ee?0:Me===he?(ge-ye)/Ee%6:Me===ge?(ye-he)/Ee+2:(he-ge)/Ee+4,Ce=0===Ee?0:Ee/Te;return me<0&&(me+=6),me*=60,Ce*=100,Te*=100/255,{h:me,s:Ce,v:Te}}($(pe))}function se(pe){return G(pe)?pe:le($(pe))}function ae(pe){return Q(pe)?pe:function j(pe){return function ce(pe){const he=pe.l,ge=pe.a,ye=pe.b,Me=Math.sqrt(ge*ge+ye*ye);let Ee=Math.atan2(ye,ge);return Ee=Ee>0?Ee:Ee+2*Math.PI,{l:he,c:Me,h:Ee}}(ie(B(pe)))}($(pe))}function _e(pe,he){const ge=le(pe);return ge.l*=1-he,Y(ge)}},94573:(dt,Re,T)=>{"use strict";function A(re){}function Q(re){return()=>re}T.d(Re,{Bg:()=>A,sM:()=>Q}),T(8314)},55538:(dt,Re,T)=>{"use strict";T.d(Re,{Mr:()=>re,x9:()=>J});var x=T(8314);const A=new Set;function re(W,B,Z={}){if((0,x.Z)("esri-deprecation-warnings")){const{moduleName:ie}=Z;J(W,"Property: "+(ie?ie+"::":"")+B,Z)}}function J(W,B,Z={}){if((0,x.Z)("esri-deprecation-warnings")){const{replacement:ie,version:ue,see:ce,warnOnce:oe}=Z;let le=B;ie&&(le+=`\n\t\u{1f6e0}\ufe0f Replacement: ${ie}`),ue&&(le+=`\n\t\u2699\ufe0f Version: ${ue}`),ce&&(le+=`\n\t\u{1f517} See ${ce} for more details.`),function G(W,B,Z=!1){Z&&A.has(B)||(Z&&A.add(B),W.warn(`\u{1f6d1} DEPRECATED - ${B}`))}(W,le,oe)}}},83100:(dt,Re,T)=>{"use strict";function x(B){return B=B||globalThis.location.hostname,W.some(Z=>null!=(null==B?void 0:B.match(Z)))}function A(B,Z){return B&&(Z=Z||globalThis.location.hostname)?null!=Z.match(Q)||null!=Z.match(re)?B.replace("static.arcgis.com","staticdev.arcgis.com"):null!=Z.match(H)||null!=Z.match(J)?B.replace("static.arcgis.com","staticqa.arcgis.com"):B:B}T.d(Re,{XO:()=>x,pJ:()=>A});const Q=/^devext.arcgis.com$/,H=/^qaext.arcgis.com$/,re=/^[\w-]*\.mapsdevext.arcgis.com$/,J=/^[\w-]*\.mapsqa.arcgis.com$/,W=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,Q,H,/^jsapps.esri.com$/,re,J]},40764:(dt,Re,T)=>{"use strict";function x(W){return"string"==typeof W?document.getElementById(W):W}function A(W){for(;W.hasChildNodes();)W.removeChild(W.firstChild)}function Q(W,B){const Z=B.parentNode;Z&&Z.insertBefore(W,B)}function H(W,B){for(;;){const Z=W.firstChild;if(!Z)break;B.appendChild(Z)}}function re(W){W.parentNode&&W.parentNode.removeChild(W)}T.d(Re,{L7:()=>x,Od:()=>re,Vt:()=>Q,YD:()=>H,cS:()=>A}),(()=>{if("function"==typeof Element.prototype.closest)return(B,Z)=>B.closest(Z);Element.prototype.matches||Element})()},17770:(dt,Re,T)=>{"use strict";function x(J){return J&&("function"==typeof J.on||"function"==typeof J.addEventListener)}function A(J,W,B){if(!x(J))throw new TypeError("target is not a Evented or EventTarget object");if("on"in J)return J.on(W,B);if(Array.isArray(W)){const Z=W.slice();for(const ie of Z)J.addEventListener(ie,B);return{remove(){for(const ie of Z)J.removeEventListener(ie,B)}}}return J.addEventListener(W,B),{remove(){J.removeEventListener(W,B)}}}function G(J,W,B){if(!x(J))throw new TypeError("target is not a Evented or EventTarget object");if("once"in J)return J.once(W,B);const Z=A(J,W,ie=>{Z.remove(),B.call(J,ie)});return{remove(){Z.remove()}}}function Q(J,W,B){let Z=!1;const ie=A(J,W,ue=>{Z||B.call(J,ue)});return{resume(){Z=!1},pause(){Z=!0},remove(){ie.remove()}}}T.d(Re,{IH:()=>G,Wy:()=>Q,kK:()=>re,on:()=>A,vT:()=>x});const H={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function re({key:J}){return H[J]||J}},36161:(dt,Re,T)=>{"use strict";T.d(Re,{I:()=>A,v:()=>G});var x=T(21286);function A(W,B,Z=0){const ie=(0,x.uZ)(W,0,re);for(let ue=0;ue<4;ue++)B[Z+ue]=Math.floor(256*J(ie*Q[ue]))}function G(W,B=0){let Z=0;for(let ie=0;ie<4;ie++)Z+=W[B+ie]*H[ie];return Z}const Q=[1,256,65536,16777216],H=[1/256,1/65536,1/16777216,1/4294967296],re=G(new Uint8ClampedArray([255,255,255,255]));function J(W){return W-Math.floor(W)}},54024:(dt,Re,T)=>{"use strict";T.d(Re,{AL:()=>A,HO:()=>re,ed:()=>H,iU:()=>Q,kB:()=>G});var x=T(62208);function A(W){return G(()=>W.forEach(B=>(0,x.pC)(B)&&B.remove()))}function G(W){return{remove:()=>{W&&(W(),W=void 0)}}}function Q(W){return G(()=>{const B=W();(0,x.pC)(B)&&B.remove()})}function H(W){return G((0,x.pC)(W)?()=>W.destroy():void 0)}function re(W,B){const Z=setTimeout(W,B);return G(()=>clearTimeout(Z))}},8314:(dt,Re,T)=>{var G,Q,H,re;let x;function A(J){return"function"==typeof x[J]?x[J]=x[J](globalThis):x[J]}T.d(Re,{Z:()=>A}),x=(null==(G=globalThis.dojoConfig)?void 0:G.has)||(null==(Q=globalThis.esriConfig)?void 0:Q.has)?or(or({},null==(H=globalThis.dojoConfig)?void 0:H.has),null==(re=globalThis.esriConfig)?void 0:re.has):{},A.add=(J,W,B,Z)=>((Z||void 0===x[J])&&(x[J]=W),B&&A(J)),A.cache=x,A.add("esri-deprecation-warnings",!0),(()=>{var W;A.add("host-webworker",void 0!==globalThis.WorkerGlobalScope&&self instanceof globalThis.WorkerGlobalScope);const J="undefined"!=typeof window&&"undefined"!=typeof location&&"undefined"!=typeof document&&window.location===location&&window.document===document;if(A.add("host-browser",J),A.add("host-node","object"==typeof globalThis.process&&(null==(W=globalThis.process.versions)?void 0:W.node)&&globalThis.process.versions.v8),A.add("dom",J),A("host-browser")){const B=navigator,Z=B.userAgent,ie=B.appVersion,ue=parseFloat(ie);if(A.add("wp",parseFloat(Z.split("Windows Phone")[1])||void 0),A.add("msapp",parseFloat(Z.split("MSAppHost/")[1])||void 0),A.add("khtml",ie.includes("Konqueror")?ue:void 0),A.add("edge",parseFloat(Z.split("Edge/")[1])||void 0),A.add("opr",parseFloat(Z.split("OPR/")[1])||void 0),A.add("webkit",!A("wp")&&!A("edge")&&parseFloat(Z.split("WebKit/")[1])||void 0),A.add("chrome",!A("edge")&&!A("opr")&&parseFloat(Z.split("Chrome/")[1])||void 0),A.add("android",!A("wp")&&parseFloat(Z.split("Android ")[1])||void 0),A.add("safari",!ie.includes("Safari")||A("wp")||A("chrome")||A("android")||A("edge")||A("opr")?void 0:parseFloat(ie.split("Version/")[1])),A.add("mac",ie.includes("Macintosh")),!A("wp")&&Z.match(/(iPhone|iPod|iPad)/)){const ce=RegExp.$1.replace(/P/,"p"),oe=Z.match(/OS ([\d_]+)/)?RegExp.$1:"1",le=parseFloat(oe.replace(/_/,".").replace(/_/g,""));A.add(ce,le),A.add("ios",le)}A.add("trident",parseFloat(ie.split("Trident/")[1])||void 0),A("webkit")||(!Z.includes("Gecko")||A("wp")||A("khtml")||A("trident")||A("edge")||A.add("mozilla",ue),A("mozilla")&&A.add("ff",parseFloat(Z.split("Firefox/")[1]||Z.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const J=navigator.userAgent,W=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(J),B=/iPhone/i.test(J);W&&A.add("esri-mobile",W),B&&A.add("esri-iPhone",B),A.add("esri-geolocation",!!navigator.geolocation)}A.add("esri-canvas-svg-support",!A("trident")),A.add("esri-wasm","WebAssembly"in globalThis),A.add("esri-shared-array-buffer",()=>{const J="SharedArrayBuffer"in globalThis,W=!1===globalThis.crossOriginIsolated;return J&&!W}),A.add("wasm-simd",()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]))),A.add("esri-atomics","Atomics"in globalThis),A.add("esri-workers","Worker"in globalThis),A.add("web-feat:cache","caches"in globalThis),A.add("esri-workers-arraybuffer-transfer",!A("safari")||Number(A("safari"))>=12),A.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),A.add("featurelayer-simplify-payload-size-factors",[1,1,4]),A.add("featurelayer-snapshot-enabled",!0),A.add("featurelayer-snapshot-point-min-threshold",8e4),A.add("featurelayer-snapshot-point-max-threshold",4e5),A.add("featurelayer-snapshot-point-coverage",.1),A.add("featurelayer-advanced-symbols",!1),A.add("featurelayer-pbf",!0),A.add("featurelayer-pbf-statistics",!1),A.add("feature-layers-workers",!0),A.add("feature-polyline-generalization-factor",1),A.add("mapview-transitions-duration",200),A.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),A.add("mapserver-pbf-enabled",!1),A.add("mapimagelayer-popup-identify-max-tolerance",20),A.add("heatmap-allow-raster-fallback",!0),A.add("heatmap-force-raster",!1),A("host-webworker")||A("host-browser")&&(A.add("esri-csp-restrictions",()=>{try{new Function}catch(J){return!0}return!1}),A.add("esri-image-decode",()=>{if("decode"in new Image){const J=new Image;return J.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void J.decode().then(()=>{A.add("esri-image-decode",!0,!0,!0)}).catch(()=>{A.add("esri-image-decode",!1,!0,!0)})}return!1}),A.add("esri-url-encodes-apostrophe",()=>{const J=window.document.createElement("a");return J.href="?'",J.href.includes("?%27")}))})()},56354:(dt,Re,T)=>{"use strict";function x(Q){const H=[];return function*(){yield*H;for(const re of Q)H.push(re),yield re}}function A(Q,H){for(const re of Q)if(null!=re&&H(re))return re}function G(Q){return null!=Q&&"function"==typeof Q[Symbol.iterator]}T.d(Re,{Fs:()=>x,TW:()=>G,sE:()=>A})},2076:(dt,Re,T)=>{"use strict";T.d(Re,{X:()=>A,w:()=>G});var x=T(94113);class A{constructor(H,re={ignoreUnknown:!1,useNumericKeys:!1}){this.jsonToAPI=H,this.options=re,this.apiValues=[],this.jsonValues=[],this.apiToJSON=this._invertMap(H),this.apiValues=this._getKeysSorted(this.apiToJSON),this.jsonValues=this._getKeysSorted(this.jsonToAPI),this.read=J=>this.fromJSON(J),this.write=(J,W,B)=>{const Z=this.toJSON(J);void 0!==Z&&(0,x.RB)(B,Z,W)},this.write.isJSONMapWriter=!0}toJSON(H){if(this.apiToJSON.hasOwnProperty(H)){const re=this.apiToJSON[H];return this.options.useNumericKeys?+re:re}return this.options.ignoreUnknown?void 0:H}fromJSON(H){return this.jsonToAPI.hasOwnProperty(H)?this.jsonToAPI[H]:this.options.ignoreUnknown?void 0:H}_invertMap(H){const re={};for(const J in H)re[H[J]]=J;return re}_getKeysSorted(H){const re=[];for(const J in H)re.push(J);return re.sort(),re}}function G(){return function(Q,H){return new A(Q,or({ignoreUnknown:!0},H))}}},58817:(dt,Re,T)=>{"use strict";T.d(Re,{Vo:()=>J,d9:()=>re,fS:()=>ce,y7:()=>oe,yd:()=>H});var x=T(85931),G=(T(8314),T(62208)),Q=T(55713);function H(U,ee){let $;if(ee)for($ in U)U.hasOwnProperty($)&&(void 0===U[$]?delete U[$]:U[$]instanceof Object&&H(U[$],!0));else for($ in U)U.hasOwnProperty($)&&void 0===U[$]&&delete U[$];return U}function re(U){if(!U||"object"!=typeof U||"function"==typeof U)return U;const ee=ue(U);if((0,G.pC)(ee))return ee;if(W(U))return U.clone();if(B(U))return U.map(re);if(Z(U))return U.clone();const $={};for(const ne of Object.getOwnPropertyNames(U))$[ne]=re(U[ne]);return $}function J(U){if(!U||"object"!=typeof U||"function"==typeof U)return U;const ee=ue(U);if((0,G.pC)(ee))return ee;if(B(U)){let $=!0;const ne=U.map(se=>{const ae=J(se);return null!=se&&null==ae&&($=!1),ae});return $?ne:null}if(W(U))return U.clone();if(!Z(U)){const $=new(Object.getPrototypeOf(U).constructor);for(const ne of Object.getOwnPropertyNames(U)){const se=U[ne],ae=J(se);if(null!=se&&null==ae)return null;$[ne]=ae}return $}return null}function W(U){return"function"==typeof U.clone}function B(U){return"function"==typeof U.map&&"function"==typeof U.forEach}function Z(U){return"function"==typeof U.notifyChange&&"function"==typeof U.watch}function ie(U){if("[object Object]"!==Object.prototype.toString.call(U))return!1;const ee=Object.getPrototypeOf(U);return null===ee||ee===Object.prototype}function ue(U){if((0,Q.W0)(U)||(0,Q.lq)(U)||(0,Q.KZ)(U)||(0,Q.z3)(U)||(0,Q.Uc)(U)||(0,Q.Hx)(U)||(0,Q.ZY)(U)||(0,Q.xZ)(U)||(0,Q.fS)(U))return(0,Q.tP)(U);if(U instanceof Date)return new Date(U.getTime());if(U instanceof ArrayBuffer)return U.slice(0,U.byteLength);if(U instanceof Map){const ee=new Map;return U.forEach(($,ne)=>{ee.set(ne,re($))}),ee}if(U instanceof Set){const ee=new Set;return U.forEach($=>{ee.add(re($))}),ee}return null}function ce(U,ee){return U===ee||"number"==typeof U&&isNaN(U)&&"number"==typeof ee&&isNaN(ee)||"function"==typeof(U||{}).getTime&&"function"==typeof(ee||{}).getTime&&U.getTime()===ee.getTime()||!1}function oe(U,ee){return U===ee||(null==U||"string"==typeof U?U===ee:"number"==typeof U?U===ee||"number"==typeof ee&&isNaN(U)&&isNaN(ee):U instanceof Date?ee instanceof Date&&U.getTime()===ee.getTime():Array.isArray(U)?Array.isArray(ee)&&(0,x.fS)(U,ee):U instanceof Set?ee instanceof Set&&function Y(U,ee){if(U.size!==ee.size)return!1;for(const $ of U)if(!ee.has($))return!1;return!0}(U,ee):U instanceof Map?ee instanceof Map&&function j(U,ee){if(U.size!==ee.size)return!1;for(const[$,ne]of U){const se=ee.get($);if(se!==ne||void 0===se&&!ee.has($))return!1}return!0}(U,ee):!!ie(U)&&ie(ee)&&function le(U,ee){if(null===U||null===ee)return!1;const $=Object.keys(U);if(null===ee||Object.keys(ee).length!==$.length)return!1;for(const ne of $)if(U[ne]!==ee[ne]||!Object.prototype.hasOwnProperty.call(ee,ne))return!1;return!0}(U,ee))}},75957:(dt,Re,T)=>{"use strict";function G(Q){return function x(Q){return Q instanceof Float32Array&&Q.length>=2}(Q)||function A(Q){return Array.isArray(Q)&&Q.length>=2}(Q)}T.d(Re,{lM:()=>G})},47877:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>re,w:()=>W});var x=T(15861),A=T(59213),G=T(46160),Q=T(47996),H=T(62208);function re(ie,ue){return J.apply(this,arguments)}function J(){return(J=(0,x.Z)(function*(ie,ue){return yield ie.load(),W(ie,ue)})).apply(this,arguments)}function W(ie,ue){return B.apply(this,arguments)}function B(){return B=(0,x.Z)(function*(ie,ue){const ce=[],oe=(...Y)=>{for(const j of Y)(0,H.Wi)(j)||(Array.isArray(j)?oe(...j):G.Z.isCollection(j)?j.forEach(X=>oe(X)):Q.Z.isLoadable(j)&&ce.push(j))};ue(oe);let le=null;if(yield(0,A.UI)(ce,function(){var Y=(0,x.Z)(function*(j){!1!==(yield(0,A.q6)(Z(j)?j.loadAll():j.load())).ok||le||(le=j)});return function(j){return Y.apply(this,arguments)}}()),le)throw le.loadError;return ie}),B.apply(this,arguments)}function Z(ie){return"loadAll"in ie&&"function"==typeof ie.loadAll}},21286:(dt,Re,T)=>{"use strict";T.d(Re,{BV:()=>ce,CW:()=>ne,H:()=>de,Kt:()=>Y,Sf:()=>Q,Vl:()=>ue,W8:()=>X,Y8:()=>j,ZF:()=>le,_3:()=>pe,b_:()=>oe,fp:()=>W,jE:()=>se,oK:()=>U,oc:()=>_e,sk:()=>B,t7:()=>Z,uZ:()=>H,wt:()=>J});var x=T(84161),A=T(993);const G=new Float32Array(1);function Q(he){--he;for(let ge=1;ge<32;ge<<=1)he|=he>>ge;return he+1}function H(he,ge,ye){return Math.min(Math.max(he,ge),ye)}function J(he){return 0==(he&he-1)}function W(he){return he--,he|=he>>1,he|=he>>2,he|=he>>4,he|=he>>8,he|=he>>16,++he}function B(he){return 10**Math.ceil(Math.LOG10E*Math.log(he))}function Z(he,ge,ye){return he+(ge-he)*ye}function ue(he){return he*Math.PI/180}function ce(he){return 180*he/Math.PI}function oe(he,ge=1e-6){return(he<0?-1:1)/Math.max(Math.abs(he),ge)}function le(he){return Math.acos(H(he,-1,1))}function Y(he){return Math.asin(H(he,-1,1))}function j(he,ge,ye=1e-6){if(isNaN(he)||isNaN(ge))return!1;if(he===ge)return!0;const Me=Math.abs(he-ge),Ee=Math.abs(he),Te=Math.abs(ge);if(0===he||0===ge||Ee<1e-12&&Te<1e-12){if(Me>.01*ye)return!1}else if(Me/(Ee+Te)>ye)return!1;return!0}function X(he,ge,ye=1e-6){return!isNaN(he)&&!isNaN(ge)&&(he>ge?he-ge:ge-he)<=ye}function U(he){return ee(Math.max(-pe,Math.min(he,pe)))}function ee(he){return G[0]=he,G[0]}function ne(he,ge,ye){const Me=H((ye-he)/(ge-he),0,1);return Me*Me*(3-2*Me)}function se(he,ge){const ye=(0,x.l)(he),Me=Y(he[2]/ye),Ee=Math.atan2(he[1]/ye,he[0]/ye);return(0,x.s)(ge,ye,Me,Ee),ge}function de(he,ge,ye){return(0,A.s)(he,ge[0],ge[1],ge[2],ge[3]*ye)}function _e(he){const ye=he[3]*he[3]+he[4]*he[4]+he[5]*he[5],Me=he[6]*he[6]+he[7]*he[7]+he[8]*he[8];return!(X(he[0]*he[0]+he[1]*he[1]+he[2]*he[2],1)&&X(ye,1)&&X(Me,1))}const pe=ee(34028234663852886e22)},62208:(dt,Re,T)=>{"use strict";T.d(Re,{Bd:()=>Y,Fd:()=>X,IM:()=>ce,JR:()=>U,O3:()=>ie,Pt:()=>W,R2:()=>ee,RY:()=>oe,SC:()=>Z,U2:()=>se,Wg:()=>re,Wi:()=>G,YP:()=>x,_W:()=>le,e8:()=>j,hw:()=>ue,j0:()=>ae,lV:()=>ne,pC:()=>A,s3:()=>J,yl:()=>B,yw:()=>H});const x=null;function A(de){return null!=de}function G(de){return null==de}function H(de,_e){return A(de)?_e(de):x}function re(de){return de}function J(de,_e){if(G(de))throw new Error(_e);return de}function W(de,_e){return A(de)?de:"function"==typeof _e?_e():_e}function B(de,_e){return A(de)?de:_e}function Z(de){return A(de)&&de.destroy(),null}function ie(de){return A(de)&&de.dispose(),null}function ue(de){return A(de)&&de.remove(),null}function ce(de){return A(de)&&de.abort(),null}function oe(de){return A(de)&&de.release(),null}function le(de,_e,pe){return A(de)&&A(_e)?A(pe)?pe(de,_e):de.equals(_e):de===_e}function Y(de){return null}function j(de,_e){const pe=new Array;return de.forEach(he=>{const ge=_e(he);A(ge)&&pe.push(ge)}),pe}function X(de,_e){const pe=new Array;for(const he of de)pe.push(ee(he,null,_e));return pe}function U(de,_e){for(const pe of de)H(pe,_e)}function ee(de,_e,pe){return A(de)?pe(de):_e}function ne(de){return de.filter(_e=>A(_e))}function se(de,..._e){let pe=de;for(let he=0;he<_e.length&&pe;++he)pe=pe[_e[he]];return pe}function ae(de){return de}},22558:(dt,Re,T)=>{"use strict";function x(A){return A&&"getAtOrigin"in A&&"originOf"in A}T.d(Re,{l:()=>x})},79682:(dt,Re,T)=>{"use strict";T.d(Re,{Y:()=>A});const x=[];function A(G){x.push(G),1===x.length&&queueMicrotask(()=>{const Q=x.slice();x.length=0;for(const H of Q)H()})}},75327:(dt,Re,T)=>{"use strict";T.d(Re,{Qc:()=>ie,WU:()=>H,lt:()=>Z});var x=T(77275),A=T(56683);const G={ar:[".",","],bg:[",","\xa0"],bs:[",","."],ca:[",","."],cs:[",","\xa0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\xa0"],fi:[",","\xa0"],fr:[",","\u202f"],"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",","."],hu:[",","\xa0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\xa0"],lv:[",","\xa0"],mk:[",","."],nb:[",","\xa0"],nl:[",","."],pl:[",","\xa0"],pt:[",","."],"pt-pt":[",","\xa0"],ro:[",","."],ru:[",","\xa0"],sk:[",","\xa0"],sl:[",","."],sr:[",","."],sv:[",","\xa0"],th:[".",","],tr:[",","."],uk:[",","\xa0"],vi:[",","."],zh:[".",","]};function Q(Y){Y||(Y=(0,A.Kd)());let j=Y in G;if(!j){const $=Y.split("-");$.length>1&&$[0]in G&&(Y=$[0],j=!0),j||(Y="en")}const[X,U,ee="#,##0.###"]=G[Y];return{decimal:X,group:U,pattern:ee}}function H(Y,j){const X=Q((j=or({},j)).locale);j.customs=X;const U=j.pattern||X.pattern;return isNaN(Y)||Math.abs(Y)===1/0?null:function J(Y,j,X){const U=(X=X||{}).customs.group,ee=X.customs.decimal,$=j.split(";"),ne=$[0];if((j=$[Y<0?1:0]||"-"+ne).includes("%"))Y*=100;else if(j.includes("\u2030"))Y*=1e3;else{if(j.includes("\xa4"))throw new Error("currency notation not supported");if(j.includes("E"))throw new Error("exponential notation not supported")}const se=re,ae=ne.match(se);if(!ae)throw new Error("unable to find a number expression in pattern: "+j);return!1===X.fractional&&(X.places=0),j.replace(se,function W(Y,j,X){!0===(X=X||{}).places&&(X.places=0),X.places===1/0&&(X.places=6);const U=j.split("."),ee="string"==typeof X.places&&X.places.indexOf(",");let $=X.places;ee?$=X.places.substring(ee+1):$>=0||($=(U[1]||[]).length),X.round<0||(Y=Number(Y.toFixed(Number($))));const ne=String(Math.abs(Y)).split("."),se=ne[1]||"";if(U[1]||X.places){ee&&(X.places=X.places.substring(0,ee));const ye=void 0!==X.places?X.places:U[1]&&U[1].lastIndexOf("0")+1;ye>se.length&&(ne[1]=se.padEnd(Number(ye),"0")),$<se.length&&(ne[1]=se.substr(0,Number($)))}else ne[1]&&ne.pop();const ae=U[0].replace(",","");let de=ae.indexOf("0");-1!==de&&(de=ae.length-de,de>ne[0].length&&(ne[0]=ne[0].padStart(de,"0")),ae.includes("#")||(ne[0]=ne[0].substr(ne[0].length-de)));let _e,pe,he=U[0].lastIndexOf(",");if(-1!==he){_e=U[0].length-he-1;const ye=U[0].substr(0,he);he=ye.lastIndexOf(","),-1!==he&&(pe=ye.length-he-1)}const ge=[];for(let ye=ne[0];ye;){const Me=ye.length-_e;ge.push(Me>0?ye.substr(Me):ye),ye=Me>0?ye.slice(0,Me):"",pe&&(_e=pe,pe=void 0)}return ne[0]=ge.reverse().join(X.group||","),ne.join(X.decimal||".")}(Y,ae[0],{decimal:ee,group:U,places:X.places,round:X.round}))}(Y,U,j)}const re=/[#0,]*[#0](?:\.0*#*)?/;function Z(Y){const j=Q((Y=Y||{}).locale),X=Y.pattern||j.pattern,U=j.group,ee=j.decimal;let $=1;if(X.includes("%"))$/=100;else if(X.includes("\u2030"))$/=1e3;else if(X.includes("\xa4"))throw new Error("currency notation not supported");const ne=X.split(";");return 1===ne.length&&ne.push("-"+ne[0]),{regexp:oe(ne,ae=>(ae="(?:"+(0,x.Qs)(ae,".")+")").replace(re,de=>{const _e={signed:!1,separator:Y.strict?U:[U,""],fractional:Y.fractional,decimal:ee,exponent:!1},pe=de.split(".");let he=Y.places;1===pe.length&&1!==$&&(pe[1]="###"),1===pe.length||0===he?_e.fractional=!1:(void 0===he&&(he=Y.pattern?pe[1].lastIndexOf("0")+1:1/0),he&&null==Y.fractional&&(_e.fractional=!0),!Y.places&&he<pe[1].length&&(he+=","+pe[1].length),_e.places=he);const ge=pe[0].split(",");return ge.length>1&&(_e.groupSize=ge.pop().length,ge.length>1&&(_e.groupSize2=ge.pop().length)),"("+function ue(Y){"places"in(Y=Y||{})||(Y.places=1/0),"string"!=typeof Y.decimal&&(Y.decimal="."),"fractional"in Y&&!/^0/.test(String(Y.places))||(Y.fractional=[!0,!1]),"exponent"in Y||(Y.exponent=[!0,!1]),"eSigned"in Y||(Y.eSigned=[!0,!1]);const j=ce(Y),X=oe(Y.fractional,ee=>{let $="";return ee&&0!==Y.places&&($="\\"+Y.decimal,Y.places===1/0?$="(?:"+$+"\\d+)?":$+="\\d{"+Y.places+"}"),$},!0);let U=j+X;return X&&(U="(?:(?:"+U+")|(?:"+X+"))"),U+oe(Y.exponent,ee=>ee?"([eE]"+ce({signed:Y.eSigned})+")":"")}(_e)+")"}),!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:U,decimal:ee,factor:$}}function ie(Y,j){const X=Z(j),U=new RegExp("^"+X.regexp+"$").exec(Y);if(!U)return NaN;let ee=U[1];if(!U[1]){if(!U[2])return NaN;ee=U[2],X.factor*=-1}return ee=ee.replace(new RegExp("["+X.group+"\\s\\xa0]","g"),"").replace(X.decimal,"."),Number(ee)*X.factor}function ce(Y){return"signed"in(Y=Y||{})||(Y.signed=[!0,!1]),"separator"in Y?"groupSize"in Y||(Y.groupSize=3):Y.separator="",oe(Y.signed,j=>j?"[-+]":"",!0)+oe(Y.separator,j=>{if(!j)return"(?:\\d+)";" "===(j=(0,x.Qs)(j))?j="\\s":"\xa0"===j&&(j="\\s\\xa0");const X=Y.groupSize,U=Y.groupSize2;if(U){const ee="(?:0|[1-9]\\d{0,"+(U-1)+"}(?:["+j+"]\\d{"+U+"})*["+j+"]\\d{"+X+"})";return X-U>0?"(?:"+ee+"|(?:0|[1-9]\\d{0,"+(X-1)+"}))":ee}return"(?:0|[1-9]\\d{0,"+(X-1)+"}(?:["+j+"]\\d{"+X+"})*)"},!0)}const oe=(Y,j,X)=>{if(!(Y instanceof Array))return j(Y);const U=[];for(let ee=0;ee<Y.length;ee++)U.push(j(Y[ee]));return le(U.join("|"),X)},le=(Y,j)=>"("+(j?"?:":"")+Y+")"},94113:(dt,Re,T)=>{"use strict";T.d(Re,{RB:()=>Q,RH:()=>A,hS:()=>G});var x=T(58817);function A(J,W,B=!1){return re(J,W,B)}function G(J,W){if(null!=W)return W[J]||H(J.split("."),!1,W)}function Q(J,W,B){const Z=J.split("."),ie=Z.pop(),ue=H(Z,!0,B);ue&&ie&&(ue[ie]=W)}function H(J,W,B){let Z=B;for(const ie of J){if(null==Z)return;if(!(ie in Z)){if(!W)return;Z[ie]={}}Z=Z[ie]}return Z}function re(J,W,B){return W?Object.keys(W).reduce((Z,ie)=>{let ue=Z[ie],ce=W[ie];return ue===ce?Z:void 0===ue?(Z[ie]=(0,x.d9)(ce),Z):(Array.isArray(ce)||Array.isArray(Z)?(ue=Z[ie]=ue?Array.isArray(ue)?ue.concat():[ue]:[],ce&&(Array.isArray(ce)||(ce=[ce]),B?ce.forEach(oe=>{ue.includes(oe)||ue.push(oe)}):Z[ie]=ce.concat())):ce&&"object"==typeof ce?Z[ie]=re(ue,ce,B):Z.hasOwnProperty(ie)&&!W.hasOwnProperty(ie)||(Z[ie]=ce),Z)},J||{}):J}},24192:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>J});var G,W,x=T(8314),A=T(27899);(W=G||(G={}))[W.varint=0]="varint",W[W.fixed64=1]="fixed64",W[W.delimited=2]="delimited",W[W.fixed32=5]="fixed32",W[W.unknown=99]="unknown";const Q=4294967296,H=new TextDecoder("utf-8"),re=(0,x.Z)("safari")||(0,x.Z)("ios")?6:(0,x.Z)("ff")?12:32;class J{constructor(B,Z,ie=0,ue=(B?B.byteLength:0)){this._tag=0,this._dataType=G.unknown,this._init(B,Z,ie,ue)}_init(B,Z,ie,ue){this._data=B,this._dataView=Z,this._pos=ie,this._end=ue}clone(){return new J(this._data,this._dataView,this._pos,this._end)}pos(){return this._pos}move(B){this._pos=B}nextTag(B){for(;;){if(this._pos===this._end)return!1;const Z=this._decodeVarint();if(this._tag=Z>>3,this._dataType=7&Z,!B||B===this._tag)break;this.skip()}return!0}next(){if(this._pos===this._end)return!1;const B=this._decodeVarint();return this._tag=B>>3,this._dataType=7&B,!0}empty(){return this._pos>=this._end}tag(){return this._tag}getInt32(){return this._decodeVarint()}getInt64(){return this._decodeVarint()}getUInt32(){let B=4294967295;return B=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?B:(B=(B|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?B:(B=(B|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?B:(B=(B|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?B:(B=(B|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?B:void 0))))}getUInt64(){return this._decodeVarint()}getSInt32(){const B=this.getUInt32();return B>>>1^-(1&B)|0}getSInt64(){return this._decodeSVarint()}getBool(){const B=0!==this._data[this._pos];return this._skip(1),B}getEnum(){return this._decodeVarint()}getFixed64(){const B=this._dataView,Z=this._pos,ie=B.getUint32(Z,!0)+B.getUint32(Z+4,!0)*Q;return this._skip(8),ie}getSFixed64(){const B=this._dataView,Z=this._pos,ie=B.getUint32(Z,!0)+B.getInt32(Z+4,!0)*Q;return this._skip(8),ie}getDouble(){const B=this._dataView.getFloat64(this._pos,!0);return this._skip(8),B}getFixed32(){const B=this._dataView.getUint32(this._pos,!0);return this._skip(4),B}getSFixed32(){const B=this._dataView.getInt32(this._pos,!0);return this._skip(4),B}getFloat(){const B=this._dataView.getFloat32(this._pos,!0);return this._skip(4),B}getString(){const B=this._getLength(),Z=this._pos,ie=this._toString(this._data,Z,Z+B);return this._skip(B),ie}getBytes(){const B=this._getLength(),Z=this._pos,ie=this._toBytes(this._data,Z,Z+B);return this._skip(B),ie}getLength(){return this._getLengthUnsafe()}processMessageWithArgs(B,Z,ie,ue){const ce=this.getMessage(),oe=B(ce,Z,ie,ue);return ce.release(),oe}processMessage(B){const Z=this.getMessage(),ie=B(Z);return Z.release(),ie}getMessage(){const B=this._getLength(),Z=J.pool.acquire();return Z._init(this._data,this._dataView,this._pos,this._pos+B),this._skip(B),Z}release(){J.pool.release(this)}dataType(){return this._dataType}skip(){switch(this._dataType){case G.varint:this._decodeVarint();break;case G.fixed64:this._skip(8);break;case G.delimited:this._skip(this._getLength());break;case G.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}skipLen(B){this._skip(B)}_skip(B){if(this._pos+B>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=B}_decodeVarint(){const B=this._data;let Z,ie=this._pos,ue=0;if(this._end-ie>=10)do{if(Z=B[ie++],ue|=127&Z,0==(128&Z)||(Z=B[ie++],ue|=(127&Z)<<7,0==(128&Z))||(Z=B[ie++],ue|=(127&Z)<<14,0==(128&Z))||(Z=B[ie++],ue|=(127&Z)<<21,0==(128&Z))||(Z=B[ie++],ue+=268435456*(127&Z),0==(128&Z))||(Z=B[ie++],ue+=34359738368*(127&Z),0==(128&Z))||(Z=B[ie++],ue+=4398046511104*(127&Z),0==(128&Z))||(Z=B[ie++],ue+=562949953421312*(127&Z),0==(128&Z))||(Z=B[ie++],ue+=72057594037927940*(127&Z),0==(128&Z))||(Z=B[ie++],ue+=0x8000000000000000*(127&Z),0==(128&Z)))break;throw new Error("Varint too long!")}while(0);else{let ce=1;for(;ie!==this._end&&(Z=B[ie],0!=(128&Z));)++ie,ue+=(127&Z)*ce,ce*=128;if(ie===this._end)throw new Error("Varint overrun!");++ie,ue+=Z*ce}return this._pos=ie,ue}_decodeSVarint(){const B=this._decodeVarint();return B%2?-(B+1)/2:B/2}_getLength(){if(this._dataType!==G.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}_getLengthUnsafe(){return this.getUInt32()}_toString(B,Z,ie){if((ie=Math.min(this._end,ie))-Z>re){const oe=B.subarray(Z,ie);return H.decode(oe)}let ue="",ce="";for(let oe=Z;oe<ie;++oe){const le=B[oe];128&le?ce+="%"+le.toString(16):(ue+=decodeURIComponent(ce)+String.fromCharCode(le),ce="")}return ce.length&&(ue+=decodeURIComponent(ce)),ue}_toBytes(B,Z,ie){return ie=Math.min(this._end,ie),new Uint8Array(B.buffer,Z,ie-Z)}}J.pool=new A.Z(J,null,W=>{W._data=null,W._dataView=null})},10699:(dt,Re,T)=>{"use strict";T.d(Re,{$F:()=>X,Bx:()=>Ge,D_:()=>$,Ds:()=>Ce,H9:()=>Y,Hc:()=>oe,Hl:()=>U,R8:()=>ne,U3:()=>ae,WW:()=>ge,Yn:()=>xe,as:()=>pe,dD:()=>_e,e4:()=>Me,fu:()=>j,gx:()=>me,hh:()=>Ie,k_:()=>ue,r9:()=>le,vr:()=>Je,y8:()=>Te,zE:()=>ie});var x=T(15861),A=T(84244),Q=(T(55538),T(26584)),H=T(17770),re=T(63290),J=T(62208);function ie(We="Aborted"){return new Q.Z("AbortError",We)}function ue(We,Ne="Aborted"){if(oe(We))throw ie(Ne)}function ce(We){return(0,J.pC)(We)?"aborted"in We?We:We.signal:We}function oe(We){const Ne=ce(We);return(0,J.pC)(Ne)&&Ne.aborted}function le(We){if($(We))throw We}function Y(We){if(!$(We))throw We}function j(We,Ne){const we=ce(We);if(!(0,J.Wi)(we)){if(!we.aborted)return(0,H.IH)(we,"abort",()=>Ne());Ne()}}function X(We,Ne){const we=ce(We);if(!(0,J.Wi)(we))return ue(we),(0,H.IH)(we,"abort",()=>Ne(ie()))}function U(We,Ne){const we=ce(Ne);return(0,J.Wi)(we)?We:new Promise((Oe,$e)=>{let Be=j(Ne,()=>$e(ie()));const Se=()=>Be=(0,J.hw)(Be);We.then(Se,Se),We.then(Oe,$e)})}function $(We){return We&&"AbortError"===We.name}function ne(We){return se.apply(this,arguments)}function se(){return(se=(0,x.Z)(function*(We){try{return yield We}catch(Ne){if(!$(Ne))throw Ne}})).apply(this,arguments)}function ae(We){return de.apply(this,arguments)}function de(){return(de=(0,x.Z)(function*(We,Ne=re.Z.getLogger("esri")){try{return yield We}catch(we){$(we)||Ne.error(we)}})).apply(this,arguments)}function _e(){let We=null;const Ne=new Promise((we,Oe)=>{We={promise:void 0,resolve:we,reject:Oe}});return We.promise=Ne,We}function pe(We){return he.apply(this,arguments)}function he(){return(he=(0,x.Z)(function*(We){if(!We)return;if("function"!=typeof We.forEach){const we=Object.keys(We),Oe=we.map(Se=>We[Se]),$e=yield pe(Oe),Be={};return we.map((Se,De)=>Be[Se]=$e[De]),Be}const Ne=We;return new Promise(we=>{const Oe=[];let $e=Ne.length;0===$e&&we(Oe),Ne.forEach(Be=>{const Se={promise:Be||Promise.resolve(Be)};Oe.push(Se),Se.promise.then(De=>{Se.value=De}).catch(De=>{Se.error=De}).then(()=>{--$e,0===$e&&we(Oe)})})})})).apply(this,arguments)}function ge(We){return ye.apply(this,arguments)}function ye(){return(ye=(0,x.Z)(function*(We){return(yield pe(We)).filter(Ne=>!!Ne.value).map(Ne=>Ne.value)})).apply(this,arguments)}function Me(We,Ne,we){const Oe=new AbortController;return j(we,()=>Oe.abort()),new Promise(($e,Be)=>{let Se=setTimeout(()=>{Se=0,$e(Ne)},We);j(Oe,()=>{Se&&(clearTimeout(Se),Be(ie()))})})}function Te(We){return We&&"function"==typeof We.then}function me(We){return Te(We)?We:Promise.resolve(We)}function Ce(We,Ne=-1){let we,Oe,$e,Be,Se=null;const De=(...Fe)=>{if(we){Oe=Fe,Be&&Be.reject(ie()),Be=_e();const be=(0,J.j0)(Be.promise);if(Se){const tt=Se;Se=null,tt.abort()}return be}if($e=Be||_e(),Be=null,Ne>0){const be=new AbortController;we=me(We(...Fe,be.signal));const tt=we;Me(Ne).then(()=>{we===tt&&(Be?be.abort():Se=be)})}else we=1,we=me(We(...Fe));const ve=()=>{const be=Oe;Oe=$e=we=Se=null,null!=be&&De(...be)},Ke=we,qe=$e;return Ke.then(ve,ve),Ke.then(qe.resolve,qe.reject),(0,J.j0)(qe.promise)};return De}function Ie(){let We,Ne;const we=new Promise(($e,Be)=>{We=$e,Ne=Be}),Oe=$e=>{We($e)};return Oe.resolve=$e=>We($e),Oe.reject=$e=>Ne($e),Oe.timeout=($e,Be)=>A.m.setTimeout(()=>Oe.reject(Be),$e),Oe.promise=we,Oe}function Ge(We,Ne){return We.then(Ne,Ne)}function Je(We,Ne){let we,Oe=new AbortController;const $e=We(Oe.signal);let Be={promise:$e,finished:!1,abort:()=>{Oe&&(Oe.abort(),Oe=null)}};const Se=()=>{Be&&(Be.finished=!0,Be=null),(0,J.pC)(we)&&(we.remove(),we=null),Oe=null};return $e.then(Se,Se),we=j(Ne,()=>{(0,J.pC)(Be)&&Be.abort()}),Be}function xe(We){return je.apply(this,arguments)}function je(){return(je=(0,x.Z)(function*(We){yield Promise.resolve(),ue(We)})).apply(this,arguments)}},32917:(dt,Re,T)=>{"use strict";T.d(Re,{N1:()=>ue,Wy:()=>Y,YP:()=>J,Z_:()=>j,gx:()=>W,nn:()=>X,on:()=>Z,tX:()=>U});var x=T(17770),A=T(54024),G=T(62208),Q=T(10699),H=T(30755);function J(ee,$,ne={}){return B(ee,$,ne,oe)}function W(ee,$,ne={}){return B(ee,$,ne,le)}function B(ee,$,ne={},se){let ae=null;const de=ne.once?(_e,pe)=>{se(_e)&&((0,G.hw)(ae),$(_e,pe))}:(_e,pe)=>{se(_e)&&$(_e,pe)};if(ae=(0,H.aQ)(ee,de,ne.sync,ne.equals),ne.initial){const _e=ee();de(_e,_e)}return ae}function Z(ee,$,ne,se={}){let ae=null,de=null,_e=null;function pe(){var ye;ae&&de&&(de.remove(),null==(ye=se.onListenerRemove)||ye.call(se,ae),ae=null,de=null)}function he(ye){se.once&&se.once&&(0,G.hw)(_e),ne(ye)}const ge=J(ee,(ye,Me)=>{var Ee;pe(),(0,x.vT)(ye)&&(ae=ye,de=(0,x.on)(ye,$,he),null==(Ee=se.onListenerAdd)||Ee.call(se,ye))},{sync:se.sync,initial:!0});return _e=(0,A.kB)(()=>{ge.remove(),pe()}),_e}function ue(ee,$){return function ce(ee,$,ne){if((0,Q.Hc)(ne))return Promise.reject((0,Q.zE)());const se=ee();if(null==$?void 0:$(se))return Promise.resolve(se);let ae=null;function de(){ae=(0,G.hw)(ae)}return new Promise((_e,pe)=>{ae=(0,A.AL)([(0,Q.fu)(ne,()=>{de(),pe((0,Q.zE)())}),B(ee,he=>{de(),_e(he)},{sync:!1,once:!0},null!=$?$:oe)])})}(ee,le,$)}function oe(ee){return!0}function le(ee){return!!ee}function Y(ee,$,ne={}){let se=!1;const ae=J(ee,(de,_e)=>{se||$(de,_e)},ne);return{remove(){ae.remove()},pause(){se=!0},resume(){se=!1}}}T(21352);const j={sync:!0},X={initial:!0},U={sync:!0,initial:!0}},50618:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>X,MU:()=>pe,Os:()=>j,bP:()=>$});var x=T(62208),A=T(79682),G=T(73362),Q=T(77029),H=T(10699),re=T(27422);class J{constructor(Ee){this.phases=Ee,this.paused=!1,this.ticks=-1,this.removed=!1}}class W{constructor(Ee){this.callback=Ee,this.isActive=!0}remove(){this.isActive=!1}}let B=0,Z=0;const ie={time:(0,re.HA)(0),deltaTime:(0,re.HA)(0),elapsedFrameTime:(0,re.HA)(0),frameDuration:(0,re.HA)(0)},ue=["prepare","preRender","render","postRender","update","finish"],ce=[],oe=new Q.Z;class le{constructor(Ee){this._task=Ee}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}}const Y={frameTasks:oe,willDispatch:!1,clearFrameTasks:function ee(Me=!1){oe.forAll(Ee=>{Ee.removed=!0}),Me&&de()},dispatch:_e,executeFrameTasks:function se(Me){const Ee=(0,re.HA)(Me-B);B=Me;const Te=Z>0?Z:1e3/60,me=Math.max(0,Ee-Te);for(let Ce=0;Ce<ue.length;Ce++){const Ie=performance.now(),Ge=ue[Ce];oe.forAll(Je=>{var xe;Je.paused||Je.removed||(0===Ce&&Je.ticks++,Je.phases[Ge]&&(ie.time=Me,ie.deltaTime=0===Je.ticks?(0,re.HA)(0):Ee,ie.elapsedFrameTime=(0,re.HA)(performance.now()-Me),ie.frameDuration=(0,re.HA)(Te-me),null==(xe=Je.phases[Ge])||xe.call(Je,ie)))}),ge[Ce].record(performance.now()-Ie)}de(),ye.record(performance.now()-Me)}};function j(Me){const Ee=new W(Me);return ce.push(Ee),Y.willDispatch||(Y.willDispatch=!0,(0,A.Y)(_e)),Ee}function X(Me){const Ee=new J(Me);return oe.push(Ee),null==U&&(B=performance.now(),U=requestAnimationFrame(ne)),new le(Ee)}let U=null;function $(Me){Z=Math.max(0,Me)}function ne(){const Me=performance.now();U=null,U=oe.length>0?requestAnimationFrame(ne):null,Y.executeFrameTasks(Me)}const ae=new Q.Z;function de(){oe.forAll(Me=>{Me.removed&&ae.push(Me)}),oe.removeUnorderedMany(ae.data,ae.length),ae.clear()}function _e(){for(;ce.length;){const Me=(0,x.j0)(ce.shift());Me.isActive&&Me.callback()}Y.willDispatch=!1}function pe(Me=1,Ee){const Te=(0,H.hh)(),me=()=>{(0,H.Hc)(Ee)?Te.reject((0,H.zE)()):0===Me?Te():(--Me,(0,A.Y)(()=>me()))};return me(),Te.promise}const ge=ue.map(Me=>new G.Z(Me)),ye=new G.Z("total")},23841:(dt,Re,T)=>{"use strict";T.d(Re,{F2:()=>Q,J$:()=>ie,So:()=>ue,Wv:()=>ce,Wz:()=>H,c$:()=>oe,gX:()=>Z,md:()=>Y,s1:()=>W,t_:()=>re,vW:()=>J});const x=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function Q(j){return j?j/72*96:0}function H(j){return j?72*j/96:0}function re(j){if("string"==typeof j){const X=j.match(x);if(X){const U=Number(X[1]),ee=X[3]&&X[3].toLowerCase(),$="-"===j.charAt(0),ne="px"===ee?H(U):U;return $?-ne:ne}return console.warn("screenUtils.toPt: input not recognized!"),null}return j}function J(j=0,X=0){return{x:j,y:X}}function W(j=0,X=0){return[j,X]}function Z(j=0,X=0){return[j,X]}function ie(j=0,X=0,U=0){return[j,X,U]}function ue(j){return j}function ce(j){return j}function oe(j){return j}function Y(j,X){return X?(X[0]=j.x,X[1]=j.y,X.length>2&&(X[2]=0),X):[j.x,j.y]}},95737:(dt,Re,T)=>{"use strict";T.d(Re,{E:()=>G,_:()=>H});var x=T(15861),A=T(62208);function G(re,J){return Q.apply(this,arguments)}function Q(){return(Q=(0,x.Z)(function*(re,J){const{WhereClause:W}=yield Promise.resolve().then(T.bind(T,10410));return W.create(re,J)})).apply(this,arguments)}function H(re,J){return(0,A.pC)(re)?(0,A.pC)(J)?`(${re}) AND (${J})`:re:J}},10410:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{WhereClause:()=>pe,defaultAttributeAdapter:()=>$e});var x=T(8314);const Q={min:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.min.apply(Math,Be[0])},max:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.max.apply(Math,Be[0])},avg:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:H(Be[0])},sum:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:function re(Be){let Se=0;for(let De=0;De<Be.length;De++)Se+=Be[De];return Se}(Be[0])},stddev:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.sqrt(J(Be[0]))},count:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Be[0].length},var:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:J(Be[0])}};function H(Be){let Se=0;for(let De=0;De<Be.length;De++)Se+=Be[De];return Se/Be.length}function J(Be){const Se=H(Be),De=Be.length;let Fe=0;for(const ve of Be)Fe+=(ve-Se)**2;return De>1?Fe/(De-1):0}var W=T(77275);class B{constructor(){this.op="+",this.day=0,this.second=0,this.hour=0,this.month=0,this.year=0,this.minute=0}static _fixDefaults(Se){if(null!==Se.precision||null!==Se.secondary)throw new Error("Primary and Secondary SqlInterval qualifiers not supported")}static createFromMilliseconds(Se){const De=new B;return De.second=Se/1e3,De}static createFromValueAndQualifer(Se,De,Fe){let ve=null;const Ke=new B;if(Ke.op="-"===Fe?"-":"+","interval-period"===De.type){B._fixDefaults(De);const qe=new RegExp("^[0-9]{1,}$");if("year"===De.period||"month"===De.period)throw new Error("Year-Month Intervals not supported");if(!qe.test(Se))throw new Error("Illegal Interval");Ke[De.period]=parseFloat(Se)}else{if(B._fixDefaults(De.start),B._fixDefaults(De.end),"year"===De.start.period||"month"===De.start.period)throw new Error("Year-Month Intervals not supported");if("year"===De.end.period||"month"===De.end.period)throw new Error("Year-Month Intervals not supported");switch(De.start.period){case"day":switch(De.end.period){case"hour":if(ve=new RegExp("^[0-9]{1,} [0-9]{1,}$"),!ve.test(Se))throw new Error("Illegal Interval");Ke[De.start.period]=parseFloat(Se.split(" ")[0]),Ke[De.end.period]=parseFloat(Se.split(" ")[1]);break;case"minute":if(ve=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$"),!ve.test(Se))throw new Error("Illegal Interval");{Ke[De.start.period]=parseFloat(Se.split(" ")[0]);const qe=Se.split(" ")[1].split(":");Ke.hour=parseFloat(qe[0]),Ke.minute=parseFloat(qe[1])}break;case"second":if(ve=new RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!ve.test(Se))throw new Error("Illegal Interval");{Ke[De.start.period]=parseFloat(Se.split(" ")[0]);const qe=Se.split(" ")[1].split(":");Ke.hour=parseFloat(qe[0]),Ke.minute=parseFloat(qe[1]),Ke.second=parseFloat(qe[2])}break;default:throw new Error("Invalid Interval.")}break;case"hour":switch(De.end.period){case"minute":if(ve=new RegExp("^[0-9]{1,}:[0-9]{1,}$"),!ve.test(Se))throw new Error("Illegal Interval");Ke.hour=parseFloat(Se.split(":")[0]),Ke.minute=parseFloat(Se.split(":")[1]);break;case"second":if(ve=new RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!ve.test(Se))throw new Error("Illegal Interval");{const qe=Se.split(":");Ke.hour=parseFloat(qe[0]),Ke.minute=parseFloat(qe[1]),Ke.second=parseFloat(qe[2])}break;default:throw new Error("Invalid Interval.")}break;case"minute":if("second"!==De.end.period)throw new Error("Invalid Interval.");if(ve=new RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$"),!ve.test(Se))throw new Error("Illegal Interval");{const qe=Se.split(":");Ke.minute=parseFloat(qe[0]),Ke.second=parseFloat(qe[1])}break;default:throw new Error("Invalid Interval.")}}return Ke}valueInMilliseconds(){return("-"===this.op?-1:1)*(1e3*this.second+60*this.minute*1e3+60*this.hour*60*1e3+24*this.day*60*60*1e3+this.month*(365/12)*24*60*60*1e3+365*this.year*24*60*60*1e3)}}function Z(Be,Se){const De=ue[Be.toLowerCase()];if(null==De)throw new Error("Function Not Recognised");if(Se.length<De.minParams||Se.length>De.maxParams)throw new Error(`Invalid Parameter count for call to ${Be.toUpperCase()}`);return De.evaluate(Se)}const ue={extract:{minParams:2,maxParams:2,evaluate:([Be,Se])=>{if(null==Se)return null;if(Se instanceof Date)switch(Be.toUpperCase()){case"SECOND":return Se.getSeconds();case"MINUTE":return Se.getMinutes();case"HOUR":return Se.getHours();case"DAY":return Se.getDate();case"MONTH":return Se.getMonth()+1;case"YEAR":return Se.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:Be=>{if(2===Be.length){const[Se,De]=Be;return null==Se||null==De?null:Se.toString().substring(De-1)}if(3===Be.length){const[Se,De,Fe]=Be;return null==Se||null==De||null==Fe?null:Fe<=0?"":Se.toString().substring(De-1,De+Fe-1)}}},position:{minParams:2,maxParams:2,evaluate:([Be,Se])=>null==Be||null==Se?null:Se.indexOf(Be)+1},trim:{minParams:2,maxParams:3,evaluate:Be=>{const Se=3===Be.length,De=Se?Be[1]:" ",Fe=Se?Be[2]:Be[1];if(null==De||null==Fe)return null;const ve=`(${(0,W.Qs)(De)})`;switch(Be[0]){case"BOTH":return Fe.replace(new RegExp(`^${ve}*|${ve}*$`,"g"),"");case"LEADING":return Fe.replace(new RegExp(`^${ve}*`,"g"),"");case"TRAILING":return Fe.replace(new RegExp(`${ve}*$`,"g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.abs(Be[0])},ceiling:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.ceil(Be[0])},floor:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.floor(Be[0])},log:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.log(Be[0])},log10:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.log(Be[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.sin(Be[0])},cos:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.cos(Be[0])},tan:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.tan(Be[0])},asin:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.asin(Be[0])},acos:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.acos(Be[0])},atan:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Math.atan(Be[0])},sign:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Be[0]>0?1:Be[1]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:Be=>null==Be[0]||null==Be[1]?null:Be[0]**Be[1]},mod:{minParams:2,maxParams:2,evaluate:Be=>null==Be[0]||null==Be[1]?null:Be[0]%Be[1]},round:{minParams:1,maxParams:2,evaluate:Be=>{const Se=Be[0],De=2===Be.length?10**Be[1]:1;return null==Se?null:Math.round(Se*De)/De}},truncate:{minParams:1,maxParams:2,evaluate:Be=>null==Be[0]?null:1===Be.length?parseInt(Be[0].toFixed(0),10):parseFloat(Be[0].toFixed(Be[1]))},char_length:{minParams:1,maxParams:1,evaluate:Be=>"string"==typeof Be[0]||Be[0]instanceof String?Be[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:Be=>{let Se="";for(let De=0;De<Be.length;De++){if(null==Be[De])return null;Se+=Be[De].toString()}return Se}},lower:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Be[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:Be=>null==Be[0]?null:Be[0].toString().toUpperCase()}};T(1719);var oe,Y={exports:{}};(oe=Y).exports&&(oe.exports=function(){function Se(ve,Ke,qe,be){var tt=Error.call(this,ve);return Object.setPrototypeOf&&Object.setPrototypeOf(tt,Se.prototype),tt.expected=Ke,tt.found=qe,tt.location=be,tt.name="SyntaxError",tt}function De(ve,Ke,qe){return qe=qe||" ",ve.length>Ke?ve:ve+(qe+=qe.repeat(Ke-=ve.length)).slice(0,Ke)}return function Be(ve,Ke){function qe(){this.constructor=ve}qe.prototype=Ke.prototype,ve.prototype=new qe}(Se,Error),Se.prototype.format=function(ve){var Ke="Error: "+this.message;if(this.location){var qe,be=null;for(qe=0;qe<ve.length;qe++)if(ve[qe].source===this.location.source){be=ve[qe].text.split(/\r\n|\n|\r/g);break}var tt=this.location.start,Ye=this.location.source+":"+tt.line+":"+tt.column;if(be){var ze=this.location.end,et=De("",tt.line.toString().length),ke=be[tt.line-1],ot=tt.line===ze.line?ze.column:ke.length+1;Ke+="\n --\x3e "+Ye+"\n"+et+" |\n"+tt.line+" | "+ke+"\n"+et+" | "+De("",tt.column-1)+De("",ot-tt.column,"^")}else Ke+="\n at "+Ye}return Ke},Se.buildMessage=function(ve,Ke){var qe={literal:function(ot){return'"'+tt(ot.text)+'"'},class:function(ot){var at=ot.parts.map(function(yt){return Array.isArray(yt)?Ye(yt[0])+"-"+Ye(yt[1]):Ye(yt)});return"["+(ot.inverted?"^":"")+at+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(ot){return ot.description}};function be(ot){return ot.charCodeAt(0).toString(16).toUpperCase()}function tt(ot){return ot.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(at){return"\\x0"+be(at)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(at){return"\\x"+be(at)})}function Ye(ot){return ot.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(at){return"\\x0"+be(at)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(at){return"\\x"+be(at)})}function ze(ot){return qe[ot.type](ot)}return"Expected "+function et(ot){var at,yt,wt=ot.map(ze);if(wt.sort(),wt.length>0){for(at=1,yt=1;at<wt.length;at++)wt[at-1]!==wt[at]&&(wt[yt]=wt[at],yt++);wt.length=yt}switch(wt.length){case 1:return wt[0];case 2:return wt[0]+" or "+wt[1];default:return wt.slice(0,-1).join(", ")+", or "+wt[wt.length-1]}}(ve)+" but "+function ke(ot){return ot?'"'+tt(ot)+'"':"end of input"}(Ke)+" found."},{SyntaxError:Se,parse:function Fe(ve,Ke){var qe,be={},tt=(Ke=void 0!==Ke?Ke:{}).grammarSource,Ye={start:Vs},ze=Vs,ds=/^[A-Za-z_\x80-\uFFFF]/,Mt=/^[A-Za-z0-9_]/,Hr=/^[A-Za-z0-9_.\x80-\uFFFF]/,Ir=/^[^']/,gi=/^[0-9]/,Ui=/^[eE]/,is=/^[+\-]/,ss=/^[ \t\n\r]/,ts=/^[^`]/,ys=fi("!",!1),ps=fi("=",!1),Ds=fi(">=",!1),Ps=fi(">",!1),ms=fi("<=",!1),Un=fi("<>",!1),gr=fi("<",!1),Sr=fi("!=",!1),mr=fi("+",!1),Wr=fi("-",!1),Di=fi("*",!1),Wi=fi("/",!1),ns=ci([["A","Z"],["a","z"],"_",["\x80","\uffff"]],!1,!1),Yi=ci([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),hs=ci([["A","Z"],["a","z"],["0","9"],"_",".",["\x80","\uffff"]],!1,!1),Ks=fi("@",!1),Ms=fi("'",!1),Zs=fi("N'",!1),tn=fi("''",!1),So=ci(["'"],!0,!1),Bn=fi(".",!1),_o=ci([["0","9"]],!1,!1),to=ci(["e","E"],!1,!1),Vn=ci(["+","-"],!1,!1),Pa=fi("NULL",!0),fa=fi("TRUE",!0),Yo=fi("FALSE",!0),_a=fi("IN",!0),ia=fi("IS",!0),Xs=fi("LIKE",!0),ro=fi("ESCAPE",!0),xa=fi("NOT",!0),xo=fi("AND",!0),ti=fi("OR",!0),Nn=fi("BETWEEN",!0),Wa=fi("FROM",!0),zo=fi("FOR",!0),nn=fi("SUBSTRING",!0),cs=fi("EXTRACT",!0),Yn=fi("TRIM",!0),Jn=fi("POSITION",!0),us=fi("TIMESTAMP",!0),ma=fi("DATE",!0),Ht=fi("LEADING",!0),kt=fi("TRAILING",!0),ur=fi("BOTH",!0),Tr=fi("TO",!0),_r=fi("INTERVAL",!0),Gr=fi("YEAR",!0),oi=fi("MONTH",!0),At=fi("DAY",!0),Bt=fi("HOUR",!0),vr=fi("MINUTE",!0),kr=fi("SECOND",!0),ai=fi("CASE",!0),Hi=fi("END",!0),fs=fi("WHEN",!0),Tn=fi("THEN",!0),On=fi("ELSE",!0),rn=fi(",",!1),hn=fi("(",!1),no=fi(")",!1),Sn=ci([" ","\t","\n","\r"],!1,!1),Va=fi("`",!1),ud=ci(["`"],!0,!1),Vi=function(Ve,gt){return ar(Ve,gt)},bl=function(Ve){return Ve[0]+" "+Ve[2]},al=function(Ve,gt){return Ve+gt.join("")},za=function(Ve){return{type:"interval-period",period:Ve.value,precision:null,secondary:null}},zn=function(Ve,gt){return{type:"interval-period",period:"second",precision:Ve,secondary:gt}},Ga=function(Ve){return parseFloat(Ve)},Mh=function(Ve,gt){return{type:"when-clause",operand:Ve,value:gt}},rt=0,dr=[{line:1,column:1}],wr=0,$t=[],Or=0;if("startRule"in Ke){if(!(Ke.startRule in Ye))throw new Error("Can't start parsing from rule \""+Ke.startRule+'".');ze=Ye[Ke.startRule]}function fi(Ve,gt){return{type:"literal",text:Ve,ignoreCase:gt}}function ci(Ve,gt,Pt){return{type:"class",parts:Ve,inverted:gt,ignoreCase:Pt}}function _s(Ve){var gt,Pt=dr[Ve];if(Pt)return Pt;for(gt=Ve-1;!dr[gt];)gt--;for(Pt={line:(Pt=dr[gt]).line,column:Pt.column};gt<Ve;)10===ve.charCodeAt(gt)?(Pt.line++,Pt.column=1):Pt.column++,gt++;return dr[Ve]=Pt,Pt}function Ri(Ve){rt<wr||(rt>wr&&(wr=rt,$t=[]),$t.push(Ve))}function Vs(){var Ve,gt;return Ve=rt,bi(),(gt=co())!==be?(bi(),Ve=gt):(rt=Ve,Ve=be),Ve}function po(){var Ve,gt,Pt,Yt,Jr,Mi,Pi,Si;if(Ve=rt,(gt=co())!==be){for(Pt=[],Yt=rt,Jr=bi(),(Mi=jo())!==be?(Pi=bi(),(Si=co())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Yt!==be;)Pt.push(Yt),Yt=rt,Jr=bi(),(Mi=jo())!==be?(Pi=bi(),(Si=co())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Ve=function(Ve,gt){var Pt={type:"expression-list"},Yt=function Gt(Ve,gt,Pt){return function xt(Ve,gt){for(var Pt=[Ve],Yt=0;Yt<gt.length;Yt++)Pt.push(gt[Yt][3]);return Pt}(Ve,gt)}(Ve,gt);return Pt.value=Yt,Pt}(gt,Pt)}else rt=Ve,Ve=be;return Ve}function co(){var Ve,gt,Pt,Yt,Jr,Mi,Pi,Si;if(Ve=rt,(gt=cn())!==be){for(Pt=[],Yt=rt,Jr=bi(),(Mi=Rh())!==be?(Pi=bi(),(Si=cn())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Yt!==be;)Pt.push(Yt),Yt=rt,Jr=bi(),(Mi=Rh())!==be?(Pi=bi(),(Si=cn())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Ve=Vi(gt,Pt)}else rt=Ve,Ve=be;return Ve}function cn(){var Ve,gt,Pt,Yt,Jr,Mi,Pi,Si;if(Ve=rt,(gt=ac())!==be){for(Pt=[],Yt=rt,Jr=bi(),(Mi=Ec())!==be?(Pi=bi(),(Si=ac())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Yt!==be;)Pt.push(Yt),Yt=rt,Jr=bi(),(Mi=Ec())!==be?(Pi=bi(),(Si=ac())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Ve=Vi(gt,Pt)}else rt=Ve,Ve=be;return Ve}function ac(){var Ve,gt,Pt,Yt,Jr;return Ve=rt,(gt=qd())===be&&(gt=rt,33===ve.charCodeAt(rt)?(Pt="!",rt++):(Pt=be,0===Or&&Ri(ys)),Pt!==be?(Yt=rt,Or++,61===ve.charCodeAt(rt)?(Jr="=",rt++):(Jr=be,0===Or&&Ri(ps)),Or--,Jr===be?Yt=void 0:(rt=Yt,Yt=be),Yt!==be?gt=Pt=[Pt,Yt]:(rt=gt,gt=be)):(rt=gt,gt=be)),gt!==be?(Pt=bi(),(Yt=ac())!==be?Ve=function(Ve){return function ut(Ve,gt){return{type:"unary-expression",operator:Ve,expr:gt}}("NOT",Ve)}(Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=function oo(){var Ve,gt,Pt;return Ve=rt,(gt=dl())!==be?(bi(),(Pt=function Zd(){var Ve;return(Ve=function dp(){var Ve,gt,Pt,Yt,Jr,Mi;if(Ve=[],gt=rt,Pt=bi(),(Yt=lc())!==be?(Jr=bi(),(Mi=dl())!==be?gt=Pt=[Pt,Yt,Jr,Mi]:(rt=gt,gt=be)):(rt=gt,gt=be),gt!==be)for(;gt!==be;)Ve.push(gt),gt=rt,Pt=bi(),(Yt=lc())!==be?(Jr=bi(),(Mi=dl())!==be?gt=Pt=[Pt,Yt,Jr,Mi]:(rt=gt,gt=be)):(rt=gt,gt=be);else Ve=be;return Ve!==be&&(Ve=function(Ve){return{type:"arithmetic",tail:Ve}}(Ve)),Ve}())===be&&(Ve=function hu(){var Ve,gt,Pt,Yt;return Ve=rt,(gt=ks())!==be?(bi(),(Pt=La())!==be?(bi(),(Yt=po())!==be?(bi(),Qn()!==be?Ve=function(Ve,gt){return{op:Ve,right:gt}}(gt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=ks())!==be?(bi(),(Pt=La())!==be?(bi(),(Yt=Qn())!==be?Ve=function(Ve){return{op:Ve,right:{type:"expression-list",value:[]}}}(gt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=ks())!==be?(bi(),(Pt=uc())!==be?Ve=function(Ve,gt){return{op:Ve,right:gt}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be))),Ve}())===be&&(Ve=function Ho(){var Ve,gt,Pt,Yt,Jr,Mi;return Ve=rt,(gt=qd())!==be?(bi(),(Pt=Ed())!==be?(bi(),(Yt=dl())!==be?(bi(),(Jr=Ec())!==be?(bi(),(Mi=dl())!==be?Ve=function(Ve,gt,Pt){return{op:"NOT"+Ve,right:{type:"expression-list",value:[gt,Pt]}}}(Pt,Yt,Mi):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=Ed())!==be?(bi(),(Pt=dl())!==be?(bi(),(Yt=Ec())!==be?(bi(),(Jr=dl())!==be?Ve=function(Ve,gt,Pt){return{op:Ve,right:{type:"expression-list",value:[gt,Pt]}}}(gt,Pt,Jr):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)),Ve}())===be&&(Ve=function Vl(){var Ve,gt,Pt,Yt;return Ve=rt,(gt=Us())!==be?(bi(),(Pt=qd())!==be?(bi(),(Yt=dl())!==be?Ve=function(Ve,gt){return{op:Ve+"NOT",right:gt}}(gt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=Us())!==be?(bi(),(Pt=dl())!==be?Ve=function(Ve,gt){return{op:Ve,right:gt}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)),Ve}())===be&&(Ve=function kd(){var Ve,gt,Pt,Yt;return Ve=rt,(gt=$d())!==be?(bi(),(Pt=Hu())!==be?(bi(),function mp(){var Ve,gt,Pt,Yt;return Ve=rt,"escape"===ve.substr(rt,6).toLowerCase()?(gt=ve.substr(rt,6),rt+=6):(gt=be,0===Or&&Ri(ro)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="ESCAPE":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()!==be?(bi(),(Yt=Gl())!==be?Ve=function(Ve,gt,Pt){return{op:Ve,right:gt,escape:Pt.value}}(gt,Pt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=$d())!==be?(bi(),(Pt=Hu())!==be?Ve=function(Ve,gt){return{op:Ve,right:gt,escape:""}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)),Ve}()),Ve}())===be&&(Pt=null),Ve=function(Ve,gt){return""==gt||null==gt||null==gt?Ve:"arithmetic"==gt.type?ar(Ve,gt.tail):Et(gt.op,Ve,gt.right,gt.escape)}(gt,Pt)):(rt=Ve,Ve=be),Ve}()),Ve}function lc(){var Ve;return">="===ve.substr(rt,2)?(Ve=">=",rt+=2):(Ve=be,0===Or&&Ri(Ds)),Ve===be&&(62===ve.charCodeAt(rt)?(Ve=">",rt++):(Ve=be,0===Or&&Ri(Ps)),Ve===be&&("<="===ve.substr(rt,2)?(Ve="<=",rt+=2):(Ve=be,0===Or&&Ri(ms)),Ve===be&&("<>"===ve.substr(rt,2)?(Ve="<>",rt+=2):(Ve=be,0===Or&&Ri(Un)),Ve===be&&(60===ve.charCodeAt(rt)?(Ve="<",rt++):(Ve=be,0===Or&&Ri(gr)),Ve===be&&(61===ve.charCodeAt(rt)?(Ve="=",rt++):(Ve=be,0===Or&&Ri(ps)),Ve===be&&("!="===ve.substr(rt,2)?(Ve="!=",rt+=2):(Ve=be,0===Or&&Ri(Sr)))))))),Ve}function $d(){var Ve,gt,Pt,Yt,Jr;return Ve=rt,gt=rt,(Pt=qd())!==be?(Yt=bi(),(Jr=Qd())!==be?gt=Pt=[Pt,Yt,Jr]:(rt=gt,gt=be)):(rt=gt,gt=be),gt!==be&&(gt=bl(gt)),(Ve=gt)===be&&(Ve=Qd()),Ve}function ks(){var Ve,gt,Pt,Yt,Jr;return Ve=rt,gt=rt,(Pt=qd())!==be?(Yt=bi(),(Jr=vd())!==be?gt=Pt=[Pt,Yt,Jr]:(rt=gt,gt=be)):(rt=gt,gt=be),gt!==be&&(gt=bl(gt)),(Ve=gt)===be&&(Ve=vd()),Ve}function dl(){var Ve,gt,Pt,Yt,Jr,Mi,Pi,Si;if(Ve=rt,(gt=Gc())!==be){for(Pt=[],Yt=rt,Jr=bi(),(Mi=zl())!==be?(Pi=bi(),(Si=Gc())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Yt!==be;)Pt.push(Yt),Yt=rt,Jr=bi(),(Mi=zl())!==be?(Pi=bi(),(Si=Gc())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Ve=Vi(gt,Pt)}else rt=Ve,Ve=be;return Ve}function zl(){var Ve;return 43===ve.charCodeAt(rt)?(Ve="+",rt++):(Ve=be,0===Or&&Ri(mr)),Ve===be&&(45===ve.charCodeAt(rt)?(Ve="-",rt++):(Ve=be,0===Or&&Ri(Wr))),Ve}function Gc(){var Ve,gt,Pt,Yt,Jr,Mi,Pi,Si;if(Ve=rt,(gt=hp())!==be){for(Pt=[],Yt=rt,Jr=bi(),(Mi=l0())!==be?(Pi=bi(),(Si=hp())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Yt!==be;)Pt.push(Yt),Yt=rt,Jr=bi(),(Mi=l0())!==be?(Pi=bi(),(Si=hp())!==be?Yt=Jr=[Jr,Mi,Pi,Si]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be);Ve=function(Ve,gt){return ar(Ve,gt)}(gt,Pt)}else rt=Ve,Ve=be;return Ve}function l0(){var Ve;return 42===ve.charCodeAt(rt)?(Ve="*",rt++):(Ve=be,0===Or&&Ri(Di)),Ve===be&&(47===ve.charCodeAt(rt)?(Ve="/",rt++):(Ve=be,0===Or&&Ri(Wi))),Ve}function hp(){var Ve,gt;return(Ve=function hl(){var Ve;return(Ve=Gl())===be&&(Ve=function Ah(){var Ve,gt,Pt,Yt;return Ve=rt,(gt=function mf(){var Ve,gt,Pt,Yt;return Ve=rt,(gt=mu())!==be&&(Pt=Ml())!==be&&(Yt=u0())!==be?Ve=function(Ve,gt,Pt){return parseFloat(Ve+gt+Pt)}(gt,Pt,Yt):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=mu())!==be&&(Pt=Ml())!==be?Ve=function(Ve,gt){return parseFloat(Ve+gt)}(gt,Pt):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=mu())!==be&&(Pt=u0())!==be?Ve=function(Ve,gt){return parseFloat(Ve+gt)}(gt,Pt):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=mu())!==be&&(gt=function(Ve){return parseFloat(Ve)}(gt)),Ve=gt))),Ve}())!==be?(Pt=rt,Or++,Yt=Xn(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve=function(Ve){return{type:"number",value:Ve}}(gt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function fp(){var Ve,gt;return Ve=rt,(gt=function Ka(){var Ve,gt,Pt,Yt;return Ve=rt,"true"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(fa)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve=gt=[gt,Pt]:(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())!==be&&(gt={type:"boolean",value:!0}),(Ve=gt)===be&&(Ve=rt,(gt=function Xd(){var Ve,gt,Pt,Yt;return Ve=rt,"false"===ve.substr(rt,5).toLowerCase()?(gt=ve.substr(rt,5),rt+=5):(gt=be,0===Or&&Ri(Yo)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve=gt=[gt,Pt]:(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())!==be&&(gt={type:"boolean",value:!1}),Ve=gt),Ve}())===be&&(Ve=function Dh(){var Ve;return(Ve=function qa(){var Ve,gt,Pt,Yt;return Ve=rt,"null"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(Pa)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve=gt=[gt,Pt]:(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())!==be&&(Ve={type:"null",value:null}),Ve}())===be&&(Ve=function o_(){var Ve,gt;return Ve=rt,function Za(){var Ve,gt,Pt,Yt;return Ve=rt,"date"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(ma)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="DATE":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()!==be?(bi(),(gt=Hu())!==be?Ve=function(Ve){return{type:"date",value:Ve.value}}(gt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function Gn(){var Ve,gt;return Ve=rt,function Ol(){var Ve,gt,Pt,Yt;return Ve=rt,"timestamp"===ve.substr(rt,9).toLowerCase()?(gt=ve.substr(rt,9),rt+=9):(gt=be,0===Or&&Ri(us)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="TIMESTAMP":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()!==be?(bi(),(gt=Hu())!==be?Ve=function(Ve){return{type:"timestamp",value:Ve.value}}(gt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function Jd(){var Ve,gt,Pt,Yt;return Ve=rt,Cc()!==be?(bi(),45===ve.charCodeAt(rt)?(gt="-",rt++):(gt=be,0===Or&&Ri(Wr)),gt===be&&(43===ve.charCodeAt(rt)?(gt="+",rt++):(gt=be,0===Or&&Ri(mr))),gt!==be?(bi(),(Pt=Hu())!==be?(bi(),(Yt=mo())!==be?Ve=function(Ve,gt,Pt){return{type:"interval",value:gt,qualifier:Pt,op:Ve}}(gt,Pt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,Cc()!==be?(bi(),(gt=Hu())!==be?(bi(),(Pt=mo())!==be?Ve=function(Ve,gt){return{type:"interval",value:Ve,qualifier:gt,op:""}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)),Ve}()),Ve}())===be&&(Ve=function ya(){var Ve,gt,Pt;return Ve=rt,function Rs(){var Ve,gt,Pt,Yt;return Ve=rt,"extract"===ve.substr(rt,7).toLowerCase()?(gt=ve.substr(rt,7),rt+=7):(gt=be,0===Or&&Ri(cs)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="EXTRACT":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()!==be?(bi(),La()!==be?(bi(),(gt=function No(){var Ve;return(Ve=Pl())===be&&(Ve=hc())===be&&(Ve=Hl())===be&&(Ve=Ts())===be&&(Ve=yp())===be&&(Ve=wa()),Ve}())!==be?(bi(),_n()!==be?(bi(),(Pt=co())!==be?(bi(),Qn()!==be?Ve=function(Ve,gt){return{type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:Ve},gt]}}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function Yd(){var Ve,gt,Pt,Yt,Jr,Mi,Pi;return Ve=rt,function on(){var Ve,gt,Pt,Yt;return Ve=rt,"substring"===ve.substr(rt,9).toLowerCase()?(gt=ve.substr(rt,9),rt+=9):(gt=be,0===Or&&Ri(nn)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="SUBSTRING":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()!==be?(bi(),La()!==be?(bi(),(gt=co())!==be?(bi(),_n()!==be?(bi(),(Pt=co())!==be?(bi(),Yt=rt,(Jr=function gu(){var Ve,gt,Pt,Yt;return Ve=rt,"for"===ve.substr(rt,3).toLowerCase()?(gt=ve.substr(rt,3),rt+=3):(gt=be,0===Or&&Ri(zo)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="FOR":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())!==be?(Mi=bi(),(Pi=co())!==be?Yt=Jr=[Jr,Mi,Pi,bi()]:(rt=Yt,Yt=be)):(rt=Yt,Yt=be),Yt===be&&(Yt=null),(Jr=Qn())!==be?Ve=function(Ve,gt,Pt){return{type:"function",name:"substring",args:{type:"expression-list",value:Pt?[Ve,gt,Pt[2]]:[Ve,gt]}}}(gt,Pt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function n_(){var Ve,gt,Pt,Yt;return Ve=rt,pl()!==be?(bi(),La()!==be?(bi(),(gt=zu())===be&&(gt=null),bi(),(Pt=co())!==be?(bi(),_n()!==be?(bi(),(Yt=co())!==be?(bi(),Qn()!==be?Ve=function(Ve,gt,Pt){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Ve?"BOTH":Ve},gt,Pt]}}}(gt,Pt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,pl()!==be?(bi(),La()!==be?(bi(),(gt=zu())===be&&(gt=null),bi(),(Pt=co())!==be?(bi(),Qn()!==be?Ve=function(Ve,gt){return{type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==Ve?"BOTH":Ve},gt]}}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)),Ve}())===be&&(Ve=function Tl(){var Ve,gt,Pt;return Ve=rt,function go(){var Ve,gt,Pt,Yt;return Ve=rt,"position"===ve.substr(rt,8).toLowerCase()?(gt=ve.substr(rt,8),rt+=8):(gt=be,0===Or&&Ri(Jn)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="POSITION":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()!==be?(bi(),La()!==be?(bi(),(gt=co())!==be?(bi(),vd()!==be?(bi(),(Pt=co())!==be?(bi(),Qn()!==be?Ve=function(Ve,gt){return{type:"function",name:"position",args:{type:"expression-list",value:[Ve,gt]}}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function yd(){var Ve,gt,Pt;return Ve=rt,(gt=function Qe(){var Ve,gt,Pt,Yt;if(Ve=rt,(Ve=gt=To())===be)if(Ve=rt,96===ve.charCodeAt(rt)?(gt="`",rt++):(gt=be,0===Or&&Ri(Va)),gt!==be){if(Pt=[],ts.test(ve.charAt(rt))?(Yt=ve.charAt(rt),rt++):(Yt=be,0===Or&&Ri(ud)),Yt!==be)for(;Yt!==be;)Pt.push(Yt),ts.test(ve.charAt(rt))?(Yt=ve.charAt(rt),rt++):(Yt=be,0===Or&&Ri(ud));else Pt=be;Pt!==be?(96===ve.charCodeAt(rt)?(Yt="`",rt++):(Yt=be,0===Or&&Ri(Va)),Yt!==be?Ve=function(Ve){return Ve.join("")}(Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)}else rt=Ve,Ve=be;return Ve}())!==be?(bi(),La()!==be?(bi(),(Pt=po())===be&&(Pt=null),bi(),Qn()!==be?Ve=function(Ve,gt){return{type:"function",name:Ve,args:gt||{type:"expression-list",value:[]}}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function Mo(){var Ve;return(Ve=function _u(){var Ve,gt,Pt,Yt,Jr;if(Ve=rt,oa()!==be)if(bi(),(gt=co())!==be){for(bi(),Pt=[],Yt=_p();Yt!==be;)Pt.push(Yt),Yt=_p();Yt=bi(),(Jr=bd())!==be?Ve=function(Ve,gt){return{type:"case-expression",format:"simple",operand:Ve,clauses:gt,else:null}}(gt,Pt):(rt=Ve,Ve=be)}else rt=Ve,Ve=be;else rt=Ve,Ve=be;if(Ve===be)if(Ve=rt,oa()!==be)if(bi(),(gt=co())!==be){for(bi(),Pt=[],Yt=_p();Yt!==be;)Pt.push(Yt),Yt=_p();Yt=bi(),(Jr=Ku())!==be?(bi(),bd()!==be?Ve=function(Ve,gt,Pt){return{type:"case-expression",format:"simple",operand:Ve,clauses:gt,else:Pt.value}}(gt,Pt,Jr):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)}else rt=Ve,Ve=be;else rt=Ve,Ve=be;return Ve}())===be&&(Ve=function dc(){var Ve,gt,Pt,Yt;if(Ve=rt,oa()!==be){for(bi(),gt=[],Pt=Da();Pt!==be;)gt.push(Pt),Pt=Da();Pt=bi(),(Yt=bd())!==be?Ve=function(Ve){return{type:"case-expression",format:"searched",clauses:Ve,else:null}}(gt):(rt=Ve,Ve=be)}else rt=Ve,Ve=be;if(Ve===be)if(Ve=rt,oa()!==be){for(bi(),gt=[],Pt=Da();Pt!==be;)gt.push(Pt),Pt=Da();Pt=bi(),(Yt=Ku())!==be?(bi(),bd()!==be?Ve=function(Ve,gt){return{type:"case-expression",format:"searched",clauses:Ve,else:gt.value}}(gt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)}else rt=Ve,Ve=be;return Ve}()),Ve}())===be&&(Ve=function cc(){var Ve;return(Ve=function pp(){var Ve;return Ve=function Ss(){var Ve,gt,Pt,Yt;if(Ve=rt,(gt=Xn())!==be){for(Pt=[],Yt=Ph();Yt!==be;)Pt.push(Yt),Yt=Ph();Ve=al(gt,Pt)}else rt=Ve,Ve=be;return Ve}(),Ve}())!==be&&(Ve=function(Ve){return/^CURRENT_DATE$/i.test(Ve)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Ve)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:Ve}}(Ve)),Ve}())===be&&(Ve=uc())===be&&(Ve=rt,La()!==be?(bi(),(gt=co())!==be?(bi(),Qn()!==be?Ve=function(Ve){return Ve.paren=!0,Ve}(gt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)),Ve}function To(){var Ve,gt,Pt,Yt;if(Ve=rt,(gt=Xn())!==be){for(Pt=[],Yt=qs();Yt!==be;)Pt.push(Yt),Yt=qs();Ve=al(gt,Pt)}else rt=Ve,Ve=be;return Ve}function Xn(){var Ve;return ds.test(ve.charAt(rt))?(Ve=ve.charAt(rt),rt++):(Ve=be,0===Or&&Ri(ns)),Ve}function qs(){var Ve;return Mt.test(ve.charAt(rt))?(Ve=ve.charAt(rt),rt++):(Ve=be,0===Or&&Ri(Yi)),Ve}function Ph(){var Ve;return Hr.test(ve.charAt(rt))?(Ve=ve.charAt(rt),rt++):(Ve=be,0===Or&&Ri(hs)),Ve}function uc(){var Ve,gt,Pt;return Ve=rt,64===ve.charCodeAt(rt)?(gt="@",rt++):(gt=be,0===Or&&Ri(Ks)),gt!==be&&(Pt=To())!==be?Ve=gt=[gt,Pt]:(rt=Ve,Ve=be),Ve!==be&&(Ve=function(Ve){return{type:"parameter",value:Ve[1]}}(Ve)),Ve}function zu(){var Ve;return(Ve=function bc(){var Ve,gt,Pt,Yt;return Ve=rt,"leading"===ve.substr(rt,7).toLowerCase()?(gt=ve.substr(rt,7),rt+=7):(gt=be,0===Or&&Ri(Ht)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="LEADING":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function Ki(){var Ve,gt,Pt,Yt;return Ve=rt,"trailing"===ve.substr(rt,8).toLowerCase()?(gt=ve.substr(rt,8),rt+=8):(gt=be,0===Or&&Ri(kt)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="TRAILING":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}())===be&&(Ve=function yu(){var Ve,gt,Pt,Yt;return Ve=rt,"both"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(ur)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="BOTH":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()),Ve}function mo(){var Ve,gt,Pt;return Ve=rt,(gt=function c0(){var Ve,gt,Pt;return Ve=rt,(gt=fu())!==be?(bi(),La()!==be?(bi(),(Pt=na())!==be?(bi(),Qn()!==be?Ve=function(Ve,gt){return{type:"interval-period",period:Ve.value,precision:gt,secondary:null}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=fu())!==be&&(gt=za(gt)),Ve=gt),Ve}())!==be?(bi(),function gp(){var Ve,gt,Pt,Yt;return Ve=rt,"to"===ve.substr(rt,2).toLowerCase()?(gt=ve.substr(rt,2),rt+=2):(gt=be,0===Or&&Ri(Tr)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="TO":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()!==be?(bi(),(Pt=function xh(){var Ve,gt,Pt,Yt;return Ve=rt,(gt=fu())!==be&&(gt=function(Ve){return{type:"interval-period",period:Ve.value,precision:null,secondary:null}}(gt)),(Ve=gt)===be&&(Ve=rt,(gt=wa())!==be?(bi(),La()!==be?(bi(),(Pt=na())!==be?(bi(),jo()!==be?(bi(),(Yt=Gu())!==be?(bi(),Qn()!==be?Ve=zn(Pt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=wa())!==be?(bi(),La()!==be?(bi(),(Pt=na())!==be?(bi(),Qn()!==be?Ve=function(Ve){return{type:"interval-period",period:"second",precision:Ve,secondary:null}}(Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=wa())!==be&&(gt={type:"interval-period",period:"second",precision:null,secondary:null}),Ve=gt))),Ve}())!==be?Ve=function(Ve,gt){return{type:"interval-qualifier",start:Ve,end:gt}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=function pu(){var Ve,gt,Pt,Yt;return Ve=rt,(gt=fu())!==be?(bi(),La()!==be?(bi(),(Pt=Gu())!==be?(bi(),Qn()!==be?Ve=function(Ve,gt){return{type:"interval-period",period:Ve.value,precision:gt,secondary:null}}(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=fu())!==be&&(gt=za(gt)),(Ve=gt)===be&&(Ve=rt,(gt=wa())!==be?(bi(),La()!==be?(bi(),(Pt=na())!==be?(bi(),jo()!==be?(bi(),(Yt=Gu())!==be?(bi(),Qn()!==be?Ve=zn(Pt,Yt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=wa())!==be?(bi(),La()!==be?(bi(),(Pt=Gu())!==be?(bi(),Qn()!==be?Ve=function(Ve){return{type:"interval-period",period:"second",precision:Ve,secondary:null}}(Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve===be&&(Ve=rt,(gt=wa())!==be&&(gt={type:"interval-period",period:"second",precision:null,secondary:null}),Ve=gt)))),Ve}()),Ve}function fu(){var Ve,gt;return Ve=rt,(gt=Hl())!==be&&(gt={type:"string",value:"day"}),(Ve=gt)===be&&(Ve=rt,(gt=Ts())!==be&&(gt={type:"string",value:"hour"}),(Ve=gt)===be&&(Ve=rt,(gt=yp())!==be&&(gt={type:"string",value:"minute"}),(Ve=gt)===be&&(Ve=rt,(gt=hc())!==be&&(gt={type:"string",value:"month"}),(Ve=gt)===be&&(Ve=rt,(gt=Pl())!==be&&(gt={type:"string",value:"year"}),Ve=gt)))),Ve}function Gu(){var Ve;return(Ve=Hc())!==be&&(Ve=Ga(Ve)),Ve}function na(){var Ve;return(Ve=Hc())!==be&&(Ve=Ga(Ve)),Ve}function Hu(){var Ve;return(Ve=Gl())===be&&(Ve=uc()),Ve}function Gl(){var Ve,gt,Pt,Yt,Jr;if(Ve=rt,39===ve.charCodeAt(rt)?(gt="'",rt++):(gt=be,0===Or&&Ri(Ms)),gt===be&&("N'"===ve.substr(rt,2)?(gt="N'",rt+=2):(gt=be,0===Or&&Ri(Zs))),gt!==be){for(Pt=[],Yt=rt,"''"===ve.substr(rt,2)?(Jr="''",rt+=2):(Jr=be,0===Or&&Ri(tn)),Jr!==be&&(Jr="'"),(Yt=Jr)===be&&(Ir.test(ve.charAt(rt))?(Yt=ve.charAt(rt),rt++):(Yt=be,0===Or&&Ri(So)));Yt!==be;)Pt.push(Yt),Yt=rt,"''"===ve.substr(rt,2)?(Jr="''",rt+=2):(Jr=be,0===Or&&Ri(tn)),Jr!==be&&(Jr="'"),(Yt=Jr)===be&&(Ir.test(ve.charAt(rt))?(Yt=ve.charAt(rt),rt++):(Yt=be,0===Or&&Ri(So)));39===ve.charCodeAt(rt)?(Yt="'",rt++):(Yt=be,0===Or&&Ri(Ms)),Yt!==be?Ve=function(Ve){return{type:"string",value:Ve.join("")}}(Pt):(rt=Ve,Ve=be)}else rt=Ve,Ve=be;return Ve}function Da(){var Ve,gt,Pt;return Ve=rt,Ia()!==be?(bi(),(gt=co())!==be?(bi(),Cd()!==be?(bi(),(Pt=co())!==be?Ve=Mh(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function _p(){var Ve,gt,Pt;return Ve=rt,Ia()!==be?(bi(),(gt=co())!==be?(bi(),Cd()!==be?(bi(),(Pt=co())!==be?Ve=Mh(gt,Pt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Ku(){var Ve,gt;return Ve=rt,function eh(){var Ve,gt,Pt,Yt;return Ve=rt,"else"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(On)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="ELSE":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}()!==be?(bi(),(gt=co())!==be?Ve=function(Ve){return{type:"else-clause",value:Ve}}(gt):(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function mu(){var Ve,gt,Pt;return(Ve=Hc())===be&&(Ve=rt,45===ve.charCodeAt(rt)?(gt="-",rt++):(gt=be,0===Or&&Ri(Wr)),gt===be&&(43===ve.charCodeAt(rt)?(gt="+",rt++):(gt=be,0===Or&&Ri(mr))),gt!==be&&(Pt=Hc())!==be?Ve=function(Ve,gt){return Ve[0]+gt}(gt,Pt):(rt=Ve,Ve=be)),Ve}function Ml(){var Ve,gt,Pt;return Ve=rt,46===ve.charCodeAt(rt)?(gt=".",rt++):(gt=be,0===Or&&Ri(Bn)),gt!==be?((Pt=Hc())===be&&(Pt=null),Ve=function(Ve){return"."+(null!=Ve?Ve:"")}(Pt)):(rt=Ve,Ve=be),Ve}function u0(){var Ve,gt,Pt;return Ve=rt,(gt=function Kc(){var Ve,gt,Pt;return Ve=rt,Ui.test(ve.charAt(rt))?(gt=ve.charAt(rt),rt++):(gt=be,0===Or&&Ri(to)),gt!==be?(is.test(ve.charAt(rt))?(Pt=ve.charAt(rt),rt++):(Pt=be,0===Or&&Ri(Vn)),Pt===be&&(Pt=null),Ve=function(Ve,gt){return"e"+(null===gt?"":gt)}(0,Pt)):(rt=Ve,Ve=be),Ve}())!==be&&(Pt=Hc())!==be?Ve=function(Ve,gt){return Ve+gt}(gt,Pt):(rt=Ve,Ve=be),Ve}function Hc(){var Ve,gt;if(Ve=[],(gt=Sh())!==be)for(;gt!==be;)Ve.push(gt),gt=Sh();else Ve=be;return Ve!==be&&(Ve=function(Ve){return Ve.join("")}(Ve)),Ve}function Sh(){var Ve;return gi.test(ve.charAt(rt))?(Ve=ve.charAt(rt),rt++):(Ve=be,0===Or&&Ri(_o)),Ve}function vd(){var Ve,gt,Pt,Yt;return Ve=rt,"in"===ve.substr(rt,2).toLowerCase()?(gt=ve.substr(rt,2),rt+=2):(gt=be,0===Or&&Ri(_a)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="IN":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Us(){var Ve,gt,Pt,Yt;return Ve=rt,"is"===ve.substr(rt,2).toLowerCase()?(gt=ve.substr(rt,2),rt+=2):(gt=be,0===Or&&Ri(ia)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="IS":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Qd(){var Ve,gt,Pt,Yt;return Ve=rt,"like"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(Xs)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="LIKE":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function qd(){var Ve,gt,Pt,Yt;return Ve=rt,"not"===ve.substr(rt,3).toLowerCase()?(gt=ve.substr(rt,3),rt+=3):(gt=be,0===Or&&Ri(xa)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="NOT":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Ec(){var Ve,gt,Pt,Yt;return Ve=rt,"and"===ve.substr(rt,3).toLowerCase()?(gt=ve.substr(rt,3),rt+=3):(gt=be,0===Or&&Ri(xo)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="AND":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Rh(){var Ve,gt,Pt,Yt;return Ve=rt,"or"===ve.substr(rt,2).toLowerCase()?(gt=ve.substr(rt,2),rt+=2):(gt=be,0===Or&&Ri(ti)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="OR":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Ed(){var Ve,gt,Pt,Yt;return Ve=rt,"between"===ve.substr(rt,7).toLowerCase()?(gt=ve.substr(rt,7),rt+=7):(gt=be,0===Or&&Ri(Nn)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="BETWEEN":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function _n(){var Ve,gt,Pt,Yt;return Ve=rt,"from"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(Wa)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="FROM":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function pl(){var Ve,gt,Pt,Yt;return Ve=rt,"trim"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(Yn)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="TRIM":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Cc(){var Ve,gt,Pt,Yt;return Ve=rt,"interval"===ve.substr(rt,8).toLowerCase()?(gt=ve.substr(rt,8),rt+=8):(gt=be,0===Or&&Ri(_r)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="INTERVAL":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Pl(){var Ve,gt,Pt,Yt;return Ve=rt,"year"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(Gr)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="YEAR":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function hc(){var Ve,gt,Pt,Yt;return Ve=rt,"month"===ve.substr(rt,5).toLowerCase()?(gt=ve.substr(rt,5),rt+=5):(gt=be,0===Or&&Ri(oi)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="MONTH":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Hl(){var Ve,gt,Pt,Yt;return Ve=rt,"day"===ve.substr(rt,3).toLowerCase()?(gt=ve.substr(rt,3),rt+=3):(gt=be,0===Or&&Ri(At)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="DAY":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Ts(){var Ve,gt,Pt,Yt;return Ve=rt,"hour"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(Bt)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="HOUR":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function yp(){var Ve,gt,Pt,Yt;return Ve=rt,"minute"===ve.substr(rt,6).toLowerCase()?(gt=ve.substr(rt,6),rt+=6):(gt=be,0===Or&&Ri(vr)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="MINUTE":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function wa(){var Ve,gt,Pt,Yt;return Ve=rt,"second"===ve.substr(rt,6).toLowerCase()?(gt=ve.substr(rt,6),rt+=6):(gt=be,0===Or&&Ri(kr)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="SECOND":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function oa(){var Ve,gt,Pt,Yt;return Ve=rt,"case"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(ai)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="CASE":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function bd(){var Ve,gt,Pt,Yt;return Ve=rt,"end"===ve.substr(rt,3).toLowerCase()?(gt=ve.substr(rt,3),rt+=3):(gt=be,0===Or&&Ri(Hi)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="END":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Ia(){var Ve,gt,Pt,Yt;return Ve=rt,"when"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(fs)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="WHEN":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function Cd(){var Ve,gt,Pt,Yt;return Ve=rt,"then"===ve.substr(rt,4).toLowerCase()?(gt=ve.substr(rt,4),rt+=4):(gt=be,0===Or&&Ri(Tn)),gt!==be?(Pt=rt,Or++,Yt=qs(),Or--,Yt===be?Pt=void 0:(rt=Pt,Pt=be),Pt!==be?Ve="THEN":(rt=Ve,Ve=be)):(rt=Ve,Ve=be),Ve}function jo(){var Ve;return 44===ve.charCodeAt(rt)?(Ve=",",rt++):(Ve=be,0===Or&&Ri(rn)),Ve}function La(){var Ve;return 40===ve.charCodeAt(rt)?(Ve="(",rt++):(Ve=be,0===Or&&Ri(hn)),Ve}function Qn(){var Ve;return 41===ve.charCodeAt(rt)?(Ve=")",rt++):(Ve=be,0===Or&&Ri(no)),Ve}function bi(){var Ve,gt;for(Ve=[],gt=Le();gt!==be;)Ve.push(gt),gt=Le();return Ve}function Le(){var Ve;return ss.test(ve.charAt(rt))?(Ve=ve.charAt(rt),rt++):(Ve=be,0===Or&&Ri(Sn)),Ve}function Et(Ve,gt,Pt,Yt){var Jr={type:"binary-expression",operator:Ve,left:gt,right:Pt};return void 0!==Yt&&(Jr.escape=Yt),Jr}function ar(Ve,gt){for(var Pt=Ve,Yt=0;Yt<gt.length;Yt++)Pt=Et(gt[Yt][1],Pt,gt[Yt][3]);return Pt}if((qe=ze())!==be&&rt===ve.length)return qe;throw qe!==be&&rt<ve.length&&Ri({type:"end"}),function Ws(Ve,gt,Pt){return new Se(Se.buildMessage(Ve,gt),Ve,gt,Pt)}($t,wr<ve.length?ve.charAt(wr):null,function $s(Ve,gt){var Pt=_s(Ve),Yt=_s(gt);return{source:tt,start:{offset:Ve,line:Pt.line,column:Pt.column},end:{offset:gt,line:Yt.line,column:Yt.column}}}(wr,wr<ve.length?wr+1:wr))}}}());const X=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,U=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,ee=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,$=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,ne=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,se=new Set(["current_timestamp","current_date","current_time"]);function ae(Be,Se){return(Be+="").length>=Se?Be:new Array(Se-Be.length+1).join("0")+Be}function de(Be,Se,De="0",Fe="0",ve="0",Ke="0",qe="",be="0",tt="0"){if("+"===qe||"-"===qe){const Ye=`${ae(parseInt(Be,10),4)}-${ae(parseInt(Se,10),2)}-${ae(parseInt(De,10),2)}`;let ze="";parseFloat(Ke)<10&&(ze="0");const et=`${ae(parseInt(Fe,10),2)}:${ae(parseInt(ve,10),2)}:${ze+parseFloat(Ke).toString()}`,ke=`${qe}${ae(parseInt(be,10),2)}:${ae(parseInt(tt,10),2)}`;return new Date(Ye+"T"+et+ke)}return new Date(parseInt(Be,10),parseInt(Se,10)-1,parseInt(De,10),parseInt(Fe,10),parseInt(ve,10),parseFloat(Ke))}class _e{static makeBool(Se){return ye(Se)}static featureValue(Se,De,Fe,ve){return Oe(Se,De,Fe,ve)}static equalsNull(Se){return null===Se}static applyLike(Se,De,Fe){return xe(Se,De,Fe)}static ensureArray(Se){return Me(Se)}static applyIn(Se,De){return Ce(Se,De)}static currentDate(){const Se=new Date;return Se.setHours(0,0,0,0),Se}static makeSqlInterval(Se,De,Fe){return B.createFromValueAndQualifer(Se,De,Fe)}static convertInterval(Se){return Se instanceof B?Se.valueInMilliseconds():Se}static currentTimestamp(){return new Date}static compare(Se,De,Fe){return We(Se,De,Fe)}static calculate(Se,De,Fe){return Ne(Se,De,Fe)}static makeComparable(Se){return je(Se)}static evaluateFunction(Se,De){return Z(Se,De)}static lookup(Se,De){const Fe=De[Se];return void 0===Fe?null:Fe}static between(Se,De){return null==Se||null==De[0]||null==De[1]?null:Se>=De[0]&&Se<=De[1]}static notbetween(Se,De){return null==Se||null==De[0]||null==De[1]?null:Se<De[0]||Se>De[1]}static ternaryNot(Se){return Ee(Se)}static ternaryAnd(Se,De){return Te(Se,De)}static ternaryOr(Se,De){return me(Se,De)}}class pe{constructor(Se,De){this.fieldsIndex=De,this.datefields={},this.parameters={},this._hasDateFunctions=void 0,this.parseTree=class j{static parse(Se){return Y.exports.parse(Se)}}.parse(Se);const{isStandardized:Fe,isAggregate:ve,referencedFieldNames:Ke}=this._extractExpressionInfo(De);this.referencedFieldNames=Ke,this.isStandardized=Fe,this.isAggregate=ve}static create(Se,De){return new pe(Se,De)}get fieldNames(){return this.referencedFieldNames}testSet(Se,De=$e){const Fe={};for(const ve of this.fieldNames)Fe[ve]=Se.map(Ke=>De.getAttribute(Ke,ve));return!!this._evaluateNode(this.parseTree,{attributes:Fe},$e)}calculateValue(Se,De=$e){const Fe=this._evaluateNode(this.parseTree,Se,De);return Fe instanceof B?Fe.valueInMilliseconds()/864e5:Fe}calculateValueCompiled(Se,De=$e){return null!=this.parseTree._compiledVersion?this.parseTree._compiledVersion(Se,this.parameters,De,this.datefields):(0,x.Z)("esri-csp-restrictions")?this.calculateValue(Se,De):(this._compileMe(),this.parseTree._compiledVersion(Se,this.parameters,De,this.datefields))}testFeature(Se,De=$e){return!!this._evaluateNode(this.parseTree,Se,De)}testFeatureCompiled(Se,De=$e){return null!=this.parseTree._compiledVersion?!!this.parseTree._compiledVersion(Se,this.parameters,De,this.datefields):(0,x.Z)("esri-csp-restrictions")?this.testFeature(Se,De):(this._compileMe(),!!this.parseTree._compiledVersion(Se,this.parameters,De,this.datefields))}get hasDateFunctions(){return null!=this._hasDateFunctions||(this._hasDateFunctions=!1,this._visitAll(this.parseTree,Se=>{"current-time"===Se.type?this._hasDateFunctions=!0:"function"===Se.type&&(this._hasDateFunctions=this._hasDateFunctions||se.has(Se.name.toLowerCase()))})),this._hasDateFunctions}getFunctions(){const Se=new Set;return this._visitAll(this.parseTree,De=>{"function"===De.type&&Se.add(De.name.toLowerCase())}),Array.from(Se)}getExpressions(){const Se=new Map;return this._visitAll(this.parseTree,De=>{if("function"===De.type){const Fe=De.name.toLowerCase(),ve=De.args.value[0];if("column-reference"===ve.type){const Ke=ve.column,qe=`${Fe}-${Ke}`;Se.has(qe)||Se.set(qe,{aggregateType:Fe,field:Ke})}}}),[...Se.values()]}getVariables(){const Se=new Set;return this._visitAll(this.parseTree,De=>{"parameter"===De.type&&Se.add(De.value.toLowerCase())}),Array.from(Se)}_compileMe(){const Se="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=new Function("feature","lookups","attributeAdapter","datefields",Se).bind(_e)}_extractExpressionInfo(Se){const De=[],Fe=new Set;let ve=!0,Ke=!0;return this._visitAll(this.parseTree,qe=>{switch(qe.type){case"column-reference":{const be=Se.get(qe.column);let tt,Ye;be?tt=Ye=be.name:(Ye=qe.column,tt=Ye.toLowerCase()),!be||"date"!==be.type&&"esriFieldTypeDate"!==be.type||(this.datefields[be.name]=1),Fe.has(tt)||(Fe.add(tt),De.push(Ye)),qe.column=Ye;break}case"function":{const{name:be,args:tt}=qe,Ye=tt.value.length;ve&&(ve=function ie(Be,Se){const De=ue[Be.toLowerCase()];return null!=De&&Se>=De.minParams&&Se<=De.maxParams}(be,Ye)),Ke&&(Ke=function G(Be,Se){const De=Q[Be.toLowerCase()];return null!=De&&Se>=De.minParams&&Se<=De.maxParams}(be,Ye));break}}}),{referencedFieldNames:Array.from(De),isStandardized:ve,isAggregate:Ke}}_visitAll(Se,De){if(null!=Se)switch(De(Se),Se.type){case"when-clause":this._visitAll(Se.operand,De),this._visitAll(Se.value,De);break;case"case-expression":for(const Fe of Se.clauses)this._visitAll(Fe,De);"simple"===Se.format&&this._visitAll(Se.operand,De),null!==Se.else&&this._visitAll(Se.else,De);break;case"expression-list":for(const Fe of Se.value)this._visitAll(Fe,De);break;case"unary-expression":this._visitAll(Se.expr,De);break;case"binary-expression":this._visitAll(Se.left,De),this._visitAll(Se.right,De);break;case"function":this._visitAll(Se.args,De)}}evaluateNodeToJavaScript(Se){switch(Se.type){case"interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(Se.value)+", "+JSON.stringify(Se.qualifier)+","+JSON.stringify(Se.op)+")";case"case-expression":{let De="";if("simple"===Se.format){const Fe="this.makeComparable("+this.evaluateNodeToJavaScript(Se.operand)+")";De="( ";for(let ve=0;ve<Se.clauses.length;ve++)De+=" ("+Fe+" === this.makeComparable("+this.evaluateNodeToJavaScript(Se.clauses[ve].operand)+")) ? ("+this.evaluateNodeToJavaScript(Se.clauses[ve].value)+") : ";De+=null!==Se.else?this.evaluateNodeToJavaScript(Se.else):"null",De+=" )"}else{De="( ";for(let Fe=0;Fe<Se.clauses.length;Fe++)De+=" this.makeBool("+this.evaluateNodeToJavaScript(Se.clauses[Fe].operand)+")===true ? ("+this.evaluateNodeToJavaScript(Se.clauses[Fe].value)+") : ";De+=null!==Se.else?this.evaluateNodeToJavaScript(Se.else):"null",De+=" )"}return De}case"parameter":return"this.lookup("+JSON.stringify(Se.value.toLowerCase())+",lookups)";case"expression-list":{let De="[";for(const Fe of Se.value)"["!==De&&(De+=","),De+=this.evaluateNodeToJavaScript(Fe);return De+="]",De}case"unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(Se.expr)+")";case"binary-expression":switch(Se.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(Se.left)+","+this.evaluateNodeToJavaScript(Se.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(Se.left)+","+this.evaluateNodeToJavaScript(Se.right)+" )";case"IS":if("null"!==Se.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(Se.left)+")";case"ISNOT":if("null"!==Se.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(Se.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(Se.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(Se.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(Se.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(Se.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(Se.left)+","+this.evaluateNodeToJavaScript(Se.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(Se.left)+","+this.evaluateNodeToJavaScript(Se.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(Se.left)+","+this.evaluateNodeToJavaScript(Se.right)+","+JSON.stringify(Se.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(Se.left)+","+this.evaluateNodeToJavaScript(Se.right)+","+JSON.stringify(Se.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(Se.operator)+","+this.evaluateNodeToJavaScript(Se.left)+","+this.evaluateNodeToJavaScript(Se.right)+")";case"*":case"-":case"+":case"/":return"this.calculate("+JSON.stringify(Se.operator)+","+this.evaluateNodeToJavaScript(Se.left)+","+this.evaluateNodeToJavaScript(Se.right)+")"}throw new Error("Not Supported Operator "+Se.operator);case"null":case"boolean":case"string":case"number":return JSON.stringify(Se.value);case"date":return"(new Date("+ge(Se.value).getTime().toString()+"))";case"timestamp":return"(new Date("+he(Se.value).getTime().toString()+"))";case"current-time":return"date"===Se.mode?"this.currentDate()":"this.currentTimestamp()";case"column-reference":return"this.featureValue(feature,"+JSON.stringify(Se.column)+",datefields,attributeAdapter)";case"function":return"this.evaluateFunction("+JSON.stringify(Se.name)+","+this.evaluateNodeToJavaScript(Se.args)+")"}throw new Error("Unsupported sql syntax "+Se.type)}_evaluateNode(Se,De,Fe){switch(Se.type){case"interval":{const ve=this._evaluateNode(Se.value,De,Fe);return B.createFromValueAndQualifer(ve,Se.qualifier,Se.op)}case"case-expression":if("simple"===Se.format){const ve=je(this._evaluateNode(Se.operand,De,Fe));for(let Ke=0;Ke<Se.clauses.length;Ke++)if(ve===je(this._evaluateNode(Se.clauses[Ke].operand,De,Fe)))return this._evaluateNode(Se.clauses[Ke].value,De,Fe);if(null!==Se.else)return this._evaluateNode(Se.else,De,Fe)}else{for(let ve=0;ve<Se.clauses.length;ve++)if(ye(this._evaluateNode(Se.clauses[ve].operand,De,Fe)))return this._evaluateNode(Se.clauses[ve].value,De,Fe);if(null!==Se.else)return this._evaluateNode(Se.else,De,Fe)}return null;case"parameter":return this.parameters[Se.value.toLowerCase()];case"expression-list":{const ve=[];for(const Ke of Se.value)ve.push(this._evaluateNode(Ke,De,Fe));return ve}case"unary-expression":return Ee(this._evaluateNode(Se.expr,De,Fe));case"binary-expression":switch(Se.operator){case"AND":return Te(this._evaluateNode(Se.left,De,Fe),this._evaluateNode(Se.right,De,Fe));case"OR":return me(this._evaluateNode(Se.left,De,Fe),this._evaluateNode(Se.right,De,Fe));case"IS":if("null"!==Se.right.type)throw new Error("Unsupported RHS for IS");return null===this._evaluateNode(Se.left,De,Fe);case"ISNOT":if("null"!==Se.right.type)throw new Error("Unsupported RHS for IS");return null!==this._evaluateNode(Se.left,De,Fe);case"IN":{const ve=Me(this._evaluateNode(Se.right,De,Fe));return Ce(this._evaluateNode(Se.left,De,Fe),ve)}case"NOT IN":{const ve=Me(this._evaluateNode(Se.right,De,Fe));return Ee(Ce(this._evaluateNode(Se.left,De,Fe),ve))}case"BETWEEN":{const ve=this._evaluateNode(Se.left,De,Fe),Ke=this._evaluateNode(Se.right,De,Fe);return null==ve||null==Ke[0]||null==Ke[1]?null:ve>=je(Ke[0])&&ve<=je(Ke[1])}case"NOTBETWEEN":{const ve=this._evaluateNode(Se.left,De,Fe),Ke=this._evaluateNode(Se.right,De,Fe);return null==ve||null==Ke[0]||null==Ke[1]?null:ve<je(Ke[0])||ve>je(Ke[1])}case"LIKE":return xe(this._evaluateNode(Se.left,De,Fe),this._evaluateNode(Se.right,De,Fe),Se.escape);case"NOT LIKE":return Ee(xe(this._evaluateNode(Se.left,De,Fe),this._evaluateNode(Se.right,De,Fe),Se.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return We(Se.operator,this._evaluateNode(Se.left,De,Fe),this._evaluateNode(Se.right,De,Fe));case"-":case"+":case"*":case"/":return Ne(Se.operator,this._evaluateNode(Se.left,De,Fe),this._evaluateNode(Se.right,De,Fe))}case"null":case"boolean":case"string":case"number":return Se.value;case"date":return ge(Se.value);case"timestamp":return he(Se.value);case"current-time":{const ve=new Date;return"date"===Se.mode&&ve.setHours(0,0,0,0),ve}case"column-reference":return Oe(De,Se.column,this.datefields,Fe);case"function":{const ve=this._evaluateNode(Se.args,De,Fe);return this.isAggregate?function A(Be,Se){const De=Q[Be.toLowerCase()];if(null==De)throw new Error("Function Not Recognised");if(Se.length<De.minParams||Se.length>De.maxParams)throw new Error(`Invalid Parameter count for call to ${Be.toUpperCase()}`);return De.evaluate(Se)}(Se.name,ve):Z(Se.name,ve)}}throw new Error("Unsupported sql syntax "+Se.type)}}function he(Be){let Se=U.exec(Be);if(null!==Se){const[,De,Fe,ve,Ke,qe,be]=Se;return de(De,Fe,ve,Ke,qe,be)}if(Se=ee.exec(Be),null!==Se){const[,De,Fe,ve,Ke,qe,be,tt,Ye,ze]=Se;return de(De,Fe,ve,Ke,qe,be,tt,Ye,ze)}if(Se=$.exec(Be),null!==Se){const[,De,Fe,ve,Ke,qe,be,tt,Ye]=Se;return de(De,Fe,ve,Ke,qe,"0",be,tt,Ye)}if(Se=ne.exec(Be),null!==Se){const[,De,Fe,ve,Ke,qe]=Se;return de(De,Fe,ve,Ke,qe)}if(Se=X.exec(Be),null!==Se){const[,De,Fe,ve]=Se;return de(De,Fe,ve)}throw new Error("SQL Invalid Timestamp")}function ge(Be){const Se=X.exec(Be);if(null===Se)throw new Error("SQL Invalid Date");const[,De,Fe,ve]=Se;return new Date(parseInt(De,10),parseInt(Fe,10)-1,parseInt(ve,10))}function ye(Be){return!0===Be}function Me(Be){return Array.isArray(Be)?Be:[Be]}function Ee(Be){return null!==Be?!0!==Be:null}function Te(Be,Se){return null!=Be&&null!=Se?!0===Be&&!0===Se:!1!==Be&&!1!==Se&&null}function me(Be,Se){return null!=Be&&null!=Se?!0===Be||!0===Se:!0===Be||!0===Se||null}function Ce(Be,Se){if(null==Be)return null;let De=!1;for(const Fe of Se)if(null==Fe)De=null;else if(Be===Fe){De=!0;break}return De}const Ie="-[]/{}()*+?.\\^$|";var Ge,Be;function xe(Be,Se,De){return null==Be?null:function Je(Be,Se){const De=Se;let Fe="",ve=Ge.Normal;for(let Ke=0;Ke<Be.length;Ke++){const qe=Be.charAt(Ke);switch(ve){case Ge.Normal:qe===De?ve=Ge.Escaped:Ie.includes(qe)?Fe+="\\"+qe:Fe+="%"===qe?".*":"_"===qe?".":qe;break;case Ge.Escaped:Ie.includes(qe)?Fe+="\\"+qe:Fe+=qe,ve=Ge.Normal}}return new RegExp("^"+Fe+"$","m")}(Se,De).test(Be)}function je(Be){return Be instanceof Date?Be.valueOf():Be}function We(Be,Se,De){if(null==Se||null==De)return null;const Fe=je(Se),ve=je(De);switch(Be){case"<>":return Fe!==ve;case"=":return Fe===ve;case">":return Fe>ve;case"<":return Fe<ve;case">=":return Fe>=ve;case"<=":return Fe<=ve}}function Ne(Be,Se,De){if(Se instanceof B)if(De instanceof Date)switch(Be){case"+":return new Date(Se.valueInMilliseconds()+De.getTime());case"-":return Se.valueInMilliseconds()-De.getTime();case"*":return Se.valueInMilliseconds()*De.getTime();case"/":return Se.valueInMilliseconds()/De.getTime()}else if(De instanceof B)switch(Be){case"+":return B.createFromMilliseconds(Se.valueInMilliseconds()+De.valueInMilliseconds());case"-":return B.createFromMilliseconds(Se.valueInMilliseconds()-De.valueInMilliseconds());case"*":return Se.valueInMilliseconds()*De.valueInMilliseconds();case"/":return Se.valueInMilliseconds()/De.valueInMilliseconds()}else Se=Se.valueInMilliseconds();else if(De instanceof B)if(Se instanceof Date)switch(Be){case"+":return new Date(De.valueInMilliseconds()+Se.getTime());case"-":return new Date(Se.getTime()-De.valueInMilliseconds());case"*":return Se.getTime()*De.valueInMilliseconds();case"/":return Se.getTime()/De.valueInMilliseconds()}else De=De.valueInMilliseconds();else if(Se instanceof Date&&"number"==typeof De)switch(De=24*De*60*60*1e3,Se=Se.getTime(),Be){case"+":return new Date(Se+De);case"-":return new Date(Se-De);case"*":return new Date(Se*De);case"/":return new Date(Se/De)}else if(De instanceof Date&&"number"==typeof Se)switch(Se=24*Se*60*60*1e3,De=De.getTime(),Be){case"+":return new Date(Se+De);case"-":return new Date(Se-De);case"*":return new Date(Se*De);case"/":return new Date(Se/De)}switch(Be){case"+":return Se+De;case"-":return Se-De;case"*":return Se*De;case"/":return Se/De}}function Oe(Be,Se,De,Fe){const ve=Fe.getAttribute(Be,Se);return null!=ve&&1===De[Se]?new Date(ve):ve}(Be=Ge||(Ge={}))[Be.Normal=0]="Normal",Be[Be.Escaped=1]="Escaped";const $e={getAttribute:(Be,Se)=>(function we(Be){return Be&&"object"==typeof Be.attributes}(Be)?Be.attributes:Be)[Se]}},77275:(dt,Re,T)=>{"use strict";T.d(Re,{Cb:()=>J,Qs:()=>H,gx:()=>Q,hP:()=>re});var x=T(94113);const A=/\{([^\}]+)\}/g;function G(W){return null==W?"":W}function Q(W,B){return W.replace(A,"object"==typeof B?(Z,ie)=>G((0,x.hS)(ie,B)):(Z,ie)=>G(B(ie)))}function H(W,B){return W.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,Z=>B&&B.includes(Z)?Z:`\\${Z}`)}function re(W){let B=0;for(let Z=0;Z<W.length;Z++)B=(B<<5)-B+W.charCodeAt(Z),B|=0;return B}function J(W){return(new DOMParser).parseFromString(W||"","text/html").body.innerText||""}},28705:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>ue,z:()=>ce});var x=T(17626),A=T(46160),G=T(89726),Q=T(80542),re=(T(8314),T(63290)),J=T(62208),W=T(77712),ie=(T(85931),T(90912),T(76898));re.Z.getLogger("esri.core.support.OwningCollection");let ue=class extends((0,Q.p)(A.Z)){constructor(oe){super(oe),this.handles.add([this.on("before-add",le=>{(0,J.Wi)(le.item)&&le.preventDefault()}),this.on("after-add",le=>this._own(le.item)),this.on("after-remove",le=>this._release(le.item))])}get owner(){return this._get("owner")}set owner(oe){oe!==this._get("owner")&&(this._releaseAll(),this._set("owner",oe),this._ownAll())}_ownAll(){for(const oe of this.items)this._own(oe)}_releaseAll(){for(const oe of this.items)this._release(oe)}_createNewInstance(oe){return this.itemType?new(A.Z.ofType(this.itemType.Type))(oe):new A.Z(oe)}};function ce(oe,le){return{type:oe,cast:G.R,set(Y){const j=(0,G.Z)(Y,this._get(le),oe);j.owner=this,this._set(le,j)}}}(0,x._)([(0,W.Cb)()],ue.prototype,"owner",null),ue=(0,x._)([(0,ie.j)("esri.core.support.OwningCollection")],ue)},17760:(dt,Re,T)=>{"use strict";T.d(Re,{t:()=>B});var x=T(17626),A=T(14517),G=T(72392),Q=T(62208),H=T(32917),re=T(50618),J=T(77712),W=T(76898);let B=class extends A.Z{constructor(){super(...arguments),this.updating=!1,this.handleId=0,this.handles=new G.Z,this.scheduleHandleId=0,this.pendingPromises=new Set}destroy(){this.removeAll(),this.handles.destroy()}add(ue,ce,oe={}){return this._installWatch(ue,ce,oe,H.YP)}addWhen(ue,ce,oe={}){return this._installWatch(ue,ce,oe,H.gx)}addOnCollectionChange(ue,ce,{initial:oe=!1,final:le=!1}={}){const Y=++this.handleId;return this.handles.add([(0,H.on)(ue,"after-changes",this._createSyncUpdatingCallback(),H.Z_),(0,H.on)(ue,"change",ce,{onListenerAdd:oe?j=>ce({added:j.toArray(),removed:[]}):void 0,onListenerRemove:le?j=>ce({added:[],removed:j.toArray()}):void 0})],Y),{remove:()=>this.handles.remove(Y)}}addPromise(ue){if((0,Q.Wi)(ue))return ue;const ce=++this.handleId;this.handles.add({remove:()=>{this.pendingPromises.delete(ue)&&(0!==this.pendingPromises.size||this.handles.has(Z)||this._set("updating",!1))}},ce),this.pendingPromises.add(ue),this._set("updating",!0);const oe=()=>this.handles.remove(ce);return ue.then(oe,oe),ue}removeAll(){this.pendingPromises.clear(),this.handles.removeAll(),this._set("updating",!1)}_installWatch(ue,ce,oe={},le){const Y=++this.handleId;oe.sync||this._installSyncUpdatingWatch(ue,Y);const j=le(ue,ce,oe);return this.handles.add(j,Y),{remove:()=>this.handles.remove(Y)}}_installSyncUpdatingWatch(ue,ce){const oe=this._createSyncUpdatingCallback(),le=(0,H.YP)(ue,oe,{sync:!0,equals:()=>!1});return this.handles.add(le,ce),le}_createSyncUpdatingCallback(){return()=>{this.handles.remove(Z),++this.scheduleHandleId;const ue=this.scheduleHandleId;this._get("updating")||this._set("updating",!0),this.handles.add((0,re.Os)(()=>{ue===this.scheduleHandleId&&(this._set("updating",this.pendingPromises.size>0),this.handles.remove(Z))}),Z)}}};(0,x._)([(0,J.Cb)({readOnly:!0})],B.prototype,"updating",void 0),B=(0,x._)([(0,W.j)("esri.core.support.WatchUpdatingTracking")],B);const Z=-42;var ie,ue;(ue=ie||(ie={}))[ue.NONE=0]="NONE",ue[ue.SYNC=1]="SYNC",ue[ue.INIT=2]="INIT"},27422:(dt,Re,T)=>{"use strict";function x(H){return H}function A(H){return 1e3*H}function G(H){return H}function Q(H){return.001*H}T.d(Re,{D9:()=>Q,HA:()=>x,_H:()=>G,up:()=>A})},28170:(dt,Re,T)=>{"use strict";T.d(Re,{JE:()=>J,Ni:()=>B,Nm:()=>H,cH:()=>ie,cl:()=>W,rJ:()=>ue,y7:()=>Z}),T(8314);const A={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},G={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function H(ce,oe,le){const Y=new Date(ce.getTime());if(oe&&le){const j=G[le],{getter:X,setter:U,multiplier:ee}=j;if("months"===le){const $=function Q(ce,oe){const le=new Date(ce,oe+1,1);return le.setDate(0),le.getDate()}(Y.getFullYear(),Y.getMonth()+oe);Y.getDate()>$&&Y.setDate($)}Y[U](Y[X]()+oe*ee)}return Y}function J(ce,oe){switch(oe){case"milliseconds":return new Date(ce.getTime());case"seconds":return new Date(ce.getFullYear(),ce.getMonth(),ce.getDate(),ce.getHours(),ce.getMinutes(),ce.getSeconds());case"minutes":return new Date(ce.getFullYear(),ce.getMonth(),ce.getDate(),ce.getHours(),ce.getMinutes());case"hours":return new Date(ce.getFullYear(),ce.getMonth(),ce.getDate(),ce.getHours());case"days":return new Date(ce.getFullYear(),ce.getMonth(),ce.getDate());case"weeks":return new Date(ce.getFullYear(),ce.getMonth(),ce.getDate()-ce.getDay());case"months":return new Date(ce.getFullYear(),ce.getMonth(),1);case"years":return new Date(ce.getFullYear(),0,1);case"decades":return new Date(ce.getFullYear()-ce.getFullYear()%10,0,1);case"centuries":return new Date(ce.getFullYear()-ce.getFullYear()%100,0,1);default:return new Date}}function W(ce,oe,le="milliseconds"){const Y=new Date(ue(oe,le,"milliseconds"));return Y.setUTCFullYear(ce.getUTCFullYear(),ce.getUTCMonth(),ce.getUTCDate()),Y}function B(ce,oe="milliseconds"){const le=ue(ce.getUTCHours(),"hours","milliseconds"),Y=ue(ce.getUTCMinutes(),"minutes","milliseconds"),j=ue(ce.getUTCSeconds(),"seconds","milliseconds");return ue(le+Y+j+ce.getUTCMilliseconds(),"milliseconds",oe)}function Z(ce,oe){const le=new Date(ce.getTime());return le.setUTCFullYear(oe.getFullYear(),oe.getMonth(),oe.getDate()),le}function ie(ce){const oe=new Date(0);return oe.setHours(0),oe.setMinutes(0),oe.setSeconds(0),oe.setMilliseconds(0),oe.setFullYear(ce.getUTCFullYear(),ce.getUTCMonth(),ce.getUTCDate()),oe}function ue(ce,oe,le){return 0===ce?0:ce*A[oe]/A[le]}},55713:(dt,Re,T)=>{"use strict";T.d(Re,{Ed:()=>A,Hx:()=>Z,KZ:()=>J,Uc:()=>B,W0:()=>H,Xw:()=>le,ZY:()=>ie,eP:()=>Q,fS:()=>ce,lq:()=>re,qo:()=>oe,tP:()=>G,xZ:()=>ue,z3:()=>W});var x=T(62208);function A(Y,j){if(Y.forEach)Y.forEach(j);else for(let X=0;X<Y.length;X++)j(Y[X],X,Y)}function G(Y,j,X){if(Y.slice)return Y.slice(j,X);void 0===j?j=0:(j<0&&(j+=Y.length),j=Math.min(Y.length,Math.max(0,j))),void 0===X?X=Y.length:(X<0&&(X+=Y.length),X=Math.min(Y.length,Math.max(0,X)));const U=Math.max(0,X-j),ee=new Y.constructor(U);for(let $=0;$<U;$++)ee[$]=Y[j+$];return ee}function Q(Y){return Y instanceof ArrayBuffer||Y&&Y.constructor&&"ArrayBuffer"===Y.constructor.name}function H(Y){return Y instanceof Int8Array||Y&&Y.constructor&&"Int8Array"===Y.constructor.name}function re(Y){return Y instanceof Uint8Array||Y&&Y.constructor&&"Uint8Array"===Y.constructor.name}function J(Y){return Y instanceof Uint8ClampedArray||Y&&Y.constructor&&"Uint8ClampedArray"===Y.constructor.name}function W(Y){return Y instanceof Int16Array||Y&&Y.constructor&&"Int16Array"===Y.constructor.name}function B(Y){return Y instanceof Uint16Array||Y&&Y.constructor&&"Uint16Array"===Y.constructor.name}function Z(Y){return Y instanceof Int32Array||Y&&Y.constructor&&"Int32Array"===Y.constructor.name}function ie(Y){return Y instanceof Uint32Array||Y&&Y.constructor&&"Uint32Array"===Y.constructor.name}function ue(Y){return Y instanceof Float32Array||Y&&Y.constructor&&"Float32Array"===Y.constructor.name}function ce(Y){return Y instanceof Float64Array||Y&&Y.constructor&&"Float64Array"===Y.constructor.name}function oe(Y){const j=new Array(Y.length);for(let X=0;X<Y.length;X++)j[X]=Y[X];return j}function le(Y){return(0,x.Wi)(Y)?0:128+Y.buffer.byteLength+64}},86236:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>G,u:()=>A});let x=0;const A=0;function G(){return++x}},90466:(dt,Re,T)=>{"use strict";T.d(Re,{L4:()=>ne,LO:()=>Z,Rd:()=>ie,Ud:()=>le,VG:()=>B,Wv:()=>ce,Zv:()=>j,_o:()=>_e,aC:()=>X,h9:()=>oe,ld:()=>U,mg:()=>ue,q6:()=>Y,sS:()=>he,yc:()=>ee});var x=T(27306),A=T(23719),G=T(21286),Q=T(62208),H=T(77275),re=T(16730),J=T(15348);function W(ge,ye,Me){return ge.units[ye][Me]}function B(ge,ye,Me,Ee=2,Te="abbr"){return`${(0,J.uf)(ye,{minimumFractionDigits:Ee,maximumFractionDigits:Ee})} ${W(ge,Me,Te)}`}function Z(ge,ye,Me,Ee=2,Te="abbr"){return`${(0,J.uf)(ye,{minimumFractionDigits:Ee,maximumFractionDigits:Ee,signDisplay:"exceptZero"})} ${W(ge,Me,Te)}`}function ie(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.KU)(ye,Me);return B(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function ue(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.KU)(ye,Me);return Z(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function ce(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.OG)(ye,Me);return B(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function oe(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.OG)(ye,Me);return Z(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function le(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.FN)(ye,Me);return B(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function Y(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.FN)(ye,Me);return Z(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function j(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.qv)(ye,Me);return B(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function X(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.qv)(ye,Me);return Z(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function U(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.tQ)(ye,Me);return B(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function ee(ge,ye,Me,Ee=2,Te="abbr"){const me=(0,re.Yl)(ye,Me);return B(ge,(0,re.En)(ye,Me,me),me,Ee,Te)}function ne(ge,ye,Me,Ee,Te){const me=A.BV.normalize(function se(ge,ye,Me){if(ye===Me)return ge;switch(Me){case"arithmetic":return function ae(ge){return 90-ge}(ge);case"geographic":return function de(ge){return-ge-90}(ge)}}((0,re.En)(ge,ye,"degrees"),Me,Ee),0,!0);return Te=(0,Q.Pt)(Te,2),(0,J.uf)(me,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:Te,minimumFractionDigits:Te})}function _e(ge,ye,Me,Ee,Te){Me!==Ee&&(ge=-ge);const me=(0,re.En)(ge,ye,"degrees")%360;return Te=(0,Q.Pt)(Te,2),(0,J.uf)(me,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:Te,minimumFractionDigits:Te,signDisplay:"exceptZero"})}const pe=["B","kB","MB","GB","TB"];function he(ge,ye){let Me=0===ye?0:Math.floor(Math.log(ye)/Math.log(x.Y8.KILOBYTES));Me=(0,G.uZ)(Me,0,pe.length-1);const Ee=(0,J.uf)(ye/x.Y8.KILOBYTES**Me,{maximumFractionDigits:2});return(0,H.gx)(ge.units.bytes[pe[Me]],{fileSize:Ee})}},16730:(dt,Re,T)=>{"use strict";T.d(Re,{$C:()=>We,En:()=>ye,FN:()=>Ie,Jo:()=>wt,KU:()=>me,OG:()=>Ce,RG:()=>ke,UF:()=>_e,Yl:()=>xe,_R:()=>we,c9:()=>$e,cM:()=>Oe,gV:()=>yt,hd:()=>B,j5:()=>ve,oq:()=>qe,qE:()=>Fe,qv:()=>Ge,tQ:()=>Je,ty:()=>je,y:()=>Ke}),T(8314);var A=T(2076),G=T(62208),Q=T(12080),H=T(65234),re=T(94425),J=T(37053),W=T(84029);const B=39.37,Z=re.sv.radius*Math.PI/200,ie=/UNIT\[([^\]]+)\]\]$/i,ue=W.Z,ce=/UNIT\[([^\]]+)\]/i,oe=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),le=(0,A.w)()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Y=Rt=>Rt*Rt,j=Rt=>Rt*Rt*Rt,X={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Y(.001)},"square-centimeters":{inBaseUnits:Y(.01)},"square-decimeters":{inBaseUnits:Y(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Y(1e3)},"square-inches":{inBaseUnits:Y(.0254)},"square-feet":{inBaseUnits:Y(.3048)},"square-yards":{inBaseUnits:Y(.9144)},"square-miles":{inBaseUnits:Y(1609.344)},"square-us-feet":{inBaseUnits:Y(1200/3937)},acres:{inBaseUnits:.0015625*Y(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*j(.001)},"cubic-centimeters":{inBaseUnits:1e3*j(.01)},"cubic-decimeters":{inBaseUnits:1e3*j(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*j(1e3)},"cubic-inches":{inBaseUnits:1e3*j(.0254)},"cubic-feet":{inBaseUnits:1e3*j(.3048)},"cubic-yards":{inBaseUnits:1e3*j(.9144)},"cubic-miles":{inBaseUnits:1e3*j(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},U=(()=>{const Rt={};for(const Ft in X)for(const bt in X[Ft].units)Rt[bt]=Ft;return Rt})(),se=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],ae=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function _e(Rt){const Ft=U[Rt];if(!Ft)throw new Error("unknown type");return Ft}function ge(Rt,Ft=null){return Ft=Ft||_e(Rt),X[Ft].baseUnit===Rt}function ye(Rt,Ft,bt){if(Ft===bt)return Rt;const St=_e(Ft);if(St!==_e(bt))throw new Error("incompatible units");const Xt=ge(Ft,St)?Rt:function ee(Rt,Ft,bt){return Rt*X[bt].units[Ft].inBaseUnits}(Rt,Ft,St);return ge(bt,St)?Xt:function $(Rt,Ft,bt){return Rt/X[bt].units[Ft].inBaseUnits}(Xt,bt,St)}function me(Rt,Ft){const bt=ye(Rt,Ft,"meters");return Math.abs(bt)<3e3?"meters":"kilometers"}function Ce(Rt,Ft){const bt=ye(Rt,Ft,"meters");return Math.abs(bt)<1e5?"meters":"kilometers"}function Ie(Rt,Ft){const bt=ye(Rt,Ft,"feet");return Math.abs(bt)<1e3?"feet":"miles"}function Ge(Rt,Ft){const bt=ye(Rt,Ft,"feet");return Math.abs(bt)<1e5?"feet":"miles"}function Je(Rt,Ft){const bt=ye(Rt,Ft,"square-meters");return Math.abs(bt)<3e6?"square-meters":"square-kilometers"}function xe(Rt,Ft){const bt=ye(Rt,Ft,"square-feet");return Math.abs(bt)<1e6?"square-feet":"square-miles"}function je(Rt,Ft,bt){return ye(Rt,Ft,"meters")/(bt*Math.PI/180)}function We(Rt){return le.fromJSON(Rt.toLowerCase())||null}function we(Rt){if(Rt&&"object"==typeof Rt&&!(0,J.N$)(Rt))return 1;const Ft=$e(Rt);return Ft>1e5?1:Ft}function Oe(Rt){return $e(Rt)>=(Rt instanceof H.Z?(0,Q.Iu)(Rt).metersPerDegree:1e5)?"meters":Fe(Rt)}function $e(Rt,Ft=re.sv.metersPerDegree){return(0,G.Pt)(function Be(Rt,Ft=!1){let bt,St,Xt=null;if(null!=Rt&&("object"==typeof Rt?(bt=Rt.wkid,St=Rt.wkt):"number"==typeof Rt?bt=Rt:"string"==typeof Rt&&(St=Rt)),bt){if((0,J.o$)(bt))return re.yr.metersPerDegree;if((0,J.ME)(bt))return re.Z1.metersPerDegree;Xt=ue.values[ue[bt]],!Xt&&Ft&&oe.has(bt)&&(Xt=Z)}else St&&(tt(St)?Xt=Se(ie.exec(St),Xt):be(St)&&(Xt=Se(ce.exec(St),Xt)));return Xt}(Rt,!0),Ft)}function Se(Rt,Ft){return Rt&&Rt[1]?De(Rt[1]):Ft}function De(Rt){return parseFloat(Rt.split(",")[1])}function Fe(Rt){let Ft,bt,St=null;if(null!=Rt&&("object"==typeof Rt?(Ft=Rt.wkid,bt=Rt.wkt):"number"==typeof Rt?Ft=Rt:"string"==typeof Rt&&(bt=Rt)),Ft)St=ue.units[ue[Ft]];else if(bt){const Xt=tt(bt)?ie:be(bt)?ce:null;if(Xt){const Mr=Xt.exec(bt);Mr&&Mr[1]&&(St=function ze(Rt){const Ft=/[\\"\\']{1}([^\\"\\']+)/.exec(Rt);let bt=Ft&&Ft[1];if(!bt||!ue.units.includes(bt)){const St=De(Rt);bt=null;const Xt=ue.values;for(let Mr=0;Mr<Xt.length;++Mr)if(Math.abs(St-Xt[Mr])<1e-7){bt=ue.units[Mr];break}}return bt}(Mr[1]))}}return(0,G.pC)(St)?We(St):null}function ve(Rt){const Ft=Fe(Rt);return(0,G.Wi)(Ft)||!se.includes(Ft)?null:Ft}function Ke(Rt){const Ft=Oe(Rt);return(0,G.Wi)(Ft)||!se.includes(Ft)?null:Ft}function qe(Rt){const Ft=Fe(Rt);return(0,G.Wi)(Ft)?null:ae.get(Ft)}function be(Rt){return/^GEOCCS/i.test(Rt)}function tt(Rt){return/^PROJCS/i.test(Rt)}function ke(Rt){var Xt,Mr,Cr;const Ft="metric";if((0,G.Wi)(Rt))return Ft;const bt=Rt.map,St=bt&&"portalItem"in bt?null==(Xt=bt.portalItem)?void 0:Xt.portal:null;if(St)switch(null!=(Cr=null==(Mr=null==St?void 0:St.user)?void 0:Mr.units)?Cr:St.units){case Ft:return Ft;case"english":return"imperial"}return(0,G.Pt)(function et(Rt){const Ft=Fe(Rt);if((0,G.Wi)(Ft))return null;switch(Ft){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}(Rt.spatialReference),Ft)}const ot={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},at={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},yt=(0,A.w)()(ot),wt=(0,A.w)()(at);(0,A.w)()(or(or({},ot),at))},21726:(dt,Re,T)=>{"use strict";T.d(Re,{$U:()=>Ft,AH:()=>Ke,B7:()=>ge,D6:()=>je,Fv:()=>$e,HK:()=>ve,Hu:()=>ri,Ie:()=>Ur,L:()=>se,Ml:()=>Nt,P$:()=>Se,PF:()=>Oe,Qj:()=>Zt,R9:()=>Y,TI:()=>ne,YP:()=>De,Yd:()=>jt,ZN:()=>hr,_l:()=>Ye,b7:()=>ye,ed:()=>Ie,fl:()=>Dr,hF:()=>we,hO:()=>Mr,io:()=>ke,jc:()=>Fe,kl:()=>We,mN:()=>_e,oC:()=>zt,oh:()=>xe,qg:()=>Me,rS:()=>qe,sJ:()=>tt,tD:()=>Ce,tm:()=>Ge,u0:()=>pe,v_:()=>Be,vt:()=>qt,zd:()=>Zr});var x=T(59318),A=T(26584),G=T(63290),Q=T(62208);const H=G.Z.getLogger("esri.core.urlUtils"),re=x.Z.request,J="esri/config: esriConfig.request.proxyUrl is not set.",W=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,B=/^\s*http:/i,Z=/^\s*https:/i,ie=/^\s*file:/i,ue=/:\d+$/,ce=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,oe=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),le=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");class Y{constructor(rr=""){this.uri=rr,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let pr=(0,Q.j0)(this.uri.match(oe));this.scheme=pr[2]||(pr[1]?"":null),this.authority=pr[4]||(pr[3]?"":null),this.path=pr[5],this.query=pr[7]||(pr[6]?"":null),this.fragment=pr[9]||(pr[8]?"":null),null!=this.authority&&(pr=(0,Q.j0)(this.authority.match(le)),this.user=pr[3]||null,this.password=pr[4]||null,this.host=pr[6]||pr[7],this.port=pr[9]||null)}toString(){return this.uri}}const j={};let U=new Y(x.Z.applicationUrl);let $=function ae(){const Ot=(0,Q.j0)(U.path),rr=Ot.substring(0,Ot.lastIndexOf(Ot.split("/")[Ot.split("/").length-1]));return`${U.scheme}://${U.host}${null!=U.port?`:${U.port}`:""}${rr}`}();const ne=()=>U,se=()=>$;function _e(Ot){const rr={path:null,query:null},pr=new Y(Ot),Pr=Ot.indexOf("?");return null===pr.query?rr.path=Ot:(rr.path=Ot.substring(0,Pr),rr.query=pe(pr.query)),pr.fragment&&(rr.hash=pr.fragment,null===pr.query&&(rr.path=rr.path.substring(0,rr.path.length-(pr.fragment.length+1)))),rr}function pe(Ot){const rr=Ot.split("&"),pr={};for(const Pr of rr){if(!Pr)continue;const Fr=Pr.indexOf("=");let ii,mi;Fr<0?(ii=decodeURIComponent(Pr),mi=""):(ii=decodeURIComponent(Pr.slice(0,Fr)),mi=decodeURIComponent(Pr.slice(Fr+1)));let wi=pr[ii];"string"==typeof wi&&(wi=pr[ii]=[wi]),Array.isArray(wi)?wi.push(mi):pr[ii]=mi}return pr}function he(Ot){return Ot&&"object"==typeof Ot&&"toJSON"in Ot&&"function"==typeof Ot.toJSON}function ge(Ot,rr){return Ot?rr&&"function"==typeof rr?Object.keys(Ot).map(pr=>encodeURIComponent(pr)+"="+encodeURIComponent(rr(pr,Ot[pr]))).join("&"):Object.keys(Ot).map(pr=>{const Pr=Ot[pr];if(null==Pr)return"";const Fr=encodeURIComponent(pr)+"=",ii=rr&&rr[pr];return ii?Fr+encodeURIComponent(ii(Pr)):Array.isArray(Pr)?Pr.map(mi=>he(mi)?Fr+encodeURIComponent(JSON.stringify(mi)):Fr+encodeURIComponent(mi)).join("&"):he(Pr)?Fr+encodeURIComponent(JSON.stringify(Pr)):Fr+encodeURIComponent(Pr)}).filter(pr=>pr).join("&"):""}function ye(Ot=!1){let rr,pr=re.proxyUrl;if("string"==typeof Ot){rr=Ft(Ot);const Pr=Ie(Ot);Pr&&(pr=Pr.proxyUrl)}else rr=!!Ot;if(!pr)throw H.warn(J),new A.Z("urlutils:proxy-not-set",J);return rr&&Yr()&&(pr=Mr(pr)),_e(pr)}function Me(Ot){const rr=Ie(Ot);let pr,Pr;if(rr){const Fr=Te(rr.proxyUrl);pr=Fr.path,Pr=Fr.query?pe(Fr.query):null}if(pr){const Fr=_e(Ot);Ot=pr+"?"+Fr.path;const ii=ge(or(or({},Pr),Fr.query));ii&&(Ot=`${Ot}?${ii}`)}return Ot}const Ee={path:"",query:""};function Te(Ot){const rr=Ot.indexOf("?");return-1!==rr?(Ee.path=Ot.slice(0,rr),Ee.query=Ot.slice(rr+1)):(Ee.path=Ot,Ee.query=null),Ee}function me(Ot){return(Ot=Lr(Ot=function er(Ot){return Ot&&"/"===Ot[Ot.length-1]?Ot:`${Ot}/`}(Ot=Te(Ot).path),!0)).toLowerCase()}function Ce(Ot){const rr={proxyUrl:Ot.proxyUrl,urlPrefix:me(Ot.urlPrefix)},pr=re.proxyRules,Pr=rr.urlPrefix;let Fr=pr.length;for(let ii=0;ii<pr.length;ii++){const mi=pr[ii].urlPrefix;if(0===Pr.indexOf(mi)){if(Pr.length===mi.length)return-1;Fr=ii;break}0===mi.indexOf(Pr)&&(Fr=ii+1)}return pr.splice(Fr,0,rr),Fr}function Ie(Ot){const rr=re.proxyRules,pr=me(Ot);for(let Pr=0;Pr<rr.length;Pr++)if(0===pr.indexOf(rr[Pr].urlPrefix))return rr[Pr]}function Ge(Ot,rr){return Ot=Je(Ot),rr=Je(rr),Lr(Ot)===Lr(rr)}function Je(Ot){const rr=(Ot=$e(Ot)).indexOf("/sharing");return rr>0?Ot.substring(0,rr):Ot.replace(/\/+$/,"")}function xe(Ot){const rr=Pr=>null==Pr||Pr instanceof RegExp&&Pr.test(Ot)||"string"==typeof Pr&&Ot.startsWith(Pr),pr=re.interceptors;if(pr)for(const Pr of pr)if(Array.isArray(Pr.urls)){if(Pr.urls.some(rr))return Pr}else if(rr(Pr.urls))return Pr;return null}function je(Ot,rr,pr=!1){const Pr=Br(Ot),Fr=Br(rr);return!(!pr&&Pr.scheme!==Fr.scheme)&&null!=Pr.host&&null!=Fr.host&&Pr.host.toLowerCase()===Fr.host.toLowerCase()&&Pr.port===Fr.port}function We(Ot){if("string"==typeof Ot){if(!De(Ot))return!0;Ot=Br(Ot)}if(je(Ot,U))return!0;const rr=re.trustedServers||[];for(let pr=0;pr<rr.length;pr++){const Pr=Ne(rr[pr]);for(let Fr=0;Fr<Pr.length;Fr++)if(je(Ot,Pr[Fr]))return!0}return!1}function Ne(Ot){return j[Ot]||(j[Ot]=Rt(Ot)||zt(Ot)?[new Y(we(Ot))]:[new Y(`http://${Ot}`),new Y(`https://${Ot}`)]),j[Ot]}function we(Ot,rr=$,pr){return zt(Ot)?pr&&pr.preserveProtocolRelative?Ot:"http"===U.scheme&&U.authority===Se(Ot).slice(2)?`http:${Ot}`:`https:${Ot}`:Rt(Ot)?Ot:(0,Q.j0)(Be("/"===Ot[0]?function ct(Ot){const rr=Ot.indexOf("//"),pr=Ot.indexOf("/",rr+2);return-1===pr?Ot:Ot.slice(0,pr)}(rr):rr,Ot))}function Oe(Ot,rr=$,pr){if(!De(Ot))return Ot;const Pr=$e(Ot),Fr=Pr.toLowerCase(),ii=$e(rr).toLowerCase().replace(/\/+$/,""),mi=pr?$e(pr).toLowerCase().replace(/\/+$/,""):null;if(mi&&0!==ii.indexOf(mi))return Ot;const wi=(Ar,ni,_i)=>-1===(_i=Ar.indexOf(ni,_i))?Ar.length:_i;let Qr=wi(Fr,"/",Fr.indexOf("//")+2),Ni=-1;for(;Fr.slice(0,Qr+1)===ii.slice(0,Qr)+"/"&&(Ni=Qr+1,Qr!==Fr.length);)Qr=wi(Fr,"/",Qr+1);if(-1===Ni||mi&&Ni<mi.length)return Ot;Ot=Pr.slice(Ni);const Hs=ii.slice(Ni-1).replace(/[^/]+/g,"").length;if(Hs>0)for(let Ar=0;Ar<Hs;Ar++)Ot=`../${Ot}`;else Ot=`./${Ot}`;return Ot}function $e(Ot){return function fr(Ot){const rr=re.httpsDomains;if(!function bt(Ot){return B.test(Ot)||"http"===U.scheme&&zt(Ot)}(Ot))return Ot;const pr=Ot.indexOf("/",7);let Pr;if(Pr=-1===pr?Ot:Ot.slice(0,pr),Pr=Pr.toLowerCase().slice(7),ue.test(Pr)){if(!Pr.endsWith(":80"))return Ot;Pr=Pr.slice(0,-3),Ot=Ot.replace(":80","")}return function Cr(){return"http"===U.scheme}()&&Pr===U.authority&&!ce.test(Ot)||(Yr()&&Pr===U.authority||rr&&rr.some(Fr=>Pr===Fr||Pr.endsWith(`.${Fr}`))||Yr()&&!Ie(Ot))&&(Ot=Mr(Ot)),Ot}(Ot=function ir(Ot){return Ot.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}(Ot=function tr(Ot){if(/^https?:\/\//i.test(Ot)){const rr=Te(Ot);Ot=(Ot=rr.path.replace(/\/{2,}/g,"/")).replace("/","//"),rr.query&&(Ot+=`?${rr.query}`)}return Ot}(Ot=we(Ot=Ot.trim()))))}function Be(...Ot){const rr=Ot.filter(Q.pC);if(!rr||!rr.length)return;const pr=[];if(De(rr[0])){const Fr=rr[0],ii=Fr.indexOf("//");-1!==ii&&(pr.push(Fr.slice(0,ii+1)),function St(Ot){return ie.test(Ot)}(rr[0])&&(pr[0]+="/"),rr[0]=Fr.slice(ii+2))}else"/"===rr[0][0]&&pr.push("");const Pr=rr.reduce((Fr,ii)=>ii?Fr.concat(ii.split("/")):Fr,[]);for(let Fr=0;Fr<Pr.length;Fr++){const ii=Pr[Fr];".."===ii&&pr.length>0&&".."!==pr[pr.length-1]?pr.pop():(!ii&&Fr===Pr.length-1||ii&&("."!==ii||0===pr.length))&&pr.push(ii)}return pr.join("/")}function Se(Ot,rr=!1){if(Fe(Ot)||ve(Ot))return null;let pr=Ot.indexOf("://");if(-1===pr&&zt(Ot))pr=2;else{if(-1===pr)return null;pr+=3}const Pr=Ot.indexOf("/",pr);return-1!==Pr&&(Ot=Ot.slice(0,Pr)),rr&&(Ot=Lr(Ot,!0)),Ot}function De(Ot){return zt(Ot)||Rt(Ot)}function Fe(Ot){return null!=Ot&&"blob:"===Ot.slice(0,5)}function ve(Ot){return"data:"===Ot.slice(0,5)}function Ke(Ot){const rr=tt(Ot);if(!rr||!rr.isBase64)return null;const pr=atob(rr.data),Pr=new Uint8Array(pr.length);for(let Fr=0;Fr<pr.length;Fr++)Pr[Fr]=pr.charCodeAt(Fr);return Pr.buffer}function qe(Ot){return btoa(String.fromCharCode.apply(null,Ot)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}const be=/^data:(.*?)(;base64)?,(.*)$/;function tt(Ot){const rr=Ot.match(be);if(!rr)return null;const[,pr,Pr,Fr]=rr;return{mediaType:pr,isBase64:!!Pr,data:Fr}}function Ye(Ot){return Ot.isBase64?`data:${Ot.mediaType};base64,${Ot.data}`:`data:${Ot.mediaType},${Ot.data}`}function ke(Ot,rr){(function at(Ot,rr){if(!Ot)return!1;const pr=document.createElement("a");if(!("download"in pr))return!1;const Pr=URL.createObjectURL(Ot);return pr.download=rr,pr.href=Pr,pr.style.display="none",document.body.appendChild(pr),pr.click(),document.body.removeChild(pr),URL.revokeObjectURL(Pr),!0})(Ot,rr)||function wt(Ot,rr){return!!window.navigator.msSaveOrOpenBlob&&window.navigator.msSaveOrOpenBlob(Ot,rr)}(Ot,rr)}function zt(Ot){return null!=Ot&&void 0!==Ot&&"/"===Ot[0]&&"/"===Ot[1]}function Rt(Ot){return W.test(Ot)}function Ft(Ot){return Z.test(Ot)||"https"===U.scheme&&zt(Ot)}function Mr(Ot){return zt(Ot)?`https:${Ot}`:Ot.replace(B,"https:")}function Yr(){return"https"===U.scheme}function Lr(Ot,rr=!1){return zt(Ot)?Ot.slice(2):(Ot=Ot.replace(W,""),rr&&Ot.length>1&&"/"===Ot[0]&&"/"===Ot[1]&&(Ot=Ot.slice(2)),Ot)}function jt(Ot){let rr=0;if(De(Ot)){const Pr=Ot.indexOf("//");-1!==Pr&&(rr=Pr+2)}const pr=Ot.lastIndexOf("/");return pr<rr?Ot:Ot.slice(0,pr+1)}function qt(Ot,rr){if(!Ot)return"";const pr=_e(Ot).path.replace(/\/+$/,""),Pr=pr.substring(pr.lastIndexOf("/")+1);if(!(null==rr?void 0:rr.length))return Pr;const Fr=new RegExp(`.(${rr.join("|")})$`,"ig");return Pr.replace(Fr,"")}function Zt(Ot){return Ot.replace(/\/+$/,"")}function Ur(Ot,rr,pr){if(!(rr&&pr&&Ot&&De(Ot)))return Ot;const Pr=Ot.indexOf("//"),Fr=Ot.indexOf("/",Pr+2),ii=Ot.indexOf(":",Pr+2),mi=Math.min(Fr<0?Ot.length:Fr,ii<0?Ot.length:ii);return Ot.slice(Pr+2,mi).toLowerCase()!==rr.toLowerCase()?Ot:`${Ot.slice(0,Pr+2)}${pr}${Ot.slice(mi)}`}function Br(Ot){return"string"==typeof Ot?new Y(we(Ot)):(Ot.scheme||(Ot.scheme=U.scheme),Ot)}function Zr(Ot){return jr.test(Ot)}function ri(Ot,rr){const pr=_e(Ot),Pr=Object.keys(pr.query||{});return Pr.length>0&&rr&&rr.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${Pr.join(", ")}.`),pr.path}function hr(Ot,rr,pr){const Pr=_e(Ot),Fr=Pr.query||{};return Fr[rr]=String(pr),`${Pr.path}?${ge(Fr)}`}function Dr(Ot,rr){const pr=_e(Ot),Pr=pr.query||{};for(const ii in rr)Pr[ii]=rr[ii];const Fr=ge(Pr);return Fr?`${pr.path}?${Fr}`:pr.path}function Nt(Ot){if((0,Q.Wi)(Ot))return null;const rr=Ot.match(lr);return rr?rr[1]:null}const lr=/.*?\.([^\/]*)$/,jr=/(^data:image\/svg|\.svg$)/i},35948:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>A});const x="randomUUID"in crypto;function A(){if(x)return crypto.randomUUID();const G=crypto.getRandomValues(new Uint16Array(8));G[3]=4095&G[3]|16384,G[4]=16383&G[4]|32768;const Q=H=>G[H].toString(16);return Q(0)+Q(1)+"-"+Q(2)+"-"+Q(3)+"-"+Q(4)+"-"+Q(5)+Q(6)+Q(7)}},93662:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>J});var x=T(54024),A=T(63290),G=T(10699),Q=T(35133),H=T(89951);const re=A.Z.getLogger("esri.core.workers.Connection");class J{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new Q.Z}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(B,Z){return new Promise((ie,ue)=>{let ce=!0;const oe=le=>{(0,G.k_)(Z.signal),ce&&(ce=!1,le())};this._clients.length=B.length,this._clientPromises.length=B.length,this._inUseClients.length=B.length;for(let le=0;le<B.length;++le){const Y=B[le];(0,G.y8)(Y)?this._clientPromises[le]=Y.then(j=>(this._clients[le]=new H.Z(j,Z,()=>this._ongoingJobsQueue.pop()),oe(ie),this._clients[le]),()=>(oe(ue),null)):(this._clients[le]=new H.Z(Y,Z,()=>this._ongoingJobsQueue.pop()),this._clientPromises[le]=Promise.resolve(this._clients[le]),oe(ie))}})}broadcast(B,Z,ie){const ue=new Array(this._clientPromises.length);for(let ce=0;ce<this._clientPromises.length;++ce)ue[ce]=this._clientPromises[ce].then(le=>le.invoke(B,Z,ie));return ue}close(){let B;for(;B=this._ongoingJobsQueue.pop();)B.deferred.reject((0,G.zE)(`Worker closing, aborting job calling '${B.methodName}'`));for(const Z of this._clientPromises)Z.then(ie=>ie.close());this._clients.length=0,this._clientPromises.length=0}invoke(B,Z,ie){let ue=null;Array.isArray(ie)?(re.warn("invoke()","The transferList parameter is deprecated, use the options object instead"),ue={transferList:ie}):ue=ie;const ce=(0,G.dD)();this._ongoingJobsQueue.push({methodName:B,data:Z,invokeOptions:ue,deferred:ce});for(let oe=0;oe<this._clientPromises.length;oe++){const le=this._clients[oe];le?le.jobAdded():this._clientPromises[oe].then(Y=>Y.jobAdded())}return ce.promise}on(B,Z){return Promise.all(this._clientPromises).then(()=>(0,x.AL)(this._clients.map(ie=>ie.on(B,Z))))}openPorts(){return new Promise(B=>{const Z=new Array(this._clientPromises.length);let ie=Z.length;for(let ue=0;ue<this._clientPromises.length;++ue)this._clientPromises[ue].then(ce=>{Z[ue]=ce.openPort(),0==--ie&&B(Z)})})}get test(){return{numClients:this._clients.length}}}},89951:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>j});var x=T(24263),A=T(26584),G=T(17770),Q=T(62208),H=T(10699),re=T(13126),J=T(38365);const W={statsWorker:()=>T.e(4135).then(T.bind(T,44135)),geometryEngineWorker:()=>Promise.all([T.e(4918),T.e(8592),T.e(8632)]).then(T.bind(T,77692)),CSVSourceWorker:()=>Promise.all([T.e(3464),T.e(4896)]).then(T.bind(T,54896)),EdgeProcessingWorker:()=>Promise.resolve().then(T.bind(T,51445)),ElevationSamplerWorker:()=>Promise.all([T.e(8592),T.e(8149)]).then(T.bind(T,28149)),FeatureServiceSnappingSourceWorker:()=>Promise.all([T.e(3464),T.e(6354)]).then(T.bind(T,86354)),GeoJSONSourceWorker:()=>Promise.all([T.e(3464),T.e(8592),T.e(4079)]).then(T.bind(T,84079)),LercWorker:()=>T.e(7300).then(T.bind(T,57300)),MemorySourceWorker:()=>Promise.all([T.e(3464),T.e(8592),T.e(7728)]).then(T.bind(T,7728)),PBFDecoderWorker:()=>T.e(4287).then(T.bind(T,84287)),Pipeline:()=>Promise.all([T.e(3464),T.e(5895),T.e(9628),T.e(8592),T.e(3251)]).then(T.bind(T,11288)),PointCloudWorker:()=>Promise.all([T.e(4471),T.e(4056)]).then(T.bind(T,44056)),RasterWorker:()=>Promise.all([T.e(7692),T.e(4307),T.e(8594),T.e(8592),T.e(5976)]).then(T.bind(T,15976)),SceneLayerSnappingSourceWorker:()=>T.e(4109).then(T.bind(T,54109)),SceneLayerWorker:()=>T.e(375).then(T.bind(T,30375)),WFSSourceWorker:()=>Promise.all([T.e(3464),T.e(3774),T.e(8592),T.e(2305)]).then(T.bind(T,62305)),WorkerTileHandler:()=>Promise.all([T.e(3751),T.e(8364),T.e(4522),T.e(195)]).then(T.bind(T,90195))},{CLOSE:B,ABORT:Z,INVOKE:ie,RESPONSE:ue,OPEN_PORT:ce,ON:oe}=re.Cs;class Y{constructor(U){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=U,this._timer=null,this._process=this._process.bind(this)}push(U){U.type===re.Cs.ABORT?this._cancelledJobIds.add(U.jobId):(this._invokeMessages.push(U),null===this._timer&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const U of this._invokeMessages)this._cancelledJobIds.has(U.jobId)||this._invoke(U);this._cancelledJobIds.clear(),this._invokeMessages.length=0}}class j{constructor(U,ee,$){this._port=U,this._getNextJob=$,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new Y(ne=>this._onInvokeMessage(ne)),this._client=ee.client,this._onMessage=this._onMessage.bind(this),this._channel=ee.channel,this._schedule=ee.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}static connect(U){const ee=new MessageChannel;let $;$="function"==typeof U?new U:"default"in U&&"function"==typeof U.default?new U.default:U;const ne=new j(ee.port1,{channel:ee,client:$},()=>null);return"object"==typeof $&&"remoteClient"in $&&($.remoteClient=ne),j.clients.set(ne,$),ee.port2}static loadWorker(U){const ee=W[U];return ee?ee():Promise.resolve(null)}close(){this._post({type:B}),this._close()}isBusy(){return this._outJobs.size>0}invoke(U,ee,$){const ne=$&&$.signal,se=$&&$.transferList;if(!this._port)return Promise.reject(new A.Z("worker:port-closed",`Cannot call invoke('${U}'), port is closed`,{methodName:U,data:ee}));const ae=(0,re.jt)();return new Promise((de,_e)=>{if((0,H.Hc)(ne))return this._processWork(),void _e((0,H.zE)());const pe=(0,H.fu)(ne,()=>{const ge=this._outJobs.get(ae);ge&&(this._outJobs.delete(ae),this._processWork(),(0,Q.hw)(ge.abortHandle),this._post({type:Z,jobId:ae}),_e((0,H.zE)()))});this._outJobs.set(ae,{resolve:de,reject:_e,abortHandle:pe,debugInfo:U}),this._post({type:ie,jobId:ae,methodName:U,abortable:null!=ne},ee,se)})}on(U,ee){const $=new MessageChannel;function ne(se){ee(se.data)}return this._port.postMessage({type:re.Cs.ON,eventType:U,port:$.port2},[$.port2]),$.port1.addEventListener("message",ne),$.port1.start(),{remove(){$.port1.postMessage({type:re.Cs.CLOSE}),$.port1.close(),$.port1.removeEventListener("message",ne)}}}jobAdded(){this._processWork()}openPort(){const U=new MessageChannel;return this._post({type:ce,port:U.port2}),U.port1}_processWork(){if(this._outJobs.size>=2)return;const U=this._getNextJob();if(!U)return;const{methodName:ee,data:$,invokeOptions:ne,deferred:se}=U;this.invoke(ee,$,ne).then(ae=>se.resolve(ae)).catch(ae=>se.reject(ae))}_close(){this._channel&&(this._channel=null),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(U=>{(0,Q.hw)(U.abortHandle),U.reject((0,H.zE)(`Worker closing, aborting job calling '${U.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=this._client=this._schedule=null}_onMessage(U){(0,Q.pC)(this._schedule)?this._schedule(()=>this._processMessage(U)):this._processMessage(U)}_processMessage(U){const ee=(0,re.QM)(U);if(ee)switch(ee.type){case ue:this._onResponseMessage(ee);break;case ie:this._invokeQueue.push(ee);break;case Z:this._onAbortMessage(ee);break;case B:this._onCloseMessage();break;case ce:this._onOpenPortMessage(ee);break;case oe:this._onOnMessage(ee)}}_onAbortMessage(U){const ee=this._inJobs,$=U.jobId,ne=ee.get($);this._invokeQueue.push(U),ne&&(ne.controller&&ne.controller.abort(),ee.delete($))}_onCloseMessage(){const U=this._client;this._close(),U&&"destroy"in U&&j.clients.get(this)===U&&U.destroy(),j.clients.delete(this),U&&U.remoteClient&&(U.remoteClient=null)}_onInvokeMessage(U){const{methodName:ee,jobId:$,data:ne,abortable:se}=U,ae=se?new AbortController:null,de=this._inJobs;let _e,pe=this._client,he=pe[ee];try{if(!he&&ee&&ee.includes(".")){const ge=ee.split(".");for(let ye=0;ye<ge.length-1;ye++)pe=pe[ge[ye]],he=pe[ge[ye+1]]}if("function"!=typeof he)throw new TypeError(`${ee} is not a function`);_e=he.call(pe,ne,{client:this,signal:ae?ae.signal:null})}catch(ge){return void this._post({type:ue,jobId:$,error:(0,re.AB)(ge)})}(0,H.y8)(_e)?(de.set($,{controller:ae,promise:_e}),_e.then(ge=>{de.has($)&&(de.delete($),this._post({type:ue,jobId:$},ge))},ge=>{de.has($)&&(de.delete($),(0,H.D_)(ge)||this._post({type:ue,jobId:$,error:(0,re.AB)(ge||{message:`Error encountered at method ${ee}`})}))})):this._post({type:ue,jobId:$},_e)}_onOpenPortMessage(U){new j(U.port,{client:this._client},()=>null)}_onOnMessage(U){const{port:ee}=U,$=this._client.on(U.eventType,se=>{ee.postMessage(se)}),ne=(0,G.on)(U.port,"message",se=>{(0,re.QM)(se).type===re.Cs.CLOSE&&(ne.remove(),$.remove(),ee.close())})}_onResponseMessage(U){const{jobId:ee,error:$,data:ne}=U,se=this._outJobs;if(!se.has(ee))return;const ae=se.get(ee);this._processWork(),se.delete(ee),(0,Q.hw)(ae.abortHandle),$?ae.reject(A.Z.fromJSON(JSON.parse($))):ae.resolve(ne)}_post(U,ee,$){return(0,re.oi)(this._port,U,ee,$)}}j.kernelInfo={revision:J.$,version:x.i8,buildDate:J.r},j.clients=new Map},42930:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>W});var x=T(85931),A=T(54024),G=T(63290),Q=T(62208),H=T(10699),re=T(59289);const J=G.Z.getLogger("esri.core.workers.WorkerHandle");class W{constructor(Z,ie,ue,ce,oe={}){this._mainMethod=ie,this._transferLists=ue,this._listeners=[],this._promise=(0,re.bA)(Z,yi(or({},oe),{schedule:ce})).then(le=>{if(void 0===this._thread){this._thread=le,this._promise=null,oe.hasInitialize&&this.broadcast({},"initialize");for(const Y of this._listeners)this._connectListener(Y)}else le.close()}),this._promise.catch(le=>J.error(`Failed to initialize ${Z} worker: ${le}`))}on(Z,ie){const ue={removed:!1,eventName:Z,callback:ie,threadHandle:null};return this._listeners.push(ue),this._connectListener(ue),(0,A.kB)(()=>{ue.removed=!0,(0,x.Od)(this._listeners,ue),this._thread&&(0,Q.pC)(ue.threadHandle)&&ue.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null}invoke(Z,ie){return this.invokeMethod(this._mainMethod,Z,ie)}invokeMethod(Z,ie,ue){if(this._thread){const ce=this._transferLists[Z],oe=ce?ce(ie):[];return this._thread.invoke(Z,ie,{transferList:oe,signal:ue})}return this._promise?this._promise.then(()=>((0,H.k_)(ue),this.invokeMethod(Z,ie,ue))):Promise.reject(null)}broadcast(Z,ie){return this._thread?Promise.all(this._thread.broadcast(ie,Z)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(Z,ie)):Promise.reject()}get promise(){return this._promise}_connectListener(Z){this._thread&&this._thread.on(Z.eventName,Z.callback).then(ie=>{Z.removed||(Z.threadHandle=ie)})}}},13126:(dt,Re,T)=>{"use strict";T.d(Re,{AB:()=>re,Cs:()=>A,QM:()=>W,jt:()=>Q,oi:()=>J});var A,ie,x=T(8314);(ie=A||(A={}))[ie.HANDSHAKE=0]="HANDSHAKE",ie[ie.OPEN=1]="OPEN",ie[ie.OPENED=2]="OPENED",ie[ie.RESPONSE=3]="RESPONSE",ie[ie.INVOKE=4]="INVOKE",ie[ie.ABORT=5]="ABORT",ie[ie.CLOSE=6]="CLOSE",ie[ie.OPEN_PORT=7]="OPEN_PORT",ie[ie.ON=8]="ON";let G=0;function Q(){return G++}function re(ie){return ie?"string"==typeof ie?JSON.stringify({name:"message",message:ie}):ie.toJSON?JSON.stringify(ie):JSON.stringify({name:ie.name,message:ie.message,details:ie.details||{stack:ie.stack}}):null}function J(ie,ue,ce,oe){if(ue.type===A.OPEN_PORT)return void ie.postMessage(ue,[ue.port]);if(ue.type!==A.INVOKE&&ue.type!==A.RESPONSE)return void ie.postMessage(ue);let le;!function H(ie){return ie&&"object"==typeof ie&&("result"in ie||"transferList"in ie)}(ce)?(le=B(oe),ue.data=ce):(le=B(ce.transferList),ue.data=ce.result),le?ie.postMessage(ue,le):ie.postMessage(ue)}function W(ie){if(!ie)return null;const ue=ie.data;return ue?"string"==typeof ue?JSON.parse(ue):ue:null}function B(ie){if(!ie||!ie.length)return null;if((0,x.Z)("esri-workers-arraybuffer-transfer"))return ie;const ue=ie.filter(ce=>!function Z(ie){return ie instanceof ArrayBuffer||ie&&ie.constructor&&"ArrayBuffer"===ie.constructor.name}(ce));return ue.length?ue:null}},59289:(dt,Re,T)=>{"use strict";T.d(Re,{j2:()=>Be,bA:()=>ve});var x=T(15861),A=T(26584),G=T(8314),Q=T(10699),H=T(93662),re=T(89951),J=T(24263),W=T(63290),B=T(62208),Z=T(13126),ie=T(54346),ue=T(59318),oe=(T(52515),T(21726));const Y={};var U=T(79682);class ee{constructor(){const ke=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(ot=>{this[ot]=(...at)=>ke[ot](...at)})}}class ${constructor(){this._dispatcher=new ee,this._workerPostMessage({type:Z.Cs.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(ke){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=ke,ke&&this.addEventListener("message",ke)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(ke){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=ke,ke&&this.addEventListener("messageerror",ke)}get onerror(){return this._onerrorHandler}set onerror(ke){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=ke,ke&&this.addEventListener("error",ke)}postMessage(ke){(0,U.Y)(()=>{this._workerMessageHandler(new MessageEvent("message",{data:ke}))})}dispatchEvent(ke){return this._dispatcher.dispatchEvent(ke)}addEventListener(ke,ot,at){this._dispatcher.addEventListener(ke,ot,at)}removeEventListener(ke,ot,at){this._dispatcher.removeEventListener(ke,ot,at)}_workerPostMessage(ke){(0,U.Y)(()=>{this.dispatchEvent(new MessageEvent("message",{data:ke}))})}_workerMessageHandler(ke){var ot=this;return(0,x.Z)(function*(){const at=(0,Z.QM)(ke);if(at&&at.type===Z.Cs.OPEN){const{modulePath:yt,jobId:wt}=at;let zt=yield re.Z.loadWorker(yt);zt||(zt=yield import(yt));const Rt=re.Z.connect(zt);ot._workerPostMessage({type:Z.Cs.OPENED,jobId:wt,data:Rt})}})()}}var ne=T(56683),se=T(38365);const ae=W.Z.getLogger("esri.core.workers"),{HANDSHAKE:de}=Z.Cs,_e='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,buildDate:r,version:t}=configuration.kernelInfo,{revision:n,buildDate:i,version:s}=e.kernelInfo;o!==n&&console.warn(`[esri.core.workers] Version mismatch detected between ArcGIS API for JavaScript and assets:\\nAPI version: ${t} [Date: ${r}, Revision: ${o.slice(0,8)}]\nAssets version: ${s} [Date: ${i}, Revision: ${n.slice(0,8)}]`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let e;function t(o){const t=e.connect(o);self.postMessage({type:2,jobId:r,data:t},[t])}"function"==typeof define&&define.amd?require([workerPath],(r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((r=>(e=r.default,checkWorkerRevision(e),e.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((r=>{e=r.default||r,checkWorkerRevision(e),e.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),e=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(e),e.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const e=outgoing.get(r);outgoing.delete(r),o.error?e.reject(JSON.parse(o.error)):e.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let pe,he;const ge="Failed to create Worker. Fallback to execute module in main thread";function Me(){return(Me=(0,x.Z)(function*(){if(!(0,G.Z)("esri-workers")||((0,G.Z)("mozilla"),0))return Ee(new $);if(!pe&&!he)try{const ke=_e.replace('"{CONFIGURATION}"',`'${me()}'`);pe=URL.createObjectURL(new Blob([ke],{type:"text/javascript"}))}catch(ke){he=ke||{}}let et;if(pe)try{et=new Worker(pe,{name:"esri-worker-"+Ce++})}catch(ke){ae.warn(ge,he),et=new $}else ae.warn(ge,he),et=new $;return Ee(et)})).apply(this,arguments)}function Ee(et){return Te.apply(this,arguments)}function Te(){return(Te=(0,x.Z)(function*(et){return new Promise(ke=>{function ot(yt){const wt=(0,Z.QM)(yt);wt&&wt.type===de&&(et.removeEventListener("message",ot),et.removeEventListener("error",at),ke(et))}function at(yt){yt.preventDefault(),et.removeEventListener("message",ot),et.removeEventListener("error",at),ae.warn("Failed to create Worker. Fallback to execute module in main thread",yt),(et=new $).addEventListener("message",ot),et.addEventListener("error",at)}et.addEventListener("message",ot),et.addEventListener("error",at)})})).apply(this,arguments)}function me(){let et;if(null!=ue.Z.default){const yt=or({},ue.Z);delete yt.default,et=JSON.parse(JSON.stringify(yt))}else et=JSON.parse(JSON.stringify(ue.Z));et.assetsPath=(0,oe.hF)(et.assetsPath),et.request.interceptors=[],et.log.interceptors=[],et.locale=(0,ne.Kd)(),et.has={"esri-csp-restrictions":(0,G.Z)("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":(0,G.Z)("esri-2d-update-debug"),"esri-2d-query-centroid-enabled":(0,G.Z)("esri-2d-query-centroid-enabled"),"featurelayer-pbf":(0,G.Z)("featurelayer-pbf"),"featurelayer-simplify-thresholds":(0,G.Z)("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":(0,G.Z)("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":(0,G.Z)("featurelayer-simplify-mobile-factor"),"esri-atomics":(0,G.Z)("esri-atomics"),"esri-shared-array-buffer":(0,G.Z)("esri-shared-array-buffer"),"esri-tiles-debug":(0,G.Z)("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":(0,G.Z)("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":(0,G.Z)("feature-polyline-generalization-factor"),"host-webworker":1},et.workers.loaderUrl&&(et.workers.loaderUrl=(0,oe.hF)(et.workers.loaderUrl)),et.workers.workerPath=(0,oe.hF)(et.workers.workerPath?et.workers.workerPath:(0,ie.V)("esri/core/workers/RemoteClient.js")),et.workers.useDynamicImport=!1;const ke=ue.Z.workers.loaderConfig,ot=function X(et){var ot;const ke={async:et.async,isDebug:et.isDebug,locale:et.locale,baseUrl:et.baseUrl,has:or({},et.has),map:or({},et.map),packages:et.packages&&et.packages.concat()||[],paths:or({},et.paths)};return et.hasOwnProperty("async")||(ke.async=!0),et.hasOwnProperty("isDebug")||(ke.isDebug=!1),et.baseUrl||(ke.baseUrl=Y.baseUrl),null==(ot=Y.packages)||ot.forEach(at=>{!function j(et,ke){for(const ot of et)if(ot.name===ke.name)return;et.push(ke)}(ke.packages,at)}),ke}({baseUrl:null==ke?void 0:ke.baseUrl,locale:(0,ne.Kd)(),has:or({"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1},null==ke?void 0:ke.has),map:or({},null==ke?void 0:ke.map),paths:or({},null==ke?void 0:ke.paths),packages:(null==ke?void 0:ke.packages)||[]});return JSON.stringify({esriConfig:et,loaderConfig:ot,kernelInfo:{version:J.i8,buildDate:se.r,revision:se.$}})}let Ce=0;const Ie=W.Z.getLogger("esri.core.workers"),{ABORT:Ge,INVOKE:Je,OPEN:xe,OPENED:je,RESPONSE:We}=Z.Cs;class Ne{constructor(ke,ot){this._outJobs=new Map,this._inJobs=new Map,this.worker=ke,this.id=ot,ke.addEventListener("message",this._onMessage.bind(this)),ke.addEventListener("error",at=>{at.preventDefault(),Ie.error(at)})}static create(ke){return(0,x.Z)(function*(){const ot=yield function ye(){return Me.apply(this,arguments)}();return new Ne(ot,ke)})()}terminate(){this.worker.terminate()}open(ke,ot={}){var at=this;return(0,x.Z)(function*(){const{signal:yt}=ot,wt=(0,Z.jt)();return new Promise((zt,Rt)=>{const Ft={resolve:zt,reject:Rt,abortHandle:(0,Q.$F)(yt,()=>{at._outJobs.delete(wt),at._post({type:Ge,jobId:wt})})};at._outJobs.set(wt,Ft),at._post({type:xe,jobId:wt,modulePath:ke})})})()}_onMessage(ke){const ot=(0,Z.QM)(ke);if(ot)switch(ot.type){case je:this._onOpenedMessage(ot);break;case We:this._onResponseMessage(ot);break;case Ge:this._onAbortMessage(ot);break;case Je:this._onInvokeMessage(ot)}}_onAbortMessage(ke){const ot=this._inJobs,at=ke.jobId,yt=ot.get(at);yt&&(yt.controller&&yt.controller.abort(),ot.delete(at))}_onInvokeMessage(ke){const{methodName:ot,jobId:at,data:yt,abortable:wt}=ke,zt=wt?new AbortController:null,Rt=this._inJobs,Ft=J.Nv[ot];let bt;try{if("function"!=typeof Ft)throw new TypeError(`${ot} is not a function`);bt=Ft.call(null,yt,{signal:zt?zt.signal:null})}catch(St){return void this._post({type:We,jobId:at,error:(0,Z.AB)(St)})}(0,Q.y8)(bt)?(Rt.set(at,{controller:zt,promise:bt}),bt.then(St=>{Rt.has(at)&&(Rt.delete(at),this._post({type:We,jobId:at},St))},St=>{Rt.has(at)&&(Rt.delete(at),St||(St={message:"Error encountered at method"+ot}),(0,Q.D_)(St)||this._post({type:We,jobId:at,error:(0,Z.AB)(St||{message:`Error encountered at method ${ot}`})}))})):this._post({type:We,jobId:at},bt)}_onOpenedMessage(ke){const{jobId:ot,data:at}=ke,yt=this._outJobs.get(ot);yt&&(this._outJobs.delete(ot),(0,B.hw)(yt.abortHandle),yt.resolve(at))}_onResponseMessage(ke){const{jobId:ot,error:at,data:yt}=ke,wt=this._outJobs.get(ot);wt&&(this._outJobs.delete(ot),(0,B.hw)(wt.abortHandle),at?wt.reject(A.Z.fromJSON(JSON.parse(at))):wt.resolve(yt))}_post(ke,ot,at){return(0,Z.oi)(this.worker,ke,ot,at)}}let we=(0,G.Z)("esri-workers-debug")?1:(0,G.Z)("host-browser")?navigator.hardwareConcurrency-1:0;we||(we=(0,G.Z)("safari")&&(0,G.Z)("mac")||(0,G.Z)("trident")?7:2);let Oe=0;const $e=[];function Be(){Ye()}function De(et,ke){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,x.Z)(function*(et,ke){const ot=new H.Z;return yield ot.open(et,ke),ot})).apply(this,arguments)}function ve(et){return Ke.apply(this,arguments)}function Ke(){return(Ke=(0,x.Z)(function*(et,ke={}){if("string"!=typeof et)throw new A.Z("workers:undefined-module","modulePath is missing");let ot=ke.strategy||"distributed";if((0,G.Z)("host-webworker")&&!(0,G.Z)("esri-workers")&&(ot="local"),"local"===ot){let at=yield re.Z.loadWorker(et);at||(at=yield import(et)),(0,Q.k_)(ke.signal);const yt=ke.client||at;return De([re.Z.connect(at)],yi(or({},ke),{client:yt}))}if(yield Ye(),(0,Q.k_)(ke.signal),"dedicated"===ot){const at=Oe++%we;return De([yield $e[at].open(et,ke)],ke)}if(ke.maxNumWorkers&&ke.maxNumWorkers>0){const at=Math.min(ke.maxNumWorkers,we);if(at<we){const yt=new Array(at);for(let wt=0;wt<at;++wt){const zt=Oe++%we;yt[wt]=$e[zt].open(et,ke)}return De(yt,ke)}}return De($e.map(at=>at.open(et,ke)),ke)})).apply(this,arguments)}let be,tt=null;function Ye(){return ze.apply(this,arguments)}function ze(){return(ze=(0,x.Z)(function*(){if(tt)return tt;be=new AbortController;const et=[];for(let ke=0;ke<we;ke++){const ot=Ne.create(ke).then(at=>($e[ke]=at,at));et.push(ot)}return tt=Promise.all(et),tt})).apply(this,arguments)}},29132:(dt,Re,T)=>{"use strict";T.d(Re,{qM:()=>ue});var x=T(90912),A=T(2004),G=T(21674),Q=T(72854),H=T(49672),re=T(37118),J=T(55214);T(65234),T(71774),T(91179);const ue={base:G.Z,key:"type",typeMap:{extent:A.Z,multipoint:Q.Z,point:H.Z,polyline:J.Z,polygon:re.Z}};(0,x.N7)(ue)},72149:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Y});var oe,x=T(17626),A=T(16730),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(49672),B=T(37118),Z=T(12080),ie=T(10049),ue=T(46367),ce=T(84029);let le=oe=class extends B.Z{constructor(...j){super(...j),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(j,X){let U;if(j&&j.center)U=j;else{if(j&&j.rings)return super.normalizeCtorArgs(j,X);U={center:j}}return or(or(or({},super.normalizeCtorArgs()),U),X)}initialize(){const j=this.center,X=this.numberOfPoints;if(this.hasZ=j&&j.hasZ,0!==this.rings.length||!j)return;const U=(0,A.En)(this.radius,this.radiusUnit,"meters"),ee=j.spatialReference;let $,ne="geographic";if(ee.isWebMercator?ne="webMercator":(null!=ce.Z[ee.wkid]||ee.wkt&&0===ee.wkt.indexOf("PROJCS"))&&(ne="projected"),this.geodesic){let se;switch(ne){case"webMercator":se=(0,ue.Sx)(j);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":se=j}$=this._createGeodesicCircle(se,U,X),"webMercator"===ne&&($=(0,ue.$)($))}else{let se;"webMercator"===ne||"projected"===ne?se=U/this._convert2Meters(1,j.spatialReference):"geographic"===ne&&(se=(0,A.ty)(U,"meters",(0,Z.Iu)(j.spatialReference).radius)),$=this._createPlanarCircle(j,se,X)}this.spatialReference=$.spatialReference,this.addRing($.rings[0])}clone(){const{center:j,numberOfPoints:X,radius:U,radiusUnit:ee,geodesic:$}=this;return new oe({center:j.clone(),numberOfPoints:X,radius:U,radiusUnit:ee,geodesic:$})}_createGeodesicCircle(j,X,U){let ee=0;const $=[];for(;ee<360;){const ne=[0,0];(0,ie.TB)(ne,[j.x,j.y],ee,X),this.hasZ&&ne.push(j.z),$.push(ne),ee+=360/U}return $.push($[0]),new B.Z($)}_createPlanarCircle(j,X,U){const ee=[],$=2*Math.PI/U;for(let ne=0;ne<U;++ne){const se=$*ne,ae=[j.x+Math.cos(-se)*X,j.y+Math.sin(-se)*X];this.hasZ&&ae.push(j.z),ee.push(ae)}return ee.push(ee[0]),new B.Z({spatialReference:j.spatialReference,rings:[ee]})}_convert2Meters(j,X){let U;if(null!=ce.Z[X.wkid])U=ce.Z.values[ce.Z[X.wkid]];else{const ee=X.wkt,$=ee.lastIndexOf(",")+1,ne=ee.lastIndexOf("]]");U=parseFloat(ee.substring($,ne))}return j*U}};(0,x._)([(0,G.Cb)({type:W.Z})],le.prototype,"center",void 0),(0,x._)([(0,G.Cb)()],le.prototype,"geodesic",void 0),(0,x._)([(0,G.Cb)()],le.prototype,"numberOfPoints",void 0),(0,x._)([(0,G.Cb)()],le.prototype,"radius",void 0),(0,x._)([(0,G.Cb)()],le.prototype,"radiusUnit",void 0),le=oe=(0,x._)([(0,J.j)("esri.geometry.Circle")],le);const Y=le},2004:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ee});var Y,x=T(17626),A=T(62208),G=T(77275),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898)),B=T(21674),Z=T(49672),ie=T(65234),ue=T(33190),ce=T(11519),oe=T(37053),le=T(46367);function X($,ne,se){return null==ne?se:null==se?ne:$(ne,se)}let U=Y=class extends B.Z{constructor(...$){super(...$),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs($,ne,se,ae,de){return function j($){return $&&("esri.geometry.SpatialReference"===$.declaredClass||null!=$.wkid)}($)?{spatialReference:$,xmin:0,ymin:0,xmax:0,ymax:0}:"object"==typeof $?($.spatialReference=null==$.spatialReference?ie.Z.WGS84:$.spatialReference,$):{xmin:$,ymin:ne,xmax:se,ymax:ae,spatialReference:null==de?ie.Z.WGS84:de}}static fromBounds($,ne){return new Y({xmin:$[0],ymin:$[1],xmax:$[2],ymax:$[3],spatialReference:ne})}static fromPoint($){return new Y({xmin:$.x,ymin:$.y,zmin:$.z,xmax:$.x,ymax:$.y,zmax:$.z,spatialReference:$.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const $=new Z.Z({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&($.z=.5*(this.zmin+this.zmax)),this.hasM&&($.m=.5*(this.mmin+this.mmax)),$}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt($){const ne=this.center;return null!=$.z&&this.hasZ?this.offset($.x-ne.x,$.y-ne.y,$.z-ne.z):this.offset($.x-ne.x,$.y-ne.y)}clone(){const $=new Y;return $.xmin=this.xmin,$.ymin=this.ymin,$.xmax=this.xmax,$.ymax=this.ymax,$.spatialReference=this.spatialReference,null!=this.zmin&&($.zmin=this.zmin,$.zmax=this.zmax),null!=this.mmin&&($.mmin=this.mmin,$.mmax=this.mmax),$}contains($){if(!$)return!1;const ne=this.spatialReference,se=$.spatialReference;return ne&&se&&!ne.equals(se)&&(0,le.Q8)(ne,se)&&($=ne.isWebMercator?(0,le.$)($):(0,le.Sx)($,!0)),"point"===$.type?(0,ue.aV)(this,$):"extent"===$.type&&(0,ue.uP)(this,$)}equals($){if(this===$)return!0;if((0,A.Wi)($))return!1;const ne=this.spatialReference,se=$.spatialReference;return ne&&se&&!ne.equals(se)&&(0,le.Q8)(ne,se)&&($=ne.isWebMercator?(0,le.$)($):(0,le.Sx)($,!0)),this.xmin===$.xmin&&this.ymin===$.ymin&&this.zmin===$.zmin&&this.mmin===$.mmin&&this.xmax===$.xmax&&this.ymax===$.ymax&&this.zmax===$.zmax&&this.mmax===$.mmax}expand($){const ne=.5*(1-$),se=this.width*ne,ae=this.height*ne;if(this.xmin+=se,this.ymin+=ae,this.xmax-=se,this.ymax-=ae,this.hasZ){const de=(this.zmax-this.zmin)*ne;this.zmin+=de,this.zmax-=de}if(this.hasM){const de=(this.mmax-this.mmin)*ne;this.mmin+=de,this.mmax-=de}return this}intersects($){if((0,A.Wi)($))return!1;"mesh"===$.type&&($=$.extent);const ne=this.spatialReference,se=$.spatialReference;return ne&&se&&!ne.equals(se)&&(0,le.Q8)(ne,se)&&($=ne.isWebMercator?(0,le.$)($):(0,le.Sx)($,!0)),(0,ce.IY)($.type)(this,$)}normalize(){const $=this._normalize(!1,!0);return Array.isArray($)?$:[$]}offset($,ne,se){return this.xmin+=$,this.ymin+=ne,this.xmax+=$,this.ymax+=ne,null!=se&&(this.zmin+=se,this.zmax+=se),this}shiftCentralMeridian(){return this._normalize(!0)}union($){return this===$||(this.xmin=Math.min(this.xmin,$.xmin),this.ymin=Math.min(this.ymin,$.ymin),this.xmax=Math.max(this.xmax,$.xmax),this.ymax=Math.max(this.ymax,$.ymax),(this.hasZ||$.hasZ)&&(this.zmin=X(Math.min,this.zmin,$.zmin),this.zmax=X(Math.max,this.zmax,$.zmax)),(this.hasM||$.hasM)&&(this.mmin=X(Math.min,this.mmin,$.mmin),this.mmax=X(Math.max,this.mmax,$.mmax))),this}intersection($){return this===$?this:(0,A.Wi)($)||!this.intersects($)?null:(this.xmin=Math.max(this.xmin,$.xmin),this.ymin=Math.max(this.ymin,$.ymin),this.xmax=Math.min(this.xmax,$.xmax),this.ymax=Math.min(this.ymax,$.ymax),(this.hasZ||$.hasZ)&&(this.zmin=X(Math.max,this.zmin,$.zmin),this.zmax=X(Math.min,this.zmax,$.zmax)),(this.hasM||$.hasM)&&(this.mmin=X(Math.max,this.mmin,$.mmin),this.mmax=X(Math.min,this.mmax,$.mmax)),this)}toJSON($){return this.write({},$)}_shiftCM($=(0,oe.C5)(this.spatialReference)){if(!$||!this.spatialReference)return this;const ne=this.spatialReference,se=this._getCM($);if(se){const ae=ne.isWebMercator?(0,le.Sx)(se):se;this.xmin-=se.x,this.xmax-=se.x,ne.isWebMercator||(ae.x=this._normalizeX(ae.x,$).x),this.spatialReference=new ie.Z((0,G.gx)(ne.isWGS84?$.altTemplate:$.wkTemplate,{Central_Meridian:ae.x}))}return this}_getCM($){let ne=null;const[se,ae]=$.valid,de=this.xmin,_e=this.xmax;return de>=se&&de<=ae&&_e>=se&&_e<=ae||(ne=this.center),ne}_normalize($,ne,se){const ae=this.spatialReference;if(!ae)return this;if(!(se=se||(0,oe.C5)(ae)))return this;const de=this._getParts(se).map(he=>he.extent);if(de.length<2)return de[0]||this;if(de.length>2)return $?this._shiftCM(se):this.set({xmin:se.valid[0],xmax:se.valid[1]});if($)return this._shiftCM(se);if(ne)return de;let _e=!0,pe=!0;return de.forEach(he=>{he.hasZ||(_e=!1),he.hasM||(pe=!1)}),{rings:de.map(he=>{const ge=[[he.xmin,he.ymin],[he.xmin,he.ymax],[he.xmax,he.ymax],[he.xmax,he.ymin],[he.xmin,he.ymin]];if(_e){const ye=(he.zmax-he.zmin)/2;for(let Me=0;Me<ge.length;Me++)ge[Me].push(ye)}if(pe){const ye=(he.mmax-he.mmin)/2;for(let Me=0;Me<ge.length;Me++)ge[Me].push(ye)}return ge}),hasZ:_e,hasM:pe,spatialReference:ae}}_getParts($){let ne=this.cache._parts;if(!ne){ne=[];const{ymin:de,ymax:_e,spatialReference:pe}=this,he=this.width,ge=this.xmin,ye=this.xmax;let Me;$=$||(0,oe.C5)(pe);const[Ee,Te]=$.valid;Me=this._normalizeX(this.xmin,$);const me=Me.x,Ce=Me.frameId;Me=this._normalizeX(this.xmax,$);const Ie=Me.x,Ge=Me.frameId,Je=me===Ie&&he>0;if(he>2*Te){const xe=new Y(ge<ye?me:Ie,de,Te,_e,pe),je=new Y(Ee,de,ge<ye?Ie:me,_e,pe),We=new Y(0,de,Te,_e,pe),Ne=new Y(Ee,de,0,_e,pe),we=[],Oe=[];xe.contains(We)&&we.push(Ce),xe.contains(Ne)&&Oe.push(Ce),je.contains(We)&&we.push(Ge),je.contains(Ne)&&Oe.push(Ge);for(let $e=Ce+1;$e<Ge;$e++)we.push($e),Oe.push($e);ne.push({extent:xe,frameIds:[Ce]},{extent:je,frameIds:[Ge]},{extent:We,frameIds:we},{extent:Ne,frameIds:Oe})}else me>Ie||Je?ne.push({extent:new Y(me,de,Te,_e,pe),frameIds:[Ce]},{extent:new Y(Ee,de,Ie,_e,pe),frameIds:[Ge]}):ne.push({extent:new Y(me,de,Ie,_e,pe),frameIds:[Ce]});this.cache._parts=ne}const se=this.hasZ,ae=this.hasM;if(se||ae){const de={};se&&(de.zmin=this.zmin,de.zmax=this.zmax),ae&&(de.mmin=this.mmin,de.mmax=this.mmax);for(let _e=0;_e<ne.length;_e++)ne[_e].extent.set(de)}return ne}_normalizeX($,ne){const[se,ae]=ne.valid,de=2*ae;let _e,pe=0;return $>ae?(_e=Math.ceil(Math.abs($-ae)/de),$-=_e*de,pe=_e):$<se&&(_e=Math.ceil(Math.abs($-se)/de),$+=_e*de,pe=-_e),{x:$,frameId:pe}}};(0,x._)([(0,Q.Cb)({readOnly:!0})],U.prototype,"cache",null),(0,x._)([(0,Q.Cb)({readOnly:!0})],U.prototype,"center",null),(0,x._)([(0,Q.Cb)({readOnly:!0})],U.prototype,"extent",null),(0,x._)([(0,Q.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],U.prototype,"hasM",null),(0,x._)([(0,Q.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],U.prototype,"hasZ",null),(0,x._)([(0,Q.Cb)({readOnly:!0})],U.prototype,"height",null),(0,x._)([(0,Q.Cb)({readOnly:!0})],U.prototype,"width",null),(0,x._)([(0,Q.Cb)({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],U.prototype,"xmin",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:!0}})],U.prototype,"ymin",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],U.prototype,"mmin",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],U.prototype,"zmin",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:!0}})],U.prototype,"xmax",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:!0}})],U.prototype,"ymax",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],U.prototype,"mmax",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],U.prototype,"zmax",void 0),U=Y=(0,x._)([(0,W.j)("esri.geometry.Extent")],U),U.prototype.toJSON.isDefaultToJSON=!0;const ee=U},21674:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(68653)),W=T(76898),B=T(65234);let Z=class extends A.wq{constructor(...ue){super(...ue),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=B.Z.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(ue,ce){if(ue instanceof B.Z)return ue;if(null!=ue){const oe=new B.Z;return oe.read(ue,ce),oe}return ue}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(ue){return this.cache[ue]}setCacheValue(ue,ce){this.cache[ue]=ce}};(0,x._)([(0,G.Cb)()],Z.prototype,"type",void 0),(0,x._)([(0,G.Cb)({readOnly:!0})],Z.prototype,"cache",null),(0,x._)([(0,G.Cb)({readOnly:!0})],Z.prototype,"extent",null),(0,x._)([(0,G.Cb)({type:Boolean,json:{write:{overridePolicy:ue=>({enabled:ue})}}})],Z.prototype,"hasM",void 0),(0,x._)([(0,G.Cb)({type:Boolean,json:{write:{overridePolicy:ue=>({enabled:ue})}}})],Z.prototype,"hasZ",void 0),(0,x._)([(0,G.Cb)({type:B.Z,json:{write:!0}})],Z.prototype,"spatialReference",void 0),(0,x._)([(0,J.r)("spatialReference")],Z.prototype,"readSpatialReference",null),Z=(0,x._)([(0,W.j)("esri.geometry.Geometry")],Z);const ie=Z},79334:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ee});var ce,x=T(17626),A=T(85931),G=T(2076),Q=T(86810),H=T(16730),re=T(14889),J=T(77712),Z=(T(8314),T(90912),T(68653)),ie=T(76898),ue=T(99433);const oe=(0,G.w)()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),le=oe.jsonValues.slice();(0,A.e$)(le,"orthometric");const Y=(0,G.w)()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let j=ce=class extends Q.wq{constructor($){super($),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel($,ne,se){return oe.write($,ne,se)}readHeightModel($,ne,se){return oe.read($)||(se&&se.messages&&se.messages.push(function U($,ne){return new re.Z("height-model:unsupported",`Height model of value '${$}' is not supported`,ne)}($,{context:se})),null)}readHeightUnit($,ne,se){return Y.read($)||(se&&se.messages&&se.messages.push(X($,{context:se})),null)}readHeightUnitService($,ne,se){return(0,H.$C)($)||Y.read($)||(se&&se.messages&&se.messages.push(X($,{context:se})),null)}readVertCRS($,ne){return ne.vertCRS||ne.ellipsoid||ne.geoid}clone(){return new ce({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals($){return!!$&&(this===$||this.heightModel===$.heightModel&&this.heightUnit===$.heightUnit&&this.vertCRS===$.vertCRS)}static deriveUnitFromSR($,ne){const se=(0,H.cM)(ne);return new ce({heightModel:$.heightModel,heightUnit:se,vertCRS:$.vertCRS})}write($,ne){return ne=or({origin:"web-scene"},ne),super.write($,ne)}static fromJSON($){if(!$)return null;const ne=new ce;return ne.read($,{origin:"web-scene"}),ne}};function X($,ne){return new re.Z("height-unit:unsupported",`Height unit of value '${$}' is not supported`,ne)}(0,x._)([(0,J.Cb)({type:oe.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:le,default:"ellipsoidal"}}}})],j.prototype,"heightModel",void 0),(0,x._)([(0,ue.c)("web-scene","heightModel")],j.prototype,"writeHeightModel",null),(0,x._)([(0,Z.r)(["web-scene","service"],"heightModel")],j.prototype,"readHeightModel",null),(0,x._)([(0,J.Cb)({type:Y.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:Y.jsonValues,write:Y.write}}}})],j.prototype,"heightUnit",void 0),(0,x._)([(0,Z.r)("web-scene","heightUnit")],j.prototype,"readHeightUnit",null),(0,x._)([(0,Z.r)("service","heightUnit")],j.prototype,"readHeightUnitService",null),(0,x._)([(0,J.Cb)({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],j.prototype,"vertCRS",void 0),(0,x._)([(0,Z.r)("service","vertCRS",["vertCRS","ellipsoid","geoid"])],j.prototype,"readVertCRS",null),j=ce=(0,x._)([(0,ie.j)("esri.geometry.HeightModelInfo")],j);const ee=j},72854:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ie,x=T(17626),A=T(58817),G=T(77712),H=(T(90912),T(76898)),re=T(99433),J=T(2004),W=T(21674),B=T(49672),Z=T(18945);function ue(Y){return(j,X)=>null==j?X:null==X?j:Y(j,X)}let oe=ie=class extends W.Z{constructor(...Y){super(...Y),this.points=[],this.type="multipoint"}normalizeCtorArgs(Y,j){if(!Y&&!j)return null;const X={};Array.isArray(Y)?(X.points=Y,X.spatialReference=j):function ce(Y){return Y&&("esri.geometry.SpatialReference"===Y.declaredClass||null!=Y.wkid)}(Y)?X.spatialReference=Y:(Y.points&&(X.points=Y.points),Y.spatialReference&&(X.spatialReference=Y.spatialReference),Y.hasZ&&(X.hasZ=Y.hasZ),Y.hasM&&(X.hasM=Y.hasM));const U=X.points&&X.points[0];return U&&(void 0===X.hasZ&&void 0===X.hasM?(X.hasZ=U.length>2,X.hasM=!1):void 0===X.hasZ?X.hasZ=U.length>3:void 0===X.hasM&&(X.hasM=U.length>3)),X}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const Y=this.points;if(!Y.length)return null;const j=new J.Z,X=this.hasZ,U=this.hasM,ee=X?3:2,$=Y[0],ne=ue(Math.min),se=ue(Math.max);let ae,de,_e,pe,[he,ge]=$,[ye,Me]=$;for(let Ee=0,Te=Y.length;Ee<Te;Ee++){const me=Y[Ee],[Ce,Ie]=me;if(he=ne(he,Ce),ge=ne(ge,Ie),ye=se(ye,Ce),Me=se(Me,Ie),X&&me.length>2){const Ge=me[2];ae=ne(ae,Ge),_e=se(_e,Ge)}if(U&&me.length>ee){const Ge=me[ee];de=ne(de,Ge),pe=se(pe,Ge)}}return j.xmin=he,j.ymin=ge,j.xmax=ye,j.ymax=Me,j.spatialReference=this.spatialReference,X?(j.zmin=ae,j.zmax=_e):(j.zmin=null,j.zmax=null),U?(j.mmin=de,j.mmax=pe):(j.mmin=null,j.mmax=null),j}writePoints(Y,j){j.points=(0,A.d9)(this.points)}addPoint(Y){return(0,Z.l)(this,Y),Array.isArray(Y)?this.points.push(Y):this.points.push(Y.toArray()),this.notifyChange("points"),this}clone(){const Y={points:(0,A.d9)(this.points),spatialReference:this.spatialReference};return this.hasZ&&(Y.hasZ=!0),this.hasM&&(Y.hasM=!0),new ie(Y)}getPoint(Y){if(!this._validateInputs(Y))return null;const j=this.points[Y],X={x:j[0],y:j[1],spatialReference:this.spatialReference};let U=2;return this.hasZ&&(X.z=j[2],U=3),this.hasM&&(X.m=j[U]),new B.Z(X)}removePoint(Y){if(!this._validateInputs(Y))return null;const j=new B.Z(this.points.splice(Y,1)[0],this.spatialReference);return this.notifyChange("points"),j}setPoint(Y,j){return this._validateInputs(Y)?((0,Z.l)(this,j),Array.isArray(j)||(j=j.toArray()),this.points[Y]=j,this.notifyChange("points"),this):this}toJSON(Y){return this.write({},Y)}_validateInputs(Y){return null!=Y&&Y>=0&&Y<this.points.length}};(0,x._)([(0,G.Cb)({readOnly:!0})],oe.prototype,"cache",null),(0,x._)([(0,G.Cb)()],oe.prototype,"extent",null),(0,x._)([(0,G.Cb)({type:[[Number]],json:{write:{isRequired:!0}}})],oe.prototype,"points",void 0),(0,x._)([(0,re.c)("points")],oe.prototype,"writePoints",null),oe=ie=(0,x._)([(0,H.j)("esri.geometry.Multipoint")],oe),oe.prototype.toJSON.isDefaultToJSON=!0;const le=oe},49672:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>de});var ee,x=T(17626),A=T(63290),G=T(62208),Q=T(77712),J=(T(85931),T(8314),T(66656)),W=T(68653),B=T(76898),Z=T(99433),ie=T(90912),ue=T(21674),ce=T(65234),X=T(37053),U=T(46367);const $=[0,0];function ne(_e){return _e&&("esri.geometry.SpatialReference"===_e.declaredClass||null!=_e.wkid)}const se=A.Z.getLogger("esri.geometry.Point");let ae=ee=class extends ue.Z{constructor(..._e){super(..._e),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}static copy(_e,pe){pe._set("x",_e._get("x")),pe._set("y",_e._get("y")),pe._set("z",_e._get("z")),pe._set("m",_e._get("m"));const he=_e._get("spatialReference");pe._set("spatialReference",Object.isFrozen(he)?he:he.clone())}normalizeCtorArgs(_e,pe,he,ge,ye){let Me;if(Array.isArray(_e))Me=_e,ye=pe,_e=Me[0],pe=Me[1],he=Me[2],ge=Me[3];else if(_e&&"object"==typeof _e){if(Me=_e,_e=null!=Me.x?Me.x:Me.longitude,pe=null!=Me.y?Me.y:Me.latitude,he=Me.z,ge=Me.m,(ye=Me.spatialReference)&&"esri.geometry.SpatialReference"!==ye.declaredClass&&(ye=new ce.Z(ye)),null!=Me.longitude||null!=Me.latitude)if(null==Me.longitude)se.warn(".longitude=","Latitude was defined without longitude");else if(null==Me.latitude)se.warn(".latitude=","Longitude was defined without latitude");else if(!Me.declaredClass&&ye&&ye.isWebMercator){const Te=(0,U.hG)(Me.longitude,Me.latitude,$);_e=Te[0],pe=Te[1]}}else ne(he)?(ye=he,he=null):ne(ge)&&(ye=ge,ge=null);const Ee={x:_e,y:pe};return null==Ee.x&&null!=Ee.y?se.warn(".y=","Y coordinate was defined without an X coordinate"):null==Ee.y&&null!=Ee.x&&se.warn(".x=","X coordinate was defined without a Y coordinate"),null!=ye&&(Ee.spatialReference=ye),null!=he&&(Ee.z=he),null!=ge&&(Ee.m=ge),Ee}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return void 0!==this.m}set hasM(_e){_e!==(void 0!==this._get("m"))&&(this._set("m",_e?0:void 0),this._set("hasM",_e))}get hasZ(){return void 0!==this.z}set hasZ(_e){_e!==(void 0!==this._get("z"))&&(this._set("z",_e?0:void 0),this._set("hasZ",_e))}get latitude(){const{spatialReference:_e,x:pe,y:he}=this;if(_e){if(_e.isWebMercator)return(0,U.R6)(pe,he,$)[1];if(_e.isGeographic)return he}return null}set latitude(_e){const{spatialReference:pe,x:he}=this;pe&&(pe.isWebMercator?this._set("y",(0,U.hG)(he,_e,$)[1]):pe.isGeographic&&this._set("y",_e),this._set("latitude",_e))}get longitude(){const{x:_e,y:pe,spatialReference:he}=this;if(he){if(he.isWebMercator)return(0,U.R6)(_e,pe,$)[0];if(he.isGeographic)return _e}return null}set longitude(_e){const{y:pe,spatialReference:he}=this;he&&(he.isWebMercator?this._set("x",(0,U.hG)(_e,pe,$)[0]):he.isGeographic&&this._set("x",_e),this._set("longitude",_e))}writeX(_e,pe,he){pe[he]=isNaN(_e)?"NaN":_e}readX(_e){return"string"==typeof _e?NaN:_e}clone(){const _e=new ee;return _e.x=this.x,_e.y=this.y,_e.z=this.z,_e.m=this.m,_e.spatialReference=this.spatialReference,_e}copy(_e){return ee.copy(_e,this),this}equals(_e){if((0,G.Wi)(_e))return!1;const{x:pe,y:he,z:ge,m:ye,spatialReference:Me}=this,{z:Ee,m:Te}=_e;let{x:me,y:Ce,spatialReference:Ie}=_e;if(!Me.equals(Ie))if(Me.isWebMercator&&Ie.isWGS84)[me,Ce]=(0,U.hG)(me,Ce),Ie=Me;else{if(!Me.isWGS84||!Ie.isWebMercator)return!1;[me,Ce]=(0,U.R6)(me,Ce),Ie=Me}return pe===me&&he===Ce&&ge===Ee&&ye===Te&&Me.wkid===Ie.wkid}offset(_e,pe,he){return function oe(_e,pe,he,ge){var ye;return _e.x=_e.x+pe,_e.y=_e.y+he,null!=ge&&(_e.z=(null!=(ye=_e.z)?ye:0)+ge),_e}(this,_e,pe,he)}normalize(){if(!this.spatialReference)return this;const _e=(0,X.C5)(this.spatialReference);if(!_e)return this;let pe=this.x;const[he,ge]=_e.valid,ye=2*ge;let Me;return pe>ge?(Me=Math.ceil(Math.abs(pe-ge)/ye),pe-=Me*ye):pe<he&&(Me=Math.ceil(Math.abs(pe-he)/ye),pe+=Me*ye),this._set("x",pe),this}distance(_e){return function Y(_e,pe){const he=_e.x-pe.x,ge=_e.y-pe.y,ye=_e.hasZ&&pe.hasZ?_e.z-pe.z:0;return Math.sqrt(he*he+ge*ge+ye*ye)}(this,_e)}toArray(){const _e=this.hasZ,pe=this.hasM;return _e&&pe?[this.x,this.y,this.z,this.m]:_e?[this.x,this.y,this.z]:pe?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(_e){return this.write({},_e)}};(0,x._)([(0,Q.Cb)({readOnly:!0})],ae.prototype,"cache",null),(0,x._)([(0,Q.Cb)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ae.prototype,"hasM",null),(0,x._)([(0,Q.Cb)({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],ae.prototype,"hasZ",null),(0,x._)([(0,Q.Cb)({type:Number})],ae.prototype,"latitude",null),(0,x._)([(0,Q.Cb)({type:Number})],ae.prototype,"longitude",null),(0,x._)([(0,Q.Cb)({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),(0,J.p)(_e=>isNaN(_e)?_e:(0,ie.q9)(_e))],ae.prototype,"x",void 0),(0,x._)([(0,Z.c)("x")],ae.prototype,"writeX",null),(0,x._)([(0,W.r)("x")],ae.prototype,"readX",null),(0,x._)([(0,Q.Cb)({type:Number,json:{write:!0}})],ae.prototype,"y",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ae.prototype,"z",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],ae.prototype,"m",void 0),ae=ee=(0,x._)([(0,B.j)("esri.geometry.Point")],ae),ae.prototype.toJSON.isDefaultToJSON=!0;const de=ae},37118:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>se});var ee,x=T(17626),A=T(85931),G=T(58817),Q=T(62208),H=T(77712),J=(T(90912),T(76898)),W=T(99433),B=T(2004),Z=T(21674),ie=T(49672),ue=T(65234),ce=T(27105),oe=T(33190),le=T(25748),Y=T(15176),j=T(11519),X=T(46367),U=T(18945);function $(ae){return!Array.isArray(ae[0])}let ne=ee=class extends Z.Z{constructor(...ae){super(...ae),this.rings=[],this.type="polygon"}static fromExtent(ae){const de=ae.clone().normalize(),_e=ae.spatialReference;let pe=!1,he=!1;for(const ye of de)ye.hasZ&&(pe=!0),ye.hasM&&(he=!0);const ge={rings:de.map(ye=>{const Me=[[ye.xmin,ye.ymin],[ye.xmin,ye.ymax],[ye.xmax,ye.ymax],[ye.xmax,ye.ymin],[ye.xmin,ye.ymin]];if(pe&&ye.hasZ){const Ee=ye.zmin+.5*(ye.zmax-ye.zmin);for(let Te=0;Te<Me.length;Te++)Me[Te].push(Ee)}if(he&&ye.hasM){const Ee=ye.mmin+.5*(ye.mmax-ye.mmin);for(let Te=0;Te<Me.length;Te++)Me[Te].push(Ee)}return Me}),spatialReference:_e};return pe&&(ge.hasZ=!0),he&&(ge.hasM=!0),new ee(ge)}normalizeCtorArgs(ae,de){let _e,pe,he=null,ge=null;return ae&&!Array.isArray(ae)?(he=ae.rings?ae.rings:null,de||(ae.spatialReference?de=ae.spatialReference:ae.rings||(de=ae)),_e=ae.hasZ,pe=ae.hasM):he=ae,he=he||[],he.length&&he[0]&&null!=he[0][0]&&"number"==typeof he[0][0]&&(he=[he]),ge=he[0]&&he[0][0],ge&&(void 0===_e&&void 0===pe?(_e=ge.length>2,pe=ge.length>3):void 0===_e?_e=pe?ge.length>3:ge.length>2:void 0===pe&&(pe=_e?ge.length>3:ge.length>2)),{rings:he,spatialReference:de=de||ue.Z.WGS84,hasZ:_e,hasM:pe}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const ae=(0,ce.tO)(this);if(!ae||isNaN(ae[0])||isNaN(ae[1])||this.hasZ&&isNaN(ae[2]))return null;const de=new ie.Z;return de.x=ae[0],de.y=ae[1],de.spatialReference=this.spatialReference,this.hasZ&&(de.z=ae[2]),de}get extent(){const{spatialReference:ae}=this,de=(0,Y._w)(this);if(!de)return null;const _e=new B.Z(de);return _e.spatialReference=ae,_e}get isSelfIntersecting(){return(0,j.Ff)(this.rings)}writeRings(ae,de){de.rings=(0,G.d9)(this.rings)}addRing(ae){if(!ae)return;const de=this.rings,_e=de.length;if($(ae)){const pe=[];for(let he=0,ge=ae.length;he<ge;he++)pe[he]=ae[he].toArray();de[_e]=pe}else de[_e]=ae.concat();return this.notifyChange("rings"),this}clone(){const ae=new ee;return ae.spatialReference=this.spatialReference,ae.rings=(0,G.d9)(this.rings),ae.hasZ=this.hasZ,ae.hasM=this.hasM,ae}equals(ae){if(this===ae)return!0;if((0,Q.Wi)(ae))return!1;const de=this.spatialReference,_e=ae.spatialReference;if((0,Q.pC)(de)!==(0,Q.pC)(_e)||(0,Q.pC)(de)&&(0,Q.pC)(_e)&&!de.equals(_e)||this.rings.length!==ae.rings.length)return!1;const pe=([he,ge,ye,Me],[Ee,Te,me,Ce])=>he===Ee&&ge===Te&&(null==ye&&null==me||ye===me)&&(null==Me&&null==Ce||Me===Ce);for(let he=0;he<this.rings.length;he++)if(!(0,A.fS)(this.rings[he],ae.rings[he],pe))return!1;return!0}contains(ae){if(!ae)return!1;const de=(0,X.iV)(ae,this.spatialReference);return(0,oe.CI)(this,(0,Q.pC)(de)?de:ae)}isClockwise(ae){let de;return de=$(ae)?ae.map(_e=>this.hasZ?this.hasM?[_e.x,_e.y,_e.z,_e.m]:[_e.x,_e.y,_e.z]:[_e.x,_e.y]):ae,(0,le.bu)(de,this.hasM,this.hasZ)}getPoint(ae,de){if(!this._validateInputs(ae,de))return null;const _e=this.rings[ae][de],pe=this.hasZ,he=this.hasM;return pe&&!he?new ie.Z(_e[0],_e[1],_e[2],void 0,this.spatialReference):he&&!pe?new ie.Z(_e[0],_e[1],void 0,_e[2],this.spatialReference):pe&&he?new ie.Z(_e[0],_e[1],_e[2],_e[3],this.spatialReference):new ie.Z(_e[0],_e[1],this.spatialReference)}insertPoint(ae,de,_e){return this._validateInputs(ae,de,!0)?((0,U.l)(this,_e),Array.isArray(_e)||(_e=_e.toArray()),this.rings[ae].splice(de,0,_e),this.notifyChange("rings"),this):this}removePoint(ae,de){if(!this._validateInputs(ae,de))return null;const _e=new ie.Z(this.rings[ae].splice(de,1)[0],this.spatialReference);return this.notifyChange("rings"),_e}removeRing(ae){if(!this._validateInputs(ae,null))return null;const de=this.rings.splice(ae,1)[0],_e=this.spatialReference,pe=de.map(he=>new ie.Z(he,_e));return this.notifyChange("rings"),pe}setPoint(ae,de,_e){return this._validateInputs(ae,de)?((0,U.l)(this,_e),Array.isArray(_e)||(_e=_e.toArray()),this.rings[ae][de]=_e,this.notifyChange("rings"),this):this}_validateInputs(ae,de,_e=!1){if(null==ae||ae<0||ae>=this.rings.length)return!1;if(null!=de){const pe=this.rings[ae];if(_e&&(de<0||de>pe.length)||!_e&&(de<0||de>=pe.length))return!1}return!0}toJSON(ae){return this.write({},ae)}};(0,x._)([(0,H.Cb)({readOnly:!0})],ne.prototype,"cache",null),(0,x._)([(0,H.Cb)({readOnly:!0})],ne.prototype,"centroid",null),(0,x._)([(0,H.Cb)({readOnly:!0})],ne.prototype,"extent",null),(0,x._)([(0,H.Cb)({readOnly:!0})],ne.prototype,"isSelfIntersecting",null),(0,x._)([(0,H.Cb)({type:[[[Number]]],json:{write:{isRequired:!0}}})],ne.prototype,"rings",void 0),(0,x._)([(0,W.c)("rings")],ne.prototype,"writeRings",null),ne=ee=(0,x._)([(0,J.j)("esri.geometry.Polygon")],ne),ne.prototype.toJSON.isDefaultToJSON=!0;const se=ne},55214:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Y});var ce,x=T(17626),A=T(58817),G=T(77712),H=(T(90912),T(76898)),re=T(99433),J=T(2004),W=T(21674),B=T(49672),Z=T(65234),ie=T(15176),ue=T(18945);let le=ce=class extends W.Z{constructor(...j){super(...j),this.paths=[],this.type="polyline"}normalizeCtorArgs(j,X){let U,ee,$=null,ne=null;return j&&!Array.isArray(j)?($=j.paths?j.paths:null,X||(j.spatialReference?X=j.spatialReference:j.paths||(X=j)),U=j.hasZ,ee=j.hasM):$=j,$=$||[],$.length&&$[0]&&null!=$[0][0]&&"number"==typeof $[0][0]&&($=[$]),ne=$[0]&&$[0][0],ne&&(void 0===U&&void 0===ee?(U=ne.length>2,ee=!1):void 0===U?U=!ee&&ne.length>3:void 0===ee&&(ee=!U&&ne.length>3)),{paths:$,spatialReference:X=X||Z.Z.WGS84,hasZ:U,hasM:ee}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:j}=this,X=(0,ie.Wn)(this);if(!X)return null;const U=new J.Z(X);return U.spatialReference=j,U}writePaths(j,X){X.paths=(0,A.d9)(this.paths)}addPath(j){if(!j)return;const X=this.paths,U=X.length;if(function oe(j){return!Array.isArray(j[0])}(j)){const ee=[];for(let $=0,ne=j.length;$<ne;$++)ee[$]=j[$].toArray();X[U]=ee}else X[U]=j.concat();return this.notifyChange("paths"),this}clone(){const j=new ce;return j.spatialReference=this.spatialReference,j.paths=(0,A.d9)(this.paths),j.hasZ=this.hasZ,j.hasM=this.hasM,j}getPoint(j,X){if(!this._validateInputs(j,X))return null;const U=this.paths[j][X],ee=this.hasZ,$=this.hasM;return ee&&!$?new B.Z(U[0],U[1],U[2],void 0,this.spatialReference):$&&!ee?new B.Z(U[0],U[1],void 0,U[2],this.spatialReference):ee&&$?new B.Z(U[0],U[1],U[2],U[3],this.spatialReference):new B.Z(U[0],U[1],this.spatialReference)}insertPoint(j,X,U){return this._validateInputs(j,X,!0)?((0,ue.l)(this,U),Array.isArray(U)||(U=U.toArray()),this.paths[j].splice(X,0,U),this.notifyChange("paths"),this):this}removePath(j){if(!this._validateInputs(j,null))return null;const X=this.paths.splice(j,1)[0],U=this.spatialReference,ee=X.map($=>new B.Z($,U));return this.notifyChange("paths"),ee}removePoint(j,X){if(!this._validateInputs(j,X))return null;const U=new B.Z(this.paths[j].splice(X,1)[0],this.spatialReference);return this.notifyChange("paths"),U}setPoint(j,X,U){return this._validateInputs(j,X)?((0,ue.l)(this,U),Array.isArray(U)||(U=U.toArray()),this.paths[j][X]=U,this.notifyChange("paths"),this):this}_validateInputs(j,X,U=!1){if(null==j||j<0||j>=this.paths.length)return!1;if(null!=X){const ee=this.paths[j];if(U&&(X<0||X>ee.length)||!U&&(X<0||X>=ee.length))return!1}return!0}toJSON(j){return this.write({},j)}};(0,x._)([(0,G.Cb)({readOnly:!0})],le.prototype,"cache",null),(0,x._)([(0,G.Cb)({readOnly:!0})],le.prototype,"extent",null),(0,x._)([(0,G.Cb)({type:[[[Number]]],json:{write:{isRequired:!0}}})],le.prototype,"paths",void 0),(0,x._)([(0,re.c)("paths")],le.prototype,"writePaths",null),le=ce=(0,x._)([(0,H.j)("esri.geometry.Polyline")],le),le.prototype.toJSON.isDefaultToJSON=!0;const Y=le},65234:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(86810),G=T(58817),Q=T(90912),H=T(77712),re=T(76898),J=T(99433),W=T(37053);let Z=B=class extends A.wq{constructor(ue){super(ue),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}static fromJSON(ue){if(!ue)return null;if(ue.wkid){if(102100===ue.wkid)return B.WebMercator;if(4326===ue.wkid)return B.WGS84}const ce=new B;return ce.read(ue),ce}normalizeCtorArgs(ue){return ue&&"object"==typeof ue?ue:{["string"==typeof ue?"wkt":"wkid"]:ue}}get isWGS84(){return(0,W.oR)(this)}get isWebMercator(){return(0,W.sS)(this)}get isGeographic(){return(0,W.sT)(this)}get isWrappable(){return(0,W.MP)(this)}writeWkt(ue,ce){this.wkid||(ce.wkt=ue)}clone(){if(this===B.WGS84)return B.WGS84;if(this===B.WebMercator)return B.WebMercator;const ue=new B;return null!=this.wkid?(ue.wkid=this.wkid,null!=this.latestWkid&&(ue.latestWkid=this.latestWkid),null!=this.vcsWkid&&(ue.vcsWkid=this.vcsWkid),null!=this.latestVcsWkid&&(ue.latestVcsWkid=this.latestVcsWkid)):null!=this.wkt&&(ue.wkt=this.wkt),this.imageCoordinateSystem&&(ue.imageCoordinateSystem=(0,G.d9)(this.imageCoordinateSystem)),ue}equals(ue){if(null==ue)return!1;if(this.imageCoordinateSystem||ue.imageCoordinateSystem){if(null==this.imageCoordinateSystem||null==ue.imageCoordinateSystem)return!1;const{id:ce,referenceServiceName:oe}=ue.imageCoordinateSystem,{geodataXform:le}=ue.imageCoordinateSystem,Y=this.imageCoordinateSystem;return null==ce||le?JSON.stringify(Y)===JSON.stringify(ue.imageCoordinateSystem):oe?Y.id===ce&&Y.referenceServiceName===oe:Y.id===ce}return(0,W.fS)(this,ue)}toJSON(ue){return this.write(void 0,ue)}};Z.GCS_NAD_1927=null,Z.WGS84=null,Z.WebMercator=null,Z.PlateCarree=null,(0,x._)([(0,H.Cb)({readOnly:!0})],Z.prototype,"isWGS84",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Z.prototype,"isWebMercator",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Z.prototype,"isGeographic",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Z.prototype,"isWrappable",null),(0,x._)([(0,H.Cb)({type:Q.z8,json:{write:!0}})],Z.prototype,"latestWkid",void 0),(0,x._)([(0,H.Cb)({type:Q.z8,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkt}}}}}}})],Z.prototype,"wkid",void 0),(0,x._)([(0,H.Cb)({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:null===this.wkid}}}}}}})],Z.prototype,"wkt",void 0),(0,x._)([(0,J.c)("wkt"),(0,J.c)("web-scene","wkt")],Z.prototype,"writeWkt",null),(0,x._)([(0,H.Cb)({type:Q.z8,json:{write:!0}})],Z.prototype,"vcsWkid",void 0),(0,x._)([(0,H.Cb)({type:Q.z8,json:{write:!0}})],Z.prototype,"latestVcsWkid",void 0),(0,x._)([(0,H.Cb)()],Z.prototype,"imageCoordinateSystem",void 0),Z=B=(0,x._)([(0,re.j)("esri.geometry.SpatialReference")],Z),Z.prototype.toJSON.isDefaultToJSON=!0,Z.GCS_NAD_1927=new Z({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Z.WGS84=new Z(W.Zn),Z.WebMercator=new Z(W.R_),Z.PlateCarree=new Z(W.WR),Object.freeze&&(Object.freeze(Z.GCS_NAD_1927),Object.freeze(Z.WGS84),Object.freeze(Z.WebMercator));const ie=Z},15994:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>x});const x={convertToGEGeometry:function A(ce,oe){return null==oe?null:ce.convertJSONToGeometry(oe)},exportPoint:function Q(ce,oe,le){const Y=new G(ce.getPointX(oe),ce.getPointY(oe),le),j=ce.hasZ(oe),X=ce.hasM(oe);return j&&(Y.z=ce.getPointZ(oe)),X&&(Y.m=ce.getPointM(oe)),Y},exportPolygon:function re(ce,oe,le){return new H(ce.exportPaths(oe),le,ce.hasZ(oe),ce.hasM(oe))},exportPolyline:function W(ce,oe,le){return new J(ce.exportPaths(oe),le,ce.hasZ(oe),ce.hasM(oe))},exportMultipoint:function Z(ce,oe,le){return new B(ce.exportPoints(oe),le,ce.hasZ(oe),ce.hasM(oe))},exportExtent:function ue(ce,oe,le){const Y=ce.hasZ(oe),j=ce.hasM(oe),X=new ie(ce.getXMin(oe),ce.getYMin(oe),ce.getXMax(oe),ce.getYMax(oe),le);if(Y){const U=ce.getZExtent(oe);X.zmin=U.vmin,X.zmax=U.vmax}if(j){const U=ce.getMExtent(oe);X.mmin=U.vmin,X.mmax=U.vmax}return X}};class G{constructor(oe,le,Y){this.x=oe,this.y=le,this.spatialReference=Y,this.z=void 0,this.m=void 0}}class H{constructor(oe,le,Y,j){this.rings=oe,this.spatialReference=le,this.hasZ=void 0,this.hasM=void 0,Y&&(this.hasZ=Y),j&&(this.hasM=j)}}class J{constructor(oe,le,Y,j){this.paths=oe,this.spatialReference=le,this.hasZ=void 0,this.hasM=void 0,Y&&(this.hasZ=Y),j&&(this.hasM=j)}}class B{constructor(oe,le,Y,j){this.points=oe,this.spatialReference=le,this.hasZ=void 0,this.hasM=void 0,Y&&(this.hasZ=Y),j&&(this.hasM=j)}}class ie{constructor(oe,le,Y,j,X){this.xmin=oe,this.ymin=le,this.xmax=Y,this.ymax=j,this.spatialReference=X,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},55915:(dt,Re,T)=>{"use strict";T.d(Re,{Bm:()=>qt,CM:()=>Xt,K2:()=>Ye,KC:()=>wt,MT:()=>yt,PR:()=>Ar,Qr:()=>Mr,Rg:()=>zt,SH:()=>Rt,UY:()=>Ft,Up:()=>we,Wt:()=>ze,X4:()=>jt,YD:()=>Be,bi:()=>tt,dH:()=>ct,dz:()=>Ce,fA:()=>at,fM:()=>Ne,fi:()=>Se,gH:()=>ri,iQ:()=>Oe,iV:()=>Te,jF:()=>ii,kR:()=>Me,ke:()=>bt,nF:()=>De,oj:()=>me,rS:()=>Ie,st:()=>Yr,yH:()=>Zt,zD:()=>Ee,zP:()=>mi});var x=T(15861),A=T(26584),G=T(21286),Q=T(62208),H=T(10699),re=T(16730),J=T(36082),W=T(48902),B=T(28347),Z=T(84161),ie=T(28093),ue=T(2004),ce=T(72854),oe=T(44956),le=T(49672),Y=T(37118),j=T(55214),X=T(12080),U=T(65401),ee=T(94425),$=T(37299),ne=T(98346),se=T(37053),ae=T(6178),de=T(33696);let _e=null,pe=null,he=null,ge={};const ye=new W.s;function Me(){return!!_e&&(0,oe.i)()}function Ee(gr){return(0,Q.Wi)(he)&&(he=Promise.all([(0,oe.l)(),T.e(4918).then(T.bind(T,4918)).then(Sr=>Sr.g),T.e(7777).then(T.bind(T,77777))])),he.then(([,Sr,{hydratedAdapter:mr}])=>{(0,H.k_)(gr),pe=mr,_e=Sr.default,_e._enableProjection(oe.p),ye.notify()})}function Te(gr,Sr,mr=null,Wr=null){return Array.isArray(gr)?0===gr.length?[]:me(pe,gr,gr[0].spatialReference,Sr,mr,Wr):me(pe,[gr],gr.spatialReference,Sr,mr,Wr)[0]}function me(gr,Sr,mr,Wr,Di=null,Wi=null){if((0,Q.Wi)(mr)||(0,Q.Wi)(Wr))return Sr;if(we(mr,Wr,Di))return Sr.map(ns=>(0,Q.Wg)(Se(ns,mr,Wr)));if((0,Q.Wi)(Di)){const ns=ne.Z.cacheKey(mr,Wr);void 0!==ge[ns]?Di=ge[ns]:(Di=Ie(mr,Wr,null),(0,Q.Wi)(Di)&&(Di=new ne.Z),ge[ns]=Di)}if((0,Q.Wi)(_e))throw new Je;return(0,Q.pC)(Wi)?_e._project(gr,Sr,mr,Wr,Di,Wi):_e._project(gr,Sr,mr,Wr,Di)}function Ce(gr,Sr){return(0,Q.Wi)(gr)?{pending:null,geometry:null}:(0,se.fS)(gr.spatialReference,Sr)?{pending:null,geometry:gr}:(0,se.JY)(gr.spatialReference)&&(0,se.JY)(Sr)?we(gr.spatialReference,Sr)||Me()?{pending:null,geometry:Ne(gr,Sr)}:((0,J.it)(ye),{pending:Ee(),geometry:null}):{pending:null,geometry:null}}function Ie(gr,Sr,mr=null){if((0,Q.Wi)(_e))throw new Je;if((0,Q.Wi)(gr)||(0,Q.Wi)(Sr))return null;const Wr=_e._getTransformation(pe,gr,Sr,mr,null==mr?void 0:mr.spatialReference);return null!==Wr?ne.Z.fromGE(Wr):null}class Je extends A.Z{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var xe,gr;function Ne(gr,Sr){try{const mr=Te(gr,Sr);if(null==mr)return null;"xmin"in gr&&"xmin"in mr&&(mr.zmin=gr.zmin,mr.zmax=gr.zmax);const Wr=(0,de.k)(mr.type,gr.spatialReference,Sr);return(0,Q.pC)(Wr)&&Wr(mr),mr}catch(mr){if(!(mr instanceof Je))throw mr;return null}}function we(gr,Sr,mr){return!mr&&(!!(0,se.fS)(gr,Sr)||(0,se.JY)(gr)&&(0,se.JY)(Sr)&&!!Mt(gr,Sr,is))}function Oe(gr,Sr,mr,Wr){return $e.apply(this,arguments)}function $e(){return $e=(0,x.Z)(function*(gr,Sr,mr,Wr){if(Me())return(0,H.Yn)(Wr);if(Array.isArray(gr)){for(const{source:Di,dest:Wi,geographicTransformation:ns}of gr)if(!we(Di,Wi,ns))return Ee(Wr)}else if(!we(gr,Sr,mr))return Ee(Wr);return(0,H.Yn)(Wr)}),$e.apply(this,arguments)}function Be(gr,Sr){switch(Mt(gr,Sr,is)){case fr:return"copy3";case Hs:return"wgs84ToSphericalECEF";case hr:return"wgs84ToWebMercator";case Nt:return"wgs84ToPlateCarree";case zr:return"wgs84ToWGS84ECEF";case Ur:return"webMercatorToWGS84";case Br:return"webMercatorToSphericalECEF";case Zr:return"webMercatorToWGS84ECEF";case jr:return"webMercatorToPlateCarree";case gs:return"wgs84ECEFToWGS84";case hi:return"wgs84ECEFToSphericalECEF";case ln:return"wgs84ECEFToWebMercator";case Ii:return"sphericalECEFToWGS84";case ji:return"sphericalECEFToWebMercator";case _i:return"sphericalMarsPCPFToMars2000";case ni:return"sphericalMoonPCPFToMoon2000";case Gi:return"sphericalECEFToWGS84ECEF";case Ni:return"mars2000ToSphericalPCPF";case Qr:return"moon2000ToSphericalPCPF";default:return null}}function Se(gr,Sr,mr){return gr?"x"in gr?Fe(gr,Sr,new le.Z,mr,0):"xmin"in gr?function ot(gr,Sr,mr,Wr,Di){const{xmin:Wi,ymin:ns,xmax:Yi,ymax:hs,hasZ:Ks,hasM:Ms}=gr;return zt(Wi,ns,Ks?gr.zmin:Di,Sr,ms,Wr)?(mr.xmin=ms[0],mr.ymin=ms[1],Ks&&(mr.zmin=ms[2]),zt(Yi,hs,Ks?gr.zmax:Di,Sr,ms,Wr)?(mr.xmax=ms[0],mr.ymax=ms[1],Ks&&(mr.zmax=ms[2]),Ms&&(mr.mmin=gr.mmin,mr.mmax=gr.mmax),mr.spatialReference=Wr,mr):null):null}(gr,Sr,new ue.Z,mr,0):"rings"in gr?et(gr,Sr,new Y.Z,mr,0):"paths"in gr?function be(gr,Sr,mr,Wr,Di){const{paths:Wi,hasZ:ns,hasM:Yi}=gr,hs=[];return Cr(Wi,ns,Yi,Sr,hs,Wr,Di)?(mr.paths=hs,mr.spatialReference=Wr,mr.hasZ=ns,mr.hasM=Yi,mr):null}(gr,Sr,new j.Z,mr,0):"points"in gr?function Ke(gr,Sr,mr,Wr,Di){const{points:Wi,hasZ:ns,hasM:Yi}=gr,hs=[],Ks=Wi.length,Ms=[];for(const Zs of Wi)Ms.push(Zs[0],Zs[1],ns?Zs[2]:Di);if(!Xt(Ms,Sr,0,Ms,Wr,0,Ks))return null;for(let Zs=0;Zs<Ks;++Zs){const tn=3*Zs,So=Ms[tn],Bn=Ms[tn+1];hs.push(ns&&Yi?[So,Bn,Ms[tn+2],Wi[Zs][3]]:ns?[So,Bn,Ms[tn+2]]:Yi?[So,Bn,Wi[Zs][2]]:[So,Bn])}return mr.points=hs,mr.spatialReference=Wr,mr.hasZ=ns,mr.hasM=Yi,mr}(gr,Sr,new ce.Z,mr,0):null:null}function De(gr,Sr,mr=Sr.spatialReference,Wr=0){return!(0,Q.Wi)(mr)&&(0,Q.pC)(Fe(gr,gr.spatialReference,Sr,mr,Wr))}function Fe(gr,Sr,mr,Wr,Di){ms[0]=gr.x,ms[1]=gr.y;const Wi=gr.z;return ms[2]=void 0!==Wi?Wi:Di,Xt(ms,Sr,0,ms,Wr,0,1)?(mr.x=ms[0],mr.y=ms[1],mr.spatialReference=Wr,void 0===Wi?(mr.z=void 0,mr.hasZ=!1):(mr.z=ms[2],mr.hasZ=!0),void 0===gr.m?(mr.m=void 0,mr.hasM=!1):(mr.m=gr.m,mr.hasM=!0),mr):null}function tt({hasZ:gr,spatialReference:Sr,paths:mr},Wr,Di=0){const Wi=ir(Sr,gi),ns=ds[Wi][xe.WGS84_COMPARABLE_LON_LAT];if((0,Q.Wi)(ns))return!1;const Yi=gr?hs=>hs:hs=>(0,Z.s)(ms,hs[0],hs[1],Di);for(const hs of mr){const Ks=[];for(const Ms of hs){const Zs=[0,0,Di];ns(Yi(Ms),0,Zs,0),Ks.push(Zs)}Wr.push(Ks)}return!0}function Ye({hasZ:gr,spatialReference:Sr,rings:mr},Wr,Di=0){const Wi=ir(Sr,gi),ns=ds[Wi][xe.WGS84_COMPARABLE_LON_LAT];if((0,Q.Wi)(ns))return!1;const Yi=gr?hs=>hs:hs=>(0,Z.s)(ms,hs[0],hs[1],Di);for(const hs of mr){const Ks=[];for(const Ms of hs){const Zs=[0,0,Di];ns(Yi(Ms),0,Zs,0),Ks.push(Zs)}Wr.push(Ks)}return!0}function ze(gr,Sr,mr=Sr.spatialReference,Wr=0){return(0,Q.pC)(mr)&&(0,Q.pC)(et(gr,gr.spatialReference,Sr,mr,Wr))}function et(gr,Sr,mr,Wr,Di){const{rings:Wi,hasZ:ns,hasM:Yi}=gr,hs=[];return Cr(Wi,ns,Yi,Sr,hs,Wr,Di)?(mr.rings=hs,mr.spatialReference=Wr,mr.hasZ=ns,mr.hasM=Yi,mr):null}function at(gr,Sr,mr){if((0,Q.Wi)(Sr)||(0,Q.Wi)(mr))return null;const Wr=new le.Z({spatialReference:mr});return Xt(gr,Sr,0,ms,mr,0,1)?(Wr.x=ms[0],Wr.y=ms[1],Wr.z=ms[2],Wr):null}function yt(gr,Sr,mr){return Xt(gr,Sr,0,ms,mr.spatialReference,0,1)?(mr.x=ms[0],mr.y=ms[1],mr.z=ms[2],mr):null}function wt(gr,Sr,mr,Wr=0){ms[0]=gr.x,ms[1]=gr.y;const Di=gr.z;return ms[2]=void 0!==Di?Di:Wr,Xt(ms,gr.spatialReference,0,Sr,mr,0,1)}function zt(gr,Sr,mr,Wr,Di,Wi){return ps[0]=gr,ps[1]=Sr,ps[2]=mr,Xt(ps,Wr,0,Di,Wi,0,1)}function Rt(gr,Sr,mr,Wr){return!((0,Q.Wi)(Sr)||(0,Q.Wi)(Wr)||gr.length<2)&&(2===gr.length&&(ps[0]=gr[0],ps[1]=gr[1],ps[2]=0,gr=ps),Xt(gr,Sr,0,mr,Wr,0,1))}function Ft(gr,Sr){ms[0]=gr.x,ms[1]=gr.y;const mr=gr.z;return ms[2]=void 0!==mr?mr:0,bt(ms,gr.spatialReference,Sr)}function bt(gr,Sr,mr){return function St(gr,Sr,mr){if((0,Q.Wi)(Sr))return!1;const Wr=ir(Sr,gi),Di=ds[Wr][xe.WGS84_COMPARABLE_LON_LAT];return!(0,Q.Wi)(Di)&&(Di(gr,0,ps,0),mr!==ps&&(mr[0]=ps[0],mr[1]=ps[1],mr.length>2&&(mr[2]=ps[2])),!0)}(gr,Sr,mr)}function Xt(gr,Sr,mr,Wr,Di,Wi,ns=1){const Yi=Mt(Sr,Di,is);if((0,Q.Wi)(Yi))return!1;if(Yi===fr){if(gr===Wr&&mr===Wi)return!0;const Ks=mr+3*ns;for(let Ms=mr,Zs=Wi;Ms<Ks;Ms++,Zs++)Wr[Zs]=gr[Ms];return!0}const hs=mr+3*ns;for(let Ks=mr,Ms=Wi;Ks<hs;Ks+=3,Ms+=3)Yi(gr,Ks,Wr,Ms);return!0}function Mr(gr,Sr,mr,Wr,Di){(0,Z.c)(ms,gr),(0,Z.a)(Un,gr,Sr),Rt(ms,mr,ms,Di),Rt(Un,mr,Un,Di),(0,Z.b)(Wr,Un,ms),(0,Z.n)(Wr,Wr)}function Cr(gr,Sr,mr,Wr,Di,Wi,ns=0){const Yi=new Array;for(const Ks of gr)for(const Ms of Ks)Yi.push(Ms[0],Ms[1],Sr?Ms[2]:ns);if(!Xt(Yi,Wr,0,Yi,Wi,0,Yi.length/3))return!1;let hs=0;Di.length=0;for(const Ks of gr){const Ms=new Array;for(const Zs of Ks)Sr&&mr?Ms.push([Yi[hs++],Yi[hs++],Yi[hs++],Zs[3]]):Sr?Ms.push([Yi[hs++],Yi[hs++],Yi[hs++]]):mr?(Ms.push([Yi[hs++],Yi[hs++],Zs[2]]),hs++):(Ms.push([Yi[hs++],Yi[hs++]]),hs++);Di.push(Ms)}return!0}function Yr(gr,Sr,mr,Wr){if((0,Q.Wi)(Sr)||(0,Q.Wi)(Wr))return!1;const Di=Hr(Sr,Wr,ss);if(Di.projector===fr)return mr[0]=gr[0],mr[1]=gr[1],mr[2]=gr[2],mr[3]=gr[3],!0;if((0,Q.Wi)(Di.projector))return!1;const{source:Wi,dest:ns}=Di;if(ns.spatialReferenceId===xe.WEB_MERCATOR){const Yi=ds[Wi.spatialReferenceId][xe.WGS84];return!(0,Q.Wi)(Yi)&&(Yi(gr,0,Ds,0),hr(Ds,0,mr,0),mr[3]=Lr(Ds[1],gr[2],gr[3],ee.sv.radius),!0)}if(Wi.spatialReferenceId!==xe.WGS84&&Wi.spatialReferenceId!==xe.CGCS2000||ns.spatialReferenceId!==xe.PLATE_CARREE)Di.projector(gr,0,mr,0),mr[3]=gr[3]*Wi.metersPerUnit/ns.metersPerUnit;else{const hs=ds[xe.SPHERICAL_ECEF][xe.PLATE_CARREE];let Ks=gr[3];(0,Q.pC)(ds[Wi.spatialReferenceId][xe.SPHERICAL_ECEF])&&(0,Q.pC)(hs)&&(Ks=Lr(gr[1],gr[2],gr[3],ee.sv.radius)),Di.projector(gr,0,mr,0),mr[3]=Ks}return!0}function Lr(gr,Sr,mr,Wr){const Di=Wr+Sr;if(Di<Wr/2||mr>Di)return Number.MAX_VALUE;const Wi=Math.abs(ts*gr)+Math.asin(mr/Di);return Wi>=Math.PI/2?Number.MAX_VALUE:mr/Math.cos(Wi)}function ct(gr,Sr,mr,Wr){return!(null==gr||((0,se.fS)(Sr,Wr)?((0,U.JG)(mr,gr),0):(ps[0]=gr[0],ps[1]=gr[1],ps[2]=0,!Xt(ps,Sr,0,ps,Wr,0,1)||(mr[0]=ps[0],mr[1]=ps[1],ps[0]=gr[2],ps[1]=gr[3],ps[2]=0,!Xt(ps,Sr,0,ps,Wr,0,1)||(mr[2]=ps[0],mr[3]=ps[1],0)))))}function jt(gr,Sr,mr,Wr){if((0,Q.Wi)(Sr)||(0,Q.Wi)(Wr))return!1;const Di=ir(Sr,gi),Wi=ir(Wr,Ui);if(Di===Wi&&Di!==xe.UNKNOWN||(0,se.fS)(Sr,Wr))return mr[0]=1,mr[1]=1,mr[2]=1,!0;if(Di===xe.SPHERICAL_ECEF){const ns=(0,Z.l)(gr),Yi=ns/Math.sqrt(gr[0]*gr[0]+gr[1]*gr[1]),hs=ns/ee.sv.radius;if(Wi===xe.WEB_MERCATOR)return mr[0]=Yi*hs,mr[1]=Yi*hs,mr[2]=1,!0;if(Wi===xe.WGS84||Wi===xe.CGCS2000){const Ks=Kr;return mr[0]=Ks*Yi*hs,mr[1]=Ks*hs,mr[2]=1,!0}}else if(Di===xe.PLATE_CARREE){if(Wi===xe.WGS84||Wi===xe.CGCS2000)return mr[0]=Kr,mr[1]=Kr,mr[2]=1,!0;if(Wi===xe.WEB_MERCATOR){const ns=gr[1]/ee.sv.radius;return mr[0]=1,mr[1]=1/Math.cos(ns),mr[2]=1,!0}}return!1}function qt(gr,Sr,mr,Wr){if((0,Q.Wi)(gr)||(0,Q.Wi)(Wr))return!1;const Di=ir(gr,gi),Wi=ir(Wr,Ui);if(Di===Wi&&!er(Wi)&&(Di!==xe.UNKNOWN||(0,se.fS)(gr,Wr)))return(0,B.f)(mr,Sr),!0;if(er(Wi)){const ns=ds[Di][xe.LON_LAT],Yi=ds[xe.LON_LAT][Wi];return!(0,Q.Wi)(ns)&&!(0,Q.Wi)(Yi)&&(ns(Sr,0,Ds,0),Yi(Ds,0,Ps,0),Zt(ts*Ds[0],ts*Ds[1],mr),mr[12]=Ps[0],mr[13]=Ps[1],mr[14]=Ps[2],!0)}if((Wi===xe.WEB_MERCATOR||Wi===xe.PLATE_CARREE)&&(Di===xe.WGS84||Di===xe.CGCS2000&&Wi===xe.PLATE_CARREE||Di===xe.SPHERICAL_ECEF||Di===xe.WEB_MERCATOR)){const ns=ds[Di][xe.LON_LAT],Yi=ds[xe.LON_LAT][Wi];return!(0,Q.Wi)(ns)&&!(0,Q.Wi)(Yi)&&(ns(Sr,0,Ds,0),Yi(Ds,0,Ps,0),Di===xe.SPHERICAL_ECEF?function tr(gr,Sr,mr){Zt(gr,Sr,mr),(0,B.t)(mr,mr)}(ts*Ds[0],ts*Ds[1],mr):(0,B.i)(mr),mr[12]=Ps[0],mr[13]=Ps[1],mr[14]=Ps[2],!0)}return!1}function er(gr){return gr===xe.SPHERICAL_ECEF||gr===xe.SPHERICAL_MARS_PCPF||gr===xe.SPHERICAL_MOON_PCPF}function Zt(gr,Sr,mr){const Wr=Math.sin(gr),Di=Math.cos(gr),Wi=Math.sin(Sr),ns=Math.cos(Sr),Yi=mr;return Yi[0]=-Wr,Yi[4]=-Wi*Di,Yi[8]=ns*Di,Yi[12]=0,Yi[1]=Di,Yi[5]=-Wi*Wr,Yi[9]=ns*Wr,Yi[13]=0,Yi[2]=0,Yi[6]=ns,Yi[10]=Wi,Yi[14]=0,Yi[3]=0,Yi[7]=0,Yi[11]=0,Yi[15]=1,Yi}function ir(gr,Sr){return Sr.spatialReference===gr?Sr.spatialReferenceId:(Sr.spatialReference=gr,"metersPerUnit"in Sr&&(Sr.metersPerUnit=(0,re.c9)(gr,1)),Sr.spatialReferenceId=gr.wkt===X.GG.wkt?xe.SPHERICAL_ECEF:(0,se.oR)(gr)?xe.WGS84:(0,se.sS)(gr)?xe.WEB_MERCATOR:(0,se.QM)(gr)?xe.PLATE_CARREE:gr.wkt===X.wY.wkt?xe.WGS84_ECEF:gr.wkid===ae.W.CGCS2000?xe.CGCS2000:gr.wkt===X.HQ.wkt?xe.SPHERICAL_MARS_PCPF:gr.wkt===X.VY.wkt?xe.SPHERICAL_MOON_PCPF:(0,se.BZ)(gr)?xe.GCSMARS2000:(0,se.V2)(gr)?xe.GCSMOON2000:xe.UNKNOWN)}function fr(gr,Sr,mr,Wr){gr!==mr&&(mr[Wr++]=gr[Sr++],mr[Wr++]=gr[Sr++],mr[Wr]=gr[Sr])}function Ur(gr,Sr,mr,Wr){mr[Wr++]=ys*(gr[Sr++]/ee.sv.radius),mr[Wr++]=ys*(Math.PI/2-2*Math.atan(Math.exp(-gr[Sr++]/ee.sv.radius))),mr[Wr]=gr[Sr]}function Br(gr,Sr,mr,Wr){Ur(gr,Sr,mr,Wr),Hs(mr,Wr,mr,Wr)}function Zr(gr,Sr,mr,Wr){Ur(gr,Sr,mr,Wr),zr(mr,Wr,mr,Wr)}function ri(gr,Sr,mr,Wr,Di){const Wi=.4999999*Math.PI,ns=(0,G.uZ)(ts*gr[Sr+1],-Wi,Wi),Yi=Math.sin(ns);mr[Wr++]=ts*gr[Sr]*Di.radius,mr[Wr++]=Di.halfSemiMajorAxis*Math.log((1+Yi)/(1-Yi)),mr[Wr]=gr[Sr+2]}function hr(gr,Sr,mr,Wr){ri(gr,Sr,mr,Wr,ee.sv)}(gr=xe||(xe={}))[gr.UNKNOWN=0]="UNKNOWN",gr[gr.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",gr[gr.WGS84=2]="WGS84",gr[gr.WEB_MERCATOR=3]="WEB_MERCATOR",gr[gr.WGS84_ECEF=4]="WGS84_ECEF",gr[gr.CGCS2000=5]="CGCS2000",gr[gr.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",gr[gr.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",gr[gr.GCSMARS2000=8]="GCSMARS2000",gr[gr.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",gr[gr.GCSMOON2000=10]="GCSMOON2000",gr[gr.LON_LAT=11]="LON_LAT",gr[gr.PLATE_CARREE=12]="PLATE_CARREE";const Dr=ee.sv.radius*Math.PI/180,Kr=180/(ee.sv.radius*Math.PI);function Nt(gr,Sr,mr,Wr){mr[Wr]=gr[Sr]*Dr,mr[Wr+1]=gr[Sr+1]*Dr,mr[Wr+2]=gr[Sr+2]}function lr(gr,Sr,mr,Wr){mr[Wr]=gr[Sr]*Kr,mr[Wr+1]=gr[Sr+1]*Kr,mr[Wr+2]=gr[Sr+2]}function jr(gr,Sr,mr,Wr){Ur(gr,Sr,mr,Wr),Nt(mr,Wr,mr,Wr)}function ii(gr){if((0,Q.Wi)(gr))return!1;const Sr=ir(gr,gi);return!!ds[Sr][xe.WGS84_COMPARABLE_LON_LAT]}function mi(gr,Sr,mr,Wr){const Di=Math.cos(mr);gr[0]=Math.cos(Sr)*Di*Wr,gr[1]=Math.sin(Sr)*Di*Wr,gr[2]=Math.sin(mr)*Wr}function wi(gr,Sr,mr,Wr,Di){const Wi=Di+gr[Sr+2],ns=ts*gr[Sr+1],Yi=ts*gr[Sr],hs=Math.cos(ns);mr[Wr++]=Math.cos(Yi)*hs*Wi,mr[Wr++]=Math.sin(Yi)*hs*Wi,mr[Wr]=Math.sin(ns)*Wi}function Qr(gr,Sr,mr,Wr){wi(gr,Sr,mr,Wr,ee.Z1.radius)}function Ni(gr,Sr,mr,Wr){wi(gr,Sr,mr,Wr,ee.yr.radius)}function Hs(gr,Sr,mr,Wr){wi(gr,Sr,mr,Wr,ee.sv.radius)}function Ar(gr,Sr,mr,Wr,Di){const Wi=gr[Sr],ns=gr[Sr+1],Yi=gr[Sr+2],hs=Math.sqrt(Wi*Wi+ns*ns+Yi*Yi),Ks=(0,G.Kt)(Yi/(0===hs?1:hs)),Ms=Math.atan2(ns,Wi);mr[Wr++]=ys*Ms,mr[Wr++]=ys*Ks,mr[Wr]=hs-Di}function ni(gr,Sr,mr,Wr){Ar(gr,Sr,mr,Wr,ee.Z1.radius)}function _i(gr,Sr,mr,Wr){Ar(gr,Sr,mr,Wr,ee.yr.radius)}function Ii(gr,Sr,mr,Wr){Ar(gr,Sr,mr,Wr,ee.sv.radius)}function ji(gr,Sr,mr,Wr){Ii(gr,Sr,mr,Wr),hr(mr,Wr,mr,Wr)}function Gi(gr,Sr,mr,Wr){Ii(gr,Sr,mr,Wr),zr(mr,Wr,mr,Wr)}function zr(gr,Sr,mr,Wr){!function es(gr,Sr,mr,Wr,Di){const Wi=ts*gr[Sr],ns=ts*gr[Sr+1],Yi=gr[Sr+2],hs=Math.sin(ns),Ks=Math.cos(ns),Ms=Di.radius/Math.sqrt(1-Di.eccentricitySquared*hs*hs);mr[Wr++]=(Ms+Yi)*Ks*Math.cos(Wi),mr[Wr++]=(Ms+Yi)*Ks*Math.sin(Wi),mr[Wr++]=(Ms*(1-Di.eccentricitySquared)+Yi)*hs}(gr,Sr,mr,Wr,ee.sv)}function gs(gr,Sr,mr,Wr){const Di=$.cD,Wi=gr[Sr],ns=gr[Sr+1],Yi=gr[Sr+2];let hs,Ks,Ms,Zs,tn,So,Bn,_o,to,Vn,Pa,fa,Yo,_a,ia,Xs,ro,xa,xo,ti,Nn;hs=Math.abs(Yi),Ks=Wi*Wi+ns*ns,Ms=Math.sqrt(Ks),Zs=Ks+Yi*Yi,tn=Math.sqrt(Zs),ti=Math.atan2(ns,Wi),So=Yi*Yi/Zs,Bn=Ks/Zs,_a=Di.a2/tn,ia=Di.a3-Di.a4/tn,Bn>.3?(_o=hs/tn*(1+Bn*(Di.a1+_a+So*ia)/tn),xo=Math.asin(_o),Vn=_o*_o,to=Math.sqrt(1-Vn)):(to=Ms/tn*(1-So*(Di.a5-_a-Bn*ia)/tn),xo=Math.acos(to),Vn=1-to*to,_o=Math.sqrt(Vn)),Pa=1-ee.sv.eccentricitySquared*Vn,fa=ee.sv.radius/Math.sqrt(Pa),Yo=Di.a6*fa,_a=Ms-fa*to,ia=hs-Yo*_o,ro=to*_a+_o*ia,Xs=to*ia-_o*_a,xa=Xs/(Yo/Pa+ro),xo+=xa,Nn=ro+Xs*xa/2,Yi<0&&(xo=-xo),mr[Wr++]=ys*ti,mr[Wr++]=ys*xo,mr[Wr]=Nn}function hi(gr,Sr,mr,Wr){gs(gr,Sr,mr,Wr),Hs(mr,Wr,mr,Wr)}function ln(gr,Sr,mr,Wr){gs(gr,Sr,mr,Wr),hr(mr,Wr,mr,Wr)}const ds={[xe.WGS84]:{[xe.CGCS2000]:null,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:null,[xe.LON_LAT]:fr,[xe.WGS84_COMPARABLE_LON_LAT]:fr,[xe.SPHERICAL_ECEF]:Hs,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:hr,[xe.PLATE_CARREE]:Nt,[xe.WGS84]:fr,[xe.WGS84_ECEF]:zr},[xe.CGCS2000]:{[xe.CGCS2000]:fr,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:null,[xe.LON_LAT]:fr,[xe.WGS84_COMPARABLE_LON_LAT]:fr,[xe.SPHERICAL_ECEF]:Hs,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:null,[xe.PLATE_CARREE]:Nt,[xe.WGS84]:null,[xe.WGS84_ECEF]:zr},[xe.GCSMARS2000]:{[xe.CGCS2000]:null,[xe.GCSMARS2000]:fr,[xe.GCSMOON2000]:null,[xe.LON_LAT]:fr,[xe.WGS84_COMPARABLE_LON_LAT]:null,[xe.SPHERICAL_ECEF]:null,[xe.SPHERICAL_MARS_PCPF]:Ni,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:null,[xe.PLATE_CARREE]:null,[xe.WGS84]:null,[xe.WGS84_ECEF]:null},[xe.GCSMOON2000]:{[xe.CGCS2000]:null,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:fr,[xe.LON_LAT]:fr,[xe.WGS84_COMPARABLE_LON_LAT]:null,[xe.SPHERICAL_ECEF]:null,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:Qr,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:null,[xe.PLATE_CARREE]:null,[xe.WGS84]:null,[xe.WGS84_ECEF]:null},[xe.WEB_MERCATOR]:{[xe.CGCS2000]:null,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:null,[xe.LON_LAT]:Ur,[xe.WGS84_COMPARABLE_LON_LAT]:Ur,[xe.SPHERICAL_ECEF]:Br,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:fr,[xe.PLATE_CARREE]:jr,[xe.WGS84]:Ur,[xe.WGS84_ECEF]:Zr},[xe.WGS84_ECEF]:{[xe.CGCS2000]:gs,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:null,[xe.LON_LAT]:gs,[xe.WGS84_COMPARABLE_LON_LAT]:gs,[xe.SPHERICAL_ECEF]:hi,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:ln,[xe.PLATE_CARREE]:function Ot(gr,Sr,mr,Wr){gs(gr,Sr,mr,Wr),Nt(mr,Wr,mr,Wr)},[xe.WGS84]:gs,[xe.WGS84_ECEF]:fr},[xe.SPHERICAL_ECEF]:{[xe.CGCS2000]:Ii,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:null,[xe.LON_LAT]:Ii,[xe.WGS84_COMPARABLE_LON_LAT]:Ii,[xe.SPHERICAL_ECEF]:fr,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:ji,[xe.PLATE_CARREE]:function rr(gr,Sr,mr,Wr){Ii(gr,Sr,mr,Wr),Nt(mr,Wr,mr,Wr)},[xe.WGS84]:Ii,[xe.WGS84_ECEF]:Gi},[xe.SPHERICAL_MARS_PCPF]:{[xe.CGCS2000]:null,[xe.GCSMARS2000]:_i,[xe.GCSMOON2000]:null,[xe.LON_LAT]:_i,[xe.WGS84_COMPARABLE_LON_LAT]:null,[xe.SPHERICAL_ECEF]:null,[xe.SPHERICAL_MARS_PCPF]:fr,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:null,[xe.PLATE_CARREE]:null,[xe.WGS84]:null,[xe.WGS84_ECEF]:null},[xe.SPHERICAL_MOON_PCPF]:{[xe.CGCS2000]:null,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:ni,[xe.LON_LAT]:ni,[xe.WGS84_COMPARABLE_LON_LAT]:null,[xe.SPHERICAL_ECEF]:null,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:fr,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:null,[xe.PLATE_CARREE]:null,[xe.WGS84]:null,[xe.WGS84_ECEF]:null},[xe.UNKNOWN]:{[xe.CGCS2000]:null,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:null,[xe.LON_LAT]:null,[xe.WGS84_COMPARABLE_LON_LAT]:null,[xe.SPHERICAL_ECEF]:null,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:fr,[xe.WEB_MERCATOR]:null,[xe.PLATE_CARREE]:null,[xe.WGS84]:null,[xe.WGS84_ECEF]:null},[xe.LON_LAT]:{[xe.CGCS2000]:fr,[xe.GCSMARS2000]:fr,[xe.GCSMOON2000]:fr,[xe.LON_LAT]:fr,[xe.WGS84_COMPARABLE_LON_LAT]:fr,[xe.SPHERICAL_ECEF]:Hs,[xe.SPHERICAL_MARS_PCPF]:Ni,[xe.SPHERICAL_MOON_PCPF]:Qr,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:hr,[xe.PLATE_CARREE]:Nt,[xe.WGS84]:fr,[xe.WGS84_ECEF]:zr},[xe.WGS84_COMPARABLE_LON_LAT]:{[xe.CGCS2000]:null,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:null,[xe.LON_LAT]:fr,[xe.WGS84_COMPARABLE_LON_LAT]:fr,[xe.SPHERICAL_ECEF]:Hs,[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:null,[xe.PLATE_CARREE]:Nt,[xe.WGS84]:fr,[xe.WGS84_ECEF]:zr},[xe.PLATE_CARREE]:{[xe.CGCS2000]:lr,[xe.GCSMARS2000]:null,[xe.GCSMOON2000]:null,[xe.LON_LAT]:lr,[xe.WGS84_COMPARABLE_LON_LAT]:lr,[xe.SPHERICAL_ECEF]:function pr(gr,Sr,mr,Wr){lr(gr,Sr,mr,Wr),Hs(mr,Wr,mr,Wr)},[xe.SPHERICAL_MARS_PCPF]:null,[xe.SPHERICAL_MOON_PCPF]:null,[xe.UNKNOWN]:null,[xe.WEB_MERCATOR]:function Pr(gr,Sr,mr,Wr){lr(gr,Sr,mr,Wr),hr(mr,Wr,mr,Wr)},[xe.PLATE_CARREE]:fr,[xe.WGS84]:lr,[xe.WGS84_ECEF]:function Fr(gr,Sr,mr,Wr){lr(gr,Sr,mr,Wr),zr(mr,Wr,mr,Wr)}}};function Mt(gr,Sr,mr=Ir()){return(0,Q.Wi)(gr)||(0,Q.Wi)(Sr)?null:Hr(gr,Sr,mr).projector}function Hr(gr,Sr,mr){if((0,Q.Wi)(gr)||(0,Q.Wi)(Sr)||mr.source.spatialReference===gr&&mr.dest.spatialReference===Sr)return mr;const Wr=ir(gr,mr.source),Di=ir(Sr,mr.dest);return mr.projector=Wr===xe.UNKNOWN&&Di===xe.UNKNOWN?(0,se.fS)(gr,Sr)?fr:null:ds[Wr][Di],mr}function Ir(){return{source:{spatialReference:null,spatialReferenceId:xe.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:xe.UNKNOWN,metersPerUnit:1},projector:fr}}const gi={spatialReference:null,spatialReferenceId:xe.UNKNOWN},Ui={spatialReference:null,spatialReferenceId:xe.UNKNOWN},is=Ir(),ss=Ir(),ts=(0,G.Vl)(1),ys=(0,G.BV)(1),ps=(0,ie.c)(),Ds=(0,ie.c)(),Ps=(0,ie.c)(),ms=(0,ie.c)(),Un=(0,ie.c)()},12080:(dt,Re,T)=>{"use strict";T.d(Re,{GG:()=>H,HQ:()=>re,Iu:()=>ie,VY:()=>J,e8:()=>ue,rS:()=>Z,wY:()=>W});var x=T(65234),A=T(94425),G=T(37053);function Q(ce){return new x.Z({wkt:`GEOCCS["Spherical geocentric",\n    DATUM["Not specified",\n      SPHEROID["Sphere",${ce.radius},0]],\n    PRIMEM["Greenwich",0.0,\n      AUTHORITY["EPSG","8901"]],\n    UNIT["m",1.0],\n    AXIS["Geocentric X",OTHER],\n    AXIS["Geocentric Y",EAST],\n    AXIS["Geocentric Z",NORTH]\n  ]`})}const H=Q(A.sv),re=Q(A.yr),J=Q(A.Z1),W=new x.Z({wkt:`GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",${A.sv.radius},298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]`});function Z(ce){return ce&&((0,G.BZ)(ce)||ce===re)?re:ce&&((0,G.V2)(ce)||ce===J)?J:H}function ie(ce){return ce&&((0,G.BZ)(ce)||ce===re)?A.yr:ce&&((0,G.V2)(ce)||ce===J)?A.Z1:A.sv}function ue(ce){return(0,G.o$)(ce)?A.yr:(0,G.ME)(ce)?A.Z1:A.sv}},78172:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{R:()=>x}),(A=x||(x={}))[A.X=0]="X",A[A.Y=1]="Y",A[A.Z=2]="Z"},94425:(dt,Re,T)=>{"use strict";T.d(Re,{Z1:()=>Q,sv:()=>A,yr:()=>G});class x{constructor(re,J,W,B){this.semiMajorAxis=re,this.flattening=J,this.outerAtmosphereRimWidth=W,this.semiMinorAxis=this.semiMajorAxis*(1-this.flattening),this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=B||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}}const A=new x(6378137,1/298.257223563,3e5,.006694379990137799),G=new x(3396190,1/169.8944472236118,23e4),Q=new x(1737400,0,0)},98346:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>G});let x=0;class A{constructor(H=null){this.uid=x++,H?(this._wkt=void 0!==H.wkt?H.wkt:null,this._wkid=void 0!==H.wkid?H.wkid:-1,this._isInverse=void 0!==H.isInverse&&!0===H.isInverse):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}static fromGE(H){const re=new A;return re._wkt=H.wkt,re._wkid=H.wkid,re._isInverse=H.isInverse,re}get wkt(){return this._wkt}set wkt(H){this._wkt=H,this.uid=x++}get wkid(){return this._wkid}set wkid(H){this._wkid=H,this.uid=x++}get isInverse(){return this._isInverse}set isInverse(H){this._isInverse=H,this.uid=x++}getInverse(){const H=new A;return H._wkt=this.wkt,H._wkid=this._wkid,H._isInverse=!this.isInverse,H}}class G{constructor(H){if(this.steps=[],this._cached_projection={},this._chain="",this._gtlistentry=null,H&&H.steps)for(const re of H.steps)this.steps.push(re instanceof A?re:new A({wkid:re.wkid,wkt:re.wkt,isInverse:re.isInverse}))}static cacheKey(H,re){return[null!=H.wkid?H.wkid.toString():"-1",null!=H.wkt?H.wkt.toString():"",null!=re.wkid?re.wkid.toString():"-1",null!=re.wkt?re.wkt.toString():""].join(",")}static fromGE(H){const re=new G;let J="";for(const W of H.steps){const B=A.fromGE(W);re.steps.push(B),J+=B.uid.toString()+","}return re._cached_projection={},re._gtlistentry=null,re._chain=J,re}getInverse(){const H=new G;H.steps=[];for(let re=this.steps.length-1;re>=0;re--)H.steps.push(this.steps[re].getInverse());return H}getGTListEntry(){let H="";for(const re of this.steps)H+=re.uid.toString()+",";return H!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=H),this._gtlistentry}assignCachedGe(H,re,J){this._cached_projection[G.cacheKey(H,re)]=J}getCachedGeTransformation(H,re){let J="";for(const B of this.steps)J+=B.uid.toString()+",";J!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=J);const W=this._cached_projection[G.cacheKey(H,re)];return void 0===W?null:W}}},61751:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ue,x=T(17626),A=T(86810),G=T(58817),Q=T(63290),H=T(77712),re=T(66656),J=T(76898),W=T(90912),B=T(45348),Z=T(27530),ie=T(92529);const ce=Q.Z.getLogger("esri.geometry.support.MeshComponent");let oe=ue=class extends A.wq{constructor(Y){super(Y),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(Y){return(0,W.TJ)(ue,Y)}castFaces(Y){return(0,ie.X)(Y,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},ce)}castMaterial(Y){return(0,W.TJ)(Y&&"object"==typeof Y&&("metallic"in Y||"roughness"in Y||"metallicRoughnessTexture"in Y)?Z.Z:B.Z,Y)}clone(){return new ue({faces:(0,G.d9)(this.faces),shading:this.shading,material:(0,G.d9)(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(Y,j){const X={faces:(0,G.d9)(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(Y,j):null,trustSourceNormals:this.trustSourceNormals};return new ue(X)}};(0,x._)([(0,H.Cb)({json:{write:!0}})],oe.prototype,"faces",void 0),(0,x._)([(0,re.p)("faces")],oe.prototype,"castFaces",null),(0,x._)([(0,H.Cb)({type:B.Z,json:{write:!0}})],oe.prototype,"material",void 0),(0,x._)([(0,re.p)("material")],oe.prototype,"castMaterial",null),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"shading",void 0),(0,x._)([(0,H.Cb)({type:Boolean})],oe.prototype,"trustSourceNormals",void 0),oe=ue=(0,x._)([(0,J.j)("esri.geometry.support.MeshComponent")],oe);const le=oe},45348:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var ie,x=T(17626),A=T(91558),G=T(86810),Q=T(62208),H=T(77712),B=(T(85931),T(8314),T(90912),T(76898)),Z=T(1607);let ue=ie=class extends G.wq{constructor(oe){super(oe),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(oe,le){const Y=(0,Q.pC)(oe)?oe.get(this):null;if(Y)return Y;const j=new ie(this.clonePropertiesWithDeduplication(le));return(0,Q.pC)(oe)&&oe.set(this,j),j}clonePropertiesWithDeduplication(oe){return{color:(0,Q.pC)(this.color)?this.color.clone():null,colorTexture:(0,Q.pC)(this.colorTexture)?this.colorTexture.cloneWithDeduplication(oe):null,normalTexture:(0,Q.pC)(this.normalTexture)?this.normalTexture.cloneWithDeduplication(oe):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};(0,x._)([(0,H.Cb)({type:A.Z,json:{write:!0}})],ue.prototype,"color",void 0),(0,x._)([(0,H.Cb)({type:Z.Z,json:{write:!0}})],ue.prototype,"colorTexture",void 0),(0,x._)([(0,H.Cb)({type:Z.Z,json:{write:!0}})],ue.prototype,"normalTexture",void 0),(0,x._)([(0,H.Cb)({nonNullable:!0,json:{write:!0}})],ue.prototype,"alphaMode",void 0),(0,x._)([(0,H.Cb)({nonNullable:!0,json:{write:!0}})],ue.prototype,"alphaCutoff",void 0),(0,x._)([(0,H.Cb)({nonNullable:!0,json:{write:!0}})],ue.prototype,"doubleSided",void 0),ue=ie=(0,x._)([(0,B.j)("esri.geometry.support.MeshMaterial")],ue);const ce=ue},27530:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var ie,x=T(17626),A=T(91558),G=T(62208),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898)),B=T(45348),Z=T(1607);let ue=ie=class extends B.Z{constructor(oe){super(oe),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(oe,le){const Y=(0,G.pC)(oe)?oe.get(this):null;if(Y)return Y;const j=new ie(this.clonePropertiesWithDeduplication(le));return(0,G.pC)(oe)&&oe.set(this,j),j}clonePropertiesWithDeduplication(oe){return yi(or({},super.clonePropertiesWithDeduplication(oe)),{emissiveColor:(0,G.pC)(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:(0,G.pC)(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(oe):null,occlusionTexture:(0,G.pC)(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(oe):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(0,G.pC)(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(oe):null})}};(0,x._)([(0,Q.Cb)({type:A.Z,json:{write:!0}})],ue.prototype,"emissiveColor",void 0),(0,x._)([(0,Q.Cb)({type:Z.Z,json:{write:!0}})],ue.prototype,"emissiveTexture",void 0),(0,x._)([(0,Q.Cb)({type:Z.Z,json:{write:!0}})],ue.prototype,"occlusionTexture",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ue.prototype,"metallic",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],ue.prototype,"roughness",void 0),(0,x._)([(0,Q.Cb)({type:Z.Z,json:{write:!0}})],ue.prototype,"metallicRoughnessTexture",void 0),ue=ie=(0,x._)([(0,W.j)("esri.geometry.support.MeshMaterialMetallicRoughness")],ue);const ce=ue},1607:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Y});var ue,x=T(17626),G=(T(8314),T(86810)),Q=T(77712),re=(T(85931),T(90912)),J=T(68653),W=T(76898),B=T(99433),Z=T(29840),ie=T(18605);const ce=new WeakMap;let oe=0,le=ue=class extends G.wq{constructor(j){super(j),this.wrap="repeat"}get url(){return this._get("url")||null}set url(j){this._set("url",j),j&&this._set("data",null)}get data(){return this._get("data")||null}set data(j){this._set("data",j),j&&this._set("url",null)}writeData(j,X,U,ee){if(j instanceof HTMLImageElement){const $={type:"image-element",src:(0,Z.t)(j.src,ee),crossOrigin:j.crossOrigin};X[U]=$}else if(j instanceof HTMLCanvasElement){const $=j.getContext("2d").getImageData(0,0,j.width,j.height),ne={type:"canvas-element",imageData:this._encodeImageData($)};X[U]=ne}else if(j instanceof HTMLVideoElement){const $={type:"video-element",src:(0,Z.t)(j.src,ee),autoplay:j.autoplay,loop:j.loop,muted:j.muted,crossOrigin:j.crossOrigin,preload:j.preload};X[U]=$}else{const $={type:"image-data",imageData:this._encodeImageData(j)};X[U]=$}}readData(j){switch(j.type){case"image-element":{const X=new Image;return X.src=j.src,X.crossOrigin=j.crossOrigin,X}case"canvas-element":{const X=this._decodeImageData(j.imageData),U=document.createElement("canvas");return U.width=X.width,U.height=X.height,U.getContext("2d").putImageData(X,0,0),U}case"image-data":return this._decodeImageData(j.imageData);case"video-element":{const X=document.createElement("video");return X.src=j.src,X.crossOrigin=j.crossOrigin,X.autoplay=j.autoplay,X.loop=j.loop,X.muted=j.muted,X.preload=j.preload,X}default:return}}get transparent(){const j=this.data,X=this.url;if(j instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(j.getContext("2d").getImageData(0,0,j.width,j.height));if(j instanceof ImageData)return this._imageDataContainsTransparent(j);if(X){const U=X.substr(X.length-4,4).toLowerCase(),ee=X.substr(0,15).toLocaleLowerCase();if(".png"===U||"data:image/png;"===ee)return!0}return!1}set transparent(j){null!=j?this._override("transparent",j):this._clearOverride("transparent")}get contentHash(){const j="string"==typeof this.wrap?this.wrap:"object"==typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",X=(U="")=>`d:${U},t:${this.transparent},w:${j}`;return null!=this.url?X(this.url):null!=this.data?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?X(this.data.src):(ce.has(this.data)||ce.set(this.data,++oe),X(ce.get(this.data))):X()}clone(){const j={url:this.url,data:this.data,wrap:this._cloneWrap()};return new ue(j)}cloneWithDeduplication(j){const X=j.get(this);if(X)return X;const U=this.clone();return j.set(this,U),U}_cloneWrap(){return"string"==typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(j){let X="";for(let U=0;U<j.data.length;U++)X+=String.fromCharCode(j.data[U]);return{data:btoa(X),width:j.width,height:j.height}}_decodeImageData(j){const X=atob(j.data),U=new Uint8ClampedArray(X.length);for(let ee=0;ee<X.length;ee++)U[ee]=X.charCodeAt(ee);return(0,ie.Jl)(U,j.width,j.height)}_imageDataContainsTransparent(j){for(let X=3;X<j.data.length;X+=4)if(255!==j.data[X])return!0;return!1}static from(j){return"string"==typeof j?new ue({url:j}):j instanceof HTMLImageElement||j instanceof HTMLCanvasElement||j instanceof ImageData||j instanceof HTMLVideoElement?new ue({data:j}):(0,re.TJ)(ue,j)}};(0,x._)([(0,Q.Cb)({type:String,json:{write:Z.w}})],le.prototype,"url",null),(0,x._)([(0,Q.Cb)({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),(0,Q.Cb)()],le.prototype,"data",null),(0,x._)([(0,B.c)("data")],le.prototype,"writeData",null),(0,x._)([(0,J.r)("data")],le.prototype,"readData",null),(0,x._)([(0,Q.Cb)({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],le.prototype,"transparent",null),(0,x._)([(0,Q.Cb)({json:{write:!0}})],le.prototype,"wrap",void 0),(0,x._)([(0,Q.Cb)({readOnly:!0})],le.prototype,"contentHash",null),le=ue=(0,x._)([(0,W.j)("esri.geometry.support.MeshTexture")],le);const Y=le},92529:(dt,Re,T)=>{"use strict";T.d(Re,{Q:()=>Z,X:()=>ue});var W,x=T(17626),A=T(86810),G=T(58817),Q=T(63290),H=T(77712),re=T(66656),J=T(76898);const B=Q.Z.getLogger("esri.geometry.support.MeshVertexAttributes");let Z=W=class extends A.wq{constructor(le){super(le),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(le){return ue(le,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},B)}castPosition(le){return le&&le instanceof Float32Array&&B.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),ue(le,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},B)}castUv(le){return ue(le,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},B)}castNormal(le){return ue(le,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},B)}castTangent(le){return ue(le,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},B)}clone(){const le={position:(0,G.d9)(this.position),uv:(0,G.d9)(this.uv),normal:(0,G.d9)(this.normal),tangent:(0,G.d9)(this.tangent),color:(0,G.d9)(this.color)};return new W(le)}clonePositional(){const le={position:(0,G.d9)(this.position),normal:(0,G.d9)(this.normal),tangent:(0,G.d9)(this.tangent),uv:this.uv,color:this.color};return new W(le)}};function ie(le,Y,j,X){const{loggerTag:U,stride:ee}=Y;return le.length%ee!=0?(X.error(U,`Invalid array length, expected a multiple of ${ee}`),new j([])):le}function ue(le,Y,j,X,U){if(!le)return le;if(le instanceof Y)return ie(le,X,Y,U);for(const ee of j)if(le instanceof ee)return ie(new Y(le),X,Y,U);if(Array.isArray(le))return ie(new Y(le),X,Y,U);{const ee=j.map($=>`'${$.name}'`);return U.error(`Failed to set property, expected one of ${ee}, but got ${le.constructor.name}`),new Y([])}}function ce(le,Y,j){Y[j]=function oe(le){const Y=new Array(le.length);for(let j=0;j<le.length;j++)Y[j]=le[j];return Y}(le)}(0,x._)([(0,H.Cb)({json:{write:ce}})],Z.prototype,"color",void 0),(0,x._)([(0,re.p)("color")],Z.prototype,"castColor",null),(0,x._)([(0,H.Cb)({nonNullable:!0,json:{write:ce}})],Z.prototype,"position",void 0),(0,x._)([(0,re.p)("position")],Z.prototype,"castPosition",null),(0,x._)([(0,H.Cb)({json:{write:ce}})],Z.prototype,"uv",void 0),(0,x._)([(0,re.p)("uv")],Z.prototype,"castUv",null),(0,x._)([(0,H.Cb)({json:{write:ce}})],Z.prototype,"normal",void 0),(0,x._)([(0,re.p)("normal")],Z.prototype,"castNormal",null),(0,x._)([(0,H.Cb)({json:{write:ce}})],Z.prototype,"tangent",void 0),(0,x._)([(0,re.p)("tangent")],Z.prototype,"castTangent",null),Z=W=(0,x._)([(0,J.j)("esri.geometry.support.MeshVertexAttributes")],Z)},6178:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{W:()=>x}),(A=x||(x={}))[A.CGCS2000=4490]="CGCS2000",A[A.GCSMARS2000=104971]="GCSMARS2000",A[A.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",A[A.GCSMOON2000=104903]="GCSMOON2000"},84029:(dt,Re,T)=>{"use strict";let x;T.d(Re,{Z:()=>A});const A={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22332:0,22391:0,22392:0,22700:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(x=2e3;x<=2045;x++)A[x]=0;for(x=2056;x<=2065;x++)A[x]=0;for(x=2067;x<=2135;x++)A[x]=0;for(x=2137;x<=2154;x++)A[x]=0;for(x=2161;x<=2170;x++)A[x]=0;for(x=2172;x<=2193;x++)A[x]=0;for(x=2195;x<=2198;x++)A[x]=0;for(x=2200;x<=2203;x++)A[x]=0;for(x=2205;x<=2217;x++)A[x]=0;for(x=2222;x<=2224;x++)A[x]=1;for(x=2225;x<=2250;x++)A[x]=2;for(x=2251;x<=2253;x++)A[x]=1;for(x=2257;x<=2264;x++)A[x]=2;for(x=2274;x<=2279;x++)A[x]=2;for(x=2280;x<=2282;x++)A[x]=1;for(x=2283;x<=2289;x++)A[x]=2;for(x=2290;x<=2292;x++)A[x]=0;for(x=2308;x<=2313;x++)A[x]=0;for(x=2315;x<=2491;x++)A[x]=0;for(x=2494;x<=2866;x++)A[x]=0;for(x=2867;x<=2869;x++)A[x]=1;for(x=2870;x<=2888;x++)A[x]=2;for(x=2891;x<=2895;x++)A[x]=2;for(x=2896;x<=2898;x++)A[x]=1;for(x=2902;x<=2908;x++)A[x]=2;for(x=2915;x<=2920;x++)A[x]=2;for(x=2921;x<=2923;x++)A[x]=1;for(x=2924;x<=2930;x++)A[x]=2;for(x=2931;x<=2962;x++)A[x]=0;for(x=2964;x<=2968;x++)A[x]=2;for(x=2969;x<=2973;x++)A[x]=0;for(x=2975;x<=2991;x++)A[x]=0;for(x=2995;x<=3051;x++)A[x]=0;for(x=3054;x<=3079;x++)A[x]=0;for(x=3081;x<=3088;x++)A[x]=0;for(x=3092;x<=3101;x++)A[x]=0;for(x=3106;x<=3138;x++)A[x]=0;for(x=3146;x<=3151;x++)A[x]=0;for(x=3153;x<=3166;x++)A[x]=0;for(x=3168;x<=3172;x++)A[x]=0;for(x=3174;x<=3203;x++)A[x]=0;for(x=3294;x<=3358;x++)A[x]=0;for(x=3367;x<=3403;x++)A[x]=0;for(x=3408;x<=3416;x++)A[x]=0;for(x=3417;x<=3438;x++)A[x]=2;for(x=3441;x<=3446;x++)A[x]=2;for(x=3447;x<=3450;x++)A[x]=0;for(x=3451;x<=3459;x++)A[x]=2;for(x=3460;x<=3478;x++)A[x]=0;for(x=3554;x<=3559;x++)A[x]=0;for(x=3560;x<=3570;x++)A[x]=2;for(x=3571;x<=3581;x++)A[x]=0;for(x=3594;x<=3597;x++)A[x]=0;for(x=3601;x<=3604;x++)A[x]=0;for(x=3637;x<=3639;x++)A[x]=0;for(x=3665;x<=3667;x++)A[x]=0;for(x=3693;x<=3695;x++)A[x]=0;for(x=3701;x<=3727;x++)A[x]=0;for(x=3728;x<=3739;x++)A[x]=2;for(x=3740;x<=3751;x++)A[x]=0;for(x=3753;x<=3760;x++)A[x]=2;for(x=3761;x<=3773;x++)A[x]=0;for(x=3775;x<=3777;x++)A[x]=0;for(x=3779;x<=3781;x++)A[x]=0;for(x=3783;x<=3785;x++)A[x]=0;for(x=3788;x<=3791;x++)A[x]=0;for(x=3797;x<=3802;x++)A[x]=0;for(x=3814;x<=3816;x++)A[x]=0;for(x=3825;x<=3829;x++)A[x]=0;for(x=3832;x<=3841;x++)A[x]=0;for(x=3844;x<=3852;x++)A[x]=0;for(x=3873;x<=3885;x++)A[x]=0;for(x=3890;x<=3893;x++)A[x]=0;for(x=3907;x<=3912;x++)A[x]=0;for(x=3942;x<=3950;x++)A[x]=0;for(x=3968;x<=3970;x++)A[x]=0;for(x=3973;x<=3976;x++)A[x]=0;for(x=3986;x<=3989;x++)A[x]=0;for(x=3994;x<=3997;x++)A[x]=0;for(x=4048;x<=4051;x++)A[x]=0;for(x=4056;x<=4063;x++)A[x]=0;for(x=4093;x<=4096;x++)A[x]=0;for(x=4390;x<=4398;x++)A[x]=0;for(x=4399;x<=4413;x++)A[x]=2;for(x=4418;x<=4433;x++)A[x]=2;for(x=4455;x<=4457;x++)A[x]=2;for(x=4484;x<=4489;x++)A[x]=0;for(x=4491;x<=4554;x++)A[x]=0;for(x=4568;x<=4589;x++)A[x]=0;for(x=4652;x<=4656;x++)A[x]=0;for(x=4766;x<=4800;x++)A[x]=0;for(x=5014;x<=5016;x++)A[x]=0;for(x=5069;x<=5072;x++)A[x]=0;for(x=5105;x<=5130;x++)A[x]=0;for(x=5173;x<=5188;x++)A[x]=0;for(x=5253;x<=5259;x++)A[x]=0;for(x=5269;x<=5275;x++)A[x]=0;for(x=5292;x<=5311;x++)A[x]=0;for(x=5329;x<=5331;x++)A[x]=0;for(x=5343;x<=5349;x++)A[x]=0;for(x=5355;x<=5357;x++)A[x]=0;for(x=5387;x<=5389;x++)A[x]=0;for(x=5459;x<=5463;x++)A[x]=0;for(x=5479;x<=5482;x++)A[x]=0;for(x=5518;x<=5520;x++)A[x]=0;for(x=5530;x<=5539;x++)A[x]=0;for(x=5550;x<=5552;x++)A[x]=0;for(x=5562;x<=5583;x++)A[x]=0;for(x=5623;x<=5625;x++)A[x]=2;for(x=5631;x<=5639;x++)A[x]=0;for(x=5649;x<=5653;x++)A[x]=0;for(x=5663;x<=5680;x++)A[x]=0;for(x=5682;x<=5685;x++)A[x]=0;for(x=5875;x<=5877;x++)A[x]=0;for(x=5896;x<=5899;x++)A[x]=0;for(x=5921;x<=5940;x++)A[x]=0;for(x=6050;x<=6125;x++)A[x]=0;for(x=6244;x<=6275;x++)A[x]=0;for(x=6328;x<=6348;x++)A[x]=0;for(x=6350;x<=6356;x++)A[x]=0;for(x=6366;x<=6372;x++)A[x]=0;for(x=6381;x<=6387;x++)A[x]=0;for(x=6393;x<=6404;x++)A[x]=0;for(x=6480;x<=6483;x++)A[x]=0;for(x=6511;x<=6514;x++)A[x]=0;for(x=6579;x<=6581;x++)A[x]=0;for(x=6619;x<=6624;x++)A[x]=0;for(x=6625;x<=6627;x++)A[x]=2;for(x=6628;x<=6632;x++)A[x]=0;for(x=6634;x<=6637;x++)A[x]=0;for(x=6669;x<=6692;x++)A[x]=0;for(x=6707;x<=6709;x++)A[x]=0;for(x=6720;x<=6723;x++)A[x]=0;for(x=6732;x<=6738;x++)A[x]=0;for(x=6931;x<=6933;x++)A[x]=0;for(x=6956;x<=6959;x++)A[x]=0;for(x=7005;x<=7007;x++)A[x]=0;for(x=7057;x<=7070;x++)A[x]=2;for(x=7074;x<=7082;x++)A[x]=0;for(x=7109;x<=7118;x++)A[x]=0;for(x=7119;x<=7127;x++)A[x]=1;for(x=7374;x<=7376;x++)A[x]=0;for(x=7528;x<=7586;x++)A[x]=0;for(x=7587;x<=7645;x++)A[x]=2;for(x=7692;x<=7696;x++)A[x]=0;for(x=7755;x<=7787;x++)A[x]=0;for(x=7791;x<=7795;x++)A[x]=0;for(x=7799;x<=7801;x++)A[x]=0;for(x=7803;x<=7805;x++)A[x]=0;for(x=7825;x<=7831;x++)A[x]=0;for(x=7845;x<=7859;x++)A[x]=0;for(x=8013;x<=8032;x++)A[x]=0;for(x=8065;x<=8068;x++)A[x]=1;for(x=8518;x<=8529;x++)A[x]=2;for(x=8533;x<=8536;x++)A[x]=2;for(x=8538;x<=8540;x++)A[x]=2;for(x=8677;x<=8679;x++)A[x]=0;for(x=8836;x<=8840;x++)A[x]=0;for(x=8857;x<=8859;x++)A[x]=0;for(x=8908;x<=8910;x++)A[x]=0;for(x=9154;x<=9159;x++)A[x]=0;for(x=9205;x<=9218;x++)A[x]=0;for(x=9271;x<=9273;x++)A[x]=0;for(x=9295;x<=9297;x++)A[x]=0;for(x=9356;x<=9360;x++)A[x]=0;for(x=9404;x<=9407;x++)A[x]=0;for(x=9476;x<=9482;x++)A[x]=0;for(x=9487;x<=9494;x++)A[x]=0;for(x=9697;x<=9699;x++)A[x]=0;for(x=20002;x<=20032;x++)A[x]=0;for(x=20062;x<=20092;x++)A[x]=0;for(x=20135;x<=20138;x++)A[x]=0;for(x=20248;x<=20258;x++)A[x]=0;for(x=20348;x<=20358;x++)A[x]=0;for(x=20436;x<=20440;x++)A[x]=0;for(x=20822;x<=20824;x++)A[x]=0;for(x=20904;x<=20932;x++)A[x]=0;for(x=20934;x<=20936;x++)A[x]=0;for(x=21004;x<=21032;x++)A[x]=0;for(x=21035;x<=21037;x++)A[x]=0;for(x=21095;x<=21097;x++)A[x]=0;for(x=21148;x<=21150;x++)A[x]=0;for(x=21207;x<=21264;x++)A[x]=0;for(x=21307;x<=21364;x++)A[x]=0;for(x=21413;x<=21423;x++)A[x]=0;for(x=21453;x<=21463;x++)A[x]=0;for(x=21473;x<=21483;x++)A[x]=0;for(x=21780;x<=21782;x++)A[x]=0;for(x=21891;x<=21894;x++)A[x]=0;for(x=21896;x<=21899;x++)A[x]=0;for(x=22171;x<=22177;x++)A[x]=0;for(x=22181;x<=22187;x++)A[x]=0;for(x=22191;x<=22197;x++)A[x]=0;for(x=22234;x<=22236;x++)A[x]=0;for(x=22521;x<=22525;x++)A[x]=0;for(x=22991;x<=22994;x++)A[x]=0;for(x=23028;x<=23038;x++)A[x]=0;for(x=23830;x<=23853;x++)A[x]=0;for(x=23866;x<=23872;x++)A[x]=0;for(x=23877;x<=23884;x++)A[x]=0;for(x=23886;x<=23894;x++)A[x]=0;for(x=23946;x<=23948;x++)A[x]=0;for(x=24311;x<=24313;x++)A[x]=0;for(x=24342;x<=24347;x++)A[x]=0;for(x=24370;x<=24374;x++)A[x]=10;for(x=24375;x<=24381;x++)A[x]=0;for(x=24718;x<=24721;x++)A[x]=0;for(x=24817;x<=24821;x++)A[x]=0;for(x=24877;x<=24882;x++)A[x]=0;for(x=24891;x<=24893;x++)A[x]=0;for(x=25391;x<=25395;x++)A[x]=0;for(x=25828;x<=25838;x++)A[x]=0;for(x=26191;x<=26195;x++)A[x]=0;for(x=26391;x<=26393;x++)A[x]=0;for(x=26701;x<=26722;x++)A[x]=0;for(x=26729;x<=26799;x++)A[x]=2;for(x=26801;x<=26803;x++)A[x]=2;for(x=26811;x<=26813;x++)A[x]=2;for(x=26847;x<=26870;x++)A[x]=2;for(x=26891;x<=26899;x++)A[x]=0;for(x=26901;x<=26923;x++)A[x]=0;for(x=26929;x<=26946;x++)A[x]=0;for(x=26948;x<=26998;x++)A[x]=0;for(x=27037;x<=27040;x++)A[x]=0;for(x=27205;x<=27232;x++)A[x]=0;for(x=27258;x<=27260;x++)A[x]=0;for(x=27391;x<=27398;x++)A[x]=0;for(x=27561;x<=27564;x++)A[x]=0;for(x=27571;x<=27574;x++)A[x]=0;for(x=27581;x<=27584;x++)A[x]=0;for(x=27591;x<=27594;x++)A[x]=0;for(x=28191;x<=28193;x++)A[x]=0;for(x=28348;x<=28358;x++)A[x]=0;for(x=28402;x<=28432;x++)A[x]=0;for(x=28462;x<=28492;x++)A[x]=0;for(x=29118;x<=29122;x++)A[x]=0;for(x=29168;x<=29172;x++)A[x]=0;for(x=29177;x<=29185;x++)A[x]=0;for(x=29187;x<=29195;x++)A[x]=0;for(x=29900;x<=29903;x++)A[x]=0;for(x=30161;x<=30179;x++)A[x]=0;for(x=30491;x<=30494;x++)A[x]=0;for(x=30729;x<=30732;x++)A[x]=0;for(x=31251;x<=31259;x++)A[x]=0;for(x=31265;x<=31268;x++)A[x]=0;for(x=31275;x<=31279;x++)A[x]=0;for(x=31281;x<=31297;x++)A[x]=0;for(x=31461;x<=31469;x++)A[x]=0;for(x=31491;x<=31495;x++)A[x]=0;for(x=31917;x<=31922;x++)A[x]=0;for(x=31965;x<=32e3;x++)A[x]=0;for(x=32001;x<=32003;x++)A[x]=2;for(x=32005;x<=32031;x++)A[x]=2;for(x=32033;x<=32060;x++)A[x]=2;for(x=32064;x<=32067;x++)A[x]=2;for(x=32074;x<=32077;x++)A[x]=2;for(x=32081;x<=32086;x++)A[x]=0;for(x=32107;x<=32130;x++)A[x]=0;for(x=32133;x<=32158;x++)A[x]=0;for(x=32164;x<=32167;x++)A[x]=2;for(x=32180;x<=32199;x++)A[x]=0;for(x=32201;x<=32260;x++)A[x]=0;for(x=32301;x<=32360;x++)A[x]=0;for(x=32601;x<=32662;x++)A[x]=0;for(x=32664;x<=32667;x++)A[x]=2;for(x=32701;x<=32761;x++)A[x]=0;for(x=53001;x<=53004;x++)A[x]=0;for(x=53008;x<=53019;x++)A[x]=0;for(x=53021;x<=53032;x++)A[x]=0;for(x=53034;x<=53037;x++)A[x]=0;for(x=53042;x<=53046;x++)A[x]=0;for(x=53074;x<=53080;x++)A[x]=0;for(x=54001;x<=54004;x++)A[x]=0;for(x=54008;x<=54019;x++)A[x]=0;for(x=54021;x<=54032;x++)A[x]=0;for(x=54034;x<=54037;x++)A[x]=0;for(x=54042;x<=54046;x++)A[x]=0;for(x=54048;x<=54053;x++)A[x]=0;for(x=54074;x<=54080;x++)A[x]=0;for(x=54098;x<=54101;x++)A[x]=0;for(x=102001;x<=102040;x++)A[x]=0;for(x=102042;x<=102063;x++)A[x]=0;for(x=102065;x<=102067;x++)A[x]=0;for(x=102070;x<=102117;x++)A[x]=0;for(x=102122;x<=102216;x++)A[x]=0;for(x=102221;x<=102377;x++)A[x]=0;for(x=102382;x<=102388;x++)A[x]=0;for(x=102389;x<=102398;x++)A[x]=2;for(x=102399;x<=102444;x++)A[x]=0;for(x=102445;x<=102447;x++)A[x]=2;for(x=102448;x<=102458;x++)A[x]=0;for(x=102459;x<=102468;x++)A[x]=2;for(x=102469;x<=102499;x++)A[x]=0;for(x=102500;x<=102519;x++)A[x]=1;for(x=102520;x<=102524;x++)A[x]=0;for(x=102525;x<=102529;x++)A[x]=2;for(x=102530;x<=102588;x++)A[x]=0;for(x=102590;x<=102598;x++)A[x]=0;for(x=102601;x<=102603;x++)A[x]=0;for(x=102605;x<=102628;x++)A[x]=0;for(x=102629;x<=102646;x++)A[x]=2;for(x=102648;x<=102700;x++)A[x]=2;for(x=102701;x<=102703;x++)A[x]=0;for(x=102707;x<=102730;x++)A[x]=2;for(x=102733;x<=102758;x++)A[x]=2;for(x=102767;x<=102900;x++)A[x]=0;for(x=102901;x<=102933;x++)A[x]=2;for(x=102934;x<=102950;x++)A[x]=13;for(x=102951;x<=102955;x++)A[x]=0;for(x=102961;x<=102963;x++)A[x]=0;for(x=102965;x<=102969;x++)A[x]=0;for(x=102971;x<=102973;x++)A[x]=0;for(x=102975;x<=102989;x++)A[x]=0;for(x=102990;x<=102992;x++)A[x]=1;for(x=102997;x<=103002;x++)A[x]=0;for(x=103003;x<=103008;x++)A[x]=2;for(x=103009;x<=103011;x++)A[x]=0;for(x=103012;x<=103014;x++)A[x]=2;for(x=103019;x<=103021;x++)A[x]=0;for(x=103022;x<=103024;x++)A[x]=2;for(x=103029;x<=103031;x++)A[x]=0;for(x=103032;x<=103034;x++)A[x]=2;for(x=103065;x<=103068;x++)A[x]=0;for(x=103074;x<=103076;x++)A[x]=0;for(x=103077;x<=103079;x++)A[x]=1;for(x=103080;x<=103082;x++)A[x]=0;for(x=103083;x<=103085;x++)A[x]=2;for(x=103090;x<=103093;x++)A[x]=0;for(x=103097;x<=103099;x++)A[x]=0;for(x=103100;x<=103102;x++)A[x]=2;for(x=103107;x<=103109;x++)A[x]=0;for(x=103110;x<=103112;x++)A[x]=2;for(x=103113;x<=103116;x++)A[x]=0;for(x=103117;x<=103120;x++)A[x]=2;for(x=103153;x<=103157;x++)A[x]=0;for(x=103158;x<=103162;x++)A[x]=2;for(x=103163;x<=103165;x++)A[x]=0;for(x=103166;x<=103168;x++)A[x]=1;for(x=103169;x<=103171;x++)A[x]=2;for(x=103186;x<=103188;x++)A[x]=0;for(x=103189;x<=103191;x++)A[x]=2;for(x=103192;x<=103195;x++)A[x]=0;for(x=103196;x<=103199;x++)A[x]=2;for(x=103200;x<=103224;x++)A[x]=0;for(x=103225;x<=103227;x++)A[x]=1;for(x=103232;x<=103237;x++)A[x]=0;for(x=103238;x<=103243;x++)A[x]=2;for(x=103244;x<=103246;x++)A[x]=0;for(x=103247;x<=103249;x++)A[x]=2;for(x=103254;x<=103256;x++)A[x]=0;for(x=103257;x<=103259;x++)A[x]=2;for(x=103264;x<=103266;x++)A[x]=0;for(x=103267;x<=103269;x++)A[x]=2;for(x=103300;x<=103375;x++)A[x]=0;for(x=103381;x<=103383;x++)A[x]=0;for(x=103384;x<=103386;x++)A[x]=1;for(x=103387;x<=103389;x++)A[x]=0;for(x=103390;x<=103392;x++)A[x]=2;for(x=103397;x<=103399;x++)A[x]=0;for(x=103400;x<=103471;x++)A[x]=2;for(x=103476;x<=103478;x++)A[x]=0;for(x=103479;x<=103481;x++)A[x]=2;for(x=103486;x<=103488;x++)A[x]=0;for(x=103489;x<=103491;x++)A[x]=2;for(x=103492;x<=103495;x++)A[x]=0;for(x=103496;x<=103499;x++)A[x]=2;for(x=103528;x<=103543;x++)A[x]=0;for(x=103544;x<=103548;x++)A[x]=2;for(x=103549;x<=103551;x++)A[x]=0;for(x=103552;x<=103554;x++)A[x]=1;for(x=103555;x<=103557;x++)A[x]=2;for(x=103558;x<=103560;x++)A[x]=0;for(x=103571;x<=103573;x++)A[x]=0;for(x=103574;x<=103576;x++)A[x]=2;for(x=103577;x<=103580;x++)A[x]=0;for(x=103581;x<=103583;x++)A[x]=2;for(x=103595;x<=103694;x++)A[x]=0;for(x=103696;x<=103699;x++)A[x]=0;for(x=103700;x<=103793;x++)A[x]=2;for(x=103794;x<=103887;x++)A[x]=0;for(x=103900;x<=103971;x++)A[x]=2},5548:(dt,Re,T)=>{"use strict";T.d(Re,{BD:()=>ae,Cb:()=>U,G1:()=>ce,Gv:()=>Oe,HH:()=>W,JR:()=>Je,KE:()=>Me,TC:()=>Z,Tn:()=>me,Ue:()=>H,VK:()=>ie,Wi:()=>le,Ye:()=>X,Zp:()=>he,aO:()=>se,al:()=>re,bA:()=>ye,bd:()=>we,be:()=>$,bf:()=>j,cS:()=>Ie,cv:()=>ge,dp:()=>ne,fS:()=>We,kK:()=>pe,op:()=>Te,pp:()=>ue,r3:()=>_e,re:()=>Ne,sU:()=>Y,t8:()=>Ce,wp:()=>je,wz:()=>ee,xE:()=>$e,y8:()=>Ge});var x=T(62208),A=T(2004),G=T(65401);function H(Se=$e){return[Se[0],Se[1],Se[2],Se[3],Se[4],Se[5]]}function re(Se,De,Fe,ve,Ke,qe,be=H()){return be[0]=Se,be[1]=De,be[2]=Fe,be[3]=ve,be[4]=Ke,be[5]=qe,be}function W(Se,De){const Fe=isFinite(Se[2])||isFinite(Se[5]);return new A.Z(Fe?{xmin:Se[0],xmax:Se[3],ymin:Se[1],ymax:Se[4],zmin:Se[2],zmax:Se[5],spatialReference:De}:{xmin:Se[0],xmax:Se[3],ymin:Se[1],ymax:Se[4],spatialReference:De})}function Z(Se,De){Se[0]=Math.min(Se[0],De[0]),Se[1]=Math.min(Se[1],De[1]),Se[2]=Math.min(Se[2],De[2]),Se[3]=Math.max(Se[3],De[3]),Se[4]=Math.max(Se[4],De[4]),Se[5]=Math.max(Se[5],De[5])}function ie(Se,De){Se[0]=Math.min(Se[0],De[0]),Se[1]=Math.min(Se[1],De[1]),Se[3]=Math.max(Se[3],De[2]),Se[4]=Math.max(Se[4],De[3])}function ue(Se,De){Se[0]=Math.min(Se[0],De[0]),Se[1]=Math.min(Se[1],De[1]),Se[2]=Math.min(Se[2],De[2]),Se[3]=Math.max(Se[3],De[0]),Se[4]=Math.max(Se[4],De[1]),Se[5]=Math.max(Se[5],De[2])}function ce(Se,De,Fe=0,ve=De.length/3){let Ke=Se[0],qe=Se[1],be=Se[2],tt=Se[3],Ye=Se[4],ze=Se[5];for(let et=0;et<ve;et++)Ke=Math.min(Ke,De[Fe+3*et]),qe=Math.min(qe,De[Fe+3*et+1]),be=Math.min(be,De[Fe+3*et+2]),tt=Math.max(tt,De[Fe+3*et]),Ye=Math.max(Ye,De[Fe+3*et+1]),ze=Math.max(ze,De[Fe+3*et+2]);Se[0]=Ke,Se[1]=qe,Se[2]=be,Se[3]=tt,Se[4]=Ye,Se[5]=ze}function le(Se,De,Fe){const ve=De.length;let Ke=Se[0],qe=Se[1],be=Se[2],tt=Se[3],Ye=Se[4],ze=Se[5];if(Fe)for(let et=0;et<ve;et++){const ke=De[et];Ke=Math.min(Ke,ke[0]),qe=Math.min(qe,ke[1]),be=Math.min(be,ke[2]),tt=Math.max(tt,ke[0]),Ye=Math.max(Ye,ke[1]),ze=Math.max(ze,ke[2])}else for(let et=0;et<ve;et++){const ke=De[et];Ke=Math.min(Ke,ke[0]),qe=Math.min(qe,ke[1]),tt=Math.max(tt,ke[0]),Ye=Math.max(Ye,ke[1])}Se[0]=Ke,Se[1]=qe,Se[2]=be,Se[3]=tt,Se[4]=Ye,Se[5]=ze}function Y(Se){for(let De=0;De<6;De++)if(!isFinite(Se[De]))return!1;return!0}function j(Se){return Se[0]>=Se[3]?0:Se[3]-Se[0]}function X(Se){return Se[1]>=Se[4]?0:Se[4]-Se[1]}function U(Se){return Se[2]>=Se[5]?0:Se[5]-Se[2]}function ee(Se){const De=j(Se),Fe=U(Se),ve=X(Se);return Math.sqrt(De*De+Fe*Fe+ve*ve)}function $(Se,De=[0,0,0]){return De[0]=Se[0]+j(Se)/2,De[1]=Se[1]+X(Se)/2,De[2]=Se[2]+U(Se)/2,De}function ne(Se,De=[0,0,0]){return De[0]=j(Se),De[1]=X(Se),De[2]=U(Se),De}function se(Se){return Math.max(j(Se),U(Se),X(Se))}function ae(Se,De){return De[0]>=Se[0]&&De[1]>=Se[1]&&De[2]>=Se[2]&&De[0]<=Se[3]&&De[1]<=Se[4]&&De[2]<=Se[5]}function _e(Se,De){return De[0]>=Se[0]&&De[1]>=Se[1]&&De[2]>=Se[2]&&De[3]<=Se[3]&&De[4]<=Se[4]&&De[5]<=Se[5]}function pe(Se,De){return Math.max(De[0],Se[0])<=Math.min(De[3],Se[3])&&Math.max(De[1],Se[1])<=Math.min(De[4],Se[4])&&Math.max(De[2],Se[2])<=Math.min(De[5],Se[5])}function he(Se,De){return!!(0,x.Wi)(De)||pe(Se,De)}function ge(Se,De,Fe,ve,Ke=Se){return Ke[0]=Se[0]+De,Ke[1]=Se[1]+Fe,Ke[2]=Se[2]+ve,Ke[3]=Se[3]+De,Ke[4]=Se[4]+Fe,Ke[5]=Se[5]+ve,Ke}function ye(Se,De,Fe=Se){const ve=Se[0]+j(Se)/2,Ke=Se[1]+X(Se)/2,qe=Se[2]+U(Se)/2;return Fe[0]=ve+(Se[0]-ve)*De,Fe[1]=Ke+(Se[1]-Ke)*De,Fe[2]=qe+(Se[2]-qe)*De,Fe[3]=ve+(Se[3]-ve)*De,Fe[4]=Ke+(Se[4]-Ke)*De,Fe[5]=qe+(Se[5]-qe)*De,Fe}function Me(Se,De){return De[0]=Se[0],De[1]=Se[1],De[2]=Se[2],De}function Te(Se,De,Fe=Se){return Fe[0]=De[0],Fe[1]=De[1],Fe[2]=De[2],Fe!==Se&&(Fe[3]=Se[3],Fe[4]=Se[4],Fe[5]=Se[5]),Fe}function me(Se,De,Fe=Se){return Fe[3]=De[0],Fe[4]=De[1],Fe[5]=De[2],Fe!==Se&&(Fe[0]=Se[0],Fe[1]=Se[1],Fe[2]=Se[2]),Se}function Ce(Se,De){return Se[0]=De[0],Se[1]=De[1],Se[2]=De[2],Se[3]=De[3],Se[4]=De[4],Se[5]=De[5],Se}function Ie(Se){return Se?Ce(Se,Oe):H(Oe)}function Ge(Se,De){return De||(De=(0,G.Ue)()),De[0]=Se[0],De[1]=Se[1],De[2]=Se[3],De[3]=Se[4],De}function Je(Se,De){return Se[0]=De[0],Se[1]=De[1],Se[2]=Number.NEGATIVE_INFINITY,Se[3]=De[2],Se[4]=De[3],Se[5]=Number.POSITIVE_INFINITY,Se}function xe(Se){return 6===Se.length}function je(Se){return 0===j(Se)&&0===X(Se)&&0===U(Se)}function We(Se,De,Fe){if((0,x.Wi)(Se)||(0,x.Wi)(De))return Se===De;if(!xe(Se)||!xe(De))return!1;if(Fe){for(let ve=0;ve<Se.length;ve++)if(!Fe(Se[ve],De[ve]))return!1}else for(let ve=0;ve<Se.length;ve++)if(Se[ve]!==De[ve])return!1;return!0}function Ne(Se,De,Fe,ve,Ke,qe){return re(Se,De,Fe,ve,Ke,qe,Be)}const we=[-1/0,-1/0,-1/0,1/0,1/0,1/0],Oe=[1/0,1/0,1/0,-1/0,-1/0,-1/0],$e=[0,0,0,0,0,0],Be=H()},65401:(dt,Re,T)=>{"use strict";T.d(Re,{BD:()=>ee,Cb:()=>j,Gv:()=>We,HH:()=>ie,Ho:()=>ue,I7:()=>ne,JG:()=>W,OC:()=>de,Qn:()=>se,SO:()=>X,TE:()=>ye,Ue:()=>re,Wi:()=>oe,Zm:()=>_e,al:()=>B,bd:()=>je,be:()=>U,bf:()=>Y,cS:()=>Ie,cv:()=>Ee,d9:()=>J,fS:()=>xe,hr:()=>$,jE:()=>ae,jV:()=>ge,jn:()=>ce,kK:()=>pe,oJ:()=>Z,r3:()=>he,sU:()=>le,wp:()=>Je}),T(8314);var A=T(21286),G=T(62208),Q=T(2004);function re(Oe=Ne){return[Oe[0],Oe[1],Oe[2],Oe[3]]}function J(Oe){return[Oe[0],Oe[1],Oe[2],Oe[3]]}function W(Oe,$e){return Oe!==$e&&(Oe[0]=$e[0],Oe[1]=$e[1],Oe[2]=$e[2],Oe[3]=$e[3]),Oe}function B(Oe,$e,Be,Se,De=re()){return De[0]=Oe,De[1]=$e,De[2]=Be,De[3]=Se,De}function Z(Oe,$e=re()){return $e[0]=Oe.xmin,$e[1]=Oe.ymin,$e[2]=Oe.xmax,$e[3]=Oe.ymax,$e}function ie(Oe,$e){return new Q.Z({xmin:Oe[0],ymin:Oe[1],xmax:Oe[2],ymax:Oe[3],spatialReference:$e})}function ue(Oe,$e){$e[0]<Oe[0]&&(Oe[0]=$e[0]),$e[0]>Oe[2]&&(Oe[2]=$e[0]),$e[1]<Oe[1]&&(Oe[1]=$e[1]),$e[1]>Oe[3]&&(Oe[3]=$e[1])}function ce(Oe,$e,Be){if((0,G.Wi)($e))W(Be,Oe);else if("length"in $e)Ge($e)?(Be[0]=Math.min(Oe[0],$e[0]),Be[1]=Math.min(Oe[1],$e[1]),Be[2]=Math.max(Oe[2],$e[2]),Be[3]=Math.max(Oe[3],$e[3])):2!==$e.length&&3!==$e.length||(Be[0]=Math.min(Oe[0],$e[0]),Be[1]=Math.min(Oe[1],$e[1]),Be[2]=Math.max(Oe[2],$e[0]),Be[3]=Math.max(Oe[3],$e[1]));else switch($e.type){case"extent":Be[0]=Math.min(Oe[0],$e.xmin),Be[1]=Math.min(Oe[1],$e.ymin),Be[2]=Math.max(Oe[2],$e.xmax),Be[3]=Math.max(Oe[3],$e.ymax);break;case"point":Be[0]=Math.min(Oe[0],$e.x),Be[1]=Math.min(Oe[1],$e.y),Be[2]=Math.max(Oe[2],$e.x),Be[3]=Math.max(Oe[3],$e.y)}}function oe(Oe,$e,Be=Oe){const Se=$e.length;let De=Oe[0],Fe=Oe[1],ve=Oe[2],Ke=Oe[3];for(let qe=0;qe<Se;qe++){const be=$e[qe];De=Math.min(De,be[0]),Fe=Math.min(Fe,be[1]),ve=Math.max(ve,be[0]),Ke=Math.max(Ke,be[1])}return Be[0]=De,Be[1]=Fe,Be[2]=ve,Be[3]=Ke,Be}function le(Oe){for(let $e=0;$e<4;$e++)if(!isFinite(Oe[$e]))return!1;return!0}function Y(Oe){return(0,G.Wi)(Oe)||Oe[0]>=Oe[2]?0:Oe[2]-Oe[0]}function j(Oe){return Oe[1]>=Oe[3]?0:Oe[3]-Oe[1]}function X(Oe){return Y(Oe)*j(Oe)}function U(Oe,$e=[0,0]){return $e[0]=(Oe[0]+Oe[2])/2,$e[1]=(Oe[1]+Oe[3])/2,$e}function ee(Oe,$e){return ae(Oe,$e[0],$e[1])}function $(Oe,$e){const Be=$e[3],De=Math.abs($e[0]-.5*(Oe[0]+Oe[2])),Fe=.5*(Oe[2]-Oe[0]);if(De>Be+Fe)return!1;const Ke=.5*(Oe[3]-Oe[1]),qe=Math.abs($e[1]-.5*(Oe[1]+Oe[3]));if(qe>Be+Ke)return!1;if(De<Fe||qe<Ke)return!0;const be=De-Fe,tt=qe-Ke;return be*be+tt*tt<=Be*Be}function ne(Oe,$e,Be){const Se=Oe[0],De=Oe[1],Fe=Oe[2],ve=Oe[3],{x:Ke,y:qe}=$e,{x:be,y:tt}=Be,Ye=(at,yt)=>(tt-qe)*at+(Ke-be)*yt+(be*qe-Ke*tt)<0,ze=Ye(Se,ve),et=Ye(Fe,ve),ke=Ye(Fe,De),ot=Ye(Se,De);return!(ze===et&&et===ke&&ke===ot&&ot===ze||Ke<Se&&be<Se||Ke>Fe&&be>Fe||qe>ve&&tt>ve||qe<De&&tt<De)}function se(Oe,$e){return ae(Oe,$e.x,$e.y)}function ae(Oe,$e,Be){return $e>=Oe[0]&&Be>=Oe[1]&&$e<=Oe[2]&&Be<=Oe[3]}function de(Oe,$e,Be,Se){return $e>=Oe[0]-Se&&Be>=Oe[1]-Se&&$e<=Oe[2]+Se&&Be<=Oe[3]+Se}function _e(Oe,$e,Be){return $e[0]>=Oe[0]-Be&&$e[1]>=Oe[1]-Be&&$e[0]<=Oe[2]+Be&&$e[1]<=Oe[3]+Be}function pe(Oe,$e){return Math.max($e[0],Oe[0])<=Math.min($e[2],Oe[2])&&Math.max($e[1],Oe[1])<=Math.min($e[3],Oe[3])}function he(Oe,$e){return $e[0]>=Oe[0]&&$e[2]<=Oe[2]&&$e[1]>=Oe[1]&&$e[3]<=Oe[3]}function ge(Oe,$e,Be){if((0,G.Wi)($e))return W(Be,Oe);const Se=$e[0],De=$e[1],Fe=$e[2],ve=$e[3];return Be[0]=(0,A.uZ)(Oe[0],Se,Fe),Be[1]=(0,A.uZ)(Oe[1],De,ve),Be[2]=(0,A.uZ)(Oe[2],Se,Fe),Be[3]=(0,A.uZ)(Oe[3],De,ve),Be}function ye(Oe,$e){const Se=(Oe[1]+Oe[3])/2,De=Math.max(Math.abs($e[0]-(Oe[0]+Oe[2])/2)-Y(Oe)/2,0),Fe=Math.max(Math.abs($e[1]-Se)-j(Oe)/2,0);return Math.sqrt(De*De+Fe*Fe)}function Ee(Oe,$e,Be,Se=Oe){return Se[0]=Oe[0]+$e,Se[1]=Oe[1]+Be,Se[2]=Oe[2]+$e,Se[3]=Oe[3]+Be,Se}function Ie(Oe){return Oe?W(Oe,We):re(We)}function Ge(Oe){return null!=Oe&&4===Oe.length}function Je(Oe){return!(0!==Y(Oe)&&isFinite(Oe[0])||0!==j(Oe)&&isFinite(Oe[1]))}function xe(Oe,$e){return Ge(Oe)&&Ge($e)?Oe[0]===$e[0]&&Oe[1]===$e[1]&&Oe[2]===$e[2]&&Oe[3]===$e[3]:Oe===$e}const je=[-1/0,-1/0,1/0,1/0],We=[1/0,1/0,-1/0,-1/0],Ne=[0,0,0,0]},32442:(dt,Re,T)=>{"use strict";function x(Y){return void 0!==Y.xmin&&void 0!==Y.ymin&&void 0!==Y.xmax&&void 0!==Y.ymax}function A(Y){return void 0!==Y.points}function G(Y){return void 0!==Y.x&&void 0!==Y.y}function Q(Y){return void 0!==Y.paths}function H(Y){return void 0!==Y.rings}function re(Y){return(j,X)=>null==j?X:null==X?j:Y(j,X)}T.d(Re,{$P:()=>B,C6:()=>ie,Yg:()=>Z,lC:()=>ce});const J=re(Math.min),W=re(Math.max);function B(Y,j){return Q(j)?ie(Y,j.paths,!1,!1):H(j)?ie(Y,j.rings,!1,!1):A(j)?ce(Y,j.points,!1,!1,!1,!1):x(j)?ue(Y,j):(G(j)&&(Y[0]=j.x,Y[1]=j.y,Y[2]=j.x,Y[3]=j.y),Y)}function Z(Y,j){return Q(j)?ie(Y,j.paths,!0,!1):H(j)?ie(Y,j.rings,!0,!1):A(j)?ce(Y,j.points,!0,!1,!0,!1):x(j)?ue(Y,j,0,0,!0,!1):(G(j)&&(Y[0]=j.x,Y[1]=j.y,Y[2]=j.z,Y[3]=j.x,Y[4]=j.y,Y[5]=j.z),Y)}function ie(Y,j,X,U){const ee=X?3:2;if(!j.length||!j[0].length)return null;let $,ne,se,ae,[de,_e]=j[0][0],[pe,he]=j[0][0];for(let ge=0;ge<j.length;ge++){const ye=j[ge];for(let Me=0;Me<ye.length;Me++){const Ee=ye[Me],[Te,me]=Ee;if(de=J(de,Te),_e=J(_e,me),pe=W(pe,Te),he=W(he,me),X&&Ee.length>2){const Ce=Ee[2];$=J($,Ce),ne=W(ne,Ce)}if(U&&Ee.length>ee){const Ce=Ee[ee];se=J($,Ce),ae=W(ne,Ce)}}}return X?U?(Y[0]=de,Y[1]=_e,Y[2]=$,Y[3]=se,Y[4]=pe,Y[5]=he,Y[6]=ne,Y[7]=ae,Y.length=8,Y):(Y[0]=de,Y[1]=_e,Y[2]=$,Y[3]=pe,Y[4]=he,Y[5]=ne,Y.length=6,Y):U?(Y[0]=de,Y[1]=_e,Y[2]=se,Y[3]=pe,Y[4]=he,Y[5]=ae,Y.length=6,Y):(Y[0]=de,Y[1]=_e,Y[2]=pe,Y[3]=he,Y.length=4,Y)}function ue(Y,j,X,U,ee,$){const ne=j.xmin,se=j.xmax,ae=j.ymin,de=j.ymax;let _e=j.zmin,pe=j.zmax,he=j.mmin,ge=j.mmax;return ee?(_e=_e||0,pe=pe||0,$?(he=he||0,ge=ge||0,Y[0]=ne,Y[1]=ae,Y[2]=_e,Y[3]=he,Y[4]=se,Y[5]=de,Y[6]=pe,Y[7]=ge,Y):(Y[0]=ne,Y[1]=ae,Y[2]=_e,Y[3]=se,Y[4]=de,Y[5]=pe,Y)):$?(he=he||0,ge=ge||0,Y[0]=ne,Y[1]=ae,Y[2]=he,Y[3]=se,Y[4]=de,Y[5]=ge,Y):(Y[0]=ne,Y[1]=ae,Y[2]=se,Y[3]=de,Y)}function ce(Y,j,X,U,ee,$){const ne=X?3:2,se=U&&$,ae=X&&ee;if(!j.length||!j[0].length)return null;let de,_e,pe,he,[ge,ye]=j[0],[Me,Ee]=j[0];for(let Te=0;Te<j.length;Te++){const me=j[Te],[Ce,Ie]=me;if(ge=J(ge,Ce),ye=J(ye,Ie),Me=W(Me,Ce),Ee=W(Ee,Ie),ae&&me.length>2){const Ge=me[2];de=J(de,Ge),_e=W(_e,Ge)}if(se&&me.length>ne){const Ge=me[ne];pe=J(de,Ge),he=W(_e,Ge)}}return ee?(de=de||0,_e=_e||0,$?(pe=pe||0,he=he||0,Y[0]=ge,Y[1]=ye,Y[2]=de,Y[3]=pe,Y[4]=Me,Y[5]=Ee,Y[6]=_e,Y[7]=he,Y):(Y[0]=ge,Y[1]=ye,Y[2]=de,Y[3]=Me,Y[4]=Ee,Y[5]=_e,Y)):$?(pe=pe||0,he=he||0,Y[0]=ge,Y[1]=ye,Y[2]=pe,Y[3]=Me,Y[4]=Ee,Y[5]=he,Y):(Y[0]=ge,Y[1]=ye,Y[2]=Me,Y[3]=Ee,Y)}},60479:(dt,Re,T)=>{"use strict";T.d(Re,{ly:()=>Z,oS:()=>X,o7:()=>Je,Jj:()=>Ne,Hz:()=>me,gK:()=>oe,ey:()=>le,bj:()=>Y,O1:()=>j,av:()=>_e,Nu:()=>ye,D_:()=>ne,Eu:()=>ie,q6:()=>U,or:()=>xe,wA:()=>we,Vs:()=>Ce,TS:()=>pe,qt:()=>Me,xA:()=>se,ct:()=>ue,fP:()=>ee,n1:()=>je,PP:()=>Oe,P_:()=>Ie,mw:()=>he,G5:()=>Ee,ne:()=>ae,ek:()=>ce,Cd:()=>$,zO:()=>We,TN:()=>$e,ir:()=>Ge,v6:()=>ge,hu:()=>Te,mc:()=>de});let x=(()=>{class Be{constructor(De,Fe,ve=0,Ke,qe){this.TypedArrayConstructor=De,this.elementCount=9;const be=this.TypedArrayConstructor;void 0===Ke&&(Ke=9*be.BYTES_PER_ELEMENT);const tt=0===Fe.byteLength?0:ve;this.typedBuffer=null==qe?new be(Fe,tt):new be(Fe,tt,(qe-ve)/be.BYTES_PER_ELEMENT),this.typedBufferStride=Ke/be.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(De,Fe,ve=this.count-Fe){const Ke=this.typedBuffer.byteOffset+Fe*this.stride;return new De(this.buffer,Ke,this.stride,Ke+ve*this.stride)}getMat(De,Fe){let ve=De*this.typedBufferStride;for(let Ke=0;Ke<9;Ke++)Fe[Ke]=this.typedBuffer[ve++];return Fe}setMat(De,Fe){let ve=De*this.typedBufferStride;for(let Ke=0;Ke<9;Ke++)this.typedBuffer[ve++]=Fe[Ke]}get(De,Fe){return this.typedBuffer[De*this.typedBufferStride+Fe]}set(De,Fe,ve){this.typedBuffer[De*this.typedBufferStride+Fe]=ve}copyFrom(De,Fe,ve){const Ke=this.typedBuffer,qe=Fe.typedBuffer;let be=De*this.typedBufferStride,tt=ve*Fe.typedBufferStride;for(let Ye=0;Ye<9;++Ye)Ke[be++]=qe[tt++]}get buffer(){return this.typedBuffer.buffer}}return Be.ElementCount=9,Be})(),A=(()=>{class Be{constructor(De,Fe,ve=0,Ke,qe){this.TypedArrayConstructor=De,this.elementCount=16;const be=this.TypedArrayConstructor;void 0===Ke&&(Ke=16*be.BYTES_PER_ELEMENT);const tt=0===Fe.byteLength?0:ve;this.typedBuffer=null==qe?new be(Fe,tt):new be(Fe,tt,(qe-ve)/be.BYTES_PER_ELEMENT),this.typedBufferStride=Ke/be.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(De,Fe,ve=this.count-Fe){const Ke=this.typedBuffer.byteOffset+Fe*this.stride;return new De(this.buffer,Ke,this.stride,Ke+ve*this.stride)}getMat(De,Fe){let ve=De*this.typedBufferStride;for(let Ke=0;Ke<16;Ke++)Fe[Ke]=this.typedBuffer[ve++];return Fe}setMat(De,Fe){let ve=De*this.typedBufferStride;for(let Ke=0;Ke<16;Ke++)this.typedBuffer[ve++]=Fe[Ke]}get(De,Fe){return this.typedBuffer[De*this.typedBufferStride+Fe]}set(De,Fe,ve){this.typedBuffer[De*this.typedBufferStride+Fe]=ve}copyFrom(De,Fe,ve){const Ke=this.typedBuffer,qe=Fe.typedBuffer;let be=De*this.typedBufferStride,tt=ve*Fe.typedBufferStride;for(let Ye=0;Ye<16;++Ye)Ke[be++]=qe[tt++]}get buffer(){return this.typedBuffer.buffer}}return Be.ElementCount=16,Be})(),G=(()=>{class Be{constructor(De,Fe,ve=0,Ke,qe){this.TypedArrayConstructor=De,this.elementCount=1;const be=this.TypedArrayConstructor;void 0===Ke&&(Ke=be.BYTES_PER_ELEMENT);const tt=0===Fe.byteLength?0:ve;this.typedBuffer=null==qe?new be(Fe,tt):new be(Fe,tt,(qe-ve)/be.BYTES_PER_ELEMENT),this.typedBufferStride=Ke/be.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(De,Fe,ve=this.count-Fe){const Ke=this.typedBuffer.byteOffset+Fe*this.stride;return new De(this.buffer,Ke,this.stride,Ke+ve*this.stride)}get(De){return this.typedBuffer[De*this.typedBufferStride]}set(De,Fe){this.typedBuffer[De*this.typedBufferStride]=Fe}get buffer(){return this.typedBuffer.buffer}}return Be.ElementCount=1,Be})();var Q=T(67831);let H=(()=>{class Be{constructor(De,Fe,ve=0,Ke,qe){this.TypedArrayConstructor=De,this.elementCount=2;const be=this.TypedArrayConstructor;void 0===Ke&&(Ke=2*be.BYTES_PER_ELEMENT);const tt=0===Fe.byteLength?0:ve;this.typedBuffer=null==qe?new be(Fe,tt):new be(Fe,tt,(qe-ve)/be.BYTES_PER_ELEMENT),this.typedBufferStride=Ke/be.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(De,Fe,ve=this.count-Fe){const Ke=this.typedBuffer.byteOffset+Fe*this.stride;return new De(this.buffer,Ke,this.stride,Ke+ve*this.stride)}getVec(De,Fe){return(0,Q.a)(Fe,this.typedBuffer[De*=this.typedBufferStride],this.typedBuffer[De+1])}setVec(De,Fe){De*=this.typedBufferStride,this.typedBuffer[De++]=Fe[0],this.typedBuffer[De]=Fe[1]}get(De,Fe){return this.typedBuffer[De*this.typedBufferStride+Fe]}set(De,Fe,ve){this.typedBuffer[De*this.typedBufferStride+Fe]=ve}setValues(De,Fe,ve){De*=this.typedBufferStride,this.typedBuffer[De++]=Fe,this.typedBuffer[De]=ve}copyFrom(De,Fe,ve){const Ke=this.typedBuffer,qe=Fe.typedBuffer;let be=De*this.typedBufferStride,tt=ve*Fe.typedBufferStride;Ke[be++]=qe[tt++],Ke[be]=qe[tt]}get buffer(){return this.typedBuffer.buffer}}return Be.ElementCount=2,Be})();var re=T(84161);let J=(()=>{class Be{constructor(De,Fe,ve=0,Ke,qe){this.TypedArrayConstructor=De,this.elementCount=3;const be=this.TypedArrayConstructor;void 0===Ke&&(Ke=3*be.BYTES_PER_ELEMENT);const tt=0===Fe.byteLength?0:ve;this.typedBuffer=null==qe?new be(Fe,tt):new be(Fe,tt,(qe-ve)/be.BYTES_PER_ELEMENT),this.typedBufferStride=Ke/be.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(De,Fe,ve=this.count-Fe){const Ke=this.typedBuffer.byteOffset+Fe*this.stride;return new De(this.buffer,Ke,this.stride,Ke+ve*this.stride)}getVec(De,Fe){return(0,re.s)(Fe,this.typedBuffer[De*=this.typedBufferStride],this.typedBuffer[De+1],this.typedBuffer[De+2])}setVec(De,Fe){De*=this.typedBufferStride,this.typedBuffer[De++]=Fe[0],this.typedBuffer[De++]=Fe[1],this.typedBuffer[De]=Fe[2]}get(De,Fe){return this.typedBuffer[De*this.typedBufferStride+Fe]}set(De,Fe,ve){this.typedBuffer[De*this.typedBufferStride+Fe]=ve}setValues(De,Fe,ve,Ke){De*=this.typedBufferStride,this.typedBuffer[De++]=Fe,this.typedBuffer[De++]=ve,this.typedBuffer[De]=Ke}copyFrom(De,Fe,ve){const Ke=this.typedBuffer,qe=Fe.typedBuffer;let be=De*this.typedBufferStride,tt=ve*Fe.typedBufferStride;Ke[be++]=qe[tt++],Ke[be++]=qe[tt++],Ke[be]=qe[tt]}get buffer(){return this.typedBuffer.buffer}}return Be.ElementCount=3,Be})();var W=T(993);let B=(()=>{class Be{constructor(De,Fe,ve=0,Ke,qe){this.TypedArrayConstructor=De,this.elementCount=4;const be=this.TypedArrayConstructor;void 0===Ke&&(Ke=4*be.BYTES_PER_ELEMENT);const tt=0===Fe.byteLength?0:ve;this.typedBuffer=null==qe?new be(Fe,tt):new be(Fe,tt,(qe-ve)/be.BYTES_PER_ELEMENT),this.typedBufferStride=Ke/be.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(De,Fe,ve=this.count-Fe){const Ke=this.typedBuffer.byteOffset+Fe*this.stride;return new De(this.buffer,Ke,this.stride,Ke+ve*this.stride)}getVec(De,Fe){return De*=this.typedBufferStride,(0,W.s)(Fe,this.typedBuffer[De++],this.typedBuffer[De++],this.typedBuffer[De++],this.typedBuffer[De])}setVec(De,Fe){De*=this.typedBufferStride,this.typedBuffer[De++]=Fe[0],this.typedBuffer[De++]=Fe[1],this.typedBuffer[De++]=Fe[2],this.typedBuffer[De]=Fe[3]}get(De,Fe){return this.typedBuffer[De*this.typedBufferStride+Fe]}set(De,Fe,ve){this.typedBuffer[De*this.typedBufferStride+Fe]=ve}setValues(De,Fe,ve,Ke,qe){De*=this.typedBufferStride,this.typedBuffer[De++]=Fe,this.typedBuffer[De++]=ve,this.typedBuffer[De++]=Ke,this.typedBuffer[De]=qe}copyFrom(De,Fe,ve){const Ke=this.typedBuffer,qe=Fe.typedBuffer;let be=De*this.typedBufferStride,tt=ve*Fe.typedBufferStride;Ke[be++]=qe[tt++],Ke[be++]=qe[tt++],Ke[be++]=qe[tt++],Ke[be]=qe[tt]}get buffer(){return this.typedBuffer.buffer}}return Be.ElementCount=4,Be})(),Z=(()=>{class Be extends G{constructor(De,Fe=0,ve,Ke){super(Float32Array,De,Fe,ve,Ke),this.elementType="f32"}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f32",Be})(),ie=(()=>{class Be extends H{constructor(De,Fe=0,ve,Ke){super(Float32Array,De,Fe,ve,Ke),this.elementType="f32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f32",Be})(),ue=(()=>{class Be extends J{constructor(De,Fe=0,ve,Ke){super(Float32Array,De,Fe,ve,Ke),this.elementType="f32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f32",Be})(),ce=(()=>{class Be extends B{constructor(De,Fe=0,ve,Ke){super(Float32Array,De,Fe,ve,Ke),this.elementType="f32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f32",Be})(),oe=(()=>{class Be extends x{constructor(De,Fe=0,ve,Ke){super(Float32Array,De,Fe,ve,Ke),this.elementType="f32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f32",Be})(),le=(()=>{class Be extends x{constructor(De,Fe=0,ve,Ke){super(Float64Array,De,Fe,ve,Ke),this.elementType="f64"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f64",Be})(),Y=(()=>{class Be extends A{constructor(De,Fe=0,ve,Ke){super(Float32Array,De,Fe,ve,Ke),this.elementType="f32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f32",Be})(),j=(()=>{class Be extends A{constructor(De,Fe=0,ve,Ke){super(Float64Array,De,Fe,ve,Ke),this.elementType="f64"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f64",Be})(),X=(()=>{class Be extends G{constructor(De,Fe=0,ve,Ke){super(Float64Array,De,Fe,ve,Ke),this.elementType="f64"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f64",Be})(),U=(()=>{class Be extends H{constructor(De,Fe=0,ve,Ke){super(Float64Array,De,Fe,ve,Ke),this.elementType="f64"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f64",Be})(),ee=(()=>{class Be extends J{constructor(De,Fe=0,ve,Ke){super(Float64Array,De,Fe,ve,Ke),this.elementType="f64"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f64",Be})(),$=(()=>{class Be extends B{constructor(De,Fe=0,ve,Ke){super(Float64Array,De,Fe,ve,Ke),this.elementType="f64"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="f64",Be})(),ne=(()=>{class Be extends G{constructor(De,Fe=0,ve,Ke){super(Uint8Array,De,Fe,ve,Ke),this.elementType="u8"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u8",Be})(),se=(()=>{class Be extends H{constructor(De,Fe=0,ve,Ke){super(Uint8Array,De,Fe,ve,Ke),this.elementType="u8"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u8",Be})(),ae=(()=>{class Be extends J{constructor(De,Fe=0,ve,Ke){super(Uint8Array,De,Fe,ve,Ke),this.elementType="u8"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u8",Be})(),de=(()=>{class Be extends B{constructor(De,Fe=0,ve,Ke){super(Uint8Array,De,Fe,ve,Ke),this.elementType="u8"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u8",Be})(),_e=(()=>{class Be extends G{constructor(De,Fe=0,ve,Ke){super(Uint16Array,De,Fe,ve,Ke),this.elementType="u16"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u16",Be})(),pe=(()=>{class Be extends H{constructor(De,Fe=0,ve,Ke){super(Uint16Array,De,Fe,ve,Ke),this.elementType="u16"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u16",Be})(),he=(()=>{class Be extends J{constructor(De,Fe=0,ve,Ke){super(Uint16Array,De,Fe,ve,Ke),this.elementType="u16"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u16",Be})(),ge=(()=>{class Be extends B{constructor(De,Fe=0,ve,Ke){super(Uint16Array,De,Fe,ve,Ke),this.elementType="u16"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u16",Be})(),ye=(()=>{class Be extends G{constructor(De,Fe=0,ve,Ke){super(Uint32Array,De,Fe,ve,Ke),this.elementType="u32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u32",Be})(),Me=(()=>{class Be extends H{constructor(De,Fe=0,ve,Ke){super(Uint32Array,De,Fe,ve,Ke),this.elementType="u32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u32",Be})(),Ee=(()=>{class Be extends J{constructor(De,Fe=0,ve,Ke){super(Uint32Array,De,Fe,ve,Ke),this.elementType="u32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u32",Be})(),Te=(()=>{class Be extends B{constructor(De,Fe=0,ve,Ke){super(Uint32Array,De,Fe,ve,Ke),this.elementType="u32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="u32",Be})(),me=(()=>{class Be extends G{constructor(De,Fe=0,ve,Ke){super(Int8Array,De,Fe,ve,Ke),this.elementType="i8"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i8",Be})(),Ce=(()=>{class Be extends H{constructor(De,Fe=0,ve,Ke){super(Int8Array,De,Fe,ve,Ke),this.elementType="i8"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i8",Be})(),Ie=(()=>{class Be extends J{constructor(De,Fe=0,ve,Ke){super(Int8Array,De,Fe,ve,Ke),this.elementType="i8"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i8",Be})(),Ge=(()=>{class Be extends B{constructor(De,Fe=0,ve,Ke){super(Int8Array,De,Fe,ve,Ke),this.elementType="i8"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i8",Be})(),Je=(()=>{class Be extends G{constructor(De,Fe=0,ve,Ke){super(Int16Array,De,Fe,ve,Ke),this.elementType="i16"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i16",Be})(),xe=(()=>{class Be extends H{constructor(De,Fe=0,ve,Ke){super(Int16Array,De,Fe,ve,Ke),this.elementType="i16"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i16",Be})(),je=(()=>{class Be extends J{constructor(De,Fe=0,ve,Ke){super(Int16Array,De,Fe,ve,Ke),this.elementType="i16"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i16",Be})(),We=(()=>{class Be extends B{constructor(De,Fe=0,ve,Ke){super(Int16Array,De,Fe,ve,Ke),this.elementType="i16"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i16",Be})(),Ne=(()=>{class Be extends G{constructor(De,Fe=0,ve,Ke){super(Int32Array,De,Fe,ve,Ke),this.elementType="i32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i32",Be})(),we=(()=>{class Be extends H{constructor(De,Fe=0,ve,Ke){super(Int32Array,De,Fe,ve,Ke),this.elementType="i32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i32",Be})(),Oe=(()=>{class Be extends J{constructor(De,Fe=0,ve,Ke){super(Int32Array,De,Fe,ve,Ke),this.elementType="i32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i32",Be})(),$e=(()=>{class Be extends B{constructor(De,Fe=0,ve,Ke){super(Int32Array,De,Fe,ve,Ke),this.elementType="i32"}slice(De,Fe){return this.sliceBuffer(Be,De,Fe)}static fromTypedArray(De,Fe){return new Be(De.buffer,De.byteOffset,Fe,De.byteOffset+De.byteLength)}}return Be.ElementType="i32",Be})()},96286:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>A});const A=T(63290).Z.getLogger("esri.views.3d.support.buffer.math")},81096:(dt,Re,T)=>{"use strict";function A(re){switch(re){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8;default:return}}function G(re){switch(re){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f32":case"f64":return!0;default:return}}function Q(re){switch(re){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f32":case"f64":return!1;default:return}}function H(re){switch(re){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f32":return 3402823e32;case"f64":return 179769e303;default:return}}T.d(Re,{B3:()=>G,Op:()=>H,U:()=>Q,n1:()=>A}),T(8314)},60490:(dt,Re,T)=>{"use strict";T.d(Re,{gS:()=>Z});var x=T(81096);function Z(ie,ue){return new ie(new ArrayBuffer(ue*ie.ElementCount*(0,x.n1)(ie.ElementType)))}Object.freeze(Object.defineProperty({__proto__:null,copy:function A(ie,ue,ce){const oe=ie.typedBuffer,le=ie.typedBufferStride,Y=ue.typedBuffer,j=ue.typedBufferStride,X=ce?ce.count:ue.count;let U=(ce&&ce.dstIndex?ce.dstIndex:0)*le,ee=(ce&&ce.srcIndex?ce.srcIndex:0)*j;for(let $=0;$<X;++$){for(let ne=0;ne<9;++ne)oe[U+ne]=Y[ee+ne];U+=le,ee+=j}}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,copy:function Q(ie,ue,ce){const oe=ie.typedBuffer,le=ie.typedBufferStride,Y=ue.typedBuffer,j=ue.typedBufferStride,X=ce?ce.count:ue.count;let U=(ce&&ce.dstIndex?ce.dstIndex:0)*le,ee=(ce&&ce.srcIndex?ce.srcIndex:0)*j;for(let $=0;$<X;++$){for(let ne=0;ne<16;++ne)oe[U+ne]=Y[ee+ne];U+=le,ee+=j}}},Symbol.toStringTag,{value:"Module"})),T(98148),T(35995),T(9554),T(63470)},27105:(dt,Re,T)=>{"use strict";T.d(Re,{$G:()=>A,a:()=>Q,tO:()=>G});var x=T(25748);function A(J){return J?J.hasZ?[J.xmax-J.xmin/2,J.ymax-J.ymin/2,J.zmax-J.zmin/2]:[J.xmax-J.xmin/2,J.ymax-J.ymin/2]:null}function G(J){return J?Q(J.rings,J.hasZ):null}function Q(J,W){if(!J||!J.length)return null;const B=[],Z=[],ie=W?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let ue=0,ce=J.length;ue<ce;ue++){const oe=H(J[ue],W,ie);oe&&Z.push(oe)}if(Z.sort((ue,ce)=>{let oe=ue[2]-ce[2];return 0===oe&&W&&(oe=ue[4]-ce[4]),oe}),Z.length&&(B[0]=Z[0][0],B[1]=Z[0][1],W&&(B[2]=Z[0][3]),(B[0]<ie[0]||B[0]>ie[1]||B[1]<ie[2]||B[1]>ie[3]||W&&(B[2]<ie[4]||B[2]>ie[5]))&&(B.length=0)),!B.length){const ue=J[0]&&J[0].length?function re(J,W){const B=W?[0,0,0]:[0,0],Z=W?[0,0,0]:[0,0];let ie=0,ue=0,ce=0,oe=0;for(let le=0,Y=J.length;le<Y-1;le++){const j=J[le],X=J[le+1];if(j&&X){B[0]=j[0],B[1]=j[1],Z[0]=X[0],Z[1]=X[1],W&&j.length>2&&X.length>2&&(B[2]=j[2],Z[2]=X[2]);const U=(0,x.xA)(B,Z);if(U){ie+=U;const ee=(0,x.Gi)(j,X);ue+=U*ee[0],ce+=U*ee[1],W&&ee.length>2&&(oe+=U*ee[2])}}}return ie>0?W?[ue/ie,ce/ie,oe/ie]:[ue/ie,ce/ie]:J.length?J[0]:null}(J[0],W):null;if(!ue)return null;B[0]=ue[0],B[1]=ue[1],W&&ue.length>2&&(B[2]=ue[2])}return B}function H(J,W,B){let Z=0,ie=0,ue=0,ce=0,oe=0;const le=J.length?J[0][0]:0,Y=J.length?J[0][1]:0,j=J.length&&W?J[0][2]:0;for(let U=0;U<J.length;U++){const ee=J[U],$=J[(U+1)%J.length],[ne,se,ae]=ee,de=ne-le,_e=se-Y,pe=W?ae-j:void 0,[he,ge,ye]=$,Me=he-le,Ee=ge-Y,Te=W?ye-j:void 0,me=de*Ee-Me*_e;if(ce+=me,Z+=(de+Me)*me,ie+=(_e+Ee)*me,W&&ee.length>2&&$.length>2){const Ce=de*Te-Me*pe;ue+=(pe+Te)*Ce,oe+=Ce}ne<B[0]&&(B[0]=ne),ne>B[1]&&(B[1]=ne),se<B[2]&&(B[2]=se),se>B[3]&&(B[3]=se),W&&(ae<B[4]&&(B[4]=ae),ae>B[5]&&(B[5]=ae))}if(ce>0&&(ce*=-1),oe>0&&(oe*=-1),!ce)return null;ce*=.5,oe*=.5;const X=[Z/(6*ce)+le,ie/(6*ce)+Y,ce];return W&&(B[4]===B[5]||0===oe?(X[3]=(B[4]+B[5])/2,X[4]=0):(X[3]=ue/(6*oe)+j,X[4]=oe)),X}},85072:(dt,Re,T)=>{"use strict";T.d(Re,{S$:()=>ce,Ue:()=>H,Ws:()=>ue,_k:()=>ie,iL:()=>B});var x=T(97535),A=T(84161),G=T(70562);function H(Y){return Y?{ray:(0,G.Ue)(Y.ray),c0:Y.c0,c1:Y.c1}:{ray:(0,G.Ue)(),c0:0,c1:Number.MAX_VALUE}}function B(Y,j=H()){return(0,G.JG)(Y,j.ray),j.c0=0,j.c1=Number.MAX_VALUE,j}function ie(Y,j,X=H()){const U=(0,A.l)(Y.vector);return(0,G.al)(Y.origin,j,X.ray),X.c0=0,X.c1=U,X}function ue(Y,j){return oe(Y,Y.c0,j)}function ce(Y,j){return oe(Y,Y.c1,j)}function oe(Y,j,X){return(0,A.a)(X,Y.ray.origin,(0,A.g)(X,Y.ray.direction,j))}T(26242),new x.x(()=>({c0:0,c1:0,ray:null}))},33190:(dt,Re,T)=>{"use strict";T.d(Re,{CI:()=>B,Kv:()=>W,OQ:()=>re,Qg:()=>J,aV:()=>G,lQ:()=>Q,uP:()=>H,wP:()=>ie});var x=T(62208);const A=[0,0];function G(oe,le){return!!(0,x.pC)(le)&&W(oe,le.x,le.y,le.z)}function Q(oe,le){if(!le.points||le.points.length)return!1;for(const Y of le.points)if(!re(oe,Y))return!1;return!0}function H(oe,le){const{xmin:Y,ymin:j,zmin:X,xmax:U,ymax:ee,zmax:$}=le;return oe.hasZ&&le.hasZ?W(oe,Y,j,X)&&W(oe,Y,ee,X)&&W(oe,U,ee,X)&&W(oe,U,j,X)&&W(oe,Y,j,$)&&W(oe,Y,ee,$)&&W(oe,U,ee,$)&&W(oe,U,j,$):W(oe,Y,j)&&W(oe,Y,ee)&&W(oe,U,ee)&&W(oe,U,j)}function re(oe,le){return W(oe,le[0],le[1])}function J(oe,le){return W(oe,le[0],le[1],le[2])}function W(oe,le,Y,j){return le>=oe.xmin&&le<=oe.xmax&&Y>=oe.ymin&&Y<=oe.ymax&&(null==j||!oe.hasZ||j>=oe.zmin&&j<=oe.zmax)}function B(oe,le){return A[1]=le.y,A[0]=le.x,function Z(oe,le){return ie(oe.rings,le)}(oe,A)}function ie(oe,le){if(!oe)return!1;if(function ue(oe){return!Array.isArray(oe[0][0])}(oe))return ce(!1,oe,le);let Y=!1;for(let j=0,X=oe.length;j<X;j++)Y=ce(Y,oe[j],le);return Y}function ce(oe,le,Y){const[j,X]=Y;let U=oe,ee=0;for(let $=0,ne=le.length;$<ne;$++){ee++,ee===ne&&(ee=0);const[se,ae]=le[$],[de,_e]=le[ee];(ae<X&&_e>=X||_e<X&&ae>=X)&&se+(X-ae)/(_e-ae)*(de-se)<j&&(U=!U)}return U}},93088:(dt,Re,T)=>{"use strict";T.d(Re,{BR:()=>U,E2:()=>Te,Is:()=>_e,Kf:()=>X,NE:()=>he,P0:()=>j,Tz:()=>Ee,Ue:()=>B,ej:()=>ne,id:()=>de,pb:()=>le,pt:()=>ce,qf:()=>Z,rF:()=>pe,yS:()=>Me});var x=T(28347),A=T(84161),G=T(28093),Q=T(12080),H=T(65234),re=T(78172),J=T(41743),W=T(97126);function B(Ce){const{value:Ie,operations:Ge}=Ce;return{operations:Ge,value:Ge.create(Ie)}}function Z(Ce,Ie,Ge){return Ce.operations.setExtent(Ce.value,Ie,Ge.value),Ge}function ue(Ce,Ie,Ge=function ie(Ce){return{operations:Ce,value:Ce.create()}}(Ce)){return Ge.operations=Ce,Ce.copy(Ie,Ge.value),Ge}function ce(Ce){return ue(W.s,(0,W.f)(0,0,0,(0,Q.Iu)(Ce).radius))}const oe=2**50;function le(){return ue(J.b,(0,J.f)([0,0,0],[oe,0,0],[0,oe,0]))}function j(Ce,Ie,Ge){return Ce.operations.axisAt(Ce.value,Ie,re.R.Z,Ge)}function X(Ce,Ie,Ge,Je){return Ce.operations.axisAt(Ce.value,Ie,Ge,Je)}function U(Ce,Ie,Ge){return Ce.operations.intersectRay(Ce.value,Ie,Ge)}function ne(Ce,Ie,Ge){return Ce.operations.intersectRayClosestSilhouette(Ce.value,Ie,Ge)}function de(Ce,Ie){return Ce.operations.altitudeAt(Ce.value,Ie)}function _e(Ce,Ie,Ge,Je){return Ce.operations.setAltitudeAt(Ce.value,Ie,Ge,Je)}function pe(Ce,Ie,Ge,Je){return Ie!==Je&&(0,x.c)(Je,Ie),(0,A.s)(ge,Je[12],Je[13],Je[14]),_e(Ce,ge,Ge,ge),Je[12]=ge[0],Je[13]=ge[1],Je[14]=ge[2],Je}function he(Ce,Ie,Ge){return Ce.operations.elevate(Ce.value,Ie,Ge.value)}const ge=(0,G.c)();function Me(Ce,Ie,Ge,Je,xe){return xe[0]=(0,A.e)(Ce,Ie),xe[1]=(0,A.e)(Ce,Ge),xe[2]=(0,A.e)(Ce,Je),xe}function Ee(Ce,Ie,Ge,Je,xe){(0,A.c)(Ge,Ce),(0,A.c)(me,Ie),(0,A.n)(me,me),(0,A.f)(Je,me,Ge),(0,A.f)(xe,Je,Ge)}function Te(Ce,Ie){return Ce?(0,Q.rS)(Ie):Ie.isGeographic?H.Z.PlateCarree:Ie}const me=(0,G.c)()},25748:(dt,Re,T)=>{"use strict";T.d(Re,{Gi:()=>re,Sq:()=>oe,Zy:()=>ie,bu:()=>B,n8:()=>W,nA:()=>A,nc:()=>ce,ok:()=>J,pW:()=>Z,xA:()=>G});var x=T(37053);function A(Y){if(!Y)return null;if(Array.isArray(Y))return Y;const j=Y.hasZ,X=Y.hasM;if("point"===Y.type)return X&&j?[Y.x,Y.y,Y.z,Y.m]:j?[Y.x,Y.y,Y.z]:X?[Y.x,Y.y,Y.m]:[Y.x,Y.y];if("polygon"===Y.type)return Y.rings.slice(0);if("polyline"===Y.type)return Y.paths.slice(0);if("multipoint"===Y.type)return Y.points.slice(0);if("extent"===Y.type){const U=Y.clone().normalize();if(!U)return null;let ee=!1,$=!1;return U.forEach(ne=>{ne.hasZ&&(ee=!0),ne.hasM&&($=!0)}),U.map(ne=>{const se=[[ne.xmin,ne.ymin],[ne.xmin,ne.ymax],[ne.xmax,ne.ymax],[ne.xmax,ne.ymin],[ne.xmin,ne.ymin]];if(ee&&ne.hasZ){const ae=.5*(ne.zmax-ne.zmin);for(let de=0;de<se.length;de++)se[de].push(ae)}if($&&ne.hasM){const ae=.5*(ne.mmax-ne.mmin);for(let de=0;de<se.length;de++)se[de].push(ae)}return se})}return null}function G(Y,j){const X=j[0]-Y[0],U=j[1]-Y[1];if(Y.length>2&&j.length>2){const ee=Y[2]-j[2];return Math.sqrt(X*X+U*U+ee*ee)}return Math.sqrt(X*X+U*U)}function Q(Y,j,X){const U=Y[0]+X*(j[0]-Y[0]),ee=Y[1]+X*(j[1]-Y[1]);return Y.length>2&&j.length>2?[U,ee,Y[2]+X*(j[2]-Y[2])]:[U,ee]}function re(Y,j){return Q(Y,j,.5)}function J(Y){const j=Y.length;let X=0;for(let U=0;U<j-1;++U)X+=G(Y[U],Y[U+1]);return X}function W(Y,j){if(j<=0)return Y[0];const X=Y.length;let U=0;for(let ee=0;ee<X-1;++ee){const $=G(Y[ee],Y[ee+1]);if(j-U<$)return Q(Y[ee],Y[ee+1],(j-U)/$);U+=$}return Y[X-1]}function B(Y,j,X){const U=Y.length;let ee=0,$=0,ne=0;for(let se=0;se<U;se++){const ae=Y[se],de=Y[(se+1)%U];let _e=2;ee+=ae[0]*de[1]-de[0]*ae[1],ae.length>2&&de.length>2&&X&&($+=ae[0]*de[2]-de[0]*ae[2],_e=3),ae.length>_e&&de.length>_e&&j&&(ne+=ae[0]*de[_e]-de[0]*ae[_e])}return ee<=0&&$<=0&&ne<=0}function Z(Y){if("rings"in Y){for(const j of Y.rings)j.length<3||j[0][0]===j[j.length-1][0]&&j[0][1]===j[j.length-1][1]||j.push([j[0][0],j[0][1]]);if(Y.rings.length>0&&!B(Y.rings[0],Y.hasM,Y.hasZ))for(let j=0;j<Y.rings.length;++j)Y.rings[j]=Y.rings[j].reverse()}}function ie(Y){if("rings"in Y)for(const j of Y.rings)j.length<3||j[0][0]===j[j.length-1][0]&&j[0][1]===j[j.length-1][1]||j.push([j[0][0],j[0][1]])}function ce(Y){return"polygon"!==Y.type&&"polyline"!==Y.type||oe("polygon"===Y.type?Y.rings:Y.paths,Y.spatialReference),Y}function oe(Y,j){const X=(0,x.C5)(j);if(!X)return;const U=X.valid[0],ee=X.valid[1],$=ee-U;for(const ne of Y){let se=1/0,ae=-1/0;ne.forEach(_e=>{let pe=_e[0];for(;pe<U;)pe+=$;for(;pe>ee;)pe-=$;se=Math.min(se,pe),ae=Math.max(ae,pe),_e[0]=pe});const de=ae-se;$-de<de&&ne.forEach(_e=>{_e[0]<0&&(_e[0]+=$)})}}},15176:(dt,Re,T)=>{"use strict";T.d(Re,{Wn:()=>j,_w:()=>Y,aO:()=>ce});var x=T(32442);const J=[];function W(X,U,ee,$){return{xmin:X,ymin:U,xmax:ee,ymax:$}}function B(X,U,ee,$,ne,se){return{xmin:X,ymin:U,zmin:ee,xmax:$,ymax:ne,zmax:se}}function Z(X,U,ee,$,ne,se){return{xmin:X,ymin:U,mmin:ee,xmax:$,ymax:ne,mmax:se}}function ie(X,U,ee,$,ne,se,ae,de){return{xmin:X,ymin:U,zmin:ee,mmin:$,xmax:ne,ymax:se,zmax:ae,mmax:de}}function ue(X,U=!1,ee=!1){return U?ee?ie(X[0],X[1],X[2],X[3],X[4],X[5],X[6],X[7]):B(X[0],X[1],X[2],X[3],X[4],X[5]):ee?Z(X[0],X[1],X[2],X[3],X[4],X[5]):W(X[0],X[1],X[2],X[3])}function ce(X){return X?function A(X){return void 0!==X.xmin&&void 0!==X.ymin&&void 0!==X.xmax&&void 0!==X.ymax}(X)?X:function Q(X){return void 0!==X.x&&void 0!==X.y}(X)?function le(X){const{x:U,y:ee,z:$,m:ne}=X,se=null!=ne;return null!=$?se?ie(U,ee,$,ne,U,ee,$,ne):B(U,ee,$,U,ee,$):se?Z(U,ee,ne,U,ee,ne):W(U,ee,U,ee)}(X):function re(X){return void 0!==X.rings}(X)?Y(X):function H(X){return void 0!==X.paths}(X)?j(X):function G(X){return void 0!==X.points}(X)?function oe(X){const{hasZ:U,hasM:ee,points:$}=X;return ue((0,x.lC)(J,$,U,ee),U,ee)}(X):null:null}function Y(X){const{hasZ:U,hasM:ee,rings:$}=X,ne=(0,x.C6)(J,$,U,ee);return ne?ue(ne,U,ee):null}function j(X){const{hasZ:U,hasM:ee,paths:$}=X,ne=(0,x.C6)(J,$,U,ee);return ne?ue(ne,U,ee):null}},8834:(dt,Re,T)=>{"use strict";T.d(Re,{Hf:()=>ie,JG:()=>ue,Jp:()=>oe,NQ:()=>se,Nu:()=>ne,Ue:()=>Z,Zr:()=>Y,fz:()=>ee,g8:()=>U,hr:()=>le,q_:()=>ce,rN:()=>X,tc:()=>de,xu:()=>ae,zq:()=>j});var ne,se,ye,x=T(97535),A=T(28347),G=T(84161),Q=T(28093),H=T(993),re=T(4794),J=T(85072),W=T(90014),B=T(26242);function Z(ye){return ye?[(0,W.Ue)(ye[0]),(0,W.Ue)(ye[1]),(0,W.Ue)(ye[2]),(0,W.Ue)(ye[3]),(0,W.Ue)(ye[4]),(0,W.Ue)(ye[5])]:[(0,W.Ue)(),(0,W.Ue)(),(0,W.Ue)(),(0,W.Ue)(),(0,W.Ue)(),(0,W.Ue)()]}function ie(){return[(0,Q.c)(),(0,Q.c)(),(0,Q.c)(),(0,Q.c)(),(0,Q.c)(),(0,Q.c)(),(0,Q.c)(),(0,Q.c)()]}function ue(ye,Me){for(let Ee=0;Ee<de.NUM;Ee++)(0,W.JG)(ye[Ee],Me[Ee])}function ce(ye,Me,Ee,Te=ge){const me=(0,A.m)(B.MP.get(),Me,ye);(0,A.a)(me,me);for(let Ce=0;Ce<_e.NUM;++Ce){const Ie=(0,H.t)(B.o6.get(),pe[Ce],me);(0,G.s)(Te[Ce],Ie[0]/Ie[3],Ie[1]/Ie[3],Ie[2]/Ie[3])}oe(Ee,Te)}function oe(ye,Me){(0,W.zk)(Me[se.FAR_BOTTOM_LEFT],Me[se.NEAR_BOTTOM_LEFT],Me[se.NEAR_TOP_LEFT],ye[ne.LEFT]),(0,W.zk)(Me[se.NEAR_BOTTOM_RIGHT],Me[se.FAR_BOTTOM_RIGHT],Me[se.FAR_TOP_RIGHT],ye[ne.RIGHT]),(0,W.zk)(Me[se.FAR_BOTTOM_LEFT],Me[se.FAR_BOTTOM_RIGHT],Me[se.NEAR_BOTTOM_RIGHT],ye[ne.BOTTOM]),(0,W.zk)(Me[se.NEAR_TOP_LEFT],Me[se.NEAR_TOP_RIGHT],Me[se.FAR_TOP_RIGHT],ye[ne.TOP]),(0,W.zk)(Me[se.NEAR_BOTTOM_LEFT],Me[se.NEAR_BOTTOM_RIGHT],Me[se.NEAR_TOP_RIGHT],ye[ne.NEAR]),(0,W.zk)(Me[se.FAR_BOTTOM_RIGHT],Me[se.FAR_BOTTOM_LEFT],Me[se.FAR_TOP_LEFT],ye[ne.FAR])}function le(ye,Me){for(let Ee=0;Ee<de.NUM;Ee++){const Te=ye[Ee];if(Te[0]*Me[0]+Te[1]*Me[1]+Te[2]*Me[2]+Te[3]>=Me[3])return!1}return!0}function Y(ye,Me){return $(ye,(0,J.iL)(Me,he.get()))}function j(ye,Me){for(let Ee=0;Ee<de.NUM;Ee++)if(!(0,W.Er)(ye[Ee],Me))return!1;return!0}function X(ye,Me,Ee){return $(ye,(0,J._k)(Me,Ee,he.get()))}function U(ye,Me){for(let Ee=0;Ee<de.NUM;Ee++)if((0,W.jH)(ye[Ee],Me)>0)return!1;return!0}function ee(ye,Me){for(let Ee=0;Ee<de.NUM;Ee++)if((0,W.U4)(ye[Ee],Me))return!1;return!0}function $(ye,Me){for(let Ee=0;Ee<de.NUM;Ee++)if(!(0,W.oq)(ye[Ee],Me))return!1;return!0}(ye=ne||(ne={}))[ye.LEFT=0]="LEFT",ye[ye.RIGHT=1]="RIGHT",ye[ye.BOTTOM=2]="BOTTOM",ye[ye.TOP=3]="TOP",ye[ye.NEAR=4]="NEAR",ye[ye.FAR=5]="FAR",function(ye){ye[ye.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",ye[ye.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",ye[ye.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",ye[ye.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",ye[ye.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",ye[ye.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",ye[ye.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",ye[ye.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(se||(se={}));const ae={bottom:[se.FAR_BOTTOM_RIGHT,se.NEAR_BOTTOM_RIGHT,se.NEAR_BOTTOM_LEFT,se.FAR_BOTTOM_LEFT],near:[se.NEAR_BOTTOM_LEFT,se.NEAR_BOTTOM_RIGHT,se.NEAR_TOP_RIGHT,se.NEAR_TOP_LEFT],far:[se.FAR_BOTTOM_RIGHT,se.FAR_BOTTOM_LEFT,se.FAR_TOP_LEFT,se.FAR_TOP_RIGHT],right:[se.NEAR_BOTTOM_RIGHT,se.FAR_BOTTOM_RIGHT,se.FAR_TOP_RIGHT,se.NEAR_TOP_RIGHT],left:[se.FAR_BOTTOM_LEFT,se.NEAR_BOTTOM_LEFT,se.NEAR_TOP_LEFT,se.FAR_TOP_LEFT],top:[se.FAR_TOP_LEFT,se.NEAR_TOP_LEFT,se.NEAR_TOP_RIGHT,se.FAR_TOP_RIGHT]};var de,_e;(function(ye){ye[ye.NUM=6]="NUM"})(de||(de={})),function(ye){ye[ye.NUM=8]="NUM"}(_e||(_e={}));const pe=[(0,re.f)(-1,-1,-1,1),(0,re.f)(1,-1,-1,1),(0,re.f)(1,1,-1,1),(0,re.f)(-1,1,-1,1),(0,re.f)(-1,-1,1,1),(0,re.f)(1,-1,1,1),(0,re.f)(1,1,1,1),(0,re.f)(-1,1,1,1)],he=new x.x(J.Ue),ge=ie()},37299:(dt,Re,T)=>{"use strict";T.d(Re,{Dg:()=>J,Yr:()=>A,cD:()=>re,yB:()=>G});var x=T(94425);const A=Math.PI/180,G=/SPHEROID\[([^\]]+)]/i,Q=x.sv.radius,H=x.sv.eccentricitySquared,re={a1:Q*H,a2:Q*H*Q*H,a3:Q*H*H/2,a4:Q*H*Q*H*2.5,a5:Q*H+Q*H*H/2,a6:1-H},J={4267:{a:6378206.4,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:x.sv.radius,f:x.sv.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:x.Z1.radius,f:x.Z1.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:x.yr.radius,f:x.yr.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:x.yr.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}}},10049:(dt,Re,T)=>{"use strict";T.d(Re,{Gb:()=>Y,Jf:()=>X,TB:()=>ee,cA:()=>$,p8:()=>j}),T(29132);var A=T(26584),G=T(16730),Q=T(37299),H=T(37053),re=T(55214),J=T(37118),B=(T(49672),T(65234));function Z(ae){if(!ae)return null;if((0,H.sT)(ae)&&ae.wkid){const de=Q.Dg[ae.wkid];if(de)return de}if(ae.wkt){const de=function ie(ae){const de=Q.yB.exec(ae);if(!de||2!==de.length)return null;const _e=de[1].split(",");if(!_e||_e.length<3)return null;const pe=parseFloat(_e[1]),he=parseFloat(_e[2]);return isNaN(pe)||isNaN(he)?null:{a:pe,f:0===he?0:1/he}}(ae.wkt);if(de)return de}return null}function ue(ae){const de=Z(ae||B.Z.WGS84);if(function ce(ae){return"b"in ae&&"eSq"in ae&&"radius"in ae}(de))return de;const _e=de.a*(1-de.f);return Object.assign(de,{b:_e,eSq:1-(_e/de.a)**2,radius:(2*de.a+_e)/3,densificationRatio:1e4/((2*de.a+_e)/3)})}function le(ae,de,_e){const{a:pe,eSq:he}=ue(_e),ge=Math.sqrt(he),ye=Math.sin(de[1]*Q.Yr),Me=pe*de[0]*Q.Yr;let Ee;return Ee=he>0?pe*((1-he)*(ye/(1-he*(ye*ye))-1/(2*ge)*Math.log((1-ge*ye)/(1+ge*ye))))*.5:pe*ye,ae[0]=Me,ae[1]=Ee,ae}function Y(ae){return null!==Z(ae)}function j(ae,de="square-meters"){if(ae.some(ye=>!Y(ye.spatialReference)))throw new A.Z("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const _e=[];for(let ye=0;ye<ae.length;ye++){const Me=ae[ye],Ee=Me.spatialReference,{radius:Te,densificationRatio:me}=ue(Ee);_e.push(U(Me,Te*me))}const pe=[],he=[0,0],ge=[0,0];for(let ye=0;ye<_e.length;ye++){const{rings:Me,spatialReference:Ee}=_e[ye];let Te=0;for(let me=0;me<Me.length;me++){const Ce=Me[me];le(he,Ce[0],Ee),le(ge,Ce[Ce.length-1],Ee);let Ie=ge[0]*he[1]-he[0]*ge[1];for(let Ge=0;Ge<Ce.length-1;Ge++)le(he,Ce[Ge+1],Ee),le(ge,Ce[Ge],Ee),Ie+=ge[0]*he[1]-he[0]*ge[1];Te+=Ie}Te=(0,G.En)(Te,"square-meters",de),pe.push(Te/-2)}return pe}function X(ae,de="meters"){if(!ae)throw new A.Z("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(ae.some(pe=>!Y(pe.spatialReference)))throw new A.Z("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const _e=[];for(let pe=0;pe<ae.length;pe++){const he=ae[pe],{spatialReference:ge}=he,ye="polyline"===he.type?he.paths:he.rings;let Me=0;for(let Ee=0;Ee<ye.length;Ee++){const Te=ye[Ee];let me=0;for(let Ce=1;Ce<Te.length;Ce++){const Ie=Te[Ce-1][0],Ge=Te[Ce][0],Je=Te[Ce-1][1],xe=Te[Ce][1];if(Je!==xe||Ie!==Ge){const je={distance:null};$(je,[Ie,Je],[Ge,xe],ge),me+=je.distance}}Me+=me}Me=(0,G.En)(Me,"meters",de),_e.push(Me)}return _e}function U(ae,de){if("polyline"!==ae.type&&"polygon"!==ae.type)throw new A.Z("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:_e}=ae;if(!Y(_e))throw new A.Z("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const pe="polyline"===ae.type?ae.paths:ae.rings,he=[],ge=[0,0],ye={distance:null};for(const Me of pe){const Ee=[];he.push(Ee),Ee.push([Me[0][0],Me[0][1]]);let Te,me,Ce=Me[0][0],Ie=Me[0][1];for(let Ge=0;Ge<Me.length-1;Ge++){if(Te=Me[Ge+1][0],me=Me[Ge+1][1],Ce===Te&&Ie===me)continue;const Je=[Ce,Ie];$(ye,[Ce,Ie],[Te,me],_e);const{azimuth:xe,distance:je}=ye,We=je/de;if(We>1){for(let Ne=1;Ne<=We-1;Ne++)ee(ge,Je,xe,Ne*de,_e),Ee.push(ge.slice(0));ee(ge,Je,xe,(je+Math.floor(We-1)*de)/2,_e),Ee.push(ge.slice(0))}ee(ge,Je,xe,je,_e),Ee.push(ge.slice(0)),Ce=ge[0],Ie=ge[1]}}return"polyline"===ae.type?new re.Z({paths:he,spatialReference:_e}):new J.Z({rings:he,spatialReference:_e})}function ee(ae,de,_e,pe,he){const Me=de[0]*Q.Yr,Ee=de[1]*Q.Yr,Te=_e*Q.Yr,{a:me,b:Ce,f:Ie}=ue(he),Ge=Math.sin(Te),Je=Math.cos(Te),xe=(1-Ie)*Math.tan(Ee),je=1/Math.sqrt(1+xe*xe),We=xe*je,Ne=Math.atan2(xe,Je),we=je*Ge,Oe=we*we,$e=1-Oe,Be=$e*(me*me-Ce*Ce)/(Ce*Ce),Se=1+Be/16384*(4096+Be*(Be*(320-175*Be)-768)),De=Be/1024*(256+Be*(Be*(74-47*Be)-128));let Fe,ve,Ke,qe,be=pe/(Ce*Se),tt=2*Math.PI;for(;Math.abs(be-tt)>1e-12;)Ke=Math.cos(2*Ne+be),Fe=Math.sin(be),ve=Math.cos(be),qe=De*Fe*(Ke+De/4*(ve*(2*Ke*Ke-1)-De/6*Ke*(4*Fe*Fe-3)*(4*Ke*Ke-3))),tt=be,be=pe/(Ce*Se)+qe;const Ye=We*Fe-je*ve*Je,ze=Math.atan2(We*ve+je*Fe*Je,(1-Ie)*Math.sqrt(Oe+Ye*Ye)),et=Math.atan2(Fe*Ge,je*ve-We*Fe*Je),ke=Ie/16*$e*(4+Ie*(4-3*$e)),ot=ze/Q.Yr;return ae[0]=(Me+(et-(1-ke)*Ie*we*(be+ke*Fe*(Ke+ke*ve*(2*Ke*Ke-1)))))/Q.Yr,ae[1]=ot,ae}function $(ae,de,_e,pe){const he=de[0]*Q.Yr,ge=de[1]*Q.Yr,ye=_e[0]*Q.Yr,Me=_e[1]*Q.Yr,{a:Ee,b:Te,f:me,radius:Ce}=ue(pe),Ie=ye-he,Ge=Math.atan((1-me)*Math.tan(ge)),Je=Math.atan((1-me)*Math.tan(Me)),xe=Math.sin(Ge),je=Math.cos(Ge),We=Math.sin(Je),Ne=Math.cos(Je);let we,Oe,$e,Be,Se,De,Fe,ve,Ke,qe,be=1e3,tt=Ie;do{if(Fe=Math.sin(tt),ve=Math.cos(tt),$e=Math.sqrt(Ne*Fe*(Ne*Fe)+(je*We-xe*Ne*ve)*(je*We-xe*Ne*ve)),0===$e)return ae.distance=0,ae.azimuth=void 0,ae.reverseAzimuth=void 0,ae;Se=xe*We+je*Ne*ve,De=Math.atan2($e,Se),Ke=je*Ne*Fe/$e,Oe=1-Ke*Ke,Be=Se-2*xe*We/Oe,isNaN(Be)&&(Be=0),qe=me/16*Oe*(4+me*(4-3*Oe)),we=tt,tt=Ie+(1-qe)*me*Ke*(De+qe*$e*(Be+qe*Se*(2*Be*Be-1)))}while(Math.abs(tt-we)>1e-12&&--be>0);if(0===be){const at=Ce,yt=Math.acos(Math.sin(ge)*Math.sin(Me)+Math.cos(ge)*Math.cos(Me)*Math.cos(ye-he))*at,wt=ye-he,zt=Math.sin(wt)*Math.cos(Me),Rt=Math.cos(ge)*Math.sin(Me)-Math.sin(ge)*Math.cos(Me)*Math.cos(wt),Ft=Math.atan2(zt,Rt);return ae.azimuth=Ft/Q.Yr,ae.distance=yt,ae.reverseAzimuth=void 0,ae}const Ye=Oe*(Ee*Ee-Te*Te)/(Te*Te),ze=Ye/1024*(256+Ye*(Ye*(74-47*Ye)-128)),et=Te*(1+Ye/16384*(4096+Ye*(Ye*(320-175*Ye)-768)))*(De-ze*$e*(Be+ze/4*(Se*(2*Be*Be-1)-ze/6*Be*(4*$e*$e-3)*(4*Be*Be-3)))),ke=Math.atan2(Ne*Math.sin(tt),je*We-xe*Ne*Math.cos(tt)),ot=Math.atan2(je*Math.sin(tt),je*We*Math.cos(tt)-xe*Ne);return ae.azimuth=ke/Q.Yr,ae.distance=et,ae.reverseAzimuth=ot/Q.Yr,ae}},36947:(dt,Re,T)=>{"use strict";T.d(Re,{Ku:()=>ue,Wt:()=>J,qC:()=>Y}),T(8314);var B,U,A=T(26584),G=T(62208),Q=T(79334),H=T(38305);function J(U,ee,$){const ne=ue(U),se=ee,ae=function W(U,ee,$){if(!Z(U)||!Z(ee))return B.Unsupported;if(null==U||null==ee)return B.Ok;if(!$&&U.heightUnit!==ee.heightUnit)return B.Units;if(U.heightModel!==ee.heightModel)return B.HeightModel;switch(U.heightModel){case"gravity-related-height":return B.Ok;case"ellipsoidal":return U.vertCRS===ee.vertCRS?B.Ok:B.CRS;default:return B.Unsupported}}(ne,se,$);if(ne){const de=Q.Z.deriveUnitFromSR(ne,U.spatialReference).heightUnit;if(!$&&de!==ne.heightUnit){const _e=new A.Z("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${de})`,{horizontalUnit:de});return new A.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:ne,error:_e})}}if(!function ie(U){return"heightModelInfo"in U&&null!=U.heightModelInfo||null!=U.spatialReference||!le(U)}(U)||ae===B.Unsupported)return new A.Z("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:ne});switch(ae){case B.Units:{const de=ne.heightUnit||"unknown",_e=se.heightUnit||"unknown",pe=new A.Z("layerview:incompatible-height-unit",`The vertical units of the layer (${de}) must match the vertical units of the scene (${_e})`,{layerUnit:de,sceneUnit:_e});return new A.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:ne,sceneHeightModelInfo:se,error:pe})}case B.HeightModel:{const de=ne.heightModel||"unknown",_e=se.heightModel||"unknown",pe=new A.Z("layerview:incompatible-height-model",`The height model of the layer (${de}) must match the height model of the scene (${_e})`,{layerHeightModel:de,sceneHeightModel:_e});return new A.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:ne,sceneHeightModelInfo:se,error:pe})}case B.CRS:{const de=ne.vertCRS||"unknown",_e=se.vertCRS||"unknown",pe=new A.Z("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${de}) must match the vertical datum of the scene (${_e})`,{layerDatum:de,sceneDatum:_e});return new A.Z("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:ne,sceneHeightModelInfo:se,error:pe})}}return null}function Z(U){return null==U||null!=U.heightModel&&null!=U.heightUnit}function ue(U){const ee=U.url&&(0,H.Qc)(U.url);return null==(U.spatialReference&&U.spatialReference.vcsWkid)&&(0,G.pC)(ee)&&"ImageServer"===ee.serverType||!ce(U)||!U.heightModelInfo?le(U)?Q.Z.deriveUnitFromSR(X,U.spatialReference):null:U.heightModelInfo}function ce(U){return"heightModelInfo"in U}function oe(U){if("unknown"===U.type||!("capabilities"in U))return!1;switch(U.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"wfs":return!0;default:return!1}}function le(U){return oe(U)?!!(U.capabilities&&U.capabilities.data&&U.capabilities.data.supportsZ):j(U)}function Y(U){return null!=U.layers||j(U)||oe(U)||ce(U)}function j(U){switch(U.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"line-of-sight":case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(U=B||(B={}))[U.Ok=0]="Ok",U[U.Units=1]="Units",U[U.HeightModel=2]="HeightModel",U[U.CRS=3]="CRS",U[U.Unsupported=4]="Unsupported";const X=new Q.Z({heightModel:"gravity-related-height"})},11519:(dt,Re,T)=>{"use strict";T.d(Re,{Ff:()=>le,IY:()=>X,UT:()=>j,h_:()=>G});var x=T(33190);function A(U,ee){return(0,x.aV)(U,ee)}function G(U,ee){let ne,se,ae;if(U.xmin<=ee.xmin){if(ne=ee.xmin,U.xmax<ne)return!1}else if(ne=U.xmin,ee.xmax<ne)return!1;if(U.ymin<=ee.ymin){if(se=ee.ymin,U.ymax<se)return!1}else if(se=U.ymin,ee.ymax<se)return!1;if(U.hasZ&&ee.hasZ&&ee.hasZ)if(U.zmin<=ee.zmin){if(ae=ee.zmin,U.zmax<ae)return!1}else if(ae=U.zmin,ee.zmax<ae)return!1;return!0}function Q(U,ee){const{points:$,hasZ:ne}=ee,se=ne?x.Qg:x.OQ;for(const ae of $)if(se(U,ae))return!0;return!1}const H=[0,0],re=[0,0],J=[0,0],W=[0,0],B=[H,re,J,W],Z=[[J,H],[H,re],[re,W],[W,J]];function ie(U,ee){return function ue(U,ee){H[0]=U.xmin,H[1]=U.ymax,re[0]=U.xmax,re[1]=U.ymax,J[0]=U.xmin,J[1]=U.ymin,W[0]=U.xmax,W[1]=U.ymin;for(const $ of B)if((0,x.wP)(ee,$))return!0;for(const $ of ee){if(!$.length)continue;let ne=$[0];if((0,x.OQ)(U,ne))return!0;for(let se=1;se<$.length;se++){const ae=$[se];if((0,x.OQ)(U,ae)||Y(ne,ae,Z))return!0;ne=ae}}return!1}(U,ee.rings)}function ce(U,ee){H[0]=U.xmin,H[1]=U.ymax,re[0]=U.xmax,re[1]=U.ymax,J[0]=U.xmin,J[1]=U.ymin,W[0]=U.xmax,W[1]=U.ymin;const $=ee.paths;for(const ne of $){if(!$.length)continue;let se=ne[0];if((0,x.OQ)(U,se))return!0;for(let ae=1;ae<ne.length;ae++){const de=ne[ae];if((0,x.OQ)(U,de)||Y(se,de,Z))return!0;se=de}}return!1}const oe=[0,0];function le(U){for(let ee=0;ee<U.length;ee++){const $=U[ee];for(let se=0;se<$.length-1;se++){const ae=$[se],de=$[se+1];for(let _e=ee+1;_e<U.length;_e++)for(let pe=0;pe<U[_e].length-1;pe++){const he=U[_e][pe],ge=U[_e][pe+1];if(j(ae,de,he,ge,oe)&&!(oe[0]===ae[0]&&oe[1]===ae[1]||oe[0]===he[0]&&oe[1]===he[1]||oe[0]===de[0]&&oe[1]===de[1]||oe[0]===ge[0]&&oe[1]===ge[1]))return!0}}const ne=$.length;if(!(ne<=4))for(let se=0;se<ne-3;se++){let ae=ne-1;0===se&&(ae=ne-2);const de=$[se],_e=$[se+1];for(let pe=se+2;pe<ae;pe++){const he=$[pe],ge=$[pe+1];if(j(de,_e,he,ge,oe)&&!(oe[0]===de[0]&&oe[1]===de[1]||oe[0]===he[0]&&oe[1]===he[1]||oe[0]===_e[0]&&oe[1]===_e[1]||oe[0]===ge[0]&&oe[1]===ge[1]))return!0}}}return!1}function Y(U,ee,$){for(let ne=0;ne<$.length;ne++)if(j(U,ee,$[ne][0],$[ne][1]))return!0;return!1}function j(U,ee,$,ne,se){const[ae,de]=U,[_e,pe]=ee,[he,ge]=$,[ye,Me]=ne,Ee=ye-he,Te=ae-he,me=_e-ae,Ce=Me-ge,Ie=de-ge,Ge=pe-de,Je=Ce*me-Ee*Ge;if(0===Je)return!1;const xe=(Ee*Ie-Ce*Te)/Je,je=(me*Ie-Ge*Te)/Je;return xe>=0&&xe<=1&&je>=0&&je<=1&&(se&&(se[0]=ae+xe*(_e-ae),se[1]=de+xe*(pe-de)),!0)}function X(U){switch(U){case"esriGeometryEnvelope":case"extent":return G;case"esriGeometryMultipoint":case"multipoint":return Q;case"esriGeometryPoint":case"point":return A;case"esriGeometryPolygon":case"polygon":return ie;case"esriGeometryPolyline":case"polyline":return ce}}},91179:(dt,Re,T)=>{"use strict";T.d(Re,{Ji:()=>Y,YX:()=>B,aW:()=>Z,im:()=>le,l9:()=>ue,oU:()=>ce,q9:()=>X,wp:()=>ie});var x=T(62208),A=T(2004),G=T(21674),Q=T(72854),H=T(49672),re=T(37118),J=T(55214);function B(U){return void 0!==U.xmin&&void 0!==U.ymin&&void 0!==U.xmax&&void 0!==U.ymax}function Z(U){return void 0!==U.points}function ie(U){return void 0!==U.x&&void 0!==U.y}function ue(U){return void 0!==U.paths}function ce(U){return void 0!==U.rings}function le(U){return(0,x.Wi)(U)?null:U instanceof G.Z?U:ie(U)?H.Z.fromJSON(U):ue(U)?J.Z.fromJSON(U):ce(U)?re.Z.fromJSON(U):Z(U)?Q.Z.fromJSON(U):B(U)?A.Z.fromJSON(U):null}function Y(U){return U?ie(U)?"esriGeometryPoint":ue(U)?"esriGeometryPolyline":ce(U)?"esriGeometryPolygon":B(U)?"esriGeometryEnvelope":Z(U)?"esriGeometryMultipoint":null:null}const j={esriGeometryPoint:H.Z,esriGeometryPolyline:J.Z,esriGeometryPolygon:re.Z,esriGeometryEnvelope:A.Z,esriGeometryMultipoint:Q.Z};function X(U){return U&&j[U]||null}},13777:(dt,Re,T)=>{"use strict";T.d(Re,{AR:()=>j,Gr:()=>Y,JG:()=>W,Jk:()=>ie,KU:()=>oe,Ue:()=>re,al:()=>B,ct:()=>le,nF:()=>ce,zk:()=>Z});var x=T(21286),A=T(97535),G=T(84161),Q=T(28093),H=T(26242);function re(ne){return ne?{origin:(0,Q.a)(ne.origin),vector:(0,Q.a)(ne.vector)}:{origin:(0,Q.c)(),vector:(0,Q.c)()}}function W(ne,se=re()){return B(ne.origin,ne.vector,se)}function B(ne,se,ae=re()){return(0,G.c)(ae.origin,ne),(0,G.c)(ae.vector,se),ae}function Z(ne,se,ae=re()){return(0,G.c)(ae.origin,ne),(0,G.b)(ae.vector,se,ne),ae}function ie(ne,se){const ae=(0,G.b)(H.WM.get(),se,ne.origin),de=(0,G.e)(ne.vector,ae),_e=(0,G.e)(ne.vector,ne.vector),pe=(0,x.uZ)(de/_e,0,1),he=(0,G.b)(H.WM.get(),(0,G.g)(H.WM.get(),ne.vector,pe),ae);return(0,G.e)(he,he)}function ce(ne,se,ae){return le(ne,se,0,1,ae)}function oe(ne,se,ae){return(0,G.a)(ae,ne.origin,(0,G.g)(ae,ne.vector,se))}function le(ne,se,ae,de,_e){const{vector:pe,origin:he}=ne,ge=(0,G.b)(H.WM.get(),se,he),ye=(0,G.e)(pe,ge)/(0,G.p)(pe);return(0,G.g)(_e,pe,(0,x.uZ)(ye,ae,de)),(0,G.a)(_e,_e,ne.origin)}function Y(ne,se){if(U(ne,function J(ne,se){const ae=$.get();return ae.origin=ne,ae.vector=se,ae}(se.origin,se.direction),!1,ee)){const{tA:ae,pB:de,distance2:_e}=ee;if(ae>=0&&ae<=1)return _e;if(ae<0)return(0,G.d)(ne.origin,de);if(ae>1)return(0,G.d)((0,G.a)(H.WM.get(),ne.origin,ne.vector),de)}return null}function j(ne,se,ae){return!!U(ne,se,!0,ee)&&((0,G.c)(ae,ee.pA),!0)}function U(ne,se,ae,de){const pe=ne.origin,he=(0,G.a)(H.WM.get(),pe,ne.vector),ge=se.origin,ye=(0,G.a)(H.WM.get(),ge,se.vector),Me=H.WM.get(),Ee=H.WM.get();if(Me[0]=pe[0]-ge[0],Me[1]=pe[1]-ge[1],Me[2]=pe[2]-ge[2],Ee[0]=ye[0]-ge[0],Ee[1]=ye[1]-ge[1],Ee[2]=ye[2]-ge[2],Math.abs(Ee[0])<1e-6&&Math.abs(Ee[1])<1e-6&&Math.abs(Ee[2])<1e-6)return!1;const Te=H.WM.get();if(Te[0]=he[0]-pe[0],Te[1]=he[1]-pe[1],Te[2]=he[2]-pe[2],Math.abs(Te[0])<1e-6&&Math.abs(Te[1])<1e-6&&Math.abs(Te[2])<1e-6)return!1;const me=Me[0]*Ee[0]+Me[1]*Ee[1]+Me[2]*Ee[2],Ce=Ee[0]*Te[0]+Ee[1]*Te[1]+Ee[2]*Te[2],Ie=Me[0]*Te[0]+Me[1]*Te[1]+Me[2]*Te[2],Ge=Ee[0]*Ee[0]+Ee[1]*Ee[1]+Ee[2]*Ee[2],Je=(Te[0]*Te[0]+Te[1]*Te[1]+Te[2]*Te[2])*Ge-Ce*Ce;if(Math.abs(Je)<1e-6)return!1;let xe=(me*Ce-Ie*Ge)/Je,je=(me+Ce*xe)/Ge;ae&&(xe=(0,x.uZ)(xe,0,1),je=(0,x.uZ)(je,0,1));const We=H.WM.get(),Ne=H.WM.get();return We[0]=pe[0]+xe*Te[0],We[1]=pe[1]+xe*Te[1],We[2]=pe[2]+xe*Te[2],Ne[0]=ge[0]+je*Ee[0],Ne[1]=ge[1]+je*Ee[1],Ne[2]=ge[2]+je*Ee[2],de.tA=xe,de.tB=je,de.pA=We,de.pB=Ne,de.distance2=(0,G.d)(We,Ne),!0}const ee={tA:0,tB:0,pA:(0,Q.c)(),pB:(0,Q.c)(),distance2:0},$=new A.x(()=>({origin:null,vector:null}))},13757:(dt,Re,T)=>{"use strict";T.d(Re,{d:()=>A});var x=T(21286);function A(J,W,B){var he;const Z=J.byteLength/(4*W),ie=new Uint32Array(J,0,Z*W);let ue=new Uint32Array(Z);const ce=null!=(he=null==B?void 0:B.minReduction)?he:0,oe=(null==B?void 0:B.originalIndices)||null,le=oe?oe.length:0,Y=(null==B?void 0:B.componentOffsets)||null;let j=0;if(Y)for(let ge=0;ge<Y.length-1;ge++){const ye=Y[ge+1]-Y[ge];ye>j&&(j=ye)}else j=Z;const X=Math.floor(1.1*j)+1;(null==re||re.length<2*X)&&(re=new Uint32Array((0,x.Sf)(2*X)));for(let ge=0;ge<2*X;ge++)re[ge]=0;let U=0;const ee=!!Y&&!!oe,$=ee?le:Z,ne=ee?new Uint32Array(le):null;let ae=0!==ce?Math.ceil(7.84*1.96/(ce*ce)*ce*(1-ce)):$,de=1,_e=Y?Y[1]:$;for(let ge=0;ge<$;ge++){if(ge===ae){const Ce=1-U/ge;if(Ce+1.96*Math.sqrt(Ce*(1-Ce)/ge)<ce)return null;ae*=2}if(ge===_e){for(let Ce=0;Ce<2*X;Ce++)re[Ce]=0;if(oe)for(let Ce=Y[de-1];Ce<Y[de];Ce++)ne[Ce]=ue[oe[Ce]];_e=Y[++de]}const ye=ee?oe[ge]:ge,Me=ye*W,Ee=H(ie,Me,W);let Te=Ee%X,me=U;for(;0!==re[2*Te+1];){if(re[2*Te]===Ee){const Ce=re[2*Te+1]-1;if(G(ie,Me,Ce*W,W)){me=ue[Ce];break}}Te++,Te>=X&&(Te-=X)}me===U&&(re[2*Te]=Ee,re[2*Te+1]=ye+1,U++),ue[ye]=me}if(0!==ce&&1-U/Z<ce)return null;if(ee){for(let ge=Y[de-1];ge<ne.length;ge++)ne[ge]=ue[oe[ge]];ue=ne}const pe=new Uint32Array(W*U);U=0;for(let ge=0;ge<$;ge++)ue[ge]===U&&(Q(ie,(ee?oe[ge]:ge)*W,pe,U*W,W),U++);if(oe&&!ee){const ge=new Uint32Array(le);for(let ye=0;ye<ge.length;ye++)ge[ye]=ue[oe[ye]];ue=ge}return{buffer:pe.buffer,indices:ue,uniqueCount:U}}function G(J,W,B,Z){for(let ie=0;ie<Z;ie++)if(J[W+ie]!==J[B+ie])return!1;return!0}function Q(J,W,B,Z,ie){for(let ue=0;ue<ie;ue++)B[Z+ue]=J[W+ue]}function H(J,W,B){let Z=0;for(let ie=0;ie<B;ie++)Z=J[W+ie]+Z|0,Z=Z+(Z<<11)+(Z>>>2)|0;return Z>>>0}let re=null},65231:(dt,Re,T)=>{"use strict";T.d(Re,{Iz:()=>le,M2:()=>se,To:()=>X,VS:()=>$,XO:()=>j,Yk:()=>Y,w9:()=>ee,wi:()=>ne,zZ:()=>U});var x=T(63290),A=T(62208),G=T(30217),Q=T(550),H=T(43703),re=T(84161),J=T(28093),W=T(55915),B=T(12080),Z=T(37053),ie=T(46367),ue=T(60479),ce=T(79800);const oe=x.Z.getLogger("esri.geometry.support.meshUtils.normalProjection");function le(Te,me,Ce,Ie,Ge){return de(Ie)?(ae(he.TO_PCPF,ue.ct.fromTypedArray(Te),ue.fP.fromTypedArray(me),ue.fP.fromTypedArray(Ce),Ie,ue.ct.fromTypedArray(Ge)),Ge):(oe.error("Cannot convert spatial reference to PCPF"),Ge)}function Y(Te,me,Ce,Ie,Ge){return de(Ie)?(ae(he.FROM_PCPF,ue.ct.fromTypedArray(Te),ue.fP.fromTypedArray(me),ue.fP.fromTypedArray(Ce),Ie,ue.ct.fromTypedArray(Ge)),Ge):(oe.error("Cannot convert to spatial reference from PCPF"),Ge)}function j(Te,me,Ce){return(0,W.CM)(Te,me,0,Ce,(0,B.rS)(me),0,Te.length/3),Ce}function X(Te,me,Ce){return(0,W.CM)(Te,(0,B.rS)(Ce),0,me,Ce,0,Te.length/3),me}function U(Te,me,Ce){if((0,A.Wi)(Te))return me;const Ie=ue.fP.fromTypedArray(Te),Ge=ue.fP.fromTypedArray(me);return(0,ce.t)(Ge,Ie,Ce),me}function ee(Te,me,Ce){if((0,A.Wi)(Te))return me;(0,G.a)(Ee,Ce);const Ie=ue.ct.fromTypedArray(Te),Ge=ue.ct.fromTypedArray(me);return(0,ce.a)(Ge,Ie,Ee),(0,G.i)(Ee)||(0,ce.n)(Ge,Ge),me}function $(Te,me,Ce){if((0,A.Wi)(Te))return me;(0,G.a)(Ee,Ce);const Ie=ue.ct.fromTypedArray(Te,4*Float32Array.BYTES_PER_ELEMENT),Ge=ue.ct.fromTypedArray(me,4*Float32Array.BYTES_PER_ELEMENT);if((0,ce.a)(Ge,Ie,Ee),(0,G.i)(Ee)||(0,ce.n)(Ge,Ge),Te!==me)for(let Je=3;Je<Te.length;Je+=4)me[Je]=Te[Je];return me}function ne(Te,me,Ce,Ie,Ge){if(!de(Ie))return oe.error("Cannot convert spatial reference to PCPF"),Ge;ae(he.TO_PCPF,ue.ct.fromTypedArray(Te,4*Float32Array.BYTES_PER_ELEMENT),ue.fP.fromTypedArray(me),ue.fP.fromTypedArray(Ce),Ie,ue.ct.fromTypedArray(Ge,4*Float32Array.BYTES_PER_ELEMENT));for(let Je=3;Je<Te.length;Je+=4)Ge[Je]=Te[Je];return Ge}function se(Te,me,Ce,Ie,Ge){if(!de(Ie))return oe.error("Cannot convert to spatial reference from PCPF"),Ge;ae(he.FROM_PCPF,ue.ct.fromTypedArray(Te,16),ue.fP.fromTypedArray(me),ue.fP.fromTypedArray(Ce),Ie,ue.ct.fromTypedArray(Ge,16));for(let Je=3;Je<Te.length;Je+=4)Ge[Je]=Te[Je];return Ge}function ae(Te,me,Ce,Ie,Ge,Je){if(!me)return;const xe=Ce.count,je=(0,B.rS)(Ge);if(_e(Ge))for(let We=0;We<xe;We++)Ie.getVec(We,ge),me.getVec(We,ye),(0,W.Bm)(je,ge,Me,je),(0,G.f)(Ee,Me),Te===he.FROM_PCPF&&(0,G.t)(Ee,Ee),(0,re.t)(ye,ye,Ee),Je.setVec(We,ye);else for(let We=0;We<xe;We++){Ie.getVec(We,ge),me.getVec(We,ye),(0,W.Bm)(je,ge,Me,je),(0,G.f)(Ee,Me);const Ne=(0,ie.mZ)(Ce.get(We,1));let we=Math.cos(Ne);Te===he.TO_PCPF&&(we=1/we),Ee[0]*=we,Ee[1]*=we,Ee[2]*=we,Ee[3]*=we,Ee[4]*=we,Ee[5]*=we,Te===he.FROM_PCPF&&(0,G.t)(Ee,Ee),(0,re.t)(ye,ye,Ee),(0,re.n)(ye,ye),Je.setVec(We,ye)}return Je}function de(Te){return _e(Te)||function pe(Te){return Te.isWebMercator}(Te)}function _e(Te){return Te.isWGS84||(0,Z.yW)(Te)||(0,Z.BZ)(Te)||(0,Z.V2)(Te)}var he,Te;(Te=he||(he={}))[Te.TO_PCPF=0]="TO_PCPF",Te[Te.FROM_PCPF=1]="FROM_PCPF";const ge=(0,J.c)(),ye=(0,J.c)(),Me=(0,H.c)(),Ee=(0,Q.c)()},13924:(dt,Re,T)=>{"use strict";T.d(Re,{aX:()=>ye});var x=T(15861),A=T(59318),G=T(26584),Q=T(63290),H=T(62208),re=T(37118),J=T(55214),W=T(74618),B=T(37053),Z=T(46367),ue=(T(29132),T(84792)),ce=T(21726),oe=T(91179);function le(me,Ce,Ie,Ge){return Y.apply(this,arguments)}function Y(){return(Y=(0,x.Z)(function*(me,Ce,Ie,Ge){const Je="string"==typeof me?(0,ce.mN)(me):me,xe=Ce[0].spatialReference,je=yi(or({},Ge),{query:yi(or({},Je.query),{f:"json",sr:JSON.stringify(xe),target:JSON.stringify({geometryType:(0,oe.Ji)(Ce[0]),geometries:Ce}),cutter:JSON.stringify(Ie)})}),We=yield(0,ue.default)(Je.path+"/cut",je),{cutIndexes:Ne,geometries:we=[]}=We.data;return{cutIndexes:Ne,geometries:we.map(Oe=>{const $e=(0,oe.im)(Oe);return $e.spatialReference=xe,$e})}})).apply(this,arguments)}function j(me,Ce,Ie){return X.apply(this,arguments)}function X(){return(X=(0,x.Z)(function*(me,Ce,Ie){const Ge="string"==typeof me?(0,ce.mN)(me):me,Je=Ce[0].spatialReference,xe=(0,oe.Ji)(Ce[0]),je=yi(or({},Ie),{query:yi(or({},Ge.query),{f:"json",sr:Je.wkid?Je.wkid:JSON.stringify(Je),geometries:JSON.stringify(U(Ce))})});return ee((yield(0,ue.default)(Ge.path+"/simplify",je)).data,xe,Je)})).apply(this,arguments)}function U(me){return{geometryType:(0,oe.Ji)(me[0]),geometries:me.map(Ce=>Ce.toJSON())}}function ee(me,Ce,Ie){const Ge=(0,oe.q9)(Ce);return me.map(Je=>{const xe=Ge.fromJSON(Je);return xe.spatialReference=Ie,xe})}const $=Q.Z.getLogger("esri.geometry.support.normalizeUtils");function se(me){return"polygon"===me[0].type}function ae(me){return"polyline"===me[0].type}function pe(me,Ce,Ie){if(Ce){const Ge=function _e(me,Ce){if(!(me instanceof J.Z||me instanceof re.Z)){const Je="straightLineDensify: the input geometry is neither polyline nor polygon";throw $.error(Je),new G.Z(Je)}const Ie=(0,W.x3)(me),Ge=[];for(const Je of Ie){const xe=[];Ge.push(xe),xe.push([Je[0][0],Je[0][1]]);for(let je=0;je<Je.length-1;je++){const We=Je[je][0],Ne=Je[je][1],we=Je[je+1][0],Oe=Je[je+1][1],$e=Math.sqrt((we-We)*(we-We)+(Oe-Ne)*(Oe-Ne)),Be=(Oe-Ne)/$e,Se=(we-We)/$e,De=$e/Ce;if(De>1){for(let qe=1;qe<=De-1;qe++){const be=qe*Ce;xe.push([Se*be+We,Be*be+Ne])}const Fe=($e+Math.floor(De-1)*Ce)/2;xe.push([Se*Fe+We,Be*Fe+Ne])}xe.push([we,Oe])}}return function ne(me){return"polygon"===me.type}(me)?new re.Z({rings:Ge,spatialReference:me.spatialReference}):new J.Z({paths:Ge,spatialReference:me.spatialReference})}(me,1e6);me=(0,Z.Sx)(Ge,!0)}return Ie&&(me=(0,W.Sy)(me,Ie)),me}function he(me,Ce,Ie){if(Array.isArray(me)){const Ge=me[0];if(Ge>Ce){const Je=(0,W.XZ)(Ge,Ce);me[0]=Ge+Je*(-2*Ce)}else if(Ge<Ie){const Je=(0,W.XZ)(Ge,Ie);me[0]=Ge+Je*(-2*Ie)}}else{const Ge=me.x;if(Ge>Ce){const Je=(0,W.XZ)(Ge,Ce);me=me.clone().offset(Je*(-2*Ce),0)}else if(Ge<Ie){const Je=(0,W.XZ)(Ge,Ie);me=me.clone().offset(Je*(-2*Ie),0)}}return me}function ge(me,Ce){let Ie=-1;for(let Ge=0;Ge<Ce.cutIndexes.length;Ge++){const Je=Ce.cutIndexes[Ge],xe=Ce.geometries[Ge],je=(0,W.x3)(xe);for(let We=0;We<je.length;We++){const Ne=je[We];Ne.some(we=>{if(we[0]<180)return!0;{let Oe=0;for(let Be=0;Be<Ne.length;Be++){const Se=Ne[Be][0];Oe=Se>Oe?Se:Oe}Oe=Number(Oe.toFixed(9));const $e=-360*(0,W.XZ)(Oe,180);for(let Be=0;Be<Ne.length;Be++){const Se=xe.getPoint(We,Be);xe.setPoint(We,Be,Se.clone().offset($e,0))}return!0}})}if(Je===Ie){if(se(me))for(const We of(0,W.x3)(xe))me[Je]=me[Je].addRing(We);else if(ae(me))for(const We of(0,W.x3)(xe))me[Je]=me[Je].addPath(We)}else Ie=Je,me[Je]=xe}return me}function ye(me,Ce,Ie){return Me.apply(this,arguments)}function Me(){return(Me=(0,x.Z)(function*(me,Ce,Ie){var tt;if(!Array.isArray(me))return ye([me],Ce);Ce&&"string"!=typeof Ce&&$.warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const Ge="string"==typeof Ce?Ce:null!=(tt=null==Ce?void 0:Ce.url)?tt:A.Z.geometryServiceUrl;let Je,xe,je,We,Ne,we,Oe,$e,Be=0;const Se=[],De=[];for(const Ye of me)if((0,H.Wi)(Ye))De.push(Ye);else if(Je||(Je=Ye.spatialReference,xe=(0,B.C5)(Je),je=Je.isWebMercator,we=je?102100:4326,We=W.UZ[we].maxX,Ne=W.UZ[we].minX,Oe=W.UZ[we].plus180Line,$e=W.UZ[we].minus180Line),xe)if("mesh"===Ye.type)De.push(Ye);else if("point"===Ye.type)De.push(he(Ye.clone(),We,Ne));else if("multipoint"===Ye.type){const ze=Ye.clone();ze.points=ze.points.map(et=>he(et,We,Ne)),De.push(ze)}else if("extent"===Ye.type){const ze=Ye.clone()._normalize(!1,!1,xe);De.push(ze.rings?new re.Z(ze):ze)}else if(Ye.extent){const ze=Ye.extent,et=(0,W.XZ)(ze.xmin,Ne)*(2*We);let ke=0===et?Ye.clone():(0,W.Sy)(Ye.clone(),et);ze.offset(et,0),ze.intersects(Oe)&&ze.xmax!==We?(Be=ze.xmax>Be?ze.xmax:Be,ke=pe(ke,je),Se.push(ke),De.push("cut")):ze.intersects($e)&&ze.xmin!==Ne?(Be=ze.xmax*(2*We)>Be?ze.xmax*(2*We):Be,ke=pe(ke,je,360),Se.push(ke),De.push("cut")):De.push(ke)}else De.push(Ye.clone());else De.push(Ye);let Fe=(0,W.XZ)(Be,We),ve=-90;const Ke=Fe,qe=new J.Z;for(;Fe>0;){const Ye=360*Fe-180;qe.addPath([[Ye,ve],[Ye,-1*ve]]),ve*=-1,Fe--}if(Se.length>0&&Ke>0){const Ye=ge(Se,yield le(Ge,Se,qe,Ie)),ze=[],et=[];for(let at=0;at<De.length;at++){const yt=De[at];if("cut"!==yt)et.push(yt);else{const wt=Ye.shift(),zt=me[at];(0,H.pC)(zt)&&"polygon"===zt.type&&zt.rings&&zt.rings.length>1&&wt.rings.length>=zt.rings.length?(ze.push(wt),et.push("simplify")):et.push(je?(0,Z.$)(wt):wt)}}if(!ze.length)return et;const ke=yield j(Ge,ze,Ie),ot=[];for(let at=0;at<et.length;at++){const yt=et[at];ot.push("simplify"!==yt?yt:je?(0,Z.$)(ke.shift()):ke.shift())}return ot}const be=[];for(let Ye=0;Ye<De.length;Ye++){const ze=De[Ye];if("cut"!==ze)be.push(ze);else{const et=Se.shift();be.push(!0===je?(0,Z.$)(et):et)}}return be})).apply(this,arguments)}},74618:(dt,Re,T)=>{"use strict";T.d(Re,{Sy:()=>re,UZ:()=>Q,XZ:()=>H,x3:()=>J});var x=T(55214),A=T(65234),G=T(91179);const Q={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new x.Z({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:A.Z.WebMercator}),minus180Line:new x.Z({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:A.Z.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new x.Z({paths:[[[180,-180],[180,180]]],spatialReference:A.Z.WGS84}),minus180Line:new x.Z({paths:[[[-180,-180],[-180,180]]],spatialReference:A.Z.WGS84})}};function H(W,B){return Math.ceil((W-B)/(2*B))}function re(W,B){const Z=J(W);for(const ie of Z)for(const ue of ie)ue[0]+=B;return W}function J(W){return(0,G.oU)(W)?W.rings:W.paths}},90014:(dt,Re,T)=>{"use strict";T.d(Re,{$I:()=>j,Ac:()=>Te,BR:()=>he,Er:()=>Ge,JG:()=>ie,Oy:()=>ce,T5:()=>ae,U4:()=>Ce,Ue:()=>B,Yq:()=>oe,_l:()=>je,al:()=>ue,dZ:()=>ye,fn:()=>pe,jH:()=>Ne,mJ:()=>Oe,my:()=>_e,nF:()=>Je,oq:()=>Ie,re:()=>Z,rx:()=>ge,tk:()=>de,tx:()=>xe,zk:()=>le});var x=T(21286),A=T(62208),G=T(84161),Q=T(28093),re=(T(97126),T(34054)),J=T(26242),W=T(98943);function B(Fe=$e){return[Fe[0],Fe[1],Fe[2],Fe[3]]}function Z(Fe=$e[0],ve=$e[1],Ke=$e[2],qe=$e[3]){return ue(Fe,ve,Ke,qe,J.o6.get())}function ie(Fe,ve){return ue(ve[0],ve[1],ve[2],ve[3],Fe)}function ue(Fe,ve,Ke,qe,be=B()){return be[0]=Fe,be[1]=ve,be[2]=Ke,be[3]=qe,be}function ce(Fe,ve,Ke){return(0,G.c)(Ke,Fe),Ke[3]=ve,Ke}function oe(Fe,ve,Ke){const qe=ve[0]*ve[0]+ve[1]*ve[1]+ve[2]*ve[2],be=Math.abs(qe-1)>1e-5&&qe>1e-12?1/Math.sqrt(qe):1;return Ke[0]=ve[0]*be,Ke[1]=ve[1]*be,Ke[2]=ve[2]*be,Ke[3]=-(Ke[0]*Fe[0]+Ke[1]*Fe[1]+Ke[2]*Fe[2]),Ke}function le(Fe,ve,Ke,qe=B()){const be=Ke[0]-ve[0],tt=Ke[1]-ve[1],Ye=Ke[2]-ve[2],ze=Fe[0]-ve[0],et=Fe[1]-ve[1],ke=Fe[2]-ve[2],ot=tt*ke-Ye*et,at=Ye*ze-be*ke,yt=be*et-tt*ze,wt=ot*ot+at*at+yt*yt,zt=Math.abs(wt-1)>1e-5&&wt>1e-12?1/Math.sqrt(wt):1;return qe[0]=ot*zt,qe[1]=at*zt,qe[2]=yt*zt,qe[3]=-(qe[0]*Fe[0]+qe[1]*Fe[1]+qe[2]*Fe[2]),qe}function j(Fe,ve,Ke,qe,be){if(Fe.count<3)return!1;Fe.getVec(Ke,U);let tt=qe,Ye=!1;for(;tt<Fe.count-1&&!Ye;)Fe.getVec(tt,ee),tt++,Ye=!(0,G.k)(U,ee);if(!Ye)return!1;for(tt=Math.max(tt,be),Ye=!1;tt<Fe.count&&!Ye;)Fe.getVec(tt,$),tt++,(0,G.b)(ne,U,ee),(0,G.n)(ne,ne),(0,G.b)(se,ee,$),(0,G.n)(se,se),Ye=!(0,G.k)(U,$)&&!(0,G.k)(ee,$)&&Math.abs((0,G.e)(ne,se))<X;return Ye?(le(U,ee,$,ve),!0):(0!==Ke||1!==qe||2!==be)&&j(Fe,ve,0,1,2)}const X=.99619469809,U=(0,Q.c)(),ee=(0,Q.c)(),$=(0,Q.c)(),ne=(0,Q.c)(),se=(0,Q.c)();function ae(Fe,ve,Ke){return ve!==Fe&&ie(Fe,ve),Fe[3]=-(0,G.e)(Fe,Ke),Fe}function de(Fe,ve){return ve[0]=-Fe[0],ve[1]=-Fe[1],ve[2]=-Fe[2],ve[3]=-Fe[3],ve}function _e(Fe,ve,Ke,qe){return(0,G.f)($,ve,Fe),oe(Ke,$,qe)}function pe(Fe,ve,Ke,qe){return we(Fe,ve,(0,G.b)(J.WM.get(),Ke,ve),Se,qe)}function he(Fe,ve,Ke){return!!(0,A.pC)(ve)&&we(Fe,ve.origin,ve.direction,De,Ke)}function ge(Fe,ve,Ke){return we(Fe,ve.origin,ve.vector,Be.NONE,Ke)}function ye(Fe,ve,Ke){return we(Fe,ve.origin,ve.vector,Be.CLAMP,Ke)}function Te(Fe,ve){return Ne(Fe,ve)>=0}function Ce(Fe,ve){return Fe[0]*(Fe[0]>0?ve[0]:ve[3])+Fe[1]*(Fe[1]>0?ve[1]:ve[4])+Fe[2]*(Fe[2]>0?ve[2]:ve[5])+Fe[3]>=0}function Ie(Fe,ve){const Ke=(0,G.e)(Fe,ve.ray.direction),qe=-Ne(Fe,ve.ray.origin);if(qe<0&&Ke>=0)return!1;if(Ke>-1e-6&&Ke<1e-6)return qe>0;if((qe<0||Ke<0)&&!(qe<0&&Ke<0))return!0;const be=qe/Ke;return Ke>0?be<ve.c1&&(ve.c1=be):be>ve.c0&&(ve.c0=be),ve.c0<=ve.c1}function Ge(Fe,ve){const Ke=(0,G.e)(Fe,ve.ray.direction),qe=-Ne(Fe,ve.ray.origin);if(Ke>-1e-6&&Ke<1e-6)return qe>0;const be=qe/Ke;return Ke>0?be<ve.c1&&(ve.c1=be):be>ve.c0&&(ve.c0=be),ve.c0<=ve.c1}function Je(Fe,ve,Ke){const qe=(0,G.g)(J.WM.get(),Fe,-Fe[3]),be=je(Fe,(0,G.b)(J.WM.get(),ve,qe),J.WM.get());return(0,G.a)(Ke,be,qe),Ke}function xe(Fe,ve,Ke,qe){const be=Fe,tt=J.WM.get(),Ye=J.WM.get();(0,W._F)(be,tt,Ye);const ze=(0,G.b)(J.WM.get(),Ke,ve),et=(0,re.SR)(tt,ze),ke=(0,re.SR)(Ye,ze),ot=(0,re.SR)(be,ze);return(0,G.s)(qe,et,ke,ot)}function je(Fe,ve,Ke){const qe=(0,G.g)(J.WM.get(),Fe,(0,G.e)(Fe,ve));return(0,G.b)(Ke,ve,qe),Ke}function Ne(Fe,ve){return(0,G.e)(Fe,ve)+Fe[3]}function we(Fe,ve,Ke,qe,be){const tt=(0,G.e)(Fe,Ke);if(0===tt)return!1;let Ye=-((0,G.e)(Fe,ve)+Fe[3])/tt;return qe&Be.CLAMP&&(Ye=(0,x.uZ)(Ye,0,1)),!(!(qe&Be.INFINITE_MIN)&&Ye<0||!(qe&Be.INFINITE_MAX)&&Ye>1||((0,G.a)(be,ve,(0,G.g)(be,Ke,Ye)),0))}function Oe(Fe){return Fe}const $e=[0,0,1,0];var Be,Fe;(Fe=Be||(Be={}))[Fe.NONE=0]="NONE",Fe[Fe.CLAMP=1]="CLAMP",Fe[Fe.INFINITE_MIN=4]="INFINITE_MIN",Fe[Fe.INFINITE_MAX=8]="INFINITE_MAX";const Se=Be.INFINITE_MIN|Be.INFINITE_MAX,De=Be.INFINITE_MAX},7848:(dt,Re,T)=>{"use strict";T.d(Re,{G6:()=>xe,Ie:()=>Je,J9:()=>Ie,RF:()=>Me,U1:()=>Ge,vY:()=>J});var x=T(62208);T(91179);const Q=(je,We,Ne)=>[We,Ne],H=(je,We,Ne)=>[We,Ne,je[2]],re=(je,We,Ne)=>[We,Ne,je[2],je[3]];function J(je){return je?{originPosition:"upper-left"===je.originPosition?"upperLeft":"lower-left"===je.originPosition?"lowerLeft":je.originPosition,scale:je.tolerance?[je.tolerance,je.tolerance]:[1,1],translate:(0,x.pC)(je.extent)?[je.extent.xmin,je.extent.ymax]:[0,0]}:null}function Y({scale:je,translate:We},Ne){return Ne*je[0]+We[0]}function j({scale:je,translate:We},Ne){return We[1]-Ne*je[1]}function X(je,We,Ne){const we=new Array(Ne.length);if(!Ne.length)return we;const[Oe,$e]=je.scale;let Be=Y(je,Ne[0][0]),Se=j(je,Ne[0][1]);we[0]=We(Ne[0],Be,Se);for(let De=1;De<Ne.length;De++){const Fe=Ne[De];Be+=Fe[0]*Oe,Se-=Fe[1]*$e,we[De]=We(Fe,Be,Se)}return we}function U(je,We,Ne){const we=new Array(Ne.length);for(let Oe=0;Oe<Ne.length;Oe++)we[Oe]=X(je,We,Ne[Oe]);return we}function Me(je,We,Ne,we,Oe){return We.x=function B({scale:je,translate:We},Ne){return Math.round((Ne-We[0])/je[0])}(je,Ne.x),We.y=function Z({scale:je,translate:We},Ne){return Math.round((We[1]-Ne)/je[1])}(je,Ne.y),We!==Ne&&(we&&(We.z=Ne.z),Oe&&(We.m=Ne.m)),We}function Ie(je,We,Ne,we,Oe){return(0,x.pC)(Ne)&&(We.points=function $(je,We,Ne,we){return X(je,Ne?we?re:H:we?H:Q,We)}(je,Ne.points,we,Oe)),We}function Ge(je,We,Ne,we,Oe){return(0,x.Wi)(Ne)||(We.x=Y(je,Ne.x),We.y=j(je,Ne.y),We!==Ne&&(we&&(We.z=Ne.z),Oe&&(We.m=Ne.m))),We}function Je(je,We,Ne,we,Oe){return(0,x.pC)(Ne)&&(We.rings=function se(je,We,Ne,we){return U(je,Ne?we?re:H:we?H:Q,We)}(je,Ne.rings,we,Oe)),We}function xe(je,We,Ne,we,Oe){return(0,x.pC)(Ne)&&(We.paths=function ne(je,We,Ne,we){return U(je,Ne?we?re:H:we?H:Q,We)}(je,Ne.paths,we,Oe)),We}},70562:(dt,Re,T)=>{"use strict";T.d(Re,{JG:()=>B,JI:()=>oe,Jk:()=>ue,Ue:()=>re,al:()=>ie,fS:()=>J,re:()=>W,zk:()=>Z});var x=T(85931),A=T(97535),G=T(84161),Q=T(28093),H=T(26242);function re(j){return j?{origin:(0,Q.a)(j.origin),direction:(0,Q.a)(j.direction)}:{origin:(0,Q.c)(),direction:(0,Q.c)()}}function J(j,X){return(0,x.fS)(j.origin,X.origin)&&(0,x.fS)(j.direction,X.direction)}function W(j,X){const U=Y.get();return U.origin=j,U.direction=X,U}function B(j,X=re()){return ie(j.origin,j.direction,X)}function Z(j,X,U=re()){return(0,G.c)(U.origin,j),(0,G.b)(U.direction,X,j),U}function ie(j,X,U=re()){return(0,G.c)(U.origin,j),(0,G.c)(U.direction,X),U}function ue(j,X){const U=(0,G.f)(H.WM.get(),(0,G.n)(H.WM.get(),j.direction),(0,G.b)(H.WM.get(),X,j.origin));return(0,G.e)(U,U)}function oe(j,X,U){const ee=(0,G.e)(j.direction,(0,G.b)(U,X,j.origin));return(0,G.a)(U,j.origin,(0,G.g)(U,j.direction,ee)),U}const Y=new A.x(function le(){return{origin:null,direction:null}})},83137:(dt,Re,T)=>{"use strict";T.d(Re,{D9:()=>re,dp:()=>Q,yZ:()=>G});var x=T(16730);function G(J,W){const B=W||J.extent,Z=J.width,ie=(0,x.c9)(B&&B.spatialReference);return B&&Z?B.width/Z*ie*x.hd*96:0}function Q(J,W){return J/((0,x.c9)(W)*x.hd*96)}function re(J,W){const B=J.extent,Z=J.width,ie=Q(W,B.spatialReference);return B.clone().expand(ie*Z/B.width)}},37053:(dt,Re,T)=>{"use strict";T.d(Re,{BZ:()=>ee,C5:()=>ue,JY:()=>ae,ME:()=>$,MP:()=>se,N$:()=>oe,QM:()=>X,R_:()=>_e,V2:()=>ne,WR:()=>pe,Zn:()=>de,fS:()=>ie,o$:()=>U,oR:()=>le,sS:()=>j,sT:()=>ce,yW:()=>Y});var x=T(62208),A=T(77275),G=T(6178),Q=T(84029);const H={102113:!0,102100:!0,3857:!0,3785:!0},re={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},J='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',W=[-20037508.342788905,20037508.342788905],B=[-20037508.342787,20037508.342787],Z={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:W,origin:B,dx:1e-5},102100:{wkTemplate:J,valid:W,origin:B,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:W,origin:B,dx:1e-5},3857:{wkTemplate:J,valid:W,origin:B,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function ie(he,ge){return!(0,x.Wi)(he)&&!(0,x.Wi)(ge)&&(he===ge||(null!=he.wkid||null!=ge.wkid?he.wkid===ge.wkid||j(he)&&j(ge)||null!=ge.latestWkid&&he.wkid===ge.latestWkid||null!=he.latestWkid&&ge.wkid===he.latestWkid:!(!he.wkt||!ge.wkt)&&he.wkt.toUpperCase()===ge.wkt.toUpperCase()))}function ue(he){return ae(he)&&he.wkid&&Z[he.wkid]||null}function ce(he){return!!ae(he)&&(he.wkid?null==Q.Z[he.wkid]:!!he.wkt&&!!/^\s*GEOGCS/i.test(he.wkt))}function oe(he){return!(ee(he)||ne(he))}function le(he){return ae(he)&&4326===he.wkid}function Y(he){return ae(he)&&he.wkid===G.W.CGCS2000}function j(he){return ae(he)&&null!=he.wkid&&!0===H[he.wkid]}function X(he){return ae(he)&&32662===he.wkid}function U(he){return he===G.W.GCSMARS2000||he===G.W.GCSMARS2000_SPHERE}function ee(he){return ae(he)&&null!=he.wkid&&U(he.wkid)}function $(he){return he===G.W.GCSMOON2000}function ne(he){return ae(he)&&null!=he.wkid&&$(he.wkid)}function se(he){return ae(he)&&null!=he.wkid&&!0===re[he.wkid]}function ae(he){return(0,x.pC)(he)&&(null!=he.wkid&&he.wkid>=2e3||null!=he.wkt)}const de={wkid:4326,wkt:(0,A.gx)(Z[4326].wkTemplate,{Central_Meridian:"0.0"})},_e={wkid:102100,latestWkid:3857},pe={wkid:32662}},11544:(dt,Re,T)=>{"use strict";T.d(Re,{bE:()=>oe,wu:()=>ue});var x=T(97535),A=T(84161),G=T(28093),Q=T(13777);function ue(U,ee,$){return.5*Math.abs((ee[0]-U[0])*($[1]-U[1])-(ee[1]-U[1])*($[0]-U[0]))}function oe(U,ee,$){return(0,A.b)(j,ee,U),(0,A.b)(X,$,U),(0,A.l)((0,A.f)(j,j,X))/2}T(26242),new x.x(Q.Ue),new x.x(()=>({p0:null,p1:null,p2:null}));const j=(0,G.c)(),X=(0,G.c)()},85334:(dt,Re,T)=>{"use strict";T.d(Re,{Mk:()=>re,ZI:()=>B,bT:()=>Q});var B,Z,x=T(11915),A=T(25748),G=T(13757);function Q(Z){const ie=re(Z.rings,Z.hasZ,B.CCW_IS_HOLE),ue=[];let ce=0,oe=0;for(const j of ie.polygons){const U=j.index,ee=new Float64Array(ie.position.buffer,3*U*ie.position.BYTES_PER_ELEMENT,3*j.count),$=j.holeIndices.map(se=>se-U),ne=new Uint32Array((0,x.e)(ee,$,3));ue.push({position:ee,faces:ne}),ce+=ee.length,oe+=ne.length}const le=function H(Z,ie,ue){if(1===Z.length)return Z[0];const ce=new Float64Array(ie),oe=new Uint32Array(ue);let le=0,Y=0,j=0;for(const X of Z){for(let U=0;U<X.position.length;U++)ce[le++]=X.position[U];for(let U=0;U<X.faces.length;U++)oe[Y++]=X.faces[U]+j;j=le/3}return{position:ce,faces:oe}}(ue,ce,oe),Y=(0,G.d)(le.position.buffer,6,{originalIndices:le.faces});return le.position=new Float64Array(Y.buffer),le.faces=Y.indices,le}function re(Z,ie,ue){const ce=Z.length,oe=new Array(ce),le=new Array(ce),Y=new Array(ce);let j=0,X=0,U=0,ee=0;for(let se=0;se<ce;++se)ee+=Z[se].length;const $=new Float64Array(3*ee);let ne=0;for(let se=ce-1;se>=0;se--){const ae=Z[se],de=ue===B.CCW_IS_HOLE&&W(ae);if(de&&1!==ce)oe[j++]=ae;else{let _e=ae.length;for(let he=0;he<j;++he)_e+=oe[he].length;const pe={index:ne,pathLengths:new Array(j+1),count:_e,holeIndices:new Array(j)};pe.pathLengths[0]=ae.length,ae.length>0&&(Y[U++]={index:ne,count:ae.length}),ne=de?J(ae,ae.length-1,-1,$,ne,ae.length,ie):J(ae,0,1,$,ne,ae.length,ie);for(let he=0;he<j;++he){const ge=oe[he];pe.holeIndices[he]=ne,pe.pathLengths[he+1]=ge.length,ge.length>0&&(Y[U++]={index:ne,count:ge.length}),ne=J(ge,0,1,$,ne,ge.length,ie)}j=0,pe.count>0&&(le[X++]=pe)}}for(let se=0;se<j;++se){const ae=oe[se];ae.length>0&&(Y[U++]={index:ne,count:ae.length}),ne=J(ae,0,1,$,ne,ae.length,ie)}return X<ce&&(le.length=X),U<ce&&(Y.length=U),{position:$,polygons:le,outlines:Y}}function J(Z,ie,ue,ce,oe,le,Y){oe*=3;for(let j=0;j<le;++j){const X=Z[ie];ce[oe++]=X[0],ce[oe++]=X[1],ce[oe++]=Y?X[2]:0,ie+=ue}return oe/3}function W(Z){return!(0,A.bu)(Z,!1,!1)}(Z=B||(B={}))[Z.NONE=0]="NONE",Z[Z.CCW_IS_HOLE=1]="CCW_IS_HOLE"},71774:(dt,Re,T)=>{"use strict";T.d(Re,{Mk:()=>G,P$:()=>Q});var x=T(2076);const G=(0,x.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),Q=(0,x.w)()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"})},34054:(dt,Re,T)=>{"use strict";T.d(Re,{EU:()=>re,SR:()=>H,cp:()=>J,nF:()=>Q});var x=T(21286),A=T(84161),G=T(28093);function Q(Z,ie,ue){const ce=(0,A.e)(Z,ie)/(0,A.e)(Z,Z);return(0,A.g)(ue,Z,ce)}function H(Z,ie){return(0,A.e)(Z,ie)/(0,A.l)(Z)}function re(Z,ie){const ue=(0,A.e)(Z,ie)/((0,A.l)(Z)*(0,A.l)(ie));return-(0,x.ZF)(ue)}function J(Z,ie,ue){(0,A.n)(W,Z),(0,A.n)(B,ie);const ce=(0,A.e)(W,B),oe=(0,x.ZF)(ce),le=(0,A.f)(W,W,B);return(0,A.e)(le,ue)<0?2*Math.PI-oe:oe}const W=(0,G.c)(),B=(0,G.c)()},26242:(dt,Re,T)=>{"use strict";T.d(Re,{MP:()=>le,vD:()=>Y,qW:()=>ie,WM:()=>ue,o6:()=>ce});var x=T(27306),A=T(79682),G=T(550),Q=T(43703),H=T(78451),re=T(99770),J=T(28093),W=T(4794);class B{constructor(X,U,ee){this.itemByteSize=X,this.itemCreate=U,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(ee/this.itemByteSize)}get(){0===this._itemsPtr&&(0,A.Y)(()=>this._reset());const X=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=X;){const U=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let ee=0;ee<this._itemsPerBuffer;++ee)this._items.push(this.itemCreate(U,ee*this.itemByteSize));this._buffers.push(U)}return this._items[this._itemsPtr++]}_reset(){const X=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>X;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(X=Z){return new B(16,re.c,X)}static createVec3f64(X=Z){return new B(24,J.b,X)}static createVec4f64(X=Z){return new B(32,W.a,X)}static createMat3f64(X=Z){return new B(72,G.a,X)}static createMat4f64(X=Z){return new B(128,Q.a,X)}static createQuatf64(X=Z){return new B(32,H.c,X)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}const Z=4*x.Y8.KILOBYTES,ie=B.createVec2f64(),ue=B.createVec3f64(),ce=B.createVec4f64(),le=(B.createMat3f64(),B.createMat4f64()),Y=B.createQuatf64()},46367:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>U,Q8:()=>le,R6:()=>X,Sx:()=>ee,hG:()=>j,iV:()=>Y,mZ:()=>ie,tp:()=>Z});var x=T(58817),A=T(62208),G=T(65234),Q=T(94425),H=T(37053);function W($){return 57.29577951308232*$}function B($){return.017453292519943*$}function Z($){return $/Q.sv.radius}function ie($){return Math.PI/2-2*Math.atan(Math.exp(-$/Q.sv.radius))}function ue($){return null!=$.wkid||null!=$.wkt}const ce=[0,0];function oe($,ne,se,ae,de){const _e=$,pe=de;if(pe.spatialReference=se,"x"in _e&&"x"in pe)[pe.x,pe.y]=ne(_e.x,_e.y,ce,ae);else if("xmin"in _e&&"xmin"in pe)[pe.xmin,pe.ymin]=ne(_e.xmin,_e.ymin,ce,ae),[pe.xmax,pe.ymax]=ne(_e.xmax,_e.ymax,ce,ae);else if("paths"in _e&&"paths"in pe||"rings"in _e&&"rings"in pe){const he="paths"in _e?_e.paths:_e.rings,ge=[];let ye;for(let Me=0;Me<he.length;Me++){const Ee=he[Me];ye=[],ge.push(ye);for(let Te=0;Te<Ee.length;Te++)ye.push(ne(Ee[Te][0],Ee[Te][1],[0,0],ae)),Ee[Te].length>2&&ye[Te].push(Ee[Te][2]),Ee[Te].length>3&&ye[Te].push(Ee[Te][3])}"paths"in pe?pe.paths=ge:pe.rings=ge}else if("points"in _e&&"points"in pe){const he=_e.points,ge=[];for(let ye=0;ye<he.length;ye++)ge[ye]=ne(he[ye][0],he[ye][1],[0,0],ae),he[ye].length>2&&ge[ye].push(he[ye][2]),he[ye].length>3&&ge[ye].push(he[ye][3]);pe.points=ge}return de}function le($,ne){const se=$&&(ue($)?$:$.spatialReference),ae=ne&&(ue(ne)?ne:ne.spatialReference);return!($&&"type"in $&&"mesh"===$.type||ne&&"type"in ne&&"mesh"===ne.type||!se||!ae)&&(!!(0,H.fS)(ae,se)||(0,H.sS)(ae)&&(0,H.oR)(se)||(0,H.sS)(se)&&(0,H.oR)(ae))}function Y($,ne){if((0,A.Wi)($))return null;const se=$.spatialReference,ae=ne&&(ue(ne)?ne:ne.spatialReference);return le(se,ae)?(0,H.fS)(se,ae)?(0,x.d9)($):(0,H.sS)(ae)?oe($,j,G.Z.WebMercator,!1,(0,x.d9)($)):(0,H.oR)(ae)?oe($,X,G.Z.WGS84,!1,(0,x.d9)($)):null:null}function j($,ne,se=[0,0]){ne>89.99999?ne=89.99999:ne<-89.99999&&(ne=-89.99999);const ae=B(ne);return se[0]=B($)*Q.sv.radius,se[1]=Q.sv.halfSemiMajorAxis*Math.log((1+Math.sin(ae))/(1-Math.sin(ae))),se}function X($,ne,se=[0,0],ae=!1){const de=W($/Q.sv.radius);return se[0]=ae?de:de-360*Math.floor((de+180)/360),se[1]=W(Math.PI/2-2*Math.atan(Math.exp(-ne/Q.sv.radius))),se}function U($,ne=!1,se=(0,x.d9)($)){return oe($,j,G.Z.WebMercator,ne,se)}function ee($,ne=!1,se=(0,x.d9)($)){return oe($,X,G.Z.WGS84,ne,se)}},18945:(dt,Re,T)=>{"use strict";function x(A,G,Q=!1){let{hasM:H,hasZ:re}=A;Array.isArray(G)?4!==G.length||H||re?3===G.length&&Q&&!H?(re=!0,H=!1):3===G.length&&H&&re&&(H=!1,re=!1):(H=!0,re=!0):(re=!re&&G.hasZ&&(!H||G.hasM),H=!H&&G.hasM&&(!re||G.hasZ)),A.hasZ=re,A.hasM=H}T.d(Re,{l:()=>x})},33696:(dt,Re,T)=>{"use strict";T.d(Re,{k:()=>Q});var x=T(62208),A=T(16730),G=T(37053);function Q(Z,ie,ue){if((0,x.Wi)(ie)||(0,x.Wi)(ue)||ue.vcsWkid||(0,G.fS)(ie,ue))return null;const ce=(0,A._R)(ie)/(0,A._R)(ue);if(1===ce)return null;switch(Z){case"point":case"esriGeometryPoint":return oe=>function H(Z,ie){Z&&null!=Z.z&&(Z.z*=ie)}(oe,ce);case"polyline":case"esriGeometryPolyline":return oe=>function J(Z,ie){if(Z)for(const ue of Z.paths)for(const ce of ue)ce.length>2&&(ce[2]*=ie)}(oe,ce);case"polygon":case"esriGeometryPolygon":return oe=>function re(Z,ie){if(Z)for(const ue of Z.rings)for(const ce of ue)ce.length>2&&(ce[2]*=ie)}(oe,ce);case"multipoint":case"esriGeometryMultipoint":return oe=>function W(Z,ie){if(Z)for(const ue of Z.points)ue.length>2&&(ue[2]*=ie)}(oe,ce);case"extent":case"esriGeometryExtent":return oe=>function B(Z,ie){Z&&null!=Z.zmin&&null!=Z.zmax&&(Z.zmin*=ie,Z.zmax*=ie)}(oe,ce);default:return null}}},52515:(dt,Re,T)=>{"use strict";T(88411),T(15348),T(97059),T(56683);var H=T(41840),re=T(15861),J=T(84792),W=T(26584),B=T(62208);function ie(){return(ie=(0,re.Z)(function*(X,U,ee,$){const ne=U.exec(ee);if(!ne)throw new W.Z("esri-intl:invalid-bundle",`Bundle id "${ee}" is not compatible with the pattern "${U}"`);const se=ne[1]?`${ne[1]}/`:"",ae=ne[2],de=(0,H.Su)($),_e=`${se}${ae}.json`,pe=de?`${se}${ae}_${de}.json`:_e;let he;try{he=yield ue(X(pe))}catch(ge){if(pe===_e)throw new W.Z("intl:unknown-bundle",`Bundle "${ee}" cannot be loaded`,{error:ge});try{he=yield ue(X(_e))}catch(ye){throw new W.Z("intl:unknown-bundle",`Bundle "${ee}" cannot be loaded`,{error:ye})}}return he})).apply(this,arguments)}function ue(X){return ce.apply(this,arguments)}function ce(){return(ce=(0,re.Z)(function*(X){if((0,B.pC)(Y.fetchBundleAsset))return Y.fetchBundleAsset(X);const U=yield(0,J.default)(X,{responseType:"text"});return JSON.parse(U.data)})).apply(this,arguments)}class oe{constructor({base:U="",pattern:ee,location:$=new URL(window.location.href)}){let ne;ne="string"==typeof $?se=>new URL(se,new URL($,window.location.href)).href:$ instanceof URL?se=>new URL(se,$).href:$,this.pattern="string"==typeof ee?new RegExp(`^${ee}`):ee,this.getAssetUrl=ne,U=U?U.endsWith("/")?U:U+"/":"",this.matcher=new RegExp(`^${U}(?:(.*)/)?(.*)$`)}fetchMessageBundle(U,ee){return function Z(X,U,ee,$){return ie.apply(this,arguments)}(this.getAssetUrl,this.matcher,U,ee)}}const Y={};var j=T(54346);(0,H.tz)(function le(X){return new oe(X)}({pattern:"esri/",location:j.V}))},88411:(dt,Re,T)=>{"use strict";T.d(Re,{Sh:()=>j,Ze:()=>X,p6:()=>U});var x=T(2076),A=T(56683);const G={year:"numeric",month:"numeric",day:"numeric"},Q={year:"numeric",month:"long",day:"numeric"},H={year:"numeric",month:"short",day:"numeric"},re={year:"numeric",month:"long",weekday:"long",day:"numeric"},J={hour:"numeric",minute:"numeric"},W=yi(or({},J),{second:"numeric"}),B={"short-date":G,"short-date-short-time":or(or({},G),J),"short-date-short-time-24":yi(or(or({},G),J),{hour12:!1}),"short-date-long-time":or(or({},G),W),"short-date-long-time-24":yi(or(or({},G),W),{hour12:!1}),"short-date-le":G,"short-date-le-short-time":or(or({},G),J),"short-date-le-short-time-24":yi(or(or({},G),J),{hour12:!1}),"short-date-le-long-time":or(or({},G),W),"short-date-le-long-time-24":yi(or(or({},G),W),{hour12:!1}),"long-month-day-year":Q,"long-month-day-year-short-time":or(or({},Q),J),"long-month-day-year-short-time-24":yi(or(or({},Q),J),{hour12:!1}),"long-month-day-year-long-time":or(or({},Q),W),"long-month-day-year-long-time-24":yi(or(or({},Q),W),{hour12:!1}),"day-short-month-year":H,"day-short-month-year-short-time":or(or({},H),J),"day-short-month-year-short-time-24":yi(or(or({},H),J),{hour12:!1}),"day-short-month-year-long-time":or(or({},H),W),"day-short-month-year-long-time-24":yi(or(or({},H),W),{hour12:!1}),"long-date":re,"long-date-short-time":or(or({},re),J),"long-date-short-time-24":yi(or(or({},re),J),{hour12:!1}),"long-date-long-time":or(or({},re),W),"long-date-long-time-24":yi(or(or({},re),W),{hour12:!1}),"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":J,"long-time":W},Z=(0,x.w)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),oe=(Z.toJSON.bind(Z),Z.fromJSON.bind(Z),{ar:"ar-u-nu-latn-ca-gregory"});let le=new WeakMap,Y=B["short-date-short-time"];function j(ee){const $=ee||Y;if(!le.has($)){const ne=(0,A.Kd)(),se=oe[(0,A.Kd)()]||ne;le.set($,new Intl.DateTimeFormat(se,$))}return le.get($)}function X(ee){return B[ee]||null}function U(ee,$){return j($).format(ee)}(0,A.Ze)(()=>{le=new WeakMap,Y=B["short-date-short-time"]})},56683:(dt,Re,T)=>{var le,Y,j,X;let A;T.d(Re,{G3:()=>J,Kd:()=>H,Ze:()=>ce,qe:()=>ie});const G=null!=(j=null==(le=globalThis.esriConfig)?void 0:le.locale)?j:null==(Y=globalThis.dojoConfig)?void 0:Y.locale;function Q(){var U,ee;return null!=(ee=null!=G?G:null==(U=globalThis.navigator)?void 0:U.language)?ee:"en"}function H(){return void 0===A&&(A=Q()),A}function J(U=H()){var ee;return null==(ee=/^([a-zA-Z]{2,3})(?:[_\-]\w+)*$/.exec(U))?void 0:ee[1].toLowerCase()}const Z=[];function ie(U){return Z.push(U),{remove(){Z.splice(Z.indexOf(U),1)}}}const ue=[];function ce(U){return ue.push(U),{remove(){Z.splice(ue.indexOf(U),1)}}}null==(X=globalThis.addEventListener)||X.call(globalThis,"languagechange",function oe(){const U=Q();A!==U&&(A=U,[...ue].forEach(ee=>{ee.call(null,U)}),[...Z].forEach(ee=>{ee.call(null,U)}))})},41840:(dt,Re,T)=>{"use strict";T.d(Re,{ME:()=>ue,Su:()=>oe,tz:()=>ie});var x=T(15861),A=T(26584),G=T(10699),Q=T(56683);const H=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,re={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function J(ee){var $;return null!=($=re[ee])&&$}const W=[],B=new Map;function Z(ee){for(const $ of B.keys())j(ee.pattern,$)&&B.delete($)}function ie(ee){return W.includes(ee)||(Z(ee),W.unshift(ee)),{remove(){const $=W.indexOf(ee);$>-1&&(W.splice($,1),Z(ee))}}}function ue(ee){return ce.apply(this,arguments)}function ce(){return(ce=(0,x.Z)(function*(ee){const $=(0,Q.Kd)();B.has(ee)||B.set(ee,le(ee,$));const ne=B.get(ee);return yield X.add(ne),ne})).apply(this,arguments)}function oe(ee){if(!H.test(ee))return null;const[,$,ne]=H.exec(ee),se=$+(ne?"-"+ne.toUpperCase():"");return J(se)?se:J($)?$:null}function le(ee,$){return Y.apply(this,arguments)}function Y(){return(Y=(0,x.Z)(function*(ee,$){const ne=[];for(const se of W)if(j(se.pattern,ee))try{return yield se.fetchMessageBundle(ee,$)}catch(ae){ne.push(ae)}throw ne.length?new A.Z("intl:message-bundle-error",`Errors occurred while loading "${ee}"`,{errors:ne}):new A.Z("intl:no-message-bundle-loader",`No loader found for message bundle "${ee}"`)})).apply(this,arguments)}function j(ee,$){return"string"==typeof ee?$.startsWith(ee):ee.test($)}(0,Q.Ze)(()=>{B.clear()});const X=new class{constructor(){this._numLoading=0}waitForAll(){var ee=this;return(0,x.Z)(function*(){ee._dfd&&(yield ee._dfd.promise)})()}add(ee){return this._increase(),ee.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=(0,G.dD)())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}}},15348:(dt,Re,T)=>{"use strict";T.d(Re,{sh:()=>J,uf:()=>W});var x=T(62208),A=T(56683);const G={ar:"ar-u-nu-latn"};let Q=new WeakMap,H={};function J(B={}){const Z={};return null!=B.digitSeparator&&(Z.useGrouping=B.digitSeparator),null!=B.places&&(Z.minimumFractionDigits=Z.maximumFractionDigits=B.places),Z}function W(B,Z){return-0===B&&(B=0),function re(B){const Z=B||H;if(!Q.has(Z)){const ie=(0,A.Kd)(),ue=G[(0,A.Kd)()]||ie;Q.set(Z,new Intl.NumberFormat(ue,B))}return(0,x.j0)(Q.get(Z))}(Z).format(B)}(0,A.Ze)(()=>{Q=new WeakMap,H={}})},97059:(dt,Re,T)=>{"use strict";T.d(Re,{n:()=>J});var x=T(63290),A=T(94113),G=T(77275),Q=T(88411),H=T(15348);const re=x.Z.getLogger("esri.intl");function J(ue,ce,oe={}){const{format:le={}}=oe;return(0,G.gx)(ue,Y=>function W(ue,ce,oe){let le,Y;const j=ue.indexOf(":");if(-1===j?le=ue.trim():(le=ue.slice(0,j).trim(),Y=ue.slice(j+1).trim()),!le)return"";const X=(0,A.hS)(le,ce);if(null==X)return"";const U=oe[Y]||oe[le];return U?function B(ue,ce){switch(ce.type){case"date":return(0,Q.p6)(ue,ce.intlOptions);case"number":return(0,H.uf)(ue,ce.intlOptions);default:return re.warn("missing format descriptor for key {key}"),ie(ue)}}(X,U):Y?function Z(ue,ce){switch(ce.toLowerCase()){case"dateformat":return(0,Q.p6)(ue);case"numberformat":return(0,H.uf)(ue);default:return re.warn(`inline format is unsupported since 4.12: ${ce}`),/^(dateformat|datestring)/i.test(ce)?(0,Q.p6)(ue):/^numberformat/i.test(ce)?(0,H.uf)(ue):ie(ue)}}(X,Y):ie(X)}(Y,ce,le))}function ie(ue){switch(typeof ue){case"string":return ue;case"number":return(0,H.uf)(ue);case"boolean":return""+ue;default:return ue instanceof Date?(0,Q.p6)(ue):""}}},24263:(dt,Re,T)=>{"use strict";T.d(Re,{Dp:()=>W,Nv:()=>H,i8:()=>Q,id:()=>re,qh:()=>J});var x=T(15861),A=T(8314),G=T(21726);const Q="4.24",H={request:(B,Z)=>(0,x.Z)(function*(){var Y;const{default:ie}=yield Promise.resolve().then(T.bind(T,84792)),ue=B.options,ce=ue.responseType;ue.signal=null==Z?void 0:Z.signal,ue.responseType="native"===ce||"native-request-init"===ce?"native-request-init":["blob","json","text"].includes(ce)&&(null==(Y=(0,G.oh)(B.url))?void 0:Y.after)?ce:"array-buffer";const oe=yield ie(B.url,ue),le={data:oe.data,ssl:oe.ssl};switch(oe.requestOptions.responseType){case"native-request-init":return delete le.data.signal,le;case"blob":le.data=yield le.data.arrayBuffer();break;case"json":le.data=(new TextEncoder).encode(JSON.stringify(le.data)).buffer;break;case"text":le.data=(new TextEncoder).encode(le.data).buffer}return{result:le,transferList:[le.data]}})()};let re;function J(B){re=B}function W(B){const Z=re&&re.findCredential(B);return Z&&Z.token?(0,G.ZN)(B,"token",Z.token):B}(0,A.Z)("host-webworker")||((0,A.Z)("edge")||(0,A.Z)("trident"))&&console.warn("Deprecated browser - see http://esriurl.com/oldbrowser")},32258:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{default:()=>oi});var xe,x=T(15861),A=T(17626),G=T(73281),Z=(T(4832),T(49067),T(96794),T(69747),T(40425),T(69357),T(40342)),ie=T(14726),ue=T(33474),ce=T(32088),oe=T(84792),le=T(20383),Y=T(79608),j=T(46160),X=T(26584),U=T(72392),ee=T(8314),$=T(2076),ne=T(58817),se=T(63290),ae=T(62208),de=T(99959),_e=T(94113),pe=T(10699),he=T(95737),ge=T(21726),ye=T(77712),Me=T(66656),Ee=T(68653),Te=T(76898),me=T(99433),Ce=T(383),Ie=T(86810),Je=(T(85931),T(90912));let je=xe=class extends Ie.wq{constructor(At){super(At),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new xe({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],je.prototype,"expression",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],je.prototype,"name",void 0),(0,A._)([(0,ye.Cb)({type:["boolean","date","number","string"],json:{write:!0}})],je.prototype,"returnType",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],je.prototype,"title",void 0),je=xe=(0,A._)([(0,Te.j)("esri.form.ExpressionInfo")],je);const We=je;let Ne=class extends Ie.wq{constructor(At){super(At),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],Ne.prototype,"description",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],Ne.prototype,"label",void 0),(0,A._)([(0,ye.Cb)()],Ne.prototype,"type",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],Ne.prototype,"visibilityExpression",void 0),Ne=(0,A._)([(0,Te.j)("esri.form.elements.Element")],Ne);const we=Ne;var Oe;let $e=Oe=class extends Ie.wq{constructor(At){super(At),this.type=null}clone(){return new Oe({type:this.type})}};(0,A._)([(0,ye.Cb)({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],$e.prototype,"type",void 0),$e=Oe=(0,A._)([(0,Te.j)("esri.form.elements.inputs.AttachmentInput")],$e);const Be=$e;var Se;let De=Se=class extends we{constructor(At){super(At),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new Se({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],De.prototype,"attachmentKeyword",void 0),(0,A._)([(0,ye.Cb)({type:Boolean,json:{write:!0}})],De.prototype,"editable",void 0),(0,A._)([(0,ye.Cb)({type:Be,json:{read:{source:"inputType"},write:{target:"inputType"}}})],De.prototype,"input",void 0),(0,A._)([(0,ye.Cb)({type:["attachment"],json:{read:!1,write:!0}})],De.prototype,"type",void 0),De=Se=(0,A._)([(0,Te.j)("esri.form.elements.AttachmentElement")],De);const Fe=De;let ve=class extends Ie.wq{constructor(At){super(At),this.type=null}};(0,A._)([(0,ye.Cb)()],ve.prototype,"type",void 0),ve=(0,A._)([(0,Te.j)("esri.form.elements.inputs.Input")],ve);const Ke=ve;let qe=class extends Ke{constructor(At){super(At),this.maxLength=null,this.minLength=0}};(0,A._)([(0,ye.Cb)({type:Number,json:{write:!0}})],qe.prototype,"maxLength",void 0),(0,A._)([(0,ye.Cb)({type:Number,json:{write:!0}})],qe.prototype,"minLength",void 0),qe=(0,A._)([(0,Te.j)("esri.form.elements.inputs.TextInput")],qe);const be=qe;var tt;let Ye=tt=class extends be{constructor(At){super(At),this.type="barcode-scanner"}clone(){return new tt({maxLength:this.maxLength,minLength:this.minLength})}};(0,A._)([(0,ye.Cb)({type:["barcode-scanner"],json:{read:!1,write:!0}})],Ye.prototype,"type",void 0),Ye=tt=(0,A._)([(0,Te.j)("esri.form.elements.inputs.BarcodeScannerInput")],Ye);const ze=Ye;var et;let ke=et=class extends Ke{constructor(At){super(At),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="combo-box"}clone(){return new et({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],ke.prototype,"noValueOptionLabel",void 0),(0,A._)([(0,ye.Cb)({type:Boolean,json:{write:!0}})],ke.prototype,"showNoValueOption",void 0),(0,A._)([(0,ye.Cb)({type:["combo-box"],json:{read:!1,write:!0}})],ke.prototype,"type",void 0),ke=et=(0,A._)([(0,Te.j)("esri.form.elements.inputs.ComboBoxInput")],ke);const ot=ke;var at;function yt(At){return null!=At?new Date(At):null}function wt(At){return At?At.getTime():null}let zt=at=class extends Ke{constructor(At){super(At),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(At,Bt){return yt(Bt.max)}writeMax(At,Bt){Bt.max=wt(At)}readMin(At,Bt){return yt(Bt.min)}writeMin(At,Bt){Bt.min=wt(At)}clone(){return new at({includeTime:this.includeTime,max:this.max,min:this.min,type:this.type})}};(0,A._)([(0,ye.Cb)({type:Boolean,json:{write:!0}})],zt.prototype,"includeTime",void 0),(0,A._)([(0,ye.Cb)({type:Date,json:{type:Number,write:!0}})],zt.prototype,"max",void 0),(0,A._)([(0,Ee.r)("max")],zt.prototype,"readMax",null),(0,A._)([(0,me.c)("max")],zt.prototype,"writeMax",null),(0,A._)([(0,ye.Cb)({type:Date,json:{type:Number,write:!0}})],zt.prototype,"min",void 0),(0,A._)([(0,Ee.r)("min")],zt.prototype,"readMin",null),(0,A._)([(0,me.c)("min")],zt.prototype,"writeMin",null),(0,A._)([(0,ye.Cb)({type:["datetime-picker"],json:{read:!1,write:!0}})],zt.prototype,"type",void 0),zt=at=(0,A._)([(0,Te.j)("esri.form.elements.inputs.DateTimePickerInput")],zt);const Rt=zt;var Ft;let bt=Ft=class extends Ke{constructor(At){super(At),this.noValueOptionLabel=null,this.showNoValueOption=!1,this.type="radio-buttons"}clone(){return new Ft({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],bt.prototype,"noValueOptionLabel",void 0),(0,A._)([(0,ye.Cb)({type:Boolean,json:{write:!0}})],bt.prototype,"showNoValueOption",void 0),(0,A._)([(0,ye.Cb)({type:["radio-buttons"],json:{read:!1,write:!0}})],bt.prototype,"type",void 0),bt=Ft=(0,A._)([(0,Te.j)("esri.form.elements.inputs.RadioButtonsInput")],bt);const St=bt;var Xt;let Mr=Xt=class extends Ke{constructor(At){super(At),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Xt({offValue:this.offValue,onValue:this.onValue})}};(0,A._)([(0,ye.Cb)({type:[String,Number],json:{write:!0}})],Mr.prototype,"offValue",void 0),(0,A._)([(0,ye.Cb)({type:[String,Number],json:{write:!0}})],Mr.prototype,"onValue",void 0),(0,A._)([(0,ye.Cb)({type:["switch"],json:{read:!1,write:!0}})],Mr.prototype,"type",void 0),Mr=Xt=(0,A._)([(0,Te.j)("esri.form.elements.inputs.SwitchInput")],Mr);const Cr=Mr;var Yr;let Lr=Yr=class extends be{constructor(At){super(At),this.type="text-area"}clone(){return new Yr({maxLength:this.maxLength,minLength:this.minLength})}};(0,A._)([(0,ye.Cb)({type:["text-area"],json:{read:!1,write:!0}})],Lr.prototype,"type",void 0),Lr=Yr=(0,A._)([(0,Te.j)("esri.form.elements.inputs.TextAreaInput")],Lr);const ct=Lr;var jt;let qt=jt=class extends be{constructor(At){super(At),this.type="text-box"}clone(){return new jt({maxLength:this.maxLength,minLength:this.minLength})}};(0,A._)([(0,ye.Cb)({type:["text-box"],json:{read:!1,write:!0}})],qt.prototype,"type",void 0),qt=jt=(0,A._)([(0,Te.j)("esri.form.elements.inputs.TextBoxInput")],qt);const Zt={base:Ke,key:"type",typeMap:{"barcode-scanner":ze,"combo-box":ot,"datetime-picker":Rt,"radio-buttons":St,switch:Cr,"text-area":ct,"text-box":qt}};var ir,tr=T(67945);let fr=ir=class extends we{constructor(At){super(At),this.domain=null,this.editable=!0,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}clone(){return new ir({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};(0,A._)([(0,ye.Cb)({types:tr.V5,json:{read:{reader:tr.im},write:!0}})],fr.prototype,"domain",void 0),(0,A._)([(0,ye.Cb)({type:Boolean,json:{write:!0}})],fr.prototype,"editable",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],fr.prototype,"editableExpression",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],fr.prototype,"fieldName",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],fr.prototype,"hint",void 0),(0,A._)([(0,ye.Cb)({types:Zt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],fr.prototype,"input",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],fr.prototype,"requiredExpression",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{read:!1,write:!0}})],fr.prototype,"type",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],fr.prototype,"valueExpression",void 0),fr=ir=(0,A._)([(0,Te.j)("esri.form.elements.FieldElement")],fr);const Ur=fr;var Zr,Br=T(51686);let ri=Zr=class extends we{constructor(At){super(At),this.displayCount=null,this.displayType="list",this.editable=!0,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new Zr({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editable:this.editable,label:this.label,orderByFields:(0,ne.d9)(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};(0,A._)([(0,ye.Cb)({type:Number,json:{write:!0}})],ri.prototype,"displayCount",void 0),(0,A._)([(0,ye.Cb)({type:["list"],json:{write:!0}})],ri.prototype,"displayType",void 0),(0,A._)([(0,ye.Cb)({type:Boolean,json:{write:!0}})],ri.prototype,"editable",void 0),(0,A._)([(0,ye.Cb)({type:[Br.Z],json:{write:!0}})],ri.prototype,"orderByFields",void 0),(0,A._)([(0,ye.Cb)({type:Number,json:{write:!0}})],ri.prototype,"relationshipId",void 0),(0,A._)([(0,ye.Cb)({type:["relationship"],json:{read:!1,write:!0}})],ri.prototype,"type",void 0),ri=Zr=(0,A._)([(0,Te.j)("esri.form.elements.RelationshipElement")],ri);const hr=ri;function Dr(At){return{typesWithGroup:{base:we,key:"type",typeMap:{attachment:Fe,field:Ur,group:At,relationship:hr}},typesWithoutGroup:{base:we,key:"type",typeMap:{attachment:Fe,field:Ur,relationship:hr}}}}function Kr(At,Bt,vr=!0){if(!At)return null;const kr=vr?Bt.typesWithGroup.typeMap:Bt.typesWithoutGroup.typeMap;return At.filter(ai=>kr[ai.type]).map(ai=>kr[ai.type].fromJSON(ai))}function Nt(At,Bt,vr=!0){if(!At)return null;const kr=vr?Bt.typesWithGroup.typeMap:Bt.typesWithoutGroup.typeMap;return At.filter(ai=>kr[ai.type]).map(ai=>ai.toJSON())}function lr(At,Bt,vr=!0){return At?At.map(kr=>(0,Je.N7)(vr?Bt.typesWithGroup:Bt.typesWithoutGroup,kr)):null}var jr;let Ot=jr=class extends we{constructor(At){super(At),this.elements=null,this.initialState="expanded",this.type="group"}castElements(At){return lr(At,rr,!1)}readElements(At,Bt){return Kr(Bt.formElements,rr,!1)}writeElements(At,Bt){Bt.formElements=Nt(At,rr,!1)}clone(){return new jr({description:this.description,elements:(0,ne.d9)(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};(0,A._)([(0,ye.Cb)({json:{write:!0}})],Ot.prototype,"elements",void 0),(0,A._)([(0,Me.p)("elements")],Ot.prototype,"castElements",null),(0,A._)([(0,Ee.r)("elements",["formElements"])],Ot.prototype,"readElements",null),(0,A._)([(0,me.c)("elements")],Ot.prototype,"writeElements",null),(0,A._)([(0,ye.Cb)({type:["collapsed","expanded"],json:{write:!0}})],Ot.prototype,"initialState",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{read:!1,write:!0}})],Ot.prototype,"type",void 0),Ot=jr=(0,A._)([(0,Te.j)("esri.form.elements.GroupElement")],Ot);const rr=Dr(Ot);var Pr;const Fr=Dr(Ot);let ii=Pr=class extends Ie.wq{constructor(At){super(At),this.description=null,this.elements=null,this.expressionInfos=null,this.title=null}castElements(At){return lr(At,Fr)}readElements(At,Bt){return Kr(Bt.formElements,Fr)}writeElements(At,Bt){Bt.formElements=Nt(At,Fr)}clone(){return new Pr({description:this.description,expressionInfos:(0,ne.d9)(this.expressionInfos),elements:(0,ne.d9)(this.elements),title:this.title})}};(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],ii.prototype,"description",void 0),(0,A._)([(0,ye.Cb)({json:{write:!0}})],ii.prototype,"elements",void 0),(0,A._)([(0,Me.p)("elements")],ii.prototype,"castElements",null),(0,A._)([(0,Ee.r)("elements",["formElements"])],ii.prototype,"readElements",null),(0,A._)([(0,me.c)("elements")],ii.prototype,"writeElements",null),(0,A._)([(0,ye.Cb)({type:[We],json:{write:!0}})],ii.prototype,"expressionInfos",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{write:!0}})],ii.prototype,"title",void 0),ii=Pr=(0,A._)([(0,Te.j)("esri.form.FormTemplate")],ii);const mi=ii;var wi=T(2004),Qr=T(79334),Ni=T(65234),Hs=T(44917),ni=(T(29132),T(88879)),_i=T(80542),Ii=T(47996),ji=T(60330),Gi=T(59289),es=T(61039),zr=T(20514),gs=T(61515),hi=T(17253),ln=T(37118),ds=T(71774);let Mt=0;const Hr=se.Z.getLogger("esri.layers.graphics.sources.MemorySource");let Ir=class extends(Ii.Z.LoadableMixin((0,ji.v)((0,_i.p)(j.Z)))){constructor(At){super(At),this._idToClientGraphic=null,this.type="memory"}load(At){const Bt=(0,ae.pC)(At)?At.signal:null;return this.addResolvingPromise(this._startWorker(Bt)),Promise.resolve(this)}destroy(){var At;null==(At=this._connection)||At.close(),this._connection=null}get workerGeometryType(){var Bt;const At=null==(Bt=this.layer)?void 0:Bt.geometryType;return At?this._geometryTypeRequiresClientGraphicMapping(At)?"polygon":At:null}applyEdits(At){return this.load().then(()=>this._applyEdits(At))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(At,Bt={}){var vr=this;return(0,x.Z)(function*(){yield vr.load(Bt);const kr=yield vr._connection.invoke("queryFeatures",At?At.toJSON():null,Bt);(0,gs.p)(At,vr.layer.spatialReference,kr);const ai=hi.default.fromJSON(kr);if(!vr._requiresClientGraphicMapping())return ai;const Hi=vr.layer.objectIdField;for(const fs of ai.features){const On=vr._idToClientGraphic.get(fs.attributes[Hi]);On&&(fs.geometry=On.geometry)}return ai.geometryType=vr.layer.geometryType,ai})()}queryFeaturesJSON(At,Bt={}){var vr=this;return(0,x.Z)(function*(){if(vr._requiresClientGraphicMapping())throw new X.Z("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");yield vr.load(Bt);const kr=yield vr._connection.invoke("queryFeatures",At?At.toJSON():null,Bt);return(0,gs.p)(At,vr.layer.spatialReference,kr),kr})()}queryFeatureCount(At,Bt={}){return this.load(Bt).then(()=>this._connection.invoke("queryFeatureCount",At?At.toJSON():null,Bt))}queryObjectIds(At,Bt={}){return this.load(Bt).then(()=>this._connection.invoke("queryObjectIds",At?At.toJSON():null,Bt))}queryExtent(At,Bt={}){return this.load(Bt).then(()=>this._connection.invoke("queryExtent",At?At.toJSON():null,Bt)).then(vr=>({count:vr.count,extent:wi.Z.fromJSON(vr.extent)}))}querySnapping(At,Bt={}){return this.load(Bt).then(()=>this._connection.invoke("querySnapping",At,Bt))}_applyEdits(At){var Bt=this;return(0,x.Z)(function*(){if(!Bt._connection)throw new X.Z("feature-layer-source:edit-failure","Memory source not loaded");const vr=Bt.layer.objectIdField;let kr=null;const ai=[],Hi=[];yield Promise.all([Bt._prepareClientMapping(At.addFeatures,null),Bt._prepareClientMapping(At.updateFeatures,null)]);const fs=hn=>"objectId"in hn&&null!=hn.objectId?hn.objectId:"attributes"in hn&&null!=hn.attributes[vr]?hn.attributes[vr]:null;if(At.addFeatures&&(kr=Bt._prepareAddFeatures(At.addFeatures)),At.deleteFeatures)for(const hn of At.deleteFeatures){const no=fs(hn);null!=no&&ai.push(no)}const Tn=At.updateFeatures&&Bt._idToClientGraphic?new Map:null;if(At.updateFeatures)for(const hn of At.updateFeatures)if(Hi.push(Bt._serializeFeature(hn)),Tn){const no=fs(hn);null!=no&&Tn.set(no,hn)}(0,zr.P)(kr?kr.features:null,Hi,Bt.layer.spatialReference);const{fullExtent:On,featureEditResults:rn}=yield Bt._connection.invoke("applyEdits",{adds:kr?kr.features:[],updates:Hi,deletes:ai});return Bt.fullExtent=On,kr&&kr.finish(rn.uidToObjectId),Bt._updateClientGraphicIds(Tn,rn),Bt._createEditsResult(rn)})()}_prepareClientMapping(At,Bt){var vr=this;return(0,x.Z)(function*(){if("mesh"!==vr.layerOrSourceGeometryType||(0,ae.Wi)(At))return;const kr=[];for(const{geometry:ai}of At)!(0,ae.pC)(ai)||"mesh"!==ai.type||ai.hasExtent||ai.loaded||kr.push(ai.load({signal:Bt}));kr.length&&(yield Promise.all(kr))})()}_updateClientGraphicIds(At,Bt){if(this._idToClientGraphic){if(At)for(const vr of Bt.updateResults){if(!vr.success)continue;const kr=At.get(vr.objectId);null!=kr&&this._addIdToClientGraphic(kr)}for(const vr of Bt.deleteResults)vr.success&&this._idToClientGraphic.delete(vr.objectId)}}_createEditsResult(At){return{addFeatureResults:At.addResults?At.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:At.updateResults?At.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:At.deleteResults?At.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(At){const Bt=!0===At.success?null:At.error||{code:void 0,description:void 0};return{objectId:At.objectId,globalId:At.globalId,error:Bt?new X.Z("feature-layer-source:edit-failure",Bt.description,{code:Bt.code}):null}}_prepareAddFeatures(At){const Bt=new Map,vr=new Array(At.length);let kr=null;for(let Hi=0;Hi<At.length;Hi++){const fs=At[Hi],Tn=this._serializeFeature(fs);!kr&&(0,ae.pC)(fs.geometry)&&(kr=fs.geometry.type),vr[Hi]=Tn,Bt.set(`${Tn.uid}`,fs)}const ai=this;return{features:vr,inferredGeometryType:kr,finish(Hi){const fs=ai.sourceJSON.objectIdField;for(const Tn in Hi){const On=Hi[Tn],rn=Bt.get(Tn);rn&&(rn.attributes||(rn.attributes={}),-1===On?delete rn.attributes[fs]:rn.attributes[fs]=On,ai._addIdToClientGraphic(rn))}}}}_addIdToClientGraphic(At){if(!this._idToClientGraphic)return;const vr=At.attributes&&At.attributes[this.sourceJSON.objectIdField];null!=vr&&this._idToClientGraphic.set(vr,At)}get layerOrSourceGeometryType(){var At,Bt,vr;return null!=(vr=null==(At=this.layer)?void 0:At.geometryType)?vr:null==(Bt=this.sourceJSON)?void 0:Bt.geometryType}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this.layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(At){return this._geometryTypeRequiresClientGraphicMapping(At.type)}_geometryTypeRequiresClientGraphicMapping(At){return"mesh"===At||"multipatch"===At||"extent"===At}_serializeFeature(At){const{attributes:Bt}=At,vr=this._geometryForSerialization(At),kr=(Mt++).toString();return vr?{uid:kr,geometry:vr.toJSON(),attributes:Bt}:{uid:kr,attributes:Bt}}_geometryForSerialization(At){const{geometry:Bt}=At;return(0,ae.Wi)(Bt)?null:this._geometryRequiresClientGraphicMapping(Bt)?Bt.extent?ln.Z.fromExtent(Bt.extent):null:Bt}_startWorker(At){var Bt=this;return(0,x.Z)(function*(){Bt._connection=yield(0,Gi.bA)("MemorySourceWorker",{strategy:(0,ee.Z)("feature-layers-workers")?"dedicated":"local",signal:At});const{fields:vr,spatialReference:kr,objectIdField:ai,hasM:Hi,hasZ:fs,timeInfo:Tn}=Bt.layer,On="defaults"===Bt.layer.originOf("spatialReference");yield Bt._prepareClientMapping(Bt.items,At);const rn=Bt._prepareAddFeatures(Bt.items);Bt.handles.add(Bt.on("before-changes",Va=>{Hr.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),Va.preventDefault()}));const hn={features:rn.features,fields:vr&&vr.map(Va=>Va.toJSON()),geometryType:ds.P$.toJSON(Bt.workerGeometryType),hasM:"mesh"!==Bt.layerOrSourceGeometryType&&Hi,hasZ:"mesh"===Bt.layerOrSourceGeometryType||fs,objectIdField:ai,spatialReference:On?null:kr&&kr.toJSON(),timeInfo:Tn?Tn.toJSON():null},no=yield Bt._connection.invoke("load",hn,{signal:At});for(const Va of no.warnings)Hr.warn(Va.message,{layer:Bt.layer,warning:Va});no.featureErrors.length&&Hr.warn(`Encountered ${no.featureErrors.length} validation errors while loading features`,no.featureErrors);const Sn=no.layerDefinition;Bt._geometryTypeRequiresClientGraphicMapping(rn.inferredGeometryType)&&(Sn.geometryType=ds.P$.toJSON(rn.inferredGeometryType)),Bt.sourceJSON=Sn,Bt._requiresClientGraphicMapping()&&(Bt._idToClientGraphic=new Map),rn.finish(no.assignedObjectIds)})()}};(0,A._)([(0,es.c)({Type:ni.Z,ensureType:(0,Je.se)(ni.Z)})],Ir.prototype,"itemType",void 0),(0,A._)([(0,ye.Cb)()],Ir.prototype,"type",void 0),(0,A._)([(0,ye.Cb)({constructOnly:!0})],Ir.prototype,"layer",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0})],Ir.prototype,"workerGeometryType",null),(0,A._)([(0,ye.Cb)()],Ir.prototype,"sourceJSON",void 0),Ir=(0,A._)([(0,Te.j)("esri.layers.graphics.sources.MemorySource")],Ir);var mr,gi=T(50085),Ui=T(65088),is=T(552),ss=T(50107),ts=T(35126),ys=T(49286),ps=T(32629),Ds=T(6647),Ps=T(30346),ms=T(99555),Un=T(97941),gr=T(38305),Sr=T(13812);let Wr=mr=class extends Ie.wq{constructor(At){super(At)}clone(){const{name:At,fields:Bt,isAscending:vr,isUnique:kr,description:ai}=this;return new mr({name:At,fields:Bt,isAscending:vr,isUnique:kr,description:ai})}};(0,A._)([(0,ye.Cb)({constructOnly:!0})],Wr.prototype,"name",void 0),(0,A._)([(0,ye.Cb)({constructOnly:!0})],Wr.prototype,"fields",void 0),(0,A._)([(0,ye.Cb)({constructOnly:!0})],Wr.prototype,"isAscending",void 0),(0,A._)([(0,ye.Cb)({constructOnly:!0})],Wr.prototype,"isUnique",void 0),(0,A._)([(0,ye.Cb)({constructOnly:!0})],Wr.prototype,"description",void 0),Wr=mr=(0,A._)([(0,Te.j)("esri.layers.support.FeatureIndex")],Wr);var Di=T(47717),Wi=T(32777),ns=T(41638),Yi=T(55911),hs=T(36630),Ks=T(16730);let Ms=class extends((0,Y.J)(Ie.wq)){constructor(At){super(At),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};(0,A._)([(0,ye.Cb)({type:String,json:{read:{source:"shapeAreaFieldName"}}})],Ms.prototype,"shapeAreaField",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{read:{source:"shapeLengthFieldName"}}})],Ms.prototype,"shapeLengthField",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{read:At=>Ks.gV.read(At)||Ks.Jo.read(At)}})],Ms.prototype,"units",void 0),Ms=(0,A._)([(0,Te.j)("esri.layers.support.GeometryFieldsInfo")],Ms);const Zs=Ms;var tn=T(170),So=T(62667),Bn=T(2430);const _o=new $.X({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),to=new $.X({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let Vn=class extends((0,Y.J)(Ie.wq)){constructor(At){super(At),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};(0,A._)([(0,ye.Cb)({json:{read:_o.read,write:_o.write}})],Vn.prototype,"cardinality",void 0),(0,A._)([(0,ye.Cb)({json:{read:!0,write:!0}})],Vn.prototype,"composite",void 0),(0,A._)([(0,ye.Cb)({json:{read:!0,write:!0}})],Vn.prototype,"id",void 0),(0,A._)([(0,ye.Cb)({json:{read:!0,write:!0}})],Vn.prototype,"keyField",void 0),(0,A._)([(0,ye.Cb)({json:{read:!0,write:!0}})],Vn.prototype,"keyFieldInRelationshipTable",void 0),(0,A._)([(0,ye.Cb)({json:{read:!0,write:!0}})],Vn.prototype,"name",void 0),(0,A._)([(0,ye.Cb)({json:{read:!0,write:!0}})],Vn.prototype,"relatedTableId",void 0),(0,A._)([(0,ye.Cb)({json:{read:!0,write:!0}})],Vn.prototype,"relationshipTableId",void 0),(0,A._)([(0,ye.Cb)({json:{read:to.read,write:to.write}})],Vn.prototype,"role",void 0),Vn=(0,A._)([(0,Te.j)("esri.layers.support.Relationship")],Vn);const Pa=Vn;var fa=T(62708),Yo=T(5676),_a=T(15283),ia=T(39683),Xs=T(67736),ro=T(84952),xa=T(67010),xo=T(6871),ti=T(49430),Nn=T(92236);const Wa=new $.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),zo={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"},nn="FeatureLayer",cs=se.Z.getLogger("esri.layers.FeatureLayer");function Yn(At,Bt){return new X.Z("layer:unsupported",`Layer (${At.title}, ${At.id}) of type '${At.declaredClass}' ${Bt}`,{layer:At})}function Jn(At){return At&&At instanceof j.Z}function us(At,Bt,vr){return!!(At&&At.hasOwnProperty(Bt)?At[Bt]:vr)}function ma(At,Bt,vr){return At&&At.hasOwnProperty(Bt)?At[Bt]:vr}function Ht(At){var vr;const Bt=null==(vr=null==At?void 0:At.supportedSpatialAggregationStatistics)?void 0:vr.map(kr=>kr.toLowerCase());return{envelope:!!(null==Bt?void 0:Bt.includes("envelopeaggregate")),centroid:!!(null==Bt?void 0:Bt.includes("centroidaggregate")),convexHull:!!(null==Bt?void 0:Bt.includes("convexhullaggregate"))}}function kt(At,Bt){var kr;const vr=null==(kr=null==At?void 0:At.supportedOperationsWithCacheHint)?void 0:kr.map(ai=>ai.toLowerCase());return!!(null==vr?void 0:vr.includes(Bt.toLowerCase()))}const ur=(0,Yi.v)();function Tr(At,Bt,vr){const kr=!!(null==vr?void 0:vr.writeLayerSchema);return{enabled:kr,ignoreOrigin:kr}}let _r=class extends((0,ts.b)((0,is.h)((0,ps.c)((0,Un.n)((0,ms.M)((0,Ps.Q)((0,Ui.Y)((0,ys.q)((0,Ds.I)((0,de.R)((0,ss.N)((0,gi.V)((0,Y.J)(Hs.Z)))))))))))))){constructor(...At){super(...At),this._handles=new U.Z,this.capabilities=null,this.charts=null,this.copyright=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.dynamicDataSource=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.featureReduction=null,this.fields=null,this.fieldsIndex=null,this.floorInfo=null,this.formTemplate=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.layerId=void 0,this.legendEnabled=!0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.screenSizePerspectiveEnabled=!0,this.serviceDefinitionExpression=null,this.spatialReference=Ni.Z.WGS84,this.subtypeCode=null,this.subtypeField=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.trackIdField=null,this.type="feature",this.typeIdField=null,this.types=null,this.indexes=new(j.Z.ofType(Wr)),this.userIsAdmin=!1,this.version=void 0,this.visible=!0}destroy(){var At;null==(At=this.source)||At.destroy(),this._handles=(0,ae.SC)(this._handles)}normalizeCtorArgs(At,Bt){return"string"==typeof At?or({url:At},Bt):At}load(At){var Bt=this;const vr=(0,ae.pC)(At)?At.signal:null;if(this.portalItem&&this.portalItem.loaded&&this.source)return void this.addResolvingPromise(this.createGraphicsSource(vr).then(ai=>this._initLayerProperties(ai)));const kr=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},At).catch(pe.r9).then((0,x.Z)(function*(){if(Bt.url&&null==Bt.layerId&&/FeatureServer|MapServer\/*$/i.test(Bt.url)){const ai=yield Bt._fetchFirstLayerId(vr);null!=ai&&(Bt.layerId=ai)}if(!Bt.url&&!Bt._hasMemorySource())throw new X.Z("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return Bt._initLayerProperties(yield Bt.createGraphicsSource(vr))})).then(()=>this.finishLoadEditablePortalLayer(At));return this.addResolvingPromise(kr),Promise.resolve(this)}readCapabilities(At,Bt){return{analytics:this._readAnalyticsCapabilities(Bt=Bt.layerDefinition||Bt),attachment:this._readAttachmentCapabilities(Bt),data:this._readDataCapabilities(Bt),metadata:this._readMetadataCapabilities(Bt),operations:this._readOperationsCapabilities(Bt.capabilities||At,Bt),query:this._readQueryCapabilities(Bt),queryRelated:this._readQueryRelatedCapabilities(Bt),queryTopFeatures:this._readQueryTopFeaturesCapabilities(Bt),editing:this._readEditingCapabilities(Bt)}}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")||0)+1}get editingEnabled(){return!(this.loaded&&!this.capabilities.operations.supportsEditing)&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(At){null!=At?this._override("editingEnabled",At):this._clearOverride("editingEnabled")}readEditingEnabled(At,Bt){return this._readEditingEnabled(Bt,!1)}readEditingEnabledFromWebMap(At,Bt,vr){return this._readEditingEnabled(Bt,!0,vr)}writeEditingEnabled(At,Bt){this._writeEditingEnabled(At,Bt,!1)}writeEditingEnabledToWebMap(At,Bt,vr,kr){this._writeEditingEnabled(At,Bt,!0,kr)}readEditingInfo(At,Bt){const{editingInfo:vr}=Bt;return vr?{lastEditDate:null!=vr.lastEditDate?new Date(vr.lastEditDate):null}:null}readIsTable(At,Bt){return"Table"===(Bt=Bt&&Bt.layerDefinition||Bt).type||!Bt.geometryType}writeIsTable(At,Bt,vr,kr){(null==kr?void 0:kr.writeLayerSchema)&&(0,_e.RB)(vr,At?"Table":"Feature Layer",Bt)}readMinScale(At,Bt){return Bt.effectiveMinScale||At||0}readMaxScale(At,Bt){return Bt.effectiveMaxScale||At||0}readGlobalIdFieldFromService(At,Bt){if((Bt=Bt.layerDefinition||Bt).globalIdField)return Bt.globalIdField;if(Bt.fields)for(const vr of Bt.fields)if("esriFieldTypeGlobalID"===vr.type)return vr.name}readObjectIdFieldFromService(At,Bt){if((Bt=Bt.layerDefinition||Bt).objectIdField)return Bt.objectIdField;if(Bt.fields)for(const vr of Bt.fields)if("esriFieldTypeOID"===vr.type)return vr.name}get parsedUrl(){const At=this.url?(0,ge.mN)(this.url):null;return null!=At&&(null!=this.dynamicDataSource?At.path=(0,ge.v_)(At.path,"dynamicLayer"):null!=this.layerId&&(At.path=(0,ge.v_)(At.path,this.layerId.toString()))),At}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(At){(0,hs.YN)(At,this.fieldsIndex),this._set("renderer",At)}readRenderer(At,Bt,vr){const kr=(Bt=Bt.layerDefinition||Bt).drawingInfo&&Bt.drawingInfo.renderer||void 0;if(kr){const ai=(0,ue.a)(kr,Bt,vr)||void 0;return ai||cs.error("Failed to create renderer",{rendererDefinition:Bt.drawingInfo.renderer,layer:this,context:vr}),ai}if(Bt.defaultSymbol)return Bt.types&&Bt.types.length?new ie.Z({defaultSymbol:Gr(Bt.defaultSymbol,Bt,vr),field:Bt.typeIdField,uniqueValueInfos:Bt.types.map(ai=>({id:ai.id,symbol:Gr(ai.symbol,ai,vr)}))}):new Z.Z({symbol:Gr(Bt.defaultSymbol,Bt,vr)})}set source(At){const Bt=this._get("source");Bt!==At&&(Jn(Bt)&&this._resetMemorySource(Bt),Jn(At)&&this._initMemorySource(At),this._set("source",At))}castSource(At){return At?Array.isArray(At)||At instanceof j.Z?new Ir({layer:this,items:At}):At:null}readSource(At,Bt){const vr=hi.default.fromJSON(Bt.featureSet);return new Ir({layer:this,items:vr&&vr.features||[]})}readServiceDefinitionExpression(At,Bt){return Bt.definitionQuery||Bt.definitionExpression}readTemplates(At,Bt){const vr=Bt.editFieldsInfo,kr=vr&&vr.creatorField,ai=vr&&vr.editorField;return At=At&&At.map(Hi=>Wi.Z.fromJSON(Hi)),this._fixTemplates(At,kr),this._fixTemplates(At,ai),At}readTitle(At,Bt){const vr=Bt.layerDefinition&&Bt.layerDefinition.name||Bt.name,kr=Bt.title||Bt.layerDefinition&&Bt.layerDefinition.title;if(vr){const ai=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return this.url?(0,gr.a7)(this.url,vr):vr;let Hi=vr;if(!Hi&&this.url){const fs=(0,gr.Qc)(this.url);(0,ae.pC)(fs)&&(Hi=fs.title)}return Hi?("item-title-and-service-name"===this.sublayerTitleMode&&ai&&ai!==Hi&&(Hi=ai+" - "+Hi),(0,gr.ld)(Hi)):void 0}if("item-title"===this.sublayerTitleMode&&kr)return kr}readTitleFromWebMap(At,Bt){return Bt.title||Bt.layerDefinition&&Bt.layerDefinition.name}readTypeIdField(At,Bt){let vr=(Bt=Bt.layerDefinition||Bt).typeIdField;if(vr&&Bt.fields){vr=vr.toLowerCase();const kr=Bt.fields.find(ai=>ai.name.toLowerCase()===vr);kr&&(vr=kr.name)}return vr}readTypes(At,Bt){At=(Bt=Bt.layerDefinition||Bt).types;const vr=Bt.editFieldsInfo,kr=vr&&vr.creatorField,ai=vr&&vr.editorField;return At&&At.map(Hi=>(Hi=ns.Z.fromJSON(Hi),this._fixTemplates(Hi.templates,kr),this._fixTemplates(Hi.templates,ai),Hi))}set url(At){const Bt=(0,gr.XG)({layer:this,url:At,nonStandardUrlAllowed:!0,logger:cs});this._set("url",Bt.url),null!=Bt.layerId&&this._set("layerId",Bt.layerId)}writeUrl(At,Bt,vr,kr){(0,gr.wH)(this,At,null,Bt,kr)}readVersion(At,Bt){return Bt.currentVersion?Bt.currentVersion:Bt.hasOwnProperty("capabilities")||Bt.hasOwnProperty("drawingInfo")||Bt.hasOwnProperty("hasAttachments")||Bt.hasOwnProperty("htmlPopupType")||Bt.hasOwnProperty("relationships")||Bt.hasOwnProperty("timeInfo")||Bt.hasOwnProperty("typeIdField")||Bt.hasOwnProperty("types")?10:9.3}readVisible(At,Bt){return Bt.layerDefinition&&null!=Bt.layerDefinition.defaultVisibility?!!Bt.layerDefinition.defaultVisibility:null!=Bt.visibility?!!Bt.visibility:void 0}addAttachment(At,Bt){return this.load().then(()=>this._checkAttachmentSupport(At)).then(()=>{if(!("addAttachment"in this.source))throw new X.Z(nn,"Layer source does not support addAttachment capability");return this.source.addAttachment(At,Bt)})}updateAttachment(At,Bt,vr){return this.load().then(()=>this._checkAttachmentSupport(At)).then(()=>{if(!("updateAttachment"in this.source))throw new X.Z(nn,"Layer source does not support updateAttachment capability");return this.source.updateAttachment(At,Bt,vr)})}applyEdits(At,Bt){var vr=this;return(0,x.Z)(function*(){const kr=yield T.e(1913).then(T.bind(T,81913));return yield vr.load(),kr.applyEdits(vr,vr.source,At,Bt)})()}on(At,Bt){return super.on(At,Bt)}createPopupTemplate(At){return(0,ti.eZ)(this,At)}createGraphicsSource(At){var Bt=this;return(0,x.Z)(function*(){if(Bt._hasMemorySource())return Bt.source.load({signal:At});const{default:vr}=yield(0,pe.Hl)(T.e(114).then(T.bind(T,30114)),At);return new vr({layer:Bt}).load({signal:At})})()}createQuery(){const At=new ro.Z,Bt=this.get("capabilities.data"),vr=this.get("capabilities.query");At.dynamicDataSource=this.dynamicDataSource,At.historicMoment=this.historicMoment,At.gdbVersion=this.gdbVersion,At.returnGeometry=!0,vr&&(At.compactGeometryEnabled=vr.supportsCompactGeometry,At.defaultSpatialReferenceEnabled=vr.supportsDefaultSpatialReference),Bt&&(Bt.supportsZ&&null!=this.returnZ&&(At.returnZ=this.returnZ),Bt.supportsM&&null!=this.returnM&&(At.returnM=this.returnM)),At.outFields=["*"];const kr=(0,ae.pC)(this.subtypeCode)?`${this.subtypeField} = ${this.subtypeCode}`:null,ai=(0,he._)(this.definitionExpression,kr);At.where=ai||"1=1";const{timeOffset:Hi,timeExtent:fs}=this;return At.timeExtent=null!=Hi&&null!=fs?fs.offset(-Hi.value,Hi.unit):fs||null,At.multipatchOption="multipatch"===this.geometryType?"xyFootprint":null,At}deleteAttachments(At,Bt){return this.load().then(()=>this._checkAttachmentSupport(At)).then(()=>{if(!("deleteAttachments"in this.source))throw new X.Z(nn,"Layer source does not support deleteAttachments capability");return this.source.deleteAttachments(At,Bt)})}fetchRecomputedExtents(At){return this.load({signal:null==At?void 0:At.signal}).then(()=>{if(this.source.fetchRecomputedExtents)return this.source.fetchRecomputedExtents(At);throw new X.Z(nn,"Layer source does not support fetchUpdates capability")})}getFeatureType(At){const{typeIdField:Bt,types:vr}=this;if(!Bt||!At)return null;const kr=At.attributes?At.attributes[Bt]:void 0;if(null==kr)return null;let ai=null;return vr.some(Hi=>{const{id:fs}=Hi;return null!=fs&&(fs.toString()===kr.toString()&&(ai=Hi),!!ai)}),ai}getFieldDomain(At,Bt){const kr=this.getFeatureType(Bt&&Bt.feature);if(kr){const ai=kr.domains&&kr.domains[At];if(ai&&"inherited"!==ai.type)return ai}return this._getLayerDomain(At)}getField(At){return this.fieldsIndex.get(At)}queryAttachments(At,Bt){return At=Xs.Z.from(At),this.load().then(()=>{if(!this.get("capabilities.data.supportsAttachment"))throw new X.Z(nn,"this layer doesn't support attachments");const{attachmentTypes:vr,objectIds:kr,globalIds:ai,num:Hi,size:fs,start:Tn,where:On}=At;if(!this.get("capabilities.operations.supportsQueryAttachments")){const hn=vr&&vr.length,no=ai&&ai.length,Sn=fs&&fs.length;if(kr&&kr.length>1||hn||no||Sn||Hi||Tn||On)throw new X.Z(nn,"when 'supportsQueryAttachments' is false, only objectIds of length 1 are supported",At)}if(!(kr&&kr.length||On))throw new X.Z(nn,"'objectIds' or 'where' are required to perform attachment query",At);if(!("queryAttachments"in this.source))throw new X.Z(nn,"Layer source does not support queryAttachments capability",At);return this.source.queryAttachments(At)})}queryFeatures(At,Bt){return this.load().then(()=>this.source.queryFeatures(ro.Z.from(At)||this.createQuery(),Bt)).then(vr=>{if(null==vr?void 0:vr.features)for(const kr of vr.features)kr.layer=kr.sourceLayer=this;return vr})}queryObjectIds(At,Bt){return this.load().then(()=>{if(this.source.queryObjectIds)return this.source.queryObjectIds(ro.Z.from(At)||this.createQuery(),Bt);throw new X.Z(nn,"Layer source does not support queryObjectIds capability")})}queryFeatureCount(At,Bt){return this.load().then(()=>{if(this.source.queryFeatureCount)return this.source.queryFeatureCount(ro.Z.from(At)||this.createQuery(),Bt);throw new X.Z(nn,"Layer source does not support queryFeatureCount capability")})}queryExtent(At,Bt){return this.load().then(()=>{if(this.source.queryExtent)return this.source.queryExtent(ro.Z.from(At)||this.createQuery(),Bt);throw new X.Z(nn,"Layer source does not support queryExtent capability")})}queryRelatedFeatures(At,Bt){return this.load().then(()=>{if("queryRelatedFeatures"in this.source)return this.source.queryRelatedFeatures(xa.Z.from(At),Bt);throw new X.Z(nn,"Layer source does not support queryRelatedFeatures capability")})}queryRelatedFeaturesCount(At,Bt){return this.load().then(()=>{if("queryRelatedFeaturesCount"in this.source)return this.source.queryRelatedFeaturesCount(xa.Z.from(At),Bt);throw new X.Z(nn,"Layer source does not support queryRelatedFeaturesCount capability")})}queryTopFeatures(At,Bt){return this.load().then(()=>{if("queryTopFeatures"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopFeatures(xo.Z.from(At),Bt).then(vr=>{if(null==vr?void 0:vr.features)for(const kr of vr.features)kr.layer=kr.sourceLayer=this;return vr});throw new X.Z(nn,"Layer source does not support queryTopFeatures capability")})}queryTopObjectIds(At,Bt){return this.load().then(()=>{if("queryTopObjectIds"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopObjectIds(xo.Z.from(At),Bt);throw new X.Z(nn,"Layer source does not support queryTopObjectIds capability")})}queryTopFeaturesExtent(At,Bt){return this.load().then(()=>{if("queryTopExtents"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopExtents(xo.Z.from(At),Bt);throw new X.Z(nn,"Layer source does not support queryTopExtents capability")})}queryTopFeatureCount(At,Bt){return this.load().then(()=>{if("queryTopCount"in this.source&&this.get("capabilities.query.supportsTopFeaturesQuery"))return this.source.queryTopCount(xo.Z.from(At),Bt);throw new X.Z(nn,"Layer source does not support queryFeatureCount capability")})}read(At,Bt){const vr=At.featureCollection;if(vr){const kr=vr.layers;kr&&1===kr.length&&(super.read(kr[0],Bt),null!=vr.showLegend&&super.read({showLegend:vr.showLegend},Bt))}super.read(At,Bt),Bt&&"service"===Bt.origin&&this.revert(["objectIdField","fields","timeInfo","spatialReference"],"service")}write(At,Bt){var Hi;Bt=yi(or({},Bt),{writeLayerSchema:null!=(Hi=null==Bt?void 0:Bt.writeLayerSchema)?Hi:this._hasMemorySource()});const{origin:vr,layerContainerType:kr,messages:ai}=Bt;if(this.dynamicDataSource)return null==ai||ai.push(Yn(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if("web-scene"===vr||"web-map"===vr&&"tables"!==kr)return null==ai||ai.push(Yn(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return null==ai||ai.push(Yn(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&"web-map"===vr&&"tables"===kr)return null==ai||ai.push(Yn(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(At,Bt)}clone(){if(this._hasMemorySource())throw new X.Z(nn,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(At){return!!this.loaded&&("memory"===this.source.type||(0,Yo.D)(this,At))}save(At){var Bt=this;return(0,x.Z)(function*(){return(yield Promise.all([T.e(8592),T.e(6533)]).then(T.bind(T,36912))).save(Bt,At)})()}saveAs(At,Bt){var vr=this;return(0,x.Z)(function*(){return(yield Promise.all([T.e(8592),T.e(6533)]).then(T.bind(T,36912))).saveAs(vr,At,Bt)})()}_readEditingEnabled(At,Bt,vr){var ai;let kr=null==(ai=At.layerDefinition)?void 0:ai.capabilities;return kr?this._hasEditingCapability(kr):(kr=At.capabilities,Bt&&"web-map"===(null==vr?void 0:vr.origin)&&!this._hasMemorySource()&&kr?this._hasEditingCapability(kr):void 0)}_hasEditingCapability(At){return At.toLowerCase().split(",").map(Bt=>Bt.trim()).includes("editing")}_writeEditingEnabled(At,Bt,vr,kr){var ai,Hi;if(!At){const fs=(null==(Hi=null==(ai=this.capabilities)?void 0:ai.operations)?void 0:Hi.supportsSync)?"Query,Sync":"Query";(0,_e.RB)("layerDefinition.capabilities",fs,Bt),vr&&!(null==kr?void 0:kr.writeLayerSchema)&&(Bt.capabilities=fs)}}_checkAttachmentSupport(At){const{attributes:Bt}=At,{objectIdField:vr}=this;return this.get("capabilities.data.supportsAttachment")?At?Bt?Bt[vr]?void 0:Promise.reject(new X.Z(nn,`feature is missing the identifying attribute ${vr}`)):Promise.reject(new X.Z(nn,"'attributes' are required on a feature to query attachments")):Promise.reject(new X.Z(nn,"A feature is required to add/delete/update attachments")):Promise.reject(new X.Z(nn,"this layer doesn't support attachments"))}_getLayerDomain(At){const Bt=this.fieldsIndex.get(At);return Bt?Bt.domain:null}_fetchFirstLayerId(At){return(0,oe.default)(this.url,{query:yi(or({f:"json"},this.customParameters),{token:this.apiKey}),responseType:"json",signal:At}).then(Bt=>{const vr=Bt.data;if(vr)return Array.isArray(vr.layers)&&vr.layers.length>0?vr.layers[0].id:Array.isArray(vr.tables)&&vr.tables.length>0?vr.tables[0].id:void 0})}_initLayerProperties(At){var Bt=this;return(0,x.Z)(function*(){return Bt._set("source",At),At.sourceJSON&&(Bt.sourceJSON=At.sourceJSON,Bt.read(At.sourceJSON,{origin:"service",url:Bt.parsedUrl})),Bt._verifySource(),Bt._verifyFields(),(0,hs.YN)(Bt.renderer,Bt.fieldsIndex),(0,hs.UF)(Bt.timeInfo,Bt.fieldsIndex),(0,ia.y)(Bt,{origin:"service"})})()}hasDataChanged(){var At=this;return(0,x.Z)(function*(){var Bt,vr;if(null==(Bt=At.source)?void 0:Bt.refresh)try{const{dataChanged:kr,updates:ai}=yield null==(vr=At.source)?void 0:vr.refresh();if((0,ae.pC)(ai)&&(At.sourceJSON=or(or({},At.sourceJSON),ai),At.read(ai,{origin:"service",url:At.parsedUrl})),kr)return!0}catch(kr){}if(At.definitionExpression)try{return(yield(0,he.E)(At.definitionExpression,At.fieldsIndex)).hasDateFunctions}catch(kr){}return!1})()}_verifyFields(){var Bt;const At=this.parsedUrl&&this.parsedUrl.path||"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+At+")"),this.isTable||this._hasMemorySource()||-1!==At.search(/\/FeatureServer\//i)||(null==(Bt=this.fields)?void 0:Bt.some(vr=>"geometry"===vr.type))||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+At+")")}_fixTemplates(At,Bt){At&&At.forEach(vr=>{const kr=vr.prototype&&vr.prototype.attributes;kr&&Bt&&delete kr[Bt]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new X.Z("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new X.Z("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(At){At.forEach(Bt=>{Bt.layer=this,Bt.sourceLayer=this}),this._handles.add([At.on("after-add",Bt=>{Bt.item.layer=this,Bt.item.sourceLayer=this}),At.on("after-remove",Bt=>{Bt.item.layer=null,Bt.item.sourceLayer=null})],"fl-source")}_resetMemorySource(At){At.forEach(Bt=>{Bt.layer=null,Bt.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}_readAnalyticsCapabilities(At){return{supportsCacheHint:kt(At.advancedQueryCapabilities,"queryAnalytics")}}_readAttachmentCapabilities(At){const Bt=At.attachmentProperties,vr={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:kt(At.advancedQueryCapabilities,"queryAttachments"),supportsResize:us(At,"supportsAttachmentsResizing",!1)};return Bt&&Array.isArray(Bt)&&Bt.forEach(kr=>{const ai=zo[kr.name];ai&&(vr[ai]=!!kr.isEnabled)}),vr}_readDataCapabilities(At){return{isVersioned:us(At,"isDataVersioned",!1),supportsAttachment:us(At,"hasAttachments",!1),supportsM:us(At,"hasM",!1),supportsZ:us(At,"hasZ",!1)}}_readMetadataCapabilities(At){return{supportsAdvancedFieldProperties:us(At,"supportsFieldDescriptionProperty",!1)}}_readOperationsCapabilities(At,Bt){const vr=At?At.toLowerCase().split(",").map(no=>no.trim()):[],kr=this.url?(0,gr.Qc)(this.url):null,ai=vr.includes((0,ae.pC)(kr)&&"MapServer"===kr.serverType?"data":"query"),Hi=vr.includes("editing")&&!Bt.datesInUnknownTimezone;let fs=Hi&&vr.includes("create"),Tn=Hi&&vr.includes("delete"),On=Hi&&vr.includes("update");const rn=vr.includes("changetracking"),hn=Bt.advancedQueryCapabilities;return Hi&&!(fs||Tn||On)&&(fs=Tn=On=!0),{supportsCalculate:us(Bt,"supportsCalculate",!1),supportsTruncate:us(Bt,"supportsTruncate",!1),supportsValidateSql:us(Bt,"supportsValidateSql",!1),supportsAdd:fs,supportsDelete:Tn,supportsEditing:Hi,supportsChangeTracking:rn,supportsQuery:ai,supportsQueryAnalytics:us(hn,"supportsQueryAnalytic",!1),supportsQueryAttachments:us(hn,"supportsQueryAttachments",!1),supportsQueryTopFeatures:us(hn,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:us(Bt,"supportsAttachmentsResizing",!1),supportsSync:vr.includes("sync"),supportsUpdate:On,supportsExceedsLimitStatistics:us(Bt,"supportsExceedsLimitStatistics",!1)}}_readQueryCapabilities(At){var On;const Bt=At.advancedQueryCapabilities,vr=At.ownershipBasedAccessControlForFeatures,kr=At.archivingInfo,ai=null==(On=this.url)?void 0:On.includes("MapServer"),Hi=!(0,ee.Z)("mapserver-pbf-enabled")&&ai&&this.version<10.81,fs=(0,gr.M8)(this.url),Tn=(At.supportedQueryFormats||"").split(",").reduce((rn,hn)=>{const no=hn.toLowerCase().trim();return no&&rn.add(no),rn},new Set);return{supportsStatistics:us(Bt,"supportsStatistics",At.supportsStatistics),supportsPercentileStatistics:us(Bt,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:us(Bt,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:Ht(Bt),supportsCentroid:us(Bt,"supportsReturningGeometryCentroid",!1),supportsDistance:us(Bt,"supportsQueryWithDistance",!1),supportsDistinct:us(Bt,"supportsDistinct",At.supportsAdvancedQueries),supportsExtent:us(Bt,"supportsReturningQueryExtent",!1),supportsGeometryProperties:us(Bt,"supportsReturningGeometryProperties",!1),supportsHavingClause:us(Bt,"supportsHavingClause",!1),supportsOrderBy:us(Bt,"supportsOrderBy",At.supportsAdvancedQueries),supportsPagination:us(Bt,"supportsPagination",!1),supportsQuantization:us(At,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:us(At,"supportsQuantizationEditMode",!1),supportsQueryGeometry:us(At,"supportsReturningQueryGeometry",!1),supportsResultType:us(Bt,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:us(Bt,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:us(Bt,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:us(At,"useStandardizedQueries",!1),supportsTopFeaturesQuery:us(Bt,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:us(vr,"allowOthersToQuery",!0),supportsHistoricMoment:us(kr,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:!Hi&&Tn.has("pbf"),supportsDisjointSpatialRelationship:us(Bt,"supportsDisjointSpatialRel",!1),supportsCacheHint:us(Bt,"supportsQueryWithCacheHint",!1)||kt(Bt,"query"),supportsDefaultSpatialReference:us(Bt,"supportsDefaultSR",!1),supportsCompactGeometry:fs,maxRecordCountFactor:ma(At,"maxRecordCountFactor",void 0),maxRecordCount:ma(At,"maxRecordCount",void 0),standardMaxRecordCount:ma(At,"standardMaxRecordCount",void 0),tileMaxRecordCount:ma(At,"tileMaxRecordCount",void 0)}}_readQueryRelatedCapabilities(At){const Bt=At.advancedQueryCapabilities,vr=us(Bt,"supportsAdvancedQueryRelated",!1);return{supportsPagination:us(Bt,"supportsQueryRelatedPagination",!1),supportsCount:vr,supportsOrderBy:vr,supportsCacheHint:kt(Bt,"queryRelated")}}_readQueryTopFeaturesCapabilities(At){return{supportsCacheHint:kt(At.advancedQueryCapabilities,"queryTopFilter")}}_readEditingCapabilities(At){const Bt=At.ownershipBasedAccessControlForFeatures;return{supportsGeometryUpdate:us(At,"allowGeometryUpdates",!0),supportsGlobalId:us(At,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:us(At,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:us(At,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:us(At,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:us(At,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:us(Bt,"allowAnonymousToDelete",!0),supportsDeleteByOthers:us(Bt,"allowOthersToDelete",!0),supportsUpdateByAnonymous:us(Bt,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:us(Bt,"allowOthersToUpdate",!0)}}};(0,A._)([(0,ye.Cb)({readOnly:!0,json:{read:!1}})],_r.prototype,"capabilities",void 0),(0,A._)([(0,Ee.r)("service","capabilities",["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"])],_r.prototype,"readCapabilities",null),(0,A._)([(0,ye.Cb)({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],_r.prototype,"charts",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0})],_r.prototype,"createQueryVersion",null),(0,A._)([(0,ye.Cb)({type:String,json:{read:{source:"layerDefinition.copyrightText"},origins:{service:{read:{source:"copyrightText"}}}}})],_r.prototype,"copyright",void 0),(0,A._)([(0,ye.Cb)({type:Boolean})],_r.prototype,"datesInUnknownTimezone",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{read:{source:"layerDefinition.displayField"},origins:{service:{read:{source:"displayField"}}}}})],_r.prototype,"displayField",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],_r.prototype,"definitionExpression",void 0),(0,A._)([(0,ye.Cb)({types:le.LB,readOnly:!0})],_r.prototype,"defaultSymbol",void 0),(0,A._)([(0,ye.Cb)({type:_a.n})],_r.prototype,"dynamicDataSource",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0})],_r.prototype,"editFieldsInfo",void 0),(0,A._)([(0,ye.Cb)({type:Boolean})],_r.prototype,"editingEnabled",null),(0,A._)([(0,Ee.r)(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],_r.prototype,"readEditingEnabled",null),(0,A._)([(0,Ee.r)("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],_r.prototype,"readEditingEnabledFromWebMap",null),(0,A._)([(0,me.c)(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],_r.prototype,"writeEditingEnabled",null),(0,A._)([(0,me.c)("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],_r.prototype,"writeEditingEnabledToWebMap",null),(0,A._)([(0,ye.Cb)({readOnly:!0})],_r.prototype,"editingInfo",void 0),(0,A._)([(0,Ee.r)("editingInfo")],_r.prototype,"readEditingInfo",null),(0,A._)([(0,ye.Cb)((()=>{const At=(0,ne.d9)(Sr.PV),Bt=At.json.origins;return Bt["web-map"]={read:!1,write:!1},Bt["portal-item"]={read:!1,write:!1},At})())],_r.prototype,"elevationInfo",void 0),(0,A._)([(0,ye.Cb)(Di.d)],_r.prototype,"featureReduction",void 0),(0,A._)([(0,ye.Cb)(yi(or({},ur.fields),{json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:Tr}}}}}))],_r.prototype,"fields",void 0),(0,A._)([(0,ye.Cb)(ur.fieldsIndex)],_r.prototype,"fieldsIndex",void 0),(0,A._)([(0,ye.Cb)({type:Bn.Z,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],_r.prototype,"floorInfo",void 0),(0,A._)([(0,ye.Cb)({type:mi,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],_r.prototype,"formTemplate",void 0),(0,A._)([(0,ye.Cb)({type:wi.Z,json:{origins:{service:{read:{source:"extent"}}},read:{source:"layerDefinition.extent"}}})],_r.prototype,"fullExtent",void 0),(0,A._)([(0,ye.Cb)()],_r.prototype,"gdbVersion",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0,type:Zs,json:{read:{source:"geometryProperties"}}})],_r.prototype,"geometryFieldsInfo",void 0),(0,A._)([(0,ye.Cb)({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:Wa.read},"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:Tr,writer(At,Bt,vr){const kr=At?Wa.toJSON(At):null;kr&&(0,_e.RB)(vr,kr,Bt)}}}},read:{source:"layerDefinition.geometryType",reader:Wa.read}}})],_r.prototype,"geometryType",void 0),(0,A._)([(0,ye.Cb)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasM"}}})],_r.prototype,"hasM",void 0),(0,A._)([(0,ye.Cb)({type:Boolean,json:{origins:{service:{read:!0}},read:{source:"layerDefinition.hasZ"}}})],_r.prototype,"hasZ",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0,type:Qr.Z})],_r.prototype,"heightModelInfo",void 0),(0,A._)([(0,ye.Cb)({type:Date})],_r.prototype,"historicMoment",void 0),(0,A._)([(0,ye.Cb)(Sr.id)],_r.prototype,"id",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],_r.prototype,"infoFor3D",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0,json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],_r.prototype,"isTable",void 0),(0,A._)([(0,Ee.r)("service","isTable",["type","geometryType"]),(0,Ee.r)("isTable",["layerDefinition.type","layerDefinition.geometryType"])],_r.prototype,"readIsTable",null),(0,A._)([(0,me.c)("web-map","isTable")],_r.prototype,"writeIsTable",null),(0,A._)([(0,ye.Cb)(Sr.iR)],_r.prototype,"labelsVisible",void 0),(0,A._)([(0,ye.Cb)({type:[tn.Z],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:So.r},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:So.r},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],_r.prototype,"labelingInfo",void 0),(0,A._)([(0,ye.Cb)((()=>{const At=(0,ne.d9)(Sr.bT);return At.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(Bt,vr,kr){(0,_e.RB)(kr,(0,Nn.a)(Bt),vr)}}},At})())],_r.prototype,"opacity",void 0),(0,A._)([(0,ye.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],_r.prototype,"layerId",void 0),(0,A._)([(0,ye.Cb)(Sr.rn)],_r.prototype,"legendEnabled",void 0),(0,A._)([(0,ye.Cb)({type:["show","hide"],json:(()=>{const At=(0,ne.d9)(Sr.rT.json);return At.origins["portal-item"]={read:!1,write:!1},At})()})],_r.prototype,"listMode",void 0),(0,A._)([(0,ye.Cb)(Sr.rO)],_r.prototype,"minScale",void 0),(0,A._)([(0,Ee.r)("service","minScale",["minScale","effectiveMinScale"])],_r.prototype,"readMinScale",null),(0,A._)([(0,ye.Cb)(Sr.u1)],_r.prototype,"maxScale",void 0),(0,A._)([(0,Ee.r)("service","maxScale",["maxScale","effectiveMaxScale"])],_r.prototype,"readMaxScale",null),(0,A._)([(0,ye.Cb)({type:String})],_r.prototype,"globalIdField",void 0),(0,A._)([(0,Ee.r)("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"]),(0,Ee.r)("service","globalIdField",["globalIdField","fields"])],_r.prototype,"readGlobalIdFieldFromService",null),(0,A._)([(0,ye.Cb)({type:String,json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:Tr}}}}})],_r.prototype,"objectIdField",void 0),(0,A._)([(0,Ee.r)("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"]),(0,Ee.r)("service","objectIdField",["objectIdField","fields"])],_r.prototype,"readObjectIdFieldFromService",null),(0,A._)([(0,ye.Cb)({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],_r.prototype,"operationalLayerType",void 0),(0,A._)([(0,ye.Cb)(ur.outFields)],_r.prototype,"outFields",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0})],_r.prototype,"parsedUrl",null),(0,A._)([(0,ye.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],_r.prototype,"path",void 0),(0,A._)([(0,ye.Cb)(Sr.C_)],_r.prototype,"popupEnabled",void 0),(0,A._)([(0,ye.Cb)({type:G.Z,json:{name:"popupInfo",write:!0}})],_r.prototype,"popupTemplate",void 0),(0,A._)([(0,ye.Cb)({readOnly:!0})],_r.prototype,"defaultPopupTemplate",null),(0,A._)([(0,ye.Cb)({type:[Pa],readOnly:!0})],_r.prototype,"relationships",void 0),(0,A._)([(0,ye.Cb)({types:ce.A,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:ce.o,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(At,Bt,vr)=>({ignoreOrigin:null==vr?void 0:vr.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(At,Bt,vr)=>({ignoreOrigin:null==vr?void 0:vr.writeLayerSchema})}}})],_r.prototype,"renderer",null),(0,A._)([(0,Ee.r)("service","renderer",["drawingInfo.renderer","defaultSymbol"]),(0,Ee.r)("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],_r.prototype,"readRenderer",null),(0,A._)([(0,ye.Cb)()],_r.prototype,"sourceJSON",void 0),(0,A._)([(0,ye.Cb)({type:Boolean})],_r.prototype,"returnM",void 0),(0,A._)([(0,ye.Cb)({type:Boolean})],_r.prototype,"returnZ",void 0),(0,A._)([(0,ye.Cb)((()=>{const At=(0,ne.d9)(Sr.YI);return At.json.origins["portal-item"]={read:!1,write:!1},At})())],_r.prototype,"screenSizePerspectiveEnabled",void 0),(0,A._)([(0,ye.Cb)({clonable:!1})],_r.prototype,"source",null),(0,A._)([(0,Me.p)("source")],_r.prototype,"castSource",null),(0,A._)([(0,Ee.r)("portal-item","source",["featureSet"]),(0,Ee.r)("web-map","source",["featureSet"])],_r.prototype,"readSource",null),(0,A._)([(0,ye.Cb)({readOnly:!0})],_r.prototype,"serviceDefinitionExpression",void 0),(0,A._)([(0,Ee.r)("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],_r.prototype,"readServiceDefinitionExpression",null),(0,A._)([(0,ye.Cb)({type:Ni.Z,json:{origins:{service:{read:{source:"extent.spatialReference"}}},read:{source:"layerDefinition.extent.spatialReference"}}})],_r.prototype,"spatialReference",void 0),(0,A._)([(0,ye.Cb)({type:Number})],_r.prototype,"subtypeCode",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{origins:{service:{read:!0}}}})],_r.prototype,"subtypeField",void 0),(0,A._)([(0,ye.Cb)({type:[Wi.Z]})],_r.prototype,"templates",void 0),(0,A._)([(0,Ee.r)("templates",["editFieldsInfo","creatorField","editorField","templates"])],_r.prototype,"readTemplates",null),(0,A._)([(0,ye.Cb)({type:fa.Z})],_r.prototype,"timeInfo",void 0),(0,A._)([(0,ye.Cb)()],_r.prototype,"title",void 0),(0,A._)([(0,Ee.r)("service","title",["name"]),(0,Ee.r)("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],_r.prototype,"readTitle",null),(0,A._)([(0,Ee.r)("web-map","title",["layerDefinition.name","title"])],_r.prototype,"readTitleFromWebMap",null),(0,A._)([(0,ye.Cb)({type:String})],_r.prototype,"sublayerTitleMode",void 0),(0,A._)([(0,ye.Cb)({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],_r.prototype,"trackIdField",void 0),(0,A._)([(0,ye.Cb)({json:{read:!1}})],_r.prototype,"type",void 0),(0,A._)([(0,ye.Cb)({type:String})],_r.prototype,"typeIdField",void 0),(0,A._)([(0,Ee.r)("service","typeIdField"),(0,Ee.r)("typeIdField",["layerDefinition.typeIdField"])],_r.prototype,"readTypeIdField",null),(0,A._)([(0,ye.Cb)({type:[ns.Z]})],_r.prototype,"types",void 0),(0,A._)([(0,Ee.r)("service","types",["types"]),(0,Ee.r)("types",["layerDefinition.types"])],_r.prototype,"readTypes",null),(0,A._)([(0,ye.Cb)({readOnly:!0,json:{write:!1}})],_r.prototype,"serverGens",void 0),(0,A._)([(0,ye.Cb)({type:j.Z.ofType(Wr),readOnly:!0})],_r.prototype,"indexes",void 0),(0,A._)([(0,ye.Cb)(Sr.HQ)],_r.prototype,"url",null),(0,A._)([(0,me.c)("url")],_r.prototype,"writeUrl",null),(0,A._)([(0,ye.Cb)({readOnly:!0})],_r.prototype,"userIsAdmin",void 0),(0,A._)([(0,ye.Cb)({json:{origins:{service:{read:!0}},read:!1}})],_r.prototype,"version",void 0),(0,A._)([(0,Ee.r)("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],_r.prototype,"readVersion",null),(0,A._)([(0,ye.Cb)({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],_r.prototype,"visible",void 0),(0,A._)([(0,Ee.r)("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],_r.prototype,"readVisible",null),_r=(0,A._)([(0,Te.j)("esri.layers.FeatureLayer")],_r);const Gr=(0,Ce.d)({types:le.QT}),oi=_r},51470:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(28705),W=T(44917),B=T(552),Z=T(99555),ie=T(51815),ue=T(82706);let ce=class extends((0,B.h)((0,Z.M)(W.Z))){constructor(le){super(le),this.elevationInfo=null,this.graphics=new ie.J,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(le){return this.graphics.add(le),this}addMany(le){return this.graphics.addMany(le),this}removeAll(){return this.graphics.removeAll(),this}remove(le){this.graphics.remove(le)}removeMany(le){this.graphics.removeMany(le)}on(le,Y){return super.on(le,Y)}graphicChanged(le){this.emit("graphic-update",le)}};(0,x._)([(0,A.Cb)({type:ue.ZP})],ce.prototype,"elevationInfo",void 0),(0,x._)([(0,A.Cb)((0,J.z)(ie.J,"graphics"))],ce.prototype,"graphics",void 0),(0,x._)([(0,A.Cb)({type:["show","hide"]})],ce.prototype,"listMode",void 0),(0,x._)([(0,A.Cb)()],ce.prototype,"screenSizePerspectiveEnabled",void 0),(0,x._)([(0,A.Cb)({readOnly:!0})],ce.prototype,"type",void 0),(0,x._)([(0,A.Cb)({constructOnly:!0})],ce.prototype,"internal",void 0),ce=(0,x._)([(0,re.j)("esri.layers.GraphicsLayer")],ce);const oe=ce},44917:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>de});var x=T(15861),A=T(17626),Q=(T(29132),T(84792)),H=T(26584),re=T(61885),J=T(61996),W=T(47996),B=T(63290),Z=T(10699),ie=T(21726),ue=T(77712),Y=(T(85931),T(8314),T(90912),T(76898)),j=T(59318);const X=B.Z.getLogger("esri.layers.support.fromPortalItem");function ee(){return(ee=(0,x.Z)(function*(_e){const pe="portalItem"in _e?_e:{portalItem:_e},he=yield T.e(7534).then(T.bind(T,7534));try{return yield he.fromItem(pe)}catch(ge){const ye=pe&&pe.portalItem;throw X.error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+(ye&&ye.portal&&ye.portal.url||j.Z.portalUrl)+"', id: '"+(ye&&ye.id||"unset")+"')",ge),ge}})).apply(this,arguments)}var $=T(2004),ne=T(65234);let se=0,ae=class extends(re.Z.EventedMixin((0,J.IG)(W.Z))){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new $.Z(-180,-90,180,90,ne.Z.WGS84),this.id=Date.now().toString(16)+"-layer-"+se++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=ne.Z.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static fromArcGISServerUrl(_e){return(0,x.Z)(function*(){const pe="string"==typeof _e?{url:_e}:_e;return(yield Promise.all([T.e(8592),T.e(164)]).then(T.bind(T,24578))).fromUrl(pe)})()}static fromPortalItem(_e){return function U(_e){return ee.apply(this,arguments)}(_e)}initialize(){this.when().catch(_e=>{var pe,he;(0,Z.D_)(_e)||B.Z.getLogger(this.declaredClass).error("#load()",`Failed to load layer (title: '${null!=(pe=this.title)?pe:"no title"}', id: '${null!=(he=this.id)?he:"no id"}')`,{error:_e})})}destroy(){if(this.parent){const _e=this,pe=this.parent;"layers"in pe&&pe.layers.includes(_e)?pe.layers.remove(_e):"tables"in pe&&pe.tables.includes(_e)?pe.tables.remove(_e):"baseLayers"in pe&&pe.baseLayers.includes(_e)?pe.baseLayers.remove(_e):"baseLayers"in pe&&pe.referenceLayers.includes(_e)&&pe.referenceLayers.remove(_e)}}get hasAttributionData(){return null!=this.attributionDataUrl}get parsedUrl(){const _e=this.url;return _e?(0,ie.mN)(_e):null}fetchAttributionData(){var _e=this;return(0,x.Z)(function*(){const pe=_e.attributionDataUrl;if(_e.hasAttributionData&&pe)return(yield(0,Q.default)(pe,{query:{f:"json"},responseType:"json"})).data;throw new H.Z("layer:no-attribution-data","Layer does not have attribution data")})()}};(0,A._)([(0,ue.Cb)({type:String})],ae.prototype,"attributionDataUrl",void 0),(0,A._)([(0,ue.Cb)({type:$.Z})],ae.prototype,"fullExtent",void 0),(0,A._)([(0,ue.Cb)({readOnly:!0})],ae.prototype,"hasAttributionData",null),(0,A._)([(0,ue.Cb)({type:String,clonable:!1})],ae.prototype,"id",void 0),(0,A._)([(0,ue.Cb)({type:Boolean,nonNullable:!0})],ae.prototype,"legendEnabled",void 0),(0,A._)([(0,ue.Cb)({type:["show","hide","hide-children"]})],ae.prototype,"listMode",void 0),(0,A._)([(0,ue.Cb)({type:Number,range:{min:0,max:1},nonNullable:!0})],ae.prototype,"opacity",void 0),(0,A._)([(0,ue.Cb)({clonable:!1})],ae.prototype,"parent",void 0),(0,A._)([(0,ue.Cb)({readOnly:!0})],ae.prototype,"parsedUrl",null),(0,A._)([(0,ue.Cb)({type:Boolean})],ae.prototype,"popupEnabled",void 0),(0,A._)([(0,ue.Cb)({type:Boolean})],ae.prototype,"attributionVisible",void 0),(0,A._)([(0,ue.Cb)({type:ne.Z})],ae.prototype,"spatialReference",void 0),(0,A._)([(0,ue.Cb)({type:String})],ae.prototype,"title",void 0),(0,A._)([(0,ue.Cb)({readOnly:!0,json:{read:!1}})],ae.prototype,"type",void 0),(0,A._)([(0,ue.Cb)()],ae.prototype,"url",void 0),(0,A._)([(0,ue.Cb)({type:Boolean,nonNullable:!0})],ae.prototype,"visible",void 0),ae=(0,A._)([(0,Y.j)("esri.layers.Layer")],ae);const de=ae},27559:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{default:()=>er});var x=T(15861),A=T(17626),G=T(73281),ce=(T(4832),T(49067),T(96794),T(69747),T(40425),T(69357),T(40342),T(14726),T(33474),T(32088)),oe=T(84792),le=T(46160),Y=T(26584),j=T(63290),X=T(62208),U=T(99959),ee=T(10699),$=T(32917),ne=T(21726),se=T(77712),_e=(T(85931),T(8314),T(52323)),he=(T(90912),T(68653)),ge=T(76898),ye=T(31283),Me=T(44917),Ee=T(50085),Te=T(65088),me=T(49286),Ce=T(6647),Ie=T(99555),Ge=T(10157),Je=T(59787),xe=T(13812),je=T(83989),We=T(47058),Ne=T(74711),we=T(55911),Oe=T(60466),$e=T(36630),Be=T(35031),Se=T(170),De=T(62667),Fe=T(2430),ve=T(86810);let Ke=class extends ve.wq{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};(0,A._)([(0,se.Cb)({type:String,json:{read:!0,write:!0}})],Ke.prototype,"name",void 0),(0,A._)([(0,se.Cb)({type:String,json:{read:!0,write:!0}})],Ke.prototype,"field",void 0),(0,A._)([(0,se.Cb)({type:[Number],json:{read:!0,write:!0}})],Ke.prototype,"currentRangeExtent",void 0),(0,A._)([(0,se.Cb)({type:[Number],json:{read:!0,write:!0}})],Ke.prototype,"fullRangeExtent",void 0),(0,A._)([(0,se.Cb)({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],Ke.prototype,"type",void 0),Ke=(0,A._)([(0,ge.j)("esri.layers.support.RangeInfo")],Ke);var ot,qe=T(72392),be=T(58817),tt=T(40405),Ye=T(14889),et=(T(82255),T(37118)),ke=T(55915);let at=ot=class extends((0,ve.eC)(le.Z.ofType(et.Z))){constructor(Zt){super(Zt)}clone(){return new ot(this.items.map(Zt=>Zt.clone()))}write(Zt,tr){return this.toJSON(tr)}toJSON(Zt){var ir;const tr=null==(ir=null==Zt?void 0:Zt.layer)?void 0:ir.spatialReference;return tr?this.toArray().map(fr=>{if(!tr.equals(fr.spatialReference)){if(!(0,ke.Up)(fr.spatialReference,tr))return Zt&&Zt.messages&&Zt.messages.push(new Ye.Z("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:Zt.layer.spatialReference,context:Zt})),null;const Br=new et.Z;(0,ke.Wt)(fr,Br,tr),fr=Br}const Ur=fr.toJSON(Zt);return delete Ur.spatialReference,Ur}).filter(fr=>null!=fr):((null==Zt?void 0:Zt.messages)&&Zt.messages.push(new Ye.Z("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:Zt.layer.spatialReference,context:Zt})),this.toArray().map(fr=>fr.toJSON(Zt)))}static fromJSON(Zt,tr){const ir=new ot;return Zt.forEach(fr=>ir.add(et.Z.fromJSON(fr,tr))),ir}};at=ot=(0,A._)([(0,ge.j)("esri.layers.support.PolygonCollection")],at);const yt=at;var zt,wt=T(29840);let Rt=zt=class extends ve.wq{constructor(Zt){super(Zt),this.spatialRelationship="disjoint",this.geometries=new yt,this._geometriesSource=null,this._handles=new qe.Z}initialize(){this._handles.add((0,$.on)(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,$.Z_))}destroy(){this._handles.destroy()}readGeometries(Zt,tr,ir){this._geometriesSource={url:(0,wt.f)(Zt,ir),context:ir}}loadGeometries(Zt,tr){var ir=this;return(0,x.Z)(function*(){if((0,X.Wi)(ir._geometriesSource))return;const{url:fr,context:Ur}=ir._geometriesSource,Br=yield(0,oe.default)(fr,{responseType:"json",signal:(0,X.U2)(tr,"signal")}),Zr=Zt.toJSON(),ri=Br.data.map(hr=>yi(or({},hr),{spatialReference:Zr}));ir.geometries=yt.fromJSON(ri,Ur),ir._geometriesSource=null})()}clone(){return new zt({geometries:(0,be.d9)(this.geometries),spatialRelationship:this.spatialRelationship})}};(0,A._)([(0,se.Cb)({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],Rt.prototype,"spatialRelationship",void 0),(0,A._)([(0,se.Cb)({type:yt,nonNullable:!0,json:{write:!0}}),(0,tt.B)({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],Rt.prototype,"geometries",void 0),(0,A._)([(0,he.r)(["web-scene","portal-item"],"geometries")],Rt.prototype,"readGeometries",null),Rt=zt=(0,A._)([(0,ge.j)("esri.layers.support.SceneFilter")],Rt);const Ft=Rt;var bt=T(39683),St=T(84952),Xt=T(49430),Mr=T(92236);const Cr=["3DObject","Point"],Yr=j.Z.getLogger("esri.layers.SceneLayer"),Lr=(0,we.v)();let ct=class extends((0,Ge.Vt)((0,Te.Y)((0,me.q)((0,Ce.I)((0,Ie.M)((0,U.R)((0,Ee.V)(Me.Z)))))))){constructor(...Zt){super(...Zt),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new le.Z,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(Zt,tr){return"string"==typeof Zt?or({url:Zt},tr):Zt}getField(Zt){return this.fieldsIndex.get(Zt)}getFieldDomain(Zt,tr){var fr,Ur,Br,Zr;const ir=null==(Ur=null==(fr=this.getFeatureType(null==tr?void 0:tr.feature))?void 0:fr.domains)?void 0:Ur[Zt];return ir&&"inherited"!==ir.type?ir:null!=(Zr=null==(Br=this.getField(Zt))?void 0:Br.domain)?Zr:null}getFeatureType(Zt){return Zt&&(0,X.pC)(this.associatedLayer)?this.associatedLayer.getFeatureType(Zt):null}get types(){return(0,X.pC)(this.associatedLayer)?this.associatedLayer.types:[]}get typeIdField(){return(0,X.pC)(this.associatedLayer)?this.associatedLayer.typeIdField:null}get formTemplate(){return(0,X.pC)(this.associatedLayer)?this.associatedLayer.formTemplate:null}get fieldsIndex(){return new Oe.Z(this.fields)}readNodePages(Zt,tr,ir){return"Point"===tr.layerType&&(Zt=tr.pointNodePages),null==Zt||"object"!=typeof Zt?null:Be.U4.fromJSON(Zt,ir)}set elevationInfo(Zt){this._set("elevationInfo",Zt),this.loaded&&this._validateElevationInfo()}get geometryType(){return qt[this.profile]||"mesh"}set renderer(Zt){(0,$e.YN)(Zt,this.fieldsIndex),this._set("renderer",Zt)}readCachedDrawingInfo(Zt){return null!=Zt&&"object"==typeof Zt||(Zt={}),null==Zt.color&&(Zt.color=!1),Zt}get capabilities(){const Zt=(0,X.pC)(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:Je.C,{query:tr,editing:{supportsGlobalId:ir,supportsRollbackOnFailure:fr,supportsUploadWithItemId:Ur,supportsReturnServiceEditsInSourceSpatialReference:Br},data:{supportsZ:Zr,supportsM:ri,isVersioned:hr,supportsAttachment:Dr},operations:{supportsEditing:Kr,supportsUpdate:Nt,supportsQuery:lr,supportsQueryAttachments:jr}}=Zt,Ot=Zt.operations.supportsChangeTracking;return{query:tr,editing:{supportsGlobalId:ir,supportsReturnServiceEditsInSourceSpatialReference:Br,supportsRollbackOnFailure:fr,supportsGeometryUpdate:!1,supportsUploadWithItemId:Ur},data:{supportsAttachment:Dr,supportsZ:Zr,supportsM:ri,isVersioned:hr},operations:{supportsQuery:lr,supportsQueryAttachments:jr,supportsEditing:Kr&&Ot,supportsAdd:!1,supportsDelete:!1,supportsUpdate:Nt&&Ot}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(Zt){null!=Zt?this._override("editingEnabled",Zt):this._clearOverride("editingEnabled")}get defaultPopupTemplate(){return(0,X.pC)(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(Zt,tr){return!Zt&&tr.fields&&tr.fields.some(ir=>("esriFieldTypeOID"===ir.type&&(Zt=ir.name),!!Zt)),Zt||void 0}readGlobalIdField(Zt,tr){return!Zt&&tr.fields&&tr.fields.some(ir=>("esriFieldTypeGlobalID"===ir.type&&(Zt=ir.name),!!Zt)),Zt||void 0}get displayField(){return(0,X.pC)(this.associatedLayer)?this.associatedLayer.displayField:null}readProfile(Zt,tr){const ir=tr.store.profile;return null!=ir&&jt[ir]?jt[ir]:(Yr.error("Unknown or missing profile",{profile:ir,layer:this}),"mesh-pyramids")}load(Zt){const tr=(0,X.pC)(Zt)?Zt.signal:null,ir=this.loadFromPortal({supportedTypes:["Scene Service"]},Zt).catch(ee.r9).then(()=>this._fetchService(tr)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,tr),this._setAssociatedFeatureLayer(tr),(0,X.pC)(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>(0,bt.y)(this,{origin:"service"},tr)).then(()=>(0,$e.YN)(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(Zt));return this.addResolvingPromise(ir),Promise.resolve(this)}beforeSave(){var Zt=this;return(0,x.Z)(function*(){(0,X.pC)(Zt.filter)&&(yield Zt.load())})()}createQuery(){const Zt=new St.Z;return"mesh"!==this.geometryType&&(Zt.returnGeometry=!0,Zt.returnZ=!0),Zt.where=this.definitionExpression||"1=1",Zt.sqlFormat="standard",Zt}queryExtent(Zt,tr){return this._getAssociatedLayerForQuery().then(ir=>ir.queryExtent(Zt||this.createQuery(),tr))}queryFeatureCount(Zt,tr){return this._getAssociatedLayerForQuery().then(ir=>ir.queryFeatureCount(Zt||this.createQuery(),tr))}queryFeatures(Zt,tr){return this._getAssociatedLayerForQuery().then(ir=>ir.queryFeatures(Zt||this.createQuery(),tr)).then(ir=>{if(null==ir?void 0:ir.features)for(const fr of ir.features)fr.layer=this,fr.sourceLayer=this;return ir})}queryObjectIds(Zt,tr){return this._getAssociatedLayerForQuery().then(ir=>ir.queryObjectIds(Zt||this.createQuery(),tr))}queryAttachments(Zt,tr){return this._getAssociatedLayerForQuery().then(ir=>ir.queryAttachments(Zt,tr))}getFieldUsageInfo(Zt){const tr={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[Zt]||tr:(Yr.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),tr)}createPopupTemplate(Zt){return(0,Xt.eZ)(this,Zt)}_getAssociatedLayerForQuery(){const Zt=this.associatedLayer;return(0,X.pC)(Zt)&&Zt.loaded?Promise.resolve(Zt):this._loadAssociatedLayerForQuery()}_loadAssociatedLayerForQuery(){var Zt=this;return(0,x.Z)(function*(){if(yield Zt.load(),(0,X.Wi)(Zt.associatedLayer))throw new Y.Z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:Zt});try{yield Zt.associatedLayer.load()}catch(tr){throw new Y.Z("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:Zt,error:tr})}return Zt.associatedLayer})()}hasCachedStatistics(Zt){return null!=this.statisticsInfo&&this.statisticsInfo.some(tr=>tr.name===Zt)}queryCachedStatistics(Zt,tr){var ir=this;return(0,x.Z)(function*(){if(yield ir.load(tr),!ir.statisticsInfo)throw new Y.Z("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const fr=ir.fieldsIndex.get(Zt);if(!fr)throw new Y.Z("scenelayer:field-unexisting",`Field '${Zt}' does not exist on the layer`);for(const Ur of ir.statisticsInfo)if(Ur.name===fr.name){const Br=(0,ne.v_)(ir.parsedUrl.path,Ur.href);return(0,oe.default)(Br,{query:{f:"json",token:ir.apiKey},responseType:"json",signal:tr?tr.signal:null}).then(Zr=>Zr.data)}throw new Y.Z("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")})()}saveAs(Zt,tr){var ir=this;return(0,x.Z)(function*(){return ir._debouncedSaveOperations(Ge.xp.SAVE_AS,yi(or({},tr),{getTypeKeywords:()=>ir._getTypeKeywords(),portalItemLayerType:"scene"}),Zt)})()}save(){var Zt=this;return(0,x.Z)(function*(){const tr={getTypeKeywords:()=>Zt._getTypeKeywords(),portalItemLayerType:"scene"};return Zt._debouncedSaveOperations(Ge.xp.SAVE,tr)})()}applyEdits(Zt,tr){var ir=this;return(0,x.Z)(function*(){const fr=yield T.e(1913).then(T.bind(T,81913));if(yield ir.load(),(0,X.Wi)(ir.associatedLayer))throw new Y.Z(`${ir.type}-layer:not-editable`,"Service is not editable");return yield ir.associatedLayer.load(),fr.applyEdits(ir,ir.associatedLayer.source,Zt,tr)})()}on(Zt,tr){return super.on(Zt,tr)}validateLayer(Zt){if(Zt.layerType&&!Cr.includes(Zt.layerType))throw new Y.Z("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:Zt.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new Y.Z("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new Y.Z("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});!function tr(ir,fr){let Ur=!1,Br=!1;if(null==ir)Ur=!0,Br=!0;else{const Zr=fr&&fr.isGeographic;switch(ir){case"east-north-up":case"earth-centered":Ur=!0,Br=Zr;break;case"vertex-reference-frame":Ur=!0,Br=!Zr;break;default:Ur=!1}}if(!Ur)throw new Y.Z("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!Br)throw new Y.Z("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const Zt=[];if("points"===this.profile)Zt.push("Point");else{if("mesh-pyramids"!==this.profile)throw new Y.Z("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);Zt.push("3DObject")}return Zt}_populateFieldUsageInfo(){if(this._fieldUsageInfo={},this.fields)for(const Zt of this.fields){const tr=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Ur=>Ur.name===Zt.name)),ir=!!((0,X.pC)(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(Ur=>Ur&&Zt.name===Ur.name));this._fieldUsageInfo[Zt.name]={supportsLabelingInfo:tr,supportsRenderer:tr,supportsPopupTemplate:tr||ir,supportsLayerQuery:ir}}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides()}_applyAssociatedLayerFieldsOverrides(){if((0,X.Wi)(this.associatedLayer)||!this.associatedLayer.fields)return;let Zt=null;for(const tr of this.associatedLayer.fields){const ir=this.getField(tr.name);ir?(!ir.domain&&tr.domain&&(ir.domain=tr.domain.clone()),ir.editable=tr.editable,ir.nullable=tr.nullable,ir.length=tr.length):(Zt||(Zt=this.fields?this.fields.slice():[]),Zt.push(tr.clone()))}Zt&&this._set("fields",Zt)}_applyAssociatedLayerPopupOverrides(){if((0,X.Wi)(this.associatedLayer))return;const Zt=["popupTemplate","popupEnabled"],tr=(0,_e.vw)(this);for(let ir=0;ir<Zt.length;ir++){const fr=Zt[ir],Ur=this.originIdOf(fr),Br=this.associatedLayer.originIdOf(fr);Ur<Br&&(Br===ye.s3.SERVICE||Br===ye.s3.PORTAL_ITEM)&&tr.setAtOrigin(fr,this.associatedLayer[fr],Br)}}_setAssociatedFeatureLayer(Zt){var tr=this;return(0,x.Z)(function*(){if(!["mesh-pyramids","points"].includes(tr.profile))return;const ir=new Ne.W(tr.parsedUrl,tr.portalItem,tr.apiKey,Zt);try{tr.associatedLayer=yield ir.fetch()}catch(fr){(0,ee.D_)(fr)||tr._logWarningOnPopupEnabled()}})()}_logWarningOnPopupEnabled(){var Zt=this;return(0,x.Z)(function*(){yield(0,$.N1)(()=>Zt.popupEnabled&&null!=Zt.popupTemplate);const tr=`this SceneLayer: ${Zt.title}`;null==Zt.attributeStorageInfo?Yr.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${tr}`):Yr.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${tr}`)})()}_validateElevationInfo(){const Zt=this.elevationInfo;Zt&&("mesh-pyramids"===this.profile&&"relative-to-scene"===Zt.mode&&Yr.warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),Zt.featureExpressionInfo&&"0"!==Zt.featureExpressionInfo.expression&&Yr.warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};(0,A._)([(0,se.Cb)({types:{key:"type",base:je.B,typeMap:{selection:We.Z}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],ct.prototype,"featureReduction",void 0),(0,A._)([(0,se.Cb)({type:[Ke],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],ct.prototype,"rangeInfos",void 0),(0,A._)([(0,se.Cb)({json:{read:!1}})],ct.prototype,"associatedLayer",void 0),(0,A._)([(0,se.Cb)({type:["show","hide"]})],ct.prototype,"listMode",void 0),(0,A._)([(0,se.Cb)({type:["ArcGISSceneServiceLayer"]})],ct.prototype,"operationalLayerType",void 0),(0,A._)([(0,se.Cb)({json:{read:!1},readOnly:!0})],ct.prototype,"type",void 0),(0,A._)([(0,se.Cb)(yi(or({},Lr.fields),{readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}}))],ct.prototype,"fields",void 0),(0,A._)([(0,se.Cb)()],ct.prototype,"types",null),(0,A._)([(0,se.Cb)()],ct.prototype,"typeIdField",null),(0,A._)([(0,se.Cb)()],ct.prototype,"formTemplate",null),(0,A._)([(0,se.Cb)({readOnly:!0})],ct.prototype,"fieldsIndex",null),(0,A._)([(0,se.Cb)({type:Fe.Z,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],ct.prototype,"floorInfo",void 0),(0,A._)([(0,se.Cb)(Lr.outFields)],ct.prototype,"outFields",void 0),(0,A._)([(0,se.Cb)({type:Be.U4,readOnly:!0,json:{read:!1}})],ct.prototype,"nodePages",void 0),(0,A._)([(0,he.r)("service","nodePages",["nodePages","pointNodePages"])],ct.prototype,"readNodePages",null),(0,A._)([(0,se.Cb)({type:[Be.QI],readOnly:!0})],ct.prototype,"materialDefinitions",void 0),(0,A._)([(0,se.Cb)({type:[Be.Yh],readOnly:!0})],ct.prototype,"textureSetDefinitions",void 0),(0,A._)([(0,se.Cb)({type:[Be.H3],readOnly:!0})],ct.prototype,"geometryDefinitions",void 0),(0,A._)([(0,se.Cb)({readOnly:!0})],ct.prototype,"serviceUpdateTimeStamp",void 0),(0,A._)([(0,se.Cb)({readOnly:!0})],ct.prototype,"attributeStorageInfo",void 0),(0,A._)([(0,se.Cb)({readOnly:!0})],ct.prototype,"statisticsInfo",void 0),(0,A._)([(0,se.Cb)({type:le.Z.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],ct.prototype,"excludeObjectIds",void 0),(0,A._)([(0,se.Cb)({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],ct.prototype,"definitionExpression",void 0),(0,A._)([(0,se.Cb)({type:Ft,json:{name:"layerDefinition.polygonFilter",write:!0}})],ct.prototype,"filter",void 0),(0,A._)([(0,se.Cb)({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],ct.prototype,"path",void 0),(0,A._)([(0,se.Cb)(xe.PV)],ct.prototype,"elevationInfo",null),(0,A._)([(0,se.Cb)({type:String})],ct.prototype,"geometryType",null),(0,A._)([(0,se.Cb)(xe.iR)],ct.prototype,"labelsVisible",void 0),(0,A._)([(0,se.Cb)({type:[Se.Z],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:De.r},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:De.r},write:!0}})],ct.prototype,"labelingInfo",void 0),(0,A._)([(0,se.Cb)(xe.rn)],ct.prototype,"legendEnabled",void 0),(0,A._)([(0,se.Cb)({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(Zt,tr){var fr,Ur;if("number"==typeof Zt&&Zt>=0&&Zt<=1)return Zt;const ir=null==(Ur=null==(fr=tr.layerDefinition)?void 0:fr.drawingInfo)?void 0:Ur.transparency;return void 0!==ir?(0,Mr.b)(ir):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],ct.prototype,"opacity",void 0),(0,A._)([(0,se.Cb)({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],ct.prototype,"priority",void 0),(0,A._)([(0,se.Cb)({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],ct.prototype,"semantic",void 0),(0,A._)([(0,se.Cb)({types:ce.o,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],ct.prototype,"renderer",null),(0,A._)([(0,se.Cb)({json:{read:!1}})],ct.prototype,"cachedDrawingInfo",void 0),(0,A._)([(0,he.r)("service","cachedDrawingInfo")],ct.prototype,"readCachedDrawingInfo",null),(0,A._)([(0,se.Cb)({readOnly:!0,json:{read:!1}})],ct.prototype,"capabilities",null),(0,A._)([(0,se.Cb)({type:Boolean,json:{read:!1}})],ct.prototype,"editingEnabled",null),(0,A._)([(0,se.Cb)(xe.C_)],ct.prototype,"popupEnabled",void 0),(0,A._)([(0,se.Cb)({type:G.Z,json:{name:"popupInfo",write:!0}})],ct.prototype,"popupTemplate",void 0),(0,A._)([(0,se.Cb)({readOnly:!0,json:{read:!1}})],ct.prototype,"defaultPopupTemplate",null),(0,A._)([(0,se.Cb)({type:String,json:{read:!1}})],ct.prototype,"objectIdField",void 0),(0,A._)([(0,he.r)("service","objectIdField",["objectIdField","fields"])],ct.prototype,"readObjectIdField",null),(0,A._)([(0,se.Cb)({type:String,json:{read:!1}})],ct.prototype,"globalIdField",void 0),(0,A._)([(0,he.r)("service","globalIdField",["globalIdField","fields"])],ct.prototype,"readGlobalIdField",null),(0,A._)([(0,se.Cb)({readOnly:!0,type:String,json:{read:!1}})],ct.prototype,"displayField",null),(0,A._)([(0,se.Cb)({type:String,json:{read:!1}})],ct.prototype,"profile",void 0),(0,A._)([(0,he.r)("service","profile",["store.profile"])],ct.prototype,"readProfile",null),(0,A._)([(0,se.Cb)({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],ct.prototype,"normalReferenceFrame",void 0),(0,A._)([(0,se.Cb)(xe.YI)],ct.prototype,"screenSizePerspectiveEnabled",void 0),ct=(0,A._)([(0,ge.j)("esri.layers.SceneLayer")],ct);const jt={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},qt={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},er=ct},12818:(dt,Re,T)=>{"use strict";T.d(Re,{rM:()=>zt,ij:()=>ke,cW:()=>ot});var x=T(26584),A=T(94113),G=T(20414),Q=T(23841),H=T(55494),re=T(28347);class le{constructor(St,Xt,Mr){this.strength=St,this.radius=Xt,this.threshold=Mr,this.type="bloom"}interpolate(St,Xt,Mr){this.strength=$(St.strength,Xt.strength,Mr),this.radius=$(St.radius,Xt.radius,Mr),this.threshold=$(St.threshold,Xt.threshold,Mr)}clone(){return new le(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:ne(this.radius),strength:this.strength,threshold:this.threshold}}}class Y{constructor(St){this.radius=St,this.type="blur"}interpolate(St,Xt,Mr){this.radius=Math.round($(St.radius,Xt.radius,Mr))}clone(){return new Y(this.radius)}toJSON(){return{type:"blur",radius:ne(this.radius)}}}class j{constructor(St,Xt){this.type=St,this.amount=Xt,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(St,Xt,Mr){this.amount=$(St.amount,Xt.amount,Mr),this._updateMatrix()}clone(){return new j(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const St=this._colorMatrix||(0,H.c)();switch(this.type){case"brightness":this._colorMatrix=((bt,St)=>{const Xt=(0,re.s)(bt,St,0,0,0,0,St,0,0,0,0,St,0,0,0,0,1);return(0,re.t)(Xt,Xt)})(St,this.amount);break;case"contrast":this._colorMatrix=((bt,St)=>{const Xt=(0,re.s)(bt,St,0,0,.5-.5*St,0,St,0,.5-.5*St,0,0,St,.5-.5*St,0,0,0,1);return(0,re.t)(Xt,Xt)})(St,this.amount);break;case"grayscale":this._colorMatrix=((bt,St)=>{const Xt=1-this.amount,Mr=(0,re.s)(bt,.2126+.7874*Xt,.7152-.7152*Xt,.0722-.0722*Xt,0,.2126-.2126*Xt,.7152+.2848*Xt,.0722-.0722*Xt,0,.2126-.2126*Xt,.7152-.7152*Xt,.0722+.9278*Xt,0,0,0,0,1);return(0,re.t)(Mr,Mr)})(St);break;case"invert":this._colorMatrix=((bt,St)=>{const Xt=1-2*St,Mr=(0,re.s)(bt,Xt,0,0,St,0,Xt,0,St,0,0,Xt,St,0,0,0,1);return(0,re.t)(Mr,Mr)})(St,this.amount);break;case"saturate":this._colorMatrix=((bt,St)=>{const Xt=(0,re.s)(bt,.213+.787*St,.715-.715*St,.072-.072*St,0,.213-.213*St,.715+.285*St,.072-.072*St,0,.213-.213*St,.715-.715*St,.072+.928*St,0,0,0,0,1);return(0,re.t)(Xt,Xt)})(St,this.amount);break;case"sepia":this._colorMatrix=((bt,St)=>{const Xt=1-this.amount,Mr=(0,re.s)(bt,.393+.607*Xt,.769-.769*Xt,.189-.189*Xt,0,.349-.349*Xt,.686+.314*Xt,.168-.168*Xt,0,.272-.272*Xt,.534-.534*Xt,.131+.869*Xt,0,0,0,0,1);return(0,re.t)(Mr,Mr)})(St)}}}class X{constructor(St,Xt,Mr,Cr){this.offsetX=St,this.offsetY=Xt,this.blurRadius=Mr,this.color=Cr,this.type="drop-shadow"}interpolate(St,Xt,Mr){this.offsetX=$(St.offsetX,Xt.offsetX,Mr),this.offsetY=$(St.offsetY,Xt.offsetY,Mr),this.blurRadius=$(St.blurRadius,Xt.blurRadius,Mr),this.color[0]=Math.round($(St.color[0],Xt.color[0],Mr)),this.color[1]=Math.round($(St.color[1],Xt.color[1],Mr)),this.color[2]=Math.round($(St.color[2],Xt.color[2],Mr)),this.color[3]=$(St.color[3],Xt.color[3],Mr)}clone(){return new X(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const St=[...this.color];return St[3]*=255,{type:"drop-shadow",xoffset:ne(this.offsetX),yoffset:ne(this.offsetY),blurRadius:ne(this.blurRadius),color:St}}}class U{constructor(St){this.angle=St,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(St,Xt,Mr){this.angle=$(St.angle,Xt.angle,Mr),this._updateMatrix()}clone(){return new U(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const St=this._colorMatrix||(0,H.c)();this._colorMatrix=((bt,St)=>{const Xt=Math.sin(St*Math.PI/180),Mr=Math.cos(St*Math.PI/180),Cr=(0,re.s)(bt,.213+.787*Mr-.213*Xt,.715-.715*Mr-.715*Xt,.072-.072*Mr+.928*Xt,0,.213-.213*Mr+.143*Xt,.715+.285*Mr+.14*Xt,.072-.072*Mr-.283*Xt,0,.213-.213*Mr-.787*Xt,.715-.715*Mr+.715*Xt,.072+.928*Mr+.072*Xt,0,0,0,0,1);return(0,re.t)(Cr,Cr)})(St,this.angle)}}class ee{constructor(St){this.amount=St,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(St,Xt,Mr){this.amount=$(St.amount,Xt.amount,Mr)}clone(){return new ee(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function $(bt,St,Xt){return bt+(St-bt)*Xt}function ne(bt){return Math.round(1e3*(0,Q.Wz)(bt))/1e3}function se(bt){switch(bt.type){case"grayscale":case"sepia":case"invert":return new j(bt.type,0);case"saturate":case"brightness":case"contrast":return new j(bt.type,1);case"opacity":return new ee(1);case"hue-rotate":return new U(0);case"blur":return new Y(0);case"drop-shadow":return new X(0,0,0,[...(0,G.h$)("transparent")]);case"bloom":return new le(0,0,1)}}function de(bt,St){const Xt=bt.length>St.length?bt:St;return(bt.length>St.length?St:bt).every((Mr,Cr)=>Mr.type===Xt[Cr].type)}function _e(bt,St){const Xt=bt.length>St.length?bt:St,Mr=bt.length>St.length?St:bt;for(let Cr=Mr.length;Cr<Xt.length;Cr++)Mr.push(se(Xt[Cr]))}T(1719);var he,ye={exports:{}};function Me(bt){if(!bt||0===bt.length)return null;if("string"==typeof bt){const Xt=Ee(bt);return Xt&&0!==Xt.length?Xt:null}const St=bt.map(Xt=>{if(!Number.isFinite(Xt.scale)||Xt.scale<=0)throw new x.Z("effect:invalid-scale","scale must be finite and greater than 0",{stop:Xt});return{scale:Xt.scale,effects:Ee(Xt.value)}});St.sort((Xt,Mr)=>Mr.effects.length-Xt.effects.length);for(let Xt=0;Xt<St.length-1;Xt++){if(!de(St[Xt].effects,St[Xt+1].effects))throw new x.Z("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:St[Xt].effects,b:St[Xt+1].effects});_e(St[Xt].effects,St[Xt+1].effects)}return St.sort((Xt,Mr)=>Mr.scale-Xt.scale),St}function Ee(bt){let St;if(!bt)return[];try{St=ye.exports.parse(bt)}catch(Xt){throw new x.Z("effect:invalid-syntax","Invalid effect syntax",{value:bt,error:Xt})}return St.map(Xt=>function Te(bt){try{switch(bt.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return function me(bt){let St=1;return je(bt.parameters,1),1===bt.parameters.length&&(St=Fe(bt.parameters[0])),new j(bt.name,St)}(bt);case"opacity":return function Ce(bt){let St=1;return je(bt.parameters,1),1===bt.parameters.length&&(St=Fe(bt.parameters[0])),new ee(St)}(bt);case"hue-rotate":return function Ie(bt){let St=0;return je(bt.parameters,1),1===bt.parameters.length&&(St=function Ke(bt){return function Be(bt){if("quantity"!==bt.type||!(0===bt.value&&null===bt.unit||bt.unit&&null!=$e[bt.unit]))throw new x.Z("effect:type-error",`Expected <angle>, Actual: ${We(bt)}`,{term:bt})}(bt),bt.value*$e[bt.unit]||0}(bt.parameters[0])),new U(St)}(bt);case"blur":return function Ge(bt){let St=0;return je(bt.parameters,1),1===bt.parameters.length&&(St=qe(bt.parameters[0]),Ne(St,bt.parameters[0])),new Y(St)}(bt);case"drop-shadow":return function Je(bt){const St=[];let Xt=null;for(const Mr of bt.parameters)if("color"===Mr.type){if(St.length&&Object.freeze(St),Xt)throw new x.Z("effect:type-error","Accepts only one color",{});Xt=be(Mr)}else{const Cr=qe(Mr);if(Object.isFrozen(St))throw new x.Z("effect:type-error","<length> parameters not consecutive",{lengths:St});St.push(Cr),3===St.length&&Ne(Cr,Mr)}if(St.length<2||St.length>3)throw new x.Z("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${St.length}}`,{lengths:St});return new X(St[0],St[1],St[2]||0,Xt||tt("black"))}(bt);case"bloom":return function xe(bt){let St=1,Xt=0,Mr=0;return je(bt.parameters,3),bt.parameters[0]&&(St=Fe(bt.parameters[0])),bt.parameters[1]&&(Xt=qe(bt.parameters[1]),Ne(Xt,bt.parameters[1])),bt.parameters[2]&&(Mr=Fe(bt.parameters[2])),new le(St,Xt,Mr)}(bt)}}catch(St){throw St.details.filter=bt,St}throw new x.Z("effect:unknown-effect",`Effect '${bt.name}' is not supported`,{effect:bt})}(Xt))}function je(bt,St){if(bt.length>St)throw new x.Z("effect:type-error",`Function supports up to ${St} parameters, Actual: ${bt.length}`,{parameters:bt})}function We(bt){if("color"===bt.type)return"<color>";if(bt.unit){if(Se[bt.unit])return"<length>";if($e[bt.unit])return"<angle>";if("%"===bt.unit)return"<percentage>"}return"<double>"}function Ne(bt,St){if(bt<0)throw new x.Z("effect:type-error",`Negative values are not allowed, Actual: ${bt}`,{term:St})}(he=ye).exports&&(he.exports=function(){function St(Cr,Yr,Lr,ct){var jt=Error.call(this,Cr);return Object.setPrototypeOf&&Object.setPrototypeOf(jt,St.prototype),jt.expected=Yr,jt.found=Lr,jt.location=ct,jt.name="SyntaxError",jt}function Xt(Cr,Yr,Lr){return Lr=Lr||" ",Cr.length>Yr?Cr:Cr+(Lr+=Lr.repeat(Yr-=Cr.length)).slice(0,Yr)}return function bt(Cr,Yr){function Lr(){this.constructor=Cr}Lr.prototype=Yr.prototype,Cr.prototype=new Lr}(St,Error),St.prototype.format=function(Cr){var Yr="Error: "+this.message;if(this.location){var Lr,ct=null;for(Lr=0;Lr<Cr.length;Lr++)if(Cr[Lr].source===this.location.source){ct=Cr[Lr].text.split(/\r\n|\n|\r/g);break}var jt=this.location.start,qt=this.location.source+":"+jt.line+":"+jt.column;if(ct){var er=this.location.end,Zt=Xt("",jt.line.toString().length),tr=ct[jt.line-1],ir=jt.line===er.line?er.column:tr.length+1;Yr+="\n --\x3e "+qt+"\n"+Zt+" |\n"+jt.line+" | "+tr+"\n"+Zt+" | "+Xt("",jt.column-1)+Xt("",ir-jt.column,"^")}else Yr+="\n at "+qt}return Yr},St.buildMessage=function(Cr,Yr){var Lr={literal:function(ir){return'"'+jt(ir.text)+'"'},class:function(ir){var fr=ir.parts.map(function(Ur){return Array.isArray(Ur)?qt(Ur[0])+"-"+qt(Ur[1]):qt(Ur)});return"["+(ir.inverted?"^":"")+fr+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(ir){return ir.description}};function ct(ir){return ir.charCodeAt(0).toString(16).toUpperCase()}function jt(ir){return ir.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(fr){return"\\x0"+ct(fr)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(fr){return"\\x"+ct(fr)})}function qt(ir){return ir.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(fr){return"\\x0"+ct(fr)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(fr){return"\\x"+ct(fr)})}function er(ir){return Lr[ir.type](ir)}return"Expected "+function Zt(ir){var fr,Ur,Br=ir.map(er);if(Br.sort(),Br.length>0){for(fr=1,Ur=1;fr<Br.length;fr++)Br[fr-1]!==Br[fr]&&(Br[Ur]=Br[fr],Ur++);Br.length=Ur}switch(Br.length){case 1:return Br[0];case 2:return Br[0]+" or "+Br[1];default:return Br.slice(0,-1).join(", ")+", or "+Br[Br.length-1]}}(Cr)+" but "+function tr(ir){return ir?'"'+jt(ir)+'"':"end of input"}(Yr)+" found."},{SyntaxError:St,parse:function Mr(Cr,Yr){var Lr,ct={},jt=(Yr=void 0!==Yr?Yr:{}).grammarSource,qt={start:Gr},er=Gr,Fr=/^[ \t\n\r]/,ii=/^[a-z\-]/,mi=/^[0-9a-fA-F]/,wi=/^[+\-]/,Qr=/^[0-9]/,Ni=Ht("none"),Hs=Jn("none",!1),Ar=Jn(")",!1),ni=Jn(",",!1),_i=Ht("whitespace"),Ii=us([" ","\t","\n","\r"],!1,!1),ji=Ht("function"),Gi=Jn("(",!1),es=Ht("identifier"),zr=us([["a","z"],"-"],!1,!1),gs=Ht("percentage"),hi=Jn("%",!1),ln=Ht("length"),ds=Jn("px",!1),Mt=Jn("cm",!1),Hr=Jn("mm",!1),Ir=Jn("in",!1),gi=Jn("pt",!1),Ui=Jn("pc",!1),is=Ht("angle"),ss=Jn("deg",!1),ts=Jn("rad",!1),ys=Jn("grad",!1),ps=Jn("turn",!1),Ds=Ht("number"),Ps=Ht("color"),ms=Jn("#",!1),Un=us([["0","9"],["a","f"],["A","F"]],!1,!1),gr=us(["+","-"],!1,!1),Sr=us([["0","9"]],!1,!1),mr=Jn(".",!1),Wr=Jn("e",!1),ti=0,Nn=0,Wa=[{line:1,column:1}],zo=0,nn=[],cs=0;if("startRule"in Yr){if(!(Yr.startRule in qt))throw new Error("Can't start parsing from rule \""+Yr.startRule+'".');er=qt[Yr.startRule]}function Yn(){return Cr.substring(Nn,ti)}function Jn(Nr,Ei){return{type:"literal",text:Nr,ignoreCase:Ei}}function us(Nr,Ei,Vi){return{type:"class",parts:Nr,inverted:Ei,ignoreCase:Vi}}function Ht(Nr){return{type:"other",description:Nr}}function kt(Nr){var Ei,Vi=Wa[Nr];if(Vi)return Vi;for(Ei=Nr-1;!Wa[Ei];)Ei--;for(Vi={line:(Vi=Wa[Ei]).line,column:Vi.column};Ei<Nr;)10===Cr.charCodeAt(Ei)?(Vi.line++,Vi.column=1):Vi.column++,Ei++;return Wa[Nr]=Vi,Vi}function Tr(Nr){ti<zo||(ti>zo&&(zo=ti,nn=[]),nn.push(Nr))}function Gr(){var Nr;return(Nr=function oi(){var Nr,Ei;return cs++,Nr=ti,ai(),"none"===Cr.substr(ti,4)?(Ei="none",ti+=4):(Ei=ct,0===cs&&Tr(Hs)),Ei!==ct?(ai(),Nn=Nr,Nr=[]):(ti=Nr,Nr=ct),cs--,Nr===ct&&0===cs&&Tr(Ni),Nr}())===ct&&(Nr=function At(){var Nr,Ei;if(Nr=[],(Ei=Bt())!==ct)for(;Ei!==ct;)Nr.push(Ei),Ei=Bt();else Nr=ct;return Nr}()),Nr}function Bt(){var Nr,Ei,Vi,yn;return Nr=ti,ai(),(Ei=function Hi(){var Nr,Ei,Vi;return cs++,Nr=ti,(Ei=fs())!==ct?(40===Cr.charCodeAt(ti)?(Vi="(",ti++):(Vi=ct,0===cs&&Tr(Gi)),Vi!==ct?(Nn=Nr,Nr=Ei):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),cs--,Nr===ct&&(Ei=ct,0===cs&&Tr(ji)),Nr}())!==ct?(ai(),(Vi=function vr(){var Nr,Ei,Vi,yn,Go,Cn,Do,El;if(Nr=ti,(Ei=kr())!==ct){for(Vi=[],yn=ti,Go=ai(),44===Cr.charCodeAt(ti)?(Cn=",",ti++):(Cn=ct,0===cs&&Tr(ni)),Cn===ct&&(Cn=null),Do=ai(),(El=kr())!==ct?yn=Go=[Go,Cn,Do,El]:(ti=yn,yn=ct);yn!==ct;)Vi.push(yn),yn=ti,Go=ai(),44===Cr.charCodeAt(ti)?(Cn=",",ti++):(Cn=ct,0===cs&&Tr(ni)),Cn===ct&&(Cn=null),Do=ai(),(El=kr())!==ct?yn=Go=[Go,Cn,Do,El]:(ti=yn,yn=ct);Nn=Nr,Nr=function(Nr,Ei){return Ei.length>0?function ud(Nr,Ei,Vi){return[Nr].concat(function Va(Nr,Ei){return Nr.map(function(Vi){return Vi[Ei]})}(Ei,Vi))}(Nr,Ei,3):[Nr]}(Ei,Vi)}else ti=Nr,Nr=ct;return Nr}())===ct&&(Vi=null),ai(),41===Cr.charCodeAt(ti)?(yn=")",ti++):(yn=ct,0===cs&&Tr(Ar)),yn!==ct?(ai(),Nn=Nr,Nr=function(Nr,Ei){return{type:"function",name:Nr,parameters:Ei||[]}}(Ei,Vi)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr}function kr(){var Nr,Ei;return Nr=ti,(Ei=function Tn(){var Nr,Ei,Vi;return cs++,Nr=ti,ai(),(Ei=Sn())!==ct?(37===Cr.charCodeAt(ti)?(Vi="%",ti++):(Vi=ct,0===cs&&Tr(hi)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"%"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),cs--,Nr===ct&&0===cs&&Tr(gs),Nr}())===ct&&(Ei=function On(){var Nr,Ei,Vi;return cs++,Nr=ti,ai(),(Ei=Sn())!==ct?("px"===Cr.substr(ti,2)?(Vi="px",ti+=2):(Vi=ct,0===cs&&Tr(ds)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"px"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr===ct&&(Nr=ti,ai(),(Ei=Sn())!==ct?("cm"===Cr.substr(ti,2)?(Vi="cm",ti+=2):(Vi=ct,0===cs&&Tr(Mt)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"cm"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr===ct&&(Nr=ti,ai(),(Ei=Sn())!==ct?("mm"===Cr.substr(ti,2)?(Vi="mm",ti+=2):(Vi=ct,0===cs&&Tr(Hr)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"mm"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr===ct&&(Nr=ti,ai(),(Ei=Sn())!==ct?("in"===Cr.substr(ti,2)?(Vi="in",ti+=2):(Vi=ct,0===cs&&Tr(Ir)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"in"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr===ct&&(Nr=ti,ai(),(Ei=Sn())!==ct?("pt"===Cr.substr(ti,2)?(Vi="pt",ti+=2):(Vi=ct,0===cs&&Tr(gi)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"pt"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr===ct&&(Nr=ti,ai(),(Ei=Sn())!==ct?("pc"===Cr.substr(ti,2)?(Vi="pc",ti+=2):(Vi=ct,0===cs&&Tr(Ui)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"pc"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct)))))),cs--,Nr===ct&&0===cs&&Tr(ln),Nr}())===ct&&(Ei=function rn(){var Nr,Ei,Vi;return cs++,Nr=ti,(Ei=Sn())!==ct?("deg"===Cr.substr(ti,3)?(Vi="deg",ti+=3):(Vi=ct,0===cs&&Tr(ss)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"deg"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr===ct&&(Nr=ti,(Ei=Sn())!==ct?("rad"===Cr.substr(ti,3)?(Vi="rad",ti+=3):(Vi=ct,0===cs&&Tr(ts)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"rad"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr===ct&&(Nr=ti,(Ei=Sn())!==ct?("grad"===Cr.substr(ti,4)?(Vi="grad",ti+=4):(Vi=ct,0===cs&&Tr(ys)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"grad"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct),Nr===ct&&(Nr=ti,(Ei=Sn())!==ct?("turn"===Cr.substr(ti,4)?(Vi="turn",ti+=4):(Vi=ct,0===cs&&Tr(ps)),Vi!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:"turn"}}(Ei)):(ti=Nr,Nr=ct)):(ti=Nr,Nr=ct)))),cs--,Nr===ct&&(Ei=ct,0===cs&&Tr(is)),Nr}())===ct&&(Ei=function hn(){var Nr,Ei;return cs++,Nr=ti,ai(),(Ei=Sn())!==ct?(Nn=Nr,Nr=function(Nr){return{value:Nr,unit:null}}(Ei)):(ti=Nr,Nr=ct),cs--,Nr===ct&&0===cs&&Tr(Ds),Nr}()),Ei!==ct&&(Nn=Nr,Ei=function(Nr){return{type:"quantity",value:Nr.value,unit:Nr.unit}}(Ei)),(Nr=Ei)===ct&&(Nr=ti,(Ei=function no(){var Nr,Ei,Vi,yn;if(cs++,Nr=ti,35===Cr.charCodeAt(ti)?(Ei="#",ti++):(Ei=ct,0===cs&&Tr(ms)),Ei!==ct){if(Vi=[],mi.test(Cr.charAt(ti))?(yn=Cr.charAt(ti),ti++):(yn=ct,0===cs&&Tr(Un)),yn!==ct)for(;yn!==ct;)Vi.push(yn),mi.test(Cr.charAt(ti))?(yn=Cr.charAt(ti),ti++):(yn=ct,0===cs&&Tr(Un));else Vi=ct;Vi!==ct?(Nn=Nr,Nr={type:"hex",value:Yn()}):(ti=Nr,Nr=ct)}else ti=Nr,Nr=ct;return Nr===ct&&(Nr=ti,(Ei=Bt())!==ct&&(Nn=Nr,Ei=function(Nr){return{type:"function",value:Nr}}(Ei)),(Nr=Ei)===ct&&(Nr=ti,(Ei=fs())!==ct&&(Nn=Nr,Ei={type:"named",value:Yn()}),Nr=Ei)),cs--,Nr===ct&&(Ei=ct,0===cs&&Tr(Ps)),Nr}())!==ct&&(Nn=Nr,Ei=function(Nr){return{type:"color",colorType:Nr.type,value:Nr.value}}(Ei)),Nr=Ei),Nr}function ai(){var Nr,Ei;for(cs++,Nr=[],Fr.test(Cr.charAt(ti))?(Ei=Cr.charAt(ti),ti++):(Ei=ct,0===cs&&Tr(Ii));Ei!==ct;)Nr.push(Ei),Fr.test(Cr.charAt(ti))?(Ei=Cr.charAt(ti),ti++):(Ei=ct,0===cs&&Tr(Ii));return cs--,Ei=ct,0===cs&&Tr(_i),Nr}function fs(){var Nr,Ei,Vi;if(cs++,Nr=ti,Ei=[],ii.test(Cr.charAt(ti))?(Vi=Cr.charAt(ti),ti++):(Vi=ct,0===cs&&Tr(zr)),Vi!==ct)for(;Vi!==ct;)Ei.push(Vi),ii.test(Cr.charAt(ti))?(Vi=Cr.charAt(ti),ti++):(Vi=ct,0===cs&&Tr(zr));else Ei=ct;return Ei!==ct&&(Nn=Nr,Ei=Yn()),cs--,(Nr=Ei)===ct&&(Ei=ct,0===cs&&Tr(es)),Nr}function Sn(){var Nr,Ei,Vi,yn,Go,Cn,Do;for(Nr=ti,wi.test(Cr.charAt(ti))?(Cr.charAt(ti),ti++):0===cs&&Tr(gr),Ei=ti,Vi=[],Qr.test(Cr.charAt(ti))?(yn=Cr.charAt(ti),ti++):(yn=ct,0===cs&&Tr(Sr));yn!==ct;)Vi.push(yn),Qr.test(Cr.charAt(ti))?(yn=Cr.charAt(ti),ti++):(yn=ct,0===cs&&Tr(Sr));if(46===Cr.charCodeAt(ti)?(yn=".",ti++):(yn=ct,0===cs&&Tr(mr)),yn!==ct){if(Go=[],Qr.test(Cr.charAt(ti))?(Cn=Cr.charAt(ti),ti++):(Cn=ct,0===cs&&Tr(Sr)),Cn!==ct)for(;Cn!==ct;)Go.push(Cn),Qr.test(Cr.charAt(ti))?(Cn=Cr.charAt(ti),ti++):(Cn=ct,0===cs&&Tr(Sr));else Go=ct;Go!==ct?Ei=Vi=[Vi,yn,Go]:(ti=Ei,Ei=ct)}else ti=Ei,Ei=ct;if(Ei===ct)if(Ei=[],Qr.test(Cr.charAt(ti))?(Vi=Cr.charAt(ti),ti++):(Vi=ct,0===cs&&Tr(Sr)),Vi!==ct)for(;Vi!==ct;)Ei.push(Vi),Qr.test(Cr.charAt(ti))?(Vi=Cr.charAt(ti),ti++):(Vi=ct,0===cs&&Tr(Sr));else Ei=ct;if(Ei!==ct){if(Vi=ti,101===Cr.charCodeAt(ti)?(yn="e",ti++):(yn=ct,0===cs&&Tr(Wr)),yn!==ct){if(wi.test(Cr.charAt(ti))?(Go=Cr.charAt(ti),ti++):(Go=ct,0===cs&&Tr(gr)),Go===ct&&(Go=null),Cn=[],Qr.test(Cr.charAt(ti))?(Do=Cr.charAt(ti),ti++):(Do=ct,0===cs&&Tr(Sr)),Do!==ct)for(;Do!==ct;)Cn.push(Do),Qr.test(Cr.charAt(ti))?(Do=Cr.charAt(ti),ti++):(Do=ct,0===cs&&Tr(Sr));else Cn=ct;Cn!==ct?Vi=yn=[yn,Go,Cn]:(ti=Vi,Vi=ct)}else ti=Vi,Vi=ct;Vi===ct&&(Vi=null),Nn=Nr,Nr=parseFloat(Yn())}else ti=Nr,Nr=ct;return Nr}if((Lr=er())!==ct&&ti===Cr.length)return Lr;throw Lr!==ct&&ti<Cr.length&&Tr({type:"end"}),function _r(Nr,Ei,Vi){return new St(St.buildMessage(Nr,Ei),Nr,Ei,Vi)}(nn,zo<Cr.length?Cr.charAt(zo):null,function ur(Nr,Ei){var Vi=kt(Nr),yn=kt(Ei);return{source:jt,start:{offset:Nr,line:Vi.line,column:Vi.column},end:{offset:Ei,line:yn.line,column:yn.column}}}(zo,zo<Cr.length?zo+1:zo))}}}());const $e={deg:1,grad:.9,rad:180/Math.PI,turn:360},Se={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function Fe(bt){!function Oe(bt){if("quantity"!==bt.type||null!==bt.unit&&"%"!==bt.unit)throw new x.Z("effect:type-error",`Expected <double> or <percentage>, Actual: ${We(bt)}`,{term:bt})}(bt);const St=bt.value;return Ne(St,bt),"%"===bt.unit?.01*St:St}function qe(bt){return function De(bt){if("quantity"!==bt.type||!(0===bt.value&&null===bt.unit||bt.unit&&null!=Se[bt.unit]))throw new x.Z("effect:type-error",`Expected <length>, Actual: ${We(bt)}`,{term:bt})}(bt),bt.value*Se[bt.unit]||0}function be(bt){switch(bt.colorType){case"hex":return(0,G.rW)(bt.value);case"named":return tt(bt.value);case"function":return function et(bt){if(je(bt.parameters,4),Ye.test(bt.name))return[Fe(bt.parameters[0]),Fe(bt.parameters[1]),Fe(bt.parameters[2]),bt.parameters[3]?Fe(bt.parameters[3]):1];if(ze.test(bt.name))return(0,G.B7)(function ve(bt){return function we(bt){if("quantity"!==bt.type||null!==bt.unit)throw new x.Z("effect:type-error",`Expected <double>, Actual: ${We(bt)}`,{term:bt})}(bt),Ne(bt.value,bt),bt.value}(bt.parameters[0]),Fe(bt.parameters[1]),Fe(bt.parameters[2]),bt.parameters[3]?Fe(bt.parameters[3]):1);throw new x.Z("effect:syntax-error",`Invalid color function '${bt.name}'`,{colorFunction:bt})}(bt.value)}}function tt(bt){if(!(0,G.St)(bt))throw new x.Z("effect:unknown-color",`color '${bt}' isn't valid`,{namedColor:bt});return(0,G.VL)(bt)}const Ye=/^rgba?/i,ze=/^hsla?/i;function ke(bt,St,Xt){var Mr;try{return function yt(bt){if(!bt||0===bt.length)return null;if(function wt(bt){const St=bt[0];return!!St&&"scale"in St}(bt)){const St=[];for(const Xt of bt)St.push({scale:Xt.scale,value:zt(Xt.value)});return St}return zt(bt)}(bt)}catch(Cr){null==(Mr=null==Xt?void 0:Xt.messages)||Mr.push(Cr)}return null}function ot(bt,St,Xt,Mr){try{const Cr=function at(bt){const St=Me(bt);return St?function pe(bt){const St=bt[0];return!!St&&"type"in St}(St)?St.map(Xt=>Xt.toJSON()):St.map(({scale:Xt,effects:Mr})=>({scale:Xt,value:Mr.map(Cr=>Cr.toJSON())})):null}(bt);(0,A.RB)(Xt,Cr,St)}catch(Cr){Mr.messages&&Mr.messages.push(Cr)}}function zt(bt){if(!bt||!bt.length)return"";const St=[];for(const Xt of bt){let Mr=[];switch(Xt.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":Mr=[Rt(Xt,"amount")];break;case"blur":Mr=[Rt(Xt,"radius","pt")];break;case"hue-rotate":Mr=[Rt(Xt,"angle","deg")];break;case"drop-shadow":Mr=[Rt(Xt,"xoffset","pt"),Rt(Xt,"yoffset","pt"),Rt(Xt,"blurRadius","pt"),Ft(Xt,"color")];break;case"bloom":Mr=[Rt(Xt,"strength"),Rt(Xt,"radius","pt"),Rt(Xt,"threshold")]}const Cr=`${Xt.type}(${Mr.filter(Boolean).join(" ")})`;Me(Cr),St.push(Cr)}return St.join(" ")}function Rt(bt,St,Xt){if(null==bt[St])throw new x.Z("effect:missing-parameter",`Missing parameter '${St}' in ${bt.type} effect`,{effect:bt});return Xt?bt[St]+Xt:""+bt[St]}function Ft(bt,St){if(null==bt[St])throw new x.Z("effect:missing-parameter",`Missing parameter '${St}' in ${bt.type} effect`,{effect:bt});const Xt=bt[St];return`rgba(${Xt[0]||0}, ${Xt[1]||0}, ${Xt[2]||0}, ${Xt[3]/255||0})`}},66385:(dt,Re,T)=>{"use strict";T.d(Re,{S6:()=>G,nd:()=>Q,u_:()=>A});var x=T(62208);class A{constructor(re=null,J={},W,B){this.geometry=re,this.attributes=J,this.centroid=W,this.objectId=B,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const re=new A(this.geometry,this.attributes,this.centroid,this.objectId);return re.displayId=this.displayId,re.geohashX=this.geohashX,re.geohashY=this.geohashY,re}}function G(H){return!((0,x.Wi)(H.geometry)||!H.geometry.coords||!H.geometry.coords.length)}class Q extends A{}},95786:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>x});class x{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const G=new x;return G.objectIdFieldName=this.objectIdFieldName,G.globalIdFieldName=this.globalIdFieldName,G.geohashFieldName=this.geohashFieldName,G.geometryProperties=this.geometryProperties,G.geometryType=this.geometryType,G.spatialReference=this.spatialReference,G.hasZ=this.hasZ,G.hasM=this.hasM,G.features=this.features,G.fields=this.fields,G.transform=this.transform,G.exceededTransferLimit=this.exceededTransferLimit,G.uniqueIdField=this.uniqueIdField,G.queryGeometry=this.queryGeometry,G.queryGeometryType=this.queryGeometryType,G}}},88071:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>x});class x{constructor(G=[],Q=[],H=!1){this.lengths=null!=G?G:[],this.coords=null!=Q?Q:[],this.hasIndeterminateRingOrder=H}static fromRect(G){const[Q,H,re,J]=G,W=re-Q,B=J-H;return new x([5],[Q,H,W,0,0,B,-W,0,0,-B])}get isPoint(){return 0===this.lengths.length}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((G,Q)=>G+Q)}forEachVertex(G){let Q=0;this.lengths.length||G(this.coords[0],this.coords[1]);for(let H=0;H<this.lengths.length;H++){const re=this.lengths[H];for(let J=0;J<re;J++)G(this.coords[2*(J+Q)],this.coords[2*(J+Q)+1]);Q+=re}}clone(G){return G?(G.set(this.coords),new x(this.lengths.slice(),G,this.hasIndeterminateRingOrder)):new x(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}}},83308:(dt,Re,T)=>{"use strict";T.d(Re,{y:()=>oe,r:()=>j});var x=T(15861),A=T(62208),G=T(27105),Q=T(15176),H=T(7848),re=T(37053),J=T(50736),W=T(63930);class B{constructor(U,ee,$){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=U.returnDistinctValues,this.fieldsIndex=$,this.featureAdapter=ee;const ne=U.outFields;if(ne&&!ne.includes("*")){this.outFields=ne;let se=0;for(const ae of ne){const de=(0,J.hr)(ae),_e=this.fieldsIndex.get(de),pe=_e?null:(0,J.Jc)(de,$),he=_e?_e.name:(0,J.nu)(ae)||"FIELD_EXP_"+se++;this._fieldDataCache.set(ae,{alias:he,clause:pe})}}}countDistinctValues(U){return this.returnDistinctValues?(U.forEach(ee=>this.getAttributes(ee)),this._returnDistinctMap.size):U.length}getAttributes(U){const ee=this._processAttributesForOutFields(U);return this._processAttributesForDistinctValues(ee)}getFieldValue(U,ee,$){const ne=$?$.name:ee;let se=null;return this._fieldDataCache.has(ne)?se=this._fieldDataCache.get(ne).clause:$||(se=(0,J.Jc)(ee,this.fieldsIndex),this._fieldDataCache.set(ne,{alias:ne,clause:se})),$?this.featureAdapter.getAttribute(U,ne):se.calculateValue(U,this.featureAdapter)}getNormalizedValue(U,ee){const $=ee.normalizationType,ne=ee.normalizationTotal;let se=this.getFieldValue(U,ee.field,ee.fieldInfo);if($&&Number.isFinite(se)){const ae=this.getFieldValue(U,ee.normalizationField,ee.normalizationFieldInfo);se=(0,W.fk)(se,$,ae,ne)}return se}getExpressionValue(U,ee,$,ne){const se={attributes:this.featureAdapter.getAttributes(U),layer:{fields:this.fieldsIndex.fields}},ae=ne.createExecContext(se,$);return ne.executeFunction(ee,ae)}getExpressionValues(U,ee,$,ne){const se={fields:this.fieldsIndex.fields};return U.map(ae=>{const de={attributes:this.featureAdapter.getAttributes(ae),layer:se},_e=ne.createExecContext(de,$);return ne.executeFunction(ee,_e)})}validateItem(U,ee){return this._fieldDataCache.has(ee)||this._fieldDataCache.set(ee,{alias:ee,clause:(0,J.Jc)(ee,this.fieldsIndex)}),this._fieldDataCache.get(ee).clause.testFeature(U,this.featureAdapter)}validateItems(U,ee){return this._fieldDataCache.has(ee)||this._fieldDataCache.set(ee,{alias:ee,clause:(0,J.Jc)(ee,this.fieldsIndex)}),this._fieldDataCache.get(ee).clause.testSet(U,this.featureAdapter)}_processAttributesForOutFields(U){const ee=this.outFields;if(!ee||!ee.length)return this.featureAdapter.getAttributes(U);const $={};for(const ne of ee){const{alias:se,clause:ae}=this._fieldDataCache.get(ne);$[se]=ae?ae.calculateValue(U,this.featureAdapter):this.featureAdapter.getAttribute(U,se)}return $}_processAttributesForDistinctValues(U){if((0,A.Wi)(U)||!this.returnDistinctValues)return U;const ee=this.outFields,$=[];if(ee)for(const ae of ee){const{alias:de}=this._fieldDataCache.get(ae);$.push(U[de])}else for(const ae in U)$.push(U[ae]);const ne=`${(ee||["*"]).join(",")}=${$.join(",")}`;let se=this._returnDistinctMap.get(ne)||0;return this._returnDistinctMap.set(ne,++se),se>1?null:U}}var j,X,Z=T(82959),ie=T(6185),ue=T(36630),ce=T(46679);class oe{constructor(U,ee,$){this.items=U,this.query=ee,this.geometryType=$.geometryType,this.hasM=$.hasM,this.hasZ=$.hasZ,this.fieldsIndex=$.fieldsIndex,this.objectIdField=$.objectIdField,this.spatialReference=$.spatialReference,this.featureAdapter=$.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const U=new B(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return U.countDistinctValues(this.items);const{groupByFieldsForStatistics:ee,having:$,outStatistics:ne}=this.query;if(!(null==ee?void 0:ee.length))return 1;const ae=new Map,de=new Map,_e=new Set;for(const pe of ne){const{statisticType:he}=pe,ge="exceedslimit"!==he?pe.onStatisticField:void 0;if(!de.has(ge)){const Me=[];for(const Ee of ee){const Te=this._getAttributeValues(U,Ee,ae);Me.push(Te)}de.set(ge,this._calculateUniqueValues(Me,U.returnDistinctValues))}const ye=de.get(ge);for(const Me in ye){const{data:Ee,items:Te}=ye[Me],me=Ee.join(",");$&&!U.validateItems(Te,$)||_e.add(me)}}return _e.size}createQueryResponse(){var U=this;return(0,x.Z)(function*(){let ee;return ee=U.query.outStatistics?U.query.outStatistics.some($=>"exceedslimit"===$.statisticType)?U._createExceedsLimitQueryResponse(U.query):yield U._createStatisticsQueryResponse(U.query):U._createFeatureQueryResponse(U.query),U.query.returnQueryGeometry&&(ee.queryGeometry=(0,re.JY)(U.query.outSR)&&!(0,re.fS)(U.query.geometry.spatialReference,U.query.outSR)?(0,ie.S2)(or({spatialReference:U.query.outSR},(0,Z.iV)(U.query.geometry,U.query.geometry.spatialReference,U.query.outSR))):(0,ie.S2)(or({spatialReference:U.query.outSR},U.query.geometry))),ee})()}createSnappingResponse(U,ee){const $=this.featureAdapter,ne=function Y(X,U){return X?U?4:3:U?3:2}(this.hasZ,this.hasM),{x:se,y:ae}=U.point,de="number"==typeof U.distance?U.distance:U.distance.x,_e="number"==typeof U.distance?U.distance:U.distance.y,pe={candidates:[]},he="esriGeometryPolygon"===this.geometryType,ge=this._getPointCreator(U.point,this.spatialReference,ee);for(const ye of this.items){const Me=$.getGeometry(ye);if((0,A.Wi)(Me))continue;const{coords:Ee,lengths:Te}=Me;if(U.types&j.EDGE){let me=0;for(let Ce=0;Ce<Te.length;Ce++){const Ie=Te[Ce];for(let Ge=0;Ge<Ie;Ge++,me+=ne){const Je=Ee[me],xe=Ee[me+1];if(Ge!==Ie-1){const je=Ee[me+ne],We=Ee[me+ne+1],{x:Ne,y:we}=le(se,ae,Je,xe,je,We),Oe=(se-Ne)/de,$e=(ae-we)/_e,Be=Oe*Oe+$e*$e;Be<=1&&pe.candidates.push({type:"edge",objectId:$.getObjectId(ye),distance:Math.sqrt(Be),target:ge(Ne,we),start:ge(Je,xe),end:ge(je,We)})}}}}if(U.types&j.VERTEX){const me=he?Ee.length-ne:Ee.length;for(let Ce=0;Ce<me;Ce+=ne){const Ie=Ee[Ce],Ge=Ee[Ce+1],Je=(se-Ie)/de,xe=(ae-Ge)/_e,je=Je*Je+xe*xe;je<=1&&pe.candidates.push({type:"vertex",objectId:$.getObjectId(ye),distance:Math.sqrt(je),target:ge(Ie,Ge)})}}}return pe.candidates.sort((ye,Me)=>ye.distance-Me.distance),pe}_getPointCreator(U,ee,$){const ne=(0,A.pC)($)&&!(0,re.fS)(ee,$)?se=>(0,Z.iV)(se,ee,$):se=>se;return null!=U.z&&null!=U.m?(se,ae)=>ne({x:se,y:ae,z:U.z,m:U.m}):null!=U.z?(se,ae)=>ne({x:se,y:ae,z:U.z}):null!=U.m?(se,ae)=>ne({x:se,y:ae,m:U.m}):(se,ae)=>ne({x:se,y:ae})}createSummaryStatisticsResponse(U){var ee=this;return(0,x.Z)(function*(){const{field:$,valueExpression:ne,normalizationField:se,normalizationType:ae,normalizationTotal:de,minValue:_e,maxValue:pe,scale:he}=U,ge=ee.fieldsIndex.isDateField($),ye=yield ee._getDataValues({field:$,valueExpression:ne,normalizationField:se,normalizationType:ae,normalizationTotal:de,scale:he}),Me=(0,W.S5)({normalizationType:ae,normalizationField:se,minValue:_e,maxValue:pe}),Ee=ee.fieldsIndex.get($),Te={value:.5,fieldType:null==Ee?void 0:Ee.type},me=(0,ue.qN)(Ee)?(0,W.H0)({values:ye,supportsNullCount:Me,percentileParams:Te}):(0,W.i5)({values:ye,minValue:_e,maxValue:pe,useSampleStdDev:!ae,supportsNullCount:Me,percentileParams:Te});return(0,W.F_)(me,ge)})()}createUniqueValuesResponse(U){var ee=this;return(0,x.Z)(function*(){const{field:$,valueExpression:ne,domain:se,returnAllCodedValues:ae,scale:de}=U,_e=yield ee._getDataValues({field:$,valueExpression:ne,scale:de}),pe=(0,W.eT)(_e);return(0,W.Qm)(pe,se,ae)})()}createClassBreaksResponse(U){var ee=this;return(0,x.Z)(function*(){const{field:$,valueExpression:ne,normalizationField:se,normalizationType:ae,normalizationTotal:de,classificationMethod:_e,standardDeviationInterval:pe,minValue:he,maxValue:ge,numClasses:ye,scale:Me}=U,Ee=yield ee._getDataValues({field:$,valueExpression:ne,normalizationField:se,normalizationType:ae,normalizationTotal:de,scale:Me}),Te=(0,W.G2)(Ee,{field:$,normalizationField:se,normalizationType:ae,normalizationTotal:de,classificationMethod:_e,standardDeviationInterval:pe,minValue:he,maxValue:ge,numClasses:ye});return(0,W.DL)(Te,_e)})()}createHistogramResponse(U){var ee=this;return(0,x.Z)(function*(){const{field:$,valueExpression:ne,normalizationField:se,normalizationType:ae,normalizationTotal:de,classificationMethod:_e,standardDeviationInterval:pe,minValue:he,maxValue:ge,numBins:ye,scale:Me}=U,Ee=yield ee._getDataValues({field:$,valueExpression:ne,normalizationField:se,normalizationType:ae,normalizationTotal:de,scale:Me});return(0,W.oF)(Ee,{field:$,normalizationField:se,normalizationType:ae,normalizationTotal:de,classificationMethod:_e,standardDeviationInterval:pe,minValue:he,maxValue:ge,numBins:ye})})()}_sortFeatures(U,ee,$){if(U.length>1&&ee&&ee.length)for(const ne of ee.reverse()){const se=ne.split(" "),ae=se[0],de=this.fieldsIndex.get(ae),_e=se[1]&&"desc"===se[1].toLowerCase(),pe=(0,W.Lq)(null==de?void 0:de.type,_e);U.sort((he,ge)=>{const ye=$(he,ae,de),Me=$(ge,ae,de);return pe(ye,Me)})}}_createFeatureQueryResponse(U){const ee=this.items,{geometryType:$,hasM:ne,hasZ:se,objectIdField:ae,spatialReference:de}=this,{outFields:_e,outSR:pe,quantizationParameters:he,resultRecordCount:ge,resultOffset:ye,returnZ:Me,returnM:Ee}=U,Te=null!=ge&&ee.length>(ye||0)+ge,me=_e&&(_e.includes("*")?[...this.fieldsIndex.fields]:_e.map(Ce=>this.fieldsIndex.get(Ce)));return{exceededTransferLimit:Te,features:this._createFeatures(U,ee),fields:me,geometryType:$,hasM:ne&&Ee,hasZ:se&&Me,objectIdFieldName:ae,spatialReference:(0,ie.S2)(pe||de),transform:he&&(0,H.vY)(he)||null}}_createFeatures(U,ee){const $=new B(U,this.featureAdapter,this.fieldsIndex),{hasM:ne,hasZ:se}=this,{orderByFields:ae,quantizationParameters:de,returnGeometry:_e,returnCentroid:pe,maxAllowableOffset:he,resultOffset:ge,resultRecordCount:ye,returnZ:Me=!1,returnM:Ee=!1}=U,Te=se&&Me,me=ne&&Ee;let Ce=[],Ie=0;const Ge=[...ee];if(this._sortFeatures(Ge,ae,(xe,je,We)=>$.getFieldValue(xe,je,We)),_e||pe){const xe=(0,H.vY)(de);if(_e&&!pe)for(const je of Ge)Ce[Ie++]={attributes:$.getAttributes(je),geometry:(0,ie.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(je),he,xe,Te,me)};else if(!_e&&pe)for(const je of Ge)Ce[Ie++]={attributes:$.getAttributes(je),centroid:(0,ie.EG)(this,this.featureAdapter.getCentroid(je,this),xe)};else for(const je of Ge)Ce[Ie++]={attributes:$.getAttributes(je),centroid:(0,ie.EG)(this,this.featureAdapter.getCentroid(je,this),xe),geometry:(0,ie.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(je),he,xe,Te,me)}}else for(const xe of Ge){const je=$.getAttributes(xe);je&&(Ce[Ie++]={attributes:je})}const Je=ge||0;return null!=ye&&(Ce=Ce.slice(Je,Math.min(Ce.length,Je+ye))),Ce}_createExceedsLimitQueryResponse(U){let ee=!1,$=Number.POSITIVE_INFINITY,ne=Number.POSITIVE_INFINITY,se=Number.POSITIVE_INFINITY;for(const ae of U.outStatistics)if("exceedslimit"===ae.statisticType){$=null!=ae.maxPointCount?ae.maxPointCount:Number.POSITIVE_INFINITY,ne=null!=ae.maxRecordCount?ae.maxRecordCount:Number.POSITIVE_INFINITY,se=null!=ae.maxVertexCount?ae.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)ee=this.items.length>$;else if(this.items.length>ne)ee=!0;else{const ae=this.hasZ?this.hasM?4:3:this.hasM?3:2,de=this.featureAdapter;ee=this.items.reduce((_e,pe)=>{const he=de.getGeometry(pe);return _e+((0,A.pC)(he)&&he.coords.length||0)},0)/ae>se}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(ee)}}]}}_createStatisticsQueryResponse(U){var ee=this;return(0,x.Z)(function*(){const $={attributes:{}},ne=[],se=new Map,ae=new Map,de=new Map,_e=new Map,pe=new B(U,ee.featureAdapter,ee.fieldsIndex),he=U.outStatistics,{groupByFieldsForStatistics:ge,having:ye,orderByFields:Me}=U,Ee=ge&&ge.length,Te=!!Ee,me=Te&&ge[0],Ce=Te&&!ee.fieldsIndex.get(me);for(const Ge of he){const{outStatisticFieldName:Je,statisticType:xe}=Ge,je=Ge,We="exceedslimit"!==xe?Ge.onStatisticField:void 0,Ne="percentile_disc"===xe||"percentile_cont"===xe,we="EnvelopeAggregate"===xe||"CentroidAggregate"===xe||"ConvexHullAggregate"===xe,Oe=Te&&1===Ee&&(We===me||Ce)&&"count"===xe;if(Te){if(!de.has(We)){const Be=[];for(const Se of ge){const De=ee._getAttributeValues(pe,Se,se);Be.push(De)}de.set(We,ee._calculateUniqueValues(Be,pe.returnDistinctValues))}const $e=de.get(We);for(const Be in $e){const{count:Se,data:De,items:Fe,itemPositions:ve}=$e[Be],Ke=De.join(",");if(!ye||pe.validateItems(Fe,ye)){const qe=_e.get(Ke)||{attributes:{}};if(we){qe.aggregateGeometries||(qe.aggregateGeometries={});const{aggregateGeometries:be,outStatisticFieldName:tt}=yield ee._getAggregateGeometry(je,Fe);qe.aggregateGeometries[tt]=be}else{let be=null;if(Oe)be=Se;else{const tt=ee._getAttributeValues(pe,We,se),Ye=ve.map(ze=>tt[ze]);be=Ne&&"statisticParameters"in je?ee._getPercentileValue(je,Ye):ee._getStatisticValue(je,Ye,null,pe.returnDistinctValues)}qe.attributes[Je]=be}ge.forEach((be,tt)=>qe.attributes[ee.fieldsIndex.get(be)?be:`EXPR_${tt+1}`]=De[tt]),_e.set(Ke,qe)}}}else if(we){$.aggregateGeometries||($.aggregateGeometries={});const{aggregateGeometries:$e,outStatisticFieldName:Be}=yield ee._getAggregateGeometry(je,ee.items);$.aggregateGeometries[Be]=$e}else{const $e=ee._getAttributeValues(pe,We,se);$.attributes[Je]=Ne&&"statisticParameters"in je?ee._getPercentileValue(je,$e):ee._getStatisticValue(je,$e,ae,pe.returnDistinctValues)}ne.push({name:Je,alias:Je,type:"esriFieldTypeDouble"})}const Ie=Te?Array.from(_e.values()):[$];return ee._sortFeatures(Ie,Me,(Ge,Je)=>Ge.attributes[Je]),{fields:ne,features:Ie}})()}_getAggregateGeometry(U,ee){var $=this;return(0,x.Z)(function*(){const ne=yield Promise.all([T.e(4918),T.e(8592),T.e(2825)]).then(T.bind(T,32825)),{statisticType:se,outStatisticFieldName:ae}=U,{featureAdapter:de,spatialReference:_e,geometryType:pe,hasZ:he,hasM:ge}=$,ye=ee.map(Te=>(0,ie.Op)(pe,he,ge,de.getGeometry(Te))),Me=ne.convexHull(_e,ye,!0)[0],Ee={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===se){const Te=Me?(0,Q._w)(Me):(0,Q.aO)(ne.union(_e,ye));Ee.aggregateGeometries=yi(or({},Te),{spatialReference:_e}),Ee.outStatisticFieldName=ae||"extent"}else if("CentroidAggregate"===se){const Te=Me?(0,G.tO)(Me):(0,G.$G)((0,Q.aO)(ne.union(_e,ye)));Ee.aggregateGeometries={x:Te[0],y:Te[1],spatialReference:_e},Ee.outStatisticFieldName=ae||"centroid"}else"ConvexHullAggregate"===se&&(Ee.aggregateGeometries=Me,Ee.outStatisticFieldName=ae||"convexHull");return Ee})()}_getStatisticValue(U,ee,$,ne){const{onStatisticField:se,statisticType:ae}=U;let de=null;return de=(null==$?void 0:$.has(se))?$.get(se):(0,ue.qN)(this.fieldsIndex.get(se))?(0,W.H0)({values:ee,returnDistinct:ne}):(0,W.i5)({values:ee,minValue:null,maxValue:null,useSampleStdDev:!0}),$&&$.set(se,de),de["var"===ae?"variance":ae]}_getPercentileValue(U,ee){const{onStatisticField:$,statisticParameters:ne,statisticType:se}=U,{value:ae,orderBy:de}=ne,_e=this.fieldsIndex.get($);return(0,W.XL)(ee,{value:ae,orderBy:de,fieldType:null==_e?void 0:_e.type,isDiscrete:"percentile_disc"===se})}_getAttributeValues(U,ee,$){if($.has(ee))return $.get(ee);const ne=this.fieldsIndex.get(ee),se=this.items.map(ae=>U.getFieldValue(ae,ee,ne));return $.set(ee,se),se}_getAttributeNormalizedValues(U,ee){return this.items.map($=>U.getNormalizedValue($,{field:ee.field,fieldInfo:this.fieldsIndex.get(ee.field),normalizationField:ee.normalizationField,normalizationFieldInfo:this.fieldsIndex.get(ee.normalizationField),normalizationType:ee.normalizationType,normalizationTotal:ee.normalizationTotal}))}_getAttributeExpressionValues(U,ee,$){var ne=this;return(0,x.Z)(function*(){const{arcadeUtils:se}=yield(0,ce.LC)(),ae=se.createFunction(ee),de=$&&se.getViewInfo($);return U.getExpressionValues(ne.items,ae,de,se)})()}_calculateUniqueValues(U,ee){const $={},ne=this.items,se=ne.length;for(let ae=0;ae<se;ae++){const de=ne[ae],_e=[];for(const he of U)_e.push(he[ae]);const pe=_e.join(",");ee?null==$[pe]&&($[pe]={count:1,data:_e,items:[de],itemPositions:[ae]}):null==$[pe]?$[pe]={count:1,data:_e,items:[de],itemPositions:[ae]}:($[pe].count++,$[pe].items.push(de),$[pe].itemPositions.push(ae))}return $}_getDataValues(U){var ee=this;return(0,x.Z)(function*(){const $=new B(ee.query,ee.featureAdapter,ee.fieldsIndex),{valueExpression:ne,field:se,normalizationField:ae,normalizationType:de,normalizationTotal:_e,scale:pe}=U;return ne?ee._getAttributeExpressionValues($,ne,ne?{viewingMode:"map",scale:pe,spatialReference:ee.query.outSR||ee.spatialReference}:null):ee._getAttributeNormalizedValues($,{field:se,normalizationField:ae,normalizationType:de,normalizationTotal:_e})})()}}function le(X,U,ee,$,ne,se){const ae=ne-ee,de=se-$,he=Math.min(1,Math.max(0,((X-ee)*ae+(U-$)*de)/(ae*ae+de*de)));return{x:ee+ae*he,y:$+de*he}}(X=j||(j={}))[X.NONE=0]="NONE",X[X.EDGE=1]="EDGE",X[X.VERTEX=2]="VERTEX"},50736:(dt,Re,T)=>{"use strict";T.d(Re,{nu:()=>oe,hr:()=>ce,Jc:()=>ie,G3:()=>le,Of:()=>ue,z4:()=>Z,hO:()=>B});var x=T(26584),A=T(78498),G=T(10410);const H=new class Q{constructor(j,X){this._cache=new A.Z(j),this._invalidCache=new A.Z(X)}get(j,X){const U=`${X.uid}:${j}`,ee=this._cache.get(U);if(ee)return ee;if(void 0!==this._invalidCache.get(U))return null;try{const $=G.WhereClause.create(j,X);return this._cache.put(U,$),$}catch($){return this._invalidCache.put(U,null),null}}}(50,500),re="feature-store:unsupported-query",J=" as ",W=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeDate"]);function B(Y,j){if(!j)return!0;const X=H.get(j,Y);if(!X)throw new x.Z(re,"invalid SQL expression",{where:j});if(!X.isStandardized)throw new x.Z(re,"where clause is not standard",{where:j});return ue(Y,X.fieldNames,"where clause contains missing fields"),!0}function Z(Y,j,X){if(!j)return!0;const U=H.get(j,Y);if(!U)throw new x.Z(re,"invalid SQL expression",{having:j});if(!U.isAggregate)throw new x.Z(re,"having does not contain a valid aggregate function",{having:j});if(ue(Y,U.fieldNames,"having contains missing fields"),!U.getExpressions().every($=>{const{aggregateType:ne,field:se}=$,ae=Y.has(se)&&Y.get(se).name;return X.some(de=>{const{onStatisticField:_e,statisticType:pe}=de;return(Y.has(_e)&&Y.get(_e).name)===ae&&pe.toLowerCase().trim()===ne})}))throw new x.Z(re,"expressions in having should also exist in outStatistics",{having:j});return!0}function ie(Y,j){return Y?H.get(Y,j):null}function ue(Y,j,X,U=!0){const ee=[];for(const $ of j)if("*"!==$&&!Y.has($))if(U){const ne=ce($);try{const se=ie(ne,Y);if(!se)throw new x.Z(re,"invalid SQL expression",{where:ne});if(!se.isStandardized)throw new x.Z(re,"expression is not standard",{clause:se});ue(Y,se.fieldNames,"expression contains missing fields")}catch(se){const ae=se&&se.details;if(ae&&(ae.clause||ae.where))throw se;ae&&ae.missingFields?ee.push(...ae.missingFields):ee.push($)}}else ee.push($);if(ee.length)throw new x.Z(re,X,{missingFields:ee})}function ce(Y){return Y.split(J)[0]}function oe(Y){return Y.split(J)[1]}function le(Y,j){const X=j.get(Y);return!!X&&!W.has(X.type)}},82959:(dt,Re,T)=>{"use strict";T.d(Re,{_W:()=>ie,iV:()=>le,oj:()=>X});var x=T(15861),A=T(62208),G=T(55915),Q=T(15994),H=T(37053),re=T(46367);const J=[0,0];function W(U,ee){if(!ee)return null;if("x"in ee){const $={x:0,y:0};return[$.x,$.y]=U(ee.x,ee.y,J),null!=ee.z&&($.z=ee.z),null!=ee.m&&($.m=ee.m),$}if("xmin"in ee){const $={xmin:0,ymin:0,xmax:0,ymax:0};return[$.xmin,$.ymin]=U(ee.xmin,ee.ymin,J),[$.xmax,$.ymax]=U(ee.xmax,ee.ymax,J),ee.hasZ&&($.zmin=ee.zmin,$.zmax=ee.zmax,$.hasZ=!0),ee.hasM&&($.mmin=ee.mmin,$.mmax=ee.mmax,$.hasM=!0),$}return"rings"in ee?{rings:B(ee.rings,U),hasM:ee.hasM,hasZ:ee.hasZ}:"paths"in ee?{paths:B(ee.paths,U),hasM:ee.hasM,hasZ:ee.hasZ}:"points"in ee?{points:Z(ee.points,U),hasM:ee.hasM,hasZ:ee.hasZ}:void 0}function B(U,ee){const $=[];for(const ne of U)$.push(Z(ne,ee));return $}function Z(U,ee){const $=[];for(const ne of U){const se=ee(ne[0],ne[1],[0,0]);$.push(se),ne.length>2&&se.push(ne[2]),ne.length>3&&se.push(ne[3])}return $}function ie(U,ee){return ue.apply(this,arguments)}function ue(){return(ue=(0,x.Z)(function*(U,ee){if(!ee)return;const $=Array.isArray(U)?U.map(ne=>(0,A.pC)(ne.geometry)&&ne.geometry.spatialReference):[U];yield(0,G.iQ)($.map(ne=>({source:ne,dest:ee})))})).apply(this,arguments)}const ce=W.bind(null,re.hG),oe=W.bind(null,re.R6);function le(U,ee,$,ne){if(!U||($||($=ee,ee=U.spatialReference),!(0,H.JY)(ee)||!(0,H.JY)($)||(0,H.fS)(ee,$)))return U;if((0,re.Q8)(ee,$)){const se=(0,H.sS)($)?ce(U):oe(U);return se.spatialReference=$,se}return(0,G.oj)(Q.N,[U],ee,$,null,ne)[0]}const j=new class Y{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(ee,$,ne){var se=this;return(0,x.Z)(function*(){if(!ee||!ee.length||!$||!ne||(0,H.fS)($,ne))return ee;const ae={geometries:ee,inSpatialReference:$,outSpatialReference:ne,resolve:null};return se._jobs.push(ae),new Promise(de=>{ae.resolve=de,null===se._timer&&(se._timer=setTimeout(se._process,10))})})()}_process(){this._timer=null;const ee=this._jobs.shift();if(!ee)return;const{geometries:$,inSpatialReference:ne,outSpatialReference:se,resolve:ae}=ee;(0,re.Q8)(ne,se)?(0,H.sS)(se)?ae($.map(ce)):ae($.map(oe)):ae((0,G.oj)(Q.N,$,ne,se,null,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function X(U,ee,$){return j.push(U,ee,$)}},6185:(dt,Re,T)=>{"use strict";T.d(Re,{EG:()=>X,Op:()=>ee,S2:()=>ge,Up:()=>$,j6:()=>se,vF:()=>ce});var x=T(15861),A=T(2076),G=T(62208),Q=T(16730),H=T(15176),re=T(91179),J=T(13924),W=T(37053),B=T(82054),Z=T(88071),ie=T(82959);const ue=new A.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),ce=Object.freeze({}),oe=new Z.Z,le=new Z.Z,Y=new Z.Z,j={esriGeometryPoint:B.fQ,esriGeometryPolyline:B.J6,esriGeometryPolygon:B.eG,esriGeometryMultipoint:B.Iv};function X(Ee,Te,me,Ce=Ee.hasZ,Ie=Ee.hasM){if((0,G.Wi)(Te))return null;const Ge=Ee.hasZ&&Ce,Je=Ee.hasM&&Ie;if(me){const xe=(0,B.Nh)(Y,Te,Ee.hasZ,Ee.hasM,"esriGeometryPoint",me,Ce,Ie);return(0,B.fQ)(xe,Ge,Je)}return(0,B.fQ)(Te,Ge,Je)}function ee(Ee,Te,me,Ce,Ie,Ge,Je=Te,xe=me){const je=Te&&Je,We=me&&xe,Ne=(0,G.pC)(Ce)?"coords"in Ce?Ce:Ce.geometry:null;if((0,G.Wi)(Ne))return null;if(Ie){let we=(0,B.zj)(le,Ne,Te,me,Ee,Ie,Je,xe);return Ge&&(we=(0,B.Nh)(Y,we,je,We,Ee,Ge)),j[Ee](we,je,We)}if(Ge){const we=(0,B.Nh)(Y,Ne,Te,me,Ee,Ge,Je,xe);return j[Ee](we,je,We)}return(0,B.hY)(oe,Ne,Te,me,Je,xe),j[Ee](oe,je,We)}function $(Ee,Te,me){return ne.apply(this,arguments)}function ne(){return(ne=(0,x.Z)(function*(Ee,Te,me){const{outFields:Ce,orderByFields:Ie,groupByFieldsForStatistics:Ge,outStatistics:Je}=Ee;if(Ce)for(let xe=0;xe<Ce.length;xe++)Ce[xe]=Ce[xe].trim();if(Ie)for(let xe=0;xe<Ie.length;xe++)Ie[xe]=Ie[xe].trim();if(Ge)for(let xe=0;xe<Ge.length;xe++)Ge[xe]=Ge[xe].trim();if(Je)for(let xe=0;xe<Je.length;xe++)Je[xe].onStatisticField&&(Je[xe].onStatisticField=Je[xe].onStatisticField.trim());return Ee.geometry&&!Ee.outSR&&(Ee.outSR=Ee.geometry.spatialReference),se(Ee,Te,me)})).apply(this,arguments)}function se(Ee,Te,me){return ae.apply(this,arguments)}function ae(){return(ae=(0,x.Z)(function*(Ee,Te,me){if(!Ee)return null;let{where:Ce}=Ee;if(Ee.where=Ce=Ce&&Ce.trim(),(!Ce||/^1 *= *1$/.test(Ce)||Te&&Te===Ce)&&(Ee.where=null),!Ee.geometry)return Ee;let Ie=yield de(Ee);if(Ee.distance=0,Ee.units=null,"esriSpatialRelEnvelopeIntersects"===Ee.spatialRel){const{spatialReference:je}=Ee.geometry;Ie=(0,H.aO)(Ie),Ie.spatialReference=je}Ee.geometry=Ie,yield(0,ie._W)(Ie.spatialReference,me);const Ge=(yield(0,J.aX)((0,re.im)(Ie)))[0];if((0,G.Wi)(Ge))throw ce;const Je=Ge.toJSON(),xe=yield(0,ie.iV)(Je,Je.spatialReference,me);if(!xe)throw ce;return xe.spatialReference=me,Ee.geometry=xe,Ee})).apply(this,arguments)}function de(Ee){return _e.apply(this,arguments)}function _e(){return(_e=(0,x.Z)(function*(Ee){const{geometry:Te,distance:me,units:Ce}=Ee;if(null==me||"vertexAttributes"in Te)return Te;const Ie=Te.spatialReference,Ge=Ce?ue.fromJSON(Ce):(0,Q.qE)(Ie),Je=Ie&&((0,W.sT)(Ie)||(0,W.sS)(Ie))?Te:yield(0,ie._W)(Ie,W.Zn).then(()=>(0,ie.iV)(Te,W.Zn));return(yield pe())(Je.spatialReference,Je,me,Ge)})).apply(this,arguments)}function pe(){return he.apply(this,arguments)}function he(){return(he=(0,x.Z)(function*(){return(yield Promise.all([T.e(4918),T.e(8592),T.e(2825)]).then(T.bind(T,32825))).geodesicBuffer})).apply(this,arguments)}function ge(Ee){return Ee&&ye in Ee?JSON.parse(JSON.stringify(Ee,Me)):Ee}const ye="_geVersion",Me=(Ee,Te)=>Ee!==ye?Te:void 0},53639:(dt,Re,T)=>{"use strict";T.d(Re,{f:()=>ce,k:()=>H}),T(8314);var A=T(62208);function G(oe,le){if(oe===le)return!0;if(null==oe||null==le||oe.length!==le.length)return!1;for(let Y=0;Y<oe.length;Y++){const j=oe[Y],X=le[Y];if(j.length!==X.length)return!1;for(let U=0;U<j.length;U++)if(j[U]!==X[U])return!1}return!0}function Q(oe,le){if(oe===le)return!0;if(null==oe||null==le||oe.length!==le.length)return!1;for(let Y=0;Y<oe.length;Y++)if(!G(oe[Y],le[Y]))return!1;return!0}function H(oe,le){return!!Z(oe.spatialReference,le.spatialReference)&&oe.x===le.x&&oe.y===le.y&&oe.z===le.z&&oe.m===le.m}function Z(oe,le){return oe===le||oe&&le&&oe.equals(le)}function ce(oe,le){return oe===le||null!=oe&&null!=le&&oe.objectId===le.objectId&&!!function ie(oe,le){if(oe===le)return!0;if((0,A.Wi)(oe)||(0,A.Wi)(le)||oe.type!==le.type)return!1;switch(oe.type){case"point":return H(oe,le);case"extent":return function B(oe,le){return oe.hasZ===le.hasZ&&oe.hasM===le.hasM&&!!Z(oe.spatialReference,le.spatialReference)&&oe.xmin===le.xmin&&oe.ymin===le.ymin&&oe.zmin===le.zmin&&oe.xmax===le.xmax&&oe.ymax===le.ymax&&oe.zmax===le.zmax}(oe,le);case"polyline":return function re(oe,le){return oe.hasZ===le.hasZ&&oe.hasM===le.hasM&&!!Z(oe.spatialReference,le.spatialReference)&&Q(oe.paths,le.paths)}(oe,le);case"polygon":return function J(oe,le){return oe.hasZ===le.hasZ&&oe.hasM===le.hasM&&!!Z(oe.spatialReference,le.spatialReference)&&Q(oe.rings,le.rings)}(oe,le);case"multipoint":return function W(oe,le){return oe.hasZ===le.hasZ&&oe.hasM===le.hasM&&!!Z(oe.spatialReference,le.spatialReference)&&G(oe.points,le.points)}(oe,le);case"mesh":return!1;default:return}}(oe.geometry,le.geometry)&&!!function ue(oe,le){if(oe===le)return!0;if(!oe||!le)return!1;const Y=Object.keys(oe),j=Object.keys(le);if(Y.length!==j.length)return!1;for(const X of Y)if(oe[X]!==le[X])return!1;return!0}(oe.attributes,le.attributes)}},88530:(dt,Re,T)=>{"use strict";function x(A){return"point"===A.type}T.d(Re,{f:()=>x})},38114:(dt,Re,T)=>{"use strict";T.d(Re,{FS:()=>de,MS:()=>ge,PA:()=>j,Pj:()=>Y,R3:()=>se,S6:()=>oe,TF:()=>pe,Tx:()=>ee,Wh:()=>ce,Xw:()=>ne,dF:()=>ae});var x=T(27306),G=(T(8314),T(62208)),Q=T(55713),H=T(86236),re=T(65234),J=T(5548),W=T(65401),B=T(7848),Z=T(71774),ie=T(36255);T(53639);class ce{constructor(Te,me,Ce){this.uid=Te,this.geometry=me,this.attributes=Ce,this.visible=!0,this.objectId=null,this.centroid=null}}function oe(Ee){return(0,G.pC)(Ee.geometry)}class Y{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function j(Ee){const Te=Z.Mk.fromJSON(Ee.geometryType),me=re.Z.fromJSON(Ee.spatialReference),Ce=Ee.transform,Ie=Ee.features.map(Ge=>{const Je=function X(Ee,Te,me,Ce){return{uid:(0,H.D)(),objectId:Ce&&Ee.attributes?Ee.attributes[Ce]:null,attributes:Ee.attributes,geometry:U(Ee.geometry,Te,me),visible:!0}}(Ge,Te,me,Ee.objectIdFieldName),xe=Je.geometry;if((0,G.pC)(xe)&&Ce)switch(xe.type){case"point":Je.geometry=(0,B.U1)(Ce,xe,xe,xe.hasZ,xe.hasM);break;case"multipoint":Je.geometry=(0,B.J9)(Ce,xe,xe,xe.hasZ,xe.hasM);break;case"polygon":Je.geometry=(0,B.Ie)(Ce,xe,xe,xe.hasZ,xe.hasM);break;case"polyline":Je.geometry=(0,B.G6)(Ce,xe,xe,xe.hasZ,xe.hasM);break;case"extent":case"mesh":Je.geometry=xe}return Je});return{geometryType:Te,features:Ie,spatialReference:me,fields:Ee.fields?Ee.fields.map(Ge=>ie.Z.fromJSON(Ge)):null,objectIdFieldName:Ee.objectIdFieldName,globalIdFieldName:Ee.globalIdFieldName,geohashFieldName:Ee.geohashFieldName,geometryProperties:Ee.geometryProperties,hasZ:Ee.hasZ,hasM:Ee.hasM,exceededTransferLimit:Ee.exceededTransferLimit,transform:null}}function U(Ee,Te,me){if((0,G.Wi)(Ee))return null;switch(Te){case"point":return{x:Ee.x,y:Ee.y,z:Ee.z,m:Ee.m,hasZ:null!=Ee.z,hasM:null!=Ee.m,type:"point",spatialReference:me};case"polyline":return{paths:Ee.paths,hasZ:!!Ee.hasZ,hasM:!!Ee.hasM,type:"polyline",spatialReference:me};case"polygon":return{rings:Ee.rings,hasZ:!!Ee.hasZ,hasM:!!Ee.hasM,type:"polygon",spatialReference:me};case"multipoint":return{points:Ee.points,hasZ:!!Ee.hasZ,hasM:!!Ee.hasM,type:"multipoint",spatialReference:me}}}function ee(Ee,Te,me,Ce){return{x:Ee,y:Te,z:me,hasZ:null!=me,hasM:!1,spatialReference:Ce,type:"point"}}function ne(Ee){let Te=32;return Te+=(0,x.f2)(Ee.attributes),Te+=3,Te+=8+function $(Ee){if((0,G.Wi)(Ee))return 0;let Te=32;switch(Ee.type){case"point":Te+=42;break;case"polyline":case"polygon":{let me=0;const Ce=2+(Ee.hasZ?1:0)+(Ee.hasM?1:0),Ie="polyline"===Ee.type?Ee.paths:Ee.rings;for(const Ge of Ie)me+=Ge.length;Te+=8*me*Ce+64,Te+=128*me,Te+=34,Te+=32*(Ie.length+1);break}case"multipoint":{const Ce=Ee.points.length;Te+=8*Ce*(2+(Ee.hasZ?1:0)+(Ee.hasM?1:0))+64,Te+=128*Ce,Te+=34,Te+=32;break}case"extent":Te+=98,Ee.hasM&&(Te+=32),Ee.hasZ&&(Te+=32);break;case"mesh":Te+=(0,Q.Xw)(Ee.vertexAttributes.position),Te+=(0,Q.Xw)(Ee.vertexAttributes.normal),Te+=(0,Q.Xw)(Ee.vertexAttributes.uv),Te+=(0,Q.Xw)(Ee.vertexAttributes.tangent)}return Te}(Ee.geometry),Te}function se(Ee){if((0,G.Wi)(Ee))return 0;switch(Ee.type){case"point":return 1;case"polyline":{let Te=0;for(const me of Ee.paths)Te+=me.length;return Te}case"polygon":{let Te=0;for(const me of Ee.rings)Te+=me.length;return Te}case"multipoint":return Ee.points.length;case"extent":return 2;case"mesh":{const Te=Ee.vertexAttributes&&Ee.vertexAttributes.position;return Te?Te.length/3:0}default:return}}function ae(Ee){if((0,G.Wi)(Ee))return!1;switch(Ee.type){case"extent":case"point":return!0;case"polyline":for(const Te of Ee.paths)if(Te.length>0)return!0;return!1;case"polygon":for(const Te of Ee.rings)if(Te.length>0)return!0;return!1;case"multipoint":return Ee.points.length>0;case"mesh":return!Ee.loaded||Ee.vertexAttributes.position.length>0}}function de(Ee,Te){switch((0,J.cS)(Te),"mesh"===Ee.type&&(Ee=Ee.extent),Ee.type){case"point":Te[0]=Te[3]=Ee.x,Te[1]=Te[4]=Ee.y,Ee.hasZ&&(Te[2]=Te[5]=Ee.z);break;case"polyline":for(let me=0;me<Ee.paths.length;me++)(0,J.Wi)(Te,Ee.paths[me],Ee.hasZ);break;case"polygon":for(let me=0;me<Ee.rings.length;me++)(0,J.Wi)(Te,Ee.rings[me],Ee.hasZ);break;case"multipoint":(0,J.Wi)(Te,Ee.points,Ee.hasZ);break;case"extent":Te[0]=Ee.xmin,Te[1]=Ee.ymin,Te[3]=Ee.xmax,Te[4]=Ee.ymax,null!=Ee.zmin&&(Te[2]=Ee.zmin),null!=Ee.zmax&&(Te[5]=Ee.zmax)}}function pe(Ee,Te){switch((0,W.cS)(Te),"mesh"===Ee.type&&(Ee=Ee.extent),Ee.type){case"point":Te[0]=Te[2]=Ee.x,Te[1]=Te[3]=Ee.y;break;case"polyline":for(let me=0;me<Ee.paths.length;me++)(0,W.Wi)(Te,Ee.paths[me]);break;case"polygon":for(let me=0;me<Ee.rings.length;me++)(0,W.Wi)(Te,Ee.rings[me]);break;case"multipoint":(0,W.Wi)(Te,Ee.points);break;case"extent":Te[0]=Ee.xmin,Te[1]=Ee.ymin,Te[2]=Ee.xmax,Te[3]=Ee.ymax}}function ge(Ee,Te){return null!=Ee.objectId?Ee.objectId:Ee.attributes&&Te?Ee.attributes[Te]:null}(0,J.Ue)(),(0,W.Ue)()},82054:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>Rt,$g:()=>bt,EI:()=>Ke,GH:()=>qe,IN:()=>j,Iv:()=>me,J6:()=>Je,Jd:()=>Y,Nh:()=>at,RZ:()=>ot,Uy:()=>Oe,XA:()=>De,Yn:()=>Fe,cn:()=>ze,dd:()=>Ee,di:()=>be,eG:()=>Ne,fQ:()=>ee,hY:()=>St,h_:()=>et,lM:()=>ke,lz:()=>Cr,oB:()=>Lr,zj:()=>yt});var x=T(26584),A=T(63290),G=T(62208),Q=T(91179),H=T(66385),re=T(95786),J=T(88071);function W(ct,jt){return ct?jt?4:3:jt?3:2}const B=A.Z.getLogger("esri.layers.graphics.featureConversionUtils"),Z={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0},ie=(ct,jt,qt,er,Zt,tr)=>{ct[qt]=Zt,ct[qt+1]=tr},ue=(ct,jt,qt,er,Zt,tr)=>{ct[qt]=Zt,ct[qt+1]=tr,ct[qt+2]=jt[er+2]},ce=(ct,jt,qt,er,Zt,tr)=>{ct[qt]=Zt,ct[qt+1]=tr,ct[qt+2]=jt[er+3]},oe=(ct,jt,qt,er,Zt,tr)=>{ct[qt]=Zt,ct[qt+1]=tr,ct[qt+2]=jt[er+2],ct[qt+3]=jt[er+3]};function le(ct,jt,qt,er){if(ct){if(qt)return jt&&er?oe:ue;if(jt&&er)return ce}else if(jt&&er)return ue;return ie}function Y({scale:ct,translate:jt},qt){return Math.round((qt-jt[0])/ct[0])}function j({scale:ct,translate:jt},qt){return Math.round((jt[1]-qt)/ct[1])}function X({scale:ct,translate:jt},qt){return qt*ct[0]+jt[0]}function U({scale:ct,translate:jt},qt){return jt[1]-qt*ct[1]}function ee(ct,jt,qt){return ct?jt?qt?pe(ct):se(ct):qt?de(ct):$(ct):null}function $(ct){const jt=ct.coords;return{x:jt[0],y:jt[1]}}function ne(ct,jt){return ct.coords[0]=jt.x,ct.coords[1]=jt.y,ct}function se(ct){const jt=ct.coords;return{x:jt[0],y:jt[1],z:jt[2]}}function ae(ct,jt){return ct.coords[0]=jt.x,ct.coords[1]=jt.y,ct.coords[2]=jt.z,ct}function de(ct){const jt=ct.coords;return{x:jt[0],y:jt[1],m:jt[2]}}function _e(ct,jt){return ct.coords[0]=jt.x,ct.coords[1]=jt.y,ct.coords[2]=jt.m,ct}function pe(ct){const jt=ct.coords;return{x:jt[0],y:jt[1],z:jt[2],m:jt[3]}}function he(ct,jt){return ct.coords[0]=jt.x,ct.coords[1]=jt.y,ct.coords[2]=jt.z,ct.coords[3]=jt.m,ct}function ye(ct,jt){return ct&&jt?he:ct?ae:jt?_e:ne}function Ee(ct,jt,qt=ye(null!=jt.z,null!=jt.m)){return qt(ct,jt)}function me(ct,jt,qt){if((0,G.Wi)(ct))return null;const er=W(jt,qt),Zt=[];for(let tr=0;tr<ct.coords.length;tr+=er){const ir=[];for(let fr=0;fr<er;fr++)ir.push(ct.coords[tr+fr]);Zt.push(ir)}return jt?qt?{points:Zt,hasZ:jt,hasM:qt}:{points:Zt,hasZ:jt}:qt?{points:Zt,hasM:qt}:{points:Zt}}function Ie(ct,jt,qt=W(jt.hasZ,jt.hasM)){ct.lengths[0]=jt.points.length;const er=ct.coords;let Zt=0;for(const tr of jt.points)for(let ir=0;ir<qt;ir++)er[Zt++]=tr[ir];return ct}function Je(ct,jt,qt){if(!ct)return null;const er=W(jt,qt),{coords:Zt,lengths:tr}=ct,ir=[];let fr=0;for(const Ur of tr){const Br=[];for(let Zr=0;Zr<Ur;Zr++){const ri=[];for(let hr=0;hr<er;hr++)ri.push(Zt[fr++]);Br.push(ri)}ir.push(Br)}return jt?qt?{paths:ir,hasZ:jt,hasM:qt}:{paths:ir,hasZ:jt}:qt?{paths:ir,hasM:qt}:{paths:ir}}function je(ct,jt,qt=W(jt.hasZ,jt.hasM)){const{lengths:er,coords:Zt}=ct;let tr=0;for(const ir of jt.paths){for(const fr of ir)for(let Ur=0;Ur<qt;Ur++)Zt[tr++]=fr[Ur];er.push(ir.length)}return ct}function Ne(ct,jt,qt){if(!ct)return null;const er=W(jt,qt),{coords:Zt,lengths:tr}=ct,ir=[];let fr=0;for(const Ur of tr){const Br=[];for(let Zr=0;Zr<Ur;Zr++){const ri=[];for(let hr=0;hr<er;hr++)ri.push(Zt[fr++]);Br.push(ri)}ir.push(Br)}return jt?qt?{rings:ir,hasZ:jt,hasM:qt}:{rings:ir,hasZ:jt}:qt?{rings:ir,hasM:qt}:{rings:ir}}function Oe(ct,jt,qt=jt.hasZ,er=jt.hasM){return function $e(ct,jt,qt,er){const Zt=W(qt,er),{lengths:tr,coords:ir}=ct;let fr=0;tr.length=ir.length=0;for(const Ur of jt){for(const Br of Ur)for(let Zr=0;Zr<Zt;Zr++)ir[fr++]=Br[Zr];tr.push(Ur.length)}}(ct,jt.rings,qt,er),ct}const Be=[],Se=[];function De(ct,jt,qt,er,Zt){Be[0]=ct;const[tr]=Fe(Se,Be,jt,qt,er,Zt);return Be.length=Se.length=0,tr}function Fe(ct,jt,qt,er,Zt,tr){if(ct.length=0,!qt){for(const ir of jt)ct.push(new H.u_(null,ir.attributes,null,ir.attributes[tr]));return ct}switch(qt){case"esriGeometryPoint":return function Me(ct,jt,qt,er,Zt){const tr=ye(qt,er);for(const ir of jt){const{geometry:fr,attributes:Ur}=ir;let Br;fr&&(Br=tr(new J.Z,fr)),ct.push(new H.u_(Br,Ur,null,Ur[Zt]))}return ct}(ct,jt,er,Zt,tr);case"esriGeometryMultipoint":return function Ce(ct,jt,qt,er,Zt){const tr=W(qt,er);for(const ir of jt){const fr=ir.geometry,Ur=ir.attributes;let Br;fr&&(Br=Ie(new J.Z,fr,tr)),ct.push(new H.u_(Br,Ur,null,Ur[Zt]))}return ct}(ct,jt,er,Zt,tr);case"esriGeometryPolyline":return function xe(ct,jt,qt,er,Zt){const tr=W(qt,er);for(const ir of jt){const fr=ir.geometry,Ur=ir.attributes;let Br;fr&&(Br=je(new J.Z,fr,tr)),ct.push(new H.u_(Br,Ur,null,Ur[Zt]))}return ct}(ct,jt,er,Zt,tr);case"esriGeometryPolygon":return function we(ct,jt,qt,er,Zt){for(const tr of jt){const ir=tr.geometry,fr=tr.centroid,Ur=tr.attributes;let Br;ir&&(Br=Oe(new J.Z,ir,qt,er)),(0,G.pC)(fr)?ct.push(new H.u_(Br,Ur,ne(new J.Z,fr),Ur[Zt])):ct.push(new H.u_(Br,Ur,null,Ur[Zt]))}return ct}(ct,jt,er,Zt,tr);default:B.error("convertToFeatureSet:unknown-geometry",new x.Z(`Unable to parse unknown geometry type '${qt}'`)),ct.length=0}return ct}function Ke(ct,jt,qt,er){Se[0]=ct,Ye(Be,Se,jt,qt,er);const Zt=Be[0];return Be.length=Se.length=0,Zt}function qe(ct,jt,qt){if((0,G.Wi)(ct))return null;const er=new J.Z;return"hasZ"in ct&&null==jt&&(jt=ct.hasZ),"hasM"in ct&&null==qt&&(qt=ct.hasM),(0,Q.wp)(ct)?ye(null!=jt?jt:null!=ct.z,null!=qt?qt:null!=ct.m)(er,ct):(0,Q.oU)(ct)?Oe(er,ct,jt,qt):(0,Q.l9)(ct)?je(er,ct,W(jt,qt)):(0,Q.aW)(ct)?Ie(er,ct,W(jt,qt)):void B.error("convertFromGeometry:unknown-geometry",new x.Z(`Unable to parse unknown geometry type '${ct}'`))}function be(ct,jt,qt,er){const Zt=ct&&("coords"in ct?ct:ct.geometry);if((0,G.Wi)(Zt))return null;switch(jt){case"esriGeometryPoint":{let tr=$;return qt&&er?tr=pe:qt?tr=se:er&&(tr=de),tr(Zt)}case"esriGeometryMultipoint":return me(Zt,qt,er);case"esriGeometryPolyline":return Je(Zt,qt,er);case"esriGeometryPolygon":return Ne(Zt,qt,er);default:return void B.error("convertToGeometry:unknown-geometry",new x.Z(`Unable to parse unknown geometry type '${jt}'`))}}function Ye(ct,jt,qt,er,Zt){if(ct.length=0,(0,G.Wi)(qt))return function tt(ct,jt){for(const qt of jt)ct.push({attributes:qt.attributes});return ct}(ct,jt);switch(qt){case"esriGeometryPoint":return function ge(ct,jt,qt,er){let Zt=$;qt&&er?Zt=pe:qt?Zt=se:er&&(Zt=de);for(const tr of jt){const{geometry:ir,attributes:fr}=tr,Ur=(0,G.pC)(ir)?Zt(ir):null;ct.push({attributes:fr,geometry:Ur})}return ct}(ct,jt,er,Zt);case"esriGeometryMultipoint":return function Te(ct,jt,qt,er){for(const Zt of jt){const{geometry:tr,attributes:ir}=Zt;let fr;tr&&(fr=me(tr,qt,er)),ct.push({attributes:ir,geometry:fr})}return ct}(ct,jt,er,Zt);case"esriGeometryPolyline":return function Ge(ct,jt,qt,er){for(const Zt of jt){const{geometry:tr,attributes:ir}=Zt;let fr;(0,G.pC)(tr)&&(fr=Je(tr,qt,er)),ct.push({attributes:ir,geometry:fr})}return ct}(ct,jt,er,Zt);case"esriGeometryPolygon":return function We(ct,jt,qt,er){for(const Zt of jt){const{geometry:tr,attributes:ir,centroid:fr}=Zt;let Ur;if((0,G.pC)(tr)&&(Ur=Ne(tr,qt,er)),(0,G.pC)(fr)){const Br=$(fr);ct.push({attributes:ir,centroid:Br,geometry:Ur})}else ct.push({attributes:ir,geometry:Ur})}return ct}(ct,jt,er,Zt);default:B.error("convertToFeatureSet:unknown-geometry",new x.Z(`Unable to parse unknown geometry type '${qt}'`))}return ct}function ze(ct){const{objectIdFieldName:jt,spatialReference:qt,transform:er,fields:Zt,hasM:tr,hasZ:ir,features:fr,geometryType:Ur,exceededTransferLimit:Br,uniqueIdField:Zr,queryGeometry:ri,queryGeometryType:hr}=ct,Dr={features:Ye([],fr,Ur,ir,tr),fields:Zt,geometryType:Ur,objectIdFieldName:jt,spatialReference:qt,uniqueIdField:Zr,queryGeometry:be(ri,hr,!1,!1)};return er&&(Dr.transform=er),Br&&(Dr.exceededTransferLimit=Br),tr&&(Dr.hasM=tr),ir&&(Dr.hasZ=ir),Dr}function et(ct,jt){const qt=new re.Z,{hasM:er,hasZ:Zt,features:tr,objectIdFieldName:ir,spatialReference:fr,geometryType:Ur,exceededTransferLimit:Br,transform:Zr,fields:ri}=ct;return ri&&(qt.fields=ri),qt.geometryType=Ur,qt.objectIdFieldName=ir||jt,qt.spatialReference=fr,qt.objectIdFieldName?(tr&&Fe(qt.features,tr,Ur,Zt,er,qt.objectIdFieldName),Br&&(qt.exceededTransferLimit=Br),er&&(qt.hasM=er),Zt&&(qt.hasZ=Zt),Zr&&(qt.transform=Zr),qt):(B.error(new x.Z("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),qt)}function ke(ct){const{transform:jt,features:qt,hasM:er,hasZ:Zt}=ct;if(!jt)return ct;for(const tr of qt)(0,G.pC)(tr.geometry)&&bt(tr.geometry,tr.geometry,er,Zt,jt),(0,G.pC)(tr.centroid)&&bt(tr.centroid,tr.centroid,er,Zt,jt);return ct.transform=null,ct}function ot(ct,jt){const{geometryType:qt,features:er,hasM:Zt,hasZ:tr}=jt;if(!ct)return jt;for(let ir=0;ir<er.length;ir++){const fr=er[ir],Ur=fr.weakClone();Ur.geometry=new J.Z,at(Ur.geometry,fr.geometry,Zt,tr,qt,ct),fr.centroid&&(Ur.centroid=new J.Z,at(Ur.centroid,fr.centroid,Zt,tr,"esriGeometryPoint",ct)),er[ir]=Ur}return jt.transform=ct,jt}function at(ct,jt,qt,er,Zt,tr,ir=qt,fr=er){if(ct.lengths.length&&(ct.lengths.length=0),ct.coords.length&&(ct.coords.length=0),(0,G.Wi)(jt)||!jt.coords.length)return null;const Ur=Z[Zt],{coords:Br,lengths:Zr}=jt,ri=W(qt,er),hr=W(qt&&ir,er&&fr),Dr=le(qt,er,ir,fr);if(!Zr.length)return Dr(ct.coords,Br,0,0,Y(tr,Br[0]),j(tr,Br[1])),ct.lengths.length&&(ct.lengths.length=0),ct.coords.length=ri,ct;let Kr,Nt,lr,jr,Ot=0,rr=0,pr=rr;for(const Pr of Zr){if(Pr<Ur)continue;let Fr=0;rr=pr,lr=Kr=Y(tr,Br[Ot]),jr=Nt=j(tr,Br[Ot+1]),Dr(ct.coords,Br,rr,Ot,lr,jr),Fr++,Ot+=ri,rr+=hr;for(let ii=1;ii<Pr;ii++,Ot+=ri)lr=Y(tr,Br[Ot]),jr=j(tr,Br[Ot+1]),lr===Kr&&jr===Nt||(Dr(ct.coords,Br,rr,Ot,lr-Kr,jr-Nt),rr+=hr,Fr++,Kr=lr,Nt=jr);Fr>=Ur&&(ct.lengths.push(Fr),pr=rr)}return ct.coords.length=pr,ct.coords.length?ct:null}function yt(ct,jt,qt,er,Zt,tr,ir=qt,fr=er){if(ct.lengths.length&&(ct.lengths.length=0),ct.coords.length&&(ct.coords.length=0),!jt||!jt.coords.length)return null;const Ur=Z[Zt],{coords:Br,lengths:Zr}=jt,ri=W(qt,er),hr=W(qt&&ir,er&&fr),Dr=le(qt,er,ir,fr);if(!Zr.length)return Dr(ct.coords,Br,0,0,Br[0],Br[1]),ct.lengths.length&&(ct.lengths.length=0),ct.coords.length=ri,ct;let Kr=0;const Nt=tr*tr;for(const lr of Zr){if(lr<Ur){Kr+=lr*ri;continue}const jr=ct.coords.length/hr,Ot=Kr,rr=Kr+(lr-1)*ri;Dr(ct.coords,Br,ct.coords.length,Ot,Br[Ot],Br[Ot+1]),zt(ct.coords,Br,ri,Nt,Dr,Ot,rr),Dr(ct.coords,Br,ct.coords.length,rr,Br[rr],Br[rr+1]);const pr=ct.coords.length/hr-jr;pr>=Ur?ct.lengths.push(pr):ct.coords.length=jr*hr,Kr+=lr*ri}return ct.coords.length?ct:null}function wt(ct,jt,qt,er){const Zt=ct[jt],tr=ct[jt+1],Ur=ct[er],Br=ct[er+1];let Zr=ct[qt],ri=ct[qt+1],hr=Ur-Zr,Dr=Br-ri;if(0!==hr||0!==Dr){const Kr=((Zt-Zr)*hr+(tr-ri)*Dr)/(hr*hr+Dr*Dr);Kr>1?(Zr=Ur,ri=Br):Kr>0&&(Zr+=hr*Kr,ri+=Dr*Kr)}return hr=Zt-Zr,Dr=tr-ri,hr*hr+Dr*Dr}function zt(ct,jt,qt,er,Zt,tr,ir){let fr,Ur=er,Br=0;for(let Zr=tr+qt;Zr<ir;Zr+=qt)fr=wt(jt,Zr,tr,ir),fr>Ur&&(Br=Zr,Ur=fr);Ur>er&&(Br-tr>qt&&zt(ct,jt,qt,er,Zt,tr,Br),Zt(ct,jt,ct.length,Br,jt[Br],jt[Br+1]),ir-Br>qt&&zt(ct,jt,qt,er,Zt,Br,ir))}function Rt(ct,jt,qt,er){if((0,G.Wi)(jt)||!jt.coords||!jt.coords.length)return null;const Zt=W(qt,er);let tr=Number.POSITIVE_INFINITY,ir=Number.POSITIVE_INFINITY,fr=Number.NEGATIVE_INFINITY,Ur=Number.NEGATIVE_INFINITY;if(jt&&jt.coords){const Br=jt.coords;for(let Zr=0;Zr<Br.length;Zr+=Zt){const ri=Br[Zr],hr=Br[Zr+1];tr=Math.min(tr,ri),fr=Math.max(fr,ri),ir=Math.min(ir,hr),Ur=Math.max(Ur,hr)}}return ct[0]=tr,ct[1]=ir,ct[2]=fr,ct[3]=Ur,ct}function bt(ct,jt,qt,er,Zt){const{coords:tr,lengths:ir}=jt,fr=qt?er?oe:ue:er?ue:ie,Ur=W(qt,er);if(!tr.length)return ct!==jt&&(ct.lengths.length=0,ct.coords.length=0),ct;if(!ir.length)return fr(ct.coords,tr,0,0,X(Zt,tr[0]),U(Zt,tr[1])),ct!==jt&&(ct.lengths.length=0,ct.coords.length=Ur),ct;const[Br,Zr]=Zt.scale;let ri=0;for(let hr=0;hr<ir.length;hr++){const Dr=ir[hr];ct.lengths[hr]=Dr;let Kr=X(Zt,tr[ri]),Nt=U(Zt,tr[ri+1]);fr(ct.coords,tr,ri,ri,Kr,Nt),ri+=Ur;for(let lr=1;lr<Dr;lr++,ri+=Ur)Kr+=tr[ri]*Br,Nt-=tr[ri+1]*Zr,fr(ct.coords,tr,ri,ri,Kr,Nt)}return ct!==jt&&(ct.lengths.length=ir.length,ct.coords.length=tr.length),ct}function St(ct,jt,qt,er,Zt,tr){const ir=W(qt,er),fr=le(qt,er,Zt,tr),Ur=jt.coords;ct.coords.length=0,ct.lengths.length=0,ct.lengths.push(...jt.lengths);for(let Br=0;Br<Ur.length;Br+=ir)fr(ct.coords,Ur,ct.coords.length,Br,Ur[Br],Ur[Br+1]);return ct}function Mr(ct,jt,qt,er){let Zt=0,tr=ct[er*jt],ir=ct[er*(jt+1)];for(let fr=1;fr<qt;fr++){const Ur=tr+ct[er*(jt+fr)],Br=ir+ct[er*(jt+fr)+1],Zr=(Ur-tr)*(Br+ir);tr=Ur,ir=Br,Zt+=Zr}return.5*Zt}function Cr(ct,jt){const{coords:qt,lengths:er}=ct;let Zt=0,tr=0;for(let ir=0;ir<er.length;ir++)tr+=Mr(qt,Zt,er[ir],jt),Zt+=ir;return Math.abs(tr)}function Lr(ct,jt){if((0,G.Wi)(ct))return null;const qt=ct.clone(),er=ct.coords,Zt=ct.lengths;let tr=0;for(let ir=0;ir<Zt.length;ir++){const fr=Zt[ir];let Ur=er[jt*tr],Br=er[jt*tr+1];for(let Zr=1;Zr<fr;Zr++){const ri=Ur+er[jt*(tr+Zr)],hr=Br+er[jt*(tr+Zr)+1];qt.coords[jt*(tr+Zr)]=ri,qt.coords[jt*(tr+Zr)+1]=hr,Ur=ri,Br=hr}tr+=fr}return qt}},84786:(dt,Re,T)=>{"use strict";T.d(Re,{Ou:()=>W,WG:()=>X,kB:()=>ue,mW:()=>ie});var x=T(88879),G=(T(8314),T(58817)),Q=T(62208),H=T(55713),re=T(91179),J=T(38114);function W(U){return"declaredClass"in U}function B(U){return"declaredClass"in U}function ie(U,ee){if(!U)return null;if(function Z(U){return"declaredClass"in U}(U))return U;const $=new x.Z({layer:ee,sourceLayer:ee});return $.visible=U.visible,$.symbol=(0,G.d9)(U.symbol),$.attributes=(0,G.d9)(U.attributes),$.geometry=ue(U.geometry),$}function ue(U){return(0,Q.Wi)(U)?null:W(U)?U:(0,re.im)(function ce(U){const ee=U.spatialReference.toJSON();switch(U.type){case"point":{const{x:$,y:ne,z:se,m:ae}=U;return{x:$,y:ne,z:se,m:ae,spatialReference:ee}}case"polygon":{const{rings:$,hasZ:ne,hasM:se}=U;return{rings:oe($),hasZ:ne,hasM:se,spatialReference:ee}}case"polyline":{const{paths:$,hasZ:ne,hasM:se}=U;return{paths:oe($),hasZ:ne,hasM:se,spatialReference:ee}}case"extent":{const{xmin:$,xmax:ne,ymin:se,ymax:ae,zmin:de,zmax:_e,mmin:pe,mmax:he,hasZ:ge,hasM:ye}=U;return{xmin:$,xmax:ne,ymin:se,ymax:ae,zmin:de,zmax:_e,mmin:pe,mmax:he,hasZ:ge,hasM:ye,spatialReference:ee}}case"multipoint":{const{points:$,hasZ:ne,hasM:se}=U;return{points:j($)?le($):$,hasZ:ne,hasM:se,spatialReference:ee}}default:return}}(U))}function oe(U){return function Y(U){for(const ee of U)if(0!==ee.length)return j(ee);return!1}(U)?U.map(ee=>le(ee)):U}function le(U){return U.map(ee=>(0,H.qo)(ee))}function j(U){return U.length&&((0,H.xZ)(U[0])||(0,H.fS)(U[0]))}function X(U,ee){if(!U)return null;let $;if(B(U)){if(null==ee)return U.clone();if(B(ee))return ee.copy(U)}return null!=ee?($=ee,$.x=U.x,$.y=U.y,$.spatialReference=U.spatialReference,U.hasZ?($.z=U.z,$.hasZ=U.hasZ):($.z=null,$.hasZ=!1),U.hasM?($.m=U.m,$.hasM=!0):($.m=null,$.hasM=!1)):($=(0,J.Tx)(U.x,U.y,U.z,U.spatialReference),U.hasM&&($.m=U.m,$.hasM=!0)),$}},50085:(dt,Re,T)=>{"use strict";T.d(Re,{V:()=>W});var x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898));const W=B=>{let Z=class extends B{get apiKey(){var ie;return this._isOverridden("apiKey")?this._get("apiKey"):function J(B){return"portalItem"in B}(this)?null==(ie=this.portalItem)?void 0:ie.apiKey:null}set apiKey(ie){null!=ie?this._override("apiKey",ie):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return(0,x._)([(0,A.Cb)({type:String})],Z.prototype,"apiKey",null),Z=(0,x._)([(0,re.j)("esri.layers.mixins.APIKeyMixin")],Z),Z}},65088:(dt,Re,T)=>{"use strict";T.d(Re,{Y:()=>Z});var x=T(17626),A=T(63290),G=T(62208),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898)),B=T(38305);const Z=ie=>{let ue=class extends ie{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const ce=(0,B.Qc)(this.url);if((0,G.pC)(ce)&&ce.title)return ce.title}return this._get("title")||""}set title(ce){this._set("title",ce)}set url(ce){this._set("url",(0,B.Nm)(ce,A.Z.getLogger(this.declaredClass)))}};return(0,x._)([(0,Q.Cb)()],ue.prototype,"title",null),(0,x._)([(0,Q.Cb)({type:String})],ue.prototype,"url",null),ue=(0,x._)([(0,W.j)("esri.layers.mixins.ArcGISService")],ue),ue}},552:(dt,Re,T)=>{"use strict";T.d(Re,{h:()=>B});var x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(12818);const W={read:{reader:J.ij},write:{allowNull:!0,writer:J.cW}},B=Z=>{let ie=class extends Z{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return(0,x._)([(0,A.Cb)({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],ie.prototype,"blendMode",void 0),(0,x._)([(0,A.Cb)({json:{read:!1,write:!1,origins:{"web-map":W,"portal-item":W}}})],ie.prototype,"effect",void 0),ie=(0,x._)([(0,re.j)("esri.layers.mixins.BlendLayer")],ie),ie}},50107:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>J});var x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898));const J=W=>{let B=class extends W{constructor(){super(...arguments),this.customParameters=null}};return(0,x._)([(0,A.Cb)({type:Object,json:{write:{overridePolicy:Z=>({enabled:!!(Z&&Object.keys(Z).length>0)})}}})],B.prototype,"customParameters",void 0),B=(0,x._)([(0,re.j)("esri.layers.mixins.CustomParametersMixin")],B),B}},35126:(dt,Re,T)=>{"use strict";T.d(Re,{b:()=>B});var x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(2319);const W={write:{allowNull:!0}},B=Z=>{let ie=class extends Z{constructor(){super(...arguments),this.featureEffect=null}};return(0,x._)([(0,A.Cb)({type:J.Z,json:{origins:{"web-map":W,"portal-item":W}}})],ie.prototype,"featureEffect",void 0),ie=(0,x._)([(0,re.j)("esri.layers.mixins.FeatureEffectLayer")],ie),ie}},49286:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>oe});var x=T(17626),A=T(26584),G=T(21726),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898)),B=T(99433),Z=T(29338),ie=T(36054);const ue={"web-scene/operational-layers":{ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":{ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,OGCFeatureLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},"web-map/basemap":{ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},"web-map/tables":{ArcGISFeatureLayer:!0},"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0}};var ce=T(13812);const oe=Y=>{let j=class extends Y{constructor(){super(...arguments),this.title=null}writeListMode(X,U,ee,$){($&&"ground"===$.layerContainerType||X&&(0,ie.d)(this,ee,{},$))&&(U[ee]=X)}writeOperationalLayerType(X,U,ee,$){!X||$&&"tables"===$.layerContainerType||(U.layerType=X)}writeTitle(X,U){U.title=X||"Layer"}read(X,U){U&&(U.layer=this),(0,Z.$)(this,X,ee=>super.read(X,ee),U)}write(X,U){var ne,se;if(null==U?void 0:U.origin){const ae=`${U.origin}/${U.layerContainerType||"operational-layers"}`,de=ue[ae];let _e=de&&de[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===ae&&(_e=!1),!_e)return null==(ne=U.messages)||ne.push(new A.Z("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${ae}'`,{layer:this})),null}const ee=super.write(X,yi(or({},U),{layer:this})),$=!!U&&!!U.messages&&!!U.messages.filter(ae=>ae instanceof A.Z&&"web-document-write:property-required"===ae.name).length;return(0,G.jc)(null==ee?void 0:ee.url)?(null==(se=null==U?void 0:U.messages)||se.push(new A.Z("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&$?null:ee}beforeSave(){}};return(0,x._)([(0,Q.Cb)({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],j.prototype,"id",void 0),(0,x._)([(0,Q.Cb)(ce.rT)],j.prototype,"listMode",void 0),(0,x._)([(0,B.c)("listMode")],j.prototype,"writeListMode",null),(0,x._)([(0,Q.Cb)({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],j.prototype,"operationalLayerType",void 0),(0,x._)([(0,B.c)("operationalLayerType")],j.prototype,"writeOperationalLayerType",null),(0,x._)([(0,Q.Cb)(ce.Oh)],j.prototype,"opacity",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],j.prototype,"title",void 0),(0,x._)([(0,B.c)([void 0,"web-scene"],"title")],j.prototype,"writeTitle",null),(0,x._)([(0,Q.Cb)({type:Boolean,json:{name:"visibility"}})],j.prototype,"visible",void 0),j=(0,x._)([(0,W.j)("esri.layers.mixins.OperationalLayer")],j),j}},32629:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>j});var Z,x=T(17626),A=T(94113),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(2076),B=T(86810);const ie=new W.X({asc:"ascending",desc:"descending"});let ue=Z=class extends B.wq{constructor(X){super(X),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Z({field:this.field,valueExpression:this.valueExpression,order:this.order})}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],ue.prototype,"field",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],ue.prototype,"valueExpression",void 0),(0,x._)([(0,G.Cb)({type:ie.apiValues,json:{read:ie.read,write:ie.write}})],ue.prototype,"order",void 0),ue=Z=(0,x._)([(0,J.j)("esri.layers.support.OrderByInfo")],ue);const ce=ue;function le(X,U,ee){if(!X)return null;const $=X.find(se=>!!se.field);if(!$)return null;const ne=new ce;return ne.read($,ee),[ne]}function Y(X,U,ee,$){const ne=X.find(se=>!!se.field);ne&&(0,A.RB)(ee,[ne.toJSON()],U)}const j=X=>{let U=class extends X{constructor(){super(...arguments),this.orderBy=null}};return(0,x._)([(0,G.Cb)({type:[ce],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:le},write:{target:"layerDefinition.orderBy",writer:Y}}})],U.prototype,"orderBy",void 0),U=(0,x._)([(0,J.j)("esri.layers.mixins.OrderedLayer")],U),U}},6647:(dt,Re,T)=>{"use strict";T.d(Re,{I:()=>ne});var x=T(15861),A=T(17626),G=T(24263),Q=T(84792),H=T(59213),re=T(26584),J=T(63290),W=T(62208),B=T(10699),Z=T(21726),ie=T(77712),le=(T(85931),T(8314),T(90912),T(68653)),Y=T(76898),j=T(99433),X=T(84687),U=T(55463),ee=T(94508);const $=J.Z.getLogger("esri.layers.mixins.PortalLayer"),ne=ae=>{let de=class extends ae{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0}destroy(){var _e;null==(_e=this.portalItem)||_e.destroy(),this.portalItem=null}set portalItem(_e){_e!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",_e))}readPortalItem(_e,pe,he){if(pe.itemId)return new U.default({id:pe.itemId,portal:he&&he.portal})}writePortalItem(_e,pe){_e&&_e.id&&(pe.itemId=_e.id)}loadFromPortal(_e,pe){var he=this;return(0,x.Z)(function*(){if(he.portalItem&&he.portalItem.id)try{const ge=yield T.e(3705).then(T.bind(T,83705));return(0,B.k_)(pe),yield ge.load({instance:he,supportedTypes:_e.supportedTypes,validateItem:_e.validateItem,supportsData:_e.supportsData},pe)}catch(ge){throw(0,B.D_)(ge)||$.warn(`Failed to load layer (${he.title}, ${he.id}) portal item (${he.portalItem.id})\n  ${ge}`),ge}})()}finishLoadEditablePortalLayer(_e){var pe=this;return(0,x.Z)(function*(){pe._set("userHasEditingPrivileges",yield pe._fetchUserHasEditingPrivileges(_e).catch(he=>((0,B.r9)(he),!0)))})()}_fetchUserHasEditingPrivileges(_e){var pe=this;return(0,x.Z)(function*(){const he=pe.url?G.id.findCredential(pe.url):null;if(!he)return!0;const ge=se.credential===he?se.user:yield pe._fetchEditingUser(_e);return se.credential=he,se.user=ge,(0,W.Wi)(ge)||null==ge.privileges||ge.privileges.includes("features:user:edit")})()}_fetchEditingUser(_e){var pe=this;return(0,x.Z)(function*(){var Ce,Ie;const he=null==(Ie=null==(Ce=pe.portalItem)?void 0:Ce.portal)?void 0:Ie.user;if(he)return he;const ge=G.id.findServerInfo(pe.url);if(!(null==ge?void 0:ge.owningSystemUrl))return null;const ye=`${ge.owningSystemUrl}/sharing/rest`,Me=X.Z.getDefault();if(Me&&Me.loaded&&(0,Z.Fv)(Me.restUrl)===(0,Z.Fv)(ye))return Me.user;const Ee=`${ye}/community/self`,Te=(0,W.pC)(_e)?_e.signal:null,me=yield(0,H.q6)((0,Q.default)(Ee,{authMode:"no-prompt",query:{f:"json"},signal:Te}));return me.ok?ee.default.fromJSON(me.value.data):null})()}read(_e,pe){pe&&(pe.layer=this),super.read(_e,pe)}write(_e,pe){const he=pe&&pe.portal,ge=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||X.Z.getDefault());return he&&ge&&!(0,Z.tm)(ge.restUrl,he.restUrl)?(pe.messages&&pe.messages.push(new re.Z("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(_e,yi(or({},pe),{layer:this}))}};return(0,A._)([(0,ie.Cb)({type:U.default})],de.prototype,"portalItem",null),(0,A._)([(0,le.r)("web-document","portalItem",["itemId"])],de.prototype,"readPortalItem",null),(0,A._)([(0,j.c)("web-document","portalItem",{itemId:{type:String}})],de.prototype,"writePortalItem",null),(0,A._)([(0,ie.Cb)({clonable:!1})],de.prototype,"resourceReferences",void 0),(0,A._)([(0,ie.Cb)({readOnly:!0})],de.prototype,"userHasEditingPrivileges",void 0),de=(0,A._)([(0,Y.j)("esri.layers.mixins.PortalLayer")],de),de},se={credential:null,user:null}},30346:(dt,Re,T)=>{"use strict";T.d(Re,{Q:()=>de,d:()=>ae});var x=T(15861),A=T(17626),G=T(63290),Q=T(10699),H=T(77712),B=(T(85931),T(8314),T(90912),T(76898)),Z=T(46160),ce=(T(26584),T(30755),T(21352));const oe=new Z.Z,le=new WeakMap;function X(_e){return _e&&"object"==typeof _e&&"refreshInterval"in _e&&"refresh"in _e}function U(_e,pe){return Number.isFinite(_e)&&Number.isFinite(pe)?pe<=0?_e:U(pe,_e%pe):0}let ee=0,$=0;function ne(){var pe;const _e=Date.now();for(const he of oe)he.refreshInterval&&_e-(null!=(pe=le.get(he))?pe:0)+5>=6e4*he.refreshInterval&&(le.set(he,_e),he.refresh(_e))}function ae(_e){return _e&&"object"==typeof _e&&"refreshTimestamp"in _e&&"refresh"in _e}(0,ce.EH)(()=>{const _e=Date.now();let pe=0;for(const he of oe)pe=U(Math.round(6e4*he.refreshInterval),pe),he.refreshInterval?le.get(he)||le.set(he,_e):le.delete(he);if(pe!==$){if($=pe,clearInterval(ee),0===$)return void(ee=0);ee=setInterval(ne,$)}});const de=_e=>{let pe=class extends _e{constructor(...he){super(...he),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=(0,Q.Ds)(()=>this.hasDataChanged()),this.when().then(()=>{!function Y(_e){X(_e)&&oe.push(_e)}(this)},()=>{})}destroy(){!function j(_e){X(_e)&&oe.includes(_e)&&oe.remove(_e)}(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(he=Date.now()){(0,Q.R8)(this._debounceHasDataChanged()).then(ge=>{ge&&this._set("refreshTimestamp",he),this.emit("refresh",{dataChanged:ge})},ge=>{G.Z.getLogger(this.declaredClass).error(ge),this.emit("refresh",{dataChanged:!1,error:ge})})}hasDataChanged(){return(0,x.Z)(function*(){return!0})()}};return(0,A._)([(0,H.Cb)({type:Number,cast:he=>he>=.1?he:he<=0?0:.1,json:{write:!0}})],pe.prototype,"refreshInterval",void 0),(0,A._)([(0,H.Cb)({readOnly:!0})],pe.prototype,"refreshTimestamp",void 0),(0,A._)([(0,H.Cb)()],pe.prototype,"refreshParameters",null),pe=(0,A._)([(0,B.j)("esri.layers.mixins.RefreshableLayer")],pe),pe}},99555:(dt,Re,T)=>{"use strict";T.d(Re,{M:()=>J});var x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898));const J=B=>{let Z=class extends B{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const ie={minScale:this.minScale,maxScale:this.maxScale},ue=this.parent;ue&&"effectiveScaleRange"in ue&&function W(B,Z){B.minScale=B.minScale>0?Z.minScale>0?Math.min(B.minScale,Z.minScale):B.minScale:Z.minScale,B.maxScale=B.maxScale>0?Z.maxScale>0?Math.max(B.maxScale,Z.maxScale):B.maxScale:Z.maxScale}(ie,ue.effectiveScaleRange);const ce=this._get("effectiveScaleRange");return ce&&ce.minScale===ie.minScale&&ce.maxScale===ie.maxScale?ce:ie}};return(0,x._)([(0,A.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],Z.prototype,"minScale",void 0),(0,x._)([(0,A.Cb)({type:Number,nonNullable:!0,json:{write:!0}})],Z.prototype,"maxScale",void 0),(0,x._)([(0,A.Cb)({readOnly:!0})],Z.prototype,"effectiveScaleRange",null),Z=(0,x._)([(0,re.j)("esri.layers.mixins.ScaleRangeLayer")],Z),Z}},10157:(dt,Re,T)=>{"use strict";T.d(Re,{xp:()=>We,Vt:()=>Ce});var x=T(15861),A=T(17626),G=T(84792),Q=T(26584),re=(T(8314),T(63290)),J=T(62208),W=T(10699),B=T(21726),Z=T(77712),ce=(T(85931),T(90912),T(68653)),oe=T(76898),le=T(99433),Y=T(52489),j=T(2004),X=T(79334),U=T(65234),ee=T(38305),$=T(13812),ne=T(60595),se=T(84687),ae=T(55463),de=T(59213),_e=T(35948),pe=T(10587);function he(Ne,we,Oe){return ge.apply(this,arguments)}function ge(){return(ge=(0,x.Z)(function*(Ne,we,Oe){if(!we||!we.resources)return;const $e=we.portalItem===Ne.portalItem?new Set(Ne.paths):new Set;Ne.paths.length=0,Ne.portalItem=we.portalItem;const Be=new Set(we.resources.toKeep.map(Ke=>Ke.resource.path)),Se=new Set,De=[];Be.forEach(Ke=>{$e.delete(Ke),Ne.paths.push(Ke)});for(const Ke of we.resources.toUpdate)if($e.delete(Ke.resource.path),Be.has(Ke.resource.path)||Se.has(Ke.resource.path)){const{resource:qe,content:be,finish:tt,error:Ye}=Ke,ze=(0,pe.getSiblingOfSameTypeI)(qe,(0,_e.D)());Ne.paths.push(ze.path),De.push(ye({resource:ze,content:be,finish:tt,error:Ye},Oe))}else Ne.paths.push(Ke.resource.path),De.push(Ee(Ke,Oe)),Se.add(Ke.resource.path);for(const Ke of we.resources.toAdd)De.push(ye(Ke,Oe)),Ne.paths.push(Ke.resource.path);if($e.forEach(Ke=>{const qe=we.portalItem.resourceFromPath(Ke);De.push(qe.portalItem.removeResource(qe).catch(()=>{}))}),0===De.length)return;const Fe=yield(0,W.as)(De);(0,W.k_)(Oe);const ve=Fe.filter(Ke=>"error"in Ke).map(Ke=>Ke.error);if(ve.length>0)throw new Q.Z("save:resources","Failed to save one or more resources",{errors:ve})})).apply(this,arguments)}function ye(Ne,we){return Me.apply(this,arguments)}function Me(){return(Me=(0,x.Z)(function*(Ne,we){const Oe=yield(0,de.q6)(Ne.resource.portalItem.addResource(Ne.resource,Ne.content,we));if(!0!==Oe.ok)throw Ne.error&&Ne.error(Oe.error),Oe.error;Ne.finish&&Ne.finish(Ne.resource)})).apply(this,arguments)}function Ee(Ne,we){return Te.apply(this,arguments)}function Te(){return(Te=(0,x.Z)(function*(Ne,we){const Oe=yield(0,de.q6)(Ne.resource.update(Ne.content,we));if(!0!==Oe.ok)throw Ne.error(Oe.error),Oe.error;Ne.finish(Ne.resource)})).apply(this,arguments)}const me=re.Z.getLogger("esri.layers.mixins.SceneService"),Ce=Ne=>{let we=class extends Ne{constructor(){var Oe;super(...arguments),Oe=this,this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=(0,W.Ds)(function(){var $e=(0,x.Z)(function*(Be,Se,De){switch(Be){case We.SAVE:return Oe._save(Se);case We.SAVE_AS:return Oe._saveAs(De,Se)}});return function(Be,Se,De){return $e.apply(this,arguments)}}())}readSpatialReference(Oe,$e){return this._readSpatialReference($e)}_readSpatialReference(Oe){if(null!=Oe.spatialReference)return U.Z.fromJSON(Oe.spatialReference);{const $e=Oe.store,Be=$e.indexCRS||$e.geographicCRS,Se=Be&&parseInt(Be.substring(Be.lastIndexOf("/")+1,Be.length),10);return null!=Se?new U.Z(Se):null}}readFullExtent(Oe,$e,Be){if(null!=Oe&&"object"==typeof Oe){const Fe=null==Oe.spatialReference?yi(or({},Oe),{spatialReference:this._readSpatialReference($e)}):Oe;return j.Z.fromJSON(Fe,Be)}const Se=$e.store,De=this._readSpatialReference($e);return null==De||null==Se||null==Se.extent||!Array.isArray(Se.extent)||Se.extent.some(Fe=>Fe<Ie)?null:new j.Z({xmin:Se.extent[0],ymin:Se.extent[1],xmax:Se.extent[2],ymax:Se.extent[3],spatialReference:De})}parseVersionString(Oe){const $e={major:Number.NaN,minor:Number.NaN,versionString:Oe},Be=Oe.split(".");return Be.length>=2&&($e.major=parseInt(Be[0],10),$e.minor=parseInt(Be[1],10)),$e}readVersion(Oe,$e){const Be=$e.store,Se=null!=Be.version?Be.version.toString():"";return this.parseVersionString(Se)}readTitlePortalItem(Oe){return"item-title"!==this.sublayerTitleMode?void 0:Oe}readTitleService(Oe,$e){const Be=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return(0,ee.a7)(this.url,$e.name);let Se=$e.name;if(!Se&&this.url){const De=(0,ee.Qc)(this.url);(0,J.pC)(De)&&(Se=De.title)}return"item-title-and-service-name"===this.sublayerTitleMode&&Be&&(Se=Be+" - "+Se),(0,ee.ld)(Se)}set url(Oe){const $e=(0,ee.XG)({layer:this,url:Oe,nonStandardUrlAllowed:!1,logger:me});this._set("url",$e.url),null!=$e.layerId&&this._set("layerId",$e.layerId)}writeUrl(Oe,$e,Be,Se){(0,ee.wH)(this,Oe,"layers",$e,Se)}get parsedUrl(){const Oe=this._get("url");if(!Oe)return null;const $e=(0,B.mN)(Oe);return null!=this.layerId&&($e.path=`${$e.path}/layers/${this.layerId}`),$e}_fetchIndexAndUpdateExtent(Oe,$e){var Be=this;return(0,x.Z)(function*(){Be.indexInfo=(0,ne.T)(Be.parsedUrl.path,Be.rootNode,Oe,Be.apiKey,me,$e),null==Be.fullExtent||Be.fullExtent.hasZ||Be._updateExtent(yield Be.indexInfo)})()}_updateExtent(Oe){var $e,Be,Se;if("page"===(null==Oe?void 0:Oe.type)){const De=Oe.rootIndex%Oe.pageSize,Fe=null==(Be=null==($e=Oe.rootPage)?void 0:$e.nodes)?void 0:Be[De];if(null==Fe||null==Fe.obb||null==Fe.obb.center||null==Fe.obb.halfSize)throw new Q.Z("sceneservice:invalid-node-page","Invalid node page.");if(Fe.obb.center[0]<Ie||null==this.fullExtent||this.fullExtent.hasZ)return;const ve=Fe.obb.halfSize,Ke=Fe.obb.center[2],qe=Math.sqrt(ve[0]*ve[0]+ve[1]*ve[1]+ve[2]*ve[2]);this.fullExtent.zmin=Ke-qe,this.fullExtent.zmax=Ke+qe}else if("node"===(null==Oe?void 0:Oe.type)){const De=null==(Se=Oe.rootNode)?void 0:Se.mbs;if(!Array.isArray(De)||4!==De.length||De[0]<Ie)return;const Fe=De[2],ve=De[3];this.fullExtent.zmin=Fe-ve,this.fullExtent.zmax=Fe+ve}}_fetchService(Oe){var $e=this;return(0,x.Z)(function*(){if(null==$e.url)throw new Q.Z("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==$e.layerId&&/SceneServer\/*$/i.test($e.url)){const Be=yield $e._fetchFirstLayerId(Oe);null!=Be&&($e.layerId=Be)}return $e._fetchServiceLayer(Oe)})()}_fetchFirstLayerId(Oe){var $e=this;return(0,x.Z)(function*(){const Be=yield(0,G.default)($e.url,{query:{f:"json",token:$e.apiKey},responseType:"json",signal:Oe});if(Be.data&&Array.isArray(Be.data.layers)&&Be.data.layers.length>0)return Be.data.layers[0].id})()}_fetchServiceLayer(Oe){var $e=this;return(0,x.Z)(function*(){const Be=yield(0,G.default)($e.parsedUrl.path,{query:{f:"json",token:$e.apiKey},responseType:"json",signal:Oe});Be.ssl&&($e.url=$e.url.replace(/^http:/i,"https:"));let Se=!1;if(Be.data.layerType&&"Voxel"===Be.data.layerType&&(Se=!0),Se)return $e._fetchVoxelServiceLayer();const De=Be.data;$e.read(De,{origin:"service",url:$e.parsedUrl}),$e.validateLayer(De)})()}_fetchVoxelServiceLayer(Oe){var $e=this;return(0,x.Z)(function*(){const Be=(yield(0,G.default)($e.parsedUrl.path+"/layer",{query:{f:"json",token:$e.apiKey},responseType:"json",signal:Oe})).data;$e.read(Be,{origin:"service",url:$e.parsedUrl}),$e.validateLayer(Be)})()}_ensureLoadBeforeSave(){var Oe=this;return(0,x.Z)(function*(){yield Oe.load(),"beforeSave"in Oe&&"function"==typeof Oe.beforeSave&&(yield Oe.beforeSave())})()}validateLayer(Oe){}_updateTypeKeywords(Oe,$e,Be){Oe.typeKeywords||(Oe.typeKeywords=[]);const Se=$e.getTypeKeywords();for(const De of Se)Oe.typeKeywords.push(De);Oe.typeKeywords&&(Oe.typeKeywords=Oe.typeKeywords.filter((De,Fe,ve)=>ve.indexOf(De)===Fe),Be===Je.newItem&&(Oe.typeKeywords=Oe.typeKeywords.filter(De=>"Hosted Service"!==De)))}_saveAs(Oe,$e){var Be=this;return(0,x.Z)(function*(){const Se=or(or({},je),$e);let De=ae.default.from(Oe);De||(me.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new Q.Z("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),De.id&&(De=De.clone(),De.id=null);const Fe=De.portal||se.Z.getDefault();yield Be._ensureLoadBeforeSave(),De.type=xe,De.portal=Fe;const ve={origin:"portal-item",url:null,messages:[],portal:Fe,portalItem:De,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},Ke={layers:[Be.write({},ve)]};return yield Promise.all(ve.resources.pendingOperations),yield Be._validateAgainstJSONSchema(Ke,ve,Se),De.url=Be.url,De.title||(De.title=Be.title),Be._updateTypeKeywords(De,Se,Je.newItem),yield Fe._signIn(),yield Fe.user.addItem({item:De,folder:Se&&Se.folder,data:Ke}),yield he(Be.resourceReferences,ve,null),Be.portalItem=De,(0,Y.D)(ve),ve.portalItem=De,De})()}_save(Oe){var $e=this;return(0,x.Z)(function*(){const Be=or(or({},je),Oe);$e.portalItem||(me.error("_save(): requires the .portalItem property to be set"),yield Promise.reject(new Q.Z("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService"))),$e.portalItem.type!==xe&&(me.error("_save(): Non-matching portal item type. Got "+$e.portalItem.type+", expected "+xe),yield Promise.reject(new Q.Z("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${xe}"`))),yield $e._ensureLoadBeforeSave();const Se={origin:"portal-item",url:$e.portalItem.itemUrl&&(0,B.mN)($e.portalItem.itemUrl),messages:[],portal:$e.portalItem.portal||se.Z.getDefault(),portalItem:$e.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},De={layers:[$e.write({},Se)]};return yield Promise.all(Se.resources.pendingOperations),yield $e._validateAgainstJSONSchema(De,Se,Be),$e.portalItem.url=$e.url,$e.portalItem.title||($e.portalItem.title=$e.title),$e._updateTypeKeywords($e.portalItem,Be,Je.existingItem),yield $e.portalItem.update({data:De}),yield he($e.resourceReferences,Se,null),(0,Y.D)(Se),$e.portalItem})()}_validateAgainstJSONSchema(Oe,$e,Be){return(0,x.Z)(function*(){let Se=$e.messages.filter(De=>"error"===De.type).map(De=>new Q.Z(De.name,De.message,De.details));if(Be&&Be.validationOptions.ignoreUnsupported&&(Se=Se.filter(De=>"layer:unsupported"!==De.name&&"symbol:unsupported"!==De.name&&"symbol-layer:unsupported"!==De.name&&"property:unsupported"!==De.name&&"url:unsupported"!==De.name&&"scenemodification:unsupported"!==De.name)),Be.validationOptions.enabled||Ge){const De=(yield T.e(5496).then(T.bind(T,15496))).validate(Oe,Be.portalItemLayerType);if(De.length>0){const Fe=`Layer item did not validate:\n${De.join("\n")}`;if(me.error(`_validateAgainstJSONSchema(): ${Fe}`),"throw"===Be.validationOptions.failPolicy){const ve=De.map(Ke=>new Q.Z("sceneservice:schema-validation",Ke)).concat(Se);throw new Q.Z("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:ve})}}}if(Se.length>0)throw new Q.Z("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:Se})})()}};return(0,A._)([(0,Z.Cb)($.id)],we.prototype,"id",void 0),(0,A._)([(0,Z.Cb)({type:U.Z})],we.prototype,"spatialReference",void 0),(0,A._)([(0,ce.r)("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],we.prototype,"readSpatialReference",null),(0,A._)([(0,Z.Cb)({type:j.Z})],we.prototype,"fullExtent",void 0),(0,A._)([(0,ce.r)("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],we.prototype,"readFullExtent",null),(0,A._)([(0,Z.Cb)({readOnly:!0,type:X.Z})],we.prototype,"heightModelInfo",void 0),(0,A._)([(0,Z.Cb)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],we.prototype,"minScale",void 0),(0,A._)([(0,Z.Cb)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],we.prototype,"maxScale",void 0),(0,A._)([(0,Z.Cb)({readOnly:!0})],we.prototype,"version",void 0),(0,A._)([(0,ce.r)("version",["store.version"])],we.prototype,"readVersion",null),(0,A._)([(0,Z.Cb)({type:String,json:{read:{source:"copyrightText"}}})],we.prototype,"copyright",void 0),(0,A._)([(0,Z.Cb)({type:String,json:{read:!1}})],we.prototype,"sublayerTitleMode",void 0),(0,A._)([(0,Z.Cb)({type:String})],we.prototype,"title",void 0),(0,A._)([(0,ce.r)("portal-item","title")],we.prototype,"readTitlePortalItem",null),(0,A._)([(0,ce.r)("service","title",["name"])],we.prototype,"readTitleService",null),(0,A._)([(0,Z.Cb)({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],we.prototype,"layerId",void 0),(0,A._)([(0,Z.Cb)($.HQ)],we.prototype,"url",null),(0,A._)([(0,le.c)("url")],we.prototype,"writeUrl",null),(0,A._)([(0,Z.Cb)()],we.prototype,"parsedUrl",null),(0,A._)([(0,Z.Cb)({readOnly:!0})],we.prototype,"store",void 0),(0,A._)([(0,Z.Cb)({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],we.prototype,"rootNode",void 0),we=(0,A._)([(0,oe.j)("esri.layers.mixins.SceneService")],we),we},Ie=-1e38,Ge=!1;var Je,Ne;(Ne=Je||(Je={}))[Ne.existingItem=0]="existingItem",Ne[Ne.newItem=1]="newItem";const xe="Scene Service",je={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var We;!function(Ne){Ne[Ne.SAVE=0]="SAVE",Ne[Ne.SAVE_AS=1]="SAVE_AS"}(We||(We={}))},97941:(dt,Re,T)=>{"use strict";T.d(Re,{n:()=>oe});var x=T(17626),A=T(97478),G=T(20849),Q=T(77712),W=(T(85931),T(8314),T(90912),T(68653)),B=T(76898),Z=T(36630),ie=T(62708),ue=T(58926);const oe=le=>{let Y=class extends le{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(j,X){const U=X.timeInfo.exportOptions;if(!U)return null;const ee=U.timeOffset,$=ue.v.fromJSON(U.timeOffsetUnits);return ee&&$?new G.Z({value:ee,unit:$}):null}set timeInfo(j){(0,Z.UF)(j,this.fieldsIndex),this._set("timeInfo",j)}};return(0,x._)([(0,Q.Cb)({type:A.Z,json:{write:!1}})],Y.prototype,"timeExtent",void 0),(0,x._)([(0,Q.Cb)({type:G.Z})],Y.prototype,"timeOffset",void 0),(0,x._)([(0,W.r)("service","timeOffset",["timeInfo.exportOptions"])],Y.prototype,"readOffset",null),(0,x._)([(0,Q.Cb)({value:null,type:ie.Z,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],Y.prototype,"timeInfo",null),(0,x._)([(0,Q.Cb)({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],Y.prototype,"useViewTime",void 0),Y=(0,x._)([(0,B.j)("esri.layers.mixins.TemporalLayer")],Y),Y}},86219:(dt,Re,T)=>{"use strict";T.d(Re,{u:()=>B});var W,x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let B=W=class extends A.wq{constructor(Z){super(Z),this.name=null,this.code=null}clone(){return new W({name:this.name,code:this.code})}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"name",void 0),(0,x._)([(0,G.Cb)({type:[String,Number],json:{write:!0}})],B.prototype,"code",void 0),B=W=(0,x._)([(0,J.j)("esri.layers.support.CodedValue")],B)},26036:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(58817),G=T(77712),H=(T(90912),T(55342)),re=T(76898),J=T(86219),W=T(50028);let Z=B=class extends W.Z{constructor(ue){super(ue),this.codedValues=null,this.type="coded-value"}getName(ue){let ce=null;if(this.codedValues){const oe=String(ue);this.codedValues.some(le=>(String(le.code)===oe&&(ce=le.name),!!ce))}return ce}clone(){return new B({codedValues:(0,A.d9)(this.codedValues),name:this.name})}};(0,x._)([(0,G.Cb)({type:[J.u],json:{write:!0}})],Z.prototype,"codedValues",void 0),(0,x._)([(0,H.J)({codedValue:"coded-value"})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,re.j)("esri.layers.support.CodedValueDomain")],Z);const ie=Z},50028:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var x=T(17626),A=T(2076),G=T(86810),Q=T(77712),W=(T(85931),T(8314),T(90912),T(55342)),B=T(76898);const Z=new A.X({inherited:"inherited",codedValue:"coded-value",range:"range"});let ie=class extends G.wq{constructor(ce){super(ce),this.name=null,this.type=null}};(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],ie.prototype,"name",void 0),(0,x._)([(0,W.J)(Z)],ie.prototype,"type",void 0),ie=(0,x._)([(0,B.j)("esri.layers.support.Domain")],ie);const ue=ie},13762:(dt,Re,T)=>{"use strict";T.d(Re,{G$:()=>ce,Tl:()=>ue}),T(29132),T(8314);var G=T(63290),Q=T(62208),H=T(16730),re=T(65401),J=T(46367),W=T(49672);const B=G.Z.getLogger("esri.layers.support.ElevationSampler");class Z{queryElevation($){return ce($.clone(),this)}on(){return U}projectIfRequired($,ne){return oe($,ne)}}class ie extends Z{constructor($,ne,se){super(),this.tile=$,this.noDataValue=se,this.extent=(0,re.HH)($.tile.extent,ne.spatialReference),this.extent.zmin=$.zmin,this.extent.zmax=$.zmax,this.aaExtent=$.tile.extent;const ae=(0,H.c9)(ne.spatialReference),de=ne.lodAt($.tile.level).resolution*ae;this.demResolution={min:de,max:de}}get spatialReference(){return this.extent.spatialReference}contains($){const ne=this.projectIfRequired($,this.spatialReference);return!(0,Q.Wi)(ne)&&this.containsAt(ne.x,ne.y)}containsAt($,ne){return(0,re.jE)(this.aaExtent,$,ne)}elevationAt($,ne){if(!this.containsAt($,ne)){const se=this.extent;return B.warn("#elevationAt()",`Point used to sample elevation (${$}, ${ne}) is outside of the sampler extent (${se.xmin}, ${se.ymin}, ${se.xmax}, ${se.ymax})`),this.noDataValue}return(0,Q.Pt)(this.tile.sample($,ne),this.noDataValue)}}class ue extends Z{constructor($,ne,se){let ae;super(),"number"==typeof ne?(this.noDataValue=ne,ae=null):(ae=ne,this.noDataValue=se),this.samplers=ae?$.map(_e=>new ie(_e,ae,this.noDataValue)):$;const de=this.samplers[0];if(de){this.extent=de.extent.clone();const{min:_e,max:pe}=de.demResolution;this.demResolution={min:_e,max:pe};for(let he=1;he<this.samplers.length;he++){const ge=this.samplers[he];this.extent.union(ge.extent),this.demResolution.min=Math.min(this.demResolution.min,ge.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,ge.demResolution.max)}}else this.extent=(0,re.HH)((0,re.Ue)(),ae.spatialReference),this.demResolution={min:0,max:0}}get spatialReference(){return this.extent.spatialReference}elevationAt($,ne){for(const se of this.samplers)if(se.containsAt($,ne))return se.elevationAt($,ne);return B.warn("#elevationAt()",`Point used to sample elevation (${$}, ${ne}) is outside of the sampler`),this.noDataValue}}function ce(ee,$){const ne=oe(ee,$.spatialReference);if(!ne)return null;switch(ee.type){case"point":!function le(ee,$,ne){ee.z=ne.elevationAt($.x,$.y)}(ee,ne,$);break;case"polyline":!function Y(ee,$,ne){X.spatialReference=$.spatialReference;const se=ee.hasM&&!ee.hasZ;for(let ae=0;ae<ee.paths.length;ae++){const de=ee.paths[ae],_e=$.paths[ae];for(let pe=0;pe<de.length;pe++){const he=de[pe],ge=_e[pe];X.x=ge[0],X.y=ge[1],se&&(he[3]=he[2]),he[2]=ne.elevationAt(X.x,X.y)}}ee.hasZ=!0}(ee,ne,$);break;case"multipoint":!function j(ee,$,ne){X.spatialReference=$.spatialReference;const se=ee.hasM&&!ee.hasZ;for(let ae=0;ae<ee.points.length;ae++){const de=ee.points[ae],_e=$.points[ae];X.x=_e[0],X.y=_e[1],se&&(de[3]=de[2]),de[2]=ne.elevationAt(X.x,X.y)}ee.hasZ=!0}(ee,ne,$)}return ee}function oe(ee,$){if((0,Q.Wi)(ee))return null;const ne=ee.spatialReference;if(ne.equals($))return ee;const se=(0,J.iV)(ee,$);return se||B.error(`Cannot project geometry spatial reference (wkid:${ne.wkid}) to elevation sampler spatial reference (wkid:${$.wkid})`),se}const X=new W.Z,U={remove(){}}},2319:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>X});var ce,x=T(17626),A=T(26584),G=T(86810),Q=T(62208),H=T(94113),re=T(77712),Z=(T(85931),T(8314),T(90912),T(76898)),ie=T(12818),ue=T(98624);const oe={read:{reader:ie.ij},write:{writer:ie.cW,overridePolicy(){return{allowNull:null!=this.excludedEffect,isRequired:null==this.excludedEffect}}}},le={read:{reader:ie.ij},write:{writer:ie.cW,overridePolicy(){return{allowNull:null!=this.includedEffect,isRequired:null==this.includedEffect}}}},Y={name:"showExcludedLabels",default:!0};let j=ce=class extends G.wq{constructor(U){super(U),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(U,ee){var ne,se;const $=super.write(U,ee);if(null==ee?void 0:ee.origin){if($.filter){const ae=Object.keys($.filter);if(ae.length>1||"where"!==ae[0])return null==(ne=ee.messages)||ne.push(new A.Z("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:ee.layer,effect:this})),null}if("showExcludedLabels"in $)return null==(se=ee.messages)||se.push(new A.Z("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:ee.layer,effect:this})),null}return $}clone(){return new ce({filter:(0,Q.pC)(this.filter)&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};(0,x._)([(0,re.Cb)({type:ue.Z,json:{write:{allowNull:!0,writer(U,ee,$,ne){const se=null==U?void 0:U.write({},ne);se&&0!==Object.keys(se).length?(0,H.RB)($,se,ee):(0,H.RB)($,null,ee)}}}})],j.prototype,"filter",void 0),(0,x._)([(0,re.Cb)({json:{write:!0,origins:{"web-map":oe,"portal-item":oe}}})],j.prototype,"includedEffect",void 0),(0,x._)([(0,re.Cb)({json:{write:!0,origins:{"web-map":le,"portal-item":le}}})],j.prototype,"excludedEffect",void 0),(0,x._)([(0,re.Cb)({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":Y,"portal-item":Y}}})],j.prototype,"excludedLabelsVisible",void 0),j=ce=(0,x._)([(0,Z.j)("esri.layers.support.FeatureEffect")],j);const X=j},98624:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Y});var ue,x=T(17626),A=T(29132),G=T(97478),Q=T(2076),H=T(86810),re=T(58817),J=T(62208),W=T(77712),Z=(T(90912),T(76898)),ie=T(84952);const ce=new Q.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),oe=new Q.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let le=ue=class extends H.wq{constructor(j){super(j),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(j={}){const{where:X,geometry:U,spatialRelationship:ee,timeExtent:$,objectIds:ne,units:se,distance:ae}=this;return new ie.Z(or({geometry:(0,re.d9)(U),objectIds:(0,re.d9)(ne),spatialRelationship:ee,timeExtent:(0,re.d9)($),where:X,units:se,distance:ae},j))}clone(){const{where:j,geometry:X,spatialRelationship:U,timeExtent:ee,objectIds:$,units:ne,distance:se}=this;return new ue({geometry:(0,re.d9)(X),objectIds:(0,re.d9)($),spatialRelationship:U,timeExtent:(0,re.d9)(ee),where:j,units:ne,distance:se})}};(0,x._)([(0,W.Cb)({type:String,json:{write:!0}})],le.prototype,"where",void 0),(0,x._)([(0,W.Cb)({types:A.qM,json:{write:!0}})],le.prototype,"geometry",void 0),(0,x._)([(0,W.Cb)({type:ce.apiValues,json:{name:"spatialRel",read:{reader:ce.read},write:{allowNull:!1,writer:ce.write,overridePolicy(){return{enabled:(0,J.pC)(this.geometry)}}}}})],le.prototype,"spatialRelationship",void 0),(0,x._)([(0,W.Cb)({type:Number,json:{write:{overridePolicy(j){return{enabled:null!=j&&null!=this.geometry}}}}})],le.prototype,"distance",void 0),(0,x._)([(0,W.Cb)({type:[Number],json:{write:!0}})],le.prototype,"objectIds",void 0),(0,x._)([(0,W.Cb)({type:oe.apiValues,json:{read:oe.read,write:{writer:oe.write,overridePolicy(j){return{enabled:null!=j&&null!=this.geometry}}}}})],le.prototype,"units",void 0),(0,x._)([(0,W.Cb)({type:G.Z,json:{write:!0}})],le.prototype,"timeExtent",void 0),le=ue=(0,x._)([(0,Z.j)("esri.layers.support.FeatureFilter")],le);const Y=le},83989:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>W});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.wq{constructor(){super(...arguments),this.type=null}};(0,x._)([(0,G.Cb)({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"type",void 0),W=(0,x._)([(0,J.j)("esri.layers.support.FeatureReduction")],W)},47058:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(83989);let B=W=class extends J.B{constructor(ie){super(ie),this.type="selection"}clone(){return new W}};(0,x._)([(0,A.Cb)({type:["selection"]})],B.prototype,"type",void 0),B=W=(0,x._)([(0,re.j)("esri.layers.support.FeatureReductionSelection")],B);const Z=B},32777:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var x=T(17626),A=T(79608),G=T(2076),Q=T(86810),H=T(77712),B=(T(85931),T(8314),T(90912),T(76898));const Z=new G.X({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let ie=class extends((0,A.J)(Q.wq)){constructor(ce){super(ce),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};(0,x._)([(0,H.Cb)({json:{write:!0}})],ie.prototype,"name",void 0),(0,x._)([(0,H.Cb)({json:{write:!0}})],ie.prototype,"description",void 0),(0,x._)([(0,H.Cb)({json:{read:Z.read,write:Z.write}})],ie.prototype,"drawingTool",void 0),(0,x._)([(0,H.Cb)({json:{write:!0}})],ie.prototype,"prototype",void 0),(0,x._)([(0,H.Cb)({json:{write:!0}})],ie.prototype,"thumbnail",void 0),ie=(0,x._)([(0,B.j)("esri.layers.support.FeatureTemplate")],ie);const ue=ie},41638:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var x=T(17626),A=T(79608),G=T(86810),Q=T(77712),W=(T(85931),T(8314),T(90912),T(68653)),B=T(76898),Z=T(99433),ie=T(67945),ue=T(32777);let ce=class extends((0,A.J)(G.wq)){constructor(le){super(le),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(le){const Y={};for(const j of Object.keys(le))Y[j]=(0,ie.im)(le[j]);return Y}writeDomains(le,Y){var X;const j={};for(const U of Object.keys(le))le[U]&&(j[U]=null==(X=le[U])?void 0:X.toJSON());Y.domains=j}};(0,x._)([(0,Q.Cb)({json:{write:!0}})],ce.prototype,"id",void 0),(0,x._)([(0,Q.Cb)({json:{write:!0}})],ce.prototype,"name",void 0),(0,x._)([(0,Q.Cb)({json:{write:!0}})],ce.prototype,"domains",void 0),(0,x._)([(0,W.r)("domains")],ce.prototype,"readDomains",null),(0,x._)([(0,Z.c)("domains")],ce.prototype,"writeDomains",null),(0,x._)([(0,Q.Cb)({type:[ue.Z],json:{write:!0}})],ce.prototype,"templates",void 0),ce=(0,x._)([(0,B.j)("esri.layers.support.FeatureType")],ce);const oe=ce},74711:(dt,Re,T)=>{"use strict";T.d(Re,{W:()=>B});var x=T(15861),A=T(24263),G=T(84792),Q=T(62208),H=T(10699),re=T(32258),J=T(84687),W=T(55463);class B{constructor(ie,ue,ce,oe){this.parsedUrl=ie,this.portalItem=ue,this.apiKey=ce,this.signal=oe,this.rootDocument=null;const le=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);le&&(this.urlParts={root:le[1],layerId:parseInt(le[2],10)})}fetch(){var ie=this;return(0,x.Z)(function*(){var oe;if(!ie.urlParts)return null;const ue=null!=(oe=ie.portalItem)?oe:yield ie._portalItemFromServiceItemId();if((0,Q.Wi)(ue))return ie._loadFromUrl();const ce=yield ie._findAndLoadRelatedPortalItem(ue);return(0,Q.Wi)(ce)?null:ie._loadFeatureLayerFromPortalItem(ce)})()}fetchPortalItem(){var ie=this;return(0,x.Z)(function*(){var ce;if(!ie.urlParts)return null;const ue=null!=(ce=ie.portalItem)?ce:yield ie._portalItemFromServiceItemId();return(0,Q.Wi)(ue)?null:ie._findAndLoadRelatedPortalItem(ue)})()}_fetchRootDocument(){var ie=this;return(0,x.Z)(function*(){if((0,Q.pC)(ie.rootDocument))return ie.rootDocument;if((0,Q.Wi)(ie.urlParts))return ie.rootDocument={},{};const ue={query:{f:"json",token:ie.apiKey},responseType:"json",signal:ie.signal},ce=`${ie.urlParts.root}/SceneServer`;try{const oe=yield(0,G.default)(ce,ue);ie.rootDocument=oe.data}catch(oe){ie.rootDocument={}}return ie.rootDocument})()}_fetchServiceOwningPortalUrl(){var ie=this;return(0,x.Z)(function*(){const ue=A.id.findServerInfo(ie.parsedUrl.path);if(null==ue?void 0:ue.owningSystemUrl)return ue.owningSystemUrl;const ce=ie.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const oe=(yield(0,G.default)(ce,{query:{f:"json"},responseType:"json",signal:ie.signal})).data.owningSystemUrl;if(oe)return oe}catch(oe){(0,H.r9)(oe)}return null})()}_findAndLoadRelatedPortalItem(ie){var ue=this;return(0,x.Z)(function*(){try{return(yield ie.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:ue.signal})).find(ce=>"Feature Service"===ce.type)||null}catch(ce){return(0,H.r9)(ce),null}})()}_loadFeatureLayerFromPortalItem(ie){var ue=this;return(0,x.Z)(function*(){yield ie.load({signal:ue.signal});const ce=yield ue._findMatchingAssociatedSublayerUrl(ie.url);return new re.default({url:ce,portalItem:ie}).load({signal:ue.signal})})()}_loadFromUrl(){var ie=this;return(0,x.Z)(function*(){const ue=yield ie._findMatchingAssociatedSublayerUrl(`${ie.urlParts.root}/FeatureServer`);return new re.default({url:ue}).load({signal:ie.signal})})()}_findMatchingAssociatedSublayerUrl(ie){var ue=this;return(0,x.Z)(function*(){const ce=ie.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),oe={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:ue.signal},le=ue.urlParts.layerId,Y=ue._fetchRootDocument(),j=(0,G.default)(ce,oe),[X,U]=yield Promise.all([j,Y]),ee=U&&U.layers,$=X.data&&X.data.layers;if(!Array.isArray($))throw new Error("expected layers array");if(Array.isArray(ee)){for(let ne=0;ne<Math.min(ee.length,$.length);ne++)if(ee[ne].id===le)return`${ce}/${$[ne].id}`}else if(le<$.length)return`${ce}/${$[le].id}`;throw new Error("could not find matching associated sublayer")})()}_portalItemFromServiceItemId(){var ie=this;return(0,x.Z)(function*(){const ue=(yield ie._fetchRootDocument()).serviceItemId;if(!ue)return null;const ce=new W.default({id:ue,apiKey:ie.apiKey}),oe=yield ie._fetchServiceOwningPortalUrl();(0,Q.pC)(oe)&&(ce.portal=new J.Z({url:oe}));try{return ce.load({signal:ie.signal})}catch(le){return(0,H.r9)(le),null}})()}}},36255:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Y});var ce,x=T(17626),A=T(2076),G=T(86810),Q=T(77712),J=(T(85931),T(8314),T(90912)),W=T(55342),B=T(68653),Z=T(76898),ie=T(67945),ue=T(85);const oe=new A.X({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let le=ce=class extends G.wq{constructor(j){super(j),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null}readDescription(j,{description:X}){let U;try{U=JSON.parse(X)}catch(ee){}return U?U.value:null}readValueType(j,{description:X}){let U;try{U=JSON.parse(X)}catch(ee){}return U?oe.fromJSON(U.fieldValueType):null}clone(){return new ce({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType})}};(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],le.prototype,"alias",void 0),(0,x._)([(0,Q.Cb)({type:[String,Number],json:{write:{allowNull:!0}}})],le.prototype,"defaultValue",void 0),(0,x._)([(0,Q.Cb)()],le.prototype,"description",void 0),(0,x._)([(0,B.r)("description")],le.prototype,"readDescription",null),(0,x._)([(0,Q.Cb)({types:ie.V5,json:{read:{reader:ie.im},write:!0}})],le.prototype,"domain",void 0),(0,x._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"editable",void 0),(0,x._)([(0,Q.Cb)({type:J.z8,json:{write:!0}})],le.prototype,"length",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],le.prototype,"name",void 0),(0,x._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"nullable",void 0),(0,x._)([(0,W.J)(ue.v)],le.prototype,"type",void 0),(0,x._)([(0,Q.Cb)()],le.prototype,"valueType",void 0),(0,x._)([(0,B.r)("valueType",["description"])],le.prototype,"readValueType",null),le=ce=(0,x._)([(0,Z.j)("esri.layers.support.Field")],le);const Y=le},60466:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>H});var x=T(36630);function G(J){return"oid"===J.type||"esriFieldTypeOID"===J.type}function Q(J){return"global-id"===J.type||"esriFieldTypeGlobalID"===J.type}class H{constructor(W){if(this.fields=W,this._fieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!W)return;const B=[];for(const Z of W){const ie=Z&&Z.name;if(ie){const ue=re(ie);this._fieldsMap.set(ie,Z),this._fieldsMap.set(ue,Z),B.push(ue),"date"===(J=Z).type||"esriFieldTypeDate"===J.type?(this.dateFields.push(Z),this._dateFieldsSet.add(Z)):(0,x.H7)(Z)&&(this._numericFieldsSet.add(Z),this.numericFields.push(Z)),G(Z)||Q(Z)||(Z.editable=null==Z.editable||!!Z.editable,Z.nullable=null==Z.nullable||!!Z.nullable)}}var J;B.sort(),this.uid=B.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const W of this.fields)G(W)||Q(W)||W.nullable||void 0!==(0,x.os)(W)||this._requiredFields.push(W)}return this._requiredFields}has(W){return null!=this.get(W)}get(W){return null!=W?this._fieldsMap.get(W)||this._fieldsMap.get(re(W)):void 0}isDateField(W){return this._dateFieldsSet.has(this.get(W))}isNumericField(W){return this._numericFieldsSet.has(this.get(W))}normalizeFieldName(W){const B=this.get(W);if(B)return B.name}}function re(J){return J.toLowerCase().trim()}},60595:(dt,Re,T)=>{"use strict";T.d(Re,{T:()=>H});var x=T(15861),A=T(84792),G=T(26584),Q=T(62208);function H(J,W,B,Z,ie,ue){return re.apply(this,arguments)}function re(){return(re=(0,x.Z)(function*(J,W,B,Z,ie,ue){let ce=null;if((0,Q.pC)(B)){const Y=`${J}/nodepages/`,j=Y+Math.floor(B.rootIndex/B.nodesPerPage);try{return{type:"page",rootPage:(yield(0,A.default)(j,{query:{f:"json",token:Z},responseType:"json",signal:ue})).data,rootIndex:B.rootIndex,pageSize:B.nodesPerPage,lodMetric:B.lodSelectionMetricType,urlPrefix:Y}}catch(X){(0,Q.pC)(ie)&&ie.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",j,X),ce=X}}if(!W)return null;const oe=`${J}/nodes/`,le=oe+(W&&W.split("/").pop());try{return{type:"node",rootNode:(yield(0,A.default)(le,{query:{f:"json",token:Z},responseType:"json",signal:ue})).data,urlPrefix:oe}}catch(Y){throw new G.Z("sceneservice:root-node-missing","Root node missing.",{pageError:ce,nodeError:Y,url:le})}})).apply(this,arguments)}},35031:(dt,Re,T)=>{"use strict";T.d(Re,{H3:()=>X,QI:()=>ue,U4:()=>B,Yh:()=>oe});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(55342)),W=T(76898);let B=class extends A.wq{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};(0,x._)([(0,G.Cb)({type:Number})],B.prototype,"nodesPerPage",void 0),(0,x._)([(0,G.Cb)({type:Number})],B.prototype,"rootIndex",void 0),(0,x._)([(0,G.Cb)({type:String})],B.prototype,"lodSelectionMetricType",void 0),B=(0,x._)([(0,W.j)("esri.layer.support.I3SNodePageDefinition")],B);let Z=class extends A.wq{constructor(){super(...arguments),this.factor=1}};(0,x._)([(0,G.Cb)({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],Z.prototype,"id",void 0),(0,x._)([(0,G.Cb)({type:Number})],Z.prototype,"factor",void 0),Z=(0,x._)([(0,W.j)("esri.layer.support.I3SMaterialTexture")],Z);let ie=class extends A.wq{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};(0,x._)([(0,G.Cb)({type:[Number]})],ie.prototype,"baseColorFactor",void 0),(0,x._)([(0,G.Cb)({type:Z})],ie.prototype,"baseColorTexture",void 0),(0,x._)([(0,G.Cb)({type:Z})],ie.prototype,"metallicRoughnessTexture",void 0),(0,x._)([(0,G.Cb)({type:Number})],ie.prototype,"metallicFactor",void 0),(0,x._)([(0,G.Cb)({type:Number})],ie.prototype,"roughnessFactor",void 0),ie=(0,x._)([(0,W.j)("esri.layer.support.I3SMaterialPBRMetallicRoughness")],ie);let ue=class extends A.wq{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};(0,x._)([(0,J.J)({opaque:"opaque",mask:"mask",blend:"blend"})],ue.prototype,"alphaMode",void 0),(0,x._)([(0,G.Cb)({type:Number})],ue.prototype,"alphaCutoff",void 0),(0,x._)([(0,G.Cb)({type:Boolean})],ue.prototype,"doubleSided",void 0),(0,x._)([(0,J.J)({none:"none",back:"back",front:"front"})],ue.prototype,"cullFace",void 0),(0,x._)([(0,G.Cb)({type:Z})],ue.prototype,"normalTexture",void 0),(0,x._)([(0,G.Cb)({type:Z})],ue.prototype,"occlusionTexture",void 0),(0,x._)([(0,G.Cb)({type:Z})],ue.prototype,"emissiveTexture",void 0),(0,x._)([(0,G.Cb)({type:[Number]})],ue.prototype,"emissiveFactor",void 0),(0,x._)([(0,G.Cb)({type:ie})],ue.prototype,"pbrMetallicRoughness",void 0),ue=(0,x._)([(0,W.j)("esri.layer.support.I3SMaterialDefinition")],ue);let ce=class extends A.wq{};(0,x._)([(0,G.Cb)({type:String,json:{read:{source:["name","index"],reader:(U,ee)=>null!=U?U:`${ee.index}`}}})],ce.prototype,"name",void 0),(0,x._)([(0,J.J)({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],ce.prototype,"format",void 0),ce=(0,x._)([(0,W.j)("esri.layer.support.I3STextureFormat")],ce);let oe=class extends A.wq{constructor(){super(...arguments),this.atlas=!1}};(0,x._)([(0,G.Cb)({type:[ce]})],oe.prototype,"formats",void 0),(0,x._)([(0,G.Cb)({type:Boolean})],oe.prototype,"atlas",void 0),oe=(0,x._)([(0,W.j)("esri.layer.support.I3STextureSetDefinition")],oe);let le=class extends A.wq{};(0,x._)([(0,J.J)({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],le.prototype,"type",void 0),(0,x._)([(0,G.Cb)({type:Number})],le.prototype,"component",void 0),le=(0,x._)([(0,W.j)("esri.layer.support.I3SGeometryAttribute")],le);let Y=class extends A.wq{};(0,x._)([(0,J.J)({draco:"draco"})],Y.prototype,"encoding",void 0),(0,x._)([(0,G.Cb)({type:[String]})],Y.prototype,"attributes",void 0),Y=(0,x._)([(0,W.j)("esri.layer.support.I3SGeometryCompressedAttributes")],Y);let j=class extends A.wq{constructor(){super(...arguments),this.offset=0}};(0,x._)([(0,G.Cb)({type:Number})],j.prototype,"offset",void 0),(0,x._)([(0,G.Cb)({type:le})],j.prototype,"position",void 0),(0,x._)([(0,G.Cb)({type:le})],j.prototype,"normal",void 0),(0,x._)([(0,G.Cb)({type:le})],j.prototype,"uv0",void 0),(0,x._)([(0,G.Cb)({type:le})],j.prototype,"color",void 0),(0,x._)([(0,G.Cb)({type:le})],j.prototype,"uvRegion",void 0),(0,x._)([(0,G.Cb)({type:le})],j.prototype,"featureId",void 0),(0,x._)([(0,G.Cb)({type:le})],j.prototype,"faceRange",void 0),(0,x._)([(0,G.Cb)({type:Y})],j.prototype,"compressedAttributes",void 0),j=(0,x._)([(0,W.j)("esri.layer.support.I3SGeometryBuffer")],j);let X=class extends A.wq{};(0,x._)([(0,J.J)({triangle:"triangle"})],X.prototype,"topology",void 0),(0,x._)([(0,G.Cb)()],X.prototype,"geometryBuffers",void 0),X=(0,x._)([(0,W.j)("esri.layer.support.I3SGeometryDefinition")],X)},90336:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var Z,x=T(17626),J=(T(63290),T(90912),T(85931),T(8314),T(82255),T(55342)),W=T(76898),B=T(50028);let ie=Z=class extends B.Z{constructor(ce){super(ce),this.type="inherited"}clone(){return new Z}};(0,x._)([(0,J.J)({inherited:"inherited"})],ie.prototype,"type",void 0),ie=Z=(0,x._)([(0,W.j)("esri.layers.support.InheritedDomain")],ie);const ue=ie},72258:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(86810),G=T(77712),re=(T(85931),T(8314),T(90912)),J=T(76898);let B=W=class extends A.wq{constructor(ie){super(ie),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new W({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};(0,x._)([(0,G.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],B.prototype,"cols",void 0),(0,x._)([(0,G.Cb)({type:re.z8,json:{write:!0}})],B.prototype,"level",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"levelValue",void 0),(0,x._)([(0,G.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],B.prototype,"origin",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],B.prototype,"resolution",void 0),(0,x._)([(0,G.Cb)({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],B.prototype,"rows",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],B.prototype,"scale",void 0),B=W=(0,x._)([(0,J.j)("esri.layers.support.LOD")],B);const Z=B},170:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>pe});var le,x=T(17626),A=T(20383),G=T(2076),Q=T(86810),H=T(58817),re=T(23841),J=T(77712),B=(T(90912),T(68653)),Z=T(76898),ie=T(99433),oe=(T(85931),T(8314),T(86793));let Y=le=class extends Q.wq{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(he,ge){return ge.value?(0,oe.dI)(ge.value):he}writeExpression(he,ge,ye){null!=this.value&&(he=(0,oe.dI)(this.value)),null!=he&&(ge[ye]=he)}clone(){return new le({expression:this.expression,title:this.title,value:this.value})}};(0,x._)([(0,J.Cb)({type:String,json:{write:{writerEnsuresNonNull:!0}}})],Y.prototype,"expression",void 0),(0,x._)([(0,B.r)("expression",["expression","value"])],Y.prototype,"readExpression",null),(0,x._)([(0,ie.c)("expression")],Y.prototype,"writeExpression",null),(0,x._)([(0,J.Cb)({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Y.prototype,"title",void 0),(0,x._)([(0,J.Cb)({json:{read:!1,write:!1}})],Y.prototype,"value",void 0),Y=le=(0,x._)([(0,Z.j)("esri.layers.support.LabelExpressionInfo")],Y);const j=Y;var ee,X=T(8080),U=T(9461);const $=new G.X({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function ne(he){var ge;return!he||"service"!==he.origin&&"map-image"!==(null==(ge=he.layer)?void 0:ge.type)}function ae(he){var ge,ye;return!!function se(he){return"map-image"===(null==he?void 0:he.type)}(he)&&!!(null==(ye=null==(ge=he.capabilities)?void 0:ge.exportMap)?void 0:ye.supportsArcadeExpressionForLabeling)}let _e=ee=class extends Q.wq{constructor(he){super(he),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=X.Rz,this.useCodedValues=void 0,this.where=null}static evaluateWhere(he,ge){const ye=(Me,Ee,Te)=>{switch(Ee){case"=":return Me==Te;case"<>":return Me!=Te;case">":return Me>Te;case">=":return Me>=Te;case"<":return Me<Te;case"<=":return Me<=Te}return!1};try{if(null==he)return!0;const Me=he.split(" ");if(3===Me.length)return ye(ge[Me[0]],Me[1],Me[2]);if(7===Me.length){const Ee=ye(ge[Me[0]],Me[1],Me[2]),Te=Me[3],me=ye(ge[Me[4]],Me[5],Me[6]);switch(Te){case"AND":return Ee&&me;case"OR":return Ee||me}}return!1}catch(Me){console.log("Error.: can't parse = "+he)}}readLabelExpression(he,ge){const ye=ge.labelExpressionInfo;if(!ye||!ye.value&&!ye.expression)return he}writeLabelExpression(he,ge,ye){if(this.labelExpressionInfo)if(null!=this.labelExpressionInfo.value)he=(0,oe.z7)(this.labelExpressionInfo.value);else if(null!=this.labelExpressionInfo.expression){const Me=(0,oe.el)(this.labelExpressionInfo.expression);Me&&(he="["+Me+"]")}null!=he&&(ge[ye]=he)}writeLabelExpressionInfo(he,ge,ye,Me){if(null==he&&null!=this.labelExpression&&ne(Me))he=new j({expression:this.getLabelExpressionArcade()});else if(!he)return;const Ee=he.toJSON(Me);Ee.expression&&(ge[ye]=Ee)}writeMaxScale(he,ge){(he||this.minScale)&&(ge.maxScale=he)}writeMinScale(he,ge){(he||this.maxScale)&&(ge.minScale=he)}getLabelExpression(){return(0,oe.hV)(this)}getLabelExpressionArcade(){return(0,oe.YI)(this)}getLabelExpressionSingleField(){return(0,oe.UO)(this)}hash(){return JSON.stringify(this)}clone(){return new ee({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:(0,H.d9)(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:(0,H.d9)(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};(0,x._)([(0,J.Cb)({type:String,json:{write:!0}})],_e.prototype,"name",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],_e.prototype,"allowOverrun",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1}}}})],_e.prototype,"deconflictionStrategy",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:{overridePolicy(he,ge,ye){return this.labelExpressionInfo&&"service"===(null==ye?void 0:ye.origin)&&ae(ye.layer)?{enabled:!1}:{allowNull:!0}}}}})],_e.prototype,"labelExpression",void 0),(0,x._)([(0,B.r)("labelExpression")],_e.prototype,"readLabelExpression",null),(0,x._)([(0,ie.c)("labelExpression")],_e.prototype,"writeLabelExpression",null),(0,x._)([(0,J.Cb)({type:j,json:{write:{overridePolicy:(he,ge,ye)=>function de(he){return ne(he)||ae(he.layer)}(ye)?{allowNull:!0}:{enabled:!1}}}})],_e.prototype,"labelExpressionInfo",void 0),(0,x._)([(0,ie.c)("labelExpressionInfo")],_e.prototype,"writeLabelExpressionInfo",null),(0,x._)([(0,J.Cb)({type:$.apiValues,json:{type:$.jsonValues,read:$.read,write:$.write}})],_e.prototype,"labelPlacement",void 0),(0,x._)([(0,J.Cb)({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],_e.prototype,"labelPosition",void 0),(0,x._)([(0,J.Cb)({type:Number})],_e.prototype,"maxScale",void 0),(0,x._)([(0,ie.c)("maxScale")],_e.prototype,"writeMaxScale",null),(0,x._)([(0,J.Cb)({type:Number})],_e.prototype,"minScale",void 0),(0,x._)([(0,ie.c)("minScale")],_e.prototype,"writeMinScale",null),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:!1}}}})],_e.prototype,"repeatLabel",void 0),(0,x._)([(0,J.Cb)({type:Number,cast:re.t_,json:{write:!0,origins:{"web-scene":{write:!1}}}})],_e.prototype,"repeatLabelDistance",void 0),(0,x._)([(0,J.Cb)({types:A.yK,json:{origins:{"web-scene":{types:A.S6,write:U.vX,default:null}},write:U.vX,default:null}})],_e.prototype,"symbol",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],_e.prototype,"useCodedValues",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:!0}})],_e.prototype,"where",void 0),_e=ee=(0,x._)([(0,Z.j)("esri.layers.support.LabelClass")],_e);const pe=_e},2430:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(46160),G=T(86810),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898));let Z=B=class extends G.wq{constructor(ue){super(ue),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new A.Z}clone(){return new B({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],Z.prototype,"floorField",void 0),(0,x._)([(0,Q.Cb)({json:{read:!1,write:!1}})],Z.prototype,"viewAllMode",void 0),(0,x._)([(0,Q.Cb)({json:{read:!1,write:!1}})],Z.prototype,"viewAllLevelIds",void 0),Z=B=(0,x._)([(0,W.j)("esri.layers.support.LayerFloorInfo")],Z);const ie=Z},36596:(dt,Re,T)=>{"use strict";T.d(Re,{w:()=>H});var x=T(62208),A=T(42930);class G extends A.q{constructor(J=null){super("LercWorker","_decode",{_decode:W=>[W.buffer]},J,{strategy:"dedicated"}),this.schedule=J,this.ref=0}decode(J,W,B){return J&&0!==J.byteLength?this.invoke({buffer:J,options:W},B):Promise.resolve(null)}release(){--this.ref<=0&&(Q.forEach((J,W)=>{J===this&&Q.delete(W)}),this.destroy())}}const Q=new Map;function H(re=null){let J=Q.get((0,x.Wg)(re));return J||((0,x.pC)(re)?(J=new G(W=>re.schedule(W)),Q.set(re,J)):(J=new G,Q.set(null,J))),++J.ref,J}},41291:(dt,Re,T)=>{"use strict";T.d(Re,{b:()=>B});var x=T(17626),A=T(14517),G=T(10699),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898));let B=class extends A.Z{constructor(){super(...arguments),this._tasks=new Array,this.running=!1}get length(){return this._tasks.length}destroy(){this.cancelAll()}runTask(ie){for(;!ie.done&&this._process(ie);)ie.madeProgress()}push(ie,ue,ce){return this.running=!0,new Promise((oe,le)=>this._tasks.push(new Z(oe,le,ie,ue,ce)))}unshift(ie,ue,ce){return this.running=!0,new Promise((oe,le)=>this._tasks.unshift(new Z(oe,le,ie,ue,ce)))}_process(ie){if(0===this._tasks.length)return!1;const ue=this._tasks.shift();try{const ce=(0,G.Hc)(ue.signal);if(ce&&!ue.abortCallback)ue.reject((0,G.zE)());else{const oe=ce?ue.abortCallback((0,G.zE)()):ue.callback(ie);(0,G.y8)(oe)?oe.then(ue.resolve,ue.reject):ue.resolve(oe)}}catch(ce){ue.reject(ce)}return this.running=this._tasks.length>0,!0}cancelAll(){const ie=(0,G.zE)();for(const ue of this._tasks)if(ue.abortCallback){const ce=ue.abortCallback(ie);ue.resolve(ce)}else ue.reject(ie);this._tasks.length=0,this.running=!1}};(0,x._)([(0,Q.Cb)()],B.prototype,"running",void 0),B=(0,x._)([(0,W.j)("esri.layers.support.PromiseQueue")],B);class Z{constructor(ue,ce,oe,le,Y){this.resolve=ue,this.reject=ce,this.callback=oe,this.signal=le,this.abortCallback=Y}}},68155:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(55342)),J=T(76898),W=T(50028);let Z=B=class extends W.Z{constructor(ue){super(ue),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new B({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};(0,x._)([(0,A.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:(ue,ce)=>ce.range&&ce.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:null!=this.maxValue&&null==this.minValue}},target:"range",writer(ue,ce,oe){ce[oe]=[this.minValue||0,ue]}}}})],Z.prototype,"maxValue",void 0),(0,x._)([(0,A.Cb)({type:Number,json:{type:[Number],read:{source:"range",reader:(ue,ce)=>ce.range&&ce.range[0]},write:{target:"range",writer(ue,ce,oe){ce[oe]=[ue,this.maxValue||0]}}}})],Z.prototype,"minValue",void 0),(0,x._)([(0,re.J)({range:"range"})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,J.j)("esri.layers.support.RangeDomain")],Z);const ie=Z},2584:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ne});var U,x=T(17626),A=T(2076),G=T(86810),Q=T(62208),H=T(16730),re=T(77712),B=(T(85931),T(8314),T(90912)),Z=T(68653),ie=T(76898),ue=T(99433),ce=T(49672),oe=T(65234),le=T(65401),Y=T(37053),j=T(46367),X=T(72258);const ee=new A.X({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let $=U=class extends G.wq{constructor(se){super(se),this.dpi=96,this.format=null,this.origin=null,this.minScale=0,this.maxScale=0,this.size=null,this.spatialReference=null}static create(se={}){const{resolutionFactor:ae=1,scales:de,size:_e=256,spatialReference:pe=oe.Z.WebMercator,numLODs:he=24}=se;if(!(0,Y.JY)(pe)){const me=[];if(de)for(let Ce=0;Ce<de.length;Ce++){const Ie=de[Ce];me.push({level:Ce,scale:Ie,resolution:Ie})}else{let Ce=5e-4;for(let Ie=he-1;Ie>=0;Ie--)me.unshift({level:Ie,scale:Ce,resolution:Ce}),Ce*=2}return new U({dpi:96,lods:me,origin:new ce.Z(0,0,pe),size:[_e,_e],spatialReference:pe})}const ge=(0,Y.C5)(pe),ye=new ce.Z(se.origin?{x:se.origin.x,y:se.origin.y,spatialReference:pe}:ge?{x:ge.origin[0],y:ge.origin[1],spatialReference:pe}:{x:0,y:0,spatialReference:pe}),Ee=1/(39.37*(0,H.c9)(pe)*96),Te=[];if(de)for(let me=0;me<de.length;me++){const Ce=de[me];Te.push({level:me,scale:Ce,resolution:Ce*Ee})}else{let me=(0,Y.sT)(pe)?512/_e*591657527.5917094:256/_e*591657527.591555;const Ce=Math.ceil(he/ae);Te.push({level:0,scale:me,resolution:me*Ee});for(let Ie=1;Ie<Ce;Ie++){const Ge=me/2**ae;Te.push({level:Ie,scale:Ge,resolution:Ge*Ee}),me=Ge}}return new U({dpi:96,lods:Te,origin:ye,size:[_e,_e],spatialReference:pe})}get isWrappable(){const{spatialReference:se,origin:ae}=this;if(se&&ae){const de=(0,Y.C5)(se);return se.isWrappable&&Math.abs(de.origin[0]-ae.x)<=de.dx}return!1}readOrigin(se,ae){return ce.Z.fromJSON(or({spatialReference:ae.spatialReference},se))}set lods(se){let ae=0,de=0;const _e=[];this._levelToLOD={},se&&(ae=-1/0,de=1/0,se.forEach(pe=>{_e.push(pe.scale),ae=pe.scale>ae?pe.scale:ae,de=pe.scale<de?pe.scale:de,this._levelToLOD[pe.level]=pe})),this._set("scales",_e),this._set("minScale",ae),this._set("maxScale",de),this._set("lods",se),this._initializeUpsampleLevels()}readSize(se,ae){return[ae.cols,ae.rows]}writeSize(se,ae){ae.cols=se[0],ae.rows=se[1]}zoomToScale(se){const ae=this.scales;if(se<=0)return ae[0];if(se>=ae.length-1)return ae[ae.length-1];{const de=Math.floor(se);return ae[de]/(ae[de]/ae[de+1])**(se-de)}}scaleToZoom(se){const ae=this.scales,de=ae.length-1;let _e=0;for(;_e<de;_e++){const pe=ae[_e],he=ae[_e+1];if(pe<=se)return _e;if(he===se)return _e+1;if(pe>se&&he<se)return _e+Math.log(pe/se)/Math.log(pe/he)}return _e}snapScale(se,ae=.95){const de=this.scaleToZoom(se);return de%Math.floor(de)>=ae?this.zoomToScale(Math.ceil(de)):this.zoomToScale(Math.floor(de))}tileAt(se,ae,de,_e){const pe=this.lodAt(se);if(!pe)return null;let he,ge;if("number"==typeof ae)he=ae,ge=de;else if((0,Y.fS)(ae.spatialReference,this.spatialReference))he=ae.x,ge=ae.y,_e=de;else{const Ee=(0,j.iV)(ae,this.spatialReference);if((0,Q.Wi)(Ee))return null;he=Ee.x,ge=Ee.y,_e=de}const ye=pe.resolution*this.size[0],Me=pe.resolution*this.size[1];return _e||(_e={id:null,level:0,row:0,col:0,extent:(0,le.Ue)()}),_e.level=se,_e.row=Math.floor((this.origin.y-ge)/Me+.001),_e.col=Math.floor((he-this.origin.x)/ye+.001),this.updateTileInfo(_e),_e}updateTileInfo(se,ae=U.ExtrapolateOptions.NONE){let de=this.lodAt(se.level);if(!de&&ae===U.ExtrapolateOptions.POWER_OF_TWO){const ge=this.lods[this.lods.length-1];ge.level<se.level&&(de=ge)}if(!de)return;const _e=se.level-de.level,pe=de.resolution*this.size[0]/2**_e,he=de.resolution*this.size[1]/2**_e;se.id=`${se.level}/${se.row}/${se.col}`,se.extent||(se.extent=(0,le.Ue)()),se.extent[0]=this.origin.x+se.col*pe,se.extent[1]=this.origin.y-(se.row+1)*he,se.extent[2]=se.extent[0]+pe,se.extent[3]=se.extent[1]+he}upsampleTile(se){const ae=this._upsampleLevels[se.level];return!(!ae||-1===ae.parentLevel||(se.level=ae.parentLevel,se.row=Math.floor(se.row/ae.factor+.001),se.col=Math.floor(se.col/ae.factor+.001),this.updateTileInfo(se),0))}getTileBounds(se,ae){const{resolution:de}=this.lodAt(ae.level),_e=de*this.size[0],pe=de*this.size[1];return se[0]=this.origin.x+ae.col*_e,se[1]=this.origin.y-(ae.row+1)*pe,se[2]=se[0]+_e,se[3]=se[1]+pe,se}lodAt(se){return this._levelToLOD&&this._levelToLOD[se]||null}clone(){return U.fromJSON(this.write({}))}getOrCreateCompatible(se,ae){if(256===this.size[0]&&256===this.size[1])return 256===se?this:null;const de=[],_e=this.lods.length;for(let pe=0;pe<_e;pe++){const he=this.lods[pe];de.push(new X.Z({level:he.level,scale:he.scale,resolution:he.resolution*ae}))}return new U({size:[se,se],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:de})}_initializeUpsampleLevels(){const se=this.lods;this._upsampleLevels=[];let ae=null;for(let de=0;de<se.length;de++){const _e=se[de];this._upsampleLevels[_e.level]={parentLevel:ae?ae.level:-1,factor:ae?ae.resolution/_e.resolution:0},ae=_e}}};var se,ae;(0,x._)([(0,re.Cb)({type:Number,json:{write:!0}})],$.prototype,"compressionQuality",void 0),(0,x._)([(0,re.Cb)({type:Number,json:{write:!0}})],$.prototype,"dpi",void 0),(0,x._)([(0,re.Cb)({type:String,json:{read:ee.read,write:ee.write,origins:{"web-scene":{read:!1,write:!1}}}})],$.prototype,"format",void 0),(0,x._)([(0,re.Cb)({readOnly:!0})],$.prototype,"isWrappable",null),(0,x._)([(0,re.Cb)({type:ce.Z,json:{write:!0}})],$.prototype,"origin",void 0),(0,x._)([(0,Z.r)("origin")],$.prototype,"readOrigin",null),(0,x._)([(0,re.Cb)({type:[X.Z],value:null,json:{write:!0}})],$.prototype,"lods",null),(0,x._)([(0,re.Cb)({readOnly:!0})],$.prototype,"minScale",void 0),(0,x._)([(0,re.Cb)({readOnly:!0})],$.prototype,"maxScale",void 0),(0,x._)([(0,re.Cb)({readOnly:!0})],$.prototype,"scales",void 0),(0,x._)([(0,re.Cb)({cast:se=>Array.isArray(se)?se:"number"==typeof se?[se,se]:[256,256]})],$.prototype,"size",void 0),(0,x._)([(0,Z.r)("size",["rows","cols"])],$.prototype,"readSize",null),(0,x._)([(0,ue.c)("size",{cols:{type:B.z8},rows:{type:B.z8}})],$.prototype,"writeSize",null),(0,x._)([(0,re.Cb)({type:oe.Z,json:{write:!0}})],$.prototype,"spatialReference",void 0),$=U=(0,x._)([(0,ie.j)("esri.layers.support.TileInfo")],$),(ae=(se=$||($={})).ExtrapolateOptions||(se.ExtrapolateOptions={}))[ae.NONE=0]="NONE",ae[ae.POWER_OF_TWO=1]="POWER_OF_TWO";const ne=$},62708:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ee});var oe,x=T(17626),A=T(97478),G=T(20849),Q=T(86810),H=T(58817),re=T(62208),J=T(77712),B=(T(90912),T(68653)),Z=T(76898),ie=T(99433);T(85931),T(8314);let le=oe=class extends Q.wq{constructor($){super($),this.respectsDaylightSaving=!1,this.timezone=null}readRespectsDaylightSaving($,ne){return void 0!==ne.respectsDaylightSaving?ne.respectsDaylightSaving:void 0!==ne.respectDaylightSaving&&ne.respectDaylightSaving}clone(){const{respectsDaylightSaving:$,timezone:ne}=this;return new oe({respectsDaylightSaving:$,timezone:ne})}};(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],le.prototype,"respectsDaylightSaving",void 0),(0,x._)([(0,B.r)("respectsDaylightSaving",["respectsDaylightSaving","respectDaylightSaving"])],le.prototype,"readRespectsDaylightSaving",null),(0,x._)([(0,J.Cb)({type:String,json:{read:{source:"timeZone"},write:{target:"timeZone"}}})],le.prototype,"timezone",void 0),le=oe=(0,x._)([(0,Z.j)("esri.layers.support.TimeReference")],le);const Y=le;var X,j=T(58926);let U=X=class extends Q.wq{constructor($){super($),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent($,ne){if(!ne.timeExtent||!Array.isArray(ne.timeExtent)||2!==ne.timeExtent.length)return null;const se=new Date(ne.timeExtent[0]),ae=new Date(ne.timeExtent[1]);return new A.Z({start:se,end:ae})}writeFullTimeExtent($,ne){ne.timeExtent=$&&(0,re.pC)($.start)&&(0,re.pC)($.end)?[$.start.getTime(),$.end.getTime()]:null}readInterval($,ne){return ne.timeInterval&&ne.timeIntervalUnits?new G.Z({value:ne.timeInterval,unit:j.v.fromJSON(ne.timeIntervalUnits)}):ne.defaultTimeInterval&&ne.defaultTimeIntervalUnits?new G.Z({value:ne.defaultTimeInterval,unit:j.v.fromJSON(ne.defaultTimeIntervalUnits)}):null}writeInterval($,ne){if($){const se=$.toJSON();ne.timeInterval=se.value,ne.timeIntervalUnits=se.unit}else ne.timeInterval=null,ne.timeIntervalUnits=null}clone(){const{cumulative:$,endField:ne,hasLiveData:se,interval:ae,startField:de,timeReference:_e,fullTimeExtent:pe,trackIdField:he,useTime:ge}=this;return new X({cumulative:$,endField:ne,hasLiveData:se,interval:ae,startField:de,timeReference:(0,H.d9)(_e),fullTimeExtent:(0,H.d9)(pe),trackIdField:he,useTime:ge})}};(0,x._)([(0,J.Cb)({type:Boolean,json:{read:{source:"exportOptions.timeDataCumulative"},write:{target:"exportOptions.timeDataCumulative"}}})],U.prototype,"cumulative",void 0),(0,x._)([(0,J.Cb)({type:String,json:{read:{source:"endTimeField"},write:{target:"endTimeField",allowNull:!0}}})],U.prototype,"endField",void 0),(0,x._)([(0,J.Cb)({type:A.Z,json:{write:{enabled:!0,allowNull:!0}}})],U.prototype,"fullTimeExtent",void 0),(0,x._)([(0,B.r)("fullTimeExtent",["timeExtent"])],U.prototype,"readFullTimeExtent",null),(0,x._)([(0,ie.c)("fullTimeExtent")],U.prototype,"writeFullTimeExtent",null),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],U.prototype,"hasLiveData",void 0),(0,x._)([(0,J.Cb)({type:G.Z,json:{write:{enabled:!0,allowNull:!0}}})],U.prototype,"interval",void 0),(0,x._)([(0,B.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],U.prototype,"readInterval",null),(0,x._)([(0,ie.c)("interval")],U.prototype,"writeInterval",null),(0,x._)([(0,J.Cb)({type:String,json:{read:{source:"startTimeField"},write:{target:"startTimeField",allowNull:!0}}})],U.prototype,"startField",void 0),(0,x._)([(0,J.Cb)({type:Y,json:{write:{enabled:!0,allowNull:!0}}})],U.prototype,"timeReference",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],U.prototype,"trackIdField",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{read:{source:"exportOptions.useTime"},write:{target:"exportOptions.useTime"}}})],U.prototype,"useTime",void 0),U=X=(0,x._)([(0,Z.j)("esri.layers.support.TimeInfo")],U);const ee=U},38305:(dt,Re,T)=>{"use strict";T.d(Re,{B5:()=>B,DR:()=>ie,G:()=>U,M8:()=>oe,Nm:()=>Y,Qc:()=>Z,XG:()=>j,a7:()=>ce,ld:()=>ue,wH:()=>X});var x=T(62208),A=T(21726),G=T(29840);const Q={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},H=Object.values(Q),re=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${H.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),J=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${H.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),W=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function B(ne){return!!re.test(ne)}function Z(ne){if((0,x.Wi)(ne))return null;const se=(0,A.mN)(ne),ae=se.path.match(re)||se.path.match(J);if(!ae)return null;const[,de,_e,pe,he]=ae,ge=_e.indexOf("/");return{title:ue(-1!==ge?_e.slice(ge+1):_e),serverType:Q[pe.toLowerCase()],sublayer:null!=he&&""!==he?parseInt(he,10):null,url:{path:de}}}function ie(ne){const se=(0,A.mN)(ne).path.match(W);return se?{serviceUrl:se[1],sublayerId:Number(se[2])}:null}function ue(ne){return(ne=ne.replace(/\s*[/_]+\s*/g," "))[0].toUpperCase()+ne.slice(1)}function ce(ne,se){const ae=[];if(ne){const de=Z(ne);(0,x.pC)(de)&&de.title&&ae.push(de.title)}if(se){const de=ue(se);ae.push(de)}if(2===ae.length){if(ae[0].toLowerCase().includes(ae[1].toLowerCase()))return ae[0];if(ae[1].toLowerCase().includes(ae[0].toLowerCase()))return ae[1]}return ae.join(" - ")}function oe(ne){if(!ne)return!1;const pe=(ne=ne.toLowerCase()).includes(".arcgis.com/"),he=ne.includes("//services")||ne.includes("//tiles")||ne.includes("//features");return pe&&he}function Y(ne,se){return ne&&(0,A.Qj)((0,A.Hu)(ne,se))}function j(ne){let{url:se}=ne;if(!se)return{url:se};se=(0,A.Hu)(se,ne.logger);const ae=(0,A.mN)(se),de=Z(ae.path);let _e;if((0,x.pC)(de))null!=de.sublayer&&null==ne.layer.layerId&&(_e=de.sublayer),se=de.url.path;else if(ne.nonStandardUrlAllowed){const pe=ie(ae.path);(0,x.pC)(pe)&&(se=pe.serviceUrl,_e=pe.sublayerId)}return{url:(0,A.Qj)(se),layerId:_e}}function X(ne,se,ae,de,_e){(0,G.w)(se,de,"url",_e),de.url&&null!=ne.layerId&&(de.url=(0,A.v_)(de.url,ae,ne.layerId.toString()))}function U(ne){if(!ne)return!1;const se=ne.toLowerCase(),ae=se.includes("/services/"),de=se.includes("/mapserver/wmsserver"),_e=se.includes("/imageserver/wmsserver"),pe=se.includes("/wmsserver");return ae&&(de||_e||pe)}},59787:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>x});const x={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}}},13812:(dt,Re,T)=>{"use strict";T.d(Re,{qG:()=>ae,PV:()=>ee,id:()=>_e,iR:()=>j,rn:()=>U,rT:()=>ge,u1:()=>he,rO:()=>pe,Oh:()=>ne,bT:()=>se,C_:()=>Y,Lx:()=>$,vg:()=>de,YI:()=>le,HQ:()=>X});var x=T(97478),A=T(2004),G=T(65234),Q=T(29840),H=T(62208),J=(T(10699),T(28170)),ce=T(82706),oe=T(92236);const le={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},Y={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(ye,Me)=>!Me.disablePopup},write:{enabled:!0,writer(ye,Me,Ee){Me[Ee]=!ye}}}},j={type:Boolean,value:!0,json:{name:"showLabels",write:!0}},X={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Q.w}}},U={type:Boolean,value:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},ee={value:null,type:ce.ZP,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function $(ye){return{type:ye,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const ne={type:Number,json:{origins:{"web-document":{write:!0,read:!0},"portal-item":{write:!0}}}},se=yi(or({},ne),{json:yi(or({},ne.json),{origins:{"web-document":yi(or({},ne.json.origins["web-document"]),{write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}})},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(ye,Me,Ee)=>Ee&&"service"!==Ee.origin||!Me.drawingInfo||void 0===Me.drawingInfo.transparency?Me.layerDefinition&&Me.layerDefinition.drawingInfo&&void 0!==Me.layerDefinition.drawingInfo.transparency?(0,oe.b)(Me.layerDefinition.drawingInfo.transparency):void 0:(0,oe.b)(Me.drawingInfo.transparency)}})}),ae={type:x.Z,readOnly:!0,get(){var Ge,Je;if(!(null==(Ge=this.layer)?void 0:Ge.timeInfo))return null;const{datesInUnknownTimezone:ye,timeOffset:Me,useViewTime:Ee}=this.layer,Te=null==(Je=this.view)?void 0:Je.timeExtent;let me=this.layer.timeExtent;ye&&(me=function ue(ye){if(!ye)return ye;const{start:Me,end:Ee}=ye;return new x.Z({start:(0,H.pC)(Me)?(0,J.Nm)(Me,Me.getTimezoneOffset(),"minutes"):Me,end:(0,H.pC)(Ee)?(0,J.Nm)(Ee,Ee.getTimezoneOffset(),"minutes"):Ee})}(me));let Ce=Ee?Te&&me?Te.intersection(me):Te||me:me;if(!Ce||Ce.isEmpty||Ce.isAllTime)return Ce;Me&&(Ce=Ce.offset(-Me.value,Me.unit)),ye&&(Ce=function ie(ye){if(!ye)return ye;const{start:Me,end:Ee}=ye;return new x.Z({start:(0,H.pC)(Me)?(0,J.Nm)(Me,-Me.getTimezoneOffset(),"minutes"):Me,end:(0,H.pC)(Ee)?(0,J.Nm)(Ee,-Ee.getTimezoneOffset(),"minutes"):Ee})}(Ce));const Ie=this._get("timeExtent");return Ce.equals(Ie)?Ie:Ce}},de={type:A.Z,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(ye,Me)=>{const Ee=A.Z.fromJSON(ye);return null!=Me.spatialReference&&"object"==typeof Me.spatialReference&&(Ee.spatialReference=G.Z.fromJSON(Me.spatialReference)),Ee}}}},read:!1}},_e={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},pe={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},he={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},ge={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}}},67945:(dt,Re,T)=>{"use strict";T.d(Re,{V5:()=>re,im:()=>J}),T(8314);var A=T(26036),G=T(50028),Q=T(90336),H=T(68155);const re={key:"type",base:G.Z,typeMap:{range:H.Z,"coded-value":A.Z,inherited:Q.Z}};function J(W){if(!W||!W.type)return null;switch(W.type){case"range":return H.Z.fromJSON(W);case"codedValue":return A.Z.fromJSON(W);case"inherited":return Q.Z.fromJSON(W)}return null}},47717:(dt,Re,T)=>{"use strict";T.d(Re,{d:()=>je});var ne,x=T(83989),A=T(17626),G=T(73281),ce=(T(4832),T(49067),T(96794),T(69747),T(40425),T(69357),T(40342),T(14726),T(33474),T(32088)),oe=T(58817),le=T(77712),j=(T(90912),T(55342)),X=T(76898),U=T(86810);T(85931),T(8314);let se=ne=class extends U.wq{constructor(){super(...arguments),this.statisticType=null,this.onStatisticField=null,this.onStatisticValueExpression=null}clone(){return new ne({statisticType:this.statisticType,onStatisticField:this.onStatisticField,onStatisticValueExpression:this.onStatisticValueExpression})}};(0,A._)([(0,le.Cb)({type:String,json:{write:!0}})],se.prototype,"statisticType",void 0),(0,A._)([(0,le.Cb)({type:String,json:{write:!0}})],se.prototype,"onStatisticField",void 0),(0,A._)([(0,le.Cb)({type:String,json:{write:!0}})],se.prototype,"onStatisticValueExpression",void 0),se=ne=(0,A._)([(0,X.j)("esri.layers.support.OutStatistic")],se);const ae=se;var de;let _e=de=class extends U.wq{constructor(){super(...arguments),this.name=null,this.outStatistic=null}clone(){return new de({name:this.name,outStatistic:this.outStatistic.clone()})}};(0,A._)([(0,le.Cb)({type:String,json:{write:!0}})],_e.prototype,"name",void 0),(0,A._)([(0,le.Cb)({type:ae,json:{write:!0}})],_e.prototype,"outStatistic",void 0),_e=de=(0,A._)([(0,X.j)("esri.layers.support.AggregateField")],_e);const pe=_e;var ye,he=T(13812),ge=T(170);let Me=ye=class extends x.B{constructor(We){super(We),this.type="binning",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}clone(){return new ye({fields:(0,oe.d9)(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:(0,oe.d9)(this.labelingInfo),labelsVisible:this.labelsVisible,popupEnabled:this.popupEnabled,popupTemplate:(0,oe.d9)(this.popupTemplate),renderer:(0,oe.d9)(this.renderer)})}};(0,A._)([(0,j.J)({binning:"binning"})],Me.prototype,"type",void 0),(0,A._)([(0,le.Cb)({type:Number,json:{write:!0}})],Me.prototype,"fixedBinLevel",void 0),(0,A._)([(0,le.Cb)({type:[ge.Z],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Me.prototype,"labelingInfo",void 0),(0,A._)([(0,le.Cb)(he.iR)],Me.prototype,"labelsVisible",void 0),(0,A._)([(0,le.Cb)(he.C_)],Me.prototype,"popupEnabled",void 0),(0,A._)([(0,le.Cb)({type:G.Z,json:{name:"popupInfo",write:!0}})],Me.prototype,"popupTemplate",void 0),(0,A._)([(0,le.Cb)({type:[pe],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Me.prototype,"fields",void 0),(0,A._)([(0,le.Cb)({types:ce.A,json:{write:!0}})],Me.prototype,"renderer",void 0),Me=ye=(0,A._)([(0,X.j)("esri.layers.support.FeatureReductionBinning")],Me);const Ee=Me;var Ce,Te=T(20383),me=T(23841);let Ie=Ce=class extends U.wq{constructor(We){super(We),this.type="cluster",this.clusterRadius=(0,me.t_)("80px"),this.clusterMinSize=(0,me.t_)("12px"),this.clusterMaxSize=(0,me.t_)("50px"),this.popupEnabled=!0,this.popupTemplate=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}clone(){return new Ce({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:(0,oe.d9)(this.labelingInfo),labelsVisible:this.labelsVisible,fields:(0,oe.d9)(this.fields),renderer:(0,oe.d9)(this.renderer),popupEnabled:this.popupEnabled,popupTemplate:(0,oe.d9)(this.popupTemplate)})}};(0,A._)([(0,le.Cb)({type:["cluster"],readOnly:!0,json:{write:!0}})],Ie.prototype,"type",void 0),(0,A._)([(0,le.Cb)({type:Number,cast:We=>"auto"===We?We:(0,me.t_)(We),json:{write:!0}})],Ie.prototype,"clusterRadius",void 0),(0,A._)([(0,le.Cb)({type:Number,cast:me.t_,json:{write:!0}})],Ie.prototype,"clusterMinSize",void 0),(0,A._)([(0,le.Cb)({type:Number,cast:me.t_,json:{write:!0}})],Ie.prototype,"clusterMaxSize",void 0),(0,A._)([(0,le.Cb)(he.C_)],Ie.prototype,"popupEnabled",void 0),(0,A._)([(0,le.Cb)({type:G.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ie.prototype,"popupTemplate",void 0),(0,A._)([(0,le.Cb)({types:ce.A,json:{write:!0}})],Ie.prototype,"renderer",void 0),(0,A._)([(0,le.Cb)({types:Te.AH})],Ie.prototype,"symbol",void 0),(0,A._)([(0,le.Cb)({type:[ge.Z],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ie.prototype,"labelingInfo",void 0),(0,A._)([(0,le.Cb)(he.iR)],Ie.prototype,"labelsVisible",void 0),(0,A._)([(0,le.Cb)({type:[pe],json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],Ie.prototype,"fields",void 0),Ie=Ce=(0,A._)([(0,X.j)("esri.layers.support.FeatureReductionCluster")],Ie);const Ge=Ie;var Je=T(47058);const xe={key:"type",base:x.B,typeMap:{selection:Ge}},je={types:{key:"type",base:x.B,typeMap:{selection:Je.Z,cluster:Ge,binning:Ee}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:xe},"portal-item":{types:xe},"web-scene":{types:{key:"type",base:x.B,typeMap:{selection:Je.Z}}}}}}},55911:(dt,Re,T)=>{"use strict";T.d(Re,{v:()=>re});var x=T(63290),A=T(36255),G=T(60466),Q=T(36630);const H=x.Z.getLogger("esri.layers.support.fieldProperties");function re(){return{fields:{type:[A.Z],value:null},fieldsIndex:{readOnly:!0,get(){return new G.Z(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(J){this._userOutFields=J,this.notifyChange("outFields")},get:function(){const J=this._userOutFields;if(!J||!J.length)return null;if(J.includes("*"))return["*"];if(!this.fields)return J;for(const W of J)this.fieldsIndex.has(W)||H.error("field-attributes-layer:invalid-field",`Invalid field ${W} found in outFields`,{layer:this,outFields:J});return(0,Q.Q0)(this.fieldsIndex,J)}}}}},85:(dt,Re,T)=>{"use strict";T.d(Re,{v:()=>A});const A=new(T(2076).X)({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml"})},36630:(dt,Re,T)=>{"use strict";T.d(Re,{io:()=>$,vl:()=>ye,ZV:()=>me,AB:()=>X,gd:()=>j,Ll:()=>Ie,Mu:()=>De,Qj:()=>Je,R9:()=>fr,Q0:()=>Y,YN:()=>ue,UF:()=>oe,O5:()=>de,CH:()=>Oe,os:()=>qe,H7:()=>zt,Ec:()=>ri,qN:()=>Rt,Gm:()=>Ur,Pz:()=>Mr,Lk:()=>U,Qc:()=>Cr,vP:()=>ir});var H,hr,x=T(15861),A=T(26584),G=T(62208),Q=T(94113);(hr=H||(H={})).VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",hr.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value";var B=T(46679);const Z=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],ie=["field","normalizationField"];function ue(hr,Dr){if(null!=hr&&null!=Dr)for(const Kr of Array.isArray(hr)?hr:[hr])if(ce(Z,Kr,Dr),"visualVariables"in Kr&&Kr.visualVariables)for(const Nt of Kr.visualVariables)ce(ie,Nt,Dr)}function ce(hr,Dr,Kr){if(hr)for(const Nt of hr){const lr=(0,Q.hS)(Nt,Dr),jr=lr&&"function"!=typeof lr&&Kr.get(lr);jr&&(0,Q.RB)(Nt,jr.name,Dr)}}function oe(hr,Dr){if(null!=hr&&(null==Dr?void 0:Dr.fields.length))if("startField"in hr){const Kr=Dr.get(hr.startField),Nt=Dr.get(hr.endField);hr.startField=Kr&&Kr.name||null,hr.endField=Nt&&Nt.name||null}else{const Kr=Dr.get(hr.startTimeField),Nt=Dr.get(hr.endTimeField);hr.startTimeField=Kr&&Kr.name||null,hr.endTimeField=Nt&&Nt.name||null}}const le=new Set;function Y(hr,Dr){return hr&&Dr?(le.clear(),j(le,hr,Dr),Array.from(le).sort()):[]}function j(hr,Dr,Kr){var Nt;if(Kr)if(null==(Nt=null==Dr?void 0:Dr.fields)?void 0:Nt.length)if(Kr.includes("*"))for(const{name:lr}of Dr.fields)hr.add(lr);else for(const lr of Kr)X(hr,Dr,lr);else{if(Kr.includes("*"))return hr.clear(),void hr.add("*");for(const lr of Kr)hr.add(lr)}}function X(hr,Dr,Kr){if("string"==typeof Kr)if(Dr){const Nt=Dr.get(Kr);Nt&&hr.add(Nt.name)}else hr.add(Kr)}function U(hr,Dr){return(0,G.Wi)(Dr)||(0,G.Wi)(hr)?[]:Dr.includes("*")?hr.fields.map(Kr=>Kr.name):Dr}function $(hr,Dr,Kr){return ne.apply(this,arguments)}function ne(){return ne=(0,x.Z)(function*(hr,Dr,Kr){var jr;if(!Kr)return;const{arcadeUtils:Nt}=yield(0,B.LC)(),lr=Nt.extractFieldNames(Kr,null==(jr=null==Dr?void 0:Dr.fields)?void 0:jr.map(Ot=>Ot.name));for(const Ot of lr)X(hr,Dr,Ot)}),ne.apply(this,arguments)}function se(hr,Dr,Kr){return ae.apply(this,arguments)}function ae(){return ae=(0,x.Z)(function*(hr,Dr,Kr){if(Kr&&"1=1"!==Kr){const Nt=(yield Promise.resolve().then(T.bind(T,10410))).WhereClause.create(Kr,Dr);if(!Nt.isStandardized)throw new A.Z("fieldUtils:collectFilterFields","Where clause is not standardized",{where:Kr});j(hr,Dr,Nt.fieldNames)}}),ae.apply(this,arguments)}function de({displayField:hr,fields:Dr}){return hr||(Dr&&Dr.length?pe(Dr,"name-or-title")||pe(Dr,"unique-identifier")||pe(Dr,"type-or-category")||function _e(hr){for(const Dr of hr){if(!Dr||!Dr.name)continue;const Kr=Dr.name.toLowerCase();if(Kr.includes("name")||Kr.includes("title"))return Dr.name}return null}(Dr):null)}function pe(hr,Dr){for(const Kr of hr)if(Kr&&Kr.valueType&&Kr.valueType===Dr)return Kr.name;return null}function ye(hr,Dr){return Me.apply(this,arguments)}function Me(){return Me=(0,x.Z)(function*(hr,Dr){if(!Dr)return;const Kr=(0,Q.hS)("elevationInfo.featureExpressionInfo",Dr);return Kr?Kr.collectRequiredFields(hr,Dr.fieldsIndex):void 0}),Me.apply(this,arguments)}function Ee(hr,Dr,Kr){return Te.apply(this,arguments)}function Te(){return Te=(0,x.Z)(function*(hr,Dr,Kr){Kr.outStatistic.onStatisticValueExpression?$(hr,Dr,Kr.outStatistic.onStatisticValueExpression):hr.add(Kr.outStatistic.onStatisticField)}),Te.apply(this,arguments)}function me(hr,Dr,Kr){return Ce.apply(this,arguments)}function Ce(){return Ce=(0,x.Z)(function*(hr,Dr,Kr){var lr,jr;if(!Dr||!Kr||!("fields"in Kr))return;const Nt=[];if((null==(lr=Kr.popupTemplate)?void 0:lr.expressionInfos)&&Nt.push(...Kr.popupTemplate.expressionInfos.map(Ot=>$(hr,Dr.fieldsIndex,Ot.expression))),Array.isArray(null==(jr=Kr.popupTemplate)?void 0:jr.content)){const Ot=Kr.popupTemplate.content;for(const rr of Ot)"expression"===rr.type&&rr.expressionInfo&&Nt.push($(hr,Dr.fieldsIndex,rr.expressionInfo.expression))}Kr.fields&&Nt.push(...Kr.fields.map(Ot=>Ee(hr,Dr.fieldsIndex,Ot))),yield Promise.all(Nt)}),Ce.apply(this,arguments)}function Ie(hr,Dr,Kr){return Ge.apply(this,arguments)}function Ge(){return Ge=(0,x.Z)(function*(hr,Dr,Kr){Dr&&(Dr.timeInfo&&(0,G.pC)(Kr)&&Kr.timeExtent&&j(hr,Dr.fieldsIndex,[Dr.timeInfo.startField,Dr.timeInfo.endField]),Dr.floorInfo&&j(hr,Dr.fieldsIndex,[Dr.floorInfo.floorField]),(0,G.pC)(Kr)&&(0,G.pC)(Kr.where)&&(yield se(hr,Dr.fieldsIndex,Kr.where)))}),Ge.apply(this,arguments)}function Je(hr,Dr,Kr){return xe.apply(this,arguments)}function xe(){return xe=(0,x.Z)(function*(hr,Dr,Kr){Dr&&Kr&&(yield Promise.all(Kr.map(Nt=>je(hr,Dr,Nt))))}),xe.apply(this,arguments)}function je(hr,Dr,Kr){return We.apply(this,arguments)}function We(){return We=(0,x.Z)(function*(hr,Dr,Kr){Dr&&Kr&&(Kr.valueExpression?yield $(hr,Dr.fieldsIndex,Kr.valueExpression):Kr.field&&X(hr,Dr.fieldsIndex,Kr.field))}),We.apply(this,arguments)}function Oe(hr){if(!hr)return[];const Dr="editFieldsInfo"in hr&&hr.editFieldsInfo;return Dr?Y(hr.fieldsIndex,[Dr&&Dr.creatorField,Dr&&Dr.creationDateField,Dr&&Dr.editorField,Dr&&Dr.editDateField]):[]}function De(hr,Dr){return Fe.apply(this,arguments)}function Fe(){return Fe=(0,x.Z)(function*(hr,Dr){const{labelingInfo:Kr,fieldsIndex:Nt}=Dr;Kr&&Kr.length&&(yield Promise.all(Kr.map(lr=>ve(hr,Nt,lr))))}),Fe.apply(this,arguments)}function ve(hr,Dr,Kr){return Ke.apply(this,arguments)}function Ke(){return Ke=(0,x.Z)(function*(hr,Dr,Kr){if(!Kr)return;const Nt=Kr.getLabelExpression(),lr=Kr.where;if("arcade"===Nt.type)yield $(hr,Dr,Nt.expression);else{const jr=Nt.expression.match(/{[^}]*}/g);jr&&jr.forEach(Ot=>{X(hr,Dr,Ot.slice(1,-1))})}yield se(hr,Dr,lr)}),Ke.apply(this,arguments)}function qe(hr){const Dr=hr.defaultValue;return void 0!==Dr&&at(hr,Dr)?Dr:hr.nullable?null:void 0}function be(hr){return"number"==typeof hr&&!isNaN(hr)&&isFinite(hr)}function tt(hr){return null===hr||be(hr)}const Ye="isInteger"in Number?Number.isInteger:hr=>"number"==typeof hr&&isFinite(hr)&&Math.floor(hr)===hr;function ze(hr){return null===hr||Ye(hr)}function et(hr){return null!=hr&&"string"==typeof hr}function ke(hr){return null===hr||et(hr)}function ot(){return!0}function at(hr,Dr){let Kr;switch(hr.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":Kr=hr.nullable?ze:Ye;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":Kr=hr.nullable?tt:be;break;case"string":case"esriFieldTypeString":Kr=hr.nullable?ke:et;break;default:Kr=ot}return 1===arguments.length?Kr:Kr(Dr)}const wt=new Set(["integer","small-integer","single","double","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]);function zt(hr){return null!=hr&&wt.has(hr.type)}function Rt(hr){return null!=hr&&("string"===hr.type||"esriFieldTypeString"===hr.type)}var St,Xt;function Mr(hr){return null==hr||"number"==typeof hr&&isNaN(hr)?null:hr}function Cr(hr,Dr){return hr.nullable&&null===Dr?null:zt(hr)&&!function Yr(hr,Dr){const Kr="string"==typeof hr?ct(hr):hr;return!!Kr&&(Kr.isInteger?Ye(Dr)&&Dr>=Kr.min&&Dr<=Kr.max:Dr>=Kr.min&&Dr<=Kr.max)}(hr.type,Number(Dr))?St.OUT_OF_RANGE:at(hr,Dr)?hr.domain?function J(hr,Dr){switch(hr.type){case"range":{const Nt="range"in hr?hr.range[1]:hr.maxValue;if(+Dr<("range"in hr?hr.range[0]:hr.minValue)||+Dr>Nt)return H.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(null==hr.codedValues||hr.codedValues.every(Kr=>null==Kr||Kr.code!==Dr))return H.INVALID_CODED_VALUE}return null}(hr.domain,Dr):null:Xt.INVALID_TYPE}function ct(hr){switch(hr){case"esriFieldTypeSmallInteger":case"small-integer":return qt;case"esriFieldTypeInteger":case"integer":return er;case"esriFieldTypeSingle":case"single":return Zt;case"esriFieldTypeDouble":case"double":return tr}}(function(hr){hr.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(St||(St={})),function(hr){hr.INVALID_TYPE="type-validation-error::invalid-type"}(Xt||(Xt={}));const qt={min:-32768,max:32767,isInteger:!0},er={min:-2147483648,max:2147483647,isInteger:!0},Zt={min:-34e37,max:12e37,isInteger:!1},tr={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function ir(hr,Dr,Kr){switch(hr){case H.INVALID_CODED_VALUE:return`Value ${Kr} is not in the coded domain - field: ${Dr.name}, domain: ${JSON.stringify(Dr.domain)}`;case H.VALUE_OUT_OF_RANGE:return`Value ${Kr} is out of the range of valid values - field: ${Dr.name}, domain: ${JSON.stringify(Dr.domain)}`;case Xt.INVALID_TYPE:return`Value ${Kr} is not a valid value for the field type - field: ${Dr.name}, type: ${Dr.type}, nullable: ${Dr.nullable}`;case St.OUT_OF_RANGE:{const{min:Nt,max:lr}=ct(Dr.type);return`Value ${Kr} is out of range for the number type - field: ${Dr.name}, type: ${Dr.type}, value range is ${Nt} to ${lr}`}}}function fr(hr,Dr){return!Ur(hr,Dr,null)}function Ur(hr,Dr,Kr){if(!Dr||!Dr.attributes||!hr){if((0,G.pC)(Kr))for(const jr of hr)Kr.add(jr);return!0}const Nt=Dr.attributes;let lr=!1;for(const jr of hr)if(!(jr in Nt)){if(lr=!0,!(0,G.pC)(Kr))break;Kr.add(jr)}return lr}function ri(hr){return["raster.itempixelvalue","raster.servicepixelvalue"].some(Dr=>hr.toLowerCase().startsWith(Dr))}},22445:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{createLabelFunction:()=>ue,formatField:()=>oe});var x=T(15861),A=T(26584),G=T(63290),Q=T(88411),H=T(15348),re=T(36630),J=T(86793),W=T(46679);const B=G.Z.getLogger("esri.layers.support.labelFormatUtils"),Z={type:"simple",evaluate:()=>null},ie={getAttribute:(le,Y)=>le.field(Y)};function ue(le,Y,j){return ce.apply(this,arguments)}function ce(){return(ce=(0,x.Z)(function*(le,Y,j){if(!le||!le.symbol)return Z;const X=le.where,U=(0,J.hV)(le),ee=X?yield Promise.resolve().then(T.bind(T,10410)):null;let $;if("arcade"===U.type){const ne=yield(0,W.WW)(U.expression,j,Y);$={type:"arcade",evaluate(se){try{const ae=ne.evaluate({$feature:"attributes"in se?ne.repurposeFeature(se):se});if(null!=ae)return ae.toString()}catch(ae){B.error(new A.Z("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:se,expression:U}))}return null},needsHydrationToEvaluate:()=>null==(0,J.el)(U.expression)}}else $={type:"simple",evaluate:ne=>U.expression.replace(/{[^}]*}/g,se=>{const ae=se.slice(1,-1),de=Y.get(ae);if(!de)return se;let _e=null;return"attributes"in ne?ne&&ne.attributes&&(_e=ne.attributes[de.name]):_e=ne.field(de.name),null==_e?"":oe(_e,de)})};if(X){let ne;try{ne=ee.WhereClause.create(X,Y)}catch(ae){return B.error(new A.Z("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:X,error:ae})),Z}const se=$.evaluate;$.evaluate=ae=>{const de="attributes"in ae?void 0:ie;try{if(ne.testFeature(ae,de))return se(ae)}catch(_e){B.error(new A.Z("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:X,feature:ae,error:_e}))}return null}}return $})).apply(this,arguments)}function oe(le,Y){if(null==le)return"";const j=Y.domain;if(j)if("codedValue"===j.type||"coded-value"===j.type){const U=le;for(const ee of j.codedValues)if(ee.code===U)return ee.name}else if("range"===j.type){const U=+le,$="range"in j?j.range[1]:j.maxValue;if(("range"in j?j.range[0]:j.minValue)<=U&&U<=$)return j.name}let X=le;return"date"===Y.type||"esriFieldTypeDate"===Y.type?X=(0,Q.p6)(X,(0,Q.Ze)("short-date")):(0,re.H7)(Y)&&(X=(0,H.uf)(+X)),X||""}},86793:(dt,Re,T)=>{"use strict";T.d(Re,{UO:()=>le,YI:()=>oe,dI:()=>Y,el:()=>ne,hV:()=>ce,z7:()=>ue});var x=T(77275);const A="__begin__",G="__end__",Q=new RegExp(A,"ig"),H=new RegExp(G,"ig"),re=new RegExp("^"+A,"i"),J=new RegExp(G+"$","i");function ue(se){return se.replace(new RegExp("\\{","g"),"[").replace(new RegExp("\\}","g"),"]")}function ce(se){const ae={expression:"",type:"none"};return se.labelExpressionInfo?se.labelExpressionInfo.value?(ae.expression=se.labelExpressionInfo.value,ae.type="conventional"):se.labelExpressionInfo.expression&&(ae.expression=se.labelExpressionInfo.expression,ae.type="arcade"):null!=se.labelExpression&&(ae.expression=function ie(se){return se.replace(new RegExp("\\[","g"),"{").replace(new RegExp("\\]","g"),"}")}(se.labelExpression),ae.type="conventional"),ae}function oe(se){const ae=ce(se);if(!ae)return null;switch(ae.type){case"conventional":return Y(ae.expression);case"arcade":return ae.expression}return null}function le(se){const ae=ce(se);if(!ae)return null;switch(ae.type){case"conventional":return function X(se){const ae=se.match(j);return ae&&ae[1].trim()||null}(ae.expression);case"arcade":return ne(ae.expression)}return null}function Y(se){let ae;return se?(ae=(0,x.gx)(se,de=>A+'$feature["'+de+'"]'+G),ae=re.test(ae)?ae.replace(re,""):'"'+ae,ae=J.test(ae)?ae.replace(J,""):ae+'"',ae=ae.replace(Q,'" + ').replace(H,' + "')):ae='""',ae}const j=/^\s*\{([^}]+)\}\s*$/i,U=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,ee=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,$=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function ne(se){if(!se)return null;let ae=U.exec(se)||ee.exec(se);return ae?ae[1]||ae[3]:(ae=$.exec(se),ae?ae[2]:null)}},62667:(dt,Re,T)=>{"use strict";T.d(Re,{r:()=>G});var x=T(170);const A=/\[([^\[\]]+)\]/gi;function G(H,re,J){return H?H.map(W=>{const B=new x.Z;if(B.read(W,J),B.labelExpression){const Z=re.fields||re.layerDefinition&&re.layerDefinition.fields||this.fields;B.labelExpression=B.labelExpression.replace(A,(ie,ue)=>`[${function Q(H,re){if(!re)return H;const J=H.toLowerCase();for(let W=0;W<re.length;W++){const B=re[W].name;if(B.toLowerCase()===J)return B}return H}(ue,Z)}]`)}return B}):null}},72469:(dt,Re,T)=>{"use strict";function A(ce){const oe=null==ce?void 0:ce.type;return"base-tile"===oe||"tile"===oe||"elevation"===oe||"imagery-tile"===oe||"base-elevation"===oe||"open-street-map"===oe||"wcs"===oe||"web-tile"===oe||"wmts"===oe||"vector-tile"===oe}function G(ce){return"voxel"===(null==ce?void 0:ce.type)}function Q(ce){return"imagery-tile"===(null==ce?void 0:ce.type)}function H(ce){var oe;return"esri.Basemap"===(null==(oe=ce.parent)?void 0:oe.declaredClass)&&ce.parent.baseLayers.includes(ce)}function re(ce){var oe;return"feature"===(null==ce?void 0:ce.type)&&!ce.url&&"memory"===(null==(oe=ce.source)?void 0:oe.type)}function J(ce){var oe;return"feature"===(null==ce?void 0:ce.type)&&"feature-layer"===(null==(oe=ce.source)?void 0:oe.type)}function ie(ce){return!0===ce.labelsVisible&&null!=ce.labelingInfo&&ce.labelingInfo.length>0}function ue(ce){if(ce.activeLayer){const oe=ce.activeLayer.tileMatrixSet;if(oe)return oe;const le=ce.activeLayer.tileMatrixSets;if(le)return le}return null}T.d(Re,{Am:()=>Q,C6:()=>ie,Tv:()=>G,iC:()=>A,mt:()=>ue,rQ:()=>re,sy:()=>H,y2:()=>J})},15283:(dt,Re,T)=>{"use strict";T.d(Re,{n:()=>Te});var X,x=T(17626),A=T(2076),G=T(86810),Q=T(77712),J=(T(85931),T(8314),T(66656)),W=T(55342),B=T(68653),Z=T(76898),ie=T(90912),ue=T(383),ce=T(36255),oe=T(48370),Y=(T(29132),T(65234)),j=T(71774);let U=X=class extends G.wq{constructor(me){super(me),this.type="query-table"}clone(){var je;const{workspaceId:me,query:Ce,oidFields:Ie,spatialReference:Ge,geometryType:Je}=this,xe={workspaceId:me,query:Ce,oidFields:Ie,spatialReference:null!=(je=null==Ge?void 0:Ge.clone())?je:void 0,geometryType:Je};return new X(xe)}};var ee;(0,x._)([(0,W.J)({queryTable:"query-table"})],U.prototype,"type",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],U.prototype,"workspaceId",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],U.prototype,"query",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],U.prototype,"oidFields",void 0),(0,x._)([(0,Q.Cb)({type:Y.Z,json:{write:!0}})],U.prototype,"spatialReference",void 0),(0,x._)([(0,W.J)(j.Mk)],U.prototype,"geometryType",void 0),U=X=(0,x._)([(0,Z.j)("esri.layers.support.source.QueryTableDataSource")],U);let $=ee=class extends G.wq{constructor(me){super(me),this.type="raster"}clone(){const{workspaceId:me,dataSourceName:Ce}=this;return new ee({workspaceId:me,dataSourceName:Ce})}};var ne;(0,x._)([(0,W.J)({raster:"raster"})],$.prototype,"type",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],$.prototype,"dataSourceName",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],$.prototype,"workspaceId",void 0),$=ee=(0,x._)([(0,Z.j)("esri.layers.support.source.RasterDataSource")],$);let se=ne=class extends G.wq{constructor(me){super(me),this.type="table"}clone(){const{workspaceId:me,gdbVersion:Ce,dataSourceName:Ie}=this;return new ne({workspaceId:me,gdbVersion:Ce,dataSourceName:Ie})}};var ae,de;(0,x._)([(0,W.J)({table:"table"})],se.prototype,"type",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],se.prototype,"workspaceId",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],se.prototype,"gdbVersion",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],se.prototype,"dataSourceName",void 0),se=ne=(0,x._)([(0,Z.j)("esri.layers.support.source.TableDataSource")],se);const _e=(0,A.w)()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let pe=ae=class extends G.wq{constructor(me){super(me),this.type="join-table"}readLeftTableSource(me,Ce,Ie){return ge()(me,Ce,Ie)}castLeftTableSource(me){return(0,ie.N7)(Me(),me)}readRightTableSource(me,Ce,Ie){return ge()(me,Ce,Ie)}castRightTableSource(me){return(0,ie.N7)(Me(),me)}clone(){var je,We;const{leftTableKey:me,rightTableKey:Ce,leftTableSource:Ie,rightTableSource:Ge,joinType:Je}=this,xe={leftTableKey:me,rightTableKey:Ce,leftTableSource:null!=(je=null==Ie?void 0:Ie.clone())?je:void 0,rightTableSource:null!=(We=null==Ge?void 0:Ge.clone())?We:void 0,joinType:Je};return new ae(xe)}};(0,x._)([(0,W.J)({joinTable:"join-table"})],pe.prototype,"type",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],pe.prototype,"leftTableKey",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],pe.prototype,"rightTableKey",void 0),(0,x._)([(0,Q.Cb)({json:{write:!0}})],pe.prototype,"leftTableSource",void 0),(0,x._)([(0,B.r)("leftTableSource")],pe.prototype,"readLeftTableSource",null),(0,x._)([(0,J.p)("leftTableSource")],pe.prototype,"castLeftTableSource",null),(0,x._)([(0,Q.Cb)({json:{write:!0}})],pe.prototype,"rightTableSource",void 0),(0,x._)([(0,B.r)("rightTableSource")],pe.prototype,"readRightTableSource",null),(0,x._)([(0,J.p)("rightTableSource")],pe.prototype,"castRightTableSource",null),(0,x._)([(0,W.J)(_e)],pe.prototype,"joinType",void 0),pe=ae=(0,x._)([(0,Z.j)("esri.layers.support.source.JoinTableDataSource")],pe);let he=null;function ge(){return he||(he=(0,ue.d)({types:Me()})),he}let ye=null;function Me(){return ye||(ye={key:"type",base:null,typeMap:{"data-layer":Te,"map-layer":oe.R}}),ye}const Ee={key:"type",base:null,typeMap:{"join-table":pe,"query-table":U,raster:$,table:se}};let Te=de=class extends G.wq{constructor(me){super(me),this.type="data-layer"}clone(){const{fields:me,dataSource:Ce}=this;return new de({fields:me,dataSource:Ce})}};(0,x._)([(0,W.J)({dataLayer:"data-layer"})],Te.prototype,"type",void 0),(0,x._)([(0,Q.Cb)({type:[ce.Z],json:{write:!0}})],Te.prototype,"fields",void 0),(0,x._)([(0,Q.Cb)({types:Ee,json:{write:!0}})],Te.prototype,"dataSource",void 0),Te=de=(0,x._)([(0,Z.j)("esri.layers.support.source.DataLayerSource")],Te),Te.from=(0,ie.se)(Te)},48370:(dt,Re,T)=>{"use strict";T.d(Re,{R:()=>Z});var B,x=T(17626),A=T(86810),G=T(77712),re=(T(85931),T(8314),T(90912)),J=T(55342),W=T(76898);let Z=B=class extends A.wq{constructor(ie){super(ie),this.type="map-layer"}clone(){const{mapLayerId:ie,gdbVersion:ue}=this;return new B({mapLayerId:ie,gdbVersion:ue})}};(0,x._)([(0,J.J)({mapLayer:"map-layer"})],Z.prototype,"type",void 0),(0,x._)([(0,G.Cb)({type:re.z8,json:{write:!0}})],Z.prototype,"mapLayerId",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Z.prototype,"gdbVersion",void 0),Z=B=(0,x._)([(0,W.j)("esri.layers.support.source.MapLayerSource")],Z)},5676:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>G});var x=T(38305);const A=[];function G(Q,H){if((0,x.M8)(Q.url))return!0;const{wkid:re}=H;for(const J of A){if(Q.version>=J[0])return!0;if("function"==typeof J[1]&&(J[1]=J[1]()),J[1].has(re))return!1}return!0}A.push([10.91,()=>{const Q=new Set([9709,9716,9741,9761,9766]);for(let H=9712;H<=9713;H++)Q.add(H);for(let H=9748;H<=9749;H++)Q.add(H);for(let H=20904;H<=20932;H++)Q.add(H);for(let H=21004;H<=21032;H++)Q.add(H);for(let H=21207;H<=21264;H++)Q.add(H);for(let H=21307;H<=21364;H++)Q.add(H);for(let H=102759;H<=102760;H++)Q.add(H);for(let H=102901;H<=102955;H++)Q.add(H);return Q}]),A.push([10.9,()=>{const Q=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let H=9356;H<=9360;H++)Q.add(H);for(let H=9404;H<=9407;H++)Q.add(H);for(let H=9476;H<=9482;H++)Q.add(H);for(let H=9487;H<=9494;H++)Q.add(H);for(let H=9697;H<=9699;H++)Q.add(H);return Q}]),A.push([10.81,()=>{const Q=new Set([9265,9333,103598,103699]);for(let H=9248;H<=9254;H++)Q.add(H);for(let H=9271;H<=9273;H++)Q.add(H);for(let H=9284;H<=9285;H++)Q.add(H);for(let H=21453;H<=21463;H++)Q.add(H);return Q}]),A.push([10.8,()=>{const Q=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let H=8035;H<=8036;H++)Q.add(H);for(let H=8455;H<=8456;H++)Q.add(H);for(let H=8518;H<=8529;H++)Q.add(H);for(let H=8533;H<=8536;H++)Q.add(H);for(let H=8538;H<=8540;H++)Q.add(H);for(let H=8677;H<=8679;H++)Q.add(H);for(let H=8902;H<=8903;H++)Q.add(H);for(let H=8907;H<=8910;H++)Q.add(H);for(let H=8949;H<=8951;H++)Q.add(H);for(let H=8972;H<=8987;H++)Q.add(H);for(let H=9039;H<=9040;H++)Q.add(H);for(let H=9068;H<=9069;H++)Q.add(H);for(let H=9140;H<=9141;H++)Q.add(H);for(let H=9148;H<=9150;H++)Q.add(H);for(let H=9153;H<=9159;H++)Q.add(H);for(let H=9205;H<=9218;H++)Q.add(H);for(let H=9221;H<=9222;H++)Q.add(H);for(let H=54098;H<=54101;H++)Q.add(H);return Q}]),A.push([10.71,()=>{const Q=new Set([6316]);for(let H=8351;H<=8353;H++)Q.add(H);for(let H=9294;H<=9297;H++)Q.add(H);for(let H=103586;H<=103594;H++)Q.add(H);for(let H=103696;H<=103698;H++)Q.add(H);return Q}]),A.push([10.7,()=>{const Q=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let H=8065;H<=8068;H++)Q.add(H);for(let H=8082;H<=8083;H++)Q.add(H);for(let H=8379;H<=8385;H++)Q.add(H);for(let H=8836;H<=8840;H++)Q.add(H);for(let H=8857;H<=8860;H++)Q.add(H);for(let H=53035;H<=53037;H++)Q.add(H);for(let H=54090;H<=54091;H++)Q.add(H);for(let H=102498;H<=102499;H++)Q.add(H);return Q}]),A.push([10.61,()=>new Set([102497])]),A.push([10.6,()=>{const Q=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let H=7755;H<=7787;H++)Q.add(H);for(let H=7791;H<=7795;H++)Q.add(H);for(let H=7799;H<=7801;H++)Q.add(H);for(let H=7825;H<=7831;H++)Q.add(H);for(let H=7877;H<=7878;H++)Q.add(H);for(let H=7882;H<=7883;H++)Q.add(H);for(let H=7991;H<=7992;H++)Q.add(H);for(let H=8042;H<=8043;H++)Q.add(H);for(let H=8058;H<=8059;H++)Q.add(H);for(let H=8311;H<=8348;H++)Q.add(H);for(let H=9060;H<=9067;H++)Q.add(H);for(let H=102562;H<=102568;H++)Q.add(H);for(let H=102799;H<=102900;H++)Q.add(H);return Q}]),A.push([10.51,()=>{const Q=new Set([7683,7881,7886,7899,8888,9e3]);for(let H=8013;H<=8032;H++)Q.add(H);for(let H=9053;H<=9057;H++)Q.add(H);for(let H=104017;H<=104018;H++)Q.add(H);for(let H=104971;H<=104974;H++)Q.add(H);return Q}]),A.push([10.5,()=>{const Q=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let H=4087;H<=4088;H++)Q.add(H);for(let H=5896;H<=5899;H++)Q.add(H);for(let H=7005;H<=7007;H++)Q.add(H);for(let H=7057;H<=7070;H++)Q.add(H);for(let H=7073;H<=7082;H++)Q.add(H);for(let H=7109;H<=7128;H++)Q.add(H);for(let H=7844;H<=7859;H++)Q.add(H);return Q}])},39605:(dt,Re,T)=>{"use strict";T.d(Re,{W:()=>G,v:()=>Q});var x=T(50645);const A={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(H,re,J)=>{"-"===re.charAt(0)?H.style.setProperty(re,J):H.style[re]=J}};let G=H=>(0,x.l7)(A,H),Q={create:(H,re)=>(re=G(re),(0,x.WV)(H,document.createElement("div"),void 0,re),(0,x.UQ)(H,re)),append:(H,re,J)=>(J=G(J),(0,x.WV)(re,H,void 0,J),(0,x.UQ)(re,J)),insertBefore:(H,re,J)=>(J=G(J),(0,x.WV)(re,H.parentNode,H,J),(0,x.UQ)(re,J)),merge:(H,re,J)=>(J=G(J),re.domNode=H,(0,x.Yj)(H,re,J),(0,x.UQ)(re,J)),replace:(H,re,J)=>(J=G(J),(0,x.WV)(re,H.parentNode,H,J),H.parentNode.removeChild(H),(0,x.UQ)(re,J))}},50645:(dt,Re,T)=>{"use strict";T.d(Re,{UQ:()=>_e,WV:()=>ne,Yj:()=>$,l7:()=>J});var x=T(38570);const A="http://www.w3.org/",G=`${A}2000/svg`,Q=`${A}1999/xlink`;let H,re=[],J=(pe,he)=>{let ge={};return Object.keys(pe).forEach(ye=>{ge[ye]=pe[ye]}),he&&Object.keys(he).forEach(ye=>{ge[ye]=he[ye]}),ge},W=(pe,he)=>pe.vnodeSelector===he.vnodeSelector&&(pe.properties&&he.properties?pe.properties.key===he.properties.key&&pe.properties.bind===he.properties.bind:!pe.properties&&!he.properties),B=pe=>{if("string"!=typeof pe)throw new Error("Style values must be strings")},Z=(pe,he,ge)=>{if(""!==he.vnodeSelector)for(let ye=ge;ye<pe.length;ye++)if(W(pe[ye],he))return ye;return-1},ie=(pe,he,ge,ye)=>{let Me=pe[he];if(""===Me.vnodeSelector)return;let Ee=Me.properties;if(!(Ee?void 0===Ee.key?Ee.bind:Ee.key:void 0))for(let Te=0;Te<pe.length;Te++)if(Te!==he&&W(pe[Te],Me))throw new Error(`${ge.vnodeSelector} had a ${Me.vnodeSelector} child ${"added"===ye?ye:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)},ue=pe=>{if(pe.properties){let he=pe.properties.enterAnimation;he&&he(pe.domNode,pe.properties)}},ce=[],oe=!1,le=pe=>{(pe.children||[]).forEach(le),pe.properties&&pe.properties.afterRemoved&&pe.properties.afterRemoved.apply(pe.properties.bind||pe.properties,[pe.domNode])},Y=()=>{oe=!1,ce.forEach(le),ce.length=0},j=pe=>{ce.push(pe),oe||(oe=!0,"undefined"!=typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(Y,{timeout:16}):setTimeout(Y,16))},X=pe=>{let he=pe.domNode;if(pe.properties){let ge=pe.properties.exitAnimation;if(ge)return he.style.pointerEvents="none",void ge(he,()=>{he.parentNode&&(he.parentNode.removeChild(he),j(pe))},pe.properties)}he.parentNode&&(he.parentNode.removeChild(he),j(pe))},U=(pe,he,ge)=>{if(!he)return;let ye=ge.eventHandlerInterceptor,Me=Object.keys(he),Ee=Me.length;for(let Te=0;Te<Ee;Te++){let me=Me[Te],Ce=he[me];if("className"===me)throw new Error('Property "className" is not supported, use "class".');if("class"===me)se(pe,Ce,!0);else if("classes"===me){let Ie=Object.keys(Ce),Ge=Ie.length;for(let Je=0;Je<Ge;Je++){let xe=Ie[Je];Ce[xe]&&pe.classList.add(xe)}}else if("styles"===me){let Ie=Object.keys(Ce),Ge=Ie.length;for(let Je=0;Je<Ge;Je++){let xe=Ie[Je],je=Ce[xe];je&&(B(je),ge.styleApplyer(pe,xe,je))}}else if("key"!==me&&null!=Ce){let Ie=typeof Ce;"function"===Ie?(0===me.lastIndexOf("on",0)&&(ye&&(Ce=ye(me,Ce,pe,he)),"oninput"===me&&function(){let Ge=Ce;Ce=function(Je){Ge.apply(this,[Je]),Je.target["oninput-value"]=Je.target.value}}()),pe[me]=Ce):ge.namespace===G?"href"===me?pe.setAttributeNS(Q,me,Ce):pe.setAttribute(me,Ce):"string"===Ie&&"value"!==me?"innerHTML"===me?pe[me]=x.w3.sanitize(Ce):pe.setAttribute(me,Ce):pe[me]=Ce}}},$=(pe,he,ge)=>{((pe,he,ge)=>{if(he)for(let ye of he)ne(ye,pe,void 0,ge)})(pe,he.children,ge),he.text&&(pe.textContent=he.text),U(pe,he.properties,ge),he.properties&&he.properties.afterCreate&&he.properties.afterCreate.apply(he.properties.bind||he.properties,[pe,ge,he.vnodeSelector,he.properties,he.children])},ne=(pe,he,ge,ye)=>{let Me,Ee=0,Te=pe.vnodeSelector,me=he.ownerDocument;if(""===Te)Me=pe.domNode=me.createTextNode(pe.text),void 0!==ge?he.insertBefore(Me,ge):he.appendChild(Me);else{for(let Ce=0;Ce<=Te.length;++Ce){let Ie=Te.charAt(Ce);if(Ce===Te.length||"."===Ie||"#"===Ie){let Ge=Te.charAt(Ee-1),Je=Te.slice(Ee,Ce);"."===Ge?Me.classList.add(Je):"#"===Ge?Me.id=Je:("svg"===Je&&(ye=J(ye,{namespace:G})),void 0!==ye.namespace?Me=pe.domNode=me.createElementNS(ye.namespace,Je):(Me=pe.domNode=pe.domNode||me.createElement(Je),"input"===Je&&pe.properties&&void 0!==pe.properties.type&&Me.setAttribute("type",pe.properties.type)),void 0!==ge?he.insertBefore(Me,ge):Me.parentNode!==he&&he.appendChild(Me)),Ee=Ce+1}}$(Me,pe,ye)}},se=(pe,he,ge)=>{he&&he.split(" ").forEach(ye=>{ye&&pe.classList.toggle(ye,ge)})};H=(pe,he,ge)=>{let ye=pe.domNode,Me=!1;if(pe===he)return!1;let Ee=!1;if(""===he.vnodeSelector){if(he.text!==pe.text){let Te=ye.ownerDocument.createTextNode(he.text);return ye.parentNode.replaceChild(Te,ye),he.domNode=Te,Me=!0,Me}he.domNode=ye}else 0===he.vnodeSelector.lastIndexOf("svg",0)&&(ge=J(ge,{namespace:G})),pe.text!==he.text&&(Ee=!0,void 0===he.text?ye.removeChild(ye.firstChild):ye.textContent=he.text),he.domNode=ye,Ee=((pe,he,ge,ye,Me)=>{if(ge===ye)return!1;let Ee,Te=(ge=ge||re).length,me=(ye=ye||re).length,Ce=0,Ie=0,Ge=!1;for(;Ie<me;){let Je=Ce<Te?ge[Ce]:void 0,xe=ye[Ie];if(void 0!==Je&&W(Je,xe))Ge=H(Je,xe,Me)||Ge,Ce++;else{let je=Z(ge,xe,Ce+1);if(je>=0){for(Ee=Ce;Ee<je;Ee++)X(ge[Ee]),ie(ge,Ee,pe,"removed");Ge=H(ge[je],xe,Me)||Ge,Ce=je+1}else ne(xe,he,Ce<Te?ge[Ce].domNode:void 0,Me),ue(xe),ie(ye,Ie,pe,"added")}Ie++}if(Te>Ce)for(Ee=Ce;Ee<Te;Ee++)X(ge[Ee]),ie(ge,Ee,pe,"removed");return Ge})(he,ye,pe.children,he.children,ge)||Ee,Ee=((pe,he,ge,ye)=>{if(!ge)return;let Me=!1,Ee=Object.keys(ge),Te=Ee.length;for(let me=0;me<Te;me++){let Ce=Ee[me],Ie=ge[Ce],Ge=he[Ce];if("class"===Ce)Ge!==Ie&&(se(pe,Ge,!1),se(pe,Ie,!0));else if("classes"===Ce){let Je=pe.classList,xe=Object.keys(Ie),je=xe.length;for(let We=0;We<je;We++){let Ne=xe[We],we=!!Ie[Ne];we!==!!Ge[Ne]&&(Me=!0,we?Je.add(Ne):Je.remove(Ne))}}else if("styles"===Ce){let Je=Object.keys(Ie),xe=Je.length;for(let je=0;je<xe;je++){let We=Je[je],Ne=Ie[We];Ne!==Ge[We]&&(Me=!0,Ne?(B(Ne),ye.styleApplyer(pe,We,Ne)):ye.styleApplyer(pe,We,""))}}else if(Ie||"string"!=typeof Ge||(Ie=""),"value"===Ce){let Je=pe[Ce];Je!==Ie&&(pe["oninput-value"]?Je===pe["oninput-value"]:Ie!==Ge)&&(pe[Ce]=Ie,pe["oninput-value"]=void 0),Ie!==Ge&&(Me=!0)}else if(Ie!==Ge){let Je=typeof Ie;"function"===Je&&ye.eventHandlerInterceptor||(ye.namespace===G?"href"===Ce?pe.setAttributeNS(Q,Ce,Ie):pe.setAttribute(Ce,Ie):"string"===Je?"innerHTML"===Ce?pe[Ce]=x.w3.sanitize(Ie):"role"===Ce&&""===Ie?pe.removeAttribute(Ce):pe.setAttribute(Ce,Ie):pe[Ce]!==Ie&&(pe[Ce]=Ie),Me=!0)}}return Me})(ye,pe.properties,he.properties,ge)||Ee,he.properties&&he.properties.afterUpdate&&he.properties.afterUpdate.apply(he.properties.bind||he.properties,[ye,ge,he.vnodeSelector,he.properties,he.children]);return Ee&&he.properties&&he.properties.updateAnimation&&he.properties.updateAnimation(ye,he.properties,pe.properties),Me};let _e=(pe,he)=>({getLastRender:()=>pe,update:ge=>{if(pe.vnodeSelector!==ge.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let ye=pe;pe=ge,H(ye,ge,he)},domNode:pe.domNode})},62996:(dt,Re,T)=>{"use strict";T.d(Re,{E:()=>re});var x=T(39605);let A,G=(J,W)=>{let B=[];for(;J&&J!==W;)B.push(J),J=J.parentNode;return B};A=Array.prototype.find?(J,W)=>J.find(W):(J,W)=>J.filter(W)[0];let Q=(J,W)=>{let B=J;return W.forEach(Z=>{B=B&&B.children?A(B.children,ie=>ie.domNode===Z):void 0}),B},H=(J,W,B)=>{let Z=function(ie){B("domEvent",ie);let ue=W(),ce=G(ie.currentTarget,ue.domNode);ce.reverse();let oe,le=Q(ue.getLastRender(),ce);return J.scheduleRender(),le&&(oe=le.properties[`on${ie.type}`].apply(le.properties.bind||this,arguments)),B("domEventProcessed",ie),oe};return(ie,ue,ce,oe)=>Z},re=J=>{let W,B,Z=(0,x.W)(J),ie=Z.performanceLogger,ue=!0,ce=!1,oe=[],le=[],Y=(X,U,ee)=>{let $;Z.eventHandlerInterceptor=H(W,()=>$,ie),$=X(U,ee(),Z),oe.push($),le.push(ee)},j=()=>{if(B=void 0,ue){ue=!1,ie("renderStart",void 0);for(let X=0;X<oe.length;X++){let U=le[X]();ie("rendered",void 0),oe[X].update(U),ie("patched",void 0)}ie("renderDone",void 0),ue=!0}};return W={renderNow:j,scheduleRender:()=>{B||ce||(B=requestAnimationFrame(j))},stop:()=>{B&&(cancelAnimationFrame(B),B=void 0),ce=!0},resume:()=>{ce=!1,ue=!0,W.scheduleRender()},append:(X,U)=>{Y(x.v.append,X,U)},insertBefore:(X,U)=>{Y(x.v.insertBefore,X,U)},merge:(X,U)=>{Y(x.v.merge,X,U)},replace:(X,U)=>{Y(x.v.replace,X,U)},detach:X=>{for(let U=0;U<le.length;U++)if(le[U]===X)return le.splice(U,1),oe.splice(U,1)[0];throw new Error("renderFunction was not found")}},W}},38159:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let B=W=class extends A.wq{constructor(ie){super(ie),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new W({title:this.title,expression:this.expression})}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"title",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"expression",void 0),(0,x._)([(0,G.Cb)({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],B.prototype,"returnType",void 0),B=W=(0,x._)([(0,J.j)("esri.popup.ElementExpressionInfo")],B);const Z=B},38439:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let B=W=class extends A.wq{constructor(ie){super(ie),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new W({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"name",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"title",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"expression",void 0),(0,x._)([(0,G.Cb)({type:["string","number"],json:{write:!0}})],B.prototype,"returnType",void 0),B=W=(0,x._)([(0,J.j)("esri.popup.ExpressionInfo")],B);const Z=B},25621:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var Z,x=T(17626),A=T(2076),G=T(86810),Q=T(58817),H=T(77712),J=(T(90912),T(55342)),W=T(76898),B=T(66845);let ie=Z=class extends G.wq{constructor(ce){super(ce),this.fieldName=null,this.format=null,this.isEditable=!1,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new Z({fieldName:this.fieldName,format:this.format?(0,Q.d9)(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ie.prototype,"fieldName",void 0),(0,x._)([(0,H.Cb)({type:B.Z,json:{write:!0}})],ie.prototype,"format",void 0),(0,x._)([(0,H.Cb)({type:Boolean,json:{write:!0,default:!1}})],ie.prototype,"isEditable",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ie.prototype,"label",void 0),(0,x._)([(0,J.J)(new A.X({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],ie.prototype,"stringFieldOption",void 0),(0,x._)([(0,H.Cb)({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],ie.prototype,"statisticType",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ie.prototype,"tooltip",void 0),(0,x._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],ie.prototype,"visible",void 0),ie=Z=(0,x._)([(0,W.j)("esri.popup.FieldInfo")],ie);const ue=ie},55664:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(55013);let B=W=class extends J.Z{constructor(ie){super(ie),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new W({description:this.description,displayType:this.displayType,title:this.title})}};(0,x._)([(0,A.Cb)({type:String,json:{write:!0}})],B.prototype,"description",void 0),(0,x._)([(0,A.Cb)({type:["auto","preview","list"],json:{write:!0}})],B.prototype,"displayType",void 0),(0,x._)([(0,A.Cb)({type:String,json:{write:!0}})],B.prototype,"title",void 0),(0,x._)([(0,A.Cb)({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],B.prototype,"type",void 0),B=W=(0,x._)([(0,re.j)("esri.popup.content.AttachmentsContent")],B);const Z=B},89594:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(85812),W=T(82657);let Z=B=class extends J.Z{constructor(ue){super(ue),this.type="bar-chart"}clone(){return new B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,x._)([(0,A.Cb)({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:W.l.write}})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,re.j)("esri.popup.content.BarChartMediaInfo")],Z);const ie=Z},81590:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(85812),W=T(82657);let Z=B=class extends J.Z{constructor(ue){super(ue),this.type="column-chart"}clone(){return new B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,x._)([(0,A.Cb)({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:W.l.write}})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,re.j)("esri.popup.content.ColumnChartMediaInfo")],Z);const ie=Z},55013:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.wq{constructor(Z){super(Z),this.type=null}};(0,x._)([(0,G.Cb)({type:["attachments","custom","fields","media","text","expression"],readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"type",void 0),W=(0,x._)([(0,J.j)("esri.popup.content.Content")],W);const B=W},16615:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var J,x=T(17626),A=T(58817),G=T(77712),H=(T(90912),T(76898)),re=T(55013);let W=J=class extends re.Z{constructor(Z){super(Z),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new J({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?(0,A.d9)(this.outFields):null})}};(0,x._)([(0,G.Cb)()],W.prototype,"creator",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"destroyer",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"outFields",void 0),(0,x._)([(0,G.Cb)({type:["custom"],readOnly:!0})],W.prototype,"type",void 0),W=J=(0,x._)([(0,H.j)("esri.popup.content.CustomContent")],W);const B=W},82561:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(38159),W=T(55013);let Z=B=class extends W.Z{constructor(ue){super(ue),this.expressionInfo=null,this.type="expression"}clone(){var ue;return new B({expressionInfo:null==(ue=this.expressionInfo)?void 0:ue.clone()})}};(0,x._)([(0,A.Cb)({type:J.Z,json:{write:!0}})],Z.prototype,"expressionInfo",void 0),(0,x._)([(0,A.Cb)({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,re.j)("esri.popup.content.ExpressionContent")],Z);const ie=Z},75484:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(58817),G=T(77712),H=(T(90912),T(76898)),re=T(99433),J=T(25621),W=T(55013);let Z=B=class extends W.Z{constructor(ue){super(ue),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(ue,ce){ce.fieldInfos=ue&&ue.map(oe=>oe.toJSON())}clone(){return new B((0,A.d9)({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};(0,x._)([(0,G.Cb)({type:Object,json:{write:!0}})],Z.prototype,"attributes",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Z.prototype,"description",void 0),(0,x._)([(0,G.Cb)({type:[J.Z]})],Z.prototype,"fieldInfos",void 0),(0,x._)([(0,re.c)("fieldInfos")],Z.prototype,"writeFieldInfos",null),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Z.prototype,"title",void 0),(0,x._)([(0,G.Cb)({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,H.j)("esri.popup.content.FieldsContent")],Z);const ie=Z},49455:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var B,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(78297),W=T(86810);let Z=B=class extends W.wq{constructor(le){super(le),this.linkURL=null,this.sourceURL=null}clone(){return new B({linkURL:this.linkURL,sourceURL:this.sourceURL})}};(0,x._)([(0,A.Cb)({type:String,json:{write:!0}})],Z.prototype,"linkURL",void 0),(0,x._)([(0,A.Cb)({type:String,json:{write:!0}})],Z.prototype,"sourceURL",void 0),Z=B=(0,x._)([(0,re.j)("esri.popup.content.support.ImageMediaInfoValue")],Z);const ie=Z;var ue;let ce=ue=class extends J.Z{constructor(le){super(le),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new ue({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};(0,x._)([(0,A.Cb)({type:Number,json:{write:!0}})],ce.prototype,"refreshInterval",void 0),(0,x._)([(0,A.Cb)({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],ce.prototype,"type",void 0),(0,x._)([(0,A.Cb)({type:ie,json:{write:!0}})],ce.prototype,"value",void 0),ce=ue=(0,x._)([(0,re.j)("esri.popup.content.ImageMediaInfo")],ce);const oe=ce},71981:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(85812),W=T(82657);let Z=B=class extends J.Z{constructor(ue){super(ue),this.type="line-chart"}clone(){return new B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,x._)([(0,A.Cb)({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:W.l.write}})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,re.j)("esri.popup.content.LineChartMediaInfo")],Z);const ie=Z},64531:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>j});var le,x=T(17626),A=T(58817),G=T(77712),H=(T(90912),T(68653)),re=T(76898),J=T(99433),W=T(89594),B=T(81590),Z=T(55013),ie=T(49455),ue=T(71981),ce=T(52023),oe=T(65560);let Y=le=class extends Z.Z{constructor(X){super(X),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(X){return X&&X.map(U=>"image"===U.type?ie.Z.fromJSON(U):"barchart"===U.type?W.Z.fromJSON(U):"columnchart"===U.type?B.Z.fromJSON(U):"linechart"===U.type?ue.Z.fromJSON(U):"piechart"===U.type?ce.Z.fromJSON(U):void 0).filter(Boolean)}writeMediaInfos(X,U){U.mediaInfos=X&&X.map(ee=>ee.toJSON())}clone(){return new le((0,A.d9)({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};(0,x._)([(0,G.Cb)()],Y.prototype,"activeMediaInfoIndex",void 0),(0,x._)([(0,G.Cb)({type:Object,json:{write:!0}})],Y.prototype,"attributes",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Y.prototype,"description",void 0),(0,x._)([(0,G.Cb)({types:[oe.V]})],Y.prototype,"mediaInfos",void 0),(0,x._)([(0,H.r)("mediaInfos")],Y.prototype,"readMediaInfos",null),(0,x._)([(0,J.c)("mediaInfos")],Y.prototype,"writeMediaInfos",null),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Y.prototype,"title",void 0),(0,x._)([(0,G.Cb)({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Y.prototype,"type",void 0),Y=le=(0,x._)([(0,re.j)("esri.popup.content.MediaContent")],Y);const j=Y},52023:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(85812),W=T(82657);let Z=B=class extends J.Z{constructor(ue){super(ue),this.type="pie-chart"}clone(){return new B({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};(0,x._)([(0,A.Cb)({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:W.l.write}})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,re.j)("esri.popup.content.PieChartMediaInfo")],Z);const ie=Z},501:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(55013);let B=W=class extends J.Z{constructor(ie){super(ie),this.text=null,this.type="text"}clone(){return new W({text:this.text})}};(0,x._)([(0,A.Cb)({type:String,json:{write:!0}})],B.prototype,"text",void 0),(0,x._)([(0,A.Cb)({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],B.prototype,"type",void 0),B=W=(0,x._)([(0,re.j)("esri.popup.content.TextContent")],B);const Z=B},85812:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ie,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(78297),W=T(86810),B=T(58817),Z=T(77891);let ue=ie=class extends W.wq{constructor(Y){super(Y),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new ie({fields:(0,B.d9)(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};(0,x._)([(0,A.Cb)({type:[String],json:{write:!0}})],ue.prototype,"fields",void 0),(0,x._)([(0,A.Cb)({type:String,json:{write:!0}})],ue.prototype,"normalizeField",void 0),(0,x._)([(0,A.Cb)({type:[Z.Z],json:{read:!1}})],ue.prototype,"series",void 0),(0,x._)([(0,A.Cb)({type:String,json:{write:!0}})],ue.prototype,"tooltipField",void 0),ue=ie=(0,x._)([(0,re.j)("esri.popup.content.support.ChartMediaInfoValue")],ue);const ce=ue;let oe=class extends J.Z{constructor(Y){super(Y),this.type=null,this.value=null}};(0,x._)([(0,A.Cb)({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],oe.prototype,"type",void 0),(0,x._)([(0,A.Cb)({type:ce,json:{write:!0}})],oe.prototype,"value",void 0),oe=(0,x._)([(0,re.j)("esri.popup.content.mixins.ChartMediaInfo")],oe);const le=oe},78297:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.wq{constructor(Z){super(Z),this.altText=null,this.caption="",this.title="",this.type=null}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],W.prototype,"altText",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],W.prototype,"caption",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],W.prototype,"title",void 0),(0,x._)([(0,G.Cb)({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"type",void 0),W=(0,x._)([(0,J.j)("esri.popup.content.mixins.MediaInfo")],W);const B=W},77891:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let B=W=class extends A.Z{constructor(ie){super(ie),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new W({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};(0,x._)([(0,G.Cb)()],B.prototype,"fieldName",void 0),(0,x._)([(0,G.Cb)()],B.prototype,"tooltip",void 0),(0,x._)([(0,G.Cb)()],B.prototype,"value",void 0),B=W=(0,x._)([(0,J.j)("esri.popup.content.support.ChartMediaInfoValueSeries")],B);const Z=B},82657:(dt,Re,T)=>{"use strict";T.d(Re,{l:()=>A});const A=(0,T(2076).w)()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"})},65560:(dt,Re,T)=>{"use strict";T.d(Re,{V:()=>J});var x=T(89594),A=T(81590),G=T(49455),Q=T(71981),H=T(52023);const J={base:T(78297).Z,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":x.Z,"column-chart":A.Z,"line-chart":Q.Z,"pie-chart":H.Z,image:G.Z}}},66845:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>U});var x=T(17626);const Q=(0,T(2076).w)()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"});Q.toJSON.bind(Q),Q.fromJSON.bind(Q);var j,W=T(86810),B=T(77712),ue=(T(85931),T(8314),T(90912)),ce=T(55342),oe=T(76898),le=T(88411),Y=T(15348);let X=j=class extends W.wq{constructor(ee){super(ee),this.dateFormat=null,this.dateTimeFormatOptions=null,this.digitSeparator=!1,this.places=null}clone(){return new j({dateFormat:this.dateFormat,digitSeparator:this.digitSeparator,places:this.places})}format(ee){return this.dateFormat?(0,le.p6)(ee,or(or({},(0,le.Ze)(this.dateFormat)),this.dateTimeFormatOptions)):(0,Y.uf)(ee,(0,Y.sh)(this))}formatRasterPixelValue(ee){let $,ne;return ee.trim().includes(",")?($=",",ne=$+" ",this._formatDelimitedString(ee,$,ne,this)):ee.trim().includes(";")?($=";",ne=$+" ",this._formatDelimitedString(ee,$,ne,this)):ee.trim().includes(" ")?($=ne=" ",this._formatDelimitedString(ee,$,ne,this)):this.format(Number(ee))}_formatDelimitedString(ee,$,ne,se){return ee&&$&&ne&&se?ee.trim().split($).map(ae=>this.format(Number(ae))).join(ne):ee}};(0,x._)([(0,ce.J)(Q)],X.prototype,"dateFormat",void 0),(0,x._)([(0,B.Cb)({type:Object,json:{read:!1}})],X.prototype,"dateTimeFormatOptions",void 0),(0,x._)([(0,B.Cb)({type:Boolean,json:{write:!0}})],X.prototype,"digitSeparator",void 0),(0,x._)([(0,B.Cb)({type:ue.z8,json:{write:!0}})],X.prototype,"places",void 0),X=j=(0,x._)([(0,oe.j)("esri.popup.support.FieldInfoFormat")],X);const U=X},51686:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let B=W=class extends A.wq{constructor(ie){super(ie),this.field=null,this.order=null}clone(){return new W({field:this.field,order:this.order})}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"field",void 0),(0,x._)([(0,G.Cb)({type:["asc","desc"],json:{write:!0}})],B.prototype,"order",void 0),B=W=(0,x._)([(0,J.j)("esri.popup.support.RelatedRecordsInfoFieldOrder")],B);const Z=B},84687:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ge});var x=T(15861),A=T(17626),G=T(59318),Q=T(24263),H=T(84792),re=T(26584),J=T(86810),W=T(47996),B=T(62208),Z=T(10699),ie=T(77712),oe=(T(85931),T(8314),T(90912)),le=T(68653),Y=T(76898),j=T(2004),X=T(56683),U=T(6278),ee=T(14517);let $=class extends ee.Z{constructor(ye){super(ye),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};(0,A._)([(0,ie.Cb)()],$.prototype,"nextQueryParams",void 0),(0,A._)([(0,ie.Cb)()],$.prototype,"queryParams",void 0),(0,A._)([(0,ie.Cb)()],$.prototype,"results",void 0),(0,A._)([(0,ie.Cb)()],$.prototype,"total",void 0),$=(0,A._)([(0,Y.j)("esri.portal.PortalQueryResult")],$);const ne=$;var de,se=T(94508),ae=T(12680);let _e;const pe={PortalGroup:()=>Promise.resolve().then(T.bind(T,96245)),PortalItem:()=>Promise.resolve().then(T.bind(T,55463)),PortalUser:()=>Promise.resolve().then(T.bind(T,94508))};let he=de=class extends((0,J.eC)(W.Z)){constructor(ye){super(ye),this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=G.Z.portalUrl,this.urlKey=null,this.user=null,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(ye){return"string"==typeof ye?{url:ye}:ye}destroy(){this._esriId_credentialCreateHandle&&(this._esriId_credentialCreateHandle.remove(),this._esriId_credentialCreateHandle=null)}readAuthorizedCrossOriginDomains(ye){if(ye)for(const Me of ye)G.Z.request.trustedServers.includes(Me)||G.Z.request.trustedServers.push(Me);return ye}readDefaultBasemap(ye){return this._readBasemap(ye)}readDefaultDevBasemap(ye){return this._readBasemap(ye)}readDefaultVectorBasemap(ye){return this._readBasemap(ye)}get extraQuery(){return this.id&&this.user&&this.user.orgId&&!this.canSearchPublic?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get restUrl(){let ye=this.url;if(ye){const Me=ye.indexOf("/sharing");ye=Me>0?ye.substring(0,Me):this.url.replace(/\/+$/,""),ye+="/sharing/rest"}return ye}get thumbnailUrl(){const ye=this.restUrl,Me=this.thumbnail;return ye&&Me?this._normalizeSSL(ye+"/portals/self/resources/"+Me):null}readUrlKey(ye){return ye&&ye.toLowerCase()}readUser(ye){let Me=null;return ye&&(Me=se.default.fromJSON(ye),Me.portal=this),Me}load(ye){const Me=Promise.resolve().then(T.bind(T,73386)).then(({default:Ee})=>{(0,Z.k_)(ye),_e=Ee}).then(()=>this.sourceJSON?this.sourceJSON:this._fetchSelf(this.authMode,!1,ye)).then(Ee=>{if(Q.id){const Te=Q.id;this.credential=Te.findCredential(this.restUrl),this.credential||this.authMode!==de.AUTH_MODE_AUTO||(this._esriId_credentialCreateHandle=Te.on("credential-create",()=>{Te.findCredential(this.restUrl)&&this._signIn()}))}this.sourceJSON=Ee,this.read(Ee)});return this.addResolvingPromise(Me),Promise.resolve(this)}createElevationLayers(){var ye=this;return(0,x.Z)(function*(){yield ye.load();const Me=ye._getHelperService("defaultElevationLayers"),Ee=(yield Promise.all([T.e(8592),T.e(5810)]).then(T.bind(T,75810))).default;return Me?Me.map(Te=>new Ee({id:Te.id,url:Te.url})):[]})()}fetchBasemaps(ye,Me){const Ee=new U.Z;return Ee.query=ye||(G.Z.apiKey&&(0,ae.r)(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),Ee.disableExtraQuery=!0,this.queryGroups(Ee,Me).then(Te=>{if(Ee.num=100,Ee.query='type:"Web Map" -type:"Web Application"',Te.total){const me=Te.results[0];return Ee.sortField=me.sortField||"name",Ee.sortOrder=me.sortOrder||"desc",me.queryItems(Ee,Me)}return null}).then(Te=>{let me;return me=Te&&Te.total?Te.results.filter(Ce=>"Web Map"===Ce.type).map(Ce=>new _e({portalItem:Ce})):[],me})}fetchCategorySchema(ye){return this.hasCategorySchema?this._request(this.restUrl+"/portals/self/categorySchema",ye).then(Me=>Me.categorySchema):(0,Z.Hc)(ye)?Promise.reject((0,Z.zE)()):Promise.resolve([])}fetchFeaturedGroups(ye){const Me=this.featuredGroups,Ee=new U.Z;if(Ee.num=100,Ee.sortField="title",Me&&Me.length){const Te=[];for(const me of Me)Te.push(`(title:"${me.title}" AND owner:${me.owner})`);return Ee.query=Te.join(" OR "),this.queryGroups(Ee,ye).then(me=>me.results)}return(0,Z.Hc)(ye)?Promise.reject((0,Z.zE)()):Promise.resolve([])}fetchRegions(ye){var Ee;const Me=(null==(Ee=this.user)?void 0:Ee.culture)||this.culture||(0,X.Kd)();return this._request(this.restUrl+"/portals/regions",yi(or({},ye),{query:{culture:Me}}))}fetchSettings(ye){var Ee;const Me=(null==(Ee=this.user)?void 0:Ee.culture)||this.culture||(0,X.Kd)();return this._request(this.restUrl+"/portals/self/settings",yi(or({},ye),{query:{culture:Me}}))}static getDefault(){return de._default&&!de._default.destroyed||(de._default=new de),de._default}queryGroups(ye,Me){return this._queryPortal("/community/groups",ye,"PortalGroup",Me)}queryItems(ye,Me){return this._queryPortal("/search",ye,"PortalItem",Me)}queryUsers(ye,Me){return ye.sortField||(ye.sortField="username"),this._queryPortal("/community/users",ye,"PortalUser",Me)}toJSON(){throw new re.Z("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(ye){if(!ye)return null;if(ye.declaredClass)throw new Error("JSON object is already hydrated");return new de({sourceJSON:ye})}_getHelperService(ye){const Me=this.helperServices&&this.helperServices[ye];if(!Me)throw new re.Z("portal:service-not-found",`The \`helperServices\` do not include an entry named "${ye}"`);return Me}_getHelperServiceUrl(ye){const Me=this._getHelperService(ye);if(!Me.url)throw new re.Z("portal:service-url-not-found",`The \`helperServices\` entry "${ye}" does not include a \`url\` value`);return Me.url}_fetchSelf(ye=this.authMode,Me=!1,Ee){const Te=this.restUrl+"/portals/self",me=or({authMode:ye,query:{culture:(0,X.Kd)().toLowerCase()}},Ee);return"auto"===me.authMode&&(me.authMode="no-prompt"),Me&&(me.query.default=!0),this._request(Te,me)}_queryPortal(ye,Me,Ee,Te){const me=(0,oe.se)(U.Z,Me),Ce=Ie=>this._request(this.restUrl+ye,or(or({},me.toRequestOptions(this)),Te)).then(Ge=>{const Je=me.clone();return Je.start=Ge.nextStart,new ne({nextQueryParams:Je,queryParams:me,total:Ge.total,results:de._resultsToTypedArray(Ie,{portal:this},Ge,Te)})}).then(Ge=>Promise.all(Ge.results.map(Je=>"function"==typeof Je.when?Je.when():Ge)).then(()=>Ge,Je=>((0,Z.r9)(Je),Ge)));return Ee&&pe[Ee]?pe[Ee]().then(({default:Ie})=>((0,Z.k_)(Te),Ce(Ie))):Ce()}_signIn(){if(this.authMode===de.AUTH_MODE_ANONYMOUS)return Promise.reject(new re.Z("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const ye=Me=>Promise.resolve().then(()=>"not-loaded"===this.loadStatus?(Me||(this.authMode="immediate"),this.load().then(()=>null)):"loading"===this.loadStatus?this.load().then(()=>this.credential?null:(this.credential=Me,this._fetchSelf("immediate"))):this.user&&this.credential===Me?null:(this.credential=Me,this._fetchSelf("immediate"))).then(Ee=>{Ee&&(this.sourceJSON=Ee,this.read(Ee))});return Q.id?Q.id.getCredential(this.restUrl).then(Me=>ye(Me)):ye(this.credential)}_normalizeSSL(ye){return ye.replace(/^http:/i,"https:").replace(":7080",":7443")}_normalizeUrl(ye){const Me=this.credential&&this.credential.token;return this._normalizeSSL(Me?ye+(ye.includes("?")?"&":"?")+"token="+Me:ye)}_requestToTypedArray(ye,Me,Ee){return this._request(ye,Me).then(Te=>{const me=de._resultsToTypedArray(Ee,{portal:this},Te);return Promise.all(me.map(Ce=>"function"==typeof Ce.when?Ce.when():Te)).then(()=>me,()=>me)})}_readBasemap(ye){if(ye){const Me=_e.fromJSON(ye);return Me.portalItem={portal:this},Me}return null}_request(ye,Me={}){const Ee=or({f:"json"},Me.query),{authMode:Te=(this.authMode===de.AUTH_MODE_ANONYMOUS?"anonymous":"auto"),body:me=null,cacheBust:Ce=!1,method:Ie="auto",responseType:Ge="json",signal:Je}=Me,xe={authMode:Te,body:me,cacheBust:Ce,method:Ie,query:Ee,responseType:Ge,timeout:0,signal:Je};return(0,H.default)(this._normalizeSSL(ye),xe).then(je=>je.data)}static _resultsToTypedArray(ye,Me,Ee,Te){let me;if(Ee){const Ce=(0,B.pC)(Te)?Te.signal:null;me=Ee.listings||Ee.notifications||Ee.userInvitations||Ee.tags||Ee.items||Ee.groups||Ee.comments||Ee.provisions||Ee.results||Ee.relatedItems||Ee,(ye||Me)&&(me=me.map(Ie=>{const Ge=Object.assign(ye?ye.fromJSON(Ie):Ie,Me);return"function"==typeof Ge.load&&Ge.load(Ce),Ge}))}else me=[];return me}};he.AUTH_MODE_ANONYMOUS="anonymous",he.AUTH_MODE_AUTO="auto",he.AUTH_MODE_IMMEDIATE="immediate",(0,A._)([(0,ie.Cb)()],he.prototype,"access",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"allSSL",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"authMode",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"authorizedCrossOriginDomains",void 0),(0,A._)([(0,le.r)("authorizedCrossOriginDomains")],he.prototype,"readAuthorizedCrossOriginDomains",null),(0,A._)([(0,ie.Cb)()],he.prototype,"basemapGalleryGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"bingKey",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canListApps",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canListData",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canListPreProvisionedItems",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canProvisionDirectPurchase",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canSearchPublic",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canShareBingPublic",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canSharePublic",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canSignInArcGIS",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"canSignInIDP",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"colorSetsGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"commentsEnabled",void 0),(0,A._)([(0,ie.Cb)({type:Date})],he.prototype,"created",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"credential",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"culture",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"currentVersion",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"customBaseUrl",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"defaultBasemap",void 0),(0,A._)([(0,le.r)("defaultBasemap")],he.prototype,"readDefaultBasemap",null),(0,A._)([(0,ie.Cb)()],he.prototype,"defaultDevBasemap",void 0),(0,A._)([(0,le.r)("defaultDevBasemap")],he.prototype,"readDefaultDevBasemap",null),(0,A._)([(0,ie.Cb)({type:j.Z})],he.prototype,"defaultExtent",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"defaultVectorBasemap",void 0),(0,A._)([(0,le.r)("defaultVectorBasemap")],he.prototype,"readDefaultVectorBasemap",null),(0,A._)([(0,ie.Cb)()],he.prototype,"description",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"devBasemapGalleryGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"eueiEnabled",void 0),(0,A._)([(0,ie.Cb)({readOnly:!0})],he.prototype,"extraQuery",null),(0,A._)([(0,ie.Cb)()],he.prototype,"featuredGroups",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"featuredItemsGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"galleryTemplatesGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"livingAtlasGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"hasCategorySchema",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"helpBase",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"helperServices",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"helpMap",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"homePageFeaturedContent",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"homePageFeaturedContentCount",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"httpPort",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"httpsPort",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"id",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"ipCntryCode",void 0),(0,A._)([(0,ie.Cb)({readOnly:!0})],he.prototype,"isOrganization",null),(0,A._)([(0,ie.Cb)()],he.prototype,"isPortal",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"isReadOnly",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"layerTemplatesGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"maxTokenExpirationMinutes",void 0),(0,A._)([(0,ie.Cb)({type:Date})],he.prototype,"modified",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"name",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"portalHostname",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"portalMode",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"portalProperties",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"region",void 0),(0,A._)([(0,ie.Cb)({readOnly:!0})],he.prototype,"restUrl",null),(0,A._)([(0,ie.Cb)()],he.prototype,"rotatorPanels",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"showHomePageDescription",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"sourceJSON",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"staticImagesUrl",void 0),(0,A._)([(0,ie.Cb)({json:{name:"2DStylesGroupQuery"}})],he.prototype,"stylesGroupQuery2d",void 0),(0,A._)([(0,ie.Cb)({json:{name:"stylesGroupQuery"}})],he.prototype,"stylesGroupQuery3d",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"supportsHostedServices",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"symbolSetsGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"templatesGroupQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"thumbnail",void 0),(0,A._)([(0,ie.Cb)({readOnly:!0})],he.prototype,"thumbnailUrl",null),(0,A._)([(0,ie.Cb)()],he.prototype,"units",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"url",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"urlKey",void 0),(0,A._)([(0,le.r)("urlKey")],he.prototype,"readUrlKey",null),(0,A._)([(0,ie.Cb)()],he.prototype,"user",void 0),(0,A._)([(0,le.r)("user")],he.prototype,"readUser",null),(0,A._)([(0,ie.Cb)()],he.prototype,"useStandardizedQuery",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"useVectorBasemaps",void 0),(0,A._)([(0,ie.Cb)()],he.prototype,"vectorBasemapGalleryGroupQuery",void 0),he=de=(0,A._)([(0,Y.j)("esri.portal.Portal")],he);const ge=he},96245:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{default:()=>ie});var x=T(17626),A=T(26584),G=T(86810),Q=T(77712),J=(T(85931),T(8314),T(90912)),W=T(76898),B=T(6278);let Z=class extends G.wq{constructor(ue){super(ue),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){const ue=this.url,ce=this.thumbnail;return ue&&ce?this.portal._normalizeUrl(`${ue}/info/${ce}?f=json`):null}get url(){const ue=this.get("portal.restUrl");return ue?ue+"/community/groups/"+this.id:null}fetchCategorySchema(ue){return this.portal._request(this.url+"/categorySchema",ue).then(ce=>{const oe=ce.categorySchema||[];return oe.some(le=>"contentCategorySetsGroupQuery.LivingAtlas"===le.source)?this._fetchCategorySchemaSet("LivingAtlas",ue):oe})}fetchMembers(ue){return this.portal._request(this.url+"/users",ue)}getThumbnailUrl(ue){let ce=this.thumbnailUrl;return ce&&ue&&(ce+=`&w=${ue}`),ce}toJSON(){throw new A.Z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(ue,ce){let oe=(0,J.se)(B.Z,ue);return parseFloat(this.portal.currentVersion)>5?(oe=oe||new B.Z,this.portal._queryPortal(`/content/groups/${this.id}/search`,oe,"PortalItem",ce)):(oe=oe?oe.clone():new B.Z,oe.query="group:"+this.id+(oe.query?" "+oe.query:""),this.portal.queryItems(oe,ce))}_fetchCategorySchemaSet(ue,ce){return this.portal._fetchSelf(this.portal.authMode,!0,ce).then(oe=>{const le=oe.contentCategorySetsGroupQuery;if(le){const Y=new B.Z;return Y.disableExtraQuery=!0,Y.num=1,Y.query=le,this.portal.queryGroups(Y,ce)}throw new A.Z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(oe=>{if(oe.total){const le=oe.results[0],Y=new B.Z;return Y.num=1,Y.query=`typekeywords:"${ue}"`,le.queryItems(Y,ce)}throw new A.Z("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(oe=>oe.total?oe.results[0].fetchData("json",ce).then(le=>{const Y=le&&le.categorySchema;return Y&&Y.length?Y:[]}):[])}};(0,x._)([(0,Q.Cb)()],Z.prototype,"access",void 0),(0,x._)([(0,Q.Cb)({type:Date})],Z.prototype,"created",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"description",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"id",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"isInvitationOnly",void 0),(0,x._)([(0,Q.Cb)({type:Date})],Z.prototype,"modified",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"owner",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"portal",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"snippet",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"sortField",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"sortOrder",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"tags",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"thumbnail",void 0),(0,x._)([(0,Q.Cb)({readOnly:!0})],Z.prototype,"thumbnailUrl",null),(0,x._)([(0,Q.Cb)()],Z.prototype,"title",void 0),(0,x._)([(0,Q.Cb)({readOnly:!0})],Z.prototype,"url",null),Z=(0,x._)([(0,W.j)("esri.portal.PortalGroup")],Z);const ie=Z},55463:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{default:()=>he});var x=T(15861),A=T(17626),G=T(54346),Q=T(26584),H=T(86810),re=T(58817),J=T(47996),W=T(62208),B=T(21726),Z=T(77712),ie=T(90912),ue=T(68653),ce=T(76898),oe=T(2004),le=T(84687),Y=T(14517),j=T(63290),ee=(T(85931),T(8314),T(66656));const $=j.Z.getLogger("esri.portal.PortalItemResource");let ne=class extends Y.Z{constructor(ge){super(ge),this.portalItem=null}normalizeCtorArgs(ge){return ge&&ge.portalItem&&ge.path?yi(or({},ge),{path:this._normalizePath(ge.path,ge.portalItem)}):ge}set path(ge){(0,W.pC)(ge)&&(0,B.YP)(ge)?$.error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",ge)}_castPath(ge){return this._normalizePath(ge,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(ge="json",ye){const Me=this.url;if((0,W.Wi)(Me))throw new Q.Z("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal._request(Me,{responseType:ge,query:{token:this.portalItem.apiKey},signal:(0,W.U2)(ye,"signal")})}update(ge,ye){var Me=this;return(0,x.Z)(function*(){return(yield Promise.resolve().then(T.bind(T,10587))).addOrUpdateResource(Me,"update",ge,ye)})()}hasPath(){return(0,W.pC)(this.path)}_normalizePath(ge,ye){return(0,W.Wi)(ge)?ge:(ge=ge.replace(/^\/+/,""),(0,W.pC)(ye)&&(0,B.YP)(ge)&&(ge=(0,B.PF)(ge,ye.itemUrl)),ge.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};(0,A._)([(0,Z.Cb)()],ne.prototype,"portalItem",void 0),(0,A._)([(0,Z.Cb)({type:String,value:null})],ne.prototype,"path",null),(0,A._)([(0,ee.p)("path")],ne.prototype,"_castPath",null),(0,A._)([(0,Z.Cb)({type:String,readOnly:!0})],ne.prototype,"url",null),(0,A._)([(0,Z.Cb)({type:String,readOnly:!0})],ne.prototype,"itemRelativeUrl",null),ne=(0,A._)([(0,ce.j)("esri.portal.PortalItemResource")],ne);const se=ne;let ae=class extends Y.Z{constructor(ge){super(ge),this.created=null,this.rating=null}};(0,A._)([(0,Z.Cb)()],ae.prototype,"created",void 0),(0,A._)([(0,Z.Cb)()],ae.prototype,"rating",void 0),ae=(0,A._)([(0,ce.j)("esri.portal.PortalRating")],ae);const de=ae;var _e;let pe=_e=class extends((0,H.eC)(J.Z)){constructor(ge){super(ge),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}static from(ge){return(0,ie.TJ)(_e,ge)}destroy(){this.portal=null}get displayName(){const ge=this.type,ye=this.typeKeywords||[];let Me=ge;return"Feature Service"===ge||"Feature Collection"===ge?Me=ye.includes("Table")?"Table":ye.includes("Route Layer")?"Route Layer":ye.includes("Markup")?"Markup":"Feature Layer":"Image Service"===ge?Me=ye.includes("Elevation 3D Layer")?"Elevation Layer":ye.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":"Scene Service"===ge?Me="Scene Layer":"Video Service"===ge?Me="Video Layer":"Scene Package"===ge?Me="Scene Layer Package":"Stream Service"===ge?Me="Feature Layer":"Geoprocessing Service"===ge&&this.portal&&this.portal.isPortal?Me=ye.includes("Web Tool")?"Tool":"Geoprocessing Service":"Geocoding Service"===ge?Me="Locator":"Geoenrichment Service"===ge?Me="GeoEnrichment Service":"Microsoft Powerpoint"===ge?Me="Microsoft PowerPoint":"GeoJson"===ge?Me="GeoJSON":"Globe Service"===ge?Me="Globe Layer":"Vector Tile Service"===ge?Me="Tile Layer":"netCDF"===ge?Me="NetCDF":"Map Service"===ge?Me=ye.includes("Spatiotemporal")||!ye.includes("Hosted Service")&&!ye.includes("Tiled")||ye.includes("Relational")?"Map Image Layer":"Tile Layer":ge&&ge.toLowerCase().includes("add in")?Me=ge.replace(/(add in)/gi,"Add-In"):"datastore catalog service"===ge?Me="Big Data File Share":"Compact Tile Package"===ge?Me="Tile Package (tpkx)":"OGCFeatureServer"===ge?Me="OGC Feature Layer":"web mapping application"===ge&&ye.includes("configurableApp")&&(Me="Instant App"),Me}readExtent(ge){return ge&&ge.length?new oe.Z(ge[0][0],ge[0][1],ge[1][0],ge[1][1]):null}get iconUrl(){const ge=this.type&&this.type.toLowerCase()||"",ye=this.typeKeywords||[];let Te,me=!1,Ce=!1,Ie=!1,Ge=!1,Je=!1,xe=!1;return ge.indexOf("service")>0||"feature collection"===ge||"kml"===ge||"wms"===ge||"wmts"===ge||"wfs"===ge?(me=ye.includes("Hosted Service"),"feature service"===ge||"feature collection"===ge||"kml"===ge||"wfs"===ge?(Ce=ye.includes("Table"),Ie=ye.includes("Route Layer"),Ge=ye.includes("Markup"),Je=ye.includes("Spatiotemporal"),xe=ye.includes("UtilityNetwork"),Te=Je&&Ce?"spatiotemporaltable":Ce?"table":Ie?"routelayer":Ge?"markup":Je?"spatiotemporal":me?"featureshosted":xe?"utilitynetwork":"features"):Te="map service"===ge||"wms"===ge||"wmts"===ge?me||ye.includes("Tiled")||"wmts"===ge?"maptiles":"mapimages":"scene service"===ge?ye.includes("Line")?"sceneweblayerline":ye.includes("3DObject")?"sceneweblayermultipatch":ye.includes("Point")?"sceneweblayerpoint":ye.includes("IntegratedMesh")?"sceneweblayermesh":ye.includes("PointCloud")?"sceneweblayerpointcloud":ye.includes("Polygon")?"sceneweblayerpolygon":ye.includes("Building")?"sceneweblayerbuilding":ye.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":"image service"===ge?ye.includes("Elevation 3D Layer")?"elevationlayer":ye.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":"stream service"===ge?"streamlayer":"video service"===ge?"mediaservice":"vector tile service"===ge?"vectortile":"datastore catalog service"===ge?"datastorecollection":"geocoding service"===ge?"geocodeservice":"geoprocessing service"===ge?ye.includes("Web Tool")&&this.portal&&this.portal.isPortal?"tool":"layers":"geodata service"===ge?"geodataservice":"layers"):Te="web map"===ge||"cityengine web scene"===ge?"maps":"web scene"===ge?ye.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":"web mapping application"===ge&&ye.includes("configurableApp")?"instantapps":"web mapping application"===ge||"mobile application"===ge||"application"===ge||"operation view"===ge||"desktop application"===ge?"apps":"map document"===ge||"map package"===ge||"published map"===ge||"scene document"===ge||"globe document"===ge||"basemap package"===ge||"mobile basemap package"===ge||"mobile map package"===ge||"project package"===ge||"project template"===ge||"pro map"===ge||"layout"===ge||"layer"===ge&&ye.includes("ArcGIS Pro")||"explorer map"===ge&&ye.indexOf("Explorer Document")?"mapsgray":"service definition"===ge||"csv"===ge||"shapefile"===ge||"cad drawing"===ge||"geojson"===ge||"360 vr experience"===ge||"netcdf"===ge||"administrative report"===ge?"datafiles":"explorer add in"===ge||"desktop add in"===ge||"windows viewer add in"===ge||"windows viewer configuration"===ge?"appsgray":"arcgis pro add in"===ge||"arcgis pro configuration"===ge?"addindesktop":"rule package"===ge||"file geodatabase"===ge||"sqlite geodatabase"===ge||"csv collection"===ge||"kml collection"===ge||"windows mobile package"===ge||"map template"===ge||"desktop application template"===ge||"gml"===ge||"arcpad package"===ge||"code sample"===ge||"form"===ge||"document link"===ge||"earth configuration"===ge||"operations dashboard add in"===ge||"rules package"===ge||"image"===ge||"workflow manager package"===ge||"explorer map"===ge&&ye.includes("Explorer Mapping Application")||ye.includes("Document")?"datafilesgray":"network analysis service"===ge||"geoprocessing service"===ge||"geodata service"===ge||"geometry service"===ge||"geoprocessing package"===ge||"locator package"===ge||"geoprocessing sample"===ge||"workflow manager service"===ge?"toolsgray":"layer"===ge||"layer package"===ge||"explorer layer"===ge?"layersgray":"scene package"===ge?"scenepackage":"mobile scene package"===ge?"mobilescenepackage":"tile package"===ge||"compact tile package"===ge?"tilepackage":"task file"===ge?"taskfile":"report template"===ge?"report-template":"statistical data collection"===ge?"statisticaldatacollection":"insights workbook"===ge?"workbook":"insights model"===ge?"insightsmodel":"insights page"===ge?"insightspage":"insights theme"===ge?"insightstheme":"hub initiative"===ge?"hubinitiative":"hubpage"===ge?"hubpage":"hub event"===ge?"hubevent":"hub site application"===ge?"hubsite":"hub project"===ge?"hubproject":"relational database connection"===ge?"relationaldatabaseconnection":"big data file share"===ge?"datastorecollection":"image collection"===ge?"imagecollection":"style"===ge?"style":"desktop style"===ge?"desktopstyle":"dashboard"===ge?"dashboard":"raster function template"===ge?"rasterprocessingtemplate":"vector tile package"===ge?"vectortilepackage":"ortho mapping project"===ge?"orthomappingproject":"ortho mapping template"===ge?"orthomappingtemplate":"solution"===ge?"solutions":"geopackage"===ge?"geopackage":"deep learning package"===ge?"deeplearningpackage":"real time analytic"===ge?"realtimeanalytics":"big data analytic"===ge?"bigdataanalytics":"feed"===ge?"feed":"excalibur imagery project"===ge?"excaliburimageryproject":"notebook"===ge?"notebook":"storymap"===ge?"storymap":"survey123 add in"===ge?"survey123addin":"mission"===ge?"mission":"mission report"===ge?"missionreport":"quickcapture project"===ge?"quickcaptureproject":"pro report"===ge?"proreport":"urban model"===ge?"urbanmodel":"web experience"===ge?"experiencebuilder":"web experience template"===ge?"webexperiencetemplate":"experience builder widget"===ge?"experiencebuilderwidget":"experience builder widget package"===ge?"experiencebuilderwidgetpackage":"workflow"===ge?"workflow":"insights script"===ge?"insightsscript":"kernel gateway connection"===ge?"kernelgatewayconnection":"hub initiative template"===ge?"hubinitiativetemplate":"storymap theme"===ge?"storymaptheme":"knowledge graph"===ge?"knowledgegraph":"native application"===ge?"nativeapp":"native application installer"===ge?"nativeappinstaller":"link chart"===ge?"linkchart":"investigation"===ge?"investigation":"ogcfeatureserver"===ge?"features":"pro project"===ge?"proproject":"insights workbook package"===ge?"insightsworkbookpackage":"apache parquet"===ge?"apacheparquet":"notebook code snippets"===ge?"notebookcodesnippets":"suitability model"===ge?"suitabilitymodel":"esri classifier definition"===ge?"classifierdefinition":"esri classification schema"===ge?"classificationschema":"insights data engineering workbook"===ge?"dataengineeringworkbook":"insights data engineering model"===ge?"dataengineeringmodel":"deep learning studio project"===ge?"deeplearningproject":"maps",Te?(0,G.V)("esri/images/portal/"+Te+"16.png"):null}get isLayer(){return["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","WMTS","WMS"].includes(this.type)}get itemUrl(){const ge=this.get("portal.restUrl");return ge&&this.id?`${ge}/content/items/${this.id}`:null}get thumbnailUrl(){const ge=this.itemUrl,ye=this.thumbnail;return ge&&ye?this.portal._normalizeUrl(`${ge}/info/${ye}?f=json`):null}get userItemUrl(){const ge=this.get("portal.restUrl");if(!ge)return null;const ye=this.owner||this.get("portal.user.username");return ye?`${ge}/content/users/${this.ownerFolder?`${ye}/${this.ownerFolder}`:ye}/items/${this.id}`:null}load(ge){this.portal||(this.portal=le.Z.getDefault());const ye=this.portal.load(ge).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?this.portal._request(this.itemUrl,{signal:(0,W.pC)(ge)?ge.signal:null,query:{token:this.apiKey}}):{}).then(Me=>{this.sourceJSON=Me,this.read(Me)});return this.addResolvingPromise(ye),Promise.resolve(this)}addRating(ge){const ye={method:"post",query:{}};return ge instanceof de&&(ge=ge.rating),isNaN(ge)||"number"!=typeof ge||(ye.query.rating=ge),this.portal._request(this.itemUrl+"/addRating",ye).then(()=>new de({rating:ge,created:new Date}))}clone(){const ge={access:this.access,accessInformation:this.accessInformation,applicationProxies:(0,re.d9)(this.applicationProxies),avgRating:this.avgRating,categories:(0,re.d9)(this.categories),created:(0,re.d9)(this.created),culture:this.culture,description:this.description,extent:(0,re.d9)(this.extent),groupCategories:(0,re.d9)(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:(0,re.d9)(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:(0,re.d9)(this.screenshots),size:this.size,snippet:this.snippet,spatialReference:this.spatialReference,tags:(0,re.d9)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,re.d9)(this.typeKeywords),url:this.url};return this.loaded&&(ge.loadStatus="loaded"),new _e({sourceJSON:this.sourceJSON}).set(ge)}createPostQuery(){const ge=this.toJSON();for(const Me of["tags","typeKeywords","categories"])ge[Me]&&(ge[Me]=ge[Me].join(", "));const{extent:ye}=ge;return ye&&(ge.extent=JSON.stringify(ye)),ge}deleteRating(){return this.portal._request(this.itemUrl+"/deleteRating",{method:"post"}).then(()=>{})}fetchData(ge="json",ye){return this.portal._request(this.itemUrl+"/data",yi(or({responseType:ge},ye),{query:{token:this.apiKey}}))}fetchRating(ge){return this.portal._request(this.itemUrl+"/rating",or({query:{token:this.apiKey}},ge)).then(ye=>null!=ye.rating?(ye.created=new Date(ye.created),new de(ye)):null)}fetchRelatedItems(ge,ye){return this.portal._requestToTypedArray(this.itemUrl+"/relatedItems",or({query:yi(or({},ge),{token:this.apiKey})},ye),_e)}getThumbnailUrl(ge){let ye=this.thumbnailUrl;return ye&&ge&&(ye+=`&w=${ge}`),ye}reload(){return this.portal._request(this.itemUrl,{cacheBust:!0,query:{token:this.apiKey}}).then(ge=>(this.sourceJSON=ge,this.read(ge),this))}update(ge){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const ye=ge&&ge.data,Me={method:"post"};Me.query=this.createPostQuery();for(const Ee in Me.query)null===Me.query[Ee]&&(Me.query[Ee]="");return Me.query.clearEmptyFields=!0,null!=ye&&("string"==typeof ye?Me.query.text=ye:"object"==typeof ye&&(Me.query.text=JSON.stringify(ye))),this.portal._request(`${this.userItemUrl}/update`,Me).then(()=>this.reload())}):Promise.reject(new Q.Z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}updateThumbnail(ge){return this.id?this.load().then(()=>this.portal._signIn()).then(()=>{const ye=ge.thumbnail,Me=ge.filename,Ee={method:"post"};if("string"==typeof ye)Ee.query=(0,B.HK)(ye)?{data:ye}:{url:(0,B.hF)(ye)},(0,W.pC)(Me)&&(Ee.query.filename=Me);else{const Te=new FormData;(0,W.pC)(Me)?Te.append("file",ye,Me):Te.append("file",ye),Ee.body=Te}return this.portal._request(`${this.userItemUrl}/updateThumbnail`,Ee).then(()=>this.reload())}):Promise.reject(new Q.Z("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}fetchResources(ge={},ye){var Me=this;return(0,x.Z)(function*(){return(yield Promise.resolve().then(T.bind(T,10587))).fetchResources(Me,ge,ye)})()}addResource(ge,ye,Me){var Ee=this;return(0,x.Z)(function*(){const Te=yield Promise.resolve().then(T.bind(T,10587));return ge.portalItem=Ee,Te.addOrUpdateResource(ge,"add",ye,Me)})()}removeResource(ge,ye){var Me=this;return(0,x.Z)(function*(){const Ee=yield Promise.resolve().then(T.bind(T,10587));if(ge.portalItem&&ge.portalItem.itemUrl!==Me.itemUrl)throw new Q.Z("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return Ee.removeResource(Me,ge,ye)})()}removeAllResources(ge){var ye=this;return(0,x.Z)(function*(){return(yield Promise.resolve().then(T.bind(T,10587))).removeAllResources(ye,ge)})()}resourceFromPath(ge){return new se({portalItem:this,path:ge})}toJSON(){const ge=this.extent,ye={accessInformation:this.accessInformation,categories:(0,re.d9)(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:ge&&[[ge.xmin,ge.ymin],[ge.xmax,ge.ymax]],id:this.id,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,spatialReference:this.spatialReference,tags:(0,re.d9)(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:(0,re.d9)(this.typeKeywords),url:this.url};return(0,re.yd)(ye)}static fromJSON(ge){if(!ge)return null;if(ge.declaredClass)throw new Error("JSON object is already hydrated");return new _e({sourceJSON:ge})}_getPostQuery(){const ge=this.toJSON();for(const ye in ge)"tags"===ye&&null!==ge[ye]&&(ge[ye]=ge[ye].join(", ")),"typeKeywords"===ye&&null!==ge[ye]&&(ge[ye]=ge[ye].join(", ")),"extent"===ye&&ge[ye]&&(ge[ye]=JSON.stringify(ge[ye]));return ge}};(0,A._)([(0,Z.Cb)({type:["private","shared","org","public"]})],pe.prototype,"access",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"accessInformation",void 0),(0,A._)([(0,Z.Cb)({type:String})],pe.prototype,"apiKey",void 0),(0,A._)([(0,Z.Cb)({json:{read:{source:"appProxies"}}})],pe.prototype,"applicationProxies",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"avgRating",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"categories",void 0),(0,A._)([(0,Z.Cb)({type:Date})],pe.prototype,"created",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"culture",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"description",void 0),(0,A._)([(0,Z.Cb)({readOnly:!0})],pe.prototype,"displayName",null),(0,A._)([(0,Z.Cb)({type:oe.Z})],pe.prototype,"extent",void 0),(0,A._)([(0,ue.r)("extent")],pe.prototype,"readExtent",null),(0,A._)([(0,Z.Cb)()],pe.prototype,"groupCategories",void 0),(0,A._)([(0,Z.Cb)({readOnly:!0})],pe.prototype,"iconUrl",null),(0,A._)([(0,Z.Cb)()],pe.prototype,"id",void 0),(0,A._)([(0,Z.Cb)({readOnly:!0})],pe.prototype,"isLayer",null),(0,A._)([(0,Z.Cb)()],pe.prototype,"itemControl",void 0),(0,A._)([(0,Z.Cb)({readOnly:!0})],pe.prototype,"itemUrl",null),(0,A._)([(0,Z.Cb)()],pe.prototype,"licenseInfo",void 0),(0,A._)([(0,Z.Cb)({type:Date})],pe.prototype,"modified",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"name",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"numComments",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"numRatings",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"numViews",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"owner",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"ownerFolder",void 0),(0,A._)([(0,Z.Cb)({type:le.Z})],pe.prototype,"portal",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"screenshots",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"size",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"snippet",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"sourceJSON",void 0),(0,A._)([(0,Z.Cb)({type:String})],pe.prototype,"spatialReference",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"tags",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"thumbnail",void 0),(0,A._)([(0,Z.Cb)({readOnly:!0})],pe.prototype,"thumbnailUrl",null),(0,A._)([(0,Z.Cb)()],pe.prototype,"title",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"type",void 0),(0,A._)([(0,Z.Cb)()],pe.prototype,"typeKeywords",void 0),(0,A._)([(0,Z.Cb)({type:String,json:{read(ge,ye){var Ee;if("KML"!==ye.type)return ge;const Me=null==(Ee=this.portal)?void 0:Ee.restUrl;return ge||(ge=Me&&this.id?`${Me}/content/items/${this.id}/data`:null),ge}}})],pe.prototype,"url",void 0),(0,A._)([(0,Z.Cb)({readOnly:!0})],pe.prototype,"userItemUrl",null),pe=_e=(0,A._)([(0,ce.j)("esri.portal.PortalItem")],pe);const he=pe},6278:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ue,x=T(17626),A=T(14517),G=T(2076),Q=T(58817),H=T(62208),re=T(77712),W=(T(90912),T(76898)),B=T(2004),Z=T(65234),ie=T(46367);const ce=new G.X({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let oe=ue=class extends A.Z{constructor(Y){super(Y),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(Y){"asc"!==Y&&"desc"!==Y||this._set("sortOrder",Y)}clone(){return new ue({categories:this.categories?(0,Q.d9)(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(Y,j){let X,U;if(this.categories&&(X=this.categories.map(ne=>Array.isArray(ne)?JSON.stringify(ne):ne)),this.extent){const ne=(0,ie.iV)(this.extent,Z.Z.WGS84);(0,H.pC)(ne)&&(U=`${ne.xmin},${ne.ymin},${ne.xmax},${ne.ymax}`)}let ee=this.query;!this.disableExtraQuery&&Y.extraQuery&&(ee="("+ee+")"+Y.extraQuery);const $={categories:X,bbox:U,q:ee,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&($.sortField=this.sortField.split(",").map(ne=>ce.toJSON(ne.trim())).join(","),$.sortOrder=this.sortOrder),{query:or(or({},j),$)}}};(0,x._)([(0,re.Cb)()],oe.prototype,"categories",void 0),(0,x._)([(0,re.Cb)()],oe.prototype,"disableExtraQuery",void 0),(0,x._)([(0,re.Cb)({type:B.Z})],oe.prototype,"extent",void 0),(0,x._)([(0,re.Cb)()],oe.prototype,"filter",void 0),(0,x._)([(0,re.Cb)()],oe.prototype,"num",void 0),(0,x._)([(0,re.Cb)()],oe.prototype,"query",void 0),(0,x._)([(0,re.Cb)()],oe.prototype,"sortField",void 0),(0,x._)([(0,re.Cb)()],oe.prototype,"sortOrder",null),(0,x._)([(0,re.Cb)()],oe.prototype,"start",void 0),oe=ue=(0,x._)([(0,W.j)("esri.portal.PortalQueryParams")],oe);const le=oe},94508:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{default:()=>oe});var x=T(17626),A=T(26584),G=T(86810),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898));let B=class extends G.wq{constructor(le){super(le),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const le=this.get("portal.restUrl");return le?`${le}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new A.Z("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};(0,x._)([(0,Q.Cb)({type:Date})],B.prototype,"created",void 0),(0,x._)([(0,Q.Cb)()],B.prototype,"id",void 0),(0,x._)([(0,Q.Cb)()],B.prototype,"portal",void 0),(0,x._)([(0,Q.Cb)()],B.prototype,"title",void 0),(0,x._)([(0,Q.Cb)({readOnly:!0})],B.prototype,"url",null),(0,x._)([(0,Q.Cb)()],B.prototype,"username",void 0),B=(0,x._)([(0,W.j)("esri.portal.PortalFolder")],B);const Z=B;var ue,ie=T(96245);let ce=ue=class extends G.wq{constructor(...le){super(...le),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const le=this.url,Y=this.thumbnail;return le&&Y?this.portal._normalizeUrl(`${le}/info/${Y}?f=json`):null}get userContentUrl(){const le=this.get("portal.restUrl");return le?`${le}/content/users/${this.username}`:null}get url(){const le=this.get("portal.restUrl");return le?`${le}/community/users/${this.username}`:null}addItem(le){const Y=le&&le.item,j=le&&le.data,X=le&&le.folder,U={method:"post"};Y&&(U.query=Y.createPostQuery(),null!=j&&("string"==typeof j?U.query.text=j:"object"==typeof j&&(U.query.text=JSON.stringify(j))));let ee=this.userContentUrl;return X&&(ee+="/"+("string"==typeof X?X:X.id)),this.portal._request(ee+"/addItem",U).then($=>(Y.id=$.id,Y.portal=this.portal,Y.loaded?Y.reload():Y.load()))}deleteItem(le){let Y=this.userContentUrl;return le.ownerFolder&&(Y+="/"+le.ownerFolder),this.portal._request(Y+`/items/${le.id}/delete`,{method:"post"}).then(()=>{le.id=null,le.portal=null})}deleteItems(le){const Y=this.userContentUrl+"/deleteItems",j=le.map(X=>X.id);if(j.length){const X={method:"post",query:{items:j.join(",")}};return this.portal._request(Y,X).then(()=>{le.forEach(U=>{U.id=null,U.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){return this.portal._request(this.userContentUrl,{query:{num:1}}).then(Y=>{let j;return j=Y&&Y.folders?Y.folders.map(X=>{const U=Z.fromJSON(X);return U.portal=this.portal,U}):[],j})}fetchGroups(){return this.portal._request(this.url).then(le=>{let Y;return Y=le&&le.groups?le.groups.map(j=>{const X=ie.default.fromJSON(j);return X.portal=this.portal,X}):[],Y})}fetchItems(le){le||(le={});let Y,j=this.userContentUrl;return le.folder&&(j+="/"+le.folder.id),Promise.resolve().then(T.bind(T,55463)).then(({default:X})=>(Y=X,this.portal._request(j,{query:{folders:!1,num:le.num||10,start:le.start||1,sortField:le.sortField||"created",sortOrder:le.sortOrder||"asc"}}))).then(X=>{let U;return X&&X.items?(U=X.items.map(ee=>{const $=Y.fromJSON(ee);return $.portal=this.portal,$}),Promise.all(U.map(ee=>ee.load())).catch(ee=>ee).then(()=>({items:U,nextStart:X.nextStart,total:X.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal._request(this.url+"/tags").then(le=>le.tags)}getThumbnailUrl(le){let Y=this.thumbnailUrl;return Y&&le&&(Y+=`&w=${le}`),Y}queryFavorites(le){return this.favGroupId?(this._favGroup||(this._favGroup=new ie.default({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(le)):Promise.reject(new A.Z("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new A.Z("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(le){if(!le)return null;if(le.declaredClass)throw new Error("JSON object is already hydrated");const Y=new ue;return Y.sourceJSON=le,Y.read(le),Y}};(0,x._)([(0,Q.Cb)()],ce.prototype,"access",void 0),(0,x._)([(0,Q.Cb)({type:Date})],ce.prototype,"created",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"culture",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"description",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"email",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"favGroupId",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"fullName",void 0),(0,x._)([(0,Q.Cb)({type:Date})],ce.prototype,"modified",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"orgId",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"portal",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"preferredView",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"privileges",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"region",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"role",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"roleId",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"sourceJSON",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"thumbnail",void 0),(0,x._)([(0,Q.Cb)({readOnly:!0})],ce.prototype,"thumbnailUrl",null),(0,x._)([(0,Q.Cb)()],ce.prototype,"units",void 0),(0,x._)([(0,Q.Cb)({readOnly:!0})],ce.prototype,"userContentUrl",null),(0,x._)([(0,Q.Cb)({readOnly:!0})],ce.prototype,"url",null),(0,x._)([(0,Q.Cb)()],ce.prototype,"username",void 0),(0,x._)([(0,Q.Cb)()],ce.prototype,"userType",void 0),ce=ue=(0,x._)([(0,W.j)("esri.portal.PortalUser")],ce);const oe=ce},35082:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{getGeometryServiceURL:()=>J,projectGeometry:()=>B});var x=T(15861),A=T(59318),G=T(26584),Q=T(84687),H=T(68886),re=T(77294);function J(){return W.apply(this,arguments)}function W(){return(W=(0,x.Z)(function*(ie=null,ue){var le,Y;if(A.Z.geometryServiceUrl)return A.Z.geometryServiceUrl;if(!ie)throw new G.Z("internal:geometry-service-url-not-configured");let ce;ce="portal"in ie?ie.portal||Q.Z.getDefault():ie,yield ce.load({signal:ue});const oe=null==(Y=null==(le=ce.helperServices)?void 0:le.geometry)?void 0:Y.url;if(!oe)throw new G.Z("internal:geometry-service-url-not-configured");return oe})).apply(this,arguments)}function B(ie,ue){return Z.apply(this,arguments)}function Z(){return(Z=(0,x.Z)(function*(ie,ue,ce=null,oe){const le=yield J(ce,oe),Y=new re.Z;Y.geometries=[ie],Y.outSpatialReference=ue;const j=yield(0,H.i)(le,Y,{signal:oe});if(j&&Array.isArray(j)&&1===j.length)return j[0];throw new G.Z("internal:geometry-service-projection-failed")})).apply(this,arguments)}},10587:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{addOrUpdateResource:()=>W,contentToBlob:()=>j,fetchResources:()=>re,getSiblingOfSameType:()=>U,getSiblingOfSameTypeI:()=>ee,removeAllResources:()=>ue,removeResource:()=>Z,splitPrefixFileNameAndExtension:()=>le});var x=T(15861),A=T(84792),G=T(26584),Q=T(62208),H=T(21726);function re($){return J.apply(this,arguments)}function J(){return(J=(0,x.Z)(function*($,ne={},se){yield $.load(se);const ae=(0,H.v_)($.itemUrl,"resources"),{start:de=1,num:_e=10,sortOrder:pe="asc",sortField:he="created"}=ne,ge={query:{start:de,num:_e,sortOrder:pe,sortField:he,token:$.apiKey},signal:(0,Q.U2)(se,"signal")},ye=yield $.portal._request(ae,ge);return{total:ye.total,nextStart:ye.nextStart,resources:ye.resources.map(({created:Me,size:Ee,resource:Te})=>({created:new Date(Me),size:Ee,resource:$.resourceFromPath(Te)}))}})).apply(this,arguments)}function W($,ne,se,ae){return B.apply(this,arguments)}function B(){return(B=(0,x.Z)(function*($,ne,se,ae){if(!$.hasPath())throw new G.Z(`portal-item-resource-${ne}:invalid-path`,"Resource does not have a valid path");const de=$.portalItem;yield de.load(ae);const _e=(0,H.v_)(de.userItemUrl,"add"===ne?"addResources":"updateResources"),[pe,he]=oe($.path),ge=yield j(se),ye=new FormData;return pe&&"."!==pe&&ye.append("resourcesPrefix",pe),ye.append("fileName",he),ye.append("file",ge,he),ye.append("f","json"),(0,Q.pC)(ae)&&ae.access&&ye.append("access",ae.access),yield de.portal._request(_e,{method:"post",body:ye,signal:(0,Q.U2)(ae,"signal")}),$})).apply(this,arguments)}function Z($,ne,se){return ie.apply(this,arguments)}function ie(){return(ie=(0,x.Z)(function*($,ne,se){if(!ne.hasPath())throw new G.Z("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield $.load(se);const ae=(0,H.v_)($.userItemUrl,"removeResources");yield $.portal._request(ae,{method:"post",query:{resource:ne.path},signal:(0,Q.U2)(se,"signal")}),ne.portalItem=null})).apply(this,arguments)}function ue($,ne){return ce.apply(this,arguments)}function ce(){return(ce=(0,x.Z)(function*($,ne){yield $.load(ne);const se=(0,H.v_)($.userItemUrl,"removeResources");return $.portal._request(se,{method:"post",query:{deleteAll:!0},signal:(0,Q.U2)(ne,"signal")})})).apply(this,arguments)}function oe($){const ne=$.lastIndexOf("/");return-1===ne?[".",$]:[$.slice(0,ne),$.slice(ne+1)]}function le($){const[ne,se]=function Y($){const ne=(0,H.Ml)($);return(0,Q.Wi)(ne)?[$,""]:[$.slice(0,$.length-ne.length-1),`.${ne}`]}($),[ae,de]=oe(ne);return[ae,de,se]}function j($){return X.apply(this,arguments)}function X(){return(X=(0,x.Z)(function*($){return $ instanceof Blob?$:(yield(0,A.default)($.url,{responseType:"blob"})).data})).apply(this,arguments)}function U($,ne){if(!$.hasPath())return null;const[se,,ae]=le($.path);return $.portalItem.resourceFromPath((0,H.v_)(se,ne+ae))}function ee($,ne){if(!$.hasPath())return null;const[se,,ae]=le($.path);return $.portalItem.resourceFromPath((0,H.v_)(se,ne+ae))}},58926:(dt,Re,T)=>{"use strict";T.d(Re,{v:()=>A});const A=(0,T(2076).w)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0})},4832:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ye});var ne,x=T(15861),A=T(17626),G=T(20383),Q=T(2076),H=T(58817),re=T(63290),J=T(62208),W=T(77712),B=T(66656),Z=T(55342),ie=T(68653),ue=T(76898),ce=T(99433),oe=T(90912),le=T(36630),Y=T(69357),j=T(2432),X=T(74400),U=T(76457),ee=T(10914),$=T(46679);const se=re.Z.getLogger("esri.renderers.ClassBreaksRenderer"),de="percent-of-total",_e="field",pe=new Q.X({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:de,esriNormalizeByField:_e}),he=(0,oe.se)(X.Z);let ge=ne=class extends((0,j.W)(Y.Z)){constructor(Me){super(Me),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(Me,Ee,Te){if(!Array.isArray(Me))return;let me=Ee.minValue;return Me.map(Ce=>{const Ie=new X.Z;return Ie.read(Ce,Te),null==Ie.minValue&&(Ie.minValue=me),null==Ie.maxValue&&(Ie.maxValue=Ie.minValue),me=Ie.maxValue,Ie})}writeClassBreakInfos(Me,Ee,Te,me){const Ce=Me.map(Ie=>Ie.write({},me));this._areClassBreaksConsecutive()&&Ce.forEach(Ie=>delete Ie.classMinValue),Ee[Te]=Ce}castField(Me){return null==Me?Me:"function"==typeof Me?(se.error(".field: field must be a string value"),null):(0,oe.Zs)(Me)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let Me=this._get("normalizationType");const Ee=!!this.normalizationField,Te=null!=this.normalizationTotal;return Ee||Te?(Me=(Ee?_e:Te&&de)||null,Ee&&Te&&se.warn("warning: both normalizationField and normalizationTotal are set!")):Me!==_e&&Me!==de||(Me=null),Me}set normalizationType(Me){this._set("normalizationType",Me)}addClassBreakInfo(Me,Ee,Te){let me=null;me="number"==typeof Me?new X.Z({minValue:Me,maxValue:Ee,symbol:(0,G.se)(Te)}):he((0,H.d9)(Me)),this.classBreakInfos.push(me),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(Me,Ee){const Te=this.classBreakInfos.length;for(let me=0;me<Te;me++){const Ce=[this.classBreakInfos[me].minValue,this.classBreakInfos[me].maxValue];if(Ce[0]===Me&&Ce[1]===Ee){this.classBreakInfos.splice(me,1);break}}}getBreakIndex(Me,Ee){return this.valueExpression&&((0,J.Wi)(Ee)||(0,J.Wi)(Ee.arcade))&&se.warn(""),this.valueExpression?this._getBreakIndexForExpression(Me,Ee):this._getBreakIndexForField(Me)}getClassBreakInfo(Me,Ee){var Te=this;return(0,x.Z)(function*(){let me=Ee;Te.valueExpression&&((0,J.Wi)(Ee)||(0,J.Wi)(Ee.arcade))&&(me=yi(or({},me),{arcade:yield(0,$.LC)()}));const Ce=Te.getBreakIndex(Me,me);return-1!==Ce?Te.classBreakInfos[Ce]:null})()}getSymbol(Me,Ee){if(this.valueExpression&&((0,J.Wi)(Ee)||(0,J.Wi)(Ee.arcade)))return void se.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const Te=this.getBreakIndex(Me,Ee);return Te>-1?this.classBreakInfos[Te].symbol:this.defaultSymbol}getSymbolAsync(Me,Ee){var Te=this;return(0,x.Z)(function*(){let me=Ee;if(Te.valueExpression&&((0,J.Wi)(Ee)||(0,J.Wi)(Ee.arcade))){const Ie=yield(0,$.LC)(),{arcadeUtils:Ge}=Ie;Ge.hasGeometryOperations(Te.valueExpression)&&(yield Ge.enableGeometryOperations()),me=yi(or({},me),{arcade:Ie})}const Ce=Te.getBreakIndex(Me,me);return Ce>-1?Te.classBreakInfos[Ce].symbol:Te.defaultSymbol})()}getSymbols(){const Me=[];return this.classBreakInfos.forEach(Ee=>{Ee.symbol&&Me.push(Ee.symbol)}),this.defaultSymbol&&Me.push(this.defaultSymbol),Me}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((Me,Ee)=>Me+Ee.getAttributeHash(),"")}getMeshHash(){const Me=JSON.stringify(this.backgroundFillSymbol),Ee=JSON.stringify(this.defaultSymbol),Te=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${Me}.${Ee}.${this.classBreakInfos.reduce((me,Ce)=>me+Ce.getMeshHash(),"")}.${Te}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new ne({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:(0,H.d9)(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:(0,H.d9)(this.visualVariables),legendOptions:(0,H.d9)(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}collectRequiredFields(Me,Ee){var Te=this;return(0,x.Z)(function*(){const me=[Te.collectVVRequiredFields(Me,Ee),Te.collectSymbolFields(Me,Ee)];yield Promise.all(me)})()}collectSymbolFields(Me,Ee){var Te=this;return(0,x.Z)(function*(){const me=[...Te.getSymbols().map(Ce=>Ce.collectRequiredFields(Me,Ee)),(0,le.io)(Me,Ee,Te.valueExpression)];(0,le.AB)(Me,Ee,Te.field),(0,le.AB)(Me,Ee,Te.normalizationField),yield Promise.all(me)})()}_getBreakIndexForExpression(Me,Ee){const{viewingMode:Te,scale:me,spatialReference:Ce,arcade:Ie}=(0,J.Pt)(Ee,{});let Ge=this._compiledValueExpression.valueExpression===this.valueExpression?this._compiledValueExpression.compiledFunction:null;const Je=(0,J.Wg)(Ie).arcadeUtils;if(!Ge){const je=Je.createSyntaxTree(this.valueExpression);Ge=Je.createFunction(je),this._compiledValueExpression.compiledFunction=Ge}this._compiledValueExpression.valueExpression=this.valueExpression;const xe=Je.executeFunction(Ge,Je.createExecContext(Me,Je.getViewInfo({viewingMode:Te,scale:me,spatialReference:Ce})));return this._getBreakIndexfromInfos(xe)}_getBreakIndexForField(Me){const Te=Me.attributes,me=this.normalizationType;let Ce=parseFloat(Te[this.field]);if(me){const Ie=this.normalizationTotal,Ge=parseFloat(Te[this.normalizationField]);if("log"===me)Ce=Math.log(Ce)*Math.LOG10E;else if(me!==de||isNaN(Ie)){if(me===_e&&!isNaN(Ge)){if(isNaN(Ce)||isNaN(Ge))return-1;Ce/=Ge}}else Ce=Ce/Ie*100}return this._getBreakIndexfromInfos(Ce)}_getBreakIndexfromInfos(Me){const Ee=this.isMaxInclusive;if(null!=Me&&"number"==typeof Me&&!isNaN(Me))for(let Te=0;Te<this.classBreakInfos.length;Te++){const me=[this.classBreakInfos[Te].minValue,this.classBreakInfos[Te].maxValue];if(me[0]<=Me&&(Ee?Me<=me[1]:Me<me[1]))return Te}return-1}_areClassBreaksConsecutive(){const Me=this.classBreakInfos,Ee=Me.length;for(let Te=1;Te<Ee;Te++)if(Me[Te-1].maxValue!==Me[Te].minValue)return!1;return!0}};(0,A._)([(0,W.Cb)(U.K)],ge.prototype,"backgroundFillSymbol",void 0),(0,A._)([(0,W.Cb)({type:[X.Z]})],ge.prototype,"classBreakInfos",void 0),(0,A._)([(0,ie.r)("classBreakInfos")],ge.prototype,"readClassBreakInfos",null),(0,A._)([(0,ce.c)("classBreakInfos")],ge.prototype,"writeClassBreakInfos",null),(0,A._)([(0,W.Cb)({type:String,json:{write:!0}})],ge.prototype,"defaultLabel",void 0),(0,A._)([(0,W.Cb)(U.G)],ge.prototype,"defaultSymbol",void 0),(0,A._)([(0,W.Cb)({type:String,json:{write:!0}})],ge.prototype,"field",void 0),(0,A._)([(0,B.p)("field")],ge.prototype,"castField",null),(0,A._)([(0,W.Cb)({type:Boolean})],ge.prototype,"isMaxInclusive",void 0),(0,A._)([(0,W.Cb)({type:ee.I,json:{write:!0}})],ge.prototype,"legendOptions",void 0),(0,A._)([(0,W.Cb)({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],ge.prototype,"minValue",null),(0,A._)([(0,W.Cb)({type:String,json:{write:!0}})],ge.prototype,"normalizationField",void 0),(0,A._)([(0,W.Cb)({type:Number,cast:Me=>(0,oe.q9)(Me),json:{write:!0}})],ge.prototype,"normalizationTotal",void 0),(0,A._)([(0,W.Cb)({type:pe.apiValues,value:null,json:{type:pe.jsonValues,read:pe.read,write:pe.write}})],ge.prototype,"normalizationType",null),(0,A._)([(0,Z.J)({classBreaks:"class-breaks"})],ge.prototype,"type",void 0),(0,A._)([(0,W.Cb)({type:String,json:{write:!0}})],ge.prototype,"valueExpression",void 0),(0,A._)([(0,W.Cb)({type:String,json:{write:!0}})],ge.prototype,"valueExpressionTitle",void 0),ge=ne=(0,A._)([(0,ue.j)("esri.renderers.ClassBreaksRenderer")],ge);const ye=ge},49067:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var ue,x=T(15861),A=T(17626),G=T(58817),Q=T(77712),re=(T(90912),T(76898)),J=T(99433),W=T(36630),B=T(69357),Z=T(2432),ie=T(29996);let ce=ue=class extends((0,Z.W)(B.Z)){constructor(le){super(le),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new ie.DictionaryLoader(this.url,this.config,this.fieldMap)}writeData(le,Y){le&&(Y.scalingExpressionInfo={expression:le,returnType:"number"})}writeVisualVariables(le,Y,j,X){(null==X?void 0:X.origin)||super.writeVisualVariables(le,Y,j,X)}clone(){return new ue({config:(0,G.d9)(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:(0,G.d9)(this.fieldMap),url:(0,G.d9)(this.url),visualVariables:(0,G.d9)(this.visualVariables)})}getSymbolAsync(le,Y){var j=this;return(0,x.Z)(function*(){return j._loader.getSymbolAsync(le,Y)})()}collectRequiredFields(le,Y){var j=this;return(0,x.Z)(function*(){yield j.collectVVRequiredFields(le,Y),j.scaleExpression&&(yield(0,W.io)(le,Y,j.scaleExpression));for(const X in j.fieldMap){const U=j.fieldMap[X];Y.has(U)&&le.add(U)}})()}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((le,Y)=>le+Y.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};(0,A._)([(0,Q.Cb)({type:ie.DictionaryLoader})],ce.prototype,"_loader",null),(0,A._)([(0,Q.Cb)({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],ce.prototype,"config",void 0),(0,A._)([(0,Q.Cb)({type:Object,json:{write:!0}})],ce.prototype,"fieldMap",void 0),(0,A._)([(0,Q.Cb)({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],ce.prototype,"scaleExpression",void 0),(0,A._)([(0,J.c)("scaleExpression")],ce.prototype,"writeData",null),(0,A._)([(0,Q.Cb)({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(le){return{enabled:!!le&&!!this.scaleExpression}}}}})],ce.prototype,"scaleExpressionTitle",void 0),(0,A._)([(0,Q.Cb)({type:String,json:{write:!0}})],ce.prototype,"url",void 0),(0,A._)([(0,J.c)("visualVariables")],ce.prototype,"writeVisualVariables",null),ce=ue=(0,A._)([(0,re.j)("esri.renderers.DictionaryRenderer")],ce);const oe=ce},96794:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ae});var j,x=T(15861),A=T(17626),G=T(91558),Q=T(58817),H=T(83960),J=(T(90912),T(55342)),W=T(77712),B=T(76898),Z=T(36630),ie=T(69357),ue=T(2432),ce=T(41832),oe=T(86810);T(85931),T(8314);let X=j=class extends oe.wq{constructor(){super(...arguments),this.unit=null}clone(){return new j({unit:this.unit})}};(0,A._)([(0,W.Cb)({type:String,json:{write:!0}})],X.prototype,"unit",void 0),X=j=(0,A._)([(0,B.j)("esri.renderers.support.DotDensityLegendOptions")],X);const U=X;var ne,ee=T(88493),$=T(52068);let se=ne=class extends((0,ue.W)(ie.Z)){constructor(de){super(de),this.attributes=null,this.backgroundColor=new G.Z([0,0,0,0]),this.blendDots=!0,this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new $.Z,this.dotValue=null,this.referenceDotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(de){if(null==this.referenceScale)return this.dotValue;const _e=de/this.referenceScale*this.dotValue;return _e<1?1:_e}getSymbol(){return new ee.Z({outline:this.outline})}getSymbolAsync(){var de=this;return(0,x.Z)(function*(){return de.getSymbol()})()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes&&this.attributes.reduce((de,_e)=>de+_e.getAttributeHash(),"")}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new ne({attributes:(0,Q.d9)(this.attributes),backgroundColor:(0,Q.d9)(this.backgroundColor),dotBlendingEnabled:(0,Q.d9)(this.dotBlendingEnabled),dotShape:(0,Q.d9)(this.dotShape),dotSize:(0,Q.d9)(this.dotSize),dotValue:(0,Q.d9)(this.dotValue),legendOptions:(0,Q.d9)(this.legendOptions),outline:(0,Q.d9)(this.outline),referenceScale:(0,Q.d9)(this.referenceScale),visualVariables:(0,Q.d9)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){return`${this.attributes.map(de=>de.field||de.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}collectRequiredFields(de,_e){var pe=this;return(0,x.Z)(function*(){yield pe.collectVVRequiredFields(de,_e);for(const he of pe.attributes)he.valueExpression&&(yield(0,Z.io)(de,_e,he.valueExpression)),he.field&&de.add(he.field)})()}};(0,A._)([(0,W.Cb)({type:[ce.Z],json:{write:!0}})],se.prototype,"attributes",void 0),(0,A._)([(0,W.Cb)({type:G.Z,json:{write:!0}})],se.prototype,"backgroundColor",void 0),(0,A._)([(0,W.Cb)({type:Boolean}),(0,H.B)("dotBlendingEnabled")],se.prototype,"blendDots",void 0),(0,A._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],se.prototype,"dotBlendingEnabled",void 0),(0,A._)([(0,W.Cb)({type:String,json:{write:!1}})],se.prototype,"dotShape",void 0),(0,A._)([(0,W.Cb)({type:Number,json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1}}}})],se.prototype,"dotSize",void 0),(0,A._)([(0,W.Cb)({type:U,json:{write:!0}})],se.prototype,"legendOptions",void 0),(0,A._)([(0,W.Cb)({type:$.Z,json:{default:null,write:!0}})],se.prototype,"outline",void 0),(0,A._)([(0,W.Cb)({type:Number,json:{write:!0}})],se.prototype,"dotValue",void 0),(0,A._)([(0,W.Cb)({type:Number}),(0,H.B)("dotValue")],se.prototype,"referenceDotValue",void 0),(0,A._)([(0,W.Cb)({type:Number,json:{write:!0}})],se.prototype,"referenceScale",void 0),(0,A._)([(0,W.Cb)({type:Number,json:{write:!0}})],se.prototype,"seed",void 0),(0,A._)([(0,J.J)({dotDensity:"dot-density"})],se.prototype,"type",void 0),se=ne=(0,A._)([(0,B.j)("esri.renderers.DotDensityRenderer")],se);const ae=se},69747:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ye});var x=T(15861),A=T(17626),G=T(91558),H=(T(20383),T(55538)),re=T(58817),J=T(63290),W=T(50618),B=T(23841),Z=T(77712),ie=T(52323),ce=(T(90912),T(55342)),oe=T(76898),le=T(36630),Y=T(69357),j=T(15312),X=T(52372),U=T(79608),ee=T(86810);T(85931),T(8314);let se=class extends((0,U.J)(ee.wq)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};(0,A._)([(0,Z.Cb)({type:String,json:{write:!0}})],se.prototype,"minLabel",void 0),(0,A._)([(0,Z.Cb)({type:String,json:{write:!0}})],se.prototype,"maxLabel",void 0),(0,A._)([(0,Z.Cb)({type:String,json:{write:!0}})],se.prototype,"title",void 0),se=(0,A._)([(0,oe.j)("esri.renderers.support.HeatmapLegendOptions")],se);var _e,ae=T(36859),de=T(57213);const pe=J.Z.getLogger("esri.renderers.HeatmapRenderer");function he(Me){if(null!=Me){const{maxDensity:Te,minDensity:me,radius:Ce}=Me;if(null!=Te||null!=me||null!=Ce){return WT(Me,["blurRadius","maxPixelIntensity","minPixelIntensity"])}}return Me}let ge=_e=class extends Y.Z{constructor(Me){super(Me),this.authoringInfo=null,this.colorStops=[new X.Z({ratio:0,color:new G.Z("rgba(255, 140, 0, 0)")}),new X.Z({ratio:.75,color:new G.Z("rgba(255, 140, 0, 1)")}),new X.Z({ratio:.9,color:new G.Z("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(Me){return he(Me)}get blurRadius(){return(0,ae.AJ)(this.radius)}set blurRadius(Me){const Ee=this.maxPixelIntensity,Te=this.minPixelIntensity;this._set("radius",(0,ae.k0)(Me)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",Ee*this._pixelIntensityToDensity),this._set("minDensity",Te*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(Me){this._set("maxDensity",Me*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(Me){this._set("minDensity",Me*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(ae.nu**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(Me,Ee){this._warnedProps[Me]||"user"===(0,ie.vw)(this).getDefaultOrigin()&&(this._warnedProps[Me]=!0,(0,W.Os)(()=>{(0,H.Mr)(pe,Me,{replacement:`${String(Ee)} (suggested value: ${this._get(Ee)})`,version:"4.24"})}))}read(Me,Ee){Me=he(Me),super.read(Me,Ee)}getSymbol(){const Ee=Math.min(this.radius*(0!==this.referenceScale?5:1),(0,B.Wz)(256));return new de.Z({size:Ee})}getSymbolAsync(){var Me=this;return(0,x.Z)(function*(){return Me.getSymbol()})()}getSymbols(){return[this.getSymbol()]}collectRequiredFields(Me,Ee){var Te=this;return(0,x.Z)(function*(){const me=Te.field,Ce=Te.valueExpression;me&&"string"==typeof me&&(yield(0,le.AB)(Me,Ee,me)),Ce&&"string"==typeof Ce&&(yield(0,le.io)(Me,Ee,Ce))})()}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new _e({colorStops:(0,re.d9)(this.colorStops),field:this.field,legendOptions:(0,re.d9)(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,A._)([(0,Z.Cb)({type:j.Z,json:{write:!1}})],ge.prototype,"authoringInfo",void 0),(0,A._)([(0,Z.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ge.prototype,"blurRadius",null),(0,A._)([(0,Z.Cb)({type:[X.Z],json:{write:!0}})],ge.prototype,"colorStops",void 0),(0,A._)([(0,Z.Cb)({type:String,json:{write:!0}})],ge.prototype,"field",void 0),(0,A._)([(0,Z.Cb)({type:Number,json:{write:{overridePolicy:(Me,Ee,Te)=>({enabled:null==Te})},origins:{"web-scene":{write:!1}}}})],ge.prototype,"fieldOffset",void 0),(0,A._)([(0,Z.Cb)({type:se,json:{write:!0}})],ge.prototype,"legendOptions",void 0),(0,A._)([(0,Z.Cb)({type:Number,json:{write:!0}})],ge.prototype,"maxDensity",void 0),(0,A._)([(0,Z.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ge.prototype,"maxPixelIntensity",null),(0,A._)([(0,Z.Cb)({type:Number,json:{write:!0}})],ge.prototype,"minDensity",void 0),(0,A._)([(0,Z.Cb)({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],ge.prototype,"minPixelIntensity",null),(0,A._)([(0,Z.Cb)({type:Number,cast:B.t_,json:{write:!0}})],ge.prototype,"radius",void 0),(0,A._)([(0,Z.Cb)({type:Number,range:{min:0},json:{default:0,write:!0}})],ge.prototype,"referenceScale",void 0),(0,A._)([(0,ce.J)({heatmap:"heatmap"})],ge.prototype,"type",void 0),(0,A._)([(0,Z.Cb)({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],ge.prototype,"valueExpression",void 0),(0,A._)([(0,Z.Cb)({type:String})],ge.prototype,"valueExpressionTitle",void 0),(0,A._)([(0,Z.Cb)({readOnly:!0})],ge.prototype,"_pixelIntensityToDensity",null),ge=_e=(0,A._)([(0,oe.j)("esri.renderers.HeatmapRenderer")],ge);const ye=ge},40425:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ae});var x=T(15861),A=T(17626),G=T(91558),H=(T(20383),T(79608)),re=T(23841),J=T(77712),ie=(T(85931),T(8314),T(90912),T(55342)),ue=T(76898),ce=T(36630),oe=T(69357),le=T(2432),Y=T(41832),j=T(86810);let X=class extends((0,H.J)(j.wq)){constructor(){super(...arguments),this.color=new G.Z([0,0,0,0]),this.label=null,this.threshold=0}};(0,A._)([(0,J.Cb)({type:G.Z,json:{write:!0}})],X.prototype,"color",void 0),(0,A._)([(0,J.Cb)({type:String,json:{write:!0}})],X.prototype,"label",void 0),(0,A._)([(0,J.Cb)({type:Number,range:{min:0,max:1},json:{write:!0}})],X.prototype,"threshold",void 0),X=(0,A._)([(0,ue.j)("esri.renderers.support.OthersCategory")],X);let U=class extends((0,H.J)(j.wq)){constructor(){super(...arguments),this.title=null}};(0,A._)([(0,J.Cb)({type:String,json:{write:!0}})],U.prototype,"title",void 0),U=(0,A._)([(0,ue.j)("esri.renderers.support.PieChartLegendOptions")],U);var ee=T(57213),$=T(88493),ne=T(52068);let se=class extends((0,le.W)((0,H.J)(oe.Z))){constructor(de){super(de),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new G.Z([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new X,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var de;return new ee.Z({size:this.size?this.size/2+((null==(de=this.outline)?void 0:de.width)||0):0})}getSymbolAsync(){var de=this;return(0,x.Z)(function*(){return de.getSymbol()})()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((de,_e)=>de+_e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((de,_e)=>de+JSON.stringify(_e),"")}collectRequiredFields(de,_e){var pe=this;return(0,x.Z)(function*(){yield pe.collectVVRequiredFields(de,_e);for(const he of pe.attributes)he.valueExpression&&(yield(0,ce.io)(de,_e,he.valueExpression)),he.field&&de.add(he.field)})()}};(0,A._)([(0,J.Cb)({type:[Y.Z],json:{write:!0}})],se.prototype,"attributes",void 0),(0,A._)([(0,J.Cb)({type:$.Z,json:{default:null,write:!0}})],se.prototype,"backgroundFillSymbol",void 0),(0,A._)([(0,J.Cb)({type:G.Z,json:{write:!0}})],se.prototype,"defaultColor",void 0),(0,A._)([(0,J.Cb)({type:String,json:{write:!0}})],se.prototype,"defaultLabel",void 0),(0,A._)([(0,J.Cb)({type:Number,range:{min:0,max:1},json:{write:!0}})],se.prototype,"holePercentage",void 0),(0,A._)([(0,J.Cb)({type:X,json:{write:!0}})],se.prototype,"othersCategory",void 0),(0,A._)([(0,J.Cb)({type:U,json:{write:!0}})],se.prototype,"legendOptions",void 0),(0,A._)([(0,J.Cb)({type:ne.Z,json:{default:null,write:!0}})],se.prototype,"outline",void 0),(0,A._)([(0,J.Cb)({type:Number,cast:re.t_,json:{write:!0}})],se.prototype,"size",void 0),(0,A._)([(0,ie.J)({pieChart:"pie-chart"})],se.prototype,"type",void 0),se=(0,A._)([(0,ue.j)("esri.renderers.PieChartRenderer")],se);const ae=se},69357:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var x=T(15861),A=T(17626),G=T(2076),Q=T(86810),H=T(77712),B=(T(85931),T(8314),T(90912),T(76898)),Z=T(15312);const ie=new G.X({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let ue=class extends Q.wq{constructor(oe){super(oe),this.authoringInfo=null,this.type=null}getRequiredFields(oe){var le=this;return(0,x.Z)(function*(){if(!le.collectRequiredFields)return[];const Y=new Set;return yield le.collectRequiredFields(Y,oe),Array.from(Y).sort()})()}getSymbol(oe,le){}getSymbolAsync(oe,le){return(0,x.Z)(function*(){})()}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};(0,A._)([(0,H.Cb)({type:Z.Z,json:{write:!0}})],ue.prototype,"authoringInfo",void 0),(0,A._)([(0,H.Cb)({type:ie.apiValues,readOnly:!0,json:{type:ie.jsonValues,read:!1,write:{writer:ie.write,ignoreOrigin:!0}}})],ue.prototype,"type",void 0),ue=(0,A._)([(0,B.j)("esri.renderers.Renderer")],ue);const ce=ue},40342:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var ie,x=T(15861),A=T(17626),G=T(58817),Q=T(77712),re=(T(90912),T(55342)),J=T(76898),W=T(69357),B=T(2432),Z=T(76457);let ue=ie=class extends((0,B.W)(W.Z)){constructor(oe){super(oe),this.description=null,this.label=null,this.symbol=null,this.type="simple"}collectRequiredFields(oe,le){var Y=this;return(0,x.Z)(function*(){yield Promise.all([Y.collectSymbolFields(oe,le),Y.collectVVRequiredFields(oe,le)])})()}collectSymbolFields(oe,le){var Y=this;return(0,x.Z)(function*(){yield Promise.all(Y.getSymbols().map(j=>j.collectRequiredFields(oe,le)))})()}getSymbol(oe,le){return this.symbol}getSymbolAsync(oe,le){var Y=this;return(0,x.Z)(function*(){return Y.symbol})()}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((oe,le)=>oe+le.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((oe,le)=>oe+JSON.stringify(le),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new ie({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:(0,G.d9)(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};(0,A._)([(0,Q.Cb)({type:String,json:{write:!0}})],ue.prototype,"description",void 0),(0,A._)([(0,Q.Cb)({type:String,json:{write:!0}})],ue.prototype,"label",void 0),(0,A._)([(0,Q.Cb)(Z.G)],ue.prototype,"symbol",void 0),(0,A._)([(0,re.J)({simple:"simple"})],ue.prototype,"type",void 0),ue=ie=(0,A._)([(0,J.j)("esri.renderers.SimpleRenderer")],ue);const ce=ue},14726:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Ee});var he,x=T(15861),A=T(17626),G=T(20383),Q=T(26584),H=T(58817),re=T(63290),J=T(62208),W=T(94113),B=T(77712),Z=T(66656),ie=T(55342),ue=T(68653),ce=T(76898),oe=T(99433),le=T(84682),Y=T(90912),j=T(36630),X=T(84687),U=T(69357),ee=T(2432),$=T(76457),ne=T(10914),se=T(87266),ae=T(46679),de=T(29840),_e=T(71937),pe=T(12874);const ge=re.Z.getLogger("esri.renderers.UniqueValueRenderer"),ye=(0,Y.se)(se.Z);let Me=he=class extends((0,ee.W)(U.Z)){constructor(Te){super(Te),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this.type="unique-value",this.backgroundFillSymbol=null,this.field=null,this.field2=null,this.field3=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.fieldDelimiter=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(me,Ce){if(!me&&!Ce)return;if(!me||!Ce)return{type:"complete",oldValue:me,newValue:Ce};let Ie=!1;const Ge={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let Je=0;Je<Ce.length;Je++){const xe=me.find(je=>je.value===Ce[Je].value);xe?(0,le.Hg)(xe,Ce[Je])?(Ge.changed.push({type:"complete",oldValue:xe,newValue:Ce[Je]}),Ie=!0):Ge.unchanged.push({oldValue:xe,newValue:Ce[Je]}):(Ge.added.push(Ce[Je]),Ie=!0)}for(let Je=0;Je<me.length;Je++)Ce.find(xe=>xe.value===me[Je].value)||(Ge.removed.push(me[Je]),Ie=!0);return Ie?Ge:void 0}},this._set("uniqueValueInfos",[])}get _cache(){return{compiledFunc:null}}castField(Te){return null==Te||"function"==typeof Te?Te:(0,Y.Zs)(Te)}writeField(Te,me,Ce,Ie){"string"==typeof Te?me[Ce]=Te:Ie&&Ie.messages?Ie.messages.push(new Q.Z("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):ge.error(".field: cannot write field to JSON since it's not a string value")}set defaultSymbol(Te){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",Te)}readPortal(Te,me,Ce){return Ce.portal||X.Z.getDefault()}readStyleOrigin(Te,me,Ce){if(me.styleName)return Object.freeze({styleName:me.styleName});if(me.styleUrl){const Ie=(0,de.f)(me.styleUrl,Ce);return Object.freeze({styleUrl:Ie})}}writeStyleOrigin(Te,me,Ce,Ie){Te.styleName?me.styleName=Te.styleName:Te.styleUrl&&(me.styleUrl=(0,de.t)(Te.styleUrl,Ie))}set uniqueValueInfos(Te){this.styleOrigin?ge.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",Te),this._updateValueInfoMap())}addUniqueValueInfo(Te,me){if(this.styleOrigin)return void ge.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let Ce;Ce="object"==typeof Te?ye(Te):new se.Z({value:Te,symbol:(0,G.se)(me)}),this.uniqueValueInfos.push(Ce),this._valueInfoMap[Ce.value]=Ce}removeUniqueValueInfo(Te){if(this.styleOrigin)ge.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");else for(let me=0;me<this.uniqueValueInfos.length;me++)if(this.uniqueValueInfos[me].value===Te+""){delete this._valueInfoMap[Te],this.uniqueValueInfos.splice(me,1);break}}getUniqueValueInfo(Te,me){var Ce=this;return(0,x.Z)(function*(){let Ie=me;return Ce.valueExpression&&((0,J.Wi)(me)||(0,J.Wi)(me.arcade))&&(Ie=yi(or({},Ie),{arcade:yield(0,ae.LC)()})),Ce._getUniqueValueInfo(Te,Ie)})()}getSymbol(Te,me){if(this.valueExpression&&((0,J.Wi)(me)||(0,J.Wi)(me.arcade)))return void ge.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const Ce=this._getUniqueValueInfo(Te,me);return Ce&&Ce.symbol||this.defaultSymbol}getSymbolAsync(Te,me){var Ce=this;return(0,x.Z)(function*(){let Ie=me;if(Ce.valueExpression&&((0,J.Wi)(Ie)||(0,J.Wi)(Ie.arcade))){const Je=yield(0,ae.LC)(),{arcadeUtils:xe}=Je;xe.hasGeometryOperations(Ce.valueExpression)&&(yield xe.enableGeometryOperations()),Ie=yi(or({},Ie),{arcade:Je})}const Ge=Ce._getUniqueValueInfo(Te,Ie);return Ge&&Ge.symbol||Ce.defaultSymbol})()}getSymbols(){const Te=[];for(const me of this.uniqueValueInfos)me.symbol&&Te.push(me.symbol);return this.defaultSymbol&&Te.push(this.defaultSymbol),Te}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((Te,me)=>Te+me.getAttributeHash(),"")}getMeshHash(){return`${JSON.stringify(this.backgroundFillSymbol)}.${JSON.stringify(this.defaultSymbol)}.${this.uniqueValueInfos.reduce((Te,me)=>Te+me.getMeshHash(),"")}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const Te=new he({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:(0,H.d9)(this.defaultSymbol),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:(0,H.d9)(this.visualVariables),legendOptions:(0,H.d9)(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:(0,H.d9)(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(Te._isDefaultSymbolDerived=!0),Te._set("portal",this.portal);const me=(0,H.d9)(this.uniqueValueInfos);return this.styleOrigin&&(Te._set("styleOrigin",Object.freeze((0,H.d9)(this.styleOrigin))),Object.freeze(me)),Te._set("uniqueValueInfos",me),Te._updateValueInfoMap(),Te}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}collectRequiredFields(Te,me){var Ce=this;return(0,x.Z)(function*(){const Ie=[Ce.collectVVRequiredFields(Te,me),Ce.collectSymbolFields(Te,me)];yield Promise.all(Ie)})()}collectSymbolFields(Te,me){var Ce=this;return(0,x.Z)(function*(){const Ie=[...Ce.getSymbols().map(Ge=>Ge.collectRequiredFields(Te,me)),(0,j.io)(Te,me,Ce.valueExpression)];(0,j.AB)(Te,me,Ce.field),(0,j.AB)(Te,me,Ce.field2),(0,j.AB)(Te,me,Ce.field3),yield Promise.all(Ie)})()}populateFromStyle(){return(0,_e.n2)(this.styleOrigin,{portal:this.portal}).then(Te=>{const me=[];return this._valueInfoMap={},Te&&Te.data&&Array.isArray(Te.data.items)&&Te.data.items.forEach(Ce=>{const Ie=new pe.Z({styleUrl:Te.styleUrl,styleName:Te.styleName,portal:this.portal,name:Ce.name});this.defaultSymbol||Ce.name!==Te.data.defaultItem||(this.defaultSymbol=Ie,this._isDefaultSymbolDerived=!0);const Ge=new se.Z({value:Ce.name,symbol:Ie});me.push(Ge),this._valueInfoMap[Ce.name]=Ge}),this._set("uniqueValueInfos",Object.freeze(me)),!this.defaultSymbol&&this.uniqueValueInfos.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateValueInfoMap(){this._valueInfoMap={},this.uniqueValueInfos.forEach(Te=>this._valueInfoMap[Te.value+""]=Te)}_getUniqueValueInfo(Te,me){return this.valueExpression?this._getUnqiueValueInfoForExpression(Te,me):this._getUnqiueValueInfoForFields(Te)}_getUnqiueValueInfoForExpression(Te,me){const{viewingMode:Ce,scale:Ie,spatialReference:Ge,arcade:Je}=(0,J.Pt)(me,{});let xe=this._cache.compiledFunc;const je=(0,J.Wg)(Je).arcadeUtils;if(!xe){const Ne=je.createSyntaxTree(this.valueExpression);xe=je.createFunction(Ne),this._cache.compiledFunc=xe}const We=je.executeFunction(xe,je.createExecContext(Te,je.getViewInfo({viewingMode:Ce,scale:Ie,spatialReference:Ge})));return this._valueInfoMap[We+""]}_getUnqiueValueInfoForFields(Te){const me=this.field,Ce=Te.attributes;let Ie;if("function"!=typeof me&&this.field2){const Ge=this.field2,Je=this.field3,xe=[];me&&xe.push(Ce[me]),Ge&&xe.push(Ce[Ge]),Je&&xe.push(Ce[Je]),Ie=xe.join(this.fieldDelimiter||"")}else"function"==typeof me?Ie=me(Te):me&&(Ie=Ce[me]);return this._valueInfoMap[Ie+""]}static fromPortalStyle(Te,me){const Ce=new he(me&&me.properties);Ce._set("styleOrigin",Object.freeze({styleName:Te})),Ce._set("portal",me&&me.portal||X.Z.getDefault());const Ie=Ce.populateFromStyle();return Ie.catch(Ge=>{ge.error(`#fromPortalStyle('${Te}'[, ...])`,"Failed to create unique value renderer from style name",Ge)}),Ie}static fromStyleUrl(Te,me){const Ce=new he(me&&me.properties);Ce._set("styleOrigin",Object.freeze({styleUrl:Te}));const Ie=Ce.populateFromStyle();return Ie.catch(Ge=>{ge.error(`#fromStyleUrl('${Te}'[, ...])`,"Failed to create unique value renderer from style URL",Ge)}),Ie}};(0,A._)([(0,B.Cb)({readOnly:!0})],Me.prototype,"_cache",null),(0,A._)([(0,ie.J)({uniqueValue:"unique-value"})],Me.prototype,"type",void 0),(0,A._)([(0,B.Cb)($.K)],Me.prototype,"backgroundFillSymbol",void 0),(0,A._)([(0,B.Cb)({json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],Me.prototype,"field",void 0),(0,A._)([(0,Z.p)("field")],Me.prototype,"castField",null),(0,A._)([(0,oe.c)("field")],Me.prototype,"writeField",null),(0,A._)([(0,B.Cb)({type:String,json:{write:!0}})],Me.prototype,"field2",void 0),(0,A._)([(0,B.Cb)({type:String,json:{write:!0}})],Me.prototype,"field3",void 0),(0,A._)([(0,B.Cb)({type:String,json:{write:!0}})],Me.prototype,"valueExpression",void 0),(0,A._)([(0,B.Cb)({type:String,json:{write:!0}})],Me.prototype,"valueExpressionTitle",void 0),(0,A._)([(0,B.Cb)({type:ne.I,json:{write:!0}})],Me.prototype,"legendOptions",void 0),(0,A._)([(0,B.Cb)({type:String,json:{write:!0}})],Me.prototype,"defaultLabel",void 0),(0,A._)([(0,B.Cb)((0,W.RH)(or({},$.G),{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],Me.prototype,"defaultSymbol",null),(0,A._)([(0,B.Cb)({type:String,json:{write:!0}})],Me.prototype,"fieldDelimiter",void 0),(0,A._)([(0,B.Cb)({type:X.Z,readOnly:!0})],Me.prototype,"portal",void 0),(0,A._)([(0,ue.r)("portal",["styleName"])],Me.prototype,"readPortal",null),(0,A._)([(0,B.Cb)({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],Me.prototype,"styleOrigin",void 0),(0,A._)([(0,ue.r)("styleOrigin",["styleName","styleUrl"])],Me.prototype,"readStyleOrigin",null),(0,A._)([(0,oe.c)("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],Me.prototype,"writeStyleOrigin",null),(0,A._)([(0,B.Cb)({type:[se.Z],json:{write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],Me.prototype,"uniqueValueInfos",null),Me=he=(0,A._)([(0,ce.j)("esri.renderers.UniqueValueRenderer")],Me);const Ee=Me},2432:(dt,Re,T)=>{"use strict";T.d(Re,{W:()=>Ge});var ce,x=T(15861),A=T(17626),G=T(77712),re=(T(85931),T(8314),T(90912)),J=T(68653),W=T(76898),B=T(99433),Z=T(36630),ie=T(17977),ue=T(8029);let oe=ce=class extends ie.Z{constructor(Je){super(Je),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(Je){Je&&Array.isArray(Je)&&(Je=Je.filter(xe=>!!xe)).sort((xe,je)=>xe.value-je.value),this._set("stops",Je)}clone(){return new ce({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(Je=>Je.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(Je=>Je.value||0)}};(0,A._)([(0,G.Cb)({readOnly:!0})],oe.prototype,"cache",null),(0,A._)([(0,G.Cb)({type:["color"],json:{type:["colorInfo"]}})],oe.prototype,"type",void 0),(0,A._)([(0,G.Cb)({type:String,json:{write:!0}})],oe.prototype,"normalizationField",void 0),(0,A._)([(0,G.Cb)({type:[ue.Z],json:{write:!0}})],oe.prototype,"stops",null),oe=ce=(0,A._)([(0,W.j)("esri.renderers.visualVariables.ColorVariable")],oe);const le=oe;var X,Y=T(86810),j=T(92236);let U=X=class extends Y.wq{constructor(Je){super(Je),this.label=null,this.opacity=null,this.value=null}readOpacity(Je,xe){return(0,j.b)(xe.transparency)}writeOpacity(Je,xe,je){xe[je]=(0,j.a)(Je)}clone(){return new X({label:this.label,opacity:this.opacity,value:this.value})}};(0,A._)([(0,G.Cb)({type:String,json:{write:!0}})],U.prototype,"label",void 0),(0,A._)([(0,G.Cb)({type:Number,json:{type:re.z8,write:{target:"transparency"}}})],U.prototype,"opacity",void 0),(0,A._)([(0,J.r)("opacity",["transparency"])],U.prototype,"readOpacity",null),(0,A._)([(0,B.c)("opacity")],U.prototype,"writeOpacity",null),(0,A._)([(0,G.Cb)({type:Number,json:{write:!0}})],U.prototype,"value",void 0),U=X=(0,A._)([(0,W.j)("esri.renderers.visualVariables.support.OpacityStop")],U);const ee=U;var $;let ne=$=class extends ie.Z{constructor(Je){super(Je),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(Je){Je&&Array.isArray(Je)&&(Je=Je.filter(xe=>!!xe)).sort((xe,je)=>xe.value-je.value),this._set("stops",Je)}clone(){return new $({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(Je=>Je.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(Je=>Je.value||0)}};(0,A._)([(0,G.Cb)({readOnly:!0})],ne.prototype,"cache",null),(0,A._)([(0,G.Cb)({type:["opacity"],json:{type:["transparencyInfo"]}})],ne.prototype,"type",void 0),(0,A._)([(0,G.Cb)({type:String,json:{write:!0}})],ne.prototype,"normalizationField",void 0),(0,A._)([(0,G.Cb)({type:[ee],json:{write:!0}})],ne.prototype,"stops",null),ne=$=(0,A._)([(0,W.j)("esri.renderers.visualVariables.OpacityVariable")],ne);const se=ne;var ae=T(13398),de=T(69565),_e=T(14517),pe=T(2076),he=T(63290),ge=T(14889);const ye=he.Z.getLogger("esri.renderers.visualVariables.VisualVariableFactory"),Me={color:le,size:de.Z,opacity:se,rotation:ae.Z},Ee=new pe.X({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),Te=/^\[([^\]]+)\]$/i;let me=class extends _e.Z{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(Je){if(this._resetVariables(),(Je=Je&&Je.filter(xe=>!!xe))&&Je.length){for(const xe of Je)switch(xe.type){case"color":this.colorVariables.push(xe);break;case"opacity":this.opacityVariables.push(xe);break;case"rotation":this.rotationVariables.push(xe);break;case"size":this.sizeVariables.push(xe)}this.sizeVariables.length&&this.sizeVariables.some(xe=>!!xe.target)&&Je.sort((xe,je)=>{let We=null;return We=xe.target===je.target?0:xe.target?1:-1,We});for(let xe=0;xe<Je.length;xe++)Je[xe].index=xe;this._set("visualVariables",Je)}else this._set("visualVariables",Je)}readVariables(Je,xe,je){const{rotationExpression:We,rotationType:Ne}=xe,we=We&&We.match(Te),Oe=we&&we[1];if(Oe&&(Je||(Je=[]),Je.push({type:"rotationInfo",rotationType:Ne,field:Oe})),Je)return Je.map($e=>{const Be=Ee.read($e.type),Se=Me[Be];Se||(ye.warn(`Unknown variable type: ${Be}`),je&&je.messages&&je.messages.push(new ge.Z("visual-variable:unsupported",`visualVariable of type '${Be}' is not supported`,{definition:$e,context:je})));const De=new Se;return De.read($e,je),De})}writeVariables(Je,xe){const je=[];for(const We of Je){const Ne=We.toJSON(xe);Ne&&je.push(Ne)}return je}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};(0,A._)([(0,G.Cb)()],me.prototype,"visualVariables",null),me=(0,A._)([(0,W.j)("esri.renderers.visualVariables.VisualVariableFactory")],me);const Ce=me,Ie={base:ie.Z,key:"type",typeMap:{opacity:se,color:le,rotation:ae.Z,size:de.Z}},Ge=Je=>{let xe=class extends Je{constructor(){super(...arguments),this._vvFactory=new Ce}set visualVariables(je){this._vvFactory.visualVariables=je,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(je,We,Ne){return this._vvFactory.readVariables(je,We,Ne)}writeVisualVariables(je,We,Ne,we){We[Ne]=this._vvFactory.writeVariables(je,we)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const je of this.visualVariables)if(je.arcadeRequired)return!0;return!1}hasVisualVariables(je,We){return je?this.getVisualVariablesForType(je,We).length>0:this.getVisualVariablesForType("size",We).length>0||this.getVisualVariablesForType("color",We).length>0||this.getVisualVariablesForType("opacity",We).length>0||this.getVisualVariablesForType("rotation",We).length>0}getVisualVariablesForType(je,We){const Ne=this.visualVariables;return Ne?Ne.filter(we=>we.type===je&&("string"==typeof We?we.target===We:!1!==We||!we.target)):[]}collectVVRequiredFields(je,We){var Ne=this;return(0,x.Z)(function*(){let we=[];Ne.visualVariables&&(we=we.concat(Ne.visualVariables));for(const Oe of we)Oe&&(Oe.field&&(0,Z.AB)(je,We,Oe.field),Oe.normalizationField&&(0,Z.AB)(je,We,Oe.normalizationField),Oe.valueExpression&&(yield(0,Z.io)(je,We,Oe.valueExpression)))})()}};return(0,A._)([(0,G.Cb)({types:[Ie],value:null,json:{write:!0}})],xe.prototype,"visualVariables",null),(0,A._)([(0,J.r)("visualVariables",["visualVariables","rotationType","rotationExpression"])],xe.prototype,"readVisualVariables",null),(0,A._)([(0,B.c)("visualVariables")],xe.prototype,"writeVisualVariables",null),xe=(0,A._)([(0,W.j)("esri.renderers.mixins.VisualVariablesMixin")],xe),xe}},41832:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var ie,x=T(17626),A=T(91558),G=T(86810),Q=T(63290),H=T(77712),W=(T(85931),T(8314),T(66656)),B=T(76898),Z=T(90912);const ue=Q.Z.getLogger("esri.renderers.support.AttributeColorInfo");let ce=ie=class extends G.wq{constructor(le){super(le),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(le){return null==le?le:"function"==typeof le?(ue.error(".field: field must be a string value"),null):(0,Z.Zs)(le)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new ie({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};(0,x._)([(0,H.Cb)({type:A.Z,json:{type:[Number],write:!0}})],ce.prototype,"color",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ce.prototype,"field",void 0),(0,x._)([(0,W.p)("field")],ce.prototype,"castField",null),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ce.prototype,"label",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ce.prototype,"valueExpression",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ce.prototype,"valueExpressionTitle",void 0),ce=ie=(0,x._)([(0,B.j)("esri.renderers.support.AttributeColorInfo")],ce);const oe=ce},15312:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Ce});var ie,x=T(17626),A=T(2076),G=T(86810),Q=T(58817),H=T(77712),re=T(90912),J=T(68653),W=T(76898);T(85931),T(8314);let ue=ie=class extends G.wq{constructor(Ie){super(Ie),this.minValue=0,this.maxValue=0}clone(){return new ie({minValue:this.minValue,maxValue:this.maxValue})}};var ce;(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],ue.prototype,"minValue",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],ue.prototype,"maxValue",void 0),ue=ie=(0,x._)([(0,W.j)("esri.renderer.support.AuthoringInfoClassBreakInfo")],ue);let oe=ce=class extends G.wq{constructor(Ie){super(Ie),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new ce({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:(0,Q.d9)(this.classBreakInfos)})}};(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"field",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"normalizationField",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"label",void 0),(0,x._)([(0,H.Cb)({type:[ue],json:{write:!0}})],oe.prototype,"classBreakInfos",void 0),oe=ce=(0,x._)([(0,W.j)("esri.renderers.support.AuthoringInfoFieldInfo")],oe);var Y,le=T(66656);const j=new A.X({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),X=new A.X({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),U={key:Ie=>"number"==typeof Ie?"number":"string",typeMap:{number:Number,string:String},base:null},ee=["high-to-low","above-and-below","centered-on","extremes"],$=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],ne=["seconds","minutes","hours","days","months","years"];let se=Y=class extends G.wq{constructor(Ie){super(Ie),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(Ie){return"string"==typeof Ie||"number"==typeof Ie?Ie:null}castStartTime(Ie){return"string"==typeof Ie||"number"==typeof Ie?Ie:null}get style(){return"color"===this.type?this._get("style"):null}set style(Ie){this._set("style",Ie)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(Ie){this._set("theme",Ie)}clone(){return new Y({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};(0,x._)([(0,H.Cb)({types:U,json:{write:!0}})],se.prototype,"endTime",void 0),(0,x._)([(0,le.p)("endTime")],se.prototype,"castEndTime",null),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],se.prototype,"field",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],se.prototype,"maxSliderValue",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],se.prototype,"minSliderValue",void 0),(0,x._)([(0,H.Cb)({types:U,json:{write:!0}})],se.prototype,"startTime",void 0),(0,x._)([(0,le.p)("startTime")],se.prototype,"castStartTime",null),(0,x._)([(0,H.Cb)({type:j.apiValues,value:null,json:{type:j.jsonValues,read:j.read,write:j.write}})],se.prototype,"style",null),(0,x._)([(0,H.Cb)({type:$,value:null,json:{type:$,origins:{"web-scene":{type:ee,write:{writer:(Ie,Ge)=>{ee.includes(Ie)&&(Ge.theme=Ie)}}}},write:!0}})],se.prototype,"theme",null),(0,x._)([(0,H.Cb)({type:X.apiValues,json:{type:X.jsonValues,read:X.read,write:X.write}})],se.prototype,"type",void 0),(0,x._)([(0,H.Cb)({type:ne,json:{type:ne,write:!0}})],se.prototype,"units",void 0),se=Y=(0,x._)([(0,W.j)("esri.renderers.support.AuthoringInfoVisualVariable")],se);const ae=se;var _e,de=T(79023);const pe=new A.X({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),he=new A.X({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),ge=new A.X({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),ye=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"];let me=_e=class extends G.wq{constructor(Ie){super(Ie),this.colorRamp=null,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const Ie=this._get("classificationMethod"),Ge=this.type;return Ge&&"relationship"!==Ge?"class-breaks-size"===Ge||"class-breaks-color"===Ge?Ie||"manual":null:Ie}set classificationMethod(Ie){this._set("classificationMethod",Ie)}readColorRamp(Ie){if(Ie)return(0,de.i)(Ie)}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(Ie){this._set("fields",Ie)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(Ie){this._set("field1",Ie)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(Ie){this._set("field2",Ie)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(Ie){this._set("flowTheme",Ie)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(Ie){this._set("focus",Ie)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(Ie){this._set("numClasses",Ie)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(Ie){this._set("statistics",Ie)}get standardDeviationInterval(){const Ie=this.type;return Ie&&"relationship"!==Ie&&"class-breaks-size"!==Ie&&"class-breaks-color"!==Ie||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(Ie){this._set("standardDeviationInterval",Ie)}get type(){return this._get("type")}set type(Ie){let Ge=Ie;"classed-size"===Ie?Ge="class-breaks-size":"classed-color"===Ie&&(Ge="class-breaks-color"),this._set("type",Ge)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(Ie){this._set("univariateSymbolStyle",Ie)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(Ie){this._set("univariateTheme",Ie)}clone(){return new _e({classificationMethod:this.classificationMethod,colorRamp:(0,Q.d9)(this.colorRamp),fields:this.fields&&this.fields.slice(0),field1:(0,Q.d9)(this.field1),field2:(0,Q.d9)(this.field2),focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(Ie=>Ie.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};(0,x._)([(0,H.Cb)({type:pe.apiValues,value:null,json:{type:pe.jsonValues,read:pe.read,write:pe.write,origins:{"web-document":{default:"manual",type:pe.jsonValues,read:pe.read,write:pe.write}}}})],me.prototype,"classificationMethod",null),(0,x._)([(0,H.Cb)({types:de.V,json:{write:!0}})],me.prototype,"colorRamp",void 0),(0,x._)([(0,J.r)("colorRamp")],me.prototype,"readColorRamp",null),(0,x._)([(0,H.Cb)({type:[String],value:null,json:{write:!0}})],me.prototype,"fields",null),(0,x._)([(0,H.Cb)({type:oe,value:null,json:{write:!0}})],me.prototype,"field1",null),(0,x._)([(0,H.Cb)({type:oe,value:null,json:{write:!0}})],me.prototype,"field2",null),(0,x._)([(0,H.Cb)({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],me.prototype,"flowTheme",null),(0,x._)([(0,H.Cb)({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],me.prototype,"focus",null),(0,x._)([(0,H.Cb)({type:Number,value:null,json:{type:re.z8,write:!0}})],me.prototype,"numClasses",null),(0,x._)([(0,H.Cb)({type:ye,json:{type:ye,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],me.prototype,"lengthUnit",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],me.prototype,"maxSliderValue",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],me.prototype,"minSliderValue",void 0),(0,x._)([(0,H.Cb)({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],me.prototype,"statistics",null),(0,x._)([(0,H.Cb)({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],me.prototype,"standardDeviationInterval",null),(0,x._)([(0,H.Cb)({type:he.apiValues,value:null,json:{type:he.jsonValues,read:he.read,write:he.write,origins:{"web-scene":{type:ge.jsonValues,write:{writer:ge.write,overridePolicy:Ie=>({enabled:"flow"!==Ie})}}}}})],me.prototype,"type",null),(0,x._)([(0,H.Cb)({type:[ae],json:{write:!0}})],me.prototype,"visualVariables",void 0),(0,x._)([(0,H.Cb)({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],me.prototype,"univariateSymbolStyle",null),(0,x._)([(0,H.Cb)({type:["high-to-low","above-and-below","above","below","90-10"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],me.prototype,"univariateTheme",null),me=_e=(0,x._)([(0,W.j)("esri.renderers.support.AuthoringInfo")],me);const Ce=me},74400:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(76457);let Z=B=class extends A.wq{constructor(ue){super(ue),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new B({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const ue=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${ue}`}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Z.prototype,"description",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Z.prototype,"label",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Z.prototype,"minValue",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Z.prototype,"maxValue",void 0),(0,x._)([(0,G.Cb)(W.G)],Z.prototype,"symbol",void 0),Z=B=(0,x._)([(0,J.j)("esri.renderers.support.ClassBreakInfo")],Z);const ie=Z},29996:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{DictionaryLoader:()=>oe});var x=T(15861),A=T(91558),G=T(84792),Q=T(26584),H=T(63290),re=T(93961),J=T(62208),W=T(10699),B=T(77275),Z=T(46679),ie=T(94398);const ue=H.Z.getLogger("esri.renderers.support.DictionaryLoader"),ce={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class oe{constructor(X,U,ee){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new re.Z(100),this.url=X,this.config=U,this.fieldMap=ee}getSymbolFields(){return this._symbolFields}getSymbolAsync(X,U){var ee=this;return(0,x.Z)(function*(){let $;ee._dictionaryPromise||(ee._dictionaryPromise=ee.fetchResources(U));try{$=yield ee._dictionaryPromise}catch(Me){if((0,W.D_)(Me))return ee._dictionaryPromise=null,null}const ne={};if(ee.fieldMap)for(const Me of ee._symbolFields){const Ee=ee.fieldMap[Me];ne[Me]=Ee&&null!=X.attributes[Ee]?""+X.attributes[Ee]:""}const se=$(ne,U);if(!se||"string"!=typeof se)return null;const ae=(0,B.hP)(se).toString(),de=ee._symbolCache.get(ae);if(de)return de.catch(()=>{ee._symbolCache.pop(ae)}),de;const _e=se.split(";"),pe=[],he=[];for(const Me of _e)if(Me)if(Me.includes("po:")){const Ee=Me.substr(3).split("|");if(3===Ee.length){const Te=Ee[0],me=Ee[1];let Ce=Ee[2];if("DashTemplate"===me)Ce=Ce.split(" ").map(Ie=>Number(Ie));else if("Color"===me){const Ie=new A.Z(Ce).toRgba();Ce=[Ie[0],Ie[1],Ie[2],255*Ie[3]]}else Ce=Number(Ce);he.push({primitiveName:Te,propertyName:me,value:Ce})}}else if(Me.includes("|")){for(const Ee of Me.split("|"))if(ee._itemNames.has(Ee)){pe.push(Ee);break}}else ee._itemNames.has(Me)&&pe.push(Me);const ge=!(0,J.pC)(X.geometry)||!X.geometry.hasZ&&"point"===X.geometry.type,ye=ee._cimPartsToCIMSymbol(pe,he,ge,U);return ee._symbolCache.put(ae,ye,1),ye})()}fetchResources(X){var U=this;return(0,x.Z)(function*(){if(U._dictionaryPromise)return U._dictionaryPromise;if(!U.url)return void ue.error("no valid URL!");const ee=(0,G.default)(U.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:(0,J.pC)(X)?X.signal:null}),[{data:$}]=yield Promise.all([ee,(0,Z.LC)()]);if(!$)throw U._dictionaryPromise=null,new Q.Z("esri.renderers.DictionaryRenderer","Bad dictionary data!");const ne=$.expression,se=$.authoringInfo;U._refSymbolUrlTemplate=U.url+"/"+$.cimRefTemplateUrl,U._itemNames=new Set($.itemsNames),U._symbolFields=se.symbol;const ae={};if(U.config){const _e=U.config;for(const pe in _e)ae[pe]=_e[pe]}if(se.configuration)for(const _e of se.configuration)ae.hasOwnProperty(_e.name)||(ae[_e.name]=_e.value);const de=[];if((0,J.pC)(X)&&X.fields&&U.fieldMap)for(const _e of U._symbolFields){const pe=U.fieldMap[_e],he=X.fields.filter(ge=>ge.name===pe);he.length>0&&de.push(yi(or({},he[0]),{name:_e}))}return U._dictionaryPromise=(0,Z.pp)(ne,(0,J.pC)(X)?X.spatialReference:null,de,ae).then(_e=>{const pe={scale:0};return(he,ge)=>{const ye=_e.repurposeFeature({geometry:null,attributes:he});return pe.scale=(0,J.pC)(ge)?ge.scale:void 0,_e.evaluate({$feature:ye,$view:pe})}}).catch(_e=>(ue.error("Creating dictinoary expression failed:",_e),null)),U._dictionaryPromise})()}_cimPartsToCIMSymbol(X,U,ee,$){var ne=this;return(0,x.Z)(function*(){const se=new Array(X.length);for(let _e=0;_e<X.length;_e++)se[_e]=ne._getSymbolPart(X[_e],$);const ae=yield Promise.all(se),de=ne.fieldMap;for(const _e of ae)le(_e,de);return new ie.Z({data:ne._combineSymbolParts(ae,U,ee)})})()}_getSymbolPart(X,U){var ee=this;return(0,x.Z)(function*(){if(ee._ongoingRequests.has(X))return ee._ongoingRequests.get(X).then(se=>se.data);const $=ee._refSymbolUrlTemplate.replace(/\{itemName\}/gi,X),ne=(0,G.default)($,or({responseType:"json",query:{f:"json"}},U));ee._ongoingRequests.set(X,ne);try{return(yield ne).data}catch(se){throw ee._ongoingRequests.delete(X),se}})()}_combineSymbolParts(X,U,ee){if(!X||0===X.length)return null;const $=or({},X[0]);if(X.length>1){$.symbolLayers=[];for(const ne of X)$.symbolLayers.unshift(...ne.symbolLayers)}return ee&&($.callout=ce),{type:"CIMSymbolReference",symbol:$,primitiveOverrides:U}}}function le(j,X){if(!j)return;const U=j.symbolLayers;if(!U)return;let ee=U.length;for(;ee--;){const $=U[ee];$&&!1!==$.enable&&"CIMVectorMarker"===$.type&&Y($,X)}}function Y(j,X){const U=j.markerGraphics;if(U)for(const ee of U){if(!ee)continue;const $=ee.symbol;if($)switch($.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":le($,X);break;case"CIMTextSymbol":$.fieldMap=X}}}},52372:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(91558),G=T(86810),Q=T(77712),J=(T(85931),T(8314),T(90912)),W=T(76898);let Z=B=class extends G.wq{constructor(ue){super(ue),this.color=null,this.ratio=null}clone(){return new B({color:this.color,ratio:this.ratio})}};(0,x._)([(0,Q.Cb)({type:A.Z,json:{type:[J.z8],default:null,write:!0}})],Z.prototype,"color",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:!0}})],Z.prototype,"ratio",void 0),Z=B=(0,x._)([(0,W.j)("esri.renderers.support.HeatmapColorStop")],Z);const ie=Z},10914:(dt,Re,T)=>{"use strict";T.d(Re,{I:()=>B});var W,x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let B=W=class extends A.wq{constructor(){super(...arguments),this.title=null}clone(){return new W({title:this.title})}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],B.prototype,"title",void 0),B=W=(0,x._)([(0,J.j)("esri.renderers.support.LegendOptions")],B)},87266:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(86810),G=T(77712),re=(T(85931),T(8314),T(66656)),J=T(76898),W=T(76457);let Z=B=class extends A.wq{constructor(ue){super(ue),this.description=null,this.label=null,this.symbol=null,this.value=null}castValue(ue){return null==ue||"string"==typeof ue||"number"==typeof ue?ue:`${ue}`}clone(){return new B({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const ue=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${ue}`}};(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Z.prototype,"description",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],Z.prototype,"label",void 0),(0,x._)([(0,G.Cb)(W.G)],Z.prototype,"symbol",void 0),(0,x._)([(0,G.Cb)({json:{type:String,write:{writer:(ue,ce)=>{ce.value=null==ue?void 0:ue.toString()}}}})],Z.prototype,"value",void 0),(0,x._)([(0,re.p)("value")],Z.prototype,"castValue",null),Z=B=(0,x._)([(0,J.j)("esri.renderers.support.UniqueValueInfo")],Z);const ie=Z},76457:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>re,K:()=>J});var x=T(20383),A=T(383),G=T(9461),Q=T(10012),H=T(89673);const re={types:x.QT,json:{write:{writer:G.cW},origins:{"web-scene":{types:x.f_,write:{writer:G.cW},read:{reader:(0,A.d)({types:x.f_})}}}}},J={types:{base:Q.Z,key:"type",typeMap:{"simple-fill":x.LB.typeMap["simple-fill"],"picture-fill":x.LB.typeMap["picture-fill"],"polygon-3d":x.LB.typeMap["polygon-3d"]}},json:{write:{writer:G.cW},origins:{"web-scene":{type:H.Z,write:{writer:G.cW}}}}}},36859:(dt,Re,T)=>{"use strict";T.d(Re,{AJ:()=>J,If:()=>oe,QM:()=>ie,k0:()=>re,nu:()=>H,uI:()=>B,wx:()=>le});var x=T(21286),A=T(23841),G=T(993),Q=T(4794);const H=2.4;function re(j){return(0,A.Wz)(j*H)}function J(j){return(0,A.F2)(j)/H}function W(j,X,U,ee){let{color:$,ratio:ne}=X,{color:se,ratio:ae}=U;ae===ne&&(1===ae?ne-=1e-6:ae+=1e-6);const de=(0,x.uZ)((ee-ne)/(ae-ne),0,1);(0,G.l)(j,$.toArray(),se.toArray(),de)}function B(j){const U=new Uint8ClampedArray(2048);if((j=j.filter(({ratio:ae})=>ae>=0&&ae<=1).sort((ae,de)=>ae.ratio-de.ratio).map(({color:ae,ratio:de})=>({color:ae,ratio:Math.max(de,.001)}))).length<1)return U;let ee=j[0],$=j[0],ne=1;const se=(0,Q.c)();for(let ae=0;ae<512;ae++){const de=(ae+.5)/512;for(;de>$.ratio&&ne<j.length;)ee=$,$=j[ne++];W(se,ee,$,de),U.set(se,4*ae)}return U}function ie(j,X,U,ee){const{radius:$,fieldOffset:ne,field:se}=X,ae=Math.round((0,A.F2)($)),de=new Float64Array(U*ee);let _e,pe=Number.NEGATIVE_INFINITY;const he=function Y(j,X){return null!=j?"string"==typeof X?U=>-1*+U.readAttribute(j):U=>+U.readAttribute(j)+X:U=>1}(se,ne),ge=new Set;for(const ye of j){const Me=ye.getCursor();for(;Me.next();){const Ee=Me.getObjectId();if(ge.has(Ee))continue;ge.add(Ee);const Te=Me.readLegacyPointGeometry(),me=128;if(Te.x<-me||Te.x>=U+me||Te.y<-me||Te.y>ee+me)continue;const Ce=+he(Me),Ie=Math.max(0,Math.round(Te.x)-ae),Ge=Math.max(0,Math.round(Te.y)-ae),Je=Math.min(ee,Math.round(Te.y)+ae),xe=Math.min(U,Math.round(Te.x)+ae);for(let je=Ge;je<Je;je++)for(let We=Ie;We<xe;We++){const Ne=je*U+We,we=oe(Te.x-We,Te.y-je,ae);_e=de[Ne]+=we*Ce,_e>pe&&(pe=_e)}}}return{matrix:de.buffer,max:pe}}function oe(j,X,U){const ee=Math.sqrt(j**2+X**2)/U;return ee>1?0:3/(Math.PI*U**2)*(1-ee**2)**2}function le(j,X){return"function"==typeof j?j:j?"string"==typeof X?U=>-1*+U[j]:U=>+U[j]+X:()=>1}},33474:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>re});var x=T(14889),A=T(383),G=T(32088);const H=(0,A.d)({types:G.A});function re(J,W,B){return J?J&&(J.styleName||J.styleUrl)&&"uniqueValue"!==J.type?(B&&B.messages&&B.messages.push(new x.Z("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+J.type+"'",{definition:J,context:B})),null):H(J,W,B):null}},21254:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>G});var x=T(16730),A=T(94425);const G={inches:(0,x.En)(1,"meters","inches"),feet:(0,x.En)(1,"meters","feet"),"us-feet":(0,x.En)(1,"meters","us-feet"),yards:(0,x.En)(1,"meters","yards"),miles:(0,x.En)(1,"meters","miles"),"nautical-miles":(0,x.En)(1,"meters","nautical-miles"),millimeters:(0,x.En)(1,"meters","millimeters"),centimeters:(0,x.En)(1,"meters","centimeters"),decimeters:(0,x.En)(1,"meters","decimeters"),meters:(0,x.En)(1,"meters","meters"),kilometers:(0,x.En)(1,"meters","kilometers"),"decimal-degrees":1/(0,x.ty)(1,"meters",A.sv.radius)}},39256:(dt,Re,T)=>{"use strict";T.d(Re,{Kb:()=>J,o2:()=>ce,sV:()=>ue,xn:()=>Z});var x=T(15861),A=T(91558),G=T(62208),Q=T(81808);function H(oe,le){if(!oe||oe.symbol)return null;const Y=le&&le.renderer;return oe&&(0,G.pC)(Y)&&Y.getObservationRenderer?Y.getObservationRenderer(oe):Y}function J(oe,le){const Y=H(oe,le),j=function re(oe,le){if((0,G.pC)(oe.symbol))return oe.symbol;const Y=H(oe,le);return(0,G.pC)(Y)&&"dot-density"!==Y.type?Y.getSymbol(oe,le):null}(oe,le);if((0,G.Wi)(j))return null;const X={renderer:Y,symbol:j};if((0,G.Wi)(Y)||!("visualVariables"in Y)||!Y.visualVariables)return X;const U=(0,Q.getVisualVariableValues)(Y,oe,le),ee=["proportional","proportional","proportional"];for(const{variable:$,value:ne}of U)switch($.type){case"color":X.color=ne.toRgba();break;case"size":if("outline"===$.target)X.outlineSize=ne;else{const ae=$.useSymbolValue?"symbol-value":ne;switch($.axis){case"width":ee[0]=ae;break;case"depth":ee[1]=ae;break;case"height":ee[2]=ae;break;case"width-and-depth":ee[0]=ee[1]=ae;break;default:ee[0]=ee[1]=ee[2]=ae}}break;case"opacity":X.opacity=ne;break;case"rotation":switch($.axis){case"tilt":X.tilt=ne;break;case"roll":X.roll=ne;break;default:X.heading=ne}}return"proportional"===ee[0]&&"proportional"===ee[1]&&"proportional"===ee[2]||(X.size=ee),X}function W(oe,le){return B.apply(this,arguments)}function B(){return(B=(0,x.Z)(function*(oe,le){if((0,G.pC)(oe.symbol))return oe.symbol;const Y=H(oe,le);return(0,G.pC)(Y)&&Y.getSymbolAsync(oe,le)})).apply(this,arguments)}function Z(oe,le){return ie.apply(this,arguments)}function ie(){return(ie=(0,x.Z)(function*(oe,le){const Y=H(oe,le),j=yield W(oe,le);if(!j)return null;const X={renderer:Y,symbol:j};if(!Y||!("visualVariables"in Y)||!Y.visualVariables)return X;const U=(0,Q.getVisualVariableValues)(Y,oe,le),ee=["proportional","proportional","proportional"];for(const{variable:$,value:ne}of U)if("color"===$.type)X.color=A.Z.toUnitRGBA(ne);else if("size"===$.type)if("outline"===$.target)X.outlineSize=ne;else{const se=$.axis,ae=$.useSymbolValue?"symbol-value":ne;"width"===se?ee[0]=ae:"depth"===se?ee[1]=ae:"height"===se?ee[2]=ae:ee[0]=ee[1]="width-and-depth"===se?ae:ee[2]=ae}else"opacity"===$.type?X.opacity=ne:"rotation"===$.type&&"tilt"===$.axis?X.tilt=ne:"rotation"===$.type&&"roll"===$.axis?X.roll=ne:"rotation"===$.type&&(X.heading=ne);return(isFinite(ee[0])||isFinite(ee[1])||isFinite(ee[2]))&&(X.size=ee),X})).apply(this,arguments)}function ue(oe,le=0){const Y=oe[le];return"number"==typeof Y&&isFinite(Y)?Y:null}function ce(oe){for(let le=0;le<3;le++){const Y=oe[le];if("number"==typeof Y)return isFinite(Y)?Y:0}return 0}},39683:(dt,Re,T)=>{"use strict";T.d(Re,{y:()=>H});var x=T(15861),A=T(59213),G=T(10699),Q=T(14889);function H(J,W,B){return re.apply(this,arguments)}function re(){return(re=(0,x.Z)(function*(J,W,B){const Z=J&&J.getAtOrigin&&J.getAtOrigin("renderer",W.origin);if(Z&&"unique-value"===Z.type&&Z.styleOrigin){const ie=yield(0,A.q6)(Z.populateFromStyle());if((0,G.k_)(B),!1===ie.ok){const ue=ie.error;W&&W.messages&&W.messages.push(new Q.Z("renderer:style-reference",`Failed to create unique value renderer from style reference: ${ue.message}`,{error:ue,context:W})),J.clear("renderer",W.origin)}}})).apply(this,arguments)}},32088:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>B,o:()=>Z});var x=T(4832),A=T(49067),G=T(96794),Q=T(69747),H=T(40425),re=T(69357),J=T(40342),W=T(14726);const B={key:"type",base:re.Z,typeMap:{heatmap:Q.Z,simple:J.Z,"unique-value":W.Z,"class-breaks":x.Z,"dot-density":G.Z,dictionary:A.Z,"pie-chart":H.Z},errorContext:"renderer"},Z={key:"type",base:re.Z,typeMap:{simple:J.Z,"unique-value":W.Z,"class-breaks":x.Z,heatmap:Q.Z},errorContext:"renderer"}},13398:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var Z,x=T(17626),A=T(26584),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(99433),B=T(17977);let ie=Z=class extends B.Z{constructor(ce){super(ce),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(ce,oe,le,Y){Y&&Y.messages&&Y.messages.push(new A.Z("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:`visualVariables[${this.index}].valueExpressionTitle`,context:Y}))}clone(){return new Z({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};(0,x._)([(0,G.Cb)({readOnly:!0})],ie.prototype,"cache",null),(0,x._)([(0,G.Cb)({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],ie.prototype,"axis",void 0),(0,x._)([(0,G.Cb)({type:["rotation"],json:{type:["rotationInfo"]}})],ie.prototype,"type",void 0),(0,x._)([(0,G.Cb)({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],ie.prototype,"rotationType",void 0),(0,x._)([(0,G.Cb)({type:String,json:{write:!0}})],ie.prototype,"valueExpressionTitle",void 0),(0,x._)([(0,W.c)("web-scene","valueExpressionTitle")],ie.prototype,"writeValueExpressionTitleWebScene",null),ie=Z=(0,x._)([(0,J.j)("esri.renderers.visualVariables.RotationVariable")],ie);const ue=ie},69565:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Ee});var Y,x=T(17626),A=T(26584),G=T(2076),Q=T(63290),H=T(23841),re=T(77712),B=(T(85931),T(8314),T(66656)),Z=T(68653),ie=T(76898),ue=T(99433),ce=T(17977),oe=T(86810);T(90912);let j=Y=class extends oe.wq{constructor(Te){super(Te),this.label=null,this.size=null,this.value=null}clone(){return new Y({label:this.label,size:this.size,value:this.value})}};(0,x._)([(0,re.Cb)({type:String,json:{write:!0}})],j.prototype,"label",void 0),(0,x._)([(0,re.Cb)({type:Number,cast:H.t_,json:{write:!0}})],j.prototype,"size",void 0),(0,x._)([(0,re.Cb)({type:Number,json:{write:!0}})],j.prototype,"value",void 0),j=Y=(0,x._)([(0,ie.j)("esri.renderers.visualVariables.support.SizeStop")],j);const X=j;var ee,U=T(11333);let $=ee=class extends U.Z{constructor(){super(...arguments),this.customValues=null}clone(){return new ee({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};(0,x._)([(0,re.Cb)({type:[Number],json:{write:!0}})],$.prototype,"customValues",void 0),$=ee=(0,x._)([(0,ie.j)("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],$);const ne=$;var de,se=T(86971),ae=T(81808);const _e=Q.Z.getLogger("esri.renderers.visualVariables.SizeVariable"),pe=new G.X({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),he=new G.X({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function ge(Te){if(null!=Te)return"string"==typeof Te||"number"==typeof Te?(0,H.t_)(Te):"size"===Te.type?(0,se.iY)(Te)?Te:(delete(Te=or({},Te)).type,new Me(Te)):void 0}function ye(Te,me,Ce){if("object"!=typeof Te)return Te;const Ie=new Me;return Ie.read(Te,Ce),Ie}let Me=de=class extends ce.Z{constructor(Te){super(Te),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:ae.viewScaleRE.test(this.valueExpression)}}set expression(Te){_e.warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),"view.scale"===Te?(this.valueExpression="$view.scale",this._set("expression",Te)):this._set("expression",null)}set index(Te){(0,se.iY)(this.maxSize)&&(this.maxSize.index=`visualVariables[${Te}].maxSize`),(0,se.iY)(this.minSize)&&(this.minSize.index=`visualVariables[${Te}].minSize`),this._set("index",Te)}get inputValueType(){return(0,se.PS)(this)}set maxDataValue(Te){Te&&this.stops&&(_e.warn("cannot set maxDataValue when stops is not null."),Te=null),this._set("maxDataValue",Te)}set maxSize(Te){Te&&this.stops&&(_e.warn("cannot set maxSize when stops is not null."),Te=null),this._set("maxSize",Te)}castMaxSize(Te){return ge(Te)}readMaxSize(Te,me,Ce){return ye(Te,0,Ce)}set minDataValue(Te){Te&&this.stops&&(_e.warn("cannot set minDataValue when stops is not null."),Te=null),this._set("minDataValue",Te)}set minSize(Te){Te&&this.stops&&(_e.warn("cannot set minSize when stops is not null."),Te=null),this._set("minSize",Te)}castMinSize(Te){return ge(Te)}readMinSize(Te,me,Ce){return ye(Te,0,Ce)}get arcadeRequired(){return!!this.valueExpression||this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(Te){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?Te&&Array.isArray(Te)&&(Te=Te.filter(me=>!!me)).sort((me,Ce)=>me.value-Ce.value):Te&&(_e.warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),Te=null),this._set("stops",Te)}get transformationType(){return(0,se.QW)(this,this.inputValueType)}readValueExpression(Te,me){return Te||me.expression&&"$view.scale"}writeValueExpressionWebScene(Te,me,Ce,Ie){if("$view.scale"===Te){if(Ie&&Ie.messages){const Ge=this.index;Ie.messages.push(new A.Z("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:("string"==typeof Ge?Ge:`visualVariables[${Ge}]`)+".valueExpression",context:Ie}))}}else me[Ce]=Te}readValueUnit(Te){return Te?he.read(Te):null}clone(){return new de({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,se.iY)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,se.iY)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(Te=>Te.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===se.hL.ClampedLinear){const{minSize:Te,maxSize:me}=this;return this.minSize=me,this.maxSize=Te,this}if(this.transformationType===se.hL.Stops){const Te=this.stops,me=Te.map(Ie=>Ie.size).reverse(),Ce=Te.length;for(let Ie=0;Ie<Ce;Ie++)Te[Ie].size=me[Ie];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(Te=>Te.value||0)}};(0,x._)([(0,re.Cb)({readOnly:!0})],Me.prototype,"cache",null),(0,x._)([(0,re.Cb)({type:pe.apiValues,json:{type:pe.jsonValues,origins:{"web-map":{read:!1}},read:pe.read,write:pe.write}})],Me.prototype,"axis",void 0),(0,x._)([(0,re.Cb)({type:String,value:null,json:{read:!1}})],Me.prototype,"expression",null),(0,x._)([(0,re.Cb)()],Me.prototype,"index",null),(0,x._)([(0,re.Cb)({type:String,readOnly:!0})],Me.prototype,"inputValueType",null),(0,x._)([(0,re.Cb)({type:ne,json:{write:!0}})],Me.prototype,"legendOptions",void 0),(0,x._)([(0,re.Cb)({type:Number,value:null,json:{write:!0}})],Me.prototype,"maxDataValue",null),(0,x._)([(0,re.Cb)({type:Number,value:null,json:{write:!0}})],Me.prototype,"maxSize",null),(0,x._)([(0,B.p)("maxSize")],Me.prototype,"castMaxSize",null),(0,x._)([(0,Z.r)("maxSize")],Me.prototype,"readMaxSize",null),(0,x._)([(0,re.Cb)({type:Number,value:null,json:{write:!0}})],Me.prototype,"minDataValue",null),(0,x._)([(0,re.Cb)({type:Number,value:null,json:{write:!0}})],Me.prototype,"minSize",null),(0,x._)([(0,B.p)("minSize")],Me.prototype,"castMinSize",null),(0,x._)([(0,Z.r)("minSize")],Me.prototype,"readMinSize",null),(0,x._)([(0,re.Cb)({type:String,json:{write:!0}})],Me.prototype,"normalizationField",void 0),(0,x._)([(0,re.Cb)({readOnly:!0})],Me.prototype,"arcadeRequired",null),(0,x._)([(0,re.Cb)({type:String})],Me.prototype,"scaleBy",void 0),(0,x._)([(0,re.Cb)({type:[X],value:null,json:{write:!0}})],Me.prototype,"stops",null),(0,x._)([(0,re.Cb)({type:["outline"],json:{write:!0}})],Me.prototype,"target",void 0),(0,x._)([(0,re.Cb)({type:String,readOnly:!0})],Me.prototype,"transformationType",null),(0,x._)([(0,re.Cb)({type:["size"],json:{type:["sizeInfo"]}})],Me.prototype,"type",void 0),(0,x._)([(0,re.Cb)({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Me.prototype,"useSymbolValue",void 0),(0,x._)([(0,re.Cb)({type:String,json:{write:!0}})],Me.prototype,"valueExpression",void 0),(0,x._)([(0,Z.r)("valueExpression",["valueExpression","expression"])],Me.prototype,"readValueExpression",null),(0,x._)([(0,ue.c)("web-scene","valueExpression")],Me.prototype,"writeValueExpressionWebScene",null),(0,x._)([(0,re.Cb)({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Me.prototype,"valueRepresentation",void 0),(0,x._)([(0,re.Cb)({type:he.apiValues,json:{write:he.write,origins:{"web-map":{read:!1},"web-scene":{write:!0}}}})],Me.prototype,"valueUnit",void 0),(0,x._)([(0,Z.r)("valueUnit")],Me.prototype,"readValueUnit",null),Me=de=(0,x._)([(0,ie.j)("esri.renderers.visualVariables.SizeVariable")],Me);const Ee=Me},17977:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var x=T(17626),A=T(2076),G=T(86810),Q=T(63290),H=T(77712),W=(T(85931),T(8314),T(66656)),B=T(76898),Z=T(90912),ie=T(11333);const ue=Q.Z.getLogger("esri.renderers.visualVariables.VisualVariable"),ce=new A.X({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let oe=class extends G.wq{constructor(Y){super(Y),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(Y){return null==Y?Y:"function"==typeof Y?(ue.error(".field: field must be a string value"),null):(0,Z.Zs)(Y)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};(0,x._)([(0,H.Cb)()],oe.prototype,"index",void 0),(0,x._)([(0,H.Cb)({type:ce.apiValues,readOnly:!0,json:{read:ce.read,write:ce.write}})],oe.prototype,"type",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"field",void 0),(0,x._)([(0,W.p)("field")],oe.prototype,"castField",null),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"valueExpression",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"valueExpressionTitle",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],oe.prototype,"arcadeRequired",null),(0,x._)([(0,H.Cb)({type:ie.Z,json:{write:!0}})],oe.prototype,"legendOptions",void 0),oe=(0,x._)([(0,B.j)("esri.renderers.visualVariables.VisualVariable")],oe);const le=oe},8029:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var Z,x=T(17626),A=T(91558),G=T(86810),Q=T(77712),J=(T(85931),T(8314),T(90912)),W=T(76898),B=T(99433);let ie=Z=class extends G.wq{constructor(ce){super(ce),this.color=null,this.label=null,this.value=null}writeValue(ce,oe,le){oe[le]=null==ce?0:ce}clone(){return new Z({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};(0,x._)([(0,Q.Cb)({type:A.Z,json:{type:[J.z8],write:!0}})],ie.prototype,"color",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],ie.prototype,"label",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],ie.prototype,"value",void 0),(0,x._)([(0,B.c)("value")],ie.prototype,"writeValue",null),ie=Z=(0,x._)([(0,W.j)("esri.renderers.visualVariables.support.ColorStop")],ie);const ue=ie},11333:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(10914);let B=W=class extends J.I{constructor(){super(...arguments),this.showLegend=null}clone(){return new W({title:this.title,showLegend:this.showLegend})}};(0,x._)([(0,A.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"showLegend",void 0),B=W=(0,x._)([(0,re.j)("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],B);const Z=B},86971:(dt,Re,T)=>{"use strict";var x,A,J;function G(J){return J&&"esri.renderers.visualVariables.SizeVariable"===J.declaredClass}function Q(J){return null!=J&&!isNaN(J)&&isFinite(J)}function H(J){return J.valueExpression?x.Expression:J.field&&"string"==typeof J.field?x.Field:x.Unknown}function re(J,W){return(W||H(J))===x.Unknown?A.Constant:J.stops?A.Stops:null!=J.minSize&&null!=J.maxSize&&null!=J.minDataValue&&null!=J.maxDataValue?A.ClampedLinear:"unknown"===(J.valueUnit||"unknown")?null!=J.minSize&&null!=J.minDataValue?J.minSize&&J.minDataValue?A.Proportional:A.Additive:A.Identity:A.RealWorldSize}T.d(Re,{PS:()=>H,QW:()=>re,RY:()=>x,hL:()=>A,iY:()=>G,qh:()=>Q}),(J=x||(x={})).Unknown="unknown",J.Expression="expression",J.Field="field",function(J){J.Unknown="unknown",J.Stops="stops",J.ClampedLinear="clamped-linear",J.Proportional="proportional",J.Additive="additive",J.Constant="constant",J.Identity="identity",J.RealWorldSize="real-world-size"}(A||(A={}))},81808:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{getAllSizes:()=>Me,getColor:()=>ue,getOpacity:()=>ce,getRotationAngle:()=>oe,getSize:()=>j,getSizeForValue:()=>pe,getSizeFromNumberOrVariable:()=>X,getSizeRangeAtScale:()=>he,getVisualVariableValues:()=>ge,viewScaleRE:()=>ie});var x=T(91558),A=T(88879),G=T(94573),Q=T(63290),H=T(62208),re=T(21254),J=T(86971);const W=Q.Z.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),B=new A.Z,Z=Math.PI,ie=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function ue(Ee,Te,me){const Ce="visualVariables"in Ee&&Ee.visualVariables?Ee.visualVariables.find(Be=>"color"===Be.type):Ee;if(!Ce)return;if("esri.renderers.visualVariables.ColorVariable"!==Ce.declaredClass)return void W.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const Ie="number"==typeof Te,Ge=Ie?null:Te,Je=Ge&&Ge.attributes;let xe=Ie?Te:null;const je=Ce.field,{ipData:We,hasExpression:Ne}=Ce.cache;let we=Ce.cache.compiledFunc;if(!je&&!Ne){const Be=Ce.stops;return Be&&Be[0]&&Be[0].color}if("number"!=typeof xe)if(Ne){if((0,H.Wi)(me)||(0,H.Wi)(me.arcade))return void W.error("Use of arcade expressions requires an arcade context");const Se=me.arcade.arcadeUtils,De=Se.getViewInfo({viewingMode:me.viewingMode,scale:me.scale,spatialReference:me.spatialReference}),Fe=Se.createExecContext(Ge,De);if(!we){const ve=Se.createSyntaxTree(Ce.valueExpression);we=Se.createFunction(ve),Ce.cache.compiledFunc=we}xe=Se.executeFunction(we,Fe)}else Je&&(xe=Je[je]);const Oe=Ce.normalizationField,$e=Je?parseFloat(Je[Oe]):void 0;if(null!=xe&&(!Oe||Ie||!isNaN($e)&&0!==$e)){isNaN($e)||Ie||(xe/=$e);const Be=ye(xe,We);if(Be){const Se=Be[0],De=Be[1],Fe=Se===De?Ce.stops[Se].color:x.Z.blendColors(Ce.stops[Se].color,Ce.stops[De].color,Be[2],(0,H.pC)(me)?me.color:void 0);return new x.Z(Fe)}}}function ce(Ee,Te,me){const Ce="visualVariables"in Ee&&Ee.visualVariables?Ee.visualVariables.find(Be=>"opacity"===Be.type):Ee;if(!Ce)return;if("esri.renderers.visualVariables.OpacityVariable"!==Ce.declaredClass)return void W.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const Ie="number"==typeof Te,Ge=Ie?null:Te,Je=Ge&&Ge.attributes;let xe=Ie?Te:null;const je=Ce.field,{ipData:We,hasExpression:Ne}=Ce.cache;let we=Ce.cache.compiledFunc;if(!je&&!Ne){const Be=Ce.stops;return Be&&Be[0]&&Be[0].opacity}if("number"!=typeof xe)if(Ne){if((0,H.Wi)(me)||(0,H.Wi)(me.arcade))return void W.error("Use of arcade expressions requires an arcade context");const Se=me.arcade.arcadeUtils,De=Se.getViewInfo({viewingMode:me.viewingMode,scale:me.scale,spatialReference:me.spatialReference}),Fe=Se.createExecContext(Ge,De);if(!we){const ve=Se.createSyntaxTree(Ce.valueExpression);we=Se.createFunction(ve),Ce.cache.compiledFunc=we}xe=Se.executeFunction(we,Fe)}else Je&&(xe=Je[je]);const Oe=Ce.normalizationField,$e=Je?parseFloat(Je[Oe]):void 0;if(null!=xe&&(!Oe||Ie||!isNaN($e)&&0!==$e)){isNaN($e)||Ie||(xe/=$e);const Be=ye(xe,We);if(Be){const Se=Be[0],De=Be[1];if(Se===De)return Ce.stops[Se].opacity;{const Fe=Ce.stops[Se].opacity;return Fe+(Ce.stops[De].opacity-Fe)*Be[2]}}}}function oe(Ee,Te,me){const Ce="visualVariables"in Ee&&Ee.visualVariables?Ee.visualVariables.find($e=>"rotation"===$e.type):Ee;if(!Ce)return;if("esri.renderers.visualVariables.RotationVariable"!==Ce.declaredClass)return void W.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const Ie=Ce.axis||"heading",Ge="heading"===Ie&&"arithmetic"===Ce.rotationType?90:0,Je="heading"===Ie&&"arithmetic"===Ce.rotationType?-1:1,xe="number"==typeof Te?null:Te,je=xe&&xe.attributes,We=Ce.field,{hasExpression:Ne}=Ce.cache;let we=Ce.cache.compiledFunc,Oe=0;if(!We&&!Ne)return Oe;if(Ne){if((0,H.Wi)(me)||(0,H.Wi)(me.arcade))return void W.error("Use of arcade expressions requires an arcade context");const Be=me.arcade.arcadeUtils,Se=Be.getViewInfo({viewingMode:me.viewingMode,scale:me.scale,spatialReference:me.spatialReference}),De=Be.createExecContext(xe,Se);if(!we){const Fe=Be.createSyntaxTree(Ce.valueExpression);we=Be.createFunction(Fe),Ce.cache.compiledFunc=we}Oe=Be.executeFunction(we,De)}else je&&(Oe=je[We]||0);return Oe="number"!=typeof Oe||isNaN(Oe)?null:Ge+Je*Oe,Oe}function j(Ee,Te,me){const Ce="visualVariables"in Ee&&Ee.visualVariables?Ee.visualVariables.find(Ge=>"size"===Ge.type):Ee;if(!Ce)return;if("esri.renderers.visualVariables.SizeVariable"!==Ce.declaredClass)return void W.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const Ie=pe(function le(Ee,Te,me){const Ce="number"==typeof Te,Ie=Ce?null:Te,Ge=Ie&&Ie.attributes;let Je=Ce?Te:null;const{isScaleDriven:xe}=Ee.cache;let je=Ee.cache.compiledFunc;if(xe){const Ne=(0,H.pC)(me)?me.scale:void 0,we=(0,H.pC)(me)?me.view:void 0;Je=null==Ne||"3d"===we?function Y(Ee){let Te=null,me=null;const Ce=Ee.stops;return Ce?(Te=Ce[0].value,me=Ce[Ce.length-1].value):(Te=Ee.minDataValue||0,me=Ee.maxDataValue||0),(Te+me)/2}(Ee):Ne}else if(!Ce)switch(Ee.inputValueType){case J.RY.Expression:{if((0,H.Wi)(me)||(0,H.Wi)(me.arcade))return void W.error("Use of arcade expressions requires an arcade context");const we=me.arcade.arcadeUtils,Oe=we.getViewInfo({viewingMode:me.viewingMode,scale:me.scale,spatialReference:me.spatialReference}),$e=we.createExecContext(Ie,Oe);if(!je){const Be=we.createSyntaxTree(Ee.valueExpression);je=we.createFunction(Be),Ee.cache.compiledFunc=je}Je=we.executeFunction(je,$e);break}case J.RY.Field:Ge&&(Je=Ge[Ee.field]);break;case J.RY.Unknown:Je=null}if(!(0,J.qh)(Je))return null;if(Ce||!Ee.normalizationField)return Je;const We=Ge?parseFloat(Ge[Ee.normalizationField]):null;return(0,J.qh)(We)&&0!==We?Je/We:null}(Ce,Te,me),Ce,Te,me,Ce.cache.ipData);return null==Ie||isNaN(Ie)?0:Ie}function X(Ee,Te,me){return null==Ee?null:(0,J.iY)(Ee)?j(Ee,Te,me):(0,J.qh)(Ee)?Ee:null}function U(Ee,Te,me){return(0,J.qh)(me)&&Ee>me?me:(0,J.qh)(Te)&&Ee<Te?Te:Ee}function pe(Ee,Te,me,Ce,Ie){switch(Te.transformationType){case J.hL.Additive:return function ee(Ee,Te,me,Ce){return Ee+(X(Te.minSize,me,Ce)||Te.minDataValue)}(Ee,Te,me,Ce);case J.hL.Constant:return function $(Ee,Te,me){const Ce=Ee.stops;let Ie=Ce&&Ce.length&&Ce[0].size;return null==Ie&&(Ie=Ee.minSize),X(Ie,Te,me)}(Te,me,Ce);case J.hL.ClampedLinear:return function ne(Ee,Te,me,Ce){const Ie=(Ee-Te.minDataValue)/(Te.maxDataValue-Te.minDataValue),Ge=X(Te.minSize,me,Ce),Je=X(Te.maxSize,me,Ce),xe=(0,H.pC)(Ce)?Ce.shape:void 0;if(Ee<=Te.minDataValue)return Ge;if(Ee>=Te.maxDataValue)return Je;if("area"===Te.scaleBy&&xe){const je="circle"===xe,We=je?Z*(Ge/2)**2:Ge*Ge,Ne=We+Ie*((je?Z*(Je/2)**2:Je*Je)-We);return je?2*Math.sqrt(Ne/Z):Math.sqrt(Ne)}return Ge+Ie*(Je-Ge)}(Ee,Te,me,Ce);case J.hL.Proportional:return function se(Ee,Te,me,Ce){const Ie=(0,H.pC)(Ce)?Ce.shape:void 0,Ge=Ee/Te.minDataValue,Je=X(Te.minSize,me,Ce),xe=X(Te.maxSize,me,Ce);let je=null;return je="circle"===Ie?2*Math.sqrt(Ge*(Je/2)**2):"square"===Ie||"diamond"===Ie||"image"===Ie?Math.sqrt(Ge*Je**2):Ge*Je,U(je,Je,xe)}(Ee,Te,me,Ce);case J.hL.Stops:return function ae(Ee,Te,me,Ce,Ie){const[Ge,Je,xe]=ye(Ee,Ie);if(Ge===Je)return X(Te.stops[Ge].size,me,Ce);{const je=X(Te.stops[Ge].size,me,Ce);return je+(X(Te.stops[Je].size,me,Ce)-je)*xe}}(Ee,Te,me,Ce,Ie);case J.hL.RealWorldSize:return function de(Ee,Te,me,Ce){const Ie=((0,H.pC)(Ce)&&Ce.resolution?Ce.resolution:1)*re.a[Te.valueUnit],Ge=X(Te.minSize,me,Ce),Je=X(Te.maxSize,me,Ce),{valueRepresentation:xe}=Te;let je=null;return je="area"===xe?2*Math.sqrt(Ee/Z)/Ie:"radius"===xe||"distance"===xe?2*Ee/Ie:Ee/Ie,U(je,Ge,Je)}(Ee,Te,me,Ce);case J.hL.Identity:return Ee;case J.hL.Unknown:return null}}function he(Ee,Te,me){const{isScaleDriven:Ce}=Ee.cache;if(!(Ce&&"3d"===me||Te))return null;const Ie={scale:Te,view:me};let Ge=X(Ee.minSize,B,Ie),Je=X(Ee.maxSize,B,Ie);if(null!=Ge||null!=Je){if(Ge>Je){const xe=Je;Je=Ge,Ge=xe}return{minSize:Ge,maxSize:Je}}}function ge(Ee,Te,me){if(!Ee.visualVariables)return;const Ce=[],Ie=[],Ge=[],Je=[],xe=[];for(const je of Ee.visualVariables)switch(je.type){case"color":Ie.push(je);break;case"opacity":Ge.push(je);break;case"rotation":xe.push(je);break;case"size":Je.push(je)}return Ie.forEach(je=>{const We=ue(je,Te,me);Ce.push({variable:je,value:We})}),Ge.forEach(je=>{const We=ce(je,Te,me);Ce.push({variable:je,value:We})}),xe.forEach(je=>{const We=oe(je,Te,me);Ce.push({variable:je,value:We})}),Je.forEach(je=>{const We=j(je,Te,me);Ce.push({variable:je,value:We})}),Ce.filter(je=>null!=je.value)}function ye(Ee,Te){if(!Te)return;let me=0,Ce=Te.length-1;return Te.some((Ie,Ge)=>Ee<Ie?(Ce=Ge,!0):(me=Ge,!1)),[me,Ce,(Ee-Te[me])/(Te[Ce]-Te[me])]}function Me(Ee,Te,me){const Ce=["proportional","proportional","proportional"];for(const Ie of Ee){const Ge=Ie.useSymbolValue?"symbol-value":j(Ie,Te,me);switch(Ie.axis){case"width":Ce[0]=Ge;break;case"depth":Ce[1]=Ge;break;case"height":Ce[2]=Ge;break;case"width-and-depth":Ce[0]=Ge,Ce[1]=Ge;break;case"all":case void 0:case null:Ce[0]=Ge,Ce[1]=Ge,Ce[2]=Ge;break;default:(0,G.Bg)(Ie.axis)}}return Ce}},84792:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{default:()=>ue});var x=T(15861),A=T(59318),G=T(24263),Q=T(26584),H=T(8314),re=T(58817),J=T(62208),W=T(10699),B=T(21726),Z=T(12680),ie=T(33899);function ue(we,Oe){return ce.apply(this,arguments)}function ce(){return(ce=(0,x.Z)(function*(we,Oe){var qe;const $e=(0,B.HK)(we),Be=(0,B.jc)(we);Be||$e||(we=(0,B.Fv)(we));const Se={url:we,requestOptions:or({},(0,J.Wg)(Oe))};let De=(0,B.oh)(we);if(De){const be=yield me(De,Se);if(null!=be)return{data:be,getHeader:ee,requestOptions:Se.requestOptions,url:Se.url};De.after||De.error||(De=null)}if(we=Se.url,"image"===(Oe=Se.requestOptions).responseType){if((0,H.Z)("host-webworker")||(0,H.Z)("host-node"))throw ae("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),Se)}else if($e)throw ae("request:invalid-parameters",new Error("Data URLs are not supported for responseType = "+Oe.responseType),Se);if("head"===Oe.method){if(Oe.body)throw ae("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),Se);if($e||Be)throw ae("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),Se)}if(yield de(),oe)return oe.execute(we,Oe);const Fe=new AbortController;(0,W.fu)(Oe,()=>Fe.abort());const ve={controller:Fe,credential:null,credentialToken:null,fetchOptions:null,hasToken:!1,interceptor:De,params:Se,redoRequest:!1,useIdentity:le.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},Ke=yield Je(ve);return null==(qe=null==De?void 0:De.after)||qe.call(De,Ke),Ke})).apply(this,arguments)}let oe;const le=A.Z.request,Y="FormData"in globalThis,j=[499,498,403,401],X=["COM_0056","COM_0057","SB_0008"],U=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],ee=()=>null,$=Symbol();function ne(we){const Oe=(0,B.P$)(we);Oe&&!ue._corsServers.includes(Oe)&&ue._corsServers.push(Oe)}function se(we){const Oe=(0,B.P$)(we);return!Oe||Oe.endsWith(".arcgis.com")||ue._corsServers.includes(Oe)||(0,B.kl)(Oe)}function ae(we,Oe,$e,Be){let Se="Error";const De={url:$e.url,requestOptions:$e.requestOptions,getHeader:ee,ssl:!1};if(Oe instanceof Q.Z)return Oe.details?(Oe.details=(0,re.d9)(Oe.details),Oe.details.url=$e.url,Oe.details.requestOptions=$e.requestOptions):Oe.details=De,Oe;if(Oe){const Fe=Be&&(qe=>Be.headers.get(qe)),ve=Be&&Be.status,Ke=Oe.message;Ke&&(Se=Ke),Fe&&(De.getHeader=Fe),De.httpStatus=(null!=Oe.httpCode?Oe.httpCode:Oe.code)||ve||0,De.subCode=Oe.subcode,De.messageCode=Oe.messageCode,De.messages="string"==typeof Oe.details?[Oe.details]:Oe.details,De.raw=$ in Oe?Oe[$]:Oe}return(0,W.D_)(Oe)?(0,W.zE)():new Q.Z(we,Se,De)}function de(){return _e.apply(this,arguments)}function _e(){return(_e=(0,x.Z)(function*(){(0,H.Z)("host-webworker")?oe||(oe=yield T.e(3358).then(T.bind(T,23358))):ue._abortableFetch||(ue._abortableFetch=globalThis.fetch.bind(globalThis))})).apply(this,arguments)}function pe(){return he.apply(this,arguments)}function he(){return(he=(0,x.Z)(function*(){G.id||(yield T.e(9058).then(T.bind(T,59058)))})).apply(this,arguments)}function ge(we){return ye.apply(this,arguments)}function ye(){return(ye=(0,x.Z)(function*(we){var ve;const Oe=we.params.url,$e=we.params.requestOptions,Be=we.controller.signal,Se=$e.body;let De=null,Fe=null;if(Y&&"HTMLFormElement"in globalThis&&(Se instanceof FormData?De=Se:Se instanceof HTMLFormElement&&(De=new FormData(Se))),"string"==typeof Se&&(Fe=Se),we.fetchOptions={cache:$e.cacheBust&&!ue._abortableFetch.polyfill?"no-cache":"default",credentials:"same-origin",headers:$e.headers||{},method:"head"===$e.method?"HEAD":"GET",mode:"cors",priority:le.priority,redirect:"follow",signal:Be},(De||Fe)&&(we.fetchOptions.body=De||Fe),"anonymous"===$e.authMode&&(we.useIdentity=!1),we.hasToken=!!(/token=/i.test(Oe)||(null==(ve=$e.query)?void 0:ve.token)||(null==De?void 0:De.get("token"))),!we.hasToken&&A.Z.apiKey&&(0,Z.r)(Oe)&&($e.query||($e.query={}),$e.query.token=A.Z.apiKey,we.hasToken=!0),we.useIdentity&&!we.hasToken&&!we.credentialToken&&!Me(Oe)&&!(0,W.Hc)(Be)){let Ke;"immediate"===$e.authMode?(yield pe(),Ke=yield G.id.getCredential(Oe,{signal:Be}),we.credential=Ke):"no-prompt"===$e.authMode?(yield pe(),Ke=yield G.id.getCredential(Oe,{prompt:!1,signal:Be}).catch(()=>{}),we.credential=Ke):G.id&&(Ke=G.id.findCredential(Oe)),Ke&&(we.credentialToken=Ke.token,we.useSSL=!!Ke.ssl)}})).apply(this,arguments)}function Me(we){return U.some(Oe=>Oe.test(we))}function Ee(we){return Te.apply(this,arguments)}function Te(){return(Te=(0,x.Z)(function*(we){let Oe=we.params.url;const $e=we.params.requestOptions,Be=we.fetchOptions,Se=(0,B.jc)(Oe)||(0,B.HK)(Oe),De=$e.responseType||"json",Fe=Se?0:null!=$e.timeout?$e.timeout:le.timeout;let ve=!1;if(!Se){we.useSSL&&(Oe=(0,B.hO)(Oe)),$e.cacheBust&&"default"===Be.cache&&(Oe=(0,B.ZN)(Oe,"request.preventCache",Date.now()));let Ye=or({},$e.query);we.credentialToken&&(Ye.token=we.credentialToken);let ze=(0,B.B7)(Ye);(0,H.Z)("esri-url-encodes-apostrophe")&&(ze=ze.replace(/'/g,"%27"));const et=Oe.length+1+ze.length;let ke;ve="delete"===$e.method||"post"===$e.method||"put"===$e.method||!!$e.body||et>le.maxUrlLength;const ot=$e.useProxy||!!(0,B.ed)(Oe);if(ot){const at=(0,B.b7)(Oe);ke=at.path,!ve&&ke.length+1+et>le.maxUrlLength&&(ve=!0),at.query&&(Ye=or(or({},at.query),Ye))}if("HEAD"===Be.method&&(ve||ot)){if(ve)throw ae("request:invalid-parameters",et>le.maxUrlLength?new Error("URL exceeds maximum length"):new Error("cannot use POST request when method is 'head'"),we.params);if(ot)throw ae("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),we.params)}if(ve?(Be.method="delete"===$e.method?"DELETE":"put"===$e.method?"PUT":"POST",$e.body?Oe=(0,B.fl)(Oe,Ye):(Be.body=(0,B.B7)(Ye),Be.headers["Content-Type"]="application/x-www-form-urlencoded")):Oe=(0,B.fl)(Oe,Ye),ot&&(we.useProxy=!0,Oe=`${ke}?${Oe}`),Ye.token&&Y&&Be.body instanceof FormData&&!/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(Oe)&&Be.body.set("token",Ye.token),$e.hasOwnProperty("withCredentials"))we.withCredentials=$e.withCredentials;else if(!(0,B.D6)(Oe,(0,B.TI)()))if((0,B.kl)(Oe))we.withCredentials=!0;else if(G.id){const at=G.id.findServerInfo(Oe);at&&at.webTierAuth&&(we.withCredentials=!0)}we.withCredentials&&(Be.credentials="include",(0,ie.jH)(Oe)&&(yield(0,ie.jz)(ve?(0,B.fl)(Oe,Ye):Oe)))}let Ke,qe,be=0,tt=!1;Fe>0&&(be=setTimeout(()=>{tt=!0,we.controller.abort()},Fe));try{if("native-request-init"===$e.responseType)qe=Be,qe.url=Oe;else if("image"!==$e.responseType||"default"!==Be.cache||"GET"!==Be.method||ve||Ie($e.headers)||!Se&&!we.useProxy&&le.proxyUrl&&!se(Oe)){if(Ke=yield ue._abortableFetch(Oe,Be),we.useProxy||ne(Oe),"native"===$e.responseType)qe=Ke;else if("HEAD"!==Be.method)if(Ke.ok){switch(De){case"array-buffer":qe=yield Ke.arrayBuffer();break;case"blob":case"image":qe=yield Ke.blob();break;default:qe=yield Ke.text()}if(be&&(clearTimeout(be),be=0),"json"===De||"xml"===De||"document"===De)if(qe)switch(De){case"json":qe=JSON.parse(qe);break;case"xml":qe=Ge(qe,"application/xml");break;case"document":qe=Ge(qe,"text/html")}else qe=null;if(qe){if("array-buffer"===De||"blob"===De){const Ye=Ke.headers.get("Content-Type");if(/application\/json|text\/plain/i.test(Ye)&&qe["blob"===De?"size":"byteLength"]<=750)try{const ze=yield new Response(qe).json();ze.error&&(qe=ze)}catch(ze){}}"image"===De&&qe instanceof Blob&&(qe=yield Ne(URL.createObjectURL(qe),we,!0))}}else qe=yield Ke.text()}else qe=yield Ne(Oe,we)}catch(Ye){if("AbortError"===Ye.name)throw tt?new Error("Timeout exceeded"):(0,W.zE)("Request canceled");if(!(!Ke&&Ye instanceof TypeError&&le.proxyUrl)||$e.body||"delete"===$e.method||"head"===$e.method||"post"===$e.method||"put"===$e.method||we.useProxy||se(Oe))throw Ye;we.redoRequest=!0,(0,B.tD)({proxyUrl:le.proxyUrl,urlPrefix:(0,B.P$)(Oe)})}finally{be&&clearTimeout(be)}return[Ke,qe]})).apply(this,arguments)}function me(we,Oe){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,x.Z)(function*(we,Oe){if(null!=we.responseData)return we.responseData;if(we.headers&&(Oe.requestOptions.headers=or(or({},Oe.requestOptions.headers),we.headers)),we.query&&(Oe.requestOptions.query=or(or({},Oe.requestOptions.query),we.query)),we.before){let $e,Be;try{Be=yield we.before(Oe)}catch(Se){$e=ae("request:interceptor",Se,Oe)}if((Be instanceof Error||Be instanceof Q.Z)&&($e=ae("request:interceptor",Be,Oe)),$e)throw we.error&&we.error($e),$e;return Be}})).apply(this,arguments)}function Ie(we){if(we)for(const Oe of Object.getOwnPropertyNames(we))if(we[Oe])return!0;return!1}function Ge(we,Oe){let $e;try{$e=(new DOMParser).parseFromString(we,Oe)}catch(Be){}if(!$e||$e.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return $e}function Je(we){return xe.apply(this,arguments)}function xe(){return(xe=(0,x.Z)(function*(we){var De;let Oe,$e;yield ge(we);try{do{[Oe,$e]=yield Ee(we)}while(!(yield je(we,Oe,$e)))}catch(Fe){const ve=ae("request:server",Fe,we.params,Oe);throw ve.details.ssl=we.useSSL,we.interceptor&&we.interceptor.error&&we.interceptor.error(ve),ve}const Be=we.params.url;if($e&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(Be)){if(!we.hasToken&&!we.credentialToken&&(null==(De=$e.user)?void 0:De.username)&&!(0,B.kl)(Be)){const Fe=(0,B.P$)(Be,!0);Fe&&le.trustedServers.push(Fe)}Array.isArray($e.authorizedCrossOriginNoCorsDomains)&&(0,ie.Hu)($e.authorizedCrossOriginNoCorsDomains)}const Se=we.credential;if(Se&&G.id){const Fe=G.id.findServerInfo(Se.server);let ve=Fe&&Fe.owningSystemUrl;if(ve){ve=ve.replace(/\/?$/,"/sharing");const Ke=G.id.findCredential(ve,Se.userId);Ke&&-1===G.id._getIdenticalSvcIdx(ve,Ke)&&Ke.resources.unshift(ve)}}return{data:$e,getHeader:Oe?Fe=>Oe.headers.get(Fe):ee,requestOptions:we.params.requestOptions,ssl:we.useSSL,url:we.params.url}})).apply(this,arguments)}function je(we,Oe,$e){return We.apply(this,arguments)}function We(){return(We=(0,x.Z)(function*(we,Oe,$e){if(we.redoRequest)return we.redoRequest=!1,!1;const Be=we.params.requestOptions;if(!Oe||"native"===Be.responseType||"native-request-init"===Be.responseType)return!0;let Se,De,Fe,ve;if(!Oe.ok)throw Se=new Error(`Unable to load ${Oe.url} status: ${Oe.status}`),Se[$]=$e,Se;(null==$e?void 0:$e.error)&&(Se=$e.error),Se&&(De=Number(Se.code),Fe=Se.hasOwnProperty("subcode")?Number(Se.subcode):null,ve=Se.messageCode,ve=ve&&ve.toUpperCase());const Ke=Be.authMode;if(403===De&&(4===Fe||Se.message&&Se.message.toLowerCase().includes("ssl")&&!Se.message.toLowerCase().includes("permission"))){if(!we.useSSL)return we.useSSL=!0,!1}else if(!we.hasToken&&we.useIdentity&&("no-prompt"!==Ke||498===De)&&j.includes(De)&&!Me(we.params.url)&&(403!==De||!X.includes(ve)&&(null==Fe||2===Fe&&we.credentialToken))){yield pe();try{const qe=yield G.id.getCredential(we.params.url,{error:ae("request:server",Se,we.params),prompt:"no-prompt"!==Ke,signal:we.controller.signal,token:we.credentialToken});return we.credential=qe,we.credentialToken=qe.token,we.useSSL=we.useSSL||qe.ssl,!1}catch(qe){if("no-prompt"===Ke)return we.credential=null,we.credentialToken=null,!1;Se=qe}}if(Se)throw Se;return!0})).apply(this,arguments)}function Ne(we,Oe,$e=!1){const Be=Oe.controller.signal,Se=new Image;return Se.crossOrigin=Oe.withCredentials?"use-credentials":"anonymous",Se.alt="",Se.fetchPriority=le.priority,Se.src=we,(0,ie.fY)(Se,we,$e,Be)}ue._abortableFetch=null,ue._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"]},68886:(dt,Re,T)=>{"use strict";T.d(Re,{i:()=>Z});var x=T(15861),A=T(84792),G=T(90912),Q=T(91179),H=T(2618);function J(ue,ce,oe){const le=(0,Q.q9)(ce);return ue.map(Y=>{const j=le.fromJSON(Y);return j.spatialReference=oe,j})}var W=T(77294);const B=(0,G.se)(W.Z);function Z(ue,ce,oe){return ie.apply(this,arguments)}function ie(){return(ie=(0,x.Z)(function*(ue,ce,oe){ce=B(ce);const le=(0,H.en)(ue),Y=or(yi(or({},le.query),{f:"json"}),ce.toJSON()),j=ce.outSpatialReference,X=(0,Q.Ji)(ce.geometries[0]),U=(0,H.lA)(Y,oe);return(0,A.default)(le.path+"/project",U).then(({data:{geometries:ee}})=>J(ee,X,j))})).apply(this,arguments)}},39517:(dt,Re,T)=>{"use strict";T.d(Re,{et:()=>_e,ef:()=>pe,bI:()=>ge,Wf:()=>he});var x=T(15861),A=T(84792),G=T(26584),Q=T(62208),H=T(94113),re=T(21726),J=T(2618),W=T(17626),B=T(86810),Z=T(77712),oe=(T(85931),T(8314),T(90912),T(55342)),le=T(68653),Y=T(76898),j=T(99433),X=T(51494);let U=class extends B.wq{constructor(Ce){super(Ce),this.dataType=null,this.name=null,this.parameterNames=null,this.restrictionUsageParameterName=null,this.timeNeutralAttributeName=null,this.trafficSupport=null,this.units=null,this.usageType=null}};(0,W._)([(0,Z.Cb)({type:String})],U.prototype,"dataType",void 0),(0,W._)([(0,oe.J)(X.Ul,{ignoreUnknown:!1})],U.prototype,"name",void 0),(0,W._)([(0,Z.Cb)({type:[String]})],U.prototype,"parameterNames",void 0),(0,W._)([(0,Z.Cb)({type:String})],U.prototype,"restrictionUsageParameterName",void 0),(0,W._)([(0,oe.J)(X.ZI,{ignoreUnknown:!1})],U.prototype,"timeNeutralAttributeName",void 0),(0,W._)([(0,Z.Cb)({type:String})],U.prototype,"trafficSupport",void 0),(0,W._)([(0,Z.Cb)({type:String})],U.prototype,"units",void 0),(0,W._)([(0,oe.J)(X.E2)],U.prototype,"usageType",void 0),U=(0,W._)([(0,Y.j)("esri.rest.support.NetworkAttribute")],U);const ee=U;let $=class extends B.wq{constructor(Ce){super(Ce),this.buildTime=null,this.name=null,this.networkAttributes=null,this.networkSources=null,this.state=null}};(0,W._)([(0,Z.Cb)({type:Number})],$.prototype,"buildTime",void 0),(0,W._)([(0,Z.Cb)({type:String})],$.prototype,"name",void 0),(0,W._)([(0,Z.Cb)({type:[ee]})],$.prototype,"networkAttributes",void 0),(0,W._)([(0,Z.Cb)()],$.prototype,"networkSources",void 0),(0,W._)([(0,Z.Cb)({type:String})],$.prototype,"state",void 0),$=(0,W._)([(0,Y.j)("esri.rest.support.NetworkDataset")],$);const ne=$;var se=T(67854);let ae=class extends B.wq{constructor(Ce){super(Ce),this.accumulateAttributeNames=null,this.currentVersion=null,this.defaultTravelMode=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsSupportedLanguages=null,this.directionsTimeAttribute=null,this.hasZ=null,this.impedance=null,this.networkDataset=null,this.supportedTravelModes=null}readAccumulateAttributes(Ce){return(0,Q.Wi)(Ce)?null:Ce.map(Ie=>X.Ul.fromJSON(Ie))}writeAccumulateAttributes(Ce,Ie,Ge){!(0,Q.Wi)(Ce)&&Ce.length&&(Ie[Ge]=Ce.map(Je=>X.Ul.toJSON(Je)))}};(0,W._)([(0,Z.Cb)()],ae.prototype,"accumulateAttributeNames",void 0),(0,W._)([(0,le.r)("accumulateAttributeNames")],ae.prototype,"readAccumulateAttributes",null),(0,W._)([(0,j.c)("accumulateAttributeNames")],ae.prototype,"writeAccumulateAttributes",null),(0,W._)([(0,Z.Cb)()],ae.prototype,"currentVersion",void 0),(0,W._)([(0,Z.Cb)()],ae.prototype,"defaultTravelMode",void 0),(0,W._)([(0,Z.Cb)()],ae.prototype,"directionsLanguage",void 0),(0,W._)([(0,oe.J)(X.GX)],ae.prototype,"directionsLengthUnits",void 0),(0,W._)([(0,Z.Cb)()],ae.prototype,"directionsSupportedLanguages",void 0),(0,W._)([(0,oe.J)(X.ZI,{ignoreUnknown:!1})],ae.prototype,"directionsTimeAttribute",void 0),(0,W._)([(0,Z.Cb)()],ae.prototype,"hasZ",void 0),(0,W._)([(0,oe.J)(X.Ul,{ignoreUnknown:!1})],ae.prototype,"impedance",void 0),(0,W._)([(0,Z.Cb)({type:ne})],ae.prototype,"networkDataset",void 0),(0,W._)([(0,Z.Cb)({type:[se.Z]})],ae.prototype,"supportedTravelModes",void 0),ae=(0,W._)([(0,Y.j)("esri.rest.support.NetworkServiceDescription")],ae);const de=ae;function _e(Ce,Ie,Ge,Je){Je[Ge]=[Ie.length,Ie.length+Ce.length],Ce.forEach(xe=>{Ie.push(xe.geometry)})}function pe(Ce,Ie){for(let Ge=0;Ge<Ie.length;Ge++){const Je=Ce[Ie[Ge]];if(Je&&Je.length)for(const xe of Je)xe.z=void 0}console.log("The remote Network Analysis service is powered by a network dataset which is not Z-aware.\nZ-coordinates of the input geometry are ignored.")}function he(Ce,Ie){for(let Ge=0;Ge<Ie.length;Ge++){const Je=Ce[Ie[Ge]];if(Je&&Je.length)for(const xe of Je)if((0,Q.pC)(xe)&&xe.hasZ)return!0}return!1}function ge(Ce,Ie,Ge){return ye.apply(this,arguments)}function ye(){return(ye=(0,x.Z)(function*(Ce,Ie,Ge){if(!Ce)throw new G.Z("network-service:missing-url","Url to Network service is missing");const Je=(0,J.lA)({f:"json",token:Ie},Ge),{data:xe}=yield(0,A.default)(Ce,Je);xe.supportedTravelModes||(xe.supportedTravelModes=[]);for(let we=0;we<xe.supportedTravelModes.length;we++)xe.supportedTravelModes[we].id||(xe.supportedTravelModes[we].id=xe.supportedTravelModes[we].itemId);const je=xe.currentVersion>=10.4?Te(Ce,Ie,Ge):Me(Ce,Ge),{defaultTravelMode:We,supportedTravelModes:Ne}=yield je;return xe.defaultTravelMode=We,xe.supportedTravelModes=Ne,de.fromJSON(xe)})).apply(this,arguments)}function Me(Ce,Ie){return Ee.apply(this,arguments)}function Ee(){return(Ee=(0,x.Z)(function*(Ce,Ie){var ve,Ke,qe;const Ge=(0,J.lA)({f:"json"},Ie),{data:Je}=yield(0,A.default)(Ce.replace(/\/rest\/.*$/i,"/info"),Ge);if(!Je||!Je.owningSystemUrl)return{supportedTravelModes:[],defaultTravelMode:null};const{owningSystemUrl:xe}=Je,je=(0,re.Qj)(xe)+"/sharing/rest/portals/self",{data:We}=yield(0,A.default)(je,Ge),Ne=(0,H.hS)("helperServices.routingUtilities.url",We);if(!Ne)return{supportedTravelModes:[],defaultTravelMode:null};const we=(0,J.en)(xe),Oe=/\/solve$/i.test(we.path)?"Route":/\/solveclosestfacility$/i.test(we.path)?"ClosestFacility":"ServiceAreas",$e=(0,J.lA)({f:"json",serviceName:Oe},Ie),Be=(0,re.Qj)(Ne)+"/GetTravelModes/execute",Se=yield(0,A.default)(Be,$e),De=[];let Fe=null;if(null==(Ke=null==(ve=null==Se?void 0:Se.data)?void 0:ve.results)?void 0:Ke.length){const be=Se.data.results;for(const tt of be)if("supportedTravelModes"===tt.paramName){if(null==(qe=tt.value)?void 0:qe.features)for(const{attributes:Ye}of tt.value.features)if(Ye){const ze=JSON.parse(Ye.TravelMode);De.push(ze)}}else"defaultTravelMode"===tt.paramName&&(Fe=tt.value)}return{supportedTravelModes:De,defaultTravelMode:Fe}})).apply(this,arguments)}function Te(Ce,Ie,Ge){return me.apply(this,arguments)}function me(){return(me=(0,x.Z)(function*(Ce,Ie,Ge){try{const Je=(0,J.lA)({f:"json",token:Ie},Ge),xe=(0,re.Qj)(Ce)+"/retrieveTravelModes",{data:{supportedTravelModes:je,defaultTravelMode:We}}=yield(0,A.default)(xe,Je);return{supportedTravelModes:je,defaultTravelMode:We}}catch(Je){throw new G.Z("network-service:retrieveTravelModes","Could not get to the NAServer's retrieveTravelModes.",{error:Je})}})).apply(this,arguments)}},76391:(dt,Re,T)=>{"use strict";function x(A){const G={};for(const Q in A){if("declaredClass"===Q)continue;const H=A[Q];if(null!=H&&"function"!=typeof H)if(Array.isArray(H)){G[Q]=[];for(let re=0;re<H.length;re++)G[Q][re]=x(H[re])}else"object"==typeof H?H.toJSON&&(G[Q]=JSON.stringify(H)):G[Q]=H}return G}T.d(Re,{A:()=>x})},2865:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>W,e:()=>re});var x=T(15861),A=T(2618),G=T(20477),Q=T(17253),H=T(84952);function re(Z,ie,ue){return J.apply(this,arguments)}function J(){return(J=(0,x.Z)(function*(Z,ie,ue){const ce=yield W(Z,ie,ue);return Q.default.fromJSON(ce)})).apply(this,arguments)}function W(Z,ie,ue){return B.apply(this,arguments)}function B(){return(B=(0,x.Z)(function*(Z,ie,ue){const ce=(0,A.en)(Z),oe=or({},ue),le=H.Z.from(ie),{data:Y}=yield(0,G.executeQuery)(ce,le,le.sourceSpatialReference,oe);return Y})).apply(this,arguments)}},20514:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>H});var x=T(62208),A=T(16730),G=T(37053);function Q(W,B,Z){if(null==W.hasM||W.hasZ)for(const ie of B)for(const ue of ie)ue.length>2&&(ue[2]*=Z)}function H(W,B,Z){if(!W&&!B||!Z)return;const ie=(0,A._R)(Z);re(W,Z,ie),re(B,Z,ie)}function re(W,B,Z){if(W)for(const ie of W)J(ie.geometry,B,Z)}function J(W,B,Z){if((0,x.Wi)(W)||!W.spatialReference||(0,G.fS)(W.spatialReference,B))return;const ie=(0,A._R)(W.spatialReference)/Z;if(1!==ie)if("x"in W)null!=W.z&&(W.z*=ie);else if("rings"in W)Q(W,W.rings,ie);else if("paths"in W)Q(W,W.paths,ie);else if("points"in W&&(null==W.hasM||W.hasZ))for(const ue of W.points)ue.length>2&&(ue[2]*=ie)}},71260:(dt,Re,T)=>{"use strict";T.d(Re,{G$:()=>ne,K9:()=>pe,O7:()=>B});var x=T(26584),A=T(62208),G=T(24192),Q=T(88071),H=T(98558);const re=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML"],J=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],W=["upperLeft","lowerLeft"];function B(he){return he>=re.length?null:re[he]}function Z(he){return he>=J.length?null:J[he]}function ie(he){return he>=W.length?null:W[he]}function ue(he,ge){return ge>=he.geometryTypes.length?null:he.geometryTypes[ge]}function ce(he,ge,ye){const Ee=ge.createPointGeometry(ye);for(;he.next();)switch(he.tag()){case 3:{const Te=he.getUInt32(),me=he.pos()+Te;let Ce=0;for(;he.pos()<me;)ge.addCoordinatePoint(Ee,he.getSInt64(),Ce++);break}default:he.skip()}return Ee}function oe(he,ge,ye){const Te=ge.createGeometry(ye),me=2+(ye.hasZ?1:0)+(ye.hasM?1:0);for(;he.next();)switch(he.tag()){case 2:{const Ce=he.getUInt32(),Ie=he.pos()+Ce;let Ge=0;for(;he.pos()<Ie;)ge.addLength(Te,he.getUInt32(),Ge++);break}case 3:{const Ce=he.getUInt32(),Ie=he.pos()+Ce;let Ge=0;for(ge.allocateCoordinates(Te);he.pos()<Ie;)ge.addCoordinate(Te,he.getSInt64(),Ge),Ge++,Ge===me&&(Ge=0);break}default:he.skip()}return Te}function le(he){const Ee=new Q.Z;let Te="esriGeometryPoint";for(;he.next();)switch(he.tag()){case 2:{const me=he.getUInt32(),Ce=he.pos()+me;for(;he.pos()<Ce;)Ee.lengths.push(he.getUInt32());break}case 3:{const me=he.getUInt32(),Ce=he.pos()+me;for(;he.pos()<Ce;)Ee.coords.push(he.getSInt64());break}case 1:Te=H.A[he.getEnum()];break;default:he.skip()}return{queryGeometry:Ee,queryGeometryType:Te}}function Y(he){for(;he.next();)switch(he.tag()){case 1:return he.getString();case 2:return he.getFloat();case 3:return he.getDouble();case 4:return he.getSInt32();case 5:return he.getUInt32();case 6:return he.getInt64();case 7:return he.getUInt64();case 8:return he.getSInt64();case 9:return he.getBool();default:return he.skip(),null}return null}function j(he){const Ce={type:B(0)};for(;he.next();)switch(he.tag()){case 1:Ce.name=he.getString();break;case 2:Ce.type=B(he.getEnum());break;case 3:Ce.alias=he.getString();break;case 4:Ce.sqlType=Z(he.getEnum());break;case 5:default:he.skip();break;case 6:Ce.defaultValue=he.getString()}return Ce}function X(he){const Me={};for(;he.next();)switch(he.tag()){case 1:Me.name=he.getString();break;case 2:Me.isSystemMaintained=he.getBool();break;default:he.skip()}return Me}function U(he,ge,ye,Me){const Ce=ge.createFeature(ye);let Ie=0;for(;he.next();)switch(he.tag()){case 1:{const Ge=Me[Ie++].name;Ce.attributes[Ge]=he.processMessage(Y);break}case 2:Ce.geometry=he.processMessageWithArgs(oe,ge,ye);break;case 4:Ce.centroid=he.processMessageWithArgs(ce,ge,ye);break;default:he.skip()}return Ce}function ee(he){const Te=[1,1,1,1];for(;he.next();)switch(he.tag()){case 1:Te[0]=he.getDouble();break;case 2:Te[1]=he.getDouble();break;case 4:Te[2]=he.getDouble();break;case 3:Te[3]=he.getDouble();break;default:he.skip()}return Te}function $(he){const Te=[0,0,0,0];for(;he.next();)switch(he.tag()){case 1:Te[0]=he.getDouble();break;case 2:Te[1]=he.getDouble();break;case 4:Te[2]=he.getDouble();break;case 3:Te[3]=he.getDouble();break;default:he.skip()}return Te}function ne(he){const Ee={originPosition:ie(0)};for(;he.next();)switch(he.tag()){case 1:Ee.originPosition=ie(he.getEnum());break;case 2:Ee.scale=he.processMessage(ee);break;case 3:Ee.translate=he.processMessage($);break;default:he.skip()}return Ee}function se(he){const Ee={};for(;he.next();)switch(he.tag()){case 1:Ee.shapeAreaFieldName=he.getString();break;case 2:Ee.shapeLengthFieldName=he.getString();break;case 3:Ee.units=he.getString();break;default:he.skip()}return Ee}function ae(he,ge){const Ce=ge.createSpatialReference();for(;he.next();)switch(he.tag()){case 1:Ce.wkid=he.getUInt32();break;case 5:Ce.wkt=he.getString();break;case 2:Ce.latestWkid=he.getUInt32();break;case 3:Ce.vcsWkid=he.getUInt32();break;case 4:Ce.latestVcsWkid=he.getUInt32();break;default:he.skip()}return Ce}function de(he,ge){const we=ge.createFeatureResult();we.geometryType=ue(ge,0);let Oe=!1;for(;he.next();)switch(he.tag()){case 1:we.objectIdFieldName=he.getString();break;case 3:we.globalIdFieldName=he.getString();break;case 4:we.geohashFieldName=he.getString();break;case 5:we.geometryProperties=he.processMessage(se);break;case 7:we.geometryType=ue(ge,he.getEnum());break;case 8:we.spatialReference=he.processMessageWithArgs(ae,ge);break;case 10:we.hasZ=he.getBool();break;case 11:we.hasM=he.getBool();break;case 12:we.transform=he.processMessage(ne);break;case 9:{const $e=he.getBool();we.exceededTransferLimit=$e;break}case 13:ge.addField(we,he.processMessage(j));break;case 15:Oe||(ge.prepareFeatures(we),Oe=!0),ge.addFeature(we,he.processMessageWithArgs(U,ge,we,we.fields));break;case 2:we.uniqueIdField=he.processMessage(X);break;default:he.skip()}return ge.finishFeatureResult(we),we}function _e(he,ge){const Ee={};let Te=null;for(;he.next();)switch(he.tag()){case 4:Te=he.processMessageWithArgs(le);break;case 1:Ee.featureResult=he.processMessageWithArgs(de,ge);break;default:he.skip()}return(0,A.pC)(Te)&&Ee.featureResult&&ge.addQueryGeometry(Ee,Te),Ee}function pe(he,ge){try{const Me=new G.Z(new Uint8Array(he),new DataView(he)),Ee={};for(;Me.next();)2===Me.tag()?Ee.queryResult=Me.processMessageWithArgs(_e,ge):Me.skip();return Ee}catch(ye){throw new x.Z("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:ye})}}},98558:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>re,J:()=>J});var x=T(16730),A=T(37053),G=T(66385),Q=T(95786),H=T(88071);const re=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];class J{constructor(B){this.options=B,this.geometryTypes=re,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new Q.Z}prepareFeatures(B){this._vertexDimension=2,B.hasZ&&this._vertexDimension++,B.hasM&&this._vertexDimension++}finishFeatureResult(B){if(!B||!B.features||!B.hasZ||!this.options.sourceSpatialReference||!B.spatialReference||(0,A.fS)(B.spatialReference,this.options.sourceSpatialReference)||B.spatialReference.vcsWkid)return;const Z=(0,x._R)(this.options.sourceSpatialReference)/(0,x._R)(B.spatialReference);if(1!==Z)for(const ie of B.features){if(!(0,G.S6)(ie))continue;const ue=ie.geometry.coords;for(let ce=2;ce<ue.length;ce+=3)ue[ce]*=Z}}addFeature(B,Z){B.features.push(Z)}createFeature(){return new G.u_}createSpatialReference(){return{wkid:0}}createGeometry(){return new H.Z}addField(B,Z){B.fields.push(Z)}allocateCoordinates(B){B.coords.length=B.lengths.reduce((Z,ie)=>Z+ie,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(B,Z){B.coords[this._coordinatePtr++]=Z}addCoordinatePoint(B,Z){B.coords.push(Z)}addLength(B,Z){B.lengths.push(Z)}addQueryGeometry(B,Z){B.queryGeometry=Z.queryGeometry,B.queryGeometryType=Z.queryGeometryType}createPointGeometry(){return new H.Z}}},85262:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>A});var x=T(71260);function A(G,Q){const H=(0,x.K9)(G,Q),re=H.queryResult.featureResult,J=H.queryResult.queryGeometry,W=H.queryResult.queryGeometryType;if(re&&re.features&&re.features.length&&re.objectIdFieldName){const B=re.objectIdFieldName;for(const Z of re.features)Z.attributes&&(Z.objectId=Z.attributes[B])}return re&&(re.queryGeometry=J,re.queryGeometryType=W),re}},20477:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{encodeGeometry:()=>ie,executeQuery:()=>ce,executeQueryForCount:()=>U,executeQueryForExtent:()=>ee,executeQueryForIds:()=>X,executeQueryPBF:()=>le,executeQueryPBFBuffer:()=>j,queryToQueryStringParameters:()=>ue,runQuery:()=>$});var x=T(15861),A=T(84792),G=T(62208),Q=T(21726),H=T(91179),re=T(13924),J=T(76391),W=T(85262),B=T(61515);const Z="Layer does not support extent calculation.";function ie(ne,se){if(se&&"extent"===ne.type)return`${ne.xmin},${ne.ymin},${ne.xmax},${ne.ymax}`;if(se&&"point"===ne.type)return`${ne.x},${ne.y}`;const ae=ne.toJSON();return delete ae.spatialReference,JSON.stringify(ae)}function ue(ne,se){const ae=ne.geometry,de=ne.toJSON();delete de.compactGeometryEnabled,delete de.defaultSpatialReferenceEnabled;const _e=de;let pe,he,ge;if((0,G.pC)(ae)&&(he=ae.spatialReference,ge=ae.spatialReference.wkid||JSON.stringify(ae.spatialReference),_e.geometryType=(0,H.Ji)(ae),_e.geometry=ie(ae,ne.compactGeometryEnabled),_e.inSR=ge),de.groupByFieldsForStatistics&&(_e.groupByFieldsForStatistics=de.groupByFieldsForStatistics.join(",")),de.objectIds&&(_e.objectIds=de.objectIds.join(",")),de.orderByFields&&(_e.orderByFields=de.orderByFields.join(",")),!de.outFields||!de.returnDistinctValues&&((null==se?void 0:se.returnCountOnly)||(null==se?void 0:se.returnExtentOnly)||(null==se?void 0:se.returnIdsOnly))?delete _e.outFields:_e.outFields=de.outFields.includes("*")?"*":de.outFields.join(","),de.outSR?(_e.outSR=de.outSR.wkid||JSON.stringify(de.outSR),pe=ne.outSpatialReference):ae&&(de.returnGeometry||de.returnCentroid)&&(_e.outSR=_e.inSR,pe=he),de.returnGeometry&&delete de.returnGeometry,de.outStatistics&&(_e.outStatistics=JSON.stringify(de.outStatistics)),de.pixelSize&&(_e.pixelSize=JSON.stringify(de.pixelSize)),de.quantizationParameters&&(ne.defaultSpatialReferenceEnabled&&(0,G.pC)(he)&&(0,G.pC)(ne.quantizationParameters)&&(0,G.pC)(ne.quantizationParameters.extent)&&he.equals(ne.quantizationParameters.extent.spatialReference)&&delete de.quantizationParameters.extent.spatialReference,_e.quantizationParameters=JSON.stringify(de.quantizationParameters)),de.parameterValues&&(_e.parameterValues=JSON.stringify(de.parameterValues)),de.rangeValues&&(_e.rangeValues=JSON.stringify(de.rangeValues)),de.dynamicDataSource&&(_e.layer=JSON.stringify({source:de.dynamicDataSource}),delete de.dynamicDataSource),de.timeExtent){const ye=de.timeExtent,{start:Me,end:Ee}=ye;null==Me&&null==Ee||(_e.time=Me===Ee?Me:`${null==Me?"null":Me},${null==Ee?"null":Ee}`),delete de.timeExtent}return ne.defaultSpatialReferenceEnabled&&(0,G.pC)(he)&&(0,G.pC)(pe)&&he.equals(pe)&&(_e.defaultSR=_e.inSR,delete _e.inSR,delete _e.outSR),_e}function ce(ne,se,ae,de){return oe.apply(this,arguments)}function oe(){return(oe=(0,x.Z)(function*(ne,se,ae,de){const _e=(0,G.pC)(se.timeExtent)&&se.timeExtent.isEmpty?{data:{features:[]}}:yield $(ne,se,"json",de);return(0,B.p)(se,ae,_e.data),_e})).apply(this,arguments)}function le(ne,se,ae,de){return Y.apply(this,arguments)}function Y(){return(Y=(0,x.Z)(function*(ne,se,ae,de){if((0,G.pC)(se.timeExtent)&&se.timeExtent.isEmpty)return{data:ae.createFeatureResult()};const _e=yield j(ne,se,de),pe=_e;return pe.data=(0,W.C)(_e.data,ae),pe})).apply(this,arguments)}function j(ne,se,ae){return $(ne,se,"pbf",ae)}function X(ne,se,ae){return(0,G.pC)(se.timeExtent)&&se.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):$(ne,se,"json",ae,{returnIdsOnly:!0})}function U(ne,se,ae){return(0,G.pC)(se.timeExtent)&&se.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):$(ne,se,"json",ae,{returnIdsOnly:!0,returnCountOnly:!0})}function ee(ne,se,ae){return(0,G.pC)(se.timeExtent)&&se.timeExtent.isEmpty?Promise.resolve({data:{count:0,extent:null}}):$(ne,se,"json",ae,{returnExtentOnly:!0,returnCountOnly:!0}).then(de=>{const _e=de.data;if(_e.hasOwnProperty("extent"))return de;if(_e.features)throw new Error(Z);if(_e.hasOwnProperty("count"))throw new Error(Z);return de})}function $(ne,se,ae,de={},_e={}){const pe="string"==typeof ne?(0,Q.mN)(ne):ne,he=se.geometry?[se.geometry]:[];return de.responseType="pbf"===ae?"array-buffer":"json",(0,re.aX)(he,null,de).then(ge=>{const ye=ge&&ge[0];(0,G.pC)(ye)&&((se=se.clone()).geometry=ye);const Me=(0,J.A)(or(or(yi(or({},pe.query),{f:ae}),_e),ue(se,_e)));return(0,A.default)((0,Q.v_)(pe.path,"query"),yi(or({},de),{query:or(or({},Me),de.query)}))})}},61515:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>G});var x=T(62208),A=T(33696);function G(Q,H,re){if(!re||!re.features||!re.hasZ)return;const J=(0,A.k)(re.geometryType,H,Q.outSpatialReference);if(!(0,x.Wi)(J))for(const W of re.features)J(W.geometry)}},87183:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var Z,x=T(17626),A=T(86810),G=T(77712),re=(T(85931),T(8314),T(90912)),J=T(76898);const ie={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};let ue=Z=class extends A.wq{constructor(oe){super(oe),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:oe}=this,le=function W(oe){const{exifInfo:le,exifName:Y,tagName:j}=oe;if(!le||!Y||!j)return null;const X=le.find(U=>U.name===Y);return X?function B(oe){const{tagName:le,tags:Y}=oe;if(!Y||!le)return null;const j=Y.find(X=>X.name===le);return j&&j.value||null}({tagName:j,tags:X.tags}):null}({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:oe});return ie[le]||null}clone(){return new Z({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}};(0,x._)([(0,G.Cb)({type:String})],ue.prototype,"contentType",void 0),(0,x._)([(0,G.Cb)()],ue.prototype,"exifInfo",void 0),(0,x._)([(0,G.Cb)({readOnly:!0})],ue.prototype,"orientationInfo",null),(0,x._)([(0,G.Cb)({type:re.z8})],ue.prototype,"id",void 0),(0,x._)([(0,G.Cb)({type:String})],ue.prototype,"globalId",void 0),(0,x._)([(0,G.Cb)({type:String})],ue.prototype,"keywords",void 0),(0,x._)([(0,G.Cb)({type:String})],ue.prototype,"name",void 0),(0,x._)([(0,G.Cb)({json:{read:!1}})],ue.prototype,"parentGlobalId",void 0),(0,x._)([(0,G.Cb)({json:{read:!1}})],ue.prototype,"parentObjectId",void 0),(0,x._)([(0,G.Cb)({type:re.z8})],ue.prototype,"size",void 0),(0,x._)([(0,G.Cb)({json:{read:!1}})],ue.prototype,"url",void 0),ue=Z=(0,x._)([(0,J.j)("esri.layers.support.AttachmentInfo")],ue);const ce=ue},54176:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>je});var x=T(15861),A=T(84792),G=T(62208),Q=T(13924),H=T(39517),re=T(2618),J=T(68171),W=T(17626),B=T(88879),Z=T(86810),ie=T(77712),le=(T(85931),T(8314),T(90912),T(68653)),Y=T(76898),j=T(17253),X=T(2076);const U=new X.X({esriJobMessageTypeInformative:"informative",esriJobMessageTypeProcessDefinition:"process-definition",esriJobMessageTypeProcessStart:"process-start",esriJobMessageTypeProcessStop:"process-stop",esriJobMessageTypeWarning:"warning",esriJobMessageTypeError:"error",esriJobMessageTypeEmpty:"empty",esriJobMessageTypeAbort:"abort"});let ee=class extends Z.wq{constructor(we){super(we),this.description=null,this.type=null}};(0,W._)([(0,ie.Cb)({type:String,json:{write:!0}})],ee.prototype,"description",void 0),(0,W._)([(0,ie.Cb)({type:String,json:{read:U.read,write:U.write}})],ee.prototype,"type",void 0),ee=(0,W._)([(0,Y.j)("esri.rest.support.GPMessage")],ee);const $=ee,ne=new X.X({0:"informative",1:"process-definition",2:"process-start",3:"process-stop",50:"warning",100:"error",101:"empty",200:"abort"});let se=class extends ${constructor(we){super(we),this.type=null}};(0,W._)([(0,ie.Cb)({type:String,json:{read:ne.read,write:ne.write}})],se.prototype,"type",void 0),se=(0,W._)([(0,Y.j)("esri.rest.support.NAMessage")],se);const ae=se;T(29132);let _e=class extends B.Z{};(0,W._)([(0,ie.Cb)()],_e.prototype,"events",void 0),(0,W._)([(0,ie.Cb)()],_e.prototype,"strings",void 0),_e=(0,W._)([(0,Y.j)("esri.rest.support.DirectionsFeature")],_e);const pe=_e;var he=T(2004),ge=T(65234),ye=T(55214),Me=T(49672);let Ee=class extends j.default{constructor(we){super(we),this.extent=null,this.features=null,this.geometryType="polyline",this.routeId=null,this.routeName=null,this.totalDriveTime=null,this.totalLength=null,this.totalTime=null}readFeatures(we,Oe){var Se;if(!we)return[];const $e=null!=(Se=Oe.summary.envelope.spatialReference)?Se:Oe.spatialReference,Be=$e&&ge.Z.fromJSON($e);return we.map(De=>{var qe,be;const Fe=this._decompressGeometry(De.compressedGeometry),ve=new ye.Z(yi(or({},Fe),{spatialReference:Be})),Ke=null!=(be=null==(qe=De.events)?void 0:qe.map(tt=>{const{arriveTimeUTC:Ye,ETA:ze,point:{x:et,y:ke,z:ot},strings:at}=tt;return new pe({geometry:new Me.Z({x:et,y:ke,z:ot,hasZ:void 0!==ot,spatialReference:Be}),attributes:{ETA:ze,arriveTimeUTC:Ye},strings:at})}))?be:[];return new pe({attributes:De.attributes,events:Ke,geometry:ve,strings:De.strings})})}get mergedGeometry(){if(!this.features)return null;const we=this.features.map(({geometry:$e})=>(0,G.Wg)($e)),Oe=this.get("extent.spatialReference");return this._mergePolylinesToSinglePath(we,Oe)}get strings(){return this.features.map(({strings:we})=>we)}_decompressGeometry(we){let Oe=0,$e=0,Be=0,Se=0;const De=[];let Fe,ve,Ke,qe,be,tt,Ye,ze,et=0,ke=0,ot=0;if(be=we.match(/((\+|\-)[^\+\-\|]+|\|)/g),be||(be=[]),0===parseInt(be[et],32)){et=2;const at=parseInt(be[et],32);et++,tt=parseInt(be[et],32),et++,1&at&&(ke=be.indexOf("|")+1,Ye=parseInt(be[ke],32),ke++),2&at&&(ot=be.indexOf("|",ke)+1,ze=parseInt(be[ot],32),ot++)}else tt=parseInt(be[et],32),et++;for(;et<be.length&&"|"!==be[et];){Fe=parseInt(be[et],32)+Oe,et++,Oe=Fe,ve=parseInt(be[et],32)+$e,et++,$e=ve;const at=[Fe/tt,ve/tt];ke&&(qe=parseInt(be[ke],32)+Be,ke++,Be=qe,at.push(qe/Ye)),ot&&(Ke=parseInt(be[ot],32)+Se,ot++,Se=Ke,at.push(Ke/ze)),De.push(at)}return{paths:[De],hasZ:ke>0,hasM:ot>0}}_mergePolylinesToSinglePath(we,Oe){if(0===we.length)return new ye.Z({spatialReference:Oe});const $e=[];for(const Fe of we)for(const ve of Fe.paths)$e.push(...ve);const Be=[];$e.forEach((Fe,ve)=>{0!==ve&&Fe[0]===$e[ve-1][0]&&Fe[1]===$e[ve-1][1]||Be.push(Fe)});const{hasM:Se,hasZ:De}=we[0];return new ye.Z({hasM:Se,hasZ:De,paths:[Be],spatialReference:Oe})}};(0,W._)([(0,ie.Cb)({type:he.Z,json:{read:{source:"summary.envelope"}}})],Ee.prototype,"extent",void 0),(0,W._)([(0,ie.Cb)()],Ee.prototype,"features",void 0),(0,W._)([(0,le.r)("features")],Ee.prototype,"readFeatures",null),(0,W._)([(0,ie.Cb)()],Ee.prototype,"geometryType",void 0),(0,W._)([(0,ie.Cb)({readOnly:!0})],Ee.prototype,"mergedGeometry",null),(0,W._)([(0,ie.Cb)()],Ee.prototype,"routeId",void 0),(0,W._)([(0,ie.Cb)()],Ee.prototype,"routeName",void 0),(0,W._)([(0,ie.Cb)({value:null,readOnly:!0})],Ee.prototype,"strings",null),(0,W._)([(0,ie.Cb)({json:{read:{source:"summary.totalDriveTime"}}})],Ee.prototype,"totalDriveTime",void 0),(0,W._)([(0,ie.Cb)({json:{read:{source:"summary.totalLength"}}})],Ee.prototype,"totalLength",void 0),(0,W._)([(0,ie.Cb)({json:{read:{source:"summary.totalTime"}}})],Ee.prototype,"totalTime",void 0),Ee=(0,W._)([(0,Y.j)("esri.rest.support.DirectionsFeatureSet")],Ee);const Te=Ee;let me=class extends Z.wq{constructor(we){super(we),this.directionLines=null,this.directionPoints=null,this.directions=null,this.route=null,this.routeName=null,this.stops=null,this.traversedEdges=null,this.traversedJunctions=null,this.traversedTurns=null}};(0,W._)([(0,ie.Cb)({type:j.default,json:{write:!0}})],me.prototype,"directionLines",void 0),(0,W._)([(0,ie.Cb)({type:j.default,json:{write:!0}})],me.prototype,"directionPoints",void 0),(0,W._)([(0,ie.Cb)({type:Te,json:{write:!0}})],me.prototype,"directions",void 0),(0,W._)([(0,ie.Cb)({type:B.Z,json:{write:!0}})],me.prototype,"route",void 0),(0,W._)([(0,ie.Cb)({type:String,json:{write:!0}})],me.prototype,"routeName",void 0),(0,W._)([(0,ie.Cb)({type:[B.Z],json:{write:!0}})],me.prototype,"stops",void 0),(0,W._)([(0,ie.Cb)({type:j.default,json:{write:!0}})],me.prototype,"traversedEdges",void 0),(0,W._)([(0,ie.Cb)({type:j.default,json:{write:!0}})],me.prototype,"traversedJunctions",void 0),(0,W._)([(0,ie.Cb)({type:j.default,json:{write:!0}})],me.prototype,"traversedTurns",void 0),me=(0,W._)([(0,Y.j)("esri.rest.support.RouteResult")],me);const Ce=me;function Ie(we){return we&&j.default.fromJSON(we).features.map(Oe=>Oe)}let Ge=class extends Z.wq{constructor(we){super(we),this.messages=null,this.pointBarriers=null,this.polylineBarriers=null,this.polygonBarriers=null,this.routeResults=null}readPointBarriers(we,Oe){return Ie(Oe.barriers)}readPolylineBarriers(we){return Ie(we)}readPolygonBarriers(we){return Ie(we)}};(0,W._)([(0,ie.Cb)({type:[ae]})],Ge.prototype,"messages",void 0),(0,W._)([(0,ie.Cb)({type:[B.Z]})],Ge.prototype,"pointBarriers",void 0),(0,W._)([(0,le.r)("pointBarriers",["barriers"])],Ge.prototype,"readPointBarriers",null),(0,W._)([(0,ie.Cb)({type:[B.Z]})],Ge.prototype,"polylineBarriers",void 0),(0,W._)([(0,le.r)("polylineBarriers")],Ge.prototype,"readPolylineBarriers",null),(0,W._)([(0,ie.Cb)({type:[B.Z]})],Ge.prototype,"polygonBarriers",void 0),(0,W._)([(0,le.r)("polygonBarriers")],Ge.prototype,"readPolygonBarriers",null),(0,W._)([(0,ie.Cb)({type:[Ce]})],Ge.prototype,"routeResults",void 0),Ge=(0,W._)([(0,Y.j)("esri.rest.support.RouteSolveResult")],Ge);const Je=Ge;function xe(we){return"esri.rest.support.FeatureSet"===(null==we?void 0:we.declaredClass)}function je(we,Oe,$e){return We.apply(this,arguments)}function We(){return(We=(0,x.Z)(function*(we,Oe,$e){const Be=[],Se=[],De={},Fe={},ve=(0,re.en)(we),{path:Ke}=ve;xe(Oe.stops)&&(0,H.et)(Oe.stops.features,Se,"stops.features",De),xe(Oe.pointBarriers)&&(0,H.et)(Oe.pointBarriers.features,Se,"pointBarriers.features",De),xe(Oe.polylineBarriers)&&(0,H.et)(Oe.polylineBarriers.features,Se,"polylineBarriers.features",De),xe(Oe.polygonBarriers)&&(0,H.et)(Oe.polygonBarriers.features,Se,"polygonBarriers.features",De);const qe=yield(0,Q.aX)(Se);for(const ze in De){const et=De[ze];Be.push(ze),Fe[ze]=qe.slice(et[0],et[1])}if((0,H.Wf)(Fe,Be)){let ze=null;try{ze=yield(0,H.bI)(Ke,Oe.apiKey,$e)}catch(et){}ze&&!ze.hasZ&&(0,H.ef)(Fe,Be)}for(const ze in Fe)Fe[ze].forEach((et,ke)=>{Oe.get(ze)[ke].geometry=et});const be=yi(or({},$e),{query:yi(or(or({},ve.query),(0,J.Yc)(Oe)),{f:"json"})}),tt=Ke.endsWith("/solve")?Ke:`${Ke}/solve`,{data:Ye}=yield(0,A.default)(tt,be);return Ne(Ye)})).apply(this,arguments)}function Ne(we){var at;const{barriers:Oe,directionLines:$e,directionPoints:Be,directions:Se,messages:De,polygonBarriers:Fe,polylineBarriers:ve,routes:Ke,stops:qe,traversedEdges:be,traversedJunctions:tt,traversedTurns:Ye}=we,ze=yt=>{const wt=ke.find(Rt=>Rt.routeName===yt);if((0,G.pC)(wt))return wt;const zt={routeId:ke.length+1,routeName:yt};return ke.push(zt),zt},et=yt=>{const wt=ke.find(Rt=>Rt.routeId===yt);if((0,G.pC)(wt))return wt;const zt={routeId:yt,routeName:null};return ke.push(zt),zt},ke=[];null==Ke||Ke.features.forEach((yt,wt)=>{yt.geometry.spatialReference=Ke.spatialReference,ke.push({routeId:wt+1,routeName:yt.attributes.Name,route:yt})}),null==Se||Se.forEach(yt=>{const{routeName:wt}=yt;ze(wt).directions=yt});const ot=null!=(at=null==qe?void 0:qe.features.every(yt=>(0,G.Wi)(yt.attributes.RouteName)))&&at&&ke.length>0?ke[0].routeName:null;return null==qe||qe.features.forEach(yt=>{var wt;yt.geometry&&(null!=(wt=yt.geometry).spatialReference||(wt.spatialReference=qe.spatialReference));const Rt=ze(null!=ot?ot:yt.attributes.RouteName);null!=Rt.stops||(Rt.stops=[]),Rt.stops.push(yt)}),null==$e||$e.features.forEach(yt=>{const zt=et(yt.attributes.RouteID),{geometryType:Rt,spatialReference:Ft}=$e;null!=zt.directionLines||(zt.directionLines={features:[],geometryType:Rt,spatialReference:Ft}),zt.directionLines.features.push(yt)}),null==Be||Be.features.forEach(yt=>{const zt=et(yt.attributes.RouteID),{geometryType:Rt,spatialReference:Ft}=Be;null!=zt.directionPoints||(zt.directionPoints={features:[],geometryType:Rt,spatialReference:Ft}),zt.directionPoints.features.push(yt)}),null==be||be.features.forEach(yt=>{const zt=et(yt.attributes.RouteID),{geometryType:Rt,spatialReference:Ft}=be;null!=zt.traversedEdges||(zt.traversedEdges={features:[],geometryType:Rt,spatialReference:Ft}),zt.traversedEdges.features.push(yt)}),null==tt||tt.features.forEach(yt=>{const zt=et(yt.attributes.RouteID),{geometryType:Rt,spatialReference:Ft}=tt;null!=zt.traversedJunctions||(zt.traversedJunctions={features:[],geometryType:Rt,spatialReference:Ft}),zt.traversedJunctions.features.push(yt)}),null==Ye||Ye.features.forEach(yt=>{const zt=et(yt.attributes.RouteID);null!=zt.traversedTurns||(zt.traversedTurns={features:[]}),zt.traversedTurns.features.push(yt)}),Je.fromJSON({routeResults:ke,barriers:Oe,polygonBarriers:Fe,polylineBarriers:ve,messages:De})}},68171:(dt,Re,T)=>{"use strict";T.d(Re,{DE:()=>G,EQ:()=>H,Yc:()=>W,co:()=>re,nY:()=>Q,pQ:()=>J});var x=T(62208),A=T(51494);function G(B,Z){if((0,x.Wi)(B))return null;const ie={},ue=new RegExp(`^${Z}`,"i");for(const ce of Object.keys(B))if(ue.test(ce)){const oe=ce.substring(Z.length);ie[A.Ul.fromJSON(oe)]=B[ce]}return ie}function Q(B,Z,ie){if(!(0,x.Wi)(B)){Z.attributes||(Z.attributes={});for(const ue in B){const ce=A.Ul.toJSON(ue);Z.attributes[`${ie}${ce}`]=B[ue]}}}function H(B){const Z={};for(const ie of Object.keys(B))Z[A.Ul.fromJSON(ie)]=B[ie];return Z}function re(B){const Z={};for(const ie of Object.keys(B))Z[A.Ul.toJSON(ie)]=B[ie];return Z}function J(B,Z){return(0,x.Wi)(B)||(0,x.Wi)(Z)?null:Math.round((B-Z)/6e4)}function W(B){const Z=B.toJSON(),ie=Z;return ie.accumulateAttributeNames&&(ie.accumulateAttributeNames=Z.accumulateAttributeNames.join()),ie.attributeParameterValues&&(ie.attributeParameterValues=JSON.stringify(Z.attributeParameterValues)),ie.barriers&&(ie.barriers=JSON.stringify(Z.barriers)),ie.outSR&&(ie.outSR=Z.outSR.wkid),ie.overrides&&(ie.overrides=JSON.stringify(Z.overrides)),ie.polygonBarriers&&(ie.polygonBarriers=JSON.stringify(Z.polygonBarriers)),ie.polylineBarriers&&(ie.polylineBarriers=JSON.stringify(Z.polylineBarriers)),ie.restrictionAttributeNames&&(ie.restrictionAttributeNames=Z.restrictionAttributeNames.join()),ie.stops&&(ie.stops=JSON.stringify(Z.stops)),ie.travelMode&&(ie.travelMode=JSON.stringify(Z.travelMode)),ie}},40251:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(91558),G=T(58817),Q=T(77712),H=T(90912),re=T(55342),J=T(76898),W=T(40669);let Z=B=class extends W.Z{constructor(ue){super(ue),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new B({fromColor:(0,G.d9)(this.fromColor),toColor:(0,G.d9)(this.toColor),algorithm:this.algorithm})}};(0,x._)([(0,re.J)({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],Z.prototype,"algorithm",void 0),(0,x._)([(0,Q.Cb)({type:A.Z,json:{type:[H.z8],write:!0}})],Z.prototype,"fromColor",void 0),(0,x._)([(0,Q.Cb)({type:A.Z,json:{type:[H.z8],write:!0}})],Z.prototype,"toColor",void 0),(0,x._)([(0,Q.Cb)({type:["algorithmic"]})],Z.prototype,"type",void 0),Z=B=(0,x._)([(0,J.j)("esri.rest.support.AlgorithmicColorRamp")],Z);const ie=Z},67736:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(86810),G=T(58817),Q=T(77712),H=T(90912),re=T(76898),J=T(99433);let B=W=class extends A.wq{constructor(ie){super(ie),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(ie,ue){ue.resultOffset=this.start,ue.resultRecordCount=this.num||10}clone(){return new W((0,G.d9)({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};(0,x._)([(0,Q.Cb)({type:[String],json:{write:!0}})],B.prototype,"attachmentTypes",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],B.prototype,"attachmentsWhere",void 0),(0,x._)([(0,Q.Cb)({type:Boolean,json:{write:!0}})],B.prototype,"cacheHint",void 0),(0,x._)([(0,Q.Cb)({type:[String],json:{write:!0}})],B.prototype,"keywords",void 0),(0,x._)([(0,Q.Cb)({type:[Number],json:{write:!0}})],B.prototype,"globalIds",void 0),(0,x._)([(0,Q.Cb)({json:{write:!0}})],B.prototype,"name",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],B.prototype,"num",void 0),(0,x._)([(0,Q.Cb)({type:[Number],json:{write:!0}})],B.prototype,"objectIds",void 0),(0,x._)([(0,Q.Cb)({type:Boolean,json:{default:!1,write:!0}})],B.prototype,"returnMetadata",void 0),(0,x._)([(0,Q.Cb)({type:[Number],json:{write:!0}})],B.prototype,"size",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],B.prototype,"start",void 0),(0,x._)([(0,J.c)("start"),(0,J.c)("num")],B.prototype,"writeStart",null),(0,x._)([(0,Q.Cb)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],B.prototype,"where",void 0),B=W=(0,x._)([(0,re.j)("esri.rest.support.AttachmentQuery")],B),B.from=(0,H.se)(B);const Z=B},79767:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>j});var x=T(17626),A=T(2076),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(86810),B=T(79023),Z=T(10012);const ie=new A.X({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});let ue=class extends W.wq{constructor(){super(...arguments),this.baseSymbol=null,this.colorRamp=null,this.type=null}};(0,x._)([(0,G.Cb)({type:Z.Z,json:{write:!0}})],ue.prototype,"baseSymbol",void 0),(0,x._)([(0,G.Cb)({types:B.V,json:{read:{reader:B.i},write:!0}})],ue.prototype,"colorRamp",void 0),(0,x._)([(0,G.Cb)({json:{read:ie.read,write:ie.write}})],ue.prototype,"type",void 0),ue=(0,x._)([(0,J.j)("esri.rest.support.ClassificationDefinition")],ue);const ce=ue,oe=new A.X({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),le=new A.X({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});let Y=class extends ce{constructor(){super(...arguments),this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null,this.type="class-breaks-definition"}set standardDeviationInterval(X){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",X)}set definedInterval(X){"defined-interval"===this.classificationMethod&&this._set("definedInterval",X)}};(0,x._)([(0,G.Cb)({json:{write:!0}})],Y.prototype,"breakCount",void 0),(0,x._)([(0,G.Cb)({json:{write:!0}})],Y.prototype,"classificationField",void 0),(0,x._)([(0,G.Cb)({type:String,json:{read:oe.read,write:oe.write}})],Y.prototype,"classificationMethod",void 0),(0,x._)([(0,G.Cb)({json:{write:!0}})],Y.prototype,"normalizationField",void 0),(0,x._)([(0,G.Cb)({json:{read:le.read,write:le.write}})],Y.prototype,"normalizationType",void 0),(0,x._)([(0,G.Cb)({value:null,json:{write:!0}})],Y.prototype,"standardDeviationInterval",null),(0,x._)([(0,G.Cb)({value:null,json:{write:!0}})],Y.prototype,"definedInterval",null),(0,x._)([(0,G.Cb)()],Y.prototype,"type",void 0),Y=(0,x._)([(0,J.j)("esri.rest.support.ClassBreaksDefinition")],Y);const j=Y},40669:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.wq{constructor(Z){super(Z),this.type=null}};(0,x._)([(0,G.Cb)({readOnly:!0,json:{read:!1,write:!0}})],W.prototype,"type",void 0),W=(0,x._)([(0,J.j)("esri.rest.support.ColorRamp")],W);const B=W},17253:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{default:()=>U});var Y,x=T(17626),A=T(29132),G=T(88879),Q=T(2076),H=T(86810),re=T(58817),J=T(62208),W=T(77712),Z=(T(90912),T(68653)),ie=T(76898),ue=T(99433),ce=T(65234),oe=T(91179),le=T(36255);const j=new Q.X({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let X=Y=class extends H.wq{constructor(ee){super(ee),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(ee,$){var ae;const ne=ce.Z.fromJSON($.spatialReference),se=[];for(let de=0;de<ee.length;de++){const _e=ee[de],pe=G.Z.fromJSON(_e),he=_e.geometry&&_e.geometry.spatialReference;(0,J.pC)(pe.geometry)&&!he&&(pe.geometry.spatialReference=ne);const ge=_e.aggregateGeometries,ye=pe.aggregateGeometries;if(ge&&(0,J.pC)(ye))for(const Me in ye){const Ee=ye[Me],Te=null==(ae=ge[Me])?void 0:ae.spatialReference;(0,J.pC)(Ee)&&!Te&&(Ee.spatialReference=ne)}se.push(pe)}return se}writeGeometryType(ee,$,ne,se){if(ee)return void j.write(ee,$,ne,se);const{features:ae}=this;if(ae)for(const de of ae)if(de&&(0,J.pC)(de.geometry))return void j.write(de.geometry.type,$,ne,se)}readQueryGeometry(ee,$){if(!ee)return null;const ne=!!ee.spatialReference,se=(0,oe.im)(ee);return!ne&&$.spatialReference&&(se.spatialReference=ce.Z.fromJSON($.spatialReference)),se}writeSpatialReference(ee,$){if(ee)return void($.spatialReference=ee.toJSON());const{features:ne}=this;if(ne)for(const se of ne)if(se&&(0,J.pC)(se.geometry)&&se.geometry.spatialReference)return void($.spatialReference=se.geometry.spatialReference.toJSON())}clone(){return new Y(this.cloneProperties())}cloneProperties(){return(0,re.d9)({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(ee){const $=this.write();if($.features&&Array.isArray(ee)&&ee.length>0)for(let ne=0;ne<$.features.length;ne++){const se=$.features[ne];if(se.geometry){const ae=ee&&ee[ne];se.geometry=ae&&ae.toJSON()||se.geometry}}return $}quantize(ee){const{scale:[$,ne],translate:[se,ae]}=ee,pe=this.features,he=this._getQuantizationFunction(this.geometryType,ge=>Math.round((ge-se)/$),ge=>Math.round((ae-ge)/ne));for(let ge=0,ye=pe.length;ge<ye;ge++)he((0,J.Wg)(pe[ge].geometry))||(pe.splice(ge,1),ge--,ye--);return this.transform=ee,this}unquantize(){const{geometryType:ee,features:$,transform:ne}=this;if(!ne)return this;const{translate:[se,ae],scale:[de,_e]}=ne,ge=this._getHydrationFunction(ee,ye=>ye*de+se,ye=>ae-ye*_e);for(const{geometry:ye}of $)(0,J.pC)(ye)&&ge(ye);return this.transform=null,this}_quantizePoints(ee,$,ne){let se,ae;const de=[];for(let _e=0,pe=ee.length;_e<pe;_e++){const he=ee[_e];if(_e>0){const ge=$(he[0]),ye=ne(he[1]);ge===se&&ye===ae||(de.push([ge-se,ye-ae]),se=ge,ae=ye)}else se=$(he[0]),ae=ne(he[1]),de.push([se,ae])}return de.length>0?de:null}_getQuantizationFunction(ee,$,ne){return"point"===ee?se=>(se.x=$(se.x),se.y=ne(se.y),se):"polyline"===ee||"polygon"===ee?se=>{const ae=(0,oe.oU)(se)?se.rings:se.paths,de=[];for(let _e=0,pe=ae.length;_e<pe;_e++){const ge=this._quantizePoints(ae[_e],$,ne);ge&&de.push(ge)}return de.length>0?((0,oe.oU)(se)?se.rings=de:se.paths=de,se):null}:"multipoint"===ee?se=>{const ae=this._quantizePoints(se.points,$,ne);return ae.length>0?(se.points=ae,se):null}:"extent"===ee?se=>se:null}_getHydrationFunction(ee,$,ne){return"point"===ee?se=>{se.x=$(se.x),se.y=ne(se.y)}:"polyline"===ee||"polygon"===ee?se=>{const ae=(0,oe.oU)(se)?se.rings:se.paths;let de,_e;for(let pe=0,he=ae.length;pe<he;pe++){const ge=ae[pe];for(let ye=0,Me=ge.length;ye<Me;ye++){const Ee=ge[ye];ye>0?(de+=Ee[0],_e+=Ee[1]):(de=Ee[0],_e=Ee[1]),Ee[0]=$(de),Ee[1]=ne(_e)}}}:"extent"===ee?se=>{se.xmin=$(se.xmin),se.ymin=ne(se.ymin),se.xmax=$(se.xmax),se.ymax=ne(se.ymax)}:"multipoint"===ee?se=>{const ae=se.points;let de,_e;for(let pe=0,he=ae.length;pe<he;pe++){const ge=ae[pe];pe>0?(de+=ge[0],_e+=ge[1]):(de=ge[0],_e=ge[1]),ge[0]=$(de),ge[1]=ne(_e)}}:void 0}};(0,x._)([(0,W.Cb)({type:String,json:{write:!0}})],X.prototype,"displayFieldName",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{write:{overridePolicy:ee=>({enabled:ee})}}})],X.prototype,"exceededTransferLimit",void 0),(0,x._)([(0,W.Cb)({type:[G.Z],json:{write:!0}})],X.prototype,"features",void 0),(0,x._)([(0,Z.r)("features")],X.prototype,"readFeatures",null),(0,x._)([(0,W.Cb)({type:[le.Z],json:{write:!0}})],X.prototype,"fields",void 0),(0,x._)([(0,W.Cb)({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:j.read}}})],X.prototype,"geometryType",void 0),(0,x._)([(0,ue.c)("geometryType")],X.prototype,"writeGeometryType",null),(0,x._)([(0,W.Cb)({type:Boolean,json:{write:{overridePolicy:ee=>({enabled:ee})}}})],X.prototype,"hasM",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{write:{overridePolicy:ee=>({enabled:ee})}}})],X.prototype,"hasZ",void 0),(0,x._)([(0,W.Cb)({types:A.qM,json:{write:!0}})],X.prototype,"queryGeometry",void 0),(0,x._)([(0,Z.r)("queryGeometry")],X.prototype,"readQueryGeometry",null),(0,x._)([(0,W.Cb)({type:ce.Z,json:{write:!0}})],X.prototype,"spatialReference",void 0),(0,x._)([(0,ue.c)("spatialReference")],X.prototype,"writeSpatialReference",null),(0,x._)([(0,W.Cb)({json:{write:!0}})],X.prototype,"transform",void 0),X=Y=(0,x._)([(0,ie.j)("esri.rest.support.FeatureSet")],X),X.prototype.toJSON.isDefaultToJSON=!0;const U=X},75414:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(58817),G=T(77712),H=(T(90912),T(76898)),re=T(40251),J=T(40669);let B=W=class extends J.Z{constructor(ie){super(ie),this.colorRamps=null,this.type="multipart"}clone(){return new W({colorRamps:(0,A.d9)(this.colorRamps)})}};(0,x._)([(0,G.Cb)({type:[re.Z],json:{write:!0}})],B.prototype,"colorRamps",void 0),(0,x._)([(0,G.Cb)({type:["multipart"]})],B.prototype,"type",void 0),B=W=(0,x._)([(0,H.j)("esri.rest.support.MultipartColorRamp")],B);const Z=B},77294:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(91179);let B=class extends A.wq{constructor(ie){super(ie),this.geometries=null,this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const ie=this.geometries.map(oe=>oe.toJSON()),ue=this.geometries[0],ce={};return ce.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),ce.inSR=ue.spatialReference.wkid||JSON.stringify(ue.spatialReference.toJSON()),ce.geometries=JSON.stringify({geometryType:(0,W.Ji)(ue),geometries:ie}),this.transformation&&(ce.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(ce.transformForward=this.transformForward),ce}};(0,x._)([(0,G.Cb)()],B.prototype,"geometries",void 0),(0,x._)([(0,G.Cb)({json:{read:{source:"outSR"}}})],B.prototype,"outSpatialReference",void 0),(0,x._)([(0,G.Cb)()],B.prototype,"transformation",void 0),(0,x._)([(0,G.Cb)()],B.prototype,"transformForward",void 0),B=(0,x._)([(0,J.j)("esri.rest.support.ProjectParameters")],B);const Z=B},89621:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var Z,x=T(17626),G=(T(29132),T(2076)),Q=T(86810),H=T(58817),re=T(77712),W=(T(90912),T(76898)),B=T(2004);const ie=new G.X({upperLeft:"upper-left",lowerLeft:"lower-left"});let ue=Z=class extends Q.wq{constructor(oe){super(oe),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new Z((0,H.d9)({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};(0,x._)([(0,re.Cb)({type:B.Z,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],ue.prototype,"extent",void 0),(0,x._)([(0,re.Cb)({type:["view","edit"],json:{write:!0}})],ue.prototype,"mode",void 0),(0,x._)([(0,re.Cb)({type:String,json:{read:ie.read,write:ie.write}})],ue.prototype,"originPosition",void 0),(0,x._)([(0,re.Cb)({type:Number,json:{write:{overridePolicy(){return{enabled:"view"===this.mode}}}}})],ue.prototype,"tolerance",void 0),ue=Z=(0,x._)([(0,W.j)("esri.rest.support.QuantizationParameters")],ue);const ce=ue},84952:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ae});var ee,x=T(17626),A=T(29132),G=T(97478),Q=T(2076),H=T(86810),re=T(58817),J=T(62208),W=T(77712),B=T(66656),Z=T(55342),ie=T(76898),ue=T(99433),ce=T(90912),oe=T(91179),le=T(15283),Y=T(89621),j=T(60776),X=T(65234),U=T(49672);const $=new Q.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),ne=new Q.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let se=ee=class extends H.wq{constructor(de){super(de),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}static from(de){return(0,ce.TJ)(ee,de)}castDatumTransformation(de){return"number"==typeof de||"object"==typeof de?de:null}writeHistoricMoment(de,_e){_e.historicMoment=de&&de.getTime()}writeParameterValues(de,_e){if(de){const pe={};for(const he in de){const ge=de[he];pe[he]=Array.isArray(ge)?ge.map(ye=>ye instanceof Date?ye.getTime():ye):ge instanceof Date?ge.getTime():ge}_e.parameterValues=pe}}writeStart(de,_e){_e.resultOffset=this.start,_e.resultRecordCount=this.num||10,_e.where="1=1"}writeWhere(de,_e){_e.where=de||"1=1"}clone(){return new ee((0,re.d9)({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:(0,J.pC)(this.historicMoment)?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};se.MAX_MAX_RECORD_COUNT_FACTOR=5,(0,x._)([(0,W.Cb)({json:{write:!0}})],se.prototype,"aggregateIds",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],se.prototype,"cacheHint",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{default:!1,write:!0}})],se.prototype,"compactGeometryEnabled",void 0),(0,x._)([(0,W.Cb)({json:{write:!0}})],se.prototype,"datumTransformation",void 0),(0,x._)([(0,B.p)("datumTransformation")],se.prototype,"castDatumTransformation",null),(0,x._)([(0,W.Cb)({type:Boolean,json:{default:!1,write:!0}})],se.prototype,"defaultSpatialReferenceEnabled",void 0),(0,x._)([(0,W.Cb)({type:Number,json:{write:{overridePolicy:de=>({enabled:de>0})}}})],se.prototype,"distance",void 0),(0,x._)([(0,W.Cb)({type:le.n,json:{write:!0}})],se.prototype,"dynamicDataSource",void 0),(0,x._)([(0,W.Cb)({type:String,json:{write:!0}})],se.prototype,"formatOf3DObjects",void 0),(0,x._)([(0,W.Cb)({type:String,json:{write:!0}})],se.prototype,"gdbVersion",void 0),(0,x._)([(0,W.Cb)({types:A.qM,json:{read:oe.im,write:!0}})],se.prototype,"geometry",void 0),(0,x._)([(0,W.Cb)({type:Number,json:{write:!0}})],se.prototype,"geometryPrecision",void 0),(0,x._)([(0,W.Cb)({type:[String],json:{write:!0}})],se.prototype,"groupByFieldsForStatistics",void 0),(0,x._)([(0,W.Cb)({type:String,json:{write:!0}})],se.prototype,"having",void 0),(0,x._)([(0,W.Cb)({type:Date})],se.prototype,"historicMoment",void 0),(0,x._)([(0,ue.c)("historicMoment")],se.prototype,"writeHistoricMoment",null),(0,x._)([(0,W.Cb)({type:Number,json:{write:!0}})],se.prototype,"maxAllowableOffset",void 0),(0,x._)([(0,W.Cb)({type:Number,cast:de=>de<1?1:de>ee.MAX_MAX_RECORD_COUNT_FACTOR?ee.MAX_MAX_RECORD_COUNT_FACTOR:de,json:{write:{overridePolicy:de=>({enabled:de>1})}}})],se.prototype,"maxRecordCountFactor",void 0),(0,x._)([(0,W.Cb)({type:["xyFootprint"],json:{write:!0}})],se.prototype,"multipatchOption",void 0),(0,x._)([(0,W.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],se.prototype,"num",void 0),(0,x._)([(0,W.Cb)({json:{write:!0}})],se.prototype,"objectIds",void 0),(0,x._)([(0,W.Cb)({type:[String],json:{write:!0}})],se.prototype,"orderByFields",void 0),(0,x._)([(0,W.Cb)({type:[String],json:{write:!0}})],se.prototype,"outFields",void 0),(0,x._)([(0,W.Cb)({type:X.Z,json:{name:"outSR",write:!0}})],se.prototype,"outSpatialReference",void 0),(0,x._)([(0,W.Cb)({type:[j.Z],json:{write:{enabled:!0,overridePolicy(){return{enabled:(0,J.pC)(this.outStatistics)&&this.outStatistics.length>0}}}}})],se.prototype,"outStatistics",void 0),(0,x._)([(0,W.Cb)({json:{write:!0}})],se.prototype,"parameterValues",void 0),(0,x._)([(0,ue.c)("parameterValues")],se.prototype,"writeParameterValues",null),(0,x._)([(0,W.Cb)({type:U.Z,json:{write:!0}})],se.prototype,"pixelSize",void 0),(0,x._)([(0,W.Cb)({type:Y.Z,json:{write:!0}})],se.prototype,"quantizationParameters",void 0),(0,x._)([(0,W.Cb)({type:[Object],json:{write:!0}})],se.prototype,"rangeValues",void 0),(0,x._)([(0,W.Cb)({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:"relation"===this.spatialRelationship}}}}})],se.prototype,"relationParameter",void 0),(0,x._)([(0,W.Cb)({type:String,json:{write:!0}})],se.prototype,"resultType",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{default:!1,write:!0}})],se.prototype,"returnCentroid",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{default:!1,write:!0}})],se.prototype,"returnDistinctValues",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{default:!0,write:!0}})],se.prototype,"returnExceededLimitFeatures",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{write:!0}})],se.prototype,"returnGeometry",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{default:!1,write:!0}})],se.prototype,"returnQueryGeometry",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{default:!1,write:!0}})],se.prototype,"returnM",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{write:{overridePolicy:de=>({enabled:de})}}})],se.prototype,"returnZ",void 0),(0,x._)([(0,W.Cb)({type:X.Z,json:{write:!0}})],se.prototype,"sourceSpatialReference",void 0),(0,x._)([(0,Z.J)($,{ignoreUnknown:!1,name:"spatialRel"})],se.prototype,"spatialRelationship",void 0),(0,x._)([(0,W.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],se.prototype,"start",void 0),(0,x._)([(0,ue.c)("start"),(0,ue.c)("num")],se.prototype,"writeStart",null),(0,x._)([(0,W.Cb)({type:String,json:{write:!0}})],se.prototype,"sqlFormat",void 0),(0,x._)([(0,W.Cb)({type:String,json:{write:!0}})],se.prototype,"text",void 0),(0,x._)([(0,W.Cb)({type:G.Z,json:{write:!0}})],se.prototype,"timeExtent",void 0),(0,x._)([(0,W.Cb)({type:Boolean,json:{default:!1,write:!0}})],se.prototype,"timeReferenceUnknownClient",void 0),(0,x._)([(0,Z.J)(ne,{ignoreUnknown:!1}),(0,W.Cb)({json:{write:{overridePolicy(de){return{enabled:de&&this.distance>0}}}}})],se.prototype,"units",void 0),(0,x._)([(0,W.Cb)({type:String,json:{write:{overridePolicy(de){return{enabled:null!=de||this.start>0}}}}})],se.prototype,"where",void 0),(0,x._)([(0,ue.c)("where")],se.prototype,"writeWhere",null),se=ee=(0,x._)([(0,ie.j)("esri.rest.support.Query")],se);const ae=se},67010:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var ie,x=T(17626),G=(T(29132),T(86810)),Q=T(58817),H=T(77712),re=T(90912),J=T(76898),W=T(99433),B=T(15283),Z=T(65234);let ue=ie=class extends G.wq{constructor(oe){super(oe),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(oe,le){le.historicMoment=oe&&oe.getTime()}writeStart(oe,le){le.resultOffset=this.start,le.resultRecordCount=this.num||10,this.start>0&&null==this.where&&(le.definitionExpression="1=1")}clone(){return new ie((0,Q.d9)({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};(0,x._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],ue.prototype,"cacheHint",void 0),(0,x._)([(0,H.Cb)({type:B.n,json:{write:!0}})],ue.prototype,"dynamicDataSource",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ue.prototype,"gdbVersion",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],ue.prototype,"geometryPrecision",void 0),(0,x._)([(0,H.Cb)({type:Date})],ue.prototype,"historicMoment",void 0),(0,x._)([(0,W.c)("historicMoment")],ue.prototype,"_writeHistoricMoment",null),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],ue.prototype,"maxAllowableOffset",void 0),(0,x._)([(0,H.Cb)({type:[Number],json:{write:!0}})],ue.prototype,"objectIds",void 0),(0,x._)([(0,H.Cb)({type:[String],json:{write:!0}})],ue.prototype,"orderByFields",void 0),(0,x._)([(0,H.Cb)({type:[String],json:{write:!0}})],ue.prototype,"outFields",void 0),(0,x._)([(0,H.Cb)({type:Z.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],ue.prototype,"outSpatialReference",void 0),(0,x._)([(0,H.Cb)({json:{write:!0}})],ue.prototype,"relationshipId",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],ue.prototype,"start",void 0),(0,x._)([(0,W.c)("start"),(0,W.c)("num")],ue.prototype,"writeStart",null),(0,x._)([(0,H.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],ue.prototype,"num",void 0),(0,x._)([(0,H.Cb)({json:{write:!0}})],ue.prototype,"returnGeometry",void 0),(0,x._)([(0,H.Cb)({type:Boolean,json:{write:{overridePolicy:oe=>({enabled:oe})}}})],ue.prototype,"returnM",void 0),(0,x._)([(0,H.Cb)({type:Boolean,json:{write:{overridePolicy:oe=>({enabled:oe})}}})],ue.prototype,"returnZ",void 0),(0,x._)([(0,H.Cb)({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],ue.prototype,"where",void 0),ue=ie=(0,x._)([(0,J.j)("esri.rest.support.RelationshipQuery")],ue),ue.from=(0,re.se)(ue);const ce=ue},46468:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Ie});var x=T(17626),A=T(29132),G=T(79608),Q=T(46160),H=T(86810),re=T(62208),J=T(77712),Z=(T(85931),T(8314),T(90912)),ie=T(55342),ue=T(68653),ce=T(76898),oe=T(99433),le=T(74722),Y=T(51494),j=T(91179);let X=class extends((0,G.J)(H.wq)){constructor(Ge){super(Ge),this.doNotLocateOnRestrictedElements=null,this.geometry=null,this.geometryType=null,this.name=null,this.spatialRelationship=null,this.type="layer",this.where=null}};(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],X.prototype,"doNotLocateOnRestrictedElements",void 0),(0,x._)([(0,J.Cb)({types:A.qM,json:{read:j.im,write:!0}})],X.prototype,"geometry",void 0),(0,x._)([(0,ie.J)(Y.KA)],X.prototype,"geometryType",void 0),(0,x._)([(0,J.Cb)({type:String,json:{name:"layerName",write:!0}})],X.prototype,"name",void 0),(0,x._)([(0,ie.J)(Y.S7,{name:"spatialRel"})],X.prototype,"spatialRelationship",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:!0}})],X.prototype,"type",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:!0}})],X.prototype,"where",void 0),X=(0,x._)([(0,ce.j)("esri.rest.support.DataLayer")],X);const U=X;var $,ee=T(17253);let ne=$=class extends ee.default{constructor(Ge){super(Ge),this.doNotLocateOnRestrictedElements=null}clone(){return new $(or({doNotLocateOnRestrictedElements:this.doNotLocateOnRestrictedElements},this.cloneProperties()))}};(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],ne.prototype,"doNotLocateOnRestrictedElements",void 0),ne=$=(0,x._)([(0,ce.j)("esri.rest.support.NetworkFeatureSet")],ne);const se=ne;let ae=class extends((0,G.J)(H.wq)){constructor(Ge){super(Ge),this.doNotLocateOnRestrictedElements=null,this.url=null}};(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],ae.prototype,"doNotLocateOnRestrictedElements",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:!0}})],ae.prototype,"url",void 0),ae=(0,x._)([(0,ce.j)("esri.rest.support.NetworkUrl")],ae);const de=ae;var he,_e=T(67854),pe=T(65234);function me(Ge,Je,xe){(0,re.pC)(Ge)&&(Je[xe]=Q.Z.isCollection(Ge)?{features:Ge.toArray().map(je=>je.toJSON())}:Ge.toJSON())}let Ce=he=class extends((0,G.J)(H.wq)){constructor(Ge){super(Ge),this.accumulateAttributes=null,this.apiKey=null,this.attributeParameterValues=null,this.directionsLanguage=null,this.directionsLengthUnits=null,this.directionsOutputType=null,this.directionsStyleName=null,this.directionsTimeAttribute=null,this.findBestSequence=null,this.geometryPrecision=null,this.geometryPrecisionM=null,this.geometryPrecisionZ=null,this.ignoreInvalidLocations=null,this.impedanceAttribute=null,this.outputGeometryPrecision=null,this.outputGeometryPrecisionUnits=null,this.outputLines="true-shape",this.outSpatialReference=null,this.overrides=null,this.pointBarriers=null,this.polygonBarriers=null,this.polylineBarriers=null,this.preserveFirstStop=null,this.preserveLastStop=null,this.preserveObjectID=null,this.restrictionAttributes=null,this.restrictUTurns=null,this.returnBarriers=!1,this.returnDirections=!1,this.returnPolygonBarriers=!1,this.returnPolylineBarriers=!1,this.returnRoutes=!0,this.returnStops=!1,this.returnTraversedEdges=null,this.returnTraversedJunctions=null,this.returnTraversedTurns=null,this.returnZ=!0,this.startTime=null,this.startTimeIsUTC=!0,this.stops=null,this.timeWindowsAreUTC=null,this.travelMode=null,this.useHierarchy=null,this.useTimeWindows=null}static from(Ge){return(0,Z.TJ)(he,Ge)}readAccumulateAttributes(Ge){return(0,re.Wi)(Ge)?null:Ge.map(Je=>Y.Ul.fromJSON(Je))}writeAccumulateAttributes(Ge,Je,xe){!(0,re.Wi)(Ge)&&Ge.length&&(Je[xe]=Ge.map(je=>Y.Ul.toJSON(je)))}writePointBarriers(Ge,Je,xe){me(Ge,Je,xe)}writePolygonBarrier(Ge,Je,xe){me(Ge,Je,xe)}writePolylineBarrier(Ge,Je,xe){me(Ge,Je,xe)}readRestrictionAttributes(Ge){return(0,re.Wi)(Ge)?null:Ge.map(Je=>Y.kL.fromJSON(Je))}writeRestrictionAttributes(Ge,Je,xe){!(0,re.Wi)(Ge)&&Ge.length&&(Je[xe]=Ge.map(je=>Y.kL.toJSON(je)))}readStartTime(Ge,Je){const{startTime:xe}=Je;return(0,re.Wi)(xe)?null:"now"===xe?"now":new Date(xe)}writeStartTime(Ge,Je){(0,re.Wi)(Ge)||(Je.startTime="now"===Ge?"now":Ge.getTime())}readStops(Ge,Je){return function Te(Ge){return function ge(Ge){return Ge&&"type"in Ge}(Ge)?U.fromJSON(Ge):function Me(Ge){return Ge&&"url"in Ge}(Ge)?de.fromJSON(Ge):function ye(Ge){return Ge&&"features"in Ge&&"doNotLocateOnRestrictedElements"in Ge}(Ge)?se.fromJSON(Ge):function Ee(Ge){return Ge&&"features"in Ge}(Ge)?ee.default.fromJSON(Ge):null}(Je.stops)}writeStops(Ge,Je,xe){me(Ge,Je,xe)}};(0,x._)([(0,J.Cb)({type:[String],json:{name:"accumulateAttributeNames",write:!0}})],Ce.prototype,"accumulateAttributes",void 0),(0,x._)([(0,ue.r)("accumulateAttributes")],Ce.prototype,"readAccumulateAttributes",null),(0,x._)([(0,oe.c)("accumulateAttributes")],Ce.prototype,"writeAccumulateAttributes",null),(0,x._)([(0,J.Cb)(le.q)],Ce.prototype,"apiKey",void 0),(0,x._)([(0,J.Cb)({json:{write:!0}})],Ce.prototype,"attributeParameterValues",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:!0}})],Ce.prototype,"directionsLanguage",void 0),(0,x._)([(0,ie.J)(Y.GX)],Ce.prototype,"directionsLengthUnits",void 0),(0,x._)([(0,ie.J)(Y.$7)],Ce.prototype,"directionsOutputType",void 0),(0,x._)([(0,ie.J)(Y.WP)],Ce.prototype,"directionsStyleName",void 0),(0,x._)([(0,ie.J)(Y.ZI,{name:"directionsTimeAttributeName",ignoreUnknown:!1})],Ce.prototype,"directionsTimeAttribute",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"findBestSequence",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{write:!0}})],Ce.prototype,"geometryPrecision",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{write:!0}})],Ce.prototype,"geometryPrecisionM",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{write:!0}})],Ce.prototype,"geometryPrecisionZ",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"ignoreInvalidLocations",void 0),(0,x._)([(0,ie.J)(Y.Ul,{name:"impedanceAttributeName",ignoreUnknown:!1})],Ce.prototype,"impedanceAttribute",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{write:!0}})],Ce.prototype,"outputGeometryPrecision",void 0),(0,x._)([(0,ie.J)(Y.q$)],Ce.prototype,"outputGeometryPrecisionUnits",void 0),(0,x._)([(0,ie.J)(Y.no)],Ce.prototype,"outputLines",void 0),(0,x._)([(0,J.Cb)({type:pe.Z,json:{name:"outSR",write:!0}})],Ce.prototype,"outSpatialReference",void 0),(0,x._)([(0,J.Cb)({json:{write:!0}})],Ce.prototype,"overrides",void 0),(0,x._)([(0,J.Cb)({json:{name:"barriers",write:!0}})],Ce.prototype,"pointBarriers",void 0),(0,x._)([(0,oe.c)("pointBarriers")],Ce.prototype,"writePointBarriers",null),(0,x._)([(0,J.Cb)({json:{write:!0}})],Ce.prototype,"polygonBarriers",void 0),(0,x._)([(0,oe.c)("polygonBarriers")],Ce.prototype,"writePolygonBarrier",null),(0,x._)([(0,J.Cb)({json:{write:!0}})],Ce.prototype,"polylineBarriers",void 0),(0,x._)([(0,oe.c)("polylineBarriers")],Ce.prototype,"writePolylineBarrier",null),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"preserveFirstStop",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"preserveLastStop",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"preserveObjectID",void 0),(0,x._)([(0,J.Cb)({type:[String],json:{name:"restrictionAttributeNames",write:!0}})],Ce.prototype,"restrictionAttributes",void 0),(0,x._)([(0,ue.r)("restrictionAttributes")],Ce.prototype,"readRestrictionAttributes",null),(0,x._)([(0,oe.c)("restrictionAttributes")],Ce.prototype,"writeRestrictionAttributes",null),(0,x._)([(0,ie.J)(Y.ip)],Ce.prototype,"restrictUTurns",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnBarriers",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnDirections",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnPolygonBarriers",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnPolylineBarriers",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnRoutes",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnStops",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnTraversedEdges",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnTraversedJunctions",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnTraversedTurns",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"returnZ",void 0),(0,x._)([(0,J.Cb)({type:Date,json:{type:Number,write:!0}})],Ce.prototype,"startTime",void 0),(0,x._)([(0,ue.r)("startTime")],Ce.prototype,"readStartTime",null),(0,x._)([(0,oe.c)("startTime")],Ce.prototype,"writeStartTime",null),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"startTimeIsUTC",void 0),(0,x._)([(0,J.Cb)({json:{write:!0}})],Ce.prototype,"stops",void 0),(0,x._)([(0,ue.r)("stops")],Ce.prototype,"readStops",null),(0,x._)([(0,oe.c)("stops")],Ce.prototype,"writeStops",null),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"timeWindowsAreUTC",void 0),(0,x._)([(0,J.Cb)({type:_e.Z,json:{write:!0}})],Ce.prototype,"travelMode",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"useHierarchy",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],Ce.prototype,"useTimeWindows",void 0),Ce=he=(0,x._)([(0,ce.j)("esri.rest.support.RouteParameters")],Ce);const Ie=Ce},60776:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var B,x=T(17626),A=T(2076),G=T(86810),Q=T(58817),H=T(77712),J=(T(90912),T(76898)),W=T(99433);const Z=new A.X({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let ie=B=class extends G.wq{constructor(ce){super(ce),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(ce,oe){"percentile-continuous"!==this.statisticType&&"percentile-discrete"!==this.statisticType||(oe.statisticParameters=(0,Q.d9)(ce))}clone(){return new B({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:(0,Q.d9)(this.statisticParameters)})}};(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],ie.prototype,"maxPointCount",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],ie.prototype,"maxRecordCount",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],ie.prototype,"maxVertexCount",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ie.prototype,"onStatisticField",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],ie.prototype,"outStatisticFieldName",void 0),(0,x._)([(0,H.Cb)({type:String,json:{read:{source:"statisticType",reader:Z.read},write:{target:"statisticType",writer:Z.write}}})],ie.prototype,"statisticType",void 0),(0,x._)([(0,H.Cb)({type:Object})],ie.prototype,"statisticParameters",void 0),(0,x._)([(0,W.c)("statisticParameters")],ie.prototype,"writeStatisticParameters",null),ie=B=(0,x._)([(0,J.j)("esri.rest.support.StatisticDefinition")],ie);const ue=ie},6871:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ne});var oe,x=T(17626),A=T(29132),G=T(97478),Q=T(2076),H=T(86810),re=T(58817),J=T(77712),W=T(90912),B=T(76898),Z=T(99433),ie=T(91179);T(85931),T(8314);let le=oe=class extends H.wq{constructor(se){super(se),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new oe({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};(0,x._)([(0,J.Cb)({type:[String],json:{write:!0}})],le.prototype,"groupByFields",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{write:!0}})],le.prototype,"topCount",void 0),(0,x._)([(0,J.Cb)({type:[String],json:{write:!0}})],le.prototype,"orderByFields",void 0),le=oe=(0,x._)([(0,B.j)("esri.rest.support.TopFilter")],le);const Y=le;var X,j=T(65234);const U=new Q.X({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),ee=new Q.X({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let $=X=class extends H.wq{constructor(se){super(se),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(se,ae){ae.resultOffset=this.start,ae.resultRecordCount=this.num||10}clone(){return new X((0,re.d9)({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};(0,x._)([(0,J.Cb)({type:Boolean,json:{write:!0}})],$.prototype,"cacheHint",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{write:{overridePolicy:se=>({enabled:se>0})}}})],$.prototype,"distance",void 0),(0,x._)([(0,J.Cb)({types:A.qM,json:{read:ie.im,write:!0}})],$.prototype,"geometry",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{write:!0}})],$.prototype,"geometryPrecision",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{write:!0}})],$.prototype,"maxAllowableOffset",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{read:{source:"resultRecordCount"}}})],$.prototype,"num",void 0),(0,x._)([(0,J.Cb)({json:{write:!0}})],$.prototype,"objectIds",void 0),(0,x._)([(0,J.Cb)({type:[String],json:{write:!0}})],$.prototype,"orderByFields",void 0),(0,x._)([(0,J.Cb)({type:[String],json:{write:!0}})],$.prototype,"outFields",void 0),(0,x._)([(0,J.Cb)({type:j.Z,json:{read:{source:"outSR"},write:{target:"outSR"}}})],$.prototype,"outSpatialReference",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:!0}})],$.prototype,"resultType",void 0),(0,x._)([(0,J.Cb)({json:{write:!0}})],$.prototype,"returnGeometry",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:{overridePolicy:se=>({enabled:se})}}})],$.prototype,"returnM",void 0),(0,x._)([(0,J.Cb)({type:Boolean,json:{write:{overridePolicy:se=>({enabled:se})}}})],$.prototype,"returnZ",void 0),(0,x._)([(0,J.Cb)({type:Number,json:{read:{source:"resultOffset"}}})],$.prototype,"start",void 0),(0,x._)([(0,Z.c)("start"),(0,Z.c)("num")],$.prototype,"writeStart",null),(0,x._)([(0,J.Cb)({type:String,json:{read:{source:"spatialRel",reader:U.read},write:{target:"spatialRel",writer:U.write}}})],$.prototype,"spatialRelationship",void 0),(0,x._)([(0,J.Cb)({type:G.Z,json:{write:!0}})],$.prototype,"timeExtent",void 0),(0,x._)([(0,J.Cb)({type:Y,json:{write:!0}})],$.prototype,"topFilter",void 0),(0,x._)([(0,J.Cb)({type:String,json:{read:ee.read,write:{writer:ee.write,overridePolicy(se){return{enabled:se&&this.distance>0}}}}})],$.prototype,"units",void 0),(0,x._)([(0,J.Cb)({type:String,json:{write:!0}})],$.prototype,"where",void 0),$=X=(0,x._)([(0,B.j)("esri.rest.support.TopFeaturesQuery")],$),$.from=(0,W.se)($);const ne=$},67854:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var x=T(17626),A=T(79608),G=T(86810),Q=T(62208),H=T(77712),B=(T(85931),T(8314),T(90912),T(55342)),Z=T(68653),ie=T(76898),ue=T(99433),ce=T(51494);let oe=class extends((0,A.J)(G.wq)){constructor(Y){super(Y),this.attributeParameterValues=null,this.description=null,this.distanceAttributeName=null,this.id=null,this.impedanceAttributeName=null,this.name=null,this.restrictionAttributeNames=null,this.simplificationTolerance=null,this.simplificationToleranceUnits=null,this.timeAttributeName=null,this.type=null,this.useHierarchy=null,this.uturnAtJunctions=null}readRestrictionAttributes(Y,j){const{restrictionAttributeNames:X}=j;return(0,Q.Wi)(X)?null:X.map(U=>ce.kL.fromJSON(U))}writeRestrictionAttributes(Y,j,X){!(0,Q.Wi)(Y)&&Y.length&&(j[X]=Y.map(U=>ce.kL.toJSON(U)))}};(0,x._)([(0,H.Cb)({type:[Object],json:{write:!0}})],oe.prototype,"attributeParameterValues",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"description",void 0),(0,x._)([(0,B.J)(ce.D$,{ignoreUnknown:!1})],oe.prototype,"distanceAttributeName",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"id",void 0),(0,x._)([(0,B.J)(ce.Ul,{ignoreUnknown:!1})],oe.prototype,"impedanceAttributeName",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"name",void 0),(0,x._)([(0,H.Cb)({type:[String],json:{write:!0}})],oe.prototype,"restrictionAttributeNames",void 0),(0,x._)([(0,Z.r)("restrictionAttributeNames")],oe.prototype,"readRestrictionAttributes",null),(0,x._)([(0,ue.c)("restrictionAttributeNames")],oe.prototype,"writeRestrictionAttributes",null),(0,x._)([(0,H.Cb)({type:Number,json:{write:{allowNull:!0}}})],oe.prototype,"simplificationTolerance",void 0),(0,x._)([(0,B.J)(ce.q$)],oe.prototype,"simplificationToleranceUnits",void 0),(0,x._)([(0,B.J)(ce.ZI,{ignoreUnknown:!1})],oe.prototype,"timeAttributeName",void 0),(0,x._)([(0,B.J)(ce.DJ)],oe.prototype,"type",void 0),(0,x._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],oe.prototype,"useHierarchy",void 0),(0,x._)([(0,B.J)(ce.ip)],oe.prototype,"uturnAtJunctions",void 0),oe=(0,x._)([(0,ie.j)("esri.rest.support.TravelMode")],oe);const le=oe},79023:(dt,Re,T)=>{"use strict";T.d(Re,{V:()=>Q,i:()=>H});var x=T(40251),A=T(40669),G=T(75414);const Q={key:"type",base:A.Z,typeMap:{algorithmic:x.Z,multipart:G.Z}};function H(re){return re&&re.type?"algorithmic"===re.type?x.Z.fromJSON(re):"multipart"===re.type?G.Z.fromJSON(re):null:null}},74722:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>x});const x={type:String,json:{read:{source:"token"},write:{target:"token"}}}},51494:(dt,Re,T)=>{"use strict";T.d(Re,{$7:()=>H,BW:()=>le,D$:()=>$,DJ:()=>ie,Dd:()=>j,E2:()=>pe,GX:()=>G,KA:()=>_e,S7:()=>de,SS:()=>oe,Ul:()=>se,W7:()=>ue,WP:()=>ee,ZI:()=>ne,cW:()=>X,hB:()=>Q,ip:()=>W,kL:()=>ae,no:()=>re,oi:()=>Y,q$:()=>A,td:()=>U,yP:()=>ce});var x=T(2076);const A=(0,x.w)()({esriCentimeters:"centimeters",esriDecimalDegrees:"decimal-degrees",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriPoints:"points",esriUnknownUnits:"unknown",esriYards:"yards"}),G=(0,x.w)()({esriNAUCentimeters:"centimeters",esriNAUDecimalDegrees:"decimal-degrees",esriNAUDecimeters:"decimeters",esriNAUFeet:"feet",esriNAUInches:"inches",esriNAUKilometers:"kilometers",esriNAUMeters:"meters",esriNAUMiles:"miles",esriNAUMillimeters:"millimeters",esriNAUNauticalMiles:"nautical-miles",esriNAUPoints:"points",esriNAUYards:"yards"}),Q=(0,x.w)()({esriNAUDays:"days",esriNAUHours:"hours",esriNAUMinutes:"minutes",esriNAUSeconds:"seconds"}),H=(0,x.w)()({esriDOTComplete:"complete",esriDOTCompleteNoEvents:"complete-no-events",esriDOTFeatureSets:"featuresets",esriDOTInstructionsOnly:"instructions-only",esriDOTStandard:"standard",esriDOTSummaryOnly:"summary-only"}),re=(0,x.w)()({esriNAOutputLineNone:"none",esriNAOutputLineStraight:"straight",esriNAOutputLineTrueShape:"true-shape",esriNAOutputLineTrueShapeWithMeasure:"true-shape-with-measure"}),W=((0,x.w)()({esriNAOutputPolygonNone:"none",esriNAOutputPolygonSimplified:"simplified",esriNAOutputPolygonDetailed:"detailed"}),(0,x.w)()({esriNFSBAllowBacktrack:"allow-backtrack",esriNFSBAtDeadEndsOnly:"at-dead-ends-only",esriNFSBNoBacktrack:"no-backtrack",esriNFSBAtDeadEndsAndIntersections:"at-dead-ends-and-intersections"})),ie=((0,x.w)()({esriNATravelDirectionFromFacility:"from-facility",esriNATravelDirectionToFacility:"to-facility"}),(0,x.w)()({esriNATimeOfDayNotUsed:"not-used",esriNATimeOfDayUseAsStartTime:"start",esriNATimeOfDayUseAsEndTime:"end"}),(0,x.w)()({AUTOMOBILE:"automobile",TRUCK:"truck",WALK:"walk",OTHER:"other"})),ue=(0,x.w)()({0:"either-side-of-vehicle",1:"right-side-of-vehicle",2:"left-side-of-vehicle",3:"no-u-turn"},{useNumericKeys:!0}),ce=(0,x.w)()({0:"stop",1:"waypoint",2:"break"},{useNumericKeys:!0}),oe=(0,x.w)()({0:"ok",1:"not-located",2:"network-element-not-located",3:"element-not-traversable",4:"invalid-field-values",5:"not-reached",6:"time-window-violation",7:"not-located-on-closest"},{useNumericKeys:!0}),le=(0,x.w)()({1:"right",2:"left"},{useNumericKeys:!0}),Y=(0,x.w)()({0:"restriction",1:"added-cost"},{useNumericKeys:!0}),j=(0,x.w)()({0:"permit",1:"restrict"},{useNumericKeys:!0}),X=(0,x.w)()({1:"header",50:"arrive",51:"depart",52:"straight",100:"on-ferry",101:"off-ferry",102:"central-fork",103:"roundabout",104:"u-turn",150:"door",151:"stairs",152:"elevator",153:"escalator",154:"pedestrian-ramp",200:"left-fork",201:"left-ramp",202:"clockwise-roundabout",203:"left-handed-u-turn",204:"bear-left",205:"left-turn",206:"sharp-left",207:"left-turn-and-immediate-left-turn",208:"left-turn-and-immediate-right-turn",300:"right-fork",301:"right-ramp",302:"counter-clockwise-roundabout",303:"right-handed-u-turn",304:"bear-right",305:"right-turn",306:"sharp-right",307:"right-turn-and-immediate-left-turn",308:"right-turn-and-immediate-right-turn",400:"up-elevator",401:"up-escalator",402:"up-stairs",500:"down-elevator",501:"down-escalator",502:"down-stairs",1e3:"general-event",1001:"landmark",1002:"time-zone-change",1003:"traffic-event",1004:"scaled-cost-barrier-event",1005:"boundary-crossing",1006:"restriction-violation"},{useNumericKeys:!0}),U=(0,x.w)()({0:"unknown",1:"segment",2:"maneuver-segment",3:"restriction-violation",4:"scaled-cost-barrier",5:"heavy-traffic",6:"slow-traffic",7:"moderate-traffic"},{useNumericKeys:!0}),ee=(0,x.w)()({"NA Campus":"campus","NA Desktop":"desktop","NA Navigation":"navigation"}),$=(0,x.w)()({Kilometers:"kilometers",Miles:"miles"},{ignoreUnknown:!1}),ne=(0,x.w)()({Minutes:"minutes",TimeAt1KPH:"time-at-1-kph",TravelTime:"travel-time",TruckMinutes:"truck-minutes",TruckTravelTime:"truck-travel-time",WalkTime:"walk-time"},{ignoreUnknown:!1}),se=(0,x.w)()({Kilometers:"kilometers",Miles:"miles",Minutes:"minutes",TimeAt1KPH:"time-at-1-kph",TravelTime:"travel-time",TruckMinutes:"truck-minutes",TruckTravelTime:"truck-travel-time",WalkTime:"walk-time"},{ignoreUnknown:!1}),ae=(0,x.w)()({"Any Hazmat Prohibited":"any-hazmat-prohibited","Avoid Carpool Roads":"avoid-carpool-roads","Avoid Express Lanes":"avoid-express-lanes","Avoid Ferries":"avoid-ferries","Avoid Gates":"avoid-gates","Avoid Limited Access Roads":"avoid-limited-access-roads","Avoid Private Roads":"avoid-private-roads","Avoid Roads Unsuitable for Pedestrians":"avoid-roads-unsuitable-for-pedestrians","Avoid Stairways":"avoid-stairways","Avoid Toll Roads":"avoid-toll-roads","Avoid Toll Roads for Trucks":"avoid-toll-roads-for-trucks","Avoid Truck Restricted Roads":"avoid-truck-restricted-roads","Avoid Unpaved Roads":"avoid-unpaved-roads","Axle Count Restriction":"axle-count-restriction","Driving a Bus":"driving-a-bus","Driving a Taxi":"driving-a-taxi","Driving a Truck":"driving-a-truck","Driving an Automobile":"driving-an-automobile","Driving an Emergency Vehicle":"driving-an-emergency-vehicle","Height Restriction":"height-restriction","Kingpin to Rear Axle Length Restriction":"kingpin-to-rear-axle-length-restriction","Length Restriction":"length-restriction","Preferred for Pedestrians":"preferred-for-pedestrians","Riding a Motorcycle":"riding-a-motorcycle","Roads Under Construction Prohibited":"roads-under-construction-prohibited","Semi or Tractor with One or More Trailers Prohibited":"semi-or-tractor-with-one-or-more-trailers-prohibited","Single Axle Vehicles Prohibited":"single-axle-vehicles-prohibited","Tandem Axle Vehicles Prohibited":"tandem-axle-vehicles-prohibited","Through Traffic Prohibited":"through-traffic-prohibited","Truck with Trailers Restriction":"truck-with-trailers-restriction","Use Preferred Hazmat Routes":"use-preferred-hazmat-routes","Use Preferred Truck Routes":"use-preferred-truck-routes",Walking:"walking","Weight Restriction":"weight-restriction"},{ignoreUnknown:!1}),de=(0,x.w)()({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),_e=(0,x.w)()({esriGeometryPoint:"point",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"envelope",esriGeometryMultipoint:"multipoint"}),pe=(0,x.w)()({esriNAUTCost:"cost",esriNAUTDescriptor:"descriptor",esriNAUTRestriction:"restriction",esriNAUTHierarchy:"hierarchy"})},2618:(dt,Re,T)=>{"use strict";T.d(Re,{cv:()=>H,en:()=>Q,lA:()=>G});var x=T(58817),A=T(21726);function G(re,J){return J?yi(or({},J),{query:or(or({},re),J.query)}):{query:re}}function Q(re){return"string"==typeof re?(0,A.mN)(re):(0,x.d9)(re)}function H(re,J,W){const B={};for(const Z in re){if("declaredClass"===Z)continue;const ie=re[Z];if(null!=ie&&"function"!=typeof ie)if(Array.isArray(ie)){B[Z]=[];for(let ue=0;ue<ie.length;ue++)B[Z][ue]=H(ie[ue])}else if("object"==typeof ie)if(ie.toJSON){const ue=ie.toJSON(W&&W[Z]);B[Z]=J?ue:JSON.stringify(ue)}else B[Z]=J?ie:JSON.stringify(ie);else B[Z]=ie}return B}},63930:(dt,Re,T)=>{"use strict";T.d(Re,{G2:()=>me,oF:()=>Je,XL:()=>de,i5:()=>ae,H0:()=>se,eT:()=>Me,Qm:()=>Ee,Lq:()=>_e,fk:()=>Te,S5:()=>ne,F_:()=>ye,DL:()=>Ge});var x=T(79767);function A(Ne,we){return Number(Ne.toFixed(we))}function H(Ne){const we=Ne.definition,{classificationMethod:Oe,breakCount:$e,normalizationType:Be,definedInterval:Se}=we,De=[];let Fe=Ne.values;if(0===Fe.length)return[];Fe=Fe.sort((qe,be)=>qe-be);const ve=Fe[0],Ke=Fe[Fe.length-1];if("equal-interval"===Oe)if(Fe.length>=$e){const qe=(Ke-ve)/$e;let be=ve;for(let tt=1;tt<$e;tt++){const Ye=A(ve+tt*qe,6);De.push({minValue:be,maxValue:Ye,label:re(be,Ye,Be)}),be=Ye}De.push({minValue:be,maxValue:Ke,label:re(be,Ke,Be)})}else Fe.forEach(qe=>{De.push({minValue:qe,maxValue:qe,label:re(qe,qe,Be)})});else if("natural-breaks"===Oe){const qe=function J(Ne){const we=[],Oe=[];let $e=Number.MIN_VALUE,Be=1,Se=-1;for(let De=0;De<Ne.length;De++){const Fe=Ne[De];Fe===$e?(Be++,Oe[Se]=Be):null!==Fe&&(we.push(Fe),$e=Fe,Be=1,Oe.push(Be),Se++)}return{uniqueValues:we,valueFrequency:Oe}}(Fe),tt=function W(Ne,we,Oe){const $e=Ne.length,Be=[];Oe>$e&&(Oe=$e);for(let De=0;De<Oe;De++)Be.push(Math.round(De*$e/Oe-1));Be.push($e-1);let Se=B(Be,Ne,we,Oe);return function Z(Ne,we,Oe,$e,Be,Se){let De=0,Fe=0,ve=0,Ke=0,qe=!0;for(let be=0;be<2&&qe;be++){0===be&&(qe=!1);for(let tt=0;tt<Se-1;tt++)for(;Oe[tt+1]+1!==Oe[tt+2];){Oe[tt+1]=Oe[tt+1]+1;const Ye=oe(tt,Oe,$e,Be);ve=Ye.sbMean,De=Ye.sbSdcm;const ze=oe(tt+1,Oe,$e,Be);if(Ke=ze.sbMean,Fe=ze.sbSdcm,!(De+Fe<we[tt]+we[tt+1])){Oe[tt+1]=Oe[tt+1]-1;break}we[tt]=De,we[tt+1]=Fe,Ne[tt]=ve,Ne[tt+1]=Ke,qe=!0}for(let tt=Se-1;tt>0;tt--)for(;Oe[tt]!==Oe[tt-1]+1;){Oe[tt]=Oe[tt]-1;const Ye=oe(tt-1,Oe,$e,Be);ve=Ye.sbMean,De=Ye.sbSdcm;const ze=oe(tt,Oe,$e,Be);if(Ke=ze.sbMean,Fe=ze.sbSdcm,!(De+Fe<we[tt-1]+we[tt])){Oe[tt]=Oe[tt]+1;break}we[tt-1]=De,we[tt]=Fe,Ne[tt-1]=ve,Ne[tt]=Ke,qe=!0}}return qe}(Se.mean,Se.sdcm,Be,Ne,we,Oe)&&(Se=B(Be,Ne,we,Oe)),Be}(qe.uniqueValues,Ne.valueFrequency||qe.valueFrequency,$e);let Ye=ve;for(let ze=1;ze<$e;ze++)if(qe.uniqueValues.length>ze){const et=A(qe.uniqueValues[tt[ze]],6);De.push({minValue:Ye,maxValue:et,label:re(Ye,et,Be)}),Ye=et}De.push({minValue:Ye,maxValue:Ke,label:re(Ye,Ke,Be)})}else if("quantile"===Oe)if(Fe.length>=$e&&ve!==Ke){let qe=ve,be=Math.ceil(Fe.length/$e),tt=0;for(let Ye=1;Ye<$e;Ye++){let ze=be+tt-1;ze>Fe.length&&(ze=Fe.length-1),ze<0&&(ze=0),De.push({minValue:qe,maxValue:Fe[ze],label:re(qe,Fe[ze],Be)}),qe=Fe[ze],tt+=be,be=Math.ceil((Fe.length-tt)/($e-Ye))}De.push({minValue:qe,maxValue:Ke,label:re(qe,Ke,Be)})}else{let qe=-1;for(let be=0;be<Fe.length;be++){const tt=Fe[be];tt!==qe&&(qe=tt,De.push({minValue:qe,maxValue:tt,label:re(qe,tt,Be)}),qe=tt)}}else if("standard-deviation"===Oe){const qe=function ue(Ne){let we=0;for(let Oe=0;Oe<Ne.length;Oe++)we+=Ne[Oe];return we/=Ne.length,we}(Fe),be=function ce(Ne,we){let Oe=0;for(let $e=0;$e<Ne.length;$e++){const Be=Ne[$e];Oe+=(Be-we)*(Be-we)}return Oe/=Ne.length,Math.sqrt(Oe)}(Fe,qe);if(0===be)De.push({minValue:Fe[0],maxValue:Fe[0],label:re(Fe[0],Fe[0],Be)});else{const tt=function ie(Ne,we,Oe,$e,Be){let Se=Math.max($e-Ne,we-$e)/Be/Oe;return Se=Se>=1?1:Se>=.5?.5:.25,Se}(ve,Ke,$e,qe,be)*be;let Ye=0,ze=ve;for(let ke=$e;ke>=1;ke--){const ot=A(qe-(ke-.5)*tt,6);De.push({minValue:ze,maxValue:ot,label:re(ze,ot,Be)}),ze=ot,Ye++}let et=A(qe+.5*tt,6);De.push({minValue:ze,maxValue:et,label:re(ze,et,Be)}),ze=et,Ye++;for(let ke=1;ke<=$e;ke++)et=Ye===2*$e?Ke:A(qe+(ke+.5)*tt,6),De.push({minValue:ze,maxValue:et,label:re(ze,et,Be)}),ze=et,Ye++}}else if("defined-interval"===Oe){if(!Se)return De;const qe=Fe[0],be=Fe[Fe.length-1],tt=Math.ceil((be-qe)/Se);let Ye=qe;for(let ze=1;ze<tt;ze++){const et=A(qe+ze*Se,6);De.push({minValue:Ye,maxValue:et,label:re(Ye,et,Be)}),Ye=et}De.push({minValue:Ye,maxValue:be,label:re(Ye,be,Be)})}return De}function re(Ne,we,Oe){let $e=null;return $e=Ne===we?Oe&&"percent-of-total"===Oe?Ne+"%":Ne.toString():Oe&&"percent-of-total"===Oe?Ne+"% - "+we+"%":Ne+" - "+we,$e}function B(Ne,we,Oe,$e){let Be=[],Se=[],De=[],Fe=0;const ve=[],Ke=[];for(let Ye=0;Ye<$e;Ye++){const ze=oe(Ye,Ne,we,Oe);ve.push(ze.sbMean),Ke.push(ze.sbSdcm),Fe+=Ke[Ye]}let qe,be=Fe,tt=!0;for(;tt||Fe<be;){tt=!1,Be=[];for(let Ye=0;Ye<$e;Ye++)Be.push(Ne[Ye]);for(let Ye=0;Ye<$e;Ye++)for(let ze=Ne[Ye]+1;ze<=Ne[Ye+1];ze++)if(qe=we[ze],Ye>0&&ze!==Ne[Ye+1]&&Math.abs(qe-ve[Ye])>Math.abs(qe-ve[Ye-1]))Ne[Ye]=ze;else if(Ye<$e-1&&Ne[Ye]!==ze-1&&Math.abs(qe-ve[Ye])>Math.abs(qe-ve[Ye+1])){Ne[Ye+1]=ze-1;break}be=Fe,Fe=0,Se=[],De=[];for(let Ye=0;Ye<$e;Ye++){Se.push(ve[Ye]),De.push(Ke[Ye]);const ze=oe(Ye,Ne,we,Oe);ve[Ye]=ze.sbMean,Ke[Ye]=ze.sbSdcm,Fe+=Ke[Ye]}}if(Fe>be){for(let Ye=0;Ye<$e;Ye++)Ne[Ye]=Be[Ye],ve[Ye]=Se[Ye],Ke[Ye]=De[Ye];Fe=be}return{mean:ve,sdcm:Ke}}function oe(Ne,we,Oe,$e){let Be=0,Se=0;for(let ve=we[Ne]+1;ve<=we[Ne+1];ve++){const Ke=$e[ve];Be+=Oe[ve]*Ke,Se+=Ke}Se<=0&&console.log("Exception in Natural Breaks calculation");const De=Be/Se;let Fe=0;for(let ve=we[Ne]+1;ve<=we[Ne+1];ve++)Fe+=$e[ve]*(Oe[ve]-De)**2;return{sbMean:De,sbSdcm:Fe}}const U=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,ee=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),$=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function ne(Ne){return!(null!=Ne.normalizationField||null!=Ne.normalizationType||null!=Ne.minValue||null!=Ne.maxValue||Ne.sqlExpression&&Ne.supportsSQLExpression)}function se(Ne){const we=Ne.returnDistinct?[...new Set(Ne.values)]:Ne.values,Oe=we.filter(Be=>null!=Be).length,$e={count:Oe};return Ne.supportsNullCount&&($e.nullcount=we.length-Oe),Ne.percentileParams&&($e.median=de(we,Ne.percentileParams)),$e}function ae(Ne){const{values:we,useSampleStdDev:Oe,supportsNullCount:$e}=Ne;let Be=Number.POSITIVE_INFINITY,Se=Number.NEGATIVE_INFINITY,De=null,Fe=null,ve=null,Ke=null,qe=0;const be=null==Ne.minValue?-1/0:Ne.minValue,tt=null==Ne.maxValue?1/0:Ne.maxValue;for(const ze of we)Number.isFinite(ze)?ze>=be&&ze<=tt&&(De+=ze,Be=Math.min(Be,ze),Se=Math.max(Se,ze),qe++):"string"==typeof ze&&qe++;if(qe&&null!=De){Fe=De/qe;let ze=0;for(const et of we)Number.isFinite(et)&&et>=be&&et<=tt&&(ze+=(et-Fe)**2);Ke=Oe?qe>1?ze/(qe-1):0:qe>0?ze/qe:0,ve=Math.sqrt(Ke)}else Be=null,Se=null;const Ye={avg:Fe,count:qe,max:Se,min:Be,stddev:ve,sum:De,variance:Ke};return $e&&(Ye.nullcount=we.length-qe),Ne.percentileParams&&(Ye.median=de(we,Ne.percentileParams)),Ye}function de(Ne,we){const{fieldType:Oe,value:$e,orderBy:Be,isDiscrete:Se}=we,De=_e(Oe,"desc"===Be);if(0===(Ne=[...Ne].filter(Ye=>null!=Ye).sort((Ye,ze)=>De(Ye,ze))).length)return null;if($e<=0)return Ne[0];if($e>=1)return Ne[Ne.length-1];const Fe=(Ne.length-1)*$e,ve=Math.floor(Fe),Ke=ve+1,qe=Fe%1,be=Ne[ve],tt=Ne[Ke];return Ke>=Ne.length||Se||"string"==typeof be||"string"==typeof tt?be:be*(1-qe)+tt*qe}function _e(Ne,we){const Oe=we?1:-1,$e=function he(Ne){return Ne?(we,Oe)=>Oe-we:(we,Oe)=>we-Oe}(we),Be=pe(we);if(!Ne||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...ee].includes(Ne))return(Se,De)=>"number"==typeof Se&&"number"==typeof De?$e(Se,De):"string"==typeof Se&&"string"==typeof De?Be(Se,De):Oe;if("esriFieldTypeDate"===Ne)return(Se,De)=>{const Fe=new Date(Se).getTime(),ve=new Date(De).getTime();return isNaN(Fe)||isNaN(ve)?Oe:$e(Fe,ve)};if(ee.has(Ne))return(Se,De)=>$e(Se,De);if("esriFieldTypeString"===Ne)return(Se,De)=>Be(Se,De);if("esriFieldTypeGUID"===Ne||"esriFieldTypeGlobalID"===Ne){const Se=pe(we);return(De,Fe)=>Se(ge(De),ge(Fe))}return we?(Se,De)=>1:(Se,De)=>-1}function pe(Ne){return Ne?(we,Oe)=>(we=null==we?void 0:we.toUpperCase())>(Oe=null==Oe?void 0:Oe.toUpperCase())?-1:we<Oe?1:0:(we,Oe)=>(we=null==we?void 0:we.toUpperCase())<(Oe=null==Oe?void 0:Oe.toUpperCase())?-1:we>Oe?1:0}function ge(Ne){return Ne.substr(24,12)+Ne.substr(19,4)+Ne.substr(16,2)+Ne.substr(14,2)+Ne.substr(11,2)+Ne.substr(9,2)+Ne.substr(6,2)+Ne.substr(4,2)+Ne.substr(2,2)+Ne.substr(0,2)}function ye(Ne,we){let Oe;for(Oe in Ne)$.includes(Oe)&&(Number.isFinite(Ne[Oe])||(Ne[Oe]=null));return we&&["avg","stddev","variance"].forEach($e=>{null!=Ne[$e]&&(Ne[$e]=Math.ceil(Ne[$e]))}),Ne}function Me(Ne){const we={};for(let Oe of Ne)(null==Oe||"string"==typeof Oe&&""===Oe.trim())&&(Oe=null),null==we[Oe]?we[Oe]={count:1,data:Oe}:we[Oe].count++;return{count:we}}function Ee(Ne,we,Oe){const $e=Ne.count,Be=[];Oe&&we&&"coded-value"===we.type&&we.codedValues.forEach(Se=>{const De=Se.code;$e.hasOwnProperty(De)||($e[De]={data:De,count:0})});for(const Se in $e){const De=$e[Se];Be.push({value:De.data,count:De.count,label:De.label})}return{uniqueValueInfos:Be}}function Te(Ne,we,Oe,$e){let Be=null;switch(we){case"log":0!==Ne&&(Be=Math.log(Ne)*Math.LOG10E);break;case"percent-of-total":Number.isFinite($e)&&0!==$e&&(Be=Ne/$e*100);break;case"field":Number.isFinite(Oe)&&0!==Oe&&(Be=Ne/Oe);break;case"natural-log":Ne>0&&(Be=Math.log(Ne));break;case"square-root":Ne>0&&(Be=Ne**.5)}return Be}function me(Ne,we){const Oe=function Ie(Ne){const we=Ne.field,Oe=Ne.classificationMethod||"equal-interval",$e=Ne.normalizationType,Be=Ne.normalizationField,Se=new x.Z;return Se.classificationField=we,Se.breakCount=Ne.breakCount,Se.classificationMethod=Oe,Se.standardDeviationInterval="standard-deviation"===Oe?Ne.standardDeviationInterval||1:void 0,Se.normalizationType=$e,Se.normalizationField="field"===$e?Be:void 0,Se}({field:we.field,normalizationType:we.normalizationType,normalizationField:we.normalizationField,classificationMethod:we.classificationMethod,standardDeviationInterval:we.standardDeviationInterval,breakCount:we.numClasses||5});return Ne=function Ce(Ne,we,Oe){return we=null==we?-1/0:we,Oe=null==Oe?1/0:Oe,Ne.filter($e=>Number.isFinite($e)&&$e>=we&&$e<=Oe)}(Ne,we.minValue,we.maxValue),function Q(Ne){const{normalizationTotal:we}=Ne;return{classBreaks:H(Ne),normalizationTotal:we}}({definition:Oe,values:Ne,normalizationTotal:we.normalizationTotal})}function Ge(Ne,we){let Oe=Ne.classBreaks;const Be=Oe[0].minValue,Se=Oe[Oe.length-1].maxValue,De="standard-deviation"===we,Fe=U;return Oe=Oe.map(ve=>{const Ke=ve.label,qe={minValue:ve.minValue,maxValue:ve.maxValue,label:Ke};if(De&&Ke){const be=Ke.match(Fe).map(tt=>+tt.trim());2===be.length?(qe.minStdDev=be[0],qe.maxStdDev=be[1],be[0]<0&&be[1]>0&&(qe.hasAvg=!0)):1===be.length&&(Ke.includes("<")?(qe.minStdDev=null,qe.maxStdDev=be[0]):Ke.includes(">")&&(qe.minStdDev=be[0],qe.maxStdDev=null))}return qe}),{minValue:Be,maxValue:Se,classBreakInfos:Oe,normalizationTotal:Ne.normalizationTotal}}function Je(Ne,we){const{min:Oe,max:$e,intervals:Be}=function xe(Ne,we){const{field:Oe,classificationMethod:$e,standardDeviationInterval:Be,normalizationType:Se,normalizationField:De,normalizationTotal:Fe,minValue:ve,maxValue:Ke}=we,qe=we.numBins||10;let be=null,tt=null,Ye=null;if($e&&"equal-interval"!==$e||Se){const{classBreaks:ze}=me(Ne,{field:Oe,normalizationType:Se,normalizationField:De,normalizationTotal:Fe,classificationMethod:$e,standardDeviationInterval:Be,minValue:ve,maxValue:Ke,numClasses:qe});be=ze[0].minValue,tt=ze[ze.length-1].maxValue,Ye=ze.map(et=>[et.minValue,et.maxValue])}else{if(null!=ve&&null!=Ke)be=ve,tt=Ke;else{const ze=ae({values:Ne,minValue:ve,maxValue:Ke,useSampleStdDev:!Se,supportsNullCount:ne({normalizationType:Se,normalizationField:De,minValue:ve,maxValue:Ke})});be=ze.min,tt=ze.max}Ye=function We(Ne,we,Oe){const $e=(we-Ne)/Oe,Be=[];let Se,De=Ne;for(let Fe=1;Fe<=Oe;Fe++)Se=De+$e,Se=Number(Se.toFixed(16)),Be.push([De,Fe===Oe?we:Se]),De=Se;return Be}(be,tt,qe)}return{min:be,max:tt,intervals:Ye}}(Ne,we),Se=Be.map((De,Fe)=>({minValue:Be[Fe][0],maxValue:Be[Fe][1],count:0}));for(const De of Ne)if(null!=De&&De>=Oe&&De<=$e){const Fe=je(Be,De);Fe>-1&&Se[Fe].count++}return{bins:Se,minValue:Oe,maxValue:$e,normalizationTotal:we.normalizationTotal}}function je(Ne,we){let Oe=-1;for(let $e=Ne.length-1;$e>=0;$e--)if(we>=Ne[$e][0]){Oe=$e;break}return Oe}},51815:(dt,Re,T)=>{"use strict";T.d(Re,{J:()=>ie});var x=T(17626),A=T(88879),Q=(T(63290),T(90912)),W=(T(85931),T(8314),T(82255),T(61039)),B=T(76898),Z=T(28705);let ie=class extends Z.a{_own(ue){ue.layer&&"remove"in ue.layer&&ue.layer!==this.owner&&ue.layer.remove(ue),ue.layer=this.owner}_release(ue){ue.layer===this.owner&&(ue.layer=null)}};(0,x._)([(0,W.c)({Type:A.Z,ensureType:(0,Q.se)(A.Z)})],ie.prototype,"itemType",void 0),ie=(0,x._)([(0,B.j)("esri.support.GraphicsCollection")],ie)},6432:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>oe});var x=T(17626),A=T(46160),G=T(89726),Q=T(63290),H=T(10699),re=T(77712),Z=(T(85931),T(8314),T(90912),T(76898)),ie=T(44917);function ue(le,Y,j){let X,U;if(le)for(let ee=0,$=le.length;ee<$;ee++){if(X=le.getItemAt(ee),X[Y]===j)return X;if("group"===(null==X?void 0:X.type)&&(U=ue(X.layers,Y,j),U))return U}}const ce=Q.Z.getLogger("esri.support.LayersMixin"),oe=le=>{let Y=class extends le{constructor(...j){super(...j),this.layers=new A.Z;const U=$=>{$.parent=this,this.layerAdded($),"elevation"!==$.type&&"base-elevation"!==$.type||ce.error(`Layer 'title:${$.title}, id:${$.id}' of type '${$.type}' is not supported as an operational layer and will therefore be ignored.`)},ee=$=>{$.parent=null,this.layerRemoved($)};this.layers.on("before-add",$=>($=>{$.parent&&"remove"in $.parent&&$.parent.remove($)})($.item)),this.layers.on("after-add",$=>U($.item)),this.layers.on("after-remove",$=>ee($.item))}destroy(){const j=this.layers.removeAll();for(const X of j)this.layerRemoved(X),X.destroy();this.layers.destroy()}set layers(j){this._set("layers",(0,G.Z)(j,this._get("layers")))}add(j,X){const U=this.layers;if(X=U.getNextIndex(X),j instanceof ie.Z){const ee=j;ee.parent===this?this.reorder(ee,X):U.add(ee,X)}else(0,H.y8)(j)?j.then(ee=>{this.destroyed||this.add(ee,X)}):ce.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(j,X){const U=this.layers;X=U.getNextIndex(X),j.slice().forEach(ee=>{ee.parent!==this?(U.add(ee,X),X+=1):this.reorder(ee,X)})}findLayerById(j){return ue(this.layers,"id",j)}findLayerByUid(j){return ue(this.layers,"uid",j)}remove(j){return this.layers.remove(j)}removeMany(j){return this.layers.removeMany(j)}removeAll(){return this.layers.removeAll()}reorder(j,X){return this.layers.reorder(j,X)}layerAdded(j){}layerRemoved(j){}};return(0,x._)([(0,re.Cb)()],Y.prototype,"layers",null),Y=(0,x._)([(0,Z.j)("esri.support.LayersMixin")],Y),Y}},6119:(dt,Re,T)=>{"use strict";T.d(Re,{Q:()=>ce});var x=T(17626),A=T(46160),G=T(89726),Q=T(63290),H=T(77712),B=(T(85931),T(8314),T(90912),T(76898));const Z="esri.support.TablesMixin",ie=Q.Z.getLogger(Z);function ue(oe,le,Y){if(oe)for(let j=0,X=oe.length;j<X;j++){const U=oe.getItemAt(j);if(U[le]===Y)return U;if("group"===(null==U?void 0:U.type)){const ee=ue(U.tables,le,Y);if(ee)return ee}}}const ce=oe=>{let le=class extends oe{constructor(...Y){super(...Y),this.tables=new A.Z,this.tables.on("after-add",j=>{const X=j.item;X.parent&&X.parent!==this&&"tables"in X.parent&&X.parent.tables.remove(X),X.parent=this,"feature"!==X.type&&ie.error(`Layer 'title:${X.title}, id:${X.id}' of type '${X.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",j=>{j.item.parent=null})}destroy(){const Y=this.tables.removeAll();for(const j of Y)j.destroy();this.tables.destroy()}set tables(Y){this._set("tables",(0,G.Z)(Y,this._get("tables")))}findTableById(Y){return ue(this.tables,"id",Y)}findTableByUid(Y){return ue(this.tables,"uid",Y)}};return(0,x._)([(0,H.Cb)()],le.prototype,"tables",null),le=(0,x._)([(0,B.j)(Z)],le),le}},59397:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(14517),G=T(61996),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898));let Z=B=class extends((0,G.IG)(A.Z)){constructor(ue){super(ue),this.active=!1,this.className=null,this.disabled=!1,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new B({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};(0,x._)([(0,Q.Cb)()],Z.prototype,"active",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"className",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"disabled",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"id",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"indicator",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"title",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"type",void 0),(0,x._)([(0,Q.Cb)()],Z.prototype,"visible",void 0),Z=B=(0,x._)([(0,W.j)("esri.support.actions.ActionBase")],Z);const ie=Z},48753:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(59397);let B=W=class extends J.Z{constructor(ie){super(ie),this.image=null,this.type="button"}clone(){return new W({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};(0,x._)([(0,A.Cb)()],B.prototype,"image",void 0),B=W=(0,x._)([(0,re.j)("esri.support.Action.ActionButton")],B);const Z=B},10671:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var W,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(59397);let B=W=class extends J.Z{constructor(ie){super(ie),this.image=null,this.type="toggle",this.value=!1}clone(){return new W({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};(0,x._)([(0,A.Cb)()],B.prototype,"image",void 0),(0,x._)([(0,A.Cb)()],B.prototype,"value",void 0),B=W=(0,x._)([(0,re.j)("esri.support.Action.ActionToggle")],B);const Z=B},12680:(dt,Re,T)=>{"use strict";T.d(Re,{r:()=>Q});var x=T(21726);const A=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function Q(H){const re=(0,x.P$)(H,!0);return re&&re.endsWith(".arcgis.com")&&!A.includes(re)&&!H.endsWith("/sharing/rest/generateToken")}},46679:(dt,Re,T)=>{"use strict";T.d(Re,{LC:()=>re,WW:()=>J,Yi:()=>W,mz:()=>ie,pp:()=>Z});var x=T(15861),G=(T(29132),T(62208)),Q=T(65234);let H;function re(){return H||(H=(0,x.Z)(function*(){const ue=yield T.e(5068).then(T.bind(T,75068));return{arcade:ue.arcade,arcadeUtils:ue,Dictionary:ue.Dictionary,Feature:ue.arcadeFeature}})()),H}const J=(ue,ce,oe)=>ie.create(ue,ce,oe,null,["$feature"]),W=(ue,ce,oe)=>ie.create(ue,ce,oe,null,["$feature","$view"]),Z=(ue,ce,oe,le)=>ie.create(ue,ce,oe,le,["$feature","$view"]);class ie{constructor(ce,oe,le,Y,j,X,U,ee){this.script=ce,this.evaluate=j;const $=Array.isArray(U)?U:U.fields;this.fields=$,this._syntaxTree=Y,this._arcade=oe,this._arcadeDictionary=le,this._arcadeFeature=X,this._spatialReference=ee,this._referencesGeometry=oe.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static create(ce,oe,le,Y,j,X){return(0,x.Z)(function*(){const{arcade:U,Feature:ee,Dictionary:$}=yield re(),ne=Q.Z.fromJSON(oe),se=U.parseScript(ce,X),ae=j.reduce((Te,me)=>yi(or({},Te),{[me]:null}),{});let de=null;(0,G.pC)(Y)&&(de=new $(Y),de.immutable=!0,ae.$config=null);const _e=U.scriptUsesGeometryEngine(se)&&U.enableGeometrySupport(),pe=U.scriptUsesFeatureSet(se)&&U.enableFeatureSetSupport(),he=U.scriptIsAsync(se)&&U.enableAsyncSupport(),ge={vars:ae,spatialReference:ne,useAsync:!!he},ye=new $;ye.immutable=!1,ye.setField("scale",0);const Me=U.compileScript(se,ge);return yield Promise.all([_e,pe,he]),new ie(ce,U,$,se,Te=>("$view"in Te&&Te.$view&&(ye.setField("scale",Te.$view.scale),Te.$view=ye),de&&(Te.$config=de),Me({vars:Te,spatialReference:ne})),new ee,le,ne)})()}repurposeFeature(ce){return ce.geometry&&!ce.geometry.spatialReference&&(ce.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(ce.geometry,ce.attributes,{fields:this.fields}),this._arcadeFeature}createDictionary(){return new this._arcadeDictionary}referencesMember(ce){return this._arcade.referencesMember(this._syntaxTree,ce)}referencesFunction(ce){return this._arcade.referencesFunction(this._syntaxTree,ce)}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}extractFieldLiterals(){return this._arcade.extractExpectedFieldLiterals(this._syntaxTree)}}},33954:(dt,Re,T)=>{"use strict";T.d(Re,{g:()=>Q,s:()=>re});var x=T(15861),A=T(54346),G=T(41840);function Q(J){return H.apply(this,arguments)}function H(){return(H=(0,x.Z)(function*(J){if(!J)return;const W=J.includes("-vector")?J.slice(0,J.indexOf("-vector")):J,B=yield(0,G.ME)("esri/t9n/basemaps");return B[J]||B[W]})).apply(this,arguments)}const re={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return(0,A.V)("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]}}},38953:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>A});var x=T(46882);function A(G){return new x.Z({getCollections:()=>[G.tables,G.layers],getChildrenFunction:Q=>{const H=[];return"tables"in Q&&H.push(Q.tables),"layers"in Q&&H.push(Q.layers),H},itemFilterFunction:Q=>{const H=Q.parent;return H&&"tables"in H&&H.tables.includes(Q)}})}},60507:(dt,Re,T)=>{"use strict";T.d(Re,{Lt:()=>J,Ou:()=>B,RL:()=>re,VW:()=>Q,Zz:()=>G,jG:()=>le,tq:()=>ce,vQ:()=>Z,vu:()=>H,zx:()=>ie});var x=T(62208),A=T(29505);function G(Y,j){return(0,x.Wi)(j)||!j.mode?Y?"absolute-height":"on-the-ground":j.mode}function Q(Y,j){return G(!!(0,x.pC)(Y)&&Y.hasZ,j)}function H(Y){const j=W(Y);return Q(Y.geometry,j)}function re(Y){const j=W(Y),X=Q(Y.geometry,j);return{mode:X,offset:(0,x.pC)(j)&&"on-the-ground"!==X?(0,x.Pt)(j.offset,0)*(0,A.Z7)((0,x.Pt)(j.unit,"meters")):0}}function J(Y){if("on-the-ground"===H(Y))return!1;const j=W(Y),X=(0,x.pC)(j)&&j.featureExpressionInfo?j.featureExpressionInfo.expression:null;return!(!X||"0"===X)}function W(Y){return Y.layer&&"elevationInfo"in Y.layer?Y.layer.elevationInfo:null}function B(Y,j,X){if((0,x.Wi)(X)||!X.mode)return;const U=Y.hasZ?Y.z:0,ee=(0,x.pC)(X.offset)?X.offset:0;switch(X.mode){case"absolute-height":return U-ee;case"on-the-ground":return 0;case"relative-to-ground":return U-((0,x.Pt)(j.elevationProvider.getElevation(Y.x,Y.y,Y.z,Y.spatialReference,"ground"),0)+ee);case"relative-to-scene":return U-((0,x.Pt)(j.elevationProvider.getElevation(Y.x,Y.y,Y.z,Y.spatialReference,"scene"),0)+ee)}}function Z(Y,j,X,U=null){return ue(Y,j.x,j.y,j.hasZ?j.z:0,j.spatialReference,X,U)}function ie(Y,j,X,U,ee=null){return ue(Y,j[0],j[1],j.length>2?j[2]:0,X,U,ee)}function ue(Y,j,X,U,ee,$,ne=null){if((0,x.Wi)($))return;const se=(0,x.pC)(ne)?ne.mode:"absolute-height";if("on-the-ground"===se)return 0;const{absoluteZ:ae}=ce(j,X,U,ee,Y,$);return function oe(Y,j,X,U,ee,$,ne,se){const ae=(0,x.pC)(ne)&&(0,x.pC)(ne.offset)?ne.offset:0;switch(se){case"absolute-height":return Y-ae;case"relative-to-ground":return Y-((0,x.Pt)($.elevationProvider.getElevation(j,X,U,ee,"ground"),0)+ae);case"relative-to-scene":return Y-((0,x.Pt)($.elevationProvider.getElevation(j,X,U,ee,"scene"),0)+ae)}}(ae,j,X,U,ee,Y,ne,se)}function ce(Y,j,X,U,ee,$){const ne=(0,x.pC)($.offset)?$.offset:0;switch($.mode){case"absolute-height":return{absoluteZ:X+ne,elevation:0};case"on-the-ground":{const se=(0,x.Pt)(ee.elevationProvider.getElevation(Y,j,0,U,"ground"),0);return{absoluteZ:se,elevation:se}}case"relative-to-ground":{const se=(0,x.Pt)(ee.elevationProvider.getElevation(Y,j,X,U,"ground"),0);return{absoluteZ:X+se+ne,elevation:se}}case"relative-to-scene":{const se=(0,x.Pt)(ee.elevationProvider.getElevation(Y,j,X,U,"scene"),0);return{absoluteZ:X+se+ne,elevation:se}}}}const le={mode:"absolute-height",offset:0}},35560:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>A,h:()=>G});var x=T(8314);const A=()=>!!(0,x.Z)("enable-feature:force-wosr"),G=()=>!!(0,x.Z)("enable-feature:direct-3d-object-feature-layer-display")},49430:(dt,Re,T)=>{"use strict";T.d(Re,{eZ:()=>oe});var x=T(73281),A=T(36630),G=T(55664),J=(T(55013),T(16615),T(82561),T(75484)),Z=(T(64531),T(501),T(25621)),ie=T(66845);const ue=["oid","global-id"],ce=["oid","global-id","guid"];function oe({displayField:he,editFieldsInfo:ge,fields:ye,objectIdField:Me,title:Ee},Te){if(!ye)return null;const me=function ne({editFieldsInfo:he,fields:ge,objectIdField:ye},Me){return function j(he,ge){const ye=he;return ge&&(he=he.filter(Me=>!ge.includes(Me.type))),he===ye&&(he=he.slice()),he.sort(X),he}(ge,(null==Me?void 0:Me.ignoreFieldTypes)||pe).map(Ee=>new Z.Z({fieldName:Ee.name,isEditable:ee(Ee,he),label:Ee.alias,format:se(Ee),visible:Y(Ee,{editFieldsInfo:he,objectIdField:ye,visibleFieldNames:null==Me?void 0:Me.visibleFieldNames})}))}({editFieldsInfo:ge,fields:ye,objectIdField:Me},Te);if(!me.length)return null;const Ce=function de(he){const ge=(0,A.O5)(he),{titleBase:ye}=he;return ge?`${ye}: {${ge.trim()}}`:ye}({titleBase:Ee,fields:ye,displayField:he}),Ie=function ae(){return[new J.Z,new G.Z]}();return new x.Z({title:Ce,content:Ie,fieldInfos:me})}const le=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i],Y=(he,{editFieldsInfo:ge,objectIdField:ye,visibleFieldNames:Me})=>Me?Me.has(he.name):!(U(he.name,ge)||ye&&he.name===ye||ue.includes(he.type)||le.some(Ee=>Ee.test(he.name)));function X(he,ge){return"oid"===he.type?-1:"oid"===ge.type?1:_e(he)?-1:_e(ge)?1:(he.alias||he.name).toLocaleLowerCase().localeCompare((ge.alias||ge.name).toLocaleLowerCase())}function U(he,ge){if(!he||!ge)return!1;const{creationDateField:ye,creatorField:Me,editDateField:Ee,editorField:Te}=ge;return[ye&&ye.toLowerCase(),Me&&Me.toLowerCase(),Ee&&Ee.toLowerCase(),Te&&Te.toLowerCase()].includes(he.toLowerCase())}function ee(he,ge){return he.editable&&!ce.includes(he.type)&&!U(he.name,ge)}function se(he){switch(he.type){case"small-integer":case"integer":case"single":return new ie.Z({digitSeparator:!0,places:0});case"double":return new ie.Z({digitSeparator:!0,places:2});case"date":return new ie.Z({dateFormat:"long-month-day-year"});default:return"string"===he.type&&(0,A.Ec)(he.name)?new ie.Z({digitSeparator:!0,places:0}):null}}function _e(he){return"name"===(he.name&&he.name.toLowerCase())||"name"===(he.alias&&he.alias.toLowerCase())||void 0}const pe=["geometry","blob","raster","guid","xml"]},70026:(dt,Re,T)=>{"use strict";T.d(Re,{t:()=>G});var x=T(15861),A=T(84792);function G(H,re){return Q.apply(this,arguments)}function Q(){return(Q=(0,x.Z)(function*(H,re){const{data:J}=yield(0,A.default)(H,or({responseType:"image"},re));return J})).apply(this,arguments)}},33899:(dt,Re,T)=>{"use strict";T.d(Re,{Hu:()=>B,fY:()=>J,jH:()=>Z,jz:()=>ie});var x=T(15861),A=T(59318),G=T(8314),Q=T(62208),H=T(10699),re=T(21726);function J(ce,oe,le=!1,Y){return new Promise((j,X)=>{if((0,H.Hc)(Y))return void X(W());let U=()=>{ne(),X(new Error(`Unable to load ${oe}`))},ee=()=>{const se=ce;ne(),j(se)},$=()=>{if(!ce)return;const se=ce;ne(),se.src="",X(W())};const ne=()=>{(0,G.Z)("esri-image-decode")||(ce.removeEventListener("error",U),ce.removeEventListener("load",ee)),U=null,ee=null,ce=null,(0,Q.pC)(Y)&&Y.removeEventListener("abort",$),$=null,le&&URL.revokeObjectURL(oe)};(0,Q.pC)(Y)&&Y.addEventListener("abort",$),(0,G.Z)("esri-image-decode")?ce.decode().then(ee,U):(ce.addEventListener("error",U),ce.addEventListener("load",ee))})}function W(){try{return new DOMException("Aborted","AbortError")}catch(ce){const oe=new Error;return oe.name="AbortError",oe}}function B(ce){A.Z.request.crossOriginNoCorsDomains||(A.Z.request.crossOriginNoCorsDomains={});const oe=A.Z.request.crossOriginNoCorsDomains;for(let le of ce)le=le.toLowerCase(),/^https?:\/\//.test(le)?oe[(0,re.P$)(le)]=0:(oe[(0,re.P$)("http://"+le)]=0,oe[(0,re.P$)("https://"+le)]=0)}function Z(ce){const oe=A.Z.request.crossOriginNoCorsDomains;if(oe){let le=(0,re.P$)(ce);if(le)return le=le.toLowerCase(),!(0,re.D6)(le,(0,re.TI)())&&oe[le]<Date.now()-36e5}return!1}function ie(ce){return ue.apply(this,arguments)}function ue(){return(ue=(0,x.Z)(function*(ce){var Y;const oe=A.Z.request.crossOriginNoCorsDomains;oe&&(oe[(0,re.P$)(ce).toLowerCase()]=Date.now());const le=(0,re.mN)(ce);ce=le.path,"json"===(null==(Y=le.query)?void 0:Y.f)&&(ce+="?f=json");try{yield fetch(ce,{mode:"no-cors",credentials:"include"})}catch(j){}})).apply(this,arguments)}},38365:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>A,r:()=>x});const x="20220708",A="7fd01dbc0e83d753fcf101c8ff2a8d215430252d"},64183:(dt,Re,T)=>{"use strict";T.d(Re,{$o:()=>G,V$:()=>H});const x="calcite-theme-";function G(){return function A(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-theme-name").replace(/\s|'|"/g,"")}().startsWith("dark")}function H(J){(function re(J){Array.from(J.classList).forEach(W=>{W.startsWith(x)&&J.classList.remove(W)})})(J),J.classList.add(function Q(){return`${x}${G()?"dark":"light"}`}())}},20383:(dt,Re,T)=>{"use strict";T.d(Re,{se:()=>qe,cT:()=>Ne,dU:()=>we,S9:()=>Be,LB:()=>Oe,AH:()=>$e,yK:()=>De,S6:()=>Ke,QT:()=>Se,f_:()=>ve});var se,x=T(90912),A=T(383),G=T(94398),H=(T(65499),T(48575)),B=(T(9260),T(11472),T(26531),T(22490)),Z=T(40445),ce=(T(21068),T(46735),T(36687)),Y=(T(2066),T(69147),T(17626)),j=T(58817),X=T(23841),U=T(77712),ee=T(55342),$=T(76898),ne=T(69738);let ae=se=class extends H.Z{constructor(...be){super(...be),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(be,tt,Ye,ze){if(be&&"string"!=typeof be&&null==be.imageData)return be;const et={};return be&&(et.url=be),tt&&(et.outline=tt),null!=Ye&&(et.width=(0,X.t_)(Ye)),null!=ze&&(et.height=(0,X.t_)(ze)),et}clone(){const be=new se({color:(0,j.d9)(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return be._set("source",(0,j.d9)(this.source)),be}hash(){var be;return`${super.hash()}.${null==(be=this.color)?void 0:be.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};(0,Y._)([(0,ee.J)({esriPFS:"picture-fill"},{readOnly:!0})],ae.prototype,"type",void 0),(0,Y._)([(0,U.Cb)(ne.KA)],ae.prototype,"url",void 0),(0,Y._)([(0,U.Cb)({type:Number,json:{write:!0}})],ae.prototype,"xscale",void 0),(0,Y._)([(0,U.Cb)({type:Number,json:{write:!0}})],ae.prototype,"yscale",void 0),(0,Y._)([(0,U.Cb)({type:Number,cast:X.t_,json:{write:!0}})],ae.prototype,"width",void 0),(0,Y._)([(0,U.Cb)({type:Number,cast:X.t_,json:{write:!0}})],ae.prototype,"height",void 0),(0,Y._)([(0,U.Cb)({type:Number,cast:X.t_,json:{write:!0}})],ae.prototype,"xoffset",void 0),(0,Y._)([(0,U.Cb)({type:Number,cast:X.t_,json:{write:!0}})],ae.prototype,"yoffset",void 0),(0,Y._)([(0,U.Cb)(ne.Ds)],ae.prototype,"source",void 0),ae=se=(0,Y._)([(0,$.j)("esri.symbols.PictureFillSymbol")],ae);const de=ae;var _e=T(13546),pe=T(69852),he=T(89673),ge=T(88493),ye=T(52068),Me=T(57213),Ee=T(10012),Ce=(T(39368),T(97665),T(35540)),Je=(T(21716),T(72622),T(12874));function Ne(be){if(!be)return!1;switch(be.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function we(be){if(!be)return!1;switch(be.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}T(17497),T(71530);const Oe={base:Ee.Z,key:"type",typeMap:{"simple-fill":ge.Z,"picture-fill":de,"picture-marker":_e.Z,"simple-line":ye.Z,"simple-marker":Me.Z,text:Ce.Z,"label-3d":B.Z,"line-3d":Z.Z,"mesh-3d":ce.Z,"point-3d":pe.Z,"polygon-3d":he.Z,"web-style":Je.Z,cim:G.Z},errorContext:"symbol"},$e={base:Ee.Z,key:"type",typeMap:{"picture-marker":_e.Z,"simple-marker":Me.Z,text:Ce.Z,"web-style":Je.Z,cim:G.Z},errorContext:"symbol"},Be=(0,A.d)({types:Oe}),Se={base:Ee.Z,key:"type",typeMap:{"simple-fill":ge.Z,"picture-fill":de,"picture-marker":_e.Z,"simple-line":ye.Z,"simple-marker":Me.Z,text:Ce.Z,"line-3d":Z.Z,"mesh-3d":ce.Z,"point-3d":pe.Z,"polygon-3d":he.Z,"web-style":Je.Z,cim:G.Z},errorContext:"symbol"},De={base:Ee.Z,key:"type",typeMap:{text:Ce.Z,"label-3d":B.Z},errorContext:"symbol"},ve={base:Ee.Z,key:"type",typeMap:{"line-3d":Z.Z,"mesh-3d":ce.Z,"point-3d":pe.Z,"polygon-3d":he.Z,"web-style":Je.Z,cim:G.Z},errorContext:"symbol"},Ke={base:Ee.Z,key:"type",typeMap:{"label-3d":B.Z},errorContext:"symbol"},qe=(0,x.N7)(Oe)},94398:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ce,x=T(15861),A=T(17626),G=T(58817),Q=T(77275),H=T(77712),J=(T(90912),T(55342)),W=T(68653),B=T(76898),Z=T(99433),ie=T(36630),ue=T(10012);let oe=ce=class extends ue.Z{constructor(Y){super(Y),this.data=null,this.type="cim"}readData(Y,j){return j}writeData(Y,j){if(Y)for(const X in Y)j[X]=Y[X]}collectRequiredFields(Y,j){var X=this;return(0,x.Z)(function*(){if("CIMSymbolReference"===X.data.type){const U=X.data.primitiveOverrides;if(U){const ee=U.map($=>(0,ie.io)(Y,j,$.valueExpressionInfo.expression));yield Promise.all(ee)}}})()}clone(){return new ce({data:(0,G.d9)(this.data)})}hash(){return(0,Q.hP)(JSON.stringify(this.data)).toString()}};(0,A._)([(0,H.Cb)({json:{write:!1}})],oe.prototype,"color",void 0),(0,A._)([(0,H.Cb)({json:{write:!0}})],oe.prototype,"data",void 0),(0,A._)([(0,W.r)("data",["symbol"])],oe.prototype,"readData",null),(0,A._)([(0,Z.c)("data",{})],oe.prototype,"writeData",null),(0,A._)([(0,J.J)({CIMSymbolReference:"cim"},{readOnly:!0})],oe.prototype,"type",void 0),oe=ce=(0,A._)([(0,B.j)("esri.symbols.CIMSymbol")],oe);const le=oe},65499:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var ue,x=T(17626),A=T(62208),G=T(77712),J=(T(85931),T(8314),T(90912),T(55342)),W=T(76898),B=T(97665),Z=T(61261),ie=T(64830);let ce=ue=class extends B.Z{constructor(le){super(le),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new ue({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:(0,A.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};(0,x._)([(0,J.J)({Extrude:"extrude"},{readOnly:!0})],ce.prototype,"type",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],ce.prototype,"size",void 0),(0,x._)([(0,G.Cb)({type:ie.b,json:{write:!0}})],ce.prototype,"material",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ce.prototype,"castShadows",void 0),(0,x._)([(0,G.Cb)(Z.Z)],ce.prototype,"edges",void 0),ce=ue=(0,x._)([(0,W.j)("esri.symbols.ExtrudeSymbol3DLayer")],ce);const oe=ce},48575:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(52068),W=T(10012);let B=class extends W.Z{constructor(ie){super(ie),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};(0,x._)([(0,A.Cb)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":J.Z}},json:{default:null,write:!0}})],B.prototype,"outline",void 0),(0,x._)([(0,A.Cb)({type:["simple-fill","picture-fill"],readOnly:!0})],B.prototype,"type",void 0),B=(0,x._)([(0,re.j)("esri.symbols.FillSymbol")],B);const Z=B},9260:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ge});var X,x=T(17626),A=T(62208),G=T(77712),J=(T(85931),T(8314),T(90912),T(55342)),W=T(76898),B=T(97665),Z=T(61261),ie=T(63743),ue=T(153),ce=T(99255),oe=T(12948),j=(T(63290),T(82255),T(64830));let U=X=class extends j.b{constructor(ye){super(ye),this.colorMixMode=null}clone(){const ye={color:(0,A.pC)(this.color)?this.color.clone():null,colorMixMode:this.colorMixMode};return new X(ye)}};(0,x._)([(0,J.J)({multiply:"multiply",replace:"replace",tint:"tint"})],U.prototype,"colorMixMode",void 0),U=X=(0,x._)([(0,W.j)("esri.symbols.support.Symbol3DFillMaterial")],U);var de,ee=T(91558),$=T(86810),ne=T(23841),se=T(60958),ae=T(43652);let _e=de=class extends $.wq{constructor(ye){super(ye),this.color=new ee.Z([0,0,0,1]),this.size=(0,ne.Wz)(1),this.pattern=null,this.patternCap="butt"}clone(){const ye={color:(0,A.pC)(this.color)?this.color.clone():null,size:this.size,pattern:(0,A.pC)(this.pattern)?this.pattern.clone():null,patternCap:this.patternCap};return new de(ye)}};var pe;(0,x._)([(0,G.Cb)(se.a)],_e.prototype,"color",void 0),(0,x._)([(0,G.Cb)(se.y)],_e.prototype,"size",void 0),(0,x._)([(0,G.Cb)(ce.D)],_e.prototype,"pattern",void 0),(0,x._)([(0,G.Cb)({type:ae.Hc,json:{default:"butt",write:{overridePolicy(){return{enabled:(0,A.pC)(this.pattern)}}}}})],_e.prototype,"patternCap",void 0),_e=de=(0,x._)([(0,W.j)("esri.symbols.support.Symbol3DOutline")],_e);let he=pe=class extends B.Z{constructor(ye){super(ye),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const ye={edges:(0,A.pC)(this.edges)?this.edges.clone():null,enabled:this.enabled,material:(0,A.pC)(this.material)?this.material.clone():null,pattern:(0,A.pC)(this.pattern)?this.pattern.clone():null,castShadows:this.castShadows,outline:(0,A.pC)(this.outline)?this.outline.clone():null};return new pe(ye)}static fromSimpleFillSymbol(ye){var Te,me,Ce,Ie,Ge,Je;const Me=ye.outline&&ye.outline.style&&"inside-frame"!==ye.outline.style&&"solid"!==ye.outline.style?new ie.Z({style:ye.outline.style}):null,Ee={size:null!=(me=null==(Te=ye.outline)?void 0:Te.width)?me:0,color:(null!=(Ie=null==(Ce=ye.outline)?void 0:Ce.color)?Ie:oe.ix).clone(),pattern:Me};return Me&&(null==(Ge=ye.outline)?void 0:Ge.cap)&&(Ee.patternCap=ye.outline.cap),new pe({material:new U({color:(null!=(Je=ye.color)?Je:oe.l9).clone()}),pattern:ye.style&&"solid"!==ye.style?new ue.Z({style:ye.style}):null,outline:Ee})}};(0,x._)([(0,J.J)({Fill:"fill"},{readOnly:!0})],he.prototype,"type",void 0),(0,x._)([(0,G.Cb)({type:U,json:{write:!0}})],he.prototype,"material",void 0),(0,x._)([(0,G.Cb)(ce.q)],he.prototype,"pattern",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],he.prototype,"castShadows",void 0),(0,x._)([(0,G.Cb)({type:_e,json:{write:!0}})],he.prototype,"outline",void 0),(0,x._)([(0,G.Cb)(Z.Z)],he.prototype,"edges",void 0),he=pe=(0,x._)([(0,W.j)("esri.symbols.FillSymbol3DLayer")],he);const ge=he},11472:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var Z,x=T(17626),A=T(86810),G=T(23841),Q=T(77712),J=(T(85931),T(8314),T(66656)),W=T(76898),B=T(50369);let ie=Z=class extends A.wq{constructor(ce){super(ce),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(ce){return(0,G.t_)(ce)}clone(){return new Z({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};(0,x._)([(0,Q.Cb)({type:B.JT,json:{default:"none",write:!0}})],ie.prototype,"decoration",void 0),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],ie.prototype,"family",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:{overridePolicy:(ce,oe,le)=>({enabled:!le||!le.textSymbol3D})}}})],ie.prototype,"size",void 0),(0,x._)([(0,J.p)("size")],ie.prototype,"castSize",null),(0,x._)([(0,Q.Cb)({type:B.g6,json:{default:"normal",write:!0}})],ie.prototype,"style",void 0),(0,x._)([(0,Q.Cb)({type:B.vC,json:{default:"normal",write:!0}})],ie.prototype,"weight",void 0),ie=Z=(0,x._)([(0,W.j)("esri.symbols.Font")],ie);const ue=ie},26531:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ge});var U,x=T(17626),A=T(63290),G=T(62208),Q=T(21726),H=T(77712),B=(T(85931),T(8314),T(90912),T(55342)),Z=T(76898),ie=T(97665),ue=T(12948),ce=T(33215),oe=T(60958),le=T(37519),Y=T(91558),j=T(86810),X=T(23841);let ee=U=class extends j.wq{constructor(ye){super(ye),this.color=new Y.Z([0,0,0,1]),this.size=(0,X.Wz)(1)}clone(){const ye={color:(0,G.pC)(this.color)?this.color.clone():null,size:this.size};return new U(ye)}};(0,x._)([(0,H.Cb)(oe.a)],ee.prototype,"color",void 0),(0,x._)([(0,H.Cb)(oe.y)],ee.prototype,"size",void 0),ee=U=(0,x._)([(0,Z.j)("esri.symbols.support.Symbol3DIconOutline")],ee);var ne,$=T(64830);const se=A.Z.getLogger("esri.symbols.IconSymbol3DLayer");let ae=ne=class extends ie.Z{constructor(ye){super(ye),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=void 0,this.outline=void 0}clone(){return new ne({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:(0,G.pC)(this.material)?this.material.clone():null,outline:(0,G.pC)(this.outline)?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(ye){const Me=ye.color||ue.ix,Ee=de(ye),Te=ye.outline&&ye.outline.width>0?{size:ye.outline.width,color:(ye.outline.color||ue.ix).clone()}:null;return new ne({size:ye.size,resource:{primitive:he(ye.style)},material:{color:Me},outline:Te,anchor:Ee?"relative":void 0,anchorPosition:Ee})}static fromPictureMarkerSymbol(ye){const Me=!ye.color||(0,ue.rx)(ye.color)?ue.ix:ye.color,Ee=de(ye);return new ne({size:ye.width<=ye.height?ye.height:ye.width,resource:{href:ye.url},material:{color:Me.clone()},anchor:Ee?"relative":void 0,anchorPosition:Ee})}static fromCIMSymbol(ye){return new ne({resource:{href:(0,Q._l)({mediaType:"application/json",data:JSON.stringify(ye.data)})}})}};function de(ye){const Me="width"in ye?ye.width:ye.size,Ee="height"in ye?ye.height:ye.size,Te=_e(ye.xoffset),me=_e(ye.yoffset);return(Te||me)&&Me&&Ee?{x:-Te/Me,y:me/Ee}:null}function _e(ye){return isFinite(ye)?ye:0}(0,x._)([(0,H.Cb)({type:$.b,json:{write:!0}})],ae.prototype,"material",void 0),(0,x._)([(0,H.Cb)({type:ce.b,json:{write:!0}})],ae.prototype,"resource",void 0),(0,x._)([(0,B.J)({Icon:"icon"},{readOnly:!0})],ae.prototype,"type",void 0),(0,x._)([(0,H.Cb)(oe.y)],ae.prototype,"size",void 0),(0,x._)([(0,B.J)({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),(0,H.Cb)({json:{default:"center"}})],ae.prototype,"anchor",void 0),(0,x._)([(0,H.Cb)({type:le.e,json:{type:[Number],read:{reader:ye=>new le.e({x:ye[0],y:ye[1]})},write:{writer:(ye,Me)=>{Me.anchorPosition=[ye.x,ye.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],ae.prototype,"anchorPosition",void 0),(0,x._)([(0,H.Cb)({type:ee,json:{write:!0}})],ae.prototype,"outline",void 0),ae=ne=(0,x._)([(0,Z.j)("esri.symbols.IconSymbol3DLayer")],ae);const pe={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function he(ye){return pe[ye]||(se.warn(`${ye} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const ge=ae},22490:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ue,x=T(17626),A=T(46160),G=T(58817),Q=T(77712),re=(T(90912),T(55342)),J=T(76898),W=T(39368),B=T(21716),Z=T(9824),ie=T(97595);const ce=A.Z.ofType({base:null,key:"type",typeMap:{text:B.Z}});let oe=ue=class extends W.Z{constructor(Y){super(Y),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new ce,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return(0,Z.gv)(this)}hasVisibleVerticalOffset(){return(0,Z.Uy)(this)}clone(){return new ue({styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail),callout:(0,G.d9)(this.callout),verticalOffset:(0,G.d9)(this.verticalOffset)})}static fromTextSymbol(Y){return new ue({symbolLayers:[B.Z.fromTextSymbol(Y)]})}};(0,x._)([(0,Q.Cb)({type:ie._,json:{write:!0}})],oe.prototype,"verticalOffset",void 0),(0,x._)([(0,Q.Cb)(Z.Y2)],oe.prototype,"callout",void 0),(0,x._)([(0,Q.Cb)({json:{read:!1,write:!1}})],oe.prototype,"styleOrigin",void 0),(0,x._)([(0,Q.Cb)({type:ce})],oe.prototype,"symbolLayers",void 0),(0,x._)([(0,re.J)({LabelSymbol3D:"label-3d"},{readOnly:!0})],oe.prototype,"type",void 0),oe=ue=(0,x._)([(0,J.j)("esri.symbols.LabelSymbol3D")],oe);const le=oe},40445:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ie,x=T(17626),A=T(46160),G=T(58817),Q=T(77712),re=(T(90912),T(55342)),J=T(76898),W=T(21068),B=T(69147),Z=T(39368);const ue=A.Z.ofType({base:null,key:"type",typeMap:{line:W.Z,path:B.Z}}),ce=A.Z.ofType({base:null,key:"type",typeMap:{line:W.Z,path:B.Z}});let oe=ie=class extends Z.Z{constructor(Y){super(Y),this.symbolLayers=new ue,this.type="line-3d"}clone(){return new ie({styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail)})}static fromSimpleLineSymbol(Y){return new ie({symbolLayers:[W.Z.fromSimpleLineSymbol(Y)]})}};(0,x._)([(0,Q.Cb)({type:ue,json:{type:ce}})],oe.prototype,"symbolLayers",void 0),(0,x._)([(0,re.J)({LineSymbol3D:"line-3d"},{readOnly:!0})],oe.prototype,"type",void 0),oe=ie=(0,x._)([(0,J.j)("esri.symbols.LineSymbol3D")],oe);const le=oe},21068:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>de});var x=T(17626),A=T(62208),G=T(23841),Q=T(77712),J=(T(85931),T(8314),T(90912)),W=T(55342),B=T(76898),Z=T(91558),ie=T(79608),ue=T(86810),ce=T(67866);let oe=class extends((0,ie.J)(ue.wq)){constructor(_e){super(_e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(_e){return(0,A.pC)(_e)&&_e.placement===this.placement&&_e.style===this.style&&((0,A.Wi)(this.color)&&(0,A.Wi)(_e.color)||(0,A.pC)(this.color)&&(0,A.pC)(_e.color)&&this.color.toJSON()===_e.color.toJSON())}};(0,x._)([(0,Q.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],oe.prototype,"type",void 0),(0,x._)([(0,Q.Cb)({type:ce.J,json:{default:"begin-end",write:!0}})],oe.prototype,"placement",void 0),(0,x._)([(0,Q.Cb)({type:ce.k,json:{default:"arrow",write:!0}})],oe.prototype,"style",void 0),(0,x._)([(0,Q.Cb)({type:Z.Z,json:{type:[J.z8],default:null,write:!0}})],oe.prototype,"color",void 0),oe=(0,x._)([(0,B.j)("esri.symbols.LineStyleMarker3D")],oe);const le=oe;var se,Y=T(97665),j=T(63743),X=T(99255),U=T(12948),ee=T(60958),$=T(64830),ne=T(43652);let ae=se=class extends Y.Z{constructor(_e){super(_e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=(0,G.Wz)(1),this.pattern=null,this.marker=null}clone(){const _e={enabled:this.enabled,material:(0,A.pC)(this.material)?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:(0,A.pC)(this.pattern)?this.pattern.clone():null,marker:(0,A.pC)(this.marker)?this.marker.clone():null};return new se(_e)}static fromSimpleLineSymbol(_e){var he,ge,ye;const pe={enabled:!0,size:null!=(he=_e.width)?he:(0,G.Wz)(1),cap:_e.cap||"butt",join:_e.join||"miter",pattern:_e.style&&"inside-frame"!==_e.style?new j.Z({style:_e.style}):null,material:new $.b({color:(_e.color||U.ix).clone()}),marker:_e.marker?new le({placement:_e.marker.placement,style:_e.marker.style,color:null!=(ye=null==(ge=_e.marker.color)?void 0:ge.clone())?ye:null}):null};return new se(pe)}};(0,x._)([(0,Q.Cb)({type:$.b,json:{write:!0}})],ae.prototype,"material",void 0),(0,x._)([(0,W.J)({Line:"line"},{readOnly:!0})],ae.prototype,"type",void 0),(0,x._)([(0,Q.Cb)({type:ne.w2,json:{write:!0,default:"miter"}})],ae.prototype,"join",void 0),(0,x._)([(0,Q.Cb)({type:ne.Hc,json:{write:!0,default:"butt"}})],ae.prototype,"cap",void 0),(0,x._)([(0,Q.Cb)(ee.y)],ae.prototype,"size",void 0),(0,x._)([(0,Q.Cb)(X.D)],ae.prototype,"pattern",void 0),(0,x._)([(0,Q.Cb)({types:{key:"type",base:le,typeMap:{style:le}},json:{write:!0}})],ae.prototype,"marker",void 0),ae=se=(0,x._)([(0,B.j)("esri.symbols.LineSymbol3DLayer")],ae);const de=ae},46735:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var x=T(17626),A=T(23841),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(10012);let B=class extends W.Z{constructor(ie){super(ie),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};(0,x._)([(0,G.Cb)({type:Number,json:{read:ie=>ie&&-1*ie,write:(ie,ue)=>ue.angle=ie&&-1*ie}})],B.prototype,"angle",void 0),(0,x._)([(0,G.Cb)({type:["simple-marker","picture-marker"],readOnly:!0})],B.prototype,"type",void 0),(0,x._)([(0,G.Cb)({type:Number,cast:A.t_,json:{write:!0}})],B.prototype,"xoffset",void 0),(0,x._)([(0,G.Cb)({type:Number,cast:A.t_,json:{write:!0}})],B.prototype,"yoffset",void 0),(0,x._)([(0,G.Cb)({type:Number,cast:ie=>"auto"===ie?ie:(0,A.t_)(ie),json:{write:!0}})],B.prototype,"size",void 0),B=(0,x._)([(0,J.j)("esri.symbols.MarkerSymbol")],B);const Z=B},36687:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var Z,x=T(17626),A=T(46160),G=T(58817),Q=T(77712),re=(T(90912),T(55342)),J=T(76898),W=T(9260),B=T(39368);const ie=A.Z.ofType({base:null,key:"type",typeMap:{fill:W.Z}});let ue=Z=class extends B.Z{constructor(oe){super(oe),this.symbolLayers=new ie,this.type="mesh-3d"}clone(){return new Z({styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail)})}};(0,x._)([(0,Q.Cb)({type:ie})],ue.prototype,"symbolLayers",void 0),(0,x._)([(0,re.J)({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],ue.prototype,"type",void 0),ue=Z=(0,x._)([(0,J.j)("esri.symbols.MeshSymbol3D")],ue);const ce=ue},2066:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>j});var ue,x=T(17626),A=T(62208),G=T(77712),J=(T(85931),T(8314),T(90912),T(55342)),W=T(76898),B=T(97665),Z=T(48521),ie=T(14517);let ce=ue=class extends ie.Z{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new ue({x:this.x,y:this.y,z:this.z})}};(0,x._)([(0,G.Cb)({type:Number})],ce.prototype,"x",void 0),(0,x._)([(0,G.Cb)({type:Number})],ce.prototype,"y",void 0),(0,x._)([(0,G.Cb)({type:Number})],ce.prototype,"z",void 0),ce=ue=(0,x._)([(0,W.j)("esri.symbols.support.Symbol3DAnchorPosition3D")],ce);var le,oe=T(64830);let Y=le=class extends B.Z{constructor(X){super(X),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new le({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:(0,A.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}};(0,x._)([(0,G.Cb)({type:oe.b,json:{write:!0}})],Y.prototype,"material",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Y.prototype,"castShadows",void 0),(0,x._)([(0,G.Cb)({type:Z.k,json:{write:!0}})],Y.prototype,"resource",void 0),(0,x._)([(0,J.J)({Object:"object"},{readOnly:!0})],Y.prototype,"type",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],Y.prototype,"width",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],Y.prototype,"height",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],Y.prototype,"depth",void 0),(0,x._)([(0,J.J)({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),(0,G.Cb)({json:{default:"origin"}})],Y.prototype,"anchor",void 0),(0,x._)([(0,G.Cb)({type:ce,json:{type:[Number],read:{reader:X=>new ce({x:X[0],y:X[1],z:X[2]})},write:{writer:(X,U)=>{U.anchorPosition=[X.x,X.y,X.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],Y.prototype,"anchorPosition",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],Y.prototype,"heading",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],Y.prototype,"tilt",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],Y.prototype,"roll",void 0),(0,x._)([(0,G.Cb)({readOnly:!0})],Y.prototype,"isPrimitive",null),Y=le=(0,x._)([(0,W.j)("esri.symbols.ObjectSymbol3DLayer")],Y);const j=Y},69147:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ce,x=T(17626),A=T(62208),G=T(77712),J=(T(85931),T(8314),T(90912),T(55342)),W=T(68653),B=T(76898),Z=T(97665),ie=T(64830),ue=T(43652);let oe=ce=class extends Z.Z{constructor(Y){super(Y),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(Y,j){return null!=Y?Y:null==j.height&&null!=j.size?j.size:void 0}readHeight(Y,j){return null!=Y?Y:null==j.width&&null!=j.size?j.size:void 0}clone(){return new ce({enabled:this.enabled,material:(0,A.pC)(this.material)?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};(0,x._)([(0,G.Cb)({type:ie.b,json:{write:!0}})],oe.prototype,"material",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],oe.prototype,"castShadows",void 0),(0,x._)([(0,J.J)({Path:"path"},{readOnly:!0})],oe.prototype,"type",void 0),(0,x._)([(0,G.Cb)({type:["circle","quad"],json:{write:!0,default:"circle"}})],oe.prototype,"profile",void 0),(0,x._)([(0,G.Cb)({type:ue.w2,json:{write:!0,default:"miter"}})],oe.prototype,"join",void 0),(0,x._)([(0,G.Cb)({type:ue.KW,json:{write:!0,default:"butt"}})],oe.prototype,"cap",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],oe.prototype,"width",void 0),(0,x._)([(0,W.r)("width",["width","size","height"])],oe.prototype,"readWidth",null),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],oe.prototype,"height",void 0),(0,x._)([(0,W.r)("height",["height","size","width"])],oe.prototype,"readHeight",null),(0,x._)([(0,G.Cb)({type:["center","bottom","top"],json:{write:!0,default:"center"}})],oe.prototype,"anchor",void 0),(0,x._)([(0,G.Cb)({type:["heading","all"],json:{write:!0,default:"all"}})],oe.prototype,"profileRotation",void 0),oe=ce=(0,x._)([(0,B.j)("esri.symbols.PathSymbol3DLayer")],oe);const le=oe},13546:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ce});var ie,x=T(17626),A=T(58817),G=T(23841),Q=T(77712),re=(T(90912),T(55342)),J=T(68653),W=T(76898),B=T(46735),Z=T(69738);let ue=ie=class extends B.Z{constructor(...oe){super(...oe),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(oe,le,Y){if(oe&&"string"!=typeof oe&&null==oe.imageData)return oe;const j={};return oe&&(j.url=oe),null!=le&&(j.width=(0,G.t_)(le)),null!=Y&&(j.height=(0,G.t_)(Y)),j}readHeight(oe,le){return le.size||oe}readWidth(oe,le){return le.size||oe}clone(){const oe=new ie({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return oe._set("source",(0,A.d9)(this.source)),oe}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};(0,x._)([(0,Q.Cb)({json:{write:!1}})],ue.prototype,"color",void 0),(0,x._)([(0,re.J)({esriPMS:"picture-marker"},{readOnly:!0})],ue.prototype,"type",void 0),(0,x._)([(0,Q.Cb)(Z.KA)],ue.prototype,"url",void 0),(0,x._)([(0,Q.Cb)(Z.Ds)],ue.prototype,"source",void 0),(0,x._)([(0,Q.Cb)({type:Number,cast:G.t_,json:{write:!0}})],ue.prototype,"height",void 0),(0,x._)([(0,J.r)("height",["height","size"])],ue.prototype,"readHeight",null),(0,x._)([(0,Q.Cb)({type:Number,cast:G.t_,json:{write:!0}})],ue.prototype,"width",void 0),(0,x._)([(0,Q.Cb)({json:{write:!1}})],ue.prototype,"size",void 0),ue=ie=(0,x._)([(0,W.j)("esri.symbols.PictureMarkerSymbol")],ue);const ce=ue},69852:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>j});var oe,x=T(17626),A=T(46160),G=T(58817),Q=T(77712),re=(T(90912),T(55342)),J=T(76898),W=T(26531),B=T(2066),Z=T(39368),ie=T(21716),ue=T(9824),ce=T(97595);const le=A.Z.ofType({base:null,key:"type",typeMap:{icon:W.Z,object:B.Z,text:ie.Z}});let Y=oe=class extends Z.Z{constructor(X){super(X),this.verticalOffset=null,this.callout=null,this.symbolLayers=new le,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const X of this.symbolLayers.items)switch(X.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return(0,ue.gv)(this)}hasVisibleVerticalOffset(){return(0,ue.Uy)(this)}clone(){return new oe({verticalOffset:(0,G.d9)(this.verticalOffset),callout:(0,G.d9)(this.callout),styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail)})}static fromSimpleMarkerSymbol(X){return new oe({symbolLayers:[W.Z.fromSimpleMarkerSymbol(X)]})}static fromPictureMarkerSymbol(X){return new oe({symbolLayers:[W.Z.fromPictureMarkerSymbol(X)]})}static fromCIMSymbol(X){var ee,$;return"CIMPointSymbol"!==(null==($=null==(ee=X.data)?void 0:ee.symbol)?void 0:$.type)?null:new oe(X.data.symbol.callout?{symbolLayers:[W.Z.fromCIMSymbol(X)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[W.Z.fromCIMSymbol(X)]})}static fromTextSymbol(X){return new oe({symbolLayers:[ie.Z.fromTextSymbol(X)]})}};(0,x._)([(0,Q.Cb)({type:ce._,json:{write:!0}})],Y.prototype,"verticalOffset",void 0),(0,x._)([(0,Q.Cb)(ue.Y2)],Y.prototype,"callout",void 0),(0,x._)([(0,Q.Cb)({type:le,json:{origins:{"web-scene":{write:!0}}}})],Y.prototype,"symbolLayers",void 0),(0,x._)([(0,re.J)({PointSymbol3D:"point-3d"},{readOnly:!0})],Y.prototype,"type",void 0),Y=oe=(0,x._)([(0,J.j)("esri.symbols.PointSymbol3D")],Y);const j=Y},89673:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ee});var j,x=T(17626),A=T(46160),G=T(58817),Q=T(62208),H=T(77712),J=(T(90912),T(55342)),W=T(76898),B=T(65499),Z=T(9260),ie=T(26531),ue=T(21068),ce=T(2066),oe=T(39368),le=T(21716),Y=T(72622);const X=A.Z.ofType({base:null,key:"type",typeMap:{extrude:B.Z,fill:Z.Z,icon:ie.Z,line:ue.Z,object:ce.Z,text:le.Z,water:Y.Z}});let U=j=class extends oe.Z{constructor($){super($),this.symbolLayers=new X,this.type="polygon-3d"}clone(){return new j({styleOrigin:(0,G.d9)(this.styleOrigin),symbolLayers:(0,G.d9)(this.symbolLayers),thumbnail:(0,G.d9)(this.thumbnail)})}static fromJSON($){const ne=new j;if(ne.read($),2===ne.symbolLayers.length&&"fill"===ne.symbolLayers.getItemAt(0).type&&"line"===ne.symbolLayers.getItemAt(1).type){const se=ne.symbolLayers.getItemAt(0),ae=ne.symbolLayers.getItemAt(1);!ae.enabled||$.symbolLayers&&$.symbolLayers[1]&&!1===$.symbolLayers[1].enable||(se.outline={size:ae.size,color:(0,Q.pC)(ae.material)?ae.material.color:null}),ne.symbolLayers.removeAt(1)}return ne}static fromSimpleFillSymbol($){return new j({symbolLayers:[Z.Z.fromSimpleFillSymbol($)]})}};(0,x._)([(0,H.Cb)({type:X,json:{write:!0}})],U.prototype,"symbolLayers",void 0),(0,x._)([(0,J.J)({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],U.prototype,"type",void 0),U=j=(0,x._)([(0,W.j)("esri.symbols.PolygonSymbol3D")],U);const ee=U},88493:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var ie,x=T(17626),A=T(91558),G=T(2076),Q=T(58817),H=T(77712),J=(T(90912),T(55342)),W=T(76898),B=T(48575),Z=T(52068);const ue=new G.X({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let ce=ie=class extends B.Z{constructor(...le){super(...le),this.color=new A.Z([0,0,0,.25]),this.outline=new Z.Z,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(le,Y,j){if(le&&"string"!=typeof le)return le;const X={};return le&&(X.style=le),Y&&(X.outline=Y),j&&(X.color=j),X}clone(){return new ie({color:(0,Q.d9)(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};(0,x._)([(0,H.Cb)()],ce.prototype,"color",void 0),(0,x._)([(0,H.Cb)()],ce.prototype,"outline",void 0),(0,x._)([(0,J.J)({esriSFS:"simple-fill"},{readOnly:!0})],ce.prototype,"type",void 0),(0,x._)([(0,H.Cb)({type:ue.apiValues,json:{read:ue.read,write:ue.write}})],ce.prototype,"style",void 0),ce=ie=(0,x._)([(0,W.j)("esri.symbols.SimpleFillSymbol")],ce);const oe=ce},52068:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>de});var x=T(17626),A=T(2076),G=T(58817),Q=T(23841),H=T(77712),J=(T(90912),T(55342)),W=T(76898),ie=(T(85931),T(8314),T(10012));let ue=class extends ie.Z{constructor(_e){super(_e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};(0,x._)([(0,J.J)({esriSLS:"simple-line"},{readOnly:!0})],ue.prototype,"type",void 0),(0,x._)([(0,H.Cb)({type:Number,cast:Q.t_,json:{write:!0}})],ue.prototype,"width",void 0),ue=(0,x._)([(0,W.j)("esri.symbols.LineSymbol")],ue);const ce=ue;var U,oe=T(91558),le=T(86810),Y=T(68653),j=T(99433),X=T(67866);let ee=U=class extends le.wq{constructor(_e){super(_e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(_e,pe,he,ge){pe[he]="web-map"===(null==ge?void 0:ge.origin)?"arrow":_e}set color(_e){this._set("color",_e)}readColor(_e){return _e&&null!=_e[0]?[_e[0],_e[1],_e[2],_e[3]/255]:_e}writeColor(_e,pe,he,ge){"web-map"===(null==ge?void 0:ge.origin)||(pe[he]=_e)}clone(){return new U({color:(0,G.d9)(this.color),placement:this.placement,style:this.style})}hash(){var _e;return`${this.placement}.${null==(_e=this.color)?void 0:_e.hash()}.${this.style}`}};(0,x._)([(0,H.Cb)({type:["begin","end","begin-end"],json:{write:!0}})],ee.prototype,"placement",void 0),(0,x._)([(0,J.J)({"line-marker":"line-marker"},{readOnly:!0}),(0,H.Cb)({json:{origins:{"web-map":{write:!1}}}})],ee.prototype,"type",void 0),(0,x._)([(0,H.Cb)({type:X.k})],ee.prototype,"style",void 0),(0,x._)([(0,j.c)("style")],ee.prototype,"writeStyle",null),(0,x._)([(0,H.Cb)({type:oe.Z,value:null,json:{write:{allowNull:!0}}})],ee.prototype,"color",null),(0,x._)([(0,Y.r)("color")],ee.prototype,"readColor",null),(0,x._)([(0,j.c)("color")],ee.prototype,"writeColor",null),ee=U=(0,x._)([(0,W.j)("esri.symbols.LineSymbolMarker")],ee);const $=ee;var ne;const se=new A.X({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let ae=ne=class extends ce{constructor(..._e){super(..._e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(_e,pe,he,ge,ye,Me){if(_e&&"string"!=typeof _e)return _e;const Ee={};return null!=_e&&(Ee.style=_e),null!=pe&&(Ee.color=pe),null!=he&&(Ee.width=(0,Q.t_)(he)),null!=ge&&(Ee.cap=ge),null!=ye&&(Ee.join=ye),null!=Me&&(Ee.miterLimit=(0,Q.t_)(Me)),Ee}clone(){var _e;return new ne({color:(0,G.d9)(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:null==(_e=this.marker)?void 0:_e.clone()})}hash(){var _e,pe;return`${super.hash()}.${null==(_e=this.color)?void 0:_e.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${null==(pe=this.marker)?void 0:pe.hash()}`}};(0,x._)([(0,J.J)({esriSLS:"simple-line"},{readOnly:!0})],ae.prototype,"type",void 0),(0,x._)([(0,H.Cb)({type:se.apiValues,json:{read:se.read,write:se.write}})],ae.prototype,"style",void 0),(0,x._)([(0,H.Cb)({type:["butt","round","square"],json:{write:{overridePolicy:(_e,pe,he)=>({enabled:"round"!==_e&&(null==he||null==he.origin)})}}})],ae.prototype,"cap",void 0),(0,x._)([(0,H.Cb)({type:["miter","round","bevel"],json:{write:{overridePolicy:(_e,pe,he)=>({enabled:"round"!==_e&&(null==he||null==he.origin)})}}})],ae.prototype,"join",void 0),(0,x._)([(0,H.Cb)({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":$}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],ae.prototype,"marker",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{read:!1,write:!1}})],ae.prototype,"miterLimit",void 0),ae=ne=(0,x._)([(0,W.j)("esri.symbols.SimpleLineSymbol")],ae);const de=ae},57213:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Y});var ce,x=T(17626),A=T(91558),G=T(2076),Q=T(58817),H=T(23841),re=T(77712),W=(T(90912),T(55342)),B=T(76898),Z=T(99433),ie=T(46735),ue=T(52068);const oe=new G.X({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let le=ce=class extends ie.Z{constructor(...j){super(...j),this.color=new A.Z([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new ue.Z}normalizeCtorArgs(j,X,U,ee){if(j&&"string"!=typeof j)return j;const $={};return j&&($.style=j),null!=X&&($.size=(0,H.t_)(X)),U&&($.outline=U),ee&&($.color=ee),$}writeColor(j,X){j&&"x"!==this.style&&"cross"!==this.style&&(X.color=j.toJSON()),null===j&&(X.color=null)}set path(j){this.style="path",this._set("path",j)}clone(){return new ce({angle:this.angle,color:(0,Q.d9)(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var j;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${null==(j=this.outline)?void 0:j.hash()}`}};(0,x._)([(0,re.Cb)()],le.prototype,"color",void 0),(0,x._)([(0,Z.c)("color")],le.prototype,"writeColor",null),(0,x._)([(0,W.J)({esriSMS:"simple-marker"},{readOnly:!0})],le.prototype,"type",void 0),(0,x._)([(0,re.Cb)()],le.prototype,"size",void 0),(0,x._)([(0,re.Cb)({type:oe.apiValues,json:{read:oe.read,write:oe.write}})],le.prototype,"style",void 0),(0,x._)([(0,re.Cb)({type:String,json:{write:!0}})],le.prototype,"path",null),(0,x._)([(0,re.Cb)({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":ue.Z}},json:{default:null,write:!0}})],le.prototype,"outline",void 0),le=ce=(0,x._)([(0,B.j)("esri.symbols.SimpleMarkerSymbol")],le);const Y=le},10012:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var x=T(15861),A=T(17626),G=T(91558),Q=T(2076),H=T(86810),re=T(77712),Z=(T(85931),T(8314),T(90912),T(68653)),ie=T(76898);const ue=new Q.X({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let ce=0,oe=class extends H.wq{constructor(Y){super(Y),this.id="sym"+ce++,this.type=null,this.color=new G.Z([0,0,0,1])}readColor(Y){return Y&&null!=Y[0]?[Y[0],Y[1],Y[2],Y[3]/255]:Y}collectRequiredFields(Y,j){return(0,x.Z)(function*(){})()}hash(){return JSON.stringify(this.toJSON())}clone(){}};(0,A._)([(0,re.Cb)({type:ue.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:ue.write}}})],oe.prototype,"type",void 0),(0,A._)([(0,re.Cb)({type:G.Z,json:{write:{allowNull:!0}}})],oe.prototype,"color",void 0),(0,A._)([(0,Z.r)("color")],oe.prototype,"readColor",null),oe=(0,A._)([(0,ie.j)("esri.symbols.Symbol")],oe);const le=oe},39368:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Ee});var x=T(17626),A=T(46160),G=T(89726),Q=T(63290),H=T(21726),re=T(14889),J=T(77712),Z=(T(85931),T(8314),T(66656)),ie=T(68653),ue=T(76898),ce=T(99433),oe=T(84687),le=T(29840),Y=T(65499),j=T(9260),X=T(26531),U=T(21068),ee=T(2066),$=T(69147),ne=T(10012),se=T(97665),ae=T(21716),de=T(72622),_e=T(77345),pe=T(96296);const he={icon:X.Z,object:ee.Z,line:U.Z,path:$.Z,fill:j.Z,extrude:Y.Z,text:ae.Z,water:de.Z},ge=A.Z.ofType({base:se.Z,key:"type",typeMap:he,errorContext:"symbol-layer"}),ye=Q.Z.getLogger("esri.symbols.Symbol3D");let Me=class extends ne.Z{constructor(Te){super(Te),this.styleOrigin=null,this.thumbnail=null,this.type=null;const me=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers;this._set("symbolLayers",new(me&&me.type||A.Z))}get color(){return null}set color(Te){this.initialized&&ye.error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(Te){(0,G.Z)(Te,this._get("symbolLayers"))}readStyleOrigin(Te,me,Ce){if(Te.styleUrl&&Te.name){const Ie=(0,le.f)(Te.styleUrl,Ce);return new _e.Z({styleUrl:Ie,name:Te.name})}if(Te.styleName&&Te.name)return new _e.Z({portal:Ce&&Ce.portal||oe.Z.getDefault(),styleName:Te.styleName,name:Te.name});Ce&&Ce.messages&&Ce.messages.push(new re.Z("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:Ce,definition:Te}))}writeStyleOrigin(Te,me,Ce,Ie){if(Te.styleUrl&&Te.name){let Ge=(0,le.t)(Te.styleUrl,Ie);(0,H.YP)(Ge)&&(Ge=(0,H.Fv)(Ge)),me.styleOrigin={styleUrl:Ge,name:Te.name}}else Te.styleName&&Te.name&&(Te.portal&&Ie&&Ie.portal&&!(0,H.tm)(Te.portal.restUrl,Ie.portal.restUrl)?Ie&&Ie.messages&&Ie.messages.push(new re.Z("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):me.styleOrigin={styleName:Te.styleName,name:Te.name})}normalizeCtorArgs(Te){return Te instanceof se.Z||Te&&he[Te.type]?{symbolLayers:[Te]}:Array.isArray(Te)?{symbolLayers:Te}:Te}};(0,x._)([(0,J.Cb)({json:{read:!1,write:!1}})],Me.prototype,"color",null),(0,x._)([(0,J.Cb)({type:ge,nonNullable:!0,json:{write:!0}}),(0,Z.p)(G.R)],Me.prototype,"symbolLayers",null),(0,x._)([(0,J.Cb)({type:_e.Z})],Me.prototype,"styleOrigin",void 0),(0,x._)([(0,ie.r)("styleOrigin")],Me.prototype,"readStyleOrigin",null),(0,x._)([(0,ce.c)("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],Me.prototype,"writeStyleOrigin",null),(0,x._)([(0,J.Cb)({type:pe.p,json:{read:!1}})],Me.prototype,"thumbnail",void 0),(0,x._)([(0,J.Cb)({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],Me.prototype,"type",void 0),Me=(0,x._)([(0,ue.j)("esri.symbols.Symbol3D")],Me);const Ee=Me},97665:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Z});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(99433);let B=class extends A.wq{constructor(ie){super(ie),this.enabled=!0,this.type=null}writeEnabled(ie,ue,ce){ie||(ue[ce]=ie)}};(0,x._)([(0,G.Cb)({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],B.prototype,"enabled",void 0),(0,x._)([(0,W.c)("enabled")],B.prototype,"writeEnabled",null),(0,x._)([(0,G.Cb)({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],B.prototype,"type",void 0),B=(0,x._)([(0,J.j)("esri.symbols.Symbol3DLayer")],B);const Z=B},35540:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ce,x=T(17626),A=T(91558),G=T(58817),Q=T(23841),H=T(77712),re=T(66656),J=T(55342),W=T(76898),B=T(99433),Z=T(11472),ie=T(10012),ue=T(50369);let oe=ce=class extends ie.Z{constructor(...Y){super(...Y),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new Z.Z,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(Y,j,X){if(Y&&"string"!=typeof Y)return Y;const U={};return Y&&(U.text=Y),j&&(U.font=j),X&&(U.color=X),U}writeLineWidth(Y,j,X,U){U&&"string"!=typeof U||(j[X]=Y)}castLineWidth(Y){return(0,Q.t_)(Y)}writeLineHeight(Y,j,X,U){U&&"string"!=typeof U||(j[X]=Y)}clone(){return new ce({angle:this.angle,backgroundColor:(0,G.d9)(this.backgroundColor),borderLineColor:(0,G.d9)(this.borderLineColor),borderLineSize:this.borderLineSize,color:(0,G.d9)(this.color),font:this.font&&this.font.clone(),haloColor:(0,G.d9)(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};(0,x._)([(0,H.Cb)({type:A.Z,json:{write:!0}})],oe.prototype,"backgroundColor",void 0),(0,x._)([(0,H.Cb)({type:A.Z,json:{write:!0}})],oe.prototype,"borderLineColor",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],oe.prototype,"borderLineSize",void 0),(0,x._)([(0,H.Cb)({type:Z.Z,json:{write:!0}})],oe.prototype,"font",void 0),(0,x._)([(0,H.Cb)(yi(or({},ue.x0),{json:{write:!0}}))],oe.prototype,"horizontalAlignment",void 0),(0,x._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],oe.prototype,"kerning",void 0),(0,x._)([(0,H.Cb)({type:A.Z,json:{write:!0}})],oe.prototype,"haloColor",void 0),(0,x._)([(0,H.Cb)({type:Number,cast:Q.t_,json:{write:!0}})],oe.prototype,"haloSize",void 0),(0,x._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],oe.prototype,"rightToLeft",void 0),(0,x._)([(0,H.Cb)({type:Boolean,json:{write:!0}})],oe.prototype,"rotated",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],oe.prototype,"text",void 0),(0,x._)([(0,J.J)({esriTS:"text"},{readOnly:!0})],oe.prototype,"type",void 0),(0,x._)([(0,H.Cb)(yi(or({},ue.Nj),{json:{write:!0}}))],oe.prototype,"verticalAlignment",void 0),(0,x._)([(0,H.Cb)({type:Number,cast:Q.t_,json:{write:!0}})],oe.prototype,"xoffset",void 0),(0,x._)([(0,H.Cb)({type:Number,cast:Q.t_,json:{write:!0}})],oe.prototype,"yoffset",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{read:Y=>Y&&-1*Y,write:(Y,j)=>j.angle=Y&&-1*Y}})],oe.prototype,"angle",void 0),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],oe.prototype,"width",void 0),(0,x._)([(0,H.Cb)({type:Number})],oe.prototype,"lineWidth",void 0),(0,x._)([(0,B.c)("lineWidth")],oe.prototype,"writeLineWidth",null),(0,x._)([(0,re.p)("lineWidth")],oe.prototype,"castLineWidth",null),(0,x._)([(0,H.Cb)(ue.Ck)],oe.prototype,"lineHeight",void 0),(0,x._)([(0,B.c)("lineHeight")],oe.prototype,"writeLineHeight",null),oe=ce=(0,x._)([(0,W.j)("esri.symbols.TextSymbol")],oe);const le=oe},21716:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>de});var oe,x=T(17626),A=T(58817),G=T(62208),Q=T(77712),re=(T(90912),T(55342)),J=T(76898),W=T(99433),B=T(11472),Z=T(97665),ie=T(60958),ue=T(91558),ce=T(86810);let le=oe=class extends ce.wq{constructor(){super(...arguments),this.color=new ue.Z([0,0,0,1]),this.size=0}clone(){const _e={color:(0,A.d9)(this.color),size:this.size};return new oe(_e)}};(0,x._)([(0,Q.Cb)(ie.a)],le.prototype,"color",void 0),(0,x._)([(0,Q.Cb)(ie.y)],le.prototype,"size",void 0),le=oe=(0,x._)([(0,J.j)("esri.symbols.support.Symbol3DHalo")],le);var Y=T(64830),j=T(79608);T(85931),T(8314);let ee=class extends((0,j.J)(ce.wq)){constructor(_e){super(_e),this.color=null}};(0,x._)([(0,Q.Cb)(ie.a)],ee.prototype,"color",void 0),ee=(0,x._)([(0,J.j)("esri.symbols.support.Symbol3DTextBackground")],ee);var ne,$=T(50369);let se=ne=class extends Z.Z{constructor(_e){super(_e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(_e){(0,G.pC)(_e)&&(0,G.pC)(this._userSize)&&(_e.size=this._userSize),this._set("font",_e)}writeFont(_e,pe,he,ge){const ye=yi(or({},ge),{textSymbol3D:!0});pe.font=_e.write({},ye),delete pe.font.size}get size(){return(0,G.pC)(this._userSize)?this._userSize:(0,G.pC)(this.font)&&null!=this.font.size?this.font.size:9}set size(_e){this._userSize=_e,(0,G.pC)(this.font)&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const _e=new ne({enabled:this.enabled,font:this.font&&(0,A.d9)(this.font),halo:this.halo&&(0,A.d9)(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:(0,G.pC)(this.material)?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:(0,A.d9)(this.background)});return _e._userSize=this._userSize,_e}static fromTextSymbol(_e){return new ne({font:(0,G.pC)(_e.font)?_e.font.clone():new B.Z,halo:ae(_e.haloColor,_e.haloSize),horizontalAlignment:_e.horizontalAlignment,lineHeight:_e.lineHeight,material:_e.color?new Y.b({color:_e.color.clone()}):null,text:_e.text,verticalAlignment:_e.verticalAlignment,background:_e.backgroundColor?new ee({color:_e.backgroundColor.clone()}):null})}};function ae(_e,pe){return _e&&pe>0?new le({color:(0,A.d9)(_e),size:pe}):null}(0,x._)([(0,Q.Cb)({type:B.Z,json:{write:!0}})],se.prototype,"font",null),(0,x._)([(0,W.c)("font")],se.prototype,"writeFont",null),(0,x._)([(0,Q.Cb)({type:le,json:{write:!0}})],se.prototype,"halo",void 0),(0,x._)([(0,Q.Cb)(yi(or({},$.x0),{json:{default:"center",write:!0}}))],se.prototype,"horizontalAlignment",void 0),(0,x._)([(0,Q.Cb)(yi(or({},$.Ck),{json:{default:1,write:!0}}))],se.prototype,"lineHeight",void 0),(0,x._)([(0,Q.Cb)({type:Y.b,json:{write:!0}})],se.prototype,"material",void 0),(0,x._)([(0,Q.Cb)({type:ee,json:{write:!0}})],se.prototype,"background",void 0),(0,x._)([(0,Q.Cb)(ie.y)],se.prototype,"size",null),(0,x._)([(0,Q.Cb)({type:String,json:{write:!0}})],se.prototype,"text",void 0),(0,x._)([(0,re.J)({Text:"text"},{readOnly:!0})],se.prototype,"type",void 0),(0,x._)([(0,Q.Cb)(yi(or({},$.Nj),{json:{default:"baseline",write:!0}}))],se.prototype,"verticalAlignment",void 0),se=ne=(0,x._)([(0,J.j)("esri.symbols.TextSymbol3DLayer")],se);const de=se},72622:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var B,x=T(17626),A=T(91558),G=T(58817),Q=T(77712),H=T(90912),re=T(55342),J=T(76898),W=T(97665);let Z=B=class extends W.Z{constructor(ce){super(ce),this.color=ie.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new B({color:(0,G.d9)(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};(0,x._)([(0,Q.Cb)({type:A.Z,nonNullable:!0,json:{type:[H.z8],write:(ce,oe,le)=>oe[le]=ce.toArray(A.Z.AlphaMode.UNLESS_OPAQUE),default:()=>ie.clone(),defaultEquals:ce=>ce.toCss(!0)===ie.toCss(!0)}})],Z.prototype,"color",void 0),(0,x._)([(0,re.J)({Water:"water"},{readOnly:!0})],Z.prototype,"type",void 0),(0,x._)([(0,Q.Cb)({type:["small","medium","large"],json:{write:!0,default:"medium"}})],Z.prototype,"waterbodySize",void 0),(0,x._)([(0,Q.Cb)({type:Number,json:{write:!0,default:null}})],Z.prototype,"waveDirection",void 0),(0,x._)([(0,Q.Cb)({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],Z.prototype,"waveStrength",void 0),Z=B=(0,x._)([(0,J.j)("esri.symbols.WaterSymbol3DLayer")],Z);const ie=new A.Z([0,119,190]),ue=Z},12874:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ee});var Y,x=T(15861),A=T(17626),G=T(63290),Q=T(62208),H=T(10699),re=T(77712),Z=(T(85931),T(8314),T(90912),T(55342)),ie=T(76898),ue=T(84687),ce=T(29840),oe=T(10012),le=T(96296);const j=G.Z.getLogger("esri.symbols.WebStyleSymbol");let X=Y=class extends oe.Z{constructor($){super($),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get fetchCacheKey(){const $=(0,Q.pC)(this.portal)?this.portal:ue.Z.getDefault();return`${this.styleName}:${this.styleUrl}:${this.name}:${$.user?$.user.username:null}:${$.url}`}read($,ne){this.portal=ne?ne.portal:void 0,super.read($,ne)}clone(){return new Y({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol($){return this._fetchSymbol("webRef",$)}fetchCIMSymbol($){return this._fetchSymbol("cimRef",$)}_fetchSymbol($,ne){var se=this;return(0,x.Z)(function*(){const ae=(0,Q.pC)(ne)?ne.cache:null,de=ae?se.fetchCacheKey:null;if((0,Q.pC)(ae)){const ge=ae.get(de);if(ge)return ge.clone()}const _e=yield function U(){return T.e(8592).then(T.bind(T,50998))}();(0,H.k_)(ne);const pe=_e.resolveWebStyleSymbol(se,{portal:se.portal},$,ne);pe.catch(ge=>{j.error("#fetchSymbol()","Failed to create symbol from style",ge)});const he=yield pe;return"webRef"===$&&"point-3d"===he.type||"cimRef"===$&&"cim"===he.type?((0,Q.pC)(ae)&&ae.set(de,he.clone()),he):null})()}};(0,A._)([(0,re.Cb)({json:{write:!1}})],X.prototype,"color",void 0),(0,A._)([(0,re.Cb)({type:String,json:{write:!0}})],X.prototype,"styleName",void 0),(0,A._)([(0,re.Cb)({type:ue.Z,json:{write:!1}})],X.prototype,"portal",void 0),(0,A._)([(0,re.Cb)({type:String,json:{read:ce.r,write:ce.w}})],X.prototype,"styleUrl",void 0),(0,A._)([(0,re.Cb)({type:le.p,json:{read:!1}})],X.prototype,"thumbnail",void 0),(0,A._)([(0,re.Cb)({type:String,json:{write:!0}})],X.prototype,"name",void 0),(0,A._)([(0,Z.J)({styleSymbolReference:"web-style"},{readOnly:!0})],X.prototype,"type",void 0),(0,A._)([(0,re.Cb)()],X.prototype,"fetchCacheKey",null),X=Y=(0,A._)([(0,ie.j)("esri.symbols.WebStyleSymbol")],X);const ee=X},21779:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.wq{constructor(Z){super(Z),this.visible=!0}clone(){}};(0,x._)([(0,G.Cb)({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],W.prototype,"type",void 0),(0,x._)([(0,G.Cb)({readOnly:!0})],W.prototype,"visible",void 0),W=(0,x._)([(0,J.j)("esri.symbols.callouts.Callout3D")],W);const B=W},17497:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>le});var ce,x=T(17626),A=T(91558),G=T(58817),Q=T(62208),H=T(23841),re=T(77712),W=(T(90912),T(55342)),B=T(76898),Z=T(21779),ie=T(71530),ue=T(60958);let oe=ce=class extends Z.Z{constructor(Y){super(Y),this.type="line",this.color=new A.Z([0,0,0,1]),this.size=(0,H.Wz)(1),this.border=null}get visible(){return this.size>0&&(0,Q.pC)(this.color)&&this.color.a>0}clone(){return new ce({color:(0,G.d9)(this.color),size:this.size,border:(0,G.d9)(this.border)})}};(0,x._)([(0,W.J)({line:"line"},{readOnly:!0})],oe.prototype,"type",void 0),(0,x._)([(0,re.Cb)(ue.a)],oe.prototype,"color",void 0),(0,x._)([(0,re.Cb)(ue.y)],oe.prototype,"size",void 0),(0,x._)([(0,re.Cb)({type:ie.a,json:{write:!0}})],oe.prototype,"border",void 0),(0,x._)([(0,re.Cb)({readOnly:!0})],oe.prototype,"visible",null),oe=ce=(0,x._)([(0,B.j)("esri.symbols.callouts.LineCallout3D")],oe);const le=oe},9824:(dt,Re,T)=>{"use strict";T.d(Re,{Pd:()=>H,Uy:()=>G,Y2:()=>J,as:()=>re,gv:()=>Q});var x=T(21779),A=T(17497);function G(W){if(!W)return!1;const B=W.verticalOffset;return!!B&&!(B.screenLength<=0||B.maxWorldLength<=0)}function Q(W){if(!W||!W.supportsCallout||!W.supportsCallout())return!1;const B=W.callout;return!!B&&!!B.visible&&!!G(W)}function H(W){return"point-3d"===W.type||"label-3d"===W.type}function re(W){return"center"===W.horizontalAlignment}const J={types:{key:"type",base:x.Z,typeMap:{line:A.Z}},json:{write:!0}}},80991:(dt,Re,T)=>{"use strict";function A(Y,j,X,U){return function x(Y){return"function"==typeof Y}(Y)?Y(j,X,U):Y}function G(Y){return[Y.r,Y.g,Y.b,Y.a]}function Q(Y,j,X){const ee=ae=>{let de=ae.length;for(;de--;)if(!" /-,\n".includes(ae.charAt(de)))return!1;return!0},$=[];let ne=0,se=-1;do{if(se=j.indexOf("[",ne),se>=ne){if(se>ne){const ae=j.substr(ne,se-ne);$.push([ae,null,ee(ae)])}if(ne=se+1,se=j.indexOf("]",ne),se>=ne){if(se>ne){const ae=Y[j.substr(ne,se-ne)];ae&&$.push([null,ae,!1])}ne=se+1}}}while(-1!==se);if(ne<j.length-1){const ae=j.substr(ne);$.push([ae,null,ee(ae)])}return ae=>{let de="",_e=null;for(const pe of $){const[he,ge,ye]=pe;if(he)ye?_e=he:(_e&&(de+=_e,_e=null),de+=he);else{const Me=ae.attributes[ge];Me&&(_e&&(de+=_e,_e=null),de+=Me)}}return H(de,X)}}function H(Y,j){switch("string"!=typeof Y&&(Y=String(Y)),j){case"LowerCase":return Y.toLowerCase();case"Allcaps":return Y.toUpperCase();default:return Y}}function re(Y,j,X,U,ee,$,ne=!0){const se=j/ee,ae=X/$,de=Math.ceil(se/2),_e=Math.ceil(ae/2);for(let pe=0;pe<$;pe++)for(let he=0;he<ee;he++){const ge=4*(he+(ne?$-pe-1:pe)*ee);let ye=0,Me=0,Ee=0,Te=0,me=0,Ce=0,Ie=0;const Ge=(pe+.5)*ae;for(let Je=Math.floor(pe*ae);Je<(pe+1)*ae;Je++){const xe=Math.abs(Ge-(Je+.5))/_e,je=(he+.5)*se,We=xe*xe;for(let Ne=Math.floor(he*se);Ne<(he+1)*se;Ne++){let we=Math.abs(je-(Ne+.5))/de;const Oe=Math.sqrt(We+we*we);Oe>=-1&&Oe<=1&&(ye=2*Oe*Oe*Oe-3*Oe*Oe+1,ye>0&&(we=4*(Ne+Je*j),Ie+=ye*Y[we+3],Ee+=ye,Y[we+3]<255&&(ye=ye*Y[we+3]/250),Te+=ye*Y[we],me+=ye*Y[we+1],Ce+=ye*Y[we+2],Me+=ye))}}U[ge]=Te/Me,U[ge+1]=me/Me,U[ge+2]=Ce/Me,U[ge+3]=Ie/Ee}}function J(Y){return Y?{r:Y[0],g:Y[1],b:Y[2],a:Y[3]/255}:{r:0,g:0,b:0,a:0}}function W(Y){var j;return null==(j=Y.data)?void 0:j.symbol}function B(Y){return"CIMVectorMarker"===Y.type||"CIMPictureMarker"===Y.type||"CIMBarChartMarker"===Y.type||"CIMCharacterMarker"===Y.type||"CIMPieChartMarker"===Y.type||"CIMStackedBarChartMarker"===Y.type}function Z(Y){return"CIMGradientStroke"===Y.type||"CIMPictureStroke"===Y.type||"CIMSolidStroke"===Y.type}function ie(Y){return"CIMGradientFill"===Y.type||"CIMHatchFill"===Y.type||"CIMPictureFill"===Y.type||"CIMSolidFill"===Y.type||"CIMWaterFill"===Y.type}function ue(Y){return"CIMMarkerPlacementAlongLineRandomSize"===Y.type||"CIMMarkerPlacementAlongLineSameSize"===Y.type||"CIMMarkerPlacementAlongLineVariableSize"===Y.type||"CIMMarkerPlacementAtExtremities"===Y.type||"CIMMarkerPlacementAtMeasuredUnits"===Y.type||"CIMMarkerPlacementAtRatioPositions"===Y.type||"CIMMarkerPlacementOnLine"===Y.type||"CIMMarkerPlacementOnVertices"===Y.type}T.d(Re,{Cc:()=>oe,NA:()=>ce,NO:()=>J,Qs:()=>Q,RI:()=>le,TT:()=>re,X3:()=>H,be:()=>W,gJ:()=>ue,hf:()=>A,k5:()=>ie,nn:()=>G,yL:()=>Z,zL:()=>B});const ce=Y=>isNaN(Y)||!Y?0:Y,oe=Y=>{if(!Y)return!1;for(const j of Y)switch(j.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":return!0}return!1};function le(){return Promise.all([T.e(4918),T.e(8592),T.e(2825)]).then(T.bind(T,32825))}},31184:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var x=T(17626),A=T(91558),G=T(86810),Q=T(58817),H=T(23841),re=T(77712),W=(T(90912),T(76898)),B=T(60958);let Z=class extends G.wq{constructor(ue){super(ue),this.color=new A.Z([0,0,0,1]),this.extensionLength=0,this.size=(0,H.Wz)(1)}clone(){}cloneProperties(){return{color:(0,Q.d9)(this.color),size:this.size,extensionLength:this.extensionLength}}};(0,x._)([(0,re.Cb)({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],Z.prototype,"type",void 0),(0,x._)([(0,re.Cb)(B.a)],Z.prototype,"color",void 0),(0,x._)([(0,re.Cb)(yi(or({},B.y),{json:{write:{overridePolicy:ue=>({enabled:!!ue})}}}))],Z.prototype,"extensionLength",void 0),(0,x._)([(0,re.Cb)(B.y)],Z.prototype,"size",void 0),Z=(0,x._)([(0,W.j)("esri.symbols.edges.Edges3D")],Z);const ie=Z},2252:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var Z,x=T(17626),J=(T(63290),T(90912),T(85931),T(8314),T(82255),T(55342)),W=T(76898),B=T(31184);let ie=Z=class extends B.Z{constructor(ce){super(ce),this.type="solid"}clone(){return new Z(this.cloneProperties())}};(0,x._)([(0,J.J)({solid:"solid"},{readOnly:!0})],ie.prototype,"type",void 0),ie=Z=(0,x._)([(0,W.j)("esri.symbols.support.SolidEdges3D")],ie);const ue=ie},61261:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var Z,x=T(31184),A=T(17626),W=(T(63290),T(90912),T(85931),T(8314),T(82255),T(55342)),B=T(76898);let ie=Z=class extends x.Z{constructor(le){super(le),this.type="sketch"}clone(){return new Z(this.cloneProperties())}};(0,A._)([(0,W.J)({sketch:"sketch"},{readOnly:!0})],ie.prototype,"type",void 0),ie=Z=(0,A._)([(0,B.j)("esri.symbols.edges.SketchEdges3D")],ie);const ue=ie;var ce=T(2252);const oe={types:{key:"type",base:x.Z,typeMap:{solid:ce.Z,sketch:ue}},json:{write:!0}}},38861:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.wq{constructor(Z){super(Z)}clone(){}};(0,x._)([(0,G.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],W.prototype,"type",void 0),W=(0,x._)([(0,J.j)("esri.symbols.patterns.LinePattern3D")],W);const B=W},63743:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var ie,x=T(17626),A=T(2076),G=T(77712),J=(T(85931),T(8314),T(90912),T(55342)),W=T(76898),B=T(38861);const ue=(0,A.w)()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let ce=ie=class extends B.Z{constructor(le){super(le),this.type="style",this.style="solid"}clone(){return new ie({style:this.style})}};(0,x._)([(0,G.Cb)({type:["style"]})],ce.prototype,"type",void 0),(0,x._)([(0,J.J)(ue),(0,G.Cb)({type:["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"]})],ce.prototype,"style",void 0),ce=ie=(0,x._)([(0,W.j)("esri.symbols.patterns.LineStylePattern3D")],ce);const oe=ce},40249:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.wq{constructor(Z){super(Z)}clone(){}};(0,x._)([(0,G.Cb)({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],W.prototype,"type",void 0),W=(0,x._)([(0,J.j)("esri.symbols.patterns.Pattern3D")],W);const B=W},153:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898)),J=T(40249);let Z=B=class extends J.Z{constructor(ue){super(ue),this.type="style",this.style="solid"}clone(){return new B({style:this.style})}};(0,x._)([(0,A.Cb)({type:["style"]})],Z.prototype,"type",void 0),(0,x._)([(0,A.Cb)({type:["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"],json:{read:!0,write:!0}})],Z.prototype,"style",void 0),Z=B=(0,x._)([(0,re.j)("esri.symbols.patterns.StylePattern3D")],Z);const ie=Z},99255:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>re,q:()=>H});var x=T(38861),A=T(63743),G=T(40249),Q=T(153);const H={types:{key:"type",base:G.Z,typeMap:{style:Q.Z}},json:{write:!0}},re={types:{key:"type",base:x.Z,typeMap:{style:A.Z}},json:{write:!0}}},82706:(dt,Re,T)=>{"use strict";T.d(Re,{ZP:()=>ne});var oe,x=T(17626),A=T(2076),G=T(86810),Q=T(62208),H=T(77712),B=(T(85931),T(8314),T(90912),T(68653)),Z=T(76898),ie=T(99433),ue=T(15861),ce=T(36630);let le=oe=class extends G.wq{collectRequiredFields(se,ae){var de=this;return(0,ue.Z)(function*(){return(0,ce.io)(se,ae,de.expression)})()}clone(){return new oe({expression:this.expression,title:this.title})}equals(se){return this.expression===se.expression&&this.title===se.title}};(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],le.prototype,"expression",void 0),(0,x._)([(0,H.Cb)({type:String,json:{write:!0}})],le.prototype,"title",void 0),le=oe=(0,x._)([(0,Z.j)("esri.layers.support.FeatureExpressionInfo")],le);const Y=le;var X,j=T(29505);const U=(0,A.w)()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),ee=new A.X({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let $=X=class extends G.wq{constructor(){super(...arguments),this.offset=null}readFeatureExpressionInfo(se,ae){return null!=se?se:ae.featureExpression&&0===ae.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(se,ae,de,_e){ae[de]=se.write({},_e),"0"===se.expression&&(ae.featureExpression={value:0})}get mode(){const{offset:se,featureExpressionInfo:ae}=this;return this._isOverridden("mode")?this._get("mode"):(0,Q.pC)(se)||ae?"relative-to-ground":"on-the-ground"}set mode(se){this._override("mode",se)}set unit(se){this._set("unit",se)}write(se,ae){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(se,ae):null}clone(){return new X({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(se){return this.mode===se.mode&&this.offset===se.offset&&this.unit===se.unit&&(0,Q._W)(this.featureExpressionInfo,se.featureExpressionInfo)}};(0,x._)([(0,H.Cb)({type:Y,json:{write:!0}})],$.prototype,"featureExpressionInfo",void 0),(0,x._)([(0,B.r)("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],$.prototype,"readFeatureExpressionInfo",null),(0,x._)([(0,ie.c)("featureExpressionInfo",{featureExpressionInfo:{type:Y},"featureExpression.value":{type:[0]}})],$.prototype,"writeFeatureExpressionInfo",null),(0,x._)([(0,H.Cb)({type:U.apiValues,nonNullable:!0,json:{type:U.jsonValues,read:U.read,write:{writer:U.write,isRequired:!0}}})],$.prototype,"mode",null),(0,x._)([(0,H.Cb)({type:Number,json:{write:!0}})],$.prototype,"offset",void 0),(0,x._)([(0,H.Cb)({type:j.f9,json:{type:String,read:ee.read,write:ee.write}})],$.prototype,"unit",null),$=X=(0,x._)([(0,Z.j)("esri.layers.support.ElevationInfo")],$);const ne=$},33215:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>j,b:()=>Y});var oe,x=T(17626),A=T(2076),G=T(86810),Q=T(21726),H=T(77712),B=(T(85931),T(8314),T(90912),T(55342)),Z=T(68653),ie=T(76898),ue=T(99433),ce=T(29840);const le=(0,A.w)()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let Y=oe=class extends G.wq{constructor(X){super(X)}readHref(X,U,ee){return X?(0,ce.f)(X,ee):U.dataURI}writeHref(X,U,ee,$){X&&((0,Q.HK)(X)?U.dataURI=X:(U.href=(0,ce.t)(X,$),(0,Q.YP)(U.href)&&(U.href=(0,Q.Fv)(U.href))))}clone(){return new oe({href:this.href,primitive:this.primitive})}};(0,x._)([(0,H.Cb)({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],Y.prototype,"href",void 0),(0,x._)([(0,Z.r)("href")],Y.prototype,"readHref",null),(0,x._)([(0,ue.c)("href",{href:{type:String},dataURI:{type:String}})],Y.prototype,"writeHref",null),(0,x._)([(0,B.J)(le)],Y.prototype,"primitive",void 0),Y=oe=(0,x._)([(0,ie.j)("esri.symbols.support.IconSymbol3DLayerResource")],Y);const j="circle"},48521:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>oe,k:()=>ce});var ie,x=T(17626),A=T(2076),G=T(86810),Q=T(77712),W=(T(85931),T(8314),T(90912),T(55342)),B=T(76898),Z=T(29840);const ue=(0,A.w)()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let ce=ie=class extends G.wq{clone(){return new ie({href:this.href,primitive:this.primitive})}};(0,x._)([(0,Q.Cb)({type:String,json:{read:Z.r,write:Z.w}})],ce.prototype,"href",void 0),(0,x._)([(0,W.J)(ue)],ce.prototype,"primitive",void 0),ce=ie=(0,x._)([(0,B.j)("esri.symbols.support.ObjectSymbol3DLayerResource")],ce);const oe="sphere"},77345:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var B,x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(84687);let Z=B=class extends A.Z{constructor(){super(...arguments),this.portal=null}clone(){return new B({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};(0,x._)([(0,G.Cb)({type:String})],Z.prototype,"name",void 0),(0,x._)([(0,G.Cb)({type:String})],Z.prototype,"styleUrl",void 0),(0,x._)([(0,G.Cb)({type:String})],Z.prototype,"styleName",void 0),(0,x._)([(0,G.Cb)({type:W.Z})],Z.prototype,"portal",void 0),Z=B=(0,x._)([(0,J.j)("esri.symbols.support.StyleOrigin")],Z);const ie=Z},37519:(dt,Re,T)=>{"use strict";T.d(Re,{e:()=>B});var W,x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let B=W=class extends A.Z{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new W({x:this.x,y:this.y})}};(0,x._)([(0,G.Cb)({type:Number})],B.prototype,"x",void 0),(0,x._)([(0,G.Cb)({type:Number})],B.prototype,"y",void 0),B=W=(0,x._)([(0,J.j)("esri.symbols.support.Symbol3DAnchorPosition2D")],B)},64830:(dt,Re,T)=>{"use strict";T.d(Re,{b:()=>ie});var Z,x=T(17626),A=T(86810),G=T(62208),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898)),B=T(60958);let ie=Z=class extends A.wq{constructor(ue){super(ue),this.color=null}clone(){const ue={color:(0,G.pC)(this.color)?this.color.clone():null};return new Z(ue)}};(0,x._)([(0,Q.Cb)(B.a)],ie.prototype,"color",void 0),ie=Z=(0,x._)([(0,W.j)("esri.symbols.support.Symbol3DMaterial")],ie)},97595:(dt,Re,T)=>{"use strict";T.d(Re,{_:()=>Z});var B,x=T(17626),A=T(86810),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898)),W=T(60958);let Z=B=class extends A.wq{constructor(){super(...arguments),this.screenLength=0,this.minWorldLength=0}clone(){return new B({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};(0,x._)([(0,G.Cb)(W.y)],Z.prototype,"screenLength",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0,default:0}})],Z.prototype,"minWorldLength",void 0),(0,x._)([(0,G.Cb)({type:Number,json:{write:!0}})],Z.prototype,"maxWorldLength",void 0),Z=B=(0,x._)([(0,J.j)("esri.symbols.support.Symbol3DVerticalOffset")],Z)},96296:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>B});var W,x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let B=W=class extends A.Z{clone(){return new W({url:this.url})}};(0,x._)([(0,G.Cb)({type:String})],B.prototype,"url",void 0),B=W=(0,x._)([(0,J.j)("esri.symbols.support.Thumbnail")],B)},56445:(dt,Re,T)=>{"use strict";T.d(Re,{FW:()=>J,PI:()=>Q,iW:()=>Z,kW:()=>G});var x=T(91558),A=T(80991);function G(j){const X=(0,A.be)(j);if("CIMTextSymbol"===X.type)return X.height;let U=0;if(X.symbolLayers)for(const ee of X.symbolLayers)(0,A.zL)(ee)&&ee.size>U?U=ee.size:(0,A.yL)(ee)&&ee.width>U?U=ee.width:(0,A.k5)(ee);return U}function Q(j,X,U){const ee=(0,A.be)(j),$=G(j);0!==$?re(ee,X/$,!1,U):function H(j,X){if("CIMTextSymbol"!==j.type){if(j.symbolLayers)for(const U of j.symbolLayers)switch(U.type){case"CIMPictureMarker":case"CIMVectorMarker":U.size=X;break;case"CIMPictureStroke":case"CIMSolidStroke":U.width=X}}else j.height=X}(ee,X)}function re(j,X,U,ee){if("CIMTextSymbol"!==j.type){if(U&&j.effects)for(const $ of j.effects)B($,X);if(j.symbolLayers)for(const $ of j.symbolLayers)switch($.type){case"CIMPictureMarker":case"CIMVectorMarker":J($,X,ee);break;case"CIMPictureStroke":case"CIMSolidStroke":!(null==ee?void 0:ee.preserveOutlineWidth)&&$.width&&($.width*=X);break;case"CIMPictureFill":$.height&&($.height*=X),$.offsetX&&($.offsetX*=X),$.offsetY&&($.offsetY*=X);break;case"CIMHatchFill":re($.lineSymbol,X,!0,yi(or({},ee),{preserveOutlineWidth:!1})),$.offsetX&&($.offsetX*=X),$.offsetY&&($.offsetY*=X),$.separation&&($.separation*=X)}}else j.height*=X}function J(j,X,U){if(j.markerPlacement&&function W(j,X){switch((0,A.gJ)(j)&&j.offset&&(j.offset*=X),j.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(j.customEndingOffset&&(j.customEndingOffset*=X),j.offsetAlongLine&&(j.offsetAlongLine*=X),j.placementTemplate&&j.placementTemplate.length){const U=j.placementTemplate.map(ee=>ee*X);j.placementTemplate=U}break;case"CIMMarkerPlacementAlongLineVariableSize":if(j.maxRandomOffset&&(j.maxRandomOffset*=X),j.placementTemplate&&j.placementTemplate.length){const U=j.placementTemplate.map(ee=>ee*X);j.placementTemplate=U}break;case"CIMMarkerPlacementOnLine":j.startPointOffset&&(j.startPointOffset*=X);break;case"CIMMarkerPlacementAtExtremities":j.offsetAlongLine&&(j.offsetAlongLine*=X);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":j.beginPosition&&(j.beginPosition*=X),j.endPosition&&(j.endPosition*=X);break;case"CIMMarkerPlacementPolygonCenter":j.offsetX&&(j.offsetX*=X),j.offsetY&&(j.offsetY*=X);break;case"CIMMarkerPlacementInsidePolygon":j.offsetX&&(j.offsetX*=X),j.offsetY&&(j.offsetY*=X),j.stepX&&(j.stepX*=X),j.stepY&&(j.stepY*=X)}}(j.markerPlacement,X),j.offsetX&&(j.offsetX*=X),j.offsetY&&(j.offsetY*=X),j.anchorPoint&&"Absolute"===j.anchorPointUnits&&(j.anchorPoint={x:j.anchorPoint.x*X,y:j.anchorPoint.y*X}),j.size*=X,"CIMVectorMarker"===j.type&&j.markerGraphics)for(const ee of j.markerGraphics)j.scaleSymbolsProportionally||re(ee.symbol,X,!0,U)}function B(j,X){switch(j.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":j.width&&(j.width*=X);break;case"CIMGeometricEffectBuffer":j.size&&(j.size*=X);break;case"CIMGeometricEffectCut":j.beginCut&&(j.beginCut*=X),j.endCut&&(j.endCut*=X),j.middleCut&&(j.middleCut*=X);break;case"CIMGeometricEffectDashes":if(j.customEndingOffset&&(j.customEndingOffset*=X),j.offsetAlongLine&&(j.offsetAlongLine*=X),j.dashTemplate&&j.dashTemplate.length){const U=j.dashTemplate.map(ee=>ee*X);j.dashTemplate=U}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":j.length&&(j.length*=X);break;case"CIMGeometricEffectMove":j.offsetX&&(j.offsetX*=X),j.offsetY&&(j.offsetY*=X);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":j.offset&&(j.offset*=X);break;case"CIMGeometricEffectRegularPolygon":j.radius&&(j.radius*=X);break;case"CIMGeometricEffectTaperedPolygon":j.fromWidth&&(j.fromWidth*=X),j.length&&(j.length*=X),j.toWidth&&(j.toWidth*=X);break;case"CIMGeometricEffectWave":j.amplitude&&(j.amplitude*=X),j.period&&(j.period*=X)}}function Z(j){const X=[];return ie((0,A.be)(j),X),X.length?new x.Z((0,A.NO)(X[0])):null}function ie(j,X){let U;U="CIMTextSymbol"===j.type?j.symbol:j;const ee="CIMPolygonSymbol"===j.type;if(U.symbolLayers)for(const $ of U.symbolLayers)if(!($.colorLocked||ee&&((0,A.yL)($)||(0,A.zL)($)&&$.markerPlacement&&(0,A.gJ)($.markerPlacement))))switch($.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":$.tintColor&&ue(X,$.tintColor);break;case"CIMVectorMarker":$.markerGraphics.forEach(ne=>{ie(ne.symbol,X)});break;case"CIMSolidStroke":case"CIMSolidFill":ue(X,$.color);break;case"CIMHatchFill":ie($.lineSymbol,X)}}function ue(j,X){for(const U of j)if(U.join(".")===X.join("."))return;j.push(X)}},12948:(dt,Re,T)=>{"use strict";T.d(Re,{ix:()=>A,l9:()=>Q,rx:()=>H});var x=T(91558);const A=new x.Z("white"),Q=(new x.Z("black"),new x.Z([255,255,255,0]));function H(re){return 0===re.r&&0===re.g&&0===re.b}},8080:(dt,Re,T)=>{"use strict";T.d(Re,{CJ:()=>B,Rz:()=>ie,js:()=>ue,xA:()=>W,z3:()=>Z}),T(8314);var A=T(62208),G=T(88493),Q=T(52068),H=T(57213),re=T(35540),J=T(24837);const W=H.Z.fromJSON(J.I4),B=Q.Z.fromJSON(J.ET),Z=G.Z.fromJSON(J.lF),ie=re.Z.fromJSON(J.qP);function ue(Y){if((0,A.Wi)(Y))return null;switch(Y.type){case"mesh":return null;case"point":case"multipoint":return W;case"polyline":return B;case"polygon":case"extent":return Z}return null}H.Z.fromJSON(J.eG),Q.Z.fromJSON(J.wW),G.Z.fromJSON(J.lj)},24837:(dt,Re,T)=>{"use strict";T.d(Re,{ET:()=>Q,I4:()=>G,SQ:()=>x,X1:()=>A,eG:()=>J,lF:()=>H,lj:()=>B,qP:()=>re,wW:()=>W});const x=[252,146,31,255],A=[153,153,153,255],G={type:"esriSMS",style:"esriSMSCircle",size:6,color:x,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},Q={type:"esriSLS",style:"esriSLSSolid",width:.75,color:x},H={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},re={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},J={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},W={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},B={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null}},74741:(dt,Re,T)=>{"use strict";T.d(Re,{Ne:()=>se,Od:()=>ee,Sp:()=>ne,_M:()=>U,mx:()=>$});var x=T(54346),A=T(91558),G=T(84792),Q=T(78498),H=T(23841),re=T(56445);const J="picture-fill",W="simple-fill",Z="simple-marker",le=new Q.Z(1e3);function U(ae){const de=ae.style;let _e=null;if(ae)switch(ae.type){case Z:"cross"!==de&&"x"!==de&&(_e=ae.color);break;case W:"solid"===de?_e=ae.color:"none"!==de&&(_e={type:"pattern",x:0,y:0,src:(0,x.V)(`esri/symbols/patterns/${de}.png`),width:5,height:5});break;case J:_e={type:"pattern",src:ae.url,width:(0,H.F2)(ae.width)*ae.xscale,height:(0,H.F2)(ae.height)*ae.yscale,x:(0,H.F2)(ae.xoffset),y:(0,H.F2)(ae.yoffset)};break;case"text":_e=ae.color;break;case"cim":_e=(0,re.iW)(ae)}return _e}function ee(ae,de){const _e=ae+"-"+de;return void 0!==le.get(_e)?Promise.resolve(le.get(_e)):(0,G.default)(ae,{responseType:"image"}).then(pe=>{const he=pe.data,ge=he.naturalWidth,ye=he.naturalHeight,Me=document.createElement("canvas");Me.width=ge,Me.height=ye;const Ee=Me.getContext("2d");Ee.fillStyle=de,Ee.fillRect(0,0,ge,ye),Ee.globalCompositeOperation="destination-in",Ee.drawImage(he,0,0);const Te=Me.toDataURL();return le.put(_e,Te),Te})}function $(ae){if(!ae)return null;let de;switch(ae.type){case W:case J:case Z:de=$(ae.outline);break;case"simple-line":{const _e=(0,H.F2)(ae.width);"none"!==ae.style&&0!==_e&&(de={color:ae.color,style:ne(ae.style),width:_e,cap:ae.cap,join:"miter"===ae.join?(0,H.F2)(ae.miterLimit):ae.join});break}default:de=null}return de}const ne=(()=>{const ae={};return de=>{if(ae[de])return ae[de];const _e=de.replace(/-/g,"");return ae[de]=_e,_e}})(),se=new A.Z([128,128,128])},9461:(dt,Re,T)=>{"use strict";T.d(Re,{cW:()=>W,im:()=>ue,vX:()=>B});var x=T(20383),A=T(26584),G=T(62208),Q=T(39368),H=T(70137),re=T(12874);const J=["building-scene","integrated-mesh","point-cloud","scene"];function W(ce,oe,le,Y){const j=ie(ce,{},{context:Y,isLabelSymbol:!1});(0,G.pC)(j)&&(oe[le]=j)}function B(ce,oe,le,Y){const j=ie(ce,{},{context:Y,isLabelSymbol:!0});(0,G.pC)(j)&&(oe[le]=j)}function Z(ce){return ce instanceof Q.Z||ce instanceof re.Z}function ie(ce,oe,le){var ee;if((0,G.Wi)(ce))return null;const{context:Y,isLabelSymbol:j}=le,X=null==Y?void 0:Y.origin,U=null==Y?void 0:Y.messages;if("web-scene"===X&&!Z(ce)){const $=(0,H.q)(ce,{retainCIM:!0,hasLabelingContext:j});return(0,G.pC)($.symbol)?$.symbol.write(oe,Y):(null==U||U.push(new A.Z("symbol:unsupported",`Symbols of type '${ce.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:ce,context:Y,error:$.error})),null)}return("web-map"===X||"portal-item"===X&&!J.includes(null==(ee=null==Y?void 0:Y.layer)?void 0:ee.type))&&Z(ce)?(null==U||U.push(new A.Z("symbol:unsupported",`Symbols of type '${ce.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:ce,context:Y})),null):ce.write(oe,Y)}function ue(ce,oe){return(0,x.S9)(ce,null,oe)}},67866:(dt,Re,T)=>{"use strict";T.d(Re,{J:()=>x,k:()=>A});const x=["begin","end","begin-end"],A=["arrow","circle","square","diamond","cross","x"]},60958:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>J,y:()=>W});var x=T(91558),A=T(23841),G=T(90912),Q=T(92236);const J={type:x.Z,json:{type:[G.z8],default:null,read:{source:["color","transparency"],reader:function H(B,Z){const ie=null!=Z.transparency?(0,Q.b)(Z.transparency):1,ue=Z.color;return ue&&Array.isArray(ue)?new x.Z([ue[0]||0,ue[1]||0,ue[2]||0,ie]):null}},write:{target:{color:{type:[G.z8]},transparency:{type:G.z8}},writer:function re(B,Z){Z.color=B.toJSON().slice(0,3);const ie=(0,Q.a)(B.a);0!==ie&&(Z.transparency=ie)}}}},W={type:Number,cast:A.t_,json:{write:!0}}},71131:(dt,Re,T)=>{"use strict";T.d(Re,{DY:()=>Z,EB:()=>W,EV:()=>H,JZ:()=>G,Pc:()=>J,TE:()=>B,XX:()=>ie,b_:()=>A,dc:()=>oe,eb:()=>Q,ht:()=>re,tp:()=>ue,uH:()=>ce});var A,le,x=T(91558);(le=A||(A={}))[le.size=22]="size",le[le.lineWidth=50]="lineWidth",le[le.maxSize=120]="maxSize",le[le.maxOutlineSize=80]="maxOutlineSize",le[le.tallSymbolWidth=20]="tallSymbolWidth";const G={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function Q(le,Y,j){const X=A.size;let U=X,ee=X;le<1?U*=.75:le>1&&(ee*=1.25);let se=X,ae=X;return Y&&j&&(U=ee=se=ae=0),[{type:"path",path:[{command:"M",values:[se,0]},{command:"L",values:[j?se:.875*se,0]},{command:"L",values:[j?U-.5*se:0,ee-.5*ae]},{command:"L",values:[U-.5*se,ee-.5*ae]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[se,0]},{command:"L",values:[se,Y?0:.125*ae]},{command:"L",values:[U-.5*se,Y?ee-.5*ae:ae]},{command:"L",values:[U-.5*se,ee-.5*ae]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[U-.5*se,ee-.5*ae]},{command:"L",values:[j?U-.5*se:0,ee-.5*ae]},{command:"L",values:[j?U-.5*se:0,Y?ee-.5*ae:ae]},{command:"L",values:[U-.5*se,Y?ee-.5*ae:ae]},{command:"Z",values:[]}]}]}function H(le){const Y=A.size,j=.5*le;return[{type:"path",path:[{command:"M",values:[0,.7*Y*.5]},{command:"L",values:[.3*Y,.7*Y]},{command:"L",values:[.3*Y,.7*Y+j]},{command:"L",values:[0,.7*Y+j-.7*Y*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*Y,.7*Y]},{command:"L",values:[.3*Y,.7*Y+j]},{command:"L",values:[Y,j]},{command:"L",values:[Y,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*Y,0]},{command:"L",values:[Y,0]},{command:"L",values:[.3*Y,.7*Y]},{command:"L",values:[0,.7*Y*.5]},{command:"Z",values:[]}]}]}function re(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function J(le,Y){let j=Y?A.tallSymbolWidth:le;const U=Y?4:6;j-=j<=A.size?.5*U:U;const ne=Y?.35*j:.5*j;return[{type:"path",path:[{command:"M",values:[.5*j,0]},{command:"L",values:[j,.5*ne]},{command:"L",values:[.5*j,ne]},{command:"L",values:[0,.5*ne]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*ne]},{command:"L",values:[.5*j,ne]},{command:"L",values:[.5*j,le]},{command:"L",values:[0,le-.5*ne]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*j,ne]},{command:"L",values:[.5*j,le]},{command:"L",values:[j,le-.5*ne]},{command:"L",values:[j,.5*ne]},{command:"Z",values:[]}]}]}function W(le,Y){let j=Y?A.tallSymbolWidth:le;const U=Y?4:6;j-=j<=A.size?.5*U:U;const ee=.5*j,$=.15*j,se=le-$;return[{type:"ellipse",cx:.5*j,cy:se,rx:ee,ry:$},{type:"path",path:[{command:"M",values:[0,$]},{command:"L",values:[0,se]},{command:"L",values:[j,se]},{command:"L",values:[j,$]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*j,cy:$,rx:ee,ry:$}]}function B(le,Y){let j=Y?A.tallSymbolWidth:le;const U=Y?4:6;j-=j<=A.size?.5*U:U;const ee=.15*j,$=le-ee;return[{type:"ellipse",cx:.5*j,cy:$,rx:.5*j,ry:ee},{type:"path",path:[{command:"M",values:[.5*j,0]},{command:"L",values:[j,$]},{command:"L",values:[0,$]},{command:"Z",values:[]}]}]}function Z(le){let Y=le;Y-=Y<A.size?3:6;const U=.15*Y;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[Y,0]},{command:"L",values:[.5*Y,le-U]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*Y,cy:0,rx:.5*Y,ry:U}]}function ie(le){let Y=le;const j=le;Y-=Y<A.size?2:4;const $=Y,ne=j,se=Math.floor(le/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*$,0]},{command:"L",values:[$,.5*ne-se]},{command:"L",values:[.45*$-se,.5*ne+se]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*$,0]},{command:"L",values:[.45*$-se,.5*ne+se]},{command:"L",values:[0,.5*ne-se]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*ne-se]},{command:"L",values:[.45*$-se,.5*ne+se]},{command:"L",values:[.45*$,j]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*$,j]},{command:"L",values:[$,.5*ne-se]},{command:"L",values:[.45*$-se,.5*ne+se]},{command:"Z",values:[]}]}]}function ue(le){let X=le;return X-=X<A.size?1:2,[{type:"path",path:[{command:"M",values:[.45*le,0]},{command:"L",values:[le,X]},{command:"L",values:[.45*le,.6*X]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*le,0]},{command:"L",values:[.45*le,.6*X]},{command:"L",values:[0,X]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,X]},{command:"L",values:[.45*le,.6*X]},{command:"L",values:[le,X]},{command:"Z",values:[]}]}]}function ce(le,Y){return Math.round(Math.min(Math.max(le+255*Y*.75,0),255))}function oe(le,Y){if("type"in le&&("linear"===le.type||"pattern"===le.type))return le;const j=new x.Z(le);return new x.Z([ce(j.r,Y),ce(j.g,Y),ce(j.b,Y),j.a])}},6172:(dt,Re,T)=>{"use strict";T.d(Re,{w:()=>Se,r:()=>qe});var x=T(24263),A=T(84792),G=T(78260),Q=T(26584),H=T(8314),J=(T(50645),T(62996)),W=T(91558),B=T(12225),Z=T(31478),ue=(T(38570),T(94450));let oe=0,le=0;const Y=(0,H.Z)("android"),j=(0,H.Z)("chrome")||Y&&Y>=4?"auto":"optimizeLegibility",X={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},U=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let ee={},$={};const ne={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},se=Math.PI;let ae=1;function de(be,tt){const Ye=be*(se/180);return Math.abs(tt*Math.sin(Ye))+Math.abs(tt*Math.cos(Ye))}function _e(be){return be.map(tt=>`${tt.command} ${tt.values.join(" ")}`).join(" ").trim()}function pe(be,tt,Ye,ze){if(be){if("circle"===be.type)return(0,ue.u)("circle",{fill:tt,"fill-rule":"evenodd",stroke:Ye.color,"stroke-width":Ye.width,"stroke-linecap":Ye.cap,"stroke-linejoin":Ye.join,"stroke-dasharray":Ye.dashArray,"stroke-dashoffset":Ye.dashOffset,"stroke-miterlimit":"4",cx:be.cx,cy:be.cy,r:be.r});if("ellipse"===be.type)return(0,ue.u)("ellipse",{fill:tt,"fill-rule":"evenodd",stroke:Ye.color,"stroke-width":Ye.width,"stroke-linecap":Ye.cap,"stroke-linejoin":Ye.join,"stroke-dasharray":Ye.dashArray,"stroke-miterlimit":"4",cx:be.cx,cy:be.cy,rx:be.rx,ry:be.ry});if("rect"===be.type)return(0,ue.u)("rect",{fill:tt,"fill-rule":"evenodd",stroke:Ye.color,"stroke-width":Ye.width,"stroke-linecap":Ye.cap,"stroke-linejoin":Ye.join,"stroke-dasharray":Ye.dashArray,"stroke-miterlimit":"4",x:be.x,y:be.y,width:be.width,height:be.height});if("image"===be.type)return(0,ue.u)("image",{href:be.src,x:be.x,y:be.y,width:be.width,height:be.height,preserveAspectRatio:"none"});if("path"===be.type){const et="string"!=typeof be.path?_e(be.path):be.path;return(0,ue.u)("path",{fill:tt,"fill-rule":"evenodd",stroke:Ye.color,"stroke-width":Ye.width,"stroke-linecap":Ye.cap,"stroke-linejoin":Ye.join,"stroke-dasharray":Ye.dashArray,"stroke-miterlimit":"4",d:et})}if("text"===be.type)return(0,ue.u)("text",{"alignment-baseline":ze.alignBaseline,fill:tt,"fill-rule":"evenodd",stroke:Ye.color,"stroke-width":Ye.width,"stroke-linecap":Ye.cap,"stroke-linejoin":Ye.join,"stroke-dasharray":Ye.dashArray,"stroke-miterlimit":"4","text-anchor":ze.align,"text-decoration":ze.decoration,kerning:ze.kerning,rotate:ze.rotate,"text-rendering":j,"font-style":ze.font.style,"font-variant":ze.font.variant,"font-weight":ze.font.weight,"font-size":ze.font.size,"font-family":ze.font.family,x:be.x,y:be.y},be.text)}return null}function he(be){const tt={fill:"none",pattern:null,linearGradient:null};if(be)if("type"in be&&"pattern"===be.type){const Ye="patternId-"+ ++oe;tt.fill=`url(#${Ye})`,tt.pattern={id:Ye,x:be.x,y:be.y,width:be.width,height:be.height,image:{x:0,y:0,width:be.width,height:be.height,href:be.src}}}else if("type"in be&&"linear"===be.type){const Ye="linearGradientId-"+ ++le;tt.fill=`url(#${Ye})`,tt.linearGradient={id:Ye,x1:be.x1,y1:be.y1,x2:be.x2,y2:be.y2,stops:be.colors.map(ze=>({offset:ze.offset,color:ze.color&&new W.Z(ze.color).toString()}))}}else if(be){const Ye=new W.Z(be);tt.fill=Ye.toString()}return tt}function ge(be){const tt={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(be&&(null!=be.width&&(tt.width=be.width),be.cap&&(tt.cap=be.cap),be.join&&(tt.join=be.join.toString()),be.color&&(tt.color=new W.Z(be.color).toString()),be.dashArray&&(tt.dashArray=be.dashArray),be.dashArray&&(tt.dashOffset=be.dashoffset),be.style)){let Ye=null;if(be.style in ne&&(Ye=ne[be.style]),Array.isArray(Ye)){Ye=Ye.slice(0);for(let ze=0;ze<Ye.length;++ze)Ye[ze]*=be.width;if("butt"!==be.cap){for(let ze=0;ze<Ye.length;ze+=2)Ye[ze]-=be.width,Ye[ze]<1&&(Ye[ze]=1);for(let ze=1;ze<Ye.length;ze+=2)Ye[ze]+=be.width}Ye=Ye.join(",")}tt.dashArray=Ye}return tt}function ye(be,tt){const Ye={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};return be&&(Ye.align=be.align,Ye.alignBaseline=be.alignBaseline,Ye.decoration=be.decoration,Ye.kerning=be.kerning?"auto":"0",Ye.rotate=be.rotated?"90":"0",Ye.font.style=tt.style||"normal",Ye.font.variant=tt.variant||"normal",Ye.font.weight=tt.weight||"normal",Ye.font.size=tt.size&&tt.size.toString()||"10pt",Ye.font.family=tt.family||"serif"),Ye}function Me(be){const{pattern:tt,linearGradient:Ye}=be;if(tt)return(0,ue.u)("pattern",{id:tt.id,patternUnits:"userSpaceOnUse",x:tt.x,y:tt.y,width:tt.width,height:tt.height},(0,ue.u)("image",{x:tt.image.x,y:tt.image.y,width:tt.image.width,height:tt.image.height,href:tt.image.href}));if(Ye){const ze=Ye.stops.map((et,ke)=>(0,ue.u)("stop",{key:`${ke}-stop`,offset:et.offset,"stop-color":et.color}));return(0,ue.u)("linearGradient",{id:Ye.id,gradientUnits:"userSpaceOnUse",x1:Ye.x1,y1:Ye.y1,x2:Ye.x2,y2:Ye.y2},ze)}return null}function Ee(be,tt){if(!be)return null;const Ye=[];for(const ze of be){const{shape:et,fill:ke,stroke:ot,font:at}=ze,yt=he(ke),wt=ge(ot),zt="text"===et.type?ye(et,at):null;Ye.push(pe(et,yt.fill,wt,zt))}return(0,ue.u)("mask",{id:tt,maskUnits:"userSpaceOnUse"},(0,ue.u)("g",null,Ye))}function Te(be,tt,Ye){return(0,Z.t)(be,(0,Z.i)(be),[tt,Ye])}function me(be,tt,Ye,ze,et){return(0,Z.s)(be,(0,Z.i)(be),[tt,Ye]),be[4]=be[4]*tt-ze*tt+ze,be[5]=be[5]*Ye-et*Ye+et,be}function Ie(be,tt){ee&&"left"in ee?(ee.left>be&&(ee.left=be),ee.right<be&&(ee.right=be),ee.top>tt&&(ee.top=tt),ee.bottom<tt&&(ee.bottom=tt)):ee={left:be,bottom:tt,right:be,top:tt}}function Ge(be){const tt=be.args,Ye=tt.length;let ze;switch(be.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(ze=0;ze<Ye;ze+=2)Ie(tt[ze],tt[ze+1]);$.x=tt[Ye-2],$.y=tt[Ye-1];break;case"H":for(ze=0;ze<Ye;++ze)Ie(tt[ze],$.y);$.x=tt[Ye-1];break;case"V":for(ze=0;ze<Ye;++ze)Ie($.x,tt[ze]);$.y=tt[Ye-1];break;case"m":{let et=0;for(("x"in $||(Ie($.x=tt[0],$.y=tt[1]),et=2),ze=et);ze<Ye;ze+=2)Ie($.x+=tt[ze],$.y+=tt[ze+1]);break}case"l":case"t":for(ze=0;ze<Ye;ze+=2)Ie($.x+=tt[ze],$.y+=tt[ze+1]);break;case"h":for(ze=0;ze<Ye;++ze)Ie($.x+=tt[ze],$.y);break;case"v":for(ze=0;ze<Ye;++ze)Ie($.x,$.y+=tt[ze]);break;case"c":for(ze=0;ze<Ye;ze+=6)Ie($.x+tt[ze],$.y+tt[ze+1]),Ie($.x+tt[ze+2],$.y+tt[ze+3]),Ie($.x+=tt[ze+4],$.y+=tt[ze+5]);break;case"s":case"q":for(ze=0;ze<Ye;ze+=4)Ie($.x+tt[ze],$.y+tt[ze+1]),Ie($.x+=tt[ze+2],$.y+=tt[ze+3]);break;case"A":for(ze=0;ze<Ye;ze+=7)Ie(tt[ze+5],tt[ze+6]);$.x=tt[Ye-2],$.y=tt[Ye-1];break;case"a":for(ze=0;ze<Ye;ze+=7)Ie($.x+=tt[ze+5],$.y+=tt[ze+6])}}function Je(be,tt,Ye){const ze=X[be.toLowerCase()];let et;"number"==typeof ze&&(ze?tt.length>=ze&&(et={action:be,args:tt.slice(0,tt.length-tt.length%ze)},Ye.push(et),Ge(et)):(et={action:be,args:[]},Ye.push(et),Ge(et)))}function je(be){const tt={x:0,y:0,width:0,height:0};if("circle"===be.type)tt.x=be.cx-be.r,tt.y=be.cy-be.r,tt.width=2*be.r,tt.height=2*be.r;else if("ellipse"===be.type)tt.x=be.cx-be.rx,tt.y=be.cy-be.ry,tt.width=2*be.rx,tt.height=2*be.ry;else if("image"===be.type||"rect"===be.type)tt.x=be.x,tt.y=be.y,tt.width=be.width,tt.height=be.height;else if("path"===be.type){const Ye=function xe(be){const tt=("string"!=typeof be.path?_e(be.path):be.path).match(U),Ye=[];if(ee={},$={},!tt)return null;let ze="",et=[];const ke=tt.length;for(let at=0;at<ke;++at){const yt=tt[at],wt=parseFloat(yt);isNaN(wt)?(ze&&Je(ze,et,Ye),et=[],ze=yt):et.push(wt)}Je(ze,et,Ye);const ot={x:0,y:0,width:0,height:0};return ee&&"left"in ee&&(ot.x=ee.left,ot.y=ee.top,ot.width=ee.right-ee.left,ot.height=ee.bottom-ee.top),ot}(be);tt.x=Ye.x,tt.y=Ye.y,tt.width=Ye.width,tt.height=Ye.height}return tt}function We(be){const tt={x:0,y:0,width:0,height:0};let Ye=null,ze=Number.NEGATIVE_INFINITY,et=Number.NEGATIVE_INFINITY;for(const ke of be)Ye?(Ye.x=Math.min(Ye.x,ke.x),Ye.y=Math.min(Ye.y,ke.y),ze=Math.max(ze,ke.x+ke.width),et=Math.max(et,ke.y+ke.height)):(Ye=tt,Ye.x=ke.x,Ye.y=ke.y,ze=ke.x+ke.width,et=ke.y+ke.height);return Ye&&(Ye.width=ze-Ye.x,Ye.height=et-Ye.y),Ye}function Ne(be,tt,Ye,ze,et,ke,ot,at,yt){let wt=(ot&&ke?de(ke,tt):tt)/2,zt=(ot&&ke?de(ke,Ye):Ye)/2;if(yt){const Yr=yt[0],Lr=yt[1];wt=(ot&&ke?de(ke,Yr):Yr)/2,zt=(ot&&ke?de(ke,Lr):Lr)/2}const Rt=be.width+ze,Ft=be.height+ze,bt=(0,B.c)(),St=(0,B.c)();let Xt=!1;if(et&&0!==Rt&&0!==Ft){const Yr=tt!==Ye?tt/Ye:Rt/Ft,Lr=tt>Ye?tt:Ye;let ct=1,jt=1;isNaN(Lr)||(Yr>1?(ct=Lr/Rt,jt=Lr/Yr/Ft):(jt=Lr/Ft,ct=Lr*Yr/Rt)),(0,Z.m)(St,St,me(bt,ct,jt,wt,zt)),Xt=!0}const Mr=be.x+(Rt-ze)/2,Cr=be.y+(Ft-ze)/2;if((0,Z.m)(St,St,Te(bt,wt-Mr,zt-Cr)),!Xt&&(Rt>tt||Ft>Ye)){const Yr=Rt/tt>Ft/Ye,Lr=(Yr?tt:Ye)/(Yr?Rt:Ft);(0,Z.m)(St,St,me(bt,Lr,Lr,Mr,Cr))}return ke&&(0,Z.m)(St,St,function Ce(be,tt,Ye,ze){const et=tt%360*Math.PI/180;(0,Z.r)(be,(0,Z.i)(be),et);const ke=Math.cos(et),ot=Math.sin(et),at=be[4],yt=be[5];return be[4]=at*ke-yt*ot+ze*ot-Ye*ke+Ye,be[5]=yt*ke+at*ot-Ye*ot-ze*ke+ze,be}(bt,ke,Mr,Cr)),at&&(0,Z.m)(St,St,Te(bt,at[0],at[1])),`matrix(${St[0]},${St[1]},${St[2]},${St[3]},${St[4]},${St[5]})`}function Oe(be,tt,Ye,ze={}){var wt;const et=[],ke=[],ot=++ae,at=function we(be,tt,Ye){const ze=null==be?void 0:be.effects.find(wt=>"bloom"===wt.type);if(!ze)return null;const{strength:et,radius:ke}=ze,ot=et>0?ke:0,at=(et+ot)*tt,yt=4*et+1;return(0,ue.u)("filter",{id:`bloom${Ye}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},(0,ue.u)("feMorphology",{operator:"dilate",radius:(et+.5*ot)*(5**(tt/100)*(.4+tt/100)),in:"SourceGraphic",result:"dilate"}),(0,ue.u)("feGaussianBlur",{in:"dilate",stdDeviation:at/25,result:"blur"}),(0,ue.u)("feGaussianBlur",{in:"blur",stdDeviation:at/50,result:"intensityBlur"}),(0,ue.u)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,ue.u)("feFuncR",{type:"linear",slope:yt}),(0,ue.u)("feFuncG",{type:"linear",slope:yt}),(0,ue.u)("feFuncB",{type:"linear",slope:yt})),(0,ue.u)("feMerge",null,(0,ue.u)("feMergeNode",{in:"intensityBlur"}),(0,ue.u)("feMergeNode",{in:"intensityBrightness"}),(0,ue.u)("feGaussianBlur",{stdDeviation:et/10})))}(ze.effectView,tt,ot);let yt=null;if(at){const zt=null==(wt=ze.effectView)?void 0:wt.effects.find(St=>"bloom"===St.type),Rt=(zt.strength?zt.strength+zt.radius/2:0)/3,bt=Ye+Ye*Rt;yt=[Math.max(tt+tt*Rt,10),Math.max(bt,10)]}for(let zt=0;zt<be.length;zt++){const Rt=be[zt],Ft=[],bt=[];let St=0,Xt=0,Mr=0;for(const Lr of Rt){const{shape:ct,fill:jt,stroke:qt,font:er,offset:Zt}=Lr;ze.ignoreStrokeWidth||(St+=qt&&qt.width||0);const tr=he(jt),ir=ge(qt),fr="text"===ct.type?ye(ct,er):null;et.push(Me(tr)),Ft.push(pe(ct,tr.fill,ir,fr)),bt.push(je(ct)),Zt&&(Xt+=Zt[0],Mr+=Zt[1])}const Cr=Ne(We(bt),tt,Ye,St,ze.scale,ze.rotation,ze.useRotationSize,[Xt,Mr],yt);let Yr=null;if(ze.masking){const Lr=`mask-${zt}`;et.push(Ee(ze.masking[zt],Lr)),Yr=`url(#${Lr})`}ke.push(Yr?(0,ue.u)("g",{mask:Yr},(0,ue.u)("g",{transform:Cr},Ft)):(0,ue.u)("g",{transform:Cr},Ft))}return ze.useRotationSize&&ze.rotation&&(tt=de(ze.rotation,tt),Ye=de(ze.rotation,Ye)),at&&(tt=yt[0],Ye=yt[1]),(0,ue.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:tt,height:Ye,style:"display: block;"},at,(0,ue.u)("defs",null,et),at?(0,ue.u)("g",{filter:`url(#bloom${ot})`},ke):ke)}var $e=T(86606);const Be=(0,J.E)();function Se(be,tt,Ye){const ze=Math.ceil(tt[0]),et=Math.ceil(tt[1]);if(!be.some(ot=>!!ot.length))return null;const ke=Ye&&Ye.node||document.createElement("div");return null!=Ye.opacity&&(ke.style.opacity=Ye.opacity.toString()),null!=Ye.effectView&&(ke.style.filter=(0,$e.wJ)(Ye.effectView)),Be.append(ke,Oe.bind(null,be,ze,et,Ye)),ke}function Ke(be,tt,Ye,ze,et){switch(et){case"multiply":be[tt+0]*=Ye[0],be[tt+1]*=Ye[1],be[tt+2]*=Ye[2],be[tt+3]*=Ye[3];break;default:{const ke=(0,G._Y)({r:be[tt+0],g:be[tt+1],b:be[tt+2]});ke.h=ze.h,ke.s=ze.s,ke.v=ke.v/100*ze.v;const ot=(0,G.xr)(ke);be[tt+0]=ot.r,be[tt+1]=ot.g,be[tt+2]=ot.b,be[tt+3]*=Ye[3];break}}}function qe(be,tt,Ye,ze,et){return function Fe(be,tt,Ye){return be?(0,A.default)(be,{responseType:"image"}).then(ze=>{const et=ze.data,ke=et.width,ot=et.height,at=ke/ot;let yt=tt;if(Ye){const wt=Math.max(ke,ot);yt=Math.min(yt,wt)}return{image:et,width:at<=1?Math.ceil(yt*at):yt,height:at<=1?yt:Math.ceil(yt/at)}}):Promise.reject(new Q.Z("renderUtils: imageDataSize","href not provided."))}(be,tt,et).then(ke=>{const ot=ke.width?ke.width:tt,at=ke.height?ke.height:tt;if(ke.image&&function ve(be,tt){return!(!be||"ignore"===tt||"multiply"===tt&&255===be.r&&255===be.g&&255===be.b&&1===be.a)}(Ye,ze)){let yt=ke.image.width,wt=ke.image.height;(0,H.Z)("edge")&&/\.svg$/i.test(be)&&(yt-=1,wt-=1);const zt=function De(be,tt){be=Math.ceil(be),tt=Math.ceil(tt);const Ye=document.createElement("canvas");Ye.width=be,Ye.height=tt,Ye.style.width=be+"px",Ye.style.height=tt+"px";const ze=Ye.getContext("2d");return ze.clearRect(0,0,be,tt),ze}(ot,at);zt.drawImage(ke.image,0,0,yt,wt,0,0,ot,at);const Rt=zt.getImageData(0,0,ot,at),Ft=[Ye.r/255,Ye.g/255,Ye.b/255,Ye.a],bt=(0,G._Y)(Ye);for(let St=0;St<Rt.data.length;St+=4)Ke(Rt.data,St,Ft,bt,ze);zt.putImageData(Rt,0,0),be=zt.canvas.toDataURL("image/png")}else{const yt=x.id&&x.id.findCredential(be);if(yt&&yt.token){const wt=be.includes("?")?"&":"?";be=`${be}${wt}token=${yt.token}`}}return{url:be,width:ot,height:at}}).catch(()=>({url:be,width:tt,height:tt}))}},71937:(dt,Re,T)=>{"use strict";T.d(Re,{EJ:()=>U,KV:()=>Y,n2:()=>le,v9:()=>j,wm:()=>ne});var x=T(15861),A=T(84792),G=T(26584),Q=T(62208),H=T(10699),re=T(21726),J=T(84687),W=T(6278),B=T(35560);const Z={};function ue(){return(ue=(0,x.Z)(function*(se,ae){try{return{data:(yield U(se,ae)).data,baseUrl:(0,re.Yd)(se),styleUrl:se}}catch(de){return(0,H.r9)(de),null}})).apply(this,arguments)}function le(se,ae,de){return se.styleUrl?function ie(se,ae){return ue.apply(this,arguments)}(se.styleUrl,de):se.styleName?function ce(se,ae,de){const _e=(0,Q.pC)(ae.portal)?ae.portal:J.Z.getDefault();let pe;const he=`${_e.url} - ${_e.user&&_e.user.username} - ${se}`;return Z[he]||(Z[he]=function oe(se,ae,de){return ae.load(de).then(()=>{const _e=new W.Z({disableExtraQuery:!0,query:`owner:${ee} AND type:${$} AND typekeywords:"${se}"`});return ae.queryItems(_e,de)}).then(({results:_e})=>{let pe=null;const he=se.toLowerCase();if(_e&&Array.isArray(_e))for(const ge of _e)if(ge.typeKeywords.some(ye=>ye.toLowerCase()===he)&&ge.type===$&&ge.owner===ee){pe=ge;break}if(!pe)throw new G.Z("symbolstyleutils:style-not-found",`The style '${se}' could not be found`,{styleName:se});return pe.load(de)})}(se,_e,de).then(ge=>(pe=ge,ge.fetchData())).then(ge=>({data:ge,baseUrl:pe.itemUrl,styleName:se}))),Z[he]}(se.styleName,ae,de):Promise.reject(new G.Z("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function Y(se){return null===se||"CIMSymbolReference"===se.type?se:{type:"CIMSymbolReference",symbol:se}}function j(se,ae){if("cimRef"===ae)return se.cimRef;if(se.formatInfos&&!(0,B.K)())for(const de of se.formatInfos)if("gltf"===de.type)return de.href;return se.webRef}function U(se,ae){const de=or({responseType:"json",query:{f:"json"}},ae);return(0,A.default)((0,re.Fv)(se),de)}const ee="esri_en",$="Style",ne="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json"},70137:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>oe});var x=T(20383),A=T(26584),G=T(12874),Q=T(69852),H=T(52068),re=T(40445),J=T(57213),W=T(13546),B=T(88493),Z=T(89673),ie=T(35540),ue=T(22490);const ce={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function oe(le,Y=ce){var ne,se;if(!le)return{symbol:null};const{retainId:j=ce.retainId,ignoreDrivers:X=ce.ignoreDrivers,hasLabelingContext:U=ce.hasLabelingContext,retainCIM:ee=ce.retainCIM}=Y;let $;if((0,x.dU)(le)||le instanceof G.Z)$=le.clone();else if("cim"===le.type){const ae=null==(se=null==(ne=le.data)?void 0:ne.symbol)?void 0:se.type;if("CIMPointSymbol"!==ae)return{error:new A.Z("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${ae||"unknown"}' is unsupported in 3D`,{symbol:le})};$=ee?le.clone():Q.Z.fromCIMSymbol(le)}else if(le instanceof H.Z)$=re.Z.fromSimpleLineSymbol(le);else if(le instanceof J.Z)$=Q.Z.fromSimpleMarkerSymbol(le);else if(le instanceof W.Z)$=Q.Z.fromPictureMarkerSymbol(le);else if(le instanceof B.Z)$=Z.Z.fromSimpleFillSymbol(le);else{if(!(le instanceof ie.Z))return{error:new A.Z("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${le.type||le.declaredClass}' is unsupported in 3D`,{symbol:le})};$=U?ue.Z.fromTextSymbol(le):Q.Z.fromTextSymbol(le)}if(j&&"cim"!==$.type&&($.id=le.id),X&&(0,x.dU)($))for(let ae=0;ae<$.symbolLayers.length;++ae)$.symbolLayers.getItemAt(ae)._ignoreDrivers=!0;return{symbol:$}}},43652:(dt,Re,T)=>{"use strict";T.d(Re,{$K:()=>Q,Hc:()=>B,KW:()=>Z,Uz:()=>W,w2:()=>ie}),T(8314);var A=T(28093),G=T(5548);function Q(ue,{isPrimitive:ce,width:oe,depth:le,height:Y}){const j=ce?10:1;if(null==oe&&null==Y&&null==le)return[j*ue[0],j*ue[1],j*ue[2]];const X=(0,A.f)(oe,le,Y);let U;for(let ee=0;ee<3;ee++){const $=X[ee];if(null!=$){U=$/ue[ee];break}}for(let ee=0;ee<3;ee++)null==X[ee]&&(X[ee]=ue[ee]*U);return X}const H=(0,G.al)(-.5,-.5,-.5,.5,.5,.5),re=(0,G.al)(-.5,-.5,0,.5,.5,1),J=(0,G.al)(-.5,-.5,0,.5,.5,.5);function W(ue){switch(ue){case"sphere":case"cube":case"diamond":return H;case"cylinder":case"cone":case"inverted-cone":return re;case"tetrahedron":return J;default:return}}const B=["butt","square","round"],Z=[...B,"none"],ie=["miter","bevel","round"]},50369:(dt,Re,T)=>{"use strict";T.d(Re,{Ck:()=>re,JT:()=>G,Nj:()=>Z,g6:()=>Q,vC:()=>H,x0:()=>B});var x=T(21286),A=T(90912);const G=["none","underline","line-through"],Q=["normal","italic","oblique"],H=["normal","lighter","bold","bolder"],re={type:Number,cast:ie=>{const ue=(0,A.q9)(ie);return 0===ue?1:(0,x.uZ)(ue,.1,4)},nonNullable:!0},B={type:["left","right","center"],nonNullable:!0},Z={type:["baseline","top","middle","bottom"],nonNullable:!0}},29505:(dt,Re,T)=>{"use strict";T.d(Re,{Z7:()=>G,f9:()=>H,lt:()=>A});var x=T(21254);function A(re){return null!=x.a[re]}function G(re){return 1/(x.a[re]||1)}const H=function Q(){const re=Object.keys(x.a);return re.sort(),re}()},69738:(dt,Re,T)=>{"use strict";T.d(Re,{Ds:()=>J,KA:()=>re});var x=T(21726),A=T(29840);function Q(B,Z){return function W(B){return B&&("service"===B.origin||"portal-item"===B.origin)&&B.layer&&("feature"===B.layer.type||"stream"===B.layer.type)}(Z)&&!(0,x.YP)(B)&&Z.layer.parsedUrl?(0,x.v_)(Z.layer.parsedUrl.path,"images",B):(0,A.f)(B,Z)}const re={json:{read:{source:["imageData","url"],reader:function G(B,Z,ie){return Z.imageData?(0,x._l)({mediaType:Z.contentType||"image/png",isBase64:!0,data:Z.imageData}):Q(Z.url,ie)}},write:{writer(B,Z,ie,ue){!function H(B,Z,ie,ue){if((0,x.HK)(B)){const ce=(0,x.sJ)(B);Z.contentType=ce.mediaType,Z.imageData=ce.data,ie&&ie.imageData===Z.imageData&&ie.url&&(0,A.w)(ie.url,Z,"url",ue)}else(0,A.w)(B,Z,"url",ue)}(B,Z,this.source,ue)}}}},J={readOnly:!0,json:{read:{source:["imageData","url"],reader(B,Z,ie){const ue={};return Z.imageData&&(ue.imageData=Z.imageData),Z.contentType&&(ue.contentType=Z.contentType),Z.url&&(ue.url=Q(Z.url,ie)),ue}}}}},86606:(dt,Re,T)=>{"use strict";T.d(Re,{BR:()=>je,YW:()=>le,_h:()=>j,e3:()=>Je,nf:()=>Y,tb:()=>ne,wJ:()=>We});var x=T(15861),A=T(91558),G=T(20383),Q=T(59213),H=T(8314),re=T(62208),J=T(28093),W=T(12818),Z=(T(74741),T(64830));const ie=/\/resource\/(.*?)\.svg$/,ue=new A.Z("white");function le(Ne){if((0,re.Wi)(Ne)||!("symbolLayers"in Ne)||(0,re.Wi)(Ne.symbolLayers))return!1;switch(Ne.type){case"point-3d":return Ne.symbolLayers.some(we=>"object"===we.type);case"line-3d":return Ne.symbolLayers.some(we=>"path"===we.type);case"polygon-3d":return Ne.symbolLayers.some(we=>"object"===we.type||"extrude"===we.type);default:return!1}}function Y(Ne,we){const Oe=we.resource.href;return!(0,H.Z)("esri-canvas-svg-support")&&Ne.styleOrigin&&ie.test(Oe)?Oe.replace(ie,"/resource/png/$1.png"):Oe}function j(Ne,we){if(!Ne)return null;let Oe=null;return(0,G.dU)(Ne)?Oe=function X(Ne){const we=Ne.symbolLayers;if(!we)return null;let Oe=null;return we.forEach($e=>{"object"===$e.type&&null!=$e.resource.href||(Oe="water"===$e.type?(0,re.Wg)($e.color):(0,re.pC)($e.material)?(0,re.Wg)($e.material.color):null)}),Oe?new A.Z(Oe):null}(Ne):(0,G.cT)(Ne)&&(Oe=Ne.color?new A.Z(Ne.color):null),Oe?U(Oe,we):null}function U(Ne,we){if(null==we)return Ne;const Oe=Ne.toRgba();return Oe[3]=Oe[3]*we,new A.Z(Oe)}function ne(Ne,we,Oe){Ne&&(we||null!=Oe)&&(we&&(we=new A.Z(we)),(0,G.dU)(Ne)?function ee(Ne,we,Oe){const $e=Ne.symbolLayers;if(!$e)return;const Be=Se=>{const De=(0,re.pC)(Se)?Se:null;return U(we=we||De||null!=Oe&&ue,Oe)};$e.forEach(Se=>{if("object"!==Se.type||null==Se.resource.href||we)if("water"===Se.type)Se.color=Be(Se.color);else{const De=(0,re.pC)(Se.material)?Se.material.color:null,Fe=Be(De);(0,re.Wi)(Se.material)?Se.material=new Z.b({color:Fe}):Se.material.color=Fe,null!=Oe&&"outline"in Se&&(0,re.pC)(Se.outline)&&(0,re.pC)(Se.outline.color)&&(Se.outline.color=U(Se.outline.color,Oe))}})}(Ne,we,Oe):(0,G.cT)(Ne)&&function $(Ne,we,Oe){(we=we||Ne.color)&&(Ne.color=U(we,Oe)),null!=Oe&&"outline"in Ne&&Ne.outline&&Ne.outline.color&&(Ne.outline.color=U(Ne.outline.color,Oe))}(Ne,we,Oe))}function se(Ne,we){return ae.apply(this,arguments)}function ae(){return ae=(0,x.Z)(function*(Ne,we){const Oe=Ne.symbolLayers;Oe&&(yield(0,Q.Ed)(Oe,function(){var $e=(0,x.Z)(function*(Be){return de(Be,we)});return function(Be){return $e.apply(this,arguments)}}()))}),ae.apply(this,arguments)}function de(Ne,we){return _e.apply(this,arguments)}function _e(){return(_e=(0,x.Z)(function*(Ne,we){switch(Ne.type){case"extrude":ge(Ne,we);break;case"icon":case"line":case"text":pe(Ne,we);break;case"path":Ee(Ne,we);break;case"object":yield ye(Ne,we)}})).apply(this,arguments)}function pe(Ne,we){const Oe=he(we);(0,re.pC)(Oe)&&(Ne.size=Oe)}function he(Ne){for(const we of Ne)if("number"==typeof we)return we;return null}function ge(Ne,we){Ne.size="number"==typeof we[2]?we[2]:0}function ye(Ne,we){return Me.apply(this,arguments)}function Me(){return(Me=(0,x.Z)(function*(Ne,we){const{resourceSize:Oe,symbolSize:$e}=yield me(Ne),Be=Te(we,Oe,$e);Ne.width=Ie(we[0],$e[0],Oe[0],Be),Ne.depth=Ie(we[1],$e[1],Oe[1],Be),Ne.height=Ie(we[2],$e[2],Oe[2],Be)})).apply(this,arguments)}function Ee(Ne,we){const Oe=Te(we,J.O,[Ne.width,void 0,Ne.height]);Ne.width=Ie(we[0],Ne.width,1,Oe),Ne.height=Ie(we[2],Ne.height,1,Oe)}function Te(Ne,we,Oe){for(let $e=0;$e<3;$e++){const Be=Ne[$e];switch(Be){case"symbol-value":return null!=Oe[$e]?Oe[$e]/we[$e]:1;case"proportional":break;default:if(Be&&we[$e])return Be/we[$e]}}return 1}function me(Ne){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,x.Z)(function*(Ne){const we=yield T.e(1831).then(T.bind(T,91831)),Oe=yield we.computeObjectLayerResourceSize(Ne,10),{width:$e,height:Be,depth:Se}=Ne,De=[$e,Se,Be];let Fe=1;for(let ve=0;ve<3;ve++)if(null!=De[ve]){Fe=De[ve]/Oe[ve];break}for(let ve=0;ve<3;ve++)null==De[ve]&&(De[ve]=Oe[ve]*Fe);return{resourceSize:Oe,symbolSize:De}})).apply(this,arguments)}function Ie(Ne,we,Oe,$e){switch(Ne){case"proportional":return Oe*$e;case"symbol-value":return null!=we?we:Oe;default:return Ne}}function Ge(Ne,we){const Oe=he(we);if(!(0,re.Wi)(Oe))switch(Ne.type){case"simple-marker":Ne.size=Oe;break;case"picture-marker":{const $e=Ne.width/Ne.height;$e>1?(Ne.width=Oe,Ne.height=Oe*$e):(Ne.width=Oe*$e,Ne.height=Oe);break}case"simple-line":Ne.width=Oe;break;case"text":Ne.font.size=Oe}}function Je(Ne,we){return xe.apply(this,arguments)}function xe(){return(xe=(0,x.Z)(function*(Ne,we){if(Ne&&we)return(0,G.dU)(Ne)?se(Ne,we):void((0,G.cT)(Ne)&&Ge(Ne,we))})).apply(this,arguments)}function je(Ne,we,Oe){if(Ne&&null!=we)if((0,G.dU)(Ne)){const $e=Ne.symbolLayers;$e&&$e.forEach(Be=>{if(Be&&"object"===Be.type)switch(Oe){case"tilt":Be.tilt=we;break;case"roll":Be.roll=we;break;default:Be.heading=we}})}else(0,G.cT)(Ne)&&("simple-marker"!==Ne.type&&"picture-marker"!==Ne.type&&"text"!==Ne.type||(Ne.angle=we))}function We(Ne){if(!Ne)return null;const we=Ne.effects.filter(Oe=>"bloom"!==Oe.type).map(Oe=>Oe.toJSON());return(0,W.rM)(we)}},39236:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Q});var x=T(26584),A=T(63290),G=T(7848);function Q(W,B,Z,ie,ue){const ce=W.referencesGeometry()&&ue?function re(W,B,Z){const{transform:ie,hasZ:ue,hasM:ce}=Z;H.has(B)||H.set(B,function J(W){const B={};switch(W){case"esriGeometryPoint":return(Z,ie,ue,ce)=>(0,G.U1)(ie,B,Z,ue,ce);case"esriGeometryPolygon":return(Z,ie,ue,ce)=>(0,G.Ie)(ie,B,Z,ue,ce);case"esriGeometryPolyline":return(Z,ie,ue,ce)=>(0,G.G6)(ie,B,Z,ue,ce);case"esriGeometryMultipoint":return(Z,ie,ue,ce)=>(0,G.J9)(ie,B,Z,ue,ce);default:return A.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new x.Z("mapview-arcade",`Unable to handle geometryType: ${W}`)),Z=>Z}}(B));const oe=H.get(B)(W.geometry,ie,ue,ce);return yi(or({},W),{geometry:oe})}(B,ie,ue):B,oe=W.repurposeFeature(ce);try{return W.evaluate(yi(or({},Z),{$feature:oe}))}catch(le){return A.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",le),null}}const H=new Map},57477:(dt,Re,T)=>{"use strict";T.d(Re,{s:()=>re});var x=T(61885),A=T(8314),G=T(62208),Q=T(10699);const H=1/(0,A.Z)("mapview-transitions-duration");class re extends x.Z{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(W){this._clips=W,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(W){this._opacity!==W&&(this._opacity=Math.min(1,Math.max(W,0)),this.requestRender())}get stage(){return this._stage}set stage(W){if(this._stage===W)return;const B=this._stage;this._stage=W,W?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):B.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return(0,G.Wi)(this._transforms)&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(W){this._visible!==W&&(this._visible=W,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=(0,Q.hh)(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=(0,Q.hh)(),this.requestRender()),this._fadeOutResolver.promise}beforeRender(W){this.updateTransitionProperties(W.deltaTime,W.state.scale)}afterRender(W){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var W;null==(W=this.parent)||W.removeChild(this)}setTransform(W){}processRender(W){this.stage&&this.computedVisible&&this.doRender(W)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(W,B){if(this.fadeTransitionEnabled){const Z=this._fadeOutResolver||!this.visible?0:this.opacity,ie=this.computedOpacity;if(ie===Z)this.computedVisible=this.visible;else{const ue=W*H;this.computedOpacity=ie>Z?Math.max(Z,ie-ue):Math.min(Z,ie+ue),this.computedVisible=this.computedOpacity>0;const ce=Z===this.computedOpacity;this.inFadeTransition=!ce,ce||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(W){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}},62449:(dt,Re,T)=>{"use strict";var x,A,G;T.d(Re,{H:()=>A,U:()=>x}),(G=x||(x={}))[G.Stretch=0]="Stretch",G[G.Lut=1]="Lut",G[G.Hillshade=2]="Hillshade",G[G.COUNT=3]="COUNT",function(G){G[G.Noop=0]="Noop",G[G.PerBand=1]="PerBand",G[G.COUNT=2]="COUNT"}(A||(A={}))},21410:(dt,Re,T)=>{"use strict";T.d(Re,{i:()=>X,K:()=>ee});var x=T(62208),A=T(30217),G=T(49966),Q=T(919),H=T(76763),re=T(83994),J=T(67969),W=T(49353);class B{constructor(ne,se){this.layerUIDs=[],this.isDestroyed=!1,this.data=ne,this.memoryUsed=ne.byteLength;let ae=1;const de=new Uint32Array(ne);this.layerUIDs=[];const _e=de[ae++];for(let pe=0;pe<_e;pe++)this.layerUIDs[pe]=de[ae++];this.bufferDataOffset=ae,se&&(this.layer=se.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return(0,x.Wi)(this.data)}get offset(){return this.bufferDataOffset}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(ne){(0,x.Wi)(this.data)||(this.doPrepareForRendering(ne,this.data,this.bufferDataOffset),this.data=null)}}class Z extends B{constructor(ne,se){super(ne,se),this.type=Q.al.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const ae=new Uint32Array(ne);let de=this.bufferDataOffset;this.lineIndexStart=ae[de++],this.lineIndexCount=ae[de++];const _e=ae[de++];if(_e>0){const pe=new Map;for(let he=0;he<_e;he++){const ge=ae[de++],ye=ae[de++],Me=ae[de++];pe.set(ge,[ye,Me])}this.patternMap=pe}this.bufferDataOffset=de}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){(0,x.pC)(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose(),(0,x.pC)(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose(),(0,x.pC)(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose(),this.lineVertexArrayObject=null,this.lineVertexBuffer=null,this.lineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(ne,se,ae){const de=new Uint32Array(se),_e=new Int32Array(de.buffer),pe=de[ae++];this.lineVertexBuffer=re.f.createVertex(ne,J.l1.STATIC_DRAW,new Int32Array(_e.buffer,4*ae,pe)),ae+=pe;const he=de[ae++];this.lineIndexBuffer=re.f.createIndex(ne,J.l1.STATIC_DRAW,new Uint32Array(de.buffer,4*ae,he)),ae+=he;const ge=this.layer.lineMaterial;this.lineVertexArrayObject=new W.U(ne,ge.getAttributeLocations(),ge.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)}}class ie extends B{constructor(ne,se){super(ne,se),this.type=Q.al.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const ae=new Uint32Array(ne);let de=this.bufferDataOffset;this.fillIndexStart=ae[de++],this.fillIndexCount=ae[de++],this.outlineIndexStart=ae[de++],this.outlineIndexCount=ae[de++];const _e=ae[de++];if(_e>0){const pe=new Map;for(let he=0;he<_e;he++){const ge=ae[de++],ye=ae[de++],Me=ae[de++];pe.set(ge,[ye,Me])}this.patternMap=pe}this.bufferDataOffset=de}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){(0,x.pC)(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose(),(0,x.pC)(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose(),(0,x.pC)(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose(),this.fillVertexArrayObject=null,this.fillVertexBuffer=null,this.fillIndexBuffer=null,(0,x.pC)(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose(),(0,x.pC)(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose(),(0,x.pC)(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose(),this.outlineVertexArrayObject=null,this.outlineVertexBuffer=null,this.outlineIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(ne,se,ae){const de=new Uint32Array(se),_e=new Int32Array(de.buffer),pe=de[ae++];this.fillVertexBuffer=re.f.createVertex(ne,J.l1.STATIC_DRAW,new Int32Array(_e.buffer,4*ae,pe)),ae+=pe;const he=de[ae++];this.fillIndexBuffer=re.f.createIndex(ne,J.l1.STATIC_DRAW,new Uint32Array(de.buffer,4*ae,he)),ae+=he;const ge=de[ae++];this.outlineVertexBuffer=re.f.createVertex(ne,J.l1.STATIC_DRAW,new Int32Array(_e.buffer,4*ae,ge)),ae+=ge;const ye=de[ae++];this.outlineIndexBuffer=re.f.createIndex(ne,J.l1.STATIC_DRAW,new Uint32Array(de.buffer,4*ae,ye)),ae+=ye;const Me=this.layer,Ee=Me.fillMaterial,Te=Me.outlineMaterial;this.fillVertexArrayObject=new W.U(ne,Ee.getAttributeLocations(),Ee.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer),this.outlineVertexArrayObject=new W.U(ne,Te.getAttributeLocations(),Te.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)}}class ue extends B{constructor(ne,se,ae){super(ne,se),this.type=Q.al.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const de=new Uint32Array(ne),_e=new Int32Array(ne),pe=new Float32Array(ne);let he=this.bufferDataOffset;this.isIconSDF=!!de[he++];const ge=de[he++];for(let Te=0;Te<ge;Te++){const me=de[he++],Ce=de[he++],Ie=de[he++];this.iconPerPageElementsMap.set(me,[Ce,Ie])}const ye=de[he++];for(let Te=0;Te<ye;Te++){const me=de[he++],Ce=de[he++],Ie=de[he++];this.glyphPerPageElementsMap.set(me,[Ce,Ie])}const Me=de[he++],Ee=de[he++];this.iconOpacity=new Int32Array(Me),this.textOpacity=new Int32Array(Ee),he=(0,H.wB)(de,_e,pe,he,this.symbols,ae),this.bufferDataOffset=he}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let ne=0;for(const[se,ae]of this.iconPerPageElementsMap)ne+=ae[1];for(const[se,ae]of this.glyphPerPageElementsMap)ne+=ae[1];return ne/3}doDestroy(){(0,x.pC)(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose(),(0,x.pC)(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose(),(0,x.pC)(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose(),(0,x.pC)(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose(),this.iconVertexArrayObject=null,this.iconVertexBuffer=null,this.iconOpacityBuffer=null,this.iconIndexBuffer=null,(0,x.pC)(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose(),(0,x.pC)(this.textVertexBuffer)&&this.textVertexBuffer.dispose(),(0,x.pC)(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose(),(0,x.pC)(this.textIndexBuffer)&&this.textIndexBuffer.dispose(),this.textVertexArrayObject=null,this.textVertexBuffer=null,this.textOpacityBuffer=null,this.textIndexBuffer=null,this.memoryUsed=0}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const ne=(0,x.Wg)(this.iconOpacity),se=(0,x.Wg)(this.iconOpacityBuffer);ne.length>0&&ne.byteLength===se.size&&se.setSubData(ne);const ae=(0,x.Wg)(this.textOpacity),de=(0,x.Wg)(this.textOpacityBuffer);ae.length>0&&ae.byteLength===de.size&&de.setSubData(ae)}doPrepareForRendering(ne,se,ae){const de=new Uint32Array(se),_e=new Int32Array(de.buffer),pe=de[ae++];this.iconVertexBuffer=re.f.createVertex(ne,J.l1.STATIC_DRAW,new Int32Array(_e.buffer,4*ae,pe)),ae+=pe;const he=de[ae++];this.iconIndexBuffer=re.f.createIndex(ne,J.l1.STATIC_DRAW,new Uint32Array(de.buffer,4*ae,he)),ae+=he;const ge=de[ae++];this.textVertexBuffer=re.f.createVertex(ne,J.l1.STATIC_DRAW,new Int32Array(_e.buffer,4*ae,ge)),ae+=ge;const ye=de[ae++];this.textIndexBuffer=re.f.createIndex(ne,J.l1.STATIC_DRAW,new Uint32Array(de.buffer,4*ae,ye)),ae+=ye,this.iconOpacityBuffer=re.f.createVertex(ne,J.l1.STATIC_DRAW,(0,x.Wg)(this.iconOpacity).buffer),this.textOpacityBuffer=re.f.createVertex(ne,J.l1.STATIC_DRAW,(0,x.Wg)(this.textOpacity).buffer);const Me=this.layer,Ee=Me.iconMaterial,Te=Me.textMaterial;this.iconVertexArrayObject=new W.U(ne,Ee.getAttributeLocations(),Ee.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer),this.textVertexArrayObject=new W.U(ne,Te.getAttributeLocations(),Te.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)}}class ce extends B{constructor(ne,se){super(ne,se),this.type=Q.al.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const ae=new Uint32Array(ne);let de=this.bufferDataOffset;this.circleIndexStart=ae[de++],this.circleIndexCount=ae[de++],this.bufferDataOffset=de}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){(0,x.pC)(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose(),(0,x.pC)(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose(),(0,x.pC)(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose(),this.circleVertexArrayObject=null,this.circleVertexBuffer=null,this.circleIndexBuffer=null,this.memoryUsed=0}doPrepareForRendering(ne,se,ae){const de=new Uint32Array(se),_e=new Int32Array(de.buffer),pe=de[ae++];this.circleVertexBuffer=re.f.createVertex(ne,J.l1.STATIC_DRAW,new Int32Array(_e.buffer,4*ae,pe)),ae+=pe;const he=de[ae++];this.circleIndexBuffer=re.f.createIndex(ne,J.l1.STATIC_DRAW,new Uint32Array(de.buffer,4*ae,he)),ae+=he;const ge=this.layer.circleMaterial;this.circleVertexArrayObject=new W.U(ne,ge.getAttributeLocations(),ge.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)}}var oe=T(47132),le=T(57477),Y=T(58098);class j extends le.s{constructor(ne,se,ae,de,_e,pe=de,he=_e){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Y.Z(ne),this.x=se,this.y=ae,this.width=de,this.height=_e,this.rangeX=pe,this.rangeY=he}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(ne,se){const ae=se/(ne.resolution*ne.pixelRatio),de=this.transforms.tileMat3,[_e,pe]=ne.toScreenNoRotation([0,0],[this.x,this.y]);(0,A.s)(de,this.width/this.rangeX*ae,0,0,0,this.height/this.rangeY*ae,0,_e,pe,1),(0,A.m)(this.transforms.dvs,ne.displayViewMat3,de)}}class X extends j{constructor(ne,se,ae,de,_e,pe,he=null){super(ne,se,ae,de,_e,4096,4096),this._memCache=he,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.styleRepository=pe,this.id=ne.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<oe.nN}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<oe.nN)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(ne){this.changeDataImpl(ne),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(ne){let se=!1;for(const ae of ne)if(this.layerData.has(ae)){const de=this.layerData.get(ae);this._memoryUsedByLayerData-=de.memoryUsed,de.type===Q.al.SYMBOL&&this.symbols.has(ae)&&(this.symbols.delete(ae),se=!0),de.destroy(),this.layerData.delete(ae),this.layerCount--}(0,x.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData),se&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){"unloaded"!==this.status&&(U.delete(this),X._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsage(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}changeDataImpl(ne){let se=!1;if(ne){const{bucketsWithData:ae,emptyBuckets:de}=ne,_e=this._createRenderBuckets(ae);if(de&&de.byteLength>0){const pe=new Uint32Array(de);for(const he of pe)this._deleteLayerData(he)}for(const[pe,he]of _e)this._deleteLayerData(pe),he.type===Q.al.SYMBOL&&(this.symbols.set(pe,he.symbols),se=!0),this._memoryUsedByLayerData+=he.memoryUsed,this.layerData.set(pe,he),this.layerCount++;(0,x.pC)(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const[ae,de]of this.layerData)de.type===Q.al.SYMBOL&&(this._hasSymbolBuckets=!0);se&&this.emit("symbols-changed")}attachWithContext(ne){this.stage={context:ne,trashDisplayObject(se){se.processDetach()},untrashDisplayObject:()=>!1}}setTransform(ne,se){super.setTransform(ne,se);const ae=se/(ne.resolution*ne.pixelRatio),de=this.width/this.rangeX*ae,_e=this.height/this.rangeY*ae,pe=[0,0];ne.toScreen(pe,[this.x,this.y]);const he=this.transforms.tileUnitsToPixels;(0,A.b)(he),(0,A.c)(he,he,pe),(0,A.r)(he,he,Math.PI*ne.rotation/180),(0,A.d)(he,he,[de,_e,1])}_createTransforms(){return{dvs:(0,G.c)(),tileMat3:(0,G.c)(),tileUnitsToPixels:(0,G.c)()}}static _destroyRenderBuckets(ne){if(!ne)return;const se=new Set;ne.forEach(ae=>{se.has(ae)||(ae.destroy(),se.add(ae))}),ne.clear()}_createRenderBuckets(ne){const se=new Map,ae=new Map;for(const de of ne){const _e=this._deserializeBucket(de,ae);for(const pe of _e.layerUIDs)se.set(pe,_e)}return se}_deserializeBucket(ne,se){let ae=se.get(ne);if(ae)return ae;switch(new Uint32Array(ne)[0]){case Q.al.FILL:ae=new ie(ne,this.styleRepository);break;case Q.al.LINE:ae=new Z(ne,this.styleRepository);break;case Q.al.SYMBOL:ae=new ue(ne,this.styleRepository,this);break;case Q.al.CIRCLE:ae=new ce(ne,this.styleRepository)}return se.set(ne,ae),ae}_deleteLayerData(ne){if(!this.layerData.has(ne))return;const se=this.layerData.get(ne);this._memoryUsedByLayerData-=se.memoryUsed,se.destroy(),this.layerData.delete(ne),this.layerCount--}}const U=new Map;function ee(){U.forEach(($,ne)=>{console.log(`\n${ne.key}:`),$[0].forEach(se=>console.log(se)),console.log("========"),$[1].forEach(se=>console.log(se))})}},47132:(dt,Re,T)=>{"use strict";T.d(Re,{Bf:()=>x,PF:()=>A,nN:()=>Q});const x=!0,A=32,Q=200},51200:(dt,Re,T)=>{"use strict";T.d(Re,{J:()=>A,a:()=>x});class x{constructor(Q){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=Q}}class A{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}}},76763:(dt,Re,T)=>{"use strict";T.d(Re,{C$:()=>B,HX:()=>J,co:()=>re,wB:()=>W});var x=T(919),A=T(51200);function re(ie,ue,ce,oe,le,Y){const j=ce-le;if(j>=0)return(ue>>j)+(oe-(Y<<j))*(ie>>j);const X=-j;return ue-(Y-(oe<<X))*(ie>>X)<<X}class J{constructor(ue,ce,oe){this._rows=Math.ceil(ce/oe),this._columns=Math.ceil(ue/oe),this._cellSize=oe,this.cells=new Array(this._rows);for(let le=0;le<this._rows;le++){this.cells[le]=new Array(this._columns);for(let Y=0;Y<this._columns;Y++)this.cells[le][Y]=[]}}getCell(ue,ce){const oe=Math.min(Math.max(Math.floor(ce/this._cellSize),0),this._rows-1),le=Math.min(Math.max(Math.floor(ue/this._cellSize),0),this._columns-1);return this.cells[oe]&&this.cells[oe][le]||null}getCellSpan(ue,ce,oe,le){return[Math.min(Math.max(Math.floor(ue/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(ce/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(oe/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(le/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}}function W(ie,ue,ce,oe,le,Y){const j=ue[oe++];for(let X=0;X<j;X++){const U=new A.a(Y);U.xTile=ue[oe++],U.yTile=ue[oe++],U.hash=ue[oe++],U.priority=ue[oe++];const ee=ue[oe++];for(let se=0;se<ee;se++){const ae=ue[oe++],de=ue[oe++],_e=ue[oe++],pe=ue[oe++],he=!!ue[oe++],ge=ue[oe++],ye=ce[oe++],Me=ce[oe++],Ee=ue[oe++],Te=ue[oe++];U.colliders.push({xTile:ae,yTile:de,dxPixels:_e,dyPixels:pe,hard:he,partIndex:ge,width:Ee,height:Te,minLod:ye,maxLod:Me})}const $=ie[oe++];for(let se=0;se<$;se++)U.textVertexRanges.push([ie[oe++],ie[oe++]]);const ne=ie[oe++];for(let se=0;se<ne;se++)U.iconVertexRanges.push([ie[oe++],ie[oe++]]);le.push(U)}return oe}function B(ie,ue,ce){for(const[oe,le]of ie.symbols)Z(ie,ue,ce,le,oe)}function Z(ie,ue,ce,oe,le){const Y=ie.layerData.get(le);if(Y.type===x.al.SYMBOL){for(const j of oe){const X=j.unique;let U;if(j.selectedForRendering){const ee=X.parts[0],$=ee.startOpacity,ne=ee.targetOpacity;ie.allSymbolsFadingOut=ie.allSymbolsFadingOut&&0===ne;const se=ce?Math.floor(127*$)|ne<<7:ne?255:0;U=se<<24|se<<16|se<<8|se}else U=0;for(const[ee,$]of j.iconVertexRanges)for(let ne=ee;ne<ee+$;ne+=4)Y.iconOpacity[ne/4]=U;if(j.selectedForRendering){const ee=X.parts[1],$=ee.startOpacity,ne=ee.targetOpacity;ie.allSymbolsFadingOut=ie.allSymbolsFadingOut&&0===ne;const se=ce?Math.floor(127*$)|ne<<7:ne?255:0;U=se<<24|se<<16|se<<8|se}else U=0;for(const[ee,$]of j.textVertexRanges)for(let ne=ee;ne<ee+$;ne+=4)Y.textOpacity[ne/4]=U}Y.lastOpacityUpdate=ue,Y.opacityChanged=!0}}},919:(dt,Re,T)=>{"use strict";var x,A,G,Q,H,re;T.d(Re,{Fr:()=>H,_K:()=>Q,al:()=>A}),(re=x||(x={}))[re.UNKNOWN=0]="UNKNOWN",re[re.FILL_VERTEX=1]="FILL_VERTEX",re[re.FILL_DD_VERTEX=2]="FILL_DD_VERTEX",re[re.FILL_INDEX=3]="FILL_INDEX",re[re.OUTLINE_VERTEX=4]="OUTLINE_VERTEX",re[re.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX",re[re.OUTLINE_INDEX=6]="OUTLINE_INDEX",re[re.LINE_VERTEX=7]="LINE_VERTEX",re[re.LINE_DD_VERTEX=8]="LINE_DD_VERTEX",re[re.LINE_INDEX=9]="LINE_INDEX",re[re.ICON_VERTEX=10]="ICON_VERTEX",re[re.ICON_DD_VERTEX=11]="ICON_DD_VERTEX",re[re.ICON_INDEX=12]="ICON_INDEX",re[re.TEXT_VERTEX=13]="TEXT_VERTEX",re[re.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX",re[re.TEXT_INDEX=15]="TEXT_INDEX",re[re.CIRCLE_VERTEX=16]="CIRCLE_VERTEX",re[re.CIRCLE_INDEX=17]="CIRCLE_INDEX",function(re){re[re.FILL=1]="FILL",re[re.LINE=2]="LINE",re[re.SYMBOL=3]="SYMBOL",re[re.CIRCLE=4]="CIRCLE"}(A||(A={})),function(re){re[re.BACKGROUND=0]="BACKGROUND",re[re.OPAQUE=1]="OPAQUE",re[re.TRANSLUCENT=2]="TRANSLUCENT",re[re.SYMBOLS=3]="SYMBOLS",re[re.HITTEST=4]="HITTEST"}(G||(G={})),function(re){re[re.BACKGROUND=0]="BACKGROUND",re[re.FILL=1]="FILL",re[re.OUTLINE=2]="OUTLINE",re[re.LINE=3]="LINE",re[re.ICON=4]="ICON",re[re.CIRCLE=5]="CIRCLE",re[re.TEXT=6]="TEXT",re[re.TILEINFO=7]="TILEINFO"}(Q||(Q={})),function(re){re[re.PAINTER_CHANGED=0]="PAINTER_CHANGED",re[re.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",re[re.LAYER_CHANGED=2]="LAYER_CHANGED",re[re.LAYER_REMOVED=3]="LAYER_REMOVED",re[re.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(H||(H={}))},93292:(dt,Re,T)=>{"use strict";T.d(Re,{cD:()=>H,sy:()=>G});var x=T(67969),A=T(40852);const G={geometry:[new A.G("a_pos",2,x.g.BYTE,0,2)]},H=(new A.G("a_pos",2,x.g.BYTE,0,4),new A.G("a_tex",2,x.g.BYTE,2,4),{geometry:[new A.G("a_pos",2,x.g.UNSIGNED_SHORT,0,4)]})},58098:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>A});var x=T(27899);class A{constructor(Q,H,re,J){this.set(Q,H,re,J)}static getId(Q,H,re,J){return"object"==typeof Q?`${Q.level}/${Q.row}/${Q.col}/${Q.world}`:`${Q}/${H}/${re}/${J}`}get key(){return this}get id(){return this.toString()}set id(Q){this.set(Q)}get hash(){return(3&this.world)<<30|(4095&this.col)<<22|(4095&this.row)<<8|63&this.level}acquire(Q,H,re,J){this.set(Q,H,re,J)}contains(Q){const H=Q.level-this.level;return this.row===Q.row>>H&&this.col===Q.col>>H&&this.world===Q.world}equals(Q){return this.level===Q.level&&this.row===Q.row&&this.col===Q.col&&this.world===Q.world}clone(){return new A(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(Q,H,re,J){if(null==Q)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof Q)this.level=Q.level||0,this.row=Q.row||0,this.col=Q.col||0,this.world=Q.world||0;else if("string"==typeof Q){const[W,B,Z,ie]=Q.split("/");this.level=parseFloat(W),this.row=parseFloat(B),this.col=parseFloat(Z),this.world=parseFloat(ie)}else this.level=+Q,this.row=+H,this.col=+re,this.world=+J||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new A(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const Q=this.level+1,H=this.row<<1,re=this.col<<1,J=this.world;return[new A(Q,H,re,J),new A(Q,H,re+1,J),new A(Q,H+1,re,J),new A(Q,H+1,re+1,J)]}compareRowMajor(Q){return this.row<Q.row?-1:this.row>Q.row?1:this.col<Q.col?-1:this.col>Q.col?1:0}}A.pool=new x.Z(A,null,null,25,50)},12015:(dt,Re,T)=>{"use strict";T.d(Re,{YF:()=>Q,co:()=>H,hZ:()=>re,yl:()=>G});var Q,H,re,J,x=T(43703),A=T(28093);class G{constructor(){this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,A.c)(),this.parallax={anchorPointClouds:(0,A.c)(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:(0,x.c)()},this.parallaxNew={anchorPointClouds:(0,A.c)(),cloudsHeight:1e5,radiusCurvatureCorrectionFactor:0,transform:(0,x.c)()},this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3},this.fadeInOut={stage:H.FINISHED,factor:0,distanceThresholdFactor:.6},this.fadeIn={stage:Q.FINISHED,factor:0,distanceThresholdFactor:2},this.fadeInOutHeight={stage:re.FINISHED,factor:-1}}}(J=Q||(Q={}))[J.FINISHED=0]="FINISHED",J[J.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",J[J.FADE_IN=2]="FADE_IN",function(J){J[J.FINISHED=0]="FINISHED",J[J.FADE_OUT=1]="FADE_OUT",J[J.SWITCH=2]="SWITCH",J[J.FADE_IN=3]="FADE_IN"}(H||(H={})),function(J){J[J.FINISHED=0]="FINISHED",J[J.HEIGHT_FADE=1]="HEIGHT_FADE"}(re||(re={}))},32849:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>G,t:()=>Q});var G,H,x=T(17626),A=T(87601);(H=G||(G={}))[H.SIXTEEN=0]="SIXTEEN",H[H.HUNDRED=1]="HUNDRED",H[H.TWOHUNDRED=2]="TWOHUNDRED",H[H.COUNT=3]="COUNT";class Q extends A.m{constructor(){super(...arguments),this.steps=G.SIXTEEN}}(0,x._)([(0,A.o)({count:G.COUNT})],Q.prototype,"steps",void 0)},64312:(dt,Re,T)=>{"use strict";T.d(Re,{i:()=>Q,u:()=>G});var G,H,x=T(17626),A=T(87601);(H=G||(G={}))[H.Full=0]="Full",H[H.WeatherMap=1]="WeatherMap",H[H.COUNT=2]="COUNT";class Q extends A.m{constructor(){super(...arguments),this.mode=G.Full}}(0,x._)([(0,A.o)({count:G.COUNT})],Q.prototype,"mode",void 0)},85755:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>J,IQ:()=>H,I_:()=>A,QZ:()=>W,iZ:()=>re,jy:()=>Q,kR:()=>G});const A=(0,T(8314).Z)("esri-mobile")?64:128,G=A/128,Q=Math.ceil(Math.sqrt(A)),H=(A+2)*Q,re=1e5,J=128,W=H/1560},6067:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>G,Y:()=>Q});var G,H,x=T(17626),A=T(87601);(H=G||(G={}))[H.Rain=0]="Rain",H[H.Snow=1]="Snow",H[H.COUNT=2]="COUNT";class Q extends A.m{constructor(){super(...arguments),this.type=G.Rain}}(0,x._)([(0,A.o)({count:G.COUNT})],Q.prototype,"type",void 0)},49115:(dt,Re,T)=>{"use strict";T.d(Re,{f:()=>Q,n:()=>G});var G,H,x=T(17626),A=T(87601);(H=G||(G={}))[H.Cone=0]="Cone",H[H.Cylinder=1]="Cylinder",H[H.Underground=2]="Underground",H[H.COUNT=3]="COUNT";class Q extends A.m{constructor(){super(...arguments),this.geometry=G.Cone}}(0,x._)([(0,A.o)({count:G.COUNT})],Q.prototype,"geometry",void 0)},9160:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>W});var x=T(15861),A=T(84792),G=T(59213),Q=T(26584),H=T(62208),re=T(10699),J=T(21726);class W{constructor(ie){this.streamDataRequester=ie}loadJSON(ie,ue){var ce=this;return(0,x.Z)(function*(){return ce._load("json",ie,ue)})()}loadBinary(ie,ue){var ce=this;return(0,x.Z)(function*(){return(0,J.HK)(ie)?((0,re.k_)(ue),(0,J.AH)(ie)):ce._load("binary",ie,ue)})()}loadImage(ie,ue){var ce=this;return(0,x.Z)(function*(){return ce._load("image",ie,ue)})()}_load(ie,ue,ce){var oe=this;return(0,x.Z)(function*(){if((0,H.Wi)(oe.streamDataRequester))return(yield(0,A.default)(ue,{responseType:B[ie]})).data;const le=yield(0,G.q6)(oe.streamDataRequester.request(ue,ie,ce));if(!0===le.ok)return le.value;throw(0,re.r9)(le.error),new Q.Z("",`Request for resource failed: ${le.error}`)})()}}const B={image:"image",binary:"array-buffer",json:"json"}},96170:(dt,Re,T)=>{"use strict";T.d(Re,{DA:()=>Q,jX:()=>H,nh:()=>G});var x=T(55713),A=T(36848);function G(re,J=A.p){return"number"==typeof re?J(re):(0,x.Uc)(re)||(0,x.lq)(re)?new Uint32Array(re):re}function Q(re){const J="number"==typeof re?re:re.length;if(J<3)return new Uint16Array(0);const W=J-2,B=W<=65536?new Uint16Array(3*W):new Uint32Array(3*W);if("number"==typeof re){let Z=0;for(let ie=0;ie<W;ie+=1)ie%2==0?(B[Z++]=ie,B[Z++]=ie+1,B[Z++]=ie+2):(B[Z++]=ie+1,B[Z++]=ie,B[Z++]=ie+2)}else{let Z=0;for(let ie=0;ie<W;ie+=1)if(ie%2==0){const ce=re[ie+1],oe=re[ie+2];B[Z++]=re[ie],B[Z++]=ce,B[Z++]=oe}else{const ce=re[ie],oe=re[ie+2];B[Z++]=re[ie+1],B[Z++]=ce,B[Z++]=oe}}return B}function H(re){const J="number"==typeof re?re:re.length;if(J<3)return new Uint16Array(0);const W=J-2,B=W<=65536?new Uint16Array(3*W):new Uint32Array(3*W);if("number"==typeof re){let Z=0;for(let ie=0;ie<W;++ie)B[Z++]=0,B[Z++]=ie+1,B[Z++]=ie+2;return B}{const Z=re[0];let ie=re[1],ue=0;for(let ce=0;ce<W;++ce){const oe=re[ce+2];B[ue++]=Z,B[ue++]=ie,B[ue++]=oe,ie=oe}return B}}},93831:(dt,Re,T)=>{"use strict";T.d(Re,{z:()=>$e});var x=T(15861),A=T(62208),G=T(43703),Q=T(26584);const re=T(63290).Z.getLogger("esri.views.3d.glTF");var $,ne,Ye,W=T(67969),ie=T(94573),ue=T(88159),ce=T(21726),oe=T(10349),le=T(28347),Y=T(48977),j=T(78451),X=T(60479),U=T(98148);class ee{constructor(ze){this.data=ze,this.offset4=0,this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}readUint32(){const ze=this.offset4;return this.offset4+=1,this.dataUint32[ze]}readUint8Array(ze){const et=4*this.offset4;return this.offset4+=ze/4,new Uint8Array(this.data,et,ze)}remainingBytes(){return this.data.byteLength-4*this.offset4}}(Ye=$||($={})).SCALAR="SCALAR",Ye.VEC2="VEC2",Ye.VEC3="VEC3",Ye.VEC4="VEC4",Ye.MAT2="MAT2",Ye.MAT3="MAT3",Ye.MAT4="MAT4",function(Ye){Ye[Ye.ARRAY_BUFFER=34962]="ARRAY_BUFFER",Ye[Ye.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(ne||(ne={}));const se={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},ae={pbrMetallicRoughness:se,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},de={ESRI_externalColorMixMode:"tint"},_e=(Ye={})=>{const ze=or(or({},se),Ye.pbrMetallicRoughness),et=function pe(Ye){switch(Ye.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,ie.Bg)(Ye.ESRI_externalColorMixMode),Ye.ESRI_externalColorMixMode="tint"}return Ye}(or(or({},de),Ye.extras));return yi(or(or({},ae),Ye),{pbrMetallicRoughness:ze,extras:et})},he={magFilter:W.cw.LINEAR,minFilter:W.cw.LINEAR_MIPMAP_LINEAR,wrapS:W.e8.REPEAT,wrapT:W.e8.REPEAT};class Ee{constructor(ze,et,ke,ot,at){this.context=ze,this.errorContext=et,this.uri=ke,this.json=ot,this.glbBuffer=at,this.bufferLoaders=new Map,this.textureLoaders=new Map,this.textureCache=new Map,this.materialCache=new Map,this.nodeParentMap=new Map,this.nodeTransformCache=new Map,this.baseUri=function ye(Ye){let ze,et;return Ye.replace(/^(.*\/)?([^/]*)$/,(ke,ot,at)=>(ze=ot||"",et=at||"","")),{dirPart:ze,filePart:et}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),et.errorUnsupportedIf(null==ot.scenes,"Scenes must be defined."),et.errorUnsupportedIf(null==ot.meshes,"Meshes must be defined"),et.errorUnsupportedIf(null==ot.nodes,"Nodes must be defined."),this._computeNodeParents()}static load(ze,et,ke,ot){var at=this;return(0,x.Z)(function*(){if((0,ce.HK)(ke)){const zt=(0,ce.sJ)(ke);if("model/gltf-binary"!==zt.mediaType)try{const Ft=JSON.parse(zt.isBase64?atob(zt.data):zt.data);return new Ee(ze,et,ke,Ft)}catch(Ft){}const Rt=(0,ce.AH)(ke);if(Ee._isGLBData(Rt))return at._fromGLBData(ze,et,ke,Rt)}if(ke.endsWith(".gltf")){const zt=yield ze.loadJSON(ke,ot);return new Ee(ze,et,ke,zt)}const yt=yield ze.loadBinary(ke,ot);if(Ee._isGLBData(yt))return at._fromGLBData(ze,et,ke,yt);const wt=yield ze.loadJSON(ke,ot);return new Ee(ze,et,ke,wt)})()}static _isGLBData(ze){const et=new ee(ze);return et.remainingBytes()>=4&&1179937895===et.readUint32()}static _fromGLBData(ze,et,ke,ot){return(0,x.Z)(function*(){const at=yield Ee._parseGLBData(et,ot);return new Ee(ze,et,ke,at.json,at.binaryData)})()}static _parseGLBData(ze,et){return(0,x.Z)(function*(){const ke=new ee(et);ze.assert(ke.remainingBytes()>=12,"GLB binary data is insufficiently large.");const ot=ke.readUint32(),at=ke.readUint32(),yt=ke.readUint32();ze.assert(1179937895===ot,"Magic first 4 bytes do not fit to expected GLB value."),ze.assert(et.byteLength>=yt,"GLB binary data is smaller than header specifies."),ze.errorUnsupportedIf(2!==at,"An unsupported GLB container version was detected. Only version 2 is supported.");let wt,zt,Rt=0;for(;ke.remainingBytes()>=8;){const Ft=ke.readUint32(),bt=ke.readUint32();0===Rt?(ze.assert(1313821514===bt,"First GLB chunk must be JSON."),ze.assert(Ft>=0,"No JSON data found."),wt=yield xe(ke.readUint8Array(Ft))):1===Rt?(ze.errorUnsupportedIf(5130562!==bt,"Second GLB chunk expected to be BIN."),zt=ke.readUint8Array(Ft)):ze.warnUnsupported("More than 2 GLB chunks detected. Skipping."),Rt+=1}return wt||ze.error("No GLB JSON chunk detected."),{json:wt,binaryData:zt}})()}getBuffer(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.json.buffers[ze],at=ke.errorContext;if(null==ot.uri)return at.assert(null!=ke.glbBuffer,"GLB buffer not present"),ke.glbBuffer;const yt=yield ke._getBufferLoader(ze,et);return at.assert(yt.byteLength===ot.byteLength,"Buffer byte lengths should match."),yt})()}_getBufferLoader(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.bufferLoaders.get(ze);if(ot)return ot;const yt=ke.context.loadBinary(ke._resolveUri(ke.json.buffers[ze].uri),et).then(wt=>new Uint8Array(wt));return ke.bufferLoaders.set(ze,yt),yt})()}getAccessor(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.errorContext;ot.errorUnsupportedIf(!ke.json.accessors,"Accessors missing.");const at=ke.json.accessors[ze];ot.errorUnsupportedIf(null==(null==at?void 0:at.bufferView),"Some accessor does not specify a bufferView."),ot.errorUnsupportedIf(at.type in[$.MAT2,$.MAT3,$.MAT4],`AttributeType ${at.type} is not supported`);const yt=ke.json.bufferViews[at.bufferView],wt=yield ke.getBuffer(yt.buffer,et),zt=Ie[at.type],Rt=Ge[at.componentType],Ft=zt*Rt,bt=yt.byteStride||Ft;return{raw:wt.buffer,byteStride:bt,byteOffset:wt.byteOffset+(yt.byteOffset||0)+(at.byteOffset||0),entryCount:at.count,isDenselyPacked:bt===Ft,componentCount:zt,componentByteSize:Rt,componentType:at.componentType,min:at.min,max:at.max,normalized:!!at.normalized}})()}getIndexData(ze,et){var ke=this;return(0,x.Z)(function*(){if(null==ze.indices)return null;const ot=yield ke.getAccessor(ze.indices,et);if(ot.isDenselyPacked)switch(ot.componentType){case W.g.UNSIGNED_BYTE:return new Uint8Array(ot.raw,ot.byteOffset,ot.entryCount);case W.g.UNSIGNED_SHORT:return new Uint16Array(ot.raw,ot.byteOffset,ot.entryCount);case W.g.UNSIGNED_INT:return new Uint32Array(ot.raw,ot.byteOffset,ot.entryCount)}else switch(ot.componentType){case W.g.UNSIGNED_BYTE:return(0,U.m)(ke._wrapAccessor(X.D_,ot));case W.g.UNSIGNED_SHORT:return(0,U.m)(ke._wrapAccessor(X.av,ot));case W.g.UNSIGNED_INT:return(0,U.m)(ke._wrapAccessor(X.Nu,ot))}})()}getPositionData(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.errorContext;ot.errorUnsupportedIf(null==ze.attributes.POSITION,"No POSITION vertex data found.");const at=yield ke.getAccessor(ze.attributes.POSITION,et);return ot.errorUnsupportedIf(at.componentType!==W.g.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+we[at.componentType]),ot.errorUnsupportedIf(3!==at.componentCount,"POSITION vertex attribute must have 3 components, but found "+at.componentCount.toFixed()),ke._wrapAccessor(X.ct,at)})()}getNormalData(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.errorContext;ot.assert(null!=ze.attributes.NORMAL,"No NORMAL vertex data found.");const at=yield ke.getAccessor(ze.attributes.NORMAL,et);return ot.errorUnsupportedIf(at.componentType!==W.g.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+we[at.componentType]),ot.errorUnsupportedIf(3!==at.componentCount,"NORMAL vertex attribute must have 3 components, but found "+at.componentCount.toFixed()),ke._wrapAccessor(X.ct,at)})()}getTangentData(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.errorContext;ot.assert(null!=ze.attributes.TANGENT,"No TANGENT vertex data found.");const at=yield ke.getAccessor(ze.attributes.TANGENT,et);return ot.errorUnsupportedIf(at.componentType!==W.g.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+we[at.componentType]),ot.errorUnsupportedIf(4!==at.componentCount,"TANGENT vertex attribute must have 4 components, but found "+at.componentCount.toFixed()),new X.ek(at.raw,at.byteOffset,at.byteStride,at.byteOffset+at.byteStride*at.entryCount)})()}getTextureCoordinates(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.errorContext;ot.assert(null!=ze.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");const at=yield ke.getAccessor(ze.attributes.TEXCOORD_0,et);return ot.errorUnsupportedIf(2!==at.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+at.componentCount.toFixed()),at.componentType===W.g.FLOAT?ke._wrapAccessor(X.Eu,at):(ot.errorUnsupportedIf(!at.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0."),function Je(Ye){switch(Ye.componentType){case W.g.BYTE:return new X.Vs(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.UNSIGNED_BYTE:return new X.xA(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.SHORT:return new X.or(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.UNSIGNED_SHORT:return new X.TS(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.UNSIGNED_INT:return new X.qt(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);case W.g.FLOAT:return new X.Eu(Ye.raw,Ye.byteOffset,Ye.byteStride,Ye.byteOffset+Ye.byteStride*Ye.entryCount);default:return void(0,ie.Bg)(Ye.componentType)}}(at))})()}getVertexColors(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.errorContext;ot.assert(null!=ze.attributes.COLOR_0,"No COLOR_0 vertex data found.");const at=yield ke.getAccessor(ze.attributes.COLOR_0,et);if(ot.errorUnsupportedIf(4!==at.componentCount&&3!==at.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+at.componentCount.toFixed()),4===at.componentCount){if(at.componentType===W.g.FLOAT)return ke._wrapAccessor(X.ek,at);if(at.componentType===W.g.UNSIGNED_BYTE)return ke._wrapAccessor(X.mc,at);if(at.componentType===W.g.UNSIGNED_SHORT)return ke._wrapAccessor(X.v6,at)}else if(3===at.componentCount){if(at.componentType===W.g.FLOAT)return ke._wrapAccessor(X.ct,at);if(at.componentType===W.g.UNSIGNED_BYTE)return ke._wrapAccessor(X.ne,at);if(at.componentType===W.g.UNSIGNED_SHORT)return ke._wrapAccessor(X.mw,at)}ot.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+we[at.componentType])})()}hasPositions(ze){return void 0!==ze.attributes.POSITION}hasNormals(ze){return void 0!==ze.attributes.NORMAL}hasVertexColors(ze){return void 0!==ze.attributes.COLOR_0}hasTextureCoordinates(ze){return void 0!==ze.attributes.TEXCOORD_0}hasTangents(ze){return void 0!==ze.attributes.TANGENT}getMaterial(ze,et,ke){var ot=this;return(0,x.Z)(function*(){let at=ot.materialCache.get(ze.material);if(!at){const yt=null!=ze.material?_e(ot.json.materials[ze.material]):_e(),wt=yt.pbrMetallicRoughness,zt=ot.hasVertexColors(ze),Rt=ot.getTexture(wt.baseColorTexture,et),Ft=ot.getTexture(yt.normalTexture,et),bt=ke?ot.getTexture(yt.occlusionTexture,et):null,St=ke?ot.getTexture(yt.emissiveTexture,et):null,Xt=ke?ot.getTexture(wt.metallicRoughnessTexture,et):null,Mr=null!=ze.material?ze.material:-1;at={alphaMode:yt.alphaMode,alphaCutoff:yt.alphaCutoff,color:wt.baseColorFactor,doubleSided:!!yt.doubleSided,colorTexture:yield Rt,normalTexture:yield Ft,name:yt.name,id:Mr,occlusionTexture:yield bt,emissiveTexture:yield St,emissiveFactor:yt.emissiveFactor,metallicFactor:wt.metallicFactor,roughnessFactor:wt.roughnessFactor,metallicRoughnessTexture:yield Xt,hasVertexColors:zt,ESRI_externalColorMixMode:yt.extras.ESRI_externalColorMixMode}}return at})()}getTexture(ze,et){var ke=this;return(0,x.Z)(function*(){if(!ze)return null;ke.errorContext.errorUnsupportedIf(0!==(ze.texCoord||0),"Only TEXCOORD with index 0 is supported.");const ot=ze.index,at=ke.errorContext,yt=ke.json.textures[ot],wt=(Ye=>or(or({},he),Ye))(null!=yt.sampler?ke.json.samplers[yt.sampler]:{});at.errorUnsupportedIf(null==yt.source,"Source is expected to be defined for a texture.");const zt=ke.json.images[yt.source],Rt=yield ke._loadTextureImageData(ot,yt,et);return(0,ue.s1)(ke.textureCache,ot,()=>{const Ft=St=>33071===St||33648===St||10497===St,bt=St=>(at.error(`Unexpected TextureSampler WrapMode: ${St}. Using default REPEAT(10497).`),10497);return{data:Rt,wrapS:Ft(wt.wrapS)?wt.wrapS:bt(wt.wrapS),wrapT:Ft(wt.wrapT)?wt.wrapT:bt(wt.wrapT),minFilter:wt.minFilter,name:zt.name,id:ot}})})()}getNodeTransform(ze){if(void 0===ze)return me;let et=this.nodeTransformCache.get(ze);if(!et){const ke=this.getNodeTransform(this._getNodeParent(ze)),ot=this.json.nodes[ze];ot.matrix?et=(0,le.m)((0,G.c)(),ke,ot.matrix):ot.translation||ot.rotation||ot.scale?(et=(0,G.b)(ke),ot.translation&&(0,le.j)(et,et,ot.translation),ot.rotation&&(Ce[3]=(0,Y.g)(Ce,ot.rotation),(0,le.e)(et,et,Ce[3],Ce)),ot.scale&&(0,le.h)(et,et,ot.scale)):et=ke,this.nodeTransformCache.set(ze,et)}return et}_wrapAccessor(ze,et){return new ze(et.raw,et.byteOffset,et.byteStride,et.byteOffset+et.byteStride*(et.entryCount-1)+et.componentByteSize*et.componentCount)}_resolveUri(ze){return(0,ce.hF)(ze,this.baseUri)}_getNodeParent(ze){return this.nodeParentMap.get(ze)}_checkVersionSupported(){const ze=oe.G.parse(this.json.asset.version,"glTF");Te.validate(ze)}_checkRequiredExtensionsSupported(){const ze=this.json;ze.extensionsRequired&&0!==ze.extensionsRequired.length&&this.errorContext.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+ze.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((ze,et)=>{ze.children&&ze.children.forEach(ke=>{this.nodeParentMap.set(ke,et)})})}_loadTextureImageData(ze,et,ke){var ot=this;return(0,x.Z)(function*(){const at=ot.textureLoaders.get(ze);if(at)return at;const yt=ot._createTextureLoader(et,ke);return ot.textureLoaders.set(ze,yt),yt})()}_createTextureLoader(ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ke.json.images[ze.source];if(ot.uri)return ke.context.loadImage(ke._resolveUri(ot.uri),et);const at=ke.errorContext;at.errorUnsupportedIf(null==ot.bufferView,"Image bufferView must be defined."),at.errorUnsupportedIf(null==ot.mimeType,"Image mimeType must be defined.");const yt=ke.json.bufferViews[ot.bufferView],wt=yield ke.getBuffer(yt.buffer,et);return at.errorUnsupportedIf(null!=yt.byteStride,"byteStride not supported for image buffer"),function We(Ye,ze){return Ne.apply(this,arguments)}(new Uint8Array(wt.buffer,wt.byteOffset+(yt.byteOffset||0),yt.byteLength),ot.mimeType)})()}}const Te=new oe.G(2,0,"glTF"),me=(0,le.z)((0,G.c)(),Math.PI/2),Ce=(0,j.a)(),Ie={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Ge={[W.g.BYTE]:1,[W.g.UNSIGNED_BYTE]:1,[W.g.SHORT]:2,[W.g.UNSIGNED_SHORT]:2,[W.g.FLOAT]:4,[W.g.UNSIGNED_INT]:4};function xe(Ye){return je.apply(this,arguments)}function je(){return je=(0,x.Z)(function*(Ye){return new Promise((ze,et)=>{const ke=new Blob([Ye]),ot=new FileReader;ot.onload=()=>{ze(JSON.parse(ot.result))},ot.onerror=at=>{et(at)},ot.readAsText(ke)})}),je.apply(this,arguments)}function Ne(){return Ne=(0,x.Z)(function*(Ye,ze){return new Promise((et,ke)=>{const ot=new Blob([Ye],{type:ze}),at=URL.createObjectURL(ot),yt=new Image;yt.addEventListener("load",()=>{URL.revokeObjectURL(at),"decode"in yt?yt.decode().then(()=>et(yt),()=>et(yt)):et(yt)}),yt.addEventListener("error",wt=>{URL.revokeObjectURL(at),ke(wt)}),yt.src=at})}),Ne.apply(this,arguments)}const we={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};let Oe=0;function $e(Ye,ze){return Be.apply(this,arguments)}function Be(){return Be=(0,x.Z)(function*(Ye,ze,et={},ke=!0){const ot=yield Ee.load(Ye,qe,ze,et),at="gltf_"+Oe++,yt={lods:[],materials:new Map,textures:new Map,meta:Se(ot)},wt=!(!ot.json.asset.extras||"symbolResource"!==ot.json.asset.extras.ESRI_type),zt=new Map;yield De(ot,function(){var Rt=(0,x.Z)(function*(Ft,bt,St,Xt){var Ur;const Mr=null!=(Ur=zt.get(St))?Ur:0;zt.set(St,Mr+1);const Cr=void 0!==Ft.mode?Ft.mode:W.MX.TRIANGLES,Yr=Cr===W.MX.TRIANGLES||Cr===W.MX.TRIANGLE_STRIP||Cr===W.MX.TRIANGLE_FAN?Cr:null;if((0,A.Wi)(Yr))return void qe.warnUnsupported("Unsupported primitive mode ("+tt[Cr]+"). Skipping primitive.");if(!ot.hasPositions(Ft))return void qe.warn("Skipping primitive without POSITION vertex attribute.");const Lr=ot.getPositionData(Ft,et),ct=ot.getMaterial(Ft,et,ke),jt=ot.hasNormals(Ft)?ot.getNormalData(Ft,et):null,qt=ot.hasTangents(Ft)?ot.getTangentData(Ft,et):null,er=ot.hasTextureCoordinates(Ft)?ot.getTextureCoordinates(Ft,et):null,Zt=ot.hasVertexColors(Ft)?ot.getVertexColors(Ft,et):null,tr=ot.getIndexData(Ft,et),ir={transform:(0,G.b)(bt),attributes:{position:yield Lr,normal:jt?yield jt:null,texCoord0:er?yield er:null,color:Zt?yield Zt:null,tangent:qt?yield qt:null},indices:yield tr,primitiveType:Yr,material:Ke(yt,yield ct,at)};let fr=null;(0,A.pC)(yt.meta)&&(0,A.pC)(yt.meta.ESRI_lod)&&"screenSpaceRadius"===yt.meta.ESRI_lod.metric&&(fr=yt.meta.ESRI_lod.thresholds[St]),yt.lods[St]=yt.lods[St]||{parts:[],name:Xt,lodThreshold:fr},yt.lods[St].parts[Mr]=ir});return function(Ft,bt,St,Xt){return Rt.apply(this,arguments)}}());for(const Rt of yt.lods)Rt.parts=Rt.parts.filter(Ft=>!!Ft);return{model:yt,meta:{isEsriSymbolResource:wt,uri:ot.uri},customMeta:{}}}),Be.apply(this,arguments)}function Se(Ye){let et=null;return Ye.json.nodes.forEach(ke=>{const ot=ke.extras;(0,A.pC)(ot)&&(ot.ESRI_proxyEllipsoid||ot.ESRI_lod)&&(et=ot)}),et}function De(Ye,ze){return Fe.apply(this,arguments)}function Fe(){return Fe=(0,x.Z)(function*(Ye,ze){const et=Ye.json,ke=et.scenes[et.scene||0].nodes,ot=ke.length>1,at=[];for(const zt of ke){const Rt=et.nodes[zt];at.push(yt(zt,0)),ve(Rt)&&!ot&&Rt.extensions.MSFT_lod.ids.forEach((Ft,bt)=>yt(Ft,bt+1))}function yt(zt,Rt){return wt.apply(this,arguments)}function wt(){return(wt=(0,x.Z)(function*(zt,Rt){const Ft=et.nodes[zt],bt=Ye.getNodeTransform(zt);if(qe.warnUnsupportedIf(null!=Ft.weights,"Morph targets are not supported."),null!=Ft.mesh){const St=et.meshes[Ft.mesh];for(const Xt of St.primitives)at.push(ze(Xt,bt,Rt,St.name))}for(const St of Ft.children||[])at.push(yt(St,Rt))})).apply(this,arguments)}yield Promise.all(at)}),Fe.apply(this,arguments)}function ve(Ye){return Ye.extensions&&Ye.extensions.MSFT_lod&&Array.isArray(Ye.extensions.MSFT_lod.ids)}function Ke(Ye,ze,et){const ke=at=>{const yt=`${et}_tex_${at&&at.id}${at&&at.name?"_"+at.name:""}`;if(at&&!Ye.textures.has(yt)){const wt=function Z(Ye,ze={}){return{data:Ye,parameters:or({wrap:or({s:W.e8.REPEAT,t:W.e8.REPEAT},ze.wrap),noUnpackFlip:!0,mipmap:!1},ze)}}(at.data,{wrap:{s:at.wrapS,t:at.wrapT},mipmap:be.includes(at.minFilter),noUnpackFlip:!0});Ye.textures.set(yt,wt)}return yt},ot=`${et}_mat_${ze.id}_${ze.name}`;if(!Ye.materials.has(ot)){const at=function B(Ye={}){return or({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply"},Ye)}({color:[ze.color[0],ze.color[1],ze.color[2]],opacity:ze.color[3],alphaMode:ze.alphaMode,alphaCutoff:ze.alphaCutoff,doubleSided:ze.doubleSided,colorMixMode:ze.ESRI_externalColorMixMode,textureColor:ze.colorTexture?ke(ze.colorTexture):void 0,textureNormal:ze.normalTexture?ke(ze.normalTexture):void 0,textureOcclusion:ze.occlusionTexture?ke(ze.occlusionTexture):void 0,textureEmissive:ze.emissiveTexture?ke(ze.emissiveTexture):void 0,textureMetallicRoughness:ze.metallicRoughnessTexture?ke(ze.metallicRoughnessTexture):void 0,emissiveFactor:[ze.emissiveFactor[0],ze.emissiveFactor[1],ze.emissiveFactor[2]],metallicFactor:ze.metallicFactor,roughnessFactor:ze.roughnessFactor});Ye.materials.set(ot,at)}return ot}const qe=new class J{error(ze){throw new Q.Z("gltf-loader-error",ze)}errorUnsupported(ze){throw new Q.Z("gltf-loader-unsupported-feature",ze)}errorUnsupportedIf(ze,et){ze&&this.errorUnsupported(et)}assert(ze,et){ze||this.error(et)}warn(ze){re.warn(ze)}warnUnsupported(ze){this.warn("[Unsupported Feature] "+ze)}warnUnsupportedIf(ze,et){ze&&this.warnUnsupported(et)}},be=[W.cw.LINEAR_MIPMAP_LINEAR,W.cw.LINEAR_MIPMAP_NEAREST],tt=["POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN"]},69648:(dt,Re,T)=>{"use strict";var G,Q;function A(Q){switch(Q){case G.SUPPORTED:break;case G.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case G.GEOMETRY_MISSING:return"no geometry";case G.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case G.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case G.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}T.d(Re,{Z:()=>A,e:()=>G}),T(8314),(Q=G||(G={}))[Q.SUPPORTED=0]="SUPPORTED",Q[Q.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",Q[Q.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",Q[Q.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",Q[Q.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",Q[Q.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"},96064:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>H}),T(8314);var A=T(62208),G=T(60507),Q=T(69648);function H(re){var J;if("graphics"!==(null==(J=re.layer)?void 0:J.type))return Q.e.GRAPHICS_LAYER_MISSING;if((0,A.Wi)(re.geometry))return Q.e.GEOMETRY_MISSING;switch(re.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return Q.e.GEOMETRY_TYPE_UNSUPPORTED}return"on-the-ground"!==(0,G.vu)(re)&&(0,G.Lt)(re)?Q.e.ELEVATION_MODE_UNSUPPORTED:Q.e.SUPPORTED}},89557:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>H,b:()=>re});var x=T(62208),A=T(72149),G=T(60507),Q=T(69648);function H(W){return J(W).result}function re(W){return J(W).geometry}function J(W){var B;return"graphics"!==(null==(B=W.layer)?void 0:B.type)?{result:Q.e.GRAPHICS_LAYER_MISSING,geometry:null}:(0,x.Wi)(W.geometry)?{result:Q.e.GEOMETRY_MISSING,geometry:null}:"on-the-ground"!==(0,G.vu)(W)&&(0,G.Lt)(W)?{result:Q.e.ELEVATION_MODE_UNSUPPORTED,geometry:null}:"point"!==W.geometry.type&&"polyline"!==W.geometry.type&&("polygon"!==W.geometry.type||W.geometry instanceof A.Z)?{result:Q.e.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:Q.e.SUPPORTED,geometry:W.geometry}}},46807:(dt,Re,T)=>{"use strict";T.d(Re,{Lz:()=>Y,RX:()=>le,Wf:()=>ue,j3:()=>ce});var x=T(62208),A=T(28347),G=T(43703),Q=T(84161),H=T(28093),re=T(55915),J=T(81468),W=T(67225),B=T(93605),Z=T(53929),ie=T(16396);function ue(de,_e,pe,he){const ge=de.stageObject,ye=ge.geometryRecords;let Me=0;for(const Ee of ye){const{update:Te,averageGeometrySampledElevation:me}=ae(Ee,_e,pe,he);Me+=me,Te&&ge.geometryVertexAttrsUpdated(Ee)}return Me/ye.length}function ce(de,_e,pe,he){const ge=de.stageObject,ye=_e.centerPointInElevationSR;let Me=0;ge.metadata.usesVerticalDistanceToGround?((0,J.qZ)(ye,pe,_e,he,se),(0,W.CV)(ge,se.verticalDistanceToGround),Me=se.sampledElevation):((0,J.qZ)(ye,pe,_e,he,se),"absolute-height"!==_e.mode&&(Me=se.sampledElevation));const Ee=(0,A.c)(oe,ge.transformation),Te=(0,Q.s)(ne,Ee[12],Ee[13],Ee[14]);B.Z.TESTS_DISABLE_OPTIMIZATIONS?(X[0]=ye.x,X[1]=ye.y,X[2]=se.z,(0,re.Bm)(ye.spatialReference,X,Ee,he.spatialReference)&&(ge.transformation=Ee)):he.setAltitudeOfTransformation(se.z,Ee);const me=j/he.unitInMeters;return(Math.abs(Ee[12]-Te[0])>=me||Math.abs(Ee[13]-Te[1])>=me||Math.abs(Ee[14]-Te[2])>=me)&&(ge.transformation=Ee),Me}const oe=(0,G.c)();function le(de,_e,pe,he){const ge=de.graphics3DSymbolLayer.lodRenderer;if((0,x.Wi)(ge))return 0;const ye=_e.centerPointInElevationSR;(0,J.qZ)(ye,pe,_e,he,se);const Me="absolute-height"!==_e.mode?se.sampledElevation:0,Ee=ge.instanceData,Te=de.instanceIndex,me=$;Ee.getGlobalTransform(Te,me);const Ce=(0,Q.s)(ne,me[12],me[13],me[14]);B.Z.TESTS_DISABLE_OPTIMIZATIONS?(X[0]=ye.x,X[1]=ye.y,X[2]=se.z,(0,re.Bm)(ye.spatialReference,X,me,he.spatialReference)&&Ee.setGlobalTransform(Te,me)):he.setAltitudeOfTransformation(se.z,me);const Ie=j/he.unitInMeters;return(B.Z.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(me[12]-Ce[0])>=Ie||Math.abs(me[13]-Ce[1])>=Ie||Math.abs(me[14]-Ce[2])>=Ie)&&Ee.setGlobalTransform(Te,me),Me}function Y(de,_e,pe,he){const ge=de.stageObject,ye=ge.geometryRecords;if(0===ye.length)return 0;let Me=0,Ee=null,Te=0,me=!1;for(const Ce of ye){const Ie=Ce.geometry.vertexAttributes.get(ie.T.POSITION);if(Ie!==Ee){const{update:Ge,averageGeometrySampledElevation:Je}=ae(Ce,_e,pe,he);Te=Je,Ee=Ie,me=Ge}me&&ge.geometryVertexAttrsUpdated(Ce),Me+=Te}return Me/ye.length}const j=.01,X=(0,H.c)(),U=(0,H.c)(),ee=(0,H.c)(),$=(0,G.c)(),ne=(0,H.c)(),se=new J.Lm;function ae(de,_e,pe,he){let ge=!1;const ye=pe.spatialReference,Me=de.geometry,Ee=de.getShaderTransformation(),Te=_e.requiresSampledElevationInfo;U[0]=Ee[12],U[1]=Ee[13],U[2]=Ee[14],Me.invalidateBoundingInfo();const me=Me.getMutableAttribute(ie.T.POSITION),Ce=me.data,Ie=Me.vertexAttributes.get(ie.T.MAPPOS).data,Ge=me.size,Je=Ce.length/Ge,xe=new Z.sb(Ie,ye);let je=0,We=0;for(let Ne=0;Ne<Je;Ne++){if(ee[0]=Ce[je],ee[1]=Ce[je+1],ee[2]=Ce[je+2],(0,J.qZ)(xe,pe,_e,he,se),Te&&(We+=se.sampledElevation),B.Z.TESTS_DISABLE_OPTIMIZATIONS)Ce[je]=xe.array[xe.offset],Ce[je+1]=xe.array[xe.offset+1],Ce[je+2]=se.z,(0,re.CM)(Ce,ye,je,Ce,he.spatialReference,je,1),Ce[je]-=U[0],Ce[je+1]-=U[1],Ce[je+2]-=U[2],ge=!0;else{X[0]=Ce[je]+U[0],X[1]=Ce[je+1]+U[1],X[2]=Ce[je+2]+U[2],he.setAltitude(X,se.z),Ce[je]=X[0]-U[0],Ce[je+1]=X[1]-U[1],Ce[je+2]=X[2]-U[2];const we=j/he.unitInMeters;(Math.abs(ee[0]-Ce[je])>=we||Math.abs(ee[1]-Ce[je+1])>=we||Math.abs(ee[2]-Ce[je+2])>=we)&&(ge=!0)}je+=Ge,xe.offset+=3}return We/=Je,{update:ge,averageGeometrySampledElevation:We}}},79112:(dt,Re,T)=>{"use strict";T.d(Re,{o:()=>Q});var x=T(62208),A=T(29505),G=T(74746);class Q{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(re){this._unit=re,this._metersPerElevationInfoUnit=(0,A.Z7)(re)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(re){this._meterUnitOffset=re,this._renderUnitOffset=0}set offsetElevationInfoUnits(re){this._meterUnitOffset=re*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(re){this._renderUnitOffset+=re}geometryZWithOffset(re,J){const W=this.calculateOffsetRenderUnits(J);return null!=this.featureExpressionInfoContext?W:re+W}calculateOffsetRenderUnits(re){let J=this._meterUnitOffset;const W=this.featureExpressionInfoContext;return null!=W&&(J+=(0,G.ht)(W)*this._metersPerElevationInfoUnit),J/re.unitInMeters+this._renderUnitOffset}setFromElevationInfo(re){this.mode=re.mode,this.unit=(0,A.lt)(re.unit)?re.unit:"meters",this.offsetElevationInfoUnits=(0,x.Pt)(re.offset,0)}updateFeatureExpressionInfoContext(re,J,W){if((0,x.Wi)(re))return void(this._featureExpressionInfoContext=null);const B=re&&re.arcade;B&&(0,x.pC)(J)&&(0,x.pC)(W)?(this._featureExpressionInfoContext=(0,G.d9)(re),(0,G.aO)(this._featureExpressionInfoContext,(0,G.Tz)(B.modules,J,W))):this._featureExpressionInfoContext=re}static fromElevationInfo(re){const J=new Q;return(0,x.pC)(re)&&J.setFromElevationInfo(re),J}}},39912:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>B,Y:()=>W});var x=T(15861),G=(T(29132),T(85931)),Q=T(62208),H=T(10699),re=T(87091),J=T(72854);class W{constructor(ie,ue){this.spatialReference=ie,this.view=ue}getElevation(ie,ue,ce){return this.view.elevationProvider.getElevation(ie,ue,0,this.spatialReference,ce)}queryElevation(ie,ue,ce,oe,le){var Y=this;return(0,x.Z)(function*(){return Y.view.elevationProvider.queryElevation(ie,ue,0,Y.spatialReference,le,ce,oe)})()}}class B{constructor(ie,ue,ce,oe){this.spatialReference=ue,this._getElevationQueryProvider=ce,this._queries=new Array,this._queryOptions=yi(or({},oe),{ignoreInvisibleLayers:!0}),this._frameTask=ie.registerTask(re.T8.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(ie,ue,ce,oe=0){return new Promise((le,Y)=>{const j={x:ie,y:ue,minDemResolution:oe,result:{resolve:le,reject:Y},signal:ce};this._queries.push(j),(0,H.fu)(ce,()=>{(0,G.Od)(this._queries,j),Y((0,H.zE)())})})}get running(){return this._queries.length>0}runTask(){const ie=this._queries;this._queries=[];const ue=this._getElevationQueryProvider();if(!ue)return void ie.forEach(U=>U.result.reject());const ce=ie.map(U=>[U.x,U.y]),oe=ie.reduce((U,ee)=>Math.min(U,ee.minDemResolution),1/0),le=new J.Z({points:ce,spatialReference:this.spatialReference}),Y=ie.length>1&&ie.some(U=>!!U.signal)?new AbortController:null,j=(0,Q.pC)(Y)?Y.signal:ie[0].signal;if((0,Q.pC)(Y)){let U=0;ie.forEach(ee=>(0,H.fu)(ee.signal,()=>{U++,ee.result.reject((0,H.zE)()),U===ie.length&&Y.abort()}))}const X=yi(or({},this._queryOptions),{minDemResolution:oe,signal:j});ue.queryElevation(le,X).then(U=>{ie.forEach((ee,$)=>{(0,Q.pC)(ee.signal)&&ee.signal.aborted?ee.result.reject((0,H.zE)()):ee.result.resolve(U.geometry.points[$][2])})}).catch(U=>{ie.forEach(ee=>ee.result.reject(U))})}get test(){const ie=this;return{update:()=>ie._queries.length>0&&ie.runTask()}}}},18170:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>qe});var x=T(63290),A=T(9824),G=T(15861),Q=T(91558),H=T(62208),re=T(23841),J=T(99770),W=T(46807),B=T(81468),Z=T(79112),ie=T(93927),ue=T(18422),ce=T(67225),oe=T(92690),le=T(97161),Y=T(42743),j=T(52107),X=T(40723),U=T(16396),ee=T(9545),$=T(19625),ne=T(6945),se=T(97347),ae=T(60881),de=T(5894),_e=T(42037),pe=T(59617),he=T(651),ge=T(91056),ye=T(39114),Me=T(12407),Ee=T(76269),Te=T(67969),me=T(2078);class Ce extends ge.A{initializeConfiguration(Ye,ze){ze.spherical=Ye.viewingMode===pe.JY.Global}initializeProgram(Ye){const ze=Ce.shader.get().build(this.configuration);return new Me.$(Ye.rctx,ze,ye.i)}setPipelineState(Ye){const ze=Ye?Te.wb.ALWAYS:Te.wb.LESS;return(0,me.sm)(this.configuration.depthHudEnabled?{depthTest:{func:ze},depthWrite:me.LZ}:{blending:(0,me.wK)(Te.zi.ONE,Te.zi.SRC_ALPHA,Te.zi.ONE_MINUS_SRC_ALPHA,Te.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:ze},colorWrite:me.BK})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}}Ce.shader=new he.J(Ee.L,()=>T.e(3807).then(T.bind(T,43807)));var Ie=T(17626),Ge=T(87601),Je=T(41528);class xe extends Je.W{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=se.d.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}}(0,Ie._)([(0,Ge.o)({count:se.d.COUNT})],xe.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,Ie._)([(0,Ge.o)()],xe.prototype,"spherical",void 0),(0,Ie._)([(0,Ge.o)()],xe.prototype,"occlusionTestEnabled",void 0),(0,Ie._)([(0,Ge.o)()],xe.prototype,"hasVerticalOffset",void 0),(0,Ie._)([(0,Ge.o)()],xe.prototype,"hasScreenSizePerspective",void 0),(0,Ie._)([(0,Ge.o)()],xe.prototype,"depthHudEnabled",void 0),(0,Ie._)([(0,Ge.o)()],xe.prototype,"depthHudAlignStartEnabled",void 0),(0,Ie._)([(0,Ge.o)()],xe.prototype,"hasSlicePlane",void 0),(0,Ie._)([(0,Ge.o)()],xe.prototype,"hasMultipassGeometry",void 0),(0,Ie._)([(0,Ge.o)({constValue:!0})],xe.prototype,"hasSliceInVertexProgram",void 0),(0,Ie._)([(0,Ge.o)({constValue:!1})],xe.prototype,"isDraped",void 0);class je extends X.F5{constructor(Ye){super(Ye,new Ne),this.techniqueConfig=new xe,this._uniqueMaterialIdentifier=je.uniqueMaterialIdentifier(this.parameters)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}getPassParameters(){return this.parameters}getConfiguration(Ye,ze){const et=(null==ze?void 0:ze.slot)!==de.r.LINE_CALLOUTS;return this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.hasVerticalOffset=(0,H.pC)(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=(0,H.pC)(this.parameters.screenSizePerspective),this.techniqueConfig.depthHudEnabled=et,this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?se.d.Screen:se.d.World,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasMultipassGeometry=!!ze&&ze.multipassGeometry.enabled,this.techniqueConfig}intersect(){}requiresSlot(Ye){switch(Ye){case de.r.LINE_CALLOUTS:case de.r.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(Ye){return Ye.output===ne.H.Color?new We(Ye):null}createBufferWriter(){return new $e}validateParameters(Ye){const ze=je.uniqueMaterialIdentifier(Ye);ze!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=ze)}static uniqueMaterialIdentifier(Ye){return JSON.stringify({screenOffset:Ye.screenOffset||[0,0],centerOffsetUnits:Ye.centerOffsetUnits||"world"})}}class We extends ae.Z{beginSlot(Ye){return this.ensureTechnique(Ce,Ye)}}class Ne extends X.Mt{constructor(){super(...arguments),this.screenOffset=J.Z,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const we=(0,$.U$)().vec3f(U.T.POSITION).vec3f(U.T.NORMAL).vec2f(U.T.UV0).vec4f(U.T.AUXPOS1),Oe=[(0,ee.f)(0,0),(0,ee.f)(1,0),(0,ee.f)(0,1),(0,ee.f)(1,0),(0,ee.f)(1,1),(0,ee.f)(0,1)];class $e{constructor(){this.vertexBufferLayout=we}allocate(Ye){return this.vertexBufferLayout.createBuffer(Ye)}elementCount(Ye){return 6*Ye.indices.get(U.T.POSITION).length}write(Ye,ze,et,ke){(0,_e.ho)(ze.indices.get(U.T.POSITION),ze.vertexAttributes.get(U.T.POSITION).data,Ye.transformation,et.position,ke,6),(0,_e.s5)(ze.indices.get(U.T.NORMAL),ze.vertexAttributes.get(U.T.NORMAL).data,Ye.invTranspTransformation,et.normal,ke,6),(0,_e.SW)(ze.indices.get(U.T.AUXPOS1),ze.vertexAttributes.get(U.T.AUXPOS1).data,et.auxpos1,ke,6);for(let ot=0;ot<Oe.length;++ot)et.uv0.setVec(ke+ot,Oe[ot])}}class Be extends ue.k{constructor(Ye,ze){super(Ye,null,ze,ve),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}doLoad(){var Ye=this;return(0,G.Z)(function*(){Ye._material=new je(Ye.materialParameters),Ye._context.stage.add(Ye._material)})()}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(Ye){const ze=this.materialParameters;return ze.screenOffset=Ye.screenOffset||J.Z,ze.centerOffsetUnits=Ye.centerOffsetUnits||"world",ze}get materialParameters(){const Ye=this.symbol,ze=Ye.callout,et=(0,H.pC)(ze.color)?Q.Z.toUnitRGBA(ze.color):[0,0,0,0];et[3]*=this._getLayerOpacity();const ke=(0,re.F2)(ze.size||0);let ot=null;if(Ye.verticalOffset){const{screenLength:Ft,minWorldLength:bt,maxWorldLength:St}=Ye.verticalOffset;ot={screenLength:(0,re.F2)(Ft),minWorldLength:bt||0,maxWorldLength:null!=St?St:1/0}}const at=(0,H.pC)(ze.border)&&(0,H.pC)(ze.border.color)?Q.Z.toUnitRGBA(ze.border.color):null,yt="object"===Ye.symbolLayers.getItemAt(0).type;return{color:et,size:ke,verticalOffset:ot,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:at,occlusionTest:!yt,shaderPolygonOffset:yt?0:void 0,depthHUDAlignStart:"label-3d"===Ye.type,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:X.yD.Occlude,__tagStrict:"NoParameters"}}_defaultElevationInfoNoZ(){return Fe}createGraphics3DGraphic(Ye){const ze=Ye.renderingInfo,et=Ye.graphic,ke=this.setGraphicElevationContext(et,new Z.o,ze.elevationOffset||0),ot=ze.symbol,at="on-the-ground"===this._elevationContext.mode&&("cim"===ot.type||!ot.symbolLayers.some(wt=>"object"===wt.type||"text"===wt.type));if("label-3d"!==ot.type&&at||"point-3d"===ot.type&&ot.symbolLayers.every(wt=>"text"===wt.type&&!(0,A.as)(wt)))return null;const yt=(0,ce.zE)(et.geometry);return(0,H.Wi)(yt)?null:this._createAs3DShape(yt,ke,ze,et.uid)}layerOpacityChanged(){return(0,H.Wi)(this._material)||this._material.setParameters(this.materialParameters),!0}layerElevationInfoChanged(Ye,ze,et){const ot=(0,B.GC)(Be.elevationModeChangeTypes,et,this._elevationContext.mode);return ot!==B.lO.UPDATE||Ye.forEach(at=>{const yt=ze(at);(0,H.pC)(yt)&&this.updateGraphicElevationContext(at.graphic,yt)}),ot}slicePlaneEnabledChanged(){return(0,H.Wi)(this._material)||this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}setGraphicElevationContext(Ye,ze,et=0){const ke=super.setGraphicElevationContext(Ye,ze);return ke.addOffsetRenderUnits(et),ke}updateGraphicElevationContext(Ye,ze){this.setGraphicElevationContext(Ye,ze.elevationContext,ze.metadata.elevationOffset),ze.needsElevationUpdates=(0,B.Xf)(ze.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:le.WU.memory}}_createVertexData(Ye){const{translation:ze,centerOffset:et}=Ye;return[[U.T.POSITION,ze?{size:3,data:[ze[0],ze[1],ze[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],[U.T.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[U.T.AUXPOS1,et?{size:4,data:[et[0],et[1],et[2],et[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]}_getOrCreateMaterial(Ye){const ze=this._perInstanceMaterialParameters(Ye),et=je.uniqueMaterialIdentifier(ze);if((0,H.pC)(this._material)&&et===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(Ye.materialCollection){let ke=Ye.materialCollection.get(et);return(0,H.Wi)(ke)&&(ke=new je(ze),Ye.materialCollection.add(et,ke)),{material:ke,isUnique:!1}}return{material:new je(ze),isUnique:!0}}_createAs3DShape(Ye,ze,et,ke){const ot=[new j.Z(this._createVertexData(et),De,Y.MX.Point)],at=this._getOrCreateMaterial(et),yt=(0,oe.km)(this._context,Ye,ot,[at.material],ze,this._context.layer.uid,ke);if(null===yt)return null;const wt=new ie.z(this,yt.object,ot,at.isUnique?[at.material]:null,null,W.j3,ze);return wt.metadata={elevationOffset:et.elevationOffset||0},wt.alignedSampledElevation=yt.sampledElevation,wt.needsElevationUpdates=(0,B.Xf)(ze.mode),(0,oe.dO)(wt,Ye,this._context.elevationProvider),wt}}Be.elevationModeChangeTypes={definedChanged:B.lO.UPDATE,staysOnTheGround:B.lO.UPDATE,onTheGroundChanged:B.lO.RECREATE};const Se=new Uint16Array([0]),De=[[U.T.POSITION,Se],[U.T.NORMAL,Se],[U.T.AUXPOS1,Se]],Fe={mode:"relative-to-ground",offset:0},ve={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1},Ke=x.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function qe(tt,Ye){if(!(0,A.Pd)(tt))return Ke.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${tt.type}' does not support callouts`),null;if(!tt.callout)return null;const ze=be[tt.callout.type];return ze?new ze(tt,Ye):(Ke.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${tt.callout.type}`),null)}const be={line:Be}},23641:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>x});class x{constructor(G,Q,H){this.graphic=G,this.renderingInfo=Q,this.layer=H}}},93927:(dt,Re,T)=>{"use strict";T.d(Re,{z:()=>ie});var x=T(15861),A=T(62208),G=T(84161),Q=T(28093),H=T(5548),re=T(97126),J=T(74746),W=T(67225),B=T(42743),Z=T(17803);class ie{constructor(X,U,ee,$,ne,se,ae,de=null){this.graphics3DSymbolLayer=X,this.stageObject=U,this._uniqueGeometries=ee,this._uniqueMaterials=$,this._sharedResource=ne,this.elevationAligner=se,this.elevationContext=ae,this._edgeState=de,this.type="object3d",this._stageLayer=null,this._stage=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1,this.graphics3DSymbolLayer=X,this.stageObject=U}get isElevationSource(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}initialize(X,U){this._stageLayer=U,this._stage=X,X.addMany(this._uniqueMaterials),X.addMany(this._uniqueGeometries),X.add(this.stageObject)}destroy(){const X=this._stage;this._stageLayer&&(X.removeMany(this._uniqueMaterials),X.removeMany(this._uniqueGeometries)),X.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const U=this._stage.renderView.ensureEdgeView();U.hasObject(this.stageObject)&&U.removeObject(this.stageObject),this.stageObject.dispose(),(0,A.pC)(this._sharedResource)&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null,this._stage=null}layerOpacityChanged(X,U){if((0,A.Wi)(this._edgeState))return;const ee=ue(this._edgeState.baseMaterial);let $=!1;for(const ne of this._edgeState.edgeMaterials)ne.objectTransparency!==ee&&(ne.objectTransparency=ee,$=!0);$&&this._resetEdgeObject(U),this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[X])}slicePlaneEnabledChanged(X,U){(0,A.Wi)(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:X},!U),this._edgeState.properties.hasSlicePlane=X)}setVisibility(X){if(null!=this._stage&&this._visible!==X&&(this._visible=X,this._visible?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),(0,A.pC)(this._edgeState))){const U=this._stage.renderView.ensureEdgeView();U.hasObject(this.stageObject)?U.updateObjectVisibility(this.stageObject,X):X&&this._addOrUpdateEdgeObject(U,!1)}}get visible(){return this._visible}alignWithElevation(X,U,ee,$){null!=this.elevationAligner&&((0,A.pC)(ee)&&(0,J.aO)(this.elevationContext.featureExpressionInfoContext,ee),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,X,U),this._resetEdgeObject($))}getCenterObjectSpace(X=(0,Q.c)()){return(0,G.c)(X,(0,re.g)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(X=(0,H.Ue)()){const U=this.stageObject.boundingVolumeObjectSpace;return(0,H.op)(X,U.min),(0,H.Tn)(X,U.max),X}computeAttachmentOrigin(X){if(this.useObjectOriginAsAttachmentOrigin){const U=this.stageObject.transformation;X.render.origin[0]+=U[12],X.render.origin[1]+=U[13],X.render.origin[2]+=U[14],X.render.num++}else for(const U of this.stageObject.geometryRecords)U.computeAttachmentOrigin(le)&&((0,G.m)(le,le,this.stageObject.transformation),(0,G.a)(X.render.origin,X.render.origin,le),X.render.num++)}getProjectedBoundingBox(X,U,ee,$,ne){var se=this;return(0,x.Z)(function*(){const ae=se.getBoundingBoxObjectSpace(ne),de=Y,_e=(0,H.wp)(ae)?1:de.length;for(let he=0;he<_e;he++){const ge=de[he];oe[0]=ae[ge[0]],oe[1]=ae[ge[1]],oe[2]=ae[ge[2]],(0,G.m)(oe,oe,se.stageObject.transformation),ce[3*he+0]=oe[0],ce[3*he+1]=oe[1],ce[3*he+2]=oe[2]}if(!X(ce,0,_e))return null;(0,H.cS)(ae);let pe=null;se.calculateRelativeScreenBounds&&(pe=se.calculateRelativeScreenBounds());for(let he=0;he<3*_e;he+=3){for(let ge=0;ge<3;ge++)ae[ge]=Math.min(ae[ge],ce[he+ge]),ae[ge+3]=Math.max(ae[ge+3],ce[he+ge]);pe&&ee.push({location:ce.slice(he,he+3),screenSpaceBoundingRect:pe})}if(U&&U.service&&"absolute-height"!==se.elevationContext.mode){(0,H.be)(ae,le);const he="relative-to-scene"===se.elevationContext.mode?"scene":"ground";let ge=0;if(U.useViewElevation)ge=(0,A.Pt)(U.service.getElevation(le[0],le[1],he),0);else try{const ye=(0,W.Si)(ae,U);ge=(0,A.Pt)(yield U.service.queryElevation(le[0],le[1],$,ye,he),0)}catch(ye){}(0,H.cv)(ae,0,0,-se.alignedSampledElevation+ge)}return ae})()}addObjectState(X,U){X===B.V_.Highlight&&U.addObject(this.stageObject,this.stageObject.highlight()),X===B.V_.MaskOccludee&&U.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(X){X.removeObject(this.stageObject)}_resetEdgeObject(X){if((0,A.Wi)(this._edgeState))return;const U=this._stage.renderView.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(U,X):U.removeObject(this.stageObject)}_addOrUpdateEdgeObject(X,U){const ee=this._edgeState;if((0,A.Wi)(ee))return;const $=ue(ee.baseMaterial);for(const ne of ee.edgeMaterials)ne.objectTransparency=$;X.addOrUpdateObject3D(this.stageObject,ee.edgeMaterials,ee.properties,!U).then(()=>{var ne;return null==(ne=this._stageLayer)?void 0:ne.sync()})}}function ue(j){return j.isVisible?j.parameters.transparent?Z.i.TRANSPARENT:Z.i.OPAQUE:Z.i.INVISIBLE}const ce=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],oe=(0,Q.c)(),le=(0,Q.c)(),Y=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},95428:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>kE});var x=T(15861),A=T(59213),G=T(62208),Q=T(10699),H=T(27306),re=T(27899),J=T(67831),W=T(99770),B=T(84161),Z=T(28093),ie=T(37118),ue=T(55915),ce=T(5548),oe=T(65401),le=T(38114),Y=T(82054),j=T(79721),X=T(74746);const U=new re.Z(Array,It=>(0,ce.t8)(It,ce.xE),null,10,5),ee=(0,oe.Ue)();class ${constructor(Ae,He,it,ht,Dt){this.graphic=Ae,this.graphics3DSymbol=He,this.graphics=it,this._labelGraphics=new Array,this._auxiliaryGraphics=new Array,this._visibilityFlags=function ne(It,Ae){const He=new Array(It);for(let it=0;it<He.length;it++)He[it]=new Array(Ae);return He}(j.E._COUNT,j.P._COUNT),this._featureExpressionFeature=null,this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1},this._extent=null,this.isElevationSource=!1,++He.referenced,this._featureExpressionFeature=Dt?(0,X.Tz)(Dt,Ae,ht):null;for(const Vt of it)(0,G.pC)(Vt)&&(this.isElevationSource=this.isElevationSource||Vt.isElevationSource)}get labelGraphics(){return this._labelGraphics}get extent(){return this._extent}initialize(Ae,He){this._layer=He,this._stage=Ae,this._forEachSymbolLayerGraphic(it=>{it.initialize(Ae,He),it.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(Ae=>Ae.destroy()),this.graphics=null,this._auxiliaryGraphics=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.graphics}clearLabelGraphics(){this._forEachLabelGraphic(Ae=>Ae.destroy()),this._labelGraphics.length=0}addLabelGraphic(Ae,He,it){this._labelGraphics.push(Ae),Ae.initialize(He,it),Ae.setVisibility(this.isVisible(j.E.LABEL))}addAuxiliaryGraphic(Ae){this._auxiliaryGraphics.push(Ae),this._layer&&(Ae.initialize(this._stage,this._layer),Ae.setVisibility(this.isVisible()))}get isDraped(){let Ae=!1;return this._forEachSymbolLayerGraphic(He=>{"draped"===He.type&&(Ae=!0)}),Ae}isVisible(Ae=j.E.GRAPHIC,He){for(let it=0;it<=Ae;it++){const ht=this._visibilityFlags[it];for(let Dt=0;Dt<ht.length;++Dt)if(!1===ht[Dt]&&Dt!==He)return!1}return!0}hasVisibilityFlag(Ae,He){return null!=this._visibilityFlags[He][Ae]}setVisibilityFlag(Ae,He,it){const ht=this.isVisible(it);this._visibilityFlags[it][Ae]=He;const Dt=this.isVisible(it);if(ht===Dt)return!1;if(it===j.E.LABEL)this._forEachLabelGraphic(Vt=>Vt.setVisibility(Dt));else{this._forEachSymbolLayerGraphic(Qt=>Qt.setVisibility(Dt));const Vt=this.isVisible(j.E.LABEL);this._forEachLabelGraphic(Qt=>Qt.setVisibility(Vt))}return!0}clearVisibilityFlag(Ae,He=j.E.GRAPHIC){return this.setVisibilityFlag(Ae,void 0,He)}computeExtent(Ae){if(!this._extent){const He=this.graphic.geometry;if((0,G.Wi)(He))return!1;this._extent=(0,oe.Ue)(),(0,le.TF)(He,this._extent);const it=He.spatialReference;if(!it.equals(Ae)&&!(0,ue.dH)(this._extent,it,this._extent,Ae))return this._extent=null,!1}return!0}getAsOptimizedGeometry(Ae,He){return(0,G.pC)(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===Ae&&this._optimizedGeometry.hasM===He||(this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,Ae,He),this._optimizedGeometry.hasZ=Ae,this._optimizedGeometry.hasM=He),this._optimizedGeometry.geometry}_convertGraphicToOptimizedGeometry(Ae,He,it){let ht=Ae.geometry;return"mesh"!==ht.type&&"extent"!==ht.type||(ht=ie.Z.fromExtent("mesh"===ht.type?ht.extent:ht)),(0,Y.GH)(ht,He,it)}get usedMemory(){let Ae=(0,H.f2)(this.graphic.attributes);return this._forEachSymbolLayerGraphic(He=>{const it=He.graphics3DSymbolLayer.complexity;if((0,G.Wi)(it))return;const ht="draped"===He.type?it.memory.draped:it.memory;Ae+=ht.bytesPerFeature,ht.bytesPerCoordinate&&(Ae+=(0,le.R3)(this.graphic.geometry)*ht.bytesPerCoordinate)}),Ae}computeAttachmentOrigin(){const Ae={render:{origin:(0,Z.c)(),num:0},draped:{origin:(0,W.a)(),num:0}};for(const He of this.graphics)(0,G.Wi)(He)||He.computeAttachmentOrigin(Ae);return Ae.render.num&&(0,B.g)(Ae.render.origin,Ae.render.origin,1/Ae.render.num),Ae.draped.num&&(0,J.f)(Ae.draped.origin,Ae.draped.origin,1/Ae.draped.num),Ae}getProjectedBoundingBox(Ae,He,it,ht,Dt){var Vt=this;return(0,x.Z)(function*(){return Dt||(Dt={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),Dt.boundingBox?(0,ce.cS)(Dt.boundingBox):Dt.boundingBox=(0,ce.cS)(),Dt.requiresDrapedElevation=!1,yield(0,A.Ed)(Vt.graphics,function(){var Qt=(0,x.Z)(function*(cr){if((0,G.Wi)(cr))return;const xr="draped"===cr.type?He:Ae,Xr=U.acquire(),Vr=yield cr.getProjectedBoundingBox(xr,it,Dt.screenSpaceObjects,ht,Xr);isFinite(Vr[2])&&isFinite(Vr[5])||(Dt.requiresDrapedElevation=!0),Vr&&(0,ce.TC)(Dt.boundingBox,Xr),U.release(Xr)});return function(cr){return Qt.apply(this,arguments)}}()),(0,ce.sU)(Dt.boundingBox)||(0,oe.sU)((0,ce.y8)(Dt.boundingBox,ee))?Dt:null})()}needsElevationUpdates(){for(const Ae of this.graphics)if((0,G.pC)(Ae)&&("object3d"===Ae.type||"lod-instance"===Ae.type)&&Ae.needsElevationUpdates)return!0;for(const Ae of this._labelGraphics)if(Ae&&Ae.needsElevationUpdates)return!0;return!1}alignWithElevation(Ae,He,it){this._forEachRenderedGraphic(ht=>{"object3d"!==ht.type&&"lod-instance"!==ht.type||ht.alignWithElevation(Ae,He,this._featureExpressionFeature,it)})}addObjectStateSet(Ae,He){this._forEachSymbolLayerGraphic(it=>it.addObjectState(Ae,He))}removeObjectState(Ae){this._forEachSymbolLayerGraphic(He=>He.removeObjectState(Ae))}_forEachGraphicList(Ae,He){Ae.forEach(it=>it&&He(it))}_forEachSymbolLayerGraphic(Ae){this._forEachGraphicList(this.graphics,Ae),this._forEachGraphicList(this._auxiliaryGraphics,Ae)}_forEachLabelGraphic(Ae){this._forEachGraphicList(this._labelGraphics,Ae)}_forEachRenderedGraphic(Ae){this._forEachSymbolLayerGraphic(Ae),this._forEachLabelGraphic(Ae)}}var se=T(93927),ae=T(63290),de=T(26584),_e=T(11915),pe=T(30217),he=T(550),ge=T(28347),ye=T(43703),Me=T(60479),Ee=T(79800),Te=T(39256),me=T(59617),Ce=T(81468),Ie=T(79112),Ge=T(18422),Je=T(67225),xe=T(64538),We=(T(29132),T(85334)),Ne=T(64835),we=T(52107),Oe=T(16396),$e=T(2004);function Be(It){const Ae=[[Oe.T.POSITION,It.indices]],He=[[Oe.T.POSITION,{size:3,data:It.attributeData.position,exclusive:!0}]];return(0,G.pC)(It.attributeData.color)&&(He.push([Oe.T.COLOR,{size:4,data:It.attributeData.color,exclusive:!0}]),Ae.push([Oe.T.COLOR,new Uint32Array(It.indices.length)])),(0,G.pC)(It.attributeData.uvMapSpace)&&(He.push([Oe.T.UVMAPSPACE,{size:4,data:It.attributeData.uvMapSpace,exclusive:!0}]),Ae.push([Oe.T.UVMAPSPACE,It.indices])),(0,G.pC)(It.attributeData.boundingRect)&&(He.push([Oe.T.BOUNDINGRECT,{size:9,data:It.attributeData.boundingRect,exclusive:!0}]),Ae.push([Oe.T.BOUNDINGRECT,It.indices])),(0,G.pC)(It.attributeData.mapPosition)&&(He.push([Oe.T.MAPPOS,{size:3,data:It.attributeData.mapPosition,exclusive:!0}]),Ae.push([Oe.T.MAPPOS,It.indices])),new we.Z(He,Ae)}function Se(It){const Ae=[[Oe.T.POSITION,It.indices],[Oe.T.UV0,It.indices]],He=[[Oe.T.POSITION,{size:3,data:It.attributeData.position,exclusive:!0}],[Oe.T.UV0,{size:2,data:It.attributeData.uv0,exclusive:!0}]];return(0,G.pC)(It.attributeData.mapPosition)&&(He.push([Oe.T.MAPPOS,{size:3,data:It.attributeData.mapPosition,exclusive:!0}]),Ae.push([Oe.T.MAPPOS,It.indices])),new we.Z(He,Ae)}function De(It){switch(It.type){case"extent":if(It instanceof $e.Z)return ie.Z.fromExtent(It);break;case"polygon":return It}return null}function Fe(It,Ae,He,it){const ht=(0,We.Mk)(It.rings,It.hasZ,We.ZI.CCW_IS_HOLE),Dt=new Float64Array(ht.position.length),Vt=(0,Ce.rR)(ht.position,It.spatialReference,0,Dt,0,ht.position,0,ht.position.length/3,Ae,He,it),Qt=null!=Vt;return{position:ht.position,mapPosition:Dt,polygons:qe(ht.polygons,ht.position,Dt),outlines:Ke(ht.outlines,ht.position,Dt),projectionSuccess:Qt,sampledElevation:Vt}}function ve(It,Ae){const He=(0,We.Mk)(It.rings,!1,We.ZI.CCW_IS_HOLE),it=(0,ue.CM)(He.position,It.spatialReference,0,He.position,Ae,0,He.position.length/3);for(let ht=2;ht<He.position.length;ht+=3)He.position[ht]=Ne.Rn;return{position:He.position,polygons:qe(He.polygons,He.position),outlines:Ke(He.outlines,He.position),projectionSuccess:it}}function Ke(It,Ae,He){const it=new Array;for(const{index:ht,count:Dt}of It){if(Dt<=1)continue;const Vt=3*ht,Qt=Vt+3*Dt;it.push({index:ht,count:Dt,position:Ae.subarray(Vt,Qt),mapPosition:He?He.subarray(Vt,Qt):void 0})}return it}function qe(It,Ae,He){const it=new Array;for(const{index:ht,count:Dt,holeIndices:Vt,pathLengths:Qt}of It){if(Dt<=1)continue;const cr=3*ht,xr=cr+3*Dt,Xr=Vt.map(Vr=>Vr-ht);it.push({index:ht,count:Dt,holeIndices:Xr,pathLengths:Qt,position:Ae.subarray(cr,xr),mapPosition:He?He.subarray(cr,xr):void 0})}return it}var be=T(2180),tt=T(93605),Ye=T(53929),ze=T(42743),et=T(97272),ke=T(28523);const ot=["polygon","extent"];function yt(It,Ae,He,it){const ht=new Uint32Array(It.length),Dt=[[Oe.T.POSITION,{size:3,data:He.positions,exclusive:!0}],[Oe.T.NORMAL,{size:3,data:He.normals,exclusive:!0}],[Oe.T.COLOR,{size:4,data:it,exclusive:!0}],[Oe.T.SIZE,{size:1,data:He.heights,exclusive:!0}]],Vt=[[Oe.T.POSITION,It],[Oe.T.NORMAL,It],[Oe.T.COLOR,ht]];return He.elevation&&(Dt.push([Oe.T.MAPPOS,{size:3,data:He.elevation}]),Vt.push([Oe.T.MAPPOS,It])),new we.Z(Dt,Vt,ze.MX.Triangle,Ae)}function wt(It,Ae,He,it,ht,Dt,Vt,Qt,cr,xr,Xr,Vr,ei,di){let vi=0,Zi=2*it.count;(function zt(It,Ae,He,it,ht,Dt,Vt,Qt,cr,xr,Xr,Vr,ei,di,_t,vi,Zi,Oi){(0,B.c)(er,Zi);const Li=vi>0?1:-1;let os=3*He,mn=Vr,Bs=3*mn,Rn=Vr+it,un=3*Rn;for(let jn=0;jn<it;++jn)Oi&&(er[0]=It[os+0],er[1]=It[os+1],er[2]=It[os+2],(0,B.n)(er,er)),Qt[Bs+0]=It[os+0],Qt[Bs+1]=It[os+1],Qt[Bs+2]=It[os+2],cr[Bs+0]=Ae[os+0],cr[Bs+1]=Ae[os+1],cr[Bs+2]=Ae[os+2],xr[Bs+0]=-Li*er[0],xr[Bs+1]=-Li*er[1],xr[Bs+2]=-Li*er[2],Xr[mn]=0,Qt[un+0]=It[os+0]+vi*er[0],Qt[un+1]=It[os+1]+vi*er[1],Qt[un+2]=It[os+2]+vi*er[2],cr[un+0]=Ae[os+0],cr[un+1]=Ae[os+1],cr[un+2]=Ae[os+2],xr[un+0]=Li*er[0],xr[un+1]=Li*er[1],xr[un+2]=Li*er[2],Xr[Rn]=vi,Bs+=3,un+=3,os+=3,mn+=1,Rn+=1;os=3*Dt,Bs=0,un=3*_t;const yo=vi<0?ir:tr,wn=vi<0?tr:ir;for(let jn=0;jn<Vt;++jn)di[Bs+0]=ht[os+yo[0]],di[Bs+1]=ht[os+yo[1]],di[Bs+2]=ht[os+yo[2]],ei[un+0]=ht[os+wn[0]]+it,ei[un+1]=ht[os+wn[1]]+it,ei[un+2]=ht[os+wn[2]]+it,Bs+=3,un+=3,os+=3})(It,Ae,it.index,it.count,He,0,He.length/3,ht,Dt,Vt,Qt,cr,xr,Xr,Zi,Vr,ei,di),Zi=0,bt(ht,Dt,Qt,Vt,vi,it.pathLengths[0],it.count,cr+=2*it.count,xr,Zi,Vr),cr+=4*it.pathLengths[0],Zi+=2*it.pathLengths[0],vi+=it.pathLengths[0];for(let Oi=1;Oi<it.pathLengths.length;++Oi)bt(ht,Dt,Qt,Vt,vi,it.pathLengths[Oi],it.count,cr,xr,Zi,Vr),cr+=4*it.pathLengths[Oi],Zi+=2*it.pathLengths[Oi],vi+=it.pathLengths[Oi]}function Rt(It,Ae,He,it,ht,Dt,Vt){it[Dt]=it[Vt],It[0+(Dt*=3)]=It[0+(Vt*=3)],It[Dt+1]=It[Vt+1],It[Dt+2]=It[Vt+2],Ae[Dt+0]=Ae[Vt+0],Ae[Dt+1]=Ae[Vt+1],Ae[Dt+2]=Ae[Vt+2],He[Dt+0]=ht[0],He[Dt+1]=ht[1],He[Dt+2]=ht[2]}const Ft=(0,Z.c)();function bt(It,Ae,He,it,ht,Dt,Vt,Qt,cr,xr,Xr){let Vr=ht,ei=ht+1,di=ht+Vt,_t=ht+Vt+1,vi=Qt,Zi=Qt+1,Oi=Qt+2*Dt,Li=Qt+2*Dt+1;Xr<0&&(Vr=ht+Vt+1,_t=ht),xr*=3;for(let os=0;os<Dt;++os)os===Dt-1&&(Xr>0?(ei=ht,_t=ht+Vt):(ei=ht,Vr=ht+Vt)),Lr(It,Vr,ei,di,Ft),Rt(It,Ae,it,He,Ft,vi,Vr),Rt(It,Ae,it,He,Ft,Zi,ei),Rt(It,Ae,it,He,Ft,Oi,di),Rt(It,Ae,it,He,Ft,Li,_t),cr[xr++]=vi,cr[xr++]=Oi,cr[xr++]=Li,cr[xr++]=vi,cr[xr++]=Li,cr[xr++]=Zi,Vr++,ei++,di++,_t++,vi+=2,Zi+=2,Oi+=2,Li+=2}const St=(0,Z.c)(),Xt=(0,Z.c)(),Mr=(0,Z.c)(),Cr=(0,Z.c)(),Yr=(0,Z.c)();function Lr(It,Ae,He,it,ht){Ae*=3,He*=3,it*=3,(0,B.s)(St,It[Ae++],It[Ae++],It[Ae++]),(0,B.s)(Xt,It[He++],It[He++],It[He++]),(0,B.s)(Mr,It[it++],It[it++],It[it++]),(0,B.b)(Cr,Xt,St),(0,B.b)(Yr,Mr,St),(0,B.f)(ht,Yr,Cr),(0,B.n)(ht,ht)}const ct=(0,Z.c)();function jt(It,Ae,He,it){const ht=It.stageObject,Dt=ht.geometryRecords,Vt=Dt.length,Qt="absolute-height"!==Ae.mode;let cr=0;const xr=ht.transformation,Xr=(0,ge.a)((0,ye.c)(),xr);for(let Vr=0;Vr<Vt;Vr+=2){const ei=Dt[Vr].geometry,di=ei.getMutableAttribute(Oe.T.POSITION).data,_t=ei.vertexAttributes.get(Oe.T.SIZE).data,vi=ei.vertexAttributes.get(Oe.T.MAPPOS).data,Zi=new Ye.sb(vi),Oi=di.length/3;let Li=0,os=!1,mn=0;const Bs=He.spatialReference;for(let Rn=0;Rn<Oi;Rn++){ct[0]=di[Li],ct[1]=di[Li+1],ct[2]=di[Li+2],(0,Ce.qZ)(Zi,He,Ae,it,Zt),Qt&&(mn+=Zt.sampledElevation),tt.Z.TESTS_DISABLE_OPTIMIZATIONS?((0,B.s)(qt,Zi.array[Zi.offset+0],Zi.array[Zi.offset+1],Zt.z+_t[Li/3]),it.toRenderCoords(qt,Bs,qt),(0,B.m)(qt,qt,Xr)):((0,B.s)(qt,di[Li+0],di[Li+1],di[Li+2]),(0,B.m)(qt,qt,xr),it.setAltitude(qt,Zt.z+_t[Li/3]),(0,B.m)(qt,qt,Xr)),di[Li]=qt[0],di[Li+1]=qt[1],di[Li+2]=qt[2];const un=fr/it.unitInMeters;(Math.abs(ct[0]-di[Li])>=un||Math.abs(ct[1]-di[Li+1])>=un||Math.abs(ct[2]-di[Li+2])>=un)&&(os=!0),Zi.offset+=3,Li+=3}os&&(ei.invalidateBoundingInfo(),ht.geometryVertexAttrsUpdated(Dt[Vr]),Dt[Vr+1].geometry.invalidateBoundingInfo(),ht.geometryVertexAttrsUpdated(Dt[Vr+1])),cr+=mn/Oi}return cr/Vt}const qt=(0,Z.c)(),er=(0,Z.c)(),Zt=new Ce.Lm,tr=[0,2,1],ir=[0,1,2],fr=.01;var Ur=T(91558),Zr=(T(20383),T(8314)),ri=T(23841),hr=T(21726),Dr=T(993),Kr=T(4794),Nt=T(46679),lr=T(33215),jr=T(86606),Ot=T(39236),rr=T(80960),pr=T(46807),Pr=T(54840);class Fr{constructor(Ae,He,it,ht){this.graphics3DSymbolLayer=Ae,this.renderGeometries=He,this.boundingBox=it,this._drapeSourceRenderer=ht,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(Ae){this.stage=Ae}setVisibility(Ae){if(null!=this.stage&&this._visible!==Ae){if(this._visible=Ae,Ae&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,Pr.$.Geometry.ADD);if(Ae||this._addedToStage){for(const He of this.renderGeometries)He.instanceParameters.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Pr.$.State.VISIBILITIES)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,Pr.$.Geometry.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(Ae=(0,Z.c)()){return(0,B.s)(Ae,0,0,0)}getBoundingBoxObjectSpace(Ae=(0,ce.Ue)()){return(0,ce.cS)(Ae)}addObjectState(Ae,He){Ae===ze.V_.Highlight&&(this.renderGeometries.forEach(it=>{const ht=it.addHighlight();He.addRenderGeometry(it,ht,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Pr.$.State.HIGHLIGHTS))}removeObjectState(Ae){this.renderGeometries.forEach(He=>{Ae.removeRenderGeometry(He)})}removeRenderGeometryObjectState(Ae,He){Ae.removeHighlight(He),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Pr.$.State.HIGHLIGHTS)}computeAttachmentOrigin(Ae){for(const He of this.renderGeometries)He.computeAttachmentOrigin(wi)&&(Ae.draped.origin[0]+=wi[0],Ae.draped.origin[1]+=wi[1],Ae.draped.num++)}getProjectedBoundingBox(Ae,He,it,ht,Dt){var Vt=this;return(0,x.Z)(function*(){(0,ce.cS)(Dt);for(let Qt=0;Qt<Vt.renderGeometries.length;Qt++)Vt._getRenderGeometryProjectedBoundingRect(Vt.renderGeometries[Qt],Ae,ii,it),(0,ce.VK)(Dt,ii);if(He){let Qt;(0,ce.be)(Dt,wi);const cr=(0,Je.Si)(Dt,He);try{Qt=yield He.service.queryElevation(wi[0],wi[1],ht,cr,"ground")}catch(xr){}(0,G.pC)(Qt)&&(Dt[2]=Math.min(Dt[2],Qt),Dt[5]=Math.max(Dt[5],Qt))}return Dt})()}_getRenderGeometryProjectedBoundingRect(Ae,He,it,ht){if(this.boundingBox)(0,ce.t8)(mi,this.boundingBox);else{const Dt=Ae.boundingSphere,Vt=Dt[3];mi[0]=Dt[0]-Vt,mi[1]=Dt[1]-Vt,mi[2]=Dt[2]-Vt,mi[3]=Dt[0]+Vt,mi[4]=Dt[1]+Vt,mi[5]=Dt[2]+Vt}return He(mi,0,2),this.calculateRelativeScreenBounds&&ht.push({location:(0,ce.be)(mi),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),(0,ce.y8)(mi,it)}}const ii=(0,oe.Ue)(),mi=(0,ce.Ue)(),wi=(0,Z.c)();var _i,Ii,ji,It,Qr=T(75688),Ni=T(92690),Hs=T(10596),Ar=T(21286),ni=T(21254);function Gi(It){return null!=It}function es(It){return"number"==typeof It}function zr(It){return"string"==typeof It}function hi(It,Ae){It&&It.push(Ae)}function ds(It,Ae,He,it,ht){const Dt=It.minSize,Vt=It.maxSize;if(It.expression)return hi(ht,"Could not convert size info: expression not supported"),!1;if(It.useSymbolValue){const Qt=it.symbolSize[He];return Ae.minSize[He]=Qt,Ae.maxSize[He]=Qt,Ae.offset[He]=Ae.minSize[He],Ae.factor[He]=0,Ae.type[He]=_i.DefinedSize,!0}if(Gi(It.field))return Gi(It.stops)?2===It.stops.length&&es(It.stops[0].size)&&es(It.stops[1].size)?(Mt(It.stops[0].size,It.stops[1].size,It.stops[0].value,It.stops[1].value,Ae,He),Ae.type[He]=_i.DefinedSize,!0):(hi(ht,"Could not convert size info: stops only supported with 2 elements"),!1):es(Dt)&&es(Vt)&&Gi(It.minDataValue)&&Gi(It.maxDataValue)?(Mt(Dt,Vt,It.minDataValue,It.maxDataValue,Ae,He),Ae.type[He]=_i.DefinedSize,!0):null!=ni.a[It.valueUnit]?(Ae.minSize[He]=-1/0,Ae.maxSize[He]=1/0,Ae.offset[He]=0,Ae.factor[He]=1/ni.a[It.valueUnit],Ae.type[He]=_i.DefinedSize,!0):"unknown"===It.valueUnit?(hi(ht,"Could not convert size info: proportional size not supported"),!1):(hi(ht,"Could not convert size info: scale-dependent size not supported"),!1);if(!Gi(It.field)){if(It.stops&&It.stops[0]&&es(It.stops[0].size))return Ae.minSize[He]=It.stops[0].size,Ae.maxSize[He]=It.stops[0].size,Ae.offset[He]=Ae.minSize[He],Ae.factor[He]=0,Ae.type[He]=_i.DefinedSize,!0;if(es(Dt))return Ae.minSize[He]=Dt,Ae.maxSize[He]=Dt,Ae.offset[He]=Dt,Ae.factor[He]=0,Ae.type[He]=_i.DefinedSize,!0}return hi(ht,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Mt(It,Ae,He,it,ht,Dt){const Vt=Math.abs(it-He)>0?(Ae-It)/(it-He):0;ht.minSize[Dt]=Vt>0?It:Ae,ht.maxSize[Dt]=Vt>0?Ae:It,ht.offset[Dt]=It-He*Vt,ht.factor[Dt]=Vt}function gi(It,Ae,He){It[4*Ae+0]=He.r/255,It[4*Ae+1]=He.g/255,It[4*Ae+2]=He.b/255,It[4*Ae+3]=He.a}function ss(It,Ae,He){const it=2===He&&"arithmetic"===It.rotationType;Ae.offset[He]=it?90:0,Ae.factor[He]=it?-1:1,Ae.type[He]=1}function ys(It,Ae,He){if(!It)return null;const it=!Ae.supportedTypes||!!Ae.supportedTypes.size,ht=!Ae.supportedTypes||!!Ae.supportedTypes.color,Dt=!Ae.supportedTypes||!!Ae.supportedTypes.rotation,Vt=!!Ae.supportedTypes&&!!Ae.supportedTypes.opacity,Qt=It.reduce((cr,xr)=>{if(!cr)return cr;if(xr.valueExpression)return hi(He,"Could not convert visual variables: arcade expressions not supported"),null;switch(xr.type){case"size":return it?function Hr(It,Ae,He,it){if(It.normalizationField||It.valueRepresentation)return hi(it,"Could not convert size info: unsupported property"),null;if(!function gs(It){return null==It||zr(It)}(It.field))return hi(it,"Could not convert size info: field is not a string"),null;if(Ae.size){if(It.field)if(Ae.size.field){if(It.field!==Ae.size.field)return hi(it,"Could not convert size info: multiple fields in use"),null}else Ae.size.field=It.field}else Ae.size={field:It.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[_i.Undefined,_i.Undefined,_i.Undefined]};let ht;switch(It.axis){case"width":return ht=ds(It,Ae.size,0,He,it),ht?Ae:null;case"height":return ht=ds(It,Ae.size,2,He,it),ht?Ae:null;case"depth":return ht=ds(It,Ae.size,1,He,it),ht?Ae:null;case"width-and-depth":return ht=ds(It,Ae.size,0,He,it),ht&&ds(It,Ae.size,1,He,it),ht?Ae:null;case null:case void 0:case"all":return ht=ds(It,Ae.size,0,He,it),ht=ht&&ds(It,Ae.size,1,He,it),ht=ht&&ds(It,Ae.size,2,He,it),ht?Ae:null;default:return hi(it,`Could not convert size info: unknown axis "${It.axis}""`),null}}(xr,cr,Ae,He):cr;case"color":return ht?function Ui(It,Ae,He){if(It.normalizationField)return hi(He,"Could not convert color info: unsupported property"),null;if(zr(It.field)){if(!It.stops)return hi(He,"Could not convert color info: missing stops or colors"),null;{if(It.stops.length>8)return hi(He,"Could not convert color info: too many color stops"),null;Ae.color={field:It.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};const it=It.stops;for(let ht=0;ht<8;++ht){const Dt=it[Math.min(ht,it.length-1)];Ae.color.values[ht]=Dt.value,gi(Ae.color.colors,ht,Dt.color)}}}else{if(!(It.stops&&It.stops.length>=0))return hi(He,"Could not convert color info: no field and no colors/stops"),null;{const it=It.stops&&It.stops.length>=0&&It.stops[0].color;Ae.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let ht=0;ht<8;ht++)Ae.color.values[ht]=1/0,gi(Ae.color.colors,ht,it)}}return Ae}(xr,cr,He):cr;case"opacity":return Vt?function is(It,Ae,He){if(It.normalizationField)return hi(He,"Could not convert opacity info: unsupported property"),null;if(zr(It.field)){if(!It.stops)return hi(He,"Could not convert opacity info: missing stops or opacities"),null;{if(It.stops.length>8)return hi(He,"Could not convert opacity info: too many opacity stops"),null;Ae.opacity={field:It.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};const it=It.stops;for(let ht=0;ht<8;++ht){const Dt=it[Math.min(ht,it.length-1)];Ae.opacity.values[ht]=Dt.value,Ae.opacity.opacityValues[ht]=Dt.opacity}}}else{if(!(It.stops&&It.stops.length>=0))return hi(He,"Could not convert opacity info: no field and no opacities/stops"),null;{const it=It.stops&&It.stops.length>=0&&It.stops[0].opacity;Ae.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let ht=0;ht<8;ht++)Ae.opacity.values[ht]=1/0,Ae.opacity.opacityValues[ht]=it}}return Ae}(xr,cr,He):null;case"rotation":return Dt?function ts(It,Ae,He){if(!zr(It.field))return hi(He,"Could not convert rotation info: field is not a string"),null;if(Ae.rotation){if(It.field)if(Ae.rotation.field){if(It.field!==Ae.rotation.field)return hi(He,"Could not convert rotation info: multiple fields in use"),null}else Ae.rotation.field=It.field}else Ae.rotation={field:It.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(It.axis){case"tilt":return ss(It,Ae.rotation,0),Ae;case"roll":return ss(It,Ae.rotation,1),Ae;case null:case void 0:case"heading":return ss(It,Ae.rotation,2),Ae;default:return hi(He,`Could not convert rotation info: unknown axis "${It.axis}""`),null}}(xr,cr,He):cr;default:return null}},{size:null,color:null,opacity:null,rotation:null});return!(It.length>0&&Qt)||Qt.size||Qt.color||Qt.opacity||Qt.rotation?Qt&&Qt.size&&!function Ir(It,Ae,He){for(let ht=0;ht<3;++ht){let Dt=Ae.unitInMeters;It.type[ht]===_i.DefinedSize&&(Dt*=Ae.modelSize[ht],It.type[ht]=_i.DefinedScale),It.minSize[ht]=It.minSize[ht]/Dt,It.maxSize[ht]=It.maxSize[ht]/Dt,It.offset[ht]=It.offset[ht]/Dt,It.factor[ht]=It.factor[ht]/Dt}let it;if(It.type[0]!==_i.Undefined)it=0;else if(It.type[1]!==_i.Undefined)it=1;else{if(It.type[2]===_i.Undefined)return hi(He,"No size axis contains a valid size or scale"),!1;it=2}for(let ht=0;ht<3;++ht)It.type[ht]===_i.Undefined&&(It.minSize[ht]=It.minSize[it],It.maxSize[ht]=It.maxSize[it],It.offset[ht]=It.offset[it],It.factor[ht]=It.factor[it],It.type[ht]=It.type[it]);return!0}(Qt.size,Ae,He)?null:Qt:null}function ps(It){return It&&null!=It.size}function Ds(It,Ae){if(!It)return{enabled:!1};if(tt.Z.TESTS_DISABLE_FAST_UPDATES)return{enabled:!1};const He=ys(It.visualVariables,Ae);return He?{enabled:!0,visualVariables:He,materialParameters:Un(He,Ae),requiresShaderTransformation:ps(He)}:{enabled:!1}}function Ps(It,Ae,He){if(!Ae||!It.enabled)return!1;const it=It.visualVariables,ht=ys(Ae.visualVariables,He);return!!ht&&!!(ms(it.size,ht.size,"size")&&ms(it.color,ht.color,"color")&&ms(it.rotation,ht.rotation,"rotation")&&ms(it.opacity,ht.opacity,"opacity"))&&(It.visualVariables=ht,It.materialParameters=Un(ht,He),It.requiresShaderTransformation=ps(ht),!0)}function ms(It,Ae,He){if(!!It!=!!Ae||It&&It.field!==Ae.field)return!1;if(It&&"rotation"===He){const it=It,ht=Ae;for(let Dt=0;Dt<3;Dt++)if(it.type[Dt]!==ht.type[Dt]||it.offset[Dt]!==ht.offset[Dt]||it.factor[Dt]!==ht.factor[Dt])return!1}return!0}function Un(It,Ae){const He={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},it=ps(It);return It&&It.size?(He.vvSizeEnabled=!0,He.vvSizeMinSize=It.size.minSize,He.vvSizeMaxSize=It.size.maxSize,He.vvSizeOffset=It.size.offset,He.vvSizeFactor=It.size.factor):It&&it&&(He.vvSizeValue=Ae.transformation.scale),It&&it&&(He.vvSymbolAnchor=Ae.transformation.anchor,He.vvSymbolRotationMatrix=(0,he.c)(),(0,ge.i)(gr),function ln(It,Ae,He,it=(0,ye.c)()){const ht=It||0,Dt=Ae||0,Vt=He||0;0!==ht&&(0,ge.g)(it,it,-ht/180*Math.PI),0!==Dt&&(0,ge.r)(it,it,Dt/180*Math.PI),0!==Vt&&(0,ge.o)(it,it,Vt/180*Math.PI)}(Ae.transformation.rotation[2],Ae.transformation.rotation[0],Ae.transformation.rotation[1],gr),(0,pe.f)(He.vvSymbolRotationMatrix,gr)),It&&It.color&&(He.vvColorEnabled=!0,He.vvColorValues=It.color.values,He.vvColorColors=It.color.colors),It&&It.opacity&&(He.vvOpacityEnabled=!0,He.vvOpacityValues=It.opacity.values,He.vvOpacityOpacities=It.opacity.opacityValues),He}(It=_i||(_i={}))[It.Undefined=0]="Undefined",It[It.DefinedSize=1]="DefinedSize",It[It.DefinedScale=2]="DefinedScale",function(It){It[It.Undefined=0]="Undefined",It[It.DefinedAngle=1]="DefinedAngle"}(Ii||(Ii={})),function(It){const Ae=(0,ye.c)(),He=(0,Z.c)();It.evaluateModelTransform=function it(Dt,Vt,Qt){if(!Dt.vvSizeEnabled)return Qt;(0,ge.c)(Ae,Qt);const cr=Dt.vvSymbolRotationMatrix;(0,ge.s)(gr,cr[0],cr[1],cr[2],0,cr[3],cr[4],cr[5],0,cr[6],cr[7],cr[8],0,0,0,0,1),(0,ge.m)(Ae,Ae,gr);for(let xr=0;xr<3;++xr)He[xr]=(0,Ar.uZ)(Dt.vvSizeOffset[xr]+Vt[0]*Dt.vvSizeFactor[xr],Dt.vvSizeMinSize[xr],Dt.vvSizeMaxSize[xr]);return(0,ge.h)(Ae,Ae,He),(0,ge.j)(Ae,Ae,Dt.vvSymbolAnchor),Ae},It.evaluateModelTransformScale=function ht(Dt,Vt,Qt){if(!Vt.vvSizeEnabled)return(0,B.s)(Dt,1,1,1);for(let cr=0;cr<3;++cr)Dt[cr]=(0,Ar.uZ)(Vt.vvSizeOffset[cr]+Qt[0]*Vt.vvSizeFactor[cr],Vt.vvSizeMinSize[cr],Vt.vvSizeMaxSize[cr]);return Dt}}(ji||(ji={}));const gr=(0,ye.c)(),Sr=ji.evaluateModelTransform,mr=ji.evaluateModelTransformScale;var Wr=T(57521),Di=T(53855),Wi=T(81695),ns=T(80805),Yi=T(94398);const hs=(0,ye.c)(),Ks=(0,Z.f)(0,0,1),tn=Hs.Ns,So=[tn/2,tn/2,1-tn/2,1-tn/2],Bn=[Hs.Ph*tn,Hs.Ph*tn];class _o extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}getCachedSize(){return{size:this._getIconSize()}}doLoad(Ae){var He=this;return(0,x.Z)(function*(){He._validateOrThrow();const it=He._prepareMaterialParameters(),ht=He._getPrimitive();if((0,G.pC)(ht))He._prepareResourcesPrimitive(it,ht);else{const Dt=(0,jr.nf)(He.symbol,He.symbolLayer),Vt=(0,hr.sJ)(Dt);Vt&&"application/json"===Vt.mediaType?yield He._prepareResourcesCIM(it,JSON.parse(Vt.data),Ae):yield He._prepareResourcesHref(it,Dt,Ae)}})()}_validateOrThrow(){if(this._drivenProperties.size)return;const Ae=(0,Je.bh)(this._getIconSize());if(Ae)throw new de.Z("graphics3diconsymbollayer:invalid-size",Ae)}_getIconSize(){const Ae=this.symbolLayer,He=Math.round(null!=Ae.size?(0,ri.F2)(Ae.size):16);return this._drivenProperties.size?Math.max(He,64):He}_generateTextureCIM(Ae){const He=this._getGraphicHash(Ae);let it=""===He?null:this._cimSymbolTextures.get(He);if(!it){const Dt=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,Ae,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",Dt.anchorPosition),it=new Wi.x(Dt.imageData,{width:Dt.imageData.width,height:Dt.imageData.height,powerOfTwoResizeMode:ze.CE.PAD}),this._cimSymbolTextures.set(He,it),this._context.stage.add(it)}return it}_computeSize(Ae,He){const it=Ae.width/Ae.height;return it>1?[He,Math.round(He/it)]:[Math.round(He*it),He]}_prepareMaterialParameters(){const Ae={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},He=this.symbol;if(function to(It){return It&&"point-3d"===It.type&&It.hasVisibleVerticalOffset()}(He)){const{screenLength:it,minWorldLength:ht,maxWorldLength:Dt}=He.verticalOffset;Ae.verticalOffset={screenLength:(0,ri.F2)(it),minWorldLength:ht||0,maxWorldLength:null!=Dt?Dt:1/0}}return this._context.screenSizePerspectiveEnabled&&(Ae.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),Ae.occlusionTest=!0,Ae.hasSlicePlane=this._context.slicePlaneEnabled,Ae}_prepareResourcesPrimitive(Ae,He){const it=this._getOutlineSize();if(Vn(He)&&0===it)throw new Error("Nothing to render");this._outlineSize=it,Ae.color=this._getFillColor(),Ae.outlineColor=this._getOutlineColor(),Ae.outlineSize=this._outlineSize;const ht=this._context.sharedResources.textures.fromData(He,()=>(0,Hs.cU)(He));this._texture=ht.texture,this._releaseTexture=ht,Ae.textureIsSignedDistanceField=!0,Ae.distanceFieldBoundingBox=So,Ae.textureId=this._texture.id;const Dt=this._getIconSize();this._size=[Dt,Dt],this._symbolTextureRatio=1/tn,this._createMaterialAndAddToStage(Ae,this._context.stage)}_prepareResourcesHref(Ae,He,it){var ht=this;return(0,x.Z)(function*(){if(!(0,Zr.Z)("esri-canvas-svg-support")&&(0,hr.zd)(He))throw new de.Z("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");ht._outlineSize=ht._getOutlineSize(),Ae.color=ht._getFillColor(),Ae.outlineColor=ht._getOutlineColor(),Ae.outlineSize=ht._outlineSize,Ae.textureIsSignedDistanceField=!1;const Dt=ht._getIconSize(),Vt=Dt*ht._context.graphicsCoreOwner.view.state.pixelRatio,Qt=yield(0,A.q6)(ht._context.sharedResources.textures.fromUrl(He,Vt,{signal:it}));if(!1===Qt.ok)throw(0,Q.r9)(Qt.error),new de.Z("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${He})`);ht._releaseTexture=Qt.value;const cr=Qt.value.texture;ht._size=ht._computeSize(cr.params,Dt),Ae.textureId=cr.id,ht._createMaterialAndAddToStage(Ae,ht._context.stage)})()}_prepareResourcesCIM(Ae,He,it){var ht=this;return(0,x.Z)(function*(){const Dt=new Yi.Z({data:He});if(!ht._context.sharedResources.cimSymbolRasterizer){const Vr=(yield Promise.all([T.e(3751),T.e(4654),T.e(3141),T.e(9235)]).then(T.bind(T,11369))).CIMSymbolRasterizer;(0,Q.k_)(it),ht._context.sharedResources.cimSymbolRasterizer||(ht._context.sharedResources.cimSymbolRasterizer=new Vr(ht._context.renderCoordsHelper.spatialReference,!0))}const Vt=ht._context.layer.fields?ht._context.layer.fields.map(Vr=>Vr.toJSON()):null;let Qt,cr;if(ht._cimLayers=yield ht._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(Dt,Vt,ht._context.renderer&&"dictionary"===ht._context.renderer.type?ht._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:it}),ht._context.renderer&&"dictionary"===ht._context.renderer.type&&ht._context.renderer.scaleExpression){const Vr=ht._context.renderer;if(isNaN(Vr.scaleExpression)){const ei=Vr.scaleExpression,di=yield(0,Nt.Yi)(ei,ht._context.layer.spatialReference,Vt);cr=(_t,vi,Zi)=>{const Oi=(0,Ot.Z)(di,_t,{$view:Zi},"esriGeometryPoint",vi);return null!==Oi?Oi:1}}else Qt=Number(Vr.scaleExpression)}ht._cimScaleFactorOrFunction=Qt||cr||1;const xr=ht._context.renderer?yield ht._context.renderer.getRequiredFields(ht._context.layer.fieldsIndex):[];(0,Q.k_)(it);const Xr=ht._context.layer.fieldsIndex;ht._cimRequiredFields=xr.map(Vr=>Xr.get(Vr).name),ht._cimMaterialParametersInfo=Ae,ht._cimMaterialParametersInfo.color=ht._getFillColor(),ht._cimMaterialParametersInfo.outlineColor=[0,0,0,0],ht._cimMaterialParametersInfo.outlineSize=0,ht._cimMaterialParametersInfo.textureIsSignedDistanceField=!1})()}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||lr.S}_getOutlineSize(){let Ae=0;const He=this.symbolLayer;return(0,G.pC)(He.outline)&&null!=He.outline.size?Math.max((0,ri.F2)(He.outline.size),0):(Ae=Vn(this._getPrimitive())?1.5:0,Math.max(Ae,0))}_getOutlineColor(){const Ae=this._getLayerOpacity(),it=(0,G.U2)(this.symbolLayer,"outline","color");if((0,G.pC)(it)){const ht=Ur.Z.toUnitRGB(it);return[ht[0],ht[1],ht[2],it.a*Ae]}return[0,0,0,0]}_getFillColor(){if(Vn(this._getPrimitive()))return rr.rD;const Ae=(0,G.Wi)(this._getPrimitive()),He=(0,G.U2)(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(He,{hasIntrinsicColor:Ae})}_getAnchorPos(Ae,He){return"relative"===Ae?(0,W.f)((He.x||0)+.5,.5-(He.y||0)):Ae in Qr.yY?Qr.yY[Ae]:Qr.yY.center}_createMaterialAndAddToStage(Ae,He){if(this._fastUpdates=this._cimLayers?{enabled:!1}:Ds(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates.enabled&&Object.assign(Ae,this._fastUpdates.materialParameters),this._cimLayers){let it=(0,G.pC)(Ae.textureId)?this._cimSymbolMaterials.get(Ae.textureId):null;return it||(it=new ns.A(Ae),this._cimSymbolMaterials.set((0,G.Pt)(Ae.textureId,0),it),He.add(it)),it}return this._material=new ns.A(Ae),He.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(Ae=>{Ae.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(Ae=>this._context.stage.remove(Ae)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(Ae=>this._context.stage.remove(Ae)),this._cimSymbolTextures.clear(),this._releaseTexture=(0,G.RY)(this._releaseTexture)}_getScaleFactor(Ae,He){if(this._drivenProperties.size&&Ae.size){for(let it=0;it<3;it++){const ht=Ae.size[it];ht&&"symbol-value"!==ht&&"proportional"!==ht&&(Ae.size[it]=(0,ri.F2)(ht))}if("symbol-value"===Ae.size[0])return 1;if(isFinite(+Ae.size[0]))return+Ae.size[0]/He;if(isFinite(+Ae.size[2]))return+Ae.size[2]/He}return 1}createGraphics3DGraphic(Ae){const He=Ae.graphic;if(!this._validateGeometry(He.geometry))return null;let it,ht;if(this._cimLayers){if(!this._cimLayers.length)return null;const Vr=this._generateTextureCIM(He),ei=or({textureId:Vr.id},this._cimMaterialParametersInfo);ht=this._createMaterialAndAddToStage(ei,this._context.stage),it=[Vr.params.width,Vr.params.height]}else it=this._size,ht=(0,G.Wg)(this._material);const Dt=(0,Ni.S_)(He.geometry);if((0,G.Wi)(Dt))return this.logger.warn(`unsupported geometry type for icon symbol: ${He.geometry.type}`),null;const Vt=Ae.renderingInfo,Qt=this._getVertexOpacityAndColor(Vt);let cr=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(cr=this._getScaleFactor(Vt,it[0]>it[1]?it[0]:it[1])),cr*=this._symbolTextureRatio;const xr=[it[0]*cr,it[1]*cr],Xr=this.setGraphicElevationContext(He,new Ie.o);return this.ensureDrapedStatus("on-the-ground"===Xr.mode)&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(He,Dt,ht,Qt,xr,Ae.layer.uid):this._createAs3DShape(He,Dt,ht,Qt,xr,Xr,He.uid)}layerOpacityChanged(){const Ae=this._getFillColor(),He=this._getOutlineColor();return this._forEachMaterial(it=>{it.setParameters({color:Ae}),it.setParameters({outlineColor:He})}),!0}layerElevationInfoChanged(Ae,He,it){const ht=this._elevationContext.mode,Dt=(0,Ce.GC)(_o.elevationModeChangeTypes,it,ht);if(Dt!==Ce.lO.UPDATE)return Dt;const Vt=(0,Ce.Xf)(ht)||"absolute-height"===ht;return this.updateGraphics3DGraphicElevationInfo(Ae,He,()=>Vt)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(Ae=>{Ae.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!!this._getPrimitive()}applyRendererDiff(Ae,He){for(const it in Ae.diff){if("visualVariables"!==it||!Ps(this._fastUpdates,He,this._fastVisualVariableConvertOptions()))return xe.W.Recreate_Symbol;(0,G.pC)(this._material)&&this._material.setParameters(this._fastUpdates.materialParameters)}return xe.W.Fast_Update}_defaultElevationInfoNoZ(){return Pa}_createAs3DShape(Ae,He,it,ht,Dt,Vt,Qt){const cr=this.getFastUpdateAttrValues(Ae),xr=cr?di=>Sr(this._fastUpdates.materialParameters,cr,di):null,Xr=[Wr.Z.createPointGeometry(Ks,null,ht,Dt,fa,null,cr)],Vr=(0,Ni.km)(this._context,He,Xr,[it],Vt,this._context.layer.uid,Qt,xr);if(null===Vr)return null;const ei=new se.z(this,Vr.object,Xr,null,null,pr.j3,Vt);return ei.alignedSampledElevation=Vr.sampledElevation,ei.needsElevationUpdates=(0,Ce.Xf)(Vt.mode)||"absolute-height"===Vt.mode,ei.getScreenSize=this._createScreenSizeGetter(Dt,xr),ei.calculateRelativeScreenBounds=di=>it.calculateRelativeScreenBounds(ei.getScreenSize(),1,di),(0,Ni.dO)(ei,He,this._context.elevationProvider),ei}_createAsOverlay(Ae,He,it,ht,Dt,Vt){it.renderPriority=this._renderPriority;const Qt=(0,Kr.c)();(0,ue.KC)(He,Qt,this._context.overlaySR),Qt[2]=Ne.Rn;const cr=this._context.clippingExtent;if((0,G.pC)(cr)&&!(0,ce.BD)(cr,Qt))return null;const xr=this.getFastUpdateAttrValues(Ae),Xr=xr?_t=>Sr(this._fastUpdates.materialParameters,xr,_t):null,Vr=Wr.Z.createPointGeometry(Ks,Qt,ht,Dt,null,null,xr),ei=new Di.z(Vr,it,{layerUid:Vt,graphicUid:Ae.uid,calculateShaderTransformation:Xr});Qt[3]=0,(0,Dr.c)(ei.boundingSphere,Qt);const di=new Fr(this,[ei],null,this._context.drapeSourceRenderer);return di.getScreenSize=this._createScreenSizeGetter(Dt,Xr),di.calculateRelativeScreenBounds=_t=>it.calculateRelativeScreenBounds(di.getScreenSize(),1,_t),di}_createScreenSizeGetter(Ae,He){const it=this._outlineSize+2;if(this._fastUpdates.enabled){const ht=Ae[0]/this._symbolTextureRatio,Dt=Ae[1]/this._symbolTextureRatio;return(Vt=(0,W.a)())=>{const Qt=He(hs);return Vt[0]=Qt[0]*ht+it,Vt[1]=Qt[5]*Dt+it,Vt}}{const ht=Ae[0]/this._symbolTextureRatio+it,Dt=Ae[1]/this._symbolTextureRatio+it;return(Vt=(0,W.a)())=>(Vt[0]=ht,Vt[1]=Dt,Vt)}}_fastVisualVariableConvertOptions(){const Ae=this._size[0]>this._size[1]?this._size[0]:this._size[1],He=(0,Z.f)(Ae,Ae,Ae),it=(0,ri.Wz)(1),ht=Ae*it;return{modelSize:He,symbolSize:(0,Z.f)(ht,ht,ht),unitInMeters:it,transformation:{anchor:Z.Z,scale:Z.O,rotation:Z.Z}}}_getGraphicHash(Ae){let He="";for(const it of this._cimRequiredFields)He+=it+Ae.attributes[it];return He}_forEachMaterial(Ae){(0,G.pC)(this._material)&&Ae(this._material),this._cimSymbolMaterials.forEach(Ae)}test(){return yi(or({},super.test()),{material:this._material})}}function Vn(It){return!(0,G.Wi)(It)&&("cross"===It||"x"===It)}_o.PRIMITIVE_SIZE=Bn,_o.elevationModeChangeTypes={definedChanged:Ce.lO.UPDATE,staysOnTheGround:Ce.lO.NONE,onTheGroundChanged:Ce.lO.RECREATE};const Pa={mode:"relative-to-ground",offset:0},fa=(0,Kr.f)(0,0,0,1);var Yo=T(44014),_a=T(30764),ia=T(19625),Xs=T(6945),ro=T(32393),xa=T(33470),xo=T(40723),ti=T(5894),Nn=T(41857),Wa=T(651),zo=T(91056),nn=T(88569),cs=T(12407),Yn=T(64127),Jn=T(62718),us=T(2078);const ma=new Map([[Oe.T.POSITION,0],[Oe.T.UV0,2],[Oe.T.AUXPOS1,3],[Oe.T.SIZE,6],[Oe.T.SIZEFEATUREATTRIBUTE,6],[Oe.T.COLOR,5],[Oe.T.COLORFEATUREATTRIBUTE,5],[Oe.T.OPACITYFEATUREATTRIBUTE,7]]);class Ht extends zo.A{initializeProgram(Ae){const He=Ht.shader.get().build(this.configuration);return new cs.$(Ae.rctx,He,ma)}_makePipelineState(Ae,He){const it=this.configuration,ht=Ae===ze.Am.NONE;return(0,us.sm)({blending:it.output===Xs.H.Color||it.output===Xs.H.Alpha?ht?nn.wu:(0,nn.j7)(Ae):null,depthTest:{func:(0,nn.Bh)(Ae)},depthWrite:ht?it.writeDepth&&us.LZ:(0,nn.K5)(Ae),colorWrite:us.BK,stencilWrite:it.hasOccludees?Yn.s3:null,stencilTest:it.hasOccludees?He?Yn.eD:Yn.RY:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=(0,us.sm)({blending:nn.wu,depthTest:Yn.zV,depthWrite:null,colorWrite:us.BK,stencilWrite:null,stencilTest:Yn.YD}),this._occluderPipelineOpaque=(0,us.sm)({blending:nn.wu,depthTest:Yn.zV,depthWrite:null,colorWrite:us.BK,stencilWrite:Yn.P7,stencilTest:Yn.ii}),this._occluderPipelineMaskWrite=(0,us.sm)({blending:null,depthTest:Yn.JN,depthWrite:null,colorWrite:null,stencilWrite:Yn.s3,stencilTest:Yn.eD})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(Ae,He){return He?this._occludeePipelineState:this.configuration.occluder?Ae===ti.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:Ae===ti.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(Ae,He)}}Ht.shader=new Wa.J(Jn.L,()=>T.e(2958).then(T.bind(T,62958)));var kt=T(17626),ur=T(87601),Tr=T(41528);class _r extends Tr.W{constructor(){super(...arguments),this.output=Xs.H.Color,this.transparencyPassType=ze.Am.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.draped=!1,this.hasCap=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,kt._)([(0,ur.o)({count:Xs.H.COUNT})],_r.prototype,"output",void 0),(0,kt._)([(0,ur.o)({count:ze.Am.COUNT})],_r.prototype,"transparencyPassType",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"occluder",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"hasSlicePlane",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"writeDepth",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"draped",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"hasCap",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"vvSize",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"vvColor",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"vvOpacity",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"hasOccludees",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"hasMultipassTerrain",void 0),(0,kt._)([(0,ur.o)()],_r.prototype,"cullAboveGround",void 0),(0,kt._)([(0,ur.o)({constValue:!0})],_r.prototype,"hasVvInstancing",void 0),(0,kt._)([(0,ur.o)({constValue:!0})],_r.prototype,"hasSliceTranslatedView",void 0);var Gr=T(39401);class oi extends xo.F5{constructor(Ae){super(Ae,new Bt),this._vertexAttributeLocations=ma,this.techniqueConfig=new _r,this.layout=this.createLayout()}dispose(){}getConfiguration(Ae,He){return this.techniqueConfig.output=Ae,this.techniqueConfig.draped=He.slot===ti.r.DRAPED_MATERIAL,this.techniqueConfig.hasCap=this.parameters.cap!==Gr.R.BUTT,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.occluder=this.parameters.renderOccluded===xo.yD.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=He.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=He.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=He.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(){}createLayout(){const Ae=(0,ia.U$)().vec3f(Oe.T.POSITION).vec2f(Oe.T.UV0).vec3f(Oe.T.AUXPOS1);return Ae.f32(this.parameters.vvSizeEnabled?Oe.T.SIZEFEATUREATTRIBUTE:Oe.T.SIZE),this.parameters.vvColorEnabled?Ae.f32(Oe.T.COLORFEATUREATTRIBUTE):Ae.vec4f(Oe.T.COLOR),this.parameters.vvOpacityEnabled&&Ae.f32(Oe.T.OPACITYFEATUREATTRIBUTE),Ae}createBufferWriter(){return new vr(this.layout,this.parameters)}requiresSlot(Ae,He){if(Ae===ti.r.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===xo.yD.OccludeAndTransparentStencil)return Ae===ti.r.OPAQUE_MATERIAL||Ae===ti.r.OCCLUDER_MATERIAL||Ae===ti.r.TRANSPARENT_OCCLUDER_MATERIAL;const it=(0,ro.S)(He);return it===Xs.H.Color||it===Xs.H.Alpha?Ae===(this.parameters.writeDepth?ti.r.TRANSPARENT_MATERIAL:ti.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):Ae===ti.r.OPAQUE_MATERIAL}createGLMaterial(Ae){return Ae.output===Xs.H.Color||Ae.output===Xs.H.Alpha||Ae.output===Xs.H.Highlight||Ae.output===Xs.H.Depth?new At(Ae):null}}class At extends xa.F{_updateParameters(Ae){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(Ht,Ae)}_updateOccludeeState(Ae){Ae.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Ae.hasOccludees})}beginSlot(Ae){return this._output!==Xs.H.Color&&this._output!==Xs.H.Alpha||this._updateOccludeeState(Ae),this._updateParameters(Ae)}}class Bt extends Nn.n{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.placement="end",this.cap=Gr.R.BUTT,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1}}class vr{constructor(Ae,He){this.vertexBufferLayout=Ae,this.parameters=He}allocate(Ae){return this.vertexBufferLayout.createBuffer(Ae)}elementCount(){return"begin-end"===this.parameters.placement?12:6}write(Ae,He,it,ht){const Dt=He.vertexAttributes.get(Oe.T.POSITION).data,Vt=Dt.length/3;let Qt=1,cr=0;this.parameters.vvSizeEnabled?cr=He.vertexAttributes.get(Oe.T.SIZEFEATUREATTRIBUTE).data[0]:He.vertexAttributes.has(Oe.T.SIZE)&&(Qt=He.vertexAttributes.get(Oe.T.SIZE).data[0]);let xr=[1,1,1,1],Xr=0;this.parameters.vvColorEnabled?Xr=He.vertexAttributes.get(Oe.T.COLORFEATUREATTRIBUTE).data[0]:He.vertexAttributes.has(Oe.T.COLOR)&&(xr=He.vertexAttributes.get(Oe.T.COLOR).data);let Vr=0;this.parameters.vvOpacityEnabled&&(Vr=He.vertexAttributes.get(Oe.T.OPACITYFEATUREATTRIBUTE).data[0]);const ei=Ae.transformation,di=new Float32Array(it.buffer);let _t=ht*(this.vertexBufferLayout.stride/4);const vi=(os,mn,Bs,Rn)=>{if(di[_t++]=os[0],di[_t++]=os[1],di[_t++]=os[2],di[_t++]=Bs[0],di[_t++]=Bs[1],di[_t++]=mn[0],di[_t++]=mn[1],di[_t++]=mn[2],di[_t++]=this.parameters.vvSizeEnabled?cr:Qt,this.parameters.vvColorEnabled)di[_t++]=Xr;else{const un=Math.min(4*Rn,xr.length-4);di[_t++]=xr[un+0],di[_t++]=xr[un+1],di[_t++]=xr[un+2],di[_t++]=xr[un+3]}this.parameters.vvOpacityEnabled&&(di[_t++]=Vr)};let Zi;var os;(os=Zi||(Zi={}))[os.ASCENDING=1]="ASCENDING",os[os.DESCENDING=-1]="DESCENDING";const Oi=(os,mn)=>{const Bs=(0,B.s)(kr,Dt[3*os],Dt[3*os+1],Dt[3*os+2]),Rn=ai;let un=os+mn;do{(0,B.s)(Rn,Dt[3*un],Dt[3*un+1],Dt[3*un+2]),un+=mn}while((0,B.z)(Bs,Rn)&&un>=0&&un<Vt);ei&&((0,B.m)(Bs,Bs,ei),(0,B.m)(Rn,Rn,ei)),vi(Bs,Rn,[-1,-1],os),vi(Bs,Rn,[1,-1],os),vi(Bs,Rn,[1,1],os),vi(Bs,Rn,[-1,-1],os),vi(Bs,Rn,[1,1],os),vi(Bs,Rn,[-1,1],os)},Li=this.parameters.placement;"begin"!==Li&&"begin-end"!==Li||Oi(0,Zi.ASCENDING),"end"!==Li&&"begin-end"!==Li||Oi(Vt-1,Zi.DESCENDING)}}const kr=(0,Z.c)(),ai=(0,Z.c)();var Hi=T(54889),fs=T(92222);const Tn=["polyline","polygon","extent"];class On extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht),this._uniformSize=1}doLoad(){var Ae=this;return(0,x.Z)(function*(){if(Ae._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},Ae._fastUpdates=Ae._context.renderer&&Ae._context.renderer.visualVariables&&Ae._context.renderer.visualVariables.length>0?Ds(Ae._context.renderer,Ae._vvConvertOptions):{enabled:!1},!Ae._drivenProperties.size){const He=null!=Ae.symbolLayer.size?Ae.symbolLayer.size:(0,ri.Wz)(1);if(He<0)throw new de.Z("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");Ae._uniformSize=He}Ae._markerTexture=(0,_a.uM)(Ae._context.sharedResources.textures,Ae.symbolLayer.marker)})()}_getMaterialParameters(Ae,He=!1){var Dt;const it=this._getCombinedOpacityAndColor(He&&this._markerColor||this._materialColor);this._patternHidesLine&&!He&&(it[3]=0);const ht={width:this._computeMaterialWidth(null==(Dt=this.symbolLayer)?void 0:Dt.size),color:it,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:(0,Yo.u9)(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:Ae,stipplePattern:(0,Hi.Dp)(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?or(or({},ht),this._fastUpdates.materialParameters):ht}get _materialColor(){return(0,G.yw)(this.symbolLayer.material,Ae=>Ae.color)}get _markerColor(){return(0,G.yw)(this.symbolLayer.marker,Ae=>Ae.color)}get lineMaterial(){return(0,G.Wi)(this._lineMaterial)&&(this._lineMaterial=new fs.U(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial)),this._lineMaterial}get ringMaterial(){return(0,G.Wi)(this._ringMaterial)&&(this._ringMaterial=new fs.U(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial)),this._ringMaterial}get wireframeLineMaterial(){return(0,G.Wi)(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new fs.U(yi(or({},this._getMaterialParameters(!1)),{wireframe:!0})),this._context.stage.add(this._wireframeLineMaterial)),this._wireframeLineMaterial}get wireframeRingMaterial(){return(0,G.Wi)(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new fs.U(yi(or({},this._getMaterialParameters(!0)),{wireframe:!0})),this._context.stage.add(this._wireframeRingMaterial)),this._wireframeRingMaterial}get markerMaterial(){return(0,G.Wi)(this._markerMaterial)&&(0,G.pC)(this.symbolLayer.marker)&&(0,G.pC)(this._markerTexture)&&(this._markerMaterial=new oi(yi(or({},this._getMaterialParameters(!1,!0)),{placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id})),this._context.stage.add(this._markerMaterial)),this._markerMaterial}destroy(){super.destroy(),this._forEachMaterial(Ae=>this._context.stage.remove(Ae)),this._lineMaterial=null,this._ringMaterial=null,this._wireframeLineMaterial=null,this._wireframeRingMaterial=null,this._markerMaterial=null,this._markerTexture=(0,G.RY)(this._markerTexture)}_getDrivenSize(Ae){return this._drivenProperties.size&&Ae.size?(0,ri.F2)((0,Te.o2)(Ae.size)):1}_getSizeFeatureAttributeData(Ae){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(0,Ge.d)(this._fastUpdates.visualVariables.size.field,Ae):null}_getDrivenColor(Ae){const He=(0,Kr.f)(1,1,1,1);return this._drivenProperties.color&&Ae.color&&(He[0]=Ae.color[0],He[1]=Ae.color[1],He[2]=Ae.color[2],Ae.color.length>0&&(He[3]=Ae.color[3])),this._drivenProperties.opacity&&Ae.opacity&&(He[3]=Ae.opacity),He}_getColorFeatureAttributeData(Ae){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?(0,Ge.d)(this._fastUpdates.visualVariables.color.field,Ae):null}_getOpacityFeatureAttributeData(Ae){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?(0,Ge.d)(this._fastUpdates.visualVariables.opacity.field,Ae):null}createGraphics3DGraphic(Ae){const He=Ae.graphic;if(!this._validateGeometry(He.geometry,Tn,this.symbolLayer.type))return null;const it=this.setGraphicElevationContext(He,new Ie.o);return this.ensureDrapedStatus("on-the-ground"===it.mode),this.draped?this._createAsOverlay(Ae,this._context.layer.uid):this._createAs3DShape(Ae,it,He.uid)}applyRendererDiff(Ae,He){for(const it in Ae.diff){if("visualVariables"!==it||!Ps(this._fastUpdates,He,this._vvConvertOptions))return xe.W.Recreate_Symbol;this._forEachMaterial(ht=>ht.setParameters(this._fastUpdates.materialParameters))}return xe.W.Fast_Update}prepareSymbolLayerPatch(Ae){var Dt,Vt;if("partial"!==Ae.diff.type)return;const He=Ae.diff.diff,it={};"complete"===(null==(Dt=He.size)?void 0:Dt.type)&&(it.width=this._computeMaterialWidth(He.size.newValue),delete He.size),"complete"===(null==(Vt=He.cap)?void 0:Vt.type)&&(it.cap=(0,Yo.u9)((0,G.Pt)(He.cap.newValue,"butt")),delete He.cap);const ht=this._prepareMarkerPatch(Ae,He);this._prepareMaterialPatch(Ae,He,ht),Ae.symbolLayerStatePatches.push(()=>this._forEachMaterial(Qt=>Qt.setParameters(it)))}layerOpacityChanged(){return this._forEachMaterial((Ae,He)=>this._updateMaterialLayerOpacity(Ae,He)),!0}_forEachMaterial(Ae){(0,G.pC)(this._lineMaterial)&&Ae(this._lineMaterial),(0,G.pC)(this._ringMaterial)&&Ae(this._ringMaterial),(0,G.pC)(this._wireframeLineMaterial)&&Ae(this._wireframeLineMaterial),(0,G.pC)(this._wireframeRingMaterial)&&Ae(this._wireframeRingMaterial),(0,G.pC)(this._markerMaterial)&&Ae(this._markerMaterial,!0)}_updateMaterialLayerOpacity(Ae,He=!1){const it=Ae.parameters.color,ht=(0,G.U2)(this.symbolLayer,"material","color"),Dt=this._patternHidesLine&&!He?0:this._getCombinedOpacity(ht),Vt=(0,Kr.f)(it[0],it[1],it[2],Dt);Ae.setParameters({color:Vt})}layerElevationInfoChanged(Ae,He,it){const ht=this._elevationContext.mode,Dt=(0,Ce.GC)(On.elevationModeChangeTypes,it,ht);if(Dt!==Ce.lO.UPDATE)return Dt;const Vt=(0,Ce.Xf)(ht);return this.updateGraphics3DGraphicElevationInfo(Ae,He,()=>Vt)}slicePlaneEnabledChanged(){const Ae={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(He=>He.setParameters(Ae)),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_getGeometryAsPolygonOrPolyline(Ae){switch(Ae.type){case"extent":if(Ae instanceof $e.Z)return ie.Z.fromExtent(Ae);break;case"polygon":case"polyline":return Ae}return null}_createAs3DShape(Ae,He,it){const Dt=this._getGeometryAsPolygonOrPolyline(Ae.graphic.geometry),Vt="polygon"===Dt.type?Dt.rings:Dt.paths,Qt=new Array,cr=new Array,xr=new Array,Xr=(0,ce.Ue)(),Vr=(0,Yo.VP)(Dt,this._context.elevationProvider,this._context.renderCoordsHelper,He);this._logGeometryCreationWarnings(Vr,Vt,"polygon"===Dt.type?"rings":"paths","LineSymbol3DLayer");for(let vi=0;vi<Vr.lines.length;vi++){const{position:Zi,mapPosition:Oi}=Vr.lines[vi];if((0,G.pC)(this._context.clippingExtent)&&((0,ce.cS)(Xr),(0,ce.G1)(Xr,Oi),!(0,ce.Zp)(Xr,this._context.clippingExtent)))continue;const Li=this._createGeometry(Ae,Zi,Oi,Dt.type,rn.ELEVATED);Qt.push(Li),cr.push("polygon"===Dt.type?this.ringMaterial:this.lineMaterial),xr.push(ye.I),tt.Z.LINE_WIREFRAMES&&(Qt.push(Li.cloneShallow()),cr.push("polygon"===Dt.type?this.wireframeRingMaterial:this.wireframeLineMaterial),xr.push(ye.I));const os=this.markerMaterial;(0,G.pC)(os)&&(Qt.push(Li.cloneShallow()),cr.push(os),xr.push(ye.I))}if(0===Qt.length)return null;const di=new et.T({geometries:Qt,materials:cr,transformations:xr,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:it}}),_t=new se.z(this,di,Qt,null,null,pr.Lz,He);return _t.alignedSampledElevation=Vr.sampledElevation,_t.needsElevationUpdates=(0,Ce.Xf)(He.mode),_t}_createGeometry(Ae,He,it,ht,Dt){const Qt=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return(0,Yo.YU)({overlayInfo:Dt===rn.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:"polygon"===ht?Yo.NW.REMOVE:Yo.NW.KEEP,uniformSize:this._uniformSize,attributeData:{position:He,mapPosition:it,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this._getDrivenSize(Ae.renderingInfo),color:Qt?null:this._getDrivenColor(Ae.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(Ae.graphic),colorFeature:this._getColorFeatureAttributeData(Ae.graphic),opacityFeature:this._getOpacityFeatureAttributeData(Ae.graphic)}})}_createAsOverlay(Ae,He){const it=Ae.graphic,ht=this._getGeometryAsPolygonOrPolyline(it.geometry),Dt="polygon"===ht.type?ht.rings:ht.paths,Vt="polygon"===ht.type?this.ringMaterial:this.lineMaterial;Vt.renderPriority=this._renderPriority;const Qt=tt.Z.LINE_WIREFRAMES?"polygon"===ht.type?this.wireframeRingMaterial:this.wireframeLineMaterial:null,cr=this.markerMaterial;(0,G.pC)(Qt)&&(Qt.renderPriority=this._renderPriority-.001),(0,G.pC)(cr)&&(cr.renderPriority=this._renderPriority-.002);const xr=new Array,Xr=(0,ce.Ue)(),Vr=(0,ce.cS)(),ei=(0,Yo.rm)(ht,this._context.overlaySR);this._logGeometryCreationWarnings(ei,Dt,"polygon"===ht.type?"rings":"paths","LineSymbol3DLayer");for(const _t of ei.lines){if((0,ce.cS)(Xr),(0,ce.G1)(Xr,_t.position),!(0,ce.Zp)(Xr,this._context.clippingExtent))continue;(0,ce.TC)(Vr,Xr);const vi=this._createGeometry(Ae,_t.position,null,ht.type,rn.DRAPED),Zi=Li=>{const os=new Di.z(vi,Li,{layerUid:He,graphicUid:it.uid});return xr.push(os),os};if((0,G.pC)(cr)){const Li=Zi(cr),os=(0,G.Wg)(this.symbolLayer.marker).placement;"begin"!==os&&"begin-end"!==os||(0,ce.G1)(Xr,_t.position,0,1),"end"!==os&&"begin-end"!==os||(0,ce.G1)(Xr,_t.position,_t.position.length-3,1),this._updateBoundingSphere(Li,Xr)}const Oi=Zi(Vt);if(this._updateBoundingSphere(Oi,Xr),tt.Z.LINE_WIREFRAMES){const Li=Zi(Qt);this._updateBoundingSphere(Li,Xr)}}return new Fr(this,xr,Vr,this._context.drapeSourceRenderer)}_updateBoundingSphere(Ae,He){(0,Dr.s)(Ae.boundingSphere,.5*(He[0]+He[3]),.5*(He[1]+He[4]),0,.5*Math.sqrt((He[3]-He[0])*(He[3]-He[0])+(He[4]-He[1])*(He[4]-He[1])))}get _patternHidesLine(){const Ae=this.symbolLayer.pattern;return(0,G.pC)(Ae)&&"style"===Ae.type&&"none"===Ae.style}_computeMaterialWidth(Ae){return Ae=(0,G.Pt)(Ae,(0,ri.Wz)(1)),this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?(0,ri.F2)(1):1:(0,ri.F2)(Ae)}_prepareMaterialPatch(Ae,He,it){const ht=He.material;if((0,G.Wi)(ht))return void(it.changed&&it.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,Ae));if("collection"===ht.type)return;const Dt="complete"===ht.type?(0,G.yw)(ht.newValue,Qt=>Qt.color):"complete"===ht.diff.color.type?ht.diff.color.newValue:null,Vt=this._getCombinedOpacityAndColor(Dt);it.useMaterialColor&&this._patchMaterialColor((0,Kr.d)(Vt),this._markerMaterial,Ae),this._patternHidesLine&&(Vt[3]=0),this._patchMaterialColor(Vt,this._lineMaterial,Ae),delete He.material}_prepareMarkerPatch(Ae,He){const it=He.marker;if((0,G.Wi)(it)||"partial"!==it.type||(0,G.pC)(it.diff.style)||(0,G.pC)(it.diff.placement)||(0,G.pC)(it.diff.color)&&"complete"!==it.diff.color.type)return{changed:!1,useMaterialColor:(0,G.Wi)(this._markerColor)};const ht=it.diff.color;if((0,G.Wi)(ht))return delete He.marker,{changed:!1,useMaterialColor:(0,G.Wi)(this._markerColor)};const Dt=(0,G.Wg)(ht.newValue);return(0,G.Wi)(Dt)?(delete He.marker,{changed:!0,useMaterialColor:!0}):(this._patchMaterialColor(this._getCombinedOpacityAndColor(Dt),this._markerMaterial,Ae),delete He.marker,{changed:!0,useMaterialColor:!1})}_patchMaterialColor(Ae,He,it){(0,G.Wi)(He)||it.symbolLayerStatePatches.push(()=>He.setParameters({color:Ae}))}}var rn;On.elevationModeChangeTypes={definedChanged:Ce.lO.RECREATE,staysOnTheGround:Ce.lO.NONE,onTheGroundChanged:Ce.lO.RECREATE},function(It){It[It.DRAPED=0]="DRAPED",It[It.ELEVATED=1]="ELEVATED"}(rn||(rn={}));var hn=T(61751),no=T(27530),Sn=T(65231),Va=T(9044),ud=T(36848),Nr=T(49580),Ei=T(67969);const Vi=["mesh"],Go=(0,Z.c)(),Cn=(0,Z.c)(),Do=(0,Z.c)(),El=(0,Z.c)(),Fu=(0,Z.c)(),lp=(0,ye.c)(),bl=(0,he.c)(),Ai=(0,ce.Ue)(),Ze=[new hn.Z];var lo;!function(It){It[It.NONE=0]="NONE",It[It.ECEF=1]="ECEF"}(lo||(lo={}));var ol=T(48521),Pn=T(43652),o0=T(7167);class Fl{constructor(Ae,He,it,ht){this.graphics3DSymbolLayer=Ae,this.instanceIndex=He,this.elevationAligner=it,this.elevationContext=ht,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(Ae){const He=this.lodRenderer.instanceData;Ae!==He.getVisible(this.instanceIndex)&&He.setVisible(this.instanceIndex,Ae)}destroy(){null!=this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(Ae,He,it){if(this.elevationAligner){(0,X.aO)(this.elevationContext.featureExpressionInfoContext,it);const ht=this.elevationAligner(this,this.elevationContext,Ae,He);(0,G.pC)(ht)&&(this.alignedSampledElevation=ht)}}getCenterObjectSpace(Ae=(0,Z.c)()){return this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Xa),(0,B.m)(Ae,this.lodRenderer.baseBoundingSphere.center,Xa)}getBoundingBoxObjectSpace(Ae=(0,ce.Ue)()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,Xa);const He=this.lodRenderer.baseBoundingBox;(0,ce.cS)(Ae);for(let it=0;it<8;++it)(0,B.s)(xn,0==(1&it)?He[0]:He[3],0==(2&it)?He[1]:He[4],0==(4&it)?He[2]:He[5]),(0,B.m)(xn,xn,Xa),(0,ce.pp)(Ae,xn);return Ae}computeAttachmentOrigin(Ae){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,Xa),Ae.render.origin[0]+=Xa[12],Ae.render.origin[1]+=Xa[13],Ae.render.origin[2]+=Xa[14],Ae.render.num++}getProjectedBoundingBox(Ae,He,it,ht,Dt){var Vt=this;return(0,x.Z)(function*(){const Qt=Vt.getBoundingBoxObjectSpace(Dt),cr=da,xr=(0,ce.wp)(Qt)?1:cr.length;Vt.lodRenderer.instanceData.getGlobalTransform(Vt.instanceIndex,Xa);for(let Vr=0;Vr<xr;Vr++){const ei=cr[Vr];xn[0]=Qt[ei[0]],xn[1]=Qt[ei[1]],xn[2]=Qt[ei[2]],(0,B.m)(xn,xn,Xa),Ls[3*Vr+0]=xn[0],Ls[3*Vr+1]=xn[1],Ls[3*Vr+2]=xn[2]}if(!Ae(Ls,0,xr))return null;(0,ce.cS)(Qt);let Xr=null;Vt.calculateRelativeScreenBounds&&(Xr=Vt.calculateRelativeScreenBounds());for(let Vr=0;Vr<3*xr;Vr+=3){for(let ei=0;ei<3;ei++)Qt[ei]=Math.min(Qt[ei],Ls[Vr+ei]),Qt[ei+3]=Math.max(Qt[ei+3],Ls[Vr+ei]);Xr&&it.push({location:Ls.slice(Vr,Vr+3),screenSpaceBoundingRect:Xr})}if(He&&((0,ce.be)(Qt,al),"absolute-height"!==Vt.elevationContext.mode)){let Vr;const ei=(0,Je.Si)(Qt,He);try{Vr=yield He.service.queryElevation(al[0],al[1],ht,ei,"ground")}catch(di){}(0,G.pC)(Vr)&&(0,ce.cv)(Qt,0,0,-Vt.alignedSampledElevation+Vr)}return Qt})()}addObjectState(Ae,He){if(Ae===ze.V_.Highlight){const it=new o0.O(Ae);this._addHighlightId(it),He.addExternal(ht=>{this._removeHighlightId(ht)},it)}}removeObjectState(Ae){this._highlights.forEach(He=>Ae.remove(He))}_addHighlightId(Ae){this._highlights.add(Ae),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(Ae){this._highlights.delete(Ae),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}}const Ls=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],xn=(0,Z.c)(),al=(0,Z.c)(),da=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],Xa=(0,ye.c)();var pn=T(87930),zi=T(47526);const Cl=.05;var Bi,Jo=T(6176),a0=T(56244),vc=T(97161),za=T(4511),Wu=T(59856),zn=T(39114),tc=T(67857),lu=T(82274),ha=T(91263),Xo=T(2282),Wd=T(61885),Sa=T(98943);!function(It){It[It.ALLOCATED=1]="ALLOCATED",It[It.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",It[It.VISIBLE=4]="VISIBLE",It[It.HIGHLIGHT=8]="HIGHLIGHT",It[It.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",It[It.REMOVE=32]="REMOVE",It[It.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",It[It.ACTIVE=18]="ACTIVE"}(Bi||(Bi={}));class sa{constructor(Ae){this.localTransform=Ae.getField(Oe.T.LOCALTRANSFORM,Me.O1),this.globalTransform=Ae.getField(Oe.T.GLOBALTRANSFORM,Me.O1),this.modelOrigin=Ae.getField(Oe.T.MODELORIGIN,Me.fP),this.model=Ae.getField(Oe.T.MODEL,Me.gK),this.modelNormal=Ae.getField(Oe.T.MODELNORMAL,Me.gK),this.modelScaleFactors=Ae.getField(Oe.T.MODELSCALEFACTORS,Me.Eu),this.boundingSphere=Ae.getField(Oe.T.BOUNDINGSPHERE,Me.Cd),this.color=Ae.getField(Oe.T.COLOR,Me.ek),this.featureAttribute=Ae.getField(Oe.T.FEATUREATTRIBUTE,Me.ek),this.state=Ae.getField(Oe.T.STATE,Me.D_),this.lodLevel=Ae.getField(Oe.T.LODLEVEL,Me.D_)}}class lt extends Wd.Z{constructor(Ae,He){super(),this._capacity=0,this._size=0,this._next=0,this._layout=function Bc(It){let Ae=(0,ia.U$)().mat4f64(Oe.T.LOCALTRANSFORM).mat4f64(Oe.T.GLOBALTRANSFORM).vec4f64(Oe.T.BOUNDINGSPHERE).vec3f64(Oe.T.MODELORIGIN).mat3f(Oe.T.MODEL).mat3f(Oe.T.MODELNORMAL).vec2f(Oe.T.MODELSCALEFACTORS);return It.includes("color")&&(Ae=Ae.vec4f(Oe.T.COLOR)),It.includes("featureAttribute")&&(Ae=Ae.vec4f(Oe.T.FEATUREATTRIBUTE)),Ae=Ae.u8(Oe.T.STATE).u8(Oe.T.LODLEVEL).alignTo(8),Ae}(Ae),this._shaderTransformation=He}get capacity(){return this._capacity}get size(){return this._size}get buffer(){return this._buffer.buffer}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const Ae=this._findSlot();return this._view.state.set(Ae,Bi.ALLOCATED),this._size++,this.emit("instance-added",{index:Ae}),Ae}removeInstance(Ae){(0,Xo.hu)(Ae>=0&&Ae<this._capacity&&this._view.state.get(Ae)&Bi.ALLOCATED,"invalid instance handle"),this._getStateFlag(Ae,Bi.ACTIVE)?this._setStateFlags(Ae,Bi.REMOVE):this.freeInstance(Ae),this.emit("instance-removed",{index:Ae})}freeInstance(Ae){const He=this._view.state;(0,Xo.hu)(Ae>=0&&Ae<this._capacity&&He.get(Ae)&Bi.ALLOCATED,"invalid instance handle"),He.set(Ae,0),this._size--}setLocalTransform(Ae,He,it=!0){this._view.localTransform.setMat(Ae,He),it&&this.updateModelTransform(Ae)}getLocalTransform(Ae,He){this._view.localTransform.getMat(Ae,He)}setGlobalTransform(Ae,He,it=!0){this._view.globalTransform.setMat(Ae,He),it&&this.updateModelTransform(Ae)}getGlobalTransform(Ae,He){this._view.globalTransform.getMat(Ae,He)}updateModelTransform(Ae){const He=this._view,it=Ha,ht=ll;He.localTransform.getMat(Ae,zd),He.globalTransform.getMat(Ae,Nc);const Dt=(0,ge.m)(Nc,Nc,zd);(0,B.s)(it,Dt[12],Dt[13],Dt[14]),He.modelOrigin.setVec(Ae,it),(0,pe.f)(ht,Dt),He.model.setMat(Ae,ht);const Vt=(0,Sa.mw)(Ha,Dt);Vt.sort(),He.modelScaleFactors.set(Ae,0,Vt[1]),He.modelScaleFactors.set(Ae,1,Vt[2]),(0,pe.e)(ht,ht),(0,pe.t)(ht,ht),He.modelNormal.setMat(Ae,ht),this._setStateFlags(Ae,Bi.TRANSFORM_CHANGED),this.emit("instance-transform-changed",{index:Ae})}getModelTransform(Ae,He){const it=this._view;it.model.getMat(Ae,ll),it.modelOrigin.getVec(Ae,Ha),He[0]=ll[0],He[1]=ll[1],He[2]=ll[2],He[3]=0,He[4]=ll[3],He[5]=ll[4],He[6]=ll[5],He[7]=0,He[8]=ll[6],He[9]=ll[7],He[10]=ll[8],He[11]=0,He[12]=Ha[0],He[13]=Ha[1],He[14]=Ha[2],He[15]=1}applyShaderTransformation(Ae,He){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,Ae,He)}getCombinedModelTransform(Ae,He){return this.getModelTransform(Ae,He),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,Ae,He),He}getCombinedLocalTransform(Ae,He){return this._view.localTransform.getMat(Ae,He),this._shaderTransformation&&this._shaderTransformation.applyTransform(this,Ae,He),He}getCombinedMaxScaleFactor(Ae){let He=this._view.modelScaleFactors.get(Ae,1);if(this._shaderTransformation){const it=this._shaderTransformation.scaleFactor(Ha,this,Ae);He*=Math.max(it[0],it[1],it[2])}return He}getCombinedMedianScaleFactor(Ae){let He=this._view.modelScaleFactors.get(Ae,0);if(this._shaderTransformation){const it=this._shaderTransformation.scaleFactor(Ha,this,Ae);it.sort(),He*=it[1]}return He}getModel(Ae,He){this._view.model.getMat(Ae,He)}setFeatureAttribute(Ae,He){this._view.featureAttribute.setVec(Ae,He)}getFeatureAttribute(Ae,He){this._view.featureAttribute.getVec(Ae,He)}setColor(Ae,He){this._view.color.setVec(Ae,He)}getColor(Ae,He){this._view.color.getVec(Ae,He)}setVisible(Ae,He){He!==this.getVisible(Ae)&&(this._setStateFlag(Ae,Bi.VISIBLE,He),this.emit("instance-visibility-changed",{index:Ae}))}getVisible(Ae){return this._getStateFlag(Ae,Bi.VISIBLE)}setHighlight(Ae,He){He!==this.getHighlight(Ae)&&(this._setStateFlag(Ae,Bi.HIGHLIGHT,He),this.emit("instance-highlight-changed",{index:Ae}))}getHighlight(Ae){return this._getStateFlag(Ae,Bi.HIGHLIGHT)}getState(Ae){return this._view.state.get(Ae)}getLodLevel(Ae){return this._view.lodLevel.get(Ae)}countFlags(Ae){let He=0;for(let it=0;it<this._capacity;++it)this.getState(it)&Ae&&++He;return He}_setStateFlags(Ae,He){const it=this._view.state;He=it.get(Ae)|He,it.set(Ae,He)}_clearStateFlags(Ae,He){const it=this._view.state;He=it.get(Ae)&~He,it.set(Ae,He)}_setStateFlag(Ae,He,it){it?this._setStateFlags(Ae,He):this._clearStateFlags(Ae,He)}_getStateFlag(Ae,He){return!!(this._view.state.get(Ae)&He)}_grow(){const Ae=Math.max(Ga,Math.floor(this._capacity*Vd)),He=this._layout.createBuffer(Ae);if(this._buffer){const it=new Uint8Array(this._buffer.buffer);new Uint8Array(He.buffer).set(it)}this._capacity=Ae,this._buffer=He,this._view=new sa(this._buffer)}_findSlot(){const Ae=this._view.state;let He=this._next;for(;Ae.get(He)&Bi.ALLOCATED;)He=(He+1)%this._capacity;return this._next=(He+1)%this._capacity,He}}const Ga=1024,Vd=2,Ha=(0,Z.c)(),ll=(0,he.c)(),zd=(0,ye.c)(),Nc=(0,ye.c)();var bh=T(97126);class Ch extends lu.Z{constructor(Ae,He){super(it=>(0,bh.w)(this._instanceData.view.boundingSphere.getVec(it,this._tmpSphere)),{maximumDepth:25}),this._tmpSphere=(0,bh.c)(),this._tmpMat4=(0,ye.c)(),this._instanceData=Ae,this._boundingSphere=He}addInstance(Ae){const He=this._instanceData.view.boundingSphere,it=this._instanceData.getCombinedModelTransform(Ae,this._tmpMat4);(0,B.m)(this._tmpSphere,this._boundingSphere.center,it),this._tmpSphere[3]=this._boundingSphere.radius*(0,Sa.u1)(it),He.setVec(Ae,this._tmpSphere),this.add([Ae])}removeInstance(Ae){this.remove([Ae])}}class Qo{constructor(Ae,He){this.thresholdScale=1,this._camera=new Wu.V,this._worldSpaceRadius=Ae,this._thresholds=He.map(it=>it)}updateCamera(Ae){this._camera.copyFrom(Ae)}selectLevel(Ae,He){const it=this._camera.computeScreenPixelSizeAt(Ae),ht=this._worldSpaceRadius*He/it,Dt=this._thresholds;let Vt=-1;for(let Qt=0;Qt<Dt.length;++Qt)ht>=Dt[Qt]*this.thresholdScale&&(Vt=Qt);return Vt}}var jc=T(62483),Th=T(83994),Mh=T(49353);class Gd{constructor(Ae,He){const it=Ae.renderContext.rctx,{geometry:ht,material:Dt}=He;this._materialRepository=Ae.materialRep,Dt.setParameters({instancedDoublePrecision:!0});const Vt=Dt.createBufferWriter(),Qt=Vt.vertexBufferLayout,cr=Vt.elementCount(ht),xr=Vt.allocate(cr);Vt.write({},ht,xr,0),this.geometry=ht,this.material=Dt,this.glMaterials=new ro.p(Dt,this._materialRepository),this.vertexBufferLayout=Qt,this.vbo=Th.f.createVertex(it,Ei.l1.STATIC_DRAW,xr.buffer),this.vao=new Mh.U(it,zn.i,{geometry:(0,za.K)(Qt)},{geometry:this.vbo}),this.vertexCount=cr}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(Ae,He,it,ht,Dt,Vt,Qt,cr){const xr=this.geometry.id;this.material.intersect(this.geometry,null,Ae.transform.transform,Ae,it,ht,(Xr,Vr,ei,di,_t)=>{if(Xr>=0){if(null!=He&&!He(Ae.rayBegin,Ae.rayEnd,Xr))return;const vi={layerUid:Vt.layerUid,graphicUid:Vt.graphicUid(Dt),geometryId:xr,triangleNr:ei,baseBoundingSphere:Qt,numLodLevels:cr};if((null==Ae.results.min.drapedLayerOrder||_t>=Ae.results.min.drapedLayerOrder)&&(null==Ae.results.min.dist||Xr<Ae.results.min.dist)&&Ae.results.min.set(tc.q7.LOD,vi,Xr,Vr,Ae.transform.transform,_t),Ae.options.store!==tc.eC.MIN&&(null==Ae.results.max.drapedLayerOrder||_t>=Ae.results.max.drapedLayerOrder)&&(null==Ae.results.max.dist||Xr>Ae.results.max.dist)&&Ae.results.max.set(tc.q7.LOD,vi,Xr,Vr,Ae.transform.transform,_t),Ae.options.store===tc.eC.ALL){const Zi=(0,jc.LP)(Ae.results.min.ray);Zi.set(tc.q7.LOD,vi,Xr,Vr,Ae.transform.transform,_t),Ae.results.all.push(Zi)}}})}}class cl{constructor(Ae,He){this.minScreenSpaceRadius=Ae,this.components=He}static create(Ae,He,it){return(0,x.Z)(function*(){const ht=yield Promise.allSettled(He.components.map(Vt=>Ae.schedule(()=>new Gd(Ae,Vt),it))),Dt=ht.map(Vt=>"fulfilled"===Vt.status?Vt.value:null).filter(Vt=>Vt);if((0,Q.Hc)(it)||Dt.length!==ht.length){Dt.forEach(Vt=>Vt.destroy()),(0,Q.k_)(it);for(const Vt of ht)if("rejected"===Vt.status)throw Vt.reason}return new cl(He.minScreenSpaceRadius,Dt)})()}destroy(){this.components.forEach(Ae=>Ae.destroy())}intersect(Ae,He,it,ht,Dt,Vt,Qt){this.components.forEach(cr=>cr.intersect(Ae,He,it,ht,Dt,Vt,this.boundingSphere,Qt))}get boundingBox(){if((0,G.Wi)(this._boundingBox)){const Ae=(0,ce.cS)();this.components.forEach(He=>{(0,G.pC)(He.boundingInfo)&&((0,ce.pp)(Ae,He.boundingInfo.bbMin),(0,ce.pp)(Ae,He.boundingInfo.bbMax))}),this._boundingBox=Ae}return this._boundingBox}get boundingSphere(){if((0,G.Wi)(this._boundingSphere)){const Ae=this.boundingBox,He=(0,Z.c)();(0,ce.be)(Ae,He),this._boundingSphere={center:He,radius:.5*(0,ce.wz)(Ae)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((Ae,He)=>Ae+He.triangleCount,0)}}class cp{constructor(Ae,He,it){this._elementSize=He,this._buffer=Th.f.createVertex(Ae,Ei.l1.STATIC_DRAW),this.resize(it)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(Ae,He,it,ht=0){const Dt=new Uint8Array(this.array,Ae*this.elementSize,(He-Ae)*this.elementSize);new Uint8Array(it.array,ht*this.elementSize).set(Dt)}transferAll(){this._buffer.setData(this._array)}transferRange(Ae,He){const it=Ae*this._elementSize;this._buffer.setSubData(this._array,it,it,He*this._elementSize)}resize(Ae){const He=Ae*this._elementSize,it=new ArrayBuffer(He);this._array&&(Ae>=this._capacity?new Uint8Array(it).set(new Uint8Array(this._array)):new Uint8Array(it).set(new Uint8Array(this._array).subarray(0,Ae*this._elementSize))),this._array=it,this._buffer.setSize(He),this._capacity=Ae}}class up{constructor(Ae){this.modelOriginHi=Ae.getField(Oe.T.MODELORIGINHI,Me.ct),this.modelOriginLo=Ae.getField(Oe.T.MODELORIGINLO,Me.ct),this.model=Ae.getField(Oe.T.MODEL,Me.gK),this.modelNormal=Ae.getField(Oe.T.MODELNORMAL,Me.gK),this.color=Ae.getField(Oe.T.INSTANCECOLOR,Me.ek),this.featureAttribute=Ae.getField(Oe.T.INSTANCEFEATUREATTRIBUTE,Me.ek)}}class hd{constructor(Ae,He){this._headIndex=0,this._tailIndex=0,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=Ae,this._instanceBufferLayout=He,this._elementSize=He.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const Ae=this._headIndex,He=this._tailIndex;return Ae>=He?Ae-He:Ae+this._capacity-He}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCylce(){this._captureFirstIndex=!0}beginUpdate(){(0,Xo.hu)(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){(0,Xo.hu)(this._updating,"not updating"),this.size<fd*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){(0,Xo.hu)(this._updating,"not updating"),this.isFull&&this._grow();const Ae=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=Ae,this._captureFirstIndex=!1),this._incrementHead(),(0,Xo.hu)(this._headIndex!==this._tailIndex,"invalid pointers"),Ae}freeTail(){(0,Xo.hu)(this._updating,"not updating"),(0,Xo.hu)(this.size>0,"invalid size");const Ae=this._tailIndex===this._firstIndex;this._incrementTail(),Ae&&(this._firstIndex=this._tailIndex)}_grow(){const Ae=Math.max(Fc,Math.floor(this._capacity*pd));this._resize(Ae)}_shrink(){const Ae=Math.max(Fc,Math.floor(this._capacity*rc));this._resize(Ae)}_resize(Ae){if((0,Xo.hu)(this._updating,"not updating"),Ae===this._capacity)return;const He=new cp(this._rctx,this._elementSize,Ae);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const it=this.size,ht=this._compactInstances(He);(0,Xo.hu)(ht===it,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=ht,this._prevHeadIndex=0}this._resized=!0,this._capacity=Ae,this._buffer=He,this._view=new up(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(Ae){const He=this._headIndex,it=this._tailIndex;return it<He?(this._buffer.copyRange(it,He,Ae),He-it):it>He?(this._buffer.copyRange(it,this._capacity,Ae),He>0&&this._buffer.copyRange(0,He,Ae,this._capacity-it),He+(this._capacity-it)):0}_incrementHead(Ae=1){this._headIndex=(this._headIndex+Ae)%this._capacity}_incrementTail(Ae=1){this._tailIndex=(this._tailIndex+Ae)%this._capacity}_transferRange(Ae,He){Ae<He?this._buffer.transferRange(Ae,He):Ae>He&&(He>0&&this._buffer.transferRange(0,He),this._buffer.transferRange(Ae,this._capacity))}}const Fc=1024,pd=2,fd=.3,rc=.5;var ic=T(57623),Oh=T(65073),_d=T(39711),md=T(26906);class Wc{constructor(Ae,He,it,ht){this.type=tc.q7.LOD,this.isGround=!1,this._levels=[],this._defaultRenderInstanceData=[],this._highlightRenderInstanceData=[],this._instanceIndex=0,this._slicePlane=!1,this._enableLevelSelection=!0,this._lastCamera=new Wu.V,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[ti.r.OPAQUE_MATERIAL,ti.r.TRANSPARENT_MATERIAL],this.canRender=!0,this._symbol=Ae,this._optionalFields=He,this._metadata=it,this._instanceBufferLayout=(0,ke.RL)({instancedDoublePrecision:!0,instanced:He}),this._glInstanceBufferLayout=(0,za.K)(this._instanceBufferLayout,1),this._instanceData=new lt(this._optionalFields,ht),this._instanceData.on("instance-added",()=>this._requestUpdateCycle()),this._instanceData.on("instance-removed",()=>this._requestUpdateCycle()),this._instanceData.on("instance-transform-changed",Dt=>{this._requestUpdateCycle(),this._metadata.notifyGraphicGeometryChanged(Dt.index)}),this._instanceData.on("instance-visibility-changed",Dt=>{this._requestUpdateCycle(!0),this._metadata.notifyGraphicVisibilityChanged(Dt.index)}),this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0)),this._enableLevelSelection=this._symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(Ae){this._slicePlane=Ae}get layerUid(){return this._metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const Ae={cpu:0,gpu:0};return this._defaultRenderInstanceData.forEach(He=>{const it=He.memoryUsage;Ae.cpu+=it.cpu,Ae.gpu+=it.gpu}),this._highlightRenderInstanceData.forEach(He=>{const it=He.memoryUsage;Ae.cpu+=it.cpu,Ae.gpu+=it.gpu}),Ae}get renderStats(){const Ae=this._instanceData.size,He=[];return this._levels.forEach((it,ht)=>{const Qt=this._defaultRenderInstanceData[ht].size+this._highlightRenderInstanceData[ht].size,cr=it.triangleCount;He.push({renderedInstances:Qt,renderedTriangles:Qt*cr,trianglesPerInstance:cr})}),{totalInstances:Ae,renderedInstances:He.reduce((it,ht)=>it+ht.renderedInstances,0),renderedTriangles:He.reduce((it,ht)=>it+ht.renderedTriangles,0),levels:He}}initializeRenderContext(Ae,He){var it=this;return(0,x.Z)(function*(){it._context=Ae;const ht=Ae.renderContext.rctx,Dt=yield Promise.allSettled(it._symbol.levels.map(Qt=>(it._defaultRenderInstanceData.push(new hd(ht,it._instanceBufferLayout)),it._highlightRenderInstanceData.push(new hd(ht,it._instanceBufferLayout)),cl.create(Ae,Qt,He)))),Vt=Dt.map(Qt=>"fulfilled"===Qt.status?Qt.value:null).filter(Qt=>Qt);if((0,Q.Hc)(He)||Vt.length!==Dt.length){Vt.forEach(Qt=>Qt.destroy()),(0,Q.k_)(He);for(const Qt of Dt)if("rejected"===Qt.status)throw Qt.reason}it._levels=Vt,it._levelSelector=(It=>{const Ae=It.baseBoundingSphere.radius,He=It.levels.map(it=>it.minScreenSpaceRadius);return new Qo(Ae,He)})(it)})()}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(Ae=>Ae.destroy()),this._defaultRenderInstanceData.forEach(Ae=>Ae.destroy()),this._highlightRenderInstanceData.forEach(Ae=>Ae.destroy())}get needsTransparentPass(){return this._levels.some(Ae=>Ae.components.some(He=>He.material.requiresSlot(ti.r.TRANSPARENT_MATERIAL)))}get needsHighlight(){return this._highlightRenderInstanceData.some(Ae=>Ae.size>0)}prepareRender(Ae){if(tt.Z.LOD_INSTANCE_RENDERER_DISABLE_UPDATES)return;if(this._enableLevelSelection){const it=Ae.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(Ae.bindParameters.contentCamera),it||this._requestUpdateCycle()}const He=this._needFullCycle?this._instanceData.size:2e3;this._needFullCycle=!1,this._updateInstances(Ae.bindParameters.contentCamera,He),this.needsUpdates&&this._context.requestRender()}render(Ae){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(Ae.pass))return;Ae.rctx.bindVAO();const it=Ae.pass!==ha.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;Ae.pass!==ha.C.MATERIAL_HIGHLIGHT&&Ae.pass!==ha.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT&&this._renderComponents(Ae,this._defaultRenderInstanceData),it&&this._renderComponents(Ae,this._highlightRenderInstanceData)}intersect(Ae,He,it,ht){if(!this.baseMaterial.isVisible())return;const Dt=(0,Z.c)();(0,B.b)(Dt,ht,it);const Vt=Qt=>{this._instanceData.getCombinedModelTransform(Qt,sc),Ae.transform.set(sc),(0,B.m)(gd,it,Ae.transform.inverse),(0,B.m)(ho,ht,Ae.transform.inverse);const cr=this._instanceData.getState(Qt),xr=this._instanceData.getLodLevel(Qt),Xr=this._levels.length;(0,Xo.hu)(cr&Bi.ACTIVE,"invalid instance state"),(0,Xo.hu)(xr>=0&&xr<Xr,"invaid lod level"),this._levels[xr].intersect(Ae,He,gd,ho,Qt,this._metadata,Xr)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(Vt):this.octree.forEachAlongRay(it,Dt,Vt)}queryDepthRange(Ae){return this._queryDepthRangeOctree(Ae)}notifyShaderTransformationChanged(){this._invalidateOctree()}_requestUpdateCycle(Ae=!1){this._updateCyclesWithStaticCamera=-1,Ae&&(this._needFullCycle=!0),this.needsUpdates&&this._context.requestRender()}get needsUpdates(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}get octree(){return this._octree||(this._octree=this._buildOctree()),this._octree}_invalidateOctree(){this._octree&&(this._octree.destroy(),this._octree=null)}_buildOctree(){const Ae=new Ch(this._instanceData,this.baseBoundingSphere),He=this._instanceData,it=He.view?He.view.state:null;for(let ht=0;ht<this._instanceData.capacity;++ht)it.get(ht)&Bi.ACTIVE&&Ae.addInstance(ht);return Ae}_queryDepthRangeOctree(Ae){const He=Ae.eye,it=Ae.viewForward,ht=this.octree.findClosest(it,lu.Z.DepthOrder.FRONT_TO_BACK,Ae.frustum),Dt=this.octree.findClosest(it,lu.Z.DepthOrder.BACK_TO_FRONT,Ae.frustum);if(null!=ht&&null!=Dt){this._instanceData.view.boundingSphere.getVec(ht,pa),(0,B.b)(pa,pa,He);const Vt=(0,B.e)(pa,it)-pa[3];this._instanceData.view.boundingSphere.getVec(Dt,pa),(0,B.b)(pa,pa,He);const Qt=(0,B.e)(pa,it)+pa[3];return{near:Math.max(Ae.near,Vt),far:Math.min(Ae.far,Qt)}}return{near:1/0,far:-1/0}}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._defaultRenderInstanceData.forEach(Ae=>{Ae.startUpdateCylce()}),this._highlightRenderInstanceData.forEach(Ae=>{Ae.startUpdateCylce()}),this.needsUpdates&&this._context.requestRender()}_updateInstances(Ae,He){const it=this._enableLevelSelection,ht=this._levelSelector;ht.updateCamera(Ae),this._defaultRenderInstanceData.forEach(Xr=>{Xr.beginUpdate()}),this._highlightRenderInstanceData.forEach(Xr=>{Xr.beginUpdate()});const Dt=this._instanceData,Vt=this._instanceData.view,cr=Dt.capacity;let xr=this._instanceIndex;He=Math.min(Dt.size,He);for(let Xr=0;Xr<He;++Xr){0===xr&&this._startUpdateCycle();const Vr=Vt.state.get(xr);let ei=0;if(!(Vr&Bi.ALLOCATED)){xr=(xr+1)%cr,He++;continue}const di=Vt.lodLevel.get(xr);if(Vr&Bi.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[di].freeTail(),Vr&Bi.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[di].freeTail(),Vr&Bi.REMOVE)Dt.freeInstance(xr);else if(Vr&Bi.VISIBLE){let _t=0;it&&(Vt.modelOrigin.getVec(xr,ul),_t=ht.selectLevel(ul,Dt.getCombinedMedianScaleFactor(xr))),ei=Vr&~(Bi.ACTIVE|Bi.TRANSFORM_CHANGED),_t>=0&&(Vr&Bi.HIGHLIGHT?(cu(this._highlightRenderInstanceData[_t],Vt,xr),ei|=Bi.HIGHLIGHT_ACTIVE):(cu(this._defaultRenderInstanceData[_t],Vt,xr),ei|=Bi.DEFAULT_ACTIVE)),Vt.state.set(xr,ei),Vt.lodLevel.set(xr,_t)}else ei=Vr&~(Bi.ACTIVE|Bi.TRANSFORM_CHANGED),Vt.state.set(xr,ei);if(this._octree){const _t=!!(Vr&Bi.ACTIVE),vi=!!(ei&Bi.ACTIVE);!_t&&vi?this._octree.addInstance(xr):_t&&!vi?this._octree.removeInstance(xr):_t&&vi&&Vr&Bi.TRANSFORM_CHANGED&&(this._octree.removeInstance(xr),this._octree.addInstance(xr))}xr=(xr+1)%cr}this._instanceIndex=xr,this._defaultRenderInstanceData.forEach(Xr=>{Xr.endUpdate()}),this._highlightRenderInstanceData.forEach(Xr=>{Xr.endUpdate()})}_renderComponents(Ae,He){this.levels.forEach((it,ht)=>{it.components.forEach(Dt=>{this._renderComponent(Ae,He[ht],Dt,ht)})})}_renderComponent(Ae,He,it,ht){const Dt=Ae.bindParameters;if(0===He.size||!it.material.requiresSlot(Dt.slot))return;const{rctx:Vt,pass:Qt}=Ae,cr=it.glMaterials.load(Vt,Qt);if((0,G.Wi)(cr))return;const xr=cr.beginSlot(Dt),Xr=Vt.bindTechnique(xr,it.material.parameters,Dt);Vt.bindVAO(it.vao),xr.ensureAttributeLocations(it.vao),xr.bindDraw(Hd,Dt),tt.Z.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&Ae.pass===ha.C.MATERIAL&&(Xr.setUniform4fv("externalColor",nc[Math.min(ht,nc.length-1)]),Xr.setUniform1i("colorMixMode",ic.FZ.replace));const Vr=Vt.capabilities.instancing,ei=He.capacity,di=He.headIndex,_t=He.tailIndex,vi=He.firstIndex,Zi=this._glInstanceBufferLayout,Oi=(Li,os)=>{(0,md.XP)(Vt,zn.i,He.buffer,Zi,Li),Vr.drawArraysInstanced(xr.primitiveType,0,it.vertexCount,os-Li),(0,md.UF)(Vt,zn.i,He.buffer,Zi)};it.material.parameters.transparent&&null!=vi?di>_t?((0,Xo.hu)(vi>=_t&&vi<=di,"invalid firstIndex"),Oi(vi,di),Oi(_t,vi)):di<_t&&(vi<=di?((0,Xo.hu)(vi>=0&&vi<=di,"invalid firstIndex"),Oi(vi,di),Oi(_t,ei),Oi(0,vi)):((0,Xo.hu)(vi>=_t&&vi<=ei,"invalid firstIndex"),Oi(vi,ei),Oi(0,di),Oi(_t,vi))):di>_t?Oi(_t,di):di<_t&&(Oi(0,di),Oi(_t,ei)),Vt.bindVAO(null)}}function cu(It,Ae,He){const it=It.allocateHead();!function Vc(It,Ae,He,it){(0,Oh.EE)(It.modelOrigin,Ae,He.modelOriginHi,He.modelOriginLo,it),He.model.copyFrom(it,It.model,Ae),He.modelNormal.copyFrom(it,It.modelNormal,Ae),It.color&&He.color&&He.color.copyFrom(it,It.color,Ae),It.featureAttribute&&He.featureAttribute&&He.featureAttribute.copyFrom(it,It.featureAttribute,Ae)}(Ae,He,It.view,it)}const ul=(0,Z.c)(),pa=(0,Kr.c)(),sc=(0,ye.c)(),gd=(0,Z.c)(),ho=(0,Z.c)(),nc=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]],Hd=new _d.Qm,li=(0,Z.c)(),Kd=(0,ye.c)(),vs=(0,ye.c)(),Qa=(0,Kr.c)(),qo=new Ce.Lm;var uu=T(39863);function du(It,Ae,He,it,ht){return It[0]=Ae,It[1]=He,It[2]=it,It[3]=ht,It}function mt(It,Ae,He){const it=Ae[0],ht=Ae[1],Dt=Ae[2],Vt=Ae[3],Qt=He[0],cr=He[1],xr=He[2],Xr=He[3];return It[0]=it*Qt+Dt*cr,It[1]=ht*Qt+Vt*cr,It[2]=it*xr+Dt*Xr,It[3]=ht*xr+Vt*Xr,It}function Or(It,Ae,He){return It[0]=Ae[0]-He[0],It[1]=Ae[1]-He[1],It[2]=Ae[2]-He[2],It[3]=Ae[3]-He[3],It}Object.freeze(Object.defineProperty({__proto__:null,copy:function Dn(It,Ae){return It[0]=Ae[0],It[1]=Ae[1],It[2]=Ae[2],It[3]=Ae[3],It},identity:function Wl(It){return It[0]=1,It[1]=0,It[2]=0,It[3]=1,It},set:du,transpose:function oc(It,Ae){if(It===Ae){const He=Ae[1];It[1]=Ae[2],It[2]=He}else It[0]=Ae[0],It[1]=Ae[2],It[2]=Ae[1],It[3]=Ae[3];return It},invert:function Bo(It,Ae){const He=Ae[0],it=Ae[1],ht=Ae[2],Dt=Ae[3];let Vt=He*Dt-ht*it;return Vt?(Vt=1/Vt,It[0]=Dt*Vt,It[1]=-it*Vt,It[2]=-ht*Vt,It[3]=He*Vt,It):null},adjoint:function Ra(It,Ae){const He=Ae[0];return It[0]=Ae[3],It[1]=-Ae[1],It[2]=-Ae[2],It[3]=He,It},determinant:function zc(It){return It[0]*It[3]-It[2]*It[1]},multiply:mt,rotate:function Ut(It,Ae,He){const it=Ae[0],ht=Ae[1],Dt=Ae[2],Vt=Ae[3],Qt=Math.sin(He),cr=Math.cos(He);return It[0]=it*cr+Dt*Qt,It[1]=ht*cr+Vt*Qt,It[2]=it*-Qt+Dt*cr,It[3]=ht*-Qt+Vt*cr,It},scale:function Tt(It,Ae,He){const ht=Ae[1],Dt=Ae[2],Vt=Ae[3],Qt=He[0],cr=He[1];return It[0]=Ae[0]*Qt,It[1]=ht*Qt,It[2]=Dt*cr,It[3]=Vt*cr,It},fromRotation:function ft(It,Ae){const He=Math.sin(Ae),it=Math.cos(Ae);return It[0]=it,It[1]=He,It[2]=-He,It[3]=it,It},fromScaling:function pt(It,Ae){return It[0]=Ae[0],It[1]=0,It[2]=0,It[3]=Ae[1],It},str:function rt(It){return"mat2("+It[0]+", "+It[1]+", "+It[2]+", "+It[3]+")"},frob:function dr(It){return Math.sqrt(It[0]**2+It[1]**2+It[2]**2+It[3]**2)},LDU:function wr(It,Ae,He,it){return It[2]=it[2]/it[0],He[0]=it[0],He[1]=it[1],He[3]=it[3]-It[2]*He[1],[It,Ae,He]},add:function $t(It,Ae,He){return It[0]=Ae[0]+He[0],It[1]=Ae[1]+He[1],It[2]=Ae[2]+He[2],It[3]=Ae[3]+He[3],It},subtract:Or,exactEquals:function fi(It,Ae){return It[0]===Ae[0]&&It[1]===Ae[1]&&It[2]===Ae[2]&&It[3]===Ae[3]},equals:function ci(It,Ae){const He=It[0],it=It[1],ht=It[2],Dt=It[3],Vt=Ae[0],Qt=Ae[1],cr=Ae[2],xr=Ae[3];return Math.abs(He-Vt)<=uu.E*Math.max(1,Math.abs(He),Math.abs(Vt))&&Math.abs(it-Qt)<=uu.E*Math.max(1,Math.abs(it),Math.abs(Qt))&&Math.abs(ht-cr)<=uu.E*Math.max(1,Math.abs(ht),Math.abs(cr))&&Math.abs(Dt-xr)<=uu.E*Math.max(1,Math.abs(Dt),Math.abs(xr))},multiplyScalar:function qr(It,Ae,He){return It[0]=Ae[0]*He,It[1]=Ae[1]*He,It[2]=Ae[2]*He,It[3]=Ae[3]*He,It},multiplyScalarAndAdd:function _s(It,Ae,He,it){return It[0]=Ae[0]+He[0]*it,It[1]=Ae[1]+He[1]*it,It[2]=Ae[2]+He[2]*it,It[3]=Ae[3]+He[3]*it,It},mul:mt,sub:Or},Symbol.toStringTag,{value:"Module"}));var Vs=T(14658);class po extends we.Z{constructor(Ae,He,it,ht,Dt,Vt){super(Ae,He),this.path=it,this.geometrySR=ht,this.upVectorAlignment=Dt,this.stencilWidth=Vt}}function co(It){return"upVectorAlignment"in It}Object.freeze(Object.defineProperty({__proto__:null,create:function cn(){return[1,0,0,1]},clone:function ac(It){return[It[0],It[1],It[2],It[3]]},fromValues:function oo(It,Ae,He,it){return[It,Ae,He,it]},createView:function Zd(It,Ae){return new Float64Array(It,Ae,4)}},Symbol.toStringTag,{value:"Module"}));var lc=T(90014),Vl=T(70562);function Ho(){return{up:(0,Z.c)(),right:(0,Z.c)()}}function $d(It,Ae,He){(0,B.m)(It.up,Ae.up,He),(0,B.m)(It.right,Ae.right,He)}function kd(It,Ae,He){(0,J.a)(It,(0,B.e)(He,Ae.right),(0,B.e)(He,Ae.up))}class hu{constructor(){this.pos=(0,Z.c)(),this.posES=(0,Z.c)(),this.posGS=(0,Z.c)(),this.vRight=(0,Z.c)(),this.vLeft=(0,Z.c)(),this.frame=Ho(),this.rotationFrame=Ho(),this.rotationRight=(0,W.a)(),this.rotationAngle=0,this.miterStretch=[1,0,0,1]}setFrameFromUpVector(Ae){(0,B.c)(this.frame.up,Ae),(0,B.a)(hl,this.vLeft,this.vRight),(0,B.n)(hl,hl),(0,B.g)(No,this.frame.up,(0,B.e)(hl,this.frame.up)),(0,B.b)(mo,hl,No),(0,B.n)(mo,mo),(0,B.f)(this.frame.right,mo,this.frame.up)}computeRotationAxisAndAngleFromUpVector(){(0,B.c)(this.rotationFrame.up,this.frame.up),(0,B.c)(this.rotationFrame.right,this.frame.right),(0,J.a)(this.rotationRight,1,0),(0,B.g)(No,this.frame.up,(0,B.e)(this.frame.up,this.vLeft)),(0,B.b)(No,this.vLeft,No),(0,B.o)(No,No),(0,B.n)(No,No),(0,B.g)(hl,this.frame.up,(0,B.e)(this.frame.up,this.vRight)),(0,B.b)(hl,this.vRight,hl),(0,B.n)(hl,hl),(0,B.f)(Gn,this.rotationFrame.up,this.vLeft);const Ae=Math.sign((0,B.e)(Gn,this.vRight));if(this.rotationAngle=Ae*(Math.PI-(0,Ar.ZF)((0,B.e)(No,hl))),Math.abs(this.rotationAngle)>0){const it=(0,Ar.b_)(Math.cos(.5*this.rotationAngle));du(this.miterStretch,it-1+1,0,0,1)}const He=Math.PI-this.rotationAngle;this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*He))}}class dl{constructor(){this.vertices=[],this.vertexIndices=[],this.vertexNormals=[],this.poles=[],this.poleIndices=[],this.uvs=null,this.uvIndices=null}addVertex(Ae,He){return this.vertices.push((0,W.d)(Ae)),this.vertexNormals.push((0,W.d)(He)),this.vertices.length-1}addUV(Ae){return this.uvs||(this.uvs=[],this.uvIndices=[]),this.uvs.push(Ae),this.uvs.length-1}addPole(Ae,He=null){return this.poles.push({position:(0,W.d)(Ae),normal:He?(0,W.d)(He):null}),this.poles.length-1}addSegment(Ae,He=null,it=null){this.vertexIndices.push(Ae.v0),this.vertexIndices.push(Ae.v1),He&&(this.uvIndices.push(He.v0),this.uvIndices.push(He.v1)),it&&(this.poleIndices.push(it.v0),this.poleIndices.push(it.v1))}get numSegments(){return this.vertexIndices.length/2}hasUV(){return null!=this.uvs}translate(Ae,He){for(const it of this.vertices)it[0]+=Ae,it[1]+=He;for(const it of this.poles)it.position[0]+=Ae,it.position[1]+=He}static circle(Ae=20){const it=new dl,ht={v0:0,v1:0};it.addPole((0,W.f)(0,0));for(let Qt=0;Qt<Ae;++Qt){const cr=2*Qt*Math.PI/Ae,xr=Math.cos(cr),Xr=Math.sin(cr),Vr=(0,W.f)(.5*xr,.5*Xr),ei=(0,W.f)(xr,Xr);it.addVertex(Vr,ei),it.addUV(Qt/Ae)}it.addUV(1);for(let Qt=0;Qt<Ae-1;++Qt){const cr={v0:Qt,v1:Qt+1};it.addSegment(cr,cr,ht)}return it.addSegment({v0:Ae-1,v1:0},{v0:Ae-1,v1:Ae},ht),it}static rect(){const it=new dl,ht=(0,W.f)(-.5,-.5),Dt=(0,W.f)(.5,-.5),Vt=(0,W.f)(.5,.5),Qt=(0,W.f)(-.5,.5),cr=(0,W.f)(0,-1),xr=(0,W.f)(1,0),Xr=(0,W.f)(0,1),Vr=(0,W.f)(-1,0);it.addUV(0),it.addUV(1),it.addPole((0,W.f)(0,.5),Xr),it.addPole((0,W.f)(0,.5)),it.addPole((0,W.f)(0,-.5)),it.addPole((0,W.f)(0,-.5),cr);const ei={v0:0,v1:1};return it.addVertex(ht,cr),it.addVertex(Dt,cr),it.addSegment({v0:0,v1:1},ei,{v0:3,v1:3}),it.addVertex(Dt,xr),it.addVertex(Vt,xr),it.addSegment({v0:2,v1:3},ei,{v0:2,v1:1}),it.addVertex(Vt,Xr),it.addVertex(Qt,Xr),it.addSegment({v0:4,v1:5},ei,{v0:0,v1:0}),it.addVertex(Qt,Vr),it.addVertex(ht,Vr),it.addSegment({v0:6,v1:7},ei,{v0:1,v1:2}),it}}class zl{constructor(Ae){this.vertices=[],this.offset=(0,Z.c)(),this.xform=(0,ye.c)(),this.vertices=Ae;const He=Math.floor((Ae.length-1)/2);(0,B.c)(this.offset,this.vertices[He].pos);for(const it of this.vertices)(0,B.b)(it.pos,it.pos,this.offset);(0,ge.j)(this.xform,this.xform,this.offset),this.updatePathVertexInformation()}updatePathVertexInformation(){const Ae=this.vertices.length;let He=this.vertices[0];He.index=0,(0,B.s)(He.vLeft,0,0,0),He.vLeftLength=0,(0,B.b)(He.vRight,this.vertices[1].pos,He.pos),He.vRightLength=(0,B.l)(He.vRight),(0,B.n)(He.vRight,He.vRight);let it=He;for(let ht=1;ht<Ae;++ht)He=this.vertices[ht],He.index=ht,(0,B.c)(He.vLeft,it.vRight),He.vLeftLength=it.vRightLength,ht<Ae-1?((0,B.b)(He.vRight,this.vertices[ht+1].pos,He.pos),He.vRightLength=(0,B.l)(He.vRight),(0,B.n)(He.vRight,He.vRight)):((0,B.c)(He.vRight,He.vLeft),He.vRightLength=He.vLeftLength),it=He}}class hp{numProfilesPerJoin(){return 1}extrude(Ae,He,it){for(let ht=0;ht<He.vertices.length;++ht)it(Ae.index,Ae.frame,He.vertices[ht],He.vertexNormals[ht],!1)}}class cc{constructor(Ae=.8*Math.PI,He=1){this.cutoffAngle=Ae,this.numBendSubdivisions=He}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(Ae,He,it){const ht=c0;if(Math.abs(Ae.rotationAngle)>=this.cutoffAngle)for(let Dt=0;Dt<this.numBendSubdivisions+1;++Dt){(0,ge.d)(xh,.5*-Ae.rotationAngle+Dt*Ae.rotationAngle/this.numBendSubdivisions,Ae.rotationFrame.up),$d(ht,Ae.frame,xh);for(let Vt=0;Vt<He.vertices.length;++Vt)(0,J.h)(He.vertices[Vt],Ae.rotationRight)*Ae.rotationAngle>=0?it(Ae.index,ht,He.vertices[Vt],He.vertexNormals[Vt],!1):((0,J.p)(zu,He.vertices[Vt],Ae.miterStretch),it(Ae.index,Ae.frame,zu,He.vertexNormals[Vt],!0))}else for(let Dt=0;Dt<this.numBendSubdivisions+1;++Dt)for(let Vt=0;Vt<He.vertices.length;++Vt){const Qt=(0,J.h)(He.vertices[Vt],Ae.rotationRight)*Ae.rotationAngle>=0;(0,J.p)(zu,He.vertices[Vt],Ae.miterStretch),it(Ae.index,Ae.frame,zu,He.vertexNormals[Vt],!Qt)}}}const pp={generateUV:!1};class Ss{rebuildConnectingProfileGeometry(Ae,He,it){for(let ht=0;ht<He.vertices.length;++ht)it(Ae.index,Ae.frame,He.vertices[ht],He.vertexNormals[ht],0,0)}}class To extends Ss{constructor(){super()}getNumVertices(){return 0}getNumIndices(){return 0}rebuildCapGeometry(){}buildTopology(){}}class Xn extends Ss{constructor(Ae,He=0,it=!1){super(),this.profile=Ae,this.profilePlaneOffset=He,this.flip=it}getNumVertices(){return this.profile.vertices.length}getNumIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(Ae,He,it){for(let ht=0;ht<He.vertices.length;++ht)it(Ae.index,Ae.frame,He.vertices[ht],He.vertexNormals[ht],this.profilePlaneOffset,0)}rebuildCapGeometry(Ae,He){const it=Tl;(0,J.a)(it,0,0);const ht=this.flip?1:-1;for(let Dt=0;Dt<this.profile.vertices.length;++Dt)He(Ae.index,Ae.frame,this.profile.vertices[Dt],it,this.profilePlaneOffset,ht)}buildTopology(Ae,He){const it=this.vertexBufferStart+this.profile.vertexIndices[0];for(let ht=1;ht<this.profile.numSegments;++ht){const Qt=this.vertexBufferStart+this.profile.vertexIndices[2*ht+0],cr=this.vertexBufferStart+this.profile.vertexIndices[2*ht+1];this.flip?He(cr,Qt,it):He(it,Qt,cr)}}}class qs extends Ss{constructor(Ae){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=Ae.profile,this.flip=Ae.flip,this.sign=this.flip?1:-1,this.breakNormals=Ae.breakNormals,this.numSegments=Ae.subdivisions}getNumVertices(){let Ae=0;return Ae=this.profile.vertices.length*(this.numSegments-1),this.breakNormals&&(Ae+=this.profile.vertices.length),Ae+=this.profile.poles.length,Ae}getNumIndices(){let Ae=0;Ae+=2*this.profile.numSegments*(this.numSegments-1);for(let He=0;He<this.profile.numSegments;++He)Ae+=this.profile.poleIndices[this.profile.vertexIndices[2*He+0]]===this.profile.poleIndices[this.profile.vertexIndices[2*He+1]]?1:2;return 3*Ae}rebuildCapGeometry(Ae,He){const it=Ae.frame,ht=.5*this.sign,Dt=zu,Vt=Tl;(0,J.a)(Vt,0,0);for(let Qt=0;Qt<this.profile.poles.length;++Qt){const cr=this.profile.poles[Qt];cr.normal?He(Ae.index,it,cr.position,cr.normal,ht,0):He(Ae.index,it,cr.position,Vt,ht,this.sign)}if(this.breakNormals)for(let Qt=0;Qt<this.profile.vertices.length;++Qt)He(Ae.index,it,this.profile.vertices[Qt],this.profile.vertexNormals[Qt],0,0);for(let Qt=0;Qt<this.numSegments-1;++Qt){const cr=(1-(Qt+1)/this.numSegments)*Math.PI*.5,xr=Math.sin(cr),Xr=Math.cos(cr);for(let Vr=0;Vr<this.profile.vertices.length;++Vr){const ei=this.profile.poles[this.profile.poleIndices[Vr]];(0,J.g)(Dt,this.profile.vertices[Vr],ei.position),(0,J.f)(Dt,Dt,xr),ei.normal?((0,J.b)(Dt,Dt,ei.position),He(Ae.index,it,Dt,ei.normal,ht*Xr,0)):((0,J.i)(Vt,Dt),(0,J.f)(Vt,Vt,xr),(0,J.b)(Dt,Dt,ei.position),He(Ae.index,it,Dt,Vt,ht*Xr,this.sign*Xr))}}}buildTopology(Ae,He){const it=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex,ht=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let Dt=0;Dt<this.profile.numSegments;++Dt){const Vt=this.profile.vertexIndices[2*Dt+0],Qt=this.profile.vertexIndices[2*Dt+1],cr=this.vertexBufferStart+this.profile.poleIndices[Vt],xr=this.vertexBufferStart+this.profile.poleIndices[Qt];let Xr=it+Vt,Vr=it+Qt;for(let ei=0;ei<this.numSegments-1;++ei){const di=ht+ei*this.profile.vertices.length+Vt,_t=ht+ei*this.profile.vertices.length+Qt;this.flip?(He(di,Vr,Xr),He(Vr,di,_t)):(He(Xr,Vr,di),He(_t,di,Vr)),Xr=di,Vr=_t}this.flip?(He(cr,Vr,Xr),cr!==xr&&He(cr,xr,Vr)):(He(Xr,Vr,cr),cr!==xr&&He(Vr,xr,cr))}}}class Ph{constructor(Ae,He,it,ht,Dt,Vt=pp){this.options=Vt,this._extrusionVertexCount=0,this._triangleCount=0,this.numExtrusionProfiles=0,this.numVerticesTotal=0,this.numNormalsTotal=0,this.numUVTotal=0,this.profile=He,this.path=Ae,this.extruder=it,this.startCap=ht,this.endCap=Dt;const Qt=this.path.vertices.length-2;this.numExtrusionProfiles=it.numProfilesPerJoin()*Qt+2,this.numVerticesTotal=He.vertices.length*this.numExtrusionProfiles,this.numNormalsTotal=this.numVerticesTotal,this.startCap.vertexBufferStart=this.numVerticesTotal;const cr=this.startCap.getNumVertices();this.numVerticesTotal+=cr,this.numNormalsTotal+=cr,this.endCap.vertexBufferStart=this.numVerticesTotal;const xr=this.endCap.getNumVertices();this.numVerticesTotal+=xr,this.numNormalsTotal+=xr,this.pathVertexData=new Float32Array(1*this.numVerticesTotal),this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal),this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal),this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal),this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal)),this.originData=new Float32Array(3*this.path.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(Ae,He,it,ht,Dt){if(this.profileRightAxisData[4*this._extrusionVertexCount+0]=He.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=He.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=He.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=He.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=He.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=He.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=it[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=it[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=ht[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=ht[1],this.pathVertexData[this._extrusionVertexCount]=Ae,Dt){const Vt=this.path.vertices[Ae];this.profileRightAxisData[4*this._extrusionVertexCount+3]=Vt.rotationRight[0]*Vt.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=Vt.rotationRight[1]*Vt.maxStretchDistance}else this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0;++this._extrusionVertexCount}emitCapVertex(Ae,He,it,ht,Dt,Vt){this.profileRightAxisData[4*this._extrusionVertexCount+0]=He.right[0],this.profileRightAxisData[4*this._extrusionVertexCount+1]=He.right[1],this.profileRightAxisData[4*this._extrusionVertexCount+2]=He.right[2],this.profileUpAxisData[4*this._extrusionVertexCount+0]=He.up[0],this.profileUpAxisData[4*this._extrusionVertexCount+1]=He.up[1],this.profileUpAxisData[4*this._extrusionVertexCount+2]=He.up[2],this.profileVertexAndNormalData[4*this._extrusionVertexCount+0]=it[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=it[1],this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=ht[0],this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=ht[1],this.pathVertexData[this._extrusionVertexCount]=Ae,this.profileRightAxisData[4*this._extrusionVertexCount+3]=Dt,this.profileUpAxisData[4*this._extrusionVertexCount+3]=Vt,++this._extrusionVertexCount}emitTriangle(Ae,He,it){this.vertexIndices[3*this._triangleCount+0]=Ae,this.vertexIndices[3*this._triangleCount+1]=He,this.vertexIndices[3*this._triangleCount+2]=it,this.pathVertexIndices[3*this._triangleCount+0]=this.pathVertexData[Ae],this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[He],this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[it],this.normalIndices[3*this._triangleCount+0]=Ae,this.normalIndices[3*this._triangleCount+1]=He,this.normalIndices[3*this._triangleCount+2]=it,++this._triangleCount}_rebuildGeometry(){const Ae=(it,ht,Dt,Vt,Qt)=>this.emitVertex(it,ht,Dt,Vt,Qt),He=(it,ht,Dt,Vt,Qt,cr)=>this.emitCapVertex(it,ht,Dt,Vt,Qt,cr);this._extrusionVertexCount=0;for(const it of this.path.vertices)this.originData[3*it.index+0]=it.pos[0],this.originData[3*it.index+1]=it.pos[1],this.originData[3*it.index+2]=it.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,He);for(let it=1;it<this.path.vertices.length-1;++it)this.extruder.extrude(this.path.vertices[it],this.profile,Ae);if(this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,He),this.startCap.rebuildCapGeometry(this.path.vertices[0],He),this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],He),this.profile.hasUV()&&this.options.generateUV)for(let it=0;it<this.profile.uvs.length;++it)this.uvData[2*it+0]=this.profile.uvs[it],this.uvData[2*it+1]=0}buildTopology(){const Ae=(Vt,Qt,cr)=>this.emitTriangle(Vt,Qt,cr);this._triangleCount=0;const He=this.profile.vertices.length,it=this.profile.numSegments,ht=this.numExtrusionProfiles-1;let Dt=it*ht*2*3;this.startCap.indexBufferStart=Dt,this.startCap.firstProfileVertexIndex=0,Dt+=this.startCap.getNumIndices(),this.endCap.indexBufferStart=Dt,this.endCap.firstProfileVertexIndex=He*(this.numExtrusionProfiles-1),Dt+=this.endCap.getNumIndices(),this.vertexIndices=new Uint32Array(Dt),this.normalIndices=new Uint32Array(Dt),this.pathVertexIndices=new Uint32Array(Dt),this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(Dt));for(let Vt=0;Vt<it;++Vt){const Qt=this.profile.vertexIndices[2*Vt],cr=this.profile.vertexIndices[2*Vt+1];for(let xr=0;xr<ht;++xr){const Xr=xr*He+Qt,Vr=(xr+1)*He+cr,ei=xr*He+cr;Ae(Xr,(xr+1)*He+Qt,Vr),Ae(Xr,Vr,ei)}}this.startCap.buildTopology(this.path.vertices[0],Ae),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],Ae)}onPathChanged(){this._rebuildGeometry()}}class uc{constructor(Ae){this.builder=Ae}get xform(){return this.builder.path.xform}onPathChanged(){this.builder.onPathChanged()}}class ya extends uc{constructor(Ae){super(Ae),this.vertexAttributePosition=null,this.vertexAttributeNormal=null,this.vertexAttributeColor=null,this.vertexAttributePosition=new Float32Array(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Float32Array(3*this.builder.numNormalsTotal),this.vertexAttributeColor=new Uint8Array(4),this.vertexAttributeColor[0]=255,this.vertexAttributeColor[1]=255,this.vertexAttributeColor[2]=255,this.vertexAttributeColor[3]=255}bakeVertexColors(Ae){this.vertexAttributeColor[0]=255*Ae[0],this.vertexAttributeColor[1]=255*Ae[1],this.vertexAttributeColor[2]=255*Ae[2],this.vertexAttributeColor[3]=255*(Ae.length>3?Ae[3]:1)}bake(Ae){this.size=Ae;for(let He=0;He<this.builder.numVerticesTotal;++He){let it=this.builder.pathVertexData[He];const ht=0===it||it===this.builder.path.vertices.length-1;it*=3;const Dt=n_;(0,B.s)(Dt,this.builder.originData[it++],this.builder.originData[it++],this.builder.originData[it]);const Vt=4*He,Qt=No,cr=zu,xr=hl,Xr=Gn,Vr=Jd;let ei=0,di=0;if((0,B.s)(Xr,this.builder.profileRightAxisData[Vt],this.builder.profileRightAxisData[Vt+1],this.builder.profileRightAxisData[Vt+2]),(0,B.s)(Vr,this.builder.profileUpAxisData[Vt],this.builder.profileUpAxisData[Vt+1],this.builder.profileUpAxisData[Vt+2]),(0,J.a)(cr,this.builder.profileVertexAndNormalData[Vt]*Ae[0],this.builder.profileVertexAndNormalData[Vt+1]*Ae[1]),ht)(0,B.f)(xr,Vr,Xr),ei=this.builder.profileRightAxisData[Vt+3]*Ae[0],di=this.builder.profileUpAxisData[Vt+3];else{const vi=Tl,Zi=yd;(0,J.a)(vi,this.builder.profileRightAxisData[Vt+3],this.builder.profileUpAxisData[Vt+3]);const Oi=(0,J.o)(vi);(0,J.i)(vi,vi);const Li=(0,J.h)(cr,vi);if(Math.abs(Li)>Oi){(0,J.a)(Zi,-vi[1],vi[0]);const os=(0,J.h)(cr,Zi);(0,J.f)(vi,vi,Oi*Math.sign(Li)),(0,J.f)(Zi,Zi,os),(0,J.b)(cr,vi,Zi)}(0,B.s)(xr,0,0,0)}(0,B.s)(Qt,Xr[0]*cr[0]+Vr[0]*cr[1],Xr[1]*cr[0]+Vr[1]*cr[1],Xr[2]*cr[0]+Vr[2]*cr[1]),this.vertexAttributePosition[3*He+0]=Dt[0]+Qt[0]+xr[0]*ei,this.vertexAttributePosition[3*He+1]=Dt[1]+Qt[1]+xr[1]*ei,this.vertexAttributePosition[3*He+2]=Dt[2]+Qt[2]+xr[2]*ei;const _t=zu;(0,J.a)(_t,this.builder.profileVertexAndNormalData[Vt+2],this.builder.profileVertexAndNormalData[Vt+3]),this.vertexAttributeNormal[3*He+0]=Xr[0]*_t[0]+Vr[0]*_t[1]+xr[0]*di,this.vertexAttributeNormal[3*He+1]=Xr[1]*_t[0]+Vr[1]*_t[1]+xr[1]*di,this.vertexAttributeNormal[3*He+2]=Xr[2]*_t[0]+Vr[2]*_t[1]+xr[2]*di}}createGeometryData(){const Ae=[[Oe.T.POSITION,this.builder.vertexIndices],[Oe.T.NORMAL,this.builder.normalIndices]],He=[[Oe.T.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[Oe.T.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];return this.vertexAttributeColor&&(Ae.push([Oe.T.COLOR,new Uint32Array(this.builder.vertexIndices.length)]),He.push([Oe.T.COLOR,{size:4,data:this.vertexAttributeColor}])),{vertexAttributes:He,indices:Ae}}onPathChanged(){super.onPathChanged(),this.bake(this.size)}intersect(Ae,He,it){const ht=this.builder.vertexIndices;(0,ic.CN)(Ae,He,0,ht.length/3,ht,{size:3,data:this.vertexAttributePosition},void 0,void 0,it)}}class Yd extends uc{constructor(Ae,He,it,ht){super(Ae),this.sizeAttributeValue=He,this.colorAttributeValue=it,this.opacityAttributeValue=ht,this.vvData=null,this.baked=new ya(Ae),this.vvData=new Float32Array(4*this.builder.path.vertices.length);for(let Dt=0;Dt<this.builder.path.vertices.length;++Dt)this.vvData[4*Dt+0]=He,this.vvData[4*Dt+1]=it,this.vvData[4*Dt+2]=ht,this.vvData[4*Dt+3]=0===Dt||Dt===this.builder.path.vertices.length-1?1:0}createGeometryData(){return{vertexAttributes:[[Oe.T.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[Oe.T.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,exclusive:!0}],[Oe.T.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[Oe.T.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[Oe.T.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[Oe.T.POSITION,this.builder.pathVertexIndices],[Oe.T.PROFILERIGHT,this.builder.vertexIndices],[Oe.T.PROFILEUP,this.builder.vertexIndices],[Oe.T.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[Oe.T.FEATUREVALUE,this.builder.pathVertexIndices]]}}}const n_=(0,Z.c)(),zu=(0,W.a)(),Tl=(0,W.a)(),yd=(0,W.a)(),No=(0,Z.c)(),hl=(0,Z.c)(),Gn=(0,Z.c)(),Jd=(0,Z.c)(),mo=(0,Z.c)(),c0=Ho(),xh=(0,ye.c)();var pu=T(96395),fu=T(60881),Gu=T(68565),na=T(92724),o_=T(7228),Dh=T(24079);const fp=new Map([[Oe.T.POSITION,0],[Oe.T.PROFILERIGHT,1],[Oe.T.PROFILEUP,2],[Oe.T.PROFILEVERTEXANDNORMAL,3],[Oe.T.FEATUREVALUE,4]]);class Hu extends Gu.C{constructor(){super(...arguments),this.ambient=(0,Z.f)(.2,.2,.2),this.diffuse=(0,Z.f)(.8,.8,.8),this.specular=(0,Z.f)(0,0,0),this.opacity=1}}class Gl extends zo.A{initializeConfiguration(Ae,He){He.spherical=Ae.viewingMode===me.JY.Global,He.doublePrecisionRequiresObfuscation=(0,o_.I)(Ae.rctx)}initializeProgram(Ae){const He=Gl.shader.get().build(this.configuration);return new cs.$(Ae.rctx,He,fp)}_setPipelineState(Ae){const He=this.configuration,it=Ae===ze.Am.NONE,ht=Ae===ze.Am.FrontFace;return(0,us.sm)({blending:He.output!==Xs.H.Color&&He.output!==Xs.H.Alpha||!He.transparent?null:it?nn.wu:(0,nn.j7)(Ae),culling:(Vt=He,!Vt.hasSlicePlane&&!(Vt.transparent||Vt.doubleSidedMode===pu.q.None)&&us.sg),depthTest:{func:(0,nn.Bh)(Ae)},depthWrite:it||ht?us.LZ:null,colorWrite:us.BK,stencilWrite:He.hasOccludees?Yn.s3:null,stencilTest:He.hasOccludees?Yn.RY:null,polygonOffset:it||ht?null:nn.E0});var Vt}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Gl.shader=new Wa.J(Dh.P,()=>T.e(3478).then(T.bind(T,93478)));class Mo extends Tr.W{constructor(){super(...arguments),this.output=Xs.H.Color,this.doubleSidedMode=pu.q.None,this.transparencyPassType=ze.Am.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}}(0,kt._)([(0,ur.o)({count:Xs.H.COUNT})],Mo.prototype,"output",void 0),(0,kt._)([(0,ur.o)({count:pu.q.COUNT})],Mo.prototype,"doubleSidedMode",void 0),(0,kt._)([(0,ur.o)({count:ze.Am.COUNT})],Mo.prototype,"transparencyPassType",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"spherical",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"receiveShadows",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"receiveAmbientOcclusion",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"vvSize",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"vvColor",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"vvOpacity",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"hasSlicePlane",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"transparent",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"hasOccludees",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"hasMultipassTerrain",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"cullAboveGround",void 0),(0,kt._)([(0,ur.o)()],Mo.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,kt._)([(0,ur.o)({constValue:na.f7.Disabled})],Mo.prototype,"pbrMode",void 0),(0,kt._)([(0,ur.o)({constValue:!0})],Mo.prototype,"hasVvInstancing",void 0),(0,kt._)([(0,ur.o)({constValue:!1})],Mo.prototype,"useCustomDTRExponentForWater",void 0),(0,kt._)([(0,ur.o)({constValue:!1})],Mo.prototype,"useFillLights",void 0);var _u=T(42037);class dc extends xo.F5{constructor(Ae){super(Ae,new _p),this.supportsEdges=!0,this._vertexAttributeLocations=fp,this._configuration=new Mo,this.vertexBufferLayout=dc.getVertexBufferLayout(this.parameters)}getConfiguration(Ae,He){return this._configuration.output=Ae,this._configuration.vvSize=this.parameters.vvSizeEnabled,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.vvOpacity=this.parameters.vvOpacityEnabled,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,Ae!==Xs.H.Color&&Ae!==Xs.H.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?pu.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?pu.q.WindingOrder:pu.q.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!He.ssaoHelper.ready&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=He.transparencyPassType,this._configuration.hasMultipassTerrain=He.multipassTerrain.enabled,this._configuration.cullAboveGround=He.multipassTerrain.cullAboveGround,this._configuration}isVisibleInPass(Ae){return Ae!==ha.C.MATERIAL_DEPTH_SHADOWMAP_ALL&&Ae!==ha.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&Ae!==ha.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const Ae=this.parameters;return!!super.isVisible()&&Ae.opacity>0}intersect(Ae,He,it,ht,Dt,Vt,Qt){const cr=Ae;if(!co(cr))return;const xr=cr.path,Xr=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){const Oi=this.parameters.vvSizeOffset,Li=this.parameters.vvSizeFactor,os=this.parameters.vvSizeMinSize,mn=this.parameters.vvSizeMaxSize,Bs=xr.sizeAttributeValue;Xr[0]*=(0,Ar.uZ)(Oi[0]+Bs*Li[0],os[0],mn[0]),Xr[1]*=(0,Ar.uZ)(Oi[2]+Bs*Li[2],os[2],mn[2])}const Vr=Math.max(Xr[0],Xr[1]),ei=Ae.boundingInfo;if((0,G.Wi)(ei))return void this._intersectTriangles(xr,Xr,Dt,Vt,Qt);const di=(0,ce.al)(ei.bbMin[0]-Vr,ei.bbMin[1]-Vr,ei.bbMin[2]-Vr,ei.bbMax[0]+Vr,ei.bbMax[1]+Vr,ei.bbMax[2]+Vr),_t=[Vt[0]-Dt[0],Vt[1]-Dt[1],Vt[2]-Dt[2]],vi=Math.sqrt(_t[0]*_t[0]+_t[1]*_t[1]+_t[2]*_t[2]);(0,ic.Tw)(di,Dt,[vi/_t[0],vi/_t[1],vi/_t[2]],ht.tolerance)&&this._intersectTriangles(xr,Xr,Dt,Vt,Qt)}_intersectTriangles(Ae,He,it,ht,Dt){Ae.baked.size&&Ae.baked.size[0]===He[0]&&Ae.baked.size[1]===He[1]||Ae.baked.bake(He),Ae.baked.intersect(it,ht,Dt)}computeAttachmentOrigin(Ae,He){const it=Ae.vertexAttributes;if(!it)return null;const ht=it.get(Oe.T.POSITION);return(0,ud.qZ)(ht,null,!1,He)}createBufferWriter(){return new Ku(this.vertexBufferLayout)}requiresSlot(Ae){return Ae===(this.parameters.transparent?ti.r.TRANSPARENT_MATERIAL:ti.r.OPAQUE_MATERIAL)||Ae===ti.r.DRAPED_MATERIAL}createGLMaterial(Ae){return Ae.output===Xs.H.Color||Ae.output===Xs.H.Alpha||Ae.output===Xs.H.Depth||Ae.output===Xs.H.Normal||Ae.output===Xs.H.Highlight||Ae.output===Xs.H.Shadow&&this.parameters.castShadows?new Da(Ae):null}static getVertexBufferLayout(Ae){let He=(0,ia.U$)().vec3f(Oe.T.POSITION).vec4f(Oe.T.PROFILERIGHT).vec4f(Oe.T.PROFILEUP).vec4f(Oe.T.PROFILEVERTEXANDNORMAL);return(Ae.vvColorEnabled||Ae.vvSizeEnabled||Ae.vvOpacityEnabled)&&(He=He.vec4f(Oe.T.FEATUREVALUE)),He}}class Da extends fu.Z{_updateOccludeeState(Ae){Ae.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Ae.hasOccludees})}_updateShadowState(Ae){((0,G.Wi)(this.technique)||Ae.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:Ae.shadowMap.enabled})}beginSlot(Ae){return this._output!==Xs.H.Color&&this._output!==Xs.H.Alpha||(this._updateShadowState(Ae),this._updateOccludeeState(Ae)),this.ensureTechnique(Gl,Ae)}}class _p extends Hu{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}}class Ku{constructor(Ae){this.vertexBufferLayout=Ae}allocate(Ae){return this.vertexBufferLayout.createBuffer(Ae)}elementCount(Ae){return Ae.indices.get(Oe.T.POSITION).length}write(Ae,He,it,ht){const Dt=Vt=>{if(He.vertexAttributes.has(Vt)){const Qt=He.vertexAttributes.get(Vt),cr=He.indices.get(Vt);(0,Xo.hu)(4===Qt.size);const xr=it.getField(Vt,Me.ek);if(!xr)throw new Error("unable to acquire view for "+Vt);(0,_u.SW)(cr,Qt.data,xr,ht)}};Dt(Oe.T.PROFILERIGHT),Dt(Oe.T.PROFILEUP),Dt(Oe.T.PROFILEVERTEXANDNORMAL),this.vertexBufferLayout.hasField(Oe.T.FEATUREVALUE)&&Dt(Oe.T.FEATUREVALUE),(0,_u.NK)(He,this.vertexBufferLayout,Ae.transformation,Ae.invTranspTransformation,it,ht)}}const Ah=["polyline"];function mu(It,Ae,He){switch(Ae){case"world":for(const it of It.vertices)(0,B.a)(Ka,it.pos,It.offset),He.worldUpAtPosition(Ka,qa),it.setFrameFromUpVector(qa),it.computeRotationAxisAndAngleFromUpVector();break;case"path":(0,B.a)(Ka,It.vertices[0].pos,It.offset),He.worldUpAtPosition(Ka,qa),function Gc(It,Ae){let He=null;const it=It.vertices.length,ht=.99619469809,Dt=(0,Z.c)(),Vt=(0,Z.c)(),Qt=(0,Z.c)(),cr=(0,Z.c)(),xr=(0,Z.c)(),Xr=(0,Z.c)(),Vr=(0,lc.Ue)();let ei=It.vertices[0];(0,B.c)(Vt,Ae),(0,B.s)(Dt,0,1,0),Wr.Z.makeOrthoBasisDirUpFallback(ei.vRight,Vt,Dt,Dt,Qt,Vt,ht),(0,B.c)(ei.frame.up,Vt),(0,B.c)(ei.frame.right,Qt),He=ei;for(let di=1;di<it;++di){ei=It.vertices[di],(0,B.a)(xr,ei.vLeft,ei.vRight);let _t=(0,B.l)(xr);_t>0?(_t=1/Math.sqrt(_t),xr[0]=xr[0]*_t,xr[1]=xr[1]*_t,xr[2]=xr[2]*_t):(xr[0]=ei.vRight[0],xr[1]=ei.vRight[1],xr[2]=ei.vRight[2]),(0,B.a)(Xr,He.pos,He.frame.up),(0,lc.Yq)(ei.pos,xr,Vr),(0,lc.BR)(Vr,(0,Vl.re)(Xr,ei.vLeft),cr)?((0,B.b)(cr,cr,ei.pos),(0,B.n)(Vt,cr),(0,B.f)(Qt,xr,Vt),(0,B.n)(Qt,Qt)):Wr.Z.makeOrthoBasisDirUpFallback(xr,He.frame.up,He.frame.right,Dt,Qt,Vt,ht),(0,B.c)(ei.frame.up,Vt),(0,B.c)(ei.frame.right,Qt),He=ei}}(It,qa);for(const it of It.vertices){const ht=Math.sign((0,B.e)(it.frame.right,it.vRight));(0,B.f)(it.rotationFrame.up,it.vRight,it.vLeft),(0,B.g)(it.rotationFrame.up,it.rotationFrame.up,ht),(0,B.n)(it.rotationFrame.up,it.rotationFrame.up);const Dt=(0,B.e)(it.rotationFrame.up,it.frame.up),Vt=(0,B.e)(it.rotationFrame.up,it.frame.right);if((0,B.g)(Ka,it.frame.up,-Vt),(0,B.g)(Xd,it.frame.right,Dt),(0,B.a)(Ka,Ka,Xd),(0,B.n)(it.rotationFrame.right,Ka),kd(it.rotationRight,it.frame,it.rotationFrame.right),(0,B.o)(Ka,it.vLeft),it.rotationAngle=-ht*(Math.PI-(0,Ar.ZF)((0,B.e)(Ka,it.vRight))),Math.abs(it.rotationAngle)>0){const cr=(0,Ar.b_)(Math.cos(.5*it.rotationAngle));du(it.miterStretch,1+(cr-1)*it.rotationRight[0]*it.rotationRight[0],(cr-1)*it.rotationRight[0]*it.rotationRight[1],(cr-1)*it.rotationRight[0]*it.rotationRight[1],1+(cr-1)*it.rotationRight[1]*it.rotationRight[1])}const Qt=Math.PI-it.rotationAngle;it.maxStretchDistance=Math.abs(Math.min(it.vLeftLength,it.vRightLength)*(0,Ar.b_)(Math.cos(.5*Qt)))}}}function Ml(It,Ae,He){switch(It){case"symbol-value":return He;case"proportional":return Ae;default:return It}}function u0(It,Ae,He,it){let ht=0;for(const Dt of It.vertices)(0,Ce.qZ)(Dt.posES,He,Ae,it,vd),ht+=vd.sampledElevation,(0,B.a)(qa,Dt.pos,It.offset),it.setAltitude(qa,vd.z),(0,B.b)(Dt.pos,qa,It.offset);return It.updatePathVertexInformation(),ht/It.vertices.length}function Hc(It,Ae,He,it){const ht=It.stageObject,Dt=ht.geometryRecords;let Vt=0;Sh.spatialReference=it.spatialReference;for(const Qt of Dt){const cr=Qt.geometry;if(!co(cr))continue;const xr=cr.path,Xr=xr.builder.path;Kc.spatialReference=cr.geometrySR,Vt+=u0(Xr,Ae,He,it),"world"!==cr.upVectorAlignment&&mu(Xr,cr.upVectorAlignment,it),xr.onPathChanged(),cr.invalidateBoundingInfo(),ht.geometryVertexAttrsUpdated(Qt)}return Vt/Dt.length}const Sh=(0,le.Tx)(0,0,0,null),Kc=(0,le.Tx)(0,0,0,null),qa=(0,Z.c)(),Ka=(0,Vs.c)(),Xd=(0,Vs.c)(),vd=new Ce.Lm;var qd=T(12080);function Rh(It,Ae,He,it,ht=1){(0,B.s)(on,1,0,0),(0,B.s)(Rs,0,1,0),(0,B.s)(pl,0,0,1),function yp(It,Ae){(0,B.s)(wa,0,0,0);for(let He=0;He<Ae.count-1;He++)Ae.getVec(He,_n),(0,B.a)(wa,wa,_n);(0,B.g)(It,wa,1/(Ae.count-1))}(Ed,Ae),function gp(It,Ae){const He=It.count-1;return(0,lc.$I)(It,Ae,0,Math.floor(He/3),Math.floor(He*(2/3)))}(Ae,gu)&&function Cc(It,Ae,He,it,ht,Dt){(0,G.pC)(ht)?(ht.basisMatrixAtPosition(Dt,Pl),(0,B.s)(hc,Pl[0],Pl[1],Pl[2]),(0,B.s)(Hl,Pl[4],Pl[5],Pl[6]),(0,B.s)(Ts,Pl[8],Pl[9],Pl[10])):((0,B.s)(hc,1,0,0),(0,B.s)(Hl,0,1,0),(0,B.s)(Ts,0,0,1));const Vt=(0,lc.mJ)(It);(0,B.e)(Vt,Ts)<0&&(0,B.g)(Vt,Vt,-1),(0,B.c)(it,Vt);const Qt=(0,B.e)(Vt,Hl),cr=(0,B.e)(Vt,hc);Math.abs(Qt)<Math.abs(cr)?((0,B.C)(Ae,hc,Vt,-cr),(0,B.n)(Ae,Ae),(0,B.f)(He,Ae,Vt),(0,B.n)(He,He),(0,B.g)(He,He,-1)):((0,B.C)(He,Hl,Vt,-Qt),(0,B.n)(He,He),(0,B.f)(Ae,He,Vt),(0,B.n)(Ae,Ae))}(gu,on,Rs,pl,He,Ed),(0,J.a)(go,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),(0,J.a)(Ol,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let cr=0;cr<Ae.count;cr++){Ae.getVec(cr,_n);const xr=(0,B.e)(on,_n),Xr=(0,B.e)(Rs,_n);go[0]=Math.min(go[0],xr),go[1]=Math.min(go[1],Xr),Ol[0]=Math.max(Ol[0],xr),Ol[1]=Math.max(Ol[1],Xr)}const Dt=(0,B.e)(pl,Ed);oa(bc,go[0],go[1],Dt,on,Rs,pl),oa(Ki,Ol[0],go[1],Dt,on,Rs,pl),oa(yu,go[0],Ol[1],Dt,on,Rs,pl),(0,B.b)(Ki,Ki,bc),(0,B.g)(Ki,Ki,.5),(0,B.b)(yu,yu,bc),(0,B.g)(yu,yu,.5),(0,B.a)(bc,bc,Ki),(0,B.a)(bc,bc,yu);const Qt=go[1]%ht;Za[0]=go[0]-go[0]%ht,Za[1]=go[1]-Qt;for(let cr=0;cr<Ae.count;cr++){Ae.getVec(cr,_n),It.setValues(cr,((0,B.e)(on,_n)-Za[0])/ht,((0,B.e)(Rs,_n)-Za[1])/ht,Za[0]/ht,Za[1]/ht);for(let xr=0;xr<3;xr++)it.set(cr,xr,bc[xr]),it.set(cr,xr+3,Ki[xr]),it.set(cr,xr+6,yu[xr])}}const Ed=(0,Z.c)(),_n=(0,Z.c)(),gu=(0,lc.Ue)(),on=(0,Z.c)(),Rs=(0,Z.c)(),pl=(0,Z.c)(),go=(0,W.a)(),Ol=(0,W.a)(),Za=(0,W.a)(),bc=(0,Z.c)(),Ki=(0,Z.c)(),yu=(0,Z.c)(),Pl=(0,ye.c)(),hc=(0,Z.c)(),Hl=(0,Z.c)(),Ts=(0,Z.c)(),wa=(0,Z.c)();function oa(It,Ae,He,it,ht,Dt,Vt){(0,B.s)(It,Ae*ht[0]+He*Dt[0]+it*Vt[0],Ae*ht[1]+He*Dt[1]+it*Vt[1],Ae*ht[2]+He*Dt[2]+it*Vt[2])}var bd=T(92972),Ia=T(95402),Cd=T(60909),eh=T(66401);class jo extends zo.A{initializeProgram(Ae){const He=jo.shader.get().build(this.configuration);return new cs.$(Ae.rctx,He,bi)}_setPipelineState(Ae,He){const it=this.configuration,ht=Ae===ze.Am.NONE,Dt=Ae===ze.Am.FrontFace;return(0,us.sm)({blending:it.output===Xs.H.Color||it.output===Xs.H.Alpha?ht?nn.wu:(0,nn.j7)(Ae):null,culling:(0,us.zp)(it.cullFace),depthTest:{func:(0,nn.Bh)(Ae)},depthWrite:ht?it.writeDepth&&us.LZ:(0,nn.K5)(Ae),colorWrite:us.BK,stencilWrite:it.hasOccludees?Yn.s3:null,stencilTest:it.hasOccludees?He?Yn.eD:Yn.RY:null,polygonOffset:ht||Dt?it.polygonOffset&&La:(0,nn.je)(it.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(Ae,He){return He?this._occludeePipelineState:super.getPipelineState(Ae,He)}}jo.shader=new Wa.J(eh.P,()=>T.e(5655).then(T.bind(T,35655)));const La={factor:1,units:1};class Qn extends Tr.W{constructor(){super(...arguments),this.output=Xs.H.Color,this.cullFace=ze.Vr.None,this.transparencyPassType=ze.Am.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,kt._)([(0,ur.o)({count:Xs.H.COUNT})],Qn.prototype,"output",void 0),(0,kt._)([(0,ur.o)({count:ze.Vr.COUNT})],Qn.prototype,"cullFace",void 0),(0,kt._)([(0,ur.o)({count:Ia.b.COUNT})],Qn.prototype,"style",void 0),(0,kt._)([(0,ur.o)({count:ze.Am.COUNT})],Qn.prototype,"transparencyPassType",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"hasSlicePlane",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"hasVertexColors",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"polygonOffset",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"writeDepth",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"hasOccludees",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"patternSpacing",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"lineWidth",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"enableOffset",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"draped",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"hasMultipassTerrain",void 0),(0,kt._)([(0,ur.o)()],Qn.prototype,"cullAboveGround",void 0);const bi=new Map([[Oe.T.POSITION,0],[Oe.T.COLOR,3],[Oe.T.UVMAPSPACE,4],[Oe.T.BOUNDINGRECT,5]]);class Le extends xo.F5{constructor(Ae){super(Ae,new Et),this.supportsEdges=!0,this._vertexAttributeLocations=bi,this.techniqueConfig=new Qn}getConfiguration(Ae,He){return this.techniqueConfig.output=Ae,this.techniqueConfig.cullFace=this.parameters.cullFace,this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.polygonOffset=this.parameters.polygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.style=this.parameters.style,this.techniqueConfig.patternSpacing=this.parameters.patternSpacing,this.techniqueConfig.lineWidth=this.parameters.lineWidth,this.techniqueConfig.draped=this.parameters.draped,this.techniqueConfig.transparencyPassType=He.transparencyPassType,this.techniqueConfig.enableOffset=He.camera.relativeElevation<nn.ve,this.techniqueConfig.hasMultipassTerrain=He.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=He.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(Ae,He,it,ht,Dt,Vt,Qt){(0,ic.Bw)(Ae,He,ht,Dt,Vt,void 0,Qt)}requiresSlot(Ae,He){return Ae===ti.r.DRAPED_MATERIAL||((0,ro.S)(He)===Xs.H.Highlight?Ae===ti.r.OPAQUE_MATERIAL:Ae===(this.parameters.writeDepth?ti.r.TRANSPARENT_MATERIAL:ti.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL))}createGLMaterial(Ae){return Ae.output===Xs.H.Color||Ae.output===Xs.H.Alpha||Ae.output===Xs.H.Highlight||Ae.output===Xs.H.Depth&&this.parameters.writeLinearDepth?new Qe(Ae):null}createBufferWriter(){const Ae=(0,ia.U$)().vec3f(Oe.T.POSITION).vec4u8(Oe.T.COLOR).vec4f(Oe.T.UVMAPSPACE);return this.parameters.draped||Ae.mat3f(Oe.T.BOUNDINGRECT),new ut(Ae)}}class Qe extends fu.Z{_updateParameters(Ae){return this.ensureTechnique(jo,Ae)}_updateOccludeeState(Ae){Ae.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Ae.hasOccludees})}beginSlot(Ae){return this._output!==Xs.H.Color&&this._output!==Xs.H.Alpha||this._updateOccludeeState(Ae),this._updateParameters(Ae)}}class ut extends Cd.G_{write(Ae,He,it,ht){for(const Dt of this.vertexBufferLayout.fieldNames){const Vt=He.vertexAttributes.get(Dt),Qt=He.indices.get(Dt);if(Vt&&Qt)switch(Dt){case Oe.T.POSITION:{(0,Xo.hu)(3===Vt.size);const cr=it.getField(Dt,Me.ct);cr&&(0,_u.ho)(Qt,Vt.data,Ae.transformation,cr,ht);break}case Oe.T.COLOR:{(0,Xo.hu)(3===Vt.size||4===Vt.size);const cr=it.getField(Dt,Me.mc);cr&&(0,_u.Vs)(Qt,Vt.data,Vt.size,cr,ht);break}case Oe.T.UVMAPSPACE:{(0,Xo.hu)(4===Vt.size);const cr=it.getField(Dt,Me.ek);cr&&(0,_u.SW)(Qt,Vt.data,cr,ht);break}case Oe.T.BOUNDINGRECT:{(0,Xo.hu)(9===Vt.size);const cr=it.getField(Dt,Me.gK);cr&&this.writeBoundingRect(Qt,Vt.data,Ae.transformation,cr,ht);break}}}}writeBoundingRect(Ae,He,it,ht,Dt){const Vt=it,Qt=ht.typedBuffer,cr=ht.typedBufferStride,xr=Ae.length;Dt*=cr;for(let Xr=0;Xr<xr;++Xr){const Vr=9*Ae[Xr],ei=He[Vr],di=He[Vr+1],_t=He[Vr+2];Qt[Dt]=Vt[0]*ei+Vt[4]*di+Vt[8]*_t+Vt[12],Qt[Dt+1]=Vt[1]*ei+Vt[5]*di+Vt[9]*_t+Vt[13],Qt[Dt+2]=Vt[2]*ei+Vt[6]*di+Vt[10]*_t+Vt[14];for(let vi=3;vi<9;++vi)Qt[Dt+vi]=He[Vr+vi];Dt+=cr}}}class Et extends xo.Mt{constructor(){super(...arguments),this.color=(0,Kr.f)(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=ze.Vr.None,this.hasOccludees=!1,this.style=Ia.b.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}}function Pt(It,Ae){if(function gt(It){return It.material instanceof Le&&!It.material.parameters.draped}(It)){const He=It.geometry.vertexAttributes,it=He.get(Oe.T.POSITION).data,ht=He.get(Oe.T.UVMAPSPACE).data,Dt=He.get(Oe.T.BOUNDINGRECT).data;Rh(Me.ek.fromTypedArray(ht),Me.fP.fromTypedArray(it),Ae,Me.ey.fromTypedArray(Dt))}}function Yt(It,Ae,He,it){const ht=(0,pr.Wf)(It,Ae,He,it),Dt=It.stageObject.geometryRecords;for(let Vt=0;Vt<Dt.length;Vt++)Pt(Dt[Vt],it);return ht}const Jr=["polyline","polygon","extent"];class Mi extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht),this._needsUV=!1,this._hasOutline=!1}doLoad(){return(0,x.Z)(function*(){})()}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){if((0,G.pC)(this._material))return;const Ae=(0,G.U2)(this.symbolLayer,"material","color"),He=this._getCombinedOpacityAndColor(Ae);this._material=function xt(It,Ae,He){return function ar(It,Ae,He){return(0,G.pC)(It)?"none"===It.style||"solid"===It.style?("none"===It.style&&(Ae.color=(0,Kr.f)(0,0,0,0),Ae.transparent=!0),new bd.E(Ae)):(Ae.style=function Ve(It){switch(It){case"horizontal":return Ia.b.Horizontal;case"vertical":return Ia.b.Vertical;case"cross":return Ia.b.Cross;case"forward-diagonal":return Ia.b.ForwardDiagonal;case"backward-diagonal":return Ia.b.BackwardDiagonal;case"diagonal-cross":return Ia.b.DiagonalCross;default:return}}(It.style),Ae.draped=He.isDraped,new Le(Ae)):new bd.E(Ae)}(function Gt(It){return It&&It.pattern||null}(It),Ae,He)}(this.symbolLayer,{color:He,transparent:He[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped}),this._needsUV=this._material instanceof Le,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const Ae=this.symbolLayer.outline;!(0,G.pC)(this._outlineMaterial)&&this._isValidOutline(Ae)&&(this._hasOutline=!0,this._outlineMaterial=(it=>{const ht=(0,Hi.Dp)(Ae.pattern);return new fs.U({width:it,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:ht,stippleScaleWithLineWidth:!0,cap:(0,Yo.u9)(Ae.patternCap||"butt")})})((0,ri.F2)(Ae.size)),this._context.stage.add(this._outlineMaterial))}_isValidOutline(Ae){return(0,G.pC)(Ae)&&Ae.size&&Ae.size>0&&(0,G.pC)(Ae.color)&&((0,G.Wi)(Ae.pattern)||"style"!==Ae.pattern.type||"none"!==Ae.pattern.style)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(Ae){const He=Ae.graphic;if(!this._validateGeometry(He.geometry,Jr,this.symbolLayer.type))return null;const it=this._getVertexOpacityAndColor(Ae.renderingInfo,255),ht=this.setGraphicElevationContext(He,new Ie.o);return this.ensureDrapedStatus("on-the-ground"===ht.mode),this._ensureMaterials(),this.draped?this._createAsOverlay(He,it):this._createAs3DShape(He,it,ht)}layerOpacityChanged(){if((0,G.pC)(this._material)){const Ae=this._material.parameters.color,He=(0,G.U2)(this.symbolLayer,"material","color"),it=this._getCombinedOpacity(He);this._material.setParameters({color:[Ae[0],Ae[1],Ae[2],it],transparent:it<1||this.needsDrivenTransparentPass})}if((0,G.pC)(this._outlineMaterial)){const Ae=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[Ae[0],Ae[1],Ae[2],this._getOutlineOpacity()]})}return!0}layerElevationInfoChanged(Ae,He,it){const ht=this._elevationContext.mode,Dt=(0,Ce.GC)(Mi.elevationModeChangeTypes,it,ht);if(Dt!==Ce.lO.UPDATE)return Dt;const Vt=(0,Ce.Xf)(ht);return this.updateGraphics3DGraphicElevationInfo(Ae,He,()=>Vt)}slicePlaneEnabledChanged(){return(0,G.pC)(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),(0,G.pC)(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(Ae,He,it){const ht=De(Ae.geometry);if((0,G.Wi)(ht))return null;Si.renderData=Fe(ht,this._context.elevationProvider,this._context.renderCoordsHelper,it),Si.color=He;const Dt=Si.renderData.position.length/3;if(this._needsUV&&(Si.uvMapSpace=new Float32Array(4*Dt),Si.boundingRect=new Float64Array(9*Dt)),Si.outNum=0,Si.outGeometries=[],Si.outTransforms=[],Si.outMaterials=[],this._createAs3DShapeFill(Si),this._hasOutline&&this._createAs3DShapeOutline(Si),this._logGeometryCreationWarnings(Si.renderData,ht.rings,"rings","FillSymbol3DLayer"),0===Si.outNum)return null;this._needsUV&&Rh(Me.ek.fromTypedArray(Si.uvMapSpace),Me.fP.fromTypedArray(Si.renderData.position),this._context.renderCoordsHelper,Me.ey.fromTypedArray(Si.boundingRect));const Vt=new et.T({geometries:Si.outGeometries,materials:Si.outMaterials,transformations:Si.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:Ae.uid}}),Qt=new se.z(this,Vt,Si.outGeometries,null,null,Yt,it);return Qt.alignedSampledElevation=Si.renderData.sampledElevation,Qt.needsElevationUpdates=(0,Ce.Xf)(it.mode),Qt}_createAs3DShapeFill(Ae){const He=Ae.renderData.polygons;for(const{position:it,mapPosition:ht,holeIndices:Dt,index:Vt,count:Qt}of He){if((0,G.pC)(this._context.clippingExtent)&&((0,ce.cS)(Pi),(0,ce.G1)(Pi,ht),!(0,ce.Zp)(Pi,this._context.clippingExtent)))continue;const cr=(0,_e.e)(ht,Dt,3);if(0===cr.length)continue;const Xr=Be({indices:new Uint32Array(cr),attributeData:{position:it,color:Ae.color,mapPosition:ht,uvMapSpace:this._needsUV?new Float32Array(Ae.uvMapSpace.buffer,4*Vt*Ae.uvMapSpace.BYTES_PER_ELEMENT,4*Qt):null,boundingRect:this._needsUV?new Float64Array(Ae.boundingRect.buffer,9*Vt*Ae.boundingRect.BYTES_PER_ELEMENT,9*Qt):null}});Ae.outGeometries.push(Xr),Ae.outMaterials.push((0,G.Wg)(this._material)),Ae.outTransforms.push(ye.I),Ae.outNum++}}_createAs3DShapeOutline(Ae){if(!this._hasOutline)return;const He=Ae.renderData.outlines;for(let it=0;it<He.length;++it){const{mapPosition:ht,position:Dt}=He[it];if((0,G.pC)(this._context.clippingExtent)&&((0,ce.cS)(Pi),(0,ce.G1)(Pi,ht),!(0,ce.Zp)(Pi,this._context.clippingExtent)))continue;const Vt=(0,Yo.YU)({overlayInfo:null,removeDuplicateStartEnd:Yo.NW.REMOVE,attributeData:{position:Dt,mapPosition:ht}}),Qt=Vt.vertexAttributes.get(Oe.T.POSITION);Qt.data===Dt&&(Qt.data=new Float64Array(Dt)),Ae.outGeometries.push(Vt),Ae.outMaterials.push((0,G.Wg)(this._outlineMaterial)),Ae.outTransforms.push(ye.I),Ae.outNum++}}_createAsOverlay(Ae,He){const it=De(Ae.geometry);return(0,G.Wi)(it)?null:((0,G.Wg)(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2,(0,G.pC)(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority),xs.renderData=ve(it,this._context.overlaySR),xs.color=He,this._needsUV&&(xs.uvMapSpace=new Float32Array(xs.renderData.position.length/3*4)),xs.outNum=0,xs.outGeometries=[],xs.outBoundingBox=(0,ce.cS)(),xs.layerUid=this._context.layer.uid,xs.graphicsUid=Ae.uid,this._createAsOverlayFill(xs),this._hasOutline&&this._createAsOverlayOutline(xs),this._logGeometryCreationWarnings(xs.renderData,it.rings,"rings","FillSymbol3DLayer"),0===xs.outNum?null:(this._needsUV&&function Ec(It,Ae,He,it,ht=1){if(He.isGeographic&&it===me.JY.Global){const Qt=new Float64Array(Ae.typedBuffer.length),cr=3*Ae.count,xr=(0,qd.Iu)(He);for(let Xr=0;Xr<cr;Xr+=3)(0,ue.gH)(Ae.typedBuffer,Xr,Qt,Xr,xr);Ae=Me.fP.fromTypedArray(Qt)}(0,J.a)(go,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let Qt=0;Qt<Ae.count;Qt++)Ae.getVec(Qt,_n),go[0]=Math.min(go[0],_n[0]),go[1]=Math.min(go[1],_n[1]);const Vt=go[1]%ht;Za[0]=go[0]-go[0]%ht,Za[1]=go[1]-Vt;for(let Qt=0;Qt<Ae.count;Qt++)Ae.getVec(Qt,_n),It.setValues(Qt,(_n[0]-Za[0])/ht,(_n[1]-Za[1])/ht,Za[0]/ht,Za[1]/ht)}(Me.ek.fromTypedArray(xs.uvMapSpace),Me.fP.fromTypedArray(xs.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode),xs.outNum>0?new Fr(this,xs.outGeometries,xs.outBoundingBox,this._context.drapeSourceRenderer):null))}_createAsOverlayFill(Ae){const He=Ae.renderData.polygons;for(const{position:it,holeIndices:ht,index:Dt,count:Vt}of He){if((0,ce.cS)(Pi),(0,ce.G1)(Pi,it),!(0,ce.Zp)(Pi,this._context.clippingExtent))continue;const Qt=(0,_e.e)(it,ht,3);if(0===Qt.length)continue;(0,ce.TC)(Ae.outBoundingBox,Pi);const xr=Be({indices:new Uint32Array(Qt),attributeData:{position:it,color:Ae.color,uvMapSpace:this._needsUV?new Float32Array(Ae.uvMapSpace.buffer,4*Dt*Ae.uvMapSpace.BYTES_PER_ELEMENT,4*Vt):null}}),Xr=new Di.z(xr,(0,G.Wg)(this._material),{layerUid:Ae.layerUid,graphicUid:Ae.graphicsUid});(0,Dr.s)(Xr.boundingSphere,.5*(Pi[0]+Pi[3]),.5*(Pi[1]+Pi[4]),0,.5*Math.sqrt((Pi[3]-Pi[0])*(Pi[3]-Pi[0])+(Pi[4]-Pi[1])*(Pi[4]-Pi[1]))),Ae.outGeometries.push(Xr),Ae.outNum++}}_createAsOverlayOutline(Ae){if(!this._hasOutline)return;const He=Ae.renderData.outlines;for(let it=0;it<He.length;++it){const{position:ht}=He[it];if((0,ce.cS)(Pi),(0,ce.G1)(Pi,ht),!(0,ce.Zp)(Pi,this._context.clippingExtent))continue;(0,ce.TC)(Ae.outBoundingBox,Pi);const Dt=(0,Yo.YU)({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:Yo.NW.REMOVE,attributeData:{position:ht}}),Vt=new Di.z(Dt,(0,G.Wg)(this._outlineMaterial),{layerUid:Ae.layerUid,graphicUid:Ae.graphicsUid});(0,Dr.s)(Vt.boundingSphere,.5*(Pi[0]+Pi[3]),.5*(Pi[1]+Pi[4]),0,.5*Math.sqrt((Pi[3]-Pi[0])*(Pi[3]-Pi[0])+(Pi[4]-Pi[1])*(Pi[4]-Pi[1]))),Ae.outGeometries.push(Vt),Ae.outNum++}}_getOutlineOpacity(){const Ae=(0,G.U2)(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*((0,G.pC)(Ae)?Ae.a:0)}_getOutlineColor(){const Ae=(0,G.U2)(this.symbolLayer,"outline","color"),He=this._getOutlineOpacity();return(0,Je.Uu)((0,G.pC)(Ae)?Ur.Z.toUnitRGB(Ae):null,He)}test(){return yi(or({},super.test()),{createAsOverlay:(Ae,He)=>this._createAsOverlay(Ae,He),createAs3DShape:(Ae,He,it)=>this._createAs3DShape(Ae,He,it)})}}Mi.elevationModeChangeTypes={definedChanged:Ce.lO.RECREATE,staysOnTheGround:Ce.lO.NONE,onTheGroundChanged:Ce.lO.RECREATE};const Pi=(0,ce.Ue)(),Si={renderData:null,color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},xs={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};var Kn=T(9824),Mn=T(65542),el=T(6169);class Kl{constructor(Ae,He,it){this._renderer=new el.tV(Ae,He,it)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const Ae=(0,el.GZ)(vu,this._renderer.renderedWidth,this._renderer.renderedHeight),He=Ae.getContext("2d");return He.save(),this._renderer.render(He,0,0),He.restore(),new Wi.x(Ae,{wrap:{s:Ei.e8.CLAMP_TO_EDGE,t:Ei.e8.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:ze.CE.PAD})}}const vu={canvas:null},Tc=[0,0,1];function vp(It,Ae,He){It&&It.forEach(it=>{const ht=Ae(it);(0,G.pC)(ht)&&He(ht,it.graphic)})}const Eu={mode:"relative-to-ground",offset:0},Ep={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};var bp=T(16730),gf=T(44989);const yf={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},d0=["polyline","polygon","extent"];class $u extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht)}doLoad(){return(0,x.Z)(function*(){})()}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(Ae){const He=Ae.graphic;if(!this._validateGeometry(He.geometry,d0,this.symbolLayer.type))return null;const it=this.setGraphicElevationContext(He,new Ie.o);return this.ensureDrapedStatus("on-the-ground"===it.mode),this.ensureMaterial(),this.draped?this._createAsOverlay(He):this._createAs3DShape(He,it,He.uid)}ensureMaterial(){if((0,G.pC)(this._material))return;const Ae=new gf.m,He=this.symbolLayer.color;(0,G.pC)(He)&&(Ae.color=Ur.Z.toUnitRGBA(He));const it=this._getCombinedOpacity(He,{hasIntrinsicColor:!0});Ae.color=[Ae.color[0],Ae.color[1],Ae.color[2],it],Ae.transparent=it<1||this.needsDrivenTransparentPass,Ae.waveDirection=(0,G.pC)(this.symbolLayer.waveDirection)?$u.headingVectorFromAngle(this.symbolLayer.waveDirection):(0,W.f)(0,0);const Dt=yf[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];Ae.waveStrength=Dt.waveStrength,Ae.waveTextureRepeat=Dt.textureRepeat,Ae.waveVelocity=Dt.waveVelocity,Ae.flowStrength=Dt.perturbationStrength,Ae.hasSlicePlane=this._context.slicePlaneEnabled,Ae.isDraped=this.draped,this._material=new gf.H(Ae),this._context.stage.add(this._material)}layerOpacityChanged(){if((0,G.Wi)(this._material))return!0;const Ae=this._material.parameters.color,He=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});return this._material.setParameters({color:[Ae[0],Ae[1],Ae[2],He],transparent:He<1||this.needsDrivenTransparentPass}),!0}layerElevationInfoChanged(Ae,He,it){const ht=this._elevationContext.mode,Dt=(0,Ce.GC)($u.elevationModeChangeTypes,it,ht);if(Dt!==Ce.lO.UPDATE)return Dt;const Vt=(0,Ce.Xf)(ht);return this.updateGraphics3DGraphicElevationInfo(Ae,He,()=>Vt)}slicePlaneEnabledChanged(){return(0,G.pC)(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!0}_createAs3DShape(Ae,He,it){const ht=De(Ae.geometry);if((0,G.Wi)(ht))return null;fl.renderData=Fe(ht,this._context.elevationProvider,this._context.renderCoordsHelper,He);const Dt=fl.renderData.position.length/3;if(fl.uvCoords=new Float64Array(2*Dt),fl.outNum=0,fl.outGeometries=[],fl.outTransforms=[],fl.outMaterials=[],this._create3DShapeGeometries(fl),this._logGeometryCreationWarnings(fl.renderData,ht.rings,"rings","WaterSymbol3DLayer"),0===fl.outNum)return null;this._createUVCoordsFromVertices(fl.uvCoords,fl.renderData.mapPosition,Dt,this._context.elevationProvider.spatialReference);const Vt=new et.T({geometries:fl.outGeometries,materials:fl.outMaterials,transformations:fl.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:it}}),Qt=new se.z(this,Vt,fl.outGeometries,null,null,pr.Wf,He);return Qt.alignedSampledElevation=fl.renderData.sampledElevation,Qt.needsElevationUpdates=(0,Ce.Xf)(He.mode),Qt}_createUVCoordsFromVertices(Ae,He,it,ht){const Dt=(0,bp.c9)(ht);(0,oe.cS)(Mc);for(let cr=0;cr<it;cr++)(0,J.a)(vm,He[3*cr+0],He[3*cr+1]),(0,oe.Ho)(Mc,vm);(0,Dr.b)(Mc,Mc,Dt);const Qt=Mc[1]%$u.unitSizeOfTexture;h0[0]=Mc[0]-Mc[0]%$u.unitSizeOfTexture,h0[1]=Mc[1]-Qt;for(let cr=0;cr<it;cr++)Ae[2*cr+0]=(He[3*cr+0]*Dt-h0[0])/$u.unitSizeOfTexture,Ae[2*cr+1]=(He[3*cr+1]*Dt-h0[1])/$u.unitSizeOfTexture}_create3DShapeGeometries(Ae){const He=Ae.renderData.polygons,it=Ae.uvCoords;for(const{count:ht,index:Dt,position:Vt,mapPosition:Qt,holeIndices:cr}of He){if((0,G.pC)(this._context.clippingExtent)&&((0,ce.cS)(th),(0,ce.G1)(th,Qt),!(0,ce.Zp)(th,this._context.clippingExtent)))continue;const xr=(0,_e.e)(Qt,cr,3);if(0===xr.length)continue;const ei=Se({indices:new Uint32Array(xr),attributeData:{position:Vt,uv0:new Float64Array(it.buffer,2*Dt*it.BYTES_PER_ELEMENT,2*ht),mapPosition:Qt}});Ae.outGeometries.push(ei),Ae.outMaterials.push((0,G.Wg)(this._material)),Ae.outTransforms.push(ye.I),Ae.outNum++}}_createAsOverlay(Ae){const He=De(Ae.geometry);if((0,G.Wi)(He))return null;(0,G.Wg)(this._material).renderPriority=this._renderPriority,xl.renderData=ve(He,this._context.overlaySR);const it=xl.renderData.position.length/3;return xl.uvCoords=new Float64Array(2*it),xl.outNum=0,xl.outGeometries=[],xl.outBoundingBox=(0,ce.cS)(),xl.layerUid=this._context.layer.uid,xl.graphicsUid=Ae.uid,this._createAsOverlayWater(xl),this._logGeometryCreationWarnings(xl.renderData,He.rings,"rings","WaterSymbol3DLayer"),0===xl.outNum?null:(this._createUVCoordsFromVertices(xl.uvCoords,xl.renderData.position,it,this._context.overlaySR),xl.outNum>0?new Fr(this,xl.outGeometries,xl.outBoundingBox,this._context.drapeSourceRenderer):null)}_createAsOverlayWater(Ae){const He=Ae.uvCoords,it=Ae.renderData.polygons;for(const{position:ht,holeIndices:Dt,index:Vt,count:Qt}of it){if((0,ce.cS)(th),(0,ce.G1)(th,ht),!(0,ce.Zp)(th,this._context.clippingExtent))continue;(0,ce.TC)(Ae.outBoundingBox,th);const cr=(0,_e.e)(ht,Dt,3);if(0===cr.length)continue;const Vr=Se({indices:new Uint32Array(cr),attributeData:{position:ht,uv0:new Float64Array(He.buffer,2*Vt*He.BYTES_PER_ELEMENT,2*Qt)}}),ei=new Di.z(Vr,(0,G.Wg)(this._material),{layerUid:Ae.layerUid,graphicUid:Ae.graphicsUid});(0,Dr.s)(ei.boundingSphere,.5*(th[0]+th[3]),.5*(th[1]+th[4]),0,.5*Math.sqrt((th[3]-th[0])*(th[3]-th[0])+(th[4]-th[1])*(th[4]-th[1]))),Ae.outGeometries.push(ei),Ae.outNum++}}static headingVectorFromAngle(Ae){const He=(0,W.a)(),it=(0,uu.t)(Ae);return He[0]=Math.sin(it),He[1]=Math.cos(it),He}test(){return yi(or({},super.test()),{create3DShape:Ae=>this._createAs3DShape(Ae.graphic,Ae.elevationContext,Ae.graphicUid),ensureMaterial:()=>this.ensureMaterial()})}}$u.unitSizeOfTexture=100,$u.elevationModeChangeTypes={definedChanged:Ce.lO.RECREATE,staysOnTheGround:Ce.lO.NONE,onTheGroundChanged:Ce.lO.RECREATE};const h0=(0,W.a)(),Mc=(0,oe.Ue)(),vm=(0,W.a)(),th=(0,ce.Ue)(),fl={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},xl={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},bu=ae.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");function VT(It,Ae,He,it){const ht=bm[It.type]&&bm[It.type][Ae.type]||oy[Ae.type];return ht?new ht(It,Ae,He,it):(bu.error("GraphicsLayerFactory#make",`unknown symbol type ${Ae.type}`),null)}const oy={icon:_o,object:class ga extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this.hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.ensureDrapedStatus(!1),this.hasLoadedPBRTextures=it.physicalBasedRenderingEnabled}getCachedSize(){const[Ae,He,it]=(0,G.pC)(this._resources)?this._resources.symbolSize:[1,1,1];return{width:Ae,depth:He,height:it}}doLoad(Ae){var He=this;return(0,x.Z)(function*(){if(!He._drivenProperties.size&&(0,Je.bh)(He.symbolLayer))throw new Error;const it=He.symbolLayer;if(He.isPrimitive){const ht=it.resource?it.resource.primitive:ol.S;He._resources=yield He._createResourcesForPrimitive(ht,Ae)}else He._resources=yield He._createResourcesForUrl(it.resource.href,Ae);He.layerOpacityChanged(),He.slicePlaneEnabledChanged(),He.physicalBasedRenderingChanged(),He.complexity=He.computeComplexity()})()}get extentPadding(){return(0,G.pC)(this._resources)?this._resources.extentPadding:0}get isPrimitive(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}get lodRenderer(){return(0,G.U2)(this._resources,"lodRenderer")}_setMaterialTransparencyParams(Ae,He=(0,G.U2)(this.symbolLayer,"material","color")){const it=this._getCombinedOpacity(He),ht=it<1||this.needsDrivenTransparentPass;return Ae.transparent=ht,Ae.opacity=it,Ae.cullFace=ht?ze.Vr.None:ze.Vr.Back,Ae}_createResourcesForPrimitive(Ae,He){var it=this;return(0,x.Z)(function*(){if(!(0,a0.F)(Ae))throw new Error(`Unknown object symbol primitive: ${Ae}`);const ht=it.symbolLayer,Dt=(0,ce.Ue)((0,Pn.Uz)(Ae)),Vt=(0,Z.d)((0,ce.dp)(Dt)),Qt=(0,Z.d)((0,Pn.$K)(Vt,ht)),cr=(0,B.l)(Qt),Vr={usePBR:it._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:Z.O,diffuse:Z.O,hasSlicePlane:it._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:it.symbolLayer.castShadows,offsetTransparentBackfaces:!it.symbolLayer.isPrimitive},ei=Vr.usePBR;it._setMaterialTransparencyParams(Vr);const di=it.symbol;if("point-3d"===di.type&&di.verticalOffset){const{screenLength:Li,minWorldLength:os,maxWorldLength:mn}=di.verticalOffset;Vr.verticalOffset={screenLength:(0,ri.F2)(Li),minWorldLength:os||0,maxWorldLength:null!=mn?mn:1/0},Vr.castShadows=!1}if(it._context.screenSizePerspectiveEnabled&&(Vr.screenSizePerspective=it._context.sharedResources.screenSizePerspectiveSettings),it._drivenProperties.color)Vr.externalColor=Kr.O;else{const Li=(0,G.pC)(ht.material)&&ht.material.color,os=(0,G.pC)(Li)?Ur.Z.toUnitRGBA(Li):Kr.O;Vr.externalColor=os}it._fastUpdates=Ds(it._context.renderer,it._fastVisualVariableConvertOptions(Dt,Qt,Vt,G.YP)),Vr.instanced=["transformation"],it._fastUpdates.enabled?(Object.assign(Vr,it._fastUpdates.materialParameters),Vr.instanced.push("featureAttribute"),it._optionalFields.push("featureAttribute")):it._hasPerInstanceColor()&&(Vr.instanced.push("color"),it._optionalFields.push("color"));const _t=new ke.Gp(Vr),vi=(0,a0.t)(Ae,_t);if(!vi)throw new Error(`Unknown object symbol primitive: ${Ae}`);const Zi=(0,zi.aH)(vi).map(Li=>({opacity:1,transparent:Li.parameters.transparent})),Oi=yield it._createStageResources(vi,ei);return{lodResources:vi,lodRenderer:yield it._createLodRenderer(vi,He),stageResources:Oi,symbolSize:Qt,extentPadding:cr,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:Zi,physicalBasedRenderingEnabled:ei,resourceBoundingBox:Dt,resourceSize:Vt,pivotOffset:G.YP}})()}_createResourcesForUrl(Ae,He){var it=this;return(0,x.Z)(function*(){const ht=["transformation"],Dt={materialParamsMixin:{instanced:ht,hasSlicePlane:it._context.slicePlaneEnabled,castShadows:it.symbolLayer.castShadows},streamDataRequester:it._context.streamDataRequester,cache:it._context.sharedResources.objectResourceCache};it._fastUpdates=Ds(it._context.renderer,it._fastVisualVariableConvertOptions(G.YP,G.YP,G.YP,G.YP)),it._fastUpdates.enabled?(Object.assign(Dt.materialParamsMixin,it._fastUpdates.materialParameters),ht.push("featureAttribute"),it._optionalFields.push("featureAttribute")):it._hasPerInstanceColor()&&(ht.push("color"),it._optionalFields.push("color"));const Vt=it.symbol;if("point-3d"===Vt.type&&Vt.verticalOffset){const{screenLength:jn,minWorldLength:Dl,maxWorldLength:vn}=Vt.verticalOffset;Dt.materialParamsMixin.verticalOffset={screenLength:(0,ri.F2)(jn),minWorldLength:Dl||0,maxWorldLength:null!=vn?vn:1/0},Dt.materialParamsMixin.castShadows=!1}Dt.signal=He,Dt.usePBR=it._context.physicalBasedRenderingEnabled;const Qt=Dt.usePBR,cr=yield(0,Jo.fetch)(Ae,Dt),xr=cr.isEsriSymbolResource,Xr=cr.isWosr;it._addDisposeResource(()=>cr.remove());const Vr=function Ro(It){return{levels:It.map(Ae=>function nt(It){const Ae=[];return It.stageResources.geometries.forEach((He,it)=>{Ae.push({material:It.stageResources.materials[it],geometry:He,textures:It.stageResources.textures})}),{components:Ae,minScreenSpaceRadius:It.lodThreshold,pivotOffset:It.pivotOffset}}(Ae))}}(cr.lods);(function dd(It){It.levels.forEach(Ae=>{Ae.minScreenSpaceRadius||(Ae.minScreenSpaceRadius=function ui(It,Ae=Cl){const He=(0,zi.HI)(It);return Math.sqrt(He/(Ae*Math.PI))}(Ae))})})(Vr),Vr.levels.sort((jn,Dl)=>jn.minScreenSpaceRadius-Dl.minScreenSpaceRadius),Vr.levels[0].minScreenSpaceRadius=Math.min(2,Vr.levels[0].minScreenSpaceRadius);const ei=it._context,_t=it._getExternalColorParameters(it.symbolLayer.material),vi=(0,G.U2)(it.symbolLayer,"material","color"),Zi=it._getCombinedOpacity(vi,{hasIntrinsicColor:!0}),Oi=it.needsDrivenTransparentPass,Li=(0,zi.aH)(Vr),os=(0,zi.aH)(Vr).map(jn=>({opacity:jn.parameters.opacity||1,transparent:jn.parameters.transparent}));Li.forEach(jn=>{const Dl=jn.parameters;jn.setParameters(_t);const vn=Dl.opacity*Zi;jn.setParameters({opacity:vn,transparent:vn<1||Oi||Dl.transparent}),ei.screenSizePerspectiveEnabled&&jn.setParameters({screenSizePerspective:ei.sharedResources.screenSizePerspectiveSettings})});const mn=cr.referenceBoundingBox,Bs=(0,Z.d)((0,ce.dp)(mn)),Rn=(0,Z.d)(Vr.levels[0].pivotOffset),un=(0,Z.d)((0,Pn.$K)(Bs,it.symbolLayer)),yo=(0,B.l)(un);Ps(it._fastUpdates,it._context.renderer,it._fastVisualVariableConvertOptions(mn,un,Bs,Rn))&&Li.forEach(jn=>jn.setParameters(it._fastUpdates.materialParameters));const wn=yield it._createStageResources(Vr,Qt);return{lodResources:Vr,lodRenderer:yield it._createLodRenderer(Vr,He),stageResources:wn,symbolSize:un,extentPadding:yo,isEsriSymbolResource:xr,isWosr:Xr,originalMaterialParameters:os,physicalBasedRenderingEnabled:Qt,resourceBoundingBox:mn,resourceSize:Bs,pivotOffset:Rn}})()}_addDisposeResource(Ae){this._disposeResourceHandles.push(Ae)}_createStageResources(Ae,He){var it=this;return(0,x.Z)(function*(){const ht=it._context.stage,Dt=(0,zi.aH)(Ae);He!==it._context.physicalBasedRenderingEnabled&&it.physicalBasedRenderingChanged(),ht.addMany(Dt),it._addDisposeResource(()=>ht.removeMany(Dt));const Vt=(0,zi.VQ)(Ae);ht.addMany(Vt),it._addDisposeResource(()=>ht.removeMany(Vt)),yield ht.load(Vt);const Qt=(0,zi.ci)(Ae);return ht.addMany(Qt),it._addDisposeResource(()=>ht.removeMany(Qt)),{materials:Dt,textures:Vt,geometries:Qt}})()}_createLodRenderer(Ae,He){var it=this;return(0,x.Z)(function*(){const ht=it._context.stage,Dt={layerUid:it._context.layer.uid,graphicUid:cr=>it._instanceIndexToGraphicUid.get(cr),notifyGraphicGeometryChanged:cr=>it._context.notifyGraphicGeometryChanged(it._instanceIndexToGraphicUid.get(cr)),notifyGraphicVisibilityChanged:cr=>it._context.notifyGraphicVisibilityChanged(it._instanceIndexToGraphicUid.get(cr))},Qt=new Wc(Ae,it._optionalFields,Dt,it._fastUpdates.enabled?{applyTransform:(cr,xr,Xr)=>{cr.getFeatureAttribute(xr,Qa),(0,ge.c)(Xr,Sr(it._fastUpdates.materialParameters,Qa,Xr))},scaleFactor:(cr,xr,Xr)=>(xr.getFeatureAttribute(Xr,Qa),mr(cr,it._fastUpdates.materialParameters,Qa))}:null);return Qt.slicePlaneEnabled=it._context.slicePlaneEnabled,it._addDisposeResource(()=>{ht.removeRenderPlugin(Qt)}),yield ht.addRenderPlugin(Qt.slots,Qt,He),Qt})()}_getExternalColorParameters(Ae){const He={};return this._drivenProperties.color?He.externalColor=Kr.O:(0,G.pC)(Ae)&&(0,G.pC)(Ae.color)?He.externalColor=Ur.Z.toUnitRGBA(Ae.color):(He.externalColor=Kr.O,He.colorMixMode="ignore"),He}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(Ae=>Ae()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(Ae){const He=Ae.graphic;if(!this._validateGeometry(He.geometry))return null;const it=(0,Ni.S_)(He.geometry);if((0,G.Wi)(it))return this.logger.warn(`unsupported geometry type for icon symbol: ${He.geometry.type}`),null;const ht=this.setGraphicElevationContext(He,new Ie.o);return this._createAs3DShape(He,it,Ae.renderingInfo,ht,He.uid)}notifyDestroyGraphicLayer(Ae){this._instanceIndexToGraphicUid.delete(Ae.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){if((0,G.Wi)(this._resources))return!0;const Ae=this._drivenProperties.opacity,He=!this.isPrimitive,it=this._resources.stageResources.materials,ht=this._resources.originalMaterialParameters;for(let Dt=0;Dt<it.length;Dt++){const Vt=it[Dt],Qt=(0,G.U2)(this.symbolLayer,"material","color"),cr=ht[Dt],xr=this._getCombinedOpacity(Qt,{hasIntrinsicColor:He})*cr.opacity,Xr=xr<1||Ae||cr.transparent;Vt.setParameters({opacity:xr,transparent:Xr}),this.isPrimitive&&Vt.setParameters({cullFace:Xr?ze.Vr.None:ze.Vr.Back})}return!0}layerElevationInfoChanged(Ae,He){return this.updateGraphics3DGraphicElevationInfo(Ae,He,Ce.B5)}slicePlaneEnabledChanged(){if((0,G.Wi)(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const Ae of this._resources.stageResources.materials)Ae.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if((0,G.Wi)(this._resources))return!0;const{stageResources:Ae,isWosr:He}=this._resources;for(const it of Ae.materials)this.isPrimitive?it.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):He||it.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1!==this.hasLoadedPBRTextures||!0!==this._context.physicalBasedRenderingEnabled||(this.hasLoadedPBRTextures=!0,!1)}pixelRatioChanged(){return!0}applyRendererDiff(Ae,He){if((0,G.Wi)(this._resources))return xe.W.Recreate_Symbol;const{stageResources:{materials:it},lodRenderer:ht,resourceBoundingBox:Dt,symbolSize:Vt,resourceSize:Qt,pivotOffset:cr}=this._resources;for(const xr in Ae.diff){if("visualVariables"!==xr||!Ps(this._fastUpdates,He,this._fastVisualVariableConvertOptions(Dt,Vt,Qt,cr)))return xe.W.Recreate_Symbol;for(const Xr of it)Xr.setParameters(this._fastUpdates.materialParameters);ht.notifyShaderTransformationChanged()}return xe.W.Fast_Update}computeComplexity(){return(0,G.Wi)(this._resources)?super.computeComplexity():{primitivesPerFeature:(0,zi.VV)(this._resources.lodResources.levels[0]).reduce((Ae,He)=>Ae+He.indices.get(Oe.T.POSITION).length,0)/3,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:(0,vc.BN)(this.symbol,this.symbolLayer)}}_hasLodRenderer(){return(0,G.pC)(this._resources)}_createAs3DShape(Ae,He,it,ht,Dt){if(!this._hasLodRenderer()||(0,G.Wi)(this._resources))return null;const Vt=this.getFastUpdateAttrValues(Ae),Qt=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?(0,Je.Uu)(it.color,it.opacity):null,cr=this._context.clippingExtent;if((0,ue.KC)(He,li,this._context.elevationProvider.spatialReference),(0,G.pC)(cr)&&!(0,ce.BD)(cr,li))return null;const xr=this._requiresTerrainElevation(ht),Xr=this._computeGlobalTransform(He,ht,vs,qo),Vr=this._computeLocalTransform(this._resources,this.symbolLayer,it,Kd),ei=this._resources.lodRenderer.instanceData,di=ei.addInstance();this._instanceIndexToGraphicUid.set(di,Dt),ei.setLocalTransform(di,Vr,!1),ei.setGlobalTransform(di,Xr),Vt&&ei.setFeatureAttribute(di,Vt),Qt&&ei.setColor(di,Qt);const _t=new Fl(this,di,pr.RX,ht);return xr&&(_t.alignedSampledElevation=qo.sampledElevation),_t.needsElevationUpdates=(0,Ce.B5)(ht.mode),(0,Ni.dO)(_t,He,this._context.elevationProvider),_t}_computeGlobalTransform(Ae,He,it,ht){return(0,Ce.qZ)(Ae,this._context.elevationProvider,He,this._context.renderCoordsHelper,ht),li[0]=Ae.x,li[1]=Ae.y,li[2]=ht.z,(0,ue.Bm)(Ae.spatialReference,li,it,this._context.renderCoordsHelper.spatialReference),it}_computeLocalTransform(Ae,He,it,ht){return(0,ge.i)(ht),this._applyObjectRotation(it,!1,ht),this._applyObjectRotation(He,!0,ht),this._applyObjectScale(Ae,it,ht),this._applyAnchor(Ae,He,ht),ht}_applyObjectScale(Ae,He,it){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const Dt=(0,Je.bD)(this._drivenProperties.size&&He.size?He.size:Ae.symbolSize,Ae.symbolSize,Ae.resourceSize,this._context.renderCoordsHelper.unitInMeters);1===Dt[0]&&1===Dt[1]&&1===Dt[2]||(0,ge.h)(it,it,Dt)}prepareSymbolLayerPatch(Ae){if("partial"!==Ae.diff.type)return;const He=Ae.diff.diff;this._preparePatchTransform(Ae,He),this._preparePatchColor(Ae,He)}updateGeometry(Ae,He){if((0,G.Wi)(this._resources))return!0;const it=He&&(0,Ni.S_)(He);if((0,G.Wi)(it))return!1;const ht=this.getGeometryElevationMode(He);return Ae.elevationContext.mode===ht&&(this._computeGlobalTransform(it,Ae.elevationContext,vs,qo),this._requiresTerrainElevation(Ae.elevationContext)&&(Ae.alignedSampledElevation=qo.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(Ae.instanceIndex,vs,!0),(0,Ni.dO)(Ae,it,this._context.elevationProvider),!0)}_preparePatchTransform(Ae,He){if(!(He.heading||He.tilt||He.roll||He.width||He.height||He.depth||He.anchor||He.anchorPosition)||(0,G.Wi)(this._resources))return;const it=(_t,vi,Zi)=>(0,G.Pt)(null!=_t&&"complete"===_t.type?_t.newValue:vi,Zi),ht=it(He.heading,this.symbolLayer.heading,0),Dt=it(He.tilt,this.symbolLayer.tilt,0),Vt=it(He.roll,this.symbolLayer.roll,0),Qt=it(He.width,this.symbolLayer.width,void 0),cr=it(He.height,this.symbolLayer.height,void 0),xr=it(He.depth,this.symbolLayer.depth,void 0),Xr=it(He.anchor,this.symbolLayer.anchor,void 0),Vr=it(He.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete He.heading,delete He.tilt,delete He.roll,delete He.width,delete He.height,delete He.depth,delete He.anchor,delete He.anchorPosition;const ei={heading:ht,tilt:Dt,roll:Vt,anchor:Xr,anchorPosition:Vr},di=this._resources;this.loadStatus===pn.P.LOADED&&Ae.symbolLayerStatePatches.push(()=>{di.symbolSize=(0,Z.d)((0,Pn.$K)(di.resourceSize,{width:Qt,height:cr,depth:xr,isPrimitive:this.symbolLayer.isPrimitive}))}),Ae.graphics3DGraphicPatches.push((_t,vi)=>{const Zi=this._computeLocalTransform(di,ei,vi,Kd);di.lodRenderer.instanceData.setLocalTransform(_t.instanceIndex,Zi,!0)})}_preparePatchColor(Ae,He){if(!He.material||"partial"!==He.material.type)return;const it=He.material.diff;if(!it.color||"complete"!==it.color.type||null==it.color.newValue||null==it.color.oldValue)return;const ht=it.color.newValue,Dt=(0,G.pC)(ht)?Ur.Z.toUnitRGBA(ht):Kr.O;delete it.color;const Vt=this._resources;(0,G.Wi)(Vt)||Ae.graphics3DGraphicPatches.push(Qt=>{let cr;this._hasPerInstanceColor()?(Vt.lodRenderer.instanceData.setColor(Qt.instanceIndex,Dt),cr=this._setMaterialTransparencyParams({},ht)):cr=this._setMaterialTransparencyParams({externalColor:Dt},ht);for(const xr of Vt.stageResources.materials)xr.setParameters(cr)})}_requiresTerrainElevation(Ae){return"absolute-height"!==Ae.mode}_applyObjectRotation(Ae,He,it){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&He))return(0,Je._Z)(Ae.heading,Ae.tilt,Ae.roll,it)}_computeAnchor(Ae,He,it){const ht=(0,Z.c)();switch(it.anchor){case"center":(0,B.c)(ht,(0,ce.be)(Ae)),(0,B.o)(ht,ht);break;case"top":{const Dt=(0,ce.be)(Ae);(0,B.s)(ht,-Dt[0],-Dt[1],-Ae[5]);break}case"bottom":{const Dt=(0,ce.be)(Ae);(0,B.s)(ht,-Dt[0],-Dt[1],-Ae[2]);break}case"relative":{const Dt=(0,ce.be)(Ae),Vt=(0,ce.dp)(Ae),Qt=it.anchorPosition,cr=Qt?(0,Z.f)(Qt.x,Qt.y,Qt.z):Z.Z;(0,B.E)(ht,Vt,cr),(0,B.a)(ht,ht,Dt),(0,B.o)(ht,ht);break}default:(0,G.pC)(He)?(0,B.o)(ht,He):(0,B.c)(ht,Z.Z)}return ht}_applyAnchor(Ae,He,it){if(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation)return;const ht=this._computeAnchor(Ae.resourceBoundingBox,Ae.pivotOffset,He);ht&&(0,ge.j)(it,it,ht)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(Ae,He,it,ht){const Dt=(0,G.pC)(Ae)?(0,Z.d)((0,ce.dp)(Ae)):Z.O,Vt=(0,G.pC)(Ae)?this._computeAnchor(Ae,ht,this.symbolLayer):Z.Z,Qt=this._context.renderCoordsHelper.unitInMeters,cr=(0,Je.bD)((0,G.pC)(He)?He:void 0,He,it,Qt),xr=(0,Z.f)(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:Dt,symbolSize:(0,G.pC)(He)?He:Z.O,unitInMeters:Qt,transformation:{anchor:Vt,scale:cr,rotation:xr}}}},line:On,path:class mf extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht),this._intrinsicSize=(0,W.f)(1,1),this.upVectorAlignment="path",this.stencilWidth=.1,this.ensureDrapedStatus(!1)}doLoad(){var Ae=this;return(0,x.Z)(function*(){const He=(0,G.pC)(Ae.symbolLayer.width)?Ae.symbolLayer.width:Ae.symbolLayer.height,it=(0,G.pC)(Ae.symbolLayer.height)?Ae.symbolLayer.height:He;Ae._vvConvertOptions={modelSize:[1,1,1],symbolSize:[He,1,it],unitInMeters:Ae._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}},Ae._fastUpdates=Ae._context.renderer&&Ae._context.renderer.visualVariables&&Ae._context.renderer.visualVariables.length>0?Ds(Ae._context.renderer,Ae._vvConvertOptions):{enabled:!1};const ht=Ae.symbolLayer.anchor||"center";Ae.upVectorAlignment="path","heading"===Ae.symbolLayer.profileRotation&&(Ae.upVectorAlignment="world");const Dt=Ae.symbolLayer.profile||"circle";switch(Dt){case"circle":default:Ae._profile=dl.circle(10);break;case"quad":Ae._profile=dl.rect()}let Vt=[0,0];switch("center"!==ht&&(Vt={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[ht],Ae._profile.translate(Vt[0],Vt[1])),Ae.symbolLayer.join||"simple"){case"round":Ae._extruder=new cc(0,3);break;case"bevel":Ae._extruder=new cc(0,1);break;case"miter":Ae._extruder=new cc(.8*Math.PI,1);break;default:Ae._extruder=new hp}const Qt=Ae.symbolLayer.cap||"butt";switch(Qt){case"none":Ae._startCap=new To,Ae._endCap=new To;break;case"butt":default:Ae._startCap=new Xn(Ae._profile,0),Ae._endCap=new Xn(Ae._profile,0,!0);break;case"square":Ae._startCap=new Xn(Ae._profile,-.5),Ae._endCap=new Xn(Ae._profile,.5,!0);break;case"round":{const _t="quad"===Dt;Ae._startCap=new qs({profile:Ae._profile,flip:!1,breakNormals:_t,subdivisions:3}),Ae._endCap=new qs({profile:Ae._profile,flip:!0,breakNormals:_t,subdivisions:3});break}}const cr=(0,G.U2)(Ae.symbolLayer,"material","color"),xr=Ae._getCombinedOpacityAndColor(cr),Xr=(0,Z.d)(xr),Vr=xr[3],ei=Vr<1||Ae.needsDrivenTransparentPass,di={diffuse:Xr,ambient:Xr,opacity:Vr,transparent:ei,hasVertexColors:!1,hasSlicePlane:Ae._context.slicePlaneEnabled,castShadows:Ae.symbolLayer.castShadows,cullFace:ei||"none"===Qt?ze.Vr.None:ze.Vr.Back,offsetTransparentBackfaces:!0};if(!Ae._drivenProperties.size&&((0,J.a)(Ae._intrinsicSize,He,it),!(0,Je.ZL)(Ae._intrinsicSize[0])||!(0,Je.ZL)(Ae._intrinsicSize[1])))throw new de.Z("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(Ae._fastUpdates.enabled&&Ae._fastUpdates.visualVariables.size||(0,J.f)(Ae._intrinsicSize,Ae._intrinsicSize,1/Ae._context.renderCoordsHelper.unitInMeters),Ae._fastUpdates.enabled){const _t=yi(or(or({},di),Ae._fastUpdates.materialParameters),{size:(0,W.b)(Ae._intrinsicSize)});Ae._material=new dc(_t)}else di.hasVertexColors=Ae._drivenProperties.color||Ae._drivenProperties.opacity,Ae._material=new ke.Gp(di);Ae._material.setParameters({usePBR:Ae._context.physicalBasedRenderingEnabled,isSchematic:!0}),Ae._context.stage.add(Ae._material)})()}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(Ae){const He=Ae.graphic;if(!this._validateGeometry(He.geometry,Ah,this.symbolLayer.type))return null;const it=this.setGraphicElevationContext(He,new Ie.o);return this._createAs3DShape(He,Ae.renderingInfo,it,He.uid)}layerOpacityChanged(){const Ae=(0,G.U2)(this.symbolLayer,"material","color"),He=this._getCombinedOpacity(Ae);return this._material.setParameters({opacity:He,transparent:He<1||this.needsDrivenTransparentPass}),!0}layerElevationInfoChanged(Ae,He){return this.updateGraphics3DGraphicElevationInfo(Ae,He,Ce.B5)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}applyRendererDiff(Ae,He){for(const it in Ae.diff){if("visualVariables"!==it||!Ps(this._fastUpdates,He,this._vvConvertOptions))return xe.W.Recreate_Symbol;this._material.setParameters(this._fastUpdates.materialParameters)}return xe.W.Fast_Update}getVertexData(Ae){let He=0;const it=Ae.paths,ht=[],Dt=Ae.spatialReference,Vt=this._context.elevationProvider.spatialReference,Qt=this._context.renderCoordsHelper.spatialReference;for(const di of it)He+=di.length;const cr=new Float64Array(3*He),xr=new Float64Array(3*He),Xr=new Float64Array(3*He);let Vr=0;for(const di of it){ht.push({index:Vr,numVertices:di.length});for(const _t of di)cr[Vr++]=_t[0],cr[Vr++]=_t[1],cr[Vr++]=Ae.hasZ?_t[2]:0}let ei=!0;return Dt.equals(Vt)?this._copyVertices(cr,0,xr,0,He):ei=(0,ue.CM)(cr,Dt,0,xr,Vt,0,He),Vt.equals(Qt)?this._copyVertices(xr,0,Xr,0,He):(0,ue.CM)(xr,Vt,0,Xr,Qt,0,He),{pathVertexDataInfos:ht,vertexDataGS:cr,vertexDataES:xr,vertexDataRS:Xr,projectionSuccess:ei,terrainElevation:0}}_copyVertices(Ae,He,it,ht,Dt){He*=3,ht*=3;for(let Vt=0;Vt<Dt;++Vt)it[ht++]=Ae[He++],it[ht++]=Ae[He++],it[ht++]=Ae[He++]}_createAs3DShape(Ae,He,it,ht){const Dt=Ae.geometry,Vt=new Array,Qt=new Array,cr=new Array,xr=Dt.spatialReference,Xr=(0,ce.Ue)(),Vr=this._context.renderCoordsHelper;Kc.spatialReference=xr;const ei=this.getVertexData(Dt);if(!ei.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(ei.pathVertexDataInfos.length>0){for(let di=0;di<ei.pathVertexDataInfos.length;++di){const _t=ei.pathVertexDataInfos[di],vi=_t.index,Zi=_t.numVertices;if(Zi<2||(0,G.pC)(this._context.clippingExtent)&&((0,ce.cS)(Xr),(0,ce.G1)(Xr,ei.vertexDataES,3*vi,Zi),!(0,ce.Zp)(Xr,this._context.clippingExtent)))continue;const Oi=[];for(let yo=vi;yo<vi+3*Zi;){const wn=yo++,jn=yo++,Dl=yo++,vn=new hu;(0,B.s)(vn.posGS,ei.vertexDataGS[wn],ei.vertexDataGS[jn],ei.vertexDataGS[Dl]),(0,B.s)(vn.posES,ei.vertexDataES[wn],ei.vertexDataES[jn],ei.vertexDataES[Dl]);const vo=(0,Ce.w7)(vn.posES,this._context.elevationProvider,it,Vr);(0,B.s)(qa,ei.vertexDataRS[wn],ei.vertexDataRS[jn],ei.vertexDataRS[Dl]),Vr.setAltitude(qa,vo),(0,B.s)(vn.pos,qa[0],qa[1],qa[2]),Oi.push(vn)}const Li=new zl(Oi);mu(Li,this.upVectorAlignment,this._context.renderCoordsHelper);const os=new Ph(Li,this._profile,this._extruder,this._startCap,this._endCap);let mn=null;if(this._fastUpdates.enabled){const yo=this._fastUpdates.visualVariables,wn=yo.size?(0,Ge.d)(yo.size.field,Ae):0,jn=yo.color?(0,Ge.d)(yo.color.field,Ae):0,Dl=yo.opacity?(0,Ge.d)(yo.opacity.field,Ae):0;mn=new Yd(os,wn,jn,Dl)}else{const yo=[this._intrinsicSize[0],this._intrinsicSize[1]];this._drivenProperties.size&&(yo[0]*=Ml(He.size[0],"symbol-value"===He.size[2]?this.symbolLayer.height||0:He.size[2],this.symbolLayer.width||0),yo[1]*=Ml(He.size[2],"symbol-value"===He.size[0]?this.symbolLayer.width||0:He.size[0],this.symbolLayer.height||0));let wn=null;this._drivenProperties.color&&(wn=He.color),this._drivenProperties.opacity&&null!=He.opacity&&(wn=wn?[wn[0],wn[1],wn[2],He.opacity]:[1,1,1,He.opacity]);const jn=new ya(os);jn.bake(yo),wn&&jn.bakeVertexColors(wn),mn=jn}const{vertexAttributes:Bs,indices:Rn}=mn.createGeometryData(),un=new po(Bs,Rn,mn,xr,this.upVectorAlignment,this.stencilWidth);Vt.push(un),Qt.push(this._material),cr.push(mn.xform)}if(Vt.length>0){const _t=new et.T({geometries:Vt,materials:Qt,transformations:cr,metadata:{layerUid:this._context.layer.uid,graphicUid:ht}}),vi=new se.z(this,_t,Vt,null,null,Hc,it);return vi.alignedSampledElevation=ei.terrainElevation,vi.needsElevationUpdates=(0,Ce.B5)(it.mode),vi}}else 0!==Dt.paths.length&&Dt.paths.some(di=>di.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null}},fill:Mi,extrude:class at extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht),this.ensureDrapedStatus(!1)}doLoad(){var Ae=this;return(0,x.Z)(function*(){if(!Ae._drivenProperties.size){const cr=(0,Je.bh)(Ae._getSymbolSize());if(cr)throw new de.Z("graphics3dextrudesymbollayer:invalid-size",cr)}const He=(0,G.U2)(Ae.symbolLayer,"material","color"),it=Ae._getCombinedOpacityAndColor(He),ht=(0,Z.d)(it),Dt=it[3],Vt=Dt<1||Ae.needsDrivenTransparentPass,Qt={usePBR:Ae._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:ht,ambient:ht,opacity:Dt,transparent:Vt,cullFace:Vt?ze.Vr.None:ze.Vr.Back,hasVertexColors:!0,hasSlicePlane:Ae._context.slicePlaneEnabled,castShadows:Ae.symbolLayer.castShadows,offsetTransparentBackfaces:!0};Ae._material=new ke.Gp(Qt),Ae._bottomMaterial=new ke.Gp(yi(or({},Qt),{cullFace:ze.Vr.Back})),Ae._context.stage.add(Ae._material),Ae._context.stage.add(Ae._bottomMaterial)})()}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(Ae){const He=Ae.graphic;if(!this._validateGeometry(He.geometry,ot,this.symbolLayer.type))return null;const it=this._getVertexOpacityAndColor(Ae.renderingInfo,255),ht=this.setGraphicElevationContext(He,new Ie.o);return this._createAs3DShape(He,Ae.renderingInfo,it,ht,He.uid)}layerOpacityChanged(Ae,He){const it=(0,G.U2)(this.symbolLayer,"material","color"),ht=this._getCombinedOpacity(it),Dt=ht<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:ht,transparent:Dt}),this._bottomMaterial.setParameters({opacity:ht,transparent:Dt});const Vt=this._getLayerOpacity();return Ae.forEach(Qt=>{const cr=He(Qt);(0,G.pC)(cr)&&cr.layerOpacityChanged(Vt,this._context.isAsync)}),!0}layerElevationInfoChanged(Ae,He){return this.updateGraphics3DGraphicElevationInfo(Ae,He,Ce.B5)}slicePlaneEnabledChanged(Ae,He){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),Ae.forEach(it=>{const ht=He(it);(0,G.pC)(ht)&&ht.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}pixelRatioChanged(){return!0}_getExtrusionSize(Ae){var it;let He;return He=Ae.size&&this._drivenProperties.size?null!=(it=(0,Te.sV)(Ae.size,2))?it:0:this._getSymbolSize(),He/=this._context.renderCoordsHelper.unitInMeters,He}applyRendererDiff(Ae,He){return this._drivenPropertiesChanged(He)?xe.W.Recreate_Symbol:xe.W.Recreate_Graphics}_getSymbolSize(){var Ae;return null!=(Ae=this.symbolLayer.size)?Ae:1}_createAs3DShape(Ae,He,it,ht,Dt){const Vt=De(Ae.geometry);if((0,G.Wi)(Vt))return null;const Qt=Fe(Vt,this._context.elevationProvider,this._context.renderCoordsHelper,ht);if(this._logGeometryCreationWarnings(Qt,Vt.rings,"rings","ExtrudeSymbol3DLayer"),0===Vt.rings.length||!Vt.rings.some(ea=>ea.length>0))return null;const cr=(0,Je.zE)(Vt);if((0,G.Wi)(cr))return null;const xr=new Array,Xr=new Array,Vr=new Array,ei=(0,ce.Ue)(),di=(0,ye.c)(),_t=(0,Z.c)(),vi=this._context.renderCoordsHelper.viewingMode===me.JY.Global;vi||this._context.renderCoordsHelper.worldUpAtPosition(null,_t),(0,ue.Bm)(Vt.spatialReference,[cr.x,cr.y,0],di,this._context.renderCoordsHelper.spatialReference);const Zi=(0,ye.c)();(0,ge.a)(Zi,di);const Oi=(0,he.c)();(0,pe.a)(Oi,Zi);const{polygons:Li,mapPosition:os,position:mn}=Qt,Bs=mn.length/3,Rn=new Float64Array(3*Bs*6),un=new Float64Array(3*Bs*6),yo=new Float64Array(3*Bs*6),wn=new Float64Array(1*Bs*6);let jn=0;for(let ea=0;ea<Li.length;++ea){const Jt=Li[ea],ls=Jt.count;if(this._context.clippingExtent&&((0,ce.cS)(ei),(0,ce.G1)(ei,Jt.mapPosition),!(0,ce.Zp)(ei,this._context.clippingExtent)))continue;const Ih=(0,_e.e)(Jt.mapPosition,Jt.holeIndices,3);if(0===Ih.length)continue;const a_=new Uint32Array(3*ls*2+Ih.length),Zc=new Uint32Array(Ih.length),Lh=6*ls,$a=3*Rn.BYTES_PER_ELEMENT,f0=new Me.fP(Rn.buffer,jn*$a,$a,(jn+Lh)*$a),Cm=3*un.BYTES_PER_ELEMENT,js=new Me.fP(un.buffer,jn*Cm,Cm,(jn+Lh)*Cm),Zn=new Float64Array(yo.buffer,3*jn*yo.BYTES_PER_ELEMENT,3*Lh),Tm=new Float64Array(wn.buffer,1*jn*wn.BYTES_PER_ELEMENT,1*Lh),Mm=this._getExtrusionSize(He);wt(mn,os,Ih,Jt,f0.typedBuffer,Zn,js.typedBuffer,Tm,0,a_,Zc,Mm,_t,vi),(0,Ee.t)(f0,f0,Zi),(0,Ee.a)(js,js,Oi),jn+=6*ls;const Om=yt(a_,a_.length-Zc.length,{positions:f0.typedBuffer,elevation:Zn,normals:js.typedBuffer,heights:Tm},it);xr.push(Om),Xr.push(this._material),Vr.push(ye.I);const Oo=yt(Zc,0,{positions:f0.typedBuffer,elevation:Zn,normals:js.typedBuffer,heights:Tm},it);xr.push(Oo),Xr.push(this._bottomMaterial),Vr.push(ye.I)}if(0===xr.length)return null;const Dl=new et.T({geometries:xr,materials:Xr,transformations:Vr,metadata:{layerUid:this._context.layer.uid,graphicUid:Dt,isElevationSource:!0}});Dl.transformation=di;const vn=(0,be.hM)(this.symbolLayer,{opacity:this._getLayerOpacity()}),vo=(0,G.pC)(vn)?{baseMaterial:this._material,edgeMaterials:[vn],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,bo=new se.z(this,Dl,xr,null,null,jt,ht,vo);return bo.alignedSampledElevation=Qt.sampledElevation,bo.needsElevationUpdates=(0,Ce.B5)(ht.mode),bo}},text:class Zu extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}doLoad(){var Ae=this;return(0,x.Z)(function*(){if(!Ae._drivenProperties.size){const He=(0,Je.bh)(Ae.symbolLayer.size);if(He)throw new de.Z("graphics3dtextsymbollayer:invalid-size",He)}yield Ae._createTextRenderParameters()})()}_createTextRenderParameters(){var Ae=this;return(0,x.Z)(function*(){const He=Ae._context.graphicsCoreOwner.view.state.pixelRatio;Ae._textRenderParameters=yield Mn.V.fromSymbol(Ae.symbolLayer,He)})()}destroy(){super.destroy()}createGraphics3DGraphic(Ae){const He=Ae.graphic,it=(0,Ni.S_)(He.geometry);if((0,G.Wi)(it))return this.logger.warn(`unsupported geometry type for text symbol: ${He.geometry.type}`),null;const ht=this.symbolLayer.text;if((0,G.Wi)(ht)||""===ht)return null;const Dt=(0,Kn.Pd)(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if((0,G.pC)(Dt)&&!(0,Kn.as)(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const Vt=yi(or({},Ep),{verticalOffset:Dt,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:(0,Qr.j1)(this.symbolLayer.verticalAlignment)});return this._createAs3DShape(He,it,ht,Vt)}createLabel(Ae,He,it,ht){const Dt=Ae.graphic,Vt=(0,Ni.S_)(Dt.geometry);if((0,G.Wi)(Vt))return this.logger.warn(`unsupported geometry type for label: ${Dt.geometry.type}`),null;const Qt=He.text;return!Qt||/^\s+$/.test(Qt)?null:this._createAs3DShape(Dt,Vt,Qt,He,it,ht)}setGraphicElevationContext(Ae,He,it=0){const ht=super.setGraphicElevationContext(Ae,He);return ht.addOffsetRenderUnits(it),ht}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(Ae,He){return vp(Ae,He,(it,ht)=>{this.updateGraphicElevationContext(ht,it)}),Ce.lO.UPDATE}slicePlaneEnabledChanged(Ae,He){return vp(Ae,He,it=>{for(const ht of it.stageObject.geometryRecords)ht.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}pixelRatioChanged(){return!1}updateGraphicElevationContext(Ae,He){this.setGraphicElevationContext(Ae,He.elevationContext,He.metadata.elevationOffset),He.needsElevationUpdates=(0,Ce.Xf)(He.elevationContext.mode)||"absolute-height"===He.elevationContext.mode}_defaultElevationInfoNoZ(){return Eu}_createAs3DShape(Ae,He,it,ht,Dt,Vt){const Qt=this.setGraphicElevationContext(Ae,new Ie.o,ht.elevationOffset),cr="polyline"===(0,G.U2)(Ae.geometry,"type"),xr=Ae.uid;let Xr=null,Vr=null;if((0,G.Wi)(Vt)){const vn=(0,Qr.mq)(ht.horizontalPlacement);Xr=new Kl(it,vn,this._textRenderParameters);let vo=null;Vr=this._context.sharedResources.textures.fromData(Xr.key,()=>(0,G.Wg)(Xr).create(),()=>{(0,G.pC)(vo)&&vo.release()});const bo=this._context.stage.renderView.textureRepository.acquire(Vr.texture.id);if((0,G.Wi)(bo)||(0,Q.y8)(bo))return Vr.release(),null;vo=bo}const ei=function wh(It,Ae){if("baseline"===Ae.verticalPlacement){const it=Qr.$A[Ae.horizontalPlacement],ht=(0,G.pC)(It)?It.baselineAnchorY:0;return(0,W.f)(it,ht)}const He=(0,Qr.QW)(Ae.horizontalPlacement,Ae.verticalPlacement);return Qr.yY[He]}(Xr,ht),di={occlusionTest:!0,screenOffset:ht.screenOffset,anchorPosition:ei,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:ht.centerOffsetUnits,debugDrawLabelBorder:ht.debugDrawLabelBorder,drawInSecondSlot:!0};if((0,G.pC)(Vr)&&(di.textureId=Vr.texture.id),(0,G.pC)(Vt)&&(di.textureId=Vt.id),(0,G.pC)(ht.verticalOffset)){const{screenLength:vn,minWorldLength:vo,maxWorldLength:bo}=ht.verticalOffset;di.verticalOffset={screenLength:(0,ri.F2)(vn),minWorldLength:vo||0,maxWorldLength:null!=bo?bo:1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:vn,screenSizePerspectiveSettingsLabels:vo}=this._context.sharedResources;di.screenSizePerspective=vo.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),di.screenSizePerspectiveAlignment=vn}let _t;if(cr&&(di.shaderPolygonOffset=1e-4),di.hasSlicePlane=this._context.slicePlaneEnabled,(0,G.pC)(Dt)){const vn=JSON.stringify(di);_t=Dt.get(vn),(0,G.Wi)(_t)&&(_t=new ns.A(di),Dt.add(vn,_t))}else _t=new ns.A(di);const vi=[_t],Zi=ht.translation,Oi=(0,G.pC)(Xr)?[Xr.displayWidth,Xr.displayHeight]:[0,0],Bs=[Wr.Z.createPointGeometry(Tc,Zi,null,Oi,ht.centerOffset,[0,0],null)],un=(0,Ni.km)(this._context,He,Bs,vi,Qt,this._context.layer.uid,xr);if(null===un)return null;const yo=new se.z(this,un.object,Bs,(0,G.Wi)(Dt)?vi:null,Vr,pr.j3,Qt);yo.alignedSampledElevation=un.sampledElevation,yo.needsElevationUpdates=(0,Ce.Xf)(Qt.mode)||"absolute-height"===Qt.mode;const{displayWidth:wn,displayHeight:jn}=(0,G.pC)(Xr)?Xr:ht;return yo.getScreenSize=(vn=(0,W.a)())=>(vn[0]=wn,vn[1]=jn,vn),yo.metadata={labelText:it,elevationOffset:ht.elevationOffset},(0,Ni.dO)(yo,He,this._context.elevationProvider),yo}},water:$u},bm={"mesh-3d":{fill:class yn extends Ge.k{constructor(Ae,He,it,ht){super(Ae,He,it,ht),this._materials=new Map,this._textures=new Map,this.ensureDrapedStatus(!1)}doLoad(){var Ae=this;return(0,x.Z)(function*(){tt.Z.DRAW_MESH_GEOMETRY_NORMALS&&(Ae._debugVertexNormalMaterial=new Nr.Y({color:[1,0,1,1]}),Ae._debugFaceNormalMaterial=new Nr.Y({color:[0,1,1,1]}))})()}destroy(){super.destroy(),this._context.stage.removeMany(Array.from(this._materials.values(),Ae=>Ae.material)),this._context.stage.removeMany(Array.from(this._textures.values())),this._materials.clear(),this._textures.clear()}createGraphics3DGraphic(Ae){const He=Ae.graphic;if(!this._validateGeometry(He.geometry,Vi,"fill on mesh-3d"))return null;const it=this.setGraphicElevationContext(He,new Ie.o);return this._createAs3DShape(He,Ae.renderingInfo,it,He.uid)}layerOpacityChanged(Ae,He){const it=this._getLayerOpacity();return this._materials.forEach(ht=>{ht.material.setParameters({layerOpacity:it});const Dt=ht.material.parameters;this._setMaterialTransparentParameter(Dt,ht),ht.material.setParameters({transparent:Dt.transparent})}),Ae.forEach(ht=>{const Dt=He(ht);(0,G.pC)(Dt)&&Dt.layerOpacityChanged(it,this._context.isAsync)}),!0}layerElevationInfoChanged(Ae,He){return this.updateGraphics3DGraphicElevationInfo(Ae,He,Ce.B5)}slicePlaneEnabledChanged(Ae,He){return this._materials.forEach(it=>{it.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),Ae.forEach(it=>{const ht=He(it);(0,G.pC)(ht)&&ht.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const Ae=this._usePBR();return this._materials.forEach(He=>He.material.setParameters({usePBR:Ae})),!0}pixelRatioChanged(){return!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(Ae){return(0,G.Wi)(Ae)?"-":Ae instanceof Ur.Z?Ae.toHex():Ae.contentHash}_materialPropertiesDefault(Ae,He){const it=this._requiresSymbolVertexColors(),ht=!!Ae.vertexAttributes.color,Dt=!!Ae.vertexAttributes.tangent;return{hasSymbolVertexColors:it,hasVertexColors:ht,hasVertexTangents:Dt,uid:`vc:${ht},vt:${Dt},vct${He},svc:${it}`}}_materialProperties(Ae,He,it){const ht=this._materialPropertiesDefault(Ae,it);if(!He.material)return ht;const{color:Dt,colorTexture:Vt,normalTexture:Qt,doubleSided:cr,alphaCutoff:xr,alphaMode:Xr}=He.material,Vr=this._colorOrTextureUid(Dt),ei=this._colorOrTextureUid(Vt),di=this._colorOrTextureUid(Qt);if(ht.color=Dt,ht.colorTexture=Vt,ht.normalTexture=Qt,ht.uid=`${ht.uid},cmuid:${Vr},ctmuid:${ei},ntmuid:${di},ds:${cr},ac:${xr},am:${Xr}`,He.material instanceof no.Z){const{metallic:_t,roughness:vi,metallicRoughnessTexture:Zi,emissiveColor:Oi,emissiveTexture:Li,occlusionTexture:os}=He.material,mn=this._colorOrTextureUid(Zi),Bs=this._colorOrTextureUid(Oi),Rn=this._colorOrTextureUid(Li),un=this._colorOrTextureUid(os);ht.metallic=_t,ht.roughness=vi,ht.metallicRoughnessTexture=Zi,ht.emissiveColor=Oi,ht.emissiveTexture=Li,ht.occlusionTexture=os,ht.uid=`${ht.uid},mrm:${_t},mrr:${vi},mrt:${mn},emuid:${Bs},etmuid:${Rn},otmuid:${un}`}return ht}_setInternalColorValueParameters(Ae,He){He.diffuse=Ur.Z.toUnitRGB(Ae),He.opacity=Ae.a}_getLoadableTextureResource(Ae){return Ae.data?Ae.data:Ae.url}_getInternalTextureId(Ae){const He=this._getInternalTexture(Ae,ze.JJ.Opaque);return(0,G.pC)(He)?He.id:null}_getInternalTexture(Ae,He){const it=this._getLoadableTextureResource(Ae);if(!it)return null;const ht=`${Ae.contentHash}/${He}`;let Dt=this._textures.get(ht);return Dt||(Dt=new Wi.x(it,{mipmap:!0,wrap:this._castTextureWrap(Ae.wrap),noUnpackFlip:!0,preMultiplyAlpha:He!==ze.JJ.Opaque}),this._textures.set(ht,Dt),this._context.stage.add(Dt),this._context.stage.loadImmediate(Dt)),Dt}_castTextureWrap(Ae="repeat"){if("string"==typeof Ae){const He=this._castTextureWrapIndividual(Ae);return{s:He,t:He}}return{s:this._castTextureWrapIndividual(Ae.horizontal),t:this._castTextureWrapIndividual(Ae.vertical)}}_castTextureWrapIndividual(Ae){switch(Ae){case"clamp":return Ei.e8.CLAMP_TO_EDGE;case"mirror":return Ei.e8.MIRRORED_REPEAT;default:return Ei.e8.REPEAT}}_setInternalMaterialParameters(Ae,He){if((0,G.pC)(Ae.color)&&this._setInternalColorValueParameters(Ae.color,He),(0,G.pC)(Ae.colorTexture)){const it=this._getInternalTexture(Ae.colorTexture,He.textureAlphaMode);(0,G.pC)(it)?(He.textureId=it.id,He.textureAlphaPremultiplied=!!it.params.preMultiplyAlpha):He.textureId=void 0}(0,G.pC)(Ae.normalTexture)&&(He.normalTextureId=this._getInternalTextureId(Ae.normalTexture)),(0,G.pC)(Ae.emissiveColor)&&(He.emissiveFactor=Ur.Z.toUnitRGB(Ae.emissiveColor)),(0,G.pC)(Ae.emissiveTexture)&&(He.emissiveTextureId=this._getInternalTextureId(Ae.emissiveTexture)),(0,G.pC)(Ae.occlusionTexture)&&(He.occlusionTextureId=this._getInternalTextureId(Ae.occlusionTexture)),(0,G.pC)(Ae.metallicRoughnessTexture)&&(He.metallicRoughnessTextureId=this._getInternalTextureId(Ae.metallicRoughnessTexture))}_setExternalMaterialParameters(Ae){const He=this._drivenProperties.color;let it=(0,G.pC)(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;if(He)Ae.externalColor=Kr.O;else{const ht=(0,G.pC)(this.symbolLayer.material)?this.symbolLayer.material.color:null;(0,G.pC)(ht)?Ae.externalColor=Ur.Z.toUnitRGBA(ht):(it=null,Ae.externalColor=Kr.O)}it&&(Ae.colorMixMode=it),Ae.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(Ae){const He=Ae.vertexAttributes.color;if((0,G.Wi)(He))return!1;for(let it=3;it<He.length;it+=4)if(255!==He[it])return!0;return!1}_getOrCreateMaterial(Ae,He){var _t,vi,Zi;const it=null==(_t=He.material)?void 0:_t.color,ht=null==(vi=He.material)?void 0:vi.colorTexture,Dt=null==(Zi=He.material)?void 0:Zi.alphaMode,Vt="blend"===Dt,Qt="opaque"!==Dt&&(this._hasTransparentVertexColors(Ae)||(0,G.pC)(it)&&it.a<1||(0,G.pC)(ht)&&ht.transparent||Vt),cr=this._materialProperties(Ae,He,Qt),xr=this._materials.get(cr.uid);if(xr)return xr.material;const Xr={material:null,isComponentTransparent:Qt,alphaMode:He.material?He.material.alphaMode:"opaque"},Vr=null==cr.metallicRoughnessTexture&&null==cr.metallic&&null==cr.roughness,ei={usePBR:this._usePBR(),isSchematic:Vr,hasVertexColors:cr.hasVertexColors,hasSymbolColors:cr.hasSymbolVertexColors,hasVertexTangents:cr.hasVertexTangents,ambient:Z.Z,diffuse:Z.O,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:ze.Vr.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};Vr||(ei.mrrFactors=[null!=cr.metallic?cr.metallic:1,null!=cr.roughness?cr.roughness:1,.5]),He.material&&(ei.doubleSided=He.material.doubleSided,ei.cullFace=He.material.doubleSided?ze.Vr.None:ze.Vr.Back,ei.textureAlphaCutoff=He.material.alphaCutoff),this._setExternalMaterialParameters(ei),this._setMaterialTransparentParameter(ei,Xr),this._setInternalMaterialParameters(cr,ei);const di=new ke.Gp(ei);return Xr.material=di,this._materials.set(cr.uid,Xr),this._context.stage.add(di),di}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(Ae,He){Ae.transparent=this.needsDrivenTransparentPass||He.isComponentTransparent||Ae.layerOpacity<1||Ae.opacity<1||Ae.externalColor&&Ae.externalColor[3]<1,Ae.textureAlphaMode="auto"===He.alphaMode?Ae.transparent?ze.JJ.MaskBlend:ze.JJ.Opaque:"opaque"===He.alphaMode?ze.JJ.Opaque:"mask"===He.alphaMode?ze.JJ.Mask:ze.JJ.Blend}_addDebugNormals(Ae,He,it,ht){const Dt=He.length,Vt=Ae.spatialReference.isGeographic?20015077/180:1,Qt=.1*Math.max(Ae.extent.width*Vt,Ae.extent.height*Vt,Ae.extent.zmax-Ae.extent.zmin),cr=[],xr=[],Xr=[],Vr=[];for(let _t=0;_t<Dt;_t++){const vi=He[_t],Zi=vi.vertexAttributes.get(Oe.T.POSITION),Oi=vi.vertexAttributes.get(Oe.T.NORMAL),Li=vi.indices.get(Oe.T.POSITION),os=vi.indices.get(Oe.T.NORMAL),mn=Zi.data,Bs=Oi.data;for(let Rn=0;Rn<Li.length;Rn++){const un=3*Li[Rn],yo=3*os[Rn];for(let wn=0;wn<3;wn++)cr.push(mn[un+wn]);for(let wn=0;wn<3;wn++)cr.push(mn[un+wn]+Bs[yo+wn]*Qt);if(xr.push(xr.length),xr.push(xr.length),Rn%3==0){this._calculateFaceNormal(mn,Li,Rn,Fu),this._getFaceVertices(mn,Li,Rn,Cn,Do,El),(0,B.a)(Cn,Cn,Do),(0,B.a)(Cn,Cn,El),(0,B.g)(Cn,Cn,1/3);for(let wn=0;wn<3;wn++)Xr.push(Cn[wn]);for(let wn=0;wn<3;wn++)Xr.push(Cn[wn]+Fu[wn]*Qt);Vr.push(Vr.length),Vr.push(Vr.length)}}}const ei=new we.Z([[Oe.T.POSITION,{data:cr,size:3,exclusive:!0}]],[[Oe.T.POSITION,new Uint32Array(xr)]],ze.MX.Line);He.push(ei),it.push(this._debugVertexNormalMaterial),ht.push((0,ye.b)(ht[0]));const di=new we.Z([[Oe.T.POSITION,{data:Xr,size:3,exclusive:!0}]],[[Oe.T.POSITION,new Uint32Array(Vr)]],ze.MX.Line);He.push(di),it.push(this._debugFaceNormalMaterial),ht.push((0,ye.b)(ht[0]))}_createAs3DShape(Ae,He,it,ht){const Dt=Ae.geometry;if("mesh"!==Dt.type)return null;const Vt=this._createGeometryInfo(Dt,He);if(!Vt)return null;const{geometries:Qt,materials:cr,transformations:xr,objectTransformation:Xr}=Vt;tt.Z.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(Dt,Qt,cr,xr);const Vr=new et.T({geometries:Qt,materials:cr,transformations:xr,metadata:{layerUid:this._context.layer.uid,graphicUid:ht}});Vr.transformation=Xr;const ei=this._createEdgeMaterial(),di=(0,G.pC)(ei)?{baseMaterial:cr[0],edgeMaterials:[ei],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,_t=new se.z(this,Vr,Qt,null,null,pr.j3,it,di);return _t.needsElevationUpdates=(0,Ce.B5)(it.mode),_t.useObjectOriginAsAttachmentOrigin=!0,_t.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(Vr),_t.alignedSampledElevation=(0,pr.j3)(_t,_t.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper),_t}_getCenterPointInElevationSR(Ae){const He=(0,le.Tx)(0,0,0,this._context.elevationProvider.spatialReference);return(0,ue.MT)([Ae.transformation[12],Ae.transformation[13],Ae.transformation[14]],this._context.renderCoordsHelper.spatialReference,He),He}_createComponentNormals(Ae,He,it,ht){switch(it.shading||"flat"){case"source":return this._createComponentNormalsSource(Ae,He,it,ht);case"flat":return this._createComponentNormalsFlat(Ae,ht);case"smooth":return this._createComponentNormalsSmooth(Ae,ht);default:return}}_createComponentNormalsSource(Ae,He,it,ht){if((0,G.Wi)(He))return this._createComponentNormalsFlat(Ae,ht);let Dt=!1;if(!it.trustSourceNormals)for(let Vt=0;Vt<ht.length;Vt+=3){this._calculateFaceNormal(Ae,ht,Vt,Fu);for(let Qt=0;Qt<3;Qt++){const cr=3*ht[Vt+Qt];Cn[0]=He[cr+0],Cn[1]=He[cr+1],Cn[2]=He[cr+2],(0,B.e)(Fu,Cn)<0&&(He[cr+0]=-He[cr+0],He[cr+1]=-He[cr+1],He[cr+2]=-He[cr+2],Dt=!0)}}return{normals:He,indices:ht,didFlipNormals:Dt}}_createComponentNormalsFlat(Ae,He){const it=new Float32Array(He.length),ht=new Uint32Array(3*He.length);for(let Dt=0;Dt<He.length;Dt+=3){const Vt=this._calculateFaceNormal(Ae,He,Dt,Fu);for(let Qt=0;Qt<3;Qt++)it[Dt+Qt]=Vt[Qt],ht[Dt+Qt]=Dt/3}return{normals:it,indices:ht,didFlipNormals:!1}}_createComponentNormalsSmooth(Ae,He){const it={};for(let Vt=0;Vt<He.length;Vt+=3){const Qt=this._calculateFaceNormal(Ae,He,Vt,Fu);for(let cr=0;cr<3;cr++){const xr=He[Vt+cr];let Xr=it[xr];Xr||(Xr={normal:(0,Z.c)(),count:0},it[xr]=Xr),(0,B.a)(Xr.normal,Xr.normal,Qt),Xr.count++}}const ht=new Float32Array(3*He.length),Dt=new Uint32Array(3*He.length);for(let Vt=0;Vt<He.length;Vt++){const Qt=it[He[Vt]];1!==Qt.count&&((0,B.n)(Qt.normal,Qt.normal),Qt.count=1);for(let cr=0;cr<3;cr++)ht[3*Vt+cr]=Qt.normal[cr];Dt[Vt]=Vt}return{normals:ht,indices:Dt,didFlipNormals:!1}}_getFaceVertices(Ae,He,it,ht,Dt,Vt){const Qt=3*He[it+0],cr=3*He[it+1],xr=3*He[it+2];ht[0]=Ae[Qt+0],ht[1]=Ae[Qt+1],ht[2]=Ae[Qt+2],Dt[0]=Ae[cr+0],Dt[1]=Ae[cr+1],Dt[2]=Ae[cr+2],Vt[0]=Ae[xr+0],Vt[1]=Ae[xr+1],Vt[2]=Ae[xr+2]}_calculateFaceNormal(Ae,He,it,ht){return this._getFaceVertices(Ae,He,it,Cn,Do,El),(0,B.b)(Do,Do,Cn),(0,B.b)(El,El,Cn),(0,B.f)(Cn,Do,El),(0,B.n)(ht,Cn),ht}_getOrCreateComponents(Ae){return(0,G.Pt)(Ae.components,Ze)}_createPositionBuffer(Ae,He){let it=Ae.vertexAttributes.position;const ht=He.reprojection===lo.ECEF?He.transformBeforeProject:null;if((0,G.pC)(ht)&&(it=(0,Sn.zZ)(it,new Float64Array(it.length),ht)),He.reprojection===lo.NONE)return He.needsBufferCopy?new Float64Array(it):it;const Dt=(0,G.pC)(ht)?it:new Float64Array(it.length);return(0,ue.CM)(it,Ae.spatialReference,0,Dt,this._context.renderCoordsHelper.spatialReference,0,it.length/3),Dt}_createNormalBuffer(Ae,He,it){let ht=Ae.vertexAttributes.normal;if((0,G.Wi)(ht))return null;const Dt=it.reprojection===lo.ECEF?it.transformBeforeProject:null;if((0,G.pC)(Dt)&&(ht=(0,Sn.w9)(ht,new Float32Array(ht.length),Dt)),"local"===this._context.graphicsCoreOwner.view.viewingMode||it.reprojection===lo.NONE)return it.needsBufferCopy&&Ae.vertexAttributes.normal===ht?new Float32Array(ht):ht;const Vt=Ae.vertexAttributes.position,Qt=(0,G.pC)(Dt)?ht:new Float32Array(ht.length);return(0,Sn.Iz)(ht,Vt,He,Ae.spatialReference,Qt)}_createTangentBuffer(Ae,He,it){let ht=Ae.vertexAttributes.tangent;if((0,G.Wi)(ht))return null;const Dt=it.reprojection===lo.ECEF?it.transformBeforeProject:null;if((0,G.pC)(Dt)&&(ht=(0,Sn.VS)(ht,new Float32Array(ht.length),Dt)),"local"===this._context.graphicsCoreOwner.view.viewingMode||it.reprojection===lo.NONE)return it.needsBufferCopy&&Ae.vertexAttributes.normal===ht?new Float32Array(ht):ht;const Vt=Ae.vertexAttributes.position,Qt=(0,G.pC)(Dt)?ht:new Float32Array(ht.length);return(0,Sn.wi)(ht,Vt,He,Ae.spatialReference,Qt)}_createColorBuffer(Ae){return Ae.vertexAttributes.color}_createSymbolColorBuffer(Ae){if(this._requiresSymbolVertexColors()){const He=this._getVertexOpacityAndColor(Ae),it=(0,Va.F5)((0,G.U2)(this.symbolLayer,"material","colorMixMode")),ht=new Uint8Array(4);return(0,Va.HB)(He,it,ht),ht}return null}_createBuffers(Ae,He){const it=Ae.vertexAttributes&&Ae.vertexAttributes.position;if(!it)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const ht=Ae.vertexAttributes.normal,Dt=Ae.vertexAttributes.uv,Vt=Ae.vertexAttributes.tangent;if((0,G.pC)(ht)&&ht.length!==it.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if((0,G.pC)(Vt)&&Vt.length/4!=it.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if((0,G.pC)(Dt)&&Dt.length/2!=it.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const Qt=this._computeReprojectionInfo(Ae),cr=this._createPositionBuffer(Ae,Qt),xr=this._createColorBuffer(Ae),Xr=this._createSymbolColorBuffer(He),Vr=this._createNormalBuffer(Ae,cr,Qt),ei=this._createTangentBuffer(Ae,cr,Qt);return{positionBuffer:cr,normalBuffer:Vr,tangentBuffer:ei,uvBuffer:Dt,colorBuffer:xr,symbolColorBuffer:Xr,objectTransformation:Qt.reprojection===lo.NONE&&(0,G.pC)(Qt.objectTransformation)?Qt.objectTransformation:this._transformOriginLocal(Ae,cr,Vr,ei),geometryTransformation:Qt.reprojection===lo.NONE&&(0,G.pC)(Qt.geometryTransformation)?Qt.geometryTransformation:(0,ye.c)()}}_computeReprojectionInfo(Ae){const He=(0,G.pC)(Ae.transform),it=He&&Ae.transform.geographic||this._context.renderCoordsHelper.viewingMode===me.JY.Local?lo.NONE:lo.ECEF;if(He){if(it===lo.NONE){const Dt=(0,ye.c)();return(0,ue.Bm)(Ae.spatialReference,Ae.transform.origin,Dt,this._context.renderCoordsHelper.spatialReference),{reprojection:it,objectTransformation:Dt,geometryTransformation:(0,ye.b)(Ae.transform.localMatrix),needsBufferCopy:!1}}const ht=(0,ge.f)((0,ye.c)(),Ae.transform.origin);return(0,ge.m)(ht,ht,Ae.transform.localMatrix),{reprojection:it,transformBeforeProject:ht,needsBufferCopy:!0}}return{reprojection:it,needsBufferCopy:!0}}_transformOriginLocal(Ae,He,it,ht){const Dt=this._context.renderCoordsHelper.spatialReference,Vt=Ae.anchor;Go[0]=Vt.x,Go[1]=Vt.y,Go[2]=Vt.z;const Qt=(0,ye.c)();(0,ue.Bm)(Ae.spatialReference,Go,Qt,Dt);const cr=Me.fP.fromTypedArray(He);if((0,ge.a)(lp,Qt),(0,Ee.t)(cr,cr,lp),(0,G.pC)(it)||(0,G.pC)(ht)){if((0,pe.f)(bl,Qt),(0,pe.t)(bl,bl),(0,G.pC)(it)){const xr=Me.ct.fromTypedArray(it);(0,Ee.a)(xr,xr,bl)}if((0,G.pC)(ht)){const xr=Me.ct.fromTypedArray(ht,4*ht.BYTES_PER_ELEMENT);(0,Ee.a)(xr,xr,bl)}}return Qt}_validateFaces(Ae,He){const it=Ae.vertexAttributes.position.length/3,ht=He.faces;if(ht){let Dt=-1;for(let Vt=0;Vt<ht.length;Vt++){const Qt=ht[Vt];Qt>Dt&&(Dt=Qt)}if(it<=Dt)return this.logger.warn(`Vertex index ${Dt} is out of bounds of the mesh position buffer`),!1}else if(it%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(Ae,He){return He.faces?He.faces:(0,ud.p)(Ae.vertexAttributes.position.length/3)}_isOutsideClippingArea(Ae){if(!this._context.clippingExtent)return!1;const He=Ae.vertexAttributes&&Ae.vertexAttributes.position;if(!He)return!1;const it=this._context.elevationProvider.spatialReference;let ht;const Dt=He.length/3;return Ae.spatialReference.equals(it)?ht=He:(ht=new Float64Array(He.length),(0,ue.CM)(Ae.vertexAttributes.position,Ae.spatialReference,0,ht,it,0,Dt)),(0,ce.cS)(Ai),(0,ce.G1)(Ai,ht,0,Dt),!(0,ce.Zp)(Ai,this._context.clippingExtent)}_createGeometryInfo(Ae,He){if(!(0,ue.Up)(Ae.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(Ae))return null;const it=this._createBuffers(Ae,He);if((0,G.Wi)(it))return null;const{positionBuffer:ht,uvBuffer:Dt,colorBuffer:Vt,symbolColorBuffer:Qt,normalBuffer:cr,tangentBuffer:xr,objectTransformation:Xr,geometryTransformation:Vr}=it,ei=this._getOrCreateComponents(Ae),di=[],_t=[],vi=[];let Zi=!1;for(const Oi of ei){if(!this._validateFaces(Ae,Oi))return null;const Li=this._getOrCreateFaces(Ae,Oi);if(0===Li.length)continue;const os=this._createComponentNormals(ht,cr,Oi,Li);os.didFlipNormals&&(Zi=!0);const mn=[[Oe.T.POSITION,{size:3,data:ht,exclusive:!0}],[Oe.T.NORMAL,{size:3,data:os.normals,exclusive:!0}]],Bs=[[Oe.T.POSITION,Li],[Oe.T.NORMAL,os.indices]];(0,G.pC)(Vt)&&(mn.push([Oe.T.COLOR,{size:4,data:Vt,exclusive:!0}]),Bs.push([Oe.T.COLOR,Li])),(0,G.pC)(Qt)&&(mn.push([Oe.T.SYMBOLCOLOR,{size:4,data:Qt,exclusive:!0}]),Bs.push([Oe.T.SYMBOLCOLOR,new Uint16Array(Li.length)])),(0,G.pC)(Dt)&&(mn.push([Oe.T.UV0,{size:2,data:Dt,exclusive:!0}]),Bs.push([Oe.T.UV0,Li])),(0,G.pC)(xr)&&(mn.push([Oe.T.TANGENT,{size:4,data:xr,exclusive:!0}]),Bs.push([Oe.T.TANGENT,Li]));const Rn=new we.Z(mn,Bs);di.push(Rn),_t.push(Vr),vi.push(this._getOrCreateMaterial(Ae,Oi))}return Zi&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:di,transformations:_t,materials:vi,objectTransformation:Xr}}_createEdgeMaterial(){const Ae={opacity:this._getLayerOpacity()};return(0,be.hM)(this.symbolLayer,Ae)}}}};class kE extends pn.w{constructor(Ae,He,it){super(He.schedule),this._symbol=Ae,this._context=He,this._backgroundLayers=it,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}set symbol(Ae){this._symbol=Ae;for(let He=0;He<Ae.symbolLayers.length;He++){const it=this.symbolLayers[He];(0,G.Wi)(it)||(it.symbol=Ae,it.symbolLayer=Ae.symbolLayers.items[He])}}get symbol(){return this._symbol}doLoad(Ae){var He=this;return(0,x.Z)(function*(){let it=He._symbol.symbolLayers;He._extentPadding=0,He._backgroundLayers&&(it=He._backgroundLayers.concat(it));const ht=it.length;for(;He.symbolLayers.length<it.length;)He.symbolLayers.push(null);He.symbolLayers.length=it.length;const Dt=[];for(let Vt=0;Vt<ht;Vt++){const Qt=it.getItemAt(Vt);if(!1===Qt.enabled)continue;p0.renderPriority=1-(1+Vt)/ht,p0.renderPriorityStep=1/ht,p0.ignoreDrivers=Qt._ignoreDrivers;const cr=VT(He.symbol,Qt,He._context,p0);Dt.push((0,Q.$F)(Ae,()=>{He.symbolLayers[Vt]=null,cr.destroy()})),He.symbolLayers[Vt]=cr}yield(0,A.Ed)(He.symbolLayers,function(){var Vt=(0,x.Z)(function*(Qt,cr){if((0,G.pC)(Qt))try{yield Qt.load(),He._extentPadding+=Math.max(He._extentPadding,Qt.extentPadding)}catch(xr){He.symbolLayers[cr]=null}});return function(Qt,cr){return Vt.apply(this,arguments)}}());for(const Vt of Dt)null==Vt||Vt.remove();if(Dt.length=0,(0,Q.k_)(Ae),He.symbolLayers.length&&!He.symbolLayers.some(Vt=>!!Vt))throw new Error})()}getSymbolLayerSize(Ae){const He=this.symbolLayers[Ae];return(0,G.pC)(He)?He.getCachedSize():null}get extentPadding(){return this._extentPadding}createGraphics3DGraphic(Ae,He){const it=Ae.graphic,ht=new Array(this.symbolLayers.length);for(let Vt=0;Vt<this.symbolLayers.length;Vt++){const Qt=this.symbolLayers[Vt];ht[Vt]=(0,G.pC)(Qt)?Qt.createGraphics3DGraphic(Ae):null}return new $(it,He||this,ht,Ae.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)}get complexity(){return(0,vc.IQ)(this.symbolLayers.map(Ae=>(0,G.U2)(Ae,"complexity")))}globalPropertyChanged(Ae,He){const it=this.symbolLayers.length;for(let ht=0;ht<it;ht++){const Dt=this.symbolLayers[ht],Vt=Qt=>{const cr=Qt.graphics[ht];return cr instanceof se.z?cr:null};if((0,G.pC)(Dt)&&!Dt.globalPropertyChanged(Ae,He,Vt))return!1}return!0}applyRendererDiff(Ae,He){return this.loadStatus!==pn.P.LOADED?xe.W.Recreate_Symbol:this.symbolLayers.reduce((it,ht)=>it!==xe.W.Recreate_Symbol&&(0,G.pC)(ht)?Math.min(it,ht.applyRendererDiff(Ae,He)):it,xe.W.Fast_Update)}prepareSymbolPatch(Ae){if(this.loadStatus===pn.P.FAILED||"partial"!==Ae.diff.type)return;const He=Ae.diff.diff;if(!He.symbolLayers||"partial"!==He.symbolLayers.type)return;const it=He.symbolLayers.diff;this.symbolLayers.forEach((ht,Dt)=>{if((0,G.Wi)(ht))return;const Vt=it[Dt];if(Vt){const Qt={diff:Vt,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};ht.prepareSymbolLayerPatch(Qt),Ae.symbolStatePatches.push(...Qt.symbolLayerStatePatches),Qt.graphics3DGraphicPatches.length&&Ae.graphics3DGraphicPatches.push((cr,xr)=>{const Xr=cr.graphics[Dt];(0,G.pC)(Xr)&&Qt.graphics3DGraphicPatches.forEach(Vr=>Vr(Xr,xr))})}})}updateGeometry(Ae,He){for(let it=0;it<this.symbolLayers.length;it++){const ht=this.symbolLayers[it];if((0,G.Wi)(ht))continue;const Dt=Ae.graphics[it];if((0,G.Wi)(Dt)||!ht.updateGeometry(Dt,He))return!1}return!0}onRemoveGraphic(Ae){for(let He=0;He<this.symbolLayers.length;He++){const it=this.symbolLayers[He];if((0,G.Wi)(it))continue;const ht=Ae.graphics[He];(0,G.pC)(ht)&&it.onRemoveGraphic(ht)}}getFastUpdateStatus(){let Ae=0,He=0,it=0;return this.symbolLayers.forEach(ht=>{(0,G.Wi)(ht)||(ht.loadStatus===pn.P.LOADING?Ae++:ht.isFastUpdatesEnabled()?it++:He++)}),{loading:Ae,slow:He,fast:it}}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const Ae of this.symbolLayers)(0,G.pC)(Ae)&&Ae.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}}const p0={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1}},18422:(dt,Re,T)=>{"use strict";T.d(Re,{d:()=>Y,k:()=>le});var x=T(91558),G=(T(8314),T(63290)),Q=T(62208),H=T(28093),re=T(4794),J=T(81468),W=T(79112),B=T(74746),Z=T(67225),ie=T(64538),ue=T(87930),ce=T(97161);const oe=G.Z.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class le extends ue.w{constructor(ne,se,ae,de){super(ae.schedule),this._context=ae,this._elevationInfoOverride=null,this._ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=oe,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.symbol=ne,this.symbolLayer=se,this._renderPriority=de.renderPriority,this._renderPriorityStep=de.renderPriorityStep,this._elevationContext=new W.o,this.complexity=this.computeComplexity(),this._ignoreDrivers=de.ignoreDrivers,this._ignoreDrivers||(this._drivenProperties=j(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(ne){if(this._ignoreDrivers)return!1;const se=this._drivenProperties,ae=j(ne);return ae.color!==se.color||ae.opacity!==se.opacity||ae.opacityAlwaysOpaque!==se.opacityAlwaysOpaque||ae.size!==se.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(ne,se,ae,de){const pe="polygons"in ne?ne.polygons:null,he=`${de} geometry failed to be created`;let ge=null;ne.projectionSuccess?!se.length||1===se.length&&!se[0].length?ge=`${he} (no ${ae} were defined)`:Array.isArray(se)&&Array.isArray(se[0])?pe&&0===pe.length&&"rings"===ae&&se.length>0&&se[0].length>2&&(ge=`${he} (filled rings should use clockwise winding - try reversing the order of vertices)`):ge=`${he} (${ae} should be defined as a 2D array)`:ge=`${he} (failed to project geometry to view spatial reference)`,ge&&oe.warnOncePerTick(ge)}_validateGeometry(ne,se=null,ae=null){if((0,Q.pC)(se)&&!se.includes(ne.type))return this.logger.warn("unsupported geometry type for "+ae+` symbol: ${ne.type}`),!1;if("point"===ne.type){const de=ne;if(!isFinite(de.x)||!isFinite(de.y))return oe.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return X}_defaultElevationInfoZ(){return U}_updateElevationContext(){(0,Q.pC)(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(ne){return ne.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(ne,se=this.getDefaultElevationInfo(ne)){return this._elevationContext.mode||se.mode}setElevationInfoOverride(ne){this._elevationInfoOverride=ne,this._updateElevationContext()}setGraphicElevationContext(ne,se){const ae=(0,Q.Wg)(ne.geometry),de=this.getDefaultElevationInfo(ae);se.unit=null!=this._elevationContext.unit?this._elevationContext.unit:de.unit,se.mode=this.getGeometryElevationMode(ae,de),se.offsetMeters=(0,Q.Pt)(this._elevationContext.meterUnitOffset,(0,Q.Pt)(de.offset,0));const _e=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===se.mode;return _e&&(se.mode="relative-to-ground",se.offsetMeters=0),se.updateFeatureExpressionInfoContext(_e?B.O$:this._elevationContext.featureExpressionInfoContext,ne,this._context.layer),se}prepareSymbolLayerPatch(ne){}updateGeometry(ne,se){return!1}onRemoveGraphic(ne){}_getLayerOpacity(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const ne=this._context.layer.opacity;return null==ne?1:ne}_getCombinedOpacity(ne,se=ee){let ae=1;return this.draped||(ae*=this._getLayerOpacity()),this._drivenProperties.opacity||((0,Q.pC)(ne)?ae*=ne.a:se.hasIntrinsicColor||(ae=0)),ae}_getCombinedOpacityAndColor(ne,se=ee){const ae=this._getCombinedOpacity(ne,se);if(this._drivenProperties.color)return(0,Z.Uu)(null,ae);const de=(0,Q.pC)(ne)?x.Z.toUnitRGB(ne):H.O;return(0,Z.Uu)(de,ae)}_getVertexOpacityAndColor(ne,se=null){const _e=(0,Z.Uu)(this._drivenProperties.color?ne.color:null,this._drivenProperties.opacity?ne.opacity:null);return(0,Q.pC)(se)&&(_e[0]*=se,_e[1]*=se,_e[2]*=se,_e[3]*=se),_e}isFastUpdatesEnabled(){return this._fastUpdates&&this._fastUpdates.enabled}computeComplexity(){return(0,ce.u)(this.symbol,this.symbolLayer)}globalPropertyChanged(ne,se,ae){switch(ne){case"opacity":return this.layerOpacityChanged(se,ae);case"elevationInfo":{const de=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(se,ae,de)!==J.lO.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(se,ae);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged();default:return!1}}updateGraphics3DGraphicElevationInfo(ne,se,ae){let de=J.lO.UPDATE;return ne.forEach(_e=>{const pe=se(_e);(0,Q.pC)(pe)?(this.setGraphicElevationContext(_e.graphic,pe.elevationContext),pe.needsElevationUpdates=ae(pe.elevationContext.mode)):de=J.lO.RECREATE}),de}applyRendererDiff(ne,se){return ie.W.Recreate_Symbol}getFastUpdateAttrValues(ne){if(!this._fastUpdates.enabled)return null;const se=this._fastUpdates.visualVariables,ae=se.size?Y(se.size.field,ne):0,de=se.color?Y(se.color.field,ne):0,_e=se.opacity?Y(se.opacity.field,ne):0;return(0,re.f)(ae,de,_e,0)}get draped(){return this._draped}ensureDrapedStatus(ne){return null==this._draped?(this._draped=ne,!0):(ne!==this.draped&&oe.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>{var se,ae,de,_e,pe,he,ge,ye,Me,Ee,Te,me,Ce,Ie,Ge,Je;return{size:null!=(_e=null==(de=null==(ae=null==(se=this._fastUpdates)?void 0:se.visualVariables)?void 0:ae.size)?void 0:de.field)?_e:null,color:null!=(ye=null==(ge=null==(he=null==(pe=this._fastUpdates)?void 0:pe.visualVariables)?void 0:he.color)?void 0:ge.field)?ye:null,opacity:null!=(me=null==(Te=null==(Ee=null==(Me=this._fastUpdates)?void 0:Me.visualVariables)?void 0:Ee.opacity)?void 0:Te.field)?me:null,rotation:null!=(Je=null==(Ge=null==(Ie=null==(Ce=this._fastUpdates)?void 0:Ce.visualVariables)?void 0:Ie.rotation)?void 0:Ge.field)?Je:null}}}}}function Y($,ne){const se=null!=$?ne.attributes[$]:0;return null!=se&&isFinite(se)?se:0}function j($){const ne={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return $&&"visualVariables"in $&&$.visualVariables&&$.visualVariables.forEach(se=>{switch(se.type){case"color":if(ne.color=!0,se.stops)for(let ae=0;ae<se.stops.length;ae++){const de=se.stops[ae].color;de&&(ne.opacity=!0,de.a<1&&(ne.opacityAlwaysOpaque=!1))}break;case"opacity":ne.opacity=!0,ne.opacityAlwaysOpaque=!1;break;case"size":ne.size=!0}}),ne}const X={mode:"on-the-ground",offset:0,unit:"meters"},U={mode:"absolute-height",offset:0,unit:"meters"},ee={hasIntrinsicColor:!1}},13939:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>re});var x=T(15861),A=T(62208),G=T(64538),Q=T(87930),H=T(97161);class re extends Q.w{constructor(W,B,Z){super(B),this.symbol=W,this.convert=Z,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(W){return(0,A.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(W):null}get symbolLayers(){return(0,A.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return(0,A.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}doLoad(W){var B=this;return(0,x.Z)(function*(){const Z=yield B.symbol.fetchSymbol({signal:W});Z.id=B.symbol.id,B.graphics3DSymbol=B.convert(Z),(0,A.pC)(B.graphics3DSymbol)&&(yield B.graphics3DSymbol.load())})()}createGraphics3DGraphic(W){return(0,A.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(W,this):null}get complexity(){return(0,A.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:H.WU}globalPropertyChanged(W,B){return!!(0,A.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.globalPropertyChanged(W,B)}applyRendererDiff(W,B){return(0,A.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(W,B):G.W.Recreate_Symbol}prepareSymbolPatch(W){(0,A.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(W)}updateGeometry(W,B){return!!(0,A.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.updateGeometry(W,B)}onRemoveGraphic(){}getFastUpdateStatus(){return(0,A.pC)(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){(0,A.pC)(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}}},87930:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>Q,w:()=>G});var Q,H,x=T(62208),A=T(10699);class G{constructor(re){this.schedule=re,this._loadStatus=Q.LOADING,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(re,J){return this._loadStatus===Q.LOADED?(re&&re(),(0,x.Wg)(this._loader)):this._loadStatus===Q.FAILED?(J&&J(this._loadError),(0,x.Wg)(this._loader)):((0,x.Wi)(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=Q.LOADED},W=>{throw this._loadError=W,this._abortController=null,this._loadStatus=Q.FAILED,!(0,A.D_)(W)&&this.logger&&W.message&&this.logger.warn(W.message),W})),this._loader.then(re,J).catch(()=>{}),this._loader)}abortLoad(){(0,x.pC)(this._abortController)?this._abortController=(0,x.IM)(this._abortController):this._loadStatus===Q.LOADING&&(this._loadStatus=Q.FAILED),this._loader=null}}(H=Q||(Q={}))[H.LOADING=0]="LOADING",H[H.LOADED=1]="LOADED",H[H.FAILED=2]="FAILED"},80960:(dt,Re,T)=>{"use strict";T.d(Re,{ZF:()=>G,a1:()=>H,rD:()=>Q});var x=T(4794);const G=1.2,Q=x.Z,H=x.O},81468:(dt,Re,T)=>{"use strict";T.d(Re,{B5:()=>le,GC:()=>ce,Lm:()=>ne,Xf:()=>oe,bD:()=>Y,lO:()=>se,qZ:()=>ie,rR:()=>Z,w7:()=>ue});var se,he,x=T(94573),A=T(62208),G=T(28347),Q=T(43703),H=T(28093),re=T(55915),J=T(88530),W=T(67225),B=T(53929);function Z(he,ge,ye,Me,Ee,Te,me,Ce,Ie,Ge,Je){const xe=ae[Je.mode];let je,We,Ne=0;if((0,re.CM)(he,ge,ye,Me,Ie.spatialReference,Ee,Ce))return xe.requiresAlignment(Je)?(Ne=xe.applyElevationAlignmentBuffer(Me,Ee,Te,me,Ce,Ie,Ge,Je),je=Te,We=me):(je=Me,We=Ee),(0,re.CM)(je,Ie.spatialReference,We,Te,Ge.spatialReference,me,Ce)?Ne:void 0}function ie(he,ge,ye,Me,Ee){const Te=((0,J.f)(he)?he.z:(0,B.Fb)(he)?he.array[he.offset+2]:he[2])||0;switch(ye.mode){case"on-the-ground":{const me=(0,A.Pt)((0,B.KO)(ge,he,"ground"),0);return Ee.verticalDistanceToGround=0,Ee.sampledElevation=me,void(Ee.z=me)}case"relative-to-ground":{const me=(0,A.Pt)((0,B.KO)(ge,he,"ground"),0),Ce=ye.geometryZWithOffset(Te,Me);return Ee.verticalDistanceToGround=Ce,Ee.sampledElevation=me,void(Ee.z=Ce+me)}case"relative-to-scene":{const me=(0,A.Pt)((0,B.KO)(ge,he,"scene"),0),Ce=ye.geometryZWithOffset(Te,Me);return Ee.verticalDistanceToGround=Ce,Ee.sampledElevation=me,void(Ee.z=Ce+me)}case"absolute-height":{const me=ye.geometryZWithOffset(Te,Me),Ce=(0,A.Pt)((0,B.KO)(ge,he,"ground"),0);return Ee.verticalDistanceToGround=me-Ce,Ee.sampledElevation=Ce,void(Ee.z=me)}default:return(0,x.Bg)(ye.mode),void(Ee.z=0)}}function ue(he,ge,ye,Me){return ie(he,ge,ye,Me,_e),_e.z}function ce(he,ge,ye){return null==ge||null==ye?he.definedChanged:"on-the-ground"===ge&&"on-the-ground"===ye?he.staysOnTheGround:ge===ye||"on-the-ground"!==ge&&"on-the-ground"!==ye?se.UPDATE:he.onTheGroundChanged}function oe(he){return"relative-to-ground"===he||"relative-to-scene"===he}function le(he){return"absolute-height"!==he}function Y(he,ge,ye,Me,Ee){ie(ge,ye,Ee,Me,_e),(0,W.CV)(he,_e.verticalDistanceToGround);const Te=_e.sampledElevation,me=(0,G.c)(de,he.transformation);return pe[0]=ge.x,pe[1]=ge.y,pe[2]=_e.z,(0,re.Bm)(ge.spatialReference,pe,me,Me.spatialReference)?he.transformation=me:console.warn("Could not locate symbol object properly, it might be misplaced"),Te}class ne{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}}(he=se||(se={}))[he.NONE=0]="NONE",he[he.UPDATE=1]="UPDATE",he[he.RECREATE=2]="RECREATE";const ae={"absolute-height":{applyElevationAlignmentBuffer:function $(he,ge,ye,Me,Ee,Te,me,Ce){const Ie=Ce.calculateOffsetRenderUnits(me),Ge=Ce.featureExpressionInfoContext;ge*=3,Me*=3;for(let Je=0;Je<Ee;++Je){const je=he[ge+1],We=he[ge+2];ye[Me+0]=he[ge+0],ye[Me+1]=je,ye[Me+2]=null==Ge?We+Ie:Ie,ge+=3,Me+=3}return 0},requiresAlignment:function ee(he){return 0!==he.meterUnitOffset||null!=he.featureExpressionInfoContext}},"on-the-ground":{applyElevationAlignmentBuffer:function j(he,ge,ye,Me,Ee,Te){let me=0;const Ce=Te.spatialReference;ge*=3,Me*=3;for(let Ie=0;Ie<Ee;++Ie){const Ge=he[ge+0],Je=he[ge+1],je=(0,A.Pt)(Te.getElevation(Ge,Je,he[ge+2],Ce,"ground"),0);me+=je,ye[Me+0]=Ge,ye[Me+1]=Je,ye[Me+2]=je,ge+=3,Me+=3}return me/Ee},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function X(he,ge,ye,Me,Ee,Te,me,Ce){let Ie=0;const Ge=Ce.calculateOffsetRenderUnits(me),Je=Ce.featureExpressionInfoContext,xe=Te.spatialReference;ge*=3,Me*=3;for(let je=0;je<Ee;++je){const We=he[ge+0],Ne=he[ge+1],we=he[ge+2],Oe=(0,A.Pt)(Te.getElevation(We,Ne,we,xe,"ground"),0);Ie+=Oe,ye[Me+0]=We,ye[Me+1]=Ne,ye[Me+2]=null==Je?we+Oe+Ge:Oe+Ge,ge+=3,Me+=3}return Ie/Ee},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function U(he,ge,ye,Me,Ee,Te,me,Ce){let Ie=0;const Ge=Ce.calculateOffsetRenderUnits(me),Je=Ce.featureExpressionInfoContext,xe=Te.spatialReference;ge*=3,Me*=3;for(let je=0;je<Ee;++je){const We=he[ge+0],Ne=he[ge+1],we=he[ge+2],Oe=(0,A.Pt)(Te.getElevation(We,Ne,we,xe,"scene"),0);Ie+=Oe,ye[Me+0]=We,ye[Me+1]=Ne,ye[Me+2]=null==Je?we+Oe+Ge:Oe+Ge,ge+=3,Me+=3}return Ie/Ee},requiresAlignment:()=>!0}},de=(0,Q.c)(),_e=new ne,pe=(0,H.c)()},79721:(dt,Re,T)=>{"use strict";var x,A,G;T.d(Re,{E:()=>x,P:()=>A}),(G=x||(x={}))[G.GRAPHIC=0]="GRAPHIC",G[G.LABEL=1]="LABEL",G[G._COUNT=2]="_COUNT",function(G){G[G.USER_SETTING=0]="USER_SETTING",G[G.SCALE_RANGE=1]="SCALE_RANGE",G[G.FILTER=2]="FILTER",G[G.DECONFLICTION=3]="DECONFLICTION",G[G._COUNT=4]="_COUNT"}(A||(A={}))},74746:(dt,Re,T)=>{"use strict";T.d(Re,{O$:()=>oe,Tz:()=>Z,WI:()=>ce,aO:()=>ie,bw:()=>J,d9:()=>re,ht:()=>ue,kr:()=>W});var x=T(15861),A=T(63290),G=T(84786),Q=T(46679);const H=A.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function re(j){return{cachedResult:j.cachedResult,arcade:j.arcade?{func:j.arcade.func,context:j.arcade.modules.arcadeUtils.createExecContext(null,{sr:j.arcade.context.spatialReference}),modules:j.arcade.modules}:null}}function J(j){const X=j&&j.expression;if("string"==typeof X){const U=Y(X);if(null!=U)return{cachedResult:U}}return null}function W(j,X,U){return B.apply(this,arguments)}function B(){return(B=(0,x.Z)(function*(j,X,U){const ee=j&&j.expression;if("string"!=typeof ee)return null;const $=Y(ee);if(null!=$)return{cachedResult:$};const ne=yield(0,Q.LC)(),se=ne.arcadeUtils,ae=se.createSyntaxTree(ee);return se.dependsOnView(ae)?(null!=U&&U.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:se.createFunction(ae),context:se.createExecContext(null,{sr:X}),modules:ne}}})).apply(this,arguments)}function Z(j,X,U){return j.arcadeUtils.createFeature(X.attributes,X.geometry,U)}function ie(j,X){if(null!=j&&!le(j)){if(!X||!j.arcade)return void H.errorOncePerTick("Arcade support required but not provided");const U=X;U._geometry&&(U._geometry=(0,G.kB)(U._geometry)),j.arcade.modules.arcadeUtils.updateExecContext(j.arcade.context,X)}}function ue(j){if(null!=j){if(le(j))return j.cachedResult;const X=j.arcade;let U=j.arcade.modules.arcadeUtils.executeFunction(X.func,X.context);return"number"!=typeof U&&(j.cachedResult=0,U=0),U}return 0}function ce(j,X=!1){let U=j&&j.featureExpressionInfo;return X||"0"===(U&&U.expression)||(U=null),U}const oe={cachedResult:0};function le(j){return null!=j.cachedResult}function Y(j){return"0"===j?0:null}},67225:(dt,Re,T)=>{"use strict";T.d(Re,{$o:()=>se,CV:()=>$,Go:()=>ee,Si:()=>ge,Uu:()=>ne,ZL:()=>pe,_Z:()=>he,bD:()=>ae,bh:()=>_e,zE:()=>le});var x=T(62208),A=T(28347),G=T(43703),Q=T(28093),H=T(993),re=T(4794),J=T(55915),W=T(5548),B=T(65401),Z=T(27105),ie=T(25748),ue=T(38114),ce=T(84786),oe=T(16396);function le(ye,Me){if("point"===ye.type)return U(ye,Me,!1);if((0,ce.Ou)(ye))switch(ye.type){case"extent":return U(ye.center,Me,!1);case"polygon":return U(ye.centroid,Me,!1);case"polyline":return U(Y(ye),Me,!0);case"mesh":return U(ye.origin,Me,!1)}else switch(ye.type){case"extent":return U(function j(ye){const Me=isFinite(ye.zmin);return(0,ue.Tx)(.5*(ye.xmax+ye.xmin),.5*(ye.ymax+ye.ymin),Me?.5*(ye.zmax+ye.zmin):void 0,ye.spatialReference)}(ye),Me,!0);case"polygon":return U(function X(ye){const Me=ye.rings[0];if(!Me||0===Me.length)return null;const Ee=(0,Z.a)(ye.rings,ye.hasZ);return(0,ue.Tx)(Ee[0],Ee[1],Ee[2],ye.spatialReference)}(ye),Me,!0);case"polyline":return U(Y(ye),Me,!0)}}function Y(ye){const Me=ye.paths[0];if(!Me||0===Me.length)return null;const Ee=(0,ie.n8)(Me,(0,ie.ok)(Me)/2);return(0,ue.Tx)(Ee[0],Ee[1],Ee[2],ye.spatialReference)}function U(ye,Me,Ee){const Te=Ee?ye:(0,ce.WG)(ye);return Me&&ye?(0,J.nF)(ye,Te,Me)?Te:null:Te}function ee(ye,Me,Ee,Te=0){if(ye){Me||(Me=(0,B.Ue)());const me=ye;let Ce=.5*me.width*(Ee-1),Ie=.5*me.height*(Ee-1);return me.width<1e-7*me.height?Ce+=Ie/20:me.height<1e-7*me.width&&(Ie+=Ce/20),(0,H.s)(Me,me.xmin-Ce-Te,me.ymin-Ie-Te,me.xmax+Ce+Te,me.ymax+Ie+Te),Me}return null}function $(ye,Me){for(let Ee=0;Ee<ye.geometries.length;++Ee){const Te=ye.geometries[Ee].getMutableAttribute(oe.T.AUXPOS1);Te&&Te.data[3]!==Me&&(Te.data[3]=Me,ye.geometryVertexAttrsUpdated(ye.geometryRecords[Ee]))}}function ne(ye,Me){const Ee=(0,re.d)(re.O);return(0,x.pC)(ye)&&(Ee[0]=ye[0],Ee[1]=ye[1],Ee[2]=ye[2]),(0,x.pC)(Me)?Ee[3]=Me:(0,x.pC)(ye)&&ye.length>3&&(Ee[3]=ye[3]),Ee}function se(ye,Me,Ee,Te,me,Ce=[0,0,0,0]){for(let Ie=0;Ie<3;++Ie)Ce[Ie]=(0,x.pC)(ye)&&null!=ye[Ie]?ye[Ie]:(0,x.pC)(Ee)&&null!=Ee[Ie]?Ee[Ie]:me[Ie];return Ce[3]=(0,x.pC)(Me)?Me:(0,x.pC)(Te)?Te:me[3],Ce}function ae(ye=Q.O,Me,Ee,Te=1){const me=new Array(3);if((0,x.Wi)(Me)||(0,x.Wi)(Ee))me[0]=1,me[1]=1,me[2]=1;else{let Ce,Ie=0;for(let Ge=2;Ge>=0;Ge--){const Je=ye[Ge];let xe;const je=null!=Je,We=0===Ge&&!Ce&&!je,Ne=Ee[Ge];"symbol-value"===Je||We?xe=0!==Ne?Me[Ge]/Ne:1:je&&"proportional"!==Je&&isFinite(Je)&&(xe=0!==Ne?Je/Ne:1),null!=xe&&(me[Ge]=xe,Ce=xe,Ie=Math.max(Ie,Math.abs(xe)))}for(let Ge=2;Ge>=0;Ge--)null==me[Ge]?me[Ge]=Ce:0===me[Ge]&&(me[Ge]=.001*Ie)}for(let Ce=2;Ce>=0;Ce--)me[Ce]/=Te;return(0,Q.d)(me)}function _e(ye){return function de(ye){return null!=ye.isPrimitive}(ye)&&(ye=[ye.width,ye.depth,ye.height]),pe(ye)?null:"Symbol sizes may not be negative values"}function pe(ye){if(Array.isArray(ye)){for(const Me of ye)if(!pe(Me))return!1;return!0}return null==ye||ye>=0}function he(ye,Me,Ee,Te=(0,G.c)()){const me=ye||0,Ce=Me||0,Ie=Ee||0;return 0!==me&&(0,A.g)(Te,Te,-me/180*Math.PI),0!==Ce&&(0,A.r)(Te,Te,Ce/180*Math.PI),0!==Ie&&(0,A.o)(Te,Te,Ie/180*Math.PI),Te}function ge(ye,Me){return null!=Me.minDemResolution?Me.minDemResolution:(0,W.wp)(ye)?Me.minDemResolutionForPoints:.01*(0,W.aO)(ye)}},64538:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{W:()=>x}),(A=x||(x={}))[A.Recreate_Symbol=0]="Recreate_Symbol",A[A.Recreate_Graphics=1]="Recreate_Graphics",A[A.Fast_Update=2]="Fast_Update"},44014:(dt,Re,T)=>{"use strict";T.d(Re,{NW:()=>Me,VP:()=>U,YU:()=>X,rm:()=>$,u9:()=>me}),T(8314);var Me,Ce,A=T(62208),G=T(55713),Q=T(67831),H=T(84161),re=T(28093),J=T(55915),W=T(12080),B=T(85334),Z=T(59617),ie=T(80960),ue=T(81468),ce=T(64835),oe=T(42743),le=T(52107),Y=T(16396),j=T(39401);function X(Ce){const Ie=[],Ge=[];!function ne(Ce,Ie,Ge){const{attributeData:{position:Je},removeDuplicateStartEnd:xe}=Ce,je=function ye(Ce){const Ie=Ce.length;return Ce[0]===Ce[Ie-3]&&Ce[1]===Ce[Ie-2]&&Ce[2]===Ce[Ie-1]}(Je)&&xe===Me.REMOVE,We=Je.length/3-(je?1:0),Ne=new Uint32Array(2*(We-1)),we=je?(0,G.tP)(Je,0,Je.length-3):Je;let Oe=0;for(let $e=0;$e<We-1;$e++)Ne[Oe++]=$e,Ne[Oe++]=$e+1;Ie.push([Y.T.POSITION,{size:3,data:we,exclusive:je}]),Ge.push([Y.T.POSITION,Ne])}(Ce,Ge,Ie);const Je=Ge[0][1].data,je=new Uint16Array(Ie[0][1].length);return function se(Ce,Ie,Ge){const Je=Ce.attributeData.mapPosition;(0,A.Wi)(Je)||(Ge.push([Y.T.MAPPOS,Ge[0][1]]),Ie.push([Y.T.MAPPOS,{size:3,data:Je}]))}(Ce,Ge,Ie),function ae(Ce,Ie,Ge,Je){(0,A.pC)(Ce.attributeData.colorFeature)||(Ie.push([Y.T.COLOR,{size:4,data:(0,A.Pt)(Ce.attributeData.color,ie.a1)}]),Ge.push([Y.T.COLOR,Je]))}(Ce,Ge,Ie,je),function _e(Ce,Ie,Ge,Je){(0,A.pC)(Ce.attributeData.sizeFeature)||(Ie.push([Y.T.SIZE,{size:1,data:[(0,A.Pt)(Ce.attributeData.size,1)]}]),Ge.push([Y.T.SIZE,Je]))}(Ce,Ge,Ie,je),function de(Ce,Ie,Ge,Je){const xe=Ce.attributeData.colorFeature;(0,A.Wi)(xe)||(Ie.push([Y.T.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([xe])}]),Ge.push([Y.T.COLOR,Je]))}(Ce,Ge,Ie,je),function pe(Ce,Ie,Ge,Je){const xe=Ce.attributeData.sizeFeature;(0,A.Wi)(xe)||(Ie.push([Y.T.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([xe])}]),Ge.push([Y.T.SIZEFEATUREATTRIBUTE,Je]))}(Ce,Ge,Ie,je),function he(Ce,Ie,Ge,Je){const xe=Ce.attributeData.opacityFeature;(0,A.Wi)(xe)||(Ie.push([Y.T.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([xe])}]),Ge.push([Y.T.OPACITYFEATUREATTRIBUTE,Je]))}(Ce,Ge,Ie,je),function ge(Ce,Ie,Ge,Je){if((0,A.Wi)(Ce.overlayInfo)||Ce.overlayInfo.renderCoordsHelper.viewingMode!==Z.JY.Global||!Ce.overlayInfo.spatialReference.isGeographic)return;const xe=new Float64Array(Je.length),je=(0,W.Iu)(Ce.overlayInfo.spatialReference);for(let Se=0;Se<xe.length;Se+=3)(0,J.gH)(Je,Se,xe,Se,je);const We=Je.length/3,Ne=new Float32Array(We+1);let we=Ee,Oe=Te,$e=0,Be=0;(0,H.s)(we,xe[Be++],xe[Be++],xe[Be++]),Ne[0]=0;for(let Se=1;Se<We+1;++Se)Se===We&&(Be=0),(0,H.s)(Oe,xe[Be++],xe[Be++],xe[Be++]),$e+=(0,Q.d)(we,Oe),Ne[Se]=$e,[we,Oe]=[Oe,we];Ie.push([Y.T.DISTANCETOSTART,{size:1,data:Ne}]),Ge.push([Y.T.DISTANCETOSTART,Ge[0][1]])}(Ce,Ge,Ie,Je),new le.Z(Ge,Ie,oe.MX.Line)}function U(Ce,Ie,Ge,Je){const xe="polygon"===Ce.type?B.ZI.CCW_IS_HOLE:B.ZI.NONE,je="polygon"===Ce.type?Ce.rings:Ce.paths,{position:We,outlines:Ne}=(0,B.Mk)(je,Ce.hasZ,xe),we=new Float64Array(We.length),Oe=(0,ue.rR)(We,Ce.spatialReference,0,we,0,We,0,We.length/3,Ie,Ge,Je),$e=null!=Oe;return{lines:$e?ee(Ne,We,we):[],projectionSuccess:$e,sampledElevation:Oe}}function ee(Ce,Ie,Ge){const Je=new Array;for(const{index:xe,count:je}of Ce){if(je<=1)continue;const We=3*xe,Ne=We+3*je;Je.push({position:Ie.subarray(We,Ne),mapPosition:Ge?Ge.subarray(We,Ne):void 0})}return Je}function $(Ce,Ie){const Ge="polygon"===Ce.type?B.ZI.CCW_IS_HOLE:B.ZI.NONE,Je="polygon"===Ce.type?Ce.rings:Ce.paths,{position:xe,outlines:je}=(0,B.Mk)(Je,!1,Ge),We=(0,J.CM)(xe,Ce.spatialReference,0,xe,Ie,0,xe.length/3);for(let Ne=2;Ne<xe.length;Ne+=3)xe[Ne]=ce.Rn;return{lines:We?ee(je,xe):[],projectionSuccess:We}}(Ce=Me||(Me={}))[Ce.KEEP=0]="KEEP",Ce[Ce.REMOVE=1]="REMOVE";const Ee=(0,re.c)(),Te=(0,re.c)();function me(Ce){switch(Ce){case"butt":return j.R.BUTT;case"square":return j.R.SQUARE;case"round":return j.R.ROUND;default:return null}}},6176:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{fetch:()=>ge,gltfToEngineResources:()=>Ee,parseUrl:()=>Me});var x=T(15861),A=T(83100),G=T(62208),Q=T(30217),H=T(550),re=T(28347),J=T(43703),W=T(84161),B=T(28093),Z=T(5548),ie=T(60479),ue=T(79800),ce=T(63657),oe=T(60490),le=T(9160),Y=T(93831),j=T(96170),X=T(98973),U=T(42743),ee=T(52107),$=T(81695),ne=T(16396),se=T(28523),ae=T(79331),de=T(67969),_e=T(35995),pe=T(63470),he=T(9554);function ge(Ie,Ge){return ye.apply(this,arguments)}function ye(){return(ye=(0,x.Z)(function*(Ie,Ge){const Je=Me((0,A.pJ)(Ie));if("wosr"===Je.fileType){const Oe=yield Ge.cache?Ge.cache.loadWOSR(Je.url,Ge):(0,X.zD)(Je.url,Ge),$e=(0,X.p2)(Oe,Ge);return{lods:[$e],referenceBoundingBox:$e.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:Oe.remove}}const xe=yield Ge.cache?Ge.cache.loadGLTF(Je.url,Ge,Ge.usePBR):(0,Y.z)(new le.C(Ge.streamDataRequester),Je.url,Ge,Ge.usePBR),je=(0,G.U2)(xe.model.meta,"ESRI_proxyEllipsoid");xe.meta.isEsriSymbolResource&&(0,G.pC)(je)&&xe.meta.uri.includes("/RealisticTrees/")&&Ce(xe,je);const We=xe.meta.isEsriSymbolResource?{usePBR:Ge.usePBR,isSchematic:!1,treeRendering:!!xe.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:Ge.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},Ne=yi(or({},Ge.materialParamsMixin),{treeRendering:!!xe.customMeta.esriTreeRendering});if(null!=Je.specifiedLodIndex){const Oe=Ee(xe,We,Ne,Je.specifiedLodIndex);let $e=Oe[0].boundingBox;return 0!==Je.specifiedLodIndex&&($e=Ee(xe,We,Ne,0)[0].boundingBox),{lods:Oe,referenceBoundingBox:$e,isEsriSymbolResource:xe.meta.isEsriSymbolResource,isWosr:!1,remove:xe.remove}}const we=Ee(xe,We,Ne);return{lods:we,referenceBoundingBox:we[0].boundingBox,isEsriSymbolResource:xe.meta.isEsriSymbolResource,isWosr:!1,remove:xe.remove}})).apply(this,arguments)}function Me(Ie){const Ge=Ie.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return Ge?{fileType:"gltf",url:Ge[1],specifiedLodIndex:null!=Ge[4]?Number(Ge[4]):null}:Ie.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:Ie,specifiedLodIndex:null}:{fileType:"unknown",url:Ie,specifiedLodIndex:null}}function Ee(Ie,Ge,Je,xe){const je=Ie.model,We=(0,H.c)(),Ne=new Array,we=new Map,Oe=new Map;return je.lods.forEach(($e,Be)=>{if(void 0!==xe&&Be!==xe)return;const Se={name:$e.name,stageResources:{textures:new Array,materials:new Array,geometries:new Array},lodThreshold:(0,G.pC)($e.lodThreshold)?$e.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:(0,Z.cS)()};Ne.push(Se),$e.parts.forEach(De=>{const Fe=De.material+(De.attributes.normal?"_normal":"")+(De.attributes.color?"_color":"")+(De.attributes.texCoord0?"_texCoord0":"")+(De.attributes.tangent?"_tangent":""),ve=je.materials.get(De.material),Ke=(0,G.pC)(De.attributes.texCoord0),qe=(0,G.pC)(De.attributes.normal),be=function Te(Ie){switch(Ie){case"BLEND":return U.JJ.Blend;case"MASK":return U.JJ.Mask;case"OPAQUE":case null:case void 0:return U.JJ.Opaque}}(ve.alphaMode);if(!we.has(Fe)){if(Ke){if((0,G.pC)(ve.textureColor)&&!Oe.has(ve.textureColor)){const Xt=je.textures.get(ve.textureColor),Mr=yi(or({},Xt.parameters),{preMultiplyAlpha:be!==U.JJ.Opaque});Oe.set(ve.textureColor,new $.x(Xt.data,Mr))}if((0,G.pC)(ve.textureNormal)&&!Oe.has(ve.textureNormal)){const Xt=je.textures.get(ve.textureNormal);Oe.set(ve.textureNormal,new $.x(Xt.data,Xt.parameters))}if((0,G.pC)(ve.textureOcclusion)&&!Oe.has(ve.textureOcclusion)){const Xt=je.textures.get(ve.textureOcclusion);Oe.set(ve.textureOcclusion,new $.x(Xt.data,Xt.parameters))}if((0,G.pC)(ve.textureEmissive)&&!Oe.has(ve.textureEmissive)){const Xt=je.textures.get(ve.textureEmissive);Oe.set(ve.textureEmissive,new $.x(Xt.data,Xt.parameters))}if((0,G.pC)(ve.textureMetallicRoughness)&&!Oe.has(ve.textureMetallicRoughness)){const Xt=je.textures.get(ve.textureMetallicRoughness);Oe.set(ve.textureMetallicRoughness,new $.x(Xt.data,Xt.parameters))}}const yt=ve.color[0]**(1/ae.K),wt=ve.color[1]**(1/ae.K),zt=ve.color[2]**(1/ae.K),Rt=ve.emissiveFactor[0]**(1/ae.K),Ft=ve.emissiveFactor[1]**(1/ae.K),bt=ve.emissiveFactor[2]**(1/ae.K),St=(0,G.pC)(ve.textureColor)&&Ke?Oe.get(ve.textureColor):null;we.set(Fe,new se.Gp(or(yi(or({},Ge),{transparent:be===U.JJ.Blend,customDepthTest:U.Gv.Lequal,textureAlphaMode:be,textureAlphaCutoff:ve.alphaCutoff,diffuse:[yt,wt,zt],ambient:[yt,wt,zt],opacity:ve.opacity,doubleSided:ve.doubleSided,doubleSidedType:"winding-order",cullFace:ve.doubleSided?U.Vr.None:U.Vr.Back,hasVertexColors:!!De.attributes.color,hasVertexTangents:!!De.attributes.tangent,normals:qe?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:(0,G.pC)(St)?St.id:void 0,colorMixMode:ve.colorMixMode,normalTextureId:(0,G.pC)(ve.textureNormal)&&Ke?Oe.get(ve.textureNormal).id:void 0,textureAlphaPremultiplied:(0,G.pC)(St)&&!!St.params.preMultiplyAlpha,occlusionTextureId:(0,G.pC)(ve.textureOcclusion)&&Ke?Oe.get(ve.textureOcclusion).id:void 0,emissiveTextureId:(0,G.pC)(ve.textureEmissive)&&Ke?Oe.get(ve.textureEmissive).id:void 0,metallicRoughnessTextureId:(0,G.pC)(ve.textureMetallicRoughness)&&Ke?Oe.get(ve.textureMetallicRoughness).id:void 0,emissiveFactor:[Rt,Ft,bt],mrrFactors:[ve.metallicFactor,ve.roughnessFactor,Ge.mrrFactors[2]],isSchematic:!1}),Je)))}const tt=function me(Ie,Ge){switch(Ge){case de.MX.TRIANGLES:return(0,j.nh)(Ie);case de.MX.TRIANGLE_STRIP:return(0,j.DA)(Ie);case de.MX.TRIANGLE_FAN:return(0,j.jX)(Ie)}}(De.indices||De.attributes.position.count,De.primitiveType),Ye=De.attributes.position.count,ze=(0,oe.gS)(ie.ct,Ye);(0,ue.t)(ze,De.attributes.position,De.transform);const et=[[ne.T.POSITION,{data:ze.typedBuffer,size:ze.elementCount,exclusive:!0}]],ke=[[ne.T.POSITION,tt]];if((0,G.pC)(De.attributes.normal)){const yt=(0,oe.gS)(ie.ct,Ye);(0,Q.a)(We,De.transform),(0,ue.a)(yt,De.attributes.normal,We),et.push([ne.T.NORMAL,{data:yt.typedBuffer,size:yt.elementCount,exclusive:!0}]),ke.push([ne.T.NORMAL,tt])}if((0,G.pC)(De.attributes.tangent)){const yt=(0,oe.gS)(ie.ek,Ye);(0,Q.a)(We,De.transform),(0,ce.t)(yt,De.attributes.tangent,We),et.push([ne.T.TANGENT,{data:yt.typedBuffer,size:yt.elementCount,exclusive:!0}]),ke.push([ne.T.TANGENT,tt])}if((0,G.pC)(De.attributes.texCoord0)){const yt=(0,oe.gS)(ie.Eu,Ye);(0,_e.n)(yt,De.attributes.texCoord0),et.push([ne.T.UV0,{data:yt.typedBuffer,size:yt.elementCount,exclusive:!0}]),ke.push([ne.T.UV0,tt])}if((0,G.pC)(De.attributes.color)){const yt=(0,oe.gS)(ie.mc,Ye);if(4===De.attributes.color.elementCount)De.attributes.color instanceof ie.ek?(0,ce.s)(yt,De.attributes.color,255):De.attributes.color instanceof ie.mc?(0,pe.c)(yt,De.attributes.color):De.attributes.color instanceof ie.v6&&(0,ce.s)(yt,De.attributes.color,1/256);else{(0,pe.f)(yt,255,255,255,255);const wt=new ie.ne(yt.buffer,0,4);De.attributes.color instanceof ie.ct?(0,ue.s)(wt,De.attributes.color,255):De.attributes.color instanceof ie.ne?(0,he.c)(wt,De.attributes.color):De.attributes.color instanceof ie.mw&&(0,ue.s)(wt,De.attributes.color,1/256)}et.push([ne.T.COLOR,{data:yt.typedBuffer,size:yt.elementCount,exclusive:!0}]),ke.push([ne.T.COLOR,tt])}const ot=new ee.Z(et,ke);Se.stageResources.geometries.push(ot),Se.stageResources.materials.push(we.get(Fe)),Ke&&((0,G.pC)(ve.textureColor)&&Se.stageResources.textures.push(Oe.get(ve.textureColor)),(0,G.pC)(ve.textureNormal)&&Se.stageResources.textures.push(Oe.get(ve.textureNormal)),(0,G.pC)(ve.textureOcclusion)&&Se.stageResources.textures.push(Oe.get(ve.textureOcclusion)),(0,G.pC)(ve.textureEmissive)&&Se.stageResources.textures.push(Oe.get(ve.textureEmissive)),(0,G.pC)(ve.textureMetallicRoughness)&&Se.stageResources.textures.push(Oe.get(ve.textureMetallicRoughness))),Se.numberOfVertices+=Ye;const at=ot.boundingInfo;(0,G.pC)(at)&&((0,Z.pp)(Se.boundingBox,at.getBBMin()),(0,Z.pp)(Se.boundingBox,at.getBBMax()))})}),Ne}function Ce(Ie,Ge){for(let Je=0;Je<Ie.model.lods.length;++Je){const xe=Ie.model.lods[Je];Ie.customMeta.esriTreeRendering=!0;for(const je of xe.parts){const We=je.attributes.normal;if((0,G.Wi)(We))return;const Ne=je.attributes.position,we=Ne.count,Oe=(0,B.c)(),$e=(0,B.c)(),Be=(0,B.c)(),Se=(0,oe.gS)(ie.mc,we),De=(0,oe.gS)(ie.ct,we),Fe=(0,re.a)((0,J.c)(),je.transform);for(let ve=0;ve<we;ve++){Ne.getVec(ve,$e),We.getVec(ve,Oe),(0,W.m)($e,$e,je.transform),(0,W.b)(Be,$e,Ge.center),(0,W.G)(Be,Be,Ge.radius);const Ke=Be[2],qe=(0,W.l)(Be),be=Math.min(.45+.55*qe*qe,1);(0,W.G)(Be,Be,Ge.radius),(0,W.m)(Be,Be,Fe),(0,W.n)(Be,Be),Je+1!==Ie.model.lods.length&&Ie.model.lods.length>1&&(0,W.h)(Be,Be,Oe,Ke>-1?.2:Math.min(-4*Ke-3.8,1)),De.setVec(ve,Be),Se.set(ve,0,255*be),Se.set(ve,1,255*be),Se.set(ve,2,255*be),Se.set(ve,3,255)}je.attributes.normal=De,je.attributes.color=Se}}}},75688:(dt,Re,T)=>{"use strict";T.d(Re,{$A:()=>G,EP:()=>J,QW:()=>W,j1:()=>B,mq:()=>H,yY:()=>Q,zi:()=>re});var x=T(99770),A=T(6169);const G={left:0,center:.5,right:1},Q={"bottom-left":(0,x.f)(0,0),bottom:(0,x.f)(.5,0),"bottom-right":(0,x.f)(1,0),left:(0,x.f)(0,.5),center:(0,x.f)(.5,.5),right:(0,x.f)(1,.5),"top-left":(0,x.f)(0,1),top:(0,x.f)(.5,1),"top-right":(0,x.f)(1,1)};function H(Z){switch(Z){case"left":return A.vU.Left;case"right":return A.vU.Right;default:return A.vU.Center}}function re(Z){switch(Z){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function J(Z){switch(Z){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function W(Z,ie){switch(ie){case"bottom":return"left"===Z?"bottom-left":"right"===Z?"bottom-right":"bottom";case"center":return Z;case"top":return"left"===Z?"top-left":"right"===Z?"top-right":"top"}}function B(Z){return"middle"===Z?"center":Z}},92690:(dt,Re,T)=>{"use strict";T.d(Re,{S_:()=>oe,VP:()=>le,dO:()=>ce,km:()=>ue});var x=T(62208),A=T(43703),G=T(28093),Q=T(55915),H=T(5548),re=T(25748),J=T(38114),W=T(81468),B=T(67225),Z=T(97272);const ie=(0,G.c)();function ue(Y,j,X,U,ee,$,ne,se){const ae=X?X.length:0,de=Y.clippingExtent;if((0,Q.KC)(j,ie,Y.elevationProvider.spatialReference),(0,x.pC)(de)&&!(0,H.BD)(de,ie))return null;(0,Q.KC)(j,ie,Y.renderCoordsHelper.spatialReference);const _e=Y.localOriginFactory.getOrigin(ie),pe=new Z.T({castShadow:!1,metadata:{layerUid:$,graphicUid:ne,usesVerticalDistanceToGround:!0}});for(let he=0;he<ae;he++)pe.addGeometry(X[he],U[he],A.I,_e,se);return{object:pe,sampledElevation:(0,W.bD)(pe,j,Y.elevationProvider,Y.renderCoordsHelper,ee)}}function ce(Y,j,X){const U=Y.elevationContext,ee=X.spatialReference;(0,Q.KC)(j,ie,ee),U.centerPointInElevationSR=(0,J.Tx)(ie[0],ie[1],j.hasZ?ie[2]:0,ee)}function oe(Y){switch(Y.type){case"point":return Y;case"polygon":case"extent":return(0,B.zE)(Y);case"polyline":{const j=Y.paths[0];if(!j||0===j.length)return null;const X=(0,re.n8)(j,(0,re.ok)(j)/2);return(0,J.Tx)(X[0],X[1],X[2],Y.spatialReference)}case"mesh":return Y.origin}return null}function le(Y,j,X,U,ee){const $=new Float64Array(3*Y.length),ne=new Float64Array($.length);Y.forEach((de,_e)=>{$[3*_e+0]=de[0],$[3*_e+1]=de[1],$[3*_e+2]=de.length>2?de[2]:0});const se=(0,W.rR)($,j,0,ne,0,$,0,$.length/3,X,U,ee);return{numVertices:Y.length,position:$,mapPosition:ne,projectionSuccess:null!=se,sampledElevation:se}}},56244:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>G,t:()=>Q}),T(8314);var A=T(57521);function G(re){switch(re){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Q(re,J){const W=(B,Z,ie=!1)=>({levels:B.map(ue=>{const ce=Z(ue.tesselation);return ie&&A.Z.cgToGIS(ce),{components:[{geometry:ce,material:J}],faceCount:ce.indexCount/3,minScreenSpaceRadius:ue.minScreenSpaceRadius}})});switch(re){case"sphere":return W([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],B=>A.Z.createPolySphereGeometry(.5,B,!0));case"cube":return W([{tesselation:0,minScreenSpaceRadius:0}],()=>A.Z.createBoxGeometry(1));case"cone":return W(H,B=>A.Z.createConeGeometry(1,.5,B,!1),!0);case"inverted-cone":return W(H,B=>A.Z.createConeGeometry(1,.5,B,!0),!0);case"cylinder":return W(H,B=>A.Z.createCylinderGeometry(1,.5,B,[0,0,1],[0,0,.5]));case"tetrahedron":return W([{tesselation:0,minScreenSpaceRadius:0}],()=>A.Z.createTetrahedronGeometry(1),!0);case"diamond":return W([{tesselation:0,minScreenSpaceRadius:0}],()=>A.Z.createDiamondGeometry(1),!0);default:return}}const H=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]},10596:(dt,Re,T)=>{"use strict";T.d(Re,{Ns:()=>re,Ph:()=>H,cU:()=>J}),T(8314);var A=T(36161),G=T(81695),Q=T(67969);const H=128,re=.5;function J($,ne=H,se=ne*re,ae=0){const de=function W($,ne=H,se=ne*re,ae=0){switch($){case"circle":default:return function B($,ne){const se=$/2-.5;return ee($,X(se,se,ne/2))}(ne,se);case"square":return function Z($,ne){return Y($,ne,!1)}(ne,se);case"cross":return function ue($,ne,se=0){return j($,ne,!1,se)}(ne,se,ae);case"x":return function ce($,ne,se=0){return j($,ne,!0,se)}(ne,se,ae);case"kite":return function ie($,ne){return Y($,ne,!0)}(ne,se);case"triangle":return function oe($,ne){return ee($,U($/2,ne,ne/2))}(ne,se);case"arrow":return function le($,ne){const se=ne,ae=ne/2,de=$/2,_e=.8*se,pe=X(de,($-ne)/2-_e,Math.sqrt(_e*_e+ae*ae)),he=U(de,se,ae);return ee($,(ge,ye)=>Math.max(he(ge,ye),-pe(ge,ye)))}(ne,se)}}($,ne,se,ae);return new G.x(de,{mipmap:!1,wrap:{s:Q.e8.CLAMP_TO_EDGE,t:Q.e8.CLAMP_TO_EDGE},width:ne,height:ne,components:4,noUnpackFlip:!0})}function Y($,ne,se){return se&&(ne/=Math.SQRT2),ee($,(ae,de)=>{let _e=ae-.5*$+.25,pe=.5*$-de-.75;if(se){const he=(_e+pe)/Math.SQRT2;pe=(pe-_e)/Math.SQRT2,_e=he}return Math.max(Math.abs(_e),Math.abs(pe))-.5*ne})}function j($,ne,se,ae=0){ne-=ae,se&&(ne*=Math.SQRT2);const de=.5*ne;return ee($,(_e,pe)=>{let he,ge=_e-.5*$,ye=.5*$-pe-1;if(se){const Me=(ge+ye)/Math.SQRT2;ye=(ye-ge)/Math.SQRT2,ge=Me}return ge=Math.abs(ge),ye=Math.abs(ye),he=ge>ye?ge>de?Math.sqrt((ge-de)*(ge-de)+ye*ye):ye:ye>de?Math.sqrt(ge*ge+(ye-de)*(ye-de)):ge,he-=ae/2,he})}function X($,ne,se){return(ae,de)=>{const _e=ae-$,pe=de-ne;return Math.sqrt(_e*_e+pe*pe)-se}}function U($,ne,se){const ae=Math.sqrt(ne*ne+se*se);return(de,_e)=>{const pe=Math.abs(de-$)-se,he=_e-$+ne/2+.75;return Math.max((ne*pe+se*he)/ae,-he)}}function ee($,ne){const se=new Uint8Array(4*$*$);for(let ae=0;ae<$;ae++)for(let de=0;de<$;de++){const _e=de+$*ae;let pe=ne(de,ae);pe=pe/$+.5,(0,A.I)(pe,se,4*_e)}return se}},97161:(dt,Re,T)=>{"use strict";T.d(Re,{BN:()=>oe,IQ:()=>Z,V9:()=>B,WU:()=>W,bz:()=>ie,u:()=>ce});var x=T(94573),A=T(62208),G=T(48521),Q=T(56244),H=T(2180),re=T(16396),J=T(47526);const W={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function B(j){return"web-style"===j.type?W:Z(j.symbolLayers.toArray().map(X=>ce(j,X)))}function Z(j){let X=0,U=0,ee=0,$=!1,ne=0;const se={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const ae of j)(0,A.Wi)(ae)||(X+=ae.primitivesPerFeature,U+=ae.primitivesPerCoordinate,ee+=ae.drawCallsPerFeature,se.bytesPerFeature+=ae.memory.bytesPerFeature,se.bytesPerFeatureLabel+=ae.memory.bytesPerFeatureLabel,se.bytesPerCoordinate+=ae.memory.bytesPerCoordinate,se.draped.bytesPerFeature+=ae.memory.bytesPerFeature,se.draped.bytesPerFeatureLabel+=ae.memory.bytesPerFeatureLabel,se.draped.bytesPerCoordinate+=ae.memory.bytesPerCoordinate,$=$||ae.estimated,++ne);return{primitivesPerFeature:X,primitivesPerCoordinate:U,drawCallsPerFeature:ee,estimated:$,memory:se,numComplexities:ne}}function ie(j){const X=Z(j);return X.numComplexities>0&&(X.primitivesPerFeature/=X.numComplexities,X.primitivesPerCoordinate/=X.numComplexities,X.drawCallsPerFeature/=X.numComplexities,X.memory.bytesPerFeature/=X.numComplexities,X.memory.bytesPerFeatureLabel/=X.numComplexities,X.memory.bytesPerCoordinate/=X.numComplexities,X.memory.draped.bytesPerFeature/=X.numComplexities,X.memory.draped.bytesPerFeatureLabel/=X.numComplexities,X.memory.draped.bytesPerCoordinate/=X.numComplexities),X}const ue={};function ce(j,X){const U=oe(j,X),ee=(0,H.eU)(X)?2:0;switch(X.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:ee,estimated:!1,memory:U};case"fill":return"mesh-3d"===j.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:ee,estimated:!1,memory:U}:(0,A.pC)(X.outline)&&X.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:U}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:U};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:U};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:U};case"object":return X.resource&&X.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:U}:yi(or({},function le(j){let X=ue[j];if(X)return X;const U=(0,Q.t)(j,null);return X={primitivesPerFeature:(0,J.VV)(U.levels[0]).reduce((ee,$)=>ee+$.indices.get(re.T.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},ue[j]=X,X}(X.resource&&X.resource.primitive||G.S)),{memory:U});case"path":{let ae=0,de=0;switch(X.profile){case"circle":ae=10;break;case"quad":ae=4;break;default:return void(0,x.Bg)(X.profile)}switch(X.join){case"round":de=3;break;case"miter":case"bevel":de=1;break;default:return void(0,x.Bg)(X.join)}const _e=2*ae,pe=ae*de*2;let he=-2*pe-_e;switch(X.cap){case"none":break;case"butt":case"square":he+=2*(ae-1);break;case"round":he+=2*(2*ae*2+ae);break;default:return}return{primitivesPerFeature:he,primitivesPerCoordinate:pe+_e,drawCallsPerFeature:0,estimated:!1,memory:U}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:U};default:return}}function oe(j,X){const U="point-3d"===j.type;switch(X.type){case"extrude":return X.edges&&X.edges.size>0?Y.EXTRUDE_EDGES:Y.EXTRUDE;case"fill":return(0,A.pC)(X.outline)&&X.outline.size>0?Y.FILL_OUTLINE:Y.FILL;case"water":return Y.FILL;case"line":return"round"===X.join?Y.LINE_ROUND:Y.LINE_MITER;case"path":switch(X.join){case"round":switch(X.profile){case"circle":return Y.PATH_ROUND_CIRCLE;case"quad":return Y.PATH_ROUND_QUAD;default:return void(0,x.Bg)(X.profile)}case"miter":case"bevel":switch(X.profile){case"circle":return Y.PATH_MITER_CIRCLE;case"quad":return Y.PATH_MITER_QUAD;default:return void(0,x.Bg)(X.profile)}default:return void(0,x.Bg)(X.join)}case"object":return U?Y.OBJECT_POINT:Y.OBJECT_POLYGON;case"icon":case"text":return U?Y.ICON_POINT:Y.ICON_POLYGON;default:return}}const Y={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}}},98973:(dt,Re,T)=>{"use strict";T.d(Re,{p2:()=>_e,zD:()=>X});var x=T(15861),A=T(84792),G=T(59213),Q=T(26584),H=T(63290),re=T(62208),J=T(10699),W=T(10349),B=T(28093),Z=T(5548),ie=T(70026),ue=T(42743),ce=T(52107),oe=T(81695),le=T(28523),Y=T(67969);const j=H.Z.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");function X(Te,me){return U.apply(this,arguments)}function U(){return(U=(0,x.Z)(function*(Te,me){const Ce=yield ee(Te,me);return{resource:Ce,textures:yield he(Ce.textureDefinitions,me)}})).apply(this,arguments)}function ee(Te,me){return $.apply(this,arguments)}function $(){return($=(0,x.Z)(function*(Te,me){const Ce=(0,re.pC)(me)&&me.streamDataRequester;if(Ce)return ne(Te,Ce,me);const Ie=yield(0,G.q6)((0,A.default)(Te,(0,re.Wg)(me)));if(!0===Ie.ok)return Ie.value.data;(0,J.r9)(Ie.error),ae(Ie.error)})).apply(this,arguments)}function ne(Te,me,Ce){return se.apply(this,arguments)}function se(){return(se=(0,x.Z)(function*(Te,me,Ce){const Ie=yield(0,G.q6)(me.request(Te,"json",Ce));if(!0===Ie.ok)return Ie.value;(0,J.r9)(Ie.error),ae(Ie.error.details.url)})).apply(this,arguments)}function ae(Te){throw new Q.Z("",`Request for object resource failed: ${Te}`)}function de(Te){const me=Te.params,Ce=me.topology;let Ie=!0;switch(me.vertexAttributes||(j.warn("Geometry must specify vertex attributes"),Ie=!1),me.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const Je=me.faces;if(Je){if(me.vertexAttributes)for(const xe in me.vertexAttributes){const je=Je[xe];je&&je.values?(null!=je.valueType&&"UInt32"!==je.valueType&&(j.warn(`Unsupported indexed geometry indices type '${je.valueType}', only UInt32 is currently supported`),Ie=!1),null!=je.valuesPerElement&&1!==je.valuesPerElement&&(j.warn(`Unsupported indexed geometry values per element '${je.valuesPerElement}', only 1 is currently supported`),Ie=!1)):(j.warn(`Indexed geometry does not specify face indices for '${xe}' attribute`),Ie=!1)}}else j.warn("Indexed geometries must specify faces"),Ie=!1;break}default:j.warn(`Unsupported topology '${Ce}'`),Ie=!1}Te.params.material||(j.warn("Geometry requires material"),Ie=!1);const Ge=Te.params.vertexAttributes;for(const Je in Ge)Ge[Je].values||(j.warn("Geometries with externally defined attributes are not yet supported"),Ie=!1);return Ie}function _e(Te,me){const Ce=[],Ie=[],Ge=[],Je=[],xe=Te.resource,je=W.G.parse(xe.version||"1.0","wosr");Ee.validate(je);const We=xe.model.name,Ne=xe.model.geometries,we=xe.materialDefinitions,Oe=Te.textures;let $e=0;const Be=new Map;for(let Se=0;Se<Ne.length;Se++){const De=Ne[Se];if(!de(De))continue;const Fe=Me(De),ve=De.params.vertexAttributes,Ke=[];for(const ke in ve){const ot=ve[ke];Ke.push([ke,{data:ot.values,size:ot.valuesPerElement,exclusive:!0}])}const qe=[];if("PerAttributeArray"!==De.params.topology){const ke=De.params.faces;for(const ot in ke)qe.push([ot,new Uint32Array(ke[ot].values)])}const be=Oe&&Oe[Fe.texture];if(be&&!Be.has(Fe.texture)){const{image:ke,params:ot}=be,at=new oe.x(ke,ot);Je.push(at),Be.set(Fe.texture,at)}const tt=Be.get(Fe.texture),Ye=tt?tt.id:void 0;let ze=Ge[Fe.material]?Ge[Fe.material][Fe.texture]:null;if(!ze){const ke=we[Fe.material.substring(Fe.material.lastIndexOf("/")+1)].params;1===ke.transparency&&(ke.transparency=0);const ot=be&&be.alphaChannelUsage,at=ke.transparency>0||"transparency"===ot||"maskAndTransparency"===ot,yt=be?ye(be.alphaChannelUsage):void 0,wt={ambient:(0,B.d)(ke.diffuse),diffuse:(0,B.d)(ke.diffuse),opacity:1-(ke.transparency||0),transparent:at,textureAlphaMode:yt,textureAlphaCutoff:.33,textureId:Ye,initTextureTransparent:!0,doubleSided:!0,cullFace:ue.Vr.None,colorMixMode:ke.externalColorMixMode||"tint",textureAlphaPremultiplied:!!be&&!!be.params.preMultiplyAlpha};(0,re.pC)(me)&&me.materialParamsMixin&&Object.assign(wt,me.materialParamsMixin),ze=new le.Gp(wt),Ge[Fe.material]||(Ge[Fe.material]={}),Ge[Fe.material][Fe.texture]=ze}Ie.push(ze);const et=new ce.Z(Ke,qe);$e+=qe.position?qe.position.length:0,Ce.push(et)}return{name:We,stageResources:{textures:Je,materials:Ie,geometries:Ce},pivotOffset:xe.model.pivotOffset,boundingBox:pe(Ce),numberOfVertices:$e,lodThreshold:null}}function pe(Te){const me=(0,Z.cS)();return Te.forEach(Ce=>{const Ie=Ce.boundingInfo;(0,re.pC)(Ie)&&((0,Z.pp)(me,Ie.getBBMin()),(0,Z.pp)(me,Ie.getBBMax()))}),me}function he(Te,me){return ge.apply(this,arguments)}function ge(){return(ge=(0,x.Z)(function*(Te,me){const Ce=[];for(const Je in Te){const xe=Te[Je],je=xe.images[0].data;if(!je){j.warn("Externally referenced texture data is not yet supported");continue}const We=xe.encoding+";base64,"+je,Ne="/textureDefinitions/"+Je,we="rgba"===xe.channels?xe.alphaChannelUsage||"transparency":"none",Oe={noUnpackFlip:!0,wrap:{s:Y.e8.REPEAT,t:Y.e8.REPEAT},preMultiplyAlpha:ye(we)!==ue.JJ.Opaque},$e=(0,re.pC)(me)&&me.disableTextures?Promise.resolve(null):(0,ie.t)(We,me);Ce.push($e.then(Be=>({refId:Ne,image:Be,params:Oe,alphaChannelUsage:we})))}const Ie=yield Promise.all(Ce),Ge={};for(const Je of Ie)Ge[Je.refId]=Je;return Ge})).apply(this,arguments)}function ye(Te){switch(Te){case"mask":return ue.JJ.Mask;case"maskAndTransparency":return ue.JJ.MaskBlend;case"none":return ue.JJ.Opaque;default:return ue.JJ.Blend}}function Me(Te){const me=Te.params;return{id:1,material:me.material,texture:me.texture,region:me.texture}}const Ee=new W.G(1,2,"wosr")},92852:(dt,Re,T)=>{"use strict";T.d(Re,{Es:()=>Y,I_:()=>Z,W7:()=>le,qM:()=>ee});var x=T(26584),A=T(58817),G=T(63290),Q=T(61566),H=T(16396);const re=G.Z.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function J(de,_e,pe){let he="",ge=0;for(;ge<pe;){const ye=de[_e+ge];if(ye<128)he+=String.fromCharCode(ye),ge++;else if(ye>=192&&ye<224){if(ge+1>=pe)throw new x.Z("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");he+=String.fromCharCode((31&ye)<<6|63&de[_e+ge+1]),ge+=2}else if(ye>=224&&ye<240){if(ge+2>=pe)throw new x.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");he+=String.fromCharCode((15&ye)<<12|(63&de[_e+ge+1])<<6|63&de[_e+ge+2]),ge+=3}else{if(!(ye>=240&&ye<248))throw new x.Z("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(ge+3>=pe)throw new x.Z("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const Me=(7&ye)<<18|(63&de[_e+ge+1])<<12|(63&de[_e+ge+2])<<6|63&de[_e+ge+3];he+=Me>=65536?String.fromCharCode(55296+(Me-65536>>10),56320+(1023&Me)):String.fromCharCode(Me),ge+=4}}}return he}function W(de,_e){const pe={byteOffset:0,byteCount:0,fields:Object.create(null)};let he=0;for(let ge=0;ge<_e.length;ge++){const ye=_e[ge],Me=ye.valueType||ye.type;pe.fields[ye.property]=(0,ne[Me])(de,he),he+=$[Me].BYTES_PER_ELEMENT}return pe.byteCount=he,pe}function Z(de,_e){return new $[_e.valueType](de,_e.byteOffset,_e.count*_e.valuesPerElement)}function ce(de,_e,pe){if(_e!==de&&re.error(`Invalid ${pe} buffer size\n expected: ${de}, actual: ${_e})`),_e<de)throw new x.Z("buffer-too-small","Binary buffer is too small",{expectedSize:de,actualSize:_e})}function le(de,_e){const pe=W(de,_e&&_e.header);let he=pe.byteCount;const ge={isDraco:!1,header:pe,byteOffset:pe.byteCount,byteCount:0,vertexAttributes:{}},ye=pe.fields,Me=null!=ye.vertexCount?ye.vertexCount:ye.count;for(const me of _e.ordering){if(!_e.vertexAttributes[me])continue;const Ce=yi(or({},_e.vertexAttributes[me]),{byteOffset:he,count:Me});ge.vertexAttributes[U[me]?U[me]:"_"+me]=Ce,he+=ae(Ce.valueType)*Ce.valuesPerElement*Me}const Ee=ye.faceCount;if(_e.faces&&Ee){ge.faces={};for(const me of _e.ordering){if(!_e.faces[me])continue;const Ce=yi(or({},_e.faces[me]),{byteOffset:he,count:Ee});ge.faces[me]=Ce,he+=ae(Ce.valueType)*Ce.valuesPerElement*Ee}}const Te=ye.featureCount;if(_e.featureAttributes&&_e.featureAttributeOrder&&Te){ge.featureAttributes={};for(const me of _e.featureAttributeOrder){if(!_e.featureAttributes[me])continue;const Ce=yi(or({},_e.featureAttributes[me]),{byteOffset:he,count:Te});ge.featureAttributes[me]=Ce,he+=("UInt64"===Ce.valueType?8:ae(Ce.valueType))*Ce.valuesPerElement*Te}}return ce(he,de.byteLength,"geometry"),ge.byteCount=he-ge.byteOffset,ge}function Y(de,_e){return de&&de.compressedAttributes&&"draco"===de.compressedAttributes.encoding?function X(de){const _e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const pe of de)switch(pe){case"position":break;case"normal":_e.normal=!0;break;case"uv0":_e.uv0=!0;break;case"color":_e.color=!0;break;case"uv-region":_e.uvRegion=!0;break;case"feature-index":_e.featureIndex=!0}return _e}(de.compressedAttributes.attributes):de?function oe(de){return{isDraco:!1,isLegacy:!1,color:null!=de.color,normal:null!=de.normal,uv0:null!=de.uv0,uvRegion:null!=de.uvRegion,featureIndex:null!=de.faceRange&&null!=de.featureId}}(de):function j(de){const _e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const pe of de.ordering)if(de.vertexAttributes[pe])switch(pe){case"position":break;case"normal":_e.normal=!0;break;case"color":_e.color=!0;break;case"uv0":_e.uv0=!0;break;case"region":_e.uvRegion=!0}return de.featureAttributes&&de.featureAttributeOrder&&(_e.featureIndex=!0),_e}(_e)}const U={position:H.T.POSITION,normal:H.T.NORMAL,color:H.T.COLOR,uv0:H.T.UV0,region:H.T.UVREGION};function ee(de,_e,pe){if("lepcc-rgb"===de.encoding)return(0,Q.IT)(_e);if("lepcc-intensity"===de.encoding)return(0,Q.ti)(_e);if(null!=de.encoding&&""!==de.encoding)throw new x.Z("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");de["attributeByteCounts "]&&!de.attributeByteCounts&&(re.warn("Warning: Trailing space in 'attributeByteCounts '."),de.attributeByteCounts=de["attributeByteCounts "]),"ObjectIds"===de.ordering[0]&&de.hasOwnProperty("objectIds")&&(re.warn("Warning: Case error in objectIds"),de.ordering[0]="objectIds");const he=function ue(de,_e,pe){const he=null!=_e.header?W(de,_e.header):{byteOffset:0,byteCount:0,fields:{count:pe}},ge={header:he,byteOffset:he.byteCount,byteCount:0,entries:Object.create(null)};let ye=he.byteCount;for(let Me=0;Me<_e.ordering.length;Me++){const Ee=_e.ordering[Me],Te=(0,A.d9)(_e[Ee]);if(Te.count=he.fields.count,"String"===Te.valueType){if(Te.byteOffset=ye,Te.byteCount=he.fields[Ee+"ByteCount"],"UTF-8"!==Te.encoding)throw new x.Z("unsupported-encoding","Unsupported String encoding.",{encoding:Te.encoding})}else{if(!se(Te.valueType))throw new x.Z("unsupported-value-type","Unsupported binary valueType",{valueType:Te.valueType});{const me=ae(Te.valueType);ye+=ye%me!=0?me-ye%me:0,Te.byteOffset=ye,Te.byteCount=me*Te.valuesPerElement*Te.count}}ye+=Te.byteCount,ge.entries[Ee]=Te}return ge.byteCount=ye-ge.byteOffset,ge}(_e,de,pe);ce(he.byteOffset+he.byteCount,_e.byteLength,"attribute");const ge=he.entries.attributeValues||he.entries.objectIds;if(ge){if("String"===ge.valueType){const ye=he.entries.attributeByteCounts,Me=Z(_e,ye),Ee=function ie(de,_e){return new Uint8Array(de,_e.byteOffset,_e.byteCount)}(_e,ge);return function B(de,_e,pe){const he=[];let ge,ye,Me=0;for(ye=0;ye<de;ye+=1){if(ge=_e[ye],ge>0){if(he.push(J(pe,Me,ge-1)),0!==pe[Me+ge-1])throw new x.Z("string-array-error","Invalid string array: missing null termination.")}else he.push(null);Me+=ge}return he}(ye.count,Me,Ee)}return Z(_e,ge)}throw new x.Z("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const $={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},ne={Float32:(de,_e)=>new DataView(de,0).getFloat32(_e,!0),Float64:(de,_e)=>new DataView(de,0).getFloat64(_e,!0),UInt8:(de,_e)=>new DataView(de,0).getUint8(_e),Int8:(de,_e)=>new DataView(de,0).getInt8(_e),UInt16:(de,_e)=>new DataView(de,0).getUint16(_e,!0),Int16:(de,_e)=>new DataView(de,0).getInt16(_e,!0),UInt32:(de,_e)=>new DataView(de,0).getUint32(_e,!0),Int32:(de,_e)=>new DataView(de,0).getInt32(_e,!0)};function se(de){return $.hasOwnProperty(de)}function ae(de){return se(de)?$[de].BYTES_PER_ELEMENT:0}},5590:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>H,n:()=>W});var x=T(43703),A=T(28093),G=T(55915),Q=T(12080);function H(B,Z,ie,ue){const ce=W(B,Z,ie),oe=(0,x.c)();return(0,G.Bm)(ie,ce,oe,ue),oe}function W(B,Z,ie){const ue=(0,A.c)(),oe=2**(4*Math.ceil(Math.log(B[3])*Math.LOG2E/4)+1);if(ie.isGeographic){const j=oe/(0,Q.Iu)(ie).radius*180/Math.PI,X=Math.round(B[1]/j),U=Math.max(-90,Math.min(90,X*j)),ee=j/Math.cos((Math.abs(U)-j/2)/180*Math.PI),$=Math.round(B[0]/ee)*ee;ue[0]=$,ue[1]=U}else{const j=Math.round(B[0]/oe),X=Math.round(B[1]/oe);ue[0]=j*oe,ue[1]=X*oe}const Y=Math.round((B[2]+Z)/oe);return ue[2]=Y*oe,ue}},42964:(dt,Re,T)=>{"use strict";T.d(Re,{Cx:()=>Nt,HV:()=>Yr,Jf:()=>ze,Jx:()=>qe,OJ:()=>ke,T2:()=>tt,VL:()=>Ot,WD:()=>rr,X5:()=>Ee,Yb:()=>Ce,a7:()=>St,bf:()=>we,c$:()=>jr,cr:()=>je,e8:()=>Ne,ei:()=>Ye,gI:()=>ct,gn:()=>yt,hv:()=>me,ix:()=>Cr,jv:()=>Lr,ns:()=>Ge,p8:()=>at,pD:()=>xe,tS:()=>Te,tp:()=>be,uC:()=>Xt,vH:()=>lr,yS:()=>Rt,zW:()=>zt});var x=T(15861),A=T(84792),G=T(85931),Q=T(26584),H=T(8314),re=T(62208),J=T(10699),W=T(55713),B=T(30217),Z=T(550),ie=T(28347),ue=T(43703),ce=T(48977),oe=T(56729),le=T(78451),Y=T(84161),j=T(28093),X=T(4794),U=T(55915),ee=T(12080),$=T(65234),ne=T(65401),se=T(37053),ae=T(84952),de=T(59617),_e=T(92852),pe=T(5590),he=T(2180),ge=T(9044),ye=T(93394);function Me(Ar){return Ar&&parseInt(Ar.substring(Ar.lastIndexOf("/")+1,Ar.length),10)}function Ee(Ar){var ni;if((0,H.Z)("disable-feature:i3s-draco")||!Ar)return!1;for(const _i of Ar)for(const Ii of _i.geometryBuffers)if("draco"===(null==(ni=Ii.compressedAttributes)?void 0:ni.encoding))return!0;return!1}function Te(Ar,ni,_i,Ii,ji,Gi){const es=ni!==Ii;ji.traverse(_i,zr=>{let gs=zr.mbs;return es&&(gs=Je,(0,U.st)(zr.mbs,Ii,gs,ni)),je(Ar,gs)!==xe.OUTSIDE&&(Gi(zr),!0)})}function me(Ar,ni,_i){let Ii=0,ji=0;for(let Gi=0;Gi<ni.length&&Ii<Ar.length;Gi++)Ar[Ii]===ni[Gi]&&(_i(Gi)&&(Ar[ji]=Ar[Ii],ji++),Ii++);Ar.length=ji}function Ce(Ar,ni,_i){let Ii=0,ji=0;for(;Ii<_i.length;)(0,G.$A)(Ar,_i[Ii])>=0===ni&&(_i[ji]=_i[Ii],ji++),Ii++;_i.length=ji}const Ie=(0,ne.Ue)();function Ge(Ar,ni){if(0===ni.rotationScale[1]&&0===ni.rotationScale[2]&&0===ni.rotationScale[3]&&0===ni.rotationScale[5]&&0===ni.rotationScale[6]&&0===ni.rotationScale[7])return Ie[0]=(Ar[0]-ni.position[0])/ni.rotationScale[0],Ie[1]=(Ar[1]-ni.position[1])/ni.rotationScale[4],Ie[2]=(Ar[2]-ni.position[0])/ni.rotationScale[0],Ie[3]=(Ar[3]-ni.position[1])/ni.rotationScale[4],Ie}const Je=(0,X.c)();var xe,Ar;function je(Ar,ni){const _i=ni[0],Ii=ni[1],ji=ni[3],Gi=Ar[0]-_i,es=_i-Ar[2],zr=Ar[1]-Ii,gs=Ii-Ar[3],hi=Math.max(Gi,es,0),ln=Math.max(zr,gs,0),ds=hi*hi+ln*ln;return ds>ji*ji?xe.OUTSIDE:ds>0?xe.INTERSECTS_CENTER_OUTSIDE:-Math.max(Gi,es,zr,gs)>ji?xe.INSIDE:xe.INTERSECTS_CENTER_INSIDE}function Ne(Ar,ni,_i){const Ii=[],ji=_i&&_i.missingFields,Gi=_i&&_i.originalFields;for(const es of Ar){const zr=es.toLowerCase();let gs=!1;for(const hi of ni)if(zr===hi.name.toLowerCase()){Ii.push(hi.name),gs=!0,Gi&&Gi.push(es);break}!gs&&ji&&ji.push(es)}return Ii}function we(Ar,ni,_i,Ii,ji){return Oe.apply(this,arguments)}function Oe(){return(Oe=(0,x.Z)(function*(Ar,ni,_i,Ii,ji){if(0===ni.length)return[];const Gi=Ar.attributeStorageInfo;if((0,re.pC)(Ar.associatedLayer))try{return yield Be(Ar.associatedLayer,ni,_i,Ii)}catch(es){if(Ar.associatedLayer.loaded)throw es}if(Gi){const es=$e(ni,_i,ji);if((0,re.Wi)(es))throw new Q.Z("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const zr=Ar.parsedUrl.path,gs=yield Promise.all(es.map(hi=>Fe(zr,Gi,hi.node,hi.indices,Ii).then(ln=>{for(let ds=0;ds<hi.graphics.length;ds++){const Mt=hi.graphics[ds],Hr=ln[ds];if(Mt.attributes)for(const Ir in Mt.attributes)Ir in Hr||(Hr[Ir]=Mt.attributes[Ir]);Mt.attributes=Hr}return hi.graphics})));return(0,G.xH)(gs)}throw new Q.Z("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")})).apply(this,arguments)}function $e(Ar,ni,_i){const Ii=new Map,ji=[],Gi=_i();for(const es of Ar){const zr=es.attributes[ni];for(let gs=0;gs<Gi.length;gs++){const hi=Gi[gs],ln=hi.featureIds.indexOf(zr);if(ln>=0){let ds=Ii.get(hi.node);ds||(ds={node:hi.node,indices:[],graphics:[]},ji.push(ds),Ii.set(hi.node,ds)),ds.indices.push(ln),ds.graphics.push(es);for(let Mt=gs;Mt>0;Mt--)Gi[Mt]=Gi[Mt-1];Gi[0]=hi;break}}}return ji}function Be(Ar,ni,_i,Ii){return Se.apply(this,arguments)}function Se(){return(Se=(0,x.Z)(function*(Ar,ni,_i,Ii){ni.sort((gs,hi)=>gs.attributes[_i]-hi.attributes[_i]);const ji=ni.map(gs=>gs.attributes[_i]),Gi=[],es=Ne(Ii,Ar.fields,{originalFields:Gi}),zr=yield De(Ar,ji,es);for(let gs=0;gs<ni.length;gs++){const hi=ni[gs],ln=zr[gs],ds={};if(hi.attributes)for(const Mt in hi.attributes)ds[Mt]=hi.attributes[Mt];for(let Mt=0;Mt<Gi.length;Mt++)ds[Gi[Mt]]=ln[es[Mt]];hi.attributes=ds}return ni})).apply(this,arguments)}function De(Ar,ni,_i){const Ii=Ar.capabilities.query.maxRecordCount;if(null!=Ii&&ni.length>Ii){const Gi=(0,G.vr)(ni,Ii);return Promise.all(Gi.map(es=>De(Ar,es,_i))).then(G.xH)}const ji=new ae.Z({objectIds:ni,outFields:_i,orderByFields:[Ar.objectIdField]});return Ar.queryFeatures(ji).then(Gi=>{if(Gi&&Gi.features&&Gi.features.length===ni.length)return Gi.features.map(es=>es.attributes);throw new Q.Z("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function Fe(Ar,ni,_i,Ii,ji){const Gi=[];for(const es of ni)es&&ji.includes(es.name)&&Gi.push({url:`${Ar}/nodes/${_i.resources.attributes}/attributes/${es.key}/0`,storageInfo:es});return(0,J.as)(Gi.map(es=>(0,A.default)(es.url,{responseType:"array-buffer"}).then(zr=>(0,_e.qM)(es.storageInfo,zr.data)))).then(es=>{const zr=[];for(const gs of Ii){const hi={};for(let ln=0;ln<es.length;ln++)null!=es[ln].value&&(hi[Gi[ln].storageInfo.name]=qe(es[ln].value,gs));zr.push(hi)}return zr})}function qe(Ar,ni){if(!Ar)return null;const _i=Ar[ni];return(0,W.z3)(Ar)?-32768===_i?null:_i:(0,W.Hx)(Ar)?-2147483648===_i?null:_i:_i!=_i?null:_i}function be(Ar){const ni=Ar.store.indexCRS||Ar.store.geographicCRS,_i=void 0===ni?Ar.store.indexWKT:void 0;if(_i){if(!Ar.spatialReference)throw new Q.Z("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(_i!==Ar.spatialReference.wkt)throw new Q.Z("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const Ii=ni?new $.Z(Me(ni)):Ar.spatialReference;return Ii.equals(Ar.spatialReference)?Ar.spatialReference:Ii}function tt(Ar){const ni=Ar.store.vertexCRS||Ar.store.projectedCRS,_i=void 0===ni?Ar.store.vertexWKT:void 0;if(_i){if(!Ar.spatialReference)throw new Q.Z("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(_i!==Ar.spatialReference.wkt)throw new Q.Z("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const Ii=ni?new $.Z(Me(ni)):Ar.spatialReference;return Ii.equals(Ar.spatialReference)?Ar.spatialReference:Ii}function Ye(Ar,ni){return(0,re.Wi)(ni)?"@null":ni===(0,ee.rS)(ni)?"@ECEF":Ar.equals(ni)?"":null!=ni.wkid?"@"+ni.wkid:null}function ze(Ar,ni,_i){if(!(0,U.Up)(Ar,ni))throw new Q.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===_i&&!function et(Ar,ni){return Ar.equals(ni)||Ar.isWGS84&&ni.isWebMercator||Ar.isWebMercator&&ni.isWGS84}(Ar,ni))throw new Q.Z("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function ke(Ar,ni,_i){const Ii=be(Ar),ji=tt(Ar);ze(Ii,ni,_i),ze(ji,ni,_i)}function at(Ar){if(null==Ar.store||null==Ar.store.defaultGeometrySchema||!function ot(Ar){return!(null!=Ar.geometryType&&"triangles"!==Ar.geometryType||null!=Ar.topology&&"PerAttributeArray"!==Ar.topology||null==Ar.vertexAttributes||null==Ar.vertexAttributes.position)}(Ar.store.defaultGeometrySchema))throw new Q.Z("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:Ar.parsedUrl.path})}function yt(Ar,ni){ke(Ar,ni.spatialReference,ni.viewingMode)}function zt(Ar){if(null==Ar.store||null==Ar.store.defaultGeometrySchema||!function wt(Ar){return!(null==Ar.geometryType||"points"!==Ar.geometryType||null!=Ar.topology&&"PerAttributeArray"!==Ar.topology||null!=Ar.encoding&&""!==Ar.encoding&&"lepcc-xyz"!==Ar.encoding||null==Ar.vertexAttributes||null==Ar.vertexAttributes.position)}(Ar.store.defaultGeometrySchema))throw new Q.Z("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function Rt(Ar,ni){ze(Ar.spatialReference,ni.spatialReference,ni.viewingMode)}function bt(Ar){return"mesh-3d"===Ar.type}function St(Ar){if(null==Ar||!function Ft(Ar){return"simple"===Ar.type||"class-breaks"===Ar.type||"unique-value"===Ar.type}(Ar)||("unique-value"===Ar.type||"class-breaks"===Ar.type)&&null==Ar.defaultSymbol)return!0;const ni=Ar.getSymbols();if(0===ni.length)return!0;for(const _i of ni){if(!bt(_i)||0===_i.symbolLayers.length)return!0;for(const Ii of _i.symbolLayers.items)if("fill"!==Ii.type||(0,re.Wi)(Ii.material)||(0,re.Wi)(Ii.material.color)||"replace"!==Ii.material.colorMixMode)return!0}return!1}(Ar=xe||(xe={}))[Ar.OUTSIDE=0]="OUTSIDE",Ar[Ar.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",Ar[Ar.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",Ar[Ar.INSIDE=3]="INSIDE";const Xt=(0,he.$s)({color:[0,0,0,0],opacity:0});class Mr{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function Cr(Ar){const ni=new Mr;let _i=!1,Ii=!1;for(const ji of Ar.symbolLayers.items)if("fill"===ji.type&&ji.enabled){const Gi=ji.material,es=ji.edges;if((0,re.pC)(Gi)&&!_i){const zr=Gi.color,gs=(0,ge.F5)(Gi.colorMixMode);ni.material=(0,re.pC)(zr)?{color:[zr.r/255,zr.g/255,zr.b/255],alpha:zr.a,colorMixMode:gs}:{color:[1,1,1],alpha:1,colorMixMode:ge.a9.Multiply},ni.castShadows=ji.castShadows,_i=!0}(0,re.pC)(es)&&!Ii&&(ni.edgeMaterial=(0,he.C8)(es,{}),Ii=!0)}return ni.material||(ni.material={color:[1,1,1],alpha:1,colorMixMode:ge.a9.Multiply}),ni}function Yr(Ar,ni){return(0|Ar)+(0|ni)|0}function Lr(Ar,ni,_i,Ii,ji=0){Ii===(0,ee.rS)(Ii)?ni.isGeographic?function Kr(Ar,ni,_i,Ii){const ji=(0,ee.Iu)(_i),Gi=1+Math.max(0,Ii)/(ji.radius+Ar.center[2]);(0,Y.s)(ni.center,Ar.center[0],Ar.center[1],Ar.center[2]+Ii),(0,U.CM)(ni.center,_i,0,ni.center,(0,ee.rS)(_i),0,1),(0,ce.a)(ni.quaternion,Ar.quaternion),(0,ce.c)(Pr,Ar.quaternion),(0,Y.s)(Qr,0,0,1),(0,Y.q)(Qr,Qr,Pr),(0,Y.s)(Qr,Ar.halfSize[0]*Math.abs(Qr[0]),Ar.halfSize[1]*Math.abs(Qr[1]),Ar.halfSize[2]*Math.abs(Qr[2])),(0,Y.g)(Qr,Qr,ji.inverseFlattening),(0,Y.a)(ni.halfSize,Ar.halfSize,Qr),(0,Y.g)(ni.halfSize,ni.halfSize,Gi)}(Ar,_i,ni,ji):function Dr(Ar,ni,_i,Ii){(0,ye.$e)(Ar,Fr),(0,Y.s)(ni.center,Ar.center[0],Ar.center[1],Ar.center[2]+Ii),(0,U.Bm)(_i,ni.center,pr,(0,ee.rS)(_i)),(0,Y.s)(ni.center,pr[12],pr[13],pr[14]);const ji=2*Math.sqrt(1+pr[0]+pr[5]+pr[10]);Pr[0]=(pr[6]-pr[9])/ji,Pr[1]=(pr[8]-pr[2])/ji,Pr[2]=(pr[1]-pr[4])/ji,Pr[3]=.25*ji,(0,ce.m)(ni.quaternion,Pr,Ar.quaternion),(0,ce.c)(Pr,ni.quaternion);let Gi=0,es=0,zr=0;for(const gs of Fr)gs[2]+=Ii,(0,U.CM)(gs,_i,0,gs,(0,ee.rS)(_i),0,1),(0,Y.v)(Qr,gs,ni.center),(0,Y.q)(Qr,Qr,Pr),Gi=Math.max(Gi,Math.abs(Qr[0])),es=Math.max(es,Math.abs(Qr[1])),zr=Math.max(zr,Math.abs(Qr[2]));(0,Y.s)(ni.halfSize,Gi,es,zr)}(Ar,_i,ni,ji):ni.isWGS84&&(Ii.isWebMercator||(0,se.QM)(Ii))?function tr(Ar,ni,_i,Ii,ji){(0,Y.c)(Br,ni.center),Br[2]+=ji;const Gi=(0,ee.rS)(_i);(0,U.CM)(Br,Ar,0,Br,Gi,0,1),hr(Gi,ni,Br,_i,Ii)}(ni,Ar,Ii,_i,ji):ni.isWebMercator&&(0,se.QM)(Ii)?function ri(Ar,ni,_i,Ii,ji){(0,Y.c)(Br,ni.center),Br[2]+=ji,hr(Ar,ni,Br,_i,Ii)}(ni,Ar,Ii,_i,ji):Ar===_i?(_i.center[2]+=ji,(0,U.CM)(_i.center,ni,0,_i.center,Ii,0,1)):((0,Y.s)(_i.center,Ar.center[0],Ar.center[1],Ar.center[2]+ji),(0,U.CM)(_i.center,ni,0,_i.center,Ii,0,1),(0,ce.a)(_i.quaternion,Ar.quaternion),(0,Y.c)(_i.halfSize,Ar.halfSize))}function ct(Ar,ni,_i,Ii,ji){if((0,ce.a)(ji.quaternion,Ar.quaternion),Ii===de.JY.Global){(0,ce.c)(Zt,Ar.quaternion),(0,Y.q)(jt,Ar.center,Zt),(0,Y.A)(qt,jt),(0,Y.B)(er,qt,Ar.halfSize),(0,Y.v)(er,qt,er);const Gi=(0,Y.l)(er);(0,Y.a)(er,qt,Ar.halfSize);const es=(0,Y.l)(er);if(Gi<_i)(0,Y.c)(ji.center,Ar.center),(0,Y.s)(jt,_i,_i,_i),(0,Y.a)(ji.halfSize,Ar.halfSize,jt);else{const zr=es>0?1+ni/es:1,gs=Gi>0?1+_i/Gi:1,hi=(gs+zr)/2,ln=(gs-zr)/2;(0,Y.g)(ji.halfSize,qt,ln),(0,Y.C)(ji.halfSize,ji.halfSize,Ar.halfSize,hi),(0,Y.g)(ji.center,qt,hi),(0,Y.C)(ji.center,ji.center,Ar.halfSize,ln),(0,Y.D)(jt,jt),(0,Y.E)(ji.center,ji.center,jt),(0,Y.q)(ji.center,ji.center,ji.quaternion)}}else{const Gi=(0,Y.s)(jt,0,0,1);(0,Y.C)(ji.center,Ar.center,Gi,(_i+ni)/2),(0,ce.c)(Zt,Ar.quaternion),(0,Y.q)(Gi,Gi,Zt),(0,Y.A)(Gi,Gi),(0,Y.C)(ji.halfSize,Ar.halfSize,Gi,(_i-ni)/2)}return ji}const jt=(0,j.c)(),qt=(0,j.c)(),er=(0,j.c)(),Zt=(0,le.a)(),ir=new Float64Array(24),fr={data:ir,size:3},Ur=(0,j.c)(),Br=(0,j.c)(),Zr=(0,Z.c)();function hr(Ar,ni,_i,Ii,ji){const Gi=(0,B.g)(Zr,ni.quaternion);for(let es=0;es<8;++es){for(let zr=0;zr<3;++zr)Ur[zr]=ni.halfSize[zr]*(0!=(es&1<<zr)?-1:1);for(let zr=0;zr<3;++zr){let gs=_i[zr];for(let hi=0;hi<3;++hi)gs+=Ur[hi]*Gi[3*hi+zr];ir[3*es+zr]=gs}}(0,U.CM)(ir,Ar,0,ir,Ii,0,8),(0,ye.Qb)(fr,ji)}function Nt(Ar,ni,_i,Ii,ji,Gi){if(!Gi||0===Gi.length||(0,re.Wi)(ni))return null;const es=(0,pe.c)(Ar.mbs,ji,_i,ni);let zr;(0,ie.a)(Hs,es);let hi=1/0,ln=-1/0;if(Gi.forEach(Hr=>(Hr=>{if("replace"!==Hr.type)return;const Ir=Hr.geometry;if(!Ir.hasZ)return;(0,ne.cS)(ii);const gi=Ir.spatialReference||Ii,Ui=Ir.rings.reduce((is,ss)=>ss.reduce((ts,ys)=>((0,U.SH)(ys,gi,Qr,ni),(0,Y.m)(Qr,Qr,Hs),(0,ne.Ho)(ii,Qr),Math.min(Qr[2],ts)),is),1/0);(()=>{if(!zr)if(zr=Fr,(0,ne.cS)(mi),(0,re.pC)(Ar.serviceObb)){Lr(Ar.serviceObb,_i,wi,ni,ji),(0,ye.$e)(wi,zr);for(const Hr of zr)(0,Y.m)(Hr,Hr,Hs),(0,ne.Ho)(mi,Hr)}else{const Hr=Ar.mbs,Ir=Hr[3];(0,U.SH)(Hr,_i,Qr,ni),(0,Y.m)(Qr,Qr,Hs),Qr[2]+=ji;for(let gi=0;gi<8;++gi){const ts=zr[gi];(0,Y.c)(ts,[Qr[0]+(1&gi?Ir:-Ir),Qr[1]+(2&gi?Ir:-Ir),Qr[2]+(4&gi?Ir:-Ir)]),(0,ne.Ho)(mi,ts)}}})(),(0,ne.kK)(mi,ii)&&(hi=Math.min(hi,Ui),ln=Math.max(ln,Ui))})(Hr)),hi===1/0)return null;const Mt=(Hr,Ir,gi)=>{(0,Y.m)(Qr,gi,es),Hr[Ir+0]=Qr[0],Hr[Ir+1]=Qr[1],Hr[Ir+2]=Qr[2],Ir+=24,gi[2]=hi,(0,Y.m)(Qr,gi,es),Hr[Ir+0]=Qr[0],Hr[Ir+1]=Qr[1],Hr[Ir+2]=Qr[2],Ir+=24,gi[2]=ln,(0,Y.m)(Qr,gi,es),Hr[Ir+0]=Qr[0],Hr[Ir+1]=Qr[1],Hr[Ir+2]=Qr[2]};for(let Hr=0;Hr<8;++Hr)Mt(Ni.data,3*Hr,zr[Hr]);return(0,ye.Qb)(Ni)}function lr(Ar){return(0,re.pC)(Ar)&&Ar.halfSize[0]>=0}function jr(Ar){return Ar[3]>=0}function Ot(Ar){(0,re.pC)(Ar)&&(Ar.halfSize[0]=-1)}function rr(Ar){(0,re.pC)(Ar)&&(Ar[3]=-1)}const pr=(0,ue.c)(),Pr=(0,oe.c)(),Fr=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],ii=(0,ne.Ue)(),mi=(0,ne.Ue)(),wi=(0,ye.Ue)(),Qr=[0,0,0],Ni={data:new Array(72),size:3},Hs=(0,ue.c)()},77926:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>Q,a:()=>G});var x=T(67857),A=T(91480);function G(H){return(0,A.nn)(H)&&H.intersector===x.q7.PCL&&!!H.target}function Q(H){return(0,A.nn)(H)&&H.intersector===x.q7.I3S&&!!H.target}},61566:(dt,Re,T)=>{"use strict";T.d(Re,{Gi:()=>J,IT:()=>ue,ti:()=>le});var x=T(26584);const A=!0;function Q(Y,j,X){return{identifier:String.fromCharCode.apply(null,new Uint8Array(Y,X+0,10)),version:j.getUint16(X+10,A),checksum:j.getUint32(X+12,A)}}function J(Y){const j=new DataView(Y,0);let X=0;const{identifier:U,version:ee}=Q(Y,j,X);if(X+=16,"LEPCC     "!==U)throw new x.Z("lepcc-decode-error","Bad identifier");if(ee>1)throw new x.Z("lepcc-decode-error","Unknown version");const $=function re(Y,j){return{sizeLo:Y.getUint32(j+0,A),sizeHi:Y.getUint32(j+4,A),minX:Y.getFloat64(j+8,A),minY:Y.getFloat64(j+16,A),minZ:Y.getFloat64(j+24,A),maxX:Y.getFloat64(j+32,A),maxY:Y.getFloat64(j+40,A),maxZ:Y.getFloat64(j+48,A),errorX:Y.getFloat64(j+56,A),errorY:Y.getFloat64(j+64,A),errorZ:Y.getFloat64(j+72,A),count:Y.getUint32(j+80,A),reserved:Y.getUint32(j+84,A)}}(j,X);if(X+=88,$.sizeHi*2**32+$.sizeLo!==Y.byteLength)throw new x.Z("lepcc-decode-error","Bad size");const ne=new Float64Array(3*$.count),se=[],ae=[],de=[],_e=[];if(X=W(Y,X,se),X=W(Y,X,ae),X=W(Y,X,de),X=W(Y,X,_e),X!==Y.byteLength)throw new x.Z("lepcc-decode-error","Bad length");let pe=0,he=0;for(let ge=0;ge<se.length;ge++){he+=se[ge];let ye=0;for(let Me=0;Me<ae[ge];Me++){ye+=de[pe];const Ee=_e[pe];ne[3*pe]=Math.min($.maxX,$.minX+2*$.errorX*ye),ne[3*pe+1]=Math.min($.maxY,$.minY+2*$.errorY*he),ne[3*pe+2]=Math.min($.maxZ,$.minZ+2*$.errorZ*Ee),pe++}}return{errorX:$.errorX,errorY:$.errorY,errorZ:$.errorZ,result:ne}}function W(Y,j,X){const U=[];j=B(Y,j,U);const ee=[];for(let $=0;$<U.length;$++){ee.length=0,j=B(Y,j,ee);for(let ne=0;ne<ee.length;ne++)X.push(ee[ne]+U[$])}return j}function B(Y,j,X){const U=new DataView(Y,j),ee=U.getUint8(0),$=31&ee,ne=!!(32&ee),se=(192&ee)>>6;let ae=0;if(0===se)ae=U.getUint32(1,A),j+=5;else if(1===se)ae=U.getUint16(1,A),j+=3;else{if(2!==se)throw new x.Z("lepcc-decode-error","Bad count type");ae=U.getUint8(1),j+=2}if(ne)throw new x.Z("lepcc-decode-error","LUT not implemented");const de=Math.ceil(ae*$/8),_e=new Uint8Array(Y,j,de);let pe=0,he=0,ge=0;const ye=-1>>>32-$;for(let Me=0;Me<ae;Me++){for(;he<$;)pe|=_e[ge]<<he,he+=8,ge+=1;X[Me]=pe&ye,pe>>>=$,he-=$,he+$>32&&(pe|=_e[ge-1]>>8-he)}return j+ge}function ue(Y){const j=new DataView(Y,0);let X=0;const{identifier:U,version:ee}=Q(Y,j,X);if(X+=16,"ClusterRGB"!==U)throw new x.Z("lepcc-decode-error","Bad identifier");if(ee>1)throw new x.Z("lepcc-decode-error","Unknown version");const $=function ie(Y,j){return{sizeLo:Y.getUint32(j+0,A),sizeHi:Y.getUint32(j+4,A),count:Y.getUint32(j+8,A),colorMapCount:Y.getUint16(j+12,A),lookupMethod:Y.getUint8(j+14),compressionMethod:Y.getUint8(j+15)}}(j,X);if(X+=16,$.sizeHi*2**32+$.sizeLo!==Y.byteLength)throw new x.Z("lepcc-decode-error","Bad size");if((2===$.lookupMethod||1===$.lookupMethod)&&0===$.compressionMethod){if(3*$.colorMapCount+$.count+X!==Y.byteLength||$.colorMapCount>256)throw new x.Z("lepcc-decode-error","Bad count");const ne=new Uint8Array(Y,X,3*$.colorMapCount),se=new Uint8Array(Y,X+3*$.colorMapCount,$.count),ae=new Uint8Array(3*$.count);for(let de=0;de<$.count;de++){const _e=se[de];ae[3*de]=ne[3*_e],ae[3*de+1]=ne[3*_e+1],ae[3*de+2]=ne[3*_e+2]}return ae}if(0===$.lookupMethod&&0===$.compressionMethod){if(3*$.count+X!==Y.byteLength||0!==$.colorMapCount)throw new x.Z("lepcc-decode-error","Bad count");return new Uint8Array(Y,X).slice()}if($.lookupMethod<=2&&1===$.compressionMethod){if(X+3!==Y.byteLength||1!==$.colorMapCount)throw new x.Z("lepcc-decode-error","Bad count");const ne=j.getUint8(X),se=j.getUint8(X+1),ae=j.getUint8(X+2),de=new Uint8Array(3*$.count);for(let _e=0;_e<$.count;_e++)de[3*_e]=ne,de[3*_e+1]=se,de[3*_e+2]=ae;return de}throw new x.Z("lepcc-decode-error","Bad method "+$.lookupMethod+","+$.compressionMethod)}function le(Y){const j=new DataView(Y,0);let X=0;const{identifier:U,version:ee}=Q(Y,j,X);if(X+=16,"Intensity "!==U)throw new x.Z("lepcc-decode-error","Bad identifier");if(ee>1)throw new x.Z("lepcc-decode-error","Unknown version");const $=function oe(Y,j){return{sizeLo:Y.getUint32(j+0,A),sizeHi:Y.getUint32(j+4,A),count:Y.getUint32(j+8,A),scaleFactor:Y.getUint16(j+12,A),bitsPerPoint:Y.getUint8(j+14),reserved:Y.getUint8(j+15)}}(j,X);if(X+=16,$.sizeHi*2**32+$.sizeLo!==Y.byteLength)throw new x.Z("lepcc-decode-error","Bad size");const ne=new Uint16Array($.count);if(8===$.bitsPerPoint){if($.count+X!==Y.byteLength)throw new x.Z("lepcc-decode-error","Bad size");const se=new Uint8Array(Y,X,$.count);for(let ae=0;ae<$.count;ae++)ne[ae]=se[ae]*$.scaleFactor}else if(16===$.bitsPerPoint){if(2*$.count+X!==Y.byteLength)throw new x.Z("lepcc-decode-error","Bad size");const se=new Uint16Array(Y,X,$.count);for(let ae=0;ae<$.count;ae++)ne[ae]=se[ae]*$.scaleFactor}else{const se=[];if(B(Y,X,se)!==Y.byteLength)throw new x.Z("lepcc-decode-error","Bad size");for(let ae=0;ae<$.count;ae++)ne[ae]=se[ae]*$.scaleFactor}return ne}},62600:(dt,Re,T)=>{"use strict";var x,A,G;T.d(Re,{L:()=>x,a:()=>A}),(G=x||(x={}))[G.RasterImage=0]="RasterImage",G[G.Features=1]="Features",function(G){G[G.WithRasterImage=0]="WithRasterImage",G[G.WithoutRasterImage=1]="WithoutRasterImage"}(A||(A={}))},27351:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>A,E:()=>G});var G,Q,x=T(65401);class A{constructor(H,re,J,W=null){this.lij=[0,0,0],this.extent=(0,x.Ue)(),this.resolution=0,this.loadPriority=0,this.measures={visibility:G.VISIBLE_ON_SURFACE,screenRect:(0,x.Ue)(),distance:0,shouldSplit:!1},this.used=!1,W&&this.acquire(H,re,J,W)}acquire(H,re,J,W){this.tilingScheme=W,this.id=A.id(H,re,J),this.lij[0]=H,this.lij[1]=re,this.lij[2]=J,W.getExtent(H,re,J,this.extent),this.resolution=W.resolutionAtLevel(H)}release(){this.tilingScheme=null}getChildren(H){const re=this.lij[0]+1,J=2*this.lij[1],W=2*this.lij[2];return H?(H[0].acquire(re,J,W,this.tilingScheme),H[1].acquire(re,J+1,W,this.tilingScheme),H[2].acquire(re,J,W+1,this.tilingScheme),H[3].acquire(re,J+1,W+1,this.tilingScheme),H):[new A(re,J,W,this.tilingScheme),new A(re,J+1,W,this.tilingScheme),new A(re,J,W+1,this.tilingScheme),new A(re,J+1,W+1,this.tilingScheme)]}copyMeasurementsFrom(H){this.measures.visibility=H.measures.visibility,this.measures.shouldSplit=H.measures.shouldSplit,this.measures.distance=H.measures.distance,(0,x.JG)(H.measures.screenRect,this.measures.screenRect)}static id(H,re,J){return`${H}/${re}/${J}`}}(Q=G||(G={}))[Q.INVISIBLE=0]="INVISIBLE",Q[Q.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",Q[Q.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"},2180:(dt,Re,T)=>{"use strict";T.d(Re,{hM:()=>ie,C8:()=>ue,$s:()=>ce,eU:()=>B});var x=T(91558),G=(T(8314),T(62208)),Q=T(23841),H=T(4794),W=T(17803);function B(j){return j&&j.enabled&&(function J(j){return"extrude"===j.type}(j)||function re(j){return"fill"===j.type}(j))&&(0,G.pC)(j.edges)}function ie(j,X){return ue(function Z(j){return j&&j.enabled&&j.edges||null}(j),X)}function ue(j,X){if((0,G.Wi)(j))return null;const U=(0,G.pC)(j.color)?(0,H.b)(x.Z.toUnitRGBA(j.color)):(0,H.f)(0,0,0,0),ee=(0,Q.F2)(j.size),$=(0,Q.F2)(j.extensionLength);switch(j.type){case"solid":return ce(or({color:U,size:ee,extensionLength:$},X));case"sketch":return function oe(j){return yi(or(or({},Y),j),{type:"sketch"})}(or({color:U,size:ee,extensionLength:$},X));default:return}}function ce(j){return yi(or(or({},le),j),{type:"solid"})}const le={color:(0,H.f)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:W.i.OPAQUE,hasSlicePlane:!1},Y={color:(0,H.f)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:W.i.OPAQUE,hasSlicePlane:!1}},30764:(dt,Re,T)=>{"use strict";T.d(Re,{CM:()=>H,uM:()=>re,vT:()=>G});var x=T(62208),A=T(10596);const G=64,Q=G/2,H=Q/5;function re(B,Z){return(0,x.pC)(Z)?function J(B,Z){return B.fromData(Z,()=>(0,A.cU)(Z,G,Q,H))}(B,function W(B){return"diamond"===B?"kite":B}(Z.style)):null}},9044:(dt,Re,T)=>{"use strict";T.d(Re,{F5:()=>Q,HB:()=>H,a9:()=>G});var G,Z,x=T(21286),A=T(62208);function Q(Z){switch(Z){case"multiply":default:return G.Multiply;case"ignore":return G.Ignore;case"replace":return G.Replace;case"tint":return G.Tint}}function H(Z,ie,ue){if((0,A.Wi)(Z)||ie===G.Ignore)return ue[0]=255,ue[1]=255,ue[2]=255,void(ue[3]=255);const ce=(0,x.uZ)(Math.round(Z[3]*J),0,J),oe=0===ce||ie===G.Tint?0:ie===G.Replace?W:B;ue[0]=(0,x.uZ)(Math.round(Z[0]*re),0,re),ue[1]=(0,x.uZ)(Math.round(Z[1]*re),0,re),ue[2]=(0,x.uZ)(Math.round(Z[2]*re),0,re),ue[3]=ce+oe}(Z=G||(G={}))[Z.Multiply=1]="Multiply",Z[Z.Ignore=2]="Ignore",Z[Z.Replace=3]="Replace",Z[Z.Tint=4]="Tint";const re=255,J=85,W=J,B=2*J},24805:(dt,Re,T)=>{"use strict";T.d(Re,{i:()=>Q});var x=T(84161),A=T(28093),G=T(8834);class Q{constructor(J){this.renderCoordsHelper=J,this.frustum=(0,G.Ue)(),this._points=(0,G.Hf)(),this.lines=new Array(12),this._origin=(0,A.c)(),this._direction=(0,A.c)(),this._altitude=null;for(let W=0;W<12;W++)this.lines[W]={origin:null,direction:(0,A.c)(),endpoint:null}}get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}update(J){(0,G.q_)(J.viewMatrix,J.projectionMatrix,this.frustum,this._points),(0,x.c)(this._origin,J.eye),(0,x.c)(this._direction,J.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(J){for(let W=0;W<this._points.length;W++)(0,x.c)(this._points[W],J[W]);(0,G.Jp)(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(J){return(0,G.hr)(this.frustum,J)}intersectsRay(J){return(0,G.Zr)(this.frustum,J)}intersectsLineSegment(J,W){return(0,G.rN)(this.frustum,J,W)}intersectsPoint(J){return(0,G.g8)(this.frustum,J)}_updateLines(){const J=this._points;for(let W=0;W<4;W++){const B=W+4;H(this.lines[W],J[W],J[B]),H(this.lines[W+4],J[W],3===W?J[0]:J[W+1]),H(this.lines[W+8],J[B],3===W?J[4]:J[B+1])}}}function H(re,J,W){re.origin=J,re.endpoint=W,(0,x.r)(re.direction,J,W)}Q.planePointIndices=G.xu,Q.nearFarLineIndices=[[G.NQ.NEAR_BOTTOM_LEFT,G.NQ.FAR_BOTTOM_LEFT],[G.NQ.NEAR_BOTTOM_RIGHT,G.NQ.FAR_BOTTOM_RIGHT],[G.NQ.NEAR_TOP_RIGHT,G.NQ.FAR_TOP_RIGHT],[G.NQ.NEAR_TOP_LEFT,G.NQ.FAR_TOP_LEFT]]},53929:(dt,Re,T)=>{"use strict";T.d(Re,{Fb:()=>Q,KO:()=>H,sb:()=>G});var x=T(62208),A=T(88530);class G{constructor(J,W=null,B=0){this.array=J,this.spatialReference=W,this.offset=B}}function Q(re){return"array"in re}function H(re,J,W="ground"){if((0,A.f)(J))return re.getElevation(J.x,J.y,J.z||0,J.spatialReference,W);if(Q(J)){let B=J.offset;return re.getElevation(J.array[B++],J.array[B++],J.array[B]||0,(0,x.Pt)(J.spatialReference,re.spatialReference),W)}return re.getElevation(J[0],J[1],J[2]||0,re.spatialReference,W)}},37810:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>U});var x=T(94573),A=T(21286),G=T(28347),Q=T(43703),H=T(84161),re=T(28093),J=T(55915),W=T(12080),B=T(5548),Z=T(65401),ie=T(8834),ue=T(13777),ce=T(90014),oe=T(70562),le=T(59617),Y=T(24229);const j=.5*Math.PI,X=j/Math.PI*180;class U{constructor(he){this.renderCoordsHelper=he.renderCoordsHelper,this.extent=new Array(4),this.planes=new Array(6),this.maxSpan=0,this.center={origin:(0,re.c)(),direction:(0,re.c)()};for(let ge=0;ge<4;ge++)this.extent[ge]={origin:(0,re.c)(),direction:(0,re.c)(),cap:{next:null,direction:(0,re.c)()}},this.planes[ge]=(0,ce.Ue)();this.planes[ie.Nu.NEAR]=(0,ce.Ue)(),this.planes[ie.Nu.FAR]=(0,ce.Ue)(),this.planesWithoutFar=this.planes.slice(0,5)}update(he,ge,ye,Me=!0){const Ee=this.extent;this._toRenderBoundingExtent(he,ge,ye),(0,H.a)(this.center.origin,Ee[0].origin,Ee[2].origin),(0,H.g)(this.center.origin,this.center.origin,.5),this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction),Me||(0,H.g)(this.center.direction,this.center.direction,-1);for(let Te=0;Te<4;Te++){const me=Ee[Te];this.renderCoordsHelper.worldUpAtPosition(me.origin,me.direction);const Ce=Ee[3===Te?0:Te+1];me.cap.next=Ce.origin,(0,H.r)(me.cap.direction,me.origin,Ce.origin),(0,ce.my)(me.direction,me.cap.direction,me.origin,this.planes[Te]),Me||(0,H.g)(me.direction,me.direction,-1)}(0,ce.my)(Ee[0].cap.direction,Ee[1].cap.direction,Ee[0].origin,this.planes[ie.Nu.NEAR]),Me?(0,ce.tk)(this.planes[ie.Nu.NEAR],this.planes[ie.Nu.FAR]):((0,ce.JG)(this.planes[ie.Nu.FAR],this.planes[ie.Nu.NEAR]),(0,ce.tk)(this.planes[ie.Nu.NEAR],this.planes[ie.Nu.NEAR])),this.maxSpan=Math.max(Math.abs(he[0]-he[2]),Math.abs(he[1]-he[3])),this.maxSpanSpatialReference=ge,this.minGlobalAltitude=.9*(0,W.Iu)(this.maxSpanSpatialReference).radius}isVisibleInFrustum(he,ge,ye=!1){if(null==he)return!1;if(this.renderCoordsHelper.viewingMode===le.JY.Global){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?X:j*ge))return!0;if(he.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(he)}if(0===this.maxSpan){const Ee=this.extent[0];return!(ye||!he.intersectsRay((0,oe.re)(Ee.origin,Ee.direction)))}for(let Ee=0;Ee<this.extent.length;Ee++){const Te=this.extent[Ee];if(!ye&&he.intersectsRay((0,oe.re)(Te.origin,Te.direction))||he.intersectsLineSegment((0,ue.zk)(Te.origin,Te.cap.next,_e),Te.cap.direction))return!0}const Me=ye?this.planes:this.planesWithoutFar;for(let Ee=0;Ee<he.lines.length;Ee++){const Te=he.lines[Ee];if((0,Y.kD)(Me,Te.origin,Te.endpoint,Te.direction))return!0}return!1}_toRenderBoundingExtentGlobal(he,ge,ye){(0,Z.be)(he,$),$[2]=ye,(0,J.Bm)(ge,$,ne,this.renderCoordsHelper.spatialReference),(0,G.a)(se,ne),(0,B.cS)(ae);for(const{x0:Ee,x1:Te,y0:me,y1:Ce}of ee)for(let Ie=0;Ie<5;Ie++){const Ge=Ie/4;$[0]=(0,A.t7)(he[Ee],he[Te],Ge),$[1]=(0,A.t7)(he[me],he[Ce],Ge),$[2]=ye,(0,J.SH)($,ge,$,this.renderCoordsHelper.spatialReference),(0,H.m)($,$,se),(0,B.pp)(ae,$)}(0,H.s)(this.extent[0].origin,ae[0],ae[1],ae[2]),(0,H.s)(this.extent[1].origin,ae[3],ae[1],ae[2]),(0,H.s)(this.extent[2].origin,ae[3],ae[4],ae[2]),(0,H.s)(this.extent[3].origin,ae[0],ae[4],ae[2]);for(let Ee=0;Ee<4;++Ee)(0,H.m)(this.extent[Ee].origin,this.extent[Ee].origin,ne)}_toRenderBoundingExtentLocal(he,ge,ye){(0,J.dH)(he,ge,de,this.renderCoordsHelper.spatialReference),(0,H.s)(this.extent[0].origin,de[0],de[1],ye),(0,H.s)(this.extent[1].origin,de[2],de[1],ye),(0,H.s)(this.extent[2].origin,de[2],de[3],ye),(0,H.s)(this.extent[3].origin,de[0],de[3],ye)}_toRenderBoundingExtent(he,ge,ye){switch(this.renderCoordsHelper.viewingMode){case le.JY.Global:this._toRenderBoundingExtentGlobal(he,ge,ye);break;case le.JY.Local:this._toRenderBoundingExtentLocal(he,ge,ye);break;default:(0,x.Bg)(this.renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(he){if((0,ce.jH)(he.planes[ie.Nu.NEAR],this.center.origin)<0&&(0,H.e)(this.center.direction,he.direction)<0)return!0;for(let ge=0;ge<4;ge++){const ye=this.extent[ge];if((0,ce.jH)(he.planes[ie.Nu.NEAR],ye.origin)<0&&(0,H.e)(ye.direction,he.direction)<0)return!0}return!1}}const ee=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],$=(0,re.c)(),ne=(0,Q.c)(),se=(0,Q.c)(),ae=(0,B.Ue)(),de=(0,Z.Ue)(),_e=(0,ue.Ue)()},63416:(dt,Re,T)=>{"use strict";T.d(Re,{L:()=>G});var x=T(94530),A=T(30755);class G{constructor(H,re){this.owner=re,this.properties={},this.afterDispatchHandle=null;for(const J in H){const B=new x.e(H[J],null,null,2,2);this.properties[J]={pool:B,acquired:[]}}this.afterDispatchHandle=(0,A.Fs)(()=>this._release())}destroy(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const H in this.properties){const re=this.properties[H];for(const J of re.acquired)(0,A.NC)(J)||re.pool.release(J);re.pool.destroy(),re.pool=null,re.acquired=null}this.properties=null,this.owner=null}get(H){const re=this.owner._get(H),J=this.properties[H];let W=J.pool.acquire();for(J.acquired.push(W);W===re;)J.acquired.push(W),W=J.pool.acquire();return W}_release(){for(const H in this.properties){const re=this.properties[H];let J=0;for(const W of re.acquired)(0,A.NC)(W)?re.acquired[J++]=W:re.pool.release(W);re.acquired.length=J}}}},60011:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>oe});var x=T(62208),A=T(16730),G=T(28347),Q=T(84161),H=T(55915),re=T(65234),J=T(78172),W=T(93088),B=T(90014),Z=T(26242),ie=T(88530),ue=T(59617),ce=T(86080);class oe{constructor(j,X,U,ee){this.viewingMode=j,this.spatialReference=X,this.unitInMeters=U,this.coordinateSystem=ee,this._coordinateSystem=(0,W.Ue)(ee)}set extent(j){j&&(0,W.qf)(this.coordinateSystem,j,this.coordinateSystem)}getAltitude(j){return(0,W.id)(this.coordinateSystem,j)}setAltitude(j,X,U=j){return(0,W.Is)(this.coordinateSystem,U,X,j)}setAltitudeOfTransformation(j,X){(0,W.rF)(this.coordinateSystem,X,j,X)}worldUpAtPosition(j,X){return(0,W.P0)(this.coordinateSystem,j,X)}worldBasisAtPosition(j,X,U){return(0,W.Kf)(this.coordinateSystem,j,X,U)}basisMatrixAtPosition(j,X){const U=this.worldBasisAtPosition(j,J.R.X,Z.WM.get()),ee=this.worldBasisAtPosition(j,J.R.Y,Z.WM.get()),$=this.worldBasisAtPosition(j,J.R.Z,Z.WM.get());return(0,G.s)(X,U[0],U[1],U[2],0,ee[0],ee[1],ee[2],0,$[0],$[1],$[2],0,0,0,0,1),X}intersectManifoldClosestSilhouette(j,X,U){return(0,W.NE)(this.coordinateSystem,X,this._coordinateSystem),(0,W.ej)(this._coordinateSystem,j,U),U}intersectManifold(j,X,U){(0,W.NE)(this.coordinateSystem,X,this._coordinateSystem);const ee=Z.WM.get();return(0,W.BR)(this._coordinateSystem,j,ee)?(0,Q.c)(U,ee):null}intersectInfiniteManifold(j,X,U){if(this.viewingMode===ue.JY.Global)return this.intersectManifold(j,X,U);(0,W.NE)(this.coordinateSystem,X,this._coordinateSystem);const ee=this._coordinateSystem.value,$=Z.WM.get();return(0,B.BR)(ee.plane,j,$)?(0,Q.c)(U,$):null}toRenderCoords(j,X,U){return(0,ie.f)(j)?(0,H.KC)(j,X,this.spatialReference):(0,H.SH)(j,X,U,this.spatialReference)}fromRenderCoords(j,X,U=null){return(0,ie.f)(X)?((0,x.pC)(U)&&(X.spatialReference=U),(0,H.MT)(j,this.spatialReference,X)):X instanceof re.Z?(0,H.fA)(j,this.spatialReference,X):(0,H.SH)(j,this.spatialReference,X,U)?X:null}static create(j,X){switch(j){case ue.JY.Local:return new oe(ue.JY.Local,X,(0,A.c9)(X),(0,W.pb)());case ue.JY.Global:return new oe(ue.JY.Global,X,1,(0,W.pt)(X))}}static renderUnitScaleFactor(j,X){return le(j)/le(X)}}function le(Y){if((0,ce.D)(Y,ue.JY.Global))return 1;const j=(0,W.E2)(!1,Y);return(0,A.c9)(j)}},91540:(dt,Re,T)=>{"use strict";T.d(Re,{nN:()=>$,wu:()=>X});var x=T(17626),A=T(84792),G=T(14517),Q=T(85931),H=T(26584),re=T(58817),J=T(62208),W=T(10699),B=T(77712),ie=(T(90912),T(76898)),ue=T(2282);class oe{constructor(_e){this.typeWorkerQuota=_e,this.tasks=new Array,this.numWorkers=0,this.statistics=new le}}class le{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}}class Y{constructor(_e,pe,he,ge){this._workerFunc=_e,this._callbackFunc=pe,this._maxTotalNumWorkers=he,this._totalNumWorkers=0,this._clients=ge.map(ye=>new oe(ye))}hasQuota(_e){const pe=this._clients[_e];return!!pe&&(this._totalNumWorkers<this._maxTotalNumWorkers||pe.numWorkers+pe.tasks.length<pe.typeWorkerQuota)}push(_e){const pe=this._clients[_e.client];pe&&(this._totalNumWorkers<this._maxTotalNumWorkers?(pe.numWorkers++,this._totalNumWorkers++,this._workerFunc(_e,(he,ge)=>this._taskCallback(he,ge))):pe.tasks.push(_e))}cancel(_e){this._taskFinished(_e),_e._cancelled=!0}destroy(){this._clients.length=0}_taskFinished(_e){const pe=this._clients[_e.client];this._totalNumWorkers--,pe.numWorkers--,pe.statistics.requests++,pe.statistics.size+=_e.size||0,pe.statistics.duration+=_e.duration||0,pe.statistics.speed=pe.statistics.duration>0?pe.statistics.size/pe.statistics.duration:0,(0,ue.hu)(pe.numWorkers>=0),this._next()}_next(){for(const _e of this._clients)if(_e&&_e.numWorkers<_e.typeWorkerQuota&&this._processQueue(_e))return;for(const _e of this._clients)if(_e&&this._processQueue(_e))return}_processQueue(_e){for(;_e.tasks.length>0;)if(this._workerFunc(_e.tasks.shift(),(pe,he)=>this._taskCallback(pe,he)))return _e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(_e,pe){_e._cancelled||(this._callbackFunc(_e,pe),this._taskFinished(_e))}getStatsForType(_e){const pe=this._clients[_e];return pe?{quota:pe.typeWorkerQuota,workers:pe.numWorkers,queueSize:pe.tasks.length,requestStats:pe.statistics}:null}get test(){const _e=this;return{set workerFunc(pe){_e._workerFunc=pe}}}}var j=T(87091);let X=class extends G.Z{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(de,_e,pe){this._loadQueue=new Y((he,ge)=>this._startLoading(he,ge),(he,ge)=>this._doneLoadingCB(he,ge),de,_e),pe&&(this._frameTask=pe.registerTask(j.T8.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=(0,J.hw)(this._frameTask),this._tasks.forEach(de=>(0,J.IM)(de.abortController)),this._loadQueue=(0,J.SC)(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(de){return this._loadQueue.hasQuota(de)}request(de,_e,pe,he={}){const ge=(0,W.hh)();ge.__signal=(0,J.pC)(he)?he.signal:null;const ye=this._createOrUpdateTask(de,_e,pe,he,ge);return(0,W.fu)(he,()=>this._cancelRequest(ye,ge)),ge.promise}_createTask(de,_e,pe,he,ge,ye){const Me=new ne(de,_e,pe,he,ge);return this._updateTask(Me,ye),this._tasks.set(ge,Me),1===this._tasks.size&&this._set("updating",!0),this._loadQueue.push(Me),Me}_cancelRequest(de,_e){(0,Q.e$)(de.resolvers,_e),_e.reject((0,W.zE)()),0===de.resolvers.length&&(de.status===ae.DOWNLOADING&&(de.status=ae.CANCELLED,this._loadQueue.cancel(de),de.abortController.abort(),de.request=null,de.abortController=null),de.status=ae.CANCELLED,this._tasks.delete(de.key),0===this._tasks.size&&this._set("updating",!1))}_updateTask(de,_e){de.resolvers.push(_e)}_createOrUpdateTask(de,_e,pe,he,ge){const ye=function se(de,_e,pe){return`${de}:${_e}:${pe}`}((0,J.pC)(he)&&he.uid||de,_e,pe),Me=this._tasks.get(ye);return Me?(this._updateTask(Me,ge),Me):this._createTask(de,he,_e,pe,ye,ge)}_doneLoadingCB(de,_e){this._loadQueue&&((0,ue.hu)(de.status===ae.DOWNLOADING),de.status=ae.DOWNLOADED,this._frameTask?this._doneQueue.push({task:de,err:_e}):this._doneLoading(de,_e))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(de){for(;!de.done&&this._onLoadQueue.length>0;){const _e=this._onLoadQueue.shift();(0,W.k_)(_e.task.abortController),_e.task.abortController=null,_e.callback(_e.task),de.madeProgress()}for(;!de.done&&this._doneQueue.length>0;){const _e=this._doneQueue.shift();_e.task.status!==ae.DOWNLOADED&&(_e.err=_e.err||(0,W.zE)()),this._doneLoading(_e.task,_e.err),de.madeProgress()}}_doneLoading(de,_e){if(_e&&!(0,W.D_)(_e)&&de.numRetries>0)return--de.numRetries,void this._loadQueue.push(de);let pe=de.result instanceof HTMLImageElement?0:de.resolvers.length;for(const he of de.resolvers)if(_e)(0,W.D_)(_e)?he.reject(_e):he.reject(new H.Z("stream-data-loader:request-error",`Failed to request resource at '${de.url}'. ${_e}`,{url:de.url,error:_e}));else{--pe;const ge=pe<=0?de.result:(0,re.d9)(de.result);he.resolve(ge)}this._tasks.delete(de.key),0===this._tasks.size&&this._set("updating",!1)}_startLoading(de,_e){if(de.status===ae.CANCELLED)return!1;let pe,he;switch(de.startTime=performance.now(),de.status=ae.DOWNLOADING,de.docType){case"binary":he="array-buffer",pe=0;break;case"image":he="image";break;case"image+type":he="array-buffer";break;default:he="json"}de.abortController=new AbortController;const ge=de.abortController.signal;de.request=(0,A.default)(de.url,yi(or({},de.options),{responseType:he,timeout:pe,signal:ge}));let ye=()=>{};const Me=Te=>{de.duration=performance.now()-de.startTime,de.size=Te instanceof ArrayBuffer?Te.byteLength:de.size||0,de.result=Te,this._frameTask?this._onLoadQueue.push({callback:_e,task:de}):(de.abortController=null,_e(de))},Ee=Te=>{de.status===ae.DOWNLOADING&&_e(de,Te),ye()};return"image+type"!==de.docType?(de.request.then(Te=>Me(Te.data),Ee),!0):(de.request.then(Te=>{const me=Te.data,Ce=function ee(de){if(de.byteLength<2)return"unknown";const _e=new Uint8Array(de,0,de.byteLength);return 137===_e[0]&&80===_e[1]?"image/png":71===_e[0]&&73===_e[1]?"image/gif":66===_e[0]&&77===_e[1]?"image/bmp":255===_e[0]&&216===_e[1]?"image/jpeg":"unknown"}(me);if(he="image",de.size=me.byteLength,"unknown"===Ce)return de.request=(0,A.default)(de.url,{responseType:he,timeout:pe,signal:ge}),void de.request.then(Je=>Me(Je.data),Ee);const Ie=new Blob([me],{type:Ce}),Ge=window.URL.createObjectURL(Ie);ye=()=>window.URL.revokeObjectURL(Ge),de.request=(0,A.default)(Ge,{responseType:he,timeout:pe,signal:ge}),de.request.then(Je=>Me(new $(Je.data,Ce,ye)),Ee)},Ee),!0)}get test(){return{loadQueue:this._loadQueue}}};(0,x._)([(0,B.Cb)({readOnly:!0})],X.prototype,"updating",void 0),X=(0,x._)([(0,ie.j)("esri.views.3d.support.StreamDataLoader")],X);class ${constructor(_e,pe,he){this.image=_e,this.type=pe,this.release=he}get isOpaque(){return"image/jpeg"===this.type}}class ne extends class ce{constructor(_e){this.client=_e,this._cancelled=!1,this.size=0,this.duration=0}}{constructor(_e,pe,he,ge,ye){super(ge),this.url=_e,this.options=pe,this.docType=he,this.key=ye,this.result=null,this.status=ae.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=0}}var ae,de;(de=ae||(ae={}))[de.QUEUED=1]="QUEUED",de[de.DOWNLOADING=2]="DOWNLOADING",de[de.DOWNLOADED=3]="DOWNLOADED",de[de.CANCELLED=4]="CANCELLED"},19625:(dt,Re,T)=>{"use strict";T.d(Re,{U$:()=>H});var x=T(60479),A=T(81096);class G{constructor(J,W){this.layout=J,this.buffer="number"==typeof W?new ArrayBuffer(W*J.stride):W;for(const B of J.fieldNames){const Z=J.fields.get(B);this[B]=new Z.constructor(this.buffer,Z.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(J,W){const B=this[J];return B&&B.elementCount===W.ElementCount&&B.elementType===W.ElementType?B:null}slice(J,W){return new G(this.layout,this.buffer.slice(J*this.stride,W*this.stride))}copyFrom(J,W,B,Z){const ie=this.stride;if(ie%4==0){const ue=new Uint32Array(J.buffer,W*ie,Z*ie/4);new Uint32Array(this.buffer,B*ie,Z*ie/4).set(ue)}else{const ue=new Uint8Array(J.buffer,W*ie,Z*ie);new Uint8Array(this.buffer,B*ie,Z*ie).set(ue)}}}class Q{constructor(){this.stride=0,this.fields=new Map,this.fieldNames=[]}vec2f(J,W){return this._appendField(J,x.Eu,W),this}vec2f64(J,W){return this._appendField(J,x.q6,W),this}vec3f(J,W){return this._appendField(J,x.ct,W),this}vec3f64(J,W){return this._appendField(J,x.fP,W),this}vec4f(J,W){return this._appendField(J,x.ek,W),this}vec4f64(J,W){return this._appendField(J,x.Cd,W),this}mat3f(J,W){return this._appendField(J,x.gK,W),this}mat3f64(J,W){return this._appendField(J,x.ey,W),this}mat4f(J,W){return this._appendField(J,x.bj,W),this}mat4f64(J,W){return this._appendField(J,x.O1,W),this}vec4u8(J,W){return this._appendField(J,x.mc,W),this}f32(J,W){return this._appendField(J,x.ly,W),this}f64(J,W){return this._appendField(J,x.oS,W),this}u8(J,W){return this._appendField(J,x.D_,W),this}u16(J,W){return this._appendField(J,x.av,W),this}i8(J,W){return this._appendField(J,x.Hz,W),this}vec2i8(J,W){return this._appendField(J,x.Vs,W),this}vec2i16(J,W){return this._appendField(J,x.or,W),this}vec2u8(J,W){return this._appendField(J,x.xA,W),this}vec4u16(J,W){return this._appendField(J,x.v6,W),this}u32(J,W){return this._appendField(J,x.Nu,W),this}_appendField(J,W,B){const Z=W.ElementCount*(0,A.n1)(W.ElementType);this.fields.set(J,{size:Z,constructor:W,offset:this.stride,optional:B}),this.stride+=Z,this.fieldNames.push(J)}alignTo(J){return this.stride=Math.floor((this.stride+J-1)/J)*J,this}hasField(J){return this.fieldNames.includes(J)}createBuffer(J){return new G(this,J)}createView(J){return new G(this,J)}clone(){const J=new Q;return J.stride=this.stride,J.fields=new Map,this.fields.forEach((W,B)=>J.fields.set(B,W)),J.fieldNames=this.fieldNames.slice(),J.BufferType=this.BufferType,J}}function H(){return new Q}},4511:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>G});var x=T(67969),A=T(40852);function G(re,J=0){const W=re.stride;return re.fieldNames.filter(B=>{const Z=re.fields.get(B).optional;return!(Z&&Z.glPadding)}).map(B=>{const Z=re.fields.get(B),ie=Z.constructor.ElementCount,ue=function Q(re){const J=H[re];if(J)return J;throw new Error("BufferType not supported in WebGL")}(Z.constructor.ElementType);return new A.G(B,ie,ue,Z.offset,W,!(!Z.optional||!Z.optional.glNormalized),J)})}const H={u8:x.g.UNSIGNED_BYTE,u16:x.g.UNSIGNED_SHORT,u32:x.g.UNSIGNED_INT,i8:x.g.BYTE,i16:x.g.SHORT,i32:x.g.INT,f32:x.g.FLOAT}},2975:(dt,Re,T)=>{"use strict";T.d(Re,{HL:()=>G,aj:()=>Q});var x=T(60479),A=T(19625);function G(ie,ue){return ue.push(ie.buffer),{buffer:ie.buffer,layout:H(ie.layout)}}function Q(ie){return function re(ie){const ue=(0,A.U$)();return ue.stride=ie.stride,ue.fieldNames=ie.fieldNames,ie.fields.forEach(ce=>ue.fields.set(ce[0],yi(or({},ce[1]),{constructor:B(ce[1].constructor)}))),ue}(ie.layout).createView(ie.buffer)}function H(ie){const ue=new Array;return ie.fields.forEach((ce,oe)=>{const le=yi(or({},ce),{constructor:W(ce.constructor)});ue.push([oe,le])}),{stride:ie.stride,fields:ue,fieldNames:ie.fieldNames}}const J=[x.ly,x.Eu,x.ct,x.ek,x.gK,x.bj,x.oS,x.q6,x.fP,x.Cd,x.ey,x.O1,x.D_,x.xA,x.ne,x.mc,x.av,x.TS,x.mw,x.v6,x.Nu,x.qt,x.G5,x.hu,x.Hz,x.Vs,x.P_,x.ir,x.o7,x.or,x.n1,x.zO,x.Jj,x.wA,x.PP,x.TN];function W(ie){return`${ie.ElementType}_${ie.ElementCount}`}function B(ie){return Z.get(ie)}const Z=new Map;J.forEach(ie=>Z.set(W(ie),ie))},93605:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.Z{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,x._)([(0,G.Cb)()],W.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"LABELS_SHOW_BORDER",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"TEXT_SHOW_BASELINE",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"TEXT_SHOW_BORDER",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"SHOW_POI",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"LINE_WIREFRAMES",void 0),W=(0,x._)([(0,J.j)("esri.views.3d.support.DebugFlags")],W);const B=new W},55745:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>H,O:()=>Q});var x=T(62208),A=T(28093),G=T(55915);function Q(J,W,B){if((0,x.Wi)(J)||(0,x.Wi)(B))return!1;let Z=!0;return re[0]=null!=J.xmin?J.xmin:0,re[1]=null!=J.ymin?J.ymin:0,re[2]=null!=J.zmin?J.zmin:0,Z=Z&&(0,G.CM)(re,J.spatialReference,0,W,B,0,1),re[0]=null!=J.xmax?J.xmax:0,re[1]=null!=J.ymax?J.ymax:0,re[2]=null!=J.zmax?J.zmax:0,Z=Z&&(0,G.CM)(re,J.spatialReference,0,W,B,3,1),null==J.xmin&&(W[0]=-1/0),null==J.ymin&&(W[1]=-1/0),null==J.zmin&&(W[2]=-1/0),null==J.xmax&&(W[3]=1/0),null==J.ymax&&(W[4]=1/0),null==J.zmax&&(W[5]=1/0),Z}function H(J,W,B){if((0,x.Wi)(J)||(0,x.Wi)(B))return!1;let Z=!0;return re[0]=null!=J.xmin?J.xmin:0,re[1]=null!=J.ymin?J.ymin:0,re[2]=null!=J.zmin?J.zmin:0,Z=Z&&(0,G.CM)(re,J.spatialReference,0,re,B,0,1),W[0]=re[0],W[1]=re[1],re[0]=null!=J.xmax?J.xmax:0,re[1]=null!=J.ymax?J.ymax:0,re[2]=null!=J.zmax?J.zmax:0,Z=Z&&(0,G.CM)(re,J.spatialReference,0,re,B,0,1),W[2]=re[0],W[3]=re[1],null==J.xmin&&(W[0]=-1/0),null==J.ymin&&(W[1]=-1/0),null==J.xmax&&(W[2]=1/0),null==J.ymax&&(W[3]=1/0),Z}const re=(0,A.c)()},26046:(dt,Re,T)=>{"use strict";T.d(Re,{Bh:()=>J,eW:()=>B,iE:()=>W,u4:()=>re});var x=T(62208),A=T(23841),G=T(67831),Q=T(84161),H=T(26242);function re(Z,ie,ue){return J(Z,Z.screenToRender(ie,(0,A.Wv)(H.WM.get())),ue)}function J(Z,ie,ue){const ce=(0,A.Wv)((0,G.c)(H.WM.get(),ie));if(ce[2]=0,!Z.unprojectFromRenderScreen(ce,ue.origin))return null;const oe=(0,A.Wv)((0,G.c)(H.WM.get(),ie));oe[2]=1;const le=Z.unprojectFromRenderScreen(oe,H.WM.get());return(0,x.Wi)(le)?null:((0,Q.b)(ue.direction,le,ue.origin),ue)}function W(Z,ie,ue){return B(Z,Z.screenToRender(ie,(0,A.Wv)(H.WM.get())),ue)}function B(Z,ie,ue){(0,Q.c)(ue.origin,Z.eye);const ce=(0,Q.s)(H.WM.get(),ie[0],ie[1],1),oe=Z.unprojectFromRenderScreen(ce,H.WM.get());return(0,x.Wi)(oe)?null:((0,Q.b)(ue.direction,oe,ue.origin),ue)}},39135:(dt,Re,T)=>{"use strict";var x,Q;T.d(Re,{Bh:()=>x,NT:()=>G,Ty:()=>A}),(Q=x||(x={}))[Q.ELEVATION=0]="ELEVATION",Q[Q.BASEMAP=1]="BASEMAP",Q[Q.I3S_INDEX=2]="I3S_INDEX",Q[Q.I3S_DATA=3]="I3S_DATA",Q[Q.SYMBOLOGY=4]="SYMBOLOGY";const A=(()=>{const Q=new Array;return Q[x.ELEVATION]=10,Q[x.BASEMAP]=10,Q[x.I3S_INDEX]=10,Q[x.I3S_DATA]=10,Q[x.SYMBOLOGY]=5,Q})(),G=30},24229:(dt,Re,T)=>{"use strict";T.d(Re,{W8:()=>Z,kD:()=>B});var x=T(99770),A=T(84161),G=T(28093),Q=T(90014);function B(le,Y,j,X){return function oe(le,Y,j,X){X.clip[0]=0,X.clip[1]=j?X.len:Number.MAX_VALUE;for(let U=0;U<le.length;U++)if(!ce(le[U],Y,X))return!1;return!0}(le,Y,j,function ue(le,Y,j,X){const U=ie;return le?(j&&X&&(U.len=(0,A.i)(Y,j)),(0,A.c)(U.dir,le)):X?(U.len=(0,A.i)(Y,j),(0,A.b)(U.dir,j,Y),(0,A.g)(U.dir,U.dir,1/U.len)):((0,A.b)(U.dir,j,Y),(0,A.n)(U.dir,U.dir)),U}(X,Y,j,!0))}function Z(le,Y,j,X){const U=(0,A.e)(j,(0,A.b)(le,X,Y));return(0,A.a)(le,Y,(0,A.g)(le,j,U))}const ie={dir:(0,G.c)(),len:0,clip:(0,x.a)()};function ce(le,Y,j){const X=(0,A.e)((0,Q.mJ)(le),j.dir),U=-(0,Q.jH)(le,Y);if(U<0&&X>=0)return!1;if(X>-1e-6&&X<1e-6)return U>0;if((U<0||X<0)&&!(U<0&&X<0))return!0;const ee=U/X;return X>0?ee<j.clip[1]&&(j.clip[1]=ee):ee>j.clip[0]&&(j.clip[0]=ee),j.clip[0]<=j.clip[1]}},98943:(dt,Re,T)=>{"use strict";T.d(Re,{EU:()=>le,T:()=>B,ZA:()=>ce,_F:()=>Z,bX:()=>ue,ek:()=>oe,mw:()=>W,pG:()=>j,u1:()=>J,uV:()=>Y});var x=T(21286),A=T(84161),G=T(28093);function J(se){return Math.sqrt(Math.max(se[0]*se[0]+se[4]*se[4]+se[8]*se[8],se[1]*se[1]+se[5]*se[5]+se[9]*se[9],se[2]*se[2]+se[6]*se[6]+se[10]*se[10]))}function W(se,ae){const de=Math.sqrt(ae[0]*ae[0]+ae[4]*ae[4]+ae[8]*ae[8]),_e=Math.sqrt(ae[1]*ae[1]+ae[5]*ae[5]+ae[9]*ae[9]),pe=Math.sqrt(ae[2]*ae[2]+ae[6]*ae[6]+ae[10]*ae[10]);return(0,A.s)(se,de,_e,pe),se}function B(se,ae,de){de=de||se;const _e=(0,A.e)(se,ae);(0,A.s)(de,se[0]-_e*ae[0],se[1]-_e*ae[1],se[2]-_e*ae[2]),(0,A.n)(de,de)}function Z(se,ae,de){Math.abs(se[0])>Math.abs(se[1])?(0,A.s)(ae,0,1,0):(0,A.s)(ae,1,0,0),(0,A.f)(de,se,ae),(0,A.n)(ae,ae),(0,A.f)(ae,de,se),(0,A.n)(de,de)}function ue(se,ae,de,_e,pe,he){const ge=se+(ae-se)*pe;return ge+(de+(_e-de)*pe-ge)*he}function ce(se,ae,de,_e=(0,G.c)()){const pe=(0,A.l)(se),he=(0,A.l)(ae),ge=(0,A.e)(se,ae)/(pe*he);if(ge<.9999999999999999){const ye=Math.acos(ge),Me=((1-de)*pe+de*he)/Math.sin(ye),Ee=Me/pe*Math.sin((1-de)*ye),Te=Me/he*Math.sin(de*ye);return(0,A.g)($,se,Ee),(0,A.g)(ne,ae,Te),(0,A.a)(_e,$,ne)}return(0,A.h)(_e,se,ae,de)}function oe(se,ae,de,_e=(0,G.c)(),pe=(0,G.c)()){const he=(0,A.l)(se),ge=(0,A.l)(ae),ye=(0,A.e)(se,ae)/(he*ge);if(ye<.9999999999999999){const Me=Math.acos(ye),Ee=Math.sin(Me),Te=Math.sin(de*Me),me=Math.sin((1-de)*Me),Ce=(1-de)*he+de*ge;{const Ie=Ce/Ee,Ge=Ie/ge*Te;(0,A.g)($,se,Ie/he*me),(0,A.g)(ne,ae,Ge),(0,A.a)(_e,$,ne)}{const Ie=1/he*(-Math.cos((1-de)*Me)*Me*Ce+me*(-he+ge));(0,A.g)($,se,Ie);const Ge=1/ge*(Math.cos(de*Me)*Me*Ce+Te*(-he+ge));(0,A.g)(ne,ae,Ge),(0,A.a)(pe,$,ne),(0,A.g)(pe,pe,1/Ee)}return pe}return(0,A.h)(_e,se,ae,de),(0,A.b)(pe,ae,se),(0,A.n)(pe,pe),pe}function le(se,ae,de){se=(0,A.n)($,se),ae=(0,A.n)(ne,ae);const _e=(0,x.ZF)((0,A.e)(se,ae));if(de){const pe=(0,A.f)(ee,se,ae);if((0,A.e)(pe,de)<0)return-_e}return _e}function Y(se){const ae=se.length;return de=>{if(de<=se[0][0])return se[0][1];if(de>=se[ae-1][0])return se[ae-1][1];let _e=1;for(;de>se[_e][0];)_e++;const he=se[_e][0],ge=(he-de)/(he-se[_e-1][0]);return ge*se[_e-1][1]+(1-ge)*se[_e][1]}}function j(se,ae,de,_e){(0,A.b)(X,ae,se),(0,A.b)(U,de,se),(0,A.f)(_e,X,U),(0,A.n)(_e,_e),_e[3]=-(0,A.e)(se,_e)}const X=(0,G.c)(),U=(0,G.c)(),ee=(0,G.c)(),$=(0,G.c)(),ne=(0,G.c)()},93394:(dt,Re,T)=>{"use strict";T.d(Re,{JF:()=>jt,d9:()=>er,Qb:()=>tr,$e:()=>lr,Ue:()=>qt,fn:()=>ri,hZ:()=>ir,pn:()=>Zr,n3:()=>Br,JH:()=>Ur,xz:()=>Nt,q0:()=>jr,t8:()=>Zt,mr:()=>fr});var x=T(30217),A=T(550),G=T(48977),Q=T(56729),H=T(78451),re=T(84161),J=T(14658),W=T(28093),Z=(T(993),T(4794)),ie=T(5548),ue=T(90014);const ce=1e-6,oe=[0,0,0],le=[0,0,0];const X=[0,0,0],U=[0,0,0],ee=[0,0,0],$=[0,0,0],ne=[0,0,0],se=[0,0,0],ae=[0,0,0],de=[0,0,0],he=[0,0,0],ye=[0,0],Ee=[0,0,0],Te=[0,0,0],me=[0,0,0],Ce=[0,0,0],Ie=[0,0,0],Ge=[0,0,0];function Je(Ot,rr,pr,Pr,Fr,ii){if(Ft(rr)<ce)return;zt(Ee,pr,rr),zt(Te,Pr,rr),zt(me,Fr,rr),je(Ot,rr,ye),Ie[1]=ye[0],Ce[1]=ye[1],Ge[1]=Ce[1]-Ie[1];const mi=[pr,Pr,Fr],wi=[Ee,Te,me];for(let Qr=0;Qr<3;++Qr){je(Ot,mi[Qr],ye),Ie[0]=ye[0],Ce[0]=ye[1],je(Ot,wi[Qr],ye),Ie[2]=ye[0],Ce[2]=ye[1],Ge[0]=Ce[0]-Ie[0],Ge[2]=Ce[2]-Ie[2];const Ni=ke(Ge);Ni<ii.quality&&(wt(ii.b0,mi[Qr]),wt(ii.b1,rr),wt(ii.b2,wi[Qr]),ii.quality=Ni)}}const xe=[0,0,0];function je(Ot,rr,pr){const{data:Pr,size:Fr}=Ot;pr[0]=Number.POSITIVE_INFINITY,pr[1]=Number.NEGATIVE_INFINITY;for(let ii=0;ii<Pr.length;ii+=Fr){const mi=Pr[ii]*rr[0]+Pr[ii+1]*rr[1]+Pr[ii+2]*rr[2];pr[0]=Math.min(pr[0],mi),pr[1]=Math.max(pr[1],mi)}}function Ne(Ot,rr,pr){wt(pr.center,Ot),yt(pr.halfSize,rr,.5),pr.quaternion[0]=0,pr.quaternion[1]=0,pr.quaternion[2]=0,pr.quaternion[3]=1}const we=[0,0,0],Oe=[0,0,0],$e=[0,0,0],Be=[0,0,0],Se=[0,0,0],De=[0,0,0];function ve(Ot,rr,pr,Pr,Fr,ii){je(Ot,rr,ye),Fr[0]=ye[0],ii[0]=ye[1],je(Ot,pr,ye),Fr[1]=ye[0],ii[1]=ye[1],je(Ot,Pr,ye),Fr[2]=ye[0],ii[2]=ye[1]}const Ke=[0,0,0],qe=[1,0,0,0,1,0,0,0,1],be=[0,0,0];function tt(Ot,rr,pr,Pr,Fr,ii,mi){qe[0]=Ot[0],qe[1]=Ot[1],qe[2]=Ot[2],qe[3]=rr[0],qe[4]=rr[1],qe[5]=rr[2],qe[6]=pr[0],qe[7]=pr[1],qe[8]=pr[2],function Xt(Ot,rr){const pr=rr[0]+rr[4]+rr[8];if(pr>0){let Pr=Math.sqrt(pr+1);Ot[3]=.5*Pr,Pr=.5/Pr,Ot[0]=(rr[5]-rr[7])*Pr,Ot[1]=(rr[6]-rr[2])*Pr,Ot[2]=(rr[1]-rr[3])*Pr}else{let Pr=0;rr[4]>rr[0]&&(Pr=1),rr[8]>rr[3*Pr+Pr]&&(Pr=2);const Fr=(Pr+1)%3,ii=(Pr+2)%3;let mi=Math.sqrt(rr[3*Pr+Pr]-rr[3*Fr+Fr]-rr[3*ii+ii]+1);Ot[Pr]=.5*mi,mi=.5/mi,Ot[3]=(rr[3*Fr+ii]-rr[3*ii+Fr])*mi,Ot[Fr]=(rr[3*Fr+Pr]+rr[3*Pr+Fr])*mi,Ot[ii]=(rr[3*ii+Pr]+rr[3*Pr+ii])*mi}}(mi.quaternion,qe),ot(be,Pr,Fr),yt(be,be,.5),yt(mi.center,Ot,be[0]),yt(Ke,rr,be[1]),ot(mi.center,mi.center,Ke),yt(Ke,pr,be[2]),ot(mi.center,mi.center,Ke),yt(mi.halfSize,ii,.5)}class ze{constructor(rr){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let Pr=0;this.minProj=new Float64Array(this.buffer,Pr,7),Pr+=56,this.maxProj=new Float64Array(this.buffer,Pr,7),Pr+=56;for(let Qr=0;Qr<7;++Qr)this.minVert[Qr]=new Float64Array(this.buffer,Pr,3),Pr+=24;for(let Qr=0;Qr<7;++Qr)this.maxVert[Qr]=new Float64Array(this.buffer,Pr,3),Pr+=24;for(let Qr=0;Qr<7;++Qr)this.minProj[Qr]=Number.POSITIVE_INFINITY,this.maxProj[Qr]=Number.NEGATIVE_INFINITY;const Fr=new Array(7),ii=new Array(7),{data:mi,size:wi}=rr;for(let Qr=0;Qr<mi.length;Qr+=wi){let Ni=mi[Qr];Ni<this.minProj[0]&&(this.minProj[0]=Ni,Fr[0]=Qr),Ni>this.maxProj[0]&&(this.maxProj[0]=Ni,ii[0]=Qr),Ni=mi[Qr+1],Ni<this.minProj[1]&&(this.minProj[1]=Ni,Fr[1]=Qr),Ni>this.maxProj[1]&&(this.maxProj[1]=Ni,ii[1]=Qr),Ni=mi[Qr+2],Ni<this.minProj[2]&&(this.minProj[2]=Ni,Fr[2]=Qr),Ni>this.maxProj[2]&&(this.maxProj[2]=Ni,ii[2]=Qr),Ni=mi[Qr]+mi[Qr+1]+mi[Qr+2],Ni<this.minProj[3]&&(this.minProj[3]=Ni,Fr[3]=Qr),Ni>this.maxProj[3]&&(this.maxProj[3]=Ni,ii[3]=Qr),Ni=mi[Qr]+mi[Qr+1]-mi[Qr+2],Ni<this.minProj[4]&&(this.minProj[4]=Ni,Fr[4]=Qr),Ni>this.maxProj[4]&&(this.maxProj[4]=Ni,ii[4]=Qr),Ni=mi[Qr]-mi[Qr+1]+mi[Qr+2],Ni<this.minProj[5]&&(this.minProj[5]=Ni,Fr[5]=Qr),Ni>this.maxProj[5]&&(this.maxProj[5]=Ni,ii[5]=Qr),Ni=mi[Qr]-mi[Qr+1]-mi[Qr+2],Ni<this.minProj[6]&&(this.minProj[6]=Ni,Fr[6]=Qr),Ni>this.maxProj[6]&&(this.maxProj[6]=Ni,ii[6]=Qr)}for(let Qr=0;Qr<7;++Qr){let Ni=Fr[Qr];wt(this.minVert[Qr],mi,Ni),Ni=ii[Qr],wt(this.maxVert[Qr],mi,Ni)}}}class et{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}}function ke(Ot){return Ot[0]*Ot[1]+Ot[0]*Ot[2]+Ot[1]*Ot[2]}function ot(Ot,rr,pr){Ot[0]=rr[0]+pr[0],Ot[1]=rr[1]+pr[1],Ot[2]=rr[2]+pr[2]}function at(Ot,rr,pr){Ot[0]=rr[0]-pr[0],Ot[1]=rr[1]-pr[1],Ot[2]=rr[2]-pr[2]}function yt(Ot,rr,pr){Ot[0]=rr[0]*pr,Ot[1]=rr[1]*pr,Ot[2]=rr[2]*pr}function wt(Ot,rr,pr=0){Ot[0]=rr[pr+0],Ot[1]=rr[pr+1],Ot[2]=rr[pr+2]}function zt(Ot,rr,pr){const Pr=rr[0],Fr=rr[1],ii=rr[2],mi=pr[0],wi=pr[1],Qr=pr[2];Ot[0]=Fr*Qr-ii*wi,Ot[1]=ii*mi-Pr*Qr,Ot[2]=Pr*wi-Fr*mi}function Rt(Ot,rr){const pr=rr[0]*rr[0]+rr[1]*rr[1]+rr[2]*rr[2];if(pr>0){const Pr=1/Math.sqrt(pr);Ot[0]=rr[0]*Pr,Ot[1]=rr[1]*Pr,Ot[2]=rr[2]*Pr}}function Ft(Ot){return Ot[0]*Ot[0]+Ot[1]*Ot[1]+Ot[2]*Ot[2]}function bt(Ot,rr){const pr=rr[0]-Ot[0],Pr=rr[1]-Ot[1],Fr=rr[2]-Ot[2];return pr*pr+Pr*Pr+Fr*Fr}function St(Ot,rr){return Ot[0]*rr[0]+Ot[1]*rr[1]+Ot[2]*rr[2]}const Mr=(0,H.a)(),Cr=(0,W.c)(),Yr=(0,W.c)(),ct=((0,Z.c)(),(0,A.c)());class jt{constructor(rr){this.buffer=new ArrayBuffer(56*rr),this.obbs=new Array(rr);for(let wi=0;wi<rr;wi++)this.obbs[wi]={center:(0,W.b)(this.buffer,56*wi+0),halfSize:(0,J.b)(this.buffer,56*wi+24),quaternion:(0,Q.b)(this.buffer,56*wi+36)}}}function qt(Ot=[0,0,0],rr=[-1,-1,-1],pr=[0,0,0,1]){return{center:(0,W.a)(Ot),halfSize:(0,J.a)(rr),quaternion:(0,Q.a)(pr)}}function er(Ot){return qt(Ot.center,Ot.halfSize,Ot.quaternion)}function Zt(Ot,rr){(0,re.c)(rr.center,Ot.center),(0,re.c)(rr.halfSize,Ot.halfSize),(0,G.a)(rr.quaternion,Ot.quaternion)}function tr(Ot,rr){return function Y(Ot,rr){const{data:pr,size:Pr}=Ot,Fr=pr.length/Pr;if(Fr<=0)return;const ii=new ze(Ot);ot(oe,ii.minProj,ii.maxProj),yt(oe,oe,.5),at(le,ii.maxProj,ii.minProj);const mi=ke(le),wi=new et;wi.quality=mi,Fr<14&&(Ot={data:new Float64Array(ii.buffer,112,42),size:3});const Qr=[0,0,0],Ni=[0,0,0],Hs=[0,0,0],Ar=[0,0,0],ni=[0,0,0],_i=[0,0,0],Ii=[0,0,0];switch(function j(Ot,rr,pr,Pr,Fr,ii,mi,wi,Qr,Ni){return function pe(Ot,rr,pr){let Pr=bt(Ot.maxVert[0],Ot.minVert[0]),Fr=0;for(let ii=1;ii<7;++ii){const mi=bt(Ot.maxVert[ii],Ot.minVert[ii]);mi>Pr&&(Pr=mi,Fr=ii)}wt(rr,Ot.minVert[Fr]),wt(pr,Ot.maxVert[Fr])}(Ot,Pr,Fr),bt(Pr,Fr)<ce?1:(at(mi,Pr,Fr),Rt(mi,mi),function ge(Ot,rr,pr,Pr){const{data:Fr,size:ii}=Ot;let mi=Number.NEGATIVE_INFINITY,wi=0;for(let Qr=0;Qr<Fr.length;Qr+=ii){he[0]=Fr[Qr]-rr[0],he[1]=Fr[Qr+1]-rr[1],he[2]=Fr[Qr+2]-rr[2];const Ni=pr[0]*he[0]+pr[1]*he[1]+pr[2]*he[2],Ar=he[0]*he[0]+he[1]*he[1]+he[2]*he[2]-Ni*Ni/(pr[0]*pr[0]+pr[1]*pr[1]+pr[2]*pr[2]);Ar>mi&&(mi=Ar,wi=Qr)}return wt(Pr,Fr,wi),mi}(rr,Pr,mi,ii)<ce?2:(at(wi,Fr,ii),Rt(wi,wi),at(Qr,ii,Pr),Rt(Qr,Qr),zt(pr,wi,mi),Rt(pr,pr),Je(rr,pr,mi,wi,Qr,Ni),0))}(ii,Ot,Ii,Qr,Ni,Hs,Ar,ni,_i,wi)){case 1:return void Ne(oe,le,rr);case 2:return void function Fe(Ot,rr,pr){wt(we,rr),Math.abs(rr[0])>Math.abs(rr[1])&&Math.abs(rr[0])>Math.abs(rr[2])?we[0]=0:Math.abs(rr[1])>Math.abs(rr[2])?we[1]=0:we[2]=0,Ft(we)<ce&&(we[0]=we[1]=we[2]=1),zt(Oe,rr,we),Rt(Oe,Oe),zt($e,rr,Oe),Rt($e,$e),ve(Ot,rr,Oe,$e,Be,Se),at(De,Se,Be),tt(rr,Oe,$e,Be,Se,De,pr)}(Ot,Ar,rr)}(function _e(Ot,rr,pr,Pr,Fr,ii,mi,wi,Qr){(function Me(Ot,rr,pr,Pr,Fr){!function We(Ot,rr,pr,Pr,Fr){const{data:ii,size:mi}=Ot;wt(Pr,ii),wt(Fr,Pr),pr[0]=St(xe,rr),pr[1]=pr[0];for(let wi=mi;wi<ii.length;wi+=mi){const Qr=ii[wi]*rr[0]+ii[wi+1]*rr[1]+ii[wi+2]*rr[2];Qr<pr[0]&&(pr[0]=Qr,wt(Pr,ii,wi)),Qr>pr[1]&&(pr[1]=Qr,wt(Fr,ii,wi))}}(Ot,rr,ye,Fr,Pr);const ii=St(pr,rr);ye[1]-ce<=ii&&(Pr[0]=void 0),ye[0]+ce>=ii&&(Fr[0]=void 0)})(Ot,rr,pr,X,U),void 0!==X[0]&&(at(ee,X,pr),Rt(ee,ee),at($,X,Pr),Rt($,$),at(ne,X,Fr),Rt(ne,ne),zt(se,$,ii),Rt(se,se),zt(ae,ne,mi),Rt(ae,ae),zt(de,ee,wi),Rt(de,de),Je(Ot,se,ii,$,ee,Qr),Je(Ot,ae,mi,ne,$,Qr),Je(Ot,de,wi,ee,ne,Qr)),void 0!==U[0]&&(at(ee,U,pr),Rt(ee,ee),at($,U,Pr),Rt($,$),at(ne,U,Fr),Rt(ne,ne),zt(se,$,ii),Rt(se,se),zt(ae,ne,mi),Rt(ae,ae),zt(de,ee,wi),Rt(de,de),Je(Ot,se,ii,$,ee,Qr),Je(Ot,ae,mi,ne,$,Qr),Je(Ot,de,wi,ee,ne,Qr))})(Ot,Ii,Qr,Ni,Hs,Ar,ni,_i,wi),ve(Ot,wi.b0,wi.b1,wi.b2,Be,Se);const ji=[0,0,0];at(ji,Se,Be),wi.quality=ke(ji),wi.quality<mi?tt(wi.b0,wi.b1,wi.b2,Be,Se,ji,rr):Ne(oe,le,rr)}(Ot,rr=rr||qt()),rr}function ir(Ot,rr){const pr=(0,ue.jH)(rr,Ot.center),Pr=Nt(Ot,(0,ue.mJ)(rr));return pr>Pr?1:pr<-Pr?-1:0}function fr(Ot,rr){rr||(rr=(0,ie.Ue)());const pr=(0,x.g)(ct,Ot.quaternion),Pr=Ot.halfSize[0]*Math.abs(pr[0])+Ot.halfSize[1]*Math.abs(pr[3])+Ot.halfSize[2]*Math.abs(pr[6]),Fr=Ot.halfSize[0]*Math.abs(pr[1])+Ot.halfSize[1]*Math.abs(pr[4])+Ot.halfSize[2]*Math.abs(pr[7]),ii=Ot.halfSize[0]*Math.abs(pr[2])+Ot.halfSize[1]*Math.abs(pr[5])+Ot.halfSize[2]*Math.abs(pr[8]);return rr[0]=Ot.center[0]-Pr,rr[1]=Ot.center[1]-Fr,rr[2]=Ot.center[2]-ii,rr[3]=Ot.center[0]+Pr,rr[4]=Ot.center[1]+Fr,rr[5]=Ot.center[2]+ii,rr}function Ur(Ot,rr){return(0,ue.jH)(rr,Ot.center)-Nt(Ot,(0,ue.mJ)(rr))}function Br(Ot,rr){return(0,ue.jH)(rr,Ot.center)+Nt(Ot,(0,ue.mJ)(rr))}function Zr(Ot,rr){return ir(Ot,rr[0])<=0&&ir(Ot,rr[1])<=0&&ir(Ot,rr[2])<=0&&ir(Ot,rr[3])<=0&&ir(Ot,rr[4])<=0&&ir(Ot,rr[5])<=0}function ri(Ot,rr,pr,Pr=0){(0,G.c)(Mr,Ot.quaternion),(0,re.b)(Cr,rr,Ot.center);const Fr=(0,re.q)(Cr,Cr,Mr),ii=(0,re.q)(Yr,pr,Mr);let mi=-1/0,wi=1/0;for(let Qr=0;Qr<3;Qr++)if(Math.abs(ii[Qr])>1e-6){const Ni=(Pr+Ot.halfSize[Qr]-Fr[Qr])/ii[Qr],Hs=(-Pr-Ot.halfSize[Qr]-Fr[Qr])/ii[Qr];mi=Math.max(mi,Math.min(Ni,Hs)),wi=Math.min(wi,Math.max(Ni,Hs))}else if(Fr[Qr]>Ot.halfSize[Qr]+Pr||Fr[Qr]<-Ot.halfSize[Qr]-Pr)return!1;return mi<=wi}function Nt(Ot,rr){(0,G.c)(Mr,Ot.quaternion),(0,re.q)(Cr,rr,Mr);const pr=Ot.halfSize;return Math.abs(Cr[0]*pr[0])+Math.abs(Cr[1]*pr[1])+Math.abs(Cr[2]*pr[2])}function lr(Ot,rr){for(let pr=0;pr<8;++pr){const Pr=rr[pr];Pr[0]=1&pr?-Ot.halfSize[0]:Ot.halfSize[0],Pr[1]=2&pr?-Ot.halfSize[1]:Ot.halfSize[1],Pr[2]=4&pr?-Ot.halfSize[2]:Ot.halfSize[2],(0,re.q)(Pr,Pr,Ot.quaternion),(0,re.a)(Pr,Pr,Ot.center)}}function jr(Ot){return(0,re.u)(Ot.halfSize)}(()=>{const Ot=new Int8Array(162);let rr=0;const pr=Pr=>{for(let Fr=0;Fr<Pr.length;Fr++)Ot[rr+Fr]=Pr[Fr];rr+=6};pr([6,2,3,1,5,4]),pr([0,2,3,1,5,4]),pr([0,2,3,7,5,4]),pr([0,1,3,2,6,4]),pr([0,1,3,2,0,0]),pr([0,1,5,7,3,2]),pr([0,1,3,7,6,4]),pr([0,1,3,7,6,2]),pr([0,1,5,7,6,2]),pr([0,1,5,4,6,2]),pr([0,1,5,4,0,0]),pr([0,1,3,7,5,4]),pr([0,2,6,4,0,0]),pr([0,0,0,0,0,0]),pr([1,3,7,5,0,0]),pr([2,3,7,6,4,0]),pr([2,3,7,6,0,0]),pr([2,3,1,5,7,6]),pr([0,1,5,7,6,2]),pr([0,1,5,7,6,4]),pr([0,1,3,7,6,4]),pr([4,5,7,6,2,0]),pr([4,5,7,6,0,0]),pr([4,5,1,3,7,6]),pr([0,2,3,7,5,4]),pr([6,2,3,7,5,4]),pr([6,2,3,1,5,4])})()},41632:(dt,Re,T)=>{"use strict";T.d(Re,{V:()=>x,q:()=>A});const x={value:.5,readOnly:!0},A={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}}},90793:(dt,Re,T)=>{"use strict";T.d(Re,{T:()=>G,j:()=>Q});var x=T(67857),A=T(91480);function G(H){return(0,A.nn)(H)&&H.intersector===x.q7.TERRAIN&&!!H.target}function Q(H){return(0,A.nn)(H)&&H.intersector===x.q7.OVERLAY&&!!H.target}},61034:(dt,Re,T)=>{"use strict";T.d(Re,{$e:()=>re,Jk:()=>W,aV:()=>J});var re,Z,x=T(21286),A=T(65401),G=T(75224),Q=T(42743),H=T(30993);(Z=re||(re={}))[Z.None=0]="None",Z[Z.ColorAndWater=1]="ColorAndWater",Z[Z.Highlight=2]="Highlight",Z[Z.Occluded=3]="Occluded";class J{constructor(ie,ue){this.index=ie,this.renderTargets=ue,this._extent=(0,A.Ue)(),this.resolution=0,this.renderLocalOrigin=(0,H.al)(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new B,this.validTargets=null,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=ie,this.validTargets=new Array(ue.renderTargets.length).fill(!1)}get extent(){return this._extent}getValidTexture(ie){return this.validTargets[ie]?this.renderTargets.getTarget(ie).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(ie){const ue=this.renderTargets.getTarget(ie===re.ColorAndWater?G.NH.Color:ie===re.Highlight?G.NH.Highlight:G.NH.Occluded);return ue?ue.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(G.NH.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(G.NH.Color):null}getNormalTexture(ie){const ue=ie===re.ColorAndWater?this.renderTargets.getTarget(G.NH.Water):null;return ue?ue.getTexture():null}draw(ie,ue){const ce=this.computeRenderTargetValidityBitfield();for(const oe of this.renderTargets.renderTargets)this.validTargets[oe.type]=!(oe.type===G.NH.ColorNoRasterImage&&!this._needsColorWithoutRasterImage)&&ie.drawTarget(this,oe,ue);return ce^this.computeRenderTargetValidityBitfield()?Q.Yg.CHANGED:Q.Yg.UNCHANGED}computeRenderTargetValidityBitfield(){const ie=this.validTargets;return+ie[G.NH.Color]|+ie[G.NH.ColorNoRasterImage]<<1|+ie[G.NH.Highlight]<<2|+ie[G.NH.Water]<<3|+ie[G.NH.Occluded]<<4}setupGeometryViewsCyclical(ie){this.setupGeometryViewsDirect();const ue=.001*ie.range;if(this._extent[0]-ue<=ie.min){const ce=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,A.cv)(this._extent,ie.range,0,ce)}if(this._extent[2]+ue>=ie.max){const ce=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,A.cv)(this._extent,-ie.range,0,ce)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,A.JG)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let ie=0;ie<this.canvasGeometries.numViews;ie++){const ue=this.canvasGeometries.extents[ie];if(ue[0]!==ue[2]&&ue[1]!==ue[3])return!0}return!1}applyViewport(ie){ie.setViewport(this.index===G.fu.INNER?0:this.resolution,0,this.resolution,this.resolution)}}function W(Z,ie,ue){return Math.min((0,x.Sf)(Math.max(Z,ie)+256),ue)}class B{constructor(){this.extents=[(0,A.Ue)(),(0,A.Ue)(),(0,A.Ue)()],this.numViews=0}}},64835:(dt,Re,T)=>{"use strict";T.d(Re,{Rn:()=>ze,CB:()=>Ke,Qi:()=>et});var x=T(15861),A=T(17626),G=T(14517),Q=T(61885),H=T(72392),re=T(88159),J=T(62208),W=T(77029),B=T(32917),Z=T(28862),ie=T(77712),le=(T(85931),T(8314),T(90912),T(76898)),Y=T(28347),j=T(28093),X=T(59617),U=T(62600),ee=T(93605),$=T(75224),ne=T(61034),se=T(9545),ae=T(67969),de=T(85775);class _e{constructor(ot,at){this.size=(0,se.c)(),this._fbo=null,this._fbo=new de.X(ot,{colorTarget:ae.Lm.TEXTURE,depthStencilTarget:ae.OU.NONE},{target:ae.No.TEXTURE_2D,pixelFormat:ae.VI.RGBA,dataType:ae.Br.UNSIGNED_BYTE,wrapMode:ae.e8.CLAMP_TO_EDGE,samplingMode:ae.cw.LINEAR_MIPMAP_LINEAR,hasMipmap:at,maxAnisotropy:8,width:0,height:0})}dispose(){this._fbo=(0,J.O3)(this._fbo)}getTexture(){return this._fbo?this._fbo.colorTexture:null}isValid(){return null!==this._fbo}resize(ot,at){this.size[0]=ot,this.size[1]=at,this._fbo.resize(this.size[0],this.size[1])}bind(ot){ot.bindFramebuffer(this._fbo)}generateMipMap(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()}disposeRenderTargetMemory(){var ot;null==(ot=this._fbo)||ot.resize(0,0)}get gpuMemoryUsage(){var ot,at;return null!=(at=null==(ot=this._fbo)?void 0:ot.gpuMemoryUsage)?at:0}}var pe=T(91263);class he{constructor(ot){const at=(yt,wt,zt=!0)=>({type:wt,fbo:new _e(ot,zt),renderPass:yt,valid:!1,lastUsed:1/0});this.renderTargets=[at(pe.C.MATERIAL,$.NH.Color),at(pe.C.MATERIAL,$.NH.ColorNoRasterImage),at(pe.C.MATERIAL_HIGHLIGHT,$.NH.Highlight,!1),at(pe.C.MATERIAL_NORMAL,$.NH.Water),at(pe.C.MATERIAL,$.NH.Occluded)]}getTarget(ot){return this.renderTargets[ot].fbo}dispose(){for(const ot of this.renderTargets)ot.fbo.dispose()}disposeRenderTargetMemory(){for(const ot of this.renderTargets)ot.fbo.disposeRenderTargetMemory()}validateUsageForTarget(ot,at,yt){if(ot)at.lastUsed=yt;else if(yt-at.lastUsed>ge)at.fbo.disposeRenderTargetMemory(),at.lastUsed=1/0;else if(at.lastUsed<1/0)return!0;return!1}get gpuMemoryUsage(){return this.renderTargets.reduce((ot,at)=>ot+at.fbo.gpuMemoryUsage,0)}}const ge=1e3;var ye=T(45323),Me=T(2286),Ee=T(42743),Te=T(59856),me=T(50907),Ce=T(19597),Ie=T(57851),Ge=T(40723),Je=T(64624),xe=T(5894),je=T(53319),We=T(14411),Ne=T(93783),we=T(80855),Oe=T(97825),$e=T(82244),Be=T(51899),Se=T(54580),De=T(87091),Fe=T(55086),ve=T(26906);let Ke=class extends((0,Me.TF)(G.Z)){constructor(ke){super(ke),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new H.Z,this._frameTask=De.sq,this._drapeSourceRenderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers=new W.Z,this._rctx=null,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.worldToPCSRatio=1,this.events=new Q.Z,this.longitudeCyclical=null}get _bindParameters(){return this._renderContext.bindParameters}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}initialize(){const ke=this.view._stage.renderView;this._rctx=ke.renderingContext;const ot=ke.waterTextureRepository;this._stippleTextureRepository=new Be.h(ke.renderingContext),this._shaderTechniqueRepository=new ye.M({rctx:this._rctx,viewingMode:X.JY.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:ot}),this._renderContext=new Je.Y(this._rctx,new je.l(this._rctx,this.view.state.viewingMode),new Ne.L(this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([(0,B.YP)(()=>ot.updating,()=>this.events.emit("content-changed"),B.tX),(0,B.YP)(()=>this.spatialReference,at=>this._localOriginFactory=new Ie.C(at),B.tX),(0,B.on)(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new me.h(ke.textureRepository,this._shaderTechniqueRepository,at=>{(at.renderOccluded&et)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating")},()=>this.events.emit("content-changed")),this._bindParameters.slot=xe.r.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=(0,Ce.hf)(this._rctx),this._bindParameters.camera=Ye,this._bindParameters.transparencyPassType=Ee.Am.NONE,this._bindParameters.lighting.groundLightingFactor=1,this._bindParameters.lighting.globalFactor=0,this._bindParameters.lighting.set([new $e.Mi((0,j.f)(1,1,1))]),this._frameTask=this.view.resourceController.scheduler.registerTask(De.T8.STAGE,this),this._handles.add(this._frameTask)}dispose(){this._handles.destroy(),this._drapeSourceRenderers.forEach(ke=>ke.destroy()),this._drapeSourceRenderers.clear(),this._debugTextureTechnique=(0,J.RY)(this._debugTextureTechnique),this._debugPatternTexture=(0,J.O3)(this._debugPatternTexture),this._bindParameters.highlightDepthTexture=(0,J.O3)(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=(0,J.O3)(this._shaderTechniqueRepository),this._temporaryFBO=(0,J.O3)(this._temporaryFBO),this._quadVAO=(0,J.O3)(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||(0,re.oE)(this._drapeSourceRenderers,ke=>ke.updating)}get hasOverlays(){return(0,J.pC)(this._overlays)&&(0,J.pC)(this._overlayRenderTarget)}get gpuMemoryUsage(){return(0,J.pC)(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(ke){return this.createDrapeSourceRenderer(ke,We.S)}createDrapeSourceRenderer(ke,ot,at){const yt=this._drapeSourceRenderers.get(ke);(0,J.pC)(yt)&&yt.destroy();const wt=new ot(yi(or({},at),{rendererContext:this,drapeSource:ke}));return this._drapeSourceRenderers.set(ke,wt),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in ke&&this._handles.add((0,B.YP)(()=>ke.fullOpacity,()=>this.events.emit("content-changed")),ke),wt}removeDrapeSourceRenderer(ke){if((0,J.Wi)(ke))return;const ot=this._drapeSourceRenderers.get(ke);(0,J.Wi)(ot)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(ke),this._handles.remove(ke),ot.destroy())}collectUnusedRenderTargetMemory(ke){let ot=!1;if((0,J.pC)(this._overlayRenderTarget))for(const at of this._overlayRenderTarget.renderTargets)ot=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[at.type]||!this.overlays[1].validTargets[at.type],at,ke)||ot;return ot}get overlays(){return(0,J.Pt)(this._overlays,[])}ensureDrapeTargets(ke){(0,J.pC)(this._overlays)&&this._overlays.forEach(ot=>{ot.hasTargetWithoutRasterImage=(0,Z.f)(ke,at=>at.drapeTargetType===U.a.WithoutRasterImage)})}ensureDrapeSources(ke){(0,J.pC)(this._overlays)&&this._overlays.forEach(ot=>{ot.hasDrapedFeatureSource=(0,Z.f)(ke,at=>at.drapeSourceType===U.L.Features),ot.hasDrapedRasterSource=(0,Z.f)(ke,at=>at.drapeSourceType===U.L.RasterImage)})}ensureOverlays(ke,ot){(0,J.Wi)(this._overlays)&&(this._overlayRenderTarget=new he(this._rctx),this._overlays=[new ne.aV($.fu.INNER,this._overlayRenderTarget),new ne.aV($.fu.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(ke),this.ensureDrapeSources(ot)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=(0,J.O3)(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(ke,ot=(()=>!0)){this._frameTask.processQueue(ke),ke.done||this._processDrapeSources(ke,ot)}_processDrapeSources(ke,ot){let at=!1;for(const[yt,wt]of this._drapeSourceRenderers){if(ke.done)break;(yt.destroyed||ot(yt))&&wt.commitChanges()&&(at=!0,ke.madeProgress())}this._updateSortedDrapeSourceRenderers(),at&&((0,J.pC)(this._overlays)&&0===this._drapeSourceRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(De.G5,ke=>ke.updatePolicy===Ee.jq.SYNC)}isEmpty(){if(ee.Z.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;for(const ke of this._drapeSourceRenderers.values())if(!ke.isEmpty)return!1;return!0}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(ke){let ot=!1;return this._drapeSourceRenderers.forEach(at=>ot=at.updateAnimation(ke)||ot),ot}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(ke,ot,at){const yt=ke.canvasGeometries;if(0===yt.numViews)return!1;this._screenToWorldRatio=at*ke.mapUnitsPerPixel;const wt=ot.renderPass;if(this.isEmpty()||wt===pe.C.MATERIAL_HIGHLIGHT&&!this.hasHighlights||wt===pe.C.MATERIAL_NORMAL&&!this.hasWater||!ke.hasSomeSizedView())return!1;const zt=ot.fbo;if(!zt.isValid())return!1;const Rt=2*ke.resolution,Ft=ke.resolution;zt.resize(Rt,Ft);const bt=this._rctx;Ye.pixelRatio=ke.pixelRatio*at,this._renderContext.pass=wt,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=wt===pe.C.MATERIAL_NORMAL?xe.r.DRAPED_WATER:xe.r.DRAPED_MATERIAL,ke.applyViewport(this._rctx),zt.bind(bt),ke.index===$.fu.INNER&&(bt.setClearColor(0,0,0,0),bt.clearSafe(ae.lk.COLOR_BUFFER_BIT));const St=ot.type===$.NH.ColorNoRasterImage?qe.ExcludeRasterImage:ot.type===$.NH.Occluded?qe.OccludedOnly:qe.Normal;if(St===qe.OccludedOnly&&(this._renderContext.renderOccludedMask=et),ee.Z.OVERLAY_DRAW_DEBUG_TEXTURE&&St!==qe.OccludedOnly)for(let Xt=0;Xt<yt.numViews;Xt++)this._setViewParameters(yt.extents[Xt],ke,Ye),this._drawDebugTexture(ke.resolution,tt[ke.index]);return this._drapeSourceRenderers.size>0&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:Xt,renderer:Mr})=>{if(St===qe.ExcludeRasterImage&&Xt.drapeSourceType===U.L.RasterImage)return;const{fullOpacity:Cr}=Xt,Yr=(0,J.pC)(Cr)&&Cr<1&&wt===pe.C.MATERIAL;Yr&&(this.bindTemporaryFramebuffer(this._rctx,Rt,Ft),bt.clearSafe(ae.lk.COLOR_BUFFER_BIT));for(let Lr=0;Lr<yt.numViews;Lr++)this._setViewParameters(yt.extents[Lr],ke,Ye),Mr.render(this._renderContext,this._bindParameters);Yr&&(0,J.pC)(this._temporaryFBO)&&(zt.bind(bt),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),Se.Fv.PremultipliedAlpha,Cr,Se.v3.OverlayWithTransparency,ke.index))}),bt.bindFramebuffer(null),zt.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(ke,ot,at){(0,J.Wi)(this._temporaryFBO)&&(this._temporaryFBO=new _e(ke,!1)),this._temporaryFBO.resize(ot,at),this._temporaryFBO.bind(ke)}reloadShaders(){var ke=this;return(0,x.Z)(function*(){yield ke._shaderTechniqueRepository.reloadAll()})()}notifyContentChanged(){this.events.emit("content-changed")}intersect(ke,ot,at,yt){var zt,Rt;let wt=0;for(const Ft of this._drapeSourceRenderers.values())wt=null!=(Rt=null==(zt=Ft.intersect)?void 0:zt.call(Ft,ke,ot,at,yt,wt))?Rt:wt}_updateSortedDrapeSourceRenderers(){if(!this._sortedDrapeSourceRenderersDirty||(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),0===this._drapeSourceRenderers.size))return;const ke=this.view.map.allLayers;this._drapeSourceRenderers.forEach((ot,at)=>{const yt=ke.indexOf(at.layer);this._sortedDrapeSourceRenderers.push(new be(at,ot,yt<0?1/0:yt))}),this._sortedDrapeSourceRenderers.sort((ot,at)=>ot.index-at.index)}_setViewParameters(ke,ot,at){at.viewport[0]=at.viewport[1]=0,at.viewport[2]=at.viewport[3]=ot.resolution,(0,Y.q)(at.projectionMatrix,0,ke[2]-ke[0],0,ke[3]-ke[1],at.near,at.far),(0,Y.f)(at.viewMatrix,[-ke[0],-ke[1],0]),this._bindParameters.camera=at}_updateHasWater(){const ke=(0,re.oE)(this._drapeSourceRenderers,ot=>ot.hasWater);ke!==this._hasWater&&(this._hasWater=ke,this.events.emit("has-water",ke))}_updateHasHighlights(){const ke=(0,re.oE)(this._drapeSourceRenderers,ot=>ot.hasHighlights);ke!==this._hasHighlights&&(this._hasHighlights=ke,this.events.emit("has-highlights",ke))}_updateRendersOccluded(){const ke=(0,re.oE)(this._drapeSourceRenderers,ot=>ot.rendersOccluded);ke!==this._rendersOccluded&&(this._rendersOccluded=ke,this.events.emit("renders-occluded",ke))}_drawDebugTexture(ke,ot){this._ensureDebugPatternResources(ke,ke);const at=this._rctx,yt=at.bindTechnique(this._debugTextureTechnique);yt.setUniform4f("uColor",ot[0],ot[1],ot[2],1),yt.bindTexture("tex",this._debugPatternTexture),at.bindVAO(this._quadVAO),at.drawArrays(ae.MX.TRIANGLE_STRIP,0,(0,ve._V)(this._quadVAO,"geometry"))}_ensureDebugPatternResources(ke,ot){if(this._debugPatternTexture)return;const at=new Uint8Array(ke*ot*4);let yt=0;for(let zt=0;zt<ot;zt++)for(let Rt=0;Rt<ke;Rt++){const Ft=Math.floor(Rt/10),bt=Math.floor(zt/10);Ft<2||bt<2||10*Ft>ke-20||10*bt>ot-20?(at[yt++]=255,at[yt++]=255,at[yt++]=255,at[yt++]=255):(at[yt++]=255,at[yt++]=255,at[yt++]=255,at[yt++]=1&Ft&&1&bt?1&Rt^1&zt?0:255:1&Ft^1&bt?0:128)}this._debugPatternTexture=new Fe.x(this._rctx,{target:ae.No.TEXTURE_2D,pixelFormat:ae.VI.RGBA,dataType:ae.Br.UNSIGNED_BYTE,samplingMode:ae.cw.NEAREST,width:ke,height:ot},at);const wt=new Oe.V;wt.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(we.K,wt),this._quadVAO=(0,Ce.ow)(this._rctx)}get test(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:ke=>this._drapeSourceRenderers.get(ke)}}};var qe,ke;(0,A._)([(0,ie.Cb)()],Ke.prototype,"_frameTask",void 0),(0,A._)([(0,ie.Cb)()],Ke.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,A._)([(0,Me.gT)()],Ke.prototype,"_shaderTechniqueRepository",void 0),(0,A._)([(0,Me.gT)()],Ke.prototype,"_stippleTextureRepository",void 0),(0,A._)([(0,ie.Cb)({constructOnly:!0})],Ke.prototype,"view",void 0),(0,A._)([(0,ie.Cb)()],Ke.prototype,"worldToPCSRatio",void 0),(0,A._)([(0,ie.Cb)()],Ke.prototype,"spatialReference",void 0),(0,A._)([(0,ie.Cb)({type:Boolean,readOnly:!0})],Ke.prototype,"updating",null),Ke=(0,A._)([(0,le.j)("esri.views.3d.terrain.OverlayRenderer")],Ke),(ke=qe||(qe={}))[ke.Normal=0]="Normal",ke[ke.OccludedOnly=1]="OccludedOnly",ke[ke.ExcludeRasterImage=2]="ExcludeRasterImage";class be{constructor(ot,at,yt){this.drapeSource=ot,this.renderer=at,this.index=yt}}const tt=[[1,.5,.5],[.5,.5,1]],Ye=new Te.V;Ye.near=1,Ye.far=1e4,Ye.relativeElevation=null;const ze=-2,et=Ge.yD.OccludeAndTransparent},31498:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>re});var x=T(62208),A=T(44796),G=T(67969),Q=T(38982);const H={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};class re{constructor(W,B,Z=null,ie=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=W,this.source=B,this.width=Z||B.width,this.height=ie||B.height}get source(){return this._source}set source(W){this._source=W,this._rasterTexture=(0,x.O3)(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?yi(or({},H),{maxCutOff:[1,1,1],factor:[1,1,1]}):this._symbolizerParameters||H}set symbolizerParameters(W){this._symbolizerParameters=W}get bandIds(){return this._bandIds}set bandIds(W){(0,x.pC)(W)&&W.length>0?this._bandIds&&W.every((B,Z)=>!!this._bandIds[Z]&&B===this._bandIds[Z])||(this._bandIds=W,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(W){if(this._interpolation=W,(0,x.pC)(this._rasterTexture)){const B=this._getRasterTextureInterpolation(W);this._rasterTexture.setSamplingMode("bilinear"===B?G.cw.LINEAR:G.cw.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(W){this._transformGrid=W,this._transformGridTexture=(0,x.O3)(this._transformGridTexture),this._memoryUsed=null}bind(W){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&(((0,x.Wi)(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(W,this.bandIds),(0,x.pC)(this._rasterTexture)&&(this._updateColormapTexture(W),this.transformGrid&&(0,x.Wi)(this._transformGridTexture)&&(this._transformGridTexture=(0,Q.Br)(W,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:W,transformGrid:B,width:Z,height:ie,opacity:ue}=this,ce=(0,Q.Tc)(B,[Z,ie],[this.source.width,this.source.height],ue),oe=(0,Q.Ue)(W.colormap,W.colormapOffset),le="stretch"===this.symbolizerParameters.type?(0,Q.xW)(this.symbolizerParameters):null,Y="hillshade"===this.symbolizerParameters.type?(0,Q.Fm)(this.symbolizerParameters):null;return new A.C(ce,oe,le||Y,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get memoryUsage(){return(0,x.Wi)(this._memoryUsed)&&(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(B=>(0,x.pC)(B)?B.descriptor.width*B.descriptor.height*4:0).reduce((B,Z)=>B+Z,0)),this._memoryUsed}release(){return this._rasterTexture=(0,x.O3)(this._rasterTexture),this._transformGridTexture=(0,x.O3)(this._transformGridTexture),this._colormapTexture=(0,x.O3)(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(W,B){const Z=this.source?this.source.extractBands(B):null;if(!(Z&&Z.pixels&&Z.pixels.length>0))return void(this._rasterTexture=(0,x.O3)(this._rasterTexture));const ie=(0,x.Wi)(B)&&(0,x.Wi)(this.bandIds)||(0,x.pC)(B)&&(0,x.pC)(this.bandIds)&&B.join("")===this.bandIds.join("");if((0,x.pC)(this._rasterTexture)&&ie)return;this._rasterTexture=(0,x.O3)(this._rasterTexture);const ue=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=(0,Q.s9)(W,Z,ue,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType}_getRasterTextureInterpolation(W){return"lut"===this.symbolizerParameters.type||"nearest"===W||"majority"===W?"nearest":"bilinear"}_updateColormapTexture(W){const B=this._colormap,Z=this.symbolizerParameters.colormap;return Z?B?Z.length!==B.length||Z.some((ie,ue)=>ie!==B[ue])?(this._colormapTexture=(0,x.O3)(this._colormapTexture),this._colormapTexture=(0,Q.iC)(W,Z),void(this._colormap=Z)):void 0:(this._colormapTexture=(0,Q.iC)(W,Z),void(this._colormap=Z)):(this._colormapTexture=(0,x.O3)(this._colormapTexture),void(this._colormap=null))}}},10558:(dt,Re,T)=>{"use strict";T.d(Re,{$7:()=>W,$r:()=>H,DR:()=>J,HB:()=>re,L:()=>ie,Lz:()=>ce,Sx:()=>B,Tg:()=>oe,Vs:()=>Y,cy:()=>ue,iU:()=>le});var x=T(21286),A=T(65401),G=T(23461);const H=64,re=512,J=2.5,W=(0,x.oK)(x._3/10),B=4,ie=X=>X<4?3:4,ue=(0,A.Ue)();G.t.WebMercatorAuxiliarySphere.getExtent(0,0,0,ue);const ce=(0,A.Ue)([-180,-90,180,90]),oe="Cannot extend surface to encompass all layers because it would result in too many root tiles.",le="Surface extent is too large for tile resolution at level 0.",Y=8},23461:(dt,Re,T)=>{"use strict";T.d(Re,{_:()=>oe,t:()=>ce});var x=T(26584),A=T(21286),G=T(62208),Q=T(16730),H=T(2004),re=T(55915),J=T(65234),W=T(65401),B=T(37053),Z=T(46367),ie=T(2584);class ce{constructor(j){const X=ce.checkUnsupported(j);if((0,G.pC)(X))throw X;const U=(0,G.Wg)(j);this.spatialReference=U.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=(0,re.jF)(this.spatialReference)||(0,B.BZ)(this.spatialReference)||(0,B.V2)(this.spatialReference),this.origin=[U.origin.x,U.origin.y],this.pixelSize=U.size[0],this.dpi=U.dpi;const ee=U.lods.reduce((de,_e,pe)=>(_e.level<de.min&&(de.min=_e.level,de.minIndex=pe),de.max=Math.max(de.max,_e.level),de),{min:1/0,minIndex:0,max:-1/0}),$=U.lods[ee.minIndex],ne=2**$.level;let se=$.resolution*ne,ae=$.scale*ne;this.levels=new Array(ee.max+1);for(let de=0;de<this.levels.length;de++)this.levels[de]={resolution:se,scale:ae,tileSize:[se*U.size[0],se*U.size[1]]},se/=2,ae/=2}clone(){return new ce(this.toTileInfo())}toTileInfo(){return new ie.Z({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((j,X)=>({level:X,scale:j.scale,resolution:j.resolution}))})}getExtent(j,X,U,ee){const $=this.levels[j],ne=$.tileSize[0],se=$.tileSize[1];ee[0]=this.origin[0]+U*ne,ee[2]=this.origin[0]+(U+1)*ne,ee[3]=this.origin[1]-X*se,ee[1]=this.origin[1]-(X+1)*se}convertExtentToRadians(j,X){this._isWebMercator?(X[0]=(0,Z.tp)(j[0]),X[1]=(0,Z.mZ)(j[1]),X[2]=(0,Z.tp)(j[2]),X[3]=(0,Z.mZ)(j[3])):this._isGCS&&(X[0]=(0,A.Vl)(j[0]),X[1]=(0,A.Vl)(j[1]),X[2]=(0,A.Vl)(j[2]),X[3]=(0,A.Vl)(j[3]))}getExtentGeometry(j,X,U,ee=new H.Z){return this.getExtent(j,X,U,le),ee.spatialReference=this.spatialReference,ee.xmin=le[0],ee.ymin=le[1],ee.xmax=le[2],ee.ymax=le[3],ee.zmin=void 0,ee.zmax=void 0,ee}ensureMaxLod(j){if(null==j)return!1;let X=!1;for(;this.levels.length<=j;){const U=this.levels[this.levels.length-1],ee=U.resolution/2;this.levels.push({resolution:ee,scale:U.scale/2,tileSize:[ee*this.pixelSize,ee*this.pixelSize]}),X=!0}return X}capMaxLod(j){this.levels.length>j+1&&(this.levels.length=j+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(j){return this.levels[0].scale/2**j}levelAtScale(j){const X=this.levels[0].scale;return j>=X?0:Math.log(X/j)*Math.LOG2E}resolutionAtLevel(j){return this.levels[0].resolution/2**j}compatibleWith(j){if(!(j instanceof ce)){if(ce.checkUnsupported(j))return!1;j=new ce(j)}if(!j.spatialReference.equals(this.spatialReference)||j.pixelSize!==this.pixelSize)return!1;const X=Math.min(this.levels.length,j.levels.length)-1,U=this.levels[X].resolution;let ee=.5*U;return!(!(0,A.W8)(j.origin[0],this.origin[0],ee)||!(0,A.W8)(j.origin[1],this.origin[1],ee))&&(ee=.5*U/2**X/this.pixelSize*12,(0,A.W8)(U,j.levels[X].resolution,ee))}rootTilesInExtent(j,X=null,U=1/0){const ee=new Array,$=this.levels[0].tileSize;if((0,G.Wi)(j)||0===$[0]||0===$[1])return ee;ce.computeRowColExtent(j,$,this.origin,le);let ne=le[1],se=le[3],ae=le[0],de=le[2];const _e=de-ae,pe=se-ne;if(_e*pe>U){const he=Math.floor(Math.sqrt(U));pe>he&&(ne=ne+Math.floor(.5*pe)-Math.floor(.5*he),se=ne+he),_e>he&&(ae=ae+Math.floor(.5*_e)-Math.floor(.5*he),de=ae+he)}for(let he=ne;he<se;he++)for(let ge=ae;ge<de;ge++)ee.push([0,he,ge]);return(0,G.pC)(X)&&(X[0]=this.origin[0]+ae*$[0],X[1]=this.origin[1]-se*$[1],X[2]=this.origin[0]+de*$[0],X[3]=this.origin[1]-ne*$[1]),ee}static computeRowColExtent(j,X,U,ee){const $=.001*(j[2]-j[0]+(j[3]-j[1]));ee[0]=Math.max(0,Math.floor((j[0]+$-U[0])/X[0])),ee[2]=Math.max(0,Math.ceil((j[2]-$-U[0])/X[0])),ee[1]=Math.max(0,Math.floor((U[1]-j[3]+$)/X[1])),ee[3]=Math.max(0,Math.ceil((U[1]-j[1]-$)/X[1]))}static isPowerOfTwo(j){const X=j.lods,U=X[0].resolution*2**X[0].level;return!X.some(ee=>!(0,A.Y8)(ee.resolution,U/2**ee.level))}static hasGapInLevels(j){const X=j.lods.map(U=>U.level);X.sort((U,ee)=>U-ee);for(let U=1;U<X.length;U++)if(X[U]!==X[0]+U)return!0;return!1}static tileSizeSupported(j){const X=j.size[1];return X===j.size[0]&&0==(X&X-1)&&X>=128&&X<=512}static hasOriginPerLODs(j){const X=j.origin;return j.lods.some(U=>null!=U.origin&&(U.origin[0]!==X.x||U.origin[1]!==X.y))}static getMissingTileInfoError(){return new x.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(j){return(0,G.Wi)(j)?oe():j.lods.length<1?new x.Z("tilingscheme:generic","Tiling scheme must have at least one level"):ce.isPowerOfTwo(j)?ce.hasGapInLevels(j)?new x.Z("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):ce.tileSizeSupported(j)?ce.hasOriginPerLODs(j)?new x.Z("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new x.Z("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new x.Z("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(j,X){const U=j[2]-j[0],ee=j[3]-j[1],$=(0,Q.c9)(X),ne=1.2*Math.max(U,ee),_e=new ce(new ie.Z({size:[256,256],origin:{x:j[0]-.5*(ne-U),y:j[3]+.5*(ne-ee)},lods:[{level:0,resolution:ne/256,scale:1/(256/96*.0254/(ne*$))}],spatialReference:X}));return _e.ensureMaxLod(20),_e}static makeWebMercatorAuxiliarySphere(j){const X=new ce(ce.WebMercatorAuxiliarySphereTileInfo);return X.ensureMaxLod(j),X}static makeGCSWithTileSize(j,X=256,U=16){const ee=256/X,$=new ce(new ie.Z({size:[X,X],origin:{x:-180,y:90,spatialReference:j},spatialReference:j,lods:[{level:0,resolution:.703125*ee,scale:295497598.570834*ee}]}));return $.ensureMaxLod(U),$}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}function oe(){return new x.Z("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}ce.WebMercatorAuxiliarySphereTileInfo=new ie.Z({size:[256,256],origin:{x:-20037508.342787,y:20037508.342787,spatialReference:J.Z.WebMercator},spatialReference:J.Z.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:591657527.591555}]}),ce.WebMercatorAuxiliarySphere=ce.makeWebMercatorAuxiliarySphere(19);const le=(0,W.Ue)()},75224:(dt,Re,T)=>{"use strict";var x,A,G,Q,H,re,J;T.d(Re,{NH:()=>H,Ns:()=>re,VB:()=>Q,Xo:()=>G,fu:()=>x,tk:()=>A}),(J=x||(x={}))[J.INNER=0]="INNER",J[J.OUTER=1]="OUTER",function(J){J[J.REGULAR=0]="REGULAR",J[J.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",J[J.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",J[J.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(A||(A={})),function(J){J[J.NORTH=0]="NORTH",J[J.NORTH_EAST=1]="NORTH_EAST",J[J.EAST=2]="EAST",J[J.SOUTH_EAST=3]="SOUTH_EAST",J[J.SOUTH=4]="SOUTH",J[J.SOUTH_WEST=5]="SOUTH_WEST",J[J.WEST=6]="WEST",J[J.NORTH_WEST=7]="NORTH_WEST"}(G||(G={})),function(J){J[J.OFF=0]="OFF",J[J.ON=1]="ON"}(Q||(Q={})),function(J){J[J.Color=0]="Color",J[J.ColorNoRasterImage=1]="ColorNoRasterImage",J[J.Highlight=2]="Highlight",J[J.Water=3]="Water",J[J.Occluded=4]="Occluded"}(H||(H={})),function(J){J[J.FADING=0]="FADING",J[J.IMMEDIATE=1]="IMMEDIATE",J[J.UNFADED=2]="UNFADED"}(re||(re={}))},61779:(dt,Re,T)=>{"use strict";T.d(Re,{XJ:()=>Te,er:()=>tt,RB:()=>Ie,E_:()=>Ye,Fp:()=>Ce,TK:()=>Oe,Eu:()=>St,_1:()=>Ne,CY:()=>we,sR:()=>Je,Ay:()=>De,GL:()=>$e,Mw:()=>Mr,wt:()=>Ft,x4:()=>Ge,L4:()=>Ke,uv:()=>Xt,wP:()=>Be,xk:()=>Se,z7:()=>ve,FH:()=>xe,Q:()=>je,Ke:()=>Fe,OD:()=>bt,_0:()=>Rt,cA:()=>Yr,OC:()=>Cr,$v:()=>wt,_F:()=>zt,z4:()=>qe,Bu:()=>ke,FZ:()=>be,jO:()=>et,wu:()=>Me});var x=T(46160),A=T(94573),G=T(62208),Q=T(37053),H=T(72469),re=T(59617),J=T(91540),W=T(75224),B=T(26584),Z=T(84161),ie=T(28093),ue=T(55915),ce=T(65401),oe=T(10558),le=T(23461);const Y=(0,ie.c)(),j=(0,ie.c)(),X=(0,ie.c)(),U=(0,ie.c)();function $(ct,jt,qt,er){(0,Z.c)(Y,qt),Y[er]=jt[er];const Zt=(0,Z.b)(Y,Y,jt),tr=(0,Z.b)(j,ct,jt),ir=(0,Z.e)(tr,Zt),fr=(0,Z.e)(Zt,Zt);let Ur;Ur=ir<=0?jt:fr<=ir?qt:(0,Z.a)(Y,jt,(0,Z.g)(Zt,Zt,ir/fr));const Br=(0,Z.b)(Y,ct,Ur);return Math.PI/2-Math.atan(Br[2]/Math.sqrt(Br[0]*Br[0]+Br[1]*Br[1]))}const de=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:function ee(ct,jt,qt=0){const er=ct.extent;if((0,G.Wi)(er))return!1;if(0===qt)return(0,ce.BD)(er,jt);const Zt=Math.min(er[2]-er[0],er[3]-er[1]);return(0,ce.Zm)(er,jt,qt*Zt)},tiltToExtentEdge:function ne(ct,jt,qt){const er=ct.extent;if((0,G.Wi)(er))return 0;X[0]=er[0],X[1]=er[1],X[2]=qt,U[0]=er[2],U[1]=er[3],U[2]=qt;let Zt=1/0,tr=1/0;return jt[0]<X[0]?Zt=$(jt,X,U,0):jt[0]>U[0]&&(Zt=$(jt,U,X,0)),jt[1]<X[1]?tr=$(jt,X,U,1):jt[1]>U[1]&&(tr=$(jt,U,X,1)),Math.min(Zt,tr)},checkIfTileInfoSupportedForViewSR:function se(ct,jt,qt){if((0,G.Wi)(ct))return(0,le._)();if(ct.spatialReference.isGeographic&&!(0,ue.jF)(ct.spatialReference))return new B.Z("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const er=le.t.checkUnsupported(ct);if((0,G.pC)(er))return er;if((0,G.Wi)(qt))return new B.Z("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const Zt=function ae(ct,jt){const qt=ct.lods,er=qt[0].resolution*2**qt[0].level,Zt=[er*ct.size[0],er*ct.size[1]],tr=[ct.origin.x,ct.origin.y],ir=(0,ce.oJ)(jt),fr=(0,ce.Ue)();le.t.computeRowColExtent(ir,Zt,tr,fr);const Ur=(fr[2]-fr[0])*(fr[3]-fr[1]);if(Ur>oe.$r){const Br=qt[0].scale*2**qt[0].level;let Zr=Math.max((ir[3]-ir[1])/ct.size[1],(ir[2]-ir[0])/ct.size[0])*Br/er;const ri=Math.floor(Math.log(Zr)/Math.log(10));return Zr=Math.ceil(Zr/10**ri)*10**ri,new B.Z("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(Br).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+Zr.toLocaleString()+".",{level0Scale:Br,suggestedLevel0Scale:Zr,requiredNumRootTiles:Ur,allowedNumRootTiles:oe.$r})}return null}(ct,qt);if(Zt)return Zt;const tr=ct.spatialReference;return(0,G.pC)(jt)&&!(tr.equals(jt)||jt.isWGS84&&tr.isWebMercator)?new B.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}},Symbol.toStringTag,{value:"Module"})),ge=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:function _e(){return!0},tiltToExtentEdge:function pe(){return 0},checkIfTileInfoSupportedForViewSR:function he(ct,jt){if((0,G.Wi)(ct))return(0,le._)();const qt=ct.lods.length-1,er=ct.spatialReference,Zt=(0,ue.jF)(er)||(0,Q.BZ)(er)||(0,Q.V2)(er);if(er.isWebMercator){if(!le.t.makeWebMercatorAuxiliarySphere(qt).compatibleWith(ct))return new B.Z("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!Zt)return new B.Z("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!le.t.makeGCSWithTileSize(ct.spatialReference,ct.size[0],qt).compatibleWith(ct))return ct.spatialReference.isWGS84?new B.Z("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new B.Z("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return(0,G.pC)(jt)&&!ct.spatialReference.equals(jt)?new B.Z("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene"):void 0}},Symbol.toStringTag,{value:"Module"})),ye={[re.JY.Global]:ge,[re.JY.Local]:de};function Me(ct,jt){ct||console.warn("Terrain: "+jt)}let Te=!1;function Ce(ct,jt){}function Ie(ct){return Je(ct)?{fullExtent:ct.fullExtent,minScale:ct.layer.minScale,maxScale:ct.layer.maxScale,tilemapCache:null}:ct.layer}function Ge(ct){return"imagery-tile"===(null==ct?void 0:ct.type)||"wcs"===(null==ct?void 0:ct.type)}function Je(ct){return"imagery-tile-3d"===(null==ct?void 0:ct.type)}function xe(ct){return"tile-3d"===(null==ct?void 0:ct.type)}function je(ct){return"vector-tile-3d"===(null==ct?void 0:ct.type)}function We(ct){return"wmts-3d"===(null==ct?void 0:ct.type)}function Ne(ct){return"elevation-3d"===(null==ct?void 0:ct.type)}function we(ct){return"group"===(null==ct?void 0:ct.type)}function Oe(ct){return ct&&(xe(ct)||We(ct)||Je(ct)||je(ct))}function $e(ct){return ct&&(xe(ct)||Je(ct)||je(ct)||We(ct))}function Be(ct){return $e(ct)||Ne(ct)}function Se(ct){switch(ct.type){case"building-scene":case"csv":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"line-of-sight":case"map-notes":case"ogc-feature":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,A.Bg)(ct.type),!1}}function De(ct){var qt;const jt=null==(qt=null==ct?void 0:ct.sourceLayerInfo)?void 0:qt.data;return(0,G.pC)(jt)&&"type"in jt&&"raster-tile"===jt.type}function Fe(ct){var qt;const jt=null==(qt=null==ct?void 0:ct.sourceLayerInfo)?void 0:qt.data;return(0,G.pC)(jt)&&"type"in jt&&"vector-tile"===jt.type}function ve(ct){var qt;const jt=null==(qt=null==ct?void 0:ct.sourceLayerInfo)?void 0:qt.data;return(0,G.pC)(jt)&&"type"in jt&&"tile-texture"===jt.type}function Ke(ct){var qt;const jt=null==(qt=null==ct?void 0:ct.sourceLayerInfo)?void 0:qt.data;return jt instanceof HTMLImageElement||jt instanceof J.nN||jt instanceof HTMLCanvasElement||jt instanceof ImageData}function qe(ct){return(0,G.pC)(ct)&&"release"in ct&&ct.release(),null}function be(ct){return ct.fetchTile&&!1!==ct.hasOverriddenFetchTile}function tt(ct,jt,qt,er){return ye[er].checkIfTileInfoSupportedForViewSR(ct,qt,jt)}function Ye(ct,jt,qt){let er=null,Zt=null;if("wmts"===(null==ct?void 0:ct.type)){const tr=function ze(ct,jt,qt){const er=(0,H.mt)(ct);if((0,G.pC)(er)){if(!x.Z.isCollection(er))return{tileInfo:er.tileInfo,fullExtent:er.fullExtent};{const Zt=er.find(tr=>null==tt(tr.tileInfo,tr.fullExtent,jt,qt));if(Zt)return{tileInfo:Zt.tileInfo,fullExtent:Zt.fullExtent}}}return{tileInfo:null,fullExtent:null}}(ct,jt,qt);er=tr.tileInfo,Zt=tr.fullExtent}else{Zt=Ge(ct)?ct.getCompatibleFullExtent(jt):ct.fullExtent;const tr=qt===re.JY.Local;if(Ge(ct))er=ct.getCompatibleTileInfo(jt,Zt,tr);else if("vector-tile"===(null==ct?void 0:ct.type)){const ir=tr&&!et(jt)||ke.force512VTL,fr=ct.tileInfo.spatialReference.isGeographic;er=ir?ct.tileInfo:ct.tileInfo.getOrCreateCompatible(256,fr?1:2)}else er=ct.tileInfo}return(0,G.pC)(er)&&(0,G.pC)(Zt)&&null==tt(er,Zt,jt,qt)?{tileInfo:er,fullExtent:Zt}:null}function et(ct){return ct.isWGS84||ct.isWebMercator||(0,Q.yW)(ct)||!(0,Q.N$)(ct)}const ke={force512VTL:!1};function wt(ct){return ct===W.Xo.NORTH_EAST?W.Xo.SOUTH_WEST:ct===W.Xo.NORTH_WEST?W.Xo.SOUTH_EAST:ct===W.Xo.SOUTH_WEST?W.Xo.NORTH_EAST:W.Xo.NORTH_WEST}function zt(ct){return ct===W.Xo.NORTH?W.Xo.SOUTH:ct===W.Xo.EAST?W.Xo.WEST:ct===W.Xo.SOUTH?W.Xo.NORTH:W.Xo.EAST}function Rt(ct){return ct===W.Xo.NORTH_WEST||ct===W.Xo.SOUTH_WEST}function Ft(ct){return ct===W.Xo.NORTH_WEST||ct===W.Xo.NORTH_EAST}function bt(ct){return ct===W.Xo.NORTH_WEST||ct===W.Xo.WEST||ct===W.Xo.SOUTH_WEST}function St(ct){return ct===W.Xo.NORTH_EAST||ct===W.Xo.EAST||ct===W.Xo.SOUTH_EAST}function Xt(ct){return ct===W.Xo.SOUTH_EAST||ct===W.Xo.SOUTH||ct===W.Xo.SOUTH_WEST}function Mr(ct){return ct===W.Xo.NORTH_EAST||ct===W.Xo.NORTH||ct===W.Xo.NORTH_WEST}const Cr=[W.Xo.NORTH,W.Xo.EAST,W.Xo.SOUTH,W.Xo.WEST],Yr=[W.Xo.NORTH_EAST,W.Xo.SOUTH_EAST,W.Xo.SOUTH_WEST,W.Xo.NORTH_WEST]},15076:(dt,Re,T)=>{"use strict";T.d(Re,{AA:()=>G,E9:()=>oe,QT:()=>ue,b:()=>ie,dF:()=>Z,rv:()=>Q,t8:()=>ce,yf:()=>J,zW:()=>B});var x=T(62208),A=T(77029);class G{constructor(){this._queue=new A.Z,this._last=null,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}resetOne(Y){this._queue.clear(),this._queue.push(Y),this._last=null}reset(Y=null){this._queue.clear(),(0,x.pC)(Y)&&this._queue.pushArray(Y),this._last=null}skipSubtree(){this._last=null}next(){return this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children),this._last=this._queue.pop(),this._last}}class Q{constructor(){this.q=new A.Z}get done(){return 0===this.q.length}reset(Y){if(this.q.clear(),!(0,x.Wi)(Y)){this.q.pushArray(Y);for(let j=0;j<this.q.length;++j){const X=this.q.data[j];X.isLeaf||this.q.pushArray(X.children)}}}next(){return this.q.pop()}}function J(le,Y,j){if((0,x.Wi)(Y)||(0,x.Wi)(Y.fullExtent))return!1;const X=Y.fullExtent,U=le.extent;if(j){if(U[0]<X.xmin||U[1]<X.ymin||U[2]>X.xmax||U[3]>X.ymax)return!1}else if(X.xmin>U[2]||X.ymin>U[3]||X.xmax<U[0]||X.ymax<U[1])return!1;const ee=le.surface.tilingScheme.levels[le.level].scale;return!(Y.minScale>0&&ee>1.00000001*Y.minScale||Y.maxScale>0&&ee<.99999999*Y.maxScale)}function W(le,Y){return le.lij[0]-Y.lij[0]||le.lij[1]-Y.lij[1]||le.lij[2]-Y.lij[2]}function B(le,Y){Y.sort((j,X)=>Z(j,X,le))}function Z(le,Y,j){const X=le.screenDepth,U=Y.screenDepth;return X<U?-j:X>U?j:W(le,Y)}function ie(le,Y){const j=new Map;le.forAll(X=>j.set(X.lij,X.distanceToSquared(Y))),le.sort((X,U)=>j.get(X.lij)-j.get(U.lij)||W(X,U))}function ue(le,Y,j){let X=1,U=0,ee=0;for(;le!==Y;)if(X*=.5,U*=.5,ee*=.5,1&le.lij[2]&&(U+=.5),0==(1&le.lij[1])&&(ee+=.5),null==(le=le.parent))throw new Error("tile was not a descendant of upsampleTile");j.init(Y,U,ee,X)}function ce(le){for(let Y=0;Y<le.length;Y++){const j=le[Y],X=j.parent;if(X)for(let U=0;U<4;U++){const ee=X.children[U];if(ee&&ee!==j&&ee.loadable)return!0}}return!1}function oe(le,Y){if(!le||!Y||le[0]===Y[0])return!1;const j=le[0]<Y[0],X=j?le:Y,U=j?Y:le,ee=1<<U[0]-X[0];return Math.floor(U[1]/ee)===X[1]&&Math.floor(U[2]/ee)===X[2]}},24225:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Q,c:()=>G});var Q,H,x=T(17626),A=T(2286);class G extends A.Xn{constructor(){super(...arguments),this.visible=Q.Hidden}}(0,x._)([(0,A.gT)()],G.prototype,"renderable",void 0),(0,x._)([(0,A.gT)()],G.prototype,"components",void 0),(H=Q||(Q={}))[H.Hidden=0]="Hidden",H[H.Visible=1]="Visible"},75550:(dt,Re,T)=>{"use strict";T.d(Re,{OH:()=>oe,_O:()=>le});var ce,oe,Y,x=T(17626),A=T(35357),G=T(50574),Q=T(6945),H=T(26859),re=T(36603),J=T(96395),W=T(92724),B=T(22799),Z=T(37847),ie=T(87601),ue=T(42743);(Y=ce||(ce={}))[Y.None=0]="None",Y[Y.Transparent=1]="Transparent",Y[Y.Opaque=2]="Opaque",Y[Y.COUNT=3]="COUNT",function(Y){Y[Y.None=0]="None",Y[Y.NoOverlay=1]="NoOverlay",Y[Y.ColorOverlay=2]="ColorOverlay",Y[Y.ColorOverlayWithWater=3]="ColorOverlayWithWater",Y[Y.COUNT=4]="COUNT"}(oe||(oe={}));class le extends ie.m{constructor(){super(...arguments),this.output=Q.H.Color,this.textureCoordinateType=re.N.None,this.componentData=A._N.Uniform,this.cullFace=ue.Vr.Back,this.vertexDiscardMode=G.a.None,this.doubleSidedMode=J.q.WindingOrder,this.alphaDiscardMode=ue.JJ.Opaque,this.integratedMeshMode=oe.None,this.transparencyPassType=ue.Am.NONE,this.ellipsoidMode=B.U.Earth,this.pbrMode=W.f7.Disabled,this.normalType=H.h.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.isGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1}}(0,x._)([(0,ie.o)({count:Q.H.COUNT})],le.prototype,"output",void 0),(0,x._)([(0,ie.o)({count:re.N.COUNT})],le.prototype,"textureCoordinateType",void 0),(0,x._)([(0,ie.o)({count:A._N.COUNT})],le.prototype,"componentData",void 0),(0,x._)([(0,ie.o)({count:ue.Vr.COUNT})],le.prototype,"cullFace",void 0),(0,x._)([(0,ie.o)({count:G.a.COUNT})],le.prototype,"vertexDiscardMode",void 0),(0,x._)([(0,ie.o)({count:J.q.COUNT})],le.prototype,"doubleSidedMode",void 0),(0,x._)([(0,ie.o)({count:ue.JJ.COUNT})],le.prototype,"alphaDiscardMode",void 0),(0,x._)([(0,ie.o)({count:oe.COUNT})],le.prototype,"integratedMeshMode",void 0),(0,x._)([(0,ie.o)({count:ue.Am.COUNT})],le.prototype,"transparencyPassType",void 0),(0,x._)([(0,ie.o)({count:B.U.COUNT})],le.prototype,"ellipsoidMode",void 0),(0,x._)([(0,ie.o)({count:W.f7.COUNT})],le.prototype,"pbrMode",void 0),(0,x._)([(0,ie.o)({count:H.h.COUNT})],le.prototype,"normalType",void 0),(0,x._)([(0,ie.o)()],le.prototype,"spherical",void 0),(0,x._)([(0,ie.o)()],le.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasVertexColors",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasNormals",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasSlicePlane",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasBaseColorTexture",void 0),(0,x._)([(0,ie.o)()],le.prototype,"receiveAmbientOcclusion",void 0),(0,x._)([(0,ie.o)()],le.prototype,"receiveShadows",void 0),(0,x._)([(0,ie.o)()],le.prototype,"blendingEnabled",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasScreenSpaceReflections",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasPolygonOffset",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasMetalnessAndRoughnessTexture",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasEmissionTexture",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasOcclusionTexture",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasNormalTexture",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasOccludees",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasMultipassTerrain",void 0),(0,x._)([(0,ie.o)()],le.prototype,"cullAboveGround",void 0),(0,x._)([(0,ie.o)()],le.prototype,"isGround",void 0),(0,x._)([(0,ie.o)()],le.prototype,"hasCloudsReflections",void 0),(0,x._)([(0,ie.o)()],le.prototype,"snowCover",void 0),(0,x._)([(0,ie.o)({constValue:Z.P.Draw})],le.prototype,"pbrTextureBindType",void 0),(0,x._)([(0,ie.o)({constValue:!0})],le.prototype,"hasSliceHighlight",void 0),(0,x._)([(0,ie.o)({constValue:!1})],le.prototype,"hasSliceInVertexProgram",void 0),(0,x._)([(0,ie.o)({constValue:!1})],le.prototype,"useCustomDTRExponentForWater",void 0),(0,x._)([(0,ie.o)({constValue:!1})],le.prototype,"hasVertexTangents",void 0),(0,x._)([(0,ie.o)({constValue:!0})],le.prototype,"supportsTextureAtlas",void 0),(0,x._)([(0,ie.o)({constValue:!1})],le.prototype,"highStepCount",void 0),(0,x._)([(0,ie.o)({constValue:!1})],le.prototype,"instancedDoublePrecision",void 0),(0,x._)([(0,ie.o)({constValue:!0})],le.prototype,"useFillLights",void 0)},35357:(dt,Re,T)=>{"use strict";T.d(Re,{AD:()=>Y,_N:()=>ce,E_:()=>oe,nO:()=>le});var x=T(94573),A=T(36161),G=T(60785),Q=T(19278),H=T(65364),re=T(90637),J=T(85930),W=T(37847);class B extends J.x{constructor(ee,$){super(ee,"int",W.P.Draw,(ne,se,ae)=>ne.setUniform1i(ee,$(se,ae)))}}var ce,U,Z=T(17625),ie=T(66838),ue=T(16396);(U=ce||(ce={}))[U.Uniform=0]="Uniform",U[U.Varying=1]="Varying",U[U.COUNT=2]="COUNT";const oe=429496.7296;function le(U,ee){(0,A.I)(U/oe*.5+.5,ee)}function Y(U,ee){switch(ee.componentData){case ce.Varying:return function j(U){const{vertex:ee,fragment:$}=U;ee.include(Q.n),ee.uniforms.add([new ie.Q("componentColorTex"),new H.e("componentColorTexInvDim")]),U.attributes.add(ue.T.COMPONENTINDEX,"float"),U.varyings.add("vExternalColorMixMode","mediump float"),U.varyings.add("vExternalColor","vec4"),U.include(G.A),ee.constants.add("elevationScale","float",2*oe),ee.code.add(Z.H`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`),$.code.add(Z.H`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}(U);case ce.Uniform:return function X(U){const{vertex:ee,fragment:$}=U;ee.uniforms.add(new re.$("externalColor",ne=>ne.componentParameters.externalColor)),$.uniforms.add(new B("externalColorMixMode",ne=>ne.componentParameters.externalColorMixMode)),U.varyings.add("vExternalColor","vec4"),ee.code.add(Z.H`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),$.code.add(Z.H`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}(U);case ce.COUNT:return;default:(0,x.Bg)(ee.componentData)}}},60785:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>G});var x=T(9044),A=T(17625);function G(Q){Q.vertex.code.add(A.H`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${A.H.int(x.a9.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${A.H.int(x.a9.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${A.H.int(x.a9.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${A.H.int(x.a9.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}},50574:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>A,z:()=>G});var A,Q,x=T(17625);function G(Q,H){const re=Q.vertex;switch(re.code.add(x.H`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),H.vertexDiscardMode){case A.None:re.code.add(x.H`#define vertexDiscardByOpacity(_opacity_) {}`);break;case A.Opaque:re.code.add(x.H`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case A.Transparent:re.code.add(x.H`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(Q=A||(A={}))[Q.None=0]="None",Q[Q.Transparent=1]="Transparent",Q[Q.Opaque=2]="Opaque",Q[Q.COUNT=3]="COUNT"},27355:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>Q});var x=T(19625),A=T(36603),G=T(16396);function Q(H){const re=(0,x.U$)().vec3f(G.T.POSITION);return H.normals&&re.vec2i16(G.T.NORMALCOMPRESSED,{glNormalized:!0}),H.textureCoordinates===A.N.Default?re.vec2f(G.T.UV0):H.textureCoordinates===A.N.Atlas&&(re.vec2f(G.T.UV0),re.vec4u16(G.T.UVREGION,{glNormalized:!0})),H.colors&&re.vec4u8(G.T.COLOR,{glNormalized:!0}),re.alignTo(4)}},43553:(dt,Re,T)=>{"use strict";T.d(Re,{SP:()=>J,T5:()=>B,kF:()=>W,o9:()=>H,zp:()=>re});var H,re,Z,x=T(28093),A=T(21799);class G extends A.d4{constructor(){super(...arguments),this.slicePlaneLocalOrigin=(0,x.c)(),this.origin=this.slicePlaneLocalOrigin}}(Z=H||(H={}))[Z.Material=0]="Material",Z[Z.ShadowMap=1]="ShadowMap",Z[Z.Highlight=2]="Highlight",function(Z){Z[Z.Color=0]="Color",Z[Z.Alpha=1]="Alpha",Z[Z.Depth=2]="Depth",Z[Z.Normal=3]="Normal"}(re||(re={}));class J extends G{constructor(){super(...arguments),this.identifier=H.Material,this.transparent=!1,this.integratedMesh=!1}}class W extends G{constructor(){super(...arguments),this.identifier=H.ShadowMap}}class B extends G{constructor(){super(...arguments),this.identifier=H.Highlight}}},52382:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>H});var x=T(6945),A=T(51040),G=T(95285),Q=T(17625);function H(re,J){J.output===x.H.Color&&J.receiveShadows?(re.varyings.add("linearDepth","float"),re.vertex.code.add(Q.H`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):J.output===x.H.Depth||J.output===x.H.Shadow?(re.include(A.up,J),re.varyings.add("linearDepth","float"),re.vertex.uniforms.add(new G.A("nearFar",(W,B)=>B.camera.nearFar)),re.vertex.code.add(Q.H`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):re.vertex.code.add(Q.H`void forwardLinearDepth() {}`)}},73132:(dt,Re,T)=>{"use strict";T.d(Re,{w:()=>A});var x=T(17625);function A(G){G.vertex.code.add(x.H`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}},98071:(dt,Re,T)=>{"use strict";T.d(Re,{k:()=>G});var x=T(17625),A=T(16396);function G(Q,H=!0){Q.attributes.add(A.T.POSITION,"vec2"),H&&Q.varyings.add("uv","vec2"),Q.vertex.code.add(x.H`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${H?x.H`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}},6945:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{H:()=>x}),(A=x||(x={}))[A.Color=0]="Color",A[A.Depth=1]="Depth",A[A.Normal=2]="Normal",A[A.Shadow=3]="Shadow",A[A.Highlight=4]="Highlight",A[A.Draped=5]="Draped",A[A.Occlusion=6]="Occlusion",A[A.Alpha=7]="Alpha",A[A.COUNT=8]="COUNT"},78925:(dt,Re,T)=>{"use strict";T.d(Re,{P_:()=>Z,UT:()=>B,f5:()=>ie});var x=T(62208),A=T(28347),G=T(43703),Q=T(84161),H=T(28093),re=T(77739),J=T(97139),W=T(17625);class B extends W.K{constructor(se){super(),this.slicePlaneLocalOrigin=se}}function Z(ne,se){ue(ne,se,[new J.J("slicePlaneOrigin",(ae,de)=>Y(se,ae,de)),new J.J("slicePlaneBasis1",(ae,de)=>{var _e;return j(se,ae,de,null==(_e=(0,x.Wg)(de.slicePlane))?void 0:_e.basis1)}),new J.J("slicePlaneBasis2",(ae,de)=>{var _e;return j(se,ae,de,null==(_e=(0,x.Wg)(de.slicePlane))?void 0:_e.basis2)})])}function ie(ne,se){ue(ne,se,[new re.B("slicePlaneOrigin",(ae,de)=>Y(se,ae,de)),new re.B("slicePlaneBasis1",(ae,de)=>{var _e;return j(se,ae,de,null==(_e=(0,x.Wg)(de.slicePlane))?void 0:_e.basis1)}),new re.B("slicePlaneBasis2",(ae,de)=>{var _e;return j(se,ae,de,null==(_e=(0,x.Wg)(de.slicePlane))?void 0:_e.basis2)})])}function ue(ne,se,ae){if(!se.hasSlicePlane){const he=W.H`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return se.hasSliceInVertexProgram&&ne.vertex.code.add(he),void ne.fragment.code.add(he)}ne.extensions.add("GL_OES_standard_derivatives"),se.hasSliceInVertexProgram&&ne.vertex.uniforms.add(ae),ne.fragment.uniforms.add(ae);const de=W.H`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,_e=W.H`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,pe=se.hasSliceHighlight?W.H`
        ${_e}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:W.H`#define highlightSlice(_color_, _pos_) (_color_)`;se.hasSliceInVertexProgram&&ne.vertex.code.add(de),ne.fragment.code.add(de),ne.fragment.code.add(pe)}function ce(ne,se,ae){return ne.instancedDoublePrecision?(0,Q.s)(X,ae.camera.viewInverseTransposeMatrix[3],ae.camera.viewInverseTransposeMatrix[7],ae.camera.viewInverseTransposeMatrix[11]):se.slicePlaneLocalOrigin}function oe(ne,se){return(0,x.pC)(ne)?(0,Q.b)(U,se.origin,ne):se.origin}function le(ne,se,ae){return ne.hasSliceTranslatedView?(0,x.pC)(se)?(0,A.j)($,ae.camera.viewMatrix,se):ae.camera.viewMatrix:null}function Y(ne,se,ae){if((0,x.Wi)(ae.slicePlane))return H.Z;const de=ce(ne,se,ae),_e=oe(de,ae.slicePlane),pe=le(ne,de,ae);return(0,x.pC)(pe)?(0,Q.m)(U,_e,pe):_e}function j(ne,se,ae,de){if((0,x.Wi)(de)||(0,x.Wi)(ae.slicePlane))return H.Z;const _e=ce(ne,se,ae),pe=oe(_e,ae.slicePlane),he=le(ne,_e,ae);return(0,x.pC)(he)?((0,Q.a)(ee,de,pe),(0,Q.m)(U,pe,he),(0,Q.m)(ee,ee,he),(0,Q.b)(ee,ee,U)):de}const X=(0,H.c)(),U=(0,H.c)(),ee=(0,H.c)(),$=(0,G.c)()},24255:(dt,Re,T)=>{"use strict";T.d(Re,{w:()=>A});var x=T(17625);function A(G,Q={hasModelTransformation:!1,linearDepth:!1}){if(Q.hasModelTransformation)return Q.linearDepth?void G.vertex.code.add(x.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):void G.vertex.code.add(x.H`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`);G.vertex.code.add(Q.linearDepth?x.H`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`:x.H`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}},60355:(dt,Re,T)=>{"use strict";T.d(Re,{f:()=>Z});var x=T(84161),A=T(28093),G=T(6945),Q=T(7228),H=T(77739),re=T(17625),J=T(63123),W=T(16396),B=T(2757);function Z(ue,ce){ce.instanced&&ce.instancedDoublePrecision&&(ue.attributes.add(W.T.MODELORIGINHI,"vec3"),ue.attributes.add(W.T.MODELORIGINLO,"vec3"),ue.attributes.add(W.T.MODEL,"mat3"),ue.attributes.add(W.T.MODELNORMAL,"mat3"));const oe=ue.vertex;ce.instancedDoublePrecision&&(oe.include(Q.$,ce),oe.uniforms.add(new H.B("viewOriginHi",(le,Y)=>(0,B.U8)((0,x.s)(ie,Y.camera.viewInverseTransposeMatrix[3],Y.camera.viewInverseTransposeMatrix[7],Y.camera.viewInverseTransposeMatrix[11]),ie))),oe.uniforms.add(new H.B("viewOriginLo",(le,Y)=>(0,B.GB)((0,x.s)(ie,Y.camera.viewInverseTransposeMatrix[3],Y.camera.viewInverseTransposeMatrix[7],Y.camera.viewInverseTransposeMatrix[11]),ie)))),oe.code.add(re.H`
    vec3 calculateVPos() {
      ${ce.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),oe.code.add(re.H`
    vec3 subtractOrigin(vec3 _pos) {
      ${ce.instancedDoublePrecision?re.H`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),oe.code.add(re.H`
    vec3 dpNormal(vec4 _normal) {
      ${ce.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),ce.output===G.H.Normal&&(oe.uniforms.add(new J.g("viewNormal",(le,Y)=>Y.camera.viewInverseTransposeMatrix)),oe.code.add(re.H`
    vec3 dpNormalView(vec4 _normal) {
      ${ce.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),ce.hasVertexTangents&&oe.code.add(re.H`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${ce.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}const ie=(0,A.c)()},26859:(dt,Re,T)=>{"use strict";T.d(Re,{O:()=>Q,h:()=>H});var x=T(17625);function A(re){const J=x.H`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;re.fragment.code.add(J),re.vertex.code.add(J)}var H,re,G=T(16396);function Q(re,J){J.normalType===H.Attribute&&(re.attributes.add(G.T.NORMAL,"vec3"),re.vertex.code.add(x.H`vec3 normalModel() {
return normal;
}`)),J.normalType===H.CompressedAttribute&&(re.include(A),re.attributes.add(G.T.NORMALCOMPRESSED,"vec2"),re.vertex.code.add(x.H`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`)),J.normalType===H.ScreenDerivative&&(re.extensions.add("GL_OES_standard_derivatives"),re.fragment.code.add(x.H`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))}(re=H||(H={}))[re.Attribute=0]="Attribute",re[re.CompressedAttribute=1]="CompressedAttribute",re[re.Ground=2]="Ground",re[re.ScreenDerivative=3]="ScreenDerivative",re[re.COUNT=4]="COUNT"},68565:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>ue,W:()=>ie});var x=T(99770),A=T(84833),G=T(95285),Q=T(97139),H=T(48565),re=T(7090),J=T(17625),W=T(16396),B=T(41857);function ie(ce,oe){ce.attributes.add(W.T.FEATUREVALUE,"vec4");const le=ce.vertex;le.code.add(J.H`bool isCapVertex() {
return featureValue.w == 1.0;
}`),le.uniforms.add(new G.A("size",Y=>Y.size)),oe.vvSize?(le.uniforms.add(new Q.J("vvSizeMinSize",Y=>Y.vvSizeMinSize)),le.uniforms.add(new Q.J("vvSizeMaxSize",Y=>Y.vvSizeMaxSize)),le.uniforms.add(new Q.J("vvSizeOffset",Y=>Y.vvSizeOffset)),le.uniforms.add(new Q.J("vvSizeFactor",Y=>Y.vvSizeFactor)),le.code.add(J.H`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):le.code.add(J.H`vec2 getSize(){
return size;
}`),oe.vvOpacity?(le.constants.add("vvOpacityNumber","int",8),le.uniforms.add([new re.O("vvOpacityValues",Y=>Y.vvOpacityValues,8),new re.O("vvOpacityOpacities",Y=>Y.vvOpacityOpacities,8)]),le.code.add(J.H`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):le.code.add(J.H`vec4 applyOpacity(vec4 color){
return color;
}`),oe.vvColor?(le.constants.add("vvColorNumber","int",B.x),le.uniforms.add([new re.O("vvColorValues",Y=>Y.vvColorValues,B.x),new H.b("vvColorColors",Y=>Y.vvColorColors,B.x)]),le.code.add(J.H`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):le.code.add(J.H`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),ce.include(A.f),ce.attributes.add(W.T.PROFILERIGHT,"vec4"),ce.attributes.add(W.T.PROFILEUP,"vec4"),ce.attributes.add(W.T.PROFILEVERTEXANDNORMAL,"vec4"),le.code.add(J.H`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),le.code.add(J.H`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),le.code.add(J.H`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),le.code.add(J.H`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}class ue extends B.n{constructor(){super(...arguments),this.size=(0,x.f)(1,1)}}},84833:(dt,Re,T)=>{"use strict";T.d(Re,{f:()=>G});var x=T(17625),A=T(16396);function G(Q){Q.attributes.add(A.T.POSITION,"vec3"),Q.vertex.code.add(x.H`vec3 positionModel() { return position; }`)}},39645:(dt,Re,T)=>{"use strict";T.d(Re,{U:()=>B});var x=T(97139),A=T(48565),G=T(65787),Q=T(7090),H=T(17625),re=T(16396),J=T(41857);function B(Z,ie){const ue=Z.vertex;ue.uniforms.add(new G.p("intrinsicWidth",ce=>ce.width)),ie.vvSize?(Z.attributes.add(re.T.SIZEFEATUREATTRIBUTE,"float"),ue.uniforms.add(new x.J("vvSizeMinSize",ce=>ce.vvSizeMinSize)),ue.uniforms.add(new x.J("vvSizeMaxSize",ce=>ce.vvSizeMaxSize)),ue.uniforms.add(new x.J("vvSizeOffset",ce=>ce.vvSizeOffset)),ue.uniforms.add(new x.J("vvSizeFactor",ce=>ce.vvSizeFactor)),ue.code.add(H.H`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(Z.attributes.add(re.T.SIZE,"float"),ue.code.add(H.H`float getSize(){
return intrinsicWidth * size;
}`)),ie.vvOpacity?(Z.attributes.add(re.T.OPACITYFEATUREATTRIBUTE,"float"),ue.constants.add("vvOpacityNumber","int",8),ue.uniforms.add([new Q.O("vvOpacityValues",ce=>ce.vvOpacityValues,8),new Q.O("vvOpacityOpacities",ce=>ce.vvOpacityOpacities,8)]),ue.code.add(H.H`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):ue.code.add(H.H`vec4 applyOpacity( vec4 color ){
return color;
}`),ie.vvColor?(Z.attributes.add(re.T.COLORFEATUREATTRIBUTE,"float"),ue.constants.add("vvColorNumber","int",J.x),ue.uniforms.add(new Q.O("vvColorValues",ce=>ce.vvColorValues,J.x)),ue.uniforms.add(new A.b("vvColorColors",ce=>ce.vvColorColors,J.x)),ue.code.add(H.H`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(Z.attributes.add(re.T.COLOR,"vec4"),ue.code.add(H.H`vec4 getColor(){
return applyOpacity(color);
}`))}},99579:(dt,Re,T)=>{"use strict";T.d(Re,{R:()=>re});var x=T(60785),A=T(18952),G=T(17625),Q=T(16396),H=T(57623);function re(J,W){W.hasSymbolColors?(J.include(x.A),J.attributes.add(Q.T.SYMBOLCOLOR,"vec4"),J.varyings.add("colorMixMode","mediump float"),J.vertex.code.add(G.H`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(J.fragment.uniforms.add(new A._("colorMixMode",B=>H.FZ[B.colorMixMode])),J.vertex.code.add(G.H`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}},36603:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>H,N:()=>Q});var Q,re,x=T(94573),A=T(17625),G=T(16396);function H(re,J){switch(J.textureCoordinateType){case Q.Default:return re.attributes.add(G.T.UV0,"vec2"),re.varyings.add("vuv0","vec2"),void re.vertex.code.add(A.H`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case Q.Atlas:return re.attributes.add(G.T.UV0,"vec2"),re.varyings.add("vuv0","vec2"),re.attributes.add(G.T.UVREGION,"vec4"),re.varyings.add("vuvRegion","vec4"),void re.vertex.code.add(A.H`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);case Q.None:return void re.vertex.code.add(A.H`void forwardTextureCoordinates() {}`);default:(0,x.Bg)(J.textureCoordinateType);case Q.COUNT:return}}(re=Q||(Q={}))[re.None=0]="None",re[re.Default=1]="Default",re[re.Atlas=2]="Atlas",re[re.COUNT=3]="COUNT"},58173:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>G});var x=T(17625),A=T(16396);function G(Q,H){H.hasVertexColors?(Q.attributes.add(A.T.COLOR,"vec4"),Q.varyings.add("vColor","vec4"),Q.vertex.code.add(x.H`void forwardVertexColor() { vColor = color; }`),Q.vertex.code.add(x.H`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):Q.vertex.code.add(x.H`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}},21799:(dt,Re,T)=>{"use strict";T.d(Re,{Bb:()=>W,Pf:()=>Z,d4:()=>B});var x=T(550),A=T(4794),G=T(26859),Q=T(51040),H=T(17625),re=T(9546),J=T(91574);function W(ie,ue){ue.normalType===G.h.Attribute||ue.normalType===G.h.CompressedAttribute?(ie.include(G.O,ue),ie.varyings.add("vNormalWorld","vec3"),ie.varyings.add("vNormalView","vec3"),ie.vertex.uniforms.add([new re.j("transformNormalGlobalFromModel",ce=>ce.transformNormalGlobalFromModel),new J.c("transformNormalViewFromGlobal",ce=>ce.transformNormalViewFromGlobal)]),ie.vertex.code.add(H.H`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):ue.normalType===G.h.Ground?(ie.include(Q.up,ue),ie.varyings.add("vNormalWorld","vec3"),ie.vertex.code.add(H.H`
    void forwardNormal() {
      vNormalWorld = ${ue.spherical?H.H`normalize(vPositionWorldCameraRelative);`:H.H`vec3(0.0, 0.0, 1.0);`}
    }
    `)):ie.vertex.code.add(H.H`void forwardNormal() {}`)}class B extends Q.su{constructor(){super(...arguments),this.transformNormalViewFromGlobal=(0,x.c)()}}class Z extends Q.OU{constructor(){super(...arguments),this.transformNormalGlobalFromModel=(0,x.c)(),this.toMapSpace=(0,A.c)()}}},51040:(dt,Re,T)=>{"use strict";T.d(Re,{OU:()=>le,su:()=>oe,up:()=>ce});var x=T(550),A=T(43703),G=T(14658),Q=T(28093),H=T(84833),re=T(7228),J=T(77739),W=T(97139),B=T(17625),Z=T(9546),ie=T(91574),ue=T(63123);function ce(Y,j){Y.include(H.f);const X=Y.vertex;X.include(re.$,j),Y.varyings.add("vPositionWorldCameraRelative","vec3"),Y.varyings.add("vPosition_view","vec3"),X.uniforms.add([new W.J("transformWorldFromViewTH",U=>U.transformWorldFromViewTH),new W.J("transformWorldFromViewTL",U=>U.transformWorldFromViewTL),new ie.c("transformViewFromCameraRelativeRS",U=>U.transformViewFromCameraRelativeRS),new ue.g("transformProjFromView",U=>U.transformProjFromView),new Z.j("transformWorldFromModelRS",U=>U.transformWorldFromModelRS),new J.B("transformWorldFromModelTH",U=>U.transformWorldFromModelTH),new J.B("transformWorldFromModelTL",U=>U.transformWorldFromModelTL)]),X.code.add(B.H`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),X.code.add(B.H`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${j.spherical?B.H`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:B.H`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),Y.fragment.uniforms.add(new W.J("transformWorldFromViewTL",U=>U.transformWorldFromViewTL)),X.code.add(B.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),Y.fragment.code.add(B.H`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}class oe extends B.K{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,Q.c)(),this.transformWorldFromViewTL=(0,Q.c)(),this.transformViewFromCameraRelativeRS=(0,x.c)(),this.transformProjFromView=(0,A.c)()}}class le extends B.K{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,x.c)(),this.transformWorldFromModelTH=(0,G.c)(),this.transformWorldFromModelTL=(0,G.c)()}}},43880:(dt,Re,T)=>{"use strict";T.d(Re,{M:()=>A});var x=T(17625);function A(G,Q){G.varyings.add("tbnTangent","vec3"),G.varyings.add("tbnBiTangent","vec3"),G.vertex.code.add(Q.spherical?x.H`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`:x.H`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),G.fragment.code.add(x.H`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}},95284:(dt,Re,T)=>{"use strict";T.d(Re,{i:()=>H});var x=T(94573),A=T(36603),G=T(95267),Q=T(17625);function H(re,J){switch(re.include(A.D,J),re.fragment.code.add(Q.H`
  struct TextureLookupParameter {
    vec2 uv;
    ${J.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `),J.textureCoordinateType){case A.N.Default:return void re.fragment.code.add(Q.H`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);case A.N.Atlas:return re.include(G.r),void re.fragment.code.add(Q.H`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);default:(0,x.Bg)(J.textureCoordinateType);case A.N.None:case A.N.COUNT:return}}},66085:(dt,Re,T)=>{"use strict";T.d(Re,{L:()=>J,V:()=>B});var x=T(993),A=T(4794),G=T(71850),Q=T(2166),H=T(69960),re=T(17625);function J(Z,ie){const ue=Z.vertex;ie.hasVerticalOffset?(B(ue),ie.hasScreenSizePerspective&&(Z.include(G.cK),(0,G.m8)(ue),(0,Q.h)(Z.vertex,ie)),ue.code.add(re.H`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${ie.spherical?re.H`vec3 worldNormal = normalize(worldPos + localOrigin);`:re.H`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${ie.hasScreenSizePerspective?re.H`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:re.H`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):ue.code.add(re.H`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const W=(0,A.c)();function B(Z){Z.uniforms.add(new H.N("verticalOffset",(ie,ue)=>{const{minWorldLength:ce,maxWorldLength:oe,screenLength:le}=ie.verticalOffset,Y=Math.tan(.5*ue.camera.fovY)/(.5*ue.camera.fullViewport[3]);return(0,x.s)(W,le*(ue.camera.pixelRatio||1),Y,ce,oe)}))}},58208:(dt,Re,T)=>{"use strict";T.d(Re,{s:()=>le});var x=T(6945),A=T(78925),G=T(24255),Q=T(26859),H=T(36603),re=T(21799),J=T(54120),W=T(62952),B=T(92836),Z=T(93609),ie=T(2166),ue=T(95285),ce=T(17625),oe=T(35387);function le(Y,j){const X=Y.vertex.code,U=Y.fragment.code,ee=j.hasModelTransformation;j.output!==x.H.Depth&&j.output!==x.H.Shadow||((0,ie.S)(Y,j),Y.include(G.w,{linearDepth:!0,hasModelTransformation:ee}),Y.include(H.D,j),Y.include(B.k,j),Y.include(J.F,j),Y.include(A.f5,j),Y.vertex.uniforms.add(new ue.A("nearFar",($,ne)=>ne.camera.nearFar)),Y.varyings.add("depth","float"),j.hasColorTexture&&Y.fragment.uniforms.add(new oe.A("tex",$=>$.texture)),X.add(ce.H`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${ee?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),Y.include(Z.z,j),U.add(ce.H`
      void main(void) {
        discardBySlice(vpos);
        ${j.hasColorTexture?ce.H`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `)),j.output===x.H.Normal&&((0,ie.S)(Y,j),Y.include(G.w,{linearDepth:!1,hasModelTransformation:ee}),Y.include(Q.O,j),Y.include(re.Bb,j),Y.include(H.D,j),Y.include(B.k,j),j.hasColorTexture&&Y.fragment.uniforms.add(new oe.A("tex",$=>$.texture)),Y.varyings.add("vPositionView","vec3"),X.add(ce.H`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${j.normalType===Q.h.Attribute?ce.H`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${ee?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),Y.include(A.f5,j),Y.include(Z.z,j),U.add(ce.H`
      void main() {
        discardBySlice(vpos);
        ${j.hasColorTexture?ce.H`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${j.normalType===Q.h.ScreenDerivative?ce.H`
            vec3 normal = screenDerivativeNormal(vPositionView);`:ce.H`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `)),j.output===x.H.Highlight&&((0,ie.S)(Y,j),Y.include(G.w,{linearDepth:!1,hasModelTransformation:ee}),Y.include(H.D,j),Y.include(B.k,j),j.hasColorTexture&&Y.fragment.uniforms.add(new oe.A("tex",$=>$.texture)),X.add(ce.H`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${ee?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),Y.include(A.f5,j),Y.include(Z.z,j),Y.include(W.bA),U.add(ce.H`
      void main() {
        discardBySlice(vpos);
        ${j.hasColorTexture?ce.H`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))}},35283:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>A});var x=T(17625);function A(G){const Q=x.H`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,H=x.H`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;G.vertex.code.add(Q),G.vertex.code.add(H),G.fragment.code.add(Q),G.fragment.code.add(H)}},97347:(dt,Re,T)=>{"use strict";T.d(Re,{R:()=>ue,d:()=>ie});var ie,ce,x=T(66085),A=T(42309),G=T(71850),Q=T(2166),H=T(69960),re=T(65787),J=T(17625),W=T(63123),B=T(35387),Z=T(16396);function ue(ce,oe){ce.include(G.cK),ce.attributes.add(Z.T.POSITION,"vec3"),ce.attributes.add(Z.T.NORMAL,"vec3"),ce.attributes.add(Z.T.AUXPOS1,"vec4");const le=ce.vertex;(0,Q.S)(ce,oe),(0,Q.h)(le,oe),le.uniforms.add([new H.N("viewport",(Y,j)=>j.camera.fullViewport),new re.p("polygonOffset",Y=>Y.shaderPolygonOffset),new re.p("cameraGroundRelative",(Y,j)=>j.camera.aboveGround?1:-1),new re.p("renderTransparentlyOccludedHUD",(Y,j)=>j.renderTransparentlyOccludedHUD===A.v.Occluded?1:j.renderTransparentlyOccludedHUD===A.v.NotOccluded?0:.75),new B.A("hudVisibilityTexture",(Y,j)=>j.hudVisibilityTexture)]),oe.hasVerticalOffset&&(0,x.V)(le),le.constants.add("smallOffsetAngle","float",.984807753012208),le.code.add(J.H`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),le.code.add(J.H`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),oe.isDraped&&!oe.hasVerticalOffset||le.uniforms.add(new W.g("viewNormal",(Y,j)=>j.camera.viewInverseTransposeMatrix)),oe.isDraped||(le.uniforms.add(new re.p("perDistancePixelRatio",(Y,j)=>Math.tan(j.camera.fovY/2)/(j.camera.fullViewport[2]/2))),le.code.add(J.H`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),oe.screenCenterOffsetUnitsEnabled===ie.Screen&&le.uniforms.add(new re.p("pixelRatio",(Y,j)=>j.camera.pixelRatio)),oe.hasScreenSizePerspective&&(0,G.m8)(le),le.code.add(J.H`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${oe.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${oe.hasScreenSizePerspective&&(oe.hasVerticalOffset||oe.screenCenterOffsetUnitsEnabled===ie.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${oe.hasVerticalOffset?oe.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${oe.hasVerticalOffset?J.H`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${oe.screenCenterOffsetUnitsEnabled!==ie.Screen?J.H`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${oe.screenCenterOffsetUnitsEnabled===ie.Screen?oe.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${oe.screenCenterOffsetUnitsEnabled===ie.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),le.code.add(J.H`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(ce=ie||(ie={}))[ce.World=0]="World",ce[ce.Screen=1]="Screen",ce[ce.COUNT=2]="COUNT"},27776:(dt,Re,T)=>{"use strict";T.d(Re,{R:()=>J});var x=T(47923),A=T(82793),G=T(19278),Q=T(95285),H=T(17625),re=T(35387);function J(W,B){const{vertex:Z,fragment:ie}=W;B.hasMultipassGeometry&&Z.include(A.S),B.hasMultipassTerrain&&W.varyings.add("depth","float"),Z.code.add(H.H`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${B.hasMultipassGeometry?H.H`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${B.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),B.hasMultipassTerrain&&ie.include(x.S),B.hasMultipassTerrain&&ie.uniforms.add([new re.A("terrainDepthTexture",(ue,ce)=>ce.multipassTerrain.linearDepthTexture),new Q.A("nearFar",(ue,ce)=>ce.camera.nearFar),new Q.A("inverseViewport",(ue,ce)=>ce.inverseViewport)]),ie.include(G.n),ie.code.add(H.H`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${B.hasMultipassTerrain?H.H`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)}},42309:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{v:()=>x}),(A=x||(x={}))[A.Occluded=0]="Occluded",A[A.NotOccluded=1]="NotOccluded",A[A.Both=2]="Both",A[A.COUNT=3]="COUNT"},7699:(dt,Re,T)=>{"use strict";var x,A,H;T.d(Re,{MV:()=>Q,iM:()=>A,pU:()=>G}),(H=x||(x={}))[H.OneMinusSourceAlpha=0]="OneMinusSourceAlpha",H[H.SourceAlpha=1]="SourceAlpha",H[H.COUNT=2]="COUNT",function(H){H[H.Normal=0]="Normal",H[H.Average=1]="Average",H[H.Lighten=2]="Lighten",H[H.Lighter=3]="Lighter",H[H.Plus=4]="Plus",H[H.Screen=5]="Screen",H[H.ColorDodge=6]="ColorDodge",H[H.Darken=7]="Darken",H[H.Multiply=8]="Multiply",H[H.ColorBurn=9]="ColorBurn",H[H.Overlay=10]="Overlay",H[H.SoftLight=11]="SoftLight",H[H.HardLight=12]="HardLight",H[H.VividLight=13]="VividLight",H[H.Hue=14]="Hue",H[H.Saturation=15]="Saturation",H[H.Luminosity=16]="Luminosity",H[H.Color=17]="Color",H[H.DestinationOver=18]="DestinationOver",H[H.DestinationAtop=19]="DestinationAtop",H[H.DestinationIn=20]="DestinationIn",H[H.DestinationOut=21]="DestinationOut",H[H.SourceAtop=22]="SourceAtop",H[H.SourceIn=23]="SourceIn",H[H.SourceOut=24]="SourceOut",H[H.Xor=25]="Xor",H[H.Difference=26]="Difference",H[H.Exclusion=27]="Exclusion",H[H.Minus=28]="Minus",H[H.Invert=29]="Invert",H[H.Reflect=30]="Reflect",H[H.COUNT=31]="COUNT"}(A||(A={}));const G={normal:A.Normal,average:A.Average,lighten:A.Lighten,lighter:A.Lighter,screen:A.Screen,plus:A.Plus,"color-dodge":A.ColorDodge,darken:A.Darken,multiply:A.Multiply,"color-burn":A.ColorBurn,overlay:A.Overlay,"soft-light":A.SoftLight,"hard-light":A.HardLight,"vivid-light":A.VividLight,hue:A.Hue,saturation:A.Saturation,luminosity:A.Luminosity,color:A.Color,difference:A.Difference,exclusion:A.Exclusion,minus:A.Minus,invert:A.Invert,reflect:A.Reflect,"destination-over":A.DestinationOver,"destination-atop":A.DestinationAtop,"destination-in":A.DestinationIn,"destination-out":A.DestinationOut,"source-atop":A.SourceAtop,"source-in":A.SourceIn,"source-out":A.SourceOut,xor:A.Xor};function Q(H){return H===A.DestinationOver||H===A.DestinationAtop||H===A.DestinationIn||H===A.DestinationOut||H===A.SourceAtop||H===A.SourceIn||H===A.SourceOut||H===A.Xor}},54120:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>Q});var x=T(6945),A=T(19278),G=T(17625);function Q(H,re){H.fragment.include(A.n),re.output===x.H.Shadow?(H.extensions.add("GL_OES_standard_derivatives"),H.fragment.code.add(G.H`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):re.output===x.H.Depth&&H.fragment.code.add(G.H`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}},62952:(dt,Re,T)=>{"use strict";T.d(Re,{bA:()=>W,ck:()=>J}),T(99770);var A=T(4794),G=T(95285),Q=T(17625),H=T(35387);const re=(0,A.f)(1,1,0,1),J=(0,A.f)(1,0,1,1);function W(Z){Z.fragment.uniforms.add(new H.A("depthTex",(ie,ue)=>ue.highlightDepthTexture)),Z.fragment.uniforms.add(new G.A("highlightViewportPixelSz",(ie,ue)=>ue.inverseViewport)),Z.fragment.constants.add("occludedHighlightFlag","vec4",re).add("unoccludedHighlightFlag","vec4",J),Z.fragment.code.add(Q.H`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)}},47923:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>G});var x=T(19278),A=T(17625);function G(Q){Q.include(x.n),Q.code.add(A.H`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)}},3802:(dt,Re,T)=>{"use strict";T.d(Re,{i:()=>Q});var x=T(65787),A=T(17625),G=T(35387);function Q(H){H.fragment.uniforms.add([new G.A("u_colormap",re=>re.u_colormap),new x.p("u_colormapOffset",re=>re.colormap.u_colormapOffset),new x.p("u_colormapMaxIndex",re=>re.colormap.u_colormapMaxIndex),new x.p("u_opacity",re=>re.common.u_opacity)]),H.fragment.code.add(A.H`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)}},76301:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>W,J:()=>J});var x=T(95285),A=T(17625),G=T(35387);function Q(B){B.fragment.uniforms.add(new G.A("u_transformGrid",Z=>Z.u_transformGrid)),B.fragment.uniforms.add(new x.A("u_transformSpacing",Z=>Z.common.u_transformSpacing)),B.fragment.uniforms.add(new x.A("u_transformGridSize",Z=>Z.common.u_transformGridSize)),B.fragment.uniforms.add(new x.A("u_targetImageSize",Z=>Z.common.u_targetImageSize)),B.fragment.code.add(A.H`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)}var H=T(14273),re=T(78038);class J extends H.R{constructor(Z,ie,ue){super(),this.common=Z,this.u_image=ie,this.u_transformGrid=ue}}function W(B){B.include(Q),B.fragment.uniforms.add([new G.A("u_image",Z=>Z.u_image),new re.U("u_flipY",Z=>Z.common.u_flipY),new re.U("u_applyTransform",Z=>Z.common.u_applyTransform)]),B.fragment.code.add(A.H`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)}},2122:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>re});var x=T(58173),A=T(28137),G=T(90637),Q=T(2163),H=T(17625);function re(J,W){J.include(x.c,W),J.fragment.include(A.y);const B=J.fragment;B.uniforms.add(new G.$("baseColor",Z=>Z.baseColor)),B.uniforms.add(new Q.p("objectOpacity",Z=>Z.objectOpacity)),B.code.add(W.hasVertexColors?H.H`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`:H.H`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),B.code.add(H.H`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}},29052:(dt,Re,T)=>{"use strict";T.d(Re,{Q:()=>B});var x=T(36603),A=T(95284),G=T(96395),Q=T(17625),H=T(5864),re=T(35387),J=T(37847),W=T(16396);function B(Z,ie){const ue=Z.fragment;if(ie.hasVertexTangents?(Z.attributes.add(W.T.TANGENT,"vec4"),Z.varyings.add("vTangent","vec4"),ue.code.add(ie.doubleSidedMode===G.q.WindingOrder?Q.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`:Q.H`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(Z.extensions.add("GL_OES_standard_derivatives"),ue.code.add(Q.H`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`)),ie.textureCoordinateType!==x.N.None){Z.include(A.i,ie);const ce=ie.supportsTextureAtlas;ue.uniforms.add(ie.pbrTextureBindType===J.P.Pass?(0,re.J)("normalTexture",oe=>oe.textureNormal,ce):(0,H.F)("normalTexture",oe=>oe.textureNormal,ce)),ue.code.add(Q.H`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${ie.supportsTextureAtlas?"vtc.size = normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `)}}},75819:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>J});var x=T(94573),A=T(26859),G=T(21799),Q=T(51040),H=T(96395),re=T(17625);function J(W,B){const Z=W.fragment;switch(B.doubleSidedMode){case H.q.None:Z.code.add(re.H`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case H.q.View:W.include(Q.up,B),Z.code.add(re.H`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case H.q.WindingOrder:Z.code.add(re.H`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:(0,x.Bg)(B.doubleSidedMode);case H.q.COUNT:}switch(B.normalType){case A.h.Attribute:case A.h.CompressedAttribute:W.include(G.Bb,B),Z.code.add(re.H`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case A.h.ScreenDerivative:W.extensions.add("GL_OES_standard_derivatives"),W.include(Q.up,B),Z.code.add(re.H`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case A.h.Ground:B.spherical?(W.include(Q.up,B),Z.code.add(re.H`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):Z.code.add(re.H`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),W.extensions.add("GL_OES_standard_derivatives"),Z.code.add(re.H`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:(0,x.Bg)(B.normalType);case A.h.COUNT:}}},44965:(dt,Re,T)=>{"use strict";T.d(Re,{_:()=>B});var x=T(84161),A=T(28093),G=T(993),Q=T(4794),H=T(92724),re=T(97139),J=T(69960),W=T(17625);function B(ue,ce){const oe=ue.fragment,le=void 0!==ce.lightingSphericalHarmonicsOrder?ce.lightingSphericalHarmonicsOrder:2;0===le?(oe.uniforms.add(new re.J("lightingAmbientSH0",(Y,j)=>(0,x.s)(Z,j.lighting.sh.r[0],j.lighting.sh.g[0],j.lighting.sh.b[0]))),oe.code.add(W.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===le?(oe.uniforms.add([new J.N("lightingAmbientSH_R",(Y,j)=>(0,G.s)(ie,j.lighting.sh.r[0],j.lighting.sh.r[1],j.lighting.sh.r[2],j.lighting.sh.r[3])),new J.N("lightingAmbientSH_G",(Y,j)=>(0,G.s)(ie,j.lighting.sh.g[0],j.lighting.sh.g[1],j.lighting.sh.g[2],j.lighting.sh.g[3])),new J.N("lightingAmbientSH_B",(Y,j)=>(0,G.s)(ie,j.lighting.sh.b[0],j.lighting.sh.b[1],j.lighting.sh.b[2],j.lighting.sh.b[3]))]),oe.code.add(W.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===le&&(oe.uniforms.add([new re.J("lightingAmbientSH0",(Y,j)=>(0,x.s)(Z,j.lighting.sh.r[0],j.lighting.sh.g[0],j.lighting.sh.b[0])),new J.N("lightingAmbientSH_R1",(Y,j)=>(0,G.s)(ie,j.lighting.sh.r[1],j.lighting.sh.r[2],j.lighting.sh.r[3],j.lighting.sh.r[4])),new J.N("lightingAmbientSH_G1",(Y,j)=>(0,G.s)(ie,j.lighting.sh.g[1],j.lighting.sh.g[2],j.lighting.sh.g[3],j.lighting.sh.g[4])),new J.N("lightingAmbientSH_B1",(Y,j)=>(0,G.s)(ie,j.lighting.sh.b[1],j.lighting.sh.b[2],j.lighting.sh.b[3],j.lighting.sh.b[4])),new J.N("lightingAmbientSH_R2",(Y,j)=>(0,G.s)(ie,j.lighting.sh.r[5],j.lighting.sh.r[6],j.lighting.sh.r[7],j.lighting.sh.r[8])),new J.N("lightingAmbientSH_G2",(Y,j)=>(0,G.s)(ie,j.lighting.sh.g[5],j.lighting.sh.g[6],j.lighting.sh.g[7],j.lighting.sh.g[8])),new J.N("lightingAmbientSH_B2",(Y,j)=>(0,G.s)(ie,j.lighting.sh.b[5],j.lighting.sh.b[6],j.lighting.sh.b[7],j.lighting.sh.b[8]))]),oe.code.add(W.H`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),ce.pbrMode!==H.f7.Normal&&ce.pbrMode!==H.f7.Schematic||oe.code.add(W.H`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const Z=(0,A.c)(),ie=(0,Q.c)()},54662:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>re});var x=T(993),A=T(4794),G=T(69960),Q=T(17625),H=T(35387);function re(W,B){const Z=W.fragment;B.receiveAmbientOcclusion?(Z.uniforms.add([new H.A("ssaoTex",(ie,ue)=>ue.ssaoHelper.colorTexture),new G.N("viewportPixelSz",(ie,ue)=>(0,x.s)(J,ue.camera.fullViewport[0],ue.camera.fullViewport[1],1/ue.ssaoHelper.width,1/ue.ssaoHelper.height))]),Z.code.add(Q.H`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):Z.code.add(Q.H`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)}const J=(0,A.c)()},13146:(dt,Re,T)=>{"use strict";T.d(Re,{X:()=>ue});var x=T(44965),A=T(54662),G=T(31166),Q=T(98898),H=T(92724),re=T(39337),J=T(78038),W=T(97139),B=T(65787),Z=T(17625),ie=T(95279);function ue(ce,oe){const le=ce.fragment;ce.include(A.K,oe),oe.pbrMode!==H.f7.Disabled&&ce.include(Q.T,oe),ce.include(x._,oe),le.constants.add("ambientBoostFactor","float",ie.V),ce.include(re.e),le.code.add(Z.H`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${oe.pbrMode===H.f7.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),le.uniforms.add(new W.J("lightingMainDirection",(Y,j)=>j.lighting.lightingMainDirection)),le.code.add(Z.H`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${oe.spherical?Z.H`normalize(vPosWorld)`:Z.H`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),le.uniforms.add([new B.p("lightingGlobalFactor",(Y,j)=>j.lighting.globalFactor),new W.J("lightingMainIntensity",(Y,j)=>j.lighting.mainLight.intensity)]),le.code.add(Z.H`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`),oe.pbrMode===H.f7.Disabled||oe.pbrMode===H.f7.WaterOnIntegratedMesh?(ce.include(G.k,oe),le.code.add(Z.H`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`)):oe.pbrMode!==H.f7.Normal&&oe.pbrMode!==H.f7.Schematic||(le.code.add(Z.H`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),le.code.add(Z.H`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),oe.useFillLights?le.uniforms.add(new J.U("hasFillLights",(Y,j)=>j.enableFillLights)):le.constants.add("hasFillLights","bool",!1),le.code.add(Z.H`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),le.uniforms.add([new B.p("lightingSpecularStrength",(Y,j)=>j.lighting.mainLight.specularStrength),new B.p("lightingEnvironmentStrength",(Y,j)=>j.lighting.mainLight.environmentStrength)]),le.code.add(Z.H`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),le.code.add(Z.H`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${oe.pbrMode===H.f7.Schematic?Z.H`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:Z.H`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `))}},45027:(dt,Re,T)=>{"use strict";T.d(Re,{E:()=>G,K:()=>A});var x=T(17625);function A(Q){Q.fragment.code.add(x.H`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function G(Q){Q.fragment.code.add(x.H`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}},96896:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>A});var x=T(17625);function A(G){G.fragment.code.add(x.H`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}},92484:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>ce});var x=T(19278),A=T(2166),G=T(69960),Q=T(65787),H=T(84178),re=T(17625),J=T(66838),W=T(62208),B=T(993),Z=T(4794);const ue=(0,Z.c)();function ce(j,X){j.constants.add("stippleAlphaColorDiscard","float",.001),j.constants.add("stippleAlphaHighlightDiscard","float",.5),X.stippleEnabled?function oe(j,X){const U=!(X.draped&&X.stipplePreferContinuous),{vertex:ee,fragment:$}=j;$.include(x.n),ee.uniforms.add(new H.d("stipplePatternPixelSize")),X.draped||((0,A.h)(ee,X),ee.uniforms.add(new Q.p("worldToScreenPerDistanceRatio",(ne,se)=>1/se.camera.perScreenPixelRatio)),ee.code.add(re.H`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),j.varyings.add("vStippleDistance","float"),X.stippleRequiresClamp&&j.varyings.add("vStippleDistanceLimits","vec2"),X.stippleRequiresStretchMeasure&&j.varyings.add("vStipplePatternStretch","float"),ee.code.add(re.H`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${Y};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),ee.code.add(re.H`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),ee.code.add(re.H`
    if (segmentLengthPseudoScreen >= ${U?"patternLength":"1e4"}) {
  `),ee.uniforms.add(new Q.p("pixelRatio",(ne,se)=>se.camera.pixelRatio)),ee.code.add(re.H`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${X.stippleRequiresStretchMeasure?re.H`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),$.uniforms.add(new J.Q("stipplePatternTexture")),$.uniforms.add(new H.d("stipplePatternSDFNormalizer")),$.uniforms.add(new H.d("stipplePatternTextureSize")),$.uniforms.add(new H.d("stipplePatternPixelSizeInv")),$.code.add(re.H`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`),$.code.add(re.H`
    float getStippleSDF(out bool isClamped) {
      ${X.stippleRequiresClamp?re.H`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:re.H`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${X.stippleScaleWithLineWidth?re.H`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${X.stippleRequiresStretchMeasure?re.H`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:re.H`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${X.stippleScaleWithLineWidth?re.H`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:re.H`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),X.stippleOffColorEnabled?($.uniforms.add(new G.N("stippleOffColor",ne=>function ie(j){return(0,W.Wi)(j)?Z.Z:4===j.length?j:(0,B.s)(ue,j[0],j[1],j[2],1)}(ne.stippleOffColor))),$.code.add(re.H`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):$.code.add(re.H`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}(j,X):function le(j){j.fragment.code.add(re.H`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}(j)}const Y=re.H.float(.4)},31166:(dt,Re,T)=>{"use strict";T.d(Re,{k:()=>Q});var x=T(97139),A=T(65787),G=T(17625);function Q(H,re){const J=H.fragment;re.isGround?J.uniforms.add(new A.p("lightingFixedFactor",(W,B)=>(1-B.lighting.groundLightingFactor)*(1-B.lighting.globalFactor))):J.constants.add("lightingFixedFactor","float",0),J.uniforms.add([new x.J("lightingMainDirection",(W,B)=>B.lighting.lightingMainDirection),new x.J("lightingMainIntensity",(W,B)=>B.lighting.mainLight.intensity)]),J.code.add(G.H`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)}},82793:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>H,_:()=>re});var x=T(47923),A=T(95285),G=T(17625),Q=T(35387);function H(J){J.include(x.S),J.uniforms.add([new Q.A("geometryDepthTexture",(W,B)=>B.multipassGeometry.linearDepthTexture),new A.A("nearFar",(W,B)=>B.camera.nearFar)]),J.code.add(G.H`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}class re{constructor(){this.enabled=!1}}},10109:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>re,l:()=>H});var x=T(47923),A=T(95285),G=T(17625),Q=T(35387);function H(J,W){W.hasMultipassTerrain&&(J.fragment.include(x.S),J.fragment.uniforms.add(new Q.A("terrainDepthTexture",(B,Z)=>Z.multipassTerrain.linearDepthTexture)),J.fragment.uniforms.add(new A.A("nearFar",(B,Z)=>Z.camera.nearFar)),J.fragment.uniforms.add(new A.A("inverseViewport",(B,Z)=>Z.inverseViewport)),J.fragment.code.add(G.H`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${W.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}class re{constructor(){this.enabled=!1,this.cullAboveGround=!1}}},7025:(dt,Re,T)=>{"use strict";T.d(Re,{n:()=>A});var x=T(17625);function A(G,Q){G.vertex.code.add(Q.spherical?x.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`:x.H`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),G.vertex.code.add(Q.spherical?x.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`:x.H`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}},96395:(dt,Re,T)=>{"use strict";T.d(Re,{k:()=>G,q:()=>Q});var Q,H,x=T(94573),A=T(17625);function G(H,re){const J=H.fragment;switch(J.code.add(A.H`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),re.doubleSidedMode){case Q.None:J.code.add(A.H`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Q.View:J.code.add(A.H`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Q.WindingOrder:J.code.add(A.H`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:(0,x.Bg)(re.doubleSidedMode);case Q.COUNT:}}(H=Q||(Q={}))[H.None=0]="None",H[H.View=1]="View",H[H.WindingOrder=2]="WindingOrder",H[H.COUNT=3]="COUNT"},98898:(dt,Re,T)=>{"use strict";T.d(Re,{T:()=>H});var x=T(17625);function A(re){const J=re.fragment.code;J.add(x.H`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),J.add(x.H`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),J.add(x.H`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}var G=T(92724),Q=T(39337);function H(re,J){const W=re.fragment.code;re.include(Q.e),J.pbrMode===G.f7.Water||J.pbrMode===G.f7.WaterOnIntegratedMesh?(W.add(x.H`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${J.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),W.add(x.H`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),W.add(x.H`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),W.add(x.H`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),W.add(x.H`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)):J.pbrMode!==G.f7.Normal&&J.pbrMode!==G.f7.Schematic||(re.include(A),W.add(x.H`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),W.add(x.H`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),W.add(x.H`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),W.add(x.H`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),W.add(x.H`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),W.add(x.H`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}},92724:(dt,Re,T)=>{"use strict";T.d(Re,{Fw:()=>Z,f7:()=>ie,jV:()=>ce});var x=T(14658),A=T(95284),G=T(77739),Q=T(97139),H=T(17625),re=T(5864),J=T(35387),W=T(37847);T(33470);const Z=(0,x.f)(0,.6,.2);var ie,oe;function ce(oe,le){const Y=oe.fragment,j=le.hasMetalnessAndRoughnessTexture||le.hasEmissionTexture||le.hasOcclusionTexture;if(le.pbrMode===ie.Normal&&j&&oe.include(A.i,le),le.pbrMode!==ie.Schematic)if(le.pbrMode!==ie.Disabled){if(le.pbrMode===ie.Normal){Y.code.add(H.H`vec3 mrr;
vec3 emission;
float occlusion;`);const X=le.supportsTextureAtlas,U=le.pbrTextureBindType;le.hasMetalnessAndRoughnessTexture&&(Y.uniforms.add(U===W.P.Pass?(0,J.J)("texMetallicRoughness",ee=>ee.textureMetallicRoughness,X):(0,re.F)("texMetallicRoughness",ee=>ee.textureMetallicRoughness,X)),Y.code.add(H.H`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),le.hasEmissionTexture&&(Y.uniforms.add(U===W.P.Pass?(0,J.J)("texEmission",ee=>ee.textureEmissive,X):(0,re.F)("texEmission",ee=>ee.textureEmissive,X)),Y.code.add(H.H`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`)),le.hasOcclusionTexture?(Y.uniforms.add(U===W.P.Pass?(0,J.J)("texOcclusion",ee=>ee.textureOcclusion,X):(0,re.F)("texOcclusion",ee=>ee.textureOcclusion,X)),Y.code.add(H.H`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):Y.code.add(H.H`float getBakedOcclusion() { return 1.0; }`),Y.uniforms.add(U===W.P.Pass?[new Q.J("emissionFactor",ee=>ee.emissiveFactor),new Q.J("mrrFactors",ee=>ee.mrrFactors)]:[new G.B("emissionFactor",ee=>ee.emissiveFactor),new G.B("mrrFactors",ee=>ee.mrrFactors)]),Y.code.add(H.H`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${j?"vtc.uv = vuv0;":""}
      ${le.hasMetalnessAndRoughnessTexture?le.supportsTextureAtlas?"vtc.size = texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${le.hasEmissionTexture?le.supportsTextureAtlas?"vtc.size = texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${le.hasOcclusionTexture?le.supportsTextureAtlas?"vtc.size = texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}}else Y.code.add(H.H`float getBakedOcclusion() { return 1.0; }`);else Y.code.add(H.H`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}(oe=ie||(ie={}))[oe.Disabled=0]="Disabled",oe[oe.Normal=1]="Normal",oe[oe.Schematic=2]="Schematic",oe[oe.Water=3]="Water",oe[oe.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",oe[oe.COUNT=5]="COUNT"},39337:(dt,Re,T)=>{"use strict";T.d(Re,{e:()=>A});var x=T(17625);function A(G){G.vertex.code.add(x.H`const float PI = 3.141592653589793;`),G.fragment.code.add(x.H`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}},37926:(dt,Re,T)=>{"use strict";T.d(Re,{s:()=>re});var x=T(36603),A=T(95284),G=T(95267),Q=T(17625),H=T(5864);function re(J,W){const B=J.fragment;if(W.hasBaseColorTexture){J.include(A.i,W);const Z=W.textureCoordinateType===x.N.Atlas;B.uniforms.add((0,H.F)("baseColorTexture",ie=>ie.texture,Z)),Z?(J.include(G.r),B.code.add(Q.H`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):B.code.add(Q.H`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}else B.code.add(Q.H`vec4 readBaseColorTexture() { return vec4(1.0); }`)}},56693:(dt,Re,T)=>{"use strict";T.d(Re,{ry:()=>ie,XE:()=>ce,hb:()=>ue});var x=T(28093),A=T(19278),G=T(69960),Q=T(65787),H=T(18952),re=T(17625),J=T(85930),W=T(37847);class B extends J.x{constructor(Y,j,X,U){switch(j){case W.P.Pass:case W.P.Draw:return void super(Y,"mat4",j,(ee,$,ne)=>ee.setUniformMatrix4fv(Y,X($,ne)),U)}}}var Z=T(35387);class ie extends re.K{constructor(){super(...arguments),this.origin=(0,x.c)()}}function ue(le,Y){Y.receiveShadows&&(le.fragment.uniforms.add(new B("shadowMapMatrix",W.P.Pass,(j,X)=>X.shadowMap.getShadowMapMatrices(j.origin),4)),oe(le))}function ce(le,Y){Y.receiveShadows&&(le.fragment.uniforms.add(new B("shadowMapMatrix",W.P.Draw,(j,X)=>X.shadowMap.getShadowMapMatrices(j.origin),4)),oe(le))}function oe(le){const Y=le.fragment;Y.include(A.n),Y.uniforms.add([new Z.A("shadowMapTex",(j,X)=>X.shadowMap.depthTexture),new H._("numCascades",(j,X)=>X.shadowMap.numCascades),new G.N("cascadeDistances",(j,X)=>X.shadowMap.cascadeDistances),new Q.p("depthHalfPixelSz",(j,X)=>.5/X.shadowMap.textureSize)]),Y.code.add(re.H`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}},45867:(dt,Re,T)=>{"use strict";T.d(Re,{O:()=>B,P:()=>W});var x=T(43703),A=T(47923),G=T(95285),Q=T(65787),H=T(17625),re=T(63123),J=T(35387);function W(Z,ie){const ue=Z.fragment.uniforms;ue.add(new G.A("nearFar",(ce,oe)=>oe.camera.nearFar)),ue.add(new J.A("depthMap",(ce,oe)=>oe.linearDepthTexture)),ue.add(new re.g("view",(ce,oe)=>oe.ssr.camera.viewMatrix)),ue.add(new re.g("proj",(ce,oe)=>oe.ssr.camera.projectionMatrix)),ue.add(new Q.p("invResolutionHeight",(ce,oe)=>1/oe.ssr.camera.height)),ue.add(new J.A("lastFrameColorMap",(ce,oe)=>oe.ssr.lastFrameColorTexture)),ue.add(new re.g("reprojectionMatrix",(ce,oe)=>oe.ssr.reprojectionMatrix)),Z.fragment.include(A.S),Z.fragment.code.add(H.H`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${ie.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}class B{constructor(){this.reprojectionMatrix=(0,x.c)()}}},92836:(dt,Re,T)=>{"use strict";T.d(Re,{k:()=>W});var x=T(97139),A=T(48565),G=T(7090),Q=T(17625),H=T(91574),re=T(16396),J=T(41857);function W(B,Z){Z.hasVvInstancing&&(Z.vvSize||Z.vvColor)&&B.attributes.add(re.T.INSTANCEFEATUREATTRIBUTE,"vec4");const ie=B.vertex;Z.vvSize?(ie.uniforms.add(new x.J("vvSizeMinSize",ue=>ue.vvSizeMinSize)),ie.uniforms.add(new x.J("vvSizeMaxSize",ue=>ue.vvSizeMaxSize)),ie.uniforms.add(new x.J("vvSizeOffset",ue=>ue.vvSizeOffset)),ie.uniforms.add(new x.J("vvSizeFactor",ue=>ue.vvSizeFactor)),ie.uniforms.add(new H.c("vvSymbolRotationMatrix",ue=>ue.vvSymbolRotationMatrix)),ie.uniforms.add(new x.J("vvSymbolAnchor",ue=>ue.vvSymbolAnchor)),ie.code.add(Q.H`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),ie.code.add(Q.H`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${Z.hasVvInstancing?Q.H`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):ie.code.add(Q.H`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),Z.vvColor?(ie.constants.add("vvColorNumber","int",J.x),Z.hasVvInstancing&&ie.uniforms.add([new G.O("vvColorValues",ue=>ue.vvColorValues,J.x),new A.b("vvColorColors",ue=>ue.vvColorColors,J.x)]),ie.code.add(Q.H`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${Z.hasVvInstancing?Q.H`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):ie.code.add(Q.H`vec4 vvColor() { return vec4(1.0); }`)}},69117:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>W});var x=T(45027),A=T(96896),G=T(98898),Q=T(45867),H=T(69602),re=T(65787),J=T(17625);function W(B,Z){B.include(G.T,Z),B.include(A.D),B.include(x.E),Z.hasCloudsReflections&&B.include(H.j,Z),Z.hasScreenSpaceReflections&&B.include(Q.P,Z);const ie=B.fragment;ie.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),ie.code.add(J.H`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),ie.uniforms.add([new re.p("lightingSpecularStrength",(ue,ce)=>ce.lighting.mainLight.specularStrength),new re.p("lightingEnvironmentStrength",(ue,ce)=>ce.lighting.mainLight.environmentStrength)]),ie.code.add(J.H`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),Z.hasCloudsReflections&&ie.code.add(J.H`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),ie.code.add(Z.hasScreenSpaceReflections?J.H`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`:J.H`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),ie.code.add(Z.hasCloudsReflections?Z.hasScreenSpaceReflections?J.H`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`:J.H`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`:J.H`return waterRenderedColor;
}`)}},45780:(dt,Re,T)=>{"use strict";T.d(Re,{M:()=>Z});var x=T(67831),A=T(99770),G=T(993),Q=T(4794),H=T(45027),re=T(95285),J=T(69960),W=T(17625),B=T(66838);function Z(ce){ce.fragment.uniforms.add(new B.Q("texWaveNormal")),ce.fragment.uniforms.add(new B.Q("texWavePerturbation")),ce.fragment.uniforms.add([new J.N("waveParams",oe=>(0,G.s)(ie,oe.waveStrength,oe.waveTextureRepeat,oe.flowStrength,oe.flowOffset)),new re.A("waveDirection",oe=>(0,x.a)(ue,oe.waveDirection[0]*oe.waveVelocity,oe.waveDirection[1]*oe.waveVelocity))]),ce.include(H.K),ce.fragment.code.add(W.H`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const ie=(0,Q.c)(),ue=(0,A.a)()},89798:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>A});var x=T(17625);function A(G){G.code.add(x.H`
    float lineFactorAtPosition(float value) {
      float pos = value * ${x.H.float(257)};
      if(pos < 0.5 || pos > ${x.H.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)}},30249:(dt,Re,T)=>{"use strict";T.d(Re,{Tw:()=>X,WB:()=>Y,gT:()=>ce,uS:()=>oe,yl:()=>le});var ce,ne,x=T(4794),A=T(65401),G=T(75224),Q=T(43553),H=T(92724),re=T(69117),J=T(97139),W=T(90637),B=T(66054),Z=T(65787),ie=T(17625),ue=T(35387);(ne=ce||(ce={}))[ne.Disabled=0]="Disabled",ne[ne.Enabled=1]="Enabled",ne[ne.EnabledWithWater=2]="EnabledWithWater",ne[ne.COUNT=3]="COUNT";class oe extends ie.K{constructor(){super(...arguments),this.overlayOpacity=1}}function le(ne,se){ne.vertex.uniforms.add([new B.y("overlayTexOffset"),new B.y("overlayTexScale")]),ne.fragment.uniforms.add([new Z.p("overlayOpacity",ae=>ae.overlayOpacity),new ue.A("ovColorTex",(ae,de)=>0===de.overlays.length?null:de.overlays[G.fu.INNER].getColorTexture(ae.overlaySource))]),j(ne,se)}function Y(ne,se){const{vertex:ae,fragment:de}=ne;ae.uniforms.add([new W.$("overlayTexOffset",(_e,pe)=>function U(ne,se){for(const ae of se.overlays){const{index:de,extent:_e}=ae;(0,A.SO)(_e)>0&&($[2*de]=ne.toMapSpace[0]/(0,A.bf)(_e)-_e[0]/(0,A.bf)(_e),$[2*de+1]=ne.toMapSpace[1]/(0,A.Cb)(_e)-_e[1]/(0,A.Cb)(_e))}return $}(_e,pe)),new W.$("overlayTexScale",(_e,pe)=>function ee(ne,se){for(const ae of se.overlays){const{index:de,extent:_e}=ae;(0,A.SO)(_e)>0&&($[2*de]=ne.toMapSpace[2]/(0,A.bf)(_e),$[2*de+1]=ne.toMapSpace[3]/(0,A.Cb)(_e))}return $}(_e,pe))]),de.constants.add("overlayOpacity","float",1),de.uniforms.add(new ue.A("ovColorTex",(_e,pe)=>X(_e,pe))),j(ne,se)}function j(ne,se){ne.extensions.add("GL_OES_standard_derivatives"),se.pbrMode!==H.f7.Water&&se.pbrMode!==H.f7.WaterOnIntegratedMesh||ne.include(re.B,se);const{vertex:ae,fragment:de}=ne;ne.varyings.add("vtcOverlay","vec4"),ae.code.add(ie.H`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),de.code.add(ie.H`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),de.code.add(ie.H`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),se.pbrMode!==H.f7.Water&&se.pbrMode!==H.f7.WaterOnIntegratedMesh||(de.uniforms.add([new J.J("lightingMainDirection",(_e,pe)=>pe.lighting.lightingMainDirection),new J.J("lightingMainIntensity",(_e,pe)=>pe.lighting.mainLight.intensity)]),de.code.add(ie.H`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function X(ne,se){return 0===se.overlays.length?null:ne.identifier===Q.o9.Material&&ne.subPass===Q.zp.Color?se.overlays[G.fu.INNER].getColorTextureNoRasterImage():ne.identifier===Q.o9.Highlight?se.overlays[G.fu.INNER].getValidTexture(G.NH.Highlight):null}const $=(0,x.c)()},91528:(dt,Re,T)=>{"use strict";T.d(Re,{E:()=>W});var x=T(89798),A=T(87633),G=T(39704),Q=T(66054),H=T(84178),re=T(17625),J=T(66838);function W(B,Z){B.varyings.add("vtc","vec2"),B.vertex.uniforms.add(new Q.y("texOffsetAndScale")),B.fragment.uniforms.add(new J.Q("tex")),B.fragment.uniforms.add(new G.K("textureOpacities"));const ie=Z.textureFadingEnabled&&!Z.renderOccluded;ie&&(B.vertex.uniforms.add(new Q.y("nextTexOffsetAndScale")),B.varyings.add("nvtc","vec2"),B.fragment.uniforms.add(new J.Q("texNext")),B.fragment.uniforms.add(new G.K("nextTexOpacities")),B.fragment.uniforms.add(new H.d("fadeFactor")));const ue=Z.tileBlendInput===A.R.ColorComposite,ce=Z.tileBlendInput===A.R.GridComposite;ce&&B.fragment.include(x.H),ue&&B.fragment.uniforms.add(new G.K("backgroundColor")),B.vertex.code.add(re.H`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${ie?re.H`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:re.H``}
  }`),B.fragment.code.add(re.H`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${ce||ue?re.H`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${ue?re.H`vec4(backgroundColor, 1.0)`:re.H`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:re.H`return color;`}
    }`),B.fragment.code.add(ie?re.H`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`:re.H`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)}},87633:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{R:()=>x}),(A=x||(x={}))[A.LayerOnly=0]="LayerOnly",A[A.ColorComposite=1]="ColorComposite",A[A.GridComposite=2]="GridComposite",A[A.COUNT=3]="COUNT"},14273:(dt,Re,T)=>{"use strict";T.d(Re,{R:()=>re,T:()=>J});var x=T(99770),A=T(95285),G=T(65787),Q=T(17625),H=T(16396);class re extends Q.K{constructor(){super(...arguments),this.scale=1,this.offset=x.Z}}function J(W){W.attributes.add(H.T.POSITION,"vec2"),W.attributes.add(H.T.UV0,"vec2"),W.vertex.uniforms.add(new G.p("scale",B=>B.scale)),W.vertex.uniforms.add(new A.A("offset",B=>B.offset)),W.varyings.add("uv","vec2"),W.varyings.add("vuv","vec2"),W.vertex.code.add(Q.H`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}},67022:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>x,b:()=>A});const x=.1,A=.001},93609:(dt,Re,T)=>{"use strict";T.d(Re,{o:()=>J,z:()=>re});var x=T(49480),A=T(2163),G=T(65787),Q=T(17625),H=T(42743);function re(B,Z){W(B,Z,new G.p("textureAlphaCutoff",ie=>ie.textureAlphaCutoff))}function J(B,Z){W(B,Z,new A.p("textureAlphaCutoff",ie=>ie.textureAlphaCutoff))}function W(B,Z,ie){const ue=B.fragment;switch(Z.alphaDiscardMode!==H.JJ.Mask&&Z.alphaDiscardMode!==H.JJ.MaskBlend||ue.uniforms.add(ie),Z.alphaDiscardMode){case H.JJ.Blend:return B.include(x.f);case H.JJ.Opaque:ue.code.add(Q.H`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case H.JJ.Mask:ue.code.add(Q.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case H.JJ.MaskBlend:B.fragment.code.add(Q.H`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}},67668:(dt,Re,T)=>{"use strict";T.d(Re,{d:()=>G});var x=T(7699),A=T(17625);function G(Q,H){const re=H.blendMode;re!==x.iM.Normal&&(re===x.iM.Reflect&&Q.code.add(A.H`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),re!==x.iM.ColorDodge&&re!==x.iM.VividLight||Q.code.add(A.H`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),re!==x.iM.ColorBurn&&re!==x.iM.VividLight||Q.code.add(A.H`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),re===x.iM.Overlay&&Q.code.add(A.H`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),re===x.iM.HardLight&&Q.code.add(A.H`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),re===x.iM.SoftLight&&Q.code.add(A.H`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),re===x.iM.VividLight&&Q.code.add(A.H`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),re!==x.iM.Hue&&re!==x.iM.Saturation&&re!==x.iM.Color&&re!==x.iM.Luminosity||(Q.code.add(A.H`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),re!==x.iM.Hue&&re!==x.iM.Saturation||Q.code.add(A.H`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),Q.code.add(A.H`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${re===x.iM.Multiply?A.H`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Average?A.H`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Lighten?A.H`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Darken?A.H`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Lighter?A.H`return vec4(cl * ol + cb * ob, ol + ob);`:re===x.iM.Plus?A.H`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:re===x.iM.Minus?A.H`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:re===x.iM.Screen?A.H`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Difference?A.H`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Invert?A.H`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:re===x.iM.DestinationOver?A.H`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:re===x.iM.DestinationAtop?A.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:re===x.iM.DestinationOut?A.H`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:re===x.iM.SourceAtop?A.H`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:re===x.iM.SourceOut?A.H`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:re===x.iM.Xor?A.H`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:re===x.iM.DestinationIn?A.H`return vec4(cb * ob * ol, ol * ob);`:re===x.iM.SourceIn?A.H`return vec4(cl * ol * ob, ol * ob);`:re===x.iM.Hue?A.H`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Saturation?A.H`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Color?A.H`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Luminosity?A.H`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Exclusion?A.H`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Reflect?A.H`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.ColorDodge?A.H`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.ColorBurn?A.H`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.Overlay?A.H`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.SoftLight?A.H`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.HardLight?A.H`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:re===x.iM.VividLight?A.H`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:A.H``}
    }
  `))}},39832:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>W,R:()=>ie});var x=T(67831),A=T(99770),G=T(993),Q=T(4794),H=T(95285),re=T(69960),J=T(17625);function W(ce){ce.fragment.uniforms.add(new re.N("projInfo",(oe,le)=>function B(ce){const oe=ce.camera.projectionMatrix;return 0===oe[11]?(0,G.s)(Z,2/(ce.camera.fullWidth*oe[0]),2/(ce.camera.fullHeight*oe[5]),(1+oe[12])/oe[0],(1+oe[13])/oe[5]):(0,G.s)(Z,-2/(ce.camera.fullWidth*oe[0]),-2/(ce.camera.fullHeight*oe[5]),(1-oe[8])/oe[0],(1-oe[9])/oe[5])}(le))),ce.fragment.uniforms.add(new H.A("zScale",(oe,le)=>ie(le))),ce.fragment.code.add(J.H`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}const Z=(0,Q.c)();function ie(ce){return 0===ce.camera.projectionMatrix[11]?(0,x.a)(ue,0,1):(0,x.a)(ue,1,0)}const ue=(0,A.a)()},69602:(dt,Re,T)=>{"use strict";T.d(Re,{j:()=>Y});var x=T(21286),A=T(62208),G=T(67831),Q=T(99770),H=T(94425),re=T(12015),J=T(78038),W=T(95285),B=T(97139),Z=T(65787),ie=T(17625),ue=T(63123),ce=T(85930),oe=T(37847);class le extends ce.x{constructor(U,ee){super(U,"samplerCube",oe.P.Pass,($,ne,se)=>$.bindTexture(U,ee(ne,se)))}}function Y(X){const U=X.fragment;U.uniforms.add([new ue.g("rotationMatrixClouds",(ee,$)=>$.clouds.parallax.transform),new ue.g("rotationMatrixCloudsCrossFade",(ee,$)=>$.clouds.parallaxNew.transform),new B.J("anchorPosition",(ee,$)=>$.clouds.parallax.anchorPointClouds),new B.J("anchorPositionCrossFade",(ee,$)=>$.clouds.parallaxNew.anchorPointClouds),new W.A("cloudVariables",(ee,$)=>(0,A.pC)($.clouds.data)?(0,G.a)(j,$.clouds.data.coverage,$.clouds.data.absorption):Q.Z),new Z.p("cloudsHeight",(ee,$)=>$.clouds.parallax.cloudsHeight),new Z.p("radiusCurvatureCorrectionFactor",(ee,$)=>$.clouds.parallax.radiusCurvatureCorrectionFactor),new Z.p("totalFadeInOut",(ee,$)=>$.clouds.fadeInOut.stage===re.co.FINISHED?$.clouds.fadeInOutHeight.factor+Math.max((0,x.uZ)($.clouds.fadeIn.factor,0,1)):$.clouds.fadeInOutHeight.factor+Math.max((0,x.uZ)($.clouds.fadeInOut.factor,0,1))),new Z.p("crossFadeAnchorFactor",(ee,$)=>(0,x.uZ)($.clouds.crossFade.factor,0,1)),new le("cubeMap",(ee,$)=>(0,A.pC)($.clouds.data)?$.clouds.data.cubeMap.colorTexture:null),new J.U("crossFade",(ee,$)=>$.clouds.crossFade.enabled)]),U.constants.add("planetRadius","float",H.sv.radius),U.code.add(ie.H`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),U.code.add(ie.H`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),U.code.add(ie.H`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),U.uniforms.add([new B.J("lightingMainDirection",(ee,$)=>$.lighting.lightingMainDirection),new B.J("lightingMainIntensity",(ee,$)=>$.lighting.mainLight.intensity)]),U.code.add(ie.H`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),U.code.add(ie.H`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`),U.code.add(ie.H`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),U.code.add(ie.H`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),U.code.add(ie.H`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}const j=(0,Q.a)()},33726:(dt,Re,T)=>{"use strict";T.d(Re,{Y:()=>A});var x=T(17625);function A(G){G.code.add(x.H`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}},49480:(dt,Re,T)=>{"use strict";T.d(Re,{f:()=>G});var x=T(67022),A=T(17625);function G(Q){Q.fragment.code.add(A.H`
    #define discardOrAdjustAlpha(color) { if (color.a < ${A.H.float(x.b)}) { discard; } }
  `)}},7228:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>G,I:()=>Q});var x=T(8314),A=T(17625);function G({code:H},re){H.add(re.doublePrecisionRequiresObfuscation?A.H`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`:A.H`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}function Q(H){return!!(0,x.Z)("force-double-precision-obfuscation")||H.driverTest.doublePrecisionRequiresObfuscation}},22799:(dt,Re,T)=>{"use strict";T.d(Re,{U:()=>A,j:()=>G});var A,Q,x=T(37053);function G(Q){return Q&&(0,x.BZ)(Q)?A.Mars:Q&&(0,x.V2)(Q)?A.Moon:A.Earth}(Q=A||(A={}))[Q.Earth=1]="Earth",Q[Q.Mars=2]="Mars",Q[Q.Moon=3]="Moon",Q[Q.COUNT=4]="COUNT"},411:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>Q});var x=T(6945),A=T(17625),G=T(68598);function Q(H,re){const J=A.H`
  /*
  *  ${re.name}
  *  ${re.output===x.H.Color?"RenderOutput: Color":re.output===x.H.Depth?"RenderOutput: Depth":re.output===x.H.Shadow?"RenderOutput: Shadow":re.output===x.H.Normal?"RenderOutput: Normal":re.output===x.H.Highlight?"RenderOutput: Highlight":""}
  */
  `;(0,G.CG)()&&(H.fragment.code.add(J),H.vertex.code.add(J))}},28137:(dt,Re,T)=>{"use strict";T.d(Re,{y:()=>Q});var x=T(9044),A=T(33726),G=T(17625);function Q(H){H.include(A.Y),H.code.add(G.H`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${G.H.int(x.a9.Multiply)}) {
        return allMixed;
      }
      if (mode == ${G.H.int(x.a9.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${G.H.int(x.a9.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${G.H.int(x.a9.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${G.H.int(x.a9.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}},19278:(dt,Re,T)=>{"use strict";T.d(Re,{n:()=>A});var x=T(17625);function A(G){G.code.add(x.H`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}},71850:(dt,Re,T)=>{"use strict";T.d(Re,{cK:()=>H,m8:()=>J,ww:()=>re});var x=T(993),A=T(4794),G=T(69960),Q=T(17625);function H(Z){Z.vertex.code.add(Q.H`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),Z.vertex.code.add(Q.H`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),Z.vertex.code.add(Q.H`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),Z.vertex.code.add(Q.H`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),Z.vertex.code.add(Q.H`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),Z.vertex.code.add(Q.H`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),Z.vertex.code.add(Q.H`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function re(Z){Z.uniforms.add(new G.N("screenSizePerspective",ie=>W(ie.screenSizePerspective)))}function J(Z){Z.uniforms.add(new G.N("screenSizePerspectiveAlignment",ie=>W(ie.screenSizePerspectiveAlignment||ie.screenSizePerspective)))}function W(Z){return(0,x.s)(B,Z.parameters.divisor,Z.parameters.offset,Z.parameters.minPixelSize,Z.paddingPixelsOverride)}const B=(0,A.c)()},95267:(dt,Re,T)=>{"use strict";T.d(Re,{r:()=>A});var x=T(17625);function A(G){G.extensions.add("GL_EXT_shader_texture_lod"),G.extensions.add("GL_OES_standard_derivatives"),G.fragment.code.add(x.H`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)}},2166:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>Z,h:()=>B});var x=T(28347),A=T(55494),G=T(84161),Q=T(28093),H=T(77739),re=T(97139),J=T(47205),W=T(63123);function B(ce,oe){oe.instancedDoublePrecision?ce.constants.add("cameraPosition","vec3",Q.Z):ce.uniforms.add(new H.B("cameraPosition",(le,Y)=>(0,G.s)(ue,Y.camera.viewInverseTransposeMatrix[3]-le.origin[0],Y.camera.viewInverseTransposeMatrix[7]-le.origin[1],Y.camera.viewInverseTransposeMatrix[11]-le.origin[2])))}function Z(ce,oe){if(ce.vertex.uniforms.add(new W.g("proj",(Y,j)=>j.camera.projectionMatrix)),oe.instancedDoublePrecision){const Y=(X,U)=>(0,G.s)(ue,U.camera.viewInverseTransposeMatrix[3],U.camera.viewInverseTransposeMatrix[7],U.camera.viewInverseTransposeMatrix[11]);ce.vertex.uniforms.add(new W.g("view",(X,U)=>(0,x.j)(ie,U.camera.viewMatrix,Y(X,U))));const j=new re.J("localOrigin",Y);return ce.vertex.uniforms.add(j),j}ce.vertex.uniforms.add(new J.K("view",(Y,j)=>(0,x.j)(ie,j.camera.viewMatrix,Y.origin)));const le=new H.B("localOrigin",Y=>Y.origin);return ce.vertex.uniforms.add(le),le}const ie=(0,A.c)(),ue=(0,Q.c)()},78038:(dt,Re,T)=>{"use strict";T.d(Re,{U:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"bool",A.P.Pass,(J,W,B)=>J.setUniform1b(H,re(W,B)))}}},32181:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"vec2",A.P.Draw,(J,W,B)=>J.setUniform2fv(H,re(W,B)))}}},95285:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"vec2",A.P.Pass,(J,W,B)=>J.setUniform2fv(H,re(W,B)))}}},65364:(dt,Re,T)=>{"use strict";T.d(Re,{e:()=>A});var x=T(85930);class A extends x.x{constructor(Q){super(Q,"vec2")}}},77739:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"vec3",A.P.Draw,(J,W,B)=>J.setUniform3fv(H,re(W,B)))}}},97139:(dt,Re,T)=>{"use strict";T.d(Re,{J:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"vec3",A.P.Pass,(J,W,B)=>J.setUniform3fv(H,re(W,B)))}}},39704:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>A});var x=T(85930);class A extends x.x{constructor(Q){super(Q,"vec3")}}},90637:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"vec4",A.P.Draw,(J,W,B)=>J.setUniform4fv(H,re(W,B)))}}},69960:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"vec4",A.P.Pass,(J,W,B)=>J.setUniform4fv(H,re(W,B)))}}},66054:(dt,Re,T)=>{"use strict";T.d(Re,{y:()=>A});var x=T(85930);class A extends x.x{constructor(Q){super(Q,"vec4")}}},48565:(dt,Re,T)=>{"use strict";T.d(Re,{b:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re,J){super(H,"vec4",A.P.Pass,(W,B,Z)=>W.setUniform4fv(H,re(B,Z)),J)}}},2163:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"float",A.P.Draw,(J,W,B)=>J.setUniform1f(H,re(W,B)))}}},65787:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"float",A.P.Pass,(J,W,B)=>J.setUniform1f(H,re(W,B)))}}},84178:(dt,Re,T)=>{"use strict";T.d(Re,{d:()=>A});var x=T(85930);class A extends x.x{constructor(Q){super(Q,"float")}}},7090:(dt,Re,T)=>{"use strict";T.d(Re,{O:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re,J){super(H,"float",A.P.Pass,(W,B,Z)=>W.setUniform1fv(H,re(B,Z)),J)}}},18952:(dt,Re,T)=>{"use strict";T.d(Re,{_:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"int",A.P.Pass,(J,W,B)=>J.setUniform1i(H,re(W,B)))}}},9546:(dt,Re,T)=>{"use strict";T.d(Re,{j:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"mat3",A.P.Draw,(J,W,B)=>J.setUniformMatrix3fv(H,re(W,B)))}}},91574:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"mat3",A.P.Pass,(J,W,B)=>J.setUniformMatrix3fv(H,re(W,B)))}}},47205:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"mat4",A.P.Draw,(J,W,B)=>J.setUniformMatrix4fv(H,re(W,B)))}}},63123:(dt,Re,T)=>{"use strict";T.d(Re,{g:()=>G});var x=T(85930),A=T(37847);class G extends x.x{constructor(H,re){super(H,"mat4",A.P.Pass,(J,W,B)=>J.setUniformMatrix4fv(H,re(W,B)))}}},46524:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>A});var x=T(85930);class A extends x.x{constructor(Q){super(Q,"mat4")}}},22355:(dt,Re,T)=>{"use strict";T.d(Re,{kG:()=>re});var x=T(26584),A=T(63290),G=T(62208);const Q=A.Z.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class H{constructor(){this.includedModules=new Map}include(j,X){if(this.includedModules.has(j)){const U=this.includedModules.get(j);if(U!==X){Q.error("Trying to include shader module multiple times with different sets of options.");const ee=new Set;for(const $ of Object.keys(U))U[$]!==j[$]&&ee.add($);for(const $ of Object.keys(j))U[$]!==j[$]&&ee.add($);ee.forEach($=>console.error(`  ${$}: current ${U[$]} new ${j[$]}`))}}else this.includedModules.set(j,X),j(this.builder,X)}}class re extends H{constructor(){super(...arguments),this.vertex=new B,this.fragment=new B,this.attributes=new Z,this.varyings=new ie,this.extensions=new ue,this.constants=new ce}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(j){const X=this.extensions.generateSource(j),U=this.attributes.generateSource(j),ee=this.varyings.generateSource(),$="vertex"===j?this.vertex:this.fragment,ne=$.uniforms.generateSource(),se=$.code.generateSource(),ae="vertex"===j?le:oe,de=this.constants.generateSource().concat($.constants.generateSource());return`\n${X.join("\n")}\n\n${ae}\n\n${de.join("\n")}\n\n${ne.join("\n")}\n\n${U.join("\n")}\n\n${ee.join("\n")}\n\n${se.join("\n")}`}generateBind(j,X){const U=new Map;this.vertex.uniforms.entries.forEach(ne=>{const se=ne.bind[j];(0,G.pC)(se)&&U.set(ne.name,se)}),this.fragment.uniforms.entries.forEach(ne=>{const se=ne.bind[j];(0,G.pC)(se)&&U.set(ne.name,se)});const ee=Array.from(U.values()),$=ee.length;return(ne,se)=>{for(let ae=0;ae<$;++ae)ee[ae](X,ne,se)}}}class J{constructor(){this._entries=new Map}add(j){if(!Array.isArray(j))return this._add(j);for(const X of j)this._add(X)}_add(j){if(this._entries.has(j.name)&&!this._entries.get(j.name).equals(j))throw new x.Z(`Duplicate uniform name ${j.name} for different uniform type`);this._entries.set(j.name,j)}generateSource(){return Array.from(this._entries.values()).map(j=>(0,G.pC)(j.arraySize)?`uniform ${j.type} ${j.name}[${j.arraySize}];`:`uniform ${j.type} ${j.name};`)}get entries(){return Array.from(this._entries.values())}}class W{constructor(){this._entries=new Array}add(j){this._entries.push(j)}generateSource(){return this._entries}}class B extends H{constructor(){super(...arguments),this.uniforms=new J,this.code=new W,this.constants=new ce}get builder(){return this}}class Z{constructor(){this._entries=new Array}add(j,X){this._entries.push([j,X])}generateSource(j){return"fragment"===j?[]:this._entries.map(X=>`attribute ${X[1]} ${X[0]};`)}}class ie{constructor(){this._entries=new Array}add(j,X){this._entries.push([j,X])}generateSource(){return this._entries.map(j=>`varying ${j[1]} ${j[0]};`)}}class ue{constructor(){this._entries=new Set}add(j){this._entries.add(j)}generateSource(j){const X="vertex"===j?ue.ALLOWLIST_VERTEX:ue.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(U=>X.includes(U)).map(U=>`#extension ${U} : enable`)}}ue.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],ue.ALLOWLIST_VERTEX=[];class ce{constructor(){this._entries=new Set}add(j,X,U){let ee="ERROR_CONSTRUCTOR_STRING";switch(X){case"float":ee=ce._numberToFloatStr(U);break;case"int":ee=ce._numberToIntStr(U);break;case"bool":ee=U.toString();break;case"vec2":ee=`vec2(${ce._numberToFloatStr(U[0])},                            ${ce._numberToFloatStr(U[1])})`;break;case"vec3":ee=`vec3(${ce._numberToFloatStr(U[0])},                            ${ce._numberToFloatStr(U[1])},                            ${ce._numberToFloatStr(U[2])})`;break;case"vec4":ee=`vec4(${ce._numberToFloatStr(U[0])},                            ${ce._numberToFloatStr(U[1])},                            ${ce._numberToFloatStr(U[2])},                            ${ce._numberToFloatStr(U[3])})`;break;case"ivec2":ee=`ivec2(${ce._numberToIntStr(U[0])},                             ${ce._numberToIntStr(U[1])})`;break;case"ivec3":ee=`ivec3(${ce._numberToIntStr(U[0])},                             ${ce._numberToIntStr(U[1])},                             ${ce._numberToIntStr(U[2])})`;break;case"ivec4":ee=`ivec4(${ce._numberToIntStr(U[0])},                             ${ce._numberToIntStr(U[1])},                             ${ce._numberToIntStr(U[2])},                             ${ce._numberToIntStr(U[3])})`;break;case"mat2":case"mat3":case"mat4":ee=`${X}(${Array.prototype.map.call(U,$=>ce._numberToFloatStr($)).join(", ")})`}return this._entries.add(`const ${X} ${j} = ${ee};`),this}static _numberToIntStr(j){return j.toFixed(0)}static _numberToFloatStr(j){return Number.isInteger(j)?j.toFixed(1):j.toString()}generateSource(){return Array.from(this._entries)}}const oe="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif",le="precision highp float;\nprecision highp sampler2D;"},5864:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>W,R:()=>J});var x=T(62208),A=T(67831),G=T(99770),Q=T(32181),H=T(85930),re=T(37847);class J extends H.x{constructor(ie,ue){super(ie,"sampler2D",re.P.Draw,(ce,oe,le)=>ce.bindTexture(ie,ue(oe,le)))}}function W(Z,ie,ue){const ce=[new J(Z,ie)];return ue&&ce.push(new Q.q(Z+"Size",(le,Y)=>{const j=ie(le,Y);return(0,x.pC)(j)?(0,A.a)(B,j.descriptor.width,j.descriptor.height):G.Z})),ce}const B=(0,G.a)()},35387:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>J,J:()=>W});var x=T(62208),A=T(67831),G=T(99770),Q=T(95285),H=T(85930),re=T(37847);class J extends H.x{constructor(ie,ue){super(ie,"sampler2D",re.P.Pass,(ce,oe,le)=>ce.bindTexture(ie,ue(oe,le)))}}function W(Z,ie,ue){const ce=[new J(Z,ie)];return ue&&ce.push(new Q.A(Z+"Size",(le,Y)=>{const j=ie(le,Y);return(0,x.pC)(j)?(0,A.a)(B,j.descriptor.width,j.descriptor.height):G.Z})),ce}const B=(0,G.a)()},66838:(dt,Re,T)=>{"use strict";T.d(Re,{Q:()=>A});var x=T(85930);class A extends x.x{constructor(Q){super(Q,"sampler2D")}}},85930:(dt,Re,T)=>{"use strict";T.d(Re,{x:()=>G});var x=T(62208),A=T(37847);class G{constructor(H,re,J,W,B=null){this.name=H,this.type=re,this.arraySize=B,this.bind={[A.P.Pass]:null,[A.P.Draw]:null},(0,x.pC)(J)&&(0,x.pC)(W)&&(this.bind[J]=W)}equals(H){return this.type===H.type&&this.name===H.name&&this.arraySize===H.arraySize}}},17625:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>A,K:()=>x});class x{}function A(G,...Q){let H="";for(let re=0;re<Q.length;re++)H+=G[re]+Q[re];return H+=G[G.length-1],H}var G;(G=A||(A={})).int=function Q(re){return Math.round(re).toString()},G.float=function H(re){return re.toPrecision(8)}},37847:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{P:()=>x}),(A=x||(x={}))[A.Pass=0]="Pass",A[A.Draw=1]="Draw"},651:(dt,Re,T)=>{"use strict";T.d(Re,{J:()=>A});var x=T(15861);class A{constructor(Q,H){this._module=Q,this._loadModule=H}get(){return this._module}reload(){var Q=this;return(0,x.Z)(function*(){return Q._module=yield Q._loadModule(),Q._module})()}}},91056:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>G});var x=T(62208),A=T(67969);class G{constructor(H,re,J){this.release=J,re&&(this.initializeConfiguration(H,re),this._configuration=re.snapshot()),this._program=this.initializeProgram(H),this._pipeline=this.initializePipeline(H.rctx.capabilities)}destroy(){this._program=(0,x.O3)(this._program),this._pipeline=this._configuration=null}reload(H){(0,x.O3)(this._program),this._program=this.initializeProgram(H),this._pipeline=this.initializePipeline(H.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.isCompiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPass(H,re){this.program.bindPass(H,re)}bindDraw(H,re){this.program.bindDraw(H,re),this.program.rebindTextures()}bindPipelineState(H,re=null,J){H.setPipelineState(this.getPipelineState(re,J))}ensureAttributeLocations(H){this.program.assertCompatibleVertexAttributeLocations(H)}get primitiveType(){return A.MX.TRIANGLES}getPipelineState(H,re){return this._pipeline}initializeConfiguration(H,re){}}},87601:(dt,Re,T)=>{"use strict";T.d(Re,{m:()=>x,o:()=>A});class x{constructor(){this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const Q=this._parameterNames,H={key:this.key};for(const re of Q)H[re]=this[re];return H}}function A(G={}){return(Q,H)=>{var re,J;if(Q._parameterNames=null!=(re=Q._parameterNames)?re:[],Q._parameterNames.push(H),null!=G.constValue)Object.defineProperty(Q,H,{get:()=>G.constValue});else{const W=Q._parameterNames.length-1,Z=Math.ceil(Math.log2(G.count||2)),ie=null!=(J=Q._parameterBits)?J:[0];let ue=0;for(;ie[ue]+Z>16;)ue++,ue>=ie.length&&ie.push(0);Q._parameterBits=ie;const ce=ie[ue],oe=(1<<Z)-1<<ce;ie[ue]+=Z,Object.defineProperty(Q,H,{get(){return this[W]},set(le){if(this[W]!==le&&(this[W]=le,this._keyDirty=!0,this._parameterBits[ue]=this._parameterBits[ue]&~oe|+le<<ce&oe,"number"!=typeof le&&"boolean"!=typeof le))throw"Configuration value for "+H+" must be boolean or number, got "+typeof le}})}}}},45323:(dt,Re,T)=>{"use strict";T.d(Re,{M:()=>Q});var x=T(15861),A=T(62208),G=T(1101);class Q{constructor(W){this._context=W,this._perConstructorInstances=new G.r,this._frameCounter=0,this._keepAliveFrameCount=re}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}dispose(){this._perConstructorInstances.forEach(W=>W.forEach(B=>B.technique.destroy())),this._perConstructorInstances.clear()}acquire(W,B){const Z=B.key;let ie=this._perConstructorInstances.get(W,Z);if((0,A.Wi)(ie)){const ue=new W(this._context,B,()=>this.release(ue));ie=new H(ue),this._perConstructorInstances.set(W,Z,ie)}return++ie.refCount,ie.technique}releaseAndAcquire(W,B,Z){if((0,A.pC)(Z)){if(B.key===Z.key)return Z;this.release(Z)}return this.acquire(W,B)}release(W){if((0,A.Wi)(W)||this._perConstructorInstances.empty)return;const B=this._perConstructorInstances.get(W.constructor,W.key);(0,A.Wi)(B)||(--B.refCount,0===B.refCount&&(B.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==re&&this._perConstructorInstances.forEach((W,B)=>{W.forEach((Z,ie)=>{0===Z.refCount&&Z.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(Z.technique.destroy(),this._perConstructorInstances.delete(B,ie))})})}reloadAll(){var W=this;return(0,x.Z)(function*(){const B=new Array;W._perConstructorInstances.forEach((Z,ie)=>{const ue=function(){var ce=(0,x.Z)(function*(oe,le){const Y=le.shader;Y&&(yield Y.reload(),oe.forEach(j=>{j.technique.reload(W._context)}))});return function(le,Y){return ce.apply(this,arguments)}}();B.push(ue(Z,ie))}),yield Promise.all(B)})()}}class H{constructor(W){this.technique=W,this.refCount=0,this.refZeroFrame=0}}const re=-1},42836:(dt,Re,T)=>{"use strict";T.d(Re,{d:()=>G});var x=T(62208),A=T(27422);class G{constructor(){this.enabled=!0,this._time=0}get time(){return(0,A.HA)(this._time)}advance(H){return(0,x.pC)(H.forcedTime)?this._time!==H.forcedTime&&(this._time=H.forcedTime,!0):!(!this.enabled||0===H.dt||(this._time+=H.dt,0))}}},2286:(dt,Re,T)=>{"use strict";T.d(Re,{TF:()=>x,Xn:()=>A,gT:()=>G});const x=Q=>class H extends Q{constructor(){super(...arguments),this._isDisposed=!1}dispose(){var J;for(const W of null!=(J=this._managedDisposables)?J:[]){const B=this[W];this[W]=null,B&&"function"==typeof B.dispose&&B.dispose()}this._isDisposed=!0}get isDisposed(){return this._isDisposed}};class A extends(x(class{})){}function G(){return(Q,H)=>{var re,J;Q.hasOwnProperty("_managedDisposables")||(Q._managedDisposables=null!=(J=null==(re=Q._managedDisposables)?void 0:re.slice())?J:[]),Q._managedDisposables.unshift(H)}}},13756:(dt,Re,T)=>{"use strict";T.d(Re,{fX:()=>U,pk:()=>$,$u:()=>oe,_h:()=>le,$8:()=>ue});var x=T(15861),A=T(62208),G=T(54346);function Q(){if((0,A.Wi)(H)){const ae=de=>(0,G.V)(`esri/libs/basisu/${de}`);H=T.e(2405).then(T.bind(T,52405)).then(de=>de.b).then(({default:de})=>de({locateFile:ae}).then(_e=>(_e.initializeBasis(),delete _e.then,_e)))}return H}let H;var re,ae;(ae=re||(re={}))[ae.ETC1_RGB=0]="ETC1_RGB",ae[ae.ETC2_RGBA=1]="ETC2_RGBA",ae[ae.BC1_RGB=2]="BC1_RGB",ae[ae.BC3_RGBA=3]="BC3_RGBA",ae[ae.BC4_R=4]="BC4_R",ae[ae.BC5_RG=5]="BC5_RG",ae[ae.BC7_M6_RGB=6]="BC7_M6_RGB",ae[ae.BC7_M5_RGBA=7]="BC7_M5_RGBA",ae[ae.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",ae[ae.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",ae[ae.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",ae[ae.ATC_RGB=11]="ATC_RGB",ae[ae.ATC_RGBA=12]="ATC_RGBA",ae[ae.FXT1_RGB=17]="FXT1_RGB",ae[ae.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",ae[ae.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",ae[ae.ETC2_EAC_R11=20]="ETC2_EAC_R11",ae[ae.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",ae[ae.RGBA32=13]="RGBA32",ae[ae.RGB565=14]="RGB565",ae[ae.BGR565=15]="BGR565",ae[ae.RGBA4444=16]="RGBA4444";var J=T(67969),W=T(55086),B=T(26906);let Z=null,ie=null;function ue(){return ce.apply(this,arguments)}function ce(){return(ce=(0,x.Z)(function*(){return(0,A.Wi)(ie)&&(ie=Q(),Z=yield ie),ie})).apply(this,arguments)}function oe(ae,de){if((0,A.Wi)(Z))return ae.byteLength;const _e=new Z.BasisFile(new Uint8Array(ae)),pe=j(_e)?Y(_e.getNumLevels(0),_e.getHasAlpha(),_e.getImageWidth(0,0),_e.getImageHeight(0,0),de):0;return _e.close(),_e.delete(),pe}function le(ae,de){if((0,A.Wi)(Z))return ae.byteLength;const _e=new Z.KTX2File(new Uint8Array(ae)),pe=X(_e)?Y(_e.getLevels(),_e.getHasAlpha(),_e.getWidth(),_e.getHeight(),de):0;return _e.close(),_e.delete(),pe}function Y(ae,de,_e,pe,he){const ge=(0,B.RG)(de?J.q_.COMPRESSED_RGBA8_ETC2_EAC:J.q_.COMPRESSED_RGB8_ETC2);return Math.ceil(_e*pe*ge*(he&&ae>1?(4**ae-1)/(3*4**(ae-1)):1))}function j(ae){return ae.getNumImages()>=1&&!ae.isUASTC()}function X(ae){return ae.getFaces()>=1&&ae.isETC1S()}function U(ae,de,_e){return ee.apply(this,arguments)}function ee(){return ee=(0,x.Z)(function*(ae,de,_e){(0,A.Wi)(Z)&&(Z=yield ue());const pe=new Z.BasisFile(new Uint8Array(_e));if(!j(pe))return null;pe.startTranscoding();const he=se(ae,de,pe.getNumLevels(0),pe.getHasAlpha(),pe.getImageWidth(0,0),pe.getImageHeight(0,0),(ge,ye)=>pe.getImageTranscodedSizeInBytes(0,ge,ye),(ge,ye,Me)=>pe.transcodeImage(Me,0,ge,ye,0,0));return pe.close(),pe.delete(),he}),ee.apply(this,arguments)}function $(ae,de,_e){return ne.apply(this,arguments)}function ne(){return ne=(0,x.Z)(function*(ae,de,_e){(0,A.Wi)(Z)&&(Z=yield ue());const pe=new Z.KTX2File(new Uint8Array(_e));if(!X(pe))return null;pe.startTranscoding();const he=se(ae,de,pe.getLevels(),pe.getHasAlpha(),pe.getWidth(),pe.getHeight(),(ge,ye)=>pe.getImageTranscodedSizeInBytes(ge,0,0,ye),(ge,ye,Me)=>pe.transcodeImage(Me,ge,0,0,ye,0,-1,-1));return pe.close(),pe.delete(),he}),ne.apply(this,arguments)}function se(ae,de,_e,pe,he,ge,ye,Me){const{compressedTextureETC:Ee,compressedTextureS3TC:Te}=ae.capabilities,[me,Ce]=Ee?pe?[re.ETC2_RGBA,J.q_.COMPRESSED_RGBA8_ETC2_EAC]:[re.ETC1_RGB,J.q_.COMPRESSED_RGB8_ETC2]:Te?pe?[re.BC3_RGBA,J.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[re.BC1_RGB,J.q_.COMPRESSED_RGB_S3TC_DXT1_EXT]:[re.RGBA32,J.VI.RGBA],Ie=de.hasMipmap?_e:Math.min(1,_e),Ge=[];for(let We=0;We<Ie;We++)Ge.push(new Uint8Array(ye(We,me))),Me(We,me,Ge[We]);const Je=Ge.length>1,xe=Je?J.cw.LINEAR_MIPMAP_LINEAR:J.cw.LINEAR,je=yi(or({},de),{samplingMode:xe,hasMipmap:Je,internalFormat:Ce,width:he,height:ge});return new W.x(ae,je,{type:"compressed",levels:Ge})}},74202:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>W});var x=T(99770),A=T(12015),G=T(82793),Q=T(10109),H=T(45867),re=T(5894),J=T(95279);class W{constructor(Z,ie,ue){this.shadowMap=Z,this.ssaoHelper=ie,this.slicePlane=ue,this.slot=re.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this._inverseViewport=(0,x.a)(),this.lighting=new J.c,this.ssr=new H.O,this.multipassTerrain=new Q.a,this.multipassGeometry=new G._,this.clouds=new A.yl,this.overlays=[]}get camera(){return this._camera}set camera(Z){this._camera=this.ssr.camera=Z,this._inverseViewport[0]=1/Z.fullViewport[2],this._inverseViewport[1]=1/Z.fullViewport[3]}get inverseViewport(){return this._inverseViewport}}},98565:(dt,Re,T)=>{"use strict";T.d(Re,{j:()=>H});var x=T(77029),A=T(84161),G=T(28093),Q=T(2282);class H{constructor(W,B,Z,ie){this.primitiveIndices=W,this._numIndexPerPrimitive=B,this.indices=Z,this.position=ie,this.center=(0,G.c)(),(0,Q.hu)(W.length>=1),(0,Q.hu)(Z.length%this._numIndexPerPrimitive==0),(0,Q.hu)(Z.length>=W.length*this._numIndexPerPrimitive),(0,Q.hu)(3===ie.size||4===ie.size);const{data:ue,size:ce}=ie,oe=W.length;let le=ce*Z[this._numIndexPerPrimitive*W[0]];re.clear(),re.push(le),this.bbMin=(0,G.f)(ue[le],ue[le+1],ue[le+2]),this.bbMax=(0,G.a)(this.bbMin);for(let j=0;j<oe;++j){const X=this._numIndexPerPrimitive*W[j];for(let U=0;U<this._numIndexPerPrimitive;++U){le=ce*Z[X+U],re.push(le);let ee=ue[le];this.bbMin[0]=Math.min(ee,this.bbMin[0]),this.bbMax[0]=Math.max(ee,this.bbMax[0]),ee=ue[le+1],this.bbMin[1]=Math.min(ee,this.bbMin[1]),this.bbMax[1]=Math.max(ee,this.bbMax[1]),ee=ue[le+2],this.bbMin[2]=Math.min(ee,this.bbMin[2]),this.bbMax[2]=Math.max(ee,this.bbMax[2])}}(0,A.h)(this.center,this.bbMin,this.bbMax,.5),this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);let Y=this.radius*this.radius;for(let j=0;j<re.length;++j){le=re.getItemAt(j);const X=ue[le]-this.center[0],U=ue[le+1]-this.center[1],ee=ue[le+2]-this.center[2],$=X*X+U*U+ee*ee;if($<=Y)continue;const ne=Math.sqrt($),se=.5*(ne-this.radius);this.radius=this.radius+se,Y=this.radius*this.radius;const ae=se/ne;this.center[0]+=X*ae,this.center[1]+=U*ae,this.center[2]+=ee*ae}re.clear()}getCenter(){return this.center}getBSRadius(){return this.radius}getBBMin(){return this.bbMin}getBBMax(){return this.bbMax}getChildren(){if(this._children)return this._children;if((0,A.d)(this.bbMin,this.bbMax)>1){const W=(0,A.h)((0,G.c)(),this.bbMin,this.bbMax,.5),B=this.primitiveIndices.length,Z=new Uint8Array(B),ie=new Array(8);for(let Y=0;Y<8;++Y)ie[Y]=0;const{data:ue,size:ce}=this.position;for(let Y=0;Y<B;++Y){let j=0;const X=this._numIndexPerPrimitive*this.primitiveIndices[Y];let U=ce*this.indices[X],ee=ue[U],$=ue[U+1],ne=ue[U+2];for(let se=1;se<this._numIndexPerPrimitive;++se){U=ce*this.indices[X+se];const ae=ue[U],de=ue[U+1],_e=ue[U+2];ae<ee&&(ee=ae),de<$&&($=de),_e<ne&&(ne=_e)}ee<W[0]&&(j|=1),$<W[1]&&(j|=2),ne<W[2]&&(j|=4),Z[Y]=j,++ie[j]}let oe=0;for(let Y=0;Y<8;++Y)ie[Y]>0&&++oe;if(oe<2)return;const le=new Array(8);for(let Y=0;Y<8;++Y)le[Y]=ie[Y]>0?new Uint32Array(ie[Y]):void 0;for(let Y=0;Y<8;++Y)ie[Y]=0;for(let Y=0;Y<B;++Y){const j=Z[Y];le[j][ie[j]++]=this.primitiveIndices[Y]}this._children=new Array(8);for(let Y=0;Y<8;++Y)void 0!==le[Y]&&(this._children[Y]=new H(le[Y],this._numIndexPerPrimitive,this.indices,this.position))}return this._children}static prune(){re.prune()}}const re=new x.Z({deallocator:null})},59856:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>de,V:()=>U});var x=T(63290),A=T(21286),G=T(62208),Q=T(23841),H=T(28347),re=T(43703),J=T(67831),W=T(99770),B=T(84161),Z=T(28093),ie=T(993),ue=T(4794),ce=T(8834),oe=T(70562),le=T(34054),Y=T(59617),j=T(2282);const X=x.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera");class U{constructor(pe=null,he=null,ge=null){this._viewUp=(0,Z.c)(),this._viewForward=(0,Z.c)(),this._viewRight=(0,Z.c)(),this._ray=(0,oe.Ue)(),this._viewport=(0,ue.f)(0,0,1,1),this._padding=(0,ue.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,W.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,re.c)(),this._projectionDirty=!0,this._projectionMatrix=(0,re.c)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,re.c)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,re.c)(),this._inverseProjectionDirty=!0,this._inverseProjectionMatrix=null,this._frustumDirty=!0,this._frustum=(0,ce.Ue)(),this._fullViewport=(0,ue.c)(),this._pixelRatio=1,this.relativeElevation=0,(0,G.pC)(pe)&&(0,B.c)(this._ray.origin,pe),this._center=(0,G.pC)(he)?(0,Z.a)(he):(0,Z.c)(),this._up=(0,G.pC)(ge)?(0,Z.a)(ge):(0,Z.f)(0,0,1)}get pixelRatio(){return this._pixelRatio}set pixelRatio(pe){this._pixelRatio=pe>0?pe:1}get eye(){return this._ray.origin}set eye(pe){this._compareAndSetView(pe,this._ray.origin)}get center(){return this._center}set center(pe){this._compareAndSetView(pe,this._center)}get ray(){return(0,B.b)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(pe){this._compareAndSetView(pe,this._up)}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(pe){(0,H.c)(this._viewMatrix,pe),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(pe){this._nearFar[0]!==pe&&(this._nearFar[0]=pe,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get far(){return this._nearFar[1]}set far(pe){this._nearFar[1]!==pe&&(this._nearFar[1]=pe,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewport(){return this._viewport}set viewport(pe){this.x=pe[0],this.y=pe[1],this.width=pe[2],this.height=pe[3]}get x(){return this._viewport[0]}set x(pe){this._viewport[0]!==(pe+=this._padding[de.LEFT])&&(this._viewport[0]=pe,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get y(){return this._viewport[1]}set y(pe){this._viewport[1]!==(pe+=this._padding[de.BOTTOM])&&(this._viewport[1]=pe,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get width(){return this._viewport[2]}set width(pe){this._viewport[2]!==pe&&(this._viewport[2]=pe,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get height(){return this._viewport[3]}set height(pe){this._viewport[3]!==pe&&(this._viewport[3]=pe,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get fullWidth(){return this._viewport[2]+this._padding[de.RIGHT]+this._padding[de.LEFT]}set fullWidth(pe){this.width=pe-(this._padding[de.RIGHT]+this._padding[de.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[de.TOP]+this._padding[de.BOTTOM]}set fullHeight(pe){this.height=pe-(this._padding[de.TOP]+this._padding[de.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[de.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[de.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get aspect(){return this.width/this.height}get padding(){return this._padding}set padding(pe){this._padding[de.TOP]===pe[de.TOP]&&this._padding[de.RIGHT]===pe[de.RIGHT]&&this._padding[de.BOTTOM]===pe[de.BOTTOM]&&this._padding[de.LEFT]===pe[de.LEFT]||(this._viewport[0]+=pe[de.LEFT]-this._padding[de.LEFT],this._viewport[1]+=pe[de.BOTTOM]-this._padding[de.BOTTOM],this._viewport[2]-=pe[de.RIGHT]+pe[de.LEFT]-(this._padding[de.RIGHT]+this._padding[de.LEFT]),this._viewport[3]-=pe[de.TOP]+pe[de.BOTTOM]-(this._padding[de.TOP]+this._padding[de.BOTTOM]),(0,ie.c)(this._padding,pe),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0)}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,H.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){if(this._projectionDirty){const pe=this.width,he=this.height,ge=this.near*Math.tan(this.fovY/2),ye=ge*this.aspect;(0,H.l)(this._projectionMatrix,-ye*(1+2*this._padding[de.LEFT]/pe),ye*(1+2*this._padding[de.RIGHT]/pe),-ge*(1+2*this._padding[de.BOTTOM]/he),ge*(1+2*this._padding[de.TOP]/he),this.near,this.far),this._projectionDirty=!1}return this._projectionMatrix}get inverseProjectionMatrix(){return(0,G.Wi)(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=(0,re.c)()),this._inverseProjectionDirty&&(0,H.a)(this._inverseProjectionMatrix,this.projectionMatrix),this._inverseProjectionMatrix}set projectionMatrix(pe){(0,H.c)(this._projectionMatrix,pe),this._projectionDirty=!1,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fov(){return this._fov}set fov(pe){this._fov=pe,this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return(0,j.tM)(this._fov,this.width,this.height)}set fovX(pe){this._fov=(0,j.Kj)(pe,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return(0,j.RQ)(this._fov,this.width,this.height)}set fovY(pe){this._fov=(0,j.zF)(pe,this.width,this.height),this._projectionDirty=!0,this._inverseProjectionDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,B.i)(this._center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,H.a)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,H.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(pe){return 2*this.near*this.far/(this.far+this.near-(2*pe-1)*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this._pixelRatio}get aboveGround(){return this.relativeElevation&&this.relativeElevation>=0}copyFrom(pe){(0,B.c)(this._ray.origin,pe.eye),(0,B.c)(this._center,pe.center),(0,B.c)(this._up,pe.up),(0,ie.c)(this._viewport,pe.viewport),(0,ie.c)(this._padding,pe.padding),(0,J.c)(this._nearFar,pe.nearFar),this._fov=pe.fov,this.relativeElevation=pe.relativeElevation;const he=pe;return this._viewDirty=he._viewDirty,this._viewDirty||((0,H.c)(this._viewMatrix,pe.viewMatrix),(0,B.c)(this._viewRight,pe.viewRight),(0,B.c)(this._viewUp,pe.viewUp),(0,B.c)(this._viewForward,pe.viewForward)),he._projectionDirty?this._projectionDirty=!0:((0,H.c)(this._projectionMatrix,pe.projectionMatrix),this._projectionDirty=!1),this._viewProjectionDirty=!0,this._inverseProjectionDirty=!0,this._frustumDirty=he._frustumDirty,this._frustumDirty||((0,ce.JG)(this._frustum,pe.frustum),this._frustumDirty=!1),he._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,H.c)(this._viewInverseTransposeMatrix,pe.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,ie.c)(this._fullViewport,pe.fullViewport),this._pixelRatio=pe.pixelRatio,this}copyViewFrom(pe){this.eye=pe.eye,this.center=pe.center,this.up=pe.up}clone(){return(new U).copyFrom(this)}equals(pe){return(0,B.k)(this.eye,pe.eye)&&(0,B.k)(this._center,pe.center)&&(0,B.k)(this._up,pe.up)&&(0,ie.g)(this._viewport,pe.viewport)&&(0,ie.g)(this._padding,pe.padding)&&(0,J.e)(this._nearFar,pe.nearFar)&&this._fov===pe.fov&&this._pixelRatio===pe.pixelRatio&&this.relativeElevation===pe.relativeElevation}almostEquals(pe){if(this._pixelRatio!==pe.pixelRatio||Math.abs(pe.fov-this._fov)>=.001)return!1;(0,B.v)(ne,pe.eye,pe.center),(0,B.v)(se,this.eye,this._center);const ye=(0,B.e)(ne,se),Me=(0,B.w)(ne),Ee=(0,B.w)(se);return ye*ye>=(1-1e-10)*Me*Ee&&(0,B.x)(pe.eye,this.eye)<5e-4*Math.max(Me,Ee)*5e-4&&(0,ie.i)(pe.padding,this._padding)<.5&&(0,ie.i)(pe.viewport,this._viewport)<.5}computeRenderPixelSizeAt(pe){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(pe))}computeRenderPixelSizeAtDist(pe){return pe*this.perRenderPixelRatio}computeScreenPixelSizeAt(pe){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(pe))}_viewDirectionDistance(pe){return Math.abs((0,le.SR)(this.viewForward,(0,B.b)(ne,pe,this.eye)))}computeScreenPixelSizeAtDist(pe){return pe*this.perScreenPixelRatio}computeDistanceFromRadius(pe,he){return pe/Math.tan(Math.min(this.fovX,this.fovY)/(2*(he||1)))}getScreenCenter(pe=(0,Q.s1)()){return pe[0]=(this.padding[de.LEFT]+this.width/2)/this._pixelRatio,pe[1]=(this.padding[de.TOP]+this.height/2)/this._pixelRatio,pe}getRenderCenter(pe,he=.5,ge=.5){return pe[0]=this.padding[de.LEFT]+this.width*he,pe[1]=this.padding[de.BOTTOM]+this.height*ge,pe[2]=.5,pe}setGLViewport(pe){const he=this.viewport,ge=this.padding;pe.setViewport(he[0]-ge[3],he[1]-ge[2],he[2]+ge[1]+ge[3],he[3]+ge[0]+ge[2])}applyProjection(pe,he){pe!==ee&&(0,B.c)(ee,pe),ee[3]=1,(0,ie.t)(ee,ee,this.projectionMatrix);const ge=Math.abs(ee[3]);(0,B.g)(ee,ee,1/ge);const ye=this.fullViewport;he[0]=(0,A.t7)(0,ye[0]+ye[2],.5+.5*ee[0]),he[1]=(0,A.t7)(0,ye[1]+ye[3],.5+.5*ee[1]),he[2]=.5*(ee[2]+1),he[3]=ge}unapplyProjection(pe,he){const ge=this.fullViewport;ee[0]=(pe[0]/(ge[0]+ge[2])*2-1)*pe[3],ee[1]=(pe[1]/(ge[1]+ge[3])*2-1)*pe[3],ee[2]=(2*pe[2]-1)*pe[3],ee[3]=pe[3],(0,ie.t)(ee,ee,this.inverseProjectionMatrix),he[0]=ee[0],he[1]=ee[1],he[2]=ee[2]}projectToScreen(pe,he){this.projectToRenderScreen(pe,ae),this.renderToScreen(ae,he)}projectToRenderScreen(pe,he){if(ee[0]=pe[0],ee[1]=pe[1],ee[2]=pe[2],ee[3]=1,(0,ie.t)(ee,ee,this.viewProjectionMatrix),0===ee[3])return null;(0,B.g)(ee,ee,1/Math.abs(ee[3]));const ge=this.fullViewport;return"x"in he?(he.x=(0,A.t7)(0,ge[0]+ge[2],.5+.5*ee[0]),he.y=(0,A.t7)(0,ge[1]+ge[3],.5+.5*ee[1])):(he[0]=(0,A.t7)(0,ge[0]+ge[2],.5+.5*ee[0]),he[1]=(0,A.t7)(0,ge[1]+ge[3],.5+.5*ee[1]),he.length>2&&(he[2]=.5*(ee[2]+1))),he}unprojectFromScreen(pe,he){return this.unprojectFromRenderScreen(this.screenToRender(pe,ae),he)}unprojectFromRenderScreen(pe,he){if((0,H.m)($,this.projectionMatrix,this.viewMatrix),!(0,H.a)($,$))return null;const ge=this.fullViewport;return ee[0]=2*(pe[0]-ge[0])/ge[2]-1,ee[1]=2*(pe[1]-ge[1])/ge[3]-1,ee[2]=2*pe[2]-1,ee[3]=1,(0,ie.t)(ee,ee,$),0===ee[3]?null:(he[0]=ee[0]/ee[3],he[1]=ee[1]/ee[3],he[2]=ee[2]/ee[3],he)}constrainWindowSize(pe,he,ge,ye=ge){const Me=pe*this._pixelRatio,Ee=he*this._pixelRatio,Te=Math.max(Me-ge/2,0),me=Math.max(this.fullHeight-Ee-ye/2,0),Ce=-Math.min(Me-ge/2,0),Ie=-Math.min(this.fullHeight-Ee-ye/2,0);return[Te,me,ge-Ce- -Math.min(this.fullWidth-Me-ge/2,0),ye-Ie- -Math.min(Ee-ye/2,0)]}computeUp(pe){pe===Y.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(pe,he){const ye=this.fullHeight-pe[1]*this._pixelRatio;return he[0]=pe[0]*this._pixelRatio,he[1]=ye,he}renderToScreen(pe,he){const ye=(this.fullHeight-pe[1])/this._pixelRatio;he[0]=pe[0]/this._pixelRatio,he[1]=ye}_computeUpGlobal(){(0,B.b)(ne,this.center,this.eye);const pe=(0,B.l)(this.center);pe<1?((0,B.s)(this._up,0,0,1),this._markViewDirty()):Math.abs((0,B.e)(ne,this.center))>.9999*(0,B.l)(ne)*pe||((0,B.f)(this._up,ne,this.center),(0,B.f)(this._up,this._up,ne),(0,B.n)(this._up,this._up),this._markViewDirty())}_computeUpLocal(){(0,B.r)(ne,this.eye,this.center),Math.abs(ne[2])<=.9999&&((0,B.g)(ne,ne,ne[2]),(0,B.s)(this._up,-ne[0],-ne[1],1-ne[2]),(0,B.n)(this._up,this._up),this._markViewDirty())}_compareAndSetView(pe,he){"number"==typeof pe[0]&&isFinite(pe[0])&&"number"==typeof pe[1]&&isFinite(pe[1])&&"number"==typeof pe[2]&&isFinite(pe[2])?(0,B.k)(pe,he)||((0,B.c)(he,pe),this._markViewDirty()):X.warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,ce.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,H.n)(this._viewMatrix,this.eye,this._center,this._up),(0,B.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,B.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,B.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}}const ee=(0,ue.c)(),$=(0,re.c)(),ne=(0,Z.c)(),se=(0,Z.c)(),ae=(0,Q.J$)();var de,_e;(_e=de||(de={}))[_e.TOP=0]="TOP",_e[_e.RIGHT=1]="RIGHT",_e[_e.BOTTOM=2]="BOTTOM",_e[_e.LEFT=3]="LEFT"},26594:(dt,Re,T)=>{"use strict";T.d(Re,{as:()=>A,t9:()=>Q});var x=T(77029);class A{constructor(){this.adds=new x.Z,this.removes=new x.Z,this.updates=new x.Z({allocator:re=>re||new G,deallocator:re=>(re.renderGeometry=null,re)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}}class G{}class Q{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}},12699:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>A});var x=T(86236);class A{constructor(){this.id=(0,x.D)()}unload(){}}},24425:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{U:()=>x}),(A=x||(x={}))[A.Layer=0]="Layer",A[A.Object=1]="Object",A[A.Geometry=2]="Geometry",A[A.Material=3]="Material",A[A.Texture=4]="Texture",A[A.COUNT=5]="COUNT"},39114:(dt,Re,T)=>{"use strict";T.d(Re,{i:()=>A});var x=T(16396);const A=new Map([[x.T.POSITION,0],[x.T.NORMAL,1],[x.T.UV0,2],[x.T.COLOR,3],[x.T.SIZE,4],[x.T.TANGENT,4],[x.T.AUXPOS1,5],[x.T.SYMBOLCOLOR,5],[x.T.AUXPOS2,6],[x.T.FEATUREATTRIBUTE,6],[x.T.INSTANCEFEATUREATTRIBUTE,6],[x.T.INSTANCECOLOR,7],[x.T.MODEL,8],[x.T.MODELNORMAL,12],[x.T.MODELORIGINHI,11],[x.T.MODELORIGINLO,15]])},59631:(dt,Re,T)=>{"use strict";T.d(Re,{Bn:()=>B,QI:()=>W});var x=T(16396),A=T(67969),G=T(40852);new G.G(x.T.POSITION,3,A.g.FLOAT,0,12),new G.G(x.T.POSITION,3,A.g.FLOAT,0,20),new G.G(x.T.UV0,2,A.g.FLOAT,12,20),new G.G(x.T.POSITION,3,A.g.FLOAT,0,32),new G.G(x.T.NORMAL,3,A.g.FLOAT,12,32),new G.G(x.T.UV0,2,A.g.FLOAT,24,32),new G.G(x.T.POSITION,3,A.g.FLOAT,0,16),new G.G(x.T.COLOR,4,A.g.UNSIGNED_BYTE,12,16);const W=[new G.G(x.T.POSITION,2,A.g.FLOAT,0,8)],B=[new G.G(x.T.POSITION,2,A.g.FLOAT,0,16),new G.G(x.T.UV0,2,A.g.FLOAT,8,16)]},60881:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>A});var x=T(42743);class A{constructor(Q){this._material=Q.material,this._techniqueRepository=Q.techniqueRep,this._output=Q.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}ensureTechnique(Q,H,re=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(Q,this._material.getConfiguration(re,H),this._technique),this._technique}ensureResources(Q){return x.Rw.LOADED}}},50907:(dt,Re,T)=>{"use strict";T.d(Re,{h:()=>re});var x=T(63290),A=T(62208),G=T(1101),Q=T(2282);const H=x.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");class re{constructor(B,Z,ie,ue){this._textureRepository=B,this._techniqueRepository=Z,this.materialChanged=ie,this.requestRender=ue,this._id2glMaterialRef=new G.r}dispose(){this._textureRepository.dispose()}acquire(B,Z){this._ownMaterial(B);let ie=this._id2glMaterialRef.get(Z,B.id);if((0,A.Wi)(ie)){const ue=B.createGLMaterial({material:B,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:Z});ie=new J(ue),this._id2glMaterialRef.set(Z,B.id,ie)}return ie.ref(),ie.glMaterial}release(B,Z){const ie=this._id2glMaterialRef.get(Z,B.id);(0,A.pC)(ie)&&(ie.unref(),ie.referenced||((0,A.O3)(ie.glMaterial),this._id2glMaterialRef.delete(Z,B.id)))}_ownMaterial(B){(0,A.pC)(B.repository)&&B.repository!==this&&H.error("Material is already owned by a different material repository"),B.repository=this}}class J{constructor(B){this.glMaterial=B,this.refCnt=0}ref(){++this.refCnt}unref(){--this.refCnt,(0,Q.hu)(this.refCnt>=0)}get referenced(){return this.refCnt>0}}},32393:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>re,p:()=>H});var x=T(62208),A=T(6945),G=T(42743),Q=T(91263);class H{constructor(W,B){this._material=W,this._repository=B,this._map=new Map}destroy(){this._map.forEach((W,B)=>{(0,x.pC)(W)&&this._repository.release(this._material,re(B))})}load(W,B){this._map.has(B)||this._map.set(B,this._repository.acquire(this._material,re(B)));const Z=this._map.get(B);if((0,x.pC)(Z)){if(Z.ensureResources(W)===G.Rw.LOADED)return Z;this._repository.requestRender()}return null}}function re(J){switch(J){case Q.C.MATERIAL:return A.H.Color;case Q.C.MATERIAL_ALPHA:return A.H.Alpha;case Q.C.MATERIAL_DEPTH:return A.H.Depth;case Q.C.MATERIAL_NORMAL:return A.H.Normal;case Q.C.MATERIAL_DEPTH_SHADOWMAP_ALL:return A.H.Shadow;case Q.C.MATERIAL_HIGHLIGHT:return A.H.Highlight;case Q.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:case Q.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return A.H.Shadow}}},33470:(dt,Re,T)=>{"use strict";T.d(Re,{E:()=>J,F:()=>re});var x=T(62208),A=T(10699),G=T(17625),Q=T(42743),H=T(60881);class re extends H.Z{constructor(B){super(B),this._numLoading=0,this._disposed=!1,this._textureRepository=B.textureRep,this._textureId=B.textureId,this._acquire(B.textureId,Z=>this._texture=Z),this._acquire(B.normalTextureId,Z=>this._textureNormal=Z),this._acquire(B.emissiveTextureId,Z=>this._textureEmissive=Z),this._acquire(B.occlusionTextureId,Z=>this._textureOcclusion=Z),this._acquire(B.metallicRoughnessTextureId,Z=>this._textureMetallicRoughness=Z)}dispose(){this._texture=(0,x.RY)(this._texture),this._textureNormal=(0,x.RY)(this._textureNormal),this._textureEmissive=(0,x.RY)(this._textureEmissive),this._textureOcclusion=(0,x.RY)(this._textureOcclusion),this._textureMetallicRoughness=(0,x.RY)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(B){return 0===this._numLoading?Q.Rw.LOADED:Q.Rw.LOADING}get textureBindParameters(){return new J((0,x.pC)(this._texture)?this._texture.glTexture:null,(0,x.pC)(this._textureNormal)?this._textureNormal.glTexture:null,(0,x.pC)(this._textureEmissive)?this._textureEmissive.glTexture:null,(0,x.pC)(this._textureOcclusion)?this._textureOcclusion.glTexture:null,(0,x.pC)(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}updateTexture(B){((0,x.Wi)(this._texture)||B!==this._texture.id)&&(this._texture=(0,x.RY)(this._texture),this._textureId=B,this._acquire(this._textureId,Z=>this._texture=Z))}_acquire(B,Z){if((0,x.Wi)(B))return void Z(null);const ie=this._textureRepository.acquire(B);if((0,A.y8)(ie))return++this._numLoading,void ie.then(ue=>{if(this._disposed)return(0,x.RY)(ue),void Z(null);Z(ue)}).finally(()=>--this._numLoading);Z(ie)}}class J extends G.K{constructor(B=null,Z=null,ie=null,ue=null,ce=null){super(),this.texture=B,this.textureNormal=Z,this.textureEmissive=ie,this.textureOcclusion=ue,this.textureMetallicRoughness=ce}}},52107:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(62208),A=T(42743),G=T(98565),Q=T(12699),H=T(24425),re=T(36848),J=T(2282),W=T(16396);class B extends Q.c{constructor(ce,oe=[],le=A.MX.Triangle,Y=-1){super(),this._primitiveType=le,this.edgeIndicesLength=Y,this.type=H.U.Geometry,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[j,X]of ce)X&&this._vertexAttributes.set(j,or({},X));if(null==oe||0===oe.length){const j=function Z(ue){const ce=ue.values().next().value;return null==ce?0:ce.data.length/ce.size}(this._vertexAttributes),X=(0,re.p)(j);this.edgeIndicesLength=this.edgeIndicesLength<0?j:this.edgeIndicesLength;for(const U of this._vertexAttributes.keys())this._indices.set(U,X)}else for(const[j,X]of oe)X&&(this._indices.set(j,ie(X)),j===W.T.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(j).length:this.edgeIndicesLength))}cloneShallow(){const ce=new B([],void 0,this._primitiveType,void 0),{_vertexAttributes:oe,_indices:le}=ce;return this._vertexAttributes.forEach((Y,j)=>{oe.set(j,Y)}),this._indices.forEach((Y,j)=>{le.set(j,Y)}),ce.screenToWorldRatio=this.screenToWorldRatio,ce._boundingInfo=this._boundingInfo,ce}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(ce){const oe=this._vertexAttributes.get(ce);return oe&&!oe.exclusive&&(oe.data=Array.from(oe.data),oe.exclusive=!0),oe}get indices(){return this._indices}get indexCount(){const ce=this._indices.values().next().value;return ce?ce.length:0}get primitiveType(){return this._primitiveType}get faceCount(){return this.indexCount/3}get boundingInfo(){return(0,x.Wi)(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(ce){return this.primitiveType===A.MX.Triangle?this._computeAttachmentOriginTriangles(ce):this._computeAttachmentOriginPoints(ce)}_computeAttachmentOriginTriangles(ce){const oe=this.indices.get(W.T.POSITION),le=this.vertexAttributes.get(W.T.POSITION);return(0,re.cM)(le,oe,ce)}_computeAttachmentOriginPoints(ce){const oe=this.indices.get(W.T.POSITION),le=this.vertexAttributes.get(W.T.POSITION);return(0,re.NO)(le,oe,ce)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const ce=this.indices.get(W.T.POSITION);if(0===ce.length)return null;const oe=this.primitiveType===A.MX.Triangle?3:1;(0,J.hu)(ce.length%oe==0,"Indexing error: "+ce.length+" not divisible by "+oe);const le=(0,re.p)(ce.length/oe),Y=this.vertexAttributes.get(W.T.POSITION);return new G.j(le,oe,ce,Y)}}function ie(ue){if(ue.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return ue;for(const ce of ue)if(ce>=65536)return ue;return new Uint16Array(ue)}},24260:(dt,Re,T)=>{"use strict";T.d(Re,{k:()=>H});var x=T(62208),A=T(27899),G=T(86236),Q=T(84161);class H{constructor(){this._disposed=!1}get disposed(){return this._disposed}get shaderTransformation(){return this._shaderTransformation}acquire(J,W,B,Z,ie,ue){this.id=(0,G.D)(),this.geometry=J,this.material=W,this.transformation=B,this.instanceParameters=Z,this.origin=ie,this._shaderTransformation=ue,this._disposed=!1}release(){this._disposed=!1}dispose(){this._disposed=!0}getStaticTransformation(){return this.transformation}getShaderTransformation(){return(0,x.pC)(this._shaderTransformation)?this._shaderTransformation(this.transformation):this.transformation}computeAttachmentOrigin(J){return!!(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,J):this.geometry.computeAttachmentOrigin(J))&&((0,Q.m)(J,J,this.getStaticTransformation()),!0)}}H.pool=new A.Z(H)},57521:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>U});var J,ee,x=T(84161),A=T(14658),G=T(28093),Q=T(90014),H=T(70562),re=T(42743);(ee=J||(J={})).length=function $(_e,pe){const he=_e[pe],ge=_e[pe+1],ye=_e[pe+2];return Math.sqrt(he*he+ge*ge+ye*ye)},ee.normalize=function ne(_e,pe){const he=_e[pe],ge=_e[pe+1],ye=_e[pe+2],Me=1/Math.sqrt(he*he+ge*ge+ye*ye);_e[pe]*=Me,_e[pe+1]*=Me,_e[pe+2]*=Me},ee.scale=function se(_e,pe,he){_e[pe]*=he,_e[pe+1]*=he,_e[pe+2]*=he},ee.add=function ae(_e,pe,he,ge,ye,Me=pe){(ye=ye||_e)[Me]=_e[pe]+he[ge],ye[Me+1]=_e[pe+1]+he[ge+1],ye[Me+2]=_e[pe+2]+he[ge+2]},ee.subtract=function de(_e,pe,he,ge,ye,Me=pe){(ye=ye||_e)[Me]=_e[pe]-he[ge],ye[Me+1]=_e[pe+1]-he[ge+1],ye[Me+2]=_e[pe+2]-he[ge+2]};var W=T(52107),B=T(36848),Z=T(2282),ie=T(16396);const ue=J;var ce,oe,le,Y;(function(ee){const ne=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],se=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],ae=[0,0,1,0,1,1,0,1],de=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),_e=new Uint16Array(36);for(let ge=0;ge<6;ge++)for(let ye=0;ye<6;ye++)_e[6*ge+ye]=ge;const pe=new Uint16Array(36);for(let ge=0;ge<6;ge++)pe[6*ge+0]=0,pe[6*ge+1]=1,pe[6*ge+2]=2,pe[6*ge+3]=2,pe[6*ge+4]=3,pe[6*ge+5]=0;ee.createGeometry=function he(ge){Array.isArray(ge)||(ge=[ge,ge,ge]);const ye=new Array(24);for(let Me=0;Me<8;Me++)ye[3*Me]=ne[Me][0]*ge[0],ye[3*Me+1]=ne[Me][1]*ge[1],ye[3*Me+2]=ne[Me][2]*ge[2];return new W.Z([[ie.T.POSITION,{size:3,data:ye,exclusive:!0}],[ie.T.NORMAL,{size:3,data:se}],[ie.T.UV0,{size:2,data:ae}]],[[ie.T.POSITION,de],[ie.T.NORMAL,_e],[ie.T.UV0,pe]])}})(ce||(ce={})),function(ee){const ne=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],se=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],ae=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),de=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);ee.createGeometry=function _e(pe){Array.isArray(pe)||(pe=[pe,pe,pe]);const he=new Array(18);for(let ge=0;ge<6;ge++)he[3*ge]=ne[ge][0]*pe[0],he[3*ge+1]=ne[ge][1]*pe[1],he[3*ge+2]=ne[ge][2]*pe[2];return new W.Z([[ie.T.POSITION,{size:3,data:he,exclusive:!0}],[ie.T.NORMAL,{size:3,data:se}]],[[ie.T.POSITION,ae],[ie.T.NORMAL,de]])}}(oe||(oe={})),function(ee){const se=(0,A.f)(-.5,0,-.5),ae=(0,A.f)(.5,0,-.5),de=(0,A.f)(0,0,.5),_e=(0,A.f)(0,.5,0),pe=(0,A.c)(),he=(0,A.c)(),ge=(0,A.c)(),ye=(0,A.c)(),Me=(0,A.c)();(0,x.b)(pe,se,_e),(0,x.b)(he,se,ae),(0,x.f)(ge,pe,he),(0,x.n)(ge,ge),(0,x.b)(pe,ae,_e),(0,x.b)(he,ae,de),(0,x.f)(ye,pe,he),(0,x.n)(ye,ye),(0,x.b)(pe,de,_e),(0,x.b)(he,de,se),(0,x.f)(Me,pe,he),(0,x.n)(Me,Me);const Ee=[se,ae,de,_e],Te=[0,-1,0,ge[0],ge[1],ge[2],ye[0],ye[1],ye[2],Me[0],Me[1],Me[2]],me=[0,1,2,3,1,0,3,2,1,3,0,2],Ce=[0,0,0,1,1,1,2,2,2,3,3,3];ee.createGeometry=function Ie(Ge){Array.isArray(Ge)||(Ge=[Ge,Ge,Ge]);const Je=new Array(12);for(let xe=0;xe<4;xe++)Je[3*xe]=Ee[xe][0]*Ge[0],Je[3*xe+1]=Ee[xe][1]*Ge[1],Je[3*xe+2]=Ee[xe][2]*Ge[2];return new W.Z([[ie.T.POSITION,{size:3,data:Je,exclusive:!0}],[ie.T.NORMAL,{size:3,data:Te}]],[[ie.T.POSITION,new Uint16Array(me)],[ie.T.NORMAL,new Uint16Array(Ce)]])}}(le||(le={})),function(ee){ee.createBoxGeometry=ce.createGeometry,ee.createDiamondGeometry=oe.createGeometry,ee.createTetrahedronGeometry=le.createGeometry,ee.createSphereGeometry=function $(xe,je,We,Ne={uv:!0}){const we=-Math.PI,Oe=2*Math.PI,$e=-Math.PI/2,Be=Math.PI,Se=Math.max(3,Math.floor(je)),De=Math.max(2,Math.floor(We)),Fe=(Se+1)*(De+1),ve=new Float32Array(3*Fe),Ke=new Float32Array(3*Fe),qe=new Float32Array(2*Fe),be=[];let tt=0;for(let ke=0;ke<=De;ke++){const ot=[],at=ke/De,yt=$e+at*Be,wt=Math.cos(yt);for(let zt=0;zt<=Se;zt++){const Rt=zt/Se,Ft=we+Rt*Oe,bt=Math.cos(Ft)*wt,St=Math.sin(yt),Xt=-Math.sin(Ft)*wt;ve[3*tt]=bt*xe,ve[3*tt+1]=St*xe,ve[3*tt+2]=Xt*xe,Ke[3*tt]=bt,Ke[3*tt+1]=St,Ke[3*tt+2]=Xt,qe[2*tt]=Rt,qe[2*tt+1]=at,ot.push(tt),++tt}be.push(ot)}const Ye=new Uint32Array(2*Se*(De-1)*3);tt=0;for(let ke=0;ke<De;ke++)for(let ot=0;ot<Se;ot++){const at=be[ke][ot],yt=be[ke][ot+1],wt=be[ke+1][ot+1],zt=be[ke+1][ot];0===ke?(Ye[tt++]=at,Ye[tt++]=wt,Ye[tt++]=zt):ke===De-1?(Ye[tt++]=at,Ye[tt++]=yt,Ye[tt++]=wt):(Ye[tt++]=at,Ye[tt++]=yt,Ye[tt++]=wt,Ye[tt++]=wt,Ye[tt++]=zt,Ye[tt++]=at)}const ze=[[ie.T.POSITION,Ye],[ie.T.NORMAL,Ye]],et=[[ie.T.POSITION,{size:3,data:ve,exclusive:!0}],[ie.T.NORMAL,{size:3,data:Ke,exclusive:!0}]];return Ne.uv&&(et.push([ie.T.UV0,{size:2,data:qe,exclusive:!0}]),ze.push([ie.T.UV0,Ye])),Ne.offset&&(ze[0][0]=ie.T.OFFSET,et[0][0]=ie.T.OFFSET,ze.push([ie.T.POSITION,new Uint32Array(Ye.length)]),et.push([ie.T.POSITION,{size:3,data:Float64Array.from(Ne.offset),exclusive:!0}])),new W.Z(et,ze)},ee.createPolySphereGeometry=function ne(xe,je,We){const Ne=xe;let we,Oe;if(We)we=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],Oe=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]);else{const ve=Ne*(1+Math.sqrt(5))/2;we=[-Ne,ve,0,Ne,ve,0,-Ne,-ve,0,Ne,-ve,0,0,-Ne,ve,0,Ne,ve,0,-Ne,-ve,0,Ne,-ve,ve,0,-Ne,ve,0,Ne,-ve,0,-Ne,-ve,0,Ne],Oe=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1])}for(let ve=0;ve<we.length;ve+=3)ue.scale(we,ve,xe/ue.length(we,ve));let $e={};function Be(ve,Ke){ve>Ke&&([ve,Ke]=[Ke,ve]);const qe=ve.toString()+"."+Ke.toString();if($e[qe])return $e[qe];let be=we.length;return we.length+=3,ue.add(we,3*ve,we,3*Ke,we,be),ue.scale(we,be,xe/ue.length(we,be)),be/=3,$e[qe]=be,be}for(let ve=0;ve<je;ve++){const Ke=Oe.length,qe=new Uint32Array(4*Ke);for(let be=0;be<Ke;be+=3){const tt=Oe[be],Ye=Oe[be+1],ze=Oe[be+2],et=Be(tt,Ye),ke=Be(Ye,ze),ot=Be(ze,tt),at=4*be;qe[at]=tt,qe[at+1]=et,qe[at+2]=ot,qe[at+3]=Ye,qe[at+4]=ke,qe[at+5]=et,qe[at+6]=ze,qe[at+7]=ot,qe[at+8]=ke,qe[at+9]=et,qe[at+10]=ke,qe[at+11]=ot}Oe=qe,$e={}}const Se=new Float32Array(we);for(let ve=0;ve<Se.length;ve+=3)ue.normalize(Se,ve);const De=[[ie.T.POSITION,Oe],[ie.T.NORMAL,Oe]],Fe=[[ie.T.POSITION,{size:3,data:new Float32Array(we),exclusive:!0}],[ie.T.NORMAL,{size:3,data:Se,exclusive:!0}]];return new W.Z(Fe,De)},ee.createPointGeometry=function se(xe,je,We,Ne,we,Oe,$e){const ve=[[ie.T.POSITION,{size:3,data:je?[je[0],je[1],je[2]]:[0,0,0],exclusive:!0}],[ie.T.NORMAL,{size:3,data:xe?[xe[0],xe[1],xe[2]]:[0,0,1],exclusive:!0}],[ie.T.UV0,{size:(Oe=Oe||[0,0]).length,data:Oe}],[ie.T.COLOR,{size:4,data:We?[255*We[0],255*We[1],255*We[2],We.length>3?255*We[3]:255]:[255,255,255,255],exclusive:!0}],[ie.T.SIZE,{size:2,data:null!=Ne&&2===Ne.length?Ne:[1,1]}]];if(null!=we){const Ke=new Float32Array([we[0],we[1],we[2],we[3]]);ve.push([ie.T.AUXPOS1,{size:4,data:Ke}])}if(null!=$e){const Ke=new Float32Array([$e[0],$e[1],$e[2],$e[3]]);ve.push([ie.T.AUXPOS2,{size:4,data:Ke}])}return new W.Z(ve,null,re.MX.Point)},ee.updatePointGeometry=function ae(xe,je,We,Ne,we,Oe,$e,Be){if(null!=xe){const{data:Se}=Be.getMutableAttribute(ie.T.NORMAL);Se[0]=xe[0],Se[1]=xe[1],Se[2]=xe[2]}if(null!=je){const{data:Se}=Be.getMutableAttribute(ie.T.POSITION);Se[0]=je[0],Se[1]=je[1],Se[2]=je[2]}if(null!=We){const{data:Se}=Be.getMutableAttribute(ie.T.COLOR);Se[0]=We[0],Se[1]=We[1],Se[2]=We[2],Se[3]=We[3]}if(null!=Ne){const{data:Se}=Be.getMutableAttribute(ie.T.SIZE);Se[0]=Ne[0],Se[1]=Ne[1]}if(null!=we){const{data:Se}=Be.getMutableAttribute(ie.T.AUXPOS1);Se[0]=we[0],Se[1]=we[1],Se[2]=we[2],Se[3]=we[3]}if(null!=Oe){const{data:Se}=Be.getMutableAttribute(ie.T.UV0);Se[0]=Oe[0],Se[1]=Oe[1]}if(null!=$e){const{data:Se}=Be.getMutableAttribute(ie.T.AUXPOS2);Se[0]=$e[0],Se[1]=$e[1],Se[2]=$e[2],Se[3]=$e[3]}},ee.createPointArrayGeometry=function de(xe,je){const We=new Float32Array(3*xe.length),Ne=new Float32Array(je?3*xe.length:3),we=new Uint32Array(xe.length),Oe=new Uint32Array(xe.length);for(let De=0;De<xe.length;De++)We[3*De]=xe[De][0],We[3*De+1]=xe[De][1],We[3*De+2]=xe[De][2],je&&(Ne[3*De]=je[De][0],Ne[3*De+1]=je[De][1],Ne[3*De+2]=je[De][2]),we[De]=De,Oe[De]=0;return je||(Ne[0]=0,Ne[1]=1,Ne[2]=0),new W.Z([[ie.T.POSITION,{size:3,data:We,exclusive:!0}],[ie.T.NORMAL,{size:3,data:Ne,exclusive:!0}],[ie.T.UV0,{size:2,data:[0,0],exclusive:!0}]],[[ie.T.POSITION,we],[ie.T.NORMAL,je?we:Oe],[ie.T.UV0,Oe]],re.MX.Point)},ee.createTriangleGeometry=function _e(){const je=new Uint16Array([0,1,2]),Ne=new Uint16Array([0,0,0]),Oe=new Uint16Array([0,0,0]);return new W.Z([[ie.T.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[ie.T.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[ie.T.UV0,{size:2,data:[0,0],exclusive:!0}]],[[ie.T.POSITION,je],[ie.T.NORMAL,Ne],[ie.T.UV0,Oe]])};const pe=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Ge(xe,je,We,Ne,we){return!(Math.abs((0,x.e)(je,xe))>we||((0,x.f)(We,xe,je),(0,x.n)(We,We),(0,x.f)(Ne,We,xe),(0,x.n)(Ne,Ne),0))}function Je(xe,je,We,Ne,we,Oe,$e){return Ge(xe,je,we,Oe,$e)||Ge(xe,We,we,Oe,$e)||Ge(xe,Ne,we,Oe,$e)}ee.createSquareGeometry=function he(xe=pe){const je=new Array(12);for(let De=0;De<4;De++)for(let Fe=0;Fe<3;Fe++)je[3*De+Fe]=xe[De][Fe];const We=new Uint32Array([0,1,2,2,3,0]),we=new Uint32Array([0,0,0,0,0,0]);return new W.Z([[ie.T.POSITION,{size:3,data:je,exclusive:!0}],[ie.T.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[ie.T.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[ie.T.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]],[[ie.T.POSITION,We],[ie.T.NORMAL,we],[ie.T.UV0,We],[ie.T.COLOR,we]])},ee.createConeGeometry=function ge(xe,je,We,Ne,we=!0,Oe=!0){let $e=0;const Be=je,Se=xe;let De=(0,A.f)(0,$e,0),Fe=(0,A.f)(0,$e+Se,0),ve=(0,A.f)(0,-1,0),Ke=(0,A.f)(0,1,0);Ne&&($e=Se,Fe=(0,A.f)(0,0,0),De=(0,A.f)(0,$e,0),ve=(0,A.f)(0,1,0),Ke=(0,A.f)(0,-1,0));const qe=[Fe,De],be=[ve,Ke],tt=We+2,Ye=Math.sqrt(Se*Se+Be*Be);if(Ne)for(let Rt=We-1;Rt>=0;Rt--){const Ft=Rt*(2*Math.PI/We),bt=(0,A.f)(Math.cos(Ft)*Be,$e,Math.sin(Ft)*Be);qe.push(bt);const St=(0,A.f)(Se*Math.cos(Ft)/Ye,-Be/Ye,Se*Math.sin(Ft)/Ye);be.push(St)}else for(let Rt=0;Rt<We;Rt++){const Ft=Rt*(2*Math.PI/We),bt=(0,A.f)(Math.cos(Ft)*Be,$e,Math.sin(Ft)*Be);qe.push(bt);const St=(0,A.f)(Se*Math.cos(Ft)/Ye,Be/Ye,Se*Math.sin(Ft)/Ye);be.push(St)}const ze=new Uint32Array(2*(We+2)*3),et=new Uint32Array(2*(We+2)*3);let ke=0,ot=0;if(we){for(let Rt=3;Rt<qe.length;Rt++)ze[ke++]=1,ze[ke++]=Rt-1,ze[ke++]=Rt,et[ot++]=0,et[ot++]=0,et[ot++]=0;ze[ke++]=qe.length-1,ze[ke++]=2,ze[ke++]=1,et[ot++]=0,et[ot++]=0,et[ot++]=0}if(Oe){for(let Rt=3;Rt<qe.length;Rt++)ze[ke++]=Rt,ze[ke++]=Rt-1,ze[ke++]=0,et[ot++]=Rt,et[ot++]=Rt-1,et[ot++]=1;ze[ke++]=0,ze[ke++]=2,ze[ke++]=qe.length-1,et[ot++]=1,et[ot++]=2,et[ot++]=be.length-1}const at=new Float32Array(3*tt);for(let Rt=0;Rt<tt;Rt++)at[3*Rt]=qe[Rt][0],at[3*Rt+1]=qe[Rt][1],at[3*Rt+2]=qe[Rt][2];const yt=new Float32Array(3*tt);for(let Rt=0;Rt<tt;Rt++)yt[3*Rt]=be[Rt][0],yt[3*Rt+1]=be[Rt][1],yt[3*Rt+2]=be[Rt][2];return new W.Z([[ie.T.POSITION,{size:3,data:at,exclusive:!0}],[ie.T.NORMAL,{size:3,data:yt,exclusive:!0}]],[[ie.T.POSITION,ze],[ie.T.NORMAL,et]])},ee.createCylinderGeometry=function ye(xe,je,We,Ne,we,Oe){const $e=Ne?(0,A.a)(Ne):(0,A.f)(1,0,0),Be=we?(0,A.a)(we):(0,A.f)(0,0,0);Oe=null==Oe||Oe;const Se=(0,A.c)();(0,x.n)(Se,$e);const De=(0,A.c)();(0,x.g)(De,Se,Math.abs(xe));const Fe=(0,A.c)();(0,x.g)(Fe,De,-.5),(0,x.a)(Fe,Fe,Be);const ve=(0,A.f)(0,1,0);Math.abs(1-(0,x.e)(Se,ve))<.2&&(0,x.s)(ve,0,0,1);const Ke=(0,A.c)();(0,x.f)(Ke,Se,ve),(0,x.n)(Ke,Ke),(0,x.f)(ve,Ke,Se);const qe=2*We+(Oe?2:0),be=We+(Oe?2:0),tt=new Float32Array(3*qe),Ye=new Float32Array(3*be),ze=new Float32Array(2*qe),et=new Uint32Array(3*We*(Oe?4:2)),ke=new Uint32Array(3*We*(Oe?4:2));Oe&&(tt[3*(qe-2)+0]=Fe[0],tt[3*(qe-2)+1]=Fe[1],tt[3*(qe-2)+2]=Fe[2],ze[2*(qe-2)]=0,ze[2*(qe-2)+1]=0,tt[3*(qe-1)+0]=tt[3*(qe-2)+0]+De[0],tt[3*(qe-1)+1]=tt[3*(qe-2)+1]+De[1],tt[3*(qe-1)+2]=tt[3*(qe-2)+2]+De[2],ze[2*(qe-1)]=1,ze[2*(qe-1)+1]=1,Ye[3*(be-2)+0]=-Se[0],Ye[3*(be-2)+1]=-Se[1],Ye[3*(be-2)+2]=-Se[2],Ye[3*(be-1)+0]=Se[0],Ye[3*(be-1)+1]=Se[1],Ye[3*(be-1)+2]=Se[2]);const ot=(Ft,bt,St)=>{et[Ft]=bt,ke[Ft]=St};let at=0;const yt=(0,A.c)(),wt=(0,A.c)();for(let Ft=0;Ft<We;Ft++){const bt=Ft*(2*Math.PI/We);(0,x.g)(yt,ve,Math.sin(bt)),(0,x.g)(wt,Ke,Math.cos(bt)),(0,x.a)(yt,yt,wt),Ye[3*Ft+0]=yt[0],Ye[3*Ft+1]=yt[1],Ye[3*Ft+2]=yt[2],(0,x.g)(yt,yt,je),(0,x.a)(yt,yt,Fe),tt[3*Ft+0]=yt[0],tt[3*Ft+1]=yt[1],tt[3*Ft+2]=yt[2],ze[2*Ft+0]=Ft/We,ze[2*Ft+1]=0,tt[3*(Ft+We)+0]=tt[3*Ft+0]+De[0],tt[3*(Ft+We)+1]=tt[3*Ft+1]+De[1],tt[3*(Ft+We)+2]=tt[3*Ft+2]+De[2],ze[2*(Ft+We)+0]=Ft/We,ze[2*Ft+1]=1;const St=(Ft+1)%We;ot(at++,Ft,Ft),ot(at++,Ft+We,Ft),ot(at++,St,St),ot(at++,St,St),ot(at++,Ft+We,Ft),ot(at++,St+We,St)}if(Oe){for(let Ft=0;Ft<We;Ft++){const bt=(Ft+1)%We;ot(at++,qe-2,be-2),ot(at++,Ft,be-2),ot(at++,bt,be-2)}for(let Ft=0;Ft<We;Ft++){const bt=(Ft+1)%We;ot(at++,Ft+We,be-1),ot(at++,qe-1,be-1),ot(at++,bt+We,be-1)}}return new W.Z([[ie.T.POSITION,{size:3,data:tt,exclusive:!0}],[ie.T.NORMAL,{size:3,data:Ye,exclusive:!0}],[ie.T.UV0,{size:2,data:ze,exclusive:!0}]],[[ie.T.POSITION,et],[ie.T.NORMAL,ke],[ie.T.UV0,et]])},ee.createTubeGeometry=function Me(xe,je,We,Ne,we){We=We||10,Ne=null==Ne||Ne,(0,Z.hu)(xe.length>1);const $e=[],Be=[];for(let Se=0;Se<We;Se++){$e.push([0,-Se-1,-(Se+1)%We-1]);const De=Se/We*2*Math.PI;Be.push([Math.cos(De)*je,Math.sin(De)*je])}return ee.createPathExtrusionGeometry(Be,xe,[[0,0,0]],$e,Ne,we)},ee.createPathExtrusionGeometry=function Ee(xe,je,We,Ne,we,Oe=(0,A.f)(0,0,0)){const $e=xe.length,Be=new Float32Array(je.length*$e*3+(6*We.length||0)),Se=new Float32Array(je.length*$e*3+(We?6:0)),De=(je.length-1)*$e*6+3*Ne.length*2,Fe=new Uint32Array(De),ve=new Uint32Array(De);let Ke=0,qe=0,be=0,tt=0;const Ye=(0,A.c)(),ze=(0,A.c)(),et=(0,A.c)(),ke=(0,A.c)(),ot=(0,A.c)(),at=(0,A.c)(),yt=(0,A.c)(),wt=(0,G.c)(),zt=(0,A.c)(),Rt=(0,A.c)(),Ft=(0,A.c)(),bt=(0,A.c)(),St=(0,A.c)(),Xt=(0,Q.Ue)();(0,x.s)(zt,0,1,0),(0,x.b)(ze,je[1],je[0]),(0,x.n)(ze,ze),we?((0,x.a)(wt,je[0],Oe),(0,x.n)(et,wt)):(0,x.s)(et,0,0,1),Je(ze,et,zt,zt,ot,et,j),(0,x.c)(ke,et),(0,x.c)(bt,ot);for(let er=0;er<We.length;er++)(0,x.g)(at,ot,We[er][0]),(0,x.g)(wt,et,We[er][2]),(0,x.a)(at,at,wt),(0,x.a)(at,at,je[0]),Be[Ke++]=at[0],Be[Ke++]=at[1],Be[Ke++]=at[2];Se[qe++]=-ze[0],Se[qe++]=-ze[1],Se[qe++]=-ze[2];for(let er=0;er<Ne.length;er++)Fe[be++]=Ne[er][0]>0?Ne[er][0]:-Ne[er][0]-1+We.length,Fe[be++]=Ne[er][1]>0?Ne[er][1]:-Ne[er][1]-1+We.length,Fe[be++]=Ne[er][2]>0?Ne[er][2]:-Ne[er][2]-1+We.length,ve[tt++]=0,ve[tt++]=0,ve[tt++]=0;let Mr=We.length;const Cr=We.length-1;for(let er=0;er<je.length;er++){let Zt=!1;er>0&&((0,x.c)(Ye,ze),er<je.length-1?((0,x.b)(ze,je[er+1],je[er]),(0,x.n)(ze,ze)):Zt=!0,(0,x.a)(Rt,Ye,ze),(0,x.n)(Rt,Rt),(0,x.a)(Ft,je[er-1],ke),(0,Q.Yq)(je[er],Rt,Xt),(0,Q.BR)(Xt,(0,H.re)(Ft,Ye),wt)?((0,x.b)(wt,wt,je[er]),(0,x.n)(et,wt),(0,x.f)(ot,Rt,et),(0,x.n)(ot,ot)):Je(Rt,ke,bt,zt,ot,et,j),(0,x.c)(ke,et),(0,x.c)(bt,ot)),we&&((0,x.a)(wt,je[er],Oe),(0,x.n)(St,wt));for(let tr=0;tr<$e;tr++)if((0,x.g)(at,ot,xe[tr][0]),(0,x.g)(wt,et,xe[tr][1]),(0,x.a)(at,at,wt),(0,x.n)(yt,at),Se[qe++]=yt[0],Se[qe++]=yt[1],Se[qe++]=yt[2],(0,x.a)(at,at,je[er]),Be[Ke++]=at[0],Be[Ke++]=at[1],Be[Ke++]=at[2],!Zt){const ir=(tr+1)%$e;Fe[be++]=Mr+tr,Fe[be++]=Mr+$e+tr,Fe[be++]=Mr+ir,Fe[be++]=Mr+ir,Fe[be++]=Mr+$e+tr,Fe[be++]=Mr+$e+ir;for(let fr=0;fr<6;fr++)ve[tt++]=Fe[be-6+fr]-Cr}Mr+=$e}const Yr=je[je.length-1];for(let er=0;er<We.length;er++)(0,x.g)(at,ot,We[er][0]),(0,x.g)(wt,et,We[er][1]),(0,x.a)(at,at,wt),(0,x.a)(at,at,Yr),Be[Ke++]=at[0],Be[Ke++]=at[1],Be[Ke++]=at[2];const Lr=qe/3;Se[qe++]=ze[0],Se[qe++]=ze[1],Se[qe++]=ze[2];const ct=Mr-$e;for(let er=0;er<Ne.length;er++)Fe[be++]=Ne[er][0]>=0?Mr+Ne[er][0]:-Ne[er][0]-1+ct,Fe[be++]=Ne[er][2]>=0?Mr+Ne[er][2]:-Ne[er][2]-1+ct,Fe[be++]=Ne[er][1]>=0?Mr+Ne[er][1]:-Ne[er][1]-1+ct,ve[tt++]=Lr,ve[tt++]=Lr,ve[tt++]=Lr;return new W.Z([[ie.T.POSITION,{size:3,data:Be,exclusive:!0}],[ie.T.NORMAL,{size:3,data:Se,exclusive:!0}]],[[ie.T.POSITION,Fe],[ie.T.NORMAL,ve]])},ee.createPolylineGeometry=function Te(xe,je,We){(0,Z.hu)(xe.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,Z.hu)(3===xe[0].length,"createPolylineGeometry(): malformed vertex"),(0,Z.hu)(null==je||je.length===xe.length,"createPolylineGeometry: need same number of points and normals"),(0,Z.hu)(null==je||3===je[0].length,"createPolylineGeometry(): malformed normal");const Ne=new Float64Array(3*xe.length),we=new Uint32Array(2*(xe.length-1));let Oe=0,$e=0;for(let De=0;De<xe.length;De++){for(let Fe=0;Fe<3;Fe++)Ne[Oe++]=xe[De][Fe];De>0&&(we[$e++]=De-1,we[$e++]=De)}const Be=[],Se=[];if(Be.push([ie.T.POSITION,we]),Se.push([ie.T.POSITION,{size:3,data:Ne,exclusive:!0}]),je){const De=new Float32Array(3*je.length);let Fe=0;for(let ve=0;ve<xe.length;ve++)for(let Ke=0;Ke<3;Ke++)De[Fe++]=je[ve][Ke];Be.push([ie.T.NORMAL,we]),Se.push([ie.T.NORMAL,{size:3,data:De,exclusive:!0}])}return We&&(Se.push([ie.T.COLOR,{size:4,data:We}]),Be.push([ie.T.COLOR,(0,B.p)(We.length/4)])),new W.Z(Se,Be,re.MX.Line)},ee.createExtrudedTriangle=function me(xe,je,We,Ne,we=0){const Oe=new Array(18),$e=[[-je,we,Ne/2],[We,we,Ne/2],[0,xe+we,Ne/2],[-je,we,-Ne/2],[We,we,-Ne/2],[0,xe+we,-Ne/2]],Be=new Uint16Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(let Se=0;Se<6;Se++)Oe[3*Se]=$e[Se][0],Oe[3*Se+1]=$e[Se][1],Oe[3*Se+2]=$e[Se][2];return new W.Z([[ie.T.POSITION,{size:3,data:Oe,exclusive:!0}]],[[ie.T.POSITION,Be]])},ee.transformInPlace=function Ce(xe,je){const We=xe.getMutableAttribute(ie.T.POSITION).data;for(let Ne=0;Ne<We.length;Ne+=3)(0,x.s)(X,We[Ne],We[Ne+1],We[Ne+2]),(0,x.m)(X,X,je),We[Ne]=X[0],We[Ne+1]=X[1],We[Ne+2]=X[2]},ee.cgToGIS=function Ie(xe,je=xe){const We=xe.vertexAttributes,Ne=We.get(ie.T.POSITION).data,we=We.get(ie.T.NORMAL).data;if(we){const Oe=je.getMutableAttribute(ie.T.NORMAL).data;for(let $e=0;$e<we.length;$e+=3){const Be=we[$e+1];Oe[$e+1]=-we[$e+2],Oe[$e+2]=Be}}if(Ne){const Oe=je.getMutableAttribute(ie.T.POSITION).data;for(let $e=0;$e<Ne.length;$e+=3){const Be=Ne[$e+1];Oe[$e+1]=-Ne[$e+2],Oe[$e+2]=Be}}return je},ee.makeOrthoBasisDirUp=Ge,ee.makeOrthoBasisDirUpFallback=Je}(Y||(Y={}));const j=.99619469809,X=(0,A.c)(),U=Y},57851:(dt,Re,T)=>{"use strict";T.d(Re,{C:()=>Y});var x=T(62208),A=T(86236),G=T(43703),Q=T(84161),H=T(28093),re=T(4794),J=T(55915),W=T(42743),B=T(52107),Z=T(30993),ie=T(97272),ue=T(39782),ce=T(16396),oe=T(34103),le=T(92222);class Y{constructor(U,ee=125e4){this._originSR=U,this._gridSize=ee,this._origins=new Map,this._objects=new Map,this._rootOriginId="root/"+(0,A.D)()}getOrigin(U){const ee=this._origins.get(this._rootOriginId);if(null==ee){const he=ue.p.rootOrigin;if((0,x.pC)(he))return this._origins.set(this._rootOriginId,(0,Z.al)(he[0],he[1],he[2],this._rootOriginId)),this.getOrigin(U);const ge=(0,Z.al)(U[0]+Math.random()-.5,U[1]+Math.random()-.5,U[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,ge),ge}const $=this._gridSize,ne=Math.round(U[0]/$),se=Math.round(U[1]/$),ae=Math.round(U[2]/$),de=`${ne}/${se}/${ae}`;let _e=this._origins.get(de);const pe=.5*$;if((0,Q.b)(j,U,ee.vec3),j[0]=Math.abs(j[0]),j[1]=Math.abs(j[1]),j[2]=Math.abs(j[2]),j[0]<pe&&j[1]<pe&&j[2]<pe){if(_e){const he=Math.max(...j);if((0,Q.b)(j,U,_e.vec3),j[0]=Math.abs(j[0]),j[1]=Math.abs(j[1]),j[2]=Math.abs(j[2]),Math.max(...j)<he)return _e}return ee}return _e||(_e=(0,Z.al)(ne*$,se*$,ae*$,de),this._origins.set(de,_e)),_e}_drawOriginBox(U,ee=(0,re.f)(1,1,0,1)){const $=window.view,ne=$._stage,se=ee.toString();if(!this._objects.has(se)){this._material=new le.U({width:2,color:ee}),ne.add(this._material);const Me=new oe.F({isPickable:!1}),Ee=new ie.T({castShadow:!1});ne.add(Ee),Me.add(Ee),ne.add(Me),this._objects.set(se,Ee)}const ae=this._objects.get(se),de=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],_e=de.length,pe=new Array(3*_e),he=new Uint16Array(2*(_e-1)),ge=.5*this._gridSize;for(let Me=0;Me<_e;Me++)pe[3*Me+0]=U[0]+(1&de[Me]?ge:-ge),pe[3*Me+1]=U[1]+(2&de[Me]?ge:-ge),pe[3*Me+2]=U[2]+(4&de[Me]?ge:-ge),Me>0&&(he[2*Me+0]=Me-1,he[2*Me+1]=Me);(0,J.CM)(pe,this._originSR,0,pe,$.renderSpatialReference,0,_e);const ye=new B.Z([[ce.T.POSITION,{size:3,data:pe,exclusive:!0}]],[[ce.T.POSITION,he]],W.MX.Line);ne.add(ye),ae.addGeometry(ye,this._material,G.I)}}const j=(0,H.c)()},62483:(dt,Re,T)=>{"use strict";T.d(Re,{LP:()=>ee,Z8:()=>Y,vh:()=>oe});var x=T(62208),A=T(28347),G=T(43703),Q=T(84161),H=T(28093),re=T(993),J=T(4794),W=T(70562),B=T(59617),Z=T(67857),ie=T(91480),ue=T(40841),ce=T(65073);const oe=1e-5;class le{constructor(ae){this.options=new Z.om,this._results=new j,this.transform=new ue.yn,this.tolerance=oe,this.verticalOffset=null,this._ray=(0,W.Ue)(),this._rayEnd=(0,H.c)(),this._rayBeginTransformed=(0,H.c)(),this._rayEndTransformed=(0,H.c)(),this.viewingMode=null==ae?B.JY.Global:ae}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(ae,de,_e){this.resetWithRay((0,W.zk)(ae,de,this._ray),_e)}resetWithRay(ae,de){this.camera=de,ae!==this._ray&&(0,W.JG)(ae,this._ray),0!==this.options.verticalOffset?this.viewingMode===B.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,Q.a)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(ae=null,de,_e,pe,he){this.point=de,this.filterPredicate=pe,this.tolerance=null==_e?oe:_e;const ge=(0,ue.W9)(this.verticalOffset);if((0,x.pC)(ae)&&ae.length>0){const ye=he?Me=>{he(Me)&&this.intersectObject(Me)}:Me=>{this.intersectObject(Me)};for(const Me of ae){const Ee=Me.getSpatialQueryAccelerator&&Me.getSpatialQueryAccelerator();(0,x.pC)(Ee)?((0,x.pC)(ge)?Ee.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,ye,ge):Ee.forEachAlongRay(this._ray.origin,this._ray.direction,ye),this.options.selectionMode&&this.options.hud&&Ee.forEachDegenerateObject(ye)):Me.objects.forAll(Te=>ye(Te))}}this.sortResults()}intersectObject(ae){const de=ae.geometryRecords;if(!de)return;const _e=ae.transformation,pe=(0,ue.W9)(this.verticalOffset);for(const he of de){const{geometry:ge,material:ye,instanceParameters:Me}=he;if((0,ce.PD)(Me))continue;const Ee=ge.id;this.transform.setAndInvalidateLazyTransforms(_e,he.getShaderTransformation()),(0,Q.m)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,Q.m)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const Te=this.transform.transform;(0,x.pC)(pe)&&(pe.objectTransform=this.transform),ye.intersect(ge,Me,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(me,Ce,Ie,Ge,Je,xe)=>{if(me>=0){if((0,x.pC)(this.filterPredicate)&&!this.filterPredicate(this._ray.origin,this._rayEnd,me))return;const je=Ge?this._results.hud:this._results,We=Ge?Ne=>{const we={object:ae,geometryId:Ee,triangleNr:Ie,center:(0,x.pC)(xe)?[xe[0],xe[1],xe[2]]:null};Ne.set(Z.q7.HUD,we,me,Ce,G.I,Je)}:Ne=>Ne.set(Z.q7.OBJECT,{object:ae,geometryId:Ee,triangleNr:Ie},me,Ce,Te,Je);if((null==je.min.drapedLayerOrder||Je>=je.min.drapedLayerOrder)&&(null==je.min.dist||me<je.min.dist)&&We(je.min),this.options.store!==Z.eC.MIN&&(null==je.max.drapedLayerOrder||Je<je.max.drapedLayerOrder)&&(null==je.max.dist||me>je.max.dist)&&We(je.max),this.options.store===Z.eC.ALL)if(Ge){const Ne=new U(this._ray);We(Ne),this._results.hud.all.push(Ne)}else{const Ne=new X(this._ray);We(Ne),this._results.all.push(Ne)}}},he.shaderTransformation)}}sortResults(ae=this._results.all){ae.sort((de,_e)=>de.dist!==_e.dist?(0,x.Pt)(de.dist,0)-(0,x.Pt)(_e.dist,0):de.drapedLayerOrder!==_e.drapedLayerOrder?(0,x.Pt)(de.drapedLayerOrder,Number.MAX_VALUE)-(0,x.Pt)(_e.drapedLayerOrder,Number.MAX_VALUE):(0,x.Pt)(_e.drapedLayerGraphicOrder,Number.MIN_VALUE)-(0,x.Pt)(de.drapedLayerGraphicOrder,Number.MIN_VALUE))}}function Y(se){return new le(se)}class j{constructor(){this.min=new X((0,W.Ue)()),this.max=new X((0,W.Ue)()),this.hud={min:new U((0,W.Ue)()),max:new U((0,W.Ue)()),all:new Array},this.ground=new X((0,W.Ue)()),this.all=[]}init(ae){this.min.init(ae),this.max.init(ae),this.ground.init(ae),this.all.length=0,this.hud.min.init(ae),this.hud.max.init(ae),this.hud.all.length=0}}class X{constructor(ae){this.intersector=Z.q7.OBJECT,this.normal=(0,H.c)(),this.transformation=(0,G.c)(),this._ray=(0,W.Ue)(),this.init(ae)}get ray(){return this._ray}get distanceInRenderSpace(){return(0,x.pC)(this.dist)?((0,Q.g)($,this.ray.direction,this.dist),(0,Q.l)($)):null}getIntersectionPoint(ae){return!!(0,ie.nn)(this)&&((0,Q.g)($,this.ray.direction,this.dist),(0,Q.a)(ae,this.ray.origin,$),!0)}getTransformedNormal(ae){return(0,Q.c)(ne,this.normal),ne[3]=0,(0,re.t)(ne,ne,this.transformation),(0,Q.c)(ae,ne),(0,Q.n)(ae,ae)}init(ae){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Z.q7.OBJECT,(0,W.JG)(ae,this._ray)}set(ae,de,_e,pe,he,ge,ye){this.intersector=ae,this.dist=_e,(0,Q.c)(this.normal,(0,x.Pt)(pe,H.U)),(0,A.c)(this.transformation,(0,x.Pt)(he,G.I)),this.target=de,this.drapedLayerOrder=ge,this.drapedLayerGraphicOrder=ye}copy(ae){(0,W.JG)(ae.ray,this._ray),this.intersector=ae.intersector,this.dist=ae.dist,this.target=ae.target,this.drapedLayerOrder=ae.drapedLayerOrder,this.drapedLayerGraphicOrder=ae.drapedLayerGraphicOrder,(0,Q.c)(this.normal,ae.normal),(0,A.c)(this.transformation,ae.transformation)}}class U extends X{constructor(){super(...arguments),this.intersector=Z.q7.HUD}}function ee(se){return new X(se)}const $=(0,H.c)(),ne=(0,J.c)()},67857:(dt,Re,T)=>{"use strict";var x,A,Q;T.d(Re,{eC:()=>A,om:()=>G,q7:()=>x}),(Q=x||(x={}))[Q.OBJECT=0]="OBJECT",Q[Q.HUD=1]="HUD",Q[Q.TERRAIN=2]="TERRAIN",Q[Q.OVERLAY=3]="OVERLAY",Q[Q.I3S=4]="I3S",Q[Q.PCL=5]="PCL",Q[Q.LOD=6]="LOD",Q[Q.VOXEL=7]="VOXEL";class G{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.store=A.ALL}}!function(Q){Q[Q.MIN=0]="MIN",Q[Q.MINMAX=1]="MINMAX",Q[Q.ALL=2]="ALL"}(A||(A={}))},30993:(dt,Re,T)=>{"use strict";T.d(Re,{al:()=>Q});var x=T(28093);class A{constructor(re,J){this.vec3=re,this.id=J}}function Q(H,re,J,W){return new A((0,x.f)(H,re,J),W)}},40723:(dt,Re,T)=>{"use strict";T.d(Re,{F5:()=>J,Mt:()=>B,yD:()=>W});var W,Z,x=T(62208),A=T(17625),G=T(12699),Q=T(24425),H=T(39114),re=T(57623);class J extends G.c{constructor(ie,ue){super(),this.type=Q.U.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=H.i,this._parameters=(0,re.Uf)(ie,ue),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(ie){return!1}setParameters(ie,ue=!0){(0,re.LO)(this._parameters,ie)&&(this.validateParameters(this._parameters),ue&&this.parametersChanged())}validateParameters(ie){}get visible(){return this._visible}set visible(ie){ie!==this._visible&&(this._visible=ie,this.parametersChanged())}shouldRender(ie){return this.isVisible()&&this.isVisibleInPass(ie.pass)&&0!=(this.renderOccluded&ie.renderOccludedMask)}isVisibleInPass(ie){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(ie){ie!==this._renderPriority&&(this._renderPriority=ie,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(ie){ie!==this._insertOrder&&(this._insertOrder=ie,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){(0,x.pC)(this.repository)&&this.repository.materialChanged(this)}}(Z=W||(W={}))[Z.Occlude=1]="Occlude",Z[Z.Transparent=2]="Transparent",Z[Z.OccludeAndTransparent=4]="OccludeAndTransparent",Z[Z.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",Z[Z.Opaque=16]="Opaque";class B extends A.K{constructor(){super(...arguments),this.renderOccluded=W.Occlude}}},54840:(dt,Re,T)=>{"use strict";var x,A,G,Q;T.d(Re,{$:()=>x}),(G=(A=x||(x={})).Geometry||(A.Geometry={}))[G.ADD=1]="ADD",G[G.UPDATE=2]="UPDATE",G[G.REMOVE=4]="REMOVE",(Q=A.State||(A.State={}))[Q.VISIBILITIES=1]="VISIBILITIES",Q[Q.VERTEXATTRS=2]="VERTEXATTRS",Q[Q.TRANSFORMATION=4]="TRANSFORMATION",Q[Q.HIGHLIGHTS=8]="HIGHLIGHTS",Q[Q.OCCLUDEES=16]="OCCLUDEES"},97272:(dt,Re,T)=>{"use strict";T.d(Re,{T:()=>le});var x=T(62208),A=T(28347),G=T(43703),Q=T(84161),H=T(28093),re=T(97126),J=T(98943),W=T(42743),B=T(12699),Z=T(24425),ie=T(24260),ue=T(7167),ce=T(2282),oe=T(65073);class le extends B.c{constructor(U={}){super(),this.type=Z.U.Object,this._geometryRecords=new Array,this._geometries=new Array,this._objectTransformation=(0,G.c)(),this._bvObjectSpace=new j,this._bvWorldSpace=new j,this._bvDirty=!0,this._hasVolatileTransformation=!1,this._visible=!0,this.castShadow=null==U.castShadow||U.castShadow,this.metadata=U.metadata,this.metadata&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new Y),this.transformation=(0,G.c)();const{geometries:ee,materials:$,transformations:ne,origins:se}=U;if(Array.isArray(ee)){(0,ce.hu)($.length===ee.length,"Object3D: materials don't match geometries"),(0,ce.hu)(ne.length===ee.length,"Object3D: transformations don't match geometries"),this._geometryRecords.length=ee.length,this._geometries.length=ee.length;for(let ae=0;ae<ee.length;ae++)this._geometries[ae]=ee[ae],this._geometryRecords[ae]=ie.k.pool.acquire(ee[ae],$[ae],(0,G.b)(ne[ae]),{highlights:null,occludees:null,visible:this._visible},se&&se[ae])}}get geometryRecords(){return this._geometryRecords}get geometries(){return this._geometries}get transformation(){return this._objectTransformation}set transformation(U){(0,A.c)(this._objectTransformation,U),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}dispose(){this._geometryRecords.length=0,this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(U){(0,ce.hu)(null==this._parentLayer||null==U,"Object3D can only be added to a single Layer"),this._parentLayer=U}addGeometry(U,ee,$,ne,se){$=$||G.I,this._geometries.push(U);const ae=ie.k.pool.acquire(U,ee,$,{highlights:null,occludees:null,visible:this._visible},ne,se);return this._geometryRecords.push(ae),this._hasVolatileTransformation=this._hasVolatileTransformation||(0,x.pC)(ae.shaderTransformation),this._emit("objectGeometryAdded",{object:this,record:ae}),this._invalidateBoundingVolume(),ae}removeGeometry(U){const ee=this._geometryRecords.splice(U,1)[0];return this._hasVolatileTransformation=(0,x.pC)(ee.shaderTransformation)?this._geometryRecords.some($=>(0,x.pC)($.shaderTransformation)):this._hasVolatileTransformation,ee.dispose(),this._geometries.splice(U,1),this._emit("objectGeometryRemoved",{object:this,record:ee}),this._invalidateBoundingVolume(),ee}removeAllGeometries(){for(;this.geometryRecords.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(U){this._emit("vertexAttrsUpdated",{object:this,record:U}),this._invalidateBoundingVolume()}get isVisible(){return this._visible}setVisible(U){if(this._visible!==U){this._visible=U;for(const ee of this._geometryRecords)ee.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const U=new ue.O(W.V_.MaskOccludee);for(const ee of this._geometryRecords)ee.instanceParameters.occludees=(0,oe.lr)(ee.instanceParameters.occludees,U);return this._emit("occlusionChanged",this),U}removeOcclude(U){for(const ee of this._geometryRecords)ee.instanceParameters.occludees=(0,oe.U_)(ee.instanceParameters.occludees,U);this._emit("occlusionChanged",this)}highlight(){const U=new ue.O(W.V_.Highlight);for(const ee of this._geometryRecords)ee.instanceParameters.highlights=(0,oe.lr)(ee.instanceParameters.highlights,U);return this._emit("highlightChanged",this),U}removeHighlight(U){for(const ee of this._geometryRecords)ee.instanceParameters.highlights=(0,oe.U_)(ee.instanceParameters.highlights,U);this._emit("highlightChanged",this)}getCombinedStaticTransformation(U,ee){return(0,A.m)((0,x.Pt)(ee,(0,G.c)()),this.transformation,U.getStaticTransformation())}_getCombinedShaderTransformation(U,ee){return ee=ee||(0,G.c)(),(0,A.m)(ee,this.transformation,U.getShaderTransformation()),ee}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._validateBoundingVolume(),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._validateBoundingVolume(),this._bvObjectSpace}_validateBoundingVolume(){if(!this._bvDirty&&!this._hasVolatileTransformation)return;this._bvObjectSpace.init(),this._bvWorldSpace.init();for(let ne=0;ne<this._geometryRecords.length;++ne){const ae=this._geometryRecords[ne],de=this._geometries[ne].boundingInfo;(0,x.pC)(de)&&(this._calculateTransformedBoundingVolume(de,this._bvObjectSpace,ae.getShaderTransformation()),this._calculateTransformedBoundingVolume(de,this._bvWorldSpace,this._getCombinedShaderTransformation(ae)))}(0,Q.h)(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5),(0,Q.h)(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);const U=(0,H.c)(),ee=(0,H.c)(),$=(0,J.u1)(this.transformation);for(let ne=0;ne<this._geometryRecords.length;++ne){const se=this._geometries[ne].boundingInfo;if((0,x.Wi)(se))continue;const ae=this._geometryRecords[ne].getShaderTransformation(),de=(0,J.u1)(ae);(0,Q.m)(U,se.getCenter(),ae);const _e=(0,Q.i)(U,this._bvObjectSpace.bounds),pe=se.getBSRadius()*de;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],_e+pe),(0,Q.m)(ee,U,this.transformation);const he=(0,Q.i)(ee,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],he+pe*$)}this._bvDirty=!1}_calculateTransformedBoundingVolume(U,ee,$){const ne=U.getBBMin(),se=U.getBBMax(),ae=(0,H.a)(ne),de=(0,H.a)(se);(0,Q.m)(ae,ae,$),(0,Q.m)(de,de,$);for(let _e=0;_e<3;++_e)ee.min[_e]=Math.min(ee.min[_e],ae[_e],de[_e]),ee.max[_e]=Math.max(ee.max[_e],ae[_e],de[_e]);for(let _e=0;_e<3;++_e){(0,Q.c)(ae,ne),(0,Q.c)(de,se),ae[_e]=se[_e],de[_e]=ne[_e],(0,Q.m)(ae,ae,$),(0,Q.m)(de,de,$);for(let pe=0;pe<3;++pe)ee.min[pe]=Math.min(ee.min[pe],ae[pe],de[pe]),ee.max[pe]=Math.max(ee.max[pe],ae[pe],de[pe])}}_invalidateBoundingVolume(){this._bvDirty=!0,(0,x.pC)(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)}_emit(U,ee){(0,x.pC)(this._parentLayer)&&this._parentLayer.events.emit(U,ee)}get test(){const U=this;return{hasGeometry:ee=>U._geometries.includes(ee),getGeometryIndex:ee=>U._geometries.indexOf(ee)}}}class Y{constructor(){this.min=(0,H.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,H.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class j extends Y{constructor(){super(...arguments),this.bounds=(0,re.c)()}init(){(0,Q.s)(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),(0,Q.s)(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),(0,re.a)(this.bounds)}}},7167:(dt,Re,T)=>{"use strict";T.d(Re,{O:()=>A});var x=T(86236);class A{constructor(Q){this.channel=Q,this.id=(0,x.D)()}}},82274:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Ge});var Je,xe,x=T(62208),A=T(27899),G=T(77029),Q=T(84161),H=T(28093),re=T(8834),J=T(70562),W=T(97126),B=T(2282);class Z{constructor(xe,je){this._objectToBoundingSphere=xe,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new ie,this._objectCount=0,je&&(void 0!==je.maximumObjectsPerNode&&(this._maximumObjectsPerNode=je.maximumObjectsPerNode),void 0!==je.maximumDepth&&(this._maximumDepth=je.maximumDepth))}get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}destroy(){this._degenerateObjects.clear(),ie.clearPool(),se[0]=null,ge.prune(),Ce.prune()}add(xe,je=xe.length){this._objectCount+=je,this._grow(xe,je);const We=ie.acquire();for(let Ne=0;Ne<je;Ne++){const we=xe[Ne];this._isDegenerate(we)?this._degenerateObjects.add(we):(We.init(this._root),this._add(we,We))}ie.release(We)}remove(xe,je=null){this._objectCount-=xe.length;const We=ie.acquire();for(const Ne of xe){const we=(0,x.pC)(je)?je:(0,W.b)(this._objectToBoundingSphere(Ne),ye);U(we[3])?(We.init(this._root),this._remove(Ne,we,We)):this._degenerateObjects.delete(Ne)}ie.release(We),this._shrink()}update(xe,je){if(!U(je[3])&&this._isDegenerate(xe))return;const We=function ae(Je){return se[0]=Je,se}(xe);this.remove(We,je),this.add(We)}forEachAlongRay(xe,je,We){const Ne=(0,J.re)(xe,je);this._forEachNode(this._root,we=>{if(!this._intersectsNode(Ne,we))return!1;const Oe=we.node;return Oe.terminals.forAll($e=>{this._intersectsObject(Ne,$e)&&We($e)}),null!==Oe.residents&&Oe.residents.forAll($e=>{this._intersectsObject(Ne,$e)&&We($e)}),!0})}forEachAlongRayWithVerticalOffset(xe,je,We,Ne){const we=(0,J.re)(xe,je);this._forEachNode(this._root,Oe=>{if(!this._intersectsNodeWithOffset(we,Oe,Ne))return!1;const $e=Oe.node;return $e.terminals.forAll(Be=>{this._intersectsObjectWithOffset(we,Be,Ne)&&We(Be)}),null!==$e.residents&&$e.residents.forAll(Be=>{this._intersectsObjectWithOffset(we,Be,Ne)&&We(Be)}),!0})}forEach(xe){this._forEachNode(this._root,je=>{const We=je.node;return We.terminals.forAll(xe),null!==We.residents&&We.residents.forAll(xe),!0}),this._degenerateObjects.forEach(xe)}forEachDegenerateObject(xe){this._degenerateObjects.forEach(xe)}findClosest(xe,je,We,Ne=(()=>!0),we=1/0){let Oe=1/0,$e=1/0,Be=null;const Se=j(xe,je),De=Fe=>{if(--we,!Ne(Fe))return;const ve=this._objectToBoundingSphere(Fe);if(!(0,re.hr)(We,ve))return;const Ke=X(xe,je,(0,W.g)(ve)),qe=Ke-ve[3];qe<Oe&&(Oe=qe,$e=Ke+ve[3],Be=Fe)};return this._forEachNodeDepthOrdered(this._root,Fe=>{if(we<=0||!(0,re.hr)(We,Fe.bounds)||((0,Q.g)(_e,Se,Fe.halfSize),(0,Q.a)(_e,_e,Fe.bounds),X(xe,je,_e)>$e))return!1;const ve=Fe.node;return ve.terminals.forAll(Ke=>De(Ke)),null!==ve.residents&&ve.residents.forAll(Ke=>De(Ke)),!0},xe,je),Be}forEachInDepthRange(xe,je,We,Ne,we,Oe,$e){let Be=-1/0,Se=1/0;const De={setRange:be=>{We===Z.DepthOrder.FRONT_TO_BACK?(Be=Math.max(Be,be.near),Se=Math.min(Se,be.far)):(Be=Math.max(Be,-be.far),Se=Math.min(Se,-be.near))}};De.setRange(Ne);const Fe=X(je,We,xe),ve=j(je,We),Ke=j(je,-We),qe=be=>{if(!$e(be))return;const tt=this._objectToBoundingSphere(be),Ye=(0,W.g)(tt),ze=X(je,We,Ye)-Fe;ze-tt[3]>Se||ze+tt[3]<Be||!(0,re.hr)(Oe,tt)||we(be,De)};this._forEachNodeDepthOrdered(this._root,be=>{if(!(0,re.hr)(Oe,be.bounds)||((0,Q.g)(_e,ve,be.halfSize),(0,Q.a)(_e,_e,be.bounds),X(je,We,_e)-Fe>Se)||((0,Q.g)(_e,Ke,be.halfSize),(0,Q.a)(_e,_e,be.bounds),X(je,We,_e)-Fe<Be))return!1;const tt=be.node;return tt.terminals.forAll(Ye=>qe(Ye)),null!==tt.residents&&tt.residents.forAll(Ye=>qe(Ye)),!0},je,We)}forEachNode(xe){this._forEachNode(this._root,je=>xe(je.node,je.bounds,je.halfSize))}forEachNeighbor(xe,je){const We=(0,W.d)(je),Ne=(0,W.g)(je),we=Oe=>{const $e=this._objectToBoundingSphere(Oe),Be=(0,W.d)($e),Se=We+Be;(0,Q.d)((0,W.g)($e),Ne)-Se*Se<=0&&xe(Oe)};this._forEachNode(this._root,Oe=>{const $e=(0,W.d)(Oe.bounds),Be=We+$e;if((0,Q.d)((0,W.g)(Oe.bounds),Ne)-Be*Be>0)return!1;const Se=Oe.node;return Se.terminals.forAll(De=>we(De)),null!==Se.residents&&Se.residents.forAll(De=>we(De)),!0}),this.forEachDegenerateObject(we)}_intersectsNode(xe,je){return oe(je.bounds,2*-je.halfSize,pe),oe(je.bounds,2*je.halfSize,he),(0,B.yK)(xe.origin,xe.direction,pe,he)}_intersectsNodeWithOffset(xe,je,We){return oe(je.bounds,2*-je.halfSize,pe),oe(je.bounds,2*je.halfSize,he),We.applyToMinMax(pe,he),(0,B.yK)(xe.origin,xe.direction,pe,he)}_intersectsObject(xe,je){const We=this._objectToBoundingSphere(je);return!(We[3]>0)||(0,W.i)(We,xe)}_intersectsObjectWithOffset(xe,je,We){const Ne=this._objectToBoundingSphere(je);return!(Ne[3]>0)||(0,W.i)(We.applyToBoundingSphere(Ne),xe)}_forEachNode(xe,je){let We=ie.acquire().init(xe);const Ne=[We];for(;0!==Ne.length;){if(We=Ne.pop(),je(We)&&!We.isLeaf())for(let we=0;we<We.node.children.length;we++)We.node.children[we]&&Ne.push(ie.acquire().init(We).advance(we));ie.release(We)}}_forEachNodeDepthOrdered(xe,je,We,Ne=Z.DepthOrder.FRONT_TO_BACK){let we=ie.acquire().init(xe);const Oe=[we];for(function Y(Je,xe,je){if(!Ce.length)for(let We=0;We<8;++We)Ce.push({index:0,distance:0});for(let We=0;We<8;++We){const Ne=ee[We];Ce.data[We].index=We,Ce.data[We].distance=X(Je,xe,Ne)}Ce.sort((We,Ne)=>We.distance-Ne.distance);for(let We=0;We<8;++We)je[We]=Ce.data[We].index}(We,Ne,Ie);0!==Oe.length;){if(we=Oe.pop(),je(we)&&!we.isLeaf())for(let $e=7;$e>=0;--$e){const Be=Ie[$e];we.node.children[Be]&&Oe.push(ie.acquire().init(we).advance(Be))}ie.release(we)}}_remove(xe,je,We){ge.clear();const Ne=We.advanceTo(je,(we,Oe)=>{ge.push(we.node),ge.push(Oe)})?We.node.terminals:We.node.residents;if(Ne.removeUnordered(xe),0===Ne.length)for(let we=ge.length-2;we>=0&&this._purge(ge.data[we],ge.data[we+1]);we-=2);}_nodeIsEmpty(xe){if(0!==xe.terminals.length)return!1;if(null!==xe.residents)return 0===xe.residents.length;for(let je=0;je<xe.children.length;je++)if(xe.children[je])return!1;return!0}_purge(xe,je){return je>=0&&(xe.children[je]=null),!!this._nodeIsEmpty(xe)&&(null===xe.residents&&(xe.residents=new G.Z({shrink:!0})),!0)}_add(xe,je){je.advanceTo(this._objectToBoundingSphere(xe))?je.node.terminals.push(xe):(je.node.residents.push(xe),je.node.residents.length>this._maximumObjectsPerNode&&je.depth<this._maximumDepth&&this._split(je))}_split(xe){const je=xe.node.residents;xe.node.residents=null;for(let We=0;We<je.length;We++){const Ne=ie.acquire().init(xe);this._add(je.getItemAt(We),Ne),ie.release(Ne)}}_grow(xe,je){if(0!==je&&(le(xe,je,We=>this._objectToBoundingSphere(We),Me),U(Me[3])&&!this._fitsInsideTree(Me)))if(this._nodeIsEmpty(this._root.node))(0,W.b)(Me,this._root.bounds),this._root.halfSize=1.25*Me[3];else{const We=this._rootBoundsForRootAsSubNode(Me);this._placingRootViolatesMaxDepth(We)?this._rebuildTree(Me,We):this._growRootAsSubNode(We),ie.release(We)}}_rebuildTree(xe,je){(0,Q.c)(Ee,je.bounds),Ee[3]=je.halfSize,le([xe,Ee],2,Ne=>Ne,Te);const We=ie.acquire().init(this._root);this._root.initFrom(null,Te,1.25*Te[3]),this._forEachNode(We,Ne=>(this.add(Ne.node.terminals.data,Ne.node.terminals.length),null!==Ne.node.residents&&this.add(Ne.node.residents.data,Ne.node.residents.length),!0)),ie.release(We)}_placingRootViolatesMaxDepth(xe){const je=Math.log(xe.halfSize/this._root.halfSize)*Math.LOG2E;let We=0;return this._forEachNode(this._root,Ne=>(We=Math.max(We,Ne.depth),We+je<=this._maximumDepth)),We+je>this._maximumDepth}_rootBoundsForRootAsSubNode(xe){const je=xe[3],We=xe;let Ne=-1/0;const we=this._root.bounds,Oe=this._root.halfSize;for(let $e=0;$e<3;$e++){const Se=We[$e]+je-(we[$e]+Oe),De=Math.max(0,Math.ceil((we[$e]-Oe-(We[$e]-je))/(2*Oe))),Fe=Math.max(0,Math.ceil(Se/(2*Oe)))+1,ve=2**Math.ceil(Math.log(De+Fe)*Math.LOG2E);Ne=Math.max(Ne,ve),me[$e].min=De,me[$e].max=Fe}for(let $e=0;$e<3;$e++){let Be=me[$e].min,Se=me[$e].max;const De=(Ne-(Be+Se))/2;Be+=Math.ceil(De),Se+=Math.floor(De),de[$e]=we[$e]-Oe-Be*Oe*2+(Se+Be)*Oe}return de[3]=Ne*Oe*ne,ie.acquire().initFrom(null,de,Ne*Oe,0)}_growRootAsSubNode(xe){const je=this._root.node;(0,Q.c)(Me,this._root.bounds),Me[3]=this._root.halfSize,this._root.init(xe),xe.advanceTo(Me,null,!0),xe.node.children=je.children,xe.node.residents=je.residents,xe.node.terminals=je.terminals}_shrink(){for(;;){const xe=this._findShrinkIndex();if(-1===xe)break;this._root.advance(xe),this._root.depth=0}}_findShrinkIndex(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let xe=null;const je=this._root.node.children;let We=0,Ne=0;for(;Ne<je.length&&null==xe;)We=Ne++,xe=je[We];for(;Ne<je.length;)if(je[Ne++])return-1;return We}_isDegenerate(xe){return!U(this._objectToBoundingSphere(xe)[3])}_fitsInsideTree(xe){const je=this._root.bounds,We=this._root.halfSize;return xe[3]<=We&&xe[0]>=je[0]-We&&xe[0]<=je[0]+We&&xe[1]>=je[1]-We&&xe[1]<=je[1]+We&&xe[2]>=je[2]-We&&xe[2]<=je[2]+We}}class ie{constructor(){this.bounds=(0,W.c)(),this.halfSize=0,this.initFrom(null,null,0,0)}init(xe){return this.initFrom(xe.node,xe.bounds,xe.halfSize,xe.depth)}initFrom(xe,je,We,Ne=this.depth){return this.node=(0,x.pC)(xe)?xe:ie.createEmptyNode(),(0,x.pC)(je)&&(0,W.b)(je,this.bounds),this.halfSize=We,this.depth=Ne,this}advance(xe){let je=this.node.children[xe];je||(je=ie.createEmptyNode(),this.node.children[xe]=je),this.node=je,this.halfSize/=2,this.depth++;const We=ee[xe];return this.bounds[0]+=We[0]*this.halfSize,this.bounds[1]+=We[1]*this.halfSize,this.bounds[2]+=We[2]*this.halfSize,this.bounds[3]=this.halfSize*ne,this}advanceTo(xe,je,We=!1){for(;;){if(this.isTerminalFor(xe))return je&&je(this,-1),!0;if(this.isLeaf()){if(!We)return je&&je(this,-1),!1;this.node.residents=null}const Ne=this._childIndex(xe);je&&je(this,Ne),this.advance(Ne)}}isLeaf(){return null!=this.node.residents}isTerminalFor(xe){return xe[3]>this.halfSize/2}_childIndex(xe){const je=this.bounds;return(je[0]<xe[0]?1:0)+(je[1]<xe[1]?2:0)+(je[2]<xe[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new G.Z({shrink:!0}),residents:new G.Z({shrink:!0})}}static acquire(){return ie._pool.acquire()}static release(xe){ie._pool.release(xe)}static clearPool(){ie._pool.prune()}}function ue(Je,xe){Je[0]=Math.min(Je[0],xe[0]-xe[3]),Je[1]=Math.min(Je[1],xe[1]-xe[3]),Je[2]=Math.min(Je[2],xe[2]-xe[3])}function ce(Je,xe){Je[0]=Math.max(Je[0],xe[0]+xe[3]),Je[1]=Math.max(Je[1],xe[1]+xe[3]),Je[2]=Math.max(Je[2],xe[2]+xe[3])}function oe(Je,xe,je){je[0]=Je[0]+xe,je[1]=Je[1]+xe,je[2]=Je[2]+xe}function le(Je,xe,je,We){if(1===xe){const Ne=je(Je[0]);(0,W.b)(Ne,We)}else{pe[0]=1/0,pe[1]=1/0,pe[2]=1/0,he[0]=-1/0,he[1]=-1/0,he[2]=-1/0;for(let Ne=0;Ne<xe;Ne++){const we=je(Je[Ne]);U(we[3])&&(ue(pe,we),ce(he,we))}(0,Q.h)(We,pe,he,.5),We[3]=Math.max(he[0]-pe[0],he[1]-pe[1],he[2]-pe[2])/2}}function j(Je,xe){let je=1/0,We=null;for(let Ne=0;Ne<8;++Ne){const we=X(Je,xe,$[Ne]);we<je&&(je=we,We=$[Ne])}return We}function X(Je,xe,je){return xe*(Je[0]*je[0]+Je[1]*je[1]+Je[2]*je[2])}function U(Je){return!isNaN(Je)&&Je!==-1/0&&Je!==1/0&&Je>0}ie._pool=new A.Z(ie),(xe=(Je=Z||(Z={})).DepthOrder||(Je.DepthOrder={}))[xe.FRONT_TO_BACK=1]="FRONT_TO_BACK",xe[xe.BACK_TO_FRONT=-1]="BACK_TO_FRONT";const ee=[(0,H.f)(-1,-1,-1),(0,H.f)(1,-1,-1),(0,H.f)(-1,1,-1),(0,H.f)(1,1,-1),(0,H.f)(-1,-1,1),(0,H.f)(1,-1,1),(0,H.f)(-1,1,1),(0,H.f)(1,1,1)],$=[(0,H.f)(-1,-1,-1),(0,H.f)(-1,-1,1),(0,H.f)(-1,1,-1),(0,H.f)(-1,1,1),(0,H.f)(1,-1,-1),(0,H.f)(1,-1,1),(0,H.f)(1,1,-1),(0,H.f)(1,1,1)],ne=Math.sqrt(3),se=[null],de=(0,W.c)(),_e=(0,H.c)(),pe=(0,H.c)(),he=(0,H.c)(),ge=new G.Z,ye=(0,W.c)(),Me=(0,W.c)(),Ee=(0,W.c)(),Te=(0,W.c)(),me=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],Ce=new G.Z,Ie=[0,0,0,0,0,0,0,0],Ge=Z},88569:(dt,Re,T)=>{"use strict";T.d(Re,{Bh:()=>ue,E0:()=>Z,IB:()=>re,K5:()=>W,j7:()=>J,je:()=>ie,ve:()=>B,wu:()=>Q});var x=T(42743),A=T(67969),G=T(2078);const Q=(0,G.wK)(A.zi.SRC_ALPHA,A.zi.ONE,A.zi.ONE_MINUS_SRC_ALPHA,A.zi.ONE_MINUS_SRC_ALPHA),H=(0,G.if)(A.zi.ONE,A.zi.ONE),re=(0,G.if)(A.zi.ZERO,A.zi.ONE_MINUS_SRC_ALPHA);function J(ce){return ce===x.Am.FrontFace?null:ce===x.Am.Alpha?re:H}function W(ce){return ce===x.Am.FrontFace?G.LZ:null}const B=5e5,Z={factor:-1,units:-2};function ie(ce){return ce?Z:null}function ue(ce,oe=A.wb.LESS){return ce===x.Am.NONE||ce===x.Am.FrontFace?oe:A.wb.LEQUAL}},12407:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>H});var x=T(62208),A=T(77029),G=T(37847),Q=T(68598);class H{constructor(J,W,B){this._context=J,this._locations=B,this._textures=new Map,this._freeTextureUnits=new A.Z({deallocator:null}),this._glProgram=J.programCache.acquire(W.generate("vertex"),W.generate("fragment"),B),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=W.generateBind(G.P.Pass,this),this.bindDraw=W.generateBind(G.P.Draw,this),this._fragmentUniforms=(0,Q.hZ)()?W.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get isCompiled(){return this._glProgram.isCompiled}setUniform1b(J,W){this._glProgram.setUniform1i(J,W?1:0)}setUniform1i(J,W){this._glProgram.setUniform1i(J,W)}setUniform1f(J,W){this._glProgram.setUniform1f(J,W)}setUniform2f(J,W,B){this._glProgram.setUniform2f(J,W,B)}setUniform2fv(J,W){this._glProgram.setUniform2fv(J,W)}setUniform3f(J,W,B,Z){this._glProgram.setUniform3f(J,W,B,Z)}setUniform3fv(J,W){this._glProgram.setUniform3fv(J,W)}setUniform4f(J,W,B,Z,ie){this._glProgram.setUniform4f(J,W,B,Z,ie)}setUniform4fv(J,W){this._glProgram.setUniform4fv(J,W)}setUniformMatrix3fv(J,W){this._glProgram.setUniformMatrix3fv(J,W)}setUniformMatrix4fv(J,W){this._glProgram.setUniformMatrix4fv(J,W)}setUniform1fv(J,W){this._glProgram.setUniform1fv(J,W)}setUniform1iv(J,W){this._glProgram.setUniform1iv(J,W)}setUniform2iv(J,W){this._glProgram.setUniform3iv(J,W)}setUniform3iv(J,W){this._glProgram.setUniform3iv(J,W)}setUniform4iv(J,W){this._glProgram.setUniform4iv(J,W)}assertCompatibleVertexAttributeLocations(J){J.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(J,W){if((0,x.Wi)(W)||null==W.glName){const Z=this._textures.get(J);return Z&&(this._context.bindTexture(null,Z.unit),this._freeTextureUnit(Z),this._textures.delete(J)),null}let B=this._textures.get(J);return null==B?(B=this._allocTextureUnit(W),this._textures.set(J,B)):B.texture=W,this._context.useProgram(this),this.setUniform1i(J,B.unit),this._context.bindTexture(W,B.unit),B.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((J,W)=>{this._context.bindTexture(J.texture,J.unit),this.setUniform1i(W,J.unit)}),(0,x.pC)(this._fragmentUniforms)&&this._fragmentUniforms.forEach(J=>{"sampler2D"!==J.type&&"samplerCube"!==J.type||this._textures.has(J.name)||console.error(`Texture sampler ${J.name} has no bound texture`)})}_allocTextureUnit(J){return{texture:J,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(J){this._freeTextureUnits.push(J.unit)}}},64624:(dt,Re,T)=>{"use strict";T.d(Re,{V:()=>J,Y:()=>re});var x=T(62208),A=T(74202),G=T(59856),Q=T(40723),H=T(91263);class re{constructor(Z,ie,ue,ce=null){this.rctx=Z,this.sliceHelper=ce,this.lastFrameCamera=new G.V,this.pass=H.C.MATERIAL,this.renderOccludedMask=W,this.bindParameters=new A.p(ie,ue,(0,x.pC)(ce)?ce.plane:null)}resetRenderOccludedMask(){this.renderOccludedMask=W}get isHighlightPass(){return this.pass===H.C.MATERIAL_HIGHLIGHT}}class J extends re{constructor(Z,ie,ue,ce,oe){super(Z,ue,ce,oe),this.offscreenRenderingHelper=ie,this.sliceHelper=oe}}const W=Q.yD.Occlude|Q.yD.OccludeAndTransparent|Q.yD.OccludeAndTransparentStencil},53855:(dt,Re,T)=>{"use strict";T.d(Re,{z:()=>oe});var x=T(62208),A=T(86236),G=T(28347),Q=T(43703),H=T(84161),re=T(4794),J=T(98943),W=T(42743),B=T(36848);class Z{constructor(){this.visible=!0}}var ie=T(7167),ue=T(16396),ce=T(65073);class oe{constructor(j,X,U={}){this.data=j,this.material=X,this.boundingSphere=(0,re.c)(),this.instanceParameters=new Z,this._transformation=(0,Q.c)(),this._shaderTransformationDirty=!0,this.layerUid=(0,x.Pt)(U.layerUid,null),this.graphicUid=(0,x.Pt)(U.graphicUid,null),this.id=U.id?U.id:(0,A.D)(),this.boundingInfo=(0,x.Pt)(U.boundingInfo,null),this.calculateShaderTransformation=(0,x.Pt)(U.calculateShaderTransformation,null),this.castShadow=!!U.castShadow&&U.castShadow}get transformation(){return this._transformation}updateTransformation(j){j(this._transformation),this._shaderTransformationDirty=!0,this.computeBoundingSphere(this._transformation,this.boundingSphere)}shaderTransformationChanged(){this._shaderTransformationDirty=!0}computeBoundingSphere(j,X,U=(0,J.u1)(j)){(0,x.Wi)(this.boundingInfo)||((0,H.m)(X,this.boundingInfo.getCenter(),j),X[3]=this.boundingInfo.getBSRadius()*U)}get hasShaderTransformation(){return(0,x.pC)(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return(0,x.Wi)(this.calculateShaderTransformation)?(0,x.Pt)(this.transformation,Q.I):(this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=(0,Q.c)()),(0,G.c)(this._shaderTransformation,this.calculateShaderTransformation((0,x.Pt)(this.transformation,Q.I))),this._shaderTransformationDirty=!1),this._shaderTransformation)}computeAttachmentOrigin(j){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,j)&&((0,x.pC)(this._transformation)&&(0,H.m)(j,j,this._transformation),!0);const X=this.indices.get(ue.T.POSITION),U=this.vertexAttributes.get(ue.T.POSITION);return!!(0,B.cM)(U,X,j)&&((0,x.pC)(this._transformation)&&(0,H.m)(j,j,this._transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const j=new ie.O(W.V_.Highlight),X=this.instanceParameters;return X.highlights=(0,ce.lr)(X.highlights,j),j}removeHighlight(j){const X=this.instanceParameters;X.highlights=(0,ce.U_)(X.highlights,j)}}},91263:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{C:()=>x}),(A=x||(x={}))[A.MATERIAL=0]="MATERIAL",A[A.MATERIAL_ALPHA=1]="MATERIAL_ALPHA",A[A.MATERIAL_DEPTH=2]="MATERIAL_DEPTH",A[A.MATERIAL_NORMAL=3]="MATERIAL_NORMAL",A[A.MATERIAL_DEPTH_SHADOWMAP_ALL=4]="MATERIAL_DEPTH_SHADOWMAP_ALL",A[A.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT",A[A.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT",A[A.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT"},5894:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{r:()=>x}),(A=x||(x={}))[A.INTEGRATED_MESH=0]="INTEGRATED_MESH",A[A.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",A[A.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",A[A.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",A[A.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",A[A.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",A[A.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",A[A.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",A[A.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",A[A.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",A[A.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",A[A.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",A[A.LASERLINES=12]="LASERLINES",A[A.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",A[A.HUD_MATERIAL=14]="HUD_MATERIAL",A[A.LABEL_MATERIAL=15]="LABEL_MATERIAL",A[A.LINE_CALLOUTS=16]="LINE_CALLOUTS",A[A.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",A[A.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",A[A.DRAPED_WATER=19]="DRAPED_WATER",A[A.VOXEL=20]="VOXEL",A[A.MAX_SLOTS=21]="MAX_SLOTS"},53218:(dt,Re,T)=>{"use strict";T.d(Re,{L:()=>Q,f:()=>G});var G,H,x=T(17626),A=T(87601);(H=G||(G={}))[H.EdgeDetector=0]="EdgeDetector",H[H.BlendWeight=1]="BlendWeight",H[H.Blur=2]="Blur",H[H.COUNT=3]="COUNT";class Q extends A.m{constructor(){super(...arguments),this.output=G.EdgeDetector}}(0,x._)([(0,A.o)({count:G.COUNT})],Q.prototype,"output",void 0)},93783:(dt,Re,T)=>{"use strict";T.d(Re,{L:()=>X});var x=T(62208),A=T(84161),G=T(70026),Q=T(17625),H=T(19597),re=T(651),J=T(91056),W=T(39114),B=T(12407),Z=T(52376),ie=T(2078);class ue extends J.A{initializeProgram($){const ne=ue.shader.get().build(this.configuration);return new B.$($.rctx,ne,W.i)}initializePipeline(){return(0,ie.sm)({colorWrite:ie.BK})}}ue.shader=new re.J(Z.S,()=>T.e(3999).then(T.bind(T,73999)));var ce=T(76217),oe=T(67969),le=T(85775),Y=T(55086),j=T(26906);class X{constructor($,ne,se){this._techniqueRep=$,this._rctx=ne,this._requestRender=se,this._enabled=!1,this._ssaoTechniqueConfig=new ce.F,this.quadVAO=null,this._blurSizePx=2,this._attenuation=.5}dispose(){this.quadVAO=(0,x.O3)(this.quadVAO)}disposeOffscreenBuffers(){(0,x.yw)(this._ssaoFBO,$=>$.resize(0,0)),(0,x.yw)(this._blur0FBO,$=>$.resize(0,0)),(0,x.yw)(this._blur1FBO,$=>$.resize(0,0))}set enabled($){$?this._enable():this._disable()}get enabled(){return this._enabled}get ready(){return this.enabled&&(0,x.pC)(this._noiseTexture)&&(0,x.pC)(this._ssaoFBO)&&(0,x.pC)(this._blur0FBO)&&(0,x.pC)(this._blur1FBO)}get colorTexture(){return(0,x.pC)(this._blur1FBO)?this._blur1FBO.colorTexture:null}get width(){return(0,x.pC)(this._ssaoFBO)?this._ssaoFBO.width:-1}get height(){return(0,x.pC)(this._ssaoFBO)?this._ssaoFBO.height:-1}computeSSAO($,ne,se){if(!this.enabled||(0,x.Wi)(ne)||(0,x.Wi)(se)||(0,x.Wi)(this._noiseTexture)||(0,x.Wi)(this._ssaoFBO)||(0,x.Wi)(this._blur0FBO)||(0,x.Wi)(this._blur1FBO))return;const ae=this._rctx,de=$.camera,_e=de.fullViewport,pe=_e[2],he=_e[3],ge=pe/this._blurSizePx,ye=he/this._blurSizePx;this._ssaoFBO.resize(pe,he),this._blur0FBO.resize(ge,ye),this._blur1FBO.resize(ge,ye);const Te=1*pe,me=1*he;ae.bindFramebuffer(this._ssaoFBO),ae.setViewport(0,0,pe,he);const Ce=ae.bindTechnique(this._ssaoTechnique,U,$);Ce.setUniform2f("rnmScale",pe/this._noiseTexture.descriptor.width,he/this._noiseTexture.descriptor.height);let Ie=1/de.computeRenderPixelSizeAtDist(1);Ce.setUniform1f("projScale",1*Ie),Ce.setUniform2f("screenSize",Te,me);const Ge=(0,A.i)(de.eye,de.center);let Je=20*de.computeRenderPixelSizeAtDist(Ge);Je=Math.max(.1,Je),Ce.setUniform1f("radius",Je),Ce.setUniform1f("intensity",4*this._attenuation/Je**6),Ce.bindTexture("rnm",this._noiseTexture),Ce.bindTexture("normalMap",se),Ce.bindTexture("depthMap",ne),(0,x.Wi)(this.quadVAO)&&(this.quadVAO=(0,H.ow)(this._rctx)),ae.bindVAO(this.quadVAO),ae.drawArrays(oe.MX.TRIANGLE_STRIP,0,(0,j._V)(this.quadVAO,"geometry"));const xe=ae.bindTechnique(this._blurTechnique,U,$);xe.bindTexture("tex",this._ssaoFBO.colorTexture),xe.bindTexture("normalMap",se),xe.bindTexture("depthMap",ne),ae.setViewport(0,0,Te/this._blurSizePx,me/this._blurSizePx),ae.bindFramebuffer(this._blur0FBO),xe.setUniform2f("screenSize",Te,me),xe.setUniform2f("blurSize",0,1*this._blurSizePx/me),Ge>5e4&&(Ie=Math.max(0,Ie-(Ge-5e4))),xe.setUniform1f("projScale",Ie),ae.drawArrays(oe.MX.TRIANGLE_STRIP,0,(0,j._V)(this.quadVAO,"geometry")),xe.setUniform2f("blurSize",1*this._blurSizePx/Te,0),ae.bindFramebuffer(this._blur1FBO),xe.bindTexture("tex",this._blur0FBO.colorTexture),ae.drawArrays(oe.MX.TRIANGLE_STRIP,0,(0,j._V)(this.quadVAO,"geometry")),ae.setViewport(_e[0],_e[1],_e[2],_e[3])}_selectPrograms(){this._ssaoTechniqueConfig.output=ce.Q.SSAO,this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(ue,this._ssaoTechniqueConfig,this._ssaoTechnique),this._ssaoTechniqueConfig.output=ce.Q.Blur,this._blurTechnique=this._techniqueRep.releaseAndAcquire(ue,this._ssaoTechniqueConfig,this._blurTechnique)}_enable(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))}_loadResources($){this._data?$():T.e(181).then(T.bind(T,10181)).then(ne=>{this._data=ne,$()})}_initialize(){const $={target:oe.No.TEXTURE_2D,pixelFormat:oe.VI.RGBA,dataType:oe.Br.UNSIGNED_BYTE,samplingMode:oe.cw.LINEAR,wrapMode:oe.e8.CLAMP_TO_EDGE,width:0,height:0},ne={colorTarget:oe.Lm.TEXTURE,depthStencilTarget:oe.OU.NONE};(0,G.t)(this._data.noiseTexture).then(se=>{this._enabled&&(this._ssaoFBO=new le.X(this._rctx,ne,$),this._blur0FBO=new le.X(this._rctx,ne,$),this._blur1FBO=new le.X(this._rctx,ne,$),this._noiseTexture=new Y.x(this._rctx,{target:oe.No.TEXTURE_2D,pixelFormat:oe.VI.RGBA,dataType:oe.Br.UNSIGNED_BYTE,hasMipmap:!0,width:se.width,height:se.height},se),this._requestRender())}),this._selectPrograms()}_disable(){this._enabled=!1,this._noiseTexture=(0,x.O3)(this._noiseTexture),this._blur1FBO=(0,x.O3)(this._blur1FBO),this._blur0FBO=(0,x.O3)(this._blur0FBO),this._ssaoFBO=(0,x.O3)(this._ssaoFBO)}get gpuMemoryUsage(){return((0,x.pC)(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+((0,x.pC)(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+((0,x.pC)(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}get test(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}const U=new Q.K},76217:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>Q,Q:()=>G});var G,H,x=T(17626),A=T(87601);(H=G||(G={}))[H.SSAO=0]="SSAO",H[H.Blur=1]="Blur",H[H.COUNT=2]="COUNT";class Q extends A.m{constructor(){super(...arguments),this.output=G.SSAO}}(0,x._)([(0,A.o)({count:G.COUNT})],Q.prototype,"output",void 0)},53319:(dt,Re,T)=>{"use strict";T.d(Re,{i:()=>U,l:()=>$});var U,ze,x=T(21286),A=T(62208),G=T(550),Q=T(28347),H=T(43703),re=T(67831),J=T(99770),W=T(84161),B=T(28093),Z=T(993),ie=T(4794),ue=T(59617),ce=T(59856),oe=T(2282),le=T(67969),Y=T(85775),j=T(55086),X=T(26906);(ze=U||(U={}))[ze.Highlight=0]="Highlight",ze[ze.Default=1]="Default";class ee{constructor(){this.camera=new ce.V,this.lightMat=(0,H.c)()}}class ${constructor(et,ke,ot=0){this.rctx=et,this.viewingMode=ke,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this.maxTextureSize=0,this.numCascades=1,this.maxNumCascades=4,this.splitSchemeLambda=0,this.warp=!0,this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,ie.c)(),this._cascades=[new ee,new ee,new ee,new ee],this.maxTextureSize=this.rctx.parameters.maxTextureSize,this.snapshotCount=ot}get depthTexture(){return this._depthTexture}get textureSize(){return this._textureSize}get cascadeDistances(){return(0,Z.s)(this._usedCascadeDistances,this._cascadeDistances[0],this.numCascades>1?this._cascadeDistances[1]:1/0,this.numCascades>2?this._cascadeDistances[2]:1/0,this.numCascades>3?this._cascadeDistances[3]:1/0)}dispose(){this._discardDepthTexture(),this._discardAllSnapshots()}set maxCascades(et){this.maxNumCascades=(0,x.uZ)(Math.floor(et),1,4)}get maxCascades(){return this.maxNumCascades}set enabled(et){this._enabled=et,et||(this._discardDepthTexture(),this._discardAllSnapshots())}get enabled(){return this._enabled}get ready(){return this._enabled&&(0,A.pC)(this._depthTexture)}get snapshotCount(){return this._snapshots.length}set snapshotCount(et){const ke=this._snapshots.length;if(et>ke){const ot=et-ke;this._snapshots.length=et;for(let at=0;at<ot;++at)this._snapshots[ke+at]=null}else if(et<this.snapshotCount){const ot=ke-et;for(let at=0;at<ot;++at)this._discardSnapshot(et+at);this._snapshots.length=et}}getSnapshot(et){return this.enabled?this._snapshots[et]:null}getCascades(){for(let et=0;et<this.numCascades;++et)Ie[et]=this._cascades[et];return Ie.length=this.numCascades,Ie}start(et,ke,ot){(0,oe.hu)(this.enabled),this._textureSize=this._computeTextureSize(et.fullWidth,et.fullHeight),this._ensureDepthTexture();const{near:at,far:yt}=this._clampNearFar(ot);this._computeCascadeDistances(yt,at),this._setupMatrices(et,ke);const wt=et.viewMatrix,zt=et.projectionMatrix;for(let Rt=0;Rt<this.numCascades;++Rt)this._constructCascade(Rt,zt,wt,ke);this.lastOrigin=null,this.clear()}finish(et){(0,oe.hu)(this.enabled),this.rctx.bindFramebuffer(et)}getShadowMapMatrices(et){if(!this.lastOrigin||!(0,W.k)(et,this.lastOrigin)){this.lastOrigin=this.lastOrigin||(0,B.c)(),(0,W.c)(this.lastOrigin,et);for(let ke=0;ke<this.numCascades;++ke){(0,Q.j)(Ge,this._cascades[ke].lightMat,et);for(let ot=0;ot<16;++ot)Je[16*ke+ot]=Ge[ot]}}return Je}takeCascadeSnapshotTo(et,ke){(0,oe.hu)(this.enabled);const ot=this._ensureSnapshot(ke);this._bindFbo();const at=this.rctx,yt=at.bindTexture(ot,j.x.TEXTURE_UNIT_FOR_UPDATES);at.gl.copyTexSubImage2D(le.No.TEXTURE_2D,0,et.camera.viewport[0],et.camera.viewport[1],et.camera.viewport[0],et.camera.viewport[1],et.camera.viewport[2],et.camera.viewport[3]),at.bindTexture(yt,j.x.TEXTURE_UNIT_FOR_UPDATES)}clear(){const et=this.rctx;this._bindFbo(),et.setClearColor(1,1,1,1),et.clearSafe(le.lk.COLOR_BUFFER_BIT|le.lk.DEPTH_BUFFER_BIT)}_computeTextureSize(et,ke){const ot=.5*Math.log(et*et+ke*ke)*Math.LOG2E,yt=2**Math.round(ot+.35);return Math.min(this.maxTextureSize,2*yt)}_ensureDepthTexture(){(0,A.pC)(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize||(this._discardDepthTexture(),this._depthTexture=new j.x(this.rctx,{target:le.No.TEXTURE_2D,pixelFormat:le.VI.RGBA,dataType:le.Br.UNSIGNED_BYTE,wrapMode:le.e8.CLAMP_TO_EDGE,samplingMode:le.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._fbo=new Y.X(this.rctx,{colorTarget:le.Lm.TEXTURE,depthStencilTarget:le.OU.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture))}_ensureSnapshot(et){let ke=this._snapshots[et];return(0,A.pC)(ke)&&ke.descriptor.width===this._textureSize||(this._discardSnapshot(et),ke=new j.x(this.rctx,{target:le.No.TEXTURE_2D,pixelFormat:le.VI.RGBA,dataType:le.Br.UNSIGNED_BYTE,wrapMode:le.e8.CLAMP_TO_EDGE,samplingMode:le.cw.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._snapshots[et]=ke),ke}_discardDepthTexture(){this._fbo=(0,A.O3)(this._fbo),this._depthTexture=(0,A.O3)(this._depthTexture)}_discardSnapshot(et){this._snapshots[et]=(0,A.O3)(this._snapshots[et])}_discardAllSnapshots(){for(let et=0;et<this.snapshotCount;++et)this._discardSnapshot(et)}_bindFbo(){const et=this.rctx;et.unbindTexture(this._depthTexture),et.bindFramebuffer(this._fbo)}_constructCascade(et,ke,ot,at){const yt=this._cascades[et],wt=-this._cascadeDistances[et],zt=-this._cascadeDistances[et+1],Rt=(ke[10]*wt+ke[14])/Math.abs(ke[11]*wt+ke[15]),Ft=(ke[10]*zt+ke[14])/Math.abs(ke[11]*zt+ke[15]);(0,oe.hu)(Rt<Ft);for(let St=0;St<8;++St){(0,Z.s)(de,St%4==0||St%4==3?-1:1,St%4==0||St%4==1?-1:1,St<4?Rt:Ft,1),(0,Z.t)(_e[St],de,ae);for(let Xt=0;Xt<3;++Xt)_e[St][Xt]/=_e[St][3]}(0,W.o)(Ce,_e[0]),(0,Q.j)(ne,me,Ce),yt.camera.viewMatrix=ne;for(let St=0;St<8;++St)(0,W.m)(_e[St],_e[St],yt.camera.viewMatrix);(0,W.c)(pe,_e[0]),(0,W.c)(he,_e[0]);for(let St=1;St<8;++St)for(let Xt=0;Xt<3;++Xt)pe[Xt]=Math.min(pe[Xt],_e[St][Xt]),he[Xt]=Math.max(he[Xt],_e[St][Xt]);pe[2]-=200,he[2]+=200,yt.camera.near=-he[2],yt.camera.far=-pe[2],this.warp?this._constructTrapezoidalProjection(ot,at,yt):this._constructOrthogonalProjection(yt),(0,Q.m)(yt.lightMat,yt.camera.projectionMatrix,yt.camera.viewMatrix);const bt=this._textureSize/2;yt.camera.viewport[0]=et%2==0?0:bt,yt.camera.viewport[1]=0===Math.floor(et/2)?0:bt,yt.camera.viewport[2]=bt,yt.camera.viewport[3]=bt}_constructOrthogonalProjection(et){(0,Q.q)(et.camera.projectionMatrix,pe[0],he[0],pe[1],he[1],et.camera.near,et.camera.far)}_constructTrapezoidalProjection(et,ke,ot){const at=1/_e[0][3],yt=1/_e[4][3];(0,oe.hu)(at<yt);let wt=at+Math.sqrt(at*yt);const zt=Math.sin((0,x.ZF)(et[2]*ke[0]+et[6]*ke[1]+et[10]*ke[2]));wt/=zt,function Fe(ze,et,ke,ot,at,yt,wt,zt){(0,re.a)(xe,0,0);for(let Zt=0;Zt<4;++Zt)(0,re.b)(xe,xe,ze[Zt]);(0,re.f)(xe,xe,.25),(0,re.a)(je,0,0);for(let Zt=4;Zt<8;++Zt)(0,re.b)(je,je,ze[Zt]);(0,re.f)(je,je,.25),(0,re.l)(We[0],ze[4],ze[5],.5),(0,re.l)(We[1],ze[5],ze[6],.5),(0,re.l)(We[2],ze[6],ze[7],.5),(0,re.l)(We[3],ze[7],ze[4],.5);let Rt=0,Ft=(0,re.s)(We[0],xe);for(let Zt=1;Zt<4;++Zt){const tr=(0,re.s)(We[Zt],xe);tr<Ft&&(Ft=tr,Rt=Zt)}(0,re.g)(Ne,We[Rt],ze[Rt+4]);const bt=Ne[0];let St,Xt;Ne[0]=-Ne[1],Ne[1]=bt,(0,re.g)(we,je,xe),(0,re.h)(we,Ne)<0&&(0,re.n)(Ne,Ne),(0,re.l)(Ne,Ne,we,ke),(0,re.i)(Ne,Ne),St=Xt=(0,re.h)((0,re.g)(Oe,ze[0],xe),Ne);for(let Zt=1;Zt<8;++Zt){const tr=(0,re.h)((0,re.g)(Oe,ze[Zt],xe),Ne);tr<St?St=tr:tr>Xt&&(Xt=tr)}(0,re.c)(ot,xe),(0,re.f)(Oe,Ne,St-et),(0,re.b)(ot,ot,Oe);let Mr=-1,Cr=1,Yr=0,Lr=0;for(let Zt=0;Zt<8;++Zt){(0,re.g)($e,ze[Zt],ot),(0,re.i)($e,$e);const tr=Ne[0]*$e[1]-Ne[1]*$e[0];tr>0?tr>Mr&&(Mr=tr,Yr=Zt):tr<Cr&&(Cr=tr,Lr=Zt)}(0,oe.T)(Mr>0,"leftArea"),(0,oe.T)(Cr<0,"rightArea"),(0,re.f)(Be,Ne,St),(0,re.b)(Be,Be,xe),(0,re.f)(Se,Ne,Xt),(0,re.b)(Se,Se,xe),De[0]=-Ne[1],De[1]=Ne[0];const ct=(0,oe.ep)(ot,ze[Lr],Se,(0,re.b)(Oe,Se,De),1,at),jt=(0,oe.ep)(ot,ze[Yr],Se,Oe,1,yt),qt=(0,oe.ep)(ot,ze[Yr],Be,(0,re.b)(Oe,Be,De),1,wt),er=(0,oe.ep)(ot,ze[Lr],Be,Oe,1,zt);(0,oe.T)(ct,"rayRay"),(0,oe.T)(jt,"rayRay"),(0,oe.T)(qt,"rayRay"),(0,oe.T)(er,"rayRay")}(_e,wt,zt,ge,ye,Me,Ee,Te),function Ye(ze,et,ke,ot,at){(0,re.g)(be,ke,ot),(0,re.f)(be,be,.5),tt[0]=be[0],tt[1]=be[1],tt[2]=0,tt[3]=be[1],tt[4]=-be[0],tt[5]=0,tt[6]=be[0]*be[0]+be[1]*be[1],tt[7]=be[0]*be[1]-be[1]*be[0],tt[8]=1,tt[ve(0,2)]=-(0,re.h)(qe(tt,0),ze),tt[ve(1,2)]=-(0,re.h)(qe(tt,1),ze);let yt=(0,re.h)(qe(tt,0),ke)+tt[ve(0,2)],wt=(0,re.h)(qe(tt,1),ke)+tt[ve(1,2)],zt=(0,re.h)(qe(tt,0),ot)+tt[ve(0,2)],Rt=(0,re.h)(qe(tt,1),ot)+tt[ve(1,2)];yt=-(yt+zt)/(wt+Rt),tt[ve(0,0)]+=tt[ve(1,0)]*yt,tt[ve(0,1)]+=tt[ve(1,1)]*yt,tt[ve(0,2)]+=tt[ve(1,2)]*yt,yt=1/((0,re.h)(qe(tt,0),ke)+tt[ve(0,2)]),wt=1/((0,re.h)(qe(tt,1),ke)+tt[ve(1,2)]),tt[ve(0,0)]*=yt,tt[ve(0,1)]*=yt,tt[ve(0,2)]*=yt,tt[ve(1,0)]*=wt,tt[ve(1,1)]*=wt,tt[ve(1,2)]*=wt,tt[ve(2,0)]=tt[ve(1,0)],tt[ve(2,1)]=tt[ve(1,1)],tt[ve(2,2)]=tt[ve(1,2)],tt[ve(1,2)]+=1,yt=(0,re.h)(qe(tt,1),et)+tt[ve(1,2)],wt=(0,re.h)(qe(tt,2),et)+tt[ve(2,2)],zt=(0,re.h)(qe(tt,1),ke)+tt[ve(1,2)],Rt=(0,re.h)(qe(tt,2),ke)+tt[ve(2,2)],yt=-.5*(yt/wt+zt/Rt),tt[ve(1,0)]+=tt[ve(2,0)]*yt,tt[ve(1,1)]+=tt[ve(2,1)]*yt,tt[ve(1,2)]+=tt[ve(2,2)]*yt,yt=(0,re.h)(qe(tt,1),et)+tt[ve(1,2)],wt=(0,re.h)(qe(tt,2),et)+tt[ve(2,2)],zt=-wt/yt,tt[ve(1,0)]*=zt,tt[ve(1,1)]*=zt,tt[ve(1,2)]*=zt,at[0]=tt[0],at[1]=tt[1],at[2]=0,at[3]=tt[2],at[4]=tt[3],at[5]=tt[4],at[6]=0,at[7]=tt[5],at[8]=0,at[9]=0,at[10]=1,at[11]=0,at[12]=tt[6],at[13]=tt[7],at[14]=0,at[15]=tt[8]}(ge,ye,Ee,Te,ot.camera.projectionMatrix),ot.camera.projectionMatrix[10]=2/(pe[2]-he[2]),ot.camera.projectionMatrix[14]=-(pe[2]+he[2])/(pe[2]-he[2])}_setupMatrices(et,ke){(0,Q.m)(se,et.projectionMatrix,et.viewMatrix),(0,Q.a)(ae,se);const ot=this.viewingMode===ue.JY.Global?et.eye:(0,W.s)(Ce,0,0,1);(0,Q.n)(me,[0,0,0],[-ke[0],-ke[1],-ke[2]],ot)}_clampNearFar(et){let{near:ke,far:ot}=et;return ke<2&&(ke=2),ot<2&&(ot=2),ke>=ot&&(ke=2,ot=4),{near:ke,far:ot}}_computeCascadeDistances(et,ke){this.numCascades=Math.min(1+Math.floor((0,oe.E6)(et/ke,4)),this.maxNumCascades);const ot=(et-ke)/this.numCascades,at=(et/ke)**(1/this.numCascades);let yt=ke,wt=ke;for(let zt=0;zt<this.numCascades+1;++zt)this._cascadeDistances[zt]=(0,x.t7)(yt,wt,this.splitSchemeLambda),yt*=at,wt+=ot}get gpuMemoryUsage(){var et,ke;return this._snapshots.reduce((ot,at)=>ot+(0,X.un)(at),null!=(ke=null==(et=this._fbo)?void 0:et.gpuMemoryUsage)?ke:0)}get test(){const et=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(ke){et.splitSchemeLambda=ke},get splitSchemeLambda(){return et.splitSchemeLambda},set warp(ke){et.warp=ke},get warp(){return et.warp}}}}const ne=(0,H.c)(),se=(0,H.c)(),ae=(0,H.c)(),de=(0,ie.c)(),_e=[];for(let ze=0;ze<8;++ze)_e.push((0,ie.c)());const pe=(0,B.c)(),he=(0,B.c)(),ge=(0,J.a)(),ye=(0,J.a)(),Me=(0,J.a)(),Ee=(0,J.a)(),Te=(0,J.a)(),me=(0,H.c)(),Ce=(0,B.c)(),Ie=[],Ge=(0,H.c)(),Je=new Float32Array(64),xe=(0,J.a)(),je=(0,J.a)(),We=[(0,J.a)(),(0,J.a)(),(0,J.a)(),(0,J.a)()],Ne=(0,J.a)(),we=(0,J.a)(),Oe=(0,J.a)(),$e=(0,J.a)(),Be=(0,J.a)(),Se=(0,J.a)(),De=(0,J.a)();function ve(ze,et){return 3*et+ze}const Ke=(0,J.a)();function qe(ze,et){return(0,re.a)(Ke,ze[et],ze[et+3]),Ke}const be=(0,J.a)(),tt=(0,G.c)()},14411:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>X});var x=T(17626),A=T(14517),G=T(88159),Q=T(62208),H=T(77029),re=T(77712),Z=(T(85931),T(8314),T(90912),T(76898)),ie=T(28093),ue=T(26594),ce=T(62483),oe=T(67857),le=T(54840),Y=T(83196),j=T(38516);let X=class extends A.Z{constructor(se){super(se),this._pending=new U,this._changes=new ue.as,this._materialRenderers=new Map,this._sortedMaterialRenderers=new H.Z,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(se=>se.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return(0,G.oE)(this._materialRenderers,se=>se.rendersOccluded)}get isEmpty(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const se=(0,Y.q)(this._changes);let ae=!1,de=!1,_e=!1;return se.forEach((pe,he)=>{let ge=this._materialRenderers.get(he);if(!ge&&pe.adds.length>0&&(ge=new j.A(this.rctx,this._materialRepository,he),this._materialRenderers.set(he,ge),ae=!0,de=!0,_e=!0),!ge)return;const ye=de||ge.hasHighlights,Me=_e||ge.hasWater;ge.modify(pe),de=de||ye!==ge.hasHighlights,_e=_e||Me!==ge.hasWater,ge.isEmpty&&(this._materialRenderers.delete(he),ge.dispose(),ae=!0)}),this._changes.clear(),ae&&this._updateSortedMaterialRenderers(),de&&(this._hasHighlights=(0,G.oE)(this._materialRenderers,pe=>pe.hasHighlights)),_e&&(this._hasWater=(0,G.oE)(this._materialRenderers,pe=>pe.hasWater)),this.notifyChange("updating"),!0}addGeometries(se,ae){if(0===se.length)return;const de=this._validateRenderGeometries(se);for(const pe of de)this._geometries.set(pe.id,pe);const _e=this._pending.empty;for(const pe of de)this._pending.adds.add(pe);_e&&this.notifyChange("updating"),ae===le.$.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(se)}removeGeometries(se,ae){const de=this._pending.empty,_e=this._pending.adds;for(const pe of se)_e.has(pe)?(this._pending.removed.add(pe),_e.delete(pe)):this._pending.removed.has(pe)||this._pending.removes.add(pe),this._geometries.delete((0,Q.Wg)(pe.id));de&&!this._pending.empty&&this.notifyChange("updating"),ae===le.$.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(se)}modifyGeometries(se,ae){const de=0===this._changes.updates.length;for(const _e of se){const pe=this._changes.updates.pushNew();pe.renderGeometry=this._validateRenderGeometry(_e),pe.updateType=ae}switch(de&&this._changes.updates.length>0&&this.notifyChange("updating"),ae){case le.$.State.TRANSFORMATION:case le.$.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(se);case le.$.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(se)}}updateAnimation(se){let ae=!1;return this._sortedMaterialRenderers.forAll(({materialRenderer:de})=>ae=de.updateAnimation(se)||ae),ae}render(se,ae){for(let de=0;de<this._sortedMaterialRenderers.length;de++){const _e=this._sortedMaterialRenderers.data[de];_e.material.shouldRender(se)&&_e.materialRenderer.render(se.pass,ae)}}intersect(se,ae,de,_e,pe){return this._geometries.forEach(he=>{if(_e&&!_e(he))return;this._intersectRenderGeometry(he,de,ae,0,se,pe);const ge=this.rendererContext.longitudeCyclical;ge&&(he.boundingSphere[0]-he.boundingSphere[3]<ge.min&&this._intersectRenderGeometry(he,de,ae,ge.range,se,pe),he.boundingSphere[0]+he.boundingSphere[3]>ge.max&&this._intersectRenderGeometry(he,de,ae,-ge.range,se,pe)),pe++}),pe}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let se=0;this._materialRenderers.forEach((ae,de)=>{de.insertOrder=se++,this._sortedMaterialRenderers.push({material:de,materialRenderer:ae})}),this._sortedMaterialRenderers.sort((ae,de)=>{const _e=de.material.renderPriority-ae.material.renderPriority;return 0!==_e?_e:ae.material.insertOrder-de.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let se=0;se<this._changes.updates.length;)this._pending.has(this._changes.updates.data[se].renderGeometry)?this._changes.updates.removeUnorderedIndex(se):se++;this._pending.clear()}_intersectRenderGeometry(se,ae,de,_e,pe,he){if(!se.instanceParameters.visible)return;let ge=0;(0,Q.pC)(se.transformation)&&(_e+=se.transformation[12],ge=se.transformation[13]),$[0]=de[0]-_e,$[1]=de[1]-ge,$[2]=1,ne[0]=de[0]-_e,ne[1]=de[1]-ge,ne[2]=0,se.screenToWorldRatio=this.rendererContext.screenToWorldRatio,se.material.intersect(se,null,se.getShaderTransformation(),pe,$,ne,(ye,Me,Ee)=>{!function ee(se,ae,de,_e,pe,he,ge){const ye={layerUid:he,graphicUid:ge,triangleNr:ae},Me=Ee=>{Ee.set(oe.q7.OVERLAY,ye,se.dist,se.normal,se.transformation,de,_e)};if((null==pe.results.min.drapedLayerOrder||de>=pe.results.min.drapedLayerOrder)&&(null==pe.results.min.dist||pe.results.ground.dist<=pe.results.min.dist)&&Me(pe.results.min),pe.options.store!==oe.eC.MIN&&(null==pe.results.max.drapedLayerOrder||de<pe.results.max.drapedLayerOrder)&&(null==pe.results.max.dist||pe.results.ground.dist>pe.results.max.dist)&&Me(pe.results.max),pe.options.store===oe.eC.ALL){const Ee=(0,ce.LP)(pe.ray);Me(Ee),pe.results.all.push(Ee)}}(ae,Ee,se.material.renderPriority,he,pe,se.layerUid,se.graphicUid)},se.calculateShaderTransformation,ae)}_notifyGraphicGeometryChanged(se){if((0,Q.Wi)(this.drapeSource.notifyGraphicGeometryChanged))return;let ae;for(const de of se){const _e=de.graphicUid;(0,Q.pC)(_e)&&_e!==ae&&(this.drapeSource.notifyGraphicGeometryChanged(_e),ae=_e)}}_notifyGraphicVisibilityChanged(se){if((0,Q.Wi)(this.drapeSource.notifyGraphicVisibilityChanged))return;let ae;for(const de of se){const _e=de.graphicUid;(0,Q.pC)(_e)&&_e!==ae&&(this.drapeSource.notifyGraphicVisibilityChanged(_e),ae=_e)}}_validateRenderGeometries(se){for(const ae of se)this._validateRenderGeometry(ae);return se}_validateRenderGeometry(se){return(0,Q.Wi)(se.origin)&&(se.origin=this._localOriginFactory.getOrigin(se.boundingSphere)),se}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};(0,x._)([(0,re.Cb)()],X.prototype,"drapeSource",void 0),(0,x._)([(0,re.Cb)()],X.prototype,"updating",null),(0,x._)([(0,re.Cb)()],X.prototype,"rctx",null),(0,x._)([(0,re.Cb)()],X.prototype,"rendererContext",void 0),(0,x._)([(0,re.Cb)()],X.prototype,"_materialRepository",null),(0,x._)([(0,re.Cb)()],X.prototype,"_localOriginFactory",null),X=(0,x._)([(0,Z.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],X);class U{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(ae){return this.adds.has(ae)||this.removes.has(ae)||this.removed.has(ae)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const $=(0,ie.c)(),ne=(0,ie.c)()},64127:(dt,Re,T)=>{"use strict";T.d(Re,{JN:()=>G,P7:()=>re,RY:()=>B,YD:()=>ue,eD:()=>Z,ec:()=>W,iV:()=>J,ii:()=>ie,s3:()=>H,zV:()=>Q});var x=T(42743),A=T(67969);const G={func:A.wb.LESS},Q={func:A.wb.ALWAYS},H={mask:255},re={mask:0},J=ce=>({function:{func:A.wb.NOTEQUAL,ref:ce,mask:ce},operation:{fail:A.xS.KEEP,zFail:A.xS.KEEP,zPass:A.xS.KEEP}}),W=ce=>({function:{func:A.wb.ALWAYS,ref:ce,mask:ce},operation:{fail:A.xS.KEEP,zFail:A.xS.KEEP,zPass:A.xS.REPLACE}}),B={function:{func:A.wb.ALWAYS,ref:x.hU.OutlineVisualElementMask,mask:x.hU.OutlineVisualElementMask},operation:{fail:A.xS.KEEP,zFail:A.xS.KEEP,zPass:A.xS.ZERO}},Z={function:{func:A.wb.ALWAYS,ref:x.hU.OutlineVisualElementMask,mask:x.hU.OutlineVisualElementMask},operation:{fail:A.xS.KEEP,zFail:A.xS.KEEP,zPass:A.xS.REPLACE}},ie={function:{func:A.wb.EQUAL,ref:x.hU.OutlineVisualElementMask,mask:x.hU.OutlineVisualElementMask},operation:{fail:A.xS.KEEP,zFail:A.xS.KEEP,zPass:A.xS.KEEP}},ue={function:{func:A.wb.NOTEQUAL,ref:x.hU.OutlineVisualElementMask,mask:x.hU.OutlineVisualElementMask},operation:{fail:A.xS.KEEP,zFail:A.xS.KEEP,zPass:A.xS.KEEP}}},65542:(dt,Re,T)=>{"use strict";T.d(Re,{V:()=>W});var x=T(15861),A=T(91558),G=T(63290),Q=T(62208),H=T(23841),re=T(4794);const J=G.Z.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");class W{constructor(Z){this.definition=Z,this.key=JSON.stringify(Z),this.haloSize=Math.round(Z.halo.size),this.textStyle=this._colorToRGBA(Z.color),this.haloStyle=this._colorToRGB(Z.halo.color),this.backgroundStyle=0!==Z.background.color[3]?this._colorToRGBA(Z.background.color):null}fontString(Z){const ie=this.definition.font;return`${ie.style} ${ie.weight} ${Z}px ${ie.family}, sans-serif`}_colorToRGB(Z){return`rgb(${Z.slice(0,3).map(ie=>Math.floor(255*ie)).toString()})`}_colorToRGBA(Z){return`rgba(${Z.slice(0,3).map(ie=>Math.floor(255*ie)).toString()},${Z[3]})`}static fromSymbol(Z,ie=1){return(0,x.Z)(function*(){const ue=(0,Q.U2)(Z,"material","color"),ce=(0,Q.R2)(ue,re.Z,A.Z.toUnitRGBA),oe=(0,Q.R2)(Z.size,12,H.F2),le=Z.lineHeight,Y=(0,Q.pC)(Z.background)?A.Z.toUnitRGBA(Z.background.color):re.Z,j={family:(0,Q.R2)(Z.font,"sans-serif",ne=>ne.family),decoration:(0,Q.R2)(Z.font,"none",ne=>ne.decoration),weight:(0,Q.R2)(Z.font,"normal",ne=>ne.weight),style:(0,Q.R2)(Z.font,"normal",ne=>ne.style)},X=Z.halo,U=(0,Q.pC)(X)&&(0,Q.pC)(X.color)&&X.size>0?{size:(0,H.F2)(X.size),color:A.Z.toUnitRGBA(X.color)}:{size:0,color:re.Z},ee=new W({color:ce,size:oe,background:{color:Y,padding:(0,Q.pC)(Z.background)?[.65*oe,.5*oe]:[0,0],borderRadius:(0,Q.pC)(Z.background)?oe*(6/16):0},lineSpacingFactor:le,font:j,halo:U,pixelRatio:ie}),$=ee.fontString(oe);try{yield document.fonts.load($)}catch(ne){J.warnOnce(`Failed to preload font '${$}'. Some text symbology may be rendered using the default browser font.`)}return ee})()}}},6169:(dt,Re,T)=>{"use strict";T.d(Re,{GZ:()=>J,tV:()=>Q,vU:()=>re});var x=T(21286),A=T(62208),G=T(93605);class Q{constructor(oe,le,Y,j=2048){this.text=oe,this._alignment=le,this._parameters=Y,this.maxSize=j,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._displayWidth=null,this._heightMetrics=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${oe}`,this._lines=oe.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}get displayHeight(){return Math.ceil(this.lineSpacing*(this._lines.length-1)+this.lineHeight+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}get firstLineYOffset(){return this.backgroundTopPadding+this.haloSize}get heightMetrics(){return this._ensureHeightMetrics()}get lineSpacing(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}get lineHeight(){return this.heightMetrics.lineHeight}get linePadding(){return this.lineHeight*B}get baselinePosition(){return this.heightMetrics.baselinePosition}get renderedFontSize(){return this._toRenderUnit(this.fontSize)}get fontSize(){return this._parameters.definition.size}get renderedHaloSize(){return this._toRenderUnit(this.haloSize)}get haloSize(){return this._parameters.haloSize}get backgroundHorizontalPadding(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}get backgroundVerticalPadding(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}get backgroundTopPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}get backgroundBottomPadding(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}get hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if((0,A.Wi)(this._renderPixelRatio)){const oe=this._parameters.definition.pixelRatio;this._renderPixelRatio=this.maxSize>0?Math.min(oe,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):oe}return this._renderPixelRatio}_getLineXOffset(oe){switch(this._alignment){case re.Left:return this.backgroundHorizontalPadding;case re.Center:return(this.displayWidth-this._lineWidths[oe])/2;case re.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[oe]}}render(oe,le=0,Y=0){oe.save();const j=le/=this.renderPixelRatio,X=Y/=this.renderPixelRatio,U=this.haloSize,ee=this.firstLineYOffset;le+=U,Y+=ee+this.baselinePosition;const $=this.haloSize>0;$&&this._renderHalo(oe,j,X,U,ee),this._setFontProperties(oe,this.renderedFontSize);for(let ne=0;ne<this._lines.length;++ne){const se=this._lines[ne],ae=this._getLineXOffset(ne);$&&(oe.globalCompositeOperation="destination-out",oe.fillStyle="rgb(0, 0, 0)",this._fillText(oe,se,le+ae,Y),this._renderLineDecoration(oe,le+ae,Y,this._textWidths[ne])),oe.globalCompositeOperation="source-over",oe.fillStyle=this._parameters.textStyle,this._fillText(oe,se,le+this._getLineXOffset(ne),Y),this._renderLineDecoration(oe,le+ae,Y,this._textWidths[ne]),Y+=this.lineSpacing}if(G.Z.TEXT_SHOW_BASELINE){oe.strokeStyle=ie,oe.setLineDash([2,2]),oe.lineWidth=1;let ne=X+ee;for(let se=0;se<this._lines.length;++se){const ae=ne+this.baselinePosition;this._drawLine(oe,[j,ae],[j+this.displayWidth,ae]),ne+=this.lineSpacing}}G.Z.TEXT_SHOW_BORDER&&(oe.strokeStyle=ie,oe.setLineDash([]),oe.lineWidth=1,this._drawBox(oe,[j,X],[this.displayWidth,this.displayHeight])),this.hasBackground&&(this._roundedRect(oe,j,X,this._parameters.definition.background.borderRadius*this.renderPixelRatio),oe.globalCompositeOperation="destination-over",oe.fillStyle=this._parameters.backgroundStyle,oe.fill()),oe.restore()}_renderLineDecoration(oe,le,Y,j,X=!1){if("none"===this._parameters.definition.font.decoration||0===j)return;const ee=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":Y+=2*ee;break;case"line-through":Y-=.33*this.baselinePosition}const $=X?this.haloSize:0;oe.strokeStyle=X?this._parameters.haloStyle:this._parameters.textStyle,oe.lineWidth=this._toRenderUnit(ee+2*$),oe.beginPath(),oe.moveTo(this._toRenderUnit(le-$),this._toRenderUnit(Y)),oe.lineTo(this._toRenderUnit(le+j+$),this._toRenderUnit(Y)),oe.stroke()}_roundedRect(oe,le,Y,j){le=this._toRenderUnit(le),Y=this._toRenderUnit(Y);const X=this.renderedWidth,U=this.renderedHeight;0!==j?(j=(0,x.uZ)(j,0,Math.floor(U/2)),oe.beginPath(),oe.moveTo(le,Y+j),oe.arcTo(le,Y,le+j,Y,j),oe.lineTo(le+X-j,Y),oe.arcTo(le+X,Y,le+X,Y+j,j),oe.lineTo(le+X,Y+U-j),oe.arcTo(le+X,Y+U,le+X-j,Y+U,j),oe.lineTo(le+j,Y+U),oe.arcTo(le,Y+U,le,Y+U-j,j),oe.closePath()):oe.rect(le,Y,X,U)}_renderHalo(oe,le,Y,j,X){const U=this.renderedWidth,ee=this.renderedHeight,$=J(W,Math.max(U,Z),Math.max(ee,Z)),ne=$.getContext("2d");ne.clearRect(0,0,U,ee),this._setFontProperties(ne,this.renderedFontSize),ne.fillStyle=this._parameters.haloStyle,ne.strokeStyle=this._parameters.haloStyle;const se=this.renderedHaloSize<3;ne.lineJoin=se?"miter":"round",se?this._renderHaloEmulated(ne,j,X):this._renderHaloNative(ne,j,X);let ae=X+this.baselinePosition;for(let de=0;de<this._lines.length;++de){const _e=this._getLineXOffset(de);this._renderLineDecoration(ne,j+_e,ae,this._textWidths[de],!0),ae+=this.lineSpacing}oe.globalAlpha=this._parameters.definition.halo.color[3],oe.drawImage($,0,0,U,ee,this._toRenderUnit(le),this._toRenderUnit(Y),U,ee),oe.globalAlpha=1}_renderHaloEmulated(oe,le,Y){Y+=this.baselinePosition;for(let j=0;j<this._lines.length;++j){const X=this._lines[j],U=this._getLineXOffset(j);for(const[ee,$]of H)this._fillText(oe,X,le+U+this.haloSize*ee,Y+this.haloSize*$);Y+=this.lineSpacing}}_renderHaloNative(oe,le,Y){const j=2*this.haloSize;Y+=this.baselinePosition;for(let X=0;X<this._lines.length;++X){const U=this._lines[X],ee=this._getLineXOffset(X),$=5,ne=.1;for(let se=0;se<$;se++)oe.lineWidth=this._toRenderUnit((1-($-1)*ne+se*ne)*j),this._strokeText(oe,U,le+ee,Y);Y+=this.lineSpacing}}_setFontProperties(oe,le){oe.font=this._parameters.fontString(le),oe.textAlign="left",oe.textBaseline="alphabetic"}_ensureTextWidth(){if((0,A.pC)(this._displayWidth))return this._displayWidth;const oe=J(W,Z,Z).getContext("2d");this._setFontProperties(oe,this.fontSize);let le=2*this.haloSize;const Y=this._parameters.definition.font;"italic"!==Y.style&&"oblique"!==Y.style&&"bold"!==Y.weight&&"bolder"!==Y.weight||(le+=.3*oe.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let j=0;for(const X of this._lines){const U=oe.measureText(X).width,ee=U+le;this._textWidths.push(U),this._lineWidths.push(ee),j=Math.max(j,ee)}return this._displayWidth=j,this._displayWidth}_ensureHeightMetrics(){if((0,A.Wi)(this._heightMetrics)){const oe=J(W,Z,Z).getContext("2d");this._setFontProperties(oe,this.fontSize);const le=oe.measureText(this.text+ue),Y=this.hasBackground?oe.measureText(this._lines[0]):le,j=1===this._lines.length?Y:this.hasBackground?oe.measureText(this._lines[this._lines.length-1]):le;this._heightMetrics={paddingTop:le.actualBoundingBoxAscent-Y.actualBoundingBoxAscent,paddingBottom:le.actualBoundingBoxDescent-j.actualBoundingBoxDescent,lineHeight:le.actualBoundingBoxAscent+le.actualBoundingBoxDescent,baselinePosition:le.actualBoundingBoxAscent}}return this._heightMetrics}_toRenderUnit(oe){return oe*this.renderPixelRatio}_toRoundedRenderUnit(oe){return Math.round(oe*this.renderPixelRatio)}_fillText(oe,le,Y,j){oe.fillText(le,this._toRenderUnit(Y),this._toRenderUnit(j))}_strokeText(oe,le,Y,j){oe.strokeText(le,this._toRenderUnit(Y),this._toRenderUnit(j))}_drawLine(oe,le,Y){oe.beginPath(),oe.moveTo(this._toRoundedRenderUnit(le[0])+.5,this._toRoundedRenderUnit(le[1])+.5),oe.lineTo(this._toRoundedRenderUnit(Y[0])+.5,this._toRoundedRenderUnit(Y[1])+.5),oe.stroke()}_drawBox(oe,le,Y){const j=this._toRenderUnit(le[0]),X=this._toRenderUnit(le[1]),U=this._toRenderUnit(Y[0]),ee=this._toRenderUnit(Y[1]),$=Math.floor(j)+.5,ne=Math.ceil(j+U)-.5,se=Math.floor(X)+.5,ae=Math.ceil(X+ee)-.5;oe.beginPath(),oe.moveTo($,se),oe.lineTo(ne,se),oe.lineTo(ne,ae),oe.lineTo($,ae),oe.lineTo($,se),oe.stroke()}}const H=[];for(let oe=0;oe<360;oe+=22.5)H.push([Math.cos(Math.PI*oe/180),Math.sin(Math.PI*oe/180)]);var re,ce;function J(ce,oe,le){return ce.canvas||(ce.canvas=document.createElement("canvas")),ce.canvas.width=oe,ce.canvas.height=le,ce.canvas}(ce=re||(re={}))[ce.Left=0]="Left",ce[ce.Center=1]="Center",ce[ce.Right=2]="Right";const W={canvas:null},B=.2,Z=512,ie="rgb(255, 0, 255, 0.5)",ue=(()=>{let ce="";for(let oe=32;oe<127;oe++)ce+=String.fromCharCode(oe);return ce})()},81695:(dt,Re,T)=>{"use strict";T.d(Re,{x:()=>Oe});var x=T(15861),A=T(94573),G=T(26584),Q=T(61885),H=T(21286),re=T(62208),J=T(10699),W=T(55713),B=T(21726),Z=T(70026),ie=T(33899),ue=T(42743),ce=T(13756),oe=T(12699),le=T(24425),Y=T(63290),j=T(67969),X=T(55086);const U=Y.Z.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function se(Be){return Be.charCodeAt(0)+(Be.charCodeAt(1)<<8)+(Be.charCodeAt(2)<<16)+(Be.charCodeAt(3)<<24)}const de=se("DXT1"),_e=se("DXT3"),pe=se("DXT5");var $e,Be,xe=T(19597),je=T(2282),We=T(85775),Ne=T(26906),we=T(38210);class Oe extends oe.c{constructor(Se,De){super(),this.data=Se,this.type=le.U.Texture,this._glTexture=null,this._powerOfTwoStretchInfo=null,this._loadingPromise=null,this._loadingController=null,this.events=new Q.Z,this.params=De||{},this.params.mipmap=!1!==this.params.mipmap,this.params.noUnpackFlip=this.params.noUnpackFlip||!1,this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1,this.params.wrap=this.params.wrap||{s:j.e8.REPEAT,t:j.e8.REPEAT},this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||ue.CE.STRETCH,this.estimatedTexMemRequired=Oe._estimateTexMemRequired(this.data,this.params),this._startPreload()}_startPreload(){const Se=this.data;(0,re.Wi)(Se)||(Se instanceof HTMLVideoElement?this._startPreloadVideoElement(Se):Se instanceof HTMLImageElement&&this._startPreloadImageElement(Se))}_startPreloadVideoElement(Se){if(!((0,B.jc)(Se.src)||"auto"===Se.preload&&Se.crossOrigin)){Se.preload="auto",Se.crossOrigin="anonymous";const De=!Se.paused;if(Se.src=Se.src,De&&Se.autoplay){const Fe=()=>{Se.removeEventListener("canplay",Fe),Se.play()};Se.addEventListener("canplay",Fe)}}}_startPreloadImageElement(Se){(0,B.HK)(Se.src)||(0,B.jc)(Se.src)||Se.crossOrigin||(Se.crossOrigin="anonymous",Se.src=Se.src)}static _getDataDimensions(Se){return Se instanceof HTMLVideoElement?{width:Se.videoWidth,height:Se.videoHeight}:Se}static _estimateTexMemRequired(Se,De){if((0,re.Wi)(Se))return 0;if((0,W.eP)(Se)||(0,W.lq)(Se))return De.encoding===Oe.KTX2_ENCODING?(0,ce._h)(Se,De.mipmap):De.encoding===Oe.BASIS_ENCODING?(0,ce.$u)(Se,De.mipmap):Se.byteLength;const{width:Fe,height:ve}=Se instanceof Image||Se instanceof ImageData||Se instanceof HTMLCanvasElement||Se instanceof HTMLVideoElement?Oe._getDataDimensions(Se):De;return(De.mipmap?4/3:1)*Fe*ve*(De.components||4)||0}dispose(){this.data=void 0}get width(){return this.params.width}get height(){return this.params.height}_createDescriptor(Se){var De;return{target:j.No.TEXTURE_2D,pixelFormat:j.VI.RGBA,dataType:j.Br.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?j.cw.LINEAR_MIPMAP_LINEAR:j.cw.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(De=this.params.maxAnisotropy)?De:this.params.mipmap?Se.parameters.maxMaxAnisotropy:1}}get glTexture(){return this._glTexture}load(Se,De){if((0,re.pC)(this._glTexture))return this._glTexture;if((0,re.pC)(this._loadingPromise))return this._loadingPromise;const Fe=this.data;return(0,re.Wi)(Fe)?(this._glTexture=new X.x(Se,this._createDescriptor(Se),null),this._glTexture):"string"==typeof Fe?this._loadFromURL(Se,De,Fe):Fe instanceof Image?this._loadFromImageElement(Se,De,Fe):Fe instanceof HTMLVideoElement?this._loadFromVideoElement(Se,De,Fe):Fe instanceof ImageData||Fe instanceof HTMLCanvasElement?this._loadFromImage(Se,Fe,De):((0,W.eP)(Fe)||(0,W.lq)(Fe))&&this.params.encoding===Oe.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(Se,Fe)):((0,W.eP)(Fe)||(0,W.lq)(Fe))&&this.params.encoding===Oe.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(Se,Fe)):((0,W.eP)(Fe)||(0,W.lq)(Fe))&&this.params.encoding===Oe.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(Se,Fe)):(0,W.lq)(Fe)?this._loadFromPixelData(Se,Fe):(0,W.eP)(Fe)?this._loadFromPixelData(Se,new Uint8Array(Fe)):null}get requiresFrameUpdates(){return this.data instanceof HTMLVideoElement}frameUpdate(Se,De,Fe){if(!(this.data instanceof HTMLVideoElement)||(0,re.Wi)(this._glTexture)||this.data.readyState<$e.HAVE_CURRENT_DATA||Fe===this.data.currentTime)return Fe;if((0,re.pC)(this._powerOfTwoStretchInfo)){const{framebuffer:ve,vao:Ke,sourceTexture:qe}=this._powerOfTwoStretchInfo;qe.setData(this.data),this._drawStretchedTexture(Se,De,ve,Ke,qe,this._glTexture)}else{const{videoWidth:ve,videoHeight:Ke}=this.data,{width:qe,height:be}=this._glTexture.descriptor;ve!==qe||Ke!==be?this._glTexture.updateData(0,0,0,Math.min(ve,qe),Math.min(Ke,be),this.data):this._glTexture.setData(this.data)}return this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.params.updateCallback&&this.params.updateCallback(),this.data.currentTime}_loadFromDDSData(Se,De){return this._glTexture=function Ge(Be,Se,De){const{textureData:Fe,internalFormat:ve,width:Ke,height:qe}=function Je(Be,Se){const De=new Int32Array(Be,0,31);if(542327876!==De[0])return U.error("Invalid magic number in DDS header"),null;if(!(4&De[20]))return U.error("Unsupported format, must contain a FourCC code"),null;const Fe=De[21];let ve,Ke;switch(Fe){case de:ve=8,Ke=j.q_.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case _e:ve=16,Ke=j.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case pe:ve=16,Ke=j.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return U.error("Unsupported FourCC code:",function ae(Be){return String.fromCharCode(255&Be,Be>>8&255,Be>>16&255,Be>>24&255)}(Fe)),null}let qe=1,be=De[4],tt=De[3];0==(3&be)&&0==(3&tt)||(U.warn("Rounding up compressed texture size to nearest multiple of 4."),be=be+3&-4,tt=tt+3&-4);const Ye=be,ze=tt;let et,ke;131072&De[2]&&!1!==Se&&(qe=Math.max(1,De[7])),1===qe||(0,H.wt)(be)&&(0,H.wt)(tt)||(U.warn("Ignoring mipmaps of non power of two sized compressed texture."),qe=1);let ot=De[1]+4;const at=[];for(let yt=0;yt<qe;++yt)ke=(be+3>>2)*(tt+3>>2)*ve,et=new Uint8Array(Be,ot,ke),at.push(et),ot+=ke,be=Math.max(1,be>>1),tt=Math.max(1,tt>>1);return{textureData:{type:"compressed",levels:at},internalFormat:Ke,width:Ye,height:ze}}(De,Se.hasMipmap);return Se.samplingMode=Fe.levels.length>1?j.cw.LINEAR_MIPMAP_LINEAR:j.cw.LINEAR,Se.hasMipmap=Fe.levels.length>1,Se.internalFormat=ve,Se.width=Ke,Se.height=qe,new X.x(Be,Se,Fe)}(Se,this._createDescriptor(Se),De),this._glTexture}_loadFromKTX2(Se,De){return this._loadAsync(()=>(0,ce.pk)(Se,this._createDescriptor(Se),De).then(Fe=>(this._glTexture=Fe,Fe)))}_loadFromBasis(Se,De){return this._loadAsync(()=>(0,ce.fX)(Se,this._createDescriptor(Se),De).then(Fe=>(this._glTexture=Fe,Fe)))}_loadFromPixelData(Se,De){(0,je.hu)(this.params.width>0&&this.params.height>0);const Fe=this._createDescriptor(Se);return Fe.pixelFormat=1===this.params.components?j.VI.LUMINANCE:3===this.params.components?j.VI.RGB:j.VI.RGBA,Fe.width=this.params.width,Fe.height=this.params.height,this._glTexture=new X.x(Se,Fe,De),this._glTexture}_loadFromURL(Se,De,Fe){var ve=this;return this._loadAsync(function(){var Ke=(0,x.Z)(function*(qe){const be=yield(0,Z.t)(Fe,{signal:qe});return(0,J.k_)(qe),ve._loadFromImage(Se,be,De)});return function(qe){return Ke.apply(this,arguments)}}())}_loadFromImageElement(Se,De,Fe){var ve=this;return Fe.complete?this._loadFromImage(Se,Fe,De):this._loadAsync(function(){var Ke=(0,x.Z)(function*(qe){const be=yield(0,ie.fY)(Fe,Fe.src,!1,qe);return(0,J.k_)(qe),ve._loadFromImage(Se,be,De)});return function(qe){return Ke.apply(this,arguments)}}())}_loadFromVideoElement(Se,De,Fe){return Fe.readyState>=$e.HAVE_CURRENT_DATA?this._loadFromImage(Se,Fe,De):this._loadFromVideoElementAsync(Se,De,Fe)}_loadFromVideoElementAsync(Se,De,Fe){return this._loadAsync(ve=>new Promise((Ke,qe)=>{const be=()=>{Fe.removeEventListener("loadeddata",tt),Fe.removeEventListener("error",Ye),(0,re.hw)(ze)},tt=()=>{Fe.readyState>=$e.HAVE_CURRENT_DATA&&(be(),Ke(this._loadFromImage(Se,Fe,De)))},Ye=et=>{be(),qe(et||new G.Z("Failed to load video"))};Fe.addEventListener("loadeddata",tt),Fe.addEventListener("error",Ye);const ze=(0,J.fu)(ve,()=>Ye((0,J.zE)()))}))}_loadFromImage(Se,De,Fe){const ve=Oe._getDataDimensions(De);this.params.width=ve.width,this.params.height=ve.height;const Ke=this._createDescriptor(Se);return Ke.pixelFormat=3===this.params.components?j.VI.RGB:j.VI.RGBA,!this._requiresPowerOfTwo(Se,Ke)||(0,H.wt)(ve.width)&&(0,H.wt)(ve.height)?(Ke.width=ve.width,Ke.height=ve.height,this._glTexture=new X.x(Se,Ke,De),this._glTexture):(this._glTexture=this._makePowerOfTwoTexture(Se,De,ve,Ke,Fe),this._glTexture)}_loadAsync(Se){const De=new AbortController;this._loadingController=De;const Fe=Se(De.signal);this._loadingPromise=Fe;const ve=()=>{this._loadingController===De&&(this._loadingController=null),this._loadingPromise===Fe&&(this._loadingPromise=null)};return Fe.then(ve,ve),Fe}_requiresPowerOfTwo(Se,De){const Fe=j.e8.CLAMP_TO_EDGE,ve="number"==typeof De.wrapMode?De.wrapMode===Fe:De.wrapMode.s===Fe&&De.wrapMode.t===Fe;return!(0,we.Z)(Se.gl)&&(De.hasMipmap||!ve)}_makePowerOfTwoTexture(Se,De,Fe,ve,Ke){const{width:qe,height:be}=Fe,tt=(0,H.Sf)(qe),Ye=(0,H.Sf)(be);let ze;switch(ve.width=tt,ve.height=Ye,this.params.powerOfTwoResizeMode){case ue.CE.PAD:ve.textureCoordinateScaleFactor=[qe/tt,be/Ye],ze=new X.x(Se,ve),ze.updateData(0,0,0,qe,be,De);break;case ue.CE.STRETCH:case null:case void 0:ze=this._stretchToPowerOfTwo(Se,De,ve,Ke());break;default:(0,A.Bg)(this.params.powerOfTwoResizeMode)}return ve.hasMipmap&&ze.generateMipmap(),ze}_stretchToPowerOfTwo(Se,De,Fe,ve){const Ke=new X.x(Se,Fe),qe=new We.X(Se,{colorTarget:j.Lm.TEXTURE,depthStencilTarget:j.OU.NONE},Ke),be=new X.x(Se,{target:j.No.TEXTURE_2D,pixelFormat:Fe.pixelFormat,dataType:j.Br.UNSIGNED_BYTE,wrapMode:j.e8.CLAMP_TO_EDGE,samplingMode:j.cw.LINEAR,flipped:!!Fe.flipped,maxAnisotropy:8,preMultiplyAlpha:Fe.preMultiplyAlpha},De),tt=(0,xe.ow)(Se),Ye=Se.getBoundFramebufferObject();return this._drawStretchedTexture(Se,ve,qe,tt,be,Ke),this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:tt,sourceTexture:be,framebuffer:qe}:(tt.dispose(!0),be.dispose(),qe.detachColorTexture(),qe.dispose()),Se.bindFramebuffer(Ye),Ke}_drawStretchedTexture(Se,De,Fe,ve,Ke,qe){Se.bindFramebuffer(Fe);const be=Se.getViewport();Se.setViewport(0,0,qe.descriptor.width,qe.descriptor.height);const tt=Se.bindTechnique(De);tt.setUniform4f("uColor",1,1,1,1),tt.bindTexture("tex",Ke),Se.bindVAO(ve),Se.drawArrays(j.MX.TRIANGLE_STRIP,0,(0,Ne._V)(ve,"geometry")),Se.bindFramebuffer(null),Se.setViewport(be.x,be.y,be.width,be.height)}unload(){if((0,re.pC)(this._powerOfTwoStretchInfo)){const{framebuffer:Se,vao:De,sourceTexture:Fe}=this._powerOfTwoStretchInfo;De.dispose(!0),Fe.dispose(),Se.dispose(),this._glTexture=null,this._powerOfTwoStretchInfo=null}if((0,re.pC)(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null),(0,re.pC)(this._loadingController)){const Se=this._loadingController;this._loadingController=null,this._loadingPromise=null,Se.abort()}this.events.emit("unloaded")}}Oe.DDS_ENCODING="image/vnd-ms.dds",Oe.KTX2_ENCODING="image/ktx2",Oe.BASIS_ENCODING="image/x.basis",(Be=$e||($e={}))[Be.HAVE_NOTHING=0]="HAVE_NOTHING",Be[Be.HAVE_METADATA=1]="HAVE_METADATA",Be[Be.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",Be[Be.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",Be[Be.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"},80855:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>W});var x=T(98361),A=T(651),G=T(91056),Q=T(39114),H=T(12407),re=T(67969),J=T(2078);class W extends G.A{initializeProgram(Z){const ie=W.shader.get().build();return new H.$(Z.rctx,ie,Q.i)}initializePipeline(){return(0,J.sm)(this.configuration.hasAlpha?{blending:(0,J.wK)(re.zi.SRC_ALPHA,re.zi.ONE,re.zi.ONE_MINUS_SRC_ALPHA,re.zi.ONE_MINUS_SRC_ALPHA),colorWrite:J.BK}:{colorWrite:J.BK})}}W.shader=new A.J(x.T,()=>T.e(6859).then(T.bind(T,98101)))},97825:(dt,Re,T)=>{"use strict";T.d(Re,{V:()=>G});var x=T(17626),A=T(87601);class G extends A.m{constructor(){super(...arguments),this.hasAlpha=!1}}(0,x._)([(0,A.o)()],G.prototype,"hasAlpha",void 0)},2282:(dt,Re,T)=>{"use strict";T.d(Re,{E6:()=>ie,Kj:()=>oe,RQ:()=>j,T:()=>J,ep:()=>B,hu:()=>re,iV:()=>Z,kG:()=>ce,tM:()=>Y,u_:()=>ue,yK:()=>W,zF:()=>le});var x=T(99770),A=T(993);const Q=(0,T(4794).c)();class H{constructor(U){this.message=U}toString(){return`AssertException: ${this.message}`}}function re(X,U){if(!X)throw U=U||"assert",console.log(new Error(U).stack),new H(U)}function J(X,U){X||(U=U||"",console.warn("Verify failed: "+U+"\n"+new Error("verify").stack))}function W(X,U,ee,$){let ne,se=(ee[0]-X[0])/U[0],ae=($[0]-X[0])/U[0];se>ae&&(ne=se,se=ae,ae=ne);let de=(ee[1]-X[1])/U[1],_e=($[1]-X[1])/U[1];if(de>_e&&(ne=de,de=_e,_e=ne),se>_e||de>ae)return!1;de>se&&(se=de),_e<ae&&(ae=_e);let pe=(ee[2]-X[2])/U[2],he=($[2]-X[2])/U[2];return pe>he&&(ne=pe,pe=he,he=ne),!(se>he||pe>ae||(he<ae&&(ae=he),ae<0))}function B(X,U,ee,$,ne,se=(0,x.a)()){const ae=($[ne]-ee[ne])*(U[0]-X[0])-($[0]-ee[0])*(U[ne]-X[ne]);if(0===ae)return!1;const _e=(($[0]-ee[0])*(X[ne]-ee[ne])-($[ne]-ee[ne])*(X[0]-ee[0]))/ae;return se[0]=X[0]+_e*(U[0]-X[0]),se[1]=X[ne]+_e*(U[ne]-X[ne]),!0}function Z(X,U,ee,$,ne){ne||(ne=X),Q[0]=X[0],Q[1]=X[1],Q[2]=X[2],Q[3]=1,(0,A.t)(Q,Q,U),ne.length>2&&(ne[2]=-Q[2]),(0,A.t)(Q,Q,ee),re(0!==Q[3]),ne[0]=Q[0]/Q[3],ne[1]=Q[1]/Q[3],ne[2]=Q[2]/Q[3],ne[0]=(.5*ne[0]+.5)*$[2]+$[0],ne[1]=(.5*ne[1]+.5)*$[3]+$[1]}function ie(X,U){return Math.log(X)/Math.log(U)}function ue(X,U,ee,$){X[12]=U,X[13]=ee,X[14]=$}function ce(X){return 1===X[0]&&0===X[1]&&0===X[2]&&0===X[3]&&0===X[4]&&1===X[5]&&0===X[6]&&0===X[7]&&0===X[8]&&0===X[9]&&1===X[10]&&0===X[11]&&1===X[15]}function oe(X,U,ee){return 2*Math.atan(Math.sqrt(U*U+ee*ee)*Math.tan(.5*X)/U)}function le(X,U,ee){return 2*Math.atan(Math.sqrt(U*U+ee*ee)*Math.tan(.5*X)/ee)}function Y(X,U,ee){return 2*Math.atan(U*Math.tan(.5*X)/Math.sqrt(U*U+ee*ee))}function j(X,U,ee){return 2*Math.atan(ee*Math.tan(.5*X)/Math.sqrt(U*U+ee*ee))}},16396:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{T:()=>x}),(A=x||(x={})).POSITION="position",A.NORMAL="normal",A.UV0="uv0",A.AUXPOS1="auxpos1",A.AUXPOS2="auxpos2",A.MAPPOS="mapPos",A.COLOR="color",A.SYMBOLCOLOR="symbolColor",A.SIZE="size",A.TANGENT="tangent",A.OFFSET="offset",A.SUBDIVISIONFACTOR="subdivisionFactor",A.COLORFEATUREATTRIBUTE="colorFeatureAttribute",A.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",A.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",A.DISTANCETOSTART="distanceToStart",A.UVMAPSPACE="uvMapSpace",A.BOUNDINGRECT="boundingRect",A.UVREGION="uvRegion",A.NORMALCOMPRESSED="normalCompressed",A.PROFILERIGHT="profileRight",A.PROFILEUP="profileUp",A.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",A.FEATUREVALUE="featureValue",A.MODELORIGINHI="modelOriginHi",A.MODELORIGINLO="modelOriginLo",A.MODEL="model",A.MODELNORMAL="modelNormal",A.INSTANCECOLOR="instanceColor",A.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",A.LOCALTRANSFORM="localTransform",A.GLOBALTRANSFORM="globalTransform",A.BOUNDINGSPHERE="boundingSphere",A.MODELORIGIN="modelOrigin",A.MODELSCALEFACTORS="modelScaleFactors",A.FEATUREATTRIBUTE="featureAttribute",A.STATE="state",A.LODLEVEL="lodLevel",A.POSITION0="position0",A.POSITION1="position1",A.NORMALA="normalA",A.NORMALB="normalB",A.COMPONENTINDEX="componentIndex",A.VARIANTOFFSET="variantOffset",A.VARIANTSTROKE="variantStroke",A.VARIANTEXTENSION="variantExtension",A.U8PADDING="u8padding",A.U16PADDING="u16padding",A.SIDENESS="sideness",A.START="start",A.END="end",A.UP="up",A.EXTRUDE="extrude"},34103:(dt,Re,T)=>{"use strict";T.d(Re,{F:()=>Z,e:()=>ie});var x=T(61885),A=T(72392),G=T(62208),Q=T(77029),H=T(42743),re=T(12699),J=T(24425);const W=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","vertexAttrsUpdated"];var B=T(82274);class Z extends re.c{constructor(ce,oe=""){var le,Y,j;super(),this.apiLayerUid=oe,this.type=J.U.Layer,this.events=new x.Z,this.isSliceable=!1,this._objects=new Q.Z,this._stageHandles=new A.Z,this.apiLayerUid=oe,this.isVisible=null==(le=null==ce?void 0:ce.isVisible)||le,this.isPickable=null==(Y=null==ce?void 0:ce.isPickable)||Y,this.updatePolicy=null!=(j=null==ce?void 0:ce.updatePolicy)?j:H.jq.ASYNC}get objects(){return this._objects}destroy(){this.detachStage(),this._stage=null}attachStage(ce){this.detachStage(),this._stage=ce;for(const oe of W)this._stageHandles.add(this.events.on(oe,le=>ce.handleEvent(oe,le)))}detachStage(){this._stageHandles.removeAll(),this.invalidateSpatialQueryAccelerator()}add(ce){this._objects.push(ce),ce.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:ce}),(0,G.pC)(this._octree)&&this._octree.add([ce])}remove(ce){this._objects.removeUnordered(ce)&&(ce.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:ce}),(0,G.pC)(this._octree)&&this._octree.remove([ce]))}addMany(ce){this._objects.pushArray(ce);for(const oe of ce)oe.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:ce}),(0,G.pC)(this._octree)&&this._octree.add(ce)}removeMany(ce){const oe=new Array;if(this._objects.removeUnorderedMany(ce,ce.length,oe),0!==oe.length){for(const le of oe)le.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:oe}),(0,G.pC)(this._octree)&&this._octree.remove(oe)}}sync(){(0,G.pC)(this._stage)&&this.updatePolicy!==H.jq.SYNC&&this._stage.syncLayer(this.id)}notifyObjectBBChanged(ce,oe){(0,G.pC)(this._octree)&&this._octree.update(ce,oe)}getSpatialQueryAccelerator(){return(0,G.Wi)(this._octree)&&this._objects.length>50&&this._createOctree(),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=(0,G.SC)(this._octree)}_createOctree(){this._octree=new B.Z(ce=>ce.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)}}function ie(ue){return(0,G.pC)(ue)&&ue.type===J.U.Layer}},42743:(dt,Re,T)=>{"use strict";var x,A,G,Q,H,re,J,W,B,Z,ie,ue,ce,oe,le;T.d(Re,{Am:()=>Q,CE:()=>ie,C_:()=>G,Gv:()=>A,Iq:()=>oe,JJ:()=>ce,MX:()=>Z,Rw:()=>re,V_:()=>B,Vr:()=>x,Xx:()=>H,Yg:()=>ue,hU:()=>J,jq:()=>W}),(le=x||(x={}))[le.None=0]="None",le[le.Front=1]="Front",le[le.Back=2]="Back",le[le.COUNT=3]="COUNT",function(le){le[le.Less=0]="Less",le[le.Lequal=1]="Lequal",le[le.COUNT=2]="COUNT"}(A||(A={})),function(le){le[le.NONE=0]="NONE",le[le.SMAA=1]="SMAA"}(G||(G={})),function(le){le[le.Color=0]="Color",le[le.Alpha=1]="Alpha",le[le.FrontFace=2]="FrontFace",le[le.NONE=3]="NONE",le[le.COUNT=4]="COUNT"}(Q||(Q={})),function(le){le[le.BACKGROUND=0]="BACKGROUND",le[le.UPDATE=1]="UPDATE"}(H||(H={})),function(le){le[le.NOT_LOADED=0]="NOT_LOADED",le[le.LOADING=1]="LOADING",le[le.LOADED=2]="LOADED"}(re||(re={})),function(le){le[le.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",le[le.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(J||(J={})),function(le){le[le.ASYNC=0]="ASYNC",le[le.SYNC=1]="SYNC"}(W||(W={})),function(le){le[le.Highlight=0]="Highlight",le[le.MaskOccludee=1]="MaskOccludee",le[le.COUNT=2]="COUNT"}(B||(B={})),function(le){le[le.Triangle=0]="Triangle",le[le.Point=1]="Point",le[le.Line=2]="Line"}(Z||(Z={})),function(le){le[le.STRETCH=1]="STRETCH",le[le.PAD=2]="PAD"}(ie||(ie={})),function(le){le[le.CHANGED=0]="CHANGED",le[le.UNCHANGED=1]="UNCHANGED"}(ue||(ue={})),function(le){le[le.Blend=0]="Blend",le[le.Opaque=1]="Opaque",le[le.Mask=2]="Mask",le[le.MaskBlend=3]="MaskBlend",le[le.COUNT=4]="COUNT"}(ce||(ce={})),function(le){le[le.OFF=0]="OFF",le[le.ON=1]="ON"}(oe||(oe={}))},51445:(dt,Re,T)=>{"use strict";T.r(Re),T.d(Re,{EdgeProcessingWorker:()=>Z,default:()=>ae,extract:()=>ie,extractComponentsEdgeLocationsLayout:()=>se,extractEdgeLocationsLayout:()=>ne});var x=T(15861),A=T(13757);function G(de,_e,pe){const he=_e/3,ge=new Uint32Array(pe+1),ye=new Uint32Array(pe+1),Me=(Ne,we)=>{Ne<we?ge[Ne+1]++:ye[we+1]++};for(let Ne=0;Ne<he;Ne++){const we=de[3*Ne],Oe=de[3*Ne+1],$e=de[3*Ne+2];Me(we,Oe),Me(Oe,$e),Me($e,we)}let Ee=0,Te=0;for(let Ne=0;Ne<pe;Ne++){const we=ge[Ne+1],Oe=ye[Ne+1];ge[Ne+1]=Ee,ye[Ne+1]=Te,Ee+=we,Te+=Oe}const me=new Uint32Array(6*he),Ce=ge[pe],Ie=(Ne,we,Oe)=>{if(Ne<we){const $e=ge[Ne+1]++;me[2*$e]=we,me[2*$e+1]=Oe}else{const $e=ye[we+1]++;me[2*Ce+2*$e]=Ne,me[2*Ce+2*$e+1]=Oe}};for(let Ne=0;Ne<he;Ne++){const we=de[3*Ne],Oe=de[3*Ne+1],$e=de[3*Ne+2];Ie(we,Oe,Ne),Ie(Oe,$e,Ne),Ie($e,we,Ne)}const Ge=(Ne,we)=>{const Oe=2*Ne,$e=we-Ne;for(let Be=1;Be<$e;Be++){const Se=me[Oe+2*Be],De=me[Oe+2*Be+1];let Fe=Be-1;for(;Fe>=0&&me[Oe+2*Fe]>Se;Fe--)me[Oe+2*Fe+2]=me[Oe+2*Fe],me[Oe+2*Fe+3]=me[Oe+2*Fe+1];me[Oe+2*Fe+2]=Se,me[Oe+2*Fe+3]=De}};for(let Ne=0;Ne<pe;Ne++)Ge(ge[Ne],ge[Ne+1]),Ge(Ce+ye[Ne],Ce+ye[Ne+1]);const Je=new Int32Array(3*he),xe=(Ne,we)=>Ne===de[3*we]?0:Ne===de[3*we+1]?1:Ne===de[3*we+2]?2:-1,je=(Ne,we)=>{const Oe=xe(Ne,we);Je[3*we+Oe]=-1},We=(Ne,we,Oe,$e)=>{const Be=xe(Ne,we);Je[3*we+Be]=$e;const Se=xe(Oe,$e);Je[3*$e+Se]=we};for(let Ne=0;Ne<pe;Ne++){let we=ge[Ne];const Oe=ge[Ne+1];let $e=ye[Ne];const Be=ye[Ne+1];for(;we<Oe&&$e<Be;){const Se=me[2*we],De=me[2*Ce+2*$e];Se===De?(We(Ne,me[2*we+1],De,me[2*Ce+2*$e+1]),we++,$e++):Se<De?(je(Ne,me[2*we+1]),we++):(je(De,me[2*Ce+2*$e+1]),$e++)}for(;we<Oe;)je(Ne,me[2*we+1]),we++;for(;$e<Be;)je(me[2*Ce+2*$e],me[2*Ce+2*$e+1]),$e++}return Je}var Q=T(19625),H=T(2975),re=T(16396),J=T(7184),W=T(89917),B=T(25558);class Z{extract(_e){return(0,x.Z)(function*(){const pe=ue(_e),he=ie(pe),ge=[pe.data.buffer];return{result:ce(he,ge),transferList:ge}})()}extractComponentsEdgeLocations(_e){return(0,x.Z)(function*(){const pe=ue(_e),he=oe(pe.data,pe.skipDeduplicate,pe.indices,pe.indicesLength),ge=(0,B.n)(he,ee,$),ye=[];return{result:(0,H.HL)(ge.regular.instancesData,ye),transferList:ye}})()}extractEdgeLocations(_e){return(0,x.Z)(function*(){const pe=ue(_e),he=oe(pe.data,pe.skipDeduplicate,pe.indices,pe.indicesLength),ge=(0,B.n)(he,U,$),ye=[];return{result:(0,H.HL)(ge.regular.instancesData,ye),transferList:ye}})()}}function ie(de){const _e=oe(de.data,de.skipDeduplicate,de.indices,de.indicesLength);return le.updateSettings(de.writerSettings),Y.updateSettings(de.writerSettings),(0,B.n)(_e,le,Y)}function ue(de){return{data:J.tf.createView(de.dataBuffer),indices:"Uint32Array"===de.indicesType?new Uint32Array(de.indicesBuffer):"Uint16Array"===de.indicesType?new Uint16Array(de.indicesBuffer):void 0,indicesLength:de.indicesLength,writerSettings:de.writerSettings,skipDeduplicate:de.skipDeduplicate}}function ce(de,_e){return _e.push(de.regular.lodInfo.lengths.buffer),_e.push(de.silhouette.lodInfo.lengths.buffer),{regular:{instancesData:(0,H.HL)(de.regular.instancesData,_e),lodInfo:{lengths:de.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:(0,H.HL)(de.silhouette.instancesData,_e),lodInfo:{lengths:de.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:de.averageEdgeLength}}function oe(de,_e,pe,he){if(_e)return{faces:pe,facesLength:he,neighbors:G(pe,he,de.count),vertices:de};const ge=(0,A.d)(de.buffer,de.stride/4,{originalIndices:pe,originalIndicesLength:he}),ye=G(ge.indices,he,ge.uniqueCount);return{faces:ge.indices,facesLength:ge.indices.length,neighbors:ye,vertices:J.tf.createView(ge.buffer)}}const le=new W.D9,Y=new W.qE,U=new class j{allocate(_e){return ne.createBuffer(_e)}trim(_e,pe){return _e.slice(0,pe)}write(_e,pe,he){_e.position0.setVec(pe,he.position0),_e.position1.setVec(pe,he.position1)}},ee=new class X{allocate(_e){return se.createBuffer(_e)}trim(_e,pe){return _e.slice(0,pe)}write(_e,pe,he){_e.position0.setVec(pe,he.position0),_e.position1.setVec(pe,he.position1),_e.componentIndex.set(pe,he.componentIndex)}},$={allocate:()=>null,write:()=>{},trim:()=>null},ne=(0,Q.U$)().vec3f(re.T.POSITION0).vec3f(re.T.POSITION1),se=(0,Q.U$)().vec3f(re.T.POSITION0).vec3f(re.T.POSITION1).u16(re.T.COMPONENTINDEX).u16(re.T.U16PADDING,{glPadding:!0});function ae(){return new Z}},94033:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>re});var x=T(15861),A=T(55713),G=T(42930),Q=T(2975),H=T(51445);class re extends G.q{constructor(W){super("EdgeProcessingWorker","extract",{extract:B=>[B.dataBuffer],extractComponentsEdgeLocations:B=>[B.dataBuffer],extractEdgeLocations:B=>[B.dataBuffer]},W)}process(W,B,Z){var ie=this;return(0,x.Z)(function*(){if(Z)return(0,H.extract)(W);const ue=ie._packInput(W),ce=yield ie.invoke(ue,B);return ie._unpackOutput(ce)})()}extractEdgeLocations(W,B){var Z=this;return(0,x.Z)(function*(){const ie=Z._packInput(W),ue=yield Z.invokeMethod("extractEdgeLocations",ie,B);return(0,Q.aj)(ue)})()}extractComponentsEdgeLocations(W,B){var Z=this;return(0,x.Z)(function*(){const ie=Z._packInput(W),ue=yield Z.invokeMethod("extractComponentsEdgeLocations",ie,B);return(0,Q.aj)(ue)})()}_packInput(W){return{dataBuffer:W.data.buffer,writerSettings:W.writerSettings,skipDeduplicate:W.skipDeduplicate,indicesBuffer:W.indices.buffer,indicesType:(0,A.ZY)(W.indices)?"Uint32Array":"Uint16Array",indicesLength:W.indicesLength}}_unpackOutput(W){return{regular:{instancesData:(0,Q.aj)(W.regular.instancesData),lodInfo:{lengths:new Float32Array(W.regular.lodInfo.lengths)}},silhouette:{instancesData:(0,Q.aj)(W.silhouette.instancesData),lodInfo:{lengths:new Float32Array(W.silhouette.lodInfo.lengths)}},averageEdgeLength:W.averageEdgeLength}}}},7184:(dt,Re,T)=>{"use strict";T.d(Re,{Hr:()=>B,dG:()=>W,dx:()=>re,rD:()=>H,so:()=>Z,tf:()=>Q});var x=T(4511),A=T(19625),G=T(16396);const Q=(0,A.U$)().vec3f(G.T.POSITION).u16(G.T.COMPONENTINDEX).u16(G.T.U16PADDING),H=(0,A.U$)().vec2u8(G.T.SIDENESS),re=(0,x.K)(H),J=(0,A.U$)().vec3f(G.T.POSITION0).vec3f(G.T.POSITION1).u16(G.T.COMPONENTINDEX).u8(G.T.VARIANTOFFSET,{glNormalized:!0}).u8(G.T.VARIANTSTROKE).u8(G.T.VARIANTEXTENSION,{glNormalized:!0}).u8(G.T.U8PADDING,{glPadding:!0}).u16(G.T.U16PADDING,{glPadding:!0}),W=J.clone().vec3f(G.T.NORMAL),B=J.clone().vec3f(G.T.NORMALA).vec3f(G.T.NORMALB),Z=new Map([[G.T.POSITION0,0],[G.T.POSITION1,1],[G.T.COMPONENTINDEX,2],[G.T.VARIANTOFFSET,3],[G.T.VARIANTSTROKE,4],[G.T.VARIANTEXTENSION,5],[G.T.NORMAL,6],[G.T.NORMALA,6],[G.T.NORMALB,7],[G.T.SIDENESS,8]])},89917:(dt,Re,T)=>{"use strict";T.d(Re,{D9:()=>le,qE:()=>Y});var x=T(4619),A=T(84161),G=T(28093),Q=T(4511),H=T(7184);class re{updateSettings(ee){this.settings=ee,this.edgeHashFunction=ee.reducedPrecision?ie:Z}write(ee,$,ne){const se=this.edgeHashFunction(ne);X.seed=se;const ae=X.getIntRange(0,255),de=X.getIntRange(0,this.settings.variants-1),pe=X.getFloat(),he=255*(.5*function oe(U,ee){const $=U<0?-1:1;return Math.abs(U)**ee*$}(-(1-Math.min(pe/.7,1))+Math.max(0,pe-.7)/(1-.7),1.2)+.5);ee.position0.setVec($,ne.position0),ee.position1.setVec($,ne.position1),ee.componentIndex.set($,ne.componentIndex),ee.variantOffset.set($,ae),ee.variantStroke.set($,de),ee.variantExtension.set($,he)}trim(ee,$){return ee.slice(0,$)}}const J=new Float32Array(6),W=new Uint32Array(J.buffer),B=new Uint32Array(1);function Z(U){const ee=J;ee[0]=U.position0[0],ee[1]=U.position0[1],ee[2]=U.position0[2],ee[3]=U.position1[0],ee[4]=U.position1[1],ee[5]=U.position1[2],B[0]=5381;for(let $=0;$<W.length;$++)B[0]=31*B[0]+W[$];return B[0]}function ie(U){const ee=J;ee[0]=ce(U.position0[0]),ee[1]=ce(U.position0[1]),ee[2]=ce(U.position0[2]),ee[3]=ce(U.position1[0]),ee[4]=ce(U.position1[1]),ee[5]=ce(U.position1[2]),B[0]=5381;for(let $=0;$<W.length;$++)B[0]=31*B[0]+W[$];return B[0]}function ce(U){return Math.round(1e4*U)/1e4}class le{constructor(){this.commonWriter=new re}updateSettings(ee){this.commonWriter.updateSettings(ee)}allocate(ee){return H.dG.createBuffer(ee)}write(ee,$,ne){this.commonWriter.write(ee,$,ne),(0,A.a)(j,ne.faceNormal0,ne.faceNormal1),(0,A.n)(j,j),ee.normal.setVec($,j)}trim(ee,$){return this.commonWriter.trim(ee,$)}}le.Layout=H.dG,le.glLayout=(0,Q.K)(H.dG,1);class Y{constructor(){this.commonWriter=new re}updateSettings(ee){this.commonWriter.updateSettings(ee)}allocate(ee){return H.Hr.createBuffer(ee)}write(ee,$,ne){this.commonWriter.write(ee,$,ne),ee.normalA.setVec($,ne.faceNormal0),ee.normalB.setVec($,ne.faceNormal1)}trim(ee,$){return this.commonWriter.trim(ee,$)}}Y.Layout=H.Hr,Y.glLayout=(0,Q.K)(H.Hr,1);const j=(0,G.c)(),X=new x.Z},25558:(dt,Re,T)=>{"use strict";T.d(Re,{P:()=>J,n:()=>W});var J,j,x=T(85931),A=T(21286),G=T(55713),Q=T(84161),H=T(28093);function W(j,X,U,ee=Y){const $=j.vertices.position,ne=j.vertices.componentIndex,se=(0,A.Vl)(ee.anglePlanar),ae=(0,A.Vl)(ee.angleSignificantEdge),de=Math.cos(ae),_e=Math.cos(se),pe=oe.edge,he=pe.position0,ge=pe.position1,ye=pe.faceNormal0,Me=pe.faceNormal1,Ee=function ce(j){const X=j.faces.length/3,U=j.vertices.position,ee=j.faces,$=le.v0,ne=le.v1,se=le.v2,ae=new Float32Array(3*X);for(let de=0;de<X;de++){const pe=ee[3*de+1],he=ee[3*de+2];U.getVec(ee[3*de+0],$),U.getVec(pe,ne),U.getVec(he,se),(0,Q.b)(ne,ne,$),(0,Q.b)(se,se,$),(0,Q.f)($,ne,se),(0,Q.n)($,$),ae[3*de+0]=$[0],ae[3*de+1]=$[1],ae[3*de+2]=$[2]}return ae}(j),Te=function ue(j){const X=j.faces.length/3,U=j.faces,ee=j.neighbors;let $=0;for(let ae=0;ae<X;ae++){const he=U[3*ae+0],ge=U[3*ae+1],ye=U[3*ae+2];$+=-1===ee[3*ae+0]||he<ge?1:0,$+=-1===ee[3*ae+1]||ge<ye?1:0,$+=-1===ee[3*ae+2]||ye<he?1:0}const ne=new Int32Array(4*$);let se=0;for(let ae=0;ae<X;ae++){const de=ee[3*ae+0],_e=ee[3*ae+1],pe=ee[3*ae+2],he=U[3*ae+0],ge=U[3*ae+1],ye=U[3*ae+2];(-1===de||he<ge)&&(ne[se++]=he,ne[se++]=ge,ne[se++]=ae,ne[se++]=de),(-1===_e||ge<ye)&&(ne[se++]=ge,ne[se++]=ye,ne[se++]=ae,ne[se++]=_e),(-1===pe||ye<he)&&(ne[se++]=ye,ne[se++]=he,ne[se++]=ae,ne[se++]=pe)}return ne}(j),me=Te.length/4,Ce=X.allocate(me);let Ie=0;const Je=U.allocate(me);let xe=0,je=0,We=0;const Ne=(0,x.w6)(0,me),we=new Float32Array(me);(0,G.Ed)(we,(De,Fe,ve)=>{$.getVec(Te[4*Fe+0],he),$.getVec(Te[4*Fe+1],ge),ve[Fe]=(0,Q.i)(he,ge)}),Ne.sort((De,Fe)=>we[Fe]-we[De]);const Oe=new Array,$e=new Array;for(let De=0;De<me;De++){const Fe=Ne[De],ve=we[Fe],Ke=Te[4*Fe+0],qe=Te[4*Fe+1],be=Te[4*Fe+2],tt=Te[4*Fe+3],Ye=-1===tt;if($.getVec(Ke,he),$.getVec(qe,ge),Ye)(0,Q.s)(ye,Ee[3*be+0],Ee[3*be+1],Ee[3*be+2]),(0,Q.c)(Me,ye),pe.componentIndex=ne.get(Ke),pe.cosAngle=(0,Q.e)(ye,Me);else{if((0,Q.s)(ye,Ee[3*be+0],Ee[3*be+1],Ee[3*be+2]),(0,Q.s)(Me,Ee[3*tt+0],Ee[3*tt+1],Ee[3*tt+2]),pe.componentIndex=ne.get(Ke),pe.cosAngle=(0,Q.e)(ye,Me),Z(pe,_e))continue;pe.cosAngle<-.9999&&(0,Q.c)(Me,ye)}je+=ve,We++,Ye||B(pe,de)?(X.write(Ce,Ie++,pe),Oe.push(ve)):ie(pe,se)&&(U.write(Je,xe++,pe),$e.push(ve))}const Be=new Float32Array(Oe.reverse()),Se=new Float32Array($e.reverse());return{regular:{instancesData:X.trim(Ce,Ie),lodInfo:{lengths:Be}},silhouette:{instancesData:U.trim(Je,xe),lodInfo:{lengths:Se}},averageEdgeLength:je/We}}function B(j,X){return j.cosAngle<X}function Z(j,X){return j.cosAngle>X}function ie(j,X){const U=(0,A.ZF)(j.cosAngle),ee=oe.fwd,$=oe.ortho;return(0,Q.r)(ee,j.position1,j.position0),U*((0,Q.e)((0,Q.f)($,j.faceNormal0,j.faceNormal1),ee)>0?-1:1)>X}(j=J||(J={}))[j.SOLID=0]="SOLID",j[j.SKETCH=1]="SKETCH";const oe={edge:{position0:(0,H.c)(),position1:(0,H.c)(),faceNormal0:(0,H.c)(),faceNormal1:(0,H.c)(),componentIndex:0,cosAngle:0},ortho:(0,H.c)(),fwd:(0,H.c)()},le={v0:(0,H.c)(),v1:(0,H.c)(),v2:(0,H.c)()},Y={anglePlanar:4,angleSignificantEdge:35}},17803:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{i:()=>x}),(A=x||(x={}))[A.INVISIBLE=0]="INVISIBLE",A[A.TRANSPARENT=1]="TRANSPARENT",A[A.OPAQUE=2]="OPAQUE"},36848:(dt,Re,T)=>{"use strict";T.d(Re,{DX:()=>W,NO:()=>Z,cM:()=>B,p:()=>J,qZ:()=>ie});var x=T(84161),A=T(28093),G=T(11544);let Q=(()=>{const Y=new Uint32Array(131072);for(let j=0;j<Y.length;++j)Y[j]=j;return Y})();const H=new Uint16Array([0]),re=(()=>{const Y=new Uint16Array(65536);for(let j=0;j<Y.length;++j)Y[j]=j;return Y})();function J(Y){if(1===Y)return H;if(Y<re.length)return new Uint16Array(re.buffer,0,Y);if(Y>Q.length){const j=Math.max(2*Q.length,Y);Q=new Uint32Array(j);for(let X=0;X<Q.length;X++)Q[X]=X}return new Uint32Array(Q.buffer,0,Y)}function W(Y){if(1===Y)return new Uint16Array(H);if(Y<re.length)return new Uint16Array(re.slice(0,Y));if(Y>Q.length){const j=new Uint32Array(Y);for(let X=0;X<j.length;X++)j[X]=X;return j}return new Uint32Array(Q.slice(0,Y))}function B(Y,j,X){if(!Y)return!1;const{size:U,data:ee}=Y;(0,x.s)(X,0,0,0),(0,x.s)(le,0,0,0);let $=0,ne=0;for(let se=0;se<j.length-2;se+=3){const ae=j[se+0]*U,de=j[se+1]*U,_e=j[se+2]*U;(0,x.s)(ue,ee[ae+0],ee[ae+1],ee[ae+2]),(0,x.s)(ce,ee[de+0],ee[de+1],ee[de+2]),(0,x.s)(oe,ee[_e+0],ee[_e+1],ee[_e+2]);const pe=(0,G.bE)(ue,ce,oe);pe?((0,x.a)(ue,ue,ce),(0,x.a)(ue,ue,oe),(0,x.g)(ue,ue,1/3*pe),(0,x.a)(X,X,ue),$+=pe):((0,x.a)(le,le,ue),(0,x.a)(le,le,ce),(0,x.a)(le,le,oe),ne+=3)}return!(0===ne&&0===$||(0!==$?((0,x.g)(X,X,1/$),0):0===ne||((0,x.g)(X,le,1/ne),0)))}function Z(Y,j,X){if(!Y||!j)return!1;const{size:U,data:ee}=Y;(0,x.s)(X,0,0,0);let $=-1,ne=0;for(let se=0;se<j.length;se++){const ae=j[se]*U;$!==ae&&(X[0]+=ee[ae+0],X[1]+=ee[ae+1],X[2]+=ee[ae+2],ne++),$=ae}return ne>1&&(0,x.g)(X,X,1/ne),ne>0}function ie(Y,j,X,U){if(!Y)return!1;const{size:ee,data:$}=Y;(0,x.s)(U,0,0,0),(0,x.s)(le,0,0,0);let ne=0,se=0;const ae=j?j.length-1:$.length/ee-1,de=ae+(X?2:0);for(let _e=0;_e<de;_e+=2){const pe=_e<ae?_e:ae,he=_e<ae?_e+1:0,ge=(j?j[pe]:pe)*ee,ye=(j?j[he]:he)*ee;ue[0]=$[ge+0],ue[1]=$[ge+1],ue[2]=$[ge+2],ce[0]=$[ye+0],ce[1]=$[ye+1],ce[2]=$[ye+2],(0,x.g)(ue,(0,x.a)(ue,ue,ce),.5);const Me=(0,x.j)(ue,ce);Me>0?((0,x.a)(U,U,(0,x.g)(ue,ue,Me)),ne+=Me):((0,x.a)(le,le,ue),se++)}return 0!==ne?((0,x.g)(U,U,1/ne),!0):0!==se&&((0,x.g)(U,le,1/se),!0)}const ue=(0,A.c)(),ce=(0,A.c)(),oe=(0,A.c)(),le=(0,A.c)()},19597:(dt,Re,T)=>{"use strict";T.d(Re,{E9:()=>W,YO:()=>ie,hf:()=>ue,l_:()=>Z,ow:()=>J});var x=T(39114),A=T(59631),G=T(83994),Q=T(67969),H=T(55086),re=T(49353);function J(ce,oe=A.QI,le=x.i,Y=-1,j=1){let X=null;return X=oe===A.Bn?new Float32Array([Y,Y,0,0,j,Y,1,0,Y,j,0,1,j,j,1,1]):new Float32Array([Y,Y,j,Y,Y,j,j,j]),new re.U(ce,le,{geometry:oe},{geometry:G.f.createVertex(ce,Q.l1.STATIC_DRAW,X)})}function W(ce,oe=A.QI,le=x.i){const Y=new Float32Array([-1,-1,3,-1,-1,3]);return new re.U(ce,le,{geometry:oe},{geometry:G.f.createVertex(ce,Q.l1.STATIC_DRAW,Y)})}function Z(ce,oe=4){return new H.x(ce,{target:Q.No.TEXTURE_2D,pixelFormat:Q.VI.RGBA,dataType:Q.Br.UNSIGNED_BYTE,samplingMode:Q.cw.NEAREST,width:oe,height:oe})}function ie(ce,oe,le=4){const Y=new Uint8Array(le*le*4);for(let j=0;j<Y.length;j+=4)Y[j+0]=255*oe[0],Y[j+1]=255*oe[1],Y[j+2]=255*oe[2],Y[j+3]=255*oe[3];return new H.x(ce,{target:Q.No.TEXTURE_2D,pixelFormat:Q.VI.RGBA,dataType:Q.Br.UNSIGNED_BYTE,samplingMode:Q.cw.NEAREST,width:le,height:le},Y)}function ue(ce){return new H.x(ce,{target:Q.No.TEXTURE_2D,pixelFormat:Q.VI.RGBA,dataType:Q.Br.UNSIGNED_BYTE,samplingMode:Q.cw.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))}},91480:(dt,Re,T)=>{"use strict";T.d(Re,{G1:()=>B,e4:()=>J,es:()=>W,nn:()=>re});var x=T(62208),A=T(84161),G=T(28093),Q=T(41743),H=T(67857);function re(ie){return(0,x.pC)(ie)&&(0,x.pC)(ie.dist)}function J(ie){return(ue,ce,oe)=>((0,A.h)(Z,ue,ce,oe),!(0,Q.e)(ie,Z))}function W(ie){return re(ie)&&ie.intersector===H.q7.OBJECT&&!!ie.target}function B(ie){return re(ie)&&ie.intersector===H.q7.HUD&&!!ie.target&&(0,x.pC)(ie.target.center)}const Z=(0,G.c)()},55314:(dt,Re,T)=>{"use strict";T.d(Re,{VB:()=>U,_s:()=>ee,tB:()=>ue,bK:()=>ce,J4:()=>ie});var x=T(62208),A=T(28347),G=T(28093),Q=T(5548),H=T(97126),re=T(77926),J=T(90793),W=T(91480),B=T(67857);function Z(ne){return(0,W.nn)(ne)&&ne.intersector===B.q7.LOD&&!!ne.target}function ie(ne,se){var ae;return(0,W.es)(ne)||(0,W.G1)(ne)?X(ne.target.object.metadata,se):(0,J.T)(ne)?null==(ae=se.map)?void 0:ae.ground:(0,re.a)(ne)||(0,re.G)(ne)||(0,J.j)(ne)?X(ne.target,se):null}function ue(ne,se){const ae=ce(ne,se);return(0,x.pC)(ae)&&"graphic"===ae.type?ae.graphic:null}function ce(ne,se){if((0,x.Wi)(ne))return null;if((0,W.es)(ne)||(0,W.G1)(ne))return oe(ne.target.object.metadata,se);if((0,re.a)(ne)){const ae=ne.target.createGraphic();return{type:"graphic",graphic:ae,layer:ae.layer}}return(0,J.j)(ne)||Z(ne)?oe(ne.target,se):(0,re.G)(ne)?function le(ne,se){const ae=X(ne,se);if((0,x.Wi)(ae))return null;const de=se.allLayerViews.find(_e=>_e.layer===ae);return de&&!de.suspended&&"getGraphicFromIntersectorTarget"in de?function j(ne){return(0,x.pC)(ne)?{type:"graphic",graphic:ne,layer:ne.layer}:null}(de.getGraphicFromIntersectorTarget(ne)):null}(ne.target,se):null}function oe(ne,se){if((0,x.Wi)(ne)||(0,x.Wi)(ne.graphicUid))return null;const ae=X(ne,se);if((0,x.Wi)(ae))return null;if(ae===se.graphics)return(0,x.Wi)(se.graphicsView)||"number"!=typeof ne.graphicUid?null:se.graphicsView.getHit(ne.graphicUid);const de=se.allLayerViews.find(_e=>_e.layer===ae);return!de||de.suspended||(0,x.Wi)(ne.graphicUid)?null:"getHit"in de?de.getHit(ne.graphicUid):null}function X(ne,se){return(0,x.Wi)(ne.layerUid)?null:(0,x.pC)(se.graphicsView)&&ne.layerUid===se.graphicsView.processor.layer.id?se.graphics:se.map.findLayerByUid(ne.layerUid)}function U(ne,se){if((0,W.es)(ne)||(0,W.G1)(ne))return(0,H.d)(ne.target.object.boundingVolumeWorldSpace.bounds);if(Z(ne)){(0,A.x)($,ne.transformation);const ae=Math.max($[0],$[1],$[2]);return ne.target.baseBoundingSphere.radius*ae}return(0,re.G)(ne)?(0,x.yw)(function Y(ne,se){const ae=X(ne,se);if((0,x.Wi)(ae))return null;const de=se.allLayerViews.find(_e=>_e.layer===ae);return de&&!de.suspended&&"getAABBFromIntersectorTarget"in de?de.getAABBFromIntersectorTarget(ne):null}(ne.target,se),ae=>.5*(0,Q.wz)(ae)):null}function ee(ne){return!(0,W.es)(ne)&&!(0,W.G1)(ne)&&(Z(ne)?ne.target.numLodLevels>1:!!(0,re.G)(ne))}const $=(0,G.c)()},47526:(dt,Re,T)=>{"use strict";T.d(Re,{HI:()=>re,VQ:()=>G,VV:()=>Q,aH:()=>A,ci:()=>H});var x=T(85931);function A(J){const W=[];return J.levels.forEach(B=>{B.components.forEach(Z=>{W.push(Z.material)})}),(0,x.Tw)(W)}function G(J){const W=new Array;return J.levels.forEach(B=>{B.components.forEach(Z=>{Z.textures&&W.push(...Z.textures)})}),(0,x.Tw)(W)}function Q(J){const W=[];return J.components.forEach(B=>{W.push(B.geometry)}),(0,x.Tw)(W)}function H(J){const W=[];return J.levels.forEach(B=>{B.components.forEach(Z=>{W.push(Z.geometry)})}),(0,x.Tw)(W)}function re(J){return Q(J).reduce((W,B)=>W+B.indexCount/3,0)}},83196:(dt,Re,T)=>{"use strict";T.d(Re,{q:()=>A});var x=T(26594);function A(Q){const H=new Map,re=J=>{let W=H.get(J);return W||(W=new x.t9,H.set(J,W)),W};return Q.removes.forAll(J=>{G(J)&&re(J.material).removes.push(J)}),Q.adds.forAll(J=>{G(J)&&re(J.material).adds.push(J)}),Q.updates.forAll(J=>{G(J.renderGeometry)&&re(J.renderGeometry.material).updates.push(J)}),H}function G(Q){return Q.data.indexCount>=1}},17962:(dt,Re,T)=>{"use strict";T.d(Re,{Gw:()=>G,PV:()=>Z,TU:()=>ie,bA:()=>ue,n9:()=>Q,sX:()=>W});var x=T(21286),A=T(59617);function G(U,ee){return new ce(U,oe,ee)}function Q(U,ee){const{curvatureDependent:$,scaleStart:ne,scaleFallOffRange:se}=oe;return new ce(U,{curvatureDependent:{min:{curvature:$.min.curvature,tiltAngle:$.min.tiltAngle,scaleFallOffFactor:le.curvatureDependent.min.scaleFallOffFactor},max:{curvature:$.max.curvature,tiltAngle:$.max.tiltAngle,scaleFallOffFactor:le.curvatureDependent.max.scaleFallOffFactor}},scaleStart:ne,scaleFallOffRange:se,minPixelSize:le.minPixelSize},ee)}function re(U,ee,$){const ne=$.parameters,se=$.paddingPixelsOverride;return j.scale=Math.min(ne.divisor/(ee-ne.offset),1),j.factor=function H(U){return Math.abs(U*U*U)}(U),j.minPixelSize=ne.minPixelSize,j.paddingPixels=se,j}function J(U,ee){return 0===U?ee.minPixelSize:ee.minPixelSize*(1+2*ee.paddingPixels/U)}function W(U,ee){return Math.max((0,x.t7)(U*ee.scale,U,ee.factor),J(U,ee))}function Z(U,ee,$,ne){ne.scale=function B(U,ee,$){const ne=re(U,ee,$);return ne.minPixelSize=0,ne.paddingPixels=0,W(1,ne)}(U,ee,$),ne.factor=0,ne.minPixelSize=$.parameters.minPixelSize,ne.paddingPixels=$.paddingPixelsOverride}function ie(U,ee,$=[0,0]){const ne=Math.min(Math.max(ee.scale,J(U[1],ee)/Math.max(1e-5,U[1])),1);return $[0]=U[0]*ne,$[1]=U[1]*ne,$}function ue(U,ee,$,ne){return W(U,re(ee,$,ne))}class ce{constructor(ee,$,ne,se={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},ae){this.viewingMode=ee,this.description=$,this.ellipsoidRadius=ne,this.parameters=se,this._paddingPixelsOverride=ae,this.viewingMode===A.JY.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}update(ee){return!(this.parameters&&this.parameters.camera.fovY===ee.fovY&&this.parameters.camera.distance===ee.distance||(this._calculateParameters(ee,this.ellipsoidRadius,this.parameters),0))}overridePadding(ee){return ee!==this.paddingPixelsOverride?new ce(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,ee):this}_calculateParameters(ee,$,ne){const{scaleStart:se,scaleFallOffRange:ae,minPixelSize:de}=this.description,{fovY:_e,distance:pe}=ee,he=this.calculateCurvatureDependentParameters(ee,$),ge=this.coverageCompensation(ee,$,he),{tiltAngle:ye,scaleFallOffFactor:Me}=he,Ee=Math.sin(ye)*pe,Te=.5*Math.PI-ye-_e*(.5-se*ge),me=Ee/Math.cos(Te),Ie=(me-Me*(Ee/Math.cos(Te+_e*ae*ge)))/(1-Me);return ne.camera.fovY=ee.fovY,ne.camera.distance=ee.distance,ne.offset=Ie,ne.divisor=me-Ie,ne.minPixelSize=de,ne}_calculateCurvatureDependentParametersLocal(ee,$,ne=X){return ne.tiltAngle=this.description.curvatureDependent.min.tiltAngle,ne.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor,ne}_calculateCurvatureDependentParametersGlobal(ee,$,ne=X){const se=this.description.curvatureDependent,ae=1+ee.distance/$,de=Math.sqrt(ae*ae-1),[_e,pe]=[se.min.curvature,se.max.curvature],he=(0,x.uZ)((de-_e)/(pe-_e),0,1),[ge,ye]=[se.min,se.max];return ne.tiltAngle=(0,x.t7)(ge.tiltAngle,ye.tiltAngle,he),ne.scaleFallOffFactor=(0,x.t7)(ge.scaleFallOffFactor,ye.scaleFallOffFactor,he),ne}_surfaceCoverageCompensationLocal(ee,$,ne){return(ee.fovY-ne.tiltAngle)/ee.fovY}_surfaceCoverageCompensationGlobal(ee,$,ne){const se=$*$,ae=ne.tiltAngle+.5*Math.PI,{fovY:de,distance:_e}=ee,pe=_e*_e+se-2*Math.cos(ae)*_e*$,he=Math.sqrt(pe),ge=Math.sqrt(pe-se);return(Math.acos(ge/he)-Math.asin($/(he/Math.sin(ae)))+.5*de)/de}}const oe={curvatureDependent:{min:{curvature:(0,x.Vl)(10),tiltAngle:(0,x.Vl)(12),scaleFallOffFactor:.5},max:{curvature:(0,x.Vl)(70),tiltAngle:(0,x.Vl)(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},le={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14},j={scale:0,factor:0,minPixelSize:0,paddingPixels:0},X={tiltAngle:0,scaleFallOffFactor:0}},39782:(dt,Re,T)=>{"use strict";T.d(Re,{p:()=>A,y:()=>x});const x={orderedRepackingEnabled:!1},A={rootOrigin:null}},40841:(dt,Re,T)=>{"use strict";T.d(Re,{W9:()=>$,cy:()=>_e,iO:()=>se,lV:()=>de,yn:()=>ue});var x=T(62208),A=T(30217),G=T(550),Q=T(28347),H=T(43703),re=T(48977),J=T(78451),W=T(84161),B=T(14658),Z=T(28093),ie=T(97126);class ue{constructor(){this._transform=(0,H.c)(),this._transformInverse=new ce({value:this._transform},Q.a,H.c),this._transformInverseTranspose=new ce(this._transformInverse,Q.t,H.c),this._transformTranspose=new ce({value:this._transform},Q.t,H.c),this._transformInverseRotation=new ce({value:this._transform},A.n,G.c)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(ge){(0,Q.c)(this._transform,ge)}multiplyTransform(ge){(0,Q.m)(this._transform,this._transform,ge)}set(ge){(0,Q.c)(this._transform,ge),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(ge,ye){this.setTransformMatrix(ge),this.multiplyTransform(ye),this._invalidateLazyTransforms()}}class ce{constructor(ge,ye,Me){this.original=ge,this.update=ye,this.dirty=!0,this.transform=Me()}invalidate(){this.dirty=!0}get value(){return this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1),this.transform}}const le=(0,Z.c)(),Y=(0,Z.c)(),j=(0,Z.c)(),ee=new class U{constructor(ge=0){this.offset=ge,this.sphere=(0,ie.c)(),this.tmpVertex=(0,Z.c)()}applyToVertex(ge,ye,Me){const Ee=this.objectTransform.transform;let Te=Ee[0]*ge+Ee[4]*ye+Ee[8]*Me+Ee[12],me=Ee[1]*ge+Ee[5]*ye+Ee[9]*Me+Ee[13],Ce=Ee[2]*ge+Ee[6]*ye+Ee[10]*Me+Ee[14];const Ie=this.offset/Math.sqrt(Te*Te+me*me+Ce*Ce);Te+=Te*Ie,me+=me*Ie,Ce+=Ce*Ie;const Ge=this.objectTransform.inverse;return this.tmpVertex[0]=Ge[0]*Te+Ge[4]*me+Ge[8]*Ce+Ge[12],this.tmpVertex[1]=Ge[1]*Te+Ge[5]*me+Ge[9]*Ce+Ge[13],this.tmpVertex[2]=Ge[2]*Te+Ge[6]*me+Ge[10]*Ce+Ge[14],this.tmpVertex}applyToMinMax(ge,ye){const Me=this.offset/Math.sqrt(ge[0]*ge[0]+ge[1]*ge[1]+ge[2]*ge[2]);ge[0]+=ge[0]*Me,ge[1]+=ge[1]*Me,ge[2]+=ge[2]*Me;const Ee=this.offset/Math.sqrt(ye[0]*ye[0]+ye[1]*ye[1]+ye[2]*ye[2]);ye[0]+=ye[0]*Ee,ye[1]+=ye[1]*Ee,ye[2]+=ye[2]*Ee}applyToAabb(ge){const ye=this.offset/Math.sqrt(ge[0]*ge[0]+ge[1]*ge[1]+ge[2]*ge[2]);ge[0]+=ge[0]*ye,ge[1]+=ge[1]*ye,ge[2]+=ge[2]*ye;const Me=this.offset/Math.sqrt(ge[3]*ge[3]+ge[4]*ge[4]+ge[5]*ge[5]);return ge[3]+=ge[3]*Me,ge[4]+=ge[4]*Me,ge[5]+=ge[5]*Me,ge}applyToBoundingSphere(ge){const ye=Math.sqrt(ge[0]*ge[0]+ge[1]*ge[1]+ge[2]*ge[2]),Me=this.offset/ye;return this.sphere[0]=ge[0]+ge[0]*Me,this.sphere[1]=ge[1]+ge[1]*Me,this.sphere[2]=ge[2]+ge[2]*Me,this.sphere[3]=ge[3]+ge[3]*this.offset/ye,this.sphere}};function $(he){return(0,x.pC)(he)?(ee.offset=he,ee):null}const ne=new class X{constructor(ge=0){this.componentLocalOriginLength=0,this._tmpVertex=(0,Z.c)(),this._mbs=(0,ie.c)(),this._obb={center:(0,Z.c)(),halfSize:(0,B.c)(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(ge)}_resetOffset(ge){this._offset=ge,this._totalOffset=ge}set offset(ge){this._resetOffset(ge)}get offset(){return this._offset}set componentOffset(ge){this._totalOffset=this._offset+ge}set localOrigin(ge){this.componentLocalOriginLength=Math.sqrt(ge[0]*ge[0]+ge[1]*ge[1]+ge[2]*ge[2])}applyToVertex(ge,ye,Me){const Ee=ge,Te=ye,me=Me+this.componentLocalOriginLength,Ce=this._totalOffset/Math.sqrt(Ee*Ee+Te*Te+me*me);return this._tmpVertex[0]=ge+Ee*Ce,this._tmpVertex[1]=ye+Te*Ce,this._tmpVertex[2]=Me+me*Ce,this._tmpVertex}applyToAabb(ge){const ye=ge[0],Me=ge[1],Ee=ge[2]+this.componentLocalOriginLength,Te=ge[3],me=ge[4],Ce=ge[5]+this.componentLocalOriginLength,Ie=ye*Te<0?0:Math.min(Math.abs(ye),Math.abs(Te)),Ge=Me*me<0?0:Math.min(Math.abs(Me),Math.abs(me)),Je=Ee*Ce<0?0:Math.min(Math.abs(Ee),Math.abs(Ce)),xe=Math.sqrt(Ie*Ie+Ge*Ge+Je*Je);if(xe<this._totalOffset)return ge[0]-=ye<0?this._totalOffset:0,ge[1]-=Me<0?this._totalOffset:0,ge[2]-=Ee<0?this._totalOffset:0,ge[3]+=Te>0?this._totalOffset:0,ge[4]+=me>0?this._totalOffset:0,ge[5]+=Ce>0?this._totalOffset:0,ge;const je=Math.max(Math.abs(ye),Math.abs(Te)),We=Math.max(Math.abs(Me),Math.abs(me)),Ne=Math.max(Math.abs(Ee),Math.abs(Ce)),we=Math.sqrt(je*je+We*We+Ne*Ne),Oe=this._totalOffset/we,$e=this._totalOffset/xe;return ge[0]+=ye*(ye>0?Oe:$e),ge[1]+=Me*(Me>0?Oe:$e),ge[2]+=Ee*(Ee>0?Oe:$e),ge[3]+=Te*(Te<0?Oe:$e),ge[4]+=me*(me<0?Oe:$e),ge[5]+=Ce*(Ce<0?Oe:$e),ge}applyToMbs(ge){const ye=Math.sqrt(ge[0]*ge[0]+ge[1]*ge[1]+ge[2]*ge[2]),Me=this._totalOffset/ye;return this._mbs[0]=ge[0]+ge[0]*Me,this._mbs[1]=ge[1]+ge[1]*Me,this._mbs[2]=ge[2]+ge[2]*Me,this._mbs[3]=ge[3]+ge[3]*this._totalOffset/ye,this._mbs}applyToObb(ge){const ye=ge.center,Me=this._totalOffset/Math.sqrt(ye[0]*ye[0]+ye[1]*ye[1]+ye[2]*ye[2]);this._obb.center[0]=ye[0]+ye[0]*Me,this._obb.center[1]=ye[1]+ye[1]*Me,this._obb.center[2]=ye[2]+ye[2]*Me,(0,W.q)(this._obb.halfSize,ge.halfSize,ge.quaternion),(0,W.a)(this._obb.halfSize,this._obb.halfSize,ge.center);const Ee=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*Ee,this._obb.halfSize[1]+=this._obb.halfSize[1]*Ee,this._obb.halfSize[2]+=this._obb.halfSize[2]*Ee,(0,W.b)(this._obb.halfSize,this._obb.halfSize,ge.center),(0,re.c)(pe,ge.quaternion),(0,W.q)(this._obb.halfSize,this._obb.halfSize,pe),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=ge.quaternion,this._obb}};function se(he){return(0,x.pC)(he)?(ne.offset=he,ne):null}const ae=new class oe{constructor(ge=0){this.offset=ge,this.tmpVertex=(0,Z.c)()}applyToVertex(ge,ye,Me){const Ee=ge+this.localOrigin[0],Te=ye+this.localOrigin[1],me=Me+this.localOrigin[2],Ce=this.offset/Math.sqrt(Ee*Ee+Te*Te+me*me);return this.tmpVertex[0]=ge+Ee*Ce,this.tmpVertex[1]=ye+Te*Ce,this.tmpVertex[2]=Me+me*Ce,this.tmpVertex}applyToAabb(ge){for(let Te=0;Te<3;++Te)le[Te]=ge[0+Te]+this.localOrigin[Te],Y[Te]=ge[3+Te]+this.localOrigin[Te],j[Te]=le[Te];const ye=this.applyToVertex(le[0],le[1],le[2]);for(let Te=0;Te<3;++Te)ge[Te]=ye[Te],ge[Te+3]=ye[Te];const Me=Te=>{const me=this.applyToVertex(Te[0],Te[1],Te[2]);for(let Ce=0;Ce<3;++Ce)ge[Ce+0]=Math.min(ge[Ce+0],me[Ce]),ge[Ce+3]=Math.max(ge[Ce+3],me[Ce])};for(let Te=1;Te<8;++Te){for(let me=0;me<3;++me)j[me]=0==(Te&1<<me)?le[me]:Y[me];Me(j)}let Ee=0;for(let Te=0;Te<3;++Te)le[Te]*Y[Te]<0&&(Ee|=1<<Te);if(0!==Ee&&7!==Ee)for(let Te=0;Te<8;++Te)if(0==(Ee&Te)){for(let me=0;me<3;++me)j[me]=Ee[me]?0:0!=(Te&1<<me)?le[me]:Y[me];Me(j)}for(let Te=0;Te<3;++Te)ge[Te+0]-=this.localOrigin[Te],ge[Te+3]-=this.localOrigin[Te];return ge}};function de(he){return(0,x.pC)(he)?(ae.offset=he,ae):null}const _e="terrain",pe=(0,J.a)()},82244:(dt,Re,T)=>{"use strict";T.d(Re,{AM:()=>G,Eg:()=>Q,Mi:()=>A,Ur:()=>H});var x=T(28093);class A{constructor(J=(0,x.c)()){this.intensity=J}}class G{constructor(J=(0,x.c)(),W=(0,x.f)(.57735,.57735,.57735)){this.intensity=J,this.direction=W}}class Q{constructor(J=(0,x.c)(),W=(0,x.f)(.57735,.57735,.57735),B=!0,Z=1,ie=1){this.intensity=J,this.direction=W,this.castShadows=B,this.specularStrength=Z,this.environmentStrength=ie}}class H{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},95279:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>ae,V:()=>se});var x=T(84161),A=T(28093),G=T(82244),Q=T(21286);function re(_e,pe,he){(he=he||_e).length=_e.length;for(let ge=0;ge<_e.length;ge++)he[ge]=_e[ge]*pe[ge];return he}function J(_e,pe,he){(he=he||_e).length=_e.length;for(let ge=0;ge<_e.length;ge++)he[ge]=_e[ge]*pe;return he}function W(_e,pe,he){(he=he||_e).length=_e.length;for(let ge=0;ge<_e.length;ge++)he[ge]=_e[ge]+pe[ge];return he}function B(_e){return(_e+1)*(_e+1)}function ie(_e,pe,he){const ge=_e[0],ye=_e[1],Me=_e[2],Ee=he||[];return Ee.length=B(pe),pe>=0&&(Ee[0]=.28209479177),pe>=1&&(Ee[1]=.4886025119*ge,Ee[2]=.4886025119*Me,Ee[3]=.4886025119*ye),pe>=2&&(Ee[4]=1.09254843059*ge*ye,Ee[5]=1.09254843059*ye*Me,Ee[6]=.31539156525*(3*Me*Me-1),Ee[7]=1.09254843059*ge*Me,Ee[8]=.54627421529*(ge*ge-ye*ye)),Ee}function le(_e,pe,he,ge){(function ue(_e,pe){const he=B(_e),ge=pe||{r:[],g:[],b:[]};ge.r.length=ge.g.length=ge.b.length=he;for(let ye=0;ye<he;ye++)ge.r[ye]=ge.g[ye]=ge.b[ye]=0})(pe,ge),(0,x.s)(he.intensity,0,0,0);let ye=!1;const Me=Y,Ee=j,Te=X;Me.length=0,Ee.length=0,Te.length=0;for(const me of _e)me instanceof G.Eg&&!ye?((0,x.c)(he.direction,me.direction),(0,x.c)(he.intensity,me.intensity),he.specularStrength=me.specularStrength,he.environmentStrength=me.environmentStrength,he.castShadows=me.castShadows,ye=!0):me instanceof G.Eg||me instanceof G.AM?Me.push(me):me instanceof G.Mi?Ee.push(me):me instanceof G.Ur&&Te.push(me);(function ce(_e,pe){const he=function Z(_e){return(0,Q.uZ)(Math.floor(Math.sqrt(_e)-1),0,2)}(pe.r.length);for(const ge of _e)(0,x.o)($,ge.direction),ie($,he,U),re(U,ne),J(U,ge.intensity[0],ee),W(pe.r,ee),J(U,ge.intensity[1],ee),W(pe.g,ee),J(U,ge.intensity[2],ee),W(pe.b,ee);return pe})(Me,ge),function oe(_e,pe){ie($,0,U);for(const he of _e)pe.r[0]+=U[0]*ne[0]*he.intensity[0]*4*Math.PI,pe.g[0]+=U[0]*ne[0]*he.intensity[1]*4*Math.PI,pe.b[0]+=U[0]*ne[0]*he.intensity[2]*4*Math.PI}(Ee,ge);for(const me of Te)W(ge.r,me.r),W(ge.g,me.g),W(ge.b,me.b)}const Y=[],j=[],X=[],U=[0],ee=[0],$=(0,A.c)(),ne=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398],se=.4;class ae{constructor(){this._shOrder=2,this._oldSunlight={direction:(0,A.c)(),ambient:{color:(0,A.c)(),intensity:1},diffuse:{color:(0,A.c)(),intensity:1}},this.globalFactor=.5,this.groundLightingFactor=.5,this._sphericalHarmonics=new G.Ur,this._mainLight={intensity:(0,A.c)(),direction:(0,A.f)(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}get lightingMainDirection(){return this._mainLight.direction}set(pe){le(pe,this._shOrder,this._mainLight,this._sphericalHarmonics),(0,x.c)(this._oldSunlight.direction,this._mainLight.direction);const he=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*he,this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*he,this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*he,(0,x.g)(this._oldSunlight.diffuse.color,this._mainLight.intensity,he),(0,x.c)(de,this._oldSunlight.diffuse.color),(0,x.g)(de,de,se*this.globalFactor),(0,x.a)(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,de)}get old(){return this._oldSunlight}}const de=(0,A.c)()},92972:(dt,Re,T)=>{"use strict";T.d(Re,{E:()=>ae});var x=T(4794),A=T(6945),G=T(42743),Q=T(60881),H=T(32393),re=T(40723),J=T(88569),W=T(5894),B=T(60909),Z=T(57623),ie=T(651),ue=T(91056),ce=T(39114),oe=T(12407),le=T(64127),Y=T(89652),j=T(2078);class X extends ue.A{initializeProgram(he){const ge=X.shader.get().build(this.configuration);return new oe.$(he.rctx,ge,ce.i)}_createPipeline(he,ge){const ye=this.configuration,Me=he===G.Am.NONE,Ee=he===G.Am.FrontFace;return(0,j.sm)({blending:ye.output!==A.H.Color&&ye.output!==A.H.Alpha||!ye.transparent?null:Me?J.wu:(0,J.j7)(he),culling:(0,j.zp)(ye.cullFace),depthTest:{func:(0,J.Bh)(he)},depthWrite:Me||Ee?ye.writeDepth&&j.LZ:null,colorWrite:j.BK,stencilWrite:ye.hasOccludees?le.s3:null,stencilTest:ye.hasOccludees?ge?le.eD:le.RY:null,polygonOffset:Me||Ee?ye.polygonOffset&&U:(0,J.je)(ye.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(he,ge){return ge?this._occludeePipelineState:super.getPipelineState(he,ge)}}X.shader=new ie.J(Y.C,()=>T.e(1362).then(T.bind(T,11362)));const U={factor:1,units:1};var ee=T(17626),$=T(87601),ne=T(41528);class se extends ne.W{constructor(){super(...arguments),this.output=A.H.Color,this.cullFace=G.Vr.None,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=G.Am.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,ee._)([(0,$.o)({count:A.H.COUNT})],se.prototype,"output",void 0),(0,ee._)([(0,$.o)({count:G.Vr.COUNT})],se.prototype,"cullFace",void 0),(0,ee._)([(0,$.o)()],se.prototype,"hasSlicePlane",void 0),(0,ee._)([(0,$.o)()],se.prototype,"hasVertexColors",void 0),(0,ee._)([(0,$.o)()],se.prototype,"transparent",void 0),(0,ee._)([(0,$.o)()],se.prototype,"polygonOffset",void 0),(0,ee._)([(0,$.o)()],se.prototype,"enableOffset",void 0),(0,ee._)([(0,$.o)()],se.prototype,"writeDepth",void 0),(0,ee._)([(0,$.o)()],se.prototype,"hasOccludees",void 0),(0,ee._)([(0,$.o)({count:G.Am.COUNT})],se.prototype,"transparencyPassType",void 0),(0,ee._)([(0,$.o)()],se.prototype,"hasMultipassTerrain",void 0),(0,ee._)([(0,$.o)()],se.prototype,"cullAboveGround",void 0);class ae extends re.F5{constructor(he){super(he,new _e),this.supportsEdges=!0,this._configuration=new se}getConfiguration(he,ge){return this._configuration.output=he,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=ge.transparencyPassType,this._configuration.enableOffset=ge.camera.relativeElevation<J.ve,this._configuration.hasMultipassTerrain=ge.multipassTerrain.enabled,this._configuration.cullAboveGround=ge.multipassTerrain.cullAboveGround,this._configuration}intersect(he,ge,ye,Me,Ee,Te,me){(0,Z.Bw)(he,ge,Me,Ee,Te,void 0,me)}requiresSlot(he,ge){return he===W.r.DRAPED_MATERIAL||((0,H.S)(ge)===A.H.Highlight?he===W.r.OPAQUE_MATERIAL:he===(this.parameters.transparent?this.parameters.writeDepth?W.r.TRANSPARENT_MATERIAL:W.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:W.r.OPAQUE_MATERIAL))}createGLMaterial(he){return he.output===A.H.Color||he.output===A.H.Alpha||he.output===A.H.Highlight||he.output===A.H.Depth&&this.parameters.writeLinearDepth?new de(he):null}createBufferWriter(){return new B.G_(B.IM)}}class de extends Q.Z{_updateOccludeeState(he){he.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:he.hasOccludees})}beginSlot(he){return this._output!==A.H.Color&&this._output!==A.H.Alpha||this._updateOccludeeState(he),this.ensureTechnique(X,he)}}class _e extends re.Mt{constructor(){super(...arguments),this.color=x.Z,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=G.Vr.None,this.hasOccludees=!1}}},28523:(dt,Re,T)=>{"use strict";T.d(Re,{Gp:()=>ge,RL:()=>Ce});var x=T(62208),A=T(84161),G=T(28093),Q=T(59617),H=T(19625),re=T(6945),J=T(26859),W=T(96395),B=T(92724),Z=T(42743),ie=T(33470),ue=T(40723),ce=T(88569),oe=T(91263),le=T(5894),Y=T(16396),j=T(40841),X=T(42037),U=T(57623),ee=T(39711),$=T(17626),ne=T(36603),se=T(87601),ae=T(41528);class de extends ae.W{constructor(){super(...arguments),this.output=re.H.Color,this.alphaDiscardMode=Z.JJ.Opaque,this.doubleSidedMode=W.q.None,this.pbrMode=B.f7.Disabled,this.cullFace=Z.Vr.None,this.transparencyPassType=Z.Am.NONE,this.normalType=J.h.Attribute,this.textureCoordinateType=ne.N.None,this.customDepthTest=Z.Gv.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetalnessAndRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1}}(0,$._)([(0,se.o)({count:re.H.COUNT})],de.prototype,"output",void 0),(0,$._)([(0,se.o)({count:Z.JJ.COUNT})],de.prototype,"alphaDiscardMode",void 0),(0,$._)([(0,se.o)({count:W.q.COUNT})],de.prototype,"doubleSidedMode",void 0),(0,$._)([(0,se.o)({count:B.f7.COUNT})],de.prototype,"pbrMode",void 0),(0,$._)([(0,se.o)({count:Z.Vr.COUNT})],de.prototype,"cullFace",void 0),(0,$._)([(0,se.o)({count:Z.Am.COUNT})],de.prototype,"transparencyPassType",void 0),(0,$._)([(0,se.o)({count:J.h.COUNT})],de.prototype,"normalType",void 0),(0,$._)([(0,se.o)({count:ne.N.COUNT})],de.prototype,"textureCoordinateType",void 0),(0,$._)([(0,se.o)({count:Z.Gv.COUNT})],de.prototype,"customDepthTest",void 0),(0,$._)([(0,se.o)()],de.prototype,"spherical",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasVertexColors",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasSymbolColors",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasVerticalOffset",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasSlicePlane",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasSliceHighlight",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasColorTexture",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasMetalnessAndRoughnessTexture",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasEmissionTexture",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasOcclusionTexture",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasNormalTexture",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasScreenSizePerspective",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasVertexTangents",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasOccludees",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasMultipassTerrain",void 0),(0,$._)([(0,se.o)()],de.prototype,"hasModelTransformation",void 0),(0,$._)([(0,se.o)()],de.prototype,"offsetBackfaces",void 0),(0,$._)([(0,se.o)()],de.prototype,"vvSize",void 0),(0,$._)([(0,se.o)()],de.prototype,"vvColor",void 0),(0,$._)([(0,se.o)()],de.prototype,"receiveShadows",void 0),(0,$._)([(0,se.o)()],de.prototype,"receiveAmbientOcclusion",void 0),(0,$._)([(0,se.o)()],de.prototype,"textureAlphaPremultiplied",void 0),(0,$._)([(0,se.o)()],de.prototype,"instanced",void 0),(0,$._)([(0,se.o)()],de.prototype,"instancedColor",void 0),(0,$._)([(0,se.o)()],de.prototype,"instancedDoublePrecision",void 0),(0,$._)([(0,se.o)()],de.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,$._)([(0,se.o)()],de.prototype,"writeDepth",void 0),(0,$._)([(0,se.o)()],de.prototype,"transparent",void 0),(0,$._)([(0,se.o)()],de.prototype,"enableOffset",void 0),(0,$._)([(0,se.o)()],de.prototype,"cullAboveGround",void 0),(0,$._)([(0,se.o)()],de.prototype,"snowCover",void 0),(0,$._)([(0,se.o)({constValue:!0})],de.prototype,"hasVvInstancing",void 0),(0,$._)([(0,se.o)({constValue:!1})],de.prototype,"useCustomDTRExponentForWater",void 0),(0,$._)([(0,se.o)({constValue:!1})],de.prototype,"supportsTextureAtlas",void 0),(0,$._)([(0,se.o)({constValue:!0})],de.prototype,"useFillLights",void 0);var _e=T(651),pe=T(77133);class he extends ee.tT{initializeConfiguration(Oe,$e){super.initializeConfiguration(Oe,$e),$e.hasMetalnessAndRoughnessTexture=!1,$e.hasEmissionTexture=!1,$e.hasOcclusionTexture=!1,$e.hasNormalTexture=!1,$e.hasModelTransformation=!1,$e.normalType=J.h.Attribute,$e.doubleSidedMode=W.q.WindingOrder,$e.hasVertexTangents=!1}initializeProgram(Oe){return this._initializeProgram(Oe,he.shader)}}he.shader=new _e.J(pe.R,()=>T.e(3959).then(T.bind(T,93959)));class ge extends ue.F5{constructor(Oe){super(Oe,Ee),this.supportsEdges=!0,this.techniqueConfig=new de,this.vertexBufferLayout=function me(we){const Oe=we.textureId||we.normalTextureId||we.metallicRoughnessTextureId||we.emissiveTextureId||we.occlusionTextureId,$e=(0,H.U$)().vec3f(Y.T.POSITION).vec3f(Y.T.NORMAL);return we.hasVertexTangents&&$e.vec4f(Y.T.TANGENT),Oe&&$e.vec2f(Y.T.UV0),we.hasVertexColors&&$e.vec4u8(Y.T.COLOR),we.hasSymbolColors&&$e.vec4u8(Y.T.SYMBOLCOLOR),$e}(this.parameters),this.instanceBufferLayout=Oe.instanced?Ce(this.parameters):null}isVisibleInPass(Oe){return Oe!==oe.C.MATERIAL_DEPTH_SHADOWMAP_ALL&&Oe!==oe.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT&&Oe!==oe.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||this.parameters.castShadows}isVisible(){const Oe=this.parameters;if(!super.isVisible()||0===Oe.layerOpacity)return!1;const{instanced:$e,hasVertexColors:Be,hasSymbolColors:Se,vvColorEnabled:De}=Oe,Fe=(0,x.pC)($e)&&$e.includes("color"),ve="replace"===Oe.colorMixMode,Ke=Oe.opacity>0,qe=Oe.externalColor&&Oe.externalColor[3]>0;return Be&&(Fe||De||Se)?!!ve||Ke:Be?ve?qe:Ke:Fe||De||Se?!!ve||Ke:ve?qe:Ke}getConfiguration(Oe,$e){return this.techniqueConfig.output=Oe,this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId,this.techniqueConfig.hasColorTexture=!!this.parameters.textureId,this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents,this.techniqueConfig.instanced=!!this.parameters.instanced,this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.hasVerticalOffset=(0,x.pC)(this.parameters.verticalOffset),this.techniqueConfig.hasScreenSizePerspective=(0,x.pC)(this.parameters.screenSizePerspective),this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight,this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode,this.techniqueConfig.normalType="screenDerivative"===this.parameters.normals?J.h.ScreenDerivative:J.h.Attribute,this.techniqueConfig.transparent=this.parameters.transparent,this.techniqueConfig.writeDepth=this.parameters.writeDepth,(0,x.pC)(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest),this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?Z.Vr.None:this.parameters.cullFace,this.techniqueConfig.hasMultipassTerrain=$e.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=$e.multipassTerrain.cullAboveGround,this.techniqueConfig.hasModelTransformation=(0,x.pC)(this.parameters.modelTransformation),Oe!==re.H.Color&&Oe!==re.H.Alpha||(this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.techniqueConfig.doubleSidedMode=this.parameters.treeRendering?W.q.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?W.q.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?W.q.WindingOrder:W.q.None,this.techniqueConfig.instancedColor=(0,x.pC)(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=!!$e.ssaoHelper.ready&&this.parameters.receiveSSAO,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?B.f7.Schematic:B.f7.Normal:B.f7.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=$e.transparencyPassType,this.techniqueConfig.enableOffset=$e.camera.relativeElevation<ce.ve,this.techniqueConfig.snowCover=this.hasSnowCover($e)),this.techniqueConfig}hasSnowCover(Oe){return(0,x.pC)(Oe.weather)&&Oe.weatherVisible&&"snowy"===Oe.weather.type&&"enabled"===Oe.weather.snowCover}intersect(Oe,$e,Be,Se,De,Fe,ve){if((0,x.pC)(this.parameters.verticalOffset)){const Ke=Se.camera;(0,A.s)(We,Be[12],Be[13],Be[14]);let qe=null;switch(Se.viewingMode){case Q.JY.Global:qe=(0,A.n)(xe,We);break;case Q.JY.Local:qe=(0,A.c)(xe,Je)}let be=0;const tt=(0,A.b)(Ne,We,Ke.eye),Ye=(0,A.l)(tt),ze=(0,A.g)(tt,tt,1/Ye);let et=null;this.parameters.screenSizePerspective&&(et=(0,A.e)(qe,ze)),be+=(0,U.Hx)(Ke,Ye,this.parameters.verticalOffset,et,this.parameters.screenSizePerspective),(0,A.g)(qe,qe,be),(0,A.t)(je,qe,Se.transform.inverseRotation),De=(0,A.b)(Ie,De,je),Fe=(0,A.b)(Ge,Fe,je)}(0,U.Bw)(Oe,$e,Se,De,Fe,(0,j.W9)(Se.verticalOffset),ve)}requiresSlot(Oe){return Oe===(this.parameters.transparent?this.parameters.writeDepth?le.r.TRANSPARENT_MATERIAL:le.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:le.r.OPAQUE_MATERIAL)||Oe===le.r.DRAPED_MATERIAL}createGLMaterial(Oe){return Oe.output===re.H.Color||Oe.output===re.H.Alpha||Oe.output===re.H.Depth||Oe.output===re.H.Normal||Oe.output===re.H.Shadow||Oe.output===re.H.Highlight?new ye(Oe):null}createBufferWriter(){return new Te(this.vertexBufferLayout,this.instanceBufferLayout)}}class ye extends ie.F{constructor(Oe){super(or(or({},Oe),Oe.material.parameters))}_updateParameters(Oe){const $e=this._material.parameters;this.updateTexture($e.textureId);const Be=Oe.camera.viewInverseTransposeMatrix;return(0,A.s)($e.origin,Be[3],Be[7],Be[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique($e.treeRendering?he:ee.tT,Oe)}_updateShadowState(Oe){Oe.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:Oe.shadowMap.enabled})}_updateOccludeeState(Oe){Oe.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Oe.hasOccludees})}beginSlot(Oe){return this._output!==re.H.Color&&this._output!==re.H.Alpha||(this._updateShadowState(Oe),this._updateOccludeeState(Oe)),this._updateParameters(Oe)}}const Ee=new class Me extends ee.em{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};class Te{constructor(Oe,$e){this.vertexBufferLayout=Oe,this.instanceBufferLayout=$e}allocate(Oe){return this.vertexBufferLayout.createBuffer(Oe)}elementCount(Oe){return Oe.indices.get(Y.T.POSITION).length}write(Oe,$e,Be,Se){(0,X.NK)($e,this.vertexBufferLayout,Oe.transformation,Oe.invTranspTransformation,Be,Se)}}function Ce(we){let Oe=(0,H.U$)();return Oe=we.instancedDoublePrecision?Oe.vec3f(Y.T.MODELORIGINHI).vec3f(Y.T.MODELORIGINLO).mat3f(Y.T.MODEL).mat3f(Y.T.MODELNORMAL):Oe.mat4f(Y.T.MODEL).mat4f(Y.T.MODELNORMAL),(0,x.pC)(we.instanced)&&we.instanced.includes("color")&&(Oe=Oe.vec4f(Y.T.INSTANCECOLOR)),(0,x.pC)(we.instanced)&&we.instanced.includes("featureAttribute")&&(Oe=Oe.vec4f(Y.T.INSTANCEFEATUREATTRIBUTE)),Oe}const Ie=(0,G.c)(),Ge=(0,G.c)(),Je=(0,G.f)(0,0,1),xe=(0,G.c)(),je=(0,G.c)(),We=(0,G.c)(),Ne=(0,G.c)()},79331:(dt,Re,T)=>{"use strict";T.d(Re,{K:()=>x});const x=2.1},41528:(dt,Re,T)=>{"use strict";T.d(Re,{W:()=>Q});var x=T(17626),A=T(37847),G=T(87601);class Q extends G.m{}(0,x._)([(0,G.o)({constValue:!0})],Q.prototype,"hasSliceHighlight",void 0),(0,x._)([(0,G.o)({constValue:!1})],Q.prototype,"hasSliceInVertexProgram",void 0),(0,x._)([(0,G.o)({constValue:!1})],Q.prototype,"instancedDoublePrecision",void 0),(0,x._)([(0,G.o)({constValue:!1})],Q.prototype,"isGround",void 0),(0,x._)([(0,G.o)({constValue:A.P.Pass})],Q.prototype,"pbrTextureBindType",void 0)},7949:(dt,Re,T)=>{"use strict";T.d(Re,{w:()=>G});var x=T(28093),A=T(21799);class G extends A.Pf{constructor(H=(0,x.c)()){super(),this.origin=H,this.slicePlaneLocalOrigin=this.origin}}},80805:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>Be});var x=T(21286),A=T(62208),G=T(30217),Q=T(550),H=T(28347),re=T(43703),J=T(67831),W=T(99770),B=T(84161),Z=T(28093),ie=T(4794);var le=T(65401),Y=T(19625),j=T(6945),X=T(97347),U=T(36848),ee=T(33470),$=T(40723),ne=T(5894),se=T(17962),ae=T(2282),de=T(16396),_e=T(42037),pe=T(57623),he=T(65073),ge=T(6467),ye=T(59617),Me=T(651),Ee=T(91056),Te=T(42743),me=T(39114),Ce=T(88569),Ie=T(12407),Ge=T(67969),Je=T(2078);class xe extends Ee.A{initializeConfiguration(ct,jt){jt.spherical=ct.viewingMode===ye.JY.Global}initializeProgram(ct){const jt=xe.shader.get().build(this.configuration);return new Ie.$(ct.rctx,jt,me.i)}_setPipelineState(ct){const jt=this.configuration,qt=ct===Te.Am.NONE,Zt=this.configuration.hasPolygonOffset&&je,tr=!qt&&ct!==Te.Am.FrontFace||jt.output===j.H.Highlight?null:(jt.depthEnabled||jt.output===j.H.Occlusion)&&Je.LZ;return(0,Je.sm)({blending:jt.output===j.H.Color||jt.output===j.H.Alpha||jt.output===j.H.Highlight?qt?We:(0,Ce.j7)(ct):null,depthTest:{func:Ge.wb.LEQUAL},depthWrite:tr,colorWrite:Je.BK,polygonOffset:Zt})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.output===j.H.Occlusion?Ge.MX.POINTS:Ge.MX.TRIANGLES}}xe.shader=new Me.J(ge.H,()=>T.e(6771).then(T.bind(T,46771)));const je={factor:0,units:-4},We=(0,Je.if)(Ge.zi.ONE,Ge.zi.ONE_MINUS_SRC_ALPHA);var Ne=T(17626),we=T(87601),Oe=T(41528);class $e extends Oe.W{constructor(){super(...arguments),this.output=j.H.Color,this.screenCenterOffsetUnitsEnabled=X.d.World,this.transparencyPassType=Te.Am.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.isDraped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,Ne._)([(0,we.o)({count:j.H.COUNT})],$e.prototype,"output",void 0),(0,Ne._)([(0,we.o)({count:X.d.COUNT})],$e.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,Ne._)([(0,we.o)({count:Te.Am.COUNT})],$e.prototype,"transparencyPassType",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"spherical",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"occlusionTestEnabled",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"signedDistanceFieldEnabled",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"vvSize",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"vvColor",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"hasVerticalOffset",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"hasScreenSizePerspective",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"debugDrawLabelBorder",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"binaryHighlightOcclusionEnabled",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"hasSlicePlane",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"hasPolygonOffset",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"depthEnabled",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"pixelSnappingEnabled",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"isDraped",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"hasMultipassGeometry",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"hasMultipassTerrain",void 0),(0,Ne._)([(0,we.o)()],$e.prototype,"cullAboveGround",void 0),(0,Ne._)([(0,we.o)({constValue:!0})],$e.prototype,"hasSliceInVertexProgram",void 0),(0,Ne._)([(0,we.o)({constValue:!1})],$e.prototype,"hasVvInstancing",void 0);class Be extends $.F5{constructor(ct){super(ct,new Mr),this.techniqueConfig=new $e}getConfiguration(ct,jt){return this.techniqueConfig.output=ct,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset,this.techniqueConfig.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?X.d.Screen:X.d.World,this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset,this.techniqueConfig.isDraped=this.parameters.isDraped,this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest,this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled,this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled,ct===j.H.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder),ct===j.H.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this.techniqueConfig.depthEnabled=this.parameters.depthEnabled,this.techniqueConfig.transparencyPassType=jt.transparencyPassType,this.techniqueConfig.hasMultipassGeometry=jt.multipassGeometry.enabled,this.techniqueConfig.hasMultipassTerrain=jt.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=jt.multipassTerrain.cullAboveGround,this.techniqueConfig}intersect(ct,jt,qt,er,Zt,tr,ir,fr,Ur){(0,A.pC)(Ur)?this._intersectDrapedHudGeometry(ct,tr,ir,fr,Ur):this._intersectHudGeometry(ct,jt,qt,er,ir,fr)}_intersectDrapedHudGeometry(ct,jt,qt,er,Zt){const tr=ct.vertexAttributes.get(de.T.POSITION),ir=ct.vertexAttributes.get(de.T.SIZE),fr=this.parameters,Ur=(0,ge.c)(fr);let Br=1,Zr=1;if((0,A.pC)(er)){const hr=er(Rt);Br=hr[0],Zr=hr[5]}Br*=ct.screenToWorldRatio,Zr*=ct.screenToWorldRatio;const ri=bt*ct.screenToWorldRatio;for(let hr=0;hr<tr.data.length/tr.size;hr++){const Dr=hr*tr.size,Kr=tr.data[Dr],Nt=tr.data[Dr+1],lr=hr*ir.size;let jr;St[0]=ir.data[lr]*Br,St[1]=ir.data[lr+1]*Zr,fr.textureIsSignedDistanceField&&(jr=fr.outlineSize*ct.screenToWorldRatio/2),Ke(jt,Kr,Nt,St,ri,jr,fr,Ur)&&qt(Zt.dist,Zt.normal,-1,!1)}}_intersectHudGeometry(ct,jt,qt,er,Zt,tr){if(!er.options.selectionMode||!er.options.hud||(0,he.PD)(jt))return;const ir=this.parameters;let fr=1,Ur=1;if((0,G.f)(ot,qt),(0,A.pC)(tr)){const jr=tr(Rt);fr=jr[0],Ur=jr[5],function ve(Lr){const ct=Lr[0],jt=Lr[1],qt=Lr[2],er=Lr[3],Zt=Lr[4],tr=Lr[5],ir=Lr[6],fr=Lr[7],Ur=Lr[8],Br=1/Math.sqrt(ct*ct+jt*jt+qt*qt),Zr=1/Math.sqrt(er*er+Zt*Zt+tr*tr),ri=1/Math.sqrt(ir*ir+fr*fr+Ur*Ur);Lr[0]=ct*Br,Lr[1]=jt*Br,Lr[2]=qt*Br,Lr[3]=er*Zr,Lr[4]=Zt*Zr,Lr[5]=tr*Zr,Lr[6]=ir*ri,Lr[7]=fr*ri,Lr[8]=Ur*ri}(ot)}const Br=ct.vertexAttributes.get(de.T.POSITION),Zr=ct.vertexAttributes.get(de.T.SIZE),ri=ct.vertexAttributes.get(de.T.NORMAL),hr=ct.vertexAttributes.get(de.T.AUXPOS1);(0,ae.hu)(Br.size>=3);const Dr=er.point,Kr=er.camera,Nt=(0,ge.c)(ir);fr*=Kr.pixelRatio,Ur*=Kr.pixelRatio;const lr="screen"===this.parameters.centerOffsetUnits;for(let jr=0;jr<Br.data.length/Br.size;jr++){const Ot=jr*Br.size;(0,B.s)(tt,Br.data[Ot],Br.data[Ot+1],Br.data[Ot+2]),(0,B.m)(tt,tt,qt);const rr=jr*Zr.size;St[0]=Zr.data[rr]*fr,St[1]=Zr.data[rr+1]*Ur,(0,B.m)(tt,tt,Kr.viewMatrix);const pr=jr*hr.size;if((0,B.s)(wt,hr.data[pr+0],hr.data[pr+1],hr.data[pr+2]),!lr&&(tt[0]+=wt[0],tt[1]+=wt[1],0!==wt[2])){const Fr=wt[2];(0,B.n)(wt,tt),(0,B.b)(tt,tt,(0,B.g)(wt,wt,Fr))}const Pr=jr*ri.size;if((0,B.s)(Ye,ri.data[Pr],ri.data[Pr+1],ri.data[Pr+2]),this._normalAndViewAngle(Ye,ot,Kr,zt),this._applyVerticalOffsetTransformationView(tt,zt,Kr,qe),Kr.applyProjection(tt,ze),ze[0]>-1){let ii;if(ze[0]=Math.floor(ze[0]),ze[1]=Math.floor(ze[1]),lr&&(wt[0]||wt[1])&&(ze[0]+=wt[0],0!==wt[1]&&(ze[1]+=(0,se.sX)(wt[1],qe.factorAlignment)),Kr.unapplyProjection(ze,tt)),ze[0]+=this.parameters.screenOffset[0],ze[1]+=this.parameters.screenOffset[1],(0,se.TU)(St,qe.factor,St),ir.textureIsSignedDistanceField&&(ii=ir.outlineSize*Kr.pixelRatio/2),Ke(Dr,ze[0],ze[1],St,Ft*Kr.pixelRatio,ii,ir,Nt)){const mi=er.ray;if((0,B.m)(ke,tt,(0,H.a)(yt,Kr.viewMatrix)),ze[0]=Dr[0],ze[1]=Dr[1],Kr.unprojectFromRenderScreen(ze,tt)){const wi=(0,Z.c)();(0,B.c)(wi,mi.direction);const Qr=1/(0,B.l)(wi);(0,B.g)(wi,wi,Qr),Zt((0,B.i)(mi.origin,tt)*Qr,wi,-1,!0,1,ke)}}}}}computeAttachmentOrigin(ct,jt){const qt=ct.vertexAttributes;if(!qt)return!1;const er=qt.get(de.T.POSITION),Zt=ct.indices.get(de.T.POSITION);return(0,U.NO)(er,Zt,jt)}createBufferWriter(){return new Yr(this)}_normalAndViewAngle(ct,jt,qt,er){return function oe(Lr){return function ue(Lr){return Lr instanceof Float32Array&&Lr.length>=16}(Lr)||function ce(Lr){return Array.isArray(Lr)&&Lr.length>=16}(Lr)}(jt)&&(jt=(0,G.f)(at,jt)),(0,B.t)(er.normal,ct,jt),(0,B.m)(er.normal,er.normal,qt.viewInverseTransposeMatrix),er.cosAngle=(0,B.e)(et,Xt),er}_updateScaleInfo(ct,jt,qt){const er=this.parameters;(0,A.pC)(er.screenSizePerspective)?(0,se.PV)(qt,jt,er.screenSizePerspective,ct.factor):(ct.factor.scale=1,ct.factor.factor=0,ct.factor.minPixelSize=0,ct.factor.paddingPixels=0),(0,A.pC)(er.screenSizePerspectiveAlignment)?(0,se.PV)(qt,jt,er.screenSizePerspectiveAlignment,ct.factorAlignment):(ct.factorAlignment.factor=ct.factor.factor,ct.factorAlignment.scale=ct.factor.scale,ct.factorAlignment.minPixelSize=ct.factor.minPixelSize,ct.factorAlignment.paddingPixels=ct.factor.paddingPixels)}applyShaderOffsetsView(ct,jt,qt,er,Zt,tr,ir){const fr=this._normalAndViewAngle(jt,qt,Zt,zt);return this._applyVerticalGroundOffsetView(ct,fr,Zt,ir),this._applyVerticalOffsetTransformationView(ir,fr,Zt,tr),this._applyPolygonOffsetView(ir,fr,er[3],Zt,ir),this._applyCenterOffsetView(ir,er,ir),ir}applyShaderOffsetsNDC(ct,jt,qt,er,Zt){return this._applyCenterOffsetNDC(ct,jt,qt,er),(0,A.pC)(Zt)&&(0,B.c)(Zt,er),this._applyPolygonOffsetNDC(er,jt,qt,er),er}_applyPolygonOffsetView(ct,jt,qt,er,Zt){const tr=er.aboveGround?1:-1;let ir=Math.sign(qt);0===ir&&(ir=tr);const fr=tr*ir;if(this.parameters.shaderPolygonOffset<=0)return(0,B.c)(Zt,ct);const Ur=(0,x.uZ)(Math.abs(jt.cosAngle),.01,1),Br=1-Math.sqrt(1-Ur*Ur)/Ur/er.viewport[2];return(0,B.g)(Zt,ct,fr>0?Br:1/Br),Zt}_applyVerticalGroundOffsetView(ct,jt,qt,er){const Zt=(0,B.l)(ct),tr=qt.aboveGround?1:-1,ir=.5*qt.computeRenderPixelSizeAtDist(Zt),fr=(0,B.g)(tt,jt.normal,tr*ir);return(0,B.a)(er,ct,fr),er}_applyVerticalOffsetTransformationView(ct,jt,qt,er){const Zt=this.parameters;if(!Zt.verticalOffset||!Zt.verticalOffset.screenLength){if(Zt.screenSizePerspective||Zt.screenSizePerspectiveAlignment){const Ur=(0,B.l)(ct);this._updateScaleInfo(er,Ur,jt.cosAngle)}else er.factor.scale=1,er.factorAlignment.scale=1;return ct}const tr=(0,B.l)(ct),ir=(0,A.Pt)(Zt.screenSizePerspectiveAlignment,Zt.screenSizePerspective),fr=(0,pe.Hx)(qt,tr,Zt.verticalOffset,jt.cosAngle,ir);return this._updateScaleInfo(er,tr,jt.cosAngle),(0,B.g)(jt.normal,jt.normal,fr),(0,B.a)(ct,ct,jt.normal)}_applyCenterOffsetView(ct,jt,qt){const er="screen"!==this.parameters.centerOffsetUnits;return qt!==ct&&(0,B.c)(qt,ct),er&&(qt[0]+=jt[0],qt[1]+=jt[1],jt[2]&&((0,B.n)(Ye,qt),(0,B.a)(qt,qt,(0,B.g)(Ye,Ye,jt[2])))),qt}_applyCenterOffsetNDC(ct,jt,qt,er){const Zt="screen"!==this.parameters.centerOffsetUnits;return er!==ct&&(0,B.c)(er,ct),Zt||(er[0]+=jt[0]/qt.fullWidth*2,er[1]+=jt[1]/qt.fullHeight*2),er}_applyPolygonOffsetNDC(ct,jt,qt,er){const Zt=this.parameters.shaderPolygonOffset;if(ct!==er&&(0,B.c)(er,ct),Zt){const tr=qt.aboveGround?1:-1,ir=tr*Math.sign(jt[3]);er[2]-=(ir||tr)*Zt}return er}requiresSlot(ct){if(ct===ne.r.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:jt,occlusionTest:qt}=this.parameters;return ct===(jt?ne.r.LABEL_MATERIAL:ne.r.HUD_MATERIAL)||qt&&ct===ne.r.OCCLUSION_PIXELS}createGLMaterial(ct){return ct.output===j.H.Color||ct.output===j.H.Alpha?new De(ct):ct.output===j.H.Highlight?new Se(ct):null}calculateRelativeScreenBounds(ct,jt,qt=(0,le.Ue)()){return function Fe(Lr,ct,jt,qt=be){(0,J.c)(qt,Lr.anchorPosition),qt[0]*=-ct[0],qt[1]*=-ct[1],qt[0]+=Lr.screenOffset[0]*jt,qt[1]+=Lr.screenOffset[1]*jt}(this.parameters,ct,jt,qt),qt[2]=qt[0]+ct[0],qt[3]=qt[1]+ct[1],qt}}class Se extends ee.F{constructor(ct){super(or(or({},ct),ct.material.parameters))}selectProgram(ct){return this.ensureTechnique(xe,ct)}beginSlot(ct){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(ct)}}class De extends Se{_isOcclusionSlot(ct){return ct.slot===ne.r.OCCLUSION_PIXELS&&this._material.parameters.occlusionTest&&(this._output===j.H.Color||this._output===j.H.Alpha)}selectProgram(ct){return this.ensureTechnique(xe,ct,this._isOcclusionSlot(ct)?j.H.Occlusion:this._output)}}function Ke(Lr,ct,jt,qt,er,Zt,tr,ir){let fr=ct-er-(ir[0]>0?qt[0]*ir[0]:0),Ur=fr+qt[0]+2*er,Br=jt-er-(ir[1]>0?qt[1]*ir[1]:0),Zr=Br+qt[1]+2*er;const ri=tr.distanceFieldBoundingBox;return tr.textureIsSignedDistanceField&&(0,A.pC)(ri)&&(fr+=qt[0]*ri[0],Br+=qt[1]*ri[1],Ur-=qt[0]*(1-ri[2]),Zr-=qt[1]*(1-ri[3]),fr-=Zt,Ur+=Zt,Br-=Zt,Zr+=Zt),Lr[0]>fr&&Lr[0]<Ur&&Lr[1]>Br&&Lr[1]<Zr}const qe={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},be=(0,W.a)(),tt=(0,Z.c)(),Ye=(0,Z.c)(),ze=(0,ie.c)(),et=(0,Z.c)(),ke=(0,Z.c)(),ot=(0,Q.c)(),at=(0,Q.c)(),yt=(0,re.c)(),wt=(0,Z.c)(),zt={normal:et,cosAngle:0},Rt=(0,re.c)(),Ft=1,bt=2,St=[0,0],Xt=(0,Z.f)(0,0,1);class Mr extends ee.E{constructor(){super(...arguments),this.renderOccluded=$.yD.Occlude,this.color=[1,1,1,1],this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,W.f)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=[1,1,1,1],this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.debugDrawLabelBorder=!1,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const Cr=(0,Y.U$)().vec3f(de.T.POSITION).vec3f(de.T.NORMAL).vec2f(de.T.UV0).vec4u8(de.T.COLOR).vec2f(de.T.SIZE).vec4f(de.T.AUXPOS1).vec4f(de.T.AUXPOS2);class Yr{constructor(ct){this.material=ct,this.vertexBufferLayout=Cr}allocate(ct){return this.vertexBufferLayout.createBuffer(ct)}elementCount(ct){return 6*ct.indices.get(de.T.POSITION).length}write(ct,jt,qt,er){(0,_e.ho)(jt.indices.get(de.T.POSITION),jt.vertexAttributes.get(de.T.POSITION).data,ct.transformation,qt.position,er,6),(0,_e.s5)(jt.indices.get(de.T.NORMAL),jt.vertexAttributes.get(de.T.NORMAL).data,ct.invTranspTransformation,qt.normal,er,6);{const Zt=jt.vertexAttributes.get(de.T.UV0).data;let tr,ir,fr,Ur;if(null==Zt||Zt.length<4){const hr=this.material.parameters;tr=0,ir=0,fr=hr.texCoordScale[0],Ur=hr.texCoordScale[1]}else tr=Zt[0],ir=Zt[1],fr=Zt[2],Ur=Zt[3];fr=Math.min(1.99999,fr+1),Ur=Math.min(1.99999,Ur+1);const Br=jt.indices.get(de.T.POSITION).length,Zr=qt.uv0;let ri=er;for(let hr=0;hr<Br;++hr)Zr.set(ri,0,tr),Zr.set(ri,1,ir),ri+=1,Zr.set(ri,0,fr),Zr.set(ri,1,ir),ri+=1,Zr.set(ri,0,fr),Zr.set(ri,1,Ur),ri+=1,Zr.set(ri,0,fr),Zr.set(ri,1,Ur),ri+=1,Zr.set(ri,0,tr),Zr.set(ri,1,Ur),ri+=1,Zr.set(ri,0,tr),Zr.set(ri,1,ir),ri+=1}(0,_e.Vs)(jt.indices.get(de.T.COLOR),jt.vertexAttributes.get(de.T.COLOR).data,4,qt.color,er,6);{const Zt=jt.indices.get(de.T.SIZE),tr=jt.vertexAttributes.get(de.T.SIZE).data,ir=Zt.length,fr=qt.size;let Ur=er;for(let Br=0;Br<ir;++Br){const Zr=tr[2*Zt[Br]],ri=tr[2*Zt[Br]+1];for(let hr=0;hr<6;++hr)fr.set(Ur,0,Zr),fr.set(Ur,1,ri),Ur+=1}}jt.indices.get(de.T.AUXPOS1)&&jt.vertexAttributes.get(de.T.AUXPOS1)&&(0,_e.SW)(jt.indices.get(de.T.AUXPOS1),jt.vertexAttributes.get(de.T.AUXPOS1).data,qt.auxpos1,er,6),jt.indices.get(de.T.AUXPOS2)&&jt.vertexAttributes.get(de.T.AUXPOS2)&&(0,_e.SW)(jt.indices.get(de.T.AUXPOS2),jt.vertexAttributes.get(de.T.AUXPOS2).data,qt.auxpos2,er,6)}}},49580:(dt,Re,T)=>{"use strict";T.d(Re,{Y:()=>Je});var x=T(63290),A=T(62208),G=T(23841),Q=T(67831),H=T(84161),re=T(28093),J=T(4794),W=T(8834),B=T(13777),Z=T(90014),ie=T(60479),ue=T(6945),ce=T(36848),oe=T(60881),le=T(40723),Y=T(5894),j=T(2282),X=T(16396),U=T(42037),ee=T(60909),$=T(57623),ne=T(65073),se=T(651),ae=T(91056),de=T(39114),_e=T(12407),pe=T(64127),he=T(32616),ge=T(67969),ye=T(2078);class Me extends ae.A{constructor(at,yt,wt){super(at,yt,wt),this.stipplePattern=null,this.stippleTextureBind=null,this.stippleTextureRepository=at.stippleTextureRepository}get stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==ue.H.Highlight}initializeProgram(at){const yt=Me.shader.get().build(this.configuration);return new _e.$(at.rctx,yt,de.i)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(at,yt){if(this.program.bindPass(at,yt),this.stipplePattern!==at.stipplePattern){const wt=at.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,wt),this.stipplePattern=wt}if(this.stippleEnabled){const{pixelSize:wt,sdfNormalizer:zt,pixels:Rt}=(0,A.pC)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",zt),this.program.setUniform1f("stipplePatternTextureSize",Rt),this.program.setUniform1f("stipplePatternPixelSize",wt),this.program.setUniform1f("stipplePatternPixelSizeInv",1/wt)}}initializePipeline(){const at=this.configuration,yt=(0,ye.wK)(ge.zi.SRC_ALPHA,ge.zi.ONE,ge.zi.ONE_MINUS_SRC_ALPHA,ge.zi.ONE_MINUS_SRC_ALPHA),wt=(zt,Rt=null,Ft=null)=>(0,ye.sm)({blending:Rt,depthTest:pe.JN,depthWrite:Ft,colorWrite:ye.BK,stencilWrite:at.hasOccludees?pe.s3:null,stencilTest:at.hasOccludees?zt?pe.eD:pe.RY:null});return at.output===ue.H.Color?(this._occludeePipelineState=wt(!0,at.transparent||this.stippleEnabled?yt:null,ye.LZ),wt(!1,at.transparent||this.stippleEnabled?yt:null,ye.LZ)):wt(!1)}get primitiveType(){return ge.MX.LINES}getPipelineState(at,yt){return yt?this._occludeePipelineState:super.getPipelineState(at,yt)}}Me.shader=new se.J(he.N,()=>T.e(310).then(T.bind(T,20310)));var Ee=T(17626),Te=T(87601),me=T(41528);class Ce extends me.W{constructor(){super(...arguments),this.output=ue.H.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}(0,Ee._)([(0,Te.o)({count:ue.H.COUNT})],Ce.prototype,"output",void 0),(0,Ee._)([(0,Te.o)()],Ce.prototype,"hasSlicePlane",void 0),(0,Ee._)([(0,Te.o)()],Ce.prototype,"hasVertexColors",void 0),(0,Ee._)([(0,Te.o)()],Ce.prototype,"transparent",void 0),(0,Ee._)([(0,Te.o)()],Ce.prototype,"draped",void 0),(0,Ee._)([(0,Te.o)()],Ce.prototype,"stippleEnabled",void 0),(0,Ee._)([(0,Te.o)()],Ce.prototype,"stippleOffColorEnabled",void 0),(0,Ee._)([(0,Te.o)()],Ce.prototype,"stipplePreferContinuous",void 0),(0,Ee._)([(0,Te.o)()],Ce.prototype,"hasOccludees",void 0),(0,Ee._)([(0,Te.o)({constValue:!1})],Ce.prototype,"stippleRequiresClamp",void 0),(0,Ee._)([(0,Te.o)({constValue:!1})],Ce.prototype,"stippleScaleWithLineWidth",void 0),(0,Ee._)([(0,Te.o)({constValue:!1})],Ce.prototype,"stippleRequiresStretchMeasure",void 0);const Ie=x.Z.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var Ge,ot;(ot=Ge||(Ge={}))[ot.START=0]="START",ot[ot.END=1]="END";class Je extends le.F5{constructor(at){super(at,new We),this._techniqueConfig=new Ce}getConfiguration(at,yt){this._techniqueConfig.output=at,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,this._techniqueConfig.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._techniqueConfig.draped=yt.slot===Y.r.DRAPED_MATERIAL;const wt=(0,A.pC)(this.parameters.stipplePattern);return this._techniqueConfig.stippleEnabled=wt,this._techniqueConfig.stippleOffColorEnabled=wt&&(0,A.pC)(this.parameters.stippleOffColor),this._techniqueConfig.hasOccludees=this.parameters.hasOccludees,this._techniqueConfig.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._techniqueConfig}intersect(at,yt,wt,zt,Rt,Ft,bt,St,Xt){(0,A.pC)(Xt)?(0,$.TT)(at,zt,Xt,Ft,1,bt):this._intersectLineGeometry(at,yt,wt,zt,bt)}_intersectLineGeometry(at,yt,wt,zt,Rt){if(!zt.options.selectionMode||(0,ne.PD)(yt))return;if(!(0,j.kG)(wt))return void Ie.error("intersection assumes a translation-only matrix");const Ft=at.vertexAttributes.get(X.T.POSITION).data,bt=zt.camera,St=qe;(0,Q.c)(St,zt.point),(0,H.s)(be[0],St[0]-2,St[1]+2,0),(0,H.s)(be[1],St[0]+2,St[1]+2,0),(0,H.s)(be[2],St[0]+2,St[1]-2,0),(0,H.s)(be[3],St[0]-2,St[1]-2,0);for(let ct=0;ct<4;ct++)if(!bt.unprojectFromRenderScreen(be[ct],tt[ct]))return;(0,Z.zk)(bt.eye,tt[0],tt[1],Ye),(0,Z.zk)(bt.eye,tt[1],tt[2],ze),(0,Z.zk)(bt.eye,tt[2],tt[3],et),(0,Z.zk)(bt.eye,tt[3],tt[0],ke);let Mr=Number.MAX_VALUE,Cr=0;for(let ct=0;ct<Ft.length-5;ct+=3){if(Ne[0]=Ft[ct]+wt[12],Ne[1]=Ft[ct+1]+wt[13],Ne[2]=Ft[ct+2]+wt[14],we[0]=Ft[ct+3]+wt[12],we[1]=Ft[ct+4]+wt[13],we[2]=Ft[ct+5]+wt[14],(0,Z.jH)(Ye,Ne)<0&&(0,Z.jH)(Ye,we)<0||(0,Z.jH)(ze,Ne)<0&&(0,Z.jH)(ze,we)<0||(0,Z.jH)(et,Ne)<0&&(0,Z.jH)(et,we)<0||(0,Z.jH)(ke,Ne)<0&&(0,Z.jH)(ke,we)<0)continue;if(bt.projectToRenderScreen(Ne,Be),bt.projectToRenderScreen(we,Se),Be[2]<0&&Se[2]>0){(0,H.b)(Oe,Ne,we);const qt=bt.frustum,er=-(0,Z.jH)(qt[W.Nu.NEAR],Ne)/(0,H.e)(Oe,(0,Z.mJ)(qt[W.Nu.NEAR]));(0,H.g)(Oe,Oe,er),(0,H.a)(Ne,Ne,Oe),bt.projectToRenderScreen(Ne,Be)}else if(Be[2]>0&&Se[2]<0){(0,H.b)(Oe,we,Ne);const qt=bt.frustum,er=-(0,Z.jH)(qt[W.Nu.NEAR],we)/(0,H.e)(Oe,(0,Z.mJ)(qt[W.Nu.NEAR]));(0,H.g)(Oe,Oe,er),(0,H.a)(we,we,Oe),bt.projectToRenderScreen(we,Se)}else if(Be[2]<0&&Se[2]<0)continue;Be[2]=0,Se[2]=0;const jt=(0,B.Jk)((0,B.zk)(Be,Se,ve),St);jt<Mr&&(Mr=jt,(0,H.c)(De,Ne),(0,H.c)(Fe,we),Cr=ct/3)}const Yr=zt.rayBegin,Lr=zt.rayEnd;if(Mr<4){let ct=Number.MAX_VALUE;if((0,B.AR)((0,B.zk)(De,Fe,ve),(0,B.zk)(Yr,Lr,Ke),$e)){(0,H.b)($e,$e,Yr);const jt=(0,H.l)($e);(0,H.g)($e,$e,1/jt),ct=jt/(0,H.i)(Yr,Lr)}Rt(ct,$e,Cr,!1)}}computeAttachmentOrigin(at,yt){const wt=at.vertexAttributes;if(!wt)return!1;const zt=wt.get(X.T.POSITION);return(0,ce.qZ)(zt,null,!1,yt)}requiresSlot(at){return at===Y.r.OPAQUE_MATERIAL||at===Y.r.DRAPED_MATERIAL}createGLMaterial(at){return at.output===ue.H.Color||at.output===ue.H.Highlight?new xe(at):null}createBufferWriter(){const at=this.parameters.hasVertexColors?ee.IM:ee.wp;return(0,A.Wi)(this.parameters.stipplePattern)?new ee.G_(at):new je(at.clone().vec3f(X.T.AUXPOS1).vec2f(X.T.UV0))}}class xe extends oe.Z{_updateOccludeeState(at){at.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:at.hasOccludees})}beginSlot(at){return this._output===ue.H.Color&&this._updateOccludeeState(at),this.ensureTechnique(Me,at)}}class je{constructor(at){this.vertexBufferLayout=at}allocate(at){return this.vertexBufferLayout.createBuffer(at)}elementCount(at){return at.indices.get(X.T.POSITION).length}write(at,yt,wt,zt){(0,U.NK)(yt,this.vertexBufferLayout,at.transformation,at.invTranspTransformation,wt,zt),this._writeAuxpos1(at,yt,wt,zt),this._writeUV0(at,yt,wt,zt)}_writeAuxpos1(at,yt,wt,zt){const Rt=wt.getField(X.T.AUXPOS1,ie.ct),Ft=yt.indices.get(X.T.POSITION),bt=yt.vertexAttributes.get(X.T.POSITION).data,St=at.transformation,Xt=Rt.typedBufferStride,Mr=Rt.typedBuffer;zt*=Xt;for(let Cr=0;Cr<Ft.length-1;Cr+=2)for(const Yr of[1,0]){const Lr=3*Ft[Cr+Yr],ct=bt[Lr],jt=bt[Lr+1],qt=bt[Lr+2],Zt=St[1]*ct+St[5]*jt+St[9]*qt+St[13],tr=St[2]*ct+St[6]*jt+St[10]*qt+St[14];Mr[zt]=St[0]*ct+St[4]*jt+St[8]*qt+St[12],Mr[zt+1]=Zt,Mr[zt+2]=tr,zt+=Xt}}_writeUV0(at,yt,wt,zt){var ir;const Rt=wt.getField(X.T.UV0,ie.Eu),Ft=yt.indices.get(X.T.POSITION),bt=yt.vertexAttributes.get(X.T.POSITION).data,St=null==(ir=yt.vertexAttributes.get(X.T.DISTANCETOSTART))?void 0:ir.data,Xt=at.transformation,Mr=Rt.typedBufferStride,Cr=Rt.typedBuffer;let Yr=0;Cr[zt*=Mr]=Ge.START,Cr[zt+1]=Yr,zt+=Mr;const Lr=3*Ft[0],ct=(0,H.s)(Ne,bt[Lr],bt[Lr+1],bt[Lr+2]);Xt&&(0,H.m)(ct,ct,Xt);const jt=we,qt=Ft.length-1;let er=1;const Zt=St?(fr,Ur,Br)=>Yr=St[Br]:(fr,Ur,Br)=>Yr+=(0,H.i)(fr,Ur);for(let fr=1;fr<qt;fr+=2){const Ur=3*Ft[fr];(0,H.s)(jt,bt[Ur],bt[Ur+1],bt[Ur+2]),Xt&&(0,H.m)(jt,jt,Xt),Zt(ct,jt,er++);for(let Br=0;Br<2;++Br)Cr[zt]=1-Br,Cr[zt+1]=Yr,zt+=Mr;(0,H.c)(ct,jt)}const tr=3*Ft[qt];(0,H.s)(jt,bt[tr],bt[tr+1],bt[tr+2]),Xt&&(0,H.m)(jt,jt,Xt),Zt(ct,jt,er),Cr[zt]=Ge.END,Cr[zt+1]=Yr}}class We extends le.Mt{constructor(){super(...arguments),this.color=J.O,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}}const Ne=(0,re.c)(),we=(0,re.c)(),Oe=(0,re.c)(),$e=(0,re.c)(),Be=(0,G.J$)(),Se=(0,G.J$)(),De=(0,re.c)(),Fe=(0,re.c)(),ve=(0,B.Ue)(),Ke=(0,B.Ue)(),qe=(0,re.c)(),be=[(0,G.J$)(),(0,G.J$)(),(0,G.J$)(),(0,G.J$)()],tt=[(0,re.c)(),(0,re.c)(),(0,re.c)(),(0,re.c)()],Ye=(0,Z.Ue)(),ze=(0,Z.Ue)(),et=(0,Z.Ue)(),ke=(0,Z.Ue)()},95402:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{b:()=>x}),(A=x||(x={}))[A.Horizontal=0]="Horizontal",A[A.Vertical=1]="Vertical",A[A.Cross=2]="Cross",A[A.ForwardDiagonal=3]="ForwardDiagonal",A[A.BackwardDiagonal=4]="BackwardDiagonal",A[A.DiagonalCross=5]="DiagonalCross",A[A.COUNT=6]="COUNT"},92222:(dt,Re,T)=>{"use strict";T.d(Re,{U:()=>Je});var x=T(63290),A=T(21286),G=T(62208),Q=T(23841),H=T(67831),re=T(84161),J=T(28093),W=T(4794),B=T(8834),Z=T(13777),ie=T(90014),ue=T(19625),ce=T(6945),oe=T(36848),le=T(60881),Y=T(32393),j=T(40723),X=T(5894),U=T(2282),ee=T(16396),$=T(41857),ne=T(65073),se=T(3393),ae=T(651),de=T(91056),_e=T(42743),pe=T(88569),he=T(12407),ge=T(64127),ye=T(67969),Me=T(2078);const Ee=new Map([[ee.T.POSITION,0],[ee.T.SUBDIVISIONFACTOR,1],[ee.T.UV0,2],[ee.T.AUXPOS1,3],[ee.T.AUXPOS2,4],[ee.T.COLOR,5],[ee.T.COLORFEATUREATTRIBUTE,5],[ee.T.SIZE,6],[ee.T.SIZEFEATUREATTRIBUTE,6],[ee.T.OPACITYFEATUREATTRIBUTE,7]]);class Te extends de.A{constructor(bt,St,Xt){super(bt,St,Xt),this.stippleTextureRepository=bt.stippleTextureRepository}initializeProgram(bt){const St=Te.shader.get().build(this.configuration);return new he.$(bt.rctx,St,Ee)}destroy(){super.destroy(),this.stippleTextureRepository.release(this.stipplePattern),this.stipplePattern=null,this.stippleTextureBind=null}bindPass(bt,St){if(this.program.bindPass(bt,St),this.stipplePattern!==bt.stipplePattern){const Xt=bt.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,Xt),this.stipplePattern=Xt}if(this.configuration.stippleEnabled){const{pixelSize:Xt,sdfNormalizer:Mr,pixels:Cr}=(0,G.pC)(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",Mr),this.program.setUniform1f("stipplePatternTextureSize",Cr),this.program.setUniform1f("stipplePatternPixelSize",Xt),this.program.setUniform1f("stipplePatternPixelSizeInv",1/Xt)}}_makePipelineState(bt,St){const Xt=this.configuration,Mr=bt===_e.Am.NONE,Cr=bt===_e.Am.FrontFace;return(0,Me.sm)({blending:Xt.output===ce.H.Color||Xt.output===ce.H.Alpha?Mr?pe.wu:(0,pe.j7)(bt):null,depthTest:{func:(0,pe.Bh)(bt)},depthWrite:Mr?Xt.writeDepth&&Me.LZ:(0,pe.K5)(bt),colorWrite:Me.BK,stencilWrite:Xt.hasOccludees?ge.s3:null,stencilTest:Xt.hasOccludees?St?ge.eD:ge.RY:null,polygonOffset:Mr||Cr?Xt.hasPolygonOffset&&me:pe.E0})}initializePipeline(){const bt=this.configuration;if(bt.occluder){const St=bt.hasPolygonOffset&&me;this._occluderPipelineTransparent=(0,Me.sm)({blending:pe.wu,polygonOffset:St,depthTest:ge.zV,depthWrite:null,colorWrite:Me.BK,stencilWrite:null,stencilTest:ge.YD}),this._occluderPipelineOpaque=(0,Me.sm)({blending:pe.wu,polygonOffset:St,depthTest:ge.zV,depthWrite:null,colorWrite:Me.BK,stencilWrite:ge.P7,stencilTest:ge.ii}),this._occluderPipelineMaskWrite=(0,Me.sm)({blending:null,polygonOffset:St,depthTest:ge.JN,depthWrite:null,colorWrite:null,stencilWrite:ge.s3,stencilTest:ge.eD})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?ye.MX.LINES:ye.MX.TRIANGLE_STRIP}getPipelineState(bt,St){return St?this._occludeePipelineState:this.configuration.occluder?bt===X.r.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:bt===X.r.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(bt,St)}}Te.shader=new ae.J(se.R,()=>T.e(4346).then(T.bind(T,84346)));const me={factor:0,units:-4};var Ce=T(39401);const Ie=x.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var Ge,Ft;(Ft=Ge||(Ge={}))[Ft.LEFT_JOIN_START=-2]="LEFT_JOIN_START",Ft[Ft.LEFT_JOIN_END=-1]="LEFT_JOIN_END",Ft[Ft.LEFT_CAP_START=-4]="LEFT_CAP_START",Ft[Ft.LEFT_CAP_END=-5]="LEFT_CAP_END",Ft[Ft.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",Ft[Ft.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",Ft[Ft.RIGHT_CAP_START=4]="RIGHT_CAP_START",Ft[Ft.RIGHT_CAP_END=5]="RIGHT_CAP_END";class Je extends j.F5{constructor(bt){super(bt,new je),this._vertexAttributeLocations=Ee,this.techniqueConfig=new Ce.G,this.layout=this.createLayout()}isClosed(bt,St){return Oe(this.parameters,bt,St)}getConfiguration(bt,St){this.techniqueConfig.output=bt,this.techniqueConfig.draped=St.slot===X.r.DRAPED_MATERIAL;const Xt=(0,G.pC)(this.parameters.stipplePattern)&&bt!==ce.H.Highlight;return this.techniqueConfig.stippleEnabled=Xt,this.techniqueConfig.stippleOffColorEnabled=Xt&&(0,G.pC)(this.parameters.stippleOffColor),this.techniqueConfig.stippleScaleWithLineWidth=Xt&&this.parameters.stippleScaleWithLineWidth,this.techniqueConfig.stipplePreferContinuous=Xt&&this.parameters.stipplePreferContinuous,this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this.techniqueConfig.hasOccludees=this.parameters.hasOccludees,this.techniqueConfig.roundJoins="round"===this.parameters.join,this.techniqueConfig.capType=this.parameters.cap,this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset,this.techniqueConfig.writeDepth=this.parameters.writeDepth,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled,this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled,this.techniqueConfig.innerColorEnabled=this.parameters.innerWidth>0&&(0,G.pC)(this.parameters.innerColor),this.techniqueConfig.falloffEnabled=this.parameters.falloff>0,this.techniqueConfig.occluder=this.parameters.renderOccluded===j.yD.OccludeAndTransparentStencil,this.techniqueConfig.transparencyPassType=St.transparencyPassType,this.techniqueConfig.hasMultipassTerrain=St.multipassTerrain.enabled,this.techniqueConfig.cullAboveGround=St.multipassTerrain.cullAboveGround,this.techniqueConfig.wireframe=this.parameters.wireframe,this.techniqueConfig}intersect(bt,St,Xt,Mr,Cr,Yr,Lr,ct,jt){(0,G.pC)(jt)?this._intersectDrapedLineGeometry(bt,Mr,jt,Yr,Lr):this._intersectLineGeometry(bt,St,Xt,Mr,Lr)}_intersectDrapedLineGeometry(bt,St,Xt,Mr,Cr){if(!St.options.selectionMode)return;const Yr=bt.vertexAttributes.get(ee.T.POSITION).data,Lr=bt.vertexAttributes.get(ee.T.SIZE);let ct=this.parameters.width;if(this.parameters.vvSizeEnabled){const ir=bt.vertexAttributes.get(ee.T.SIZEFEATUREATTRIBUTE).data[0];ct*=(0,A.uZ)(this.parameters.vvSizeOffset[0]+ir*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else Lr&&(ct*=Lr.data[0]);const jt=Mr[0],qt=Mr[1],er=(ct/2+4)*bt.screenToWorldRatio;let Zt=Number.MAX_VALUE,tr=0;for(let ir=0;ir<Yr.length-5;ir+=3){const fr=Yr[ir],Ur=Yr[ir+1],Br=jt-fr,Zr=qt-Ur,ri=Yr[ir+3]-fr,hr=Yr[ir+4]-Ur,Dr=(0,A.uZ)((ri*Br+hr*Zr)/(ri*ri+hr*hr),0,1),Kr=ri*Dr-Br,Nt=hr*Dr-Zr,lr=Kr*Kr+Nt*Nt;lr<Zt&&(Zt=lr,tr=ir/3)}Zt<er*er&&Cr(Xt.dist,Xt.normal,tr,!1)}_intersectLineGeometry(bt,St,Xt,Mr,Cr){if(!Mr.options.selectionMode||(0,ne.PD)(St))return;if(!(0,U.kG)(Xt))return void Ie.error("intersection assumes a translation-only matrix");const Yr=bt.vertexAttributes,Lr=Yr.get(ee.T.POSITION).data;let ct=this.parameters.width;if(this.parameters.vvSizeEnabled){const Br=Yr.get(ee.T.SIZEFEATUREATTRIBUTE).data[0];ct*=(0,A.uZ)(this.parameters.vvSizeOffset[0]+Br*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else Yr.has(ee.T.SIZE)&&(ct*=Yr.get(ee.T.SIZE).data[0]);const jt=Mr.camera,qt=Fe;(0,H.c)(qt,Mr.point);const er=ct*jt.pixelRatio/2+4*jt.pixelRatio;(0,re.s)(ot[0],qt[0]-er,qt[1]+er,0),(0,re.s)(ot[1],qt[0]+er,qt[1]+er,0),(0,re.s)(ot[2],qt[0]+er,qt[1]-er,0),(0,re.s)(ot[3],qt[0]-er,qt[1]-er,0);for(let Br=0;Br<4;Br++)if(!jt.unprojectFromRenderScreen(ot[Br],at[Br]))return;(0,ie.zk)(jt.eye,at[0],at[1],yt),(0,ie.zk)(jt.eye,at[1],at[2],wt),(0,ie.zk)(jt.eye,at[2],at[3],zt),(0,ie.zk)(jt.eye,at[3],at[0],Rt);let Zt=Number.MAX_VALUE,tr=0;const ir=we(this.parameters,Yr,bt.indices)?Lr.length-2:Lr.length-5;for(let Br=0;Br<ir;Br+=3){$e[0]=Lr[Br]+Xt[12],$e[1]=Lr[Br+1]+Xt[13],$e[2]=Lr[Br+2]+Xt[14];const Zr=(Br+3)%Lr.length;if(Be[0]=Lr[Zr]+Xt[12],Be[1]=Lr[Zr+1]+Xt[13],Be[2]=Lr[Zr+2]+Xt[14],(0,ie.jH)(yt,$e)<0&&(0,ie.jH)(yt,Be)<0||(0,ie.jH)(wt,$e)<0&&(0,ie.jH)(wt,Be)<0||(0,ie.jH)(zt,$e)<0&&(0,ie.jH)(zt,Be)<0||(0,ie.jH)(Rt,$e)<0&&(0,ie.jH)(Rt,Be)<0)continue;if(jt.projectToRenderScreen($e,ve),jt.projectToRenderScreen(Be,Ke),ve[2]<0&&Ke[2]>0){(0,re.b)(Se,$e,Be);const hr=jt.frustum,Dr=-(0,ie.jH)(hr[B.Nu.NEAR],$e)/(0,re.e)(Se,(0,ie.mJ)(hr[B.Nu.NEAR]));(0,re.g)(Se,Se,Dr),(0,re.a)($e,$e,Se),jt.projectToRenderScreen($e,ve)}else if(ve[2]>0&&Ke[2]<0){(0,re.b)(Se,Be,$e);const hr=jt.frustum,Dr=-(0,ie.jH)(hr[B.Nu.NEAR],Be)/(0,re.e)(Se,(0,ie.mJ)(hr[B.Nu.NEAR]));(0,re.g)(Se,Se,Dr),(0,re.a)(Be,Be,Se),jt.projectToRenderScreen(Be,Ke)}else if(ve[2]<0&&Ke[2]<0)continue;ve[2]=0,Ke[2]=0;const ri=(0,Z.Jk)((0,Z.zk)(ve,Ke,tt),qt);ri<Zt&&(Zt=ri,(0,re.c)(qe,$e),(0,re.c)(be,Be),tr=Br/3)}const fr=Mr.rayBegin,Ur=Mr.rayEnd;if(Zt<er*er){let Br=Number.MAX_VALUE;if((0,Z.AR)((0,Z.zk)(qe,be,tt),(0,Z.zk)(fr,Ur,Ye),De)){(0,re.b)(De,De,fr);const Zr=(0,re.l)(De);(0,re.g)(De,De,1/Zr),Br=Zr/(0,re.i)(fr,Ur)}Cr(Br,De,tr,!1)}}computeAttachmentOrigin(bt,St){const Xt=bt.vertexAttributes;if(!Xt)return null;const Mr=bt.indices,Cr=Xt.get(ee.T.POSITION);return(0,oe.qZ)(Cr,Mr?Mr.get(ee.T.POSITION):null,Mr&&we(this.parameters,Xt,Mr),St)}createLayout(){const bt=(0,ue.U$)().vec3f(ee.T.POSITION).f32(ee.T.SUBDIVISIONFACTOR).vec2f(ee.T.UV0).vec3f(ee.T.AUXPOS1).vec3f(ee.T.AUXPOS2);return bt.f32(this.parameters.vvSizeEnabled?ee.T.SIZEFEATUREATTRIBUTE:ee.T.SIZE),this.parameters.vvColorEnabled?bt.f32(ee.T.COLORFEATUREATTRIBUTE):bt.vec4f(ee.T.COLOR),this.parameters.vvOpacityEnabled&&bt.f32(ee.T.OPACITYFEATUREATTRIBUTE),bt}createBufferWriter(){return new We(this.layout,this.parameters)}requiresSlot(bt,St){if(bt===X.r.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===j.yD.OccludeAndTransparentStencil)return bt===X.r.OPAQUE_MATERIAL||bt===X.r.OCCLUDER_MATERIAL||bt===X.r.TRANSPARENT_OCCLUDER_MATERIAL;const Xt=(0,Y.S)(St);return Xt===ce.H.Color||Xt===ce.H.Alpha?bt===(this.parameters.writeDepth?X.r.TRANSPARENT_MATERIAL:X.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):bt===X.r.OPAQUE_MATERIAL}createGLMaterial(bt){return bt.output===ce.H.Color||bt.output===ce.H.Alpha||bt.output===ce.H.Highlight||bt.output===ce.H.Depth?new xe(bt):null}validateParameters(bt){"miter"!==bt.join&&(bt.miterLimit=0)}}class xe extends le.Z{_updateOccludeeState(bt){bt.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:bt.hasOccludees})}beginSlot(bt){return this._output!==ce.H.Color&&this._output!==ce.H.Alpha||this._updateOccludeeState(bt),this.ensureTechnique(Te,bt)}}class je extends $.n{constructor(){super(...arguments),this.width=0,this.color=W.O,this.join="miter",this.cap=Ce.R.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class We{constructor(bt,St){this.parameters=St,this.numJoinSubdivisions=0,this.vertexBufferLayout=bt;const Xt=St.stipplePattern?1:0;switch(this.parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=Xt;break;case"round":this.numJoinSubdivisions=se.N+Xt}}_isClosed(bt){return we(this.parameters,bt.vertexAttributes,bt.indices)}allocate(bt){return this.vertexBufferLayout.createBuffer(bt)}elementCount(bt){const Xt=bt.indices.get(ee.T.POSITION).length/2+1,Mr=this._isClosed(bt);let Cr=Mr?2:4;return Cr+=((Mr?Xt:Xt-1)-(Mr?0:1))*(2*this.numJoinSubdivisions+4),Cr+=2,this.parameters.wireframe&&(Cr=2+4*(Cr-2)),Cr}write(bt,St,Xt,Mr){var pr;const Cr=ze,Yr=et,Lr=ke,ct=St.vertexAttributes.get(ee.T.POSITION).data,jt=St.indices&&St.indices.get(ee.T.POSITION),qt=null==(pr=St.vertexAttributes.get(ee.T.DISTANCETOSTART))?void 0:pr.data;jt&&jt.length!==2*(ct.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let er=1,Zt=0;this.parameters.vvSizeEnabled?Zt=St.vertexAttributes.get(ee.T.SIZEFEATUREATTRIBUTE).data[0]:St.vertexAttributes.has(ee.T.SIZE)&&(er=St.vertexAttributes.get(ee.T.SIZE).data[0]);let tr=[1,1,1,1],ir=0;this.parameters.vvColorEnabled?ir=St.vertexAttributes.get(ee.T.COLORFEATUREATTRIBUTE).data[0]:St.vertexAttributes.has(ee.T.COLOR)&&(tr=St.vertexAttributes.get(ee.T.COLOR).data);let fr=0;this.parameters.vvOpacityEnabled&&(fr=St.vertexAttributes.get(ee.T.OPACITYFEATUREATTRIBUTE).data[0]);const Ur=ct.length/3,Br=bt.transformation,Zr=new Float32Array(Xt.buffer),ri=this.vertexBufferLayout.stride/4;let hr=Mr*ri;const Dr=hr;let Kr=0;const Nt=qt?(Pr,Fr,ii)=>Kr=qt[ii]:(Pr,Fr,ii)=>Kr+=(0,re.i)(Pr,Fr),lr=(Pr,Fr,ii,mi,wi,Qr,Ni)=>{if(Zr[hr++]=Fr[0],Zr[hr++]=Fr[1],Zr[hr++]=Fr[2],Zr[hr++]=mi,Zr[hr++]=Ni,Zr[hr++]=wi,Zr[hr++]=Pr[0],Zr[hr++]=Pr[1],Zr[hr++]=Pr[2],Zr[hr++]=ii[0],Zr[hr++]=ii[1],Zr[hr++]=ii[2],Zr[hr++]=this.parameters.vvSizeEnabled?Zt:er,this.parameters.vvColorEnabled)Zr[hr++]=ir;else{const Hs=Math.min(4*Qr,tr.length-4);Zr[hr++]=tr[Hs+0],Zr[hr++]=tr[Hs+1],Zr[hr++]=tr[Hs+2],Zr[hr++]=tr[Hs+3]}this.parameters.vvOpacityEnabled&&(Zr[hr++]=fr)};hr+=ri,(0,re.s)(Yr,ct[0],ct[1],ct[2]),Br&&(0,re.m)(Yr,Yr,Br);const jr=this._isClosed(St);if(jr){const Pr=ct.length-3;(0,re.s)(Cr,ct[Pr],ct[Pr+1],ct[Pr+2]),Br&&(0,re.m)(Cr,Cr,Br)}else(0,re.s)(Lr,ct[3],ct[4],ct[5]),Br&&(0,re.m)(Lr,Lr,Br),lr(Yr,Yr,Lr,1,Ge.LEFT_CAP_START,0,0),lr(Yr,Yr,Lr,1,Ge.RIGHT_CAP_START,0,0),(0,re.c)(Cr,Yr),(0,re.c)(Yr,Lr);const Ot=jr?0:1,rr=jr?Ur:Ur-1;for(let Pr=Ot;Pr<rr;Pr++){const Fr=(Pr+1)%Ur*3;(0,re.s)(Lr,ct[Fr+0],ct[Fr+1],ct[Fr+2]),Br&&(0,re.m)(Lr,Lr,Br),Nt(Cr,Yr,Pr),lr(Cr,Yr,Lr,0,Ge.LEFT_JOIN_END,Pr,Kr),lr(Cr,Yr,Lr,0,Ge.RIGHT_JOIN_END,Pr,Kr);const ii=this.numJoinSubdivisions;for(let mi=0;mi<ii;++mi){const wi=(mi+1)/(ii+1);lr(Cr,Yr,Lr,wi,Ge.LEFT_JOIN_END,Pr,Kr),lr(Cr,Yr,Lr,wi,Ge.RIGHT_JOIN_END,Pr,Kr)}lr(Cr,Yr,Lr,1,Ge.LEFT_JOIN_START,Pr,Kr),lr(Cr,Yr,Lr,1,Ge.RIGHT_JOIN_START,Pr,Kr),(0,re.c)(Cr,Yr),(0,re.c)(Yr,Lr)}jr?((0,re.s)(Lr,ct[3],ct[4],ct[5]),Br&&(0,re.m)(Lr,Lr,Br),Kr=Nt(Cr,Yr,rr),lr(Cr,Yr,Lr,0,Ge.LEFT_JOIN_END,Ot,Kr),lr(Cr,Yr,Lr,0,Ge.RIGHT_JOIN_END,Ot,Kr)):(Kr=Nt(Cr,Yr,rr),lr(Cr,Yr,Yr,0,Ge.LEFT_CAP_END,rr,Kr),lr(Cr,Yr,Yr,0,Ge.RIGHT_CAP_END,rr,Kr)),Ne(Zr,Dr+ri,Zr,Dr,ri),hr=Ne(Zr,hr-ri,Zr,hr,ri),this.parameters.wireframe&&this._addWireframeVertices(Xt,Dr,hr,ri)}_addWireframeVertices(bt,St,Xt,Mr){const Cr=new Float32Array(bt.buffer,Xt*Float32Array.BYTES_PER_ELEMENT),Yr=new Float32Array(bt.buffer,St*Float32Array.BYTES_PER_ELEMENT,Xt-St);let Lr=0;const ct=jt=>Lr=Ne(Yr,jt,Cr,Lr,Mr);for(let jt=0;jt<Yr.length-1;jt+=2*Mr)ct(jt),ct(jt+2*Mr),ct(jt+1*Mr),ct(jt+2*Mr),ct(jt+1*Mr),ct(jt+3*Mr)}}function Ne(Ft,bt,St,Xt,Mr){for(let Cr=0;Cr<Mr;Cr++)St[Xt++]=Ft[bt++];return Xt}function we(Ft,bt,St){return Oe(Ft,bt.get(ee.T.POSITION).data,St?St.get(ee.T.POSITION):null)}function Oe(Ft,bt,St){return!!Ft.isClosed&&(St?St.length>2:bt.length>6)}const $e=(0,J.c)(),Be=(0,J.c)(),Se=(0,J.c)(),De=(0,J.c)(),Fe=(0,J.c)(),ve=(0,Q.J$)(),Ke=(0,Q.J$)(),qe=(0,J.c)(),be=(0,J.c)(),tt=(0,Z.Ue)(),Ye=(0,Z.Ue)(),ze=(0,J.c)(),et=(0,J.c)(),ke=(0,J.c)(),ot=[(0,Q.J$)(),(0,Q.J$)(),(0,Q.J$)(),(0,Q.J$)()],at=[(0,J.c)(),(0,J.c)(),(0,J.c)(),(0,J.c)()],yt=(0,ie.Ue)(),wt=(0,ie.Ue)(),zt=(0,ie.Ue)(),Rt=(0,ie.Ue)()},51899:(dt,Re,T)=>{"use strict";T.d(Re,{h:()=>H});var x=T(36161),A=T(62208),G=T(67969),Q=T(55086);class H{constructor(W){this._rctx=W,this.cache=new Map}dispose(){this.cache.forEach(W=>W.texture=(0,A.O3)(W.texture)),this.cache.clear()}_acquire(W){if((0,A.Wi)(W))return null;const B=this._patternId(W),Z=this.cache.get(B);if(Z)return Z.refCount++,Z.bind;const ie=W.pixelRatio,{encodedData:ue,sdfNormalizer:ce,pixels:oe,paddedPixels:le}=function re(J,W){const B=J.map($=>Math.round($*W)),Z=1/W,ie=Math.floor(B.reduce(($,ne)=>$+ne)),ue=B.reduce(($,ne)=>Math.max($,ne)),ce=(Math.floor(.5*(ue-1))+.5)*Z,oe=[];let le=1;for(const $ of B){for(let ne=0;ne<$;ne++){const se=le*(Math.min(ne,$-1-ne)+.5)*Z/ce*.5+.5;oe.push(se)}le=-le}const Y=Math.round(B[0]/2),j=[...oe.slice(Y),...oe.slice(0,Y)],X=ie+2,U=new Uint8Array(4*X);let ee=4;for(const $ of j)(0,x.I)($,U,ee),ee+=4;return U.copyWithin(0,ee-4,ee),U.copyWithin(ee,4,8),{encodedData:U,sdfNormalizer:ce,paddedPixels:X,pixels:ie}}(W.pattern,ie),Y=oe/ie,j={refCount:1,texture:null,bind:X=>((0,A.Wi)(j.texture)&&(j.texture=new Q.x(this._rctx,{width:le,height:1,internalFormat:G.VI.RGBA,pixelFormat:G.VI.RGBA,dataType:G.Br.UNSIGNED_BYTE,wrapMode:G.e8.CLAMP_TO_EDGE},ue)),X.bindTexture("stipplePatternTexture",j.texture),{pixelSize:Y,sdfNormalizer:ce,pixels:oe})};return this.cache.set(B,j),j.bind}release(W){if((0,A.Wi)(W))return;const B=this._patternId(W),Z=this.cache.get(B);Z&&(Z.refCount--,0===Z.refCount&&((0,A.pC)(Z.texture)&&Z.texture.dispose(),this.cache.delete(B)))}swap(W,B){const Z=this._acquire(B);return this.release(W),Z}_patternId(W){return`${W.pattern.join(",")}-r${W.pixelRatio}`}}},41857:(dt,Re,T)=>{"use strict";T.d(Re,{n:()=>Q,x:()=>H});var x=T(550),A=T(28093),G=T(40723);class Q extends G.Mt{constructor(){super(...arguments),this.vvSizeEnabled=!1,this.vvSizeMinSize=(0,A.f)(1,1,1),this.vvSizeMaxSize=(0,A.f)(100,100,100),this.vvSizeOffset=(0,A.f)(0,0,0),this.vvSizeFactor=(0,A.f)(1,1,1),this.vvSizeValue=(0,A.f)(1,1,1),this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvOpacityEnabled=!1,this.vvOpacityValues=[0,0,0,0,0,0,0,0],this.vvOpacityOpacities=[1,1,1,1,1,1,1,1],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=(0,x.c)()}}const H=8},44989:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>ye,m:()=>Me});var x=T(27422),A=T(99770),G=T(4794),Q=T(6945),H=T(42836),re=T(32393),J=T(40723),W=T(88569),B=T(5894),Z=T(62208),ie=T(42743),ue=T(60881),ce=T(17626),oe=T(59617),le=T(92724),Y=T(7228),j=T(651),X=T(91056),U=T(87601),ee=T(39114),$=T(12407),ne=T(41528),se=T(61584),ae=T(2078);class de extends X.A{constructor(me,Ce,Ie){super(me,Ce,Ie),this._textureRepository=me.waterTextureRepository}initializeConfiguration(me,Ce){Ce.spherical=me.viewingMode===oe.JY.Global,Ce.doublePrecisionRequiresObfuscation=(0,Y.I)(me.rctx)}initializeProgram(me){const Ce=de.shader.get().build(this.configuration);return new $.$(me.rctx,Ce,ee.i)}bindPass(me,Ce){this.program.bindPass(me,Ce),this.configuration.output!==Q.H.Color&&this.configuration.output!==Q.H.Normal||this._textureRepository.bind(this.program)}_setPipelineState(me){const Ce=this.configuration,Ie=me===ie.Am.NONE,Ge=me===ie.Am.FrontFace;return(0,ae.sm)({blending:Ce.output!==Q.H.Normal&&Ce.output!==Q.H.Highlight&&Ce.transparent?Ie?W.wu:(0,W.j7)(me):null,depthTest:{func:(0,W.Bh)(me)},depthWrite:Ie?Ce.writeDepth&&ae.LZ:(0,W.K5)(me),colorWrite:ae.BK,polygonOffset:Ie||Ge?null:(0,W.je)(Ce.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}de.shader=new j.J(se.W,()=>T.e(4095).then(T.bind(T,74095)));class _e extends ne.W{constructor(){super(...arguments),this.output=Q.H.Color,this.transparencyPassType=ie.Am.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,ce._)([(0,U.o)({count:Q.H.COUNT})],_e.prototype,"output",void 0),(0,ce._)([(0,U.o)({count:ie.Am.COUNT})],_e.prototype,"transparencyPassType",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"spherical",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"receiveShadows",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"hasSlicePlane",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"transparent",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"enableOffset",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"writeDepth",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"hasScreenSpaceReflections",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"hasCloudsReflections",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"isDraped",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"hasMultipassTerrain",void 0),(0,ce._)([(0,U.o)()],_e.prototype,"cullAboveGround",void 0),(0,ce._)([(0,U.o)({constValue:le.f7.Water})],_e.prototype,"pbrMode",void 0),(0,ce._)([(0,U.o)({constValue:!0})],_e.prototype,"useCustomDTRExponentForWater",void 0),(0,ce._)([(0,U.o)({constValue:!0})],_e.prototype,"highStepCount",void 0),(0,ce._)([(0,U.o)({constValue:!1})],_e.prototype,"useFillLights",void 0);class pe extends ue.Z{_updateShadowState(me){me.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:me.shadowMap.enabled})}_updateSSRState(me){me.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:me.ssr.enabled})}_updateCloudsReflectionState(me){const Ce=(0,Z.pC)(me.clouds.data);Ce!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:Ce})}ensureResources(me){const Ce=this._techniqueRepository.constructionContext.waterTextureRepository;return Ce.resourceState===ie.Rw.NOT_LOADED&&Ce.loadTextures(me),Ce.resourceState}beginSlot(me){return this._output===Q.H.Color&&(this._updateShadowState(me),this._updateSSRState(me),this._updateCloudsReflectionState(me)),this.ensureTechnique(de,me)}}var he=T(60909),ge=T(57623);class ye extends J.F5{constructor(me){super(me,new Me),this._techniqueConfig=new _e,this.animation=new H.d}getConfiguration(me,Ce){return this._techniqueConfig.output=me,this._techniqueConfig.writeDepth=this.parameters.writeDepth,this._techniqueConfig.receiveShadows=this.parameters.receiveShadows,this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane,this._techniqueConfig.transparent=this.parameters.transparent,this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections,this._techniqueConfig.isDraped=this.parameters.isDraped,this._techniqueConfig.transparencyPassType=Ce.transparencyPassType,this._techniqueConfig.enableOffset=Ce.camera.relativeElevation<W.ve,this._techniqueConfig.hasMultipassTerrain=Ce.multipassTerrain.enabled,this._techniqueConfig.cullAboveGround=Ce.multipassTerrain.cullAboveGround,this._techniqueConfig}update(me){const Ce=Math.min(me.camera.relativeElevation,me.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Ce<Ee;const Ie=this.animation.advance(me);return this.setParameters({timeElapsed:(0,x.D9)(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&Ie}intersect(me,Ce,Ie,Ge,Je,xe,je){(0,ge.Bw)(me,Ce,Ge,Je,xe,void 0,je)}requiresSlot(me,Ce){switch((0,re.S)(Ce)){case Q.H.Normal:return me===B.r.DRAPED_WATER;case Q.H.Color:if(this.parameters.isDraped)return me===B.r.DRAPED_MATERIAL;break;case Q.H.Highlight:return me===B.r.OPAQUE_MATERIAL||me===B.r.DRAPED_MATERIAL}let Ie=B.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(Ie=this.parameters.writeDepth?B.r.TRANSPARENT_MATERIAL:B.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),me===Ie}createGLMaterial(me){if(me.output===Q.H.Color&&this.parameters.isDraped)return me.output=Q.H.Draped,new pe(me);switch(me.output){case Q.H.Color:case Q.H.Normal:case Q.H.Highlight:case Q.H.Alpha:return new pe(me)}return null}createBufferWriter(){return new he.G_(he.W1)}}class Me extends J.Mt{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,A.f)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,G.f)(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1}}const Ee=35e3},60909:(dt,Re,T)=>{"use strict";T.d(Re,{G_:()=>J,IM:()=>re,W1:()=>H,wp:()=>Q});var x=T(19625),A=T(16396),G=T(42037);const Q=(0,x.U$)().vec3f(A.T.POSITION),H=(0,x.U$)().vec3f(A.T.POSITION).vec2f(A.T.UV0),re=(0,x.U$)().vec3f(A.T.POSITION).vec4u8(A.T.COLOR);class J{constructor(B){this.vertexBufferLayout=B}allocate(B){return this.vertexBufferLayout.createBuffer(B)}elementCount(B){return B.indices.get(A.T.POSITION).length}write(B,Z,ie,ue){(0,G.NK)(Z,this.vertexBufferLayout,B.transformation,B.invTranspTransformation,ie,ue)}}},57623:(dt,Re,T)=>{"use strict";T.d(Re,{Bw:()=>ce,CN:()=>j,FZ:()=>ye,Fw:()=>ae,Hx:()=>de,LO:()=>pe,Mw:()=>$,TT:()=>he,Tw:()=>se,Ue:()=>ne,Uf:()=>_e});var x=T(85931),A=T(21286),G=T(62208),Q=T(84161),H=T(28093),re=T(5548),J=T(42743),W=T(17962),B=T(2282),Z=T(16396),ie=T(65073);const ue=(0,re.Ue)();function ce(Ee,Te,me,Ce,Ie,Ge,Je){if(!(0,ie.PD)(Te))if(Ee.boundingInfo)(0,B.hu)(Ee.primitiveType===J.MX.Triangle),le(Ee.boundingInfo,Ce,Ie,me.tolerance,Ge,Je);else{const xe=Ee.indices.get(Z.T.POSITION),je=Ee.vertexAttributes.get(Z.T.POSITION);j(Ce,Ie,0,xe.length/3,xe,je,void 0,Ge,Je)}}const oe=(0,H.c)();function le(Ee,Te,me,Ce,Ie,Ge){if((0,G.Wi)(Ee))return;const Je=ne(Te,me,oe);if((0,re.op)(ue,Ee.getBBMin()),(0,re.Tn)(ue,Ee.getBBMax()),(0,G.pC)(Ie)&&Ie.applyToAabb(ue),se(ue,Te,Je,Ce)){const{primitiveIndices:xe,indices:je,position:We}=Ee,Ne=xe?xe.length:je.length/3;if(Ne>Me){const we=Ee.getChildren();if(void 0!==we){for(let Oe=0;Oe<8;++Oe)void 0!==we[Oe]&&le(we[Oe],Te,me,Ce,Ie,Ge);return}}j(Te,me,0,Ne,je,We,xe,Ie,Ge)}}const Y=(0,H.c)();function j(Ee,Te,me,Ce,Ie,Ge,Je,xe,je){if(Je)return function X(Ee,Te,me,Ce,Ie,Ge,Je,xe,je){const We=Ge.data,Ne=Ge.stride||Ge.size,we=Ee[0],Oe=Ee[1],$e=Ee[2],Be=Te[0]-we,Se=Te[1]-Oe,De=Te[2]-$e;for(let Fe=me;Fe<Ce;++Fe){const ve=Je[Fe];let Ke=3*ve,qe=Ne*Ie[Ke++],be=We[qe++],tt=We[qe++],Ye=We[qe];qe=Ne*Ie[Ke++];let ze=We[qe++],et=We[qe++],ke=We[qe];qe=Ne*Ie[Ke];let ot=We[qe++],at=We[qe++],yt=We[qe];(0,G.pC)(xe)&&([be,tt,Ye]=xe.applyToVertex(be,tt,Ye,Fe),[ze,et,ke]=xe.applyToVertex(ze,et,ke,Fe),[ot,at,yt]=xe.applyToVertex(ot,at,yt,Fe));const wt=ze-be,zt=et-tt,Rt=ke-Ye,Ft=ot-be,bt=at-tt,St=yt-Ye,Xt=Se*St-bt*De,Mr=De*Ft-St*Be,Cr=Be*bt-Ft*Se,Yr=wt*Xt+zt*Mr+Rt*Cr;if(Math.abs(Yr)<=Number.EPSILON)continue;const Lr=we-be,ct=Oe-tt,jt=$e-Ye,qt=Lr*Xt+ct*Mr+jt*Cr;if(Yr>0){if(qt<0||qt>Yr)continue}else if(qt>0||qt<Yr)continue;const er=ct*Rt-zt*jt,Zt=jt*wt-Rt*Lr,tr=Lr*zt-wt*ct,ir=Be*er+Se*Zt+De*tr;if(Yr>0){if(ir<0||qt+ir>Yr)continue}else if(ir>0||qt+ir<Yr)continue;const fr=(Ft*er+bt*Zt+St*tr)/Yr;fr>=0&&je(fr,$(wt,zt,Rt,Ft,bt,St,Y),ve,!1)}}(Ee,Te,me,Ce,Ie,Ge,Je,xe,je);const We=Ge.data,Ne=Ge.stride||Ge.size,we=Ee[0],Oe=Ee[1],$e=Ee[2],Be=Te[0]-we,Se=Te[1]-Oe,De=Te[2]-$e;for(let Fe=me,ve=3*me;Fe<Ce;++Fe){let Ke=Ne*Ie[ve++],qe=We[Ke++],be=We[Ke++],tt=We[Ke];Ke=Ne*Ie[ve++];let Ye=We[Ke++],ze=We[Ke++],et=We[Ke];Ke=Ne*Ie[ve++];let ke=We[Ke++],ot=We[Ke++],at=We[Ke];(0,G.pC)(xe)&&([qe,be,tt]=xe.applyToVertex(qe,be,tt,Fe),[Ye,ze,et]=xe.applyToVertex(Ye,ze,et,Fe),[ke,ot,at]=xe.applyToVertex(ke,ot,at,Fe));const yt=Ye-qe,wt=ze-be,zt=et-tt,Rt=ke-qe,Ft=ot-be,bt=at-tt,St=Se*bt-Ft*De,Xt=De*Rt-bt*Be,Mr=Be*Ft-Rt*Se,Cr=yt*St+wt*Xt+zt*Mr;if(Math.abs(Cr)<=Number.EPSILON)continue;const Yr=we-qe,Lr=Oe-be,ct=$e-tt,jt=Yr*St+Lr*Xt+ct*Mr;if(Cr>0){if(jt<0||jt>Cr)continue}else if(jt>0||jt<Cr)continue;const qt=Lr*zt-wt*ct,er=ct*yt-zt*Yr,Zt=Yr*wt-yt*Lr,tr=Be*qt+Se*er+De*Zt;if(Cr>0){if(tr<0||jt+tr>Cr)continue}else if(tr>0||jt+tr<Cr)continue;const ir=(Rt*qt+Ft*er+bt*Zt)/Cr;ir>=0&&je(ir,$(yt,wt,zt,Rt,Ft,bt,Y),Fe,!1)}}const U=(0,H.c)(),ee=(0,H.c)();function $(Ee,Te,me,Ce,Ie,Ge,Je){return(0,Q.s)(U,Ee,Te,me),(0,Q.s)(ee,Ce,Ie,Ge),(0,Q.f)(Je,U,ee),(0,Q.n)(Je,Je),Je}function ne(Ee,Te,me){return(0,Q.s)(me,1/(Te[0]-Ee[0]),1/(Te[1]-Ee[1]),1/(Te[2]-Ee[2]))}function se(Ee,Te,me,Ce){return ae(Ee,Te,me,Ce,1/0)}function ae(Ee,Te,me,Ce,Ie){const Ge=(Ee[0]-Ce-Te[0])*me[0],Je=(Ee[3]+Ce-Te[0])*me[0];let xe=Math.min(Ge,Je),je=Math.max(Ge,Je);const We=(Ee[1]-Ce-Te[1])*me[1],Ne=(Ee[4]+Ce-Te[1])*me[1];if(je=Math.min(je,Math.max(We,Ne)),je<0||(xe=Math.max(xe,Math.min(We,Ne)),xe>je))return!1;const we=(Ee[2]-Ce-Te[2])*me[2],Oe=(Ee[5]+Ce-Te[2])*me[2];return je=Math.min(je,Math.max(we,Oe)),!(je<0)&&(xe=Math.max(xe,Math.min(we,Oe)),!(xe>je)&&xe<Ie)}function de(Ee,Te,me,Ce,Ie){let Ge=(me.screenLength||0)*Ee.pixelRatio;(0,G.pC)(Ie)&&(Ge=(0,W.bA)(Ge,Ce,Te,Ie));const Je=Ge*Math.tan(.5*Ee.fovY)/(.5*Ee.fullHeight);return(0,A.uZ)(Je*Te,me.minWorldLength||0,null!=me.maxWorldLength?me.maxWorldLength:1/0)}function _e(Ee,Te){const me=Te?_e(Te):{};for(const Ce in Ee){let Ie=Ee[Ce];Ie&&Ie.forEach&&(Ie=ge(Ie)),null==Ie&&Ce in me||(me[Ce]=Ie)}return me}function pe(Ee,Te){let me=!1;for(const Ce in Te){const Ie=Te[Ce];void 0!==Ie&&(Array.isArray(Ie)?null===Ee[Ce]?(Ee[Ce]=Ie.slice(),me=!0):(0,x.Vx)(Ee[Ce],Ie)&&(me=!0):Ee[Ce]!==Ie&&(me=!0,Ee[Ce]=Ie))}return me}function he(Ee,Te,me,Ce,Ie,Ge){if(!Te.options.selectionMode)return;const Je=Ee.vertexAttributes.get(Z.T.POSITION).data,xe=Ee.vertexAttributes.get(Z.T.SIZE),We=Ce[0],Ne=Ce[1],we=(((xe&&xe.data[0])+Ie)/2+4)*Ee.screenToWorldRatio;let Oe=Number.MAX_VALUE,$e=0;for(let Be=0;Be<Je.length-5;Be+=3){const Se=Je[Be],De=Je[Be+1],Fe=We-Se,ve=Ne-De,Ke=Je[Be+3]-Se,qe=Je[Be+4]-De,be=(0,A.uZ)((Ke*Fe+qe*ve)/(Ke*Ke+qe*qe),0,1),tt=Ke*be-Fe,Ye=qe*be-ve,ze=tt*tt+Ye*Ye;ze<Oe&&(Oe=ze,$e=Be/3)}Oe<we*we&&Ge(me.dist,me.normal,$e,!1)}function ge(Ee){const Te=[];return Ee.forEach(me=>Te.push(me)),Te}const ye={multiply:1,ignore:2,replace:3,tint:4},Me=1e3},42037:(dt,Re,T)=>{"use strict";T.d(Re,{NK:()=>le,SW:()=>W,Vs:()=>oe,XW:()=>H,ho:()=>ie,s5:()=>ue});var x=T(28347),A=T(60479),G=T(2282),Q=T(16396);function H(Y,j,X,U,ee=1){const $=X.typedBuffer,ne=X.typedBufferStride,se=Y.length;if(U*=ne,1===ee)for(let ae=0;ae<se;++ae)$[U]=j[Y[ae]],U+=ne;else for(let ae=0;ae<se;++ae){const de=j[Y[ae]];for(let _e=0;_e<ee;_e++)$[U]=de,U+=ne}}function re(Y,j,X,U){const ee=X.typedBuffer,$=X.typedBufferStride,ne=Y.length;U*=$;for(let se=0;se<ne;++se){const ae=2*Y[se];ee[U]=j[ae],ee[U+1]=j[ae+1],U+=$}}function J(Y,j,X,U,ee){const $=X.typedBuffer,ne=X.typedBufferStride,se=Y.length;if(U*=ne,null==ee||1===ee)for(let ae=0;ae<se;++ae){const de=3*Y[ae];$[U]=j[de],$[U+1]=j[de+1],$[U+2]=j[de+2],U+=ne}else for(let ae=0;ae<se;++ae){const de=3*Y[ae];for(let _e=0;_e<ee;++_e)$[U]=j[de],$[U+1]=j[de+1],$[U+2]=j[de+2],U+=ne}}function W(Y,j,X,U,ee=1){const $=X.typedBuffer,ne=X.typedBufferStride,se=Y.length;if(U*=ne,1===ee)for(let ae=0;ae<se;++ae){const de=4*Y[ae];$[U]=j[de],$[U+1]=j[de+1],$[U+2]=j[de+2],$[U+3]=j[de+3],U+=ne}else for(let ae=0;ae<se;++ae){const de=4*Y[ae];for(let _e=0;_e<ee;++_e)$[U]=j[de],$[U+1]=j[de+1],$[U+2]=j[de+2],$[U+3]=j[de+3],U+=ne}}function ie(Y,j,X,U,ee,$=1){if(!X)return void J(Y,j,U,ee,$);const ne=U.typedBuffer,se=U.typedBufferStride,ae=Y.length,de=X[0],_e=X[1],pe=X[2],he=X[4],ge=X[5],ye=X[6],Me=X[8],Ee=X[9],Te=X[10],me=X[12],Ce=X[13],Ie=X[14];if(ee*=se,1===$)for(let Ge=0;Ge<ae;++Ge){const Je=3*Y[Ge],xe=j[Je],je=j[Je+1],We=j[Je+2];ne[ee]=de*xe+he*je+Me*We+me,ne[ee+1]=_e*xe+ge*je+Ee*We+Ce,ne[ee+2]=pe*xe+ye*je+Te*We+Ie,ee+=se}else for(let Ge=0;Ge<ae;++Ge){const Je=3*Y[Ge],xe=j[Je],je=j[Je+1],We=j[Je+2],Ne=de*xe+he*je+Me*We+me,we=_e*xe+ge*je+Ee*We+Ce,Oe=pe*xe+ye*je+Te*We+Ie;for(let $e=0;$e<$;++$e)ne[ee]=Ne,ne[ee+1]=we,ne[ee+2]=Oe,ee+=se}}function ue(Y,j,X,U,ee,$=1){if(!X)return void J(Y,j,U,ee,$);const se=U.typedBuffer,ae=U.typedBufferStride,de=Y.length,_e=X[0],pe=X[1],he=X[2],ge=X[4],ye=X[5],Me=X[6],Ee=X[8],Te=X[9],me=X[10],Ce=!(0,x.p)(X);if(ee*=ae,1===$)for(let Je=0;Je<de;++Je){const xe=3*Y[Je],je=j[xe],We=j[xe+1],Ne=j[xe+2];let we=_e*je+ge*We+Ee*Ne,Oe=pe*je+ye*We+Te*Ne,$e=he*je+Me*We+me*Ne;if(Ce){const Be=we*we+Oe*Oe+$e*$e;if(Be<.999999&&Be>1e-6){const Se=1/Math.sqrt(Be);we*=Se,Oe*=Se,$e*=Se}}se[ee+0]=we,se[ee+1]=Oe,se[ee+2]=$e,ee+=ae}else for(let Je=0;Je<de;++Je){const xe=3*Y[Je],je=j[xe],We=j[xe+1],Ne=j[xe+2];let we=_e*je+ge*We+Ee*Ne,Oe=pe*je+ye*We+Te*Ne,$e=he*je+Me*We+me*Ne;if(Ce){const Be=we*we+Oe*Oe+$e*$e;if(Be<.999999&&Be>1e-6){const Se=1/Math.sqrt(Be);we*=Se,Oe*=Se,$e*=Se}}for(let Be=0;Be<$;++Be)se[ee+0]=we,se[ee+1]=Oe,se[ee+2]=$e,ee+=ae}}function ce(Y,j,X,U,ee,$=1){if(!X)return void W(Y,j,U,ee,$);const se=U.typedBuffer,ae=U.typedBufferStride,de=Y.length,_e=X[0],pe=X[1],he=X[2],ge=X[4],ye=X[5],Me=X[6],Ee=X[8],Te=X[9],me=X[10],Ce=!(0,x.p)(X);if(ee*=ae,1===$)for(let Je=0;Je<de;++Je){const xe=4*Y[Je],je=j[xe],We=j[xe+1],Ne=j[xe+2],we=j[xe+3];let Oe=_e*je+ge*We+Ee*Ne,$e=pe*je+ye*We+Te*Ne,Be=he*je+Me*We+me*Ne;if(Ce){const Se=Oe*Oe+$e*$e+Be*Be;if(Se<.999999&&Se>1e-6){const De=1/Math.sqrt(Se);Oe*=De,$e*=De,Be*=De}}se[ee+0]=Oe,se[ee+1]=$e,se[ee+2]=Be,se[ee+3]=we,ee+=ae}else for(let Je=0;Je<de;++Je){const xe=4*Y[Je],je=j[xe],We=j[xe+1],Ne=j[xe+2],we=j[xe+3];let Oe=_e*je+ge*We+Ee*Ne,$e=pe*je+ye*We+Te*Ne,Be=he*je+Me*We+me*Ne;if(Ce){const Se=Oe*Oe+$e*$e+Be*Be;if(Se<.999999&&Se>1e-6){const De=1/Math.sqrt(Se);Oe*=De,$e*=De,Be*=De}}for(let Se=0;Se<$;++Se)se[ee+0]=Oe,se[ee+1]=$e,se[ee+2]=Be,se[ee+3]=we,ee+=ae}}function oe(Y,j,X,U,ee,$=1){const ne=U.typedBuffer,se=U.typedBufferStride,ae=Y.length;if(ee*=se,1===$){if(4===X)for(let de=0;de<ae;++de){const _e=4*Y[de];ne[ee]=j[_e],ne[ee+1]=j[_e+1],ne[ee+2]=j[_e+2],ne[ee+3]=j[_e+3],ee+=se}else if(3===X)for(let de=0;de<ae;++de){const _e=3*Y[de];ne[ee]=j[_e],ne[ee+1]=j[_e+1],ne[ee+2]=j[_e+2],ne[ee+3]=255,ee+=se}}else if(4===X)for(let de=0;de<ae;++de){const _e=4*Y[de];for(let pe=0;pe<$;++pe)ne[ee]=j[_e],ne[ee+1]=j[_e+1],ne[ee+2]=j[_e+2],ne[ee+3]=j[_e+3],ee+=se}else if(3===X)for(let de=0;de<ae;++de){const _e=3*Y[de];for(let pe=0;pe<$;++pe)ne[ee]=j[_e],ne[ee+1]=j[_e+1],ne[ee+2]=j[_e+2],ne[ee+3]=255,ee+=se}}function le(Y,j,X,U,ee,$){for(const ne of j.fieldNames){const se=Y.vertexAttributes.get(ne),ae=Y.indices.get(ne);if(se&&ae)switch(ne){case Q.T.POSITION:{(0,G.hu)(3===se.size);const de=ee.getField(ne,A.ct);de&&ie(ae,se.data,X,de,$);break}case Q.T.NORMAL:{(0,G.hu)(3===se.size);const de=ee.getField(ne,A.ct);de&&ue(ae,se.data,U,de,$);break}case Q.T.UV0:{(0,G.hu)(2===se.size);const de=ee.getField(ne,A.Eu);de&&re(ae,se.data,de,$);break}case Q.T.COLOR:{(0,G.hu)(3===se.size||4===se.size);const de=ee.getField(ne,A.mc);de&&oe(ae,se.data,se.size,de,$);break}case Q.T.SYMBOLCOLOR:{(0,G.hu)(3===se.size||4===se.size);const de=ee.getField(ne,A.mc);de&&oe(ae,se.data,se.size,de,$);break}case Q.T.TANGENT:{(0,G.hu)(4===se.size);const de=ee.getField(ne,A.ek);de&&ce(ae,se.data,U,de,$);break}}}}},54889:(dt,Re,T)=>{"use strict";T.d(Re,{Dp:()=>J,z5:()=>re});var x=T(62208);const A={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},G={dash:A.dash,"dash-dot":[...A.dash,...A.dot],dot:A.dot,"long-dash":A["long-dash"],"long-dash-dot":[...A["long-dash"],...A.dot],"long-dash-dot-dot":[...A["long-dash"],...A.dot,...A.dot],none:null,"short-dash":A["short-dash"],"short-dash-dot":[...A["short-dash"],...A["short-dot"]],"short-dash-dot-dot":[...A["short-dash"],...A["short-dot"],...A["short-dot"]],"short-dot":A["short-dot"],solid:null};function re(B,Z=2){return{pattern:[B,B],pixelRatio:Z}}function J(B){return(0,x.pC)(B)&&"style"===B.type?function W(B){return(0,x.pC)(B)?function H(B,Z=2){return(0,x.Wi)(B)?B:{pattern:B.slice(),pixelRatio:Z}}(G[B],8):null}(B.style):null}},38516:(dt,Re,T)=>{"use strict";T.d(Re,{A:()=>Ce});var x=T(88159),A=T(62208),G=T(77029),Q=T(28347),H=T(43703),re=T(4511),J=T(32393),W=T(40723),B=T(54840),Z=T(91263),ie=T(2282),ue=T(7949),ce=T(44989);class oe{constructor(Fe){this.first=Fe.from,this.count=Fe.to-Fe.from}}class le{constructor(Fe=0,ve=0){this.from=Fe,this.to=ve}}class Y extends le{constructor(Fe,ve,Ke,qe,be,tt){super(ve,Ke),this.id=Fe,this.isVisible=qe,this.hasHighlights=be,this.hasOccludees=tt}}function j(De){return Array.from(De.values()).sort(X)}function X(De,Fe){return De.from===Fe.from?De.to-Fe.to:De.from-Fe.from}function U(De,Fe){if(0===De.length)return void De.push(new oe(Fe));const ve=De[De.length-1];!function ee(De,Fe){return De.first+De.count>=Fe.from}(ve,Fe)?De.push(new oe(Fe)):ve.count=Fe.from-ve.first+Fe.to-Fe.from}class ${constructor(Fe,ve){this._pool=Fe,this._size=0,this._buffer=Fe.newBuffer(se(ve))}dispose(){this._buffer=this._pool.deleteBuffer(this._buffer),this._size=0}release(){this.erase(0,this._size),this.dispose()}get vao(){return this._buffer.vao}get array(){return this._buffer.array}get size(){return this._size}grow(Fe){this._resize(this._size+Fe,!0).dispose()}alloc(Fe){return this._resize(Fe,!1)}_resize(Fe,ve){let Ke;const qe=function ae(De,Fe,ve){return Fe<=ve?De>=ve?De:se(Math.max(2*De,ve)):De<=2*ve?De:se(ve)}(this._buffer.length,this._size,Fe);if(this._buffer.length!==qe){const tt=this._pool.newBuffer(qe);ve&&(tt.array.set(this._buffer.array.subarray(0,Math.min(this._size,qe))),tt.vao.vertexBuffers.geometry.setSubData(tt.array,0,0,tt.array.byteLength)),Ke=this._buffer,this._buffer=tt}const be=this._size;return this._size=Fe,Ke?{dispose:()=>{Ke.array.fill(0,0,be),this._pool.deleteBuffer(Ke)},copy:(tt,Ye,ze)=>this._buffer.array.set(Ke.array.subarray(Ye,ze),tt),hasNewBuffer:!0}:{dispose:()=>{},copy:(tt,Ye,ze)=>{tt!==Ye&&this._buffer.array.copyWithin(tt,Ye,ze)},hasNewBuffer:!1}}erase(Fe,ve){this._buffer.array.fill(0,Fe,ve)}}function se(De){return 65536*Math.ceil(De/65536)}var de=T(1036),_e=T(86236),pe=T(83994),he=T(67969),ge=T(49353);class ye{constructor(Fe,ve,Ke,qe){this.vao=new ge.U(Fe,ve,{geometry:Ke},{geometry:pe.f.createVertex(Fe,he.l1.STATIC_DRAW)}),this.array=new Float32Array(qe),this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}dispose(){this.vao.dispose(!0)}get length(){return this.array.length}}const Me=de.an+1;class Ee{constructor(Fe,ve,Ke){this._rctx=Fe,this._locations=ve,this._layout=Ke,this._cache=Fe.newCache(`MergedRenderer pool ${(0,_e.D)()}`,Te)}dispose(){this._cache.destroy()}newBuffer(Fe){const ve=Fe.toString(),Ke=this._cache.pop(ve);if((0,A.pC)(Ke)){const qe=Ke.pop();return Ke.length>0&&this._cache.put(ve,Ke,qe.array.byteLength*Ke.length,Me),qe}return new ye(this._rctx,this._locations,this._layout,Fe)}deleteBuffer(Fe){const ve=Fe.array.byteLength,Ke=Fe.array.length.toString(),qe=this._cache.pop(Ke);return(0,A.pC)(qe)?(qe.push(Fe),this._cache.put(Ke,qe,ve*qe.length,-1)):this._cache.put(Ke,[Fe],ve,-1),null}}function Te(De,Fe){if(Fe===de.lN.ALL)return void De.forEach(qe=>qe.dispose());const ve=De.pop(),Ke=De.length*ve.array.byteLength;return ve.dispose(),Ke}var me=T(65073);class Ce{constructor(Fe,ve,Ke){this._rctx=Fe,this._materialRepository=ve,this._material=Ke,this.type="MergedRenderer",this._dataByOrigin=new Map,this._renderCommandData=new G.Z,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new J.p(this._material,this._materialRepository),this._bufferWriter=Ke.createBufferWriter(),this._bufferPool=new Ee(Fe,Ke.vertexAttributeLocations,(0,re.K)(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(Fe=>Fe.buffer.dispose()),this._dataByOrigin.clear(),this._bufferPool.dispose()}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this._material instanceof ce.H}get rendersOccluded(){return!this.isEmpty&&this._material.renderOccluded!==W.yD.Occlude}modify(Fe){this._updateGeometries(Fe.updates),this._addAndRemoveGeometries(Fe.adds,Fe.removes),this._updateRenderCommands()}_addAndRemoveGeometries(Fe,ve){const Ke=this._bufferWriter,qe=Ke.vertexBufferLayout.stride/4,be=this._dataByOrigin,tt=function Ge(De,Fe){const ve=new Map;for(const Ke of De)Je(ve,Ke,!0);for(const Ke of Fe)Je(ve,Ke,!1);return ve}(Fe,ve);tt.forEach((Ye,ze)=>{tt.delete(ze);const et=Ye.toAdd.reduce((Ft,bt)=>Ft+Ke.elementCount(bt.data),0);let ke=be.get(ze);if(null==ke)(0,ie.hu)(0===Ye.toRemove.length),ke=new Ne(Ye.origin,new $(this._bufferPool,et*qe)),be.set(ze,ke);else if(0===Ye.toAdd.length&&ke.instances.size===Ye.toRemove.length)return ke.buffer.dispose(),void be.delete(ze);let ot=0;ke.instances.forEach(Ft=>ot+=Ft.to-Ft.from);const at=Ye.toRemove.reduce((Ft,bt)=>Ft+Ke.elementCount(bt.data),0),wt=(ot+et-at)*qe,zt=Oe;if(wt<ke.buffer.size/2?this._removeAndRebuild(ke,Ye.toRemove,qe,wt,zt):Ye.toRemove.length>0&&this._remove(ke,Ye.toRemove,qe,zt),Ye.toAdd.length>0){const Ft=$e;(0,ie.u_)(Ft,-Ye.origin[0],-Ye.origin[1],-Ye.origin[2]),this._add(ke,Ye.toAdd,qe,Ft,zt)}const Rt=ke.buffer.vao.vertexBuffers.geometry;We(zt),zt.forAll(({from:Ft,to:bt})=>{if(Ft<bt){const Xt=4,Mr=Ft*Xt;Rt.setSubData(ke.buffer.array,Mr,Mr,bt*Xt)}}),zt.clear(),ke.drawCommandsDirty=!0})}_updateGeometries(Fe){const ve=this._bufferWriter,Ke=ve.vertexBufferLayout.stride/4;for(const qe of Fe){const be=qe.renderGeometry,tt=this._dataByOrigin.get(be.origin.id),Ye=tt&&tt.instances.get(be.id);if(!Ye)return;const ze=qe.updateType;if(ze&B.$.State.VISIBILITIES&&(Ye.isVisible=be.instanceParameters.visible),ze&(B.$.State.HIGHLIGHTS|B.$.State.VISIBILITIES)){const et=be.instanceParameters.visible;Ye.hasHighlights=!!be.instanceParameters.highlights&&et}if(ze&B.$.State.OCCLUDEES&&(Ye.hasOccludees=!!be.instanceParameters.occludees),ze&(B.$.State.VERTEXATTRS|B.$.State.TRANSFORMATION)){const{array:et,vao:ke}=tt.buffer;(0,me.bZ)(be,Be,Se),ve.write({transformation:Be,invTranspTransformation:Se},be.data,ve.vertexBufferLayout.createView(et.buffer),Ye.from),(0,ie.hu)(Ye.from+ve.elementCount(be.data)===Ye.to,"material VBO layout has changed"),ke.vertexBuffers.geometry.setSubData(et,Ye.from*Ke*4,Ye.from*Ke*4,Ye.to*Ke*4)}tt.drawCommandsDirty=!0}}_updateRenderCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(ve=>{ve.hasHiddenInstances=!1,ve.hasHighlights=!1,ve.hasOccludees=!1,(0,x.oE)(ve.instances,Ke=>(Ke.isVisible?(Ke.hasHighlights&&(this._hasHighlights=!0,ve.hasHighlights=!0),Ke.hasOccludees&&(this._hasOccludees=!0,ve.hasOccludees=!0)):ve.hasHiddenInstances=!0,ve.hasHiddenInstances&&ve.hasHighlights&&ve.hasOccludees))});const Fe=ve=>{if(ve.drawCommandsDefault=null,ve.drawCommandsHighlight=null,ve.drawCommandsOccludees=null,ve.drawCommandsShadowHighlightRest=null,0===ve.instances.size)return;if(!xe(ve))return void(ve.drawCommandsDefault=[{first:0,count:4*ve.buffer.size/this._bufferWriter.vertexBufferLayout.stride}]);const Ke=j(ve.instances);ve.drawCommandsDefault=[],ve.drawCommandsHighlight=[],ve.drawCommandsOccludees=[],ve.drawCommandsShadowHighlightRest=[];for(const qe of Ke)qe.isVisible&&(U(qe.hasOccludees?ve.drawCommandsOccludees:ve.drawCommandsDefault,qe),U(qe.hasHighlights?ve.drawCommandsHighlight:ve.drawCommandsShadowHighlightRest,qe))};this._dataByOrigin.forEach(ve=>{ve.drawCommandsDirty&&(Fe(ve),ve.drawCommandsDirty=!1)})}updateAnimation(Fe){return this._material.update(Fe)}requiresSlot(Fe,ve){return null==Fe||this._material.requiresSlot(Fe,ve)}render(Fe,ve){if(!this.requiresSlot(ve.slot,Fe))return!1;const Ke=Fe===Z.C.MATERIAL_HIGHLIGHT||Fe===Z.C.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(Ke&&!this._hasHighlights)return!1;const qe=Fe===Z.C.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,be=!(Ke||qe);if(this._dataByOrigin.forEach(et=>{if(Ke&&!et.hasHighlights)return;const ke=(Ke?et.drawCommandsHighlight:qe&&xe(et)?et.drawCommandsShadowHighlightRest:et.drawCommandsDefault)||null,ot=be&&et.drawCommandsOccludees||null;((0,A.pC)(ke)||(0,A.pC)(ot))&&this._renderCommandData.push(new we(et.origin,et.buffer,ke,ot))}),0===this._renderCommandData.length)return!1;const tt=this._rctx,Ye=this._glMaterials.load(tt,Fe);if((0,A.Wi)(Ye))return this._renderCommandData.clear(),!1;const ze=Ye.beginSlot(ve);return tt.bindTechnique(ze,this._material.parameters,ve,!1),this._renderCommandData.forAll(et=>{ze.bindDraw(et,ve);const{buffer:ke,renderCommands:ot,occludeeCommands:at}=et;ze.ensureAttributeLocations(ke.vao),tt.bindVAO(ke.vao);const yt=ze.primitiveType;(0,A.pC)(ot)&&this._renderCommands(tt,yt,ot),(0,A.pC)(at)&&(ze.bindPipelineState(tt,ve.slot,!0),this._renderCommands(tt,yt,at),ze.bindPipelineState(tt,ve.slot,!1))}),this._renderCommandData.clear(),!0}_renderCommands(Fe,ve,Ke){for(let qe=0;qe<Ke.length;qe++)Fe.drawArrays(ve,Ke[qe].first,Ke[qe].count)}_removeAndRebuild(Fe,ve,Ke,qe,be){for(const ke of ve)Fe.instances.delete(ke.id);const tt=j(Fe.instances);Fe.instances.clear();const Ye=Fe.buffer.size,ze=Fe.buffer.alloc(qe);let et=0;for(const ke of tt){const ot=ke.from*Ke,at=ke.to*Ke;ze.copy(et,ot,at),ke.from=et/Ke,et+=at-ot,ke.to=et/Ke,Fe.instances.set(ke.id,ke)}be.push(new le(0,ze.hasNewBuffer?Fe.buffer.array.length:Ye)),ze.dispose(),Fe.buffer.erase(et,be.back().to),Fe.holes.clear()}_remove(Fe,ve,Ke,qe){for(const be of ve){const tt=be.id,Ye=Fe.instances.get(tt),ze=Ye.from*Ke,et=Ye.to*Ke;Fe.buffer.erase(ze,et),Fe.holes.push(new le(Ye.from,Ye.to)),Fe.instances.delete(tt),qe.push(new le(ze,et))}We(Fe.holes)}_add(Fe,ve,Ke,qe,be){if(0===ve.length)return;const tt=this._bufferWriter;let Ye=tt.vertexBufferLayout.createView(Fe.buffer.array.buffer);const ze=Fe.holes.length>0;let et=Number.MAX_SAFE_INTEGER,ke=Number.MIN_SAFE_INTEGER;for(const ot of ve){const at=(0,A.pC)(ot.transformation)?(0,Q.m)(Be,qe,ot.transformation):qe;(0,Q.a)(Se,at);const yt=(0,Q.t)(Se,Se),wt=tt.elementCount(ot.data),zt=wt*Ke;let Rt=je(Fe.holes,wt);(0,A.Wi)(Rt)&&(Rt=Fe.buffer.size/Ke,Fe.buffer.grow(zt),Ye=tt.vertexBufferLayout.createView(Fe.buffer.array.buffer)),tt.write({transformation:at,invTranspTransformation:yt},ot.data,Ye,Rt);const Ft=ot.instanceParameters.visible,Xt=new Y(ot.id,Rt,Rt+wt,Ft,!!ot.instanceParameters.highlights&&Ft,!!ot.instanceParameters.occludees);(0,ie.hu)(null==Fe.instances.get(ot.id)),Fe.instances.set(ot.id,Xt),ze?be.push(new le(Xt.from*Ke,Xt.to*Ke)):(et=Math.min(Xt.from,et),ke=Math.max(Xt.to,ke))}ze||be.push(new le(et*Ke,ke*Ke))}get test(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}class Ie{constructor(Fe){this.origin=Fe,this.toAdd=new Array,this.toRemove=new Array}}function Je(De,Fe,ve){const Ke=Fe.origin;if((0,A.Wi)(Ke))return;let qe=De.get(Ke.id);null==qe&&(qe=new Ie(Ke.vec3),De.set(Ke.id,qe)),ve?qe.toAdd.push(Fe):qe.toRemove.push(Fe)}function xe(De){return De.hasOccludees||De.hasHighlights||De.hasHiddenInstances}function je(De,Fe){let ve;if(!De.some(qe=>!(qe.to-qe.from<Fe||(ve=qe,0))))return null;const Ke=ve.from;return ve.from+=Fe,ve.from>=ve.to&&De.removeUnordered(ve),Ke}function We(De){const Fe=new Map;De.forAll(Ke=>Fe.set(Ke.from,Ke));let ve=!0;for(;ve;)ve=!1,De.forEach(Ke=>{const qe=Fe.get(Ke.to);qe&&(Ke.to=qe.to,Fe.delete(qe.from),De.removeUnordered(qe),ve=!0)})}class Ne{constructor(Fe,ve){this.origin=Fe,this.buffer=ve,this.instances=new Map,this.holes=new G.Z({deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!1}}class we extends ue.w{constructor(Fe,ve,Ke,qe){super(Fe),this.buffer=ve,this.renderCommands=Ke,this.occludeeCommands=qe}}const Oe=new G.Z({deallocator:null}),$e=(0,H.c)(),Be=(0,H.c)(),Se=(0,H.c)()},65073:(dt,Re,T)=>{"use strict";T.d(Re,{EE:()=>Z,PD:()=>W,U_:()=>J,bZ:()=>B,lr:()=>re});var x=T(62208),A=T(28347),G=T(43703),Q=T(2282),H=T(2757);function re(oe,le){return(0,x.Wi)(oe)&&(oe=[]),oe.push(le),oe}function J(oe,le){if((0,x.Wi)(oe))return null;const Y=oe.filter(j=>j!==le);return 0===Y.length?null:Y}function W(oe){return!!(0,x.pC)(oe)&&!oe.visible}function B(oe,le,Y){const j=oe.origin.vec3;(0,Q.u_)(ce,-j[0],-j[1],-j[2]),(0,x.pC)(oe.transformation)?(0,A.m)(le,ce,oe.transformation):(0,A.c)(le,ce),Y&&((0,A.a)(Y,le),(0,A.t)(Y,Y))}function Z(oe,le,Y,j,X){ie[0]=oe.get(le,0),ie[1]=oe.get(le,1),ie[2]=oe.get(le,2),(0,H.LF)(ie,ue,3),Y.set(X,0,ue[0]),j.set(X,0,ue[1]),Y.set(X,1,ue[2]),j.set(X,1,ue[3]),Y.set(X,2,ue[4]),j.set(X,2,ue[5])}const ie=new Float64Array(3),ue=new Float32Array(6),ce=(0,G.c)()},54580:(dt,Re,T)=>{"use strict";T.d(Re,{Fv:()=>Q,ZB:()=>H,v3:()=>G});var G,Q,re,x=T(17626),A=T(87601);(re=G||(G={}))[re.Standard=0]="Standard",re[re.TransparentToHUDVisibility=1]="TransparentToHUDVisibility",re[re.Transparency=2]="Transparency",re[re.OverlayWithTransparency=3]="OverlayWithTransparency",re[re.COUNT=4]="COUNT",function(re){re[re.None=0]="None",re[re.Alpha=1]="Alpha",re[re.PremultipliedAlpha=2]="PremultipliedAlpha",re[re.COUNT=3]="COUNT"}(Q||(Q={}));class H extends A.m{constructor(){super(...arguments),this.function=G.Standard,this.alphaMode=Q.None,this.hasOpacityFactor=!1}}(0,x._)([(0,A.o)({count:G.COUNT})],H.prototype,"function",void 0),(0,x._)([(0,A.o)({count:Q.COUNT})],H.prototype,"alphaMode",void 0),(0,x._)([(0,A.o)()],H.prototype,"hasOpacityFactor",void 0)},39711:(dt,Re,T)=>{"use strict";T.d(Re,{Qm:()=>ne,em:()=>$,tT:()=>se});var x=T(550),A=T(28093),G=T(4794),Q=T(59617),H=T(6945),re=T(36603),J=T(21799),W=T(67022),B=T(7228),Z=T(651),ie=T(91056),ue=T(42743),ce=T(39114),oe=T(40723),le=T(88569),Y=T(12407),j=T(64127),X=T(96160),U=T(67969),ee=T(2078);class $ extends J.d4{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=(0,A.f)(0,1,.5),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=ue.Vr.Back,this.emissiveFactor=(0,A.f)(0,0,0),this.instancedDoublePrecision=!1,this.normals="default",this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=(0,A.f)(.2,.2,.2),this.diffuse=(0,A.f)(.8,.8,.8),this.externalColor=(0,G.f)(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=(0,A.c)(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSizeEnabled=!1,this.vvSizeMinSize=[1,1,1],this.vvSizeMaxSize=[100,100,100],this.vvSizeOffset=[0,0,0],this.vvSizeFactor=[1,1,1],this.vvSizeValue=[1,1,1],this.vvColorEnabled=!1,this.vvColorValues=[0,0,0,0,0,0,0,0],this.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],this.vvSymbolAnchor=[0,0,0],this.vvSymbolRotationMatrix=(0,x.c)(),this.vvOpacityEnabled=!1,this.vvOpacityValues=[],this.vvOpacityOpacities=[],this.transparent=!1,this.writeDepth=!0,this.customDepthTest=ue.Gv.Less,this.textureAlphaMode=ue.JJ.Blend,this.textureAlphaCutoff=W.F,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=oe.yD.Occlude}}class ne extends J.Pf{constructor(){super(...arguments),this.origin=(0,A.c)(),this.slicePlaneLocalOrigin=this.origin}}class se extends ie.A{initializeConfiguration(_e,pe){pe.spherical=_e.viewingMode===Q.JY.Global,pe.doublePrecisionRequiresObfuscation=(0,B.I)(_e.rctx),pe.textureCoordinateType=pe.hasColorTexture||pe.hasMetalnessAndRoughnessTexture||pe.hasEmissionTexture||pe.hasOcclusionTexture||pe.hasNormalTexture?re.N.Default:re.N.None}initializeProgram(_e){return this._initializeProgram(_e,se.shader)}_initializeProgram(_e,pe){const he=pe.get().build(this.configuration);return new Y.$(_e.rctx,he,ce.i)}_convertDepthTestFunction(_e){return _e===ue.Gv.Lequal?U.wb.LEQUAL:U.wb.LESS}_setPipeline(_e,pe){const he=this.configuration,ge=_e===ue.Am.NONE,ye=_e===ue.Am.FrontFace;return(0,ee.sm)({blending:he.output!==H.H.Color&&he.output!==H.H.Alpha||!he.transparent?null:ge?le.wu:(0,le.j7)(_e),culling:(de=he,(de.cullFace!==ue.Vr.None||!de.hasSlicePlane&&!de.transparent&&!de.doubleSidedMode)&&(0,ee.zp)(he.cullFace)),depthTest:{func:(0,le.Bh)(_e,this._convertDepthTestFunction(he.customDepthTest))},depthWrite:ge||ye?he.writeDepth&&ee.LZ:null,colorWrite:ee.BK,stencilWrite:he.hasOccludees?j.s3:null,stencilTest:he.hasOccludees?pe?j.eD:j.RY:null,polygonOffset:ge||ye?null:(0,le.je)(he.enableOffset)});var de}initializePipeline(){return this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0),this._setPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(_e,pe){return pe?this._occludeePipelineState:super.getPipelineState(_e,pe)}}se.shader=new Z.J(X.D,()=>T.e(3907).then(T.bind(T,83907)))},39401:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>J,R:()=>re});var re,W,x=T(17626),A=T(6945),G=T(87601),Q=T(42743),H=T(41528);(W=re||(re={}))[W.BUTT=0]="BUTT",W[W.SQUARE=1]="SQUARE",W[W.ROUND=2]="ROUND",W[W.COUNT=3]="COUNT";class J extends H.W{constructor(){super(...arguments),this.output=A.H.Color,this.capType=re.BUTT,this.transparencyPassType=Q.Am.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1}}(0,x._)([(0,G.o)({count:A.H.COUNT})],J.prototype,"output",void 0),(0,x._)([(0,G.o)({count:re.COUNT})],J.prototype,"capType",void 0),(0,x._)([(0,G.o)({count:Q.Am.COUNT})],J.prototype,"transparencyPassType",void 0),(0,x._)([(0,G.o)()],J.prototype,"occluder",void 0),(0,x._)([(0,G.o)()],J.prototype,"hasSlicePlane",void 0),(0,x._)([(0,G.o)()],J.prototype,"hasPolygonOffset",void 0),(0,x._)([(0,G.o)()],J.prototype,"writeDepth",void 0),(0,x._)([(0,G.o)()],J.prototype,"draped",void 0),(0,x._)([(0,G.o)()],J.prototype,"stippleEnabled",void 0),(0,x._)([(0,G.o)()],J.prototype,"stippleOffColorEnabled",void 0),(0,x._)([(0,G.o)()],J.prototype,"stippleScaleWithLineWidth",void 0),(0,x._)([(0,G.o)()],J.prototype,"stipplePreferContinuous",void 0),(0,x._)([(0,G.o)()],J.prototype,"roundJoins",void 0),(0,x._)([(0,G.o)()],J.prototype,"vvSize",void 0),(0,x._)([(0,G.o)()],J.prototype,"vvColor",void 0),(0,x._)([(0,G.o)()],J.prototype,"vvOpacity",void 0),(0,x._)([(0,G.o)()],J.prototype,"falloffEnabled",void 0),(0,x._)([(0,G.o)()],J.prototype,"innerColorEnabled",void 0),(0,x._)([(0,G.o)()],J.prototype,"hasOccludees",void 0),(0,x._)([(0,G.o)()],J.prototype,"hasMultipassTerrain",void 0),(0,x._)([(0,G.o)()],J.prototype,"cullAboveGround",void 0),(0,x._)([(0,G.o)()],J.prototype,"wireframe",void 0),(0,x._)([(0,G.o)({constValue:!0})],J.prototype,"stippleRequiresClamp",void 0),(0,x._)([(0,G.o)({constValue:!0})],J.prototype,"stippleRequiresStretchMeasure",void 0),(0,x._)([(0,G.o)({constValue:!0})],J.prototype,"hasVvInstancing",void 0),(0,x._)([(0,G.o)({constValue:!0})],J.prototype,"hasSliceTranslatedView",void 0)},69828:(dt,Re,T)=>{"use strict";T.d(Re,{l:()=>Q,w:()=>G});var G,H,x=T(17626),A=T(87601);(H=G||(G={}))[H.Gradient=0]="Gradient",H[H.Threshold=1]="Threshold",H[H.COUNT=2]="COUNT";class Q extends A.m{constructor(){super(...arguments),this.visualization=G.Gradient,this.bandsEnabled=!1}}(0,x._)([(0,A.o)({count:G.COUNT})],Q.prototype,"visualization",void 0),(0,x._)([(0,A.o)()],Q.prototype,"bandsEnabled",void 0)},57008:(dt,Re,T)=>{"use strict";T.d(Re,{g:()=>B});var x=T(99770),A=T(17625);function G(Z){const ie=A.H`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;Z.code.add(ie)}var Q=T(95285),H=T(91574),re=T(63123),J=T(46524);const W=(0,x.f)(.5,-4e-4);function B(Z,ie){const ue=Z.vertex;ue.include(G),ue.constants.add("depthBias","vec2",W),ue.uniforms.add(new Q.A("inverseViewport",(ce,oe)=>oe.inverseViewport)),ie.legacy?(ue.uniforms.add(new J.B("localView")),ue.uniforms.add(new re.g("proj",(ce,oe)=>oe.camera.projectionMatrix)),ue.code.add(A.H`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(ue.uniforms.add(new H.c("transformNormalViewFromGlobal",ce=>ce.transformNormalViewFromGlobal)),ue.uniforms.add(new re.g("transformProjFromView",ce=>ce.transformProjFromView)),ue.code.add(A.H`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),ue.code.add(A.H`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}},98828:(dt,Re,T)=>{"use strict";T.d(Re,{S:()=>A});var x=T(17625);function A(G,Q){const H=G.fragment;H.constants.add("coverageTestThreshold","float",.01),H.code.add(Q.antialiasing?x.H`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`:x.H`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}},72175:(dt,Re,T)=>{"use strict";T.d(Re,{o:()=>A});var x=T(17625);function A(G,Q){const H=G.vertex;Q.silhouette?(H.code.add(x.H`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),H.code.add(Q.legacy?x.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`:x.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):H.code.add(x.H`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}},98412:(dt,Re,T)=>{"use strict";T.d(Re,{l:()=>G});var x=T(17625),A=T(73105);function G(Q,H){const re=Q.vertex;switch(H.mode){case A.Jb.SKETCH:re.code.add(x.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case A.Jb.MIXED:re.code.add(x.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case A.Jb.SOLID:re.code.add(x.H`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}}},73105:(dt,Re,T)=>{"use strict";T.d(Re,{Jb:()=>j,UR:()=>oe,lV:()=>le});var j,X,x=T(35357),A=T(7228),G=T(19278),Q=T(65364),H=T(77739),re=T(97139),J=T(65787),W=T(17625),B=T(9546),Z=T(91574),ie=T(63123),ue=T(66838),ce=T(16396);function oe(X,U){const ee=X.vertex;ee.include(G.n),ee.uniforms.add(new J.p("distanceFalloffFactor",$=>$.distanceFalloffFactor)),ee.code.add(W.H`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),ee.uniforms.add(new ue.Q("componentDataTex")),ee.uniforms.add(new Q.e("componentDataTexInvDim")),X.attributes.add(ce.T.COMPONENTINDEX,"float"),ee.constants.add("componentColorFieldOffset","float",0),ee.constants.add("componentOtherFieldOffset","float",1),ee.constants.add("componentVerticalOffsetFieldOffset","float",2),ee.constants.add("componentFieldCount","float",3),ee.constants.add("lineWidthFractionFactor","float",8),ee.constants.add("extensionLengthOffset","float",128),ee.constants.add("componentTexWidth","float",4096),ee.constants.add("verticalOffsetScale","float",2*x.E_),ee.code.add(W.H`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),U.legacy?ee.code.add(W.H`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(ee.uniforms.add(new B.j("transformNormalGlobalFromModel",$=>$.transformNormalGlobalFromModel)),ee.code.add(W.H`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),U.silhouette?(X.attributes.add(ce.T.NORMALA,"vec3"),X.attributes.add(ce.T.NORMALB,"vec3"),ee.code.add(W.H`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(X.attributes.add(ce.T.NORMAL,"vec3"),ee.code.add(W.H`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),U.legacy?ee.code.add(W.H`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(ee.include(A.$,U),ee.include(A.$,U),ee.uniforms.add([new Z.c("transformViewFromCameraRelativeRS",$=>$.transformViewFromCameraRelativeRS),new B.j("transformWorldFromModelRS",$=>$.transformWorldFromModelRS),new H.B("transformWorldFromModelTL",$=>$.transformWorldFromModelTL),new H.B("transformWorldFromModelTH",$=>$.transformWorldFromModelTH),new re.J("transformWorldFromViewTL",$=>$.transformWorldFromViewTL),new re.J("transformWorldFromViewTH",$=>$.transformWorldFromViewTH)]),ee.code.add(W.H`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${U.spherical?W.H`normalize(transformWorldFromModelTL + rotatedModelPosition);`:W.H`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),ee.uniforms.add(new ie.g("transformProjFromView",($,ne)=>ne.camera.projectionMatrix)),ee.code.add(W.H`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),ee.code.add(W.H`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function le(X){return X.mode===j.SKETCH||X.mode===j.MIXED}(X=j||(j={}))[X.SOLID=0]="SOLID",X[X.SKETCH=1]="SKETCH",X[X.MIXED=2]="MIXED",X[X.COUNT=3]="COUNT"},10967:(dt,Re,T)=>{"use strict";T.d(Re,{B:()=>H});var x=T(84178),A=T(17625),G=T(73105),Q=T(69276);function H(re,J){const W=re.vertex;switch(re.include(Q.H,J),(0,G.lV)(J)&&W.uniforms.add(new x.d("strokesAmplitude")),J.mode){case G.Jb.SOLID:W.code.add(A.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case G.Jb.SKETCH:W.code.add(A.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case G.Jb.MIXED:W.code.add(A.H`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}},82716:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>W});var x=T(19278),A=T(65364),G=T(84178),Q=T(17625),H=T(66838),re=T(73105),J=T(69276);function W(B,Z){const ie=B.vertex;B.include(J.H,Z);const ue=B.fragment;switch((0,re.lV)(Z)&&(ie.uniforms.add(new A.e("strokesTextureScale")),ie.uniforms.add(new G.d("strokesLog2Resolution")),ie.uniforms.add(new G.d("strokeVariants")),B.varyings.add("vStrokeUV","vec2"),ue.uniforms.add(new H.Q("strokesTexture")),ue.uniforms.add(new G.d("strokesNormalizationScale")),ie.code.add(Q.H`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),B.fragment.include(x.n),ue.code.add(Q.H`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),Z.mode){case re.Jb.SOLID:ie.code.add(Q.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),ue.code.add(Q.H`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case re.Jb.SKETCH:ie.code.add(Q.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),ue.code.add(Q.H`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case re.Jb.MIXED:B.varyings.add("vType","float"),ie.code.add(Q.H`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),ue.code.add(Q.H`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}},69276:(dt,Re,T)=>{"use strict";T.d(Re,{H:()=>H});var x=T(94573),A=T(17625),G=T(16396),Q=T(73105);function H(re,J){const W=re.vertex;switch(re.attributes.add(G.T.SIDENESS,"vec2"),W.code.add(J.mode===Q.Jb.MIXED?A.H`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`:A.H`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),J.mode){case Q.Jb.MIXED:W.code.add(A.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case Q.Jb.SKETCH:W.code.add(A.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Q.Jb.SOLID:W.code.add(A.H`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case Q.Jb.COUNT:break;default:(0,x.Bg)(J.mode)}}},59029:(dt,Re,T)=>{"use strict";T.d(Re,{f:()=>Qn,t:()=>bi});var x=T(17626),A=T(40764),G=T(32917),Q=T(50618),H=T(77712),re=T(85931),B=(T(8314),T(90912),T(76898)),Z=T(14517),ie=T(46160),ue=T(17760),oe=(T(50645),T(62996));let le=class extends Z.Z{constructor(){super(...arguments),this.items=new ie.Z,this._watchUpdatingTracking=new ue.t,this._callbacks=new Map,this._projector=(0,oe.E)(),this._hiddenProjector=(0,oe.E)()}get needsRender(){return this.items.length>0}initialize(){const Le=document.createElement("div");Le.className="esri-overlay-surface",this._set("surface",Le),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),Le.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,Qe=>{for(const ut of Qe.added){const Et=()=>ut.render();this._callbacks.set(ut,Et),this._projector.append(this.surface,Et)}for(const ut of Qe.removed){const Et=this._projector.detach(this._callbacks.get(ut));this.surface.removeChild(Et.domNode),this._callbacks.delete(ut)}})}addItem(Le){this.items.add(Le)}removeItem(Le){this.items.remove(Le)}destroy(){this.items.removeAll(),this._callbacks.forEach(Le=>this._projector.detach(Le)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(Le){const Qe=this._hiddenSurface,ut=this._hiddenProjector;let Et=null;const xt=()=>(Et=Le.render(),Et);ut.append(Qe,xt),ut.renderNow();const Gt={left:0,top:0,right:0,bottom:0};if(Et&&Et.domNode){const ar=Et.domNode.getBoundingClientRect();Gt.left=ar.left,Gt.top=ar.top,Gt.right=ar.right,Gt.bottom=ar.bottom}for(ut.detach(xt);Qe.firstChild;)Qe.removeChild(Qe.firstChild);return Gt}overlaps(Le,Qe){const ut=this.computeBoundingRect(Le),Et=this.computeBoundingRect(Qe);return Math.max(ut.left,Et.left)<=Math.min(ut.right,Et.right)&&Math.max(ut.top,Et.top)<=Math.min(ut.bottom,Et.bottom)}get hasVisibleItems(){return this.items.some(Le=>Le.visible)}renderCanvas(Le){if(!this.items.some(ut=>ut.visible))return;const Qe=Le.getContext("2d");Qe.save(),Qe.font=`10px ${getComputedStyle(this.surface).fontFamily}`,this.items.forEach(ut=>{Qe.save(),ut.renderCanvas(Qe),Qe.restore()}),Qe.restore()}};(0,x._)([(0,H.Cb)({readOnly:!0})],le.prototype,"surface",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],le.prototype,"items",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],le.prototype,"needsRender",null),(0,x._)([(0,H.Cb)({readOnly:!0})],le.prototype,"_watchUpdatingTracking",void 0),(0,x._)([(0,H.Cb)({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],le.prototype,"updating",void 0),le=(0,x._)([(0,B.j)("esri.views.overlay.ViewOverlay")],le);const Y=le;var j=T(15861),U=(T(52515),T(17770)),ee=T(72392),$=T(63290),ne=T(62208);function se(Le,Qe,ut,Et){let xt=null,Gt=1e3;"number"==typeof Qe?(Gt=Qe,Et=ut):(xt=null!=Qe?Qe:null,Gt=ut);let ar,Ve=0;const gt=()=>{Ve=0,Le.apply(Et,ar)},Pt=(...Yt)=>{xt&&xt.apply(Et,Yt),ar=Yt,Gt?Ve||(Ve=setTimeout(gt,Gt)):gt()};return Pt.remove=()=>{Ve&&(clearTimeout(Ve),Ve=0)},Pt.forceUpdate=()=>{Ve&&(clearTimeout(Ve),gt())},Pt.hasPendingUpdates=()=>!!Ve,Pt}var ae=T(83960),de=T(66656),_e=T(10391),pe=T(26584),he=T(90466),ge=T(88879),ye=T(87183),Me=T(67736),Ee=T(77275),Te=T(88411),me=T(15348),Ce=T(36630),Ie=T(66845),Ge=T(46679);const xe=$.Z.getLogger("esri.widgets.Feature.support.featureUtils"),je=/href=(""|'')/gi,We=/(\{([^\{\r\n]+)\})/g,Ne=/\'/g,we=/^\s*expression\//i,Oe=/(\n)/gi,$e=/[\u00A0-\u9999<>\&]/gim,Be=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,Se=/^(?:mailto:|tel:)/,De="relationships/",Fe=(0,Te.Ze)("short-date-short-time");function ve(Le){if(!(0,ne.Wi)(Le))return Le.get("sourceLayer")||Le.get("layer")}function Ke(Le,Qe){return qe.apply(this,arguments)}function qe(){return(qe=(0,j.Z)(function*(Le,Qe){return"function"==typeof Le?Le.call(null,Qe):Le})).apply(this,arguments)}function be(Le=""){if(Le)return!Se.test(Le.trim().toLowerCase())}function tt(Le){return!!Le&&we.test(Le)}function ze(Le,Qe){const ut=function Ye(Le,Qe){if(!tt(Qe)||!Le)return null;const ut=Qe.replace(we,"").toLowerCase();let Et;return Le.some(xt=>xt.name.toLowerCase()===ut&&(Et=xt,!0)),Et}(Qe,null==Le?void 0:Le.fieldName);return ut?ut.title||null:Le?Le.label||Le.fieldName:null}function ot(Le,Qe){const ut=yt(Qe,Le);return ut?ut.name:Le}function yt(Le,Qe){return Le&&"function"==typeof Le.getField?Le.getField(Qe):null}function wt(Le){return`${Le}`.trim()}function zt({attributes:Le,globalAttributes:Qe,layer:ut,text:Et,expressionAttributes:xt,fieldInfoMap:Gt}){return Et?Rt({formattedAttributes:Qe,template:Mr(Et,or(or(or({},Qe),xt),Le),ut),fieldInfoMap:Gt}):""}function Rt({formattedAttributes:Le,template:Qe,fieldInfoMap:ut}){return wt(function ke(Le){return Le.replace(je,"")}((0,Ee.gx)((0,Ee.gx)(Qe,Et=>function et(Le,Qe){const ut=Qe.get(Le.toLowerCase());return`{${ut&&ut.fieldName||Le}}`}(Et,ut)),Le)))}function Xt(Le,Qe){return Le.replace(We,(ut,Et,xt)=>{const Gt=yt(Qe,xt);return Gt?`{${Gt.name}}`:Et})}function Mr(Le,Qe,ut){const Et=Xt(Le,ut);return Et&&Et.replace(Be,(xt,Gt,ar)=>function St(Le,Qe,ut){const Et=(Qe=wt(Qe))&&"{"!==Qe[0];return(0,Ee.gx)(Le,function bt(Le,Qe=!1){const ut=or({},Le);return Object.keys(ut).forEach(Et=>function Ft(Le,Qe,ut=!1){const Et=Qe[Le];if("string"==typeof Et){const xt="%27",Gt=(ut?encodeURIComponent(Et):Et).replace(Ne,xt);Qe[Le]=Gt}}(Et,ut,Qe)),ut}(ut,Et))}(xt,Gt||ar,Qe))}function Lr(Le){return!!(null==Le?void 0:Le.layer)}function qt(Le,Qe){if(!Le||!Le.length||!Qe)return;const ut=Qe.toLowerCase();let Et;return Le.some(xt=>!(!xt.fieldName||xt.fieldName.toLowerCase()!==ut||(Et=xt,0))),Et}function fr(Le){const Qe=[];if(!Le)return Qe;const{fieldInfos:ut,content:Et}=Le;return ut&&Qe.push(...ut),Et&&Array.isArray(Et)&&Et.forEach(xt=>{if("fields"===xt.type){const Gt=xt&&xt.fieldInfos;Gt&&Qe.push(...Gt)}}),Qe}function Ur(Le){return Le.replace($e,Qe=>`&#${Qe.charCodeAt(0)};`)}function Br(Le){return"string"==typeof Le?Le.replace(Oe,'<br class="esri-text-new-line" />'):Le}function Zr(Le){const{value:Qe,fieldName:ut,fieldInfos:Et,fieldInfoMap:xt,layer:Gt,graphic:ar}=Le;if(null==Qe)return"";const Ve=function Zt({fieldName:Le,value:Qe,graphic:ut,layer:Et}){if(Ot(Le)||!Et||"function"!=typeof Et.getFieldDomain)return null;const xt=Et.getFieldDomain(Le,{feature:ut});return xt&&"coded-value"===xt.type?xt.getName(Qe):null}({fieldName:ut,value:Qe,graphic:ar,layer:Gt});if(Ve)return Ve;const gt=function er({fieldName:Le,graphic:Qe,layer:ut}){if(Ot(Le)||!ut||"function"!=typeof ut.getFeatureType)return null;const{typeIdField:Et}=ut;if(!Et||Le!==Et)return null;const xt=ut.getFeatureType(Qe);return xt?xt.name:null}({fieldName:ut,graphic:ar,layer:Gt});if(gt)return gt;if(xt.get(ut.toLowerCase()))return function jt(Le,Qe){var Pt;const Et=Qe.fieldName,xt=null==(Pt=qt(Qe.fieldInfos,Et))?void 0:Pt.clone(),Gt=Qe.preventPlacesFormatting,ar=Qe.layer,Ve=yt(ar,Et);if(xt&&"date"===(null==Ve?void 0:Ve.type)){const Yt=xt.format||new Ie.Z;Yt.dateFormat=Yt.dateFormat||"short-date-short-time",Yt.dateTimeFormatOptions=!Lr(ar)&&function Yr(Le){return"feature"===(null==Le?void 0:Le.type)}(ar)&&ar.datesInUnknownTimezone||Lr(ar)&&function ct(Le){return"map-image"===(null==Le?void 0:Le.type)}(ar.layer)&&ar.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,xt.format=Yt}const gt=xt&&xt.format;return"string"==typeof Le&&(0,Ce.Ec)(Et)&&gt?gt.formatRasterPixelValue(Le):"string"==typeof(Le=function Cr(Le,Qe){if("string"==typeof Le&&Qe&&null==Qe.dateFormat&&(null!=Qe.places||null!=Qe.digitSeparator)){const ut=Number(Le);if(!isNaN(ut))return ut}return Le}(Le,gt))||null==Le||null==gt?Br(Le):Gt?(0,me.uf)(Le,yi(or({},(0,me.sh)(gt)),{minimumFractionDigits:0,maximumFractionDigits:20})):gt.format(Le)}(Qe,{fieldInfos:Et||Array.from(xt.values()),fieldName:ut,layer:Gt});const Pt=Gt&&Gt.fieldsIndex;return Pt&&Pt.isDateField(ut)?(0,Te.p6)(Qe,Fe):Br(Qe)}function ri({fieldInfos:Le,attributes:Qe,layer:ut,graphic:Et,fieldInfoMap:xt,relatedInfos:Gt}){const ar={};return null==Gt||Gt.forEach(Ve=>function Pr({attributes:Le,relatedInfo:Qe,fieldInfoMap:ut,fieldInfos:Et,layer:xt}){Le&&Qe&&(Qe.relatedFeatures&&Qe.relatedFeatures&&Qe.relatedFeatures.forEach(Gt=>pr({attributes:Le,graphic:Gt,relatedInfo:Qe,fieldInfoMap:ut,fieldInfos:Et,layer:xt})),Qe.relatedStatsFeatures&&Qe.relatedStatsFeatures&&Qe.relatedStatsFeatures.forEach(Gt=>pr({attributes:Le,graphic:Gt,relatedInfo:Qe,fieldInfoMap:ut,fieldInfos:Et,layer:xt})))}({attributes:ar,relatedInfo:Ve,fieldInfoMap:xt,fieldInfos:Le,layer:ut})),Object.keys(Qe).forEach(Ve=>{ar[Ve]=Zr({fieldName:Ve,fieldInfos:Le,fieldInfoMap:xt,layer:ut,value:Qe[Ve],graphic:Et})}),ar}function hr(Le,Qe){return Dr.apply(this,arguments)}function Dr(){return(Dr=(0,j.Z)(function*(Le,Qe){var Yt,Jr;const{layer:ut,graphic:Et,outFields:xt,objectIds:Gt,returnGeometry:ar,spatialReference:Ve}=Le,gt=Gt[0];if("number"!=typeof gt&&"string"!=typeof gt)return xe.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:ut,graphic:Et,objectId:gt,requiredFields:xt}),null;if(!(null==(Jr=null==(Yt=ut.capabilities)?void 0:Yt.operations)?void 0:Jr.supportsQuery))return xe.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:ut,graphic:Et,requiredFields:xt,returnGeometry:ar}),null;const Pt=ut.createQuery();return Pt.objectIds=Gt,Pt.outFields=(null==xt?void 0:xt.length)?xt:[ut.objectIdField],Pt.returnGeometry=!!ar,Pt.returnZ=!!ar,Pt.returnM=!!ar,Pt.outSpatialReference=Ve,(yield ut.queryFeatures(Pt,Qe)).features[0]})).apply(this,arguments)}function Kr(Le){return Nt.apply(this,arguments)}function Nt(){return(Nt=(0,j.Z)(function*(Le){var Et;if(!(null==(Et=Le.expressionInfos)?void 0:Et.length))return!1;const Qe=yield(0,Ge.LC)(),{arcadeUtils:{hasGeometryFunctions:ut}}=Qe;return ut(Le)})).apply(this,arguments)}function jr(){return(jr=(0,j.Z)(function*({graphic:Le,popupTemplate:Qe,layer:ut,spatialReference:Et},xt){if(!ut||!Qe||("function"==typeof ut.load&&(yield ut.load(xt)),!Le.attributes))return;const Gt=Le.attributes[ut.objectIdField];if(null==Gt)return;const ar=[Gt],Ve=yield Qe.getRequiredFields(ut.fieldsIndex),gt=(0,Ce.R9)(Ve,Le),Pt=gt?[]:Ve,Yt=Qe.returnGeometry||(yield Kr(Qe));if(gt&&!Yt)return;const Jr=yield hr({layer:ut,graphic:Le,outFields:Pt,objectIds:ar,returnGeometry:Yt,spatialReference:Et},xt);Jr&&(Jr.geometry&&(Le.geometry=Jr.geometry),Jr.attributes&&(Le.attributes=or(or({},Le.attributes),Jr.attributes)))})).apply(this,arguments)}function Ot(Le=""){return!!Le&&Le.includes(De)}function pr({attributes:Le,graphic:Qe,relatedInfo:ut,fieldInfos:Et,fieldInfoMap:xt,layer:Gt}){Le&&Qe&&ut&&Object.keys(Qe.attributes).forEach(ar=>{const Ve=function rr(Le){return Le?`${De}${Le.layerId}/${Le.fieldName}`:""}({layerId:ut.relation.id.toString(),fieldName:ar});Le[Ve]=Zr({fieldName:Ve,fieldInfos:Et,fieldInfoMap:xt,layer:Gt,value:Qe.attributes[ar],graphic:Qe})})}const Fr=Le=>{if(!Le)return!1;const Qe=Le.toUpperCase();return Qe.includes("CURRENT_TIMESTAMP")||Qe.includes("CURRENT_DATE")||Qe.includes("CURRENT_TIME")},ii=({layer:Le,method:Qe,query:ut,definitionExpression:Et})=>{var ar,Ve;if(!(null==(Ve=null==(ar=Le.capabilities)?void 0:ar.query)?void 0:Ve.supportsCacheHint)||"attachments"===Qe)return;const xt=(0,ne.pC)(ut.where)&&ut.where,Gt=(0,ne.pC)(ut.geometry)&&ut.geometry;Fr(Et)||Fr(xt)||"extent"===(null==Gt?void 0:Gt.type)||"tile"===ut.resultType||(ut.cacheHint=!0)},Qr={editing:!1,operations:{add:!0,update:!0,delete:!0}},Ni=ie.Z.ofType(ye.Z);let Ar=class extends Z.Z{constructor(Le){super(Le),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.abilities=or({},Qr),this.activeAttachmentInfo=null,this.attachmentInfos=new Ni,this.graphic=null,this.mode="view",this.own((0,G.YP)(()=>this.graphic,()=>this._graphicChanged(),G.nn))}destroy(){this._attachmentLayer=null,this.graphic=null}castAbilities(Le){return or(or({},Qr),Le)}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}getAttachments(){var Le=this;return(0,j.Z)(function*(){const{_attachmentLayer:Qe,attachmentInfos:ut}=Le;if(!Qe||"function"!=typeof Qe.queryAttachments)throw new pe.Z("invalid-layer","getAttachments(): A valid layer is required.");const Et=Le._getFeatureId(),xt=new Me.Z({objectIds:[Et],returnMetadata:!0}),Gt=[],ar=Qe.queryAttachments(xt).then(gt=>gt[Et]||Gt).catch(()=>Gt);Le._getAttachmentsPromise=ar,Le.notifyChange("state");const Ve=yield ar;return ut.removeAll(),Ve.length&&ut.addMany(Ve),Le._getAttachmentsPromise=null,Le.notifyChange("state"),Ve})()}addAttachment(Le){var Qe=this;return(0,j.Z)(function*(){const{_attachmentLayer:ut,attachmentInfos:Et,graphic:xt,abilities:Gt}=Qe;if(!Le)throw new pe.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:Le});if(!Gt.operations.add)throw new pe.Z("invalid-abilities","addAttachment(): add abilities are required.");if(!ut||"function"!=typeof ut.addAttachment)throw new pe.Z("invalid-layer","addAttachment(): A valid layer is required.");const ar=ut.addAttachment(xt,Le).then(gt=>Qe._queryAttachment(gt.objectId)),Ve=yield ar;return Et.add(Ve),Ve})()}deleteAttachment(Le){var Qe=this;return(0,j.Z)(function*(){const{_attachmentLayer:ut,attachmentInfos:Et,graphic:xt,abilities:Gt}=Qe;if(!Le)throw new pe.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:Le});if(!Gt.operations.delete)throw new pe.Z("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!ut||"function"!=typeof ut.deleteAttachments)throw new pe.Z("invalid-layer","deleteAttachment(): A valid layer is required.");const ar=ut.deleteAttachments(xt,[Le.id]).then(()=>Le),Ve=yield ar;return Et.remove(Ve),Ve})()}updateAttachment(Le,Qe=this.activeAttachmentInfo){var ut=this;return(0,j.Z)(function*(){const{_attachmentLayer:Et,attachmentInfos:xt,graphic:Gt,abilities:ar}=ut;if(!Le)throw new pe.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:Le});if(!Qe)throw new pe.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:Qe});if(!ar.operations.update)throw new pe.Z("invalid-abilities","updateAttachment(): Update abilities are required.");const Ve=xt.findIndex(Yt=>Yt===Qe);if(!Et||"function"!=typeof Et.updateAttachment)throw new pe.Z("invalid-layer","updateAttachment(): A valid layer is required.");const gt=Et.updateAttachment(Gt,Qe.id,Le).then(Yt=>ut._queryAttachment(Yt.objectId)),Pt=yield gt;return xt.splice(Ve,1,Pt),Pt})()}_queryAttachment(Le){var Qe=this;return(0,j.Z)(function*(){if(!Le)throw new pe.Z("invalid-attachment-id","Could not query attachment.");const{_attachmentLayer:ut}=Qe,Et=Qe._getFeatureId(),xt=new Me.Z({objectIds:[Et],attachmentsWhere:`AttachmentId=${Le}`,returnMetadata:!0});return ut.queryAttachments(xt).then(Gt=>Gt[Et][0])})()}_getFeatureId(){const{_attachmentLayer:Le,graphic:Qe}=this;if(!Le||!Qe)return null;const{objectIdField:ut}=Le,{attributes:Et}=Qe;return Et&&Et[ut]}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))}_setAttachmentLayer(){const{graphic:Le}=this,Qe=ve(Le);this._attachmentLayer=Qe?"scene"===Qe.type&&(0,ne.pC)(Qe.associatedLayer)?Qe.associatedLayer:Qe:null}};(0,x._)([(0,H.Cb)()],Ar.prototype,"abilities",void 0),(0,x._)([(0,de.p)("abilities")],Ar.prototype,"castAbilities",null),(0,x._)([(0,H.Cb)()],Ar.prototype,"activeAttachmentInfo",void 0),(0,x._)([(0,H.Cb)({readOnly:!0,type:Ni})],Ar.prototype,"attachmentInfos",void 0),(0,x._)([(0,H.Cb)({type:ge.Z})],Ar.prototype,"graphic",void 0),(0,x._)([(0,H.Cb)()],Ar.prototype,"mode",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Ar.prototype,"state",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ar.prototype,"supportsResizeAttachments",null),Ar=(0,x._)([(0,B.j)("esri.widgets.Attachments.AttachmentsViewModel")],Ar);const ni=Ar;var _i=T(54346),Gi=T(38570),es=T(25552),zr=T(94450);const gs={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},ln=window.CSS;let ds=class extends _e.Z{constructor(Le,Qe){super(Le,Qe),this.abilities=null,this.displayType="auto",this.graphic=null,this.label=void 0,this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=new ni,this.visibleElements=or({},gs),this._supportsImageOrientation=ln&&ln.supports&&ln.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}initialize(){this.own([(0,G.on)(()=>{var Le;return null==(Le=this.viewModel)?void 0:Le.attachmentInfos},"change",()=>this.scheduleRender()),(0,G.YP)(()=>{var Le;return null==(Le=this.viewModel)?void 0:Le.mode},()=>this._modeChanged(),G.nn)])}get effectiveDisplayType(){const{displayType:Le}=this;return Le&&"auto"!==Le?Le:this.viewModel.supportsResizeAttachments?"preview":"list"}castVisibleElements(Le){return or(or({},gs),Le)}addAttachment(){const{_addAttachmentForm:Le,viewModel:Qe}=this;return this._set("submitting",!0),this._set("error",null),Qe.addAttachment(Le).then(ut=>(this._set("submitting",!1),this._set("error",null),Qe.mode="view",ut)).catch(ut=>{throw this._set("submitting",!1),this._set("error",new pe.Z("attachments:add-attachment",this.messages.addErrorMessage,ut)),ut})}deleteAttachment(Le){const{viewModel:Qe}=this;return this._set("submitting",!0),this._set("error",null),Qe.deleteAttachment(Le).then(ut=>(this._set("submitting",!1),this._set("error",null),Qe.mode="view",ut)).catch(ut=>{throw this._set("submitting",!1),this._set("error",new pe.Z("attachments:delete-attachment",this.messages.deleteErrorMessage,ut)),ut})}updateAttachment(){const{viewModel:Le}=this,{_updateAttachmentForm:Qe}=this;return this._set("submitting",!0),this._set("error",null),Le.updateAttachment(Qe).then(ut=>(this._set("submitting",!1),this._set("error",null),Le.mode="view",ut)).catch(ut=>{throw this._set("submitting",!1),this._set("error",new pe.Z("attachments:update-attachment",this.messages.updateErrorMessage,ut)),ut})}render(){const{submitting:Le,viewModel:Qe}=this,{state:ut}=Qe;return(0,zr.u)("div",{class:this.classes("esri-attachments","esri-widget")},Le?this.renderProgressBar():null,"loading"===ut?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())}renderErrorMessage(){const{error:Le,visibleElements:Qe}=this;return Le&&Qe.errorMessage?(0,zr.u)("div",{key:"error-message",class:"esri-attachments__error-message"},Le.message):null}renderAttachments(){const{mode:Le,activeAttachmentInfo:Qe}=this.viewModel;return"add"===Le?this.renderAddForm():"edit"===Le?this.renderDetailsForm(Qe):this.renderAttachmentContainer()}renderLoading(){return(0,zr.u)("div",{class:"esri-attachments__loader-container",key:"loader"},(0,zr.u)("div",{class:"esri-attachments__loader"}))}renderProgressBar(){return this.visibleElements.progressBar?(0,zr.u)("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null}renderAddForm(){const{submitting:Le,selectedFile:Qe}=this,ut=Le||!Qe,Et=this.visibleElements.cancelAddButton?(0,zr.u)("button",{type:"button",bind:this,disabled:Le,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",Le&&"esri-button--disabled")},this.messages.cancel):null,xt=this.visibleElements.addSubmitButton?(0,zr.u)("button",{type:"submit",disabled:ut,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{"esri-button--disabled":ut})},this.messages.add):null,Gt=Qe?(0,zr.u)("span",{key:"file-name",class:"esri-attachments__file-name"},Qe.name):null,ar=(0,zr.u)("form",{bind:this,afterCreate:Gi.Yo,afterRemoved:Gi.pV,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,zr.u)("fieldset",{class:"esri-attachments__file-fieldset"},Gt,(0,zr.u)("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},Qe?this.messages.changeFile:this.messages.selectFile,(0,zr.u)("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),xt,Et);return(0,zr.u)("div",{key:"add-form-container",class:"esri-attachments__form-node"},ar)}renderDetailsForm(Le){const{visibleElements:Qe,viewModel:ut,selectedFile:Et,submitting:xt}=this,{contentType:Gt,size:ar,url:Ve}=Le,{abilities:gt}=ut,Pt=xt||!Et,Yt=gt.editing&&gt.operations.delete&&Qe.deleteButton?(0,zr.u)("button",{key:"delete-button",type:"button",disabled:xt,bind:this,onclick:el=>this._submitDeleteAttachment(el,Le),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{"esri-button--disabled":xt})},this.messages.delete):null,Jr=gt.editing&&gt.operations.update&&Qe.updateButton?(0,zr.u)("button",{disabled:Pt,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{"esri-button--disabled":Pt})},this.messages.update):null,Mi=this.visibleElements.cancelUpdateButton?(0,zr.u)("button",{disabled:xt,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{"esri-button--disabled":xt})},this.messages.cancel):null,Pi=Et?(0,zr.u)("span",{key:"file-name",class:"esri-attachments__file-name"},Et.name):null,Si=gt.editing&&gt.operations.update?(0,zr.u)("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},Pi,(0,zr.u)("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,(0,zr.u)("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null,xs=(0,zr.u)("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},(0,zr.u)("label",null,(0,he.sS)(this.messagesUnits,ar))),Kn=(0,zr.u)("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},(0,zr.u)("label",null,Gt)),Mn=(0,zr.u)("form",{bind:this,afterCreate:Gi.Yo,afterRemoved:Gi.pV,"data-node-ref":"_updateAttachmentForm",onsubmit:this._submitUpdateAttachment},(0,zr.u)("div",{class:"esri-attachments__metadata"},xs,Kn),Si,(0,zr.u)("div",{class:"esri-attachments__actions"},Yt,Mi,Jr));return(0,zr.u)("div",{key:"edit-form-container",class:"esri-attachments__form-node"},(0,zr.u)("a",{class:"esri-attachments__item-link",href:Ve,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:Le,size:400}),(0,zr.u)("div",{class:"esri-attachments__item-link-overlay"},(0,zr.u)("span",{class:"esri-attachments__item-link-overlay-icon"},(0,zr.u)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},(0,zr.u)("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),(0,zr.u)("path",{fill:"none",d:"M0 0h32v32H0z"}))))),Mn)}renderImageMask({attachmentInfo:Le,size:Qe}){const{supportsResizeAttachments:ut}=this.viewModel,{contentType:Et,name:xt,url:Gt}=Le,ar=ut&&function Ii(Le){const Qe=Le.toLowerCase();return"image/bmp"===Qe||"image/emf"===Qe||"image/exif"===Qe||"image/gif"===Qe||"image/x-icon"===Qe||"image/jpeg"===Qe||"image/png"===Qe||"image/tiff"===Qe||"image/x-wmf"===Qe}(Et),Ve=this._getCSSTransform(Le,ar),gt=Ve?{transform:Ve,"image-orientation":"none"}:{},Pt=Gt.includes("?")?"&":"?",Yt=ar?`${Gt}${Pt}w=${Qe}`:function ji(Le){const Qe=(0,_i.V)("esri/themes/base/images/files/");return Le?"text/plain"===Le?`${Qe}text-32.svg`:"application/pdf"===Le?`${Qe}pdf-32.svg`:"text/csv"===Le?`${Qe}csv-32.svg`:"application/gpx+xml"===Le?`${Qe}gpx-32.svg`:"application/x-dwf"===Le?`${Qe}cad-32.svg`:"application/postscript"===Le||"application/json"===Le||"text/xml"===Le||"model/vrml"===Le?`${Qe}code-32.svg`:"application/x-zip-compressed"===Le||"application/x-7z-compressed"===Le||"application/x-gzip"===Le||"application/x-tar"===Le||"application/x-gtar"===Le||"application/x-bzip2"===Le||"application/gzip"===Le||"application/x-compress"===Le||"application/x-apple-diskimage"===Le||"application/x-rar-compressed"===Le||"application/zip"===Le?`${Qe}zip-32.svg`:Le.includes("image/")?`${Qe}image-32.svg`:Le.includes("audio/")?`${Qe}sound-32.svg`:Le.includes("video/")?`${Qe}video-32.svg`:Le.includes("msexcel")||Le.includes("ms-excel")||Le.includes("spreadsheetml")?`${Qe}excel-32.svg`:Le.includes("msword")||Le.includes("ms-word")||Le.includes("wordprocessingml")?`${Qe}word-32.svg`:Le.includes("powerpoint")||Le.includes("presentationml")?`${Qe}report-32.svg`:`${Qe}generic-32.svg`:`${Qe}generic-32.svg`}(Et),Mi={"esri-attachments__image--resizable":ut};return(0,zr.u)("div",{class:this.classes({"esri-attachments__item-mask--icon":!ar},"esri-attachments__item-mask")},(0,zr.u)("img",{styles:gt,alt:xt,src:Yt,class:this.classes(Mi,"esri-attachments__image")}))}renderAttachmentInfo({attachmentInfo:Le,displayType:Qe}){const{viewModel:ut}=this,{abilities:Et}=ut,{name:xt,url:Gt}=Le,ar=this.renderImageMask({attachmentInfo:Le,size:"list"===Qe?48:400}),Ve=Et.editing?(0,zr.u)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",(0,Gi.dZ)(this.container)?"esri-icon-left":"esri-icon-right")}):null,gt=[ar,(0,zr.u)("label",{class:"esri-attachments__label"},(0,zr.u)("span",{class:"esri-attachments__filename"},xt||this.messages.noTitle),Ve)],Pt=Et.editing?(0,zr.u)("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":Le.id,onclick:()=>this._startEditAttachment(Le),type:"button"},gt):(0,zr.u)("a",{key:"details-link",class:"esri-attachments__item-button",href:Gt,target:"_blank"},gt);return(0,zr.u)("li",{class:"esri-attachments__item",key:Le},Pt)}renderAttachmentContainer(){const{effectiveDisplayType:Le,viewModel:Qe,visibleElements:ut}=this,{attachmentInfos:Et,abilities:xt}=Qe,Gt=Et&&Et.length,ar={"esri-attachments__container--list":"preview"!==Le,"esri-attachments__container--preview":"preview"===Le},Ve=xt.editing&&xt.operations.add&&ut.addButton?(0,zr.u)("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},(0,zr.u)("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null,gt=Gt?(0,zr.u)("ul",{class:"esri-attachments__items"},Et.toArray().map(Pt=>this.renderAttachmentInfo({attachmentInfo:Pt,displayType:Le}))):(0,zr.u)("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return(0,zr.u)("div",{key:"attachments-container",class:this.classes("esri-attachments__container",ar)},gt,Ve)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(Le){const Qe=Le.target,ut=Qe&&Qe.files&&Qe.files.item(0);this._set("selectedFile",ut)}_submitDeleteAttachment(Le,Qe){Le.preventDefault(),this.deleteAttachment(Qe)}_submitAddAttachment(Le){Le.preventDefault(),this.addAttachment()}_submitUpdateAttachment(Le){Le.preventDefault(),this.updateAttachment()}_startEditAttachment(Le){const{viewModel:Qe}=this;Qe.activeAttachmentInfo=Le,Qe.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(Le){Le.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(Le,Qe){const{orientationInfo:ut}=Le;return!this._supportsImageOrientation&&Qe&&ut?[ut.rotation?`rotate(${ut.rotation}deg)`:"",ut.mirrored?"scaleX(-1)":""].join(" "):""}};(0,x._)([(0,ae.B)("viewModel.abilities")],ds.prototype,"abilities",void 0),(0,x._)([(0,H.Cb)()],ds.prototype,"displayType",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],ds.prototype,"effectiveDisplayType",null),(0,x._)([(0,ae.B)("viewModel.graphic")],ds.prototype,"graphic",void 0),(0,x._)([(0,H.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ds.prototype,"label",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/widgets/Attachments/t9n/Attachments")],ds.prototype,"messages",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/core/t9n/Units")],ds.prototype,"messagesUnits",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],ds.prototype,"selectedFile",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],ds.prototype,"submitting",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],ds.prototype,"error",void 0),(0,x._)([(0,H.Cb)({type:ni})],ds.prototype,"viewModel",void 0),(0,x._)([(0,H.Cb)()],ds.prototype,"visibleElements",void 0),(0,x._)([(0,de.p)("visibleElements")],ds.prototype,"castVisibleElements",null),ds=(0,x._)([(0,B.j)("esri.widgets.Attachments")],ds);const Mt=ds;let Hr=class extends ni{constructor(Le){super(Le),this.description=null,this.title=null}};(0,x._)([(0,H.Cb)()],Hr.prototype,"description",void 0),(0,x._)([(0,H.Cb)()],Hr.prototype,"title",void 0),Hr=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],Hr);const Ir=Hr;var gi=T(13065);let is=class extends _e.Z{constructor(Le,Qe){super(Le,Qe),this.description=null,this.headingLevel=2,this.title=null}render(){return(0,zr.u)("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())}renderTitle(){const{title:Le}=this;return Le?(0,zr.u)(gi.X6,{level:this.headingLevel,class:"esri-feature-element-info__title"},Le):null}renderDescription(){const{description:Le}=this;return Le?(0,zr.u)("div",{key:"description",class:"esri-feature-element-info__description"},Le):null}};(0,x._)([(0,H.Cb)()],is.prototype,"description",void 0),(0,x._)([(0,H.Cb)()],is.prototype,"headingLevel",void 0),(0,x._)([(0,H.Cb)()],is.prototype,"title",void 0),is=(0,x._)([(0,B.j)("esri.widgets.Feature.support.FeatureElementInfo")],is);const ss=is;let ys=class extends _e.Z{constructor(Le,Qe){super(Le,Qe),this._featureElementInfo=null,this.attachmentsWidget=new Mt,this.description=null,this.displayType=null,this.graphic=null,this.headingLevel=2,this.title=null,this.viewModel=new Ir}initialize(){this._featureElementInfo=new ss,this.own([(0,G.YP)(()=>{var Le,Qe;return[null==(Le=this.viewModel)?void 0:Le.description,null==(Qe=this.viewModel)?void 0:Qe.title,this.headingLevel]},()=>this._setupFeatureElementInfo(),G.nn),(0,G.YP)(()=>{var Le;return null==(Le=this.viewModel)?void 0:Le.graphic},Le=>this.attachmentsWidget.graphic=Le,G.nn)])}destroy(){this.attachmentsWidget.destroy(),this._featureElementInfo.destroy()}render(){var Qe;const{attachmentsWidget:Le}=this;return(0,zr.u)("div",{class:"esri-feature-attachments"},null==(Qe=this._featureElementInfo)?void 0:Qe.render(),null==Le?void 0:Le.render())}_setupFeatureElementInfo(){const{description:Le,title:Qe,headingLevel:ut}=this;this._featureElementInfo.set({description:Le,title:Qe,headingLevel:ut})}};(0,x._)([(0,H.Cb)({readOnly:!0})],ys.prototype,"attachmentsWidget",void 0),(0,x._)([(0,ae.B)("viewModel.description")],ys.prototype,"description",void 0),(0,x._)([(0,ae.B)("attachmentsWidget.displayType")],ys.prototype,"displayType",void 0),(0,x._)([(0,ae.B)("viewModel.graphic")],ys.prototype,"graphic",void 0),(0,x._)([(0,H.Cb)()],ys.prototype,"headingLevel",void 0),(0,x._)([(0,ae.B)("viewModel.title")],ys.prototype,"title",void 0),(0,x._)([(0,H.Cb)({type:Ir})],ys.prototype,"viewModel",void 0),ys=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureAttachments")],ys);const ps=ys;var Ds=T(80542);let Ps=class extends((0,Ds.p)(Z.Z)){constructor(Le){super(Le),this._loadingPromise=null,this.created=null,this.creator=null,this.destroyer=null,this.graphic=null,this.handles.add((0,G.YP)(()=>this.creator,Qe=>{this._destroyContent(),this._createContent(Qe)},G.nn))}destroy(){this._destroyContent()}get state(){return this._loadingPromise?"loading":"ready"}_destroyContent(){const{created:Le,graphic:Qe,destroyer:ut}=this;Le&&(Ke(ut,{graphic:Qe}).catch(()=>null),this._set("created",null))}_createContent(Le){var Qe=this;return(0,j.Z)(function*(){const{graphic:ut}=Qe,Et=Ke(Le,{graphic:ut}).catch(()=>null);Qe._loadingPromise=Et,Qe.notifyChange("state");const xt=yield Et;Et===Qe._loadingPromise&&(Qe._loadingPromise=null,Qe.notifyChange("state"),Qe._set("created",xt))})()}};(0,x._)([(0,H.Cb)({readOnly:!0})],Ps.prototype,"created",void 0),(0,x._)([(0,H.Cb)()],Ps.prototype,"creator",void 0),(0,x._)([(0,H.Cb)()],Ps.prototype,"destroyer",void 0),(0,x._)([(0,H.Cb)({type:ge.Z})],Ps.prototype,"graphic",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Ps.prototype,"state",null),Ps=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],Ps);const ms=Ps;var Un=T(25469);let Sr=class extends _e.Z{constructor(Le,Qe){super(Le,Qe),this.creator=null,this.graphic=null,this.viewModel=null,this._addTargetToAnchors=ut=>{Array.from(ut.querySelectorAll("a")).forEach(Et=>{be(Et.href)&&!Et.hasAttribute("target")&&Et.setAttribute("target","_blank")})}}renderLoading(){return(0,zr.u)("div",{class:"esri-feature-content__loader-container",key:"loader"},(0,zr.u)("div",{class:"esri-feature-content__loader"}))}renderCreated(){var Qe;const Le=null==(Qe=this.viewModel)?void 0:Qe.created;return Le?Le instanceof HTMLElement?(0,zr.u)("div",{key:Le,bind:Le,afterCreate:this._attachToNode}):(0,Un.Qd)(Le)?(0,zr.u)("div",{key:Le},!Le.destroyed&&Le.render()):(0,zr.u)("div",{key:Le,innerHTML:Le,afterCreate:this._addTargetToAnchors}):null}render(){var Qe;const Le=null==(Qe=this.viewModel)?void 0:Qe.state;return(0,zr.u)("div",{class:"esri-feature-content"},"loading"===Le?this.renderLoading():this.renderCreated())}_attachToNode(Le){Le.appendChild(this)}};(0,x._)([(0,ae.B)("viewModel.creator")],Sr.prototype,"creator",void 0),(0,x._)([(0,ae.B)("viewModel.graphic")],Sr.prototype,"graphic",void 0),(0,x._)([(0,H.Cb)({type:ms})],Sr.prototype,"viewModel",void 0),Sr=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureContent")],Sr);const mr=Sr;var Wr=T(38439),Di=T(25621);let Wi=class extends Z.Z{constructor(Le){super(Le),this.attributes=null,this.expressionInfos=null,this.description=null,this.fieldInfos=null,this.title=null}get formattedFieldInfos(){const{expressionInfos:Le,fieldInfos:Qe}=this,ut=[];return null==Qe||Qe.forEach(Et=>{if(Et.hasOwnProperty("visible")&&!Et.visible)return;const xt=Et.clone();xt.label=ze(xt,Le),ut.push(xt)}),ut}};(0,x._)([(0,H.Cb)()],Wi.prototype,"attributes",void 0),(0,x._)([(0,H.Cb)({type:[Wr.Z]})],Wi.prototype,"expressionInfos",void 0),(0,x._)([(0,H.Cb)()],Wi.prototype,"description",void 0),(0,x._)([(0,H.Cb)({type:[Di.Z]})],Wi.prototype,"fieldInfos",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Wi.prototype,"formattedFieldInfos",null),(0,x._)([(0,H.Cb)()],Wi.prototype,"title",void 0),Wi=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],Wi);const ns=Wi,Yi=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];let Zs=class extends _e.Z{constructor(Le,Qe){super(Le,Qe),this._featureElementInfo=null,this.attributes=null,this.description=null,this.expressionInfos=null,this.fieldInfos=null,this.title=null,this.viewModel=new ns,this.messages=null,this.messagesURIUtils=null}initialize(){this._featureElementInfo=new ss,this.own((0,G.YP)(()=>{var Le,Qe;return[null==(Le=this.viewModel)?void 0:Le.description,null==(Qe=this.viewModel)?void 0:Qe.title]},()=>this._setupFeatureElementInfo(),G.nn))}destroy(){this._featureElementInfo.destroy()}renderFieldInfo(Le,Qe){const{attributes:ut}=this.viewModel,Et=Le.fieldName,xt=Le.label||Et,Gt=ut?null==ut[Et]?"":ut[Et]:"",ar=!(!Le.format||!Le.format.dateFormat),Ve="number"!=typeof Gt||ar?function Ks(Le,Qe){if("string"!=typeof Qe||!Qe)return Qe;const ut=function hs(Le){let Qe=null;return Yi.some(ut=>(ut.pattern.test(Le)&&(Qe=ut),!!Qe)),Qe}(Qe);if(!ut)return Qe;const Et=Qe.match(ut.pattern),Gt=(0,Ee.gx)((0,Ee.gx)(ut.label,{messages:Le,hierPart:Et&&Et[2]}),{appName:ut.appName});return Qe.replace(ut.pattern,`<a${ut.target?` target="${ut.target}"`:""} href="$1"${"_blank"===ut.target?' rel="noreferrer"':""}>${Gt}</a>`)}(this.messagesURIUtils,Gt):this._forceLTR(Gt),gt={"esri-feature-fields__field-data--date":ar};return(0,zr.u)("tr",{key:`fields-element-info-row-${Et}-${Qe}`},(0,zr.u)("th",{key:`fields-element-info-row-header-${Et}-${Qe}`,class:"esri-feature-fields__field-header",innerHTML:xt}),(0,zr.u)("td",{key:`fields-element-info-row-data-${Et}-${Qe}`,class:this.classes("esri-feature-fields__field-data",gt),innerHTML:Ve}))}renderFields(){const{formattedFieldInfos:Le}=this.viewModel;return(null==Le?void 0:Le.length)?(0,zr.u)("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},(0,zr.u)("tbody",null,Le.map((Qe,ut)=>this.renderFieldInfo(Qe,ut)))):null}render(){var Le;return(0,zr.u)("div",{class:"esri-feature-fields"},null==(Le=this._featureElementInfo)?void 0:Le.render(),this.renderFields())}_setupFeatureElementInfo(){const{description:Le,title:Qe}=this;this._featureElementInfo.set({description:Le,title:Qe})}_forceLTR(Le){return`&lrm;${Le}`}};(0,x._)([(0,ae.B)("viewModel.attributes")],Zs.prototype,"attributes",void 0),(0,x._)([(0,ae.B)("viewModel.description")],Zs.prototype,"description",void 0),(0,x._)([(0,ae.B)("viewModel.expressionInfos")],Zs.prototype,"expressionInfos",void 0),(0,x._)([(0,ae.B)("viewModel.fieldInfos")],Zs.prototype,"fieldInfos",void 0),(0,x._)([(0,ae.B)("viewModel.title")],Zs.prototype,"title",void 0),(0,x._)([(0,H.Cb)({type:ns})],Zs.prototype,"viewModel",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/widgets/Feature/t9n/Feature")],Zs.prototype,"messages",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/widgets/support/t9n/uriUtils")],Zs.prototype,"messagesURIUtils",void 0),Zs=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureFields")],Zs);const tn=Zs;var So=T(88159);const _a={maximumFractionDigits:20};T(8029);var ro=T(86606),xa=T(91558);T(20383),T(52068);const zo=(0,Te.Ze)("short-date");const Ht=new xa.Z([64,64,64]);function kt(Le,Qe){const ut=[],Et=Le.length-1;return 5===Le.length?ut.push(0,2,4):ut.push(0,Et),Le.map((xt,Gt)=>ut.includes(Gt)?function nn(Le,Qe,ut,Et){let xt="";0===Qe?xt="< ":Qe===ut&&(xt="> ");let Gt=null;return Gt=Et?(0,Te.p6)(Le,zo):function ia(Le){return(0,me.uf)(Le,_a)}(Le),xt+Gt}(xt,Gt,Et,Qe):null)}function ur(Le,Qe,ut){return Tr.apply(this,arguments)}function Tr(){return Tr=(0,j.Z)(function*(Le,Qe,ut){let Et=!1,xt=[],Gt=[];if(Le.stops){const Pt=Le.stops;xt=Pt.map(Yt=>Yt.value),Et=Pt.some(Yt=>!!Yt.label),Et&&(Gt=Pt.map(Yt=>Yt.label))}if(null==xt[0]&&null==xt[xt.length-1])return null;const gt=Et?null:kt(xt,ut);return(yield Promise.all(xt.map(function(){var Pt=(0,j.Z)(function*(Yt,Jr){return{value:Yt,color:"opacity"===Le.type?yield _r(Yt,Le,Qe):(yield Promise.resolve().then(T.bind(T,81808))).getColor(Le,Yt),label:Et?Gt[Jr]:gt[Jr]}});return function(Yt,Jr){return Pt.apply(this,arguments)}}()))).reverse()}),Tr.apply(this,arguments)}function _r(Le,Qe){return Gr.apply(this,arguments)}function Gr(){return(Gr=(0,j.Z)(function*(Le,Qe,ut=Ht){const Et=new xa.Z(ut),xt=(yield Promise.resolve().then(T.bind(T,81808))).getOpacity(Qe,Le);return null!=xt&&(Et.a=xt),Et})).apply(this,arguments)}var kr=T(52372);function ai(Le){if(!Le.colorStops)return[];const Qe=[...Le.colorStops].filter(Et=>{var xt;return(null==(xt=Et.color)?void 0:xt.a)>0});let ut=Qe.length-1;if(Qe&&Qe[0]){const Et=Qe[ut];Et&&1!==Et.ratio&&(Qe.push(new kr.Z({ratio:1,color:Et.color})),ut++)}return Qe.map((Et,xt)=>{var ar,Ve;let Gt="";return 0===xt?Gt=(null==(ar=Le.legendOptions)?void 0:ar.minLabel)||"low":xt===ut&&(Gt=(null==(Ve=Le.legendOptions)?void 0:Ve.maxLabel)||"high"),{color:Et.color,label:Gt,ratio:Et.ratio}}).reverse()}function hn(Le,Qe,ut){(0,So.s1)(Le,Qe,()=>[]).push(...ut)}function Sn(){return(Sn=(0,j.Z)(function*(Le){var ut,Et;const Qe=new Map;if("visualVariables"in Le&&Le.visualVariables){const xt=Le.visualVariables.filter(Gt=>"color"===Gt.type);for(const Gt of xt){const ar=Gt.field||Gt.valueExpression,Ve=(yield ur(Gt)).map(gt=>gt.color);hn(Qe,ar,Ve)}}if("heatmap"===Le.type){const xt=ai(Le).map(Gt=>Gt.color);hn(Qe,Le.field,xt)}else if("pie-chart"===Le.type){for(const xt of Le.attributes)hn(Qe,xt.field,[xt.color]);hn(Qe,null,[null==(ut=null==Le?void 0:Le.othersCategory)?void 0:ut.color,(0,ro._h)(Le.backgroundFillSymbol,null)])}else if("dot-density"===Le.type){for(const xt of Le.attributes)hn(Qe,xt.field,[xt.color]);hn(Qe,null,[Le.backgroundColor])}else if("unique-value"===Le.type)if("predominance"===(null==(Et=Le.authoringInfo)?void 0:Et.type))for(const xt of Le.uniqueValueInfos)hn(Qe,xt.value.toString(),[(0,ro._h)(xt.symbol,null)]);else{const xt=Le.uniqueValueInfos.map(Pt=>(0,ro._h)(Pt.symbol,null)),{field:Gt,field2:ar,field3:Ve,valueExpression:gt}=Le;(Gt||gt)&&hn(Qe,Gt||gt,xt),ar&&hn(Qe,ar,xt),Ve&&hn(Qe,Ve,xt)}else if("class-breaks"===Le.type){const xt=Le.classBreakInfos.map(Gt=>(0,ro._h)(Gt.symbol,null));hn(Qe,Le.field||Le.valueExpression,xt)}else"simple"===Le.type&&hn(Qe,null,[(0,ro._h)(Le.symbol,null)]);return"defaultSymbol"in Le&&Le.defaultSymbol&&hn(Qe,null,[(0,ro._h)(Le.defaultSymbol,null)]),Qe.forEach((xt,Gt)=>{const ar=(0,re.Tw)(xt.filter(Boolean),(Ve,gt)=>JSON.stringify(Ve)===JSON.stringify(gt));Qe.set(Gt,ar)}),Qe})).apply(this,arguments)}$.Z.getLogger("esri.renderers.support.utils"),(0,Te.Ze)("short-date");var Ai=T(77891),Ze=T(84792),lo=T(10699),Pn=(T(15283),T(2865)),pn=(T(21726),T(16730),T(37053),T(82054),T(2004),T(21674),T(72854),T(49672)),Cl=(T(37118),T(55214),T(13924),T(24192),T(17253),T(84952)),vc=(T(24263),T(29132),T(67010)),Wu=(T(6871),T(60776));const tc=$.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),lu=new Map;function ha(Le){if(!Ot(Le))return null;const[Qe,ut]=Le.split("/").slice(1);return{layerId:Qe,fieldName:ut}}function Wd({originRelationship:Le,relationships:Qe,layerId:ut}){let Et;return Qe&&Qe.some(xt=>(`${xt.relatedTableId}`===ut&&xt.id===Le.id&&(Et=xt),!!Et)),Et}function Sa(Le,Qe){const ut=Qe.toLowerCase();for(const Et in Le)if(Et.toLowerCase()===ut)return Le[Et];return null}function sa(Le,Qe,ut,Et){const xt=new vc.Z;return xt.outFields=["*"],xt.relationshipId="number"==typeof Qe.id?Qe.id:parseInt(Qe.id,10),xt.objectIds=[Le.attributes[ut.objectIdField]],ut.queryRelatedFeatures(xt,Et)}function lt(Le,Qe,ut){let Et=0;const xt=[];for(;Et<Qe.length;)xt.push(`${Le} IN (${Qe.slice(Et,ut+Et)})`),Et+=ut;return xt.join(" OR ")}function Vd(){return(Vd=(0,j.Z)(function*(Le,Qe,ut,Et){const xt=ut.layerId.toString(),{layerInfo:Gt,relation:ar,relatedFields:Ve,outStatistics:gt,url:Pt,sourceSpatialReference:Yt}=Qe,Jr=Wd({originRelationship:ar,relationships:Gt.relationships,layerId:xt});if(Jr.relationshipTableId&&Jr.keyFieldInRelationshipTable){const Pi=(yield sa(Le,Jr,ut,Et))[Le.attributes[ut.objectIdField]];if(!Pi)return null;const Si=Pi.features.map(xs=>xs.attributes[Gt.objectIdField]);if((null==gt?void 0:gt.length)>0&&Gt.supportsStatistics){const xs=new Cl.Z;xs.where=lt(Gt.objectIdField,Si,1e3),xs.outFields=Ve,xs.outStatistics=gt,xs.sourceSpatialReference=Yt;const Kn={features:Promise.resolve(Pi),statsFeatures:(0,Pn.e)(Pt,xs)};return(0,lo.as)(Kn)}}const Mi=null==Jr?void 0:Jr.keyField;if(Mi){const Pi=(0,Ce.H7)(bh(Gt.fields,Mi)),Si=Sa(Le.attributes,ar.keyField),xs=Pi?`${Mi}=${Si}`:`${Mi}='${Si}'`,Kn=(0,Pn.e)(Pt,new Cl.Z({where:xs,outFields:Qe.relatedFields,sourceSpatialReference:Yt}),Et),Mn=Qe.outStatistics&&Qe.outStatistics.length>0&&Gt.supportsStatistics?(0,Pn.e)(Pt,new Cl.Z({where:xs,outFields:Qe.relatedFields,outStatistics:Qe.outStatistics,sourceSpatialReference:Yt}),Et):null,el={features:Kn};return Mn&&(el.statsFeatures=Mn),(0,lo.as)(el)}return null})).apply(this,arguments)}function bh(Le,Qe){if(null!=Le){Qe=Qe.toLowerCase();for(const ut of Le)if(ut&&ut.name.toLowerCase()===Qe)return ut}return null}const Ch={chartAnimation:!0};let Qo=class extends Z.Z{constructor(Le){super(Le),this.abilities=or({},Ch),this.activeMediaInfoIndex=0,this.attributes=null,this.description=null,this.fieldInfoMap=null,this.formattedAttributes=null,this.expressionAttributes=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null}castAbilities(Le){return or(or({},Ch),Le)}get activeMediaInfo(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}get formattedMediaInfos(){return this._formatMediaInfos()||[]}get formattedMediaInfoCount(){return this.formattedMediaInfos.length}setActiveMedia(Le){this._setContentElementMedia(Le)}next(){this._pageContentElementMedia(1)}previous(){this._pageContentElementMedia(-1)}_setContentElementMedia(Le){const{formattedMediaInfoCount:Qe}=this;this.activeMediaInfoIndex=(Le+Qe)%Qe}_pageContentElementMedia(Le){const{activeMediaInfoIndex:Qe}=this;this._setContentElementMedia(Qe+Le)}_formatMediaInfos(){const{attributes:Le,mediaInfos:Qe,formattedAttributes:ut,expressionAttributes:Et,fieldInfoMap:xt,layer:Gt}=this;return null==Qe?void 0:Qe.map(ar=>{const Ve=null==ar?void 0:ar.clone();if(!Ve)return null;if(Ve.title=zt({attributes:Le,fieldInfoMap:xt,globalAttributes:ut,expressionAttributes:Et,layer:Gt,text:Ve.title}),Ve.caption=zt({attributes:Le,fieldInfoMap:xt,globalAttributes:ut,expressionAttributes:Et,layer:Gt,text:Ve.caption}),Ve.altText=zt({attributes:Le,fieldInfoMap:xt,globalAttributes:ut,expressionAttributes:Et,layer:Gt,text:Ve.altText}),"image"===Ve.type){const{value:gt}=Ve;return this._setImageValue({value:gt,formattedAttributes:ut,layer:Gt}),Ve.value.sourceURL?Ve:void 0}if("pie-chart"===Ve.type||"line-chart"===Ve.type||"column-chart"===Ve.type||"bar-chart"===Ve.type){const{value:gt}=Ve;return this._setChartValue({value:gt,chartType:Ve.type,attributes:Le,formattedAttributes:ut,layer:Gt}),Ve}return null}).filter(Boolean)}_setImageValue(Le){const{fieldInfoMap:Qe}=this,{value:ut,formattedAttributes:Et,layer:xt}=Le,{linkURL:Gt,sourceURL:ar}=ut;if(ar){const Ve=Xt(ar,xt);ut.sourceURL=Rt({formattedAttributes:Et,template:Ve,fieldInfoMap:Qe})}if(Gt){const Ve=Xt(Gt,xt);ut.linkURL=Rt({formattedAttributes:Et,template:Ve,fieldInfoMap:Qe})}}_setChartValue(Le){const{value:Qe,attributes:ut,formattedAttributes:Et,chartType:xt,layer:Gt}=Le,{popupTemplate:ar,relatedInfos:Ve}=this,{fields:gt,normalizeField:Pt}=Qe;if(Qe.fields=function at(Le,Qe){return Le&&Le.map(ut=>ot(ut,Qe))}(gt,Gt),Pt&&(Qe.normalizeField=ot(Pt,Gt)),!gt.some(Jr=>!!(null!=Et[Jr]||Ot(Jr)&&Ve.size)))return;const Yt=null==ar?void 0:ar.fieldInfos;gt.forEach(Jr=>{if(Ot(Jr))return void(Qe.series=[...Qe.series,...this._getRelatedChartInfos({fieldInfos:Yt,fieldName:Jr,formattedAttributes:Et,chartType:xt,value:Qe})]);const Mi=this._getChartOption({value:Qe,attributes:ut,chartType:xt,formattedAttributes:Et,fieldName:Jr,fieldInfos:Yt});Qe.series.push(Mi)})}_getRelatedChartInfos(Le){var Si;const{fieldInfos:Qe,fieldName:ut,formattedAttributes:Et,chartType:xt,value:Gt}=Le,ar=[],Ve=ha(ut),{layerId:gt,fieldName:Pt}=Ve,Yt=null==(Si=this.relatedInfos)?void 0:Si.get(gt.toString());if(!Yt)return ar;const{relatedFeatures:Jr,relation:Mi}=Yt;if(!Mi||!Jr)return ar;const{cardinality:Pi}=Mi;return Jr.forEach(xs=>{const{attributes:Kn}=xs;Kn&&Object.keys(Kn).forEach(Mn=>{Mn===Pt&&ar.push(this._getChartOption({value:Gt,attributes:Kn,formattedAttributes:Et,fieldName:ut,chartType:xt,relatedFieldName:Mn,fieldInfos:Qe}))})}),"one-to-many"===Pi||"many-to-many"===Pi?ar:[ar[0]]}_getTooltip({label:Le,value:Qe,chartType:ut}){return"pie-chart"===ut?`${Le}`:`${Le}: ${Qe}`}_getChartOption(Le){var Kl,vu,Tc,Zu,vp,wh;const{value:Qe,attributes:ut,formattedAttributes:Et,fieldName:xt,relatedFieldName:Gt,fieldInfos:ar,chartType:Ve}=Le,{layer:gt,fieldInfoMap:Pt}=this,{normalizeField:Yt,tooltipField:Jr}=Qe,Mi=Yt?Ot(Yt)?ut[ha(Yt).fieldName]:ut[Yt]:null,Pi=Gt&&void 0!==ut[Gt]?ut[Gt]:void 0!==ut[xt]?ut[xt]:Et[xt],Si=new Ai.Z({fieldName:xt,value:void 0===Pi?null:Pi&&Mi?Pi/Mi:Pi});if(Ot(xt)){const Eu=Pt.get(xt.toLowerCase()),Ep=Pt.get(Jr.toLowerCase()),bp=null!=(Kl=null==Eu?void 0:Eu.fieldName)?Kl:xt,gf=null!=(vp=null!=(Zu=null!=(Tc=Et[null!=(vu=null==Ep?void 0:Ep.fieldName)?vu:Jr])?Tc:null==Eu?void 0:Eu.label)?Zu:null==Eu?void 0:Eu.fieldName)?vp:Gt;return Si.tooltip=this._getTooltip({label:gf,value:Et[bp],chartType:Ve}),Si}const xs=qt(ar,xt),Kn=ot(xt,gt),Mn=Jr&&void 0!==Et[Jr]?Et[Jr]:ze(xs||new Di.Z({fieldName:Kn}),null==(wh=this.popupTemplate)?void 0:wh.expressionInfos);return Si.tooltip=this._getTooltip({label:Mn,value:Et[Kn],chartType:Ve}),Si}};(0,x._)([(0,H.Cb)()],Qo.prototype,"abilities",void 0),(0,x._)([(0,de.p)("abilities")],Qo.prototype,"castAbilities",null),(0,x._)([(0,H.Cb)()],Qo.prototype,"activeMediaInfoIndex",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qo.prototype,"activeMediaInfo",null),(0,x._)([(0,H.Cb)()],Qo.prototype,"attributes",void 0),(0,x._)([(0,H.Cb)()],Qo.prototype,"description",void 0),(0,x._)([(0,H.Cb)()],Qo.prototype,"fieldInfoMap",void 0),(0,x._)([(0,H.Cb)()],Qo.prototype,"formattedAttributes",void 0),(0,x._)([(0,H.Cb)()],Qo.prototype,"expressionAttributes",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qo.prototype,"formattedMediaInfos",null),(0,x._)([(0,H.Cb)()],Qo.prototype,"layer",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qo.prototype,"formattedMediaInfoCount",null),(0,x._)([(0,H.Cb)()],Qo.prototype,"mediaInfos",void 0),(0,x._)([(0,H.Cb)()],Qo.prototype,"popupTemplate",void 0),(0,x._)([(0,H.Cb)()],Qo.prototype,"relatedInfos",void 0),(0,x._)([(0,H.Cb)()],Qo.prototype,"title",void 0),Qo=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],Qo);const jc=Qo;var Th=["#ffffff","#858585","#ffbebe","#ffebbe","#ffebaf","#ffffbe","#e9ffbe","#d3ffbe","#beffe8","#bee8ff","#bed2ff","#e8beff","#ffbee8","#ebebeb","#707070","#ff7f7f","#ffa77f","#ffd37f","#ffff73","#d1ff73","#a3ff73","#73ffdf","#73dfff","#73b2ff","#df73ff","#ff73df","#d6d6d6","#5c5c5c","#ff0000","#ff5500","#ffaa00","#ffff00","#aaff00","#55ff00","#00ffc5","#00c5ff","#0070ff","#c500ff","#ff00c5","#c2c2c2","#474747","#e60000","#e64c00","#e69800","#e6e600","#98e600","#4ce600","#00e6a9","#00a9e6","#005ce6","#a900e6","#e600a9","#adadad","#242424","#a80000","#a83800","#a87000","#a8a800","#70a800","#38a800","#00a884","#0084a8","#004da8","#8400a8","#a80084","#999999","#1a1a1a","#730000","#732600","#734c00","#737300","#4c7300","#267300","#00734c","#004c73","#002673","#4c0073","#73004"],Gd=[{name:"default",colors:[].concat(Th.slice(30,39),Th.slice(28,30).reverse())},{name:"cat-dark",colors:["#ed5151","#149ece","#a7c636","#9e559c","#fc921f","#ffde3e","#f789d8","#b7814a","#3caf99","#6b6bd6","#b54779","#7f7f7f"]},{name:"tropical-bliss",colors:["#fce138","#ff9399","#fcd27e","#f1983c","#a553b7","#b1a9d0","#6ecffc","#4c81cd","#fc6f84","#fc3e5a","#6af689","#48885c"]},{name:"desert-blooms",colors:["#102432","#144d59","#ffc730","#ed9310","#a64f1b","#661510","#d9351a","#b31515","#4a0932","#8c213f","#18382e","#2c6954"]},{name:"under-the-sea",colors:["#bf9727","#607100","#00734c","#704489","#01acca","#024e76","#f09100","#ea311f","#c6004b","#7570b3","#666666","#333333"]},{name:"vibrant-rainbow",colors:["#fffb00","#f5cb11","#9fd40c","#46e39c","#32b8a6","#7ff2fa","#ac08cc","#dd33ff","#eb7200","#e8a784","#bf2e2e","#6c7000"]},{name:"ocean-bay",colors:["#191921","#11495c","#78b1c2","#454f4b","#8f8f82","#9be0c0","#87b051","#f7ec88","#ebdcc1","#dbb658","#c43541","#75351e"]},{name:"prairie-summer",colors:["#332424","#751555","#d47013","#d68989","#211173","#82aad6","#7bfaeb","#6ec9a8","#6b6408","#eada40","#ccc54a","#1fc235"]},{name:"pastel-chalk",colors:["#fffd99","#f5e6a4","#c1d48c","#b8e3d0","#a0b8b5","#cbf7fa","#d791f2","#dfc1eb","#f2b983","#e8c4b2","#bf8e8e","#94995c"]},{name:"seq-yellow-orange-red-bright",colors:["#910000","#b1260b","#c0370f","#e05919","#ef6a1d","#ff7b22","#ffa143","#ffb454","#ffda74","#ffed85"]},{name:"seq-reds-bright",colors:["#57453b","#7b4238","#9f4036","#c23d33","#d7483c","#ec5244","#f3696c","#f9816c","#ffc4ae","#fff0dc"]},{name:"seq-purples-bright",colors:["#4e465c","#5a4a78","#695291","#775baa","#8663c3","#946bdc","#aa89e8","#c1a6f3","#d7c4ff","#e6e1ff"]},{name:"seq-blues-bright",colors:["#404d54","#435c6c","#48799d","#4b88b6","#4d96ce","#50a5e7","#74bbed","#98d0f3","#bce6f9","#e6faff"]},{name:"seq-greens-bright",colors:["#39544c","#386757","#368165","#359b73","#33b581","#4bc392","#64d2a2","#7ce0b3","#cbf6d9","#f4ffea"]},{name:"seq-browns-bright",colors:["#524834","#715b38","#8f6e3c","#ae8140","#cc9444","#eba748","#eeb664","#f0c47f","#f9e0b7","#fff8eb"]}],up=T(56683);const Fc=new Map([["ar",()=>T.e(3309).then(T.bind(T,93309)).then(Le=>Le.a)],["bg-bg",()=>T.e(2504).then(T.bind(T,82504)).then(Le=>Le.b)],["bs-ba",()=>T.e(88).then(T.bind(T,88)).then(Le=>Le.b)],["ca-es",()=>T.e(2371).then(T.bind(T,32371)).then(Le=>Le.c)],["cs-cz",()=>T.e(3690).then(T.bind(T,93690)).then(Le=>Le.c)],["da-dk",()=>T.e(2125).then(T.bind(T,42125)).then(Le=>Le.d)],["de-de",()=>T.e(7396).then(T.bind(T,7396)).then(Le=>Le.d)],["de-ch",()=>T.e(2479).then(T.bind(T,62479)).then(Le=>Le.d)],["el-gr",()=>T.e(9548).then(T.bind(T,39548)).then(Le=>Le.e)],["en-us",()=>T.e(700).then(T.bind(T,20700)).then(Le=>Le.e)],["en-ca",()=>T.e(7028).then(T.bind(T,37028)).then(Le=>Le.e)],["es-es",()=>T.e(4824).then(T.bind(T,54824)).then(Le=>Le.e)],["et-ee",()=>T.e(3914).then(T.bind(T,23914)).then(Le=>Le.e)],["fi-fi",()=>T.e(1299).then(T.bind(T,1299)).then(Le=>Le.f)],["fr-fr",()=>T.e(9856).then(T.bind(T,39856)).then(Le=>Le.f)],["he-il",()=>T.e(4609).then(T.bind(T,24609)).then(Le=>Le.h)],["hr-hr",()=>T.e(7731).then(T.bind(T,87731)).then(Le=>Le.h)],["hu-hu",()=>T.e(7127).then(T.bind(T,57127)).then(Le=>Le.h)],["id-id",()=>T.e(6560).then(T.bind(T,36560)).then(Le=>Le.i)],["it-it",()=>T.e(7708).then(T.bind(T,67708)).then(Le=>Le.i)],["ja-jp",()=>T.e(6651).then(T.bind(T,36651)).then(Le=>Le.j)],["ko-kr",()=>T.e(7016).then(T.bind(T,7016)).then(Le=>Le.k)],["lt-lt",()=>T.e(5010).then(T.bind(T,5010)).then(Le=>Le.l)],["lv-lv",()=>T.e(2620).then(T.bind(T,92620)).then(Le=>Le.l)],["nb-no",()=>T.e(5237).then(T.bind(T,55237)).then(Le=>Le.n)],["nl-nl",()=>T.e(948).then(T.bind(T,948)).then(Le=>Le.n)],["pl-pl",()=>T.e(8351).then(T.bind(T,58351)).then(Le=>Le.p)],["pt-br",()=>T.e(6681).then(T.bind(T,86681)).then(Le=>Le.p)],["pt-pt",()=>T.e(8110).then(T.bind(T,48110)).then(Le=>Le.p)],["ro-ro",()=>T.e(8372).then(T.bind(T,78372)).then(Le=>Le.r)],["ru-ru",()=>T.e(8073).then(T.bind(T,88073)).then(Le=>Le.r)],["sk-sk",()=>T.e(7419).then(T.bind(T,7419)).then(Le=>Le.s)],["sl-sl",()=>T.e(1218).then(T.bind(T,11218)).then(Le=>Le.s)],["sr-rs",()=>T.e(5302).then(T.bind(T,85302)).then(Le=>Le.s)],["sv-se",()=>T.e(6079).then(T.bind(T,86079)).then(Le=>Le.s)],["th-th",()=>T.e(5508).then(T.bind(T,55508)).then(Le=>Le.t)],["tr-tr",()=>T.e(6844).then(T.bind(T,56844)).then(Le=>Le.t)],["uk-ua",()=>T.e(4978).then(T.bind(T,4978)).then(Le=>Le.u)],["vi-vn",()=>T.e(9202).then(T.bind(T,29202)).then(Le=>Le.v)],["zh-cn",()=>T.e(865).then(T.bind(T,70865)).then(Le=>Le.z)],["zh-hk",()=>T.e(3207).then(T.bind(T,3207)).then(Le=>Le.z)],["zh-tw",()=>T.e(3207).then(T.bind(T,3207)).then(Le=>Le.z)]]);function fd(Le){return Le?Fc.has(Le.toLowerCase())?Le.toLowerCase():function pd(Le){const Qe=Le.split("-")[0].toLowerCase();let ut=null;for(const Et of Fc.keys())if(Et.startsWith(Qe)){ut=Et;break}return ut}(Le)||"en-us":"en-us"}let rc,ic;function _d(){return(_d=(0,j.Z)(function*(Le=(0,up.Kd)()){if(Le=fd(Le),rc&&Le===ic)return rc;rc=T.e(4430).then(T.bind(T,4430)).then(Qe=>Qe.i),ic=Le;try{const[Qe,ut]=yield Promise.all([rc,Fc.get(ic)()]);ic===Le&&(Qe.am4core.options.defaultLocale=ut.default),Qe.am4core.options.suppressWarnings=!0,Qe.am4core.options.autoDispose=!0}catch(Qe){return rc=null,ic=null,null}return rc})).apply(this,arguments)}var Vu=T(64183);const Ao_mediaIcon="esri-feature-media__icon",ul="color",pa="tooltip",sc="value",gd="default-line-value";let ho=class extends _e.Z{constructor(Le,Qe){var ut;super(Le,Qe),ut=this,this._refreshTimer=null,this._refreshIntervalInfo=null,this._featureElementInfo=null,this.attributes=null,this.activeMediaInfoIndex=null,this.description=null,this.fieldInfoMap=null,this.layer=null,this.mediaInfos=null,this.popupTemplate=null,this.relatedInfos=null,this.title=null,this.viewModel=new jc,this.messages=null,this._getChartDependencies=function(){var Et=(0,j.Z)(function*(xt){const Gt=yield function Oh(){return _d.apply(this,arguments)}(),{destroyed:ar,viewModel:Ve}=ut;if(ar||!Ve||!xt)return;const{activeMediaInfo:gt}=Ve,Pt=yield ut._getRendererColors(Gt);ut._renderChart({chartDiv:xt,mediaInfo:gt,chartsModule:Gt,colorMap:Pt})});return function(xt){return Et.apply(this,arguments)}}()}initialize(){this._featureElementInfo=new ss,this.own([(0,G.YP)(()=>{var Le,Qe;return[null==(Le=this.viewModel)?void 0:Le.activeMediaInfo,null==(Qe=this.viewModel)?void 0:Qe.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),G.nn),(0,G.YP)(()=>{var Le,Qe;return[null==(Le=this.viewModel)?void 0:Le.description,null==(Qe=this.viewModel)?void 0:Qe.title]},()=>this._setupFeatureElementInfo(),G.nn)])}destroy(){this._clearMediaRefreshTimer(),this._featureElementInfo.destroy()}render(){var Le;return(0,zr.u)("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(Le=this._featureElementInfo)?void 0:Le.render(),this.renderMedia())}renderMedia(){const{formattedMediaInfoCount:Le}=this.viewModel;return Le?(0,zr.u)("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null}renderImageMediaInfo(Le){const{_refreshIntervalInfo:Qe}=this,{activeMediaInfoIndex:ut,formattedMediaInfoCount:Et}=this.viewModel,{value:xt,refreshInterval:Gt,altText:ar,title:Ve,type:gt}=Le,{sourceURL:Pt,linkURL:Yt}=xt,Jr=be(Yt)?"_blank":"_self",Mi="_blank"===Jr?"noreferrer":"",Pi=Gt?Qe:null,Kn=(0,zr.u)("img",{alt:ar||Ve,key:`media-${gt}-${ut}-${Et}-${Pi?Pi.timestamp:0}`,src:Pi?Pi.sourceURL:Pt});return(Yt?(0,zr.u)("a",{title:Ve,href:Yt,rel:Mi,target:Jr},Kn):null)||Kn}renderChartMediaInfo(Le){const{activeMediaInfoIndex:Qe,formattedMediaInfoCount:ut}=this.viewModel;return(0,zr.u)("div",{key:`media-${Le.type}-${Qe}-${ut}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})}renderMediaInfoType(){const{activeMediaInfo:Le}=this.viewModel;return Le?"image"===Le.type?this.renderImageMediaInfo(Le):Le.type.includes("chart")?this.renderChartMediaInfo(Le):null:null}renderMediaInfo(){const{activeMediaInfo:Le}=this.viewModel;if(!Le)return null;const Qe=Le.title?(0,zr.u)("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:Le.title}):null,ut=Le.caption?(0,zr.u)("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:Le.caption}):null;return(0,zr.u)("div",{key:"media-container",class:"esri-feature-media__item-container"},(0,zr.u)("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),Qe,ut)}renderMediaPageButton(Le){if(this.viewModel.formattedMediaInfoCount<2)return null;const Qe="previous"===Le,ut=Qe?this.messages.previous:this.messages.next,Et=this.classes("esri-feature-media__button",Qe?"esri-feature-media__previous":"esri-feature-media__next"),xt=Qe?this.classes(Ao_mediaIcon,"esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes(Ao_mediaIcon,"esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),Gt=Qe?this.classes(Ao_mediaIcon,"esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes(Ao_mediaIcon,"esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return(0,zr.u)("button",{type:"button",key:Qe?"media-previous":"media-next",title:ut,"aria-label":ut,tabIndex:0,class:Et,bind:this,onclick:Qe?this._previous:this._next},(0,zr.u)("span",{"aria-hidden":"true",class:xt}),(0,zr.u)("span",{"aria-hidden":"true",class:Gt}))}_setupFeatureElementInfo(){const{description:Le,title:Qe}=this;this._featureElementInfo.set({description:Le,title:Qe})}_next(){this.viewModel.next()}_previous(){this.viewModel.previous()}_getRendererColors(Le){var Qe=this;return(0,j.Z)(function*(){var ar;const{am4core:ut}=Le,Et=null==(ar=Qe.viewModel)?void 0:ar.layer,xt=new Map;if(!Et)return xt;const Gt=yield function no(Le){return Sn.apply(this,arguments)}(Et.renderer);return Gt.delete(null),Array.from(Gt.values()).every(Ve=>1===(null==Ve?void 0:Ve.length))&&(xt.set(gd,ut.color({r:50,g:50,b:50,a:1})),Array.from(Gt.keys()).forEach(Ve=>{Ve&&xt.set(Ve,ut.color(Gt.get(Ve)[0].toCss(!0)))})),xt})()}_handleMediaKeyup(Le){const Qe=(0,U.kK)(Le);"ArrowLeft"===Qe&&(Le.stopPropagation(),this.viewModel.previous()),"ArrowRight"===Qe&&(Le.stopPropagation(),this.viewModel.next())}_renderChart(Le){const{abilities:Qe}=this.viewModel,{chartsModule:ut,chartDiv:Et,mediaInfo:xt,colorMap:Gt}=Le,{value:ar,type:Ve}=xt,{am4core:gt}=ut,Pt=function md(Le,Qe="default"){const ut=Gd.find(Et=>Et.name===Qe);return ut?ut.colors.map(Et=>Le.color(Et)):null}(gt);(0,Vu.$o)()&&gt.useTheme(ut.am4themes_dark);const Jr=window.matchMedia("(prefers-reduced-motion: reduce)");Qe.chartAnimation&&!Jr.matches?gt.useTheme(ut.am4themes_animated):gt.unuseTheme(ut.am4themes_animated),gt.useTheme(function Yt(Pi){Pi instanceof gt.ColorSet&&Pt&&(Pi.list=Pt)});const Mi="pie-chart"===Ve?this._createPieChart(Le):this._createXYChart(Le);Et.setAttribute("aria-label",xt.altText||xt.title),Mi.data=ar.series.map(Pi=>({[pa]:Pi.tooltip,[sc]:Pi.value,[ul]:Gt.get(Pi.fieldName)})).filter(Pi=>"pie-chart"!==Ve||Pi.value>0)}_customizeChartTooltip(Le,Qe){Le.label.wrap=!0,Le.label.maxWidth=200,Le.autoTextColor=!1,Le.getFillFromObject=!1,Le.label.fill=Qe.color("#ffffff"),Le.background.fill=Qe.color({r:0,g:0,b:0,a:.7})}_createPieChart(Le){const{chartDiv:Qe,chartsModule:ut}=Le,{am4core:Et,am4charts:xt}=ut,Gt=Et.create(Qe,xt.PieChart);Gt.rtl=(0,Gi.dZ)(this.container);const ar=Gt.series.push(new xt.PieSeries);return ar.labels.template.disabled=!0,ar.ticks.template.disabled=!0,ar.dataFields.value=sc,ar.dataFields.category=pa,this._customizeChartTooltip(ar.tooltip,Et),ar.slices.template.tooltipText=Gt.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%",ar.slices.template.propertyFields.fill=ul,ar.slices.template.propertyFields.stroke=ul,Gt}_getMinSeriesValue(Le){let Qe=0;return Le.forEach(ut=>Qe=Math.min(ut.value,Qe)),Qe}_createColumnChart(Le,Qe){const{chartsModule:ut,mediaInfo:Et}=Qe,{value:xt}=Et,{am4core:Gt,am4charts:ar}=ut,Ve=Le.xAxes.push(new ar.CategoryAxis);Ve.dataFields.category=pa,Ve.renderer.labels.template.disabled=!0,this._customizeChartTooltip(Ve.tooltip,Gt),Ve.tooltip.events.on("sizechanged",()=>{Ve.tooltip.dy=-Ve.tooltip.contentHeight});const gt=Le.yAxes.push(new ar.ValueAxis),Pt=gt.renderer.labels.template;gt.renderer.minLabelPosition=.05,gt.renderer.maxLabelPosition=.95,gt.min=this._getMinSeriesValue(xt.series),this._customizeChartTooltip(gt.tooltip,Gt),Pt.wrap=!0;const Yt=Le.series.push(new ar.ColumnSeries);Yt.dataFields.valueY=sc,Yt.dataFields.categoryX=pa,Yt.columns.template.propertyFields.fill=ul,Yt.columns.template.propertyFields.stroke=ul,Le.cursor=new ar.XYCursor,xt.series.length>15&&(Le.scrollbarX=new Gt.Scrollbar)}_createBarChart(Le,Qe){const{chartsModule:ut,mediaInfo:Et}=Qe,{value:xt}=Et,{am4core:Gt,am4charts:ar}=ut,Ve=Le.yAxes.push(new ar.CategoryAxis);Ve.dataFields.category=pa,Ve.renderer.inversed=!0,Ve.renderer.labels.template.disabled=!0,this._customizeChartTooltip(Ve.tooltip,Gt),Ve.tooltip.events.on("sizechanged",()=>{Ve.tooltip.dx=Ve.tooltip.contentWidth});const gt=Le.xAxes.push(new ar.ValueAxis),Pt=gt.renderer.labels.template;gt.renderer.minLabelPosition=.05,gt.renderer.maxLabelPosition=.95,gt.min=this._getMinSeriesValue(xt.series),this._customizeChartTooltip(gt.tooltip,Gt),Pt.wrap=!0;const Yt=Le.series.push(new ar.ColumnSeries);Yt.dataFields.valueX=sc,Yt.dataFields.categoryY=pa,Yt.columns.template.propertyFields.fill=ul,Yt.columns.template.propertyFields.stroke=ul,Le.cursor=new ar.XYCursor,xt.series.length>15&&(Le.scrollbarY=new Gt.Scrollbar)}_createLineChart(Le,Qe){const{chartsModule:ut,mediaInfo:Et,colorMap:xt}=Qe,{value:Gt}=Et,{am4core:ar,am4charts:Ve}=ut,gt=Le.xAxes.push(new Ve.CategoryAxis);gt.dataFields.category=pa,gt.renderer.labels.template.disabled=!0,this._customizeChartTooltip(gt.tooltip,ar),gt.tooltip.events.on("sizechanged",()=>{gt.tooltip.dy=-gt.tooltip.contentHeight});const Pt=Le.yAxes.push(new Ve.ValueAxis),Yt=Pt.renderer.labels.template;Pt.renderer.minLabelPosition=.05,Pt.renderer.maxLabelPosition=.95,Pt.min=this._getMinSeriesValue(Gt.series),this._customizeChartTooltip(Pt.tooltip,ar),Yt.wrap=!0;const Jr=Le.series.push(new Ve.LineSeries);Jr.dataFields.categoryX=pa,Jr.dataFields.valueY=sc,Jr.strokeWidth=1;const Mi=xt.get(gd);Mi&&(Jr.stroke=Mi);const Pi=Jr.bullets.push(new Ve.CircleBullet);Pi.propertyFields.fill=ul,Pi.propertyFields.stroke=ul,Le.cursor=new Ve.XYCursor,Gt.series.length>15&&(Le.scrollbarX=new ar.Scrollbar)}_createXYChart(Le){const{chartDiv:Qe,chartsModule:ut,mediaInfo:Et}=Le,{type:xt}=Et,{am4core:Gt,am4charts:ar}=ut,Ve=Gt.create(Qe,ar.XYChart);return Ve.rtl=(0,Gi.dZ)(this.container),"column-chart"===xt&&this._createColumnChart(Ve,Le),"bar-chart"===xt&&this._createBarChart(Ve,Le),"line-chart"===xt&&this._createLineChart(Ve,Le),Ve}_clearMediaRefreshTimer(){const{_refreshTimer:Le}=this;Le&&(clearTimeout(Le),this._refreshTimer=null)}_updateMediaInfoTimestamp(Le){const Qe=Date.now();this._refreshIntervalInfo={timestamp:Qe,sourceURL:this._getImageSource(Le,Qe)},this.scheduleRender()}_setupMediaRefreshTimer(){this._clearMediaRefreshTimer();const{activeMediaInfo:Le}=this.viewModel;Le&&"image"===Le.type&&Le.refreshInterval&&this._setRefreshTimeout(Le)}_setRefreshTimeout(Le){const{refreshInterval:Qe,value:ut}=Le;if(!Qe)return;const Et=6e4*Qe;this._updateMediaInfoTimestamp(ut.sourceURL);const xt=setInterval(()=>{this._updateMediaInfoTimestamp(ut.sourceURL)},Et);this._refreshTimer=xt}_getImageSource(Le,Qe){const ut=Le.includes("?")?"&":"?",[Et,xt=""]=Le.split("#");return`${Et}${ut}timestamp=${Qe}${xt?"#":""}${xt}`}};(0,x._)([(0,ae.B)("viewModel.attributes")],ho.prototype,"attributes",void 0),(0,x._)([(0,ae.B)("viewModel.activeMediaInfoIndex")],ho.prototype,"activeMediaInfoIndex",void 0),(0,x._)([(0,ae.B)("viewModel.description")],ho.prototype,"description",void 0),(0,x._)([(0,ae.B)("viewModel.fieldInfoMap")],ho.prototype,"fieldInfoMap",void 0),(0,x._)([(0,ae.B)("viewModel.layer")],ho.prototype,"layer",void 0),(0,x._)([(0,ae.B)("viewModel.mediaInfos")],ho.prototype,"mediaInfos",void 0),(0,x._)([(0,ae.B)("viewModel.popupTemplate")],ho.prototype,"popupTemplate",void 0),(0,x._)([(0,ae.B)("viewModel.relatedInfos")],ho.prototype,"relatedInfos",void 0),(0,x._)([(0,ae.B)("viewModel.title")],ho.prototype,"title",void 0),(0,x._)([(0,H.Cb)({type:jc})],ho.prototype,"viewModel",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/widgets/Feature/t9n/Feature")],ho.prototype,"messages",void 0),ho=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureMedia")],ho);const nc=ho;var Hd=T(47562),Qa=(T(55664),T(55013),T(16615),T(82561),T(75484)),qo=T(64531),uu=T(501),Dn=T(38159),Wl=T(32258);const du=["$datastore","$map","$layer","$aggregatedfeatures"],Bo=$.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function Ra(Le){return"string"==typeof Le?Br(Ur(Le)):Array.isArray(Le)?function zc(Le){return`<ul class="esri-widget__list">${Le.map(Qe=>`<li>${"string"==typeof Qe?Br(Ur(Qe)):Qe}</li>`).join("")}</ul>`}(Le):"esri.arcade.Dictionary"===(null==Le?void 0:Le.declaredClass)?function mt(Le){return`<table class="esri-widget__table">${Le.keys().map(Qe=>{const ut=Le.field(Qe);return`<tr><th>${Qe}</th><td>${"string"==typeof ut?Br(Ur(ut)):ut}</td></tr>`}).join("")}</table>`}(Le):Le}function Ut({aggregatedFeatures:Le,arcadeUtils:Qe,featureSetVars:ut,context:Et,viewInfo:xt,map:Gt,graphic:ar,interceptor:Ve}){ut.forEach(gt=>{const Pt=gt.toLowerCase();if("$map"===Pt&&(Et.vars[Pt]=Qe.convertMapToFeatureSetCollection({map:Gt,spatialReference:xt.sr,interceptor:Ve})),"$layer"===Pt&&(Et.vars[Pt]=Qe.convertFeatureLayerToFeatureSet({layer:ar.sourceLayer,spatialReference:xt.sr,interceptor:Ve})),"$datastore"===Pt&&(Et.vars[Pt]=Qe.convertServiceUrlToWorkspace({url:ar.sourceLayer.url,spatialReference:xt.sr,interceptor:Ve})),"$aggregatedfeatures"===Pt){const Jr=ar.layer,{fields:Mi,objectIdField:Pi,geometryType:Si,spatialReference:xs,displayField:Kn}=Jr,Mn=new Wl.default(yi(or({fields:Mi,objectIdField:Pi,geometryType:Si,spatialReference:xs,displayField:Kn},"feature"===Jr.type?{templates:Jr.templates,typeIdField:Jr.typeIdField,types:Jr.types}:null),{source:Le}));Et.vars[Pt]=Qe.convertFeatureLayerToFeatureSet({layer:Mn,spatialReference:xt.sr,interceptor:Ve})}})}function Tt(){return T.e(5068).then(T.bind(T,75068))}function ft(Le){return pt.apply(this,arguments)}function pt(){return(pt=(0,j.Z)(function*({graphic:Le,view:Qe}){const{isAggregate:ut,layer:Et}=Le;if(!ut||!Et||"2d"!==(null==Qe?void 0:Qe.type))return[];const xt=yield Qe.whenLayerView(Et);if(!xt.createQuery||!xt.queryFeatures)return[];const Gt=xt.createQuery();Gt.aggregateIds=[Le.getObjectId()];const{features:ar}=yield xt.queryFeatures(Gt);return ar})).apply(this,arguments)}function rt(Le){return dr.apply(this,arguments)}function dr(){return(dr=(0,j.Z)(function*({expressionInfo:Le,arcadeUtils:Qe,interceptor:ut,spatialReference:Et,map:xt,graphic:Gt,view:ar}){if(!Le||!Le.expression)return null;const Ve=Qe.createSyntaxTree(Le.expression),gt=du.filter(Pi=>Qe.hasVariable(Ve,Pi)),[Pt]=yield Promise.all([ft({graphic:Gt,view:ar}),Qe.loadScriptDependencies(Ve,!0,gt)]),Yt=Qe.getViewInfo({spatialReference:Et}),Jr=Qe.createExecContext(Gt,Yt);Jr.interceptor=ut,Jr.useAsync=!0,Ut({aggregatedFeatures:Pt,arcadeUtils:Qe,featureSetVars:gt,context:Jr,viewInfo:Yt,map:xt,graphic:Gt,interceptor:ut});const Mi=Qe.createFunction(Ve,Jr);return Qe.executeAsyncFunction(Mi,Jr).catch(Pi=>Bo.error("arcade-execution-error",{error:Pi,graphic:Gt,expressionInfo:Le}))})).apply(this,arguments)}function wr(Le){return $t.apply(this,arguments)}function $t(){return($t=(0,j.Z)(function*({expressionInfos:Le,spatialReference:Qe,graphic:ut,interceptor:Et,map:xt,view:Gt}){if(!Le||!Le.length)return{};const ar=yield Tt(),Ve={};for(const Yt of Le)Ve[`expression/${Yt.name}`]=rt({expressionInfo:Yt,arcadeUtils:ar,interceptor:Et,spatialReference:Qe,map:xt,graphic:ut,view:Gt});const gt=yield(0,lo.as)(Ve),Pt={};for(const Yt in gt)Pt[Yt]=Ra(gt[Yt].value);return Pt})).apply(this,arguments)}let fi=class extends((0,Ds.p)(Z.Z)){constructor(Le){var Qe;super(Le),Qe=this,this._abortController=null,this.expressionInfo=null,this.graphic=null,this.contentElement=null,this.contentElementViewModel=null,this.interceptor=null,this.view=null,this._cancelQuery=()=>{const{_abortController:ut}=this;ut&&ut.abort(),this._abortController=null},this._createVM=()=>{var xt,Gt;const ut=null==(xt=this.contentElement)?void 0:xt.type;null==(Gt=this.contentElementViewModel)||Gt.destroy();const Et="fields"===ut?new ns:"media"===ut?new jc:"text"===ut?new ms:null;this._set("contentElementViewModel",Et)},this._compile=(0,j.Z)(function*(){Qe._cancelQuery();const ut=new AbortController;Qe._abortController=ut,yield Qe._compileExpression(),Qe._abortController===ut&&(Qe._abortController=null)}),this._compileThrottled=se(this._compile,1,this),this._compileExpression=(0,j.Z)(function*(){const{expressionInfo:ut,graphic:Et,interceptor:xt,spatialReference:Gt,map:ar,view:Ve,_abortController:gt}=Qe;if(!(ut&&Et&&Gt&&ar))return void Qe._set("contentElement",null);const Pt=yield Tt();if(gt!==Qe._abortController)return;const Yt=yield rt({arcadeUtils:Pt,expressionInfo:ut,graphic:Et,interceptor:xt,map:ar,spatialReference:Gt,view:Ve});if(!Yt||"esri.arcade.Dictionary"!==Yt.declaredClass)return void Qe._set("contentElement",null);const Jr=yield(0,Hd.d)(Yt,gt.signal),Mi=null==Jr?void 0:Jr.type,Pi="media"===Mi?qo.Z.fromJSON(Jr):"text"===Mi?uu.Z.fromJSON(Jr):"fields"===Mi?Qa.Z.fromJSON(Jr):null;Qe._set("contentElement",Pi)}),this.handles.add([(0,G.YP)(()=>[this.expressionInfo,this.graphic,this.map,this.spatialReference,this.view],()=>this._compileThrottled(),G.nn),(0,G.YP)(()=>[this.contentElement],()=>this._createVM(),G.nn)])}destroy(){var Le;this._cancelQuery(),null==(Le=this.contentElementViewModel)||Le.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}get spatialReference(){var Le;return(null==(Le=this.view)?void 0:Le.spatialReference)||null}set spatialReference(Le){void 0!==Le?this._override("spatialReference",Le):this._clearOverride("spatialReference")}get state(){const{_abortController:Le,contentElement:Qe,contentElementViewModel:ut}=this;return Le?"loading":Qe||ut?"ready":"disabled"}get map(){var Le;return(null==(Le=this.view)?void 0:Le.map)||null}set map(Le){void 0!==Le?this._override("map",Le):this._clearOverride("map")}};(0,x._)([(0,H.Cb)()],fi.prototype,"_abortController",void 0),(0,x._)([(0,H.Cb)({type:Dn.Z})],fi.prototype,"expressionInfo",void 0),(0,x._)([(0,H.Cb)({type:ge.Z})],fi.prototype,"graphic",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],fi.prototype,"contentElement",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],fi.prototype,"contentElementViewModel",void 0),(0,x._)([(0,H.Cb)()],fi.prototype,"interceptor",void 0),(0,x._)([(0,H.Cb)()],fi.prototype,"spatialReference",null),(0,x._)([(0,H.Cb)({readOnly:!0})],fi.prototype,"state",null),(0,x._)([(0,H.Cb)()],fi.prototype,"map",null),(0,x._)([(0,H.Cb)()],fi.prototype,"view",void 0),fi=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],fi);const ci=fi;let _s=class extends _e.Z{constructor(Le,Qe){super(Le,Qe),this.viewModel=new ci}initialize(){this.own((0,G.YP)(()=>{var Le;return null==(Le=this.viewModel)?void 0:Le.contentElementViewModel},()=>this._setupExpressionWidget(),G.nn))}destroy(){this._destroyContentWidget()}renderLoading(){return(0,zr.u)("div",{key:"loading-container",class:"esri-feature__loading-container"},(0,zr.u)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}render(){var Qe;const{state:Le}=this.viewModel;return(0,zr.u)("div",{class:"esri-feature-expression"},"loading"===Le?this.renderLoading():"disabled"===Le?null:null==(Qe=this._contentWidget)?void 0:Qe.render())}_destroyContentWidget(){const{_contentWidget:Le}=this;Le&&(Le.viewModel=null,Le.destroy()),this._contentWidget=null}_setupExpressionWidget(){const{contentElementViewModel:Le,contentElement:Qe}=this.viewModel,ut=null==Qe?void 0:Qe.type;this._destroyContentWidget();const Et=Le?"fields"===ut?new tn({viewModel:Le}):"media"===ut?new nc({viewModel:Le}):"text"===ut?new mr({viewModel:Le}):null:null;this._contentWidget=Et,this.scheduleRender()}};(0,x._)([(0,H.Cb)({type:ci})],_s.prototype,"viewModel",void 0),_s=(0,x._)([(0,B.j)("esri.widgets.Feature.FeatureExpression")],_s);const $s=_s;var Ws;const po="content-view-models",co="esri.widgets.FeatureViewModel",cn=$.Z.getLogger(co),ac={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};let oo=Ws=class extends Z.Z{constructor(Le){super(Le),this._handles=new ee.Z,this._error=null,this._featureAbortController=null,this.graphicChangedThrottled=se(this._graphicChanged,1,this),this._expressionAttributes=null,this._graphicExpressionAttributes=null,this.abilities=or({},ac),this.content=null,this.contentViewModels=[],this.defaultPopupTemplateEnabled=!1,this.formattedAttributes=null,this.lastEditInfo=null,this.relatedInfos=new Map,this.title="",this.view=null,this._isAllowedContentType=Qe=>{const{abilities:ut}=this;return"attachments"===Qe.type&&ut.attachmentsContent||"custom"===Qe.type&&ut.customContent||"fields"===Qe.type&&ut.fieldsContent||"media"===Qe.type&&ut.mediaContent||"text"===Qe.type&&ut.textContent||"expression"===Qe.type&&ut.expressionContent},this._handles.add((0,G.YP)(()=>[this.graphic,this._effectivePopupTemplate,this.abilities],()=>this.graphicChangedThrottled(),G.nn))}destroy(){this._clear(),this._cancelFeatureQuery(),this._error=null,this._handles.destroy(),this._handles=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}get _effectivePopupTemplate(){return(0,ne.pC)(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}get _fieldInfoMap(){return function ir(Le,Qe){const ut=new Map;return Le&&Le.forEach(Et=>{const xt=ot(Et.fieldName,Qe);Et.fieldName=xt,ut.set(xt.toLowerCase(),Et)}),ut}(fr(this._effectivePopupTemplate),this._sourceLayer)}get _sourceLayer(){return ve(this.graphic)}castAbilities(Le){return or(or({},ac),Le)}get state(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}set graphic(Le){this._set("graphic",Le?Le.clone():null)}get spatialReference(){return this.get("view.spatialReference")||null}set spatialReference(Le){void 0!==Le?this._override("spatialReference",Le):this._clearOverride("spatialReference")}get map(){return this.get("view.map")||null}set map(Le){void 0!==Le?this._override("map",Le):this._clearOverride("map")}get waitingForContent(){return!!this._featureAbortController}setActiveMedia(Le,Qe){const ut=this.contentViewModels[Le];ut instanceof jc&&ut.setActiveMedia(Qe)}nextMedia(Le){const Qe=this.contentViewModels[Le];Qe instanceof jc&&Qe.next()}previousMedia(Le){const Qe=this.contentViewModels[Le];Qe instanceof jc&&Qe.previous()}_clear(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}_graphicChanged(){var Le=this;return(0,j.Z)(function*(){Le._cancelFeatureQuery(),Le._error=null,Le._clear();const{graphic:Qe}=Le;if(!Qe)return;const ut=new AbortController;Le._featureAbortController=ut;try{yield Le._queryFeature({signal:ut.signal})}catch(Et){(0,lo.D_)(Et)||(Le._error=Et,cn.error("error","The popupTemplate could not be displayed for this feature.",{error:Et,graphic:Qe,popupTemplate:Le._effectivePopupTemplate}))}Le._featureAbortController===ut&&(Le._featureAbortController=null)})()}_cancelFeatureQuery(){const{_featureAbortController:Le}=this;Le&&Le.abort(),this._featureAbortController=null}_compileContentElement(Le,Qe){return"attachments"===Le.type?this._compileAttachments(Le,Qe):"custom"===Le.type?this._compileCustom(Le,Qe):"fields"===Le.type?this._compileFields(Le,Qe):"media"===Le.type?this._compileMedia(Le,Qe):"text"===Le.type?this._compileText(Le,Qe):"expression"===Le.type?this._compileExpression(Le,Qe):void 0}_compileContent(Le){if(this._destroyContentViewModels(),this.graphic)return Array.isArray(Le)?Le.filter(this._isAllowedContentType).map((Qe,ut)=>this._compileContentElement(Qe,ut)):"string"==typeof Le?this._compileText(new uu.Z({text:Le}),0).text:Le}_destroyContentViewModels(){var Le;null==(Le=this._handles)||Le.remove(po),this.contentViewModels.forEach(Qe=>Qe&&!Qe.destroyed&&Qe.destroy()),this._set("contentViewModels",[])}_setExpressionContentVM(Le,Qe){const{formattedAttributes:ut}=this,{contentElement:Et,contentElementViewModel:xt}=Le,Gt=null==Et?void 0:Et.type;xt&&Gt&&("fields"===Gt&&(this._createFieldsFormattedAttributes({contentElement:Et,contentElementIndex:Qe,formattedAttributes:ut}),xt.set(this._createFieldsVMParams(Et,Qe))),"media"===Gt&&(this._createMediaFormattedAttributes({contentElement:Et,contentElementIndex:Qe,formattedAttributes:ut}),xt.set(this._createMediaVMParams(Et,Qe))),"text"===Gt&&xt.set(this._createTextVMParams(Et)))}_compileExpression(Le,Qe){const{expressionInfo:ut}=Le,{graphic:Et,map:xt,spatialReference:Gt,view:ar}=this,Ve=new ci({expressionInfo:ut,graphic:Et,interceptor:Ws.interceptor,map:xt,spatialReference:Gt,view:ar});return this.contentViewModels[Qe]=Ve,this._handles.add((0,G.YP)(()=>Ve.contentElementViewModel,()=>this._setExpressionContentVM(Ve,Qe),G.nn),po),Le}_compileAttachments(Le,Qe){const{graphic:ut}=this,{description:Et,title:xt}=Le;return this.contentViewModels[Qe]=new Ir(or({graphic:ut},this._compileTitleAndDesc({title:xt,description:Et}))),Le}_compileCustom(Le,Qe){const{graphic:ut}=this,{creator:Et,destroyer:xt}=Le;return this.contentViewModels[Qe]=new ms({graphic:ut,creator:Et,destroyer:xt}),Le}_compileTitleAndDesc({title:Le,description:Qe}){const{_fieldInfoMap:ut,_sourceLayer:Et,graphic:xt,formattedAttributes:Gt,_expressionAttributes:ar}=this,{attributes:Ve}=xt,gt=Gt.global;return{title:zt({attributes:Ve,fieldInfoMap:ut,globalAttributes:gt,expressionAttributes:ar,layer:Et,text:Le}),description:zt({attributes:Ve,fieldInfoMap:ut,globalAttributes:gt,expressionAttributes:ar,layer:Et,text:Qe})}}_createFieldsVMParams(Le,Qe){var Pt;const{_effectivePopupTemplate:ut,formattedAttributes:Et}=this,xt=or(or({},Et.global),Et.content[Qe]),Gt=null==(Pt=(null==Le?void 0:Le.fieldInfos)||(null==ut?void 0:ut.fieldInfos))?void 0:Pt.filter(({fieldName:Yt})=>tt(Yt)||Ot(Yt)||xt.hasOwnProperty(Yt)),ar=null==ut?void 0:ut.expressionInfos,{description:Ve,title:gt}=Le;return or({attributes:xt,expressionInfos:ar,fieldInfos:Gt},this._compileTitleAndDesc({title:gt,description:Ve}))}_compileFields(Le,Qe){const ut=Le.clone(),Et=new ns(this._createFieldsVMParams(Le,Qe));return this.contentViewModels[Qe]=Et,ut.fieldInfos=Et.formattedFieldInfos.slice(0),ut}_createMediaVMParams(Le,Qe){const{abilities:ut,graphic:Et,_fieldInfoMap:xt,formattedAttributes:Gt,_effectivePopupTemplate:ar,relatedInfos:Ve,_sourceLayer:gt,_expressionAttributes:Pt}=this,{attributes:Yt}=Et,{description:Jr,mediaInfos:Mi,title:Pi}=Le;return or({abilities:{chartAnimation:ut.chartAnimation},activeMediaInfoIndex:Le.activeMediaInfoIndex||0,attributes:Yt,layer:gt,fieldInfoMap:xt,formattedAttributes:or(or({},Gt.global),Gt.content[Qe]),expressionAttributes:Pt,mediaInfos:Mi,popupTemplate:ar,relatedInfos:Ve},this._compileTitleAndDesc({title:Pi,description:Jr}))}_compileMedia(Le,Qe){const ut=Le.clone(),Et=new jc(this._createMediaVMParams(Le,Qe));return ut.mediaInfos=Et.formattedMediaInfos.slice(0),this.contentViewModels[Qe]=Et,ut}_createTextVMParams(Le){const{graphic:Qe,_fieldInfoMap:ut,_sourceLayer:Et,_expressionAttributes:xt}=this;if(Le&&Le.text){const{attributes:Gt}=Qe;Le.text=zt({attributes:Gt,fieldInfoMap:ut,globalAttributes:this.formattedAttributes.global,expressionAttributes:xt,layer:Et,text:Le.text})}return{graphic:Qe,creator:Le.text}}_compileText(Le,Qe){const ut=Le.clone();return this.contentViewModels[Qe]=new ms(this._createTextVMParams(ut)),ut}_compileLastEditInfo(){const{_effectivePopupTemplate:Le,_sourceLayer:Qe,graphic:ut}=this;if(!Le)return;const{lastEditInfoEnabled:Et}=Le,xt=null==Qe?void 0:Qe.editFieldsInfo;return Et&&xt?function tr(Le,Qe){const{creatorField:ut,creationDateField:Et,editorField:xt,editDateField:Gt}=Le;if(!Qe)return;const ar=Qe[Gt];if("number"==typeof ar){const gt=Qe[xt];return{type:"edit",date:(0,Te.p6)(ar,Fe),user:gt}}const Ve=Qe[Et];if("number"==typeof Ve){const gt=Qe[ut];return{type:"create",date:(0,Te.p6)(Ve,Fe),user:gt}}return null}(xt,ut.attributes):void 0}_compileTitle(Le){const{_fieldInfoMap:Qe,_sourceLayer:ut,graphic:Et,_expressionAttributes:xt}=this,{attributes:Gt}=Et;return zt({attributes:Gt,fieldInfoMap:Qe,globalAttributes:this.formattedAttributes.global,expressionAttributes:xt,layer:ut,text:Le})}_getTitle(){var Le=this;return(0,j.Z)(function*(){const{_effectivePopupTemplate:Qe,graphic:ut}=Le;return Ke(null==Qe?void 0:Qe.title,{graphic:ut})})()}_getContent(){var Le=this;return(0,j.Z)(function*(){const{_effectivePopupTemplate:Qe,graphic:ut}=Le;return Ke(null==Qe?void 0:Qe.content,{graphic:ut})})()}_queryFeature(Le){var Qe=this;return(0,j.Z)(function*(){const{_featureAbortController:ut,_sourceLayer:Et,graphic:xt,_effectivePopupTemplate:Gt,spatialReference:ar,map:Ve,view:gt}=Qe,{content:{value:Pt},title:{value:Yt}}=yield(0,lo.as)({content:Qe._getContent(),title:Qe._getTitle()});if(ut!==Qe._featureAbortController||!xt)return;yield function lr(Le,Qe){return jr.apply(this,arguments)}({graphic:xt,popupTemplate:Gt,layer:Et,spatialReference:ar},Le);const{expressionAttributes:{value:Jr}}=yield(0,lo.as)({checkForRelatedFeatures:Qe._checkForRelatedFeatures(Le),expressionAttributes:wr({expressionInfos:null==Gt?void 0:Gt.expressionInfos,spatialReference:ar,graphic:xt,map:Ve,interceptor:Ws.interceptor,view:gt})});ut===Qe._featureAbortController&&xt&&(Qe._expressionAttributes=Jr,Qe._graphicExpressionAttributes=or(or({},xt.attributes),Jr),Qe._set("formattedAttributes",Qe._createFormattedAttributes(Pt)),Qe._set("title",Qe._compileTitle(Yt)),Qe._set("lastEditInfo",Qe._compileLastEditInfo()||null),Qe._set("content",Qe._compileContent(Pt)||null))})()}_createMediaFormattedAttributes({contentElement:Le,contentElementIndex:Qe,formattedAttributes:ut}){const{_effectivePopupTemplate:Et,graphic:xt,relatedInfos:Gt,_sourceLayer:ar,_fieldInfoMap:Ve,_graphicExpressionAttributes:gt}=this;ut.content[Qe]=ri({fieldInfos:null==Et?void 0:Et.fieldInfos,graphic:xt,attributes:or(or({},gt),Le.attributes),layer:ar,fieldInfoMap:Ve,relatedInfos:Gt})}_createFieldsFormattedAttributes({contentElement:Le,contentElementIndex:Qe,formattedAttributes:ut}){if(Le.fieldInfos){const{graphic:Et,relatedInfos:xt,_sourceLayer:Gt,_fieldInfoMap:ar,_graphicExpressionAttributes:Ve}=this;ut.content[Qe]=ri({fieldInfos:Le.fieldInfos,graphic:Et,attributes:or(or({},Ve),Le.attributes),layer:Gt,fieldInfoMap:ar,relatedInfos:xt})}}_createFormattedAttributes(Le){const{_effectivePopupTemplate:Qe,graphic:ut,relatedInfos:Et,_sourceLayer:xt,_fieldInfoMap:Gt,_graphicExpressionAttributes:ar}=this,gt={global:ri({fieldInfos:null==Qe?void 0:Qe.fieldInfos,graphic:ut,attributes:ar,layer:xt,fieldInfoMap:Gt,relatedInfos:Et}),content:[]};return Array.isArray(Le)&&Le.forEach((Pt,Yt)=>{"fields"===Pt.type&&this._createFieldsFormattedAttributes({contentElement:Pt,contentElementIndex:Yt,formattedAttributes:gt}),"media"===Pt.type&&this._createMediaFormattedAttributes({contentElement:Pt,contentElementIndex:Yt,formattedAttributes:gt})}),gt}_checkForRelatedFeatures(Le){const{graphic:Qe,_effectivePopupTemplate:ut}=this;return this._queryRelatedInfos(Qe,fr(ut),Le)}_queryRelatedInfos(Le,Qe,ut){var Et=this;return(0,j.Z)(function*(){const{relatedInfos:xt,_sourceLayer:Gt}=Et;xt.clear();const ar=(0,ne.pC)(Gt.associatedLayer)?yield Gt.associatedLayer.load(ut):Gt;if(!ar)return;const Ve=Qe.filter(Yt=>Yt&&Ot(Yt.fieldName));if(!Ve||!Ve.length)return;Qe.forEach(Yt=>Et._configureRelatedInfo(Yt,ar));const gt=yield function ll({relatedInfos:Le,layer:Qe},ut){const Et={};return Le.forEach((xt,Gt)=>{const{relation:ar}=xt;if(!ar){const Jr=new pe.Z("relation-required","A relation is required on a layer to retrieve related records.");throw tc.error(Jr),Jr}const{relatedTableId:Ve}=ar;if("number"!=typeof Ve){const Jr=new pe.Z("A related table ID is required on a layer to retrieve related records.");throw tc.error(Jr),Jr}const gt=`${Qe.url}/${Ve}`,Pt=lu.get(gt),Yt=Pt||function Ha(Le,Qe){return(0,Ze.default)(Le,{query:{f:"json"},signal:Qe&&Qe.signal})}(gt,ut);Pt||lu.set(gt,Yt),Et[Gt]=Yt}),(0,lo.as)(Et)}({relatedInfos:xt,layer:ar},ut);Object.keys(gt).forEach(Yt=>{var Pi;const Jr=xt.get(Yt.toString()),Mi=null==(Pi=gt[Yt])?void 0:Pi.value;Jr&&Mi&&(Jr.layerInfo=Mi.data)});const Pt=yield function zd({graphic:Le,relatedInfos:Qe,layer:ut},Et){const xt={};return Qe.forEach((Gt,ar)=>{Gt.layerInfo&&(xt[ar]=function Ga(Le,Qe,ut,Et){return Vd.apply(this,arguments)}(Le,Gt,ut,Et))}),(0,lo.as)(xt)}({graphic:Le,relatedInfos:xt,layer:ar},ut);Object.keys(Pt).forEach(Yt=>{var Jr;!function Bc(Le,Qe){if(!Qe||!Le)return;const{features:ut,statsFeatures:Et}=Le,xt=ut&&ut.value;Qe.relatedFeatures=xt?xt.features:[];const Gt=Et&&Et.value;Qe.relatedStatsFeatures=Gt?Gt.features:[]}(null==(Jr=Pt[Yt])?void 0:Jr.value,xt.get(Yt.toString()))})})()}_configureRelatedInfo(Le,Qe){const{relatedInfos:ut}=this,Et=ha(Le.fieldName);if(!Et)return;const{layerId:xt,fieldName:Gt}=Et;if(!xt)return;const ar=ut.get(xt.toString())||function Bi(Le,Qe){const ut=function Xo(Le,Qe){if(!Qe.relationships)return null;let ut=null;const{relationships:Et}=Qe;return Et.some(xt=>xt.id===parseInt(Le,10)&&(ut=xt,!0)),ut}(Le,Qe);if(ut)return{url:`${Qe.url}/${ut.relatedTableId}`,sourceSpatialReference:Qe.spatialReference,relation:ut,relatedFields:[],outStatistics:[]}}(xt,Qe);ar&&(function Nc({relatedInfo:Le,fieldName:Qe,fieldInfo:ut}){if(Le.relatedFields.push(Qe),ut.statisticType){const Et=new Wu.Z({statisticType:ut.statisticType,onStatisticField:Qe,outStatisticFieldName:Qe});Le.outStatistics.push(Et)}}({relatedInfo:ar,fieldName:Gt,fieldInfo:Le}),this.relatedInfos.set(xt,ar))}};oo.interceptor=new class Ri{constructor(Qe,ut){this.preLayerQueryCallback=Qe,this.preRequestCallback=ut,this.preLayerQueryCallback||(this.preLayerQueryCallback=Et=>{}),this.preRequestCallback||(this.preLayerQueryCallback=Et=>{})}}(({query:Le,layer:Qe,method:ut})=>{ii({layer:Qe,method:ut,query:Le,definitionExpression:`${Qe.definitionExpression} ${Qe.serviceDefinitionExpression}`})},({queryPayload:Le,layer:Qe,method:ut})=>{ii({layer:Qe,method:ut,query:Le,definitionExpression:`${Qe.definitionExpression} ${Qe.serviceDefinitionExpression}`})}),(0,x._)([(0,H.Cb)()],oo.prototype,"_error",void 0),(0,x._)([(0,H.Cb)()],oo.prototype,"_featureAbortController",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"_effectivePopupTemplate",null),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"_fieldInfoMap",null),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"_sourceLayer",null),(0,x._)([(0,H.Cb)()],oo.prototype,"abilities",void 0),(0,x._)([(0,de.p)("abilities")],oo.prototype,"castAbilities",null),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"content",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"contentViewModels",void 0),(0,x._)([(0,H.Cb)({type:Boolean})],oo.prototype,"defaultPopupTemplateEnabled",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"state",null),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"formattedAttributes",void 0),(0,x._)([(0,H.Cb)({type:ge.Z,value:null})],oo.prototype,"graphic",null),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"lastEditInfo",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"relatedInfos",void 0),(0,x._)([(0,H.Cb)()],oo.prototype,"spatialReference",null),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"title",void 0),(0,x._)([(0,H.Cb)()],oo.prototype,"map",null),(0,x._)([(0,H.Cb)({readOnly:!0})],oo.prototype,"waitingForContent",null),(0,x._)([(0,H.Cb)()],oo.prototype,"view",void 0),oo=Ws=(0,x._)([(0,B.j)(co)],oo);const Zd=oo;T(82255);const lc=Le=>{let Qe=class extends Le{constructor(){super(...arguments),this.renderNodeContent=ut=>(0,Un.Qd)(ut)&&!ut.destroyed?(0,zr.u)("div",{key:ut},ut.render()):ut instanceof HTMLElement?(0,zr.u)("div",{key:ut,bind:ut,afterCreate:this._attachToNode}):(0,Un.o)(ut)?(0,zr.u)("div",{key:ut,bind:ut.domNode,afterCreate:this._attachToNode}):null}_attachToNode(ut){ut.appendChild(this)}};return Qe=(0,x._)([(0,B.j)("esri.widgets.Feature.ContentMixin")],Qe),Qe};var Vl=T(97059);const Ho_contentElement="esri-feature__content-element",$d={title:!0,content:!0,lastEditedInfo:!0};let ks=class extends(lc(_e.Z)){constructor(Le,Qe){super(Le,Qe),this._contentWidgets=[],this.graphic=null,this.defaultPopupTemplateEnabled=!1,this.headingLevel=2,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.spatialReference=null,this.title=null,this.visibleElements=or({},$d),this.map=null,this.view=null,this.viewModel=new Zd}initialize(){this.own((0,G.YP)(()=>{var Le;return null==(Le=this.viewModel)?void 0:Le.contentViewModels},()=>this._setupContentWidgets(),G.nn))}loadDependencies(){return Promise.all([T.e(8592),T.e(3056)]).then(T.bind(T,83056))}destroy(){this._destroyContentWidgets()}castVisibleElements(Le){return or(or({},$d),Le)}render(){const{state:Le}=this.viewModel,Qe=(0,zr.u)("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===Le?this.renderError():"loading"===Le?this.renderLoading():this.renderContentContainer());return(0,zr.u)("div",{class:this.classes("esri-feature","esri-widget")},Qe)}setActiveMedia(Le,Qe){this.viewModel.setActiveMedia(Le,Qe)}nextMedia(Le){this.viewModel.nextMedia(Le)}previousMedia(Le){this.viewModel.previousMedia(Le)}renderError(){const{messagesCommon:Le,messages:Qe,visibleElements:ut}=this;return(0,zr.u)("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},ut.title?(0,zr.u)("div",{key:"error-title",slot:"title"},Le.errorMessage):null,(0,zr.u)("div",{key:"error-message",slot:"message"},Qe.loadingError))}renderLoading(){return(0,zr.u)("div",{key:"loading-container",class:"esri-feature__loading-container"},(0,zr.u)("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))}renderContentContainer(){const{visibleElements:Le}=this;return Le.content?(0,zr.u)("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):null}renderTitle(){const{visibleElements:Le,title:Qe}=this;return Le.title?(0,zr.u)(gi.X6,{level:this.headingLevel,class:"esri-feature__title",innerHTML:Qe}):null}renderContent(){const Le=this.viewModel.content,Qe="content";if(!Le)return null;if(Array.isArray(Le))return Le.length?(0,zr.u)("div",{key:`${Qe}-content-elements`},Le.map(this.renderContentElement,this)):null;if("string"==typeof Le){const ut=this._contentWidgets[0];return!ut||ut.destroyed?null:(0,zr.u)("div",{key:`${Qe}-content`},ut.render())}return this.renderNodeContent(Le)}renderContentElement(Le,Qe){const{visibleElements:ut}=this;if("boolean"!=typeof ut.content&&!ut.content[Le.type])return null;switch(Le.type){case"attachments":return this.renderAttachments(Qe);case"custom":return this.renderCustom(Le,Qe);case"fields":return this.renderFields(Qe);case"media":return this.renderMedia(Qe);case"text":return this.renderText(Le,Qe);case"expression":return this.renderExpression(Qe);default:return null}}renderAttachments(Le){const Qe=this._contentWidgets[Le];if(!Qe||Qe.destroyed)return null;const{state:ut,attachmentInfos:Et}=Qe.viewModel;return"loading"===ut||Et.length>0?(0,zr.u)("div",{key:this._buildKey("attachments-element",Le),class:this.classes(Ho_contentElement)},Qe.render()):null}renderExpression(Le){const Qe=this._contentWidgets[Le];return!Qe||Qe.destroyed?null:(0,zr.u)("div",{key:this._buildKey("expression-element",Le),class:Ho_contentElement},Qe.render())}renderCustom(Le,Qe){const{creator:ut}=Le,Et=this._contentWidgets[Qe];return!Et||Et.destroyed?null:ut?(0,zr.u)("div",{key:this._buildKey("custom-element",Qe),class:Ho_contentElement},Et.render()):null}renderFields(Le){const Qe=this._contentWidgets[Le];return!Qe||Qe.destroyed?null:(0,zr.u)("div",{key:this._buildKey("fields-element",Le),class:Ho_contentElement},Qe.render())}renderMedia(Le){const Qe=this._contentWidgets[Le];return!Qe||Qe.destroyed?null:(0,zr.u)("div",{key:this._buildKey("media-element",Le),class:Ho_contentElement},Qe.render())}renderLastEditInfo(){const{visibleElements:Le,messages:Qe}=this,{lastEditInfo:ut}=this.viewModel;if(!ut||!Le.lastEditedInfo)return null;const{date:Et,user:xt}=ut,ar=(0,Vl.n)("edit"===ut.type?xt?Qe.lastEditedByUser:Qe.lastEdited:xt?Qe.lastCreatedByUser:Qe.lastCreated,{date:Et,user:xt});return(0,zr.u)("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info",Ho_contentElement)},ar)}renderText(Le,Qe){const Et=this._contentWidgets[Qe];return!Et||Et.destroyed?null:Le.text?(0,zr.u)("div",{key:this._buildKey("text-element",Qe),class:this.classes(Ho_contentElement,"esri-feature__text")},Et.render()):null}_buildKey(Le,...Qe){return`${Le}__${this.get("viewModel.graphic.uid")||"0"}-${Qe.join("-")}`}_destroyContentWidget(Le){Le&&(Le.viewModel=null,!Le.destroyed&&Le.destroy())}_destroyContentWidgets(){this._contentWidgets.forEach(Le=>this._destroyContentWidget(Le)),this._contentWidgets=[]}_setupContentWidgets(){this._destroyContentWidgets();const{headingLevel:Le,visibleElements:Qe}=this,ut=this.get("viewModel.content"),{contentViewModels:Et}=this.viewModel;if(Array.isArray(ut))ut.forEach((xt,Gt)=>{"attachments"===xt.type&&(this._contentWidgets[Gt]=new ps({displayType:xt.displayType,headingLevel:Qe.title?Le+1:Le,viewModel:Et[Gt]})),"fields"===xt.type&&(this._contentWidgets[Gt]=new tn({viewModel:Et[Gt]})),"media"===xt.type&&(this._contentWidgets[Gt]=new nc({viewModel:Et[Gt]})),"text"===xt.type&&(this._contentWidgets[Gt]=new mr({viewModel:Et[Gt]})),"custom"===xt.type&&(this._contentWidgets[Gt]=new mr({viewModel:Et[Gt]})),"expression"===xt.type&&(this._contentWidgets[Gt]=new $s({viewModel:Et[Gt]}))},this);else{const xt=Et[0];xt&&!xt.destroyed&&(this._contentWidgets[0]=new mr({viewModel:xt}))}this.scheduleRender()}};(0,x._)([(0,ae.B)("viewModel.graphic")],ks.prototype,"graphic",void 0),(0,x._)([(0,ae.B)("viewModel.defaultPopupTemplateEnabled")],ks.prototype,"defaultPopupTemplateEnabled",void 0),(0,x._)([(0,H.Cb)()],ks.prototype,"headingLevel",void 0),(0,x._)([(0,H.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],ks.prototype,"label",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/widgets/Feature/t9n/Feature")],ks.prototype,"messages",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/t9n/common")],ks.prototype,"messagesCommon",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/widgets/support/t9n/uriUtils")],ks.prototype,"messagesURIUtils",void 0),(0,x._)([(0,ae.B)("viewModel.spatialReference")],ks.prototype,"spatialReference",void 0),(0,x._)([(0,ae.B)("viewModel.title")],ks.prototype,"title",void 0),(0,x._)([(0,H.Cb)()],ks.prototype,"visibleElements",void 0),(0,x._)([(0,de.p)("visibleElements")],ks.prototype,"castVisibleElements",null),(0,x._)([(0,ae.B)("viewModel.map")],ks.prototype,"map",void 0),(0,x._)([(0,ae.B)("viewModel.view")],ks.prototype,"view",void 0),(0,x._)([(0,H.Cb)({type:Zd})],ks.prototype,"viewModel",void 0),ks=(0,x._)([(0,B.j)("esri.widgets.Feature")],ks);const kd=ks;var dl,hu=T(61885);const zl=Symbol("anchorHandles");let Gc=class extends hu.Z.EventedAccessor{constructor(Le){super(Le),this[dl]=new ee.Z,this.location=null,this.screenLocationEnabled=!1,this.view=null,this[zl].add([(0,G.gx)(()=>(0,ne.yw)(this.screenLocationEnabled?this.view:null,Qe=>[Qe.size,"3d"===Qe.type?Qe.camera:Qe.viewpoint]),()=>this.notifyChange("screenLocation")),(0,G.YP)(()=>this.screenLocation,(Qe,ut)=>{(0,ne.pC)(Qe)&&(0,ne.pC)(ut)&&this.emit("view-change")})])}destroy(){this.view=null,this[zl]=(0,ne.SC)(this[zl])}get screenLocation(){const{location:Le,view:Qe,screenLocationEnabled:ut}=this;return ut&&(0,ne.pC)(Le)&&(0,ne.pC)(Qe)&&Qe.ready?Qe.toScreen(Le):null}};dl=zl,(0,x._)([(0,H.Cb)()],Gc.prototype,"location",void 0),(0,x._)([(0,H.Cb)()],Gc.prototype,"screenLocation",null),(0,x._)([(0,H.Cb)()],Gc.prototype,"screenLocationEnabled",void 0),(0,x._)([(0,H.Cb)()],Gc.prototype,"view",void 0),Gc=(0,x._)([(0,B.j)("esri.widgets.support.AnchorElementViewModel")],Gc);const l0=Gc;let cc=class extends l0{constructor(Le){super(Le),this.visible=!1}};(0,x._)([(0,H.Cb)()],cc.prototype,"visible",void 0),cc=(0,x._)([(0,B.j)("esri.widgets.CompassViewModel")],cc);const pp=cc;let To=class extends _e.Z{constructor(Le,Qe){super(Le,Qe),this._animationDelay=500,this._animationPromise=null,this.location=null,this.view=null,this.viewModel=new pp,this.visible=!1}initialize(){this.own([(0,G.YP)(()=>this.visible,Le=>this._visibleChange(Le))])}destroy(){this._animationPromise=null}show(Le){const{location:Qe,promise:ut}=Le;Qe&&(this.viewModel.location=Qe),this.visible=!0,ut&&ut.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:Le}=this,{screenLocation:Qe}=this.viewModel,ut=!!Qe,Gt={"esri-spinner--start":Le&&ut,"esri-spinner--finish":!Le&&ut},ar=this._getPositionStyles();return(0,zr.u)("div",{class:this.classes("esri-spinner",Gt),styles:ar})}_visibleChange(Le){if(Le)return void(this.viewModel.screenLocationEnabled=!0);const Qe=(0,lo.e4)(this._animationDelay);this._animationPromise=Qe,Qe.catch(()=>{}).then(()=>{this._animationPromise===Qe&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:Le,view:Qe}=this.viewModel;if((0,ne.Wi)(Qe)||(0,ne.Wi)(Le))return{};const{padding:ut}=Qe;return{left:Le.x-ut.left+"px",top:Le.y-ut.top+"px"}}};(0,x._)([(0,ae.B)("viewModel.location")],To.prototype,"location",void 0),(0,x._)([(0,ae.B)("viewModel.view")],To.prototype,"view",void 0),(0,x._)([(0,H.Cb)({type:pp})],To.prototype,"viewModel",void 0),(0,x._)([(0,ae.B)("viewModel.visible")],To.prototype,"visible",void 0),To=(0,x._)([(0,B.j)("esri.widgets.Spinner")],To);const Xn=To;var qs=T(46367),Ph=T(44917),uc=T(59397),ya=T(48753),Yd=T(10671);function fu(Le){return Le&&"opacity"in Le?Le.opacity*fu(Le.parent):1}function na(){return(na=(0,j.Z)(function*(Le,Qe){var Kn;if(!Le)return;const ut=Le.sourceLayer,Et=null!=(Kn=(0,ne.pC)(Qe)&&Qe.useSourceLayer?ut:Le.layer)?Kn:ut,xt=fu(Et);if((0,ne.pC)(Le.symbol)&&(!(0,ne.pC)(Qe)||!0!==Qe.ignoreGraphicSymbol)){const Mn="web-style"===Le.symbol.type?yield Le.symbol.fetchSymbol(yi(or({},Qe),{cache:(0,ne.pC)(Qe)?Qe.webStyleCache:null})):Le.symbol.clone();return(0,ro.tb)(Mn,null,xt),Mn}const Gt=(0,ne.pC)(Qe)&&Qe.renderer||Et&&"renderer"in Et&&Et.renderer;let ar=Gt&&"getSymbolAsync"in Gt?yield Gt.getSymbolAsync(Le,Qe):null;if(!ar)return;if(ar="web-style"===ar.type?yield ar.fetchSymbol(yi(or({},Qe),{cache:(0,ne.pC)(Qe)?Qe.webStyleCache:null})):ar.clone(),!("visualVariables"in Gt)||!Gt.visualVariables||!Gt.visualVariables.length)return(0,ro.tb)(ar,null,xt),ar;if("arcadeRequiredForVisualVariables"in Gt&&Gt.arcadeRequiredForVisualVariables&&((0,ne.Wi)(Qe)||(0,ne.Wi)(Qe.arcade))){const Mn=or({},(0,ne.Wg)(Qe));Mn.arcade=yield(0,Ge.LC)(),Qe=Mn}const Ve=yield Promise.resolve().then(T.bind(T,81808)),gt=[],Pt=[],Yt=[],Jr=[];for(const Mn of Gt.visualVariables)switch(Mn.type){case"color":gt.push(Mn);break;case"opacity":Pt.push(Mn);break;case"rotation":Jr.push(Mn);break;case"size":Mn.target||Yt.push(Mn)}const Mi=!!gt.length&&gt[gt.length-1],Pi=Mi?Ve.getColor(Mi,Le,Qe):null,Si=!!Pt.length&&Pt[Pt.length-1];let xs=Si?Ve.getOpacity(Si,Le,Qe):null;if(null!=xt&&(xs=null!=xs?xs*xt:xt),(0,ro.tb)(ar,Pi,xs),Yt.length){const Mn=Ve.getAllSizes(Yt,Le,Qe);yield(0,ro.e3)(ar,Mn)}for(const Mn of Jr)(0,ro.BR)(ar,Ve.getRotationAngle(Mn,Le,Qe),Mn.axis);return ar})).apply(this,arguments)}T(74741),T(71131),T(6172);var fp=T(56846),Hu=T(93579);const Gl_iconZoom="esri-icon-zoom-in-magnifying-glass",Mo=new ya.Z({id:"zoom-to-feature",title:"{messages.zoom}",className:Gl_iconZoom}),_u=new ya.Z({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),dc=new ya.Z({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:Gl_iconZoom}),Da=new ya.Z({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"}),Ah=$.Z.getLogger("esri.widgets.Popup.PopupViewModel"),mf=Le=>{const{event:Qe,view:ut}=Le,{action:Et}=Qe,xt=ut&&ut.popup;if(!Et)return Promise.reject(new pe.Z("trigger-action:missing-arguments","Event has no action"));if(!xt)return Promise.reject(new pe.Z("trigger-action:missing-arguments","view.popup is missing"));const{disabled:Gt,id:ar}=Et;if(!ar)return Promise.reject(new pe.Z("trigger-action:invalid-action","action.id is missing"));if(Gt)return Promise.reject(new pe.Z("trigger-action:invalid-action","Action is disabled"));if(ar===Mo.id)return function Hc(Le){return Sh.apply(this,arguments)}(xt.viewModel).catch(lo.H9);if(ar===dc.id)return function Kc(Le){return qa.apply(this,arguments)}(xt.viewModel);if(ar===Da.id)return xt.featureMenuOpen=!xt.featureMenuOpen,xt.viewModel.browseClusterEnabled=!xt.viewModel.browseClusterEnabled,Promise.resolve();if(xt.viewModel.browseClusterEnabled=!1,ar===_u.id){xt.close();const{selectedFeature:Ve}=xt;if(!Ve)return Promise.reject(new pe.Z(`trigger-action:${_u.id}`,"selectedFeature is required",{selectedFeature:Ve}));const{sourceLayer:gt}=Ve;return gt?gt.remove(Ve):ut.graphics.remove(Ve),Promise.resolve()}return Promise.resolve()};function mu(Le){const{selectedFeature:Qe,location:ut,view:Et}=Le;return Et?"3d"===Et.type?Qe||ut:Le.get("selectedFeature.geometry")||ut:null}function Ml(Le){var Qe,ut;return(null==Le?void 0:Le.isAggregate)&&"cluster"===(null==(ut=null==(Qe=null==Le?void 0:Le.sourceLayer)?void 0:Qe.featureReduction)?void 0:ut.type)}function u0(Le,Qe){if("3d"!==(null==Qe?void 0:Qe.type)||!Le||"esri.Graphic"!==Le.declaredClass)return!0;const ut=Qe.getViewForGraphic(Le);if(ut&&"whenGraphicBounds"in ut){let Et=!1;return ut.whenGraphicBounds(Le,{useViewElevation:!0}).then(xt=>{Et=!xt||!xt.boundingBox||xt.boundingBox[0]===xt.boundingBox[3]&&xt.boundingBox[1]===xt.boundingBox[4]&&xt.boundingBox[2]===xt.boundingBox[5]}).catch(()=>{const xt=new pe.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:Le});Ah.error(xt)}),Et}return!0}function Sh(){return(Sh=(0,j.Z)(function*(Le){const{location:Qe,selectedFeature:ut,view:Et,zoomFactor:xt}=Le,Gt=mu(Le);if(!Gt){const Pt=new pe.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:Gt,view:Et});throw Ah.error(Pt),Pt}const ar=Et.scale/xt,Ve=Le.get("selectedFeature.geometry")||Qe,gt=Ve&&"point"===Ve.type&&u0(ut,Et);Mo.active=!0,Mo.disabled=!0;try{yield Le.view.goTo({target:Gt,scale:gt?ar:void 0})}finally{Mo.active=!1,Mo.disabled=!1,Le.zoomToLocation=null,gt&&(Le.location=Ve)}})).apply(this,arguments)}function qa(){return(qa=(0,j.Z)(function*(Le){const{selectedFeature:Qe,view:ut}=Le;if("2d"!==(null==ut?void 0:ut.type)){const Ve=new pe.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:ut});throw Ah.error(Ve),Ve}if(!Ml(Qe)){const Ve=new pe.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:Qe});throw Ah.error(Ve),Ve}const Et=Qe.sourceLayer,xt=yield ut.whenLayerView(Et),Gt=xt.createQuery();Gt.aggregateIds=[Qe.getObjectId()],dc.active=!0,dc.disabled=!0;const{extent:ar}=yield xt.queryExtent(Gt);yield ut.goTo({target:ar}),dc.active=!1,dc.disabled=!1})).apply(this,arguments)}function Xd(){return(Xd=(0,j.Z)(function*(Le){const{selectedFeature:Qe,view:ut}=Le,Et=Qe.sourceLayer,xt=yield ut.whenLayerView(Et),Gt=xt.createQuery();Gt.aggregateIds=[Qe.getObjectId()];const{extent:ar}=yield xt.queryExtent(Gt);Le.selectedClusterBoundaryFeature.geometry=ar,ut.graphics.add(Le.selectedClusterBoundaryFeature)})).apply(this,arguments)}function Us(){return(Us=(0,j.Z)(function*(Le){const{selectedFeature:Qe,view:ut}=Le,Et=Qe.sourceLayer,xt=yield ut.whenLayerView(Et),Gt=xt.createQuery();Gt.aggregateIds=[Qe.getObjectId()],Da.active=!0,Da.disabled=!0;const{features:ar}=yield xt.queryFeatures(Gt);Da.active=!1,Da.disabled=!1,ut.popup.open({features:[Qe].concat(ar),featureMenuOpen:!0})})).apply(this,arguments)}var mp=T(67436),qd=T(88493);const Ec=ie.Z.ofType({key:"type",defaultKeyValue:"button",base:uc.Z,typeMap:{button:ya.Z,toggle:Yd.Z}}),_n="esri.widgets.Popup.PopupViewModel",gu=$.Z.getLogger(_n);let on=class extends((0,mp._)(l0)){constructor(Le){super(Le),this._handles=new ee.Z,this._pendingPromises=new Set,this._fetchFeaturesController=null,this._selectedClusterFeature=null,this.featurePage=null,this.actions=new Ec,this.activeFeature=null,this.defaultPopupTemplateEnabled=!1,this.autoCloseEnabled=!1,this.autoOpenEnabled=!0,this.browseClusterEnabled=!1,this.content=null,this.featuresPerPage=20,this.featureViewModelAbilities=null,this.featureViewModels=[],this.highlightEnabled=!0,this.includeDefaultActions=!0,this.selectedClusterBoundaryFeature=new ge.Z({symbol:new qd.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),this.title=null,this.updateLocationEnabled=!1,this.view=null,this.visible=!1,this.zoomFactor=4,this.zoomToLocation=null}get isLoadingFeature(){return this.featureViewModels.some(Le=>Le.waitingForContent)}initialize(){this._handles.add([(0,G.YP)(()=>[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),(0,G.YP)(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),(0,G.YP)(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),(0,G.YP)(()=>{var Le,Qe;return null==(Qe=null==(Le=this.view)?void 0:Le.animation)?void 0:Qe.state},Le=>this._animationStateChange(Le)),(0,G.YP)(()=>this.location,Le=>this._locationChange(Le)),(0,G.YP)(()=>this.selectedFeature,Le=>this._selectedFeatureChange(Le)),(0,G.YP)(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),(0,G.YP)(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),(0,G.YP)(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",Le=>mf({event:Le,view:this.view})),(0,G.gx)(()=>!this.waitingForResult,()=>this._waitingForResultChange(),G.Z_),(0,G.YP)(()=>{var Le,Qe;return[this.features,null==(Le=this.view)?void 0:Le.map,null==(Qe=this.view)?void 0:Qe.spatialReference]},()=>this._updateFeatureVMs()),(0,G.YP)(()=>{var Le;return null==(Le=this.view)?void 0:Le.scale},()=>this._viewScaleChange()),(0,G.gx)(()=>!this.visible,()=>this.browseClusterEnabled=!1),(0,G.YP)(()=>this.browseClusterEnabled,Le=>Le?this.enableClusterBrowsing():this.disableClusterBrowsing())])}destroy(){this._cancelFetchingFeatures(),this._handles.destroy(),this._handles=null,this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}get active(){return!(!this.visible||this.waitingForResult)}get allActions(){const Le=this._get("allActions")||new Ec;Le.removeAll();const{actions:Qe,defaultActions:ut,defaultPopupTemplateEnabled:Et,includeDefaultActions:xt,selectedFeature:Gt}=this,ar=xt?ut.concat(Qe):Qe,Ve=Gt&&("function"==typeof Gt.getEffectivePopupTemplate&&Gt.getEffectivePopupTemplate(Et)||Gt.popupTemplate),gt=Ve&&Ve.actions,Pt=Ve&&Ve.overwriteActions?gt:gt?gt.concat(ar):ar;return Pt&&Pt.filter(Boolean).forEach(Yt=>Le.add(Yt)),Le}get defaultActions(){const Le=this._get("defaultActions")||new Ec;return Le.removeAll(),Le.addMany(Ml(this.selectedFeature)?[dc.clone(),Da.clone()]:[Mo.clone()]),Le}get featureCount(){return this.features.length}get features(){return this._get("features")||[]}set features(Le){const Qe=Le||[];this._set("features",Qe);const{pendingPromisesCount:ut,promiseCount:Et,selectedFeatureIndex:xt}=this,Gt=Et&&Qe.length;Gt&&ut&&-1===xt?this.selectedFeatureIndex=0:Gt&&-1!==xt||(this.selectedFeatureIndex=Qe.length?0:-1)}get location(){return this._get("location")||null}set location(Le){const Qe=this.get("view.spatialReference.isWebMercator");Le&&Le.get("spatialReference.isWGS84")&&Qe&&(Le=(0,qs.$)(Le)),this._set("location",Le)}get pendingPromisesCount(){return this._pendingPromises.size}get waitingForResult(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}get promiseCount(){return this.promises.length}get promises(){return this._get("promises")||[]}set promises(Le){if(this._pendingPromises.clear(),this.features=[],!Array.isArray(Le)||!Le.length)return this._set("promises",[]),void this.notifyChange("pendingPromisesCount");this._set("promises",Le),(Le=Le.slice(0)).forEach(Qe=>{this._pendingPromises.add(Qe),Qe.then(xt=>{this._pendingPromises.has(Qe)&&this._updateFeatures(xt),this._updatePendingPromises(Qe)},()=>this._updatePendingPromises(Qe))}),this.notifyChange("pendingPromisesCount")}get selectedFeature(){const{features:Le,selectedFeatureIndex:Qe}=this;return-1===Qe?null:Le[Qe]||null}get selectedFeatureIndex(){const Le=this._get("selectedFeatureIndex");return"number"==typeof Le?Le:-1}set selectedFeatureIndex(Le){const{featureCount:Qe}=this;Le=isNaN(Le)||Le<-1||!Qe?-1:(Le+Qe)%Qe,this.activeFeature=null,this._set("selectedFeatureIndex",Le)}get selectedFeatureViewModel(){return this.featureViewModels[this.selectedFeatureIndex]||null}get state(){return this.get("view.ready")?"ready":"disabled"}centerAtLocation(){const{view:Le}=this,Qe=mu(this);if(!Qe){const ut=new pe.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:Qe,view:Le});return gu.error(ut),Promise.reject(ut)}return this.callGoTo({target:{target:Qe,scale:Le.scale}})}clear(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}fetchFeatures(Le,Qe){const{view:ut}=this;if(!ut||!Le){const Et=new pe.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:Le,view:ut});return gu.error(Et),Promise.reject(Et)}return ut.fetchPopupFeatures(Le,{event:Qe&&Qe.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:Qe&&Qe.signal})}open(Le){const Qe=yi(or({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},Le),{visible:!0}),{fetchFeatures:ut}=Qe;delete Qe.fetchFeatures,ut&&this._setFetchFeaturesPromises(Qe.location);const Et=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const xt of Et)delete Qe[xt];this.set(Qe)}triggerAction(Le){const Qe=this.allActions.getItemAt(Le);Qe&&!Qe.disabled&&this.emit("trigger-action",{action:Qe})}next(){return this.selectedFeatureIndex=this.selectedFeatureIndex+1,this}previous(){return this.selectedFeatureIndex=this.selectedFeatureIndex-1,this}disableClusterBrowsing(){(function Qd(Le){const Qe=Le.features.filter(ut=>Ml(ut));Qe.length&&(Le.features=Qe)})(this),this._clearBrowsedClusterGraphics()}enableClusterBrowsing(){var Le=this;return(0,j.Z)(function*(){const{view:Qe,selectedFeature:ut}=Le;"2d"===(null==Qe?void 0:Qe.type)?Ml(ut)?(yield function Ka(Le){return Xd.apply(this,arguments)}(Le),yield function vd(Le){return Us.apply(this,arguments)}(Le)):gu.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",ut):gu.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",ut)})()}_animationStateChange(Le){this.zoomToLocation||(Mo.disabled="waiting-for-target"===Le)}_clearBrowsedClusterGraphics(){var Qe;const Le=null==(Qe=this.view)?void 0:Qe.graphics;Le&&(Le.remove(this.selectedClusterBoundaryFeature),Le.remove(this._selectedClusterFeature)),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}_viewScaleChange(){if(Ml(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=[this.selectedFeature])}_locationChange(Le){const{selectedFeature:Qe,updateLocationEnabled:ut}=this;ut&&Le&&(!Qe||Qe.geometry)&&this.centerAtLocation()}_selectedFeatureIndexChange(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}_featureViewModelsChange(){this.featurePage=this.featureCount>1?1:null}_setGraphicOnFeatureViewModels(){const{features:Le,featureCount:Qe,featurePage:ut,featuresPerPage:Et,featureViewModels:xt}=this;if(null===ut)return;const Gt=((ut-1)*Et+Qe)%Qe;xt.slice(Gt,Gt+Et).forEach((Ve,gt)=>{Ve&&!Ve.graphic&&(Ve.graphic=Le[Gt+gt])})}_selectedFeatureChange(Le){var Qe=this;return(0,j.Z)(function*(){if(!Le)return;const{location:ut,updateLocationEnabled:Et,view:xt}=Qe;if(Qe.browseClusterEnabled)return Qe._selectedClusterFeature&&(xt.graphics.remove(Qe._selectedClusterFeature),Qe._selectedClusterFeature=null),Ml(Le)?void 0:(Le.symbol=yield function Gu(Le,Qe){return na.apply(this,arguments)}(Le),Qe._selectedClusterFeature=Le,void xt.graphics.add(Qe._selectedClusterFeature));!Et&&ut||!Le.geometry?Et&&!Le.geometry&&Qe.centerAtLocation().then(()=>{Qe.location=xt.center.clone()}):Qe.location=(0,ne.Wg)(Qe._getPointFromGeometry(Le.geometry))})()}_waitingForResultChange(){!this.featureCount&&this.promises&&(this.visible=!1)}_setFetchFeaturesPromises(Le){return this._fetchFeaturesWithController(this._getScreenPoint(Le||this.location)).then(Qe=>{const{clientOnlyGraphics:ut,promisesPerLayerView:Et}=Qe,xt=Promise.resolve(ut),Gt=Et.map(ar=>ar.promise);this.promises=[xt,...Gt]})}_destroyFeatureVMs(){this.featureViewModels.forEach(Le=>Le&&!Le.destroyed&&Le.destroy()),this._set("featureViewModels",[])}_updateFeatureVMs(){const{selectedFeature:Le,features:Qe,featureViewModels:ut}=this;if(Ml(Le)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),!Qe||!Qe.length)return;const Et=ut.slice(0),xt=[];Qe.forEach((Gt,ar)=>{var gt,Pt;if(!Gt)return;let Ve=null;if(Et.some((Yt,Jr)=>(Yt&&Yt.graphic===Gt&&(Ve=Yt,Et.splice(Jr,1)),!!Ve)),Ve)xt[ar]=Ve;else{const Yt=new Zd({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(gt=this.view)?void 0:gt.spatialReference,graphic:Gt===Le?Gt:null,map:null==(Pt=this.view)?void 0:Pt.map,view:this.view});xt[ar]=Yt}}),Et.forEach(Gt=>Gt&&!Gt.destroyed&&Gt.destroy()),this._set("featureViewModels",xt)}_getScreenPoint(Le){const{view:Qe}=this;return Qe&&Le&&"function"==typeof Qe.toScreen?Qe.toScreen(Le):null}_autoOpenEnabledChange(){const Le="auto-fetch-features",{_handles:Qe,autoOpenEnabled:ut}=this;if(Qe.remove(Le),ut&&this.view){const Et=this.view.on("click",xt=>{"mouse"===xt.pointerType&&0!==xt.button||this._fetchFeaturesAndOpen(xt)},fp.f.WIDGET);Qe.add(Et,Le)}}_cancelFetchingFeatures(){const Le=this._fetchFeaturesController;Le&&Le.abort(),this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}_fetchFeaturesWithController(Le,Qe){this._cancelFetchingFeatures();const ut=new AbortController,{signal:Et}=ut;this._fetchFeaturesController=ut,this.notifyChange("waitingForResult");const xt=this.fetchFeatures(Le,{signal:Et,event:Qe});return xt.catch(()=>{}).then(()=>{this._fetchFeaturesController=null,this.notifyChange("waitingForResult")}),xt}_fetchFeaturesAndOpen(Le){const{screenPoint:Qe,mapPoint:ut}=Le,{view:Et}=this;this._fetchFeaturesWithController(Qe,Le).then(xt=>{const{clientOnlyGraphics:Gt,promisesPerLayerView:ar,location:Ve}=xt,gt=[Promise.resolve(Gt),...ar.map(Pt=>Pt.promise)];return Et.popup.open({location:Ve||ut,promises:gt}),xt})}_updatePendingPromises(Le){Le&&this._pendingPromises.has(Le)&&(this._pendingPromises.delete(Le),this.notifyChange("pendingPromisesCount"))}_autoClose(){this.autoCloseEnabled&&(this.visible=!1)}_getPointFromGeometry(Le){return(0,ne.Wi)(Le)?null:"point"===Le.type?Le:"extent"===Le.type?Le.center:"polygon"===Le.type?Le.centroid:"multipoint"===Le.type||"polyline"===Le.type?Le.extent.center:null}_getLayerView(Le,Qe){return(0,j.Z)(function*(){return yield Le.when(),Le.whenLayerView(Qe)})()}_getHighlightLayer(Le){const{layer:Qe,sourceLayer:ut}=Le;return"map-notes"===(null==ut?void 0:ut.type)||"subtype-group"===(null==ut?void 0:ut.type)?ut:Qe}_getHighlightTarget(Le,Qe){const ut="imagery"===Qe.type?void 0:"objectIdField"in Qe&&Qe.objectIdField,Et=Le.attributes;return Et&&ut&&Et[ut]||Le}_highlightActiveFeature(){var Le=this;return(0,j.Z)(function*(){const Qe="highlight-active-feature";Le._handles.remove(Qe);const{highlightEnabled:ut,view:Et,activeFeature:xt,visible:Gt}=Le;if(!(xt&&Et&&ut&&Gt))return;const ar=Le._getHighlightLayer(xt);if(!(ar&&ar instanceof Ph.Z))return;const Ve=Le._getLayerView(Et,ar);Le._highlightActiveFeaturePromise=Ve;const gt=yield Ve;if(!(gt&&(0,Hu.tl)(gt)&&Le._highlightActiveFeaturePromise===Ve&&Le.activeFeature&&Le.highlightEnabled))return;const Pt=gt.highlight(Le._getHighlightTarget(xt,ar));Le._handles.add(Pt,Qe)})()}_highlightSelectedFeature(){var Le=this;return(0,j.Z)(function*(){const Qe="highlight-selected-feature";Le._handles.remove(Qe);const{selectedFeature:ut,highlightEnabled:Et,view:xt,visible:Gt}=Le;if(!(ut&&xt&&Et&&Gt))return;const ar=Le._getHighlightLayer(ut);if(!(ar&&ar instanceof Ph.Z))return;const Ve=Le._getLayerView(xt,ar);Le._highlightSelectedFeaturePromise=Ve;const gt=yield Ve;if(!(gt&&(0,Hu.tl)(gt)&&Le._highlightSelectedFeaturePromise===Ve&&Le.selectedFeature&&Le.highlightEnabled&&Le.visible))return;const Pt=gt.highlight(Le._getHighlightTarget(ut,ar));Le._handles.add(Pt,Qe)})()}_updateFeatures(Le){const{features:Qe}=this;if(!Le||!Le.length)return;if(!Qe.length)return void(this.features=Le);const ut=Le.filter(Et=>!Qe.includes(Et));this.features=Qe.concat(ut)}};(0,x._)([(0,H.Cb)()],on.prototype,"featurePage",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"isLoadingFeature",null),(0,x._)([(0,H.Cb)({type:Ec})],on.prototype,"actions",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"active",null),(0,x._)([(0,H.Cb)()],on.prototype,"activeFeature",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"allActions",null),(0,x._)([(0,H.Cb)({type:Boolean})],on.prototype,"defaultPopupTemplateEnabled",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"autoCloseEnabled",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"autoOpenEnabled",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"browseClusterEnabled",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"content",void 0),(0,x._)([(0,H.Cb)({type:Ec,readOnly:!0})],on.prototype,"defaultActions",null),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"featureCount",null),(0,x._)([(0,H.Cb)()],on.prototype,"features",null),(0,x._)([(0,H.Cb)()],on.prototype,"featuresPerPage",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"featureViewModelAbilities",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"featureViewModels",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"highlightEnabled",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"includeDefaultActions",void 0),(0,x._)([(0,H.Cb)({type:pn.Z})],on.prototype,"location",null),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"pendingPromisesCount",null),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"selectedClusterBoundaryFeature",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"waitingForResult",null),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"promiseCount",null),(0,x._)([(0,H.Cb)()],on.prototype,"promises",null),(0,x._)([(0,H.Cb)({value:null,readOnly:!0})],on.prototype,"selectedFeature",null),(0,x._)([(0,H.Cb)({value:-1})],on.prototype,"selectedFeatureIndex",null),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"selectedFeatureViewModel",null),(0,x._)([(0,H.Cb)({readOnly:!0})],on.prototype,"state",null),(0,x._)([(0,H.Cb)()],on.prototype,"title",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"updateLocationEnabled",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"view",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"visible",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"zoomFactor",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"zoomToLocation",void 0),(0,x._)([(0,H.Cb)()],on.prototype,"centerAtLocation",null),on=(0,x._)([(0,B.j)(_n)],on);const Rs=on;var pl=T(24940),go=T(78745);const Ol="selected-index",bc="popup-spinner",Ki_shadow="esri-popup--shadow",Ki_button="esri-popup__button",Ki_icon="esri-popup__icon",yu={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},gp="esri-popup";function Cc(Le,Qe){return void 0===Qe?`${gp}__${Le}`:`${gp}__${Le}-${Qe}`}const Pl="esri.widgets.Popup",hc=$.Z.getLogger(Pl),Hl={closeButton:!0,featureNavigation:!0};let Ts=class extends(lc(_e.Z)){constructor(Le,Qe){super(Le,Qe),this._blurClose=!1,this._blurContainer=!1,this._containerNode=null,this._mainContainerNode=null,this._featureMenuNode=null,this._actionsMenuNode=null,this._focusClose=!1,this._focusContainer=!1,this._focusDockButton=!1,this._focusFeatureMenuButton=!1,this._focusActionsMenuButton=!1,this._focusFirstFeature=!1,this._focusFirstAction=!1,this._handles=new ee.Z,this._pointerOffsetInPx=16,this._spinner=null,this._feature=null,this._featureMenuIntersectionObserverCallback=([ut])=>{(null==ut?void 0:ut.isIntersecting)&&this.viewModel.featurePage++},this._featureMenuIntersectionObserver=new IntersectionObserver(this._featureMenuIntersectionObserverCallback,{root:window.document}),this._displaySpinnerThrottled=se(()=>this._displaySpinner(),0),this.actions=null,this.alignment="auto",this.autoCloseEnabled=null,this.autoOpenEnabled=null,this.defaultPopupTemplateEnabled=null,this.content=null,this.collapsed=!1,this.collapseEnabled=!0,this.dockEnabled=!1,this.featureCount=null,this.featureMenuOpen=!1,this.features=null,this.goToOverride=null,this.headingLevel=2,this.highlightEnabled=null,this.location=null,this.label=void 0,this.maxInlineActions=3,this.messages=null,this.messagesCommon=null,this.promises=null,this.selectedFeature=null,this.selectedFeatureIndex=null,this.spinnerEnabled=!0,this.title=null,this.updateLocationEnabled=null,this.view=null,this.viewModel=new Rs,this.visible=null,this.visibleElements=or({},Hl),this._addSelectedFeatureIndexHandle(),this.own([(0,G.YP)(()=>{var ut;return null==(ut=this.viewModel)?void 0:ut.screenLocation},()=>this._positionContainer()),(0,G.YP)(()=>{var ut;return[null==(ut=this.viewModel)?void 0:ut.active,this.dockEnabled]},()=>this._toggleScreenLocationEnabled()),(0,G.YP)(()=>{var ut;return null==(ut=this.viewModel)?void 0:ut.screenLocation},(ut,Et)=>{!!ut!=!!Et&&this.reposition()}),(0,G.YP)(()=>{var ut,Et,xt,Gt,ar,Ve;return[null==(Et=null==(ut=this.viewModel)?void 0:ut.view)?void 0:Et.padding,null==(Gt=null==(xt=this.viewModel)?void 0:xt.view)?void 0:Gt.size,null==(ar=this.viewModel)?void 0:ar.active,null==(Ve=this.viewModel)?void 0:Ve.location,this.alignment]},()=>this.reposition()),(0,G.YP)(()=>this.spinnerEnabled,ut=>this._spinnerEnabledChange(ut)),(0,G.YP)(()=>{var ut,Et;return null==(Et=null==(ut=this.viewModel)?void 0:ut.view)?void 0:Et.size},(ut,Et)=>this._updateDockEnabledForViewSize(ut,Et)),(0,G.YP)(()=>{var ut;return null==(ut=this.viewModel)?void 0:ut.view},(ut,Et)=>this._viewChange(ut,Et)),(0,G.YP)(()=>{var ut,Et;return null==(Et=null==(ut=this.viewModel)?void 0:ut.view)?void 0:Et.ready},(ut,Et)=>this._viewReadyChange(ut,Et)),(0,G.YP)(()=>{var ut,Et;return[null==(ut=this.viewModel)?void 0:ut.waitingForResult,null==(Et=this.viewModel)?void 0:Et.location]},()=>{this._hideSpinner(),this._displaySpinnerThrottled()}),(0,G.YP)(()=>{var ut,Et,xt,Gt;return[null==(Et=null==(ut=this.selectedFeatureWidget)?void 0:ut.viewModel)?void 0:Et.title,null==(Gt=null==(xt=this.selectedFeatureWidget)?void 0:xt.viewModel)?void 0:Gt.state]},()=>this._setTitleFromFeatureWidget()),(0,G.YP)(()=>{var ut,Et,xt,Gt;return[null==(Et=null==(ut=this.selectedFeatureWidget)?void 0:ut.viewModel)?void 0:Et.content,null==(Gt=null==(xt=this.selectedFeatureWidget)?void 0:xt.viewModel)?void 0:Gt.state]},()=>this._setContentFromFeatureWidget()),(0,G.gx)(()=>!this.collapsed,()=>{var ut,Et;"xsmall"===(null==(Et=null==(ut=this.viewModel)?void 0:ut.view)?void 0:Et.widthBreakpoint)&&this.viewModel.active&&this.collapseEnabled&&this.viewModel.centerAtLocation()}),(0,G.on)(()=>{var ut;return null==(ut=this.viewModel)?void 0:ut.allActions},"change",()=>this._watchActions()),(0,G.YP)(()=>{var ut;return null==(ut=this.viewModel)?void 0:ut.allActions},()=>this._watchActions(),G.nn),(0,G.YP)(()=>{var ut;return null==(ut=this.viewModel)?void 0:ut.featureViewModels},()=>this._featureMenuViewportScrollTop())])}destroy(){var Le,Qe;this._destroySelectedFeatureWidget(),this._destroySpinner(),null==(Le=this._handles)||Le.destroy(),this._unobserveFeatureMenuObserver(),null==(Qe=this._featureMenuIntersectionObserver)||Qe.disconnect(),this._handles=null}get actionsMenuId(){return`${this.id}-actions-menu`}get actionsMenuButtonId(){return`${this.id}-actions-menu-button`}get featureMenuId(){return`${this.id}-feature-menu`}get titleId(){return`${this.id}-popup-title`}get contentId(){return`${this.id}-popup-content`}get hasContent(){var Le,Qe,ut,Et,xt,Gt,ar;return!!(this.selectedFeatureWidget?(null==(Qe=null==(Le=this.selectedFeatureWidget)?void 0:Le.viewModel)?void 0:Qe.waitingForContent)||"error"===(null==(Et=null==(ut=this.selectedFeatureWidget)?void 0:ut.viewModel)?void 0:Et.state)||(null==(Gt=null==(xt=this.selectedFeatureWidget)?void 0:xt.viewModel)?void 0:Gt.content):null==(ar=this.viewModel)?void 0:ar.content)}get featureNavigationVisible(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}get collapsible(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}get featureMenuVisible(){return this.featureNavigationVisible&&this.featureMenuOpen}get contentCollapsed(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}get dividedActions(){return this._divideActions()}set actionsMenuOpen(Le){this._set("actionsMenuOpen",!!Le)}get actionsMenuOpen(){return!!this.viewModel.active&&this._get("actionsMenuOpen")}get currentAlignment(){return this._getCurrentAlignment()}get currentDockPosition(){return this._getCurrentDockPosition()}get dockOptions(){return this._get("dockOptions")||yu}set dockOptions(Le){const Qe=or({},yu),ut=this.get("viewModel.view.breakpoints"),Et={};ut&&(Et.width=ut.xsmall,Et.height=ut.xsmall);const xt=or(or({},Qe),Le),Gt=or(or({},Qe.breakpoint),Et),{breakpoint:ar}=xt;!0===ar?xt.breakpoint=Gt:"object"==typeof ar&&(xt.breakpoint=or(or({},Gt),ar)),this._set("dockOptions",xt),this._setCurrentDockPosition(),this.reposition()}get selectedFeatureWidget(){const{_feature:Le,visibleElements:Qe,headingLevel:ut}=this,{selectedFeatureViewModel:Et}=this.viewModel,xt=yi(or({},Qe),{title:!1});return Et?(Le?(Le.viewModel=Et,Le.visibleElements=xt):this._feature=new kd({headingLevel:ut+1,viewModel:Et,visibleElements:xt}),this._feature):null}castVisibleElements(Le){return or(or({},Hl),Le)}blur(){const{active:Le}=this.viewModel;Le||hc.warn("Popup can only be blurred when currently active."),this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0,this.scheduleRender()}clear(){this.viewModel.clear()}close(){this.visible=!1}fetchFeatures(Le,Qe){return this.viewModel.fetchFeatures(Le,Qe)}focus(){const{active:Le}=this.viewModel;Le||hc.warn("Popup can only be focused when currently active."),this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0,this.scheduleRender()}next(){return this.viewModel.next()}open(Le){var xt,Gt;this._handles.remove(Ol);const Et={collapsed:!!Le&&!!Le.collapsed,actionsMenuOpen:!!Le&&!!Le.actionsMenuOpen,featureMenuOpen:!!Le&&!!Le.featureMenuOpen};"xsmall"===(null==(Gt=null==(xt=this.viewModel)?void 0:xt.view)?void 0:Gt.widthBreakpoint)&&(Et.collapsed=!0),this.set(Et),this.viewModel.open(Le),this._shouldFocus(Le),this._addSelectedFeatureIndexHandle()}previous(){return this.viewModel.previous()}reposition(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}triggerAction(Le){this.viewModel.triggerAction(Le)}render(){var Si,xs,Kn,Mn;const{actionsMenuOpen:Le,dockEnabled:Qe,featureMenuVisible:ut,dividedActions:Et,currentAlignment:xt,currentDockPosition:Gt}=this,{active:ar}=this.viewModel,{menuActions:Ve}=Et,Jr=null==(xs=null==(Si=this.selectedFeature)?void 0:Si.layer)?void 0:xs.title,Mi=null==(Mn=null==(Kn=this.selectedFeature)?void 0:Kn.layer)?void 0:Mn.id;return(0,zr.u)("div",{class:this.classes("esri-popup",{"esri-popup--aligned-top-center":"top-center"===xt,"esri-popup--aligned-bottom-center":"bottom-center"===xt,"esri-popup--aligned-top-left":"top-left"===xt,"esri-popup--aligned-bottom-left":"bottom-left"===xt,"esri-popup--aligned-top-right":"top-right"===xt,"esri-popup--aligned-bottom-right":"bottom-right"===xt,"esri-popup--is-docked":ar&&Qe,[Ki_shadow]:ar&&!Qe,"esri-popup--is-docked-top-left":"top-left"===Gt,"esri-popup--is-docked-top-center":"top-center"===Gt,"esri-popup--is-docked-top-right":"top-right"===Gt,"esri-popup--is-docked-bottom-left":"bottom-left"===Gt,"esri-popup--is-docked-bottom-center":"bottom-center"===Gt,"esri-popup--is-docked-bottom-right":"bottom-right"===Gt,"esri-popup--feature-menu-open":ut,"esri-popup--actions-menu-open":ar&&Ve.length>1&&Le}),role:"presentation","data-layer-title":Jr,"data-layer-id":Mi,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},ar?[this.renderMainContainer(),this.renderPointer()]:null)}renderLoadingIcon(){return(0,zr.u)("span",{"aria-hidden":"true",class:this.classes(Ki_icon,"esri-icon-loading-indicator","esri-rotating")})}renderNavigationLoading(){const{messagesCommon:Le}=this;return this.viewModel.pendingPromisesCount?(0,zr.u)("div",{key:Cc("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":Le.loading,title:Le.loading},this.renderLoadingIcon()):null}renderPreviousIcon(){const Le=(0,Gi.dZ)(this.container);return(0,zr.u)("span",{"aria-hidden":"true",class:this.classes(Ki_icon,{"esri-icon-right-triangle-arrow":Le,"esri-popup__pagination-previous-icon--rtl":Le,"esri-icon-left-triangle-arrow":!Le,"esri-popup__pagination-previous-icon":!Le})})}renderPreviousButton(){const{messages:Le}=this;return(0,zr.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(Ki_button,"esri-popup__pagination-previous"),"aria-label":Le.previous,title:Le.previous},this.renderPreviousIcon())}renderNextIcon(){const Le=(0,Gi.dZ)(this.container);return(0,zr.u)("span",{"aria-hidden":"true",class:this.classes(Ki_icon,{"esri-icon-left-triangle-arrow":Le,"esri-popup__pagination-next-icon--rtl":Le,"esri-icon-right-triangle-arrow":!Le,"esri-popup__pagination-next-icon":!Le})})}renderNextButton(){const{messages:Le}=this;return(0,zr.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes(Ki_button,"esri-popup__pagination-next"),"aria-label":Le.next,title:Le.next},this.renderNextIcon())}renderFeatureMenuButton(){const{featureMenuOpen:Le,featureMenuId:Qe,messagesCommon:ut}=this,{featureCount:Et,selectedFeatureIndex:xt}=this.viewModel;return(0,zr.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(Ki_button,"esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":Qe,"aria-expanded":Le.toString(),"aria-label":ut.menu,title:ut.menu},this._getPageText(Et,xt))}renderNavigationButtons(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:null}renderDockIcon(){const{dockEnabled:Le}=this,Qe=this._wouldDockTo();return(0,zr.u)("span",{"aria-hidden":"true",class:this.classes({"esri-icon-minimize":Le,"esri-popup__icon--dock-icon":!Le,"esri-icon-dock-right":!Le&&("top-right"===Qe||"bottom-right"===Qe),"esri-icon-dock-left":!Le&&("top-left"===Qe||"bottom-left"===Qe),"esri-icon-maximize":!Le&&"top-center"===Qe,"esri-icon-dock-bottom":!Le&&"bottom-center"===Qe},Ki_icon)})}renderDockButton(){var xt,Gt,ar;const{dockEnabled:Le,messages:Qe}=this,ut=null==(Gt=null==(xt=this.viewModel)?void 0:xt.view)?void 0:Gt.widthBreakpoint,Et=Le?Qe.undock:Qe.dock;return"xsmall"!==ut&&(null==(ar=this.dockOptions)?void 0:ar.buttonEnabled)?(0,zr.u)("div",{role:"button","aria-label":Et,title:Et,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(Ki_button,"esri-popup__button--dock")},this.renderDockIcon()):null}renderTitle(){const{title:Le}=this.viewModel,{titleId:Qe,collapsible:ut,contentCollapsed:Et,messagesCommon:xt}=this,Gt={"esri-popup__header-container--button":ut},ar=(0,zr.u)(gi.X6,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:Le}),Ve=ut?(0,zr.u)("button",{key:`${Le}--collapsible`,id:Qe,title:Et?xt.expand:xt.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",Gt),"aria-expanded":Et?"false":"true",onclick:this._toggleCollapsed,type:"button"},ar):(0,zr.u)("div",{key:Le,id:Qe,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",Gt)},ar);return Le?Ve:null}renderCloseIcon(){return(0,zr.u)("span",{"aria-hidden":"true",class:this.classes(Ki_icon,"esri-icon-close")})}renderCloseButton(){const{visibleElements:Le,messagesCommon:Qe}=this;return Le.closeButton?(0,zr.u)("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:Ki_button,"aria-label":Qe.close,title:Qe.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null}renderHeader(){return(0,zr.u)("header",{class:"esri-popup__header"},this.renderTitle(),(0,zr.u)("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))}renderContentContainer(){const{contentId:Le,hasContent:Qe,contentCollapsed:ut}=this,{content:Et}=this.viewModel;return Qe&&!ut?(0,zr.u)("article",{key:Et,enterAnimation:this._createFeatureUpdatedAnimation(),id:Le,class:"esri-popup__content"},this.renderContent()):null}renderActionsMenuButton(){const{actionsMenuId:Le,actionsMenuButtonId:Qe,actionsMenuOpen:ut,dividedActions:Et,messagesCommon:xt}=this,Gt=ut?xt.close:xt.open,{menuActions:ar}=Et;return ar.length?(0,zr.u)("div",{key:Cc("actions-menu-button"),class:this.classes(Ki_button,"esri-popup__actions-menu-button"),role:"button",id:Qe,"aria-haspopup":"true","aria-controls":ut?Le:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":Gt,title:Gt},(0,zr.u)("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null}renderMenuActions(){const{actionsMenuId:Le,actionsMenuButtonId:Qe,actionsMenuOpen:ut,dividedActions:Et}=this,{menuActions:xt}=Et;return xt.length&&ut?(0,zr.u)("ul",{id:Le,role:"menu","aria-labelledby":Qe,key:Cc("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},xt.toArray().map(Gt=>this.renderAction({action:Gt,type:"menu-item"}))):null}renderInlineActions(){const{inlineActions:Le}=this.dividedActions;return!!Le.length&&Le.toArray().map(Qe=>this.renderAction({action:Qe,type:"inline"}))}renderInlineActionsContainer(){const{inlineActions:Le,menuActions:Qe}=this.dividedActions,ut=!!Le.length,Et=!!Qe.length;return ut||Et?(0,zr.u)("div",{key:"inline-actions-container","data-inline-actions":ut.toString(),"data-menu-actions":Et.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null}renderNavigation(){return this.featureNavigationVisible?(0,zr.u)("section",{key:Cc("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null}renderFooter(){const{featureNavigationVisible:Le,dividedActions:Qe}=this,{inlineActions:ut,menuActions:Et}=Qe,xt=!!ut.length,ar={"esri-popup__footer--has-pagination":Le,"esri-popup__footer--has-actions":xt,"esri-popup__footer--has-actions-menu":!!Et.length};return Le||xt?(0,zr.u)("div",{key:Cc("feature-buttons"),class:this.classes("esri-popup__footer",ar)},this.renderInlineActionsContainer(),this.renderNavigation()):null}renderFeatureMenuContainer(){const{messages:Le}=this,{featureViewModels:Qe,isLoadingFeature:ut}=this.viewModel,Et=(0,Vl.n)(Le.selectedFeatures,{total:Qe.length});return(0,zr.u)("section",{key:Cc("menu"),class:"esri-popup__feature-menu"},(0,zr.u)("strong",{class:"esri-popup__feature-menu-header"},Et),(0,zr.u)("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:Gi.Yo},this.renderFeatureMenu(),(0,zr.u)("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),ut?(0,zr.u)("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):null))}renderPointer(){return this.dockEnabled?null:(0,zr.u)("div",{key:Cc("pointer"),class:"esri-popup__pointer",role:"presentation"},(0,zr.u)("div",{class:this.classes("esri-popup__pointer-direction",Ki_shadow)}))}renderMainContainer(){const{dockEnabled:Le,currentAlignment:Qe,currentDockPosition:ut,titleId:Et,contentId:xt,collapsible:Gt,hasContent:ar,contentCollapsed:Ve,visibleElements:gt}=this,{title:Pt}=this.viewModel,Yt="bottom-left"===Qe||"bottom-center"===Qe||"bottom-right"===Qe||"top-left"===ut||"top-center"===ut||"top-right"===ut,Jr="top-left"===Qe||"top-center"===Qe||"top-right"===Qe||"bottom-left"===ut||"bottom-center"===ut||"bottom-right"===ut;return(0,zr.u)("div",{class:this.classes("esri-popup__main-container","esri-widget",{[Ki_shadow]:Le,"esri-popup--is-collapsible":Gt,"esri-popup--is-collapsed":Ve}),tabIndex:gt.closeButton?null:-1,role:"dialog","aria-labelledby":Pt?Et:"","aria-describedby":ar&&!Ve?xt:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},Yt?this.renderFooter():null,Yt?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),Jr?this.renderFooter():null,Jr?this.renderFeatureMenuContainer():null)}renderContent(){var Qe;const Le=null==(Qe=this.viewModel)?void 0:Qe.content;return Le?"string"==typeof Le?(0,zr.u)("div",{key:Le,innerHTML:Le}):this.renderNodeContent(Le):null}renderActionText(Le){return(0,zr.u)("span",{key:"text",class:"esri-popup__action-text"},Le)}renderActionIcon(Le){const Qe=this._getActionClass(Le),ut=this._getActionImage(Le),Et={"esri-icon-loading-indicator":Le.active,"esri-rotating":Le.active,[Ki_icon]:!!Qe,"esri-popup__action-image":!Le.active&&!!ut};return Qe&&(Et[Qe]=!Le.active),(0,zr.u)("span",{key:"icon","aria-hidden":"true",class:this.classes(Ki_icon,Et),styles:this._getIconStyles(ut)})}renderAction(Le){const{action:Qe,type:ut}=Le,Et=this._getActionTitle(Qe),xt={"esri-popup__action":"toggle"!==Qe.type,"esri-popup__action-toggle":"toggle"===Qe.type,"esri-popup__action-toggle--on":"toggle"===Qe.type&&Qe.value,"esri-popup__button--disabled":Qe.disabled},Gt=[this.renderActionIcon(Qe),this.renderActionText(Et)],ar="menu-item"===ut?(0,zr.u)("li",{key:Qe.uid,role:"menuitem",tabIndex:0,title:Et,"aria-label":Et,class:this.classes(Ki_button,xt),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":Qe.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},Gt):(0,zr.u)("div",{key:Qe.uid,role:"button",tabIndex:0,title:Et,"aria-label":Et,class:this.classes(Ki_button,xt),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":Qe.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},Gt);return Qe.visible?ar:null}renderFeatureMenuItem(Le,Qe){const{messages:ut,messagesCommon:Et}=this,{selectedFeatureIndex:xt,selectedFeatureViewModel:Gt}=this.viewModel,ar=Le===Gt,Ve={"esri-popup__feature-menu-item--selected":ar},gt=ar?(0,zr.u)("span",{key:Cc(`feature-menu-selected-feature-${xt}`),title:ut.selectedFeature,"aria-label":ut.selectedFeature,class:"esri-icon-check-mark"}):null,Pt=(0,zr.u)("span",{innerHTML:Le.title||Et.untitled});return(0,zr.u)("li",{role:"menuitem",tabIndex:-1,key:Cc(`feature-menu-feature-${xt}`),class:this.classes(Ve,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":Qe,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},(0,zr.u)("span",{class:"esri-popup__feature-menu-title"},Pt,gt))}renderFeatureMenu(){const{featureMenuId:Le}=this,{featureViewModels:Qe}=this.viewModel;return Qe.length>1?(0,zr.u)("ol",{class:"esri-popup__feature-menu-list",id:Le,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},Qe.filter(ut=>!!ut.graphic).map((ut,Et)=>this.renderFeatureMenuItem(ut,Et))):null}_getActionTitle(Le){const{messages:Qe,selectedFeature:ut,messagesCommon:Et}=this,{id:xt}=Le,Gt=null==ut?void 0:ut.attributes,ar="zoom-to-feature"===xt?(0,Vl.n)(Le.title,{messages:Qe}):"remove-selected-feature"===xt?(0,Vl.n)(Le.title,{messages:Et}):"zoom-to-clustered-features"===xt||"browse-clustered-features"===xt?(0,Vl.n)(Le.title,{messages:Qe}):Le.title;return ar&&Gt?(0,Vl.n)(ar,Gt):ar}_getActionClass(Le){const{selectedFeature:Qe}=this,ut=null==Qe?void 0:Qe.attributes,{className:Et,image:xt}=Le,Gt=xt||Et?Et:"esri-icon-default-action";return Gt&&ut?(0,Vl.n)(Gt,ut):Gt}_getActionImage(Le){const{selectedFeature:Qe}=this,ut=null==Qe?void 0:Qe.attributes,{image:Et}=Le;return Et&&ut?(0,Vl.n)(Et,ut):Et}_createFeatureUpdatedAnimation(){return(0,Gi.vU)("enter","esri-popup--feature-updated")}_getInlineActionCount(){const{maxInlineActions:Le,featureNavigationVisible:Qe}=this;if("number"!=typeof Le)return null;const ut=Math.round(Le);return Math.max(Qe?ut-1:ut,0)}_watchActions(){const{allActions:Le}=this.viewModel;this.notifyChange("dividedActions");const Qe="actions";this._handles.remove(Qe),Le&&Le.forEach(ut=>{this._handles.add((0,G.YP)(()=>[ut.uid,ut.active,ut.className,ut.disabled,ut.id,ut.title,ut.image,ut.visible],()=>this.scheduleRender()),Qe)})}_divideActions(){const{allActions:Le}=this.viewModel,Qe=Le.filter(Gt=>Gt.visible),ut=this._getInlineActionCount(),Et=null===ut,xt=0===ut;return{inlineActions:Et?Qe.slice(0):xt?new ie.Z:Qe.slice(0,ut),menuActions:Et?new ie.Z:Qe.slice(xt?0:ut)}}_featureMenuOpenChanged(Le){Le?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0}_actionsMenuOpenChanged(Le){Le?this._focusFirstAction=!0:this._focusActionsMenuButton=!0}_setTitleFromFeatureWidget(){var ut,Et;const{selectedFeatureWidget:Le,messagesCommon:Qe}=this;Le&&(this.viewModel.title="error"===(null==(ut=Le.viewModel)?void 0:ut.state)?Qe.errorMessage:(null==(Et=Le.viewModel)?void 0:Et.title)||"")}_setContentFromFeatureWidget(){const{selectedFeatureWidget:Le}=this;Le&&(this.viewModel.content=Le)}_unobserveFeatureMenuObserver(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}_featureMenuIntersectionObserverCreated(Le){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(Le),this._featureMenuIntersectionObserverNode=Le}_handleFeatureMenuKeyup(Le){"Escape"===(0,U.kK)(Le)&&(Le.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())}_handleActionMenuKeyup(Le){"Escape"===(0,U.kK)(Le)&&(Le.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())}_setActiveFeature(Le){const{viewModel:Qe}=this;Qe.activeFeature=Qe.features[Le.currentTarget["data-feature-index"]]||null}_removeActiveFeature(){this.viewModel.activeFeature=null}_handleFeatureMenuItemKeyup(Le){const Qe=(0,U.kK)(Le),{_featureMenuNode:ut}=this,Et=Le.currentTarget["data-feature-index"];if(!ut)return;const xt=ut.querySelectorAll("li"),Gt=xt.length;"ArrowUp"!==Qe?"ArrowDown"!==Qe?"Home"!==Qe?"End"!==Qe||(Le.stopPropagation(),xt[xt.length-1].focus()):(Le.stopPropagation(),xt[0].focus()):(Le.stopPropagation(),xt[(Et+1+Gt)%Gt].focus()):(Le.stopPropagation(),xt[(Et-1+Gt)%Gt].focus())}_handleActionMenuItemKeyup(Le){const Qe=(0,U.kK)(Le),{_actionsMenuNode:ut}=this,Et=Le.currentTarget.dataset.actionUid,{menuActions:xt}=this.dividedActions,Gt=xt.findIndex(gt=>gt.uid===Et);if(!ut)return;const ar=ut.querySelectorAll("li"),Ve=ar.length;"ArrowUp"!==Qe?"ArrowDown"!==Qe?"Home"!==Qe?"End"!==Qe||(Le.stopPropagation(),ar[ar.length-1].focus()):(Le.stopPropagation(),ar[0].focus()):(Le.stopPropagation(),ar[(Gt+1+Ve)%Ve].focus()):(Le.stopPropagation(),ar[(Gt-1+Ve)%Ve].focus())}_handleMainKeyup(Le){const Qe=(0,U.kK)(Le);"ArrowLeft"===Qe&&(Le.stopPropagation(),this.previous()),"ArrowRight"===Qe&&(Le.stopPropagation(),this.next())}_spinnerEnabledChange(Le){if(this._destroySpinner(),!Le)return;const Qe=this.get("viewModel.view");this._createSpinner(Qe)}_hideSpinner(){const{_spinner:Le}=this;Le&&(Le.location=null,Le.hide())}_displaySpinner(){const{_spinner:Le}=this;if(!Le)return;const{location:Qe,waitingForResult:ut}=this.viewModel;ut?Le.show({location:Qe}):Le.hide()}_getIconStyles(Le){return{"background-image":Le?`url(${Le})`:""}}_shouldFocus(Le){var Qe=this;return(0,j.Z)(function*(){Le.shouldFocus&&(yield(0,G.N1)(()=>{var ut;return!0===(null==(ut=Qe.viewModel)?void 0:ut.active)}),Qe.focus())})()}_addSelectedFeatureIndexHandle(){const Le=(0,G.YP)(()=>{var Qe;return null==(Qe=this.viewModel)?void 0:Qe.selectedFeatureIndex},(Qe,ut)=>this._selectedFeatureIndexUpdated(Qe,ut));this._handles.add(Le,Ol)}_selectedFeatureIndexUpdated(Le,Qe){const{featureCount:ut}=this;ut&&Le!==Qe&&-1!==Le&&(this.actionsMenuOpen=!1,this.featureMenuOpen=!1)}_destroySelectedFeatureWidget(){const{_feature:Le}=this;Le&&(Le.viewModel=null,Le&&!Le.destroyed&&Le.destroy()),this._feature=null}_isScreenLocationWithinView(Le,Qe){return Le.x>-1&&Le.y>-1&&Le.x<=Qe.width&&Le.y<=Qe.height}_isOutsideView(Le){const{popupHeight:Qe,popupWidth:ut,screenLocation:Et,side:xt,view:Gt}=Le;if(isNaN(ut)||isNaN(Qe)||!Gt||!Et)return!1;const ar=Gt.padding;return"right"===xt&&Et.x+ut/2>Gt.width-ar.right||"left"===xt&&Et.x-ut/2<ar.left||"top"===xt&&Et.y-Qe<ar.top||"bottom"===xt&&Et.y+Qe>Gt.height-ar.bottom}_calculateAutoAlignment(Le){if("auto"!==Le)return Le;const{_pointerOffsetInPx:Qe,_containerNode:ut,_mainContainerNode:Et,viewModel:xt}=this,{screenLocation:Gt,view:ar}=xt;if((0,ne.Wi)(Gt)||!ar||!ut)return"top-center";if(!this._isScreenLocationWithinView(Gt,ar))return this._get("currentAlignment")||"top-center";function Ve(Kl){return parseInt(Kl.replace(/[^-\d\.]/g,""),10)}const gt=Et?window.getComputedStyle(Et,null):null,Pt=gt?Ve(gt.getPropertyValue("max-height")):0,Yt=gt?Ve(gt.getPropertyValue("height")):0,{height:Jr,width:Mi}=ut.getBoundingClientRect(),Pi=Mi+Qe,Si=Math.max(Jr,Pt,Yt)+Qe,xs=this._isOutsideView({popupHeight:Si,popupWidth:Pi,screenLocation:Gt,side:"right",view:ar}),Kn=this._isOutsideView({popupHeight:Si,popupWidth:Pi,screenLocation:Gt,side:"left",view:ar}),Mn=this._isOutsideView({popupHeight:Si,popupWidth:Pi,screenLocation:Gt,side:"top",view:ar}),el=this._isOutsideView({popupHeight:Si,popupWidth:Pi,screenLocation:Gt,side:"bottom",view:ar});return Kn?Mn?"bottom-right":"top-right":xs?Mn?"bottom-left":"top-left":Mn?el?"top-center":"bottom-center":"top-center"}_callCurrentAlignment(Le){return"function"==typeof Le?Le.call(this):Le}_getCurrentAlignment(){const{alignment:Le,dockEnabled:Qe}=this;return Qe||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(Le)))}_setCurrentAlignment(){this._set("currentAlignment",this._getCurrentAlignment())}_setCurrentDockPosition(){this._set("currentDockPosition",this._getCurrentDockPosition())}_calculatePositionResult(Le){const Qe=["left","right"];return(0,Gi.dZ)(this.container)&&Qe.reverse(),Le.replace(/leading/gi,Qe[0]).replace(/trailing/gi,Qe[1])}_callDockPosition(Le){return"function"==typeof Le?Le.call(this):Le}_getDockPosition(){var Le;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(Le=this.dockOptions)?void 0:Le.position)))}_getCurrentDockPosition(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}_wouldDockTo(){return this.dockEnabled?null:this._getDockPosition()}_calculateAutoDockPosition(Le){var ar;if("auto"!==Le)return Le;const Qe=null==(ar=this.viewModel)?void 0:ar.view,ut=(0,Gi.dZ)(this.container)?"top-left":"top-right";if(!Qe)return ut;const Et=Qe.padding||{left:0,right:0,top:0,bottom:0},xt=Qe.width-Et.left-Et.right,{breakpoints:Gt}=Qe;return Gt&&xt<=Gt.xsmall?"bottom-center":ut}_positionContainer(Le=this._containerNode){if(Le&&(this._containerNode=Le),!Le)return;const{screenLocation:Qe}=this.viewModel,{width:ut}=Le.getBoundingClientRect(),Et=this._calculatePositionStyle(Qe,ut);Et&&(Le.style.top=Et.top,Le.style.left=Et.left,Le.style.bottom=Et.bottom,Le.style.right=Et.right)}_calculateFullWidth(Le){const{currentAlignment:Qe,_pointerOffsetInPx:ut}=this;return"top-left"===Qe||"bottom-left"===Qe||"top-right"===Qe||"bottom-right"===Qe?Le+ut:Le}_calculateAlignmentPosition(Le,Qe,ut,Et){const{currentAlignment:xt,_pointerOffsetInPx:Gt}=this,ar=Et/2,Ve=ut.height-Qe,gt=ut.width-Le,{padding:Pt}=this.view;return"bottom-center"===xt?{top:Qe+Gt-Pt.top,left:Le-ar-Pt.left}:"top-left"===xt?{bottom:Ve+Gt-Pt.bottom,right:gt+Gt-Pt.right}:"bottom-left"===xt?{top:Qe+Gt-Pt.top,right:gt+Gt-Pt.right}:"top-right"===xt?{bottom:Ve+Gt-Pt.bottom,left:Le+Gt-Pt.left}:"bottom-right"===xt?{top:Qe+Gt-Pt.top,left:Le+Gt-Pt.left}:"top-center"===xt?{bottom:Ve+Gt-Pt.bottom,left:Le-ar-Pt.left}:void 0}_calculatePositionStyle(Le,Qe){const{dockEnabled:ut,view:Et}=this;if(!Et)return;if(ut)return{left:"",top:"",right:"",bottom:""};if((0,ne.Wi)(Le)||!Qe)return;const xt=this._calculateFullWidth(Qe),Gt=this._calculateAlignmentPosition(Le.x,Le.y,Et,xt);return Gt?{top:void 0!==Gt.top?`${Gt.top}px`:"auto",left:void 0!==Gt.left?`${Gt.left}px`:"auto",bottom:void 0!==Gt.bottom?`${Gt.bottom}px`:"auto",right:void 0!==Gt.right?`${Gt.right}px`:"auto"}:void 0}_viewChange(Le,Qe){Le&&Qe&&(this.close(),this.clear())}_viewReadyChange(Le,Qe){if(Le){const ut=this.get("viewModel.view");this._wireUpView(ut)}else Qe&&(this.close(),this.clear())}_wireUpView(Le){if(this._destroySpinner(),!Le)return;const{spinnerEnabled:Qe}=this;Qe&&this._createSpinner(Le),this._setDockEnabledForViewSize(this.dockOptions)}_dockingThresholdCrossed(Le,Qe,ut){const[Et,xt]=Le,[Gt,ar]=Qe,{width:Ve,height:gt}=ut;return Et<=Ve&&Gt>Ve||Et>Ve&&Gt<=Ve||xt<=gt&&ar>gt||xt>gt&&ar<=gt}_updateDockEnabledForViewSize(Le,Qe){if(!Le||!Qe)return;const ut=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},Et=ut.left+ut.right,xt=ut.top+ut.bottom,Gt=[],ar=[];Gt[0]=Le[0]-Et,Gt[1]=Le[1]-xt,ar[0]=Qe[0]-Et,ar[1]=Qe[1]-xt;const{dockOptions:Ve}=this;this._dockingThresholdCrossed(Gt,ar,Ve.breakpoint)&&this._setDockEnabledForViewSize(Ve),this._setCurrentDockPosition()}_focusDockButtonNode(Le){this._focusDockButton&&(this._focusDockButton=!1,Le.focus())}_closeButtonNodeUpdated(Le){return this._focusClose?(this._focusClose=!1,void Le.focus()):this._blurClose?(this._blurClose=!1,void Le.blur()):void 0}_mainContainerNodeUpdated(Le){return this._mainContainerNode=Le,this._focusContainer?(this._focusContainer=!1,void Le.focus()):this._blurContainer?(this._blurContainer=!1,void Le.blur()):void 0}_featureMenuNodeUpdated(Le){if(this._featureMenuNode=Le,!Le||!this._focusFirstFeature)return;this._focusFirstFeature=!1;const Qe=Le.querySelectorAll("li");Qe.length&&Qe[0].focus()}_actionsMenuNodeUpdated(Le){if(this._actionsMenuNode=Le,!Le||!this._focusFirstAction)return;this._focusFirstAction=!1;const Qe=Le.querySelectorAll("li");Qe.length&&Qe[0].focus()}_focusFeatureMenuButtonNode(Le){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,Le.focus())}_focusActionsMenuButtonNode(Le){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,Le.focus())}_featureMenuViewportScrollTop(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)}_toggleScreenLocationEnabled(){const{dockEnabled:Le,viewModel:Qe}=this;Qe&&(Qe.screenLocationEnabled=Qe.active&&!Le)}_shouldDockAtCurrentViewSize(Le){var Ve,gt;const Qe=Le.breakpoint,ut=null==(gt=null==(Ve=this.viewModel)?void 0:Ve.view)?void 0:gt.ui;if(!ut)return!1;const{width:Et,height:xt}=ut;if(isNaN(Et)||isNaN(xt))return!1;const Gt=Qe.hasOwnProperty("width")&&Et<=Qe.width,ar=Qe.hasOwnProperty("height")&&xt<=Qe.height;return Gt||ar}_setDockEnabledForViewSize(Le){Le.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(Le))}_getPageText(Le,Qe){return this.featureNavigationVisible?(0,Vl.n)(this.messages.pageText,{index:Qe+1,total:Le}):null}_destroySpinner(){const{_spinner:Le,view:Qe}=this;Le&&(Qe&&Qe.ui&&Qe.ui.remove(this._spinner,bc),Le.destroy(),this._spinner=null)}_createSpinner(Le){Le&&(this._spinner=new Xn({view:Le}),Le.ui.add(this._spinner,{key:bc,position:"manual"}))}_toggleCollapsed(){this.collapsed=!this.collapsed}_close(){this.close(),this.view&&this.view.focus()}_toggleDockEnabled(){this.dockEnabled=!this.dockEnabled,this._focusDockButton=!0,this.scheduleRender()}_toggleFeatureMenu(){const Le=!this.featureMenuOpen;this._featureMenuOpenChanged(Le),this.actionsMenuOpen=!1,this.featureMenuOpen=Le}_toggleActionsMenu(){const Le=!this.actionsMenuOpen;this._actionsMenuOpenChanged(Le),this.featureMenuOpen=!1,this.actionsMenuOpen=Le}_triggerAction(Le){const Qe=Le.currentTarget.dataset.actionUid,{allActions:ut}=this.viewModel,Et=ut.findIndex(Gt=>Gt.uid===Qe),xt=ut.getItemAt(Et);xt&&"toggle"===xt.type&&(xt.value=!xt.value),this.actionsMenuOpen=!1,this.viewModel.triggerAction(Et)}_selectFeature(Le){const Qe=Le.currentTarget["data-feature-index"];isNaN(Qe)||(this.viewModel.selectedFeatureIndex=Qe),this.featureMenuOpen=!1,this._focusFeatureMenuButton=!0,this.scheduleRender()}_next(){this.next()}_previous(){this.previous()}};(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"actionsMenuId",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"actionsMenuButtonId",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"featureMenuId",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"titleId",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"contentId",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"hasContent",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"featureNavigationVisible",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"collapsible",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"featureMenuVisible",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"contentCollapsed",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"dividedActions",null),(0,x._)([(0,ae.B)("viewModel.actions")],Ts.prototype,"actions",void 0),(0,x._)([(0,H.Cb)()],Ts.prototype,"actionsMenuOpen",null),(0,x._)([(0,H.Cb)()],Ts.prototype,"alignment",void 0),(0,x._)([(0,ae.B)("viewModel.autoCloseEnabled")],Ts.prototype,"autoCloseEnabled",void 0),(0,x._)([(0,ae.B)("viewModel.autoOpenEnabled")],Ts.prototype,"autoOpenEnabled",void 0),(0,x._)([(0,ae.B)("viewModel.defaultPopupTemplateEnabled")],Ts.prototype,"defaultPopupTemplateEnabled",void 0),(0,x._)([(0,ae.B)("viewModel.content")],Ts.prototype,"content",void 0),(0,x._)([(0,H.Cb)()],Ts.prototype,"collapsed",void 0),(0,x._)([(0,H.Cb)()],Ts.prototype,"collapseEnabled",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"currentAlignment",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"currentDockPosition",null),(0,x._)([(0,H.Cb)()],Ts.prototype,"dockOptions",null),(0,x._)([(0,H.Cb)()],Ts.prototype,"dockEnabled",void 0),(0,x._)([(0,ae.B)("viewModel.featureCount")],Ts.prototype,"featureCount",void 0),(0,x._)([(0,H.Cb)()],Ts.prototype,"featureMenuOpen",void 0),(0,x._)([(0,ae.B)("viewModel.features")],Ts.prototype,"features",void 0),(0,x._)([(0,ae.B)("viewModel.goToOverride")],Ts.prototype,"goToOverride",void 0),(0,x._)([(0,H.Cb)()],Ts.prototype,"headingLevel",void 0),(0,x._)([(0,ae.B)("viewModel.highlightEnabled")],Ts.prototype,"highlightEnabled",void 0),(0,x._)([(0,ae.B)("viewModel.location")],Ts.prototype,"location",void 0),(0,x._)([(0,H.Cb)({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],Ts.prototype,"label",void 0),(0,x._)([(0,H.Cb)()],Ts.prototype,"maxInlineActions",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/widgets/Popup/t9n/Popup")],Ts.prototype,"messages",void 0),(0,x._)([(0,H.Cb)(),(0,es.H)("esri/t9n/common")],Ts.prototype,"messagesCommon",void 0),(0,x._)([(0,ae.B)("viewModel.promises")],Ts.prototype,"promises",void 0),(0,x._)([(0,ae.B)("viewModel.selectedFeature")],Ts.prototype,"selectedFeature",void 0),(0,x._)([(0,ae.B)("viewModel.selectedFeatureIndex")],Ts.prototype,"selectedFeatureIndex",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Ts.prototype,"selectedFeatureWidget",null),(0,x._)([(0,H.Cb)()],Ts.prototype,"spinnerEnabled",void 0),(0,x._)([(0,ae.B)("viewModel.title")],Ts.prototype,"title",void 0),(0,x._)([(0,ae.B)("viewModel.updateLocationEnabled")],Ts.prototype,"updateLocationEnabled",void 0),(0,x._)([(0,ae.B)("viewModel.view")],Ts.prototype,"view",void 0),(0,x._)([(0,H.Cb)({type:Rs}),(0,go.s)(["triggerAction","trigger-action"])],Ts.prototype,"viewModel",void 0),(0,x._)([(0,ae.B)("viewModel.visible")],Ts.prototype,"visible",void 0),(0,x._)([(0,H.Cb)()],Ts.prototype,"visibleElements",void 0),(0,x._)([(0,de.p)("visibleElements")],Ts.prototype,"castVisibleElements",null),(0,x._)([(0,pl.h)()],Ts.prototype,"_close",null),(0,x._)([(0,pl.h)()],Ts.prototype,"_toggleDockEnabled",null),(0,x._)([(0,pl.h)()],Ts.prototype,"_toggleFeatureMenu",null),(0,x._)([(0,pl.h)()],Ts.prototype,"_toggleActionsMenu",null),(0,x._)([(0,pl.h)()],Ts.prototype,"_triggerAction",null),(0,x._)([(0,pl.h)()],Ts.prototype,"_selectFeature",null),(0,x._)([(0,pl.h)()],Ts.prototype,"_next",null),(0,x._)([(0,pl.h)()],Ts.prototype,"_previous",null),Ts=(0,x._)([(0,B.j)(Pl)],Ts);const yp=Ts,wa=[0,0];function bd(Le){Le&&((0,A.cS)(Le),Le.parentNode&&Le.parentNode.removeChild(Le))}const Qn=Le=>{let Qe=class extends Le{constructor(...ut){super(...ut),this._freqInfo={freq:16,time:750},this._overlayRenderTaskHandle=null,this.height=0,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.handles.add([(0,G.YP)(()=>this.cursor,Et=>{const{surface:xt}=this;xt&&xt.setAttribute("data-cursor",Et)}),(0,G.YP)(()=>this.interacting,Et=>{const{surface:xt}=this;xt&&xt.setAttribute("data-interacting",Et.toString())})])}initialize(){this.handles.add((0,G.YP)(()=>this.ui,(ut,Et)=>this._handleUIChange(ut,Et))),this._wireUI(this.ui),this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)}set container(ut){const Et=this._get("container");if(Et===ut)return;const xt="dom-size";if(this.handles.remove(xt),this._stopMeasuring(),Et&&(Et.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),bd(this.root),this._set("root",null),(0,A.YD)(this.userContent,Et),bd(this.userContent),this._set("userContent",null)),ut){ut.classList.add("esri-view");const Gt=document.createElement("div");Gt.className="esri-view-user-storage",(0,A.YD)(ut,Gt),ut.appendChild(Gt),this._set("userContent",Gt);const ar=document.createElement("div");ar.className="esri-view-root",ut.insertBefore(ar,ut.firstChild),this._set("root",ar);const Ve=document.createElement("div");Ve.className="esri-view-surface",Ve.setAttribute("role","application"),Ve.tabIndex=0,ar.appendChild(Ve),this._set("surface",Ve);const gt=new Y;ar.appendChild(gt.surface),this._set("overlay",gt),(0,G.YP)(()=>gt.needsRender,Pt=>{Pt&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=(0,Q.A)({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)}),this.forceDOMReadyCycle(),this.handles.add((0,G.YP)(()=>this.size,Pt=>{const[Yt,Jr]=Pt,Mi="esri-view-surface--inset-outline";Yt>=document.body.clientWidth||Jr>=document.body.clientHeight?Ve.classList.add(Mi):Ve.classList.remove(Mi)},G.nn),xt),this._set("container",ut),this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}get focused(){const ut=document.activeElement===this.surface;return document.hasFocus()&&ut}get popup(){return this._get("popup")||new yp({view:this})}set popup(ut){const Et=this._get("popup");Et&&Et!==ut&&Et.destroy(),this._set("popup",ut)}get size(){return[this.width,this.height]}blur(){this.surface&&this.surface.blur()}focus(){this.surface&&this.surface.focus()}pageToContainer(ut,Et,xt){const Gt=this.position;return ut-=Gt[0],Et-=Gt[1],xt?(xt[0]=ut,xt[1]=Et):xt=[ut,Et],xt}containerToPage(ut,Et,xt){const Gt=this.position;return ut+=Gt[0],Et+=Gt[1],xt?(xt[0]=ut,xt[1]=Et):xt=[ut,Et],xt}_handleUIChange(ut,Et){Et&&(this.handles.remove("ui"),Et.destroy()),ut&&this._wireUI(ut),this._set("ui",ut)}_wireUI(ut){this.handles.remove("ui"),ut&&(ut.view=this,this.handles.add([(0,G.YP)(()=>this.root,Et=>{ut.container=Et?function Ia(Le){const Qe=document.createElement("div");return Le.appendChild(Qe),Qe}(Et):null},G.nn),(0,G.YP)(()=>this.popup,(Et,xt)=>{xt&&ut.remove(xt,"popup"),Et&&(Et.view=ut.view,ut.add(Et,{key:"popup",position:"manual"}))},G.nn)],"ui"))}_stopMeasuring(){this.handles.remove("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const ut=this._freqInfo;ut.freq=16,ut.time=750,this.handles.add([(()=>{const Et=()=>{ut.freq=16,ut.time=750};return window.addEventListener("resize",Et),{remove(){window.removeEventListener("resize",Et)}}})(),(0,Q.A)({prepare:Et=>{const xt=this._measure(),Gt=this._freqInfo;if(Gt.time+=Et.deltaTime,xt&&(Gt.freq=16,this._get("resizing")||this._set("resizing",!0)),Gt.time<Gt.freq)return;Gt.time=0;const ar=this._position();Gt.freq=ar||xt?16:Math.min(750,2*Gt.freq),!xt&&Gt.freq>=512&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const ut=this.container,Et=ut?ut.clientWidth:0,xt=ut?ut.clientHeight:0;if(0===Et||0===xt)return this.suspended||this._set("suspended",!0),!1;const Gt=this.width,ar=this.height;return Et===Gt&&xt===ar?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",Et),this._set("height",xt),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:Gt,oldHeight:ar,width:Et,height:xt}),!0)}_position(){const Et=this.position,xt=function oa(Le){const Qe=(Le.ownerDocument||window.document).defaultView,ut=Le.getBoundingClientRect();return wa[0]=ut.left+Qe.pageXOffset,wa[1]=ut.top+Qe.pageYOffset,wa}(this.container);return!(Et&&xt[0]===Et[0]&&xt[1]===Et[1]||(this._set("position",[xt[0],xt[1]]),0))}forceDOMReadyCycle(){}};return(0,x._)([(0,H.Cb)({value:null,cast:ut=>(0,A.L7)(ut)})],Qe.prototype,"container",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"focused",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"height",void 0),(0,x._)([(0,H.Cb)({type:yp})],Qe.prototype,"popup",null),(0,x._)([(0,H.Cb)({type:Y})],Qe.prototype,"overlay",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"position",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"resizing",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"root",void 0),(0,x._)([(0,H.Cb)({value:null,readOnly:!0})],Qe.prototype,"size",null),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"surface",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"suspended",void 0),(0,x._)([(0,H.Cb)()],Qe.prototype,"ui",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"userContent",void 0),(0,x._)([(0,H.Cb)({readOnly:!0})],Qe.prototype,"width",void 0),(0,x._)([(0,H.Cb)()],Qe.prototype,"widthBreakpoint",void 0),Qe=(0,x._)([(0,B.j)("esri.views.DOMContainer")],Qe),Qe};function bi(Le){return Le&&"focus"in Le}},59617:(dt,Re,T)=>{"use strict";var x,Q;function A(Q){return"global"===Q?x.Global:x.Local}function G(Q){return Q===x.Global?"global":"local"}T.d(Re,{JY:()=>x,M7:()=>G,wg:()=>A}),(Q=x||(x={}))[Q.Global=1]="Global",Q[Q.Local=2]="Local"},10228:(dt,Re,T)=>{"use strict";T.d(Re,{j:()=>G,p:()=>A});var x=T(62208);function A(Q,H,re){if(!H||!Q||!Q.map)return;const{map:J}=Q,W=J.layers.find(B=>B===H);W||J.add(H,re),null!=re&&J.layers.reorder(W,re)}function G(Q,H){return Q.allLayerViews.find(re=>{const J=re.layer;return J===H||"sublayers"in J&&(0,x.pC)(J.sublayers)&&J.sublayers.includes(H)})}},85112:(dt,Re,T)=>{"use strict";var x,A;T.d(Re,{t:()=>x}),(A=x||(x={}))[A.Left=0]="Left",A[A.Middle=1]="Middle",A[A.Right=2]="Right"},35216:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>Q});var x=T(63290);class A{constructor(W,B=[]){this.eventType=W,this.keyModifiers=B}matches(W){if(W.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;const B=W.modifiers;for(const Z of this.keyModifiers)if(!B.has(Z))return!1;return!0}}const G=x.Z.getLogger("esri.views.input.InputHandler");class Q{constructor(W){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=W}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const W in this._incoming){const B=this._incoming[W];for(const Z of B)this._incomingEventMatches.push(Z.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(W=>W.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(W){this._manager?G.error("This InputHandler has already been registered with an InputManager"):(W.setEventCallback(B=>this._handleEvent(B)),W.setUninstallCallback(()=>this._onUninstall()),this._manager=W)}onUninstall(){}registerIncoming(W,B,Z){let ie;"function"==typeof B?(Z=B,ie=[]):ie=B||[];const ue="string"==typeof W?new A(W,ie):W,ce=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},oe=j=>{const X=this._incoming[j.match.eventType];if(X){const U=X.indexOf(j);X.splice(U,1),ce(),this._manager&&this._manager.updateDependencies()}},le=new H(ue,Z,{onPause:oe,onRemove:oe,onResume:j=>{const X=this._incoming[j.match.eventType];X&&!X.includes(j)&&(X.push(j),ce(),this._manager&&this._manager.updateDependencies())}});let Y=this._incoming[ue.eventType];return Y||(Y=[],this._incoming[ue.eventType]=Y),Y.push(le),ce(),this._manager&&this._manager.updateDependencies(),le}registerOutgoing(W){if(this._outgoing[W])throw Error("There is already a callback registered for this outgoing InputEvent: "+W);const B=new re(W,{onEmit:(Z,ie,ue,ce)=>{this._manager.emit(Z.eventType,ie,ue,ce)},onRemove:Z=>{delete this._outgoing[Z.eventType],this._manager.updateDependencies()}});return this._outgoing[W]=B,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),B}startCapturingPointer(W){this._manager.setPointerCapture(W,!0)}stopCapturingPointer(W){this._manager.setPointerCapture(W,!1)}refreshHasPendingInputs(){this._manager.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):G.error("This InputHandler is not registered with an InputManager")}_handleEvent(W){const B=this._incoming[W.type];if(B)for(const Z of B)if(Z.match.matches(W)&&(Z.callback(W),W.shouldStopPropagation()))break}}class H{constructor(W,B,Z){this.match=W,this._callback=B,this._handler=Z}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}}class re{constructor(W,B){this.eventType=W,this._removed=!1,this._handler=B}emit(W,B,Z){this._removed||this._handler.onEmit(this,W,B,Z)}remove(){this._removed=!0,this._handler.onRemove(this)}}},56846:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>Y,f:()=>U});var x=T(17626),A=T(14517),G=T(63290),Q=T(62208),H=T(35133),re=T(77712),Z=(T(85931),T(8314),T(90912),T(76898)),ie=T(63416),ue=T(25441),ce=T(35216);class oe extends ce.a{constructor(ne){super(!0),this._onChange=ne,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",se=>{this._setValue("touch"===se.data.native.pointerType?"touch":"mouse",se.data.x,se.data.y)})}_setValue(ne,se,ae){ne===this._value&&this._x===se&&this._y===ae||(this._value=ne,this._x=se,this._y=ae,this._onChange(ne,se,ae))}}const le=G.Z.getLogger("esri.views.input.InputManager");let Y=class extends A.Z{constructor($){super($),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=ue.CK,this.latestPointerType="mouse",this._propertiesPool=new ie.L({latestPointerLocation:ee},this),this.latestPointerLocation=null,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const $=Object.keys(this._nameToGroup);for(const ne of $)this.uninstallHandlers(ne);this.eventSource=null,this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some($=>$.handler.hasPendingInputs)}installHandlers($,ne,se=U.INTERNAL){if(this._nameToGroup[$])return void le.error("There is already an InputHandler group registered under the name `"+$+"`");if(0===ne.length)return void le.error("Can't register a group of zero handlers");const ae={name:$,handlers:ne.map(de=>({handler:de,active:!0,removed:!1,priorityIndex:0,groupPriority:se,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[$]=ae;for(let de=ae.handlers.length-1;de>=0;de--){const _e=ae.handlers[de];this._handlers.push(_e),_e.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(pe,he,ge,ye,Me)=>{this._emitInputEvent(_e.priorityIndex+1,pe,he,ge,Me,ye)},setPointerCapture:(pe,he)=>{this._setPointerCapture(ae,_e,pe,he)},setEventCallback:pe=>{_e.eventCallback=pe},setUninstallCallback:pe=>{_e.uninstallCallback=pe},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers($){const ne=this._nameToGroup[$];ne?(ne.handlers.forEach(se=>{se.removed=!0,se.uninstallCallback()}),delete this._nameToGroup[$],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):le.error("There is no InputHandler group registered under the name `"+$+"`")}hasHandlers($){return void 0!==this._nameToGroup[$]}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const $=new Set,ne=new Set;this._handlersPriority=[];for(let se=this._handlers.length-1;se>=0;se--){const ae=this._handlers[se];ae.priorityIndex=se,this._handlersPriority.push(ae)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let se=this._handlersPriority.length-1;se>=0;se--){const ae=this._handlersPriority[se];ae.priorityIndex=se;let de=ae.handler.hasSideEffects;if(!de)for(const _e of ae.handler.outgoingEventTypes)if($.has(_e)){de=!0;break}if(de)for(const _e of ae.handler.incomingEventMatches){$.add(_e.eventType);for(const pe of _e.keyModifiers)(0,ue.wj)(pe)||ne.add(pe)}ae.active=de}this._sourceEvents=$,this._keyModifiers=ne,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer($,ne,se){this._get("latestPointerType")!==$&&this._set("latestPointerType",$);const ae=this._get("latestPointerLocation");if((0,Q.Wi)(ae)||ae.x!==ne||ae.y!==se){const de=this._propertiesPool.get("latestPointerLocation");de.x=ne,de.y=se,this._set("latestPointerLocation",de)}}_onEventReceived($,ne){"pointer-capture-lost"===$&&this._pointerCaptures.delete(ne.native.pointerId),this._updateKeyModifiers($,ne),this._emitInputEventFromSource($,ne,null!=this.test.timestamp?this.test.timestamp:ne.native?ne.native.timestamp:void 0,ne.native?ne.native.cancelable:void 0)}_updateKeyModifiers($,ne){if(!ne)return;let se=!1;const ae=()=>{if(!se){const pe=new Set;this._activeKeyModifiers.forEach(he=>{pe.add(he)}),this._activeKeyModifiers=pe,se=!0}},de=(pe,he)=>{he&&!this._activeKeyModifiers.has(pe)?(ae(),this._activeKeyModifiers.add(pe)):!he&&this._activeKeyModifiers.has(pe)&&(ae(),this._activeKeyModifiers.delete(pe))};if("key-down"===$||"key-up"===$){const pe=ne.key;this._keyModifiers.has(pe)&&de(pe,"key-down"===$)}const _e=ne.native;de("Alt",!(!_e||!_e.altKey)),de("Ctrl",!(!_e||!_e.ctrlKey)),de("Shift",!(!_e||!_e.shiftKey)),de("Meta",!(!_e||!_e.metaKey)),de("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new oe(($,ne,se)=>this._setLatestPointer($,ne,se)),this.installHandlers("input-manager-logic",[this._latestPointerHandler],U.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,U.INTERNAL)}_setPointerCapture($,ne,se,ae){const de=$.name+"-"+ne.priorityIndex,_e=this._pointerCaptures.get(se.pointerId)||new Set;this._pointerCaptures.set(se.pointerId,_e),ae?(_e.add(de),1===_e.size&&this.eventSource&&this.eventSource.setPointerCapture(se,!0)):_e.has(de)&&(_e.delete(de),0===_e.size&&(this._pointerCaptures.delete(se.pointerId),this.eventSource&&this.eventSource.setPointerCapture(se,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter($=>!$.removed),this.updateDependencies()}_emitInputEventFromSource($,ne,se,ae){this._emitInputEvent(0,$,ne,se,ae)}_emitInputEvent($,ne,se,ae,de,_e){const pe=void 0!==ae?ae:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),ge={event:new j(ne,se,pe,_e||this._activeKeyModifiers,void 0!==de&&de),priorityIndex:$};this._currentPropagation?this._currentPropagation.events.push(ge):this._doNewPropagation(ge)}_doNewPropagation($){this._currentPropagation={events:new H.Z,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:$.event.timestamp},this._currentPropagation.events.push($),this._continuePropagation()}_continuePropagation(){const $=this._currentPropagation;if($){for(;this._currentPropagation.events.length>0;){const{event:ne,priorityIndex:se}=this._currentPropagation.events.pop(),ae=ne.data&&ne.data.eventId;if(null==ae||!this._stoppedPropagationEventIds.has(ae))for($.currentHandler=this._handlersPriority[se];$.currentHandler;){if($.currentHandler.removed)$.needsHandlerGarbageCollect=!0;else{if($.currentHandler.active&&!ne.shouldStopPropagation()&&$.currentHandler.eventCallback(ne),ne.shouldStopPropagation()){null!=ae&&this._stoppedPropagationEventIds.add(ae);break}if(ne.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:ne,priorityIndex:$.currentHandler.priorityIndex+1})}$.currentHandler=this._handlersPriority[$.currentHandler.priorityIndex+1]}}$.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation($){const ne=new H.Z;for(ne.push($);this._currentPropagation.events.length;)ne.push(this._currentPropagation.events.pop());this._currentPropagation.events=ne,this._currentPropagation.currentHandler=null}_compareHandlerPriority($,ne){if($.handler.hasSideEffects!==ne.handler.hasSideEffects)return $.handler.hasSideEffects?1:-1;if($.groupPriority!==ne.groupPriority)return $.groupPriority>ne.groupPriority?-1:1;for(const se of $.handler.incomingEventMatches)for(const ae of ne.handler.incomingEventMatches){if(se.eventType!==ae.eventType)continue;const de=se.keyModifiers.filter(_e=>ae.keyModifiers.includes(_e));if(de.length===se.keyModifiers.length!=(de.length===ae.keyModifiers.length))return se.keyModifiers.length>ae.keyModifiers.length?-1:1}return $.priorityIndex>ne.priorityIndex?-1:1}_sortHandlersPriority($){const ne=[];for(const se of $){let ae=0;for(;ae<ne.length&&this._compareHandlerPriority(se,ne[ae])>=0;)ae++;ne.splice(ae,0,se)}return ne}get debug(){const $=ne=>{const se=this._setPointerCapture;this._setPointerCapture=()=>{},ne(),this._setPointerCapture=se};return{injectEvent:(ne,se)=>{$(()=>{this._onEventReceived(ne,se)})},disablePointerCapture:$}}};(0,x._)([(0,re.Cb)({readOnly:!0})],Y.prototype,"hasPendingInputs",null),(0,x._)([(0,re.Cb)()],Y.prototype,"eventSource",void 0),(0,x._)([(0,re.Cb)()],Y.prototype,"recognizers",void 0),(0,x._)([(0,re.Cb)({readOnly:!0})],Y.prototype,"latestPointerType",void 0),(0,x._)([(0,re.Cb)({readOnly:!0})],Y.prototype,"latestPointerLocation",void 0),Y=(0,x._)([(0,Z.j)("esri.views.input.InputManager")],Y);class j{constructor(ne,se,ae,de,_e){this.type=ne,this.data=se,this.timestamp=ae,this.modifiers=de,this.cancelable=_e,this._propagationState=X.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=X.STOPPED}shouldStopPropagation(){return 0!=(this._propagationState&X.STOPPED)}async(ne){this._propagationState|=X.PAUSED;const se=(ae,de)=>{this._propagationState&=~X.PAUSED;const _e=this._resumeCallback;if(this._resumeCallback=null,_e&&_e(),de)throw ae;return ae};return("function"==typeof ne?ne():ne).then(ae=>se(ae,!1),ae=>se(ae,!0))}shouldPausePropagation(ne){return!!(this._propagationState&X.PAUSED)&&(this._resumeCallback=ne,!0)}preventDefault(){this.data.native.preventDefault()}}var X,$;($=X||(X={}))[$.NONE=0]="NONE",$[$.STOPPED=1]="STOPPED",$[$.PAUSED=2]="PAUSED";const U={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class ee{}},45458:(dt,Re,T)=>{"use strict";T.d(Re,{CE:()=>ie,uS:()=>J}),T(8314);var A=T(21286),G=T(23841),Q=T(35216),H=T(56846);T(85112);const J=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],W={};function B(ce){return!!W[ce]}J.forEach(ce=>{W[ce]=!0});class ie{constructor(oe){this.handlers=new Map,this.counter=0,this.handlerCounts=new Map,this.view=oe,this.inputManager=null}connect(oe){oe&&this.disconnect(),this.inputManager=oe,this.handlers.forEach(({handler:le,priority:Y},j)=>this.inputManager.installHandlers(j,[le],Y))}disconnect(){this.inputManager&&this.handlers.forEach((oe,le)=>this.inputManager.uninstallHandlers(le)),this.inputManager=null}destroy(){this.disconnect(),this.handlers.clear(),this.view=null}on(oe,le,Y,j){const X=Array.isArray(oe)?oe:oe.split(",");if(!function Z(ce){for(const oe of ce)if(!B(oe))return!1;return!0}(X))return X.some(B)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let U,ee;Array.isArray(le)?ee=le:(U=le,ee=[]),"function"==typeof Y?U=Y:j=Y,j=null!=j?j:H.f.DEFAULT;const $=this._createUniqueGroupName(),ne=new ue(this.view,X,ee,U);this.handlers.set($,{handler:ne,priority:j});for(const se of X){const ae=this.handlerCounts.get(se)||0;this.handlerCounts.set(se,ae+1)}return this.inputManager&&this.inputManager.installHandlers($,[ne],j),{remove:()=>this._removeHandler($,X)}}hasHandler(oe){return!!this.handlerCounts.get(oe)}_removeHandler(oe,le){if(this.handlers.has(oe)){this.handlers.delete(oe);for(const Y of le){const j=this.handlerCounts.get(Y);void 0===j?console.error("Trying to remove handler for event that has no handlers registered: ",Y):1===j?this.handlerCounts.delete(Y):this.handlerCounts.set(Y,j-1)}}this.inputManager&&this.inputManager.uninstallHandlers(oe)}_createUniqueGroupName(){return this.counter+=1,`viewEvents_${this.counter}`}}class ue extends Q.a{constructor(oe,le,Y,j){super(!0),this.view=oe;for(const X of le)switch(X){case"click":this.registerIncoming("click",Y,U=>j(this._wrapClick(U)));break;case"double-click":this.registerIncoming("double-click",Y,U=>j(this._wrapDoubleClick(U)));break;case"immediate-click":this.registerIncoming("immediate-click",Y,U=>j(this._wrapImmediateClick(U)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",Y,U=>j(this._wrapImmediateDoubleClick(U)));break;case"hold":this.registerIncoming("hold",Y,U=>j(this._wrapHold(U)));break;case"drag":this.registerIncoming("drag",Y,U=>{const ee=this._wrapDrag(U);ee&&j(ee)});break;case"key-down":this.registerIncoming("key-down",Y,U=>j(this._wrapKeyDown(U)));break;case"key-up":this.registerIncoming("key-up",Y,U=>j(this._wrapKeyUp(U)));break;case"pointer-down":this.registerIncoming("pointer-down",Y,U=>j(this._wrapPointer(U,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",Y,U=>j(this._wrapPointer(U,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",Y,U=>j(this._wrapPointer(U,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",Y,U=>j(this._wrapPointerDrag(U)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",Y,U=>j(this._wrapMouseWheel(U)));break;case"pointer-enter":this.registerIncoming("pointer-enter",Y,U=>j(this._wrapPointer(U,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",Y,U=>j(this._wrapPointer(U,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",Y,U=>{j(this._wrapGamepad(U))});break;case"focus":this.registerIncoming("focus",Y,U=>{j(this._wrapFocus(U))});break;case"blur":this.registerIncoming("blur",Y,U=>{j(this._wrapBlur(U))})}}_wrapFocus(oe){return{type:"focus",timestamp:oe.timestamp,native:oe.data.native,cancelable:oe.cancelable,stopPropagation:()=>oe.stopPropagation(),async:le=>oe.async(le),preventDefault:()=>oe.preventDefault()}}_wrapBlur(oe){return{type:"blur",timestamp:oe.timestamp,native:oe.data.native,cancelable:oe.cancelable,stopPropagation:()=>oe.stopPropagation(),async:le=>oe.async(le),preventDefault:()=>oe.preventDefault()}}_wrapClick(oe){const{pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,eventId:$}=oe.data,{cancelable:ne,timestamp:se}=oe;return{type:"click",pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,timestamp:se,screenPoint:(0,G.vW)(X,U),mapPoint:this._getMapPoint(X,U),eventId:$,cancelable:ne,stopPropagation:()=>oe.stopPropagation(),async:ae=>oe.async(ae),preventDefault:()=>oe.preventDefault()}}_wrapDoubleClick(oe){const{pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,eventId:$}=oe.data,{cancelable:ne,timestamp:se}=oe;return{type:"double-click",pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,timestamp:se,mapPoint:this._getMapPoint(X,U),eventId:$,cancelable:ne,stopPropagation:()=>oe.stopPropagation(),async:ae=>oe.async(ae),preventDefault:()=>oe.preventDefault()}}_wrapImmediateClick(oe){const{pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,eventId:$}=oe.data,ne=ee.pointerId,{cancelable:se,timestamp:ae}=oe;return{type:"immediate-click",pointerId:ne,pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,timestamp:ae,mapPoint:this._getMapPoint(X,U),eventId:$,cancelable:se,stopPropagation:()=>oe.stopPropagation(),async:de=>oe.async(de),preventDefault:()=>oe.preventDefault()}}_wrapImmediateDoubleClick(oe){const{pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,eventId:$}=oe.data,ne=ee.pointerId,{cancelable:se,timestamp:ae}=oe;return{type:"immediate-double-click",pointerId:ne,pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,timestamp:ae,mapPoint:this._getMapPoint(X,U),eventId:$,cancelable:se,stopPropagation:()=>oe.stopPropagation(),async:de=>oe.async(de),preventDefault:()=>oe.preventDefault()}}_wrapHold(oe){const{pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee}=oe.data,{cancelable:$,timestamp:ne}=oe;return{type:"hold",pointerType:le,button:Y,buttons:j,x:X,y:U,native:ee,timestamp:ne,mapPoint:this._getMapPoint(X,U),cancelable:$,stopPropagation:()=>oe.stopPropagation(),async:se=>oe.async(se),preventDefault:()=>oe.preventDefault()}}_getMapPoint(oe,le){return this.view.toMap((0,G.vW)(oe,le),{exclude:[]})}_wrapDrag(oe){const le=oe.data,{x:Y,y:j}=le.center,{action:X,pointerType:U,button:ee}=le;if("start"===X&&(this.latestDragStart=le),!this.latestDragStart)return;const $=le.pointer.native,ne=le.buttons,{cancelable:se,timestamp:ae}=oe,de={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};return"end"===X&&(this.latestDragStart=void 0),{type:"drag",action:X,x:Y,y:j,origin:de,pointerType:U,button:ee,buttons:ne,radius:le.radius,angle:(0,A.BV)(le.angle),native:$,timestamp:ae,cancelable:se,stopPropagation:()=>oe.stopPropagation(),async:_e=>oe.async(_e),preventDefault:()=>oe.preventDefault()}}_wrapKeyDown(oe){const{key:le,repeat:Y,native:j}=oe.data,{cancelable:X,timestamp:U}=oe;return{type:"key-down",key:le,repeat:Y,native:j,timestamp:U,cancelable:X,stopPropagation:()=>oe.stopPropagation(),async:ee=>oe.async(ee),preventDefault:()=>oe.preventDefault()}}_wrapKeyUp(oe){const{key:le,native:Y}=oe.data,{cancelable:j,timestamp:X}=oe;return{type:"key-up",key:le,native:Y,timestamp:X,cancelable:j,stopPropagation:()=>oe.stopPropagation(),async:U=>oe.async(U),preventDefault:()=>oe.preventDefault()}}_wrapPointer(oe,le){const{x:Y,y:j,button:X,buttons:U,native:ee,eventId:$}=oe.data,ne=ee.pointerId,se=ee.pointerType,{cancelable:ae,timestamp:de}=oe;return{type:le,x:Y,y:j,pointerId:ne,pointerType:se,button:X,buttons:U,native:ee,timestamp:de,eventId:$,cancelable:ae,stopPropagation:()=>oe.stopPropagation(),async:_e=>oe.async(_e),preventDefault:()=>oe.preventDefault()}}_wrapPointerDrag(oe){const{x:le,y:Y,buttons:j,native:X,eventId:U}=oe.data.currentEvent,{button:ee}=oe.data.startEvent,$=oe.data.startEvent.native.pointerId,ne=oe.data.startEvent.native.pointerType,se=oe.data.action,ae={x:oe.data.startEvent.x,y:oe.data.startEvent.y},{cancelable:de,timestamp:_e}=oe;return{type:"pointer-drag",x:le,y:Y,pointerId:$,pointerType:ne,button:ee,buttons:j,action:se,origin:ae,native:X,timestamp:_e,eventId:U,cancelable:de,stopPropagation:()=>oe.stopPropagation(),async:pe=>oe.async(pe),preventDefault:()=>oe.preventDefault()}}_wrapMouseWheel(oe){const{cancelable:le,data:Y,timestamp:j}=oe,{x:X,y:U,deltaY:ee,native:$}=Y;return{type:"mouse-wheel",x:X,y:U,deltaY:ee,native:$,timestamp:j,cancelable:le,stopPropagation:()=>oe.stopPropagation(),async:ne=>oe.async(ne),preventDefault:()=>oe.preventDefault()}}_wrapGamepad(oe){const{action:le,state:Y,device:j}=oe.data,{cancelable:X,timestamp:U}=oe,{buttons:ee,axes:$}=Y;return{type:"gamepad",device:j,timestamp:U,action:le,buttons:ee,axes:$,cancelable:X,stopPropagation:()=>oe.stopPropagation(),async:ne=>oe.async(ne),preventDefault:()=>oe.preventDefault()}}}},25441:(dt,Re,T)=>{"use strict";T.d(Re,{CK:()=>G,kK:()=>H,wj:()=>re});var x=T(17770);const G=(0,T(8314).Z)("mac")?"Meta":"Ctrl",Q={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let J=48;J<58;J++)Q[J]=String.fromCharCode(J);for(let J=1;J<25;J++)Q[111+J]=`F${J}`;for(let J=65;J<91;J++)Q[J]=[String.fromCharCode(J+32),String.fromCharCode(J)];function H(J){if(void 0!==J.key)return(0,x.kK)(J);const W=Q[J.keyCode];return Array.isArray(W)?J.shiftKey?W[1]:W[0]:W}function re(J){switch(J){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}},33786:(dt,Re,T)=>{"use strict";var x,A,G,Q;T.d(Re,{Q9:()=>A,bH:()=>x,jg:()=>G}),(Q=x||(x={}))[Q.USER=0]="USER",Q[Q.MANAGER=1]="MANAGER",function(Q){Q[Q.None=0]="None",Q[Q.Unfocused=1]="Unfocused",Q[Q.Focused=2]="Focused",Q[Q.Unselected=4]="Unselected",Q[Q.Selected=8]="Selected",Q[Q.All=15]="All"}(A||(A={})),function(Q){Q[Q.None=0]="None",Q[Q.Custom1=16]="Custom1",Q[Q.Custom2=32]="Custom2",Q[Q.Custom3=64]="Custom3",Q[Q.Custom4=128]="Custom4",Q[Q.Custom5=256]="Custom5",Q[Q.Custom6=512]="Custom6",Q[Q.Custom7=1024]="Custom7",Q[Q.Custom8=2048]="Custom8",Q[Q.Custom9=4096]="Custom9",Q[Q.Custom10=8192]="Custom10",Q[Q.Custom11=16384]="Custom11",Q[Q.Custom12=32768]="Custom12",Q[Q.All=65520]="All"}(G||(G={}))},72791:(dt,Re,T)=>{"use strict";T.d(Re,{j:()=>x});const x={redo:"r",undo:"z",center:"Alt",constraint:"Shift",snappingToggle:"Control",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "}},24959:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.Z{constructor(Z){super(Z),this.enabled=!1}};(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],W.prototype,"enabled",void 0),W=(0,x._)([(0,J.j)("esri.views.interactive.sketch.SketchLabelOptions")],W);const B=W},94309:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ie});var x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.Z{constructor(ue){super(ue),this.mode="absolute-height"}};(0,x._)([(0,G.Cb)({type:String,nonNullable:!0})],W.prototype,"mode",void 0),W=(0,x._)([(0,J.j)("esri.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],W);let B=class extends A.Z{constructor(){super(...arguments),this.distance=!0,this.elevation=!0,this.size=!0,this.scale=!0,this.rotation=!0,this.orientation=!0,this.totalLength=!0,this.area=!0,this.radius=!0}};(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"distance",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"elevation",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"size",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"scale",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"rotation",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"orientation",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"totalLength",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"area",void 0),(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],B.prototype,"radius",void 0),B=(0,x._)([(0,J.j)("esri.widgets.Sketch.SketchTooltipOptions.VisibleElements")],B);let Z=class extends A.Z{constructor(ue){super(ue),this.enabled=!1,this.elevation=new W,this.visibleElements=new B,this.visualVariables=null}};(0,x._)([(0,G.Cb)({type:Boolean,nonNullable:!0})],Z.prototype,"enabled",void 0),(0,x._)([(0,G.Cb)({type:W,nonNullable:!0})],Z.prototype,"elevation",void 0),(0,x._)([(0,G.Cb)({type:B,nonNullable:!0})],Z.prototype,"visibleElements",void 0),(0,x._)([(0,G.Cb)()],Z.prototype,"visualVariables",void 0),Z=(0,x._)([(0,J.j)("esri.widgets.Sketch.SketchTooltipOptions")],Z);const ie=Z},14380:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.Z{constructor(Z){super(Z),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,x._)([(0,G.Cb)({constructOnly:!0})],W.prototype,"layer",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"enabled",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"updating",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"availability",void 0),W=(0,x._)([(0,J.j)("esri.views.interactive.snapping.SnappingLayerSource")],W);const B=W},36460:(dt,Re,T)=>{"use strict";T.d(Re,{c:()=>W});var x=T(17626),A=T(91558),G=T(86810),Q=T(77712),H=T(76898);let re=class extends G.wq{constructor(){super(...arguments),this.enabled=!0}};(0,x._)([(0,Q.Cb)({type:Boolean})],re.prototype,"enabled",void 0),re=(0,x._)([(0,H.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],re);let J=class extends G.wq{constructor(B){super(B),this.lineSnapper=new re,this.parallelLineSnapper=new re,this.rightAngleSnapper=new re,this.rightAngleTriangleSnapper=new re,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new A.Z([255,127,0]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5}};(0,x._)([(0,Q.Cb)({type:re,constructOnly:!0,nonNullable:!0,json:{write:!0}})],J.prototype,"lineSnapper",void 0),(0,x._)([(0,Q.Cb)({type:re,constructOnly:!0,nonNullable:!0,json:{write:!0}})],J.prototype,"parallelLineSnapper",void 0),(0,x._)([(0,Q.Cb)({type:re,constructOnly:!0,nonNullable:!0,json:{write:!0}})],J.prototype,"rightAngleSnapper",void 0),(0,x._)([(0,Q.Cb)({type:re,constructOnly:!0,nonNullable:!0,json:{write:!0}})],J.prototype,"rightAngleTriangleSnapper",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],J.prototype,"shortLineThreshold",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],J.prototype,"distance",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],J.prototype,"pointThreshold",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],J.prototype,"intersectionParallelLineThreshold",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],J.prototype,"parallelLineThreshold",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],J.prototype,"touchSensitivityMultiplier",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],J.prototype,"pointOnLineThreshold",void 0),(0,x._)([(0,Q.Cb)({type:A.Z,nonNullable:!0})],J.prototype,"orange",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],J.prototype,"lineHintWidthReference",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],J.prototype,"lineHintWidthTarget",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],J.prototype,"lineHintFadedExtensions",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],J.prototype,"parallelLineHintWidth",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],J.prototype,"parallelLineHintLength",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],J.prototype,"parallelLineHintOffset",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],J.prototype,"rightAngleHintSize",void 0),(0,x._)([(0,Q.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],J.prototype,"rightAngleHintOutlineSize",void 0),J=(0,x._)([(0,H.j)("esri.views.interactive.snapping.Settings.Defaults")],J);const W=new J},33351:(dt,Re,T)=>{"use strict";T.d(Re,{Bq:()=>ie,Hk:()=>J,UL:()=>ue,ku:()=>Z,yG:()=>B});var x=T(67831),A=T(99770),G=T(36460),Q=T(44725),H=T(396);class re{constructor(oe){this.coordinateHelper=oe}}class J extends re{constructor(oe,le){super(oe),this.point=le}objectEqual(oe){return oe instanceof J&&(0,Q.Xv)(this.point,oe.point)}check(oe){return(0,x.s)(oe,this.point)<G.c.pointThreshold}closestTo(){return this.coordinateHelper.clone(this.point)}intersect(oe){const le=[];return oe instanceof W?le.push(...(0,H.pk)({start:oe.start,end:oe.end,type:oe instanceof Z?H.SP.LINE:H.SP.RAY},this.point)):oe instanceof ue&&le.push(...(0,H.l0)(oe.center,oe.radius,this.point)),le.map(Y=>new ie(this.coordinateHelper,Y,this,oe))}}class W extends re{constructor(oe,le,Y){super(oe),this.start=le,this.end=Y}objectEqual(oe){return oe instanceof W&&(0,Q.Xv)(this.start,oe.start)&&(0,Q.Xv)(this.end,oe.end)}intersect(oe){const le=[];return oe instanceof J?le.push(...(0,H.pk)({start:this.start,end:this.end,type:this instanceof Z?H.SP.LINE:H.SP.RAY},oe.point)):oe instanceof W?le.push(...(0,H.dU)({start:this.start,end:this.end,type:this instanceof Z?H.SP.LINE:H.SP.RAY},{start:oe.start,end:oe.end,type:oe instanceof Z?H.SP.LINE:H.SP.RAY})):oe instanceof ue&&le.push(...(0,H.UG)({start:this.start,end:this.end,type:this instanceof Z?H.SP.LINE:H.SP.RAY},oe.center,oe.radius)),le.map(Y=>new ie(this.coordinateHelper,Y,this,oe))}}class B extends W{constructor(oe,le,Y){super(oe,le,Y),this.dir=(0,A.a)(),this.p=(0,A.a)()}objectEqual(oe){return oe instanceof B&&super.objectEqual(oe)}check(oe){return(0,x.g)(this.dir,this.end,this.start),(0,x.g)(this.p,oe,this.start),(0,x.h)(this.dir,this.p)>=0&&(0,H.Oy)(oe,this.start,this.end)<G.c.pointOnLineThreshold}closestTo(oe){const le=this.coordinateHelper.clone(oe);return(0,H.aW)(le,oe,this.start,this.end),le}}class Z extends W{constructor(oe,le,Y){super(oe,le,Y)}objectEqual(oe){return oe instanceof Z&&super.objectEqual(oe)}check(oe){return(0,H.Oy)(oe,this.start,this.end)<G.c.pointOnLineThreshold}closestTo(oe){const le=this.coordinateHelper.clone(oe);return(0,H.k0)(le,oe,this.start,this.end),le}}class ie extends re{constructor(oe,le,Y,j){super(oe),this.intersection=le,this.first=Y,this.second=j}objectEqual(oe){return oe instanceof ie&&this.first.objectEqual(oe.first)&&this.second.objectEqual(oe.second)}check(){return!1}closestTo(oe){const le=this.coordinateHelper.clone(oe);return(0,x.c)(le,this.intersection),le}intersect(){return[]}}class ue extends re{constructor(oe,le,Y){super(oe),this.center=le,this.radius=Y}objectEqual(oe){return oe instanceof ue&&this.center[0]===oe.center[0]&&this.center[1]===oe.center[1]&&this.radius===oe.radius}check(){return!1}closestTo(oe){const le=this.coordinateHelper.clone(oe);return(0,H.xO)(le,oe,this.center,this.radius),le}intersect(oe){const le=[];return oe instanceof W?le.push(...(0,H.UG)({start:oe.start,end:oe.end,type:oe instanceof Z?H.SP.LINE:H.SP.RAY},this.center,this.radius)):oe instanceof J&&le.push(...(0,H.l0)(this.center,this.radius,oe.point)),le.map(Y=>new ie(this.coordinateHelper,Y,this,oe))}}},45390:(dt,Re,T)=>{"use strict";T.d(Re,{N:()=>be});var _e,Ye,x=T(15861),A=T(17626),G=T(61885),Q=T(80542),H=T(62208),re=T(10699),J=T(32917),W=T(77712),ue=(T(85931),T(8314),T(90912),T(76898)),ce=T(67831),oe=T(72392),le=T(88159),Y=T(28093),j=T(83308),X=T(33351),U=T(44725),ee=T(75897),$=T(97979),ne=T(22823),se=T(62160),ae=T(86842);class de extends ne.j{constructor({coordinateHelper:ze,targetPoint:et,constraint:ke,previousVertex:ot,otherVertex:at,otherVertexType:yt,objectId:wt,elevationInfo:zt}){super(ze,et,ke,zt),this.previousVertex=ot,this.otherVertex=at,this.otherVertexType=yt,this.objectId=wt}get hints(){const ze=this.previousVertex,et=this.otherVertexType===_e.CENTER?this.otherVertex:this.targetPoint,ke=this.otherVertexType===_e.CENTER?this.targetPoint:this.otherVertex,ot=this.elevationInfo;return[new se.w(U.ze.TARGET,et,ke,ot),new se.w(U.ze.REFERENCE,ze,et,ot),new ae.y(this.previousVertex,et,ke,ot)]}}(Ye=_e||(_e={}))[Ye.NEXT=0]="NEXT",Ye[Ye.CENTER=1]="CENTER";var pe=T(25858);let he=class extends Q.r{constructor(Ye){super(Ye),this.options=null,this.sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null}}}get updating(){return(0,le.oE)(this.snappingSources,({snappingSource:Ye})=>Ye.updating)||this.updatingHandles.updating}get snappingSources(){const Ye=this._get("snappingSources")||new Map,ze=new Map;if((0,H.pC)(this.options)&&(0,H.pC)(this.options.featureSources))for(const et of this.options.featureSources.items){const ke=et.layer.uid,ot=Ye.get(ke);if(ot){Ye.delete(ke),ze.set(ke,ot);continue}if(!et.layer.loaded){this.updatingHandles.addPromise(et.layer.load());continue}const at=this._createSourceInfo(et);(0,H.pC)(at)&&ze.set(ke,at)}for(const[,et]of Ye)et.destroy();return ze}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),J.Z_),(0,H.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",Ye=>this._updateLayerView(Ye.layer,Ye.layerView)),this.view.on("layerview-destroy",Ye=>this._updateLayerView(Ye.layer,null))])}_updateLayerView(Ye,ze){for(const[,et]of this.snappingSources)et.snappingSource.layerSource.layer===Ye&&(et.layerView=ze)}destroy(){this._set("options",null);for(const[,Ye]of this.snappingSources)Ye.destroy()}fetchCandidates(Ye,ze,et){var ke=this;return(0,x.Z)(function*(){if((0,H.Wi)(ke.options)||!ke.options.effectiveFeatureEnabled)return[];const ot=[],at=ke._computeScreeenSizeDistanceParameters(Ye,ze),yt={distance:at,point:Ye,coordinateHelper:ze.coordinateHelper,types:ke.types,filter:null};for(const[,{snappingSource:zt,layerView:Rt}]of ke.snappingSources)!zt.layerSource.enabled||(0,H.pC)(Rt)&&Rt.suspended||ot.push(zt.fetchCandidates(yt,et).then(Ft=>Ft.filter(bt=>!ke._candidateIsExcluded(zt,bt,ze.excludeFeature))));const wt=(yield(0,re.WW)(ot)).flat();return ke._addRightAngleCandidates(wt,Ye,at,ze),(0,re.k_)(et),(0,U.lQ)(Ye,wt),wt})()}_addRightAngleCandidates(Ye,ze,et,ke){var wt,zt,Rt,Ft,bt,St,Xt,Mr;const ot=(0,H.pC)(ke.vertexHandle)?null==(zt=null==(wt=ke.vertexHandle.rightEdge)?void 0:wt.rightVertex)?void 0:zt.pos:(0,H.pC)(ke.editGeometryOperations)&&"polygon"===ke.editGeometryOperations.data.type?null==(Ft=(0,H.Wg)(null==(Rt=ke.editGeometryOperations.data.components[0])?void 0:Rt.getFirstVertex()))?void 0:Ft.pos:null,at=(0,H.pC)(ke.vertexHandle)?null==(St=null==(bt=ke.vertexHandle.leftEdge)?void 0:bt.leftVertex)?void 0:St.pos:(0,H.pC)(ke.editGeometryOperations)?null==(Mr=(0,H.Wg)(null==(Xt=ke.editGeometryOperations.data.components[0])?void 0:Xt.getLastVertex()))?void 0:Mr.pos:null,yt=Ye.length;for(let Cr=0;Cr<yt;Cr++)this._addRightAngleCandidate(Ye[Cr],at,ze,et,ke,Ye),this._addRightAngleCandidate(Ye[Cr],ot,ze,et,ke,Ye)}_addRightAngleCandidate(Ye,ze,et,ke,ot,at){if((0,H.Wi)(ze)||!(Ye instanceof ee.L))return;const yt=Ye.constraint.closestTo(ze),wt=(yt[0]-et[0])/ke.x,zt=(yt[1]-et[1])/ke.y;if(wt*wt+zt*zt<=1){const Rt=ot.coordinateHelper;at.push(new de({coordinateHelper:Rt,targetPoint:yt,otherVertex:ze,otherVertexType:_e.NEXT,previousVertex:Ye.constraint.start,constraint:new X.yG(Rt,ze,yt),objectId:Ye.objectId,elevationInfo:Ye.elevationInfo}))}}_computeScreeenSizeDistanceParameters(Ye,ze){const et=(0,H.pC)(this.options)?this.options.distance*("touch"===ze.pointer?this.options.touchSensitivityMultiplier:1):0;if((0,H.Wi)(this.view))return{x:et,y:et,pixelSize:et};if("2d"===this.view.type){const ke=et*this.view.resolution;return{x:ke,y:ke,pixelSize:ke}}return this._computeScreenSizeDistanceParameters3D(Ye,et,this.view,ze)}_computeScreenSizeDistanceParameters3D(Ye,ze,et,ke){const{coordinateHelper:ot,elevationInfo:at}=ke,yt=et.state.camera.computeScreenPixelSizeAt((0,pe.$r)(Ye,ot,at,et,ye)),wt=yt*et.renderCoordsHelper.unitInMeters/et.mapCoordsHelper.unitInMeters,zt=ze*wt;return{x:zt/this._computeScreenMagnitudeOfMapOffset(Ye,wt,0,et,ke),y:zt/this._computeScreenMagnitudeOfMapOffset(Ye,0,wt,et,ke),pixelSize:yt}}_computeScreenMagnitudeOfMapOffset(Ye,ze,et,ke,{coordinateHelper:ot,elevationInfo:at}){const yt=ot.clone(Ye);yt[0]+=ze,yt[1]+=et;const wt=(0,pe.a7)(Ye,ot,at,ke),zt=(0,pe.a7)(yt,ot,at,ke),Rt=zt.x-wt.x,Ft=zt.y-wt.y;return Math.sqrt(Rt*Rt+Ft*Ft)}get types(){return j.r.EDGE|j.r.VERTEX}_candidateIsExcluded(Ye,ze,et){if((0,H.Wi)(et))return!1;const ke=this._getCandidateObjectId(ze);if((0,H.Wi)(ke))return!1;const ot=Ye.layerSource.layer;return"graphics"===ot.type?et.uid===ke:et.sourceLayer===ot&&!(!et.attributes||!("objectIdField"in ot))&&et.attributes[ot.objectIdField]===ke}_getCandidateObjectId(Ye){return Ye instanceof $.a?Ye.objectId:null}_createSourceInfo(Ye){const ze=this._createFeatureSnappingSourceType(Ye);if((0,H.Wi)(ze))return null;if("loading"in ze)return this.updatingHandles.addPromise(ze.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const et=(0,H.pC)(this.view)?this.view.allLayerViews.find(ke=>ke.layer===Ye.layer):null;return new ge(ze.source,et)}_createFeatureSnappingSourceType(Ye){switch(Ye.layer.type){case"feature":case"geojson":case"csv":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(Ye);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(Ye)}return null}_createFeatureSnappingSourceFeatureLayer(Ye){switch(Ye.layer.source.type){case"feature-layer":{const ze=this._getSourceModule("featureService");return(0,H.pC)(ze.module)?{source:new ze.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:Ye})}:{loading:ze.loader}}case"memory":case"csv":case"geojson":case"wfs":{if("mesh"===Ye.layer.geometryType)return null;const ze=this._getSourceModule("featureCollection");return(0,H.pC)(ze.module)?{source:new ze.module.FeatureCollectionSnappingSource({layerSource:Ye})}:{loading:ze.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(Ye){const ze=this._getSourceModule("graphics");return(0,H.pC)(ze.module)?{source:new ze.module.GraphicsSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:Ye})}:{loading:ze.loader}}_getSourceModule(Ye){const ze=this.sourceModules[Ye];if((0,H.Wi)(ze.loader)){const et=this._loadSourceModule(Ye).then(ke=>{ze.module=ke});return ze.loader=et,{module:ze.module,loader:et}}return{module:ze.module,loader:ze.loader}}_loadSourceModule(Ye){switch(Ye){case"featureService":return this.updatingHandles.addPromise(Promise.all([T.e(8592),T.e(5896)]).then(T.bind(T,78740)));case"featureCollection":return this.updatingHandles.addPromise(Promise.all([T.e(8592),T.e(565)]).then(T.bind(T,78176)));case"graphics":return this.updatingHandles.addPromise(Promise.all([T.e(3464),T.e(8592),T.e(9440)]).then(T.bind(T,66269)))}return null}};(0,A._)([(0,W.Cb)({constructOnly:!0})],he.prototype,"spatialReference",void 0),(0,A._)([(0,W.Cb)({constructOnly:!0})],he.prototype,"view",void 0),(0,A._)([(0,W.Cb)()],he.prototype,"options",void 0),(0,A._)([(0,W.Cb)({readOnly:!0})],he.prototype,"updating",null),(0,A._)([(0,W.Cb)({readOnly:!0})],he.prototype,"snappingSources",null),he=(0,A._)([(0,ue.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],he);class ge{constructor(ze,et){this.snappingSource=ze,this.layerView=et,this.handles=new oe.Z;const ke=this.snappingSource.layerSource.layer;"refresh"in ke&&this.handles.add(ke.on("refresh",()=>ze.refresh())),this.handles.add([(0,J.YP)(()=>ze.updating,ot=>ze.layerSource.updating=ot,J.tX),(0,J.YP)(()=>ze.availability,ot=>ze.layerSource.availability=ot,J.tX)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}const ye=(0,Y.c)();var Me=T(14517),Ee=T(46160),Te=T(99770),me=T(36460);class Ce{constructor(ze,et){this.view=ze,this.options=et,this.squaredShortLineThreshold=me.c.shortLineThreshold*me.c.shortLineThreshold}snap(ze,et){return(0,H.pC)(et.vertexHandle)?"vertex"!==et.vertexHandle.type?[]:this.snapExistingVertex(ze,et):this.snapNewVertex(ze,et)}edgeExceedsShortLineThreshold(ze,et){return this.exceedsShortLineThreshold(ze.leftVertex.pos,ze.rightVertex.pos,et)}exceedsShortLineThreshold(ze,et,{elevationInfo:ke,editGeometryOperations:ot}){const at=ot.data.coordinateHelper;return 0===this.squaredShortLineThreshold||(0,U.tp)((0,pe.a7)(et,at,ke,this.view),(0,pe.a7)(ze,at,ke,this.view))>this.squaredShortLineThreshold}squaredProximityTreshold(ze){return"touch"===ze?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:ze,touchSensitivityMultiplier:et}=this.options,ke=ze*et;return ke*ke}}class Ie extends ne.j{constructor({coordinateHelper:ze,lineStart:et,lineEnd:ke,targetPoint:ot,elevationInfo:at}){super(ze,ot,new X.ku(ze,et,ke),at),this.referenceLineHint=new se.w(U.ze.REFERENCE_EXTENSION,et,ke,at)}get hints(){return[this.referenceLineHint,new se.w(U.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.elevationInfo)]}_lineEndClosestToTarget(){const ze=this.constraint.start,et=this.constraint.end;return Math.sign((0,ce.h)((0,ce.g)(Je,et,ze),(0,ce.g)(Ge,this.targetPoint,ze)))>0?et:ze}}const Ge=(0,Te.a)(),Je=(0,Te.a)();var xe=T(396);class je extends Ce{snapNewVertex(ze,et){const ke=et.editGeometryOperations.data.components[0],ot=ke.edges.length,at=[];if(ot<1)return at;const wt=(0,pe.a7)(ze,et.coordinateHelper,et.elevationInfo,this.view),zt=ke.edges[ot-1];let Rt=zt;do{this.edgeExceedsShortLineThreshold(Rt,et)&&this._processCandidateProposal(Rt.leftVertex.pos,Rt.rightVertex.pos,ze,wt,et,at),Rt=Rt.leftVertex.leftEdge}while(Rt&&Rt!==zt);return at}snapExistingVertex(ze,et){const ke=[],ot=(0,H.Wg)(et.vertexHandle),at=ot.component;if(at.edges.length<2)return ke;const wt=(0,pe.a7)(ze,et.coordinateHelper,et.elevationInfo,this.view),zt=ot.leftEdge,Rt=ot.rightEdge;zt&&Rt&&this.edgeExceedsShortLineThreshold(zt,et)&&this.edgeExceedsShortLineThreshold(Rt,et)&&this._processCandidateProposal(zt.leftVertex.pos,Rt.rightVertex.pos,ze,wt,et,ke);const Ft=at.edges[0];let bt=Ft;do{bt!==ot.leftEdge&&bt!==ot.rightEdge&&this.edgeExceedsShortLineThreshold(bt,et)&&this._processCandidateProposal(bt.leftVertex.pos,bt.rightVertex.pos,ze,wt,et,ke),bt=bt.rightVertex.rightEdge}while(bt&&bt!==Ft);return ke}_processCandidateProposal(ze,et,ke,ot,at,yt){const wt=(0,xe.k0)((0,Te.a)(),ke,ze,et),{coordinateHelper:zt,elevationInfo:Rt,pointer:Ft}=at,bt=zt.fromXYZ(wt,zt.getZ(ke,0));(0,U.tp)(ot,(0,pe.a7)(bt,zt,Rt,this.view))<this.squaredProximityTreshold(Ft)&&yt.push(new Ie({coordinateHelper:zt,lineStart:ze,lineEnd:et,targetPoint:bt,elevationInfo:Rt}))}}var We=T(80221);class Ne extends ne.j{constructor({coordinateHelper:ze,referenceLine:et,lineStart:ke,targetPoint:ot,elevationInfo:at}){const yt=ze.clone(ke);(0,ce.g)(yt,(0,ce.b)(yt,yt,et.rightVertex.pos),et.leftVertex.pos),super(ze,ot,new X.ku(ze,ke,yt),at),this._referenceLines=[{edge:et,fadeLeft:!0,fadeRight:!0}]}get hints(){const ze=this.elevationInfo;return[new se.w(U.ze.TARGET,this.constraint.start,this.targetPoint,ze),new We.L(this.constraint.start,this.targetPoint,ze),...this._referenceLines.map(et=>new se.w(U.ze.REFERENCE,et.edge.leftVertex.pos,et.edge.rightVertex.pos,ze,et.fadeLeft,et.fadeRight))]}addReferenceLine(ze){const et={edge:ze,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(ke=>{ze.rightVertex.rightEdge===ke.edge&&(ke.fadeLeft=!1,et.fadeRight=!1),ze.leftVertex.leftEdge===ke.edge&&(ke.fadeRight=!1,et.fadeLeft=!1)}),this._referenceLines.push(et)}}class we extends Ce{constructor(){super(...arguments),this._tmpProjection=(0,Te.a)()}snapNewVertex(ze,et){const ke=et.editGeometryOperations.data.components[0],ot=ke.edges.length,at=ke.vertices.length,yt=[];if(ot<2)return yt;const wt=(0,pe.a7)(ze,et.coordinateHelper,et.elevationInfo,this.view),zt=ke.vertices[at-1],Rt=ke.vertices[0],Ft=ke.edges[ot-1];let bt=Ft;do{this.edgeExceedsShortLineThreshold(bt,et)&&(this._checkEdgeForParalleLines(bt,zt.pos,ze,wt,et,yt),this._checkEdgeForParalleLines(bt,Rt.pos,ze,wt,et,yt)),bt=bt.leftVertex.leftEdge}while(bt&&bt!==Ft);return yt}snapExistingVertex(ze,et){const ke=[],ot=(0,H.Wg)(et.vertexHandle),at=ot.component;if(at.edges.length<3)return ke;const yt=(0,pe.a7)(ze,et.coordinateHelper,et.elevationInfo,this.view),wt=ot.leftEdge,zt=ot.rightEdge,Rt=at.vertices[0],bt=at.vertices[at.vertices.length-1],St=at.edges[0];let Xt=St;do{Xt!==wt&&Xt!==zt&&this.edgeExceedsShortLineThreshold(Xt,et)&&(wt&&this._checkEdgeForParalleLines(Xt,wt.leftVertex.pos,ze,yt,et,ke),zt&&this._checkEdgeForParalleLines(Xt,zt.rightVertex.pos,ze,yt,et,ke),ot===Rt?this._checkEdgeForParalleLines(Xt,bt.pos,ze,yt,et,ke):ot===bt&&this._checkEdgeForParalleLines(Xt,Rt.pos,ze,yt,et,ke)),Xt=Xt.rightVertex.rightEdge}while(Xt&&Xt!==St);return ke}_checkEdgeForParalleLines(ze,et,ke,ot,at,yt){const wt=ze.leftVertex.pos,zt=ze.rightVertex.pos;if((0,xe.k0)(this._tmpProjection,et,wt,zt),(0,ce.s)(this._tmpProjection,et)<me.c.parallelLineThreshold)return;(0,xe.k0)(this._tmpProjection,ke,wt,zt,et);const{coordinateHelper:Rt,elevationInfo:Ft,pointer:bt}=at,St=Rt.fromXYZ(this._tmpProjection,Rt.getZ(ke,0));if((0,U.tp)(ot,(0,pe.a7)(St,Rt,Ft,this.view))<this.squaredProximityTreshold(bt)){if(this._parallelToPreviousCandidate(ze,yt))return;yt.push(new Ne({coordinateHelper:Rt,referenceLine:ze,lineStart:et,targetPoint:St,elevationInfo:Ft}))}}_parallelToPreviousCandidate(ze,et){const ke=ze.leftVertex.pos,ot=ze.rightVertex.pos;for(const at of et)if((0,xe.k0)(this._tmpProjection,ot,at.constraint.start,at.constraint.end,ke),(0,ce.s)(this._tmpProjection,ot)<me.c.parallelLineThreshold)return at.addReferenceLine(ze),!0;return!1}}class Oe extends Ce{constructor(){super(...arguments),this._tmp=(0,Te.a)()}snapNewVertex(ze,et){const ke=et.editGeometryOperations.data.components[0],ot=ke.vertices.length,at=[];if(ot<2)return at;const yt=(0,pe.a7)(ze,et.coordinateHelper,et.elevationInfo,this.view),wt=ke.vertices[ot-1];this._checkForSnappingCandidate(at,wt.leftEdge,wt.pos,ze,wt.leftEdge.leftVertex.pos,wt.pos,et,ze,yt);const zt=ke.vertices[0];return this._checkForSnappingCandidate(at,zt.rightEdge,zt.pos,ze,zt.rightEdge.rightVertex.pos,zt.pos,et,ze,yt),at}snapExistingVertex(ze,et){const ke=[],ot=(0,H.Wg)(et.vertexHandle),at=ot.component,yt=at.vertices.length;if(yt<3)return ke;const wt=(0,pe.a7)(ze,et.coordinateHelper,et.elevationInfo,this.view),zt=ot.leftEdge,Rt=ot.rightEdge,Ft=at.vertices[0],bt=at.vertices[yt-1];if(!zt)return this._checkForSnappingCandidate(ke,Ft.rightEdge.rightVertex.rightEdge,Ft.rightEdge.rightVertex.pos,ze,Ft.rightEdge.rightVertex.rightEdge.rightVertex.pos,Ft.rightEdge.rightVertex.pos,et,ze,wt),ke;if(!Rt)return this._checkForSnappingCandidate(ke,bt.leftEdge.leftVertex.leftEdge,bt.leftEdge.leftVertex.pos,ze,bt.leftEdge.leftVertex.leftEdge.leftVertex.pos,bt.leftEdge.leftVertex.pos,et,ze,wt),ke;if(zt&&zt.leftVertex.leftEdge){const St=zt.leftVertex.leftEdge;this._checkForSnappingCandidate(ke,St,zt.leftVertex.pos,ze,St.leftVertex.pos,zt.leftVertex.pos,et,ze,wt)}if(Rt&&Rt.rightVertex.rightEdge){const St=Rt.rightVertex.rightEdge;this._checkForSnappingCandidate(ke,St,Rt.rightVertex.pos,ze,St.rightVertex.pos,Rt.rightVertex.pos,et,ze,wt)}return ke}_checkForSnappingCandidate(ze,et,ke,ot,at,yt,wt,zt,Rt){if(!this.edgeExceedsShortLineThreshold(et,wt))return;(0,ce.g)(this._tmp,et.rightVertex.pos,et.leftVertex.pos);const Ft=(0,Te.f)(this._tmp[1],-this._tmp[0]),bt=(0,ce.h)(Ft,(0,ce.g)(this._tmp,ot,ke))/(0,ce.u)(Ft),{coordinateHelper:St,elevationInfo:Xt,pointer:Mr}=wt,Cr=St.fromXYZ((0,ce.v)((0,Te.a)(),yt,Ft,bt),St.getZ(zt,0));(0,U.tp)(Rt,(0,pe.a7)(Cr,St,Xt,this.view))<this.squaredProximityTreshold(Mr)&&ze.push(new de({coordinateHelper:St,targetPoint:Cr,constraint:new X.yG(St,yt,(0,ce.v)(St.createVector(),yt,Ft,Math.sign(bt))),previousVertex:at,otherVertex:yt,otherVertexType:_e.CENTER,elevationInfo:Xt}))}}class $e extends ne.j{constructor({coordinateHelper:ze,targetPoint:et,point1:ke,point2:ot,elevationInfo:at}){super(ze,et,new X.UL(ze,(0,ce.l)(Be,ke,ot,.5),.5*(0,ce.j)(ke,ot)),at),this.p1=ke,this.p2=ot}get hints(){const ze=this.elevationInfo;return[new se.w(U.ze.REFERENCE,this.targetPoint,this.p1,ze),new se.w(U.ze.REFERENCE,this.targetPoint,this.p2,ze),new ae.y(this.p1,this.targetPoint,this.p2,ze)]}}const Be=(0,Te.a)();class Se extends Ce{snapNewVertex(ze,et){const ke=et.editGeometryOperations.data.components[0],ot=[],at=ke.vertices.length;return"polygon"!==et.editGeometryOperations.data.type||at<2||this._processCandidateProposal(ke.vertices[0].pos,ke.vertices[at-1].pos,ze,et,ot),ot}snapExistingVertex(ze,et){const ke=[],ot=(0,H.Wg)(et.vertexHandle),at=ot.component;return at.edges.length<2||("polyline"!==et.editGeometryOperations.data.type||0!==ot.index&&ot.index!==at.vertices.length-1)&&this._processCandidateProposal(ot.leftEdge.leftVertex.pos,ot.rightEdge.rightVertex.pos,ze,et,ke),ke}_processCandidateProposal(ze,et,ke,ot,at){if(!this.exceedsShortLineThreshold(ze,et,ot))return;const yt=(0,ce.l)((0,Te.a)(),ze,et,.5),wt=.5*(0,ce.j)(ze,et),zt=(0,xe.xO)((0,Te.a)(),ke,yt,wt),{coordinateHelper:Rt,elevationInfo:Ft,pointer:bt}=ot,St=Rt.fromXYZ(zt,Rt.getZ(ke,0)),Xt=(0,pe.a7)(ke,Rt,Ft,this.view);(0,U.tp)(Xt,(0,pe.a7)(St,Rt,Ft,this.view))<this.squaredProximityTreshold(bt)&&at.push(new $e({coordinateHelper:Rt,targetPoint:St,point1:ze,point2:et,elevationInfo:Ft}))}}let De=class extends Me.Z{constructor(Ye){super(Ye),this.updating=!1,this._snappers=new Ee.Z}initialize(){this._snappers.push(new we(this.view,this.options),new je(this.view,this.options),new Oe(this.view,this.options),new Se(this.view,this.options))}set options(Ye){this._set("options",Ye);for(const ze of this._snappers)ze.options=Ye}fetchCandidates(Ye,ze){var et=this;return(0,x.Z)(function*(){if(!et.options.effectiveSelfEnabled)return[];const ke=[];for(const ot of et._snappers.items)ke.push(...ot.snap(Ye,ze));return(0,U.lQ)(Ye,ke),ke})()}};function Fe(Ye,ze){return[new De({view:Ye,options:ze}),new he({view:Ye,options:ze,spatialReference:Ye.spatialReference})]}(0,A._)([(0,W.Cb)({readOnly:!0})],De.prototype,"updating",void 0),(0,A._)([(0,W.Cb)({constructOnly:!0})],De.prototype,"view",void 0),(0,A._)([(0,W.Cb)()],De.prototype,"options",null),De=(0,A._)([(0,ue.j)("esri.views.interactive.snapping.SelfSnappingEngine")],De);var ve=T(79546),Ke=T(80985);class qe extends ne.j{constructor(ze,et,ke,ot,at){super(ze,et,new X.Bq(ze,et,ke.constraint,ot.constraint),at),this.first=ke,this.second=ot}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Ke.w(this.targetPoint,this.elevationInfo)]}}let be=class extends(G.Z.EventedMixin(Q.r)){constructor(Ye){super(Ye),this.options=new ve.Z,this.snappingEnginesFactory=Fe,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}initialize(){this.handles.add([(0,J.YP)(()=>{const{effectiveFeatureEnabled:Ye,effectiveSelfEnabled:ze,touchSensitivityMultiplier:et,distance:ke}=this.options;return{effectiveFeatureEnabled:Ye,effectiveSelfEnabled:ze,touchSensitivityMultiplier:et,distance:ke}},()=>{this.doneSnapping(),this.emit("changed")},J.Z_),(0,J.YP)(()=>this.options,Ye=>{for(const ze of this._engines)ze.options=Ye},J.Z_),(0,J.YP)(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:Ye,snappingEnginesFactory:ze})=>this._recreateEngines(Ye,ze),J.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(Ye=>Ye.updating)}_recreateEngines(Ye,ze){if(this._destroyEngines(),!Ye)return;const{view:et,options:ke}=this;this._engines=ze(et,ke)}_destroyEngines(){for(const Ye of this._engines)Ye.destroy();this._engines=[]}get squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get squaredTouchProximityThreshold(){const{distance:Ye,touchSensitivityMultiplier:ze}=this.options,et=Ye*ze;return et*et}snap(Ye,ze,et){var ke=this;return(0,x.Z)(function*(){const ot=ze.coordinateHelper.pointToVector(Ye),at=yield ke._fetchCandidates(ot,ze,et);return{get valid(){return!(0,re.Hc)(et)},apply:()=>{const{snappedPoint:yt,hints:wt}=ke._processCandidates(ot,at,ze);return ke._removeVisualization(),(0,H.pC)(ze.visualizer)&&ke.handles.add(ze.visualizer.draw(wt,{coordinateHelper:ze.coordinateHelper,elevationInfo:ze.elevationInfo,view:ke.view}),tt),yt}}})()}update(Ye,ze){this._removeVisualization();let et=Ye;const ke=[];if((0,H.pC)(this._currentMainCandidate)){const ot=ze.coordinateHelper,at=ot.pointToVector(Ye),yt=this._currentMainCandidate.constraint.closestTo(at);if((0,U.tp)((0,pe.a7)(at,ot,ze.elevationInfo,this.view),(0,pe.a7)(yt,ot,ze.elevationInfo,this.view))<this._squaredPointProximityThreshold(ze.pointer)){et=ot.vectorToDehydratedPoint(yt),this._currentMainCandidate.targetPoint=yt,ke.push(...this._currentMainCandidate.hints);for(const wt of this._currentOtherActiveCandidates)wt.targetPoint=yt,ke.push(...wt.hints)}else this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}return(0,H.pC)(ze.visualizer)&&this.handles.add(ze.visualizer.draw(ke,{coordinateHelper:ze.coordinateHelper,elevationInfo:ze.elevationInfo,view:this.view}),tt),et}doneSnapping(){this._removeVisualization(),this._currentMainCandidate=null,this._currentOtherActiveCandidates=[]}_removeVisualization(){this.handles.remove(tt)}_fetchCandidates(Ye,ze,et){var ke=this;return(0,x.Z)(function*(){return(yield Promise.all(ke._engines.map(ot=>ot.fetchCandidates(Ye,ze,et)))).flat()})()}_processCandidates(Ye,ze,et){if(ze.length<1)return this.doneSnapping(),{snappedPoint:et.coordinateHelper.vectorToDehydratedPoint(Ye),hints:[]};(0,U.lQ)(Ye,ze);const ke=this._currentMainCandidate;if((0,H.pC)(ke)){const ot=this._findOldConstraintInNewCandidates(ke,ze);if(ot>=0){if(!(ze[ot]instanceof qe))return this._intersectWithOtherCandidates(ot,ze,Ye,et);if((0,ce.s)(Ye,ke.targetPoint)<this._squaredPointProximityThreshold(et.pointer))return this._updateSnappingCandidate(ke,ze,et)}}return this._intersectWithOtherCandidates(0,ze,Ye,et)}_findOldConstraintInNewCandidates(Ye,ze){return Ye instanceof qe?this._findOldCandidateIndex(ze,Ye.first)>=0&&this._findOldCandidateIndex(ze,Ye.second)>=0?0:-1:this._findOldCandidateIndex(ze,Ye)}_intersectWithOtherCandidates(Ye,ze,et,ke){const ot=ze[Ye],at=[],yt=ke.coordinateHelper;for(let wt=0;wt<ze.length;++wt){if(wt===Ye)continue;const zt=ze[wt];for(const Rt of ot.constraint.intersect(zt.constraint)){const Ft=yt.fromXYZ(Rt.intersection,ot.targetPoint[2]);at.push([new qe(yt,Ft,ot,zt,zt.elevationInfo),(0,U.tp)((0,pe.a7)(et,ke.coordinateHelper,ke.elevationInfo,this.view),(0,pe.a7)(Ft,ke.coordinateHelper,ke.elevationInfo,this.view))])}}return at.length>0&&(at.sort((wt,zt)=>wt[1]-zt[1]),at[0][1]<this._squaredPointProximityThreshold(ke.pointer))?this._updateSnappingCandidate(at[0][0],ze,ke):this._updateSnappingCandidate(ot,ze,ke)}_updateSnappingCandidate(Ye,ze,et){this.doneSnapping(),this._currentMainCandidate=Ye;const ke=this._currentMainCandidate.targetPoint,ot=[];ot.push(...Ye.hints);for(const at of ze){if(Ye instanceof qe){if(at.constraint.objectEqual(Ye.first.constraint)||at.constraint.objectEqual(Ye.second.constraint))continue}else if(at.constraint.objectEqual(Ye.constraint))continue;at.constraint.check(ke)&&(at.targetPoint=ke,this._currentOtherActiveCandidates.push(at),ot.push(...at.hints))}return{snappedPoint:et.coordinateHelper.vectorToDehydratedPoint(ke),hints:ot}}_squaredPointProximityThreshold(Ye){return"touch"===Ye?this.squaredTouchProximityThreshold:this.squaredMouseProximityTreshold}_findOldCandidateIndex(Ye,ze){let et=-1;for(let ke=0;ke<Ye.length;++ke)if(ze.constraint.objectEqual(Ye[ke].constraint)){et=ke;break}return et}get test(){return{visualizationsActive:this.handles.has(tt),engines:this._engines}}};(0,A._)([(0,W.Cb)({constructOnly:!0})],be.prototype,"view",void 0),(0,A._)([(0,W.Cb)()],be.prototype,"options",void 0),(0,A._)([(0,W.Cb)({readOnly:!0})],be.prototype,"updating",null),(0,A._)([(0,W.Cb)()],be.prototype,"snappingEnginesFactory",void 0),(0,A._)([(0,W.Cb)()],be.prototype,"_engines",void 0),(0,A._)([(0,W.Cb)()],be.prototype,"squaredMouseProximityTreshold",null),(0,A._)([(0,W.Cb)()],be.prototype,"squaredTouchProximityThreshold",null),be=(0,A._)([(0,ue.j)("esri.views.interactive.snapping.SnappingManager")],be);const tt="visualization-handle"},79546:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>ue});var x=T(17626),A=T(14517),G=T(46160),Q=T(77712),W=(T(85931),T(8314),T(90912),T(76898)),B=T(14380),Z=T(36460);let ie=class extends A.Z{constructor(ce){super(ce),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new G.Z,this.distance=Z.c.distance,this.touchSensitivityMultiplier=Z.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,x._)([(0,Q.Cb)()],ie.prototype,"enabled",void 0),(0,x._)([(0,Q.Cb)()],ie.prototype,"enabledToggled",void 0),(0,x._)([(0,Q.Cb)()],ie.prototype,"selfEnabled",void 0),(0,x._)([(0,Q.Cb)()],ie.prototype,"featureEnabled",void 0),(0,x._)([(0,Q.Cb)({type:G.Z.ofType(B.Z)})],ie.prototype,"featureSources",void 0),(0,x._)([(0,Q.Cb)()],ie.prototype,"distance",void 0),(0,x._)([(0,Q.Cb)()],ie.prototype,"touchSensitivityMultiplier",void 0),(0,x._)([(0,Q.Cb)({readOnly:!0})],ie.prototype,"effectiveEnabled",null),(0,x._)([(0,Q.Cb)({readOnly:!0})],ie.prototype,"effectiveSelfEnabled",null),(0,x._)([(0,Q.Cb)({readOnly:!0})],ie.prototype,"effectiveFeatureEnabled",null),ie=(0,x._)([(0,W.j)("esri.views.interactive.snapping.SnappingOptions")],ie);const ue=ie},75897:(dt,Re,T)=>{"use strict";T.d(Re,{L:()=>H});var x=T(33351),A=T(44725),G=T(97979),Q=T(62160);class H extends G.a{constructor(J){super(yi(or({},J),{constraint:new x.ku(J.coordinateHelper,J.edgeStart,J.edgeEnd)}))}get hints(){return[new Q.w(A.ze.REFERENCE,this.constraint.start,this.constraint.end,this.elevationInfo)]}}},97979:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>A});var x=T(22823);class A extends x.j{constructor({coordinateHelper:Q,targetPoint:H,objectId:re,constraint:J,elevationInfo:W}){super(Q,H,J,W),this.objectId=re}}},22823:(dt,Re,T)=>{"use strict";T.d(Re,{j:()=>x});class x{constructor(G,Q,H,re){this.coordinateHelper=G,this.targetPoint=Q,this.constraint=H,this.elevationInfo=re}}},80985:(dt,Re,T)=>{"use strict";T.d(Re,{w:()=>G});var x=T(44725),A=T(5286);class G extends A.r{constructor(H,re){super(re),this.intersectionPoint=H}equals(H){return H instanceof G&&(0,x.Xv)(this.intersectionPoint,H.intersectionPoint)}}},62160:(dt,Re,T)=>{"use strict";T.d(Re,{w:()=>H}),T(8314);var A=T(63290),G=T(44725),Q=T(5286);A.Z.getLogger("esri.views.interactive.snapping.hints.LineSnappingHint");class H extends Q.r{constructor(J,W,B,Z,ie=!0,ue=!0){super(Z),this.type=J,this.lineStart=W,this.lineEnd=B,this.fadeLeft=ie,this.fadeRight=ue}equals(J){return J instanceof H&&this.type===J.type&&(0,G.Xv)(this.lineStart,J.lineStart)&&(0,G.Xv)(this.lineEnd,J.lineEnd)&&this.fadeLeft===J.fadeLeft&&this.fadeRight===J.fadeRight}}},80221:(dt,Re,T)=>{"use strict";T.d(Re,{L:()=>H}),T(8314);var A=T(63290),G=T(44725),Q=T(5286);A.Z.getLogger("esri.views.interactive.snapping.hints.ParallelSnappingHint");class H extends Q.r{constructor(J,W,B){super(B),this.lineStart=J,this.lineEnd=W}equals(J){return J instanceof H&&(0,G.Xv)(this.lineStart,J.lineStart)&&(0,G.Xv)(this.lineEnd,J.lineEnd)}}},86842:(dt,Re,T)=>{"use strict";T.d(Re,{y:()=>H}),T(8314);var A=T(63290),G=T(44725),Q=T(5286);A.Z.getLogger("esri.views.interactive.snapping.hints.RightAngleSnappingHint");class H extends Q.r{constructor(J,W,B,Z){super(Z),this.previousVertex=J,this.centerVertex=W,this.nextVertex=B}equals(J){return J instanceof H&&(0,G.Xv)(this.previousVertex,J.previousVertex)&&(0,G.Xv)(this.centerVertex,J.centerVertex)&&(0,G.Xv)(this.nextVertex,J.nextVertex)}}},5286:(dt,Re,T)=>{"use strict";T.d(Re,{r:()=>x});class x{constructor(G){this.elevationInfo=G}}},44725:(dt,Re,T)=>{"use strict";T.d(Re,{Xv:()=>G,lQ:()=>Q,tp:()=>A,ze:()=>H});var H,re,x=T(67831);function A(re,J){const W=re.x-J.x,B=re.y-J.y;return W*W+B*B}function G(re,J){const W=re.length===J.length&&re[0]===J[0]&&re[1]===J[1];switch(re.length){case 2:return W;case 3:return W&&re[2]===J[2];case 4:return W&&re[3]===J[3]}return!1}function Q(re,J){J.sort((W,B)=>(0,x.s)(W.targetPoint,re)-(0,x.s)(B.targetPoint,re))}(re=H||(H={}))[re.TARGET=0]="TARGET",re[re.REFERENCE=1]="REFERENCE",re[re.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"},25858:(dt,Re,T)=>{"use strict";T.d(Re,{$r:()=>Z,By:()=>ce,CM:()=>J,RS:()=>ie,a7:()=>ue});var x=T(23841),A=T(67831),G=T(84161),Q=T(28093),H=T(49672),re=T(60507);function J(ee,$,ne,se){ne.projectToRenderScreen(ee,Y),ne.projectToRenderScreen($,j),(0,A.g)(se,j,Y),(0,A.i)(se,se)}function Z(ee,$,ne,se,ae=(0,Q.c)()){const de=$.toXYZ(ee);return de[2]=(0,re.zx)(se,de,$.spatialReference,ne)||0,se.renderCoordsHelper.toRenderCoords(de,$.spatialReference,ae),ae}function ie(ee,$,ne,se,ae=(0,Q.c)()){const de=(0,G.c)(le,ee);return de[2]=(0,re.zx)(se,de,$,ne)||0,se.renderCoordsHelper.toRenderCoords(de,$,ae),ae}function ue(ee,$,ne,se){return"2d"===se.type?se.toScreen($.vectorToPoint(ee,oe)):(Z(ee,$,ne,se,le),se.state.camera.projectToScreen(le,X),(0,x.vW)(X[0],X[1]))}function ce(ee,$,ne,se,ae,de,_e){const pe=ne.toXYZ(ee),he=ne.toXYZ($);if("absolute-height"!==se.mode){const ge=(0,re.zx)(ae,pe,ne.spatialReference,se),ye=(0,re.zx)(ae,he,ne.spatialReference,se),Me=(null==ge?ye:null==ye?ge:Math.min(ge,ye))||0;pe[2]=Me,he[2]=Me}ae.renderCoordsHelper.toRenderCoords(pe,ne.spatialReference,de),ae.renderCoordsHelper.toRenderCoords(he,ne.spatialReference,_e)}const oe=new H.Z,le=(0,Q.c)(),Y=(0,x.J$)(),j=(0,x.J$)(),X=(0,x.s1)();(0,x.s1)()},87091:(dt,Re,T)=>{"use strict";T.d(Re,{G5:()=>Te,T8:()=>ee,ZM:()=>ae,sq:()=>Ce,z4:()=>U});var x=T(17626),A=T(14517),G=T(72392),Q=T(63290),H=T(62208),re=T(73362),J=T(77029),W=T(10699),B=T(32917),Z=T(27422),ie=T(77712),le=(T(85931),T(8314),T(90912),T(76898)),Y=T(41291),j=T(66463);const X=Q.Z.getLogger("esri.views.support.Scheduler");function U(){return new Me.Scheduler}var ee,Ge;(Ge=ee||(ee={})).RESOURCE_CONTROLLER="schedule",Ge.SLIDE="slide",Ge.STREAM_DATA_LOADER="stream loader",Ge.ELEVATION_QUERY="elevation query",Ge.TERRAIN_SURFACE="terrain",Ge.SURFACE_GEOMETRY_UPDATES="surface geometry updates",Ge.GRAPHICS_CORE="Graphics3D",Ge.I3S_CONTROLLER="I3S",Ge.POINT_CLOUD_LAYER="point cloud",Ge.FEATURE_TILE_FETCHER="feature fetcher",Ge.OVERLAY="overlay",Ge.STAGE="stage",Ge.GRAPHICS_DECONFLICTOR="graphics deconflictor",Ge.FILTER_VISIBILITY="Graphics3D filter visibility",Ge.SCALE_VISIBILITY="Graphics3D scale visibility",Ge.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",Ge.POINT_OF_INTEREST_FREQUENT="POI frequent",Ge.POINT_OF_INTEREST_INFREQUENT="POI infrequent",Ge.LABELER="labeler",Ge.FEATURE_QUERY_ENGINE="feature query",Ge.FEATURE_TILE_TREE="feature tile tree",Ge.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",Ge.ELEVATION_ALIGNMENT="elevation alignment",Ge.TEXT_TEXTURE_ATLAS="text texture atlas",Ge.TEXTURE_UNLOAD="texture unload",Ge.LINE_OF_SIGHT_TOOL="line of sight tool",Ge.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",Ge.ELEVATION_PROFILE="elevation profile",Ge.SNAPPING="snapping",Ge.SHADOW_ACCUMULATOR="shadow accumulator",Ge.CLOUDS_GENERATOR="cloud generator",Ge[Ge.TEST_PRIO=1]="TEST_PRIO";const ne=new Map([[ee.RESOURCE_CONTROLLER,0],[ee.SLIDE,0],[ee.STREAM_DATA_LOADER,0],[ee.ELEVATION_QUERY,0],[ee.TERRAIN_SURFACE,1],[ee.SURFACE_GEOMETRY_UPDATES,1],[ee.GRAPHICS_CORE,2],[ee.I3S_CONTROLLER,2],[ee.POINT_CLOUD_LAYER,2],[ee.FEATURE_TILE_FETCHER,2],[ee.OVERLAY,4],[ee.STAGE,4],[ee.GRAPHICS_DECONFLICTOR,4],[ee.FILTER_VISIBILITY,4],[ee.SCALE_VISIBILITY,4],[ee.FRUSTUM_VISIBILITY,4],[ee.POINT_OF_INTEREST_FREQUENT,6],[ee.POINT_OF_INTEREST_INFREQUENT,30],[ee.LABELER,8],[ee.FEATURE_QUERY_ENGINE,8],[ee.FEATURE_TILE_TREE,16],[ee.FEATURE_TILE_TREE_ACTIVE,0],[ee.ELEVATION_ALIGNMENT,12],[ee.TEXT_TEXTURE_ATLAS,12],[ee.CLOUDS_GENERATOR,12],[ee.TEXTURE_UNLOAD,12],[ee.LINE_OF_SIGHT_TOOL,16],[ee.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[ee.SNAPPING,0],[ee.SHADOW_ACCUMULATOR,30]]);function se(Ge){return ne.has(Ge)?ne.get(Ge):"number"==typeof Ge?Ge:1}var ae;!function(Ge){Ge[Ge.ANIMATING=0]="ANIMATING",Ge[Ge.INTERACTING=1]="INTERACTING",Ge[Ge.IDLE=2]="IDLE"}(ae||(ae={}));const de=(0,Z.HA)(6.5),_e=(0,Z.HA)(1),pe=(0,Z.HA)(30),he=(0,Z.HA)(1e3/30),ge=(0,Z.HA)(100);var Me,Ee;(function(Ge){let Je=class extends A.Z{constructor(){super(),this.updating=!0,this._microTaskQueued=!1,this.performanceInfo={total:new re.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new je,this._state=ae.INTERACTING,this._tasks=new J.Z,this._runQueue=new J.Z,this._load=0,this._idleStateCallbacks=new J.Z,this._idleUpdatesStartFired=!1,this._maxReschedule=Ie,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,B.YP)(()=>j.Z.SCHEDULER_LOG_SLOW_TASKS,we=>this._debug=we,B.nn);for(const we of Object.keys(ee))this.performanceInfo.tasks.set(ee[we],new re.Z(ee[we]));let We;const Ne=this;this._test={get state(){return(0,H.Pt)(We,Ne._state)},set state(we){We=we},FRAME_SAFETY_BUDGET:de,INTERACTING_BUDGET:he,IDLE_BUDGET:ge,get availableBudget(){return Ne._budget.budget},usedBudget:0,getBudget:()=>Ne._budget,setBudget:we=>Ne._budget=we,updateTask:we=>this._updateTask(we),getState:we=>this._getState(we),getRuntime:we=>this._getRuntime(we),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(We=>We.remove()),this._tasks.clear(),(0,H.hw)(this._debugHandle),this._microTaskQueued=!1,this.updating=!1}activate(){this._budget.done||this._microTaskQueued||(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.done||(this._maxReschedule=Ie,this._schedule(),this.frame()))}))}registerTask(We,Ne){const we=se(We),Oe=new xe(this,We,Ne,we);return this._tasks.push(Oe),this.performanceInfo.tasks.has(We)||this.performanceInfo.tasks.set(We,new re.Z(We)),Oe}registerIdleStateCallbacks(We,Ne){const we={idleBegin:We,idleEnd:Ne};this._idleStateCallbacks.push(we),this.state===ae.IDLE&&this._idleUpdatesStartFired&&we.idleBegin();const Oe=this;return{remove:()=>this._removeIdleStateCallbacks(we),set idleBegin($e){Oe._idleUpdatesStartFired&&(we.idleEnd(),Oe._state===ae.IDLE&&$e()),we.idleBegin=$e},set idleEnd($e){we.idleEnd=$e}}}get load(){return this._load}set state(We){this._state!==We&&(this._state=We,this.state!==ae.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(Ne=>Ne.idleEnd())))}get state(){return(0,H.Wi)(this._test.state)?this._state:this._test.state}updateBudget(We){this._test.usedBudget=0;let Ne=de,we=We.frameDuration,Oe=_e;switch(this.state){case ae.IDLE:Ne=(0,Z.HA)(0),we=(0,Z.HA)(Math.max(ge,We.frameDuration)),Oe=pe;break;case ae.INTERACTING:we=(0,Z.HA)(Math.max(he,We.frameDuration))}return we=(0,Z.HA)(we-We.elapsedFrameTime-Ne),this.state!==ae.IDLE&&we<_e&&!this._forceTask?(this._forceTask=!0,!1):(we=(0,Z.HA)(Math.max(we,Oe)),this._budget.reset(we,this.state),this._maxReschedule=Ie,this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case ae.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(We=>We.idleBegin())),this._runIdle();break;case ae.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset((0,Z.HA)(0),this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(We){this._idleUpdatesStartFired&&We.idleEnd(),this._idleStateCallbacks.removeUnordered(We)}removeTask(We){this._tasks.removeUnordered(We),this._runQueue.removeUnordered(We)}_updateTask(We){this._tasks.forAll(Ne=>{Ne.name===We&&Ne.setPriority(We)})}_getState(We){if(this._runQueue.some(we=>we.name===We))return Ee.SCHEDULED;let Ne=Ee.IDLE;return this._tasks.forAll(we=>{we.name===We&&we.needsUpdate&&(we.schedulePriority<=1?Ne=Ee.READY:Ne!==Ee.READY&&(Ne=Ee.WAITING))}),Ne}_getRuntime(We){let Ne=0;return this._tasks.forAll(we=>{we.name===We&&(Ne+=we.runtime)}),Ne}_resetRuntimes(){this._tasks.forAll(We=>We.runtime=0)}_getRunning(){const We=new Map;if(this._tasks.forAll(we=>{we.needsUpdate&&We.set(we.name,(We.get(we.name)||0)+1)}),0===We.size)return null;let Ne="";return We.forEach((we,Oe)=>{Ne+=we>1?` ${we}x ${Oe}`:` ${Oe}`}),Ne}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const We=this._tasks.reduce((Ne,we)=>we.needsUpdate?++Ne:Ne,0);this._load=.9*this._load+We*(1-.9)}_schedule(){if(this._maxReschedule<=0)return!1;for(this._runQueue.filterInPlace(We=>!!We.needsUpdate||(We.schedulePriority=We.basePriority,!1)),this._tasks.forAll(We=>{0===We.basePriority&&We.needsUpdate&&!this._runQueue.includes(We)&&this._runQueue.unshift(We)});0===this._runQueue.length;){let We=!1,Ne=0;if(this._tasks.forAll(we=>{we.needsUpdate&&0!==we.schedulePriority&&0!==we.basePriority&&(We=!0,Ne=Math.max(Ne,we.basePriority),1===we.schedulePriority?(we.schedulePriority=0,this._runQueue.push(we)):--we.schedulePriority)}),!We)return this.updating=!1,!1;this._maxReschedule===Ie&&(this._maxReschedule=Ne),--this._maxReschedule}return this.updating=!0,!0}_run(){const We=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){const Ne=this._budget.now(),we=this._runQueue.pop();this._budget.resetProgress();try{we.task.runTask(this._budget)}catch($e){X.error(`Exception in task "${we.name}"`,$e)}we.schedulePriority=we.basePriority;const Oe=this._budget.now()-Ne;if(we.runtime+=Oe,this._frameTaskTimes.set(we.priority,this._frameTaskTimes.get(we.priority)+Oe),this._debug&&this._budget.elapsed>2*this._budget.budget&&console.log("Task",we.name,"used",this._budget.elapsed,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this.updating=this._tasks.some($e=>$e.needsUpdate),void this._recordFrameTaskTimes(this._budget.now()-We)}}while(this._schedule());this.updating=this._tasks.some(Ne=>Ne.needsUpdate),this._recordFrameTaskTimes(this._budget.now()-We)}_startFrameTaskTimes(){for(const We of Object.keys(ee))this._frameTaskTimes.set(ee[We],0)}_recordFrameTaskTimes(We){this._frameTaskTimes.forEach((Ne,we)=>this.performanceInfo.tasks.get(we).record(Ne)),this.performanceInfo.total.record(We)}get test(){return this._test}};(0,x._)([(0,ie.Cb)()],Je.prototype,"updating",void 0),Je=(0,x._)([(0,le.j)("esri.views.support.Scheduler")],Je),Ge.Scheduler=Je;let xe=class extends A.Z{constructor(We,Ne,we,Oe){super({}),this._scheduler=We,this.name=Ne,this._basePriority=Oe,this.runtime=0,this._queue=new Y.b,this._handles=new G.Z,this.schedulePriority=this._basePriority,this.task=(0,H.pC)(we)?we:this._queue,this._handles.add((0,B.gx)(()=>this.task.running,()=>We.activate()))}get updating(){return this._queue.running}normalizeCtorArgs(){return{}}remove(){this.processQueue(Te),this._scheduler.removeTask(this),this.schedule=Ce.schedule,this.reschedule=Ce.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(We){this.name=We;const Ne=se(We);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=Ne),this._basePriority=Ne}get priority(){return this.name}set priority(We){this.setPriority(We)}get needsUpdate(){return this.updating||this.task.running}schedule(We,Ne,we){return this._queue.push(We,Ne,we)}reschedule(We,Ne,we){return this._queue.unshift(We,Ne,we)}processQueue(We){this._queue.runTask(We)}};(0,x._)([(0,ie.Cb)({constructOnly:!0})],xe.prototype,"task",void 0),(0,x._)([(0,ie.Cb)({readOnly:!0})],xe.prototype,"updating",null),xe=(0,x._)([(0,le.j)("esri.views.support.SchedulerTask")],xe);class je{constructor(){this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=ae.IDLE,this._didWork=!1,this._enabled=!0}run(Ne){return!this.done&&(!0===Ne()&&(this._didWork=!0),!0)}get done(){return this._didWork&&this.elapsed>=this._budget&&this._enabled}get budget(){return this._budget}madeProgress(){this._didWork=!0}get state(){return this._state}get enabled(){return this._enabled}set enabled(Ne){this._enabled=Ne}reset(Ne,we){this._begin=this.now(),this._budget=Ne,this._state=we,this._didWork=!1}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._didWork=!1}get hasProgressed(){return this._didWork}}Ge.Budget=je})(Me||(Me={})),function(Ge){Ge.SCHEDULED="s",Ge.READY="r",Ge.WAITING="w",Ge.IDLE="i"}(Ee||(Ee={}));const Te=(()=>{const Ge=new Me.Budget;return Ge.enabled=!1,Ge})(),Ce=new class me{remove(){}processQueue(){}schedule(Je,xe,je){try{if((0,W.Hc)(xe)){const We=(0,W.zE)();return je?Promise.resolve(je(We)):Promise.reject(We)}return(0,W.gx)(Je(Te))}catch(We){return Promise.reject(We)}}reschedule(Je,xe,je){return this.schedule(Je,xe,je)}},Ie=Number.MAX_SAFE_INTEGER},66463:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>B});var x=T(17626),A=T(14517),G=T(77712),J=(T(85931),T(8314),T(90912),T(76898));let W=class extends A.Z{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};(0,x._)([(0,G.Cb)()],W.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,x._)([(0,G.Cb)()],W.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),W=(0,x._)([(0,J.j)("esri.views.support.DebugFlags")],W);const B=new W},396:(dt,Re,T)=>{"use strict";T.d(Re,{Oy:()=>H,SP:()=>oe,UG:()=>ce,aW:()=>W,dU:()=>ue,k0:()=>J,l0:()=>ie,pk:()=>Z,xO:()=>B});var oe,ee,x=T(21286),A=T(67831),G=T(99770);function Q(ee,$){return ee[0]*$[1]-ee[1]*$[0]}function H(ee,$,ne){return Math.abs(($[0]-ee[0])*(ne[1]-ee[1])-($[1]-ee[1])*(ne[0]-ee[0]))/(0,A.j)($,ne)}function J(ee,$,ne,se,ae=ne){return(0,A.g)(Y,se,ne),(0,A.g)(X,$,ae),function re(ee,$,ne){const se=(0,A.h)(ne,$)/(0,A.u)(ne);(0,A.f)(ee,ne,se)}(U,X,Y),(0,A.b)(ee,ae,U)}function W(ee,$,ne,se){(0,A.g)(Y,se,ne),(0,A.g)(X,$,ne);const ae=(0,A.h)(Y,X)/(0,A.u)(Y);return ae>0?(0,A.v)(ee,ne,Y,ae):(0,A.c)(ee,ne)}function B(ee,$,ne,se){(0,A.g)(Y,$,ne);const ae=se/(0,A.o)(Y);return(0,A.v)(ee,ne,Y,ae)}function Z(ee,$){return J(X,$,ee.start,ee.end),(0,x.W8)(X[0],$[0])&&(0,x.W8)(X[1],$[1])?[(0,G.d)($)]:[]}function ie(ee,$,ne){return B(X,ne,ee,$),(0,x.W8)(X[0],ne[0])&&(0,x.W8)(X[1],ne[1])?[(0,G.d)(ne)]:[]}function ue(ee,$){const ne=ee.start,ae=$.start,de=$.end,_e=(0,A.g)(Y,ee.end,ne),pe=(0,A.g)(j,de,ae),he=Q(_e,pe);if(Math.abs(he)<=le)return[];const ge=(0,A.g)(X,ne,ae),ye=Q(pe,ge)/he,Me=Q(_e,ge)/he;if(ye>=0){if(Me>=0||$.type===oe.LINE)return[(0,A.v)(U,ne,_e,ye)]}else if(ee.type===oe.LINE&&(Me>=0||$.type===oe.LINE))return[(0,A.v)(U,ne,_e,ye)];return[]}function ce(ee,$,ne){const se=[],ae=(0,A.g)(Y,ee.end,ee.start),de=(0,A.g)(j,ee.start,$),_e=(0,A.u)(ae),pe=2*(0,A.h)(ae,de),he=pe*pe-4*_e*((0,A.u)(de)-ne*ne);if(0===he){const ge=-pe/(2*_e);(ee.type===oe.LINE||ge>=0)&&se.push((0,A.v)(U,ee.start,ae,ge))}else if(he>0){const ge=Math.sqrt(he),ye=(-pe+ge)/(2*_e);(ee.type===oe.LINE||ye>=0)&&se.push((0,A.v)(U,ee.start,ae,ye));const Me=(-pe-ge)/(2*_e);(ee.type===oe.LINE||Me>=0)&&se.push((0,A.v)(X,ee.start,ae,Me))}return se}(ee=oe||(oe={}))[ee.RAY=0]="RAY",ee[ee.LINE=1]="LINE";const le=1e-6,Y=(0,G.a)(),j=(0,G.a)(),X=(0,G.a)(),U=(0,G.a)()},93579:(dt,Re,T)=>{"use strict";T.d(Re,{Av:()=>H,_1:()=>G,lu:()=>re,rs:()=>Q,tl:()=>A});var x=T(62208);function A(J){return J&&"function"==typeof J.highlight}function G(J){return J&&"function"==typeof J.maskOccludee}function Q(J,W,B){return(0,x.Wi)(J)||J>B&&(0===W||J<W)}function H(J,W){return J>0||W>0}function re(J){var B,Z;const W=J.effectiveScaleRange;return{minScale:null!=(B=null==W?void 0:W.minScale)?B:0,maxScale:null!=(Z=null==W?void 0:W.maxScale)?Z:0}}},41900:(dt,Re,T)=>{"use strict";T.d(Re,{Eu:()=>H,Rw:()=>J,Sj:()=>Q,s6:()=>re,vT:()=>G}),T(8314);var A=T(23841);function G(W){return(0,A.vW)(W.x,W.y)}function Q(W){return(0,A.s1)(W.x,W.y)}function H(W,B){const Z=(W instanceof HTMLElement?W:W.surface).getBoundingClientRect();return(0,A.vW)(B.clientX-Z.left,B.clientY-Z.top)}function re(W,B){return B instanceof Event?H(W,B):G(B)}function J(W){if(W instanceof Event)return!0;if("object"==typeof W&&"type"in W)switch(W.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}},18605:(dt,Re,T)=>{"use strict";T.d(Re,{$3:()=>$,Jl:()=>U,TT:()=>ee,cv:()=>B,r7:()=>X,uz:()=>W,v8:()=>Z}),T(8314);var A=T(21286),G=T(62208);function J(xe,je){const{format:We,quality:Ne,rotation:we,disableDecorations:Oe}=xe||{},$e=ye(xe,je.padding),Be=function pe(xe,je){const We={x:0,y:0,width:je.width,height:je.height};if(xe&&xe.area){null!=xe.area.x&&(We.x=Math.floor(xe.area.x)),null!=xe.area.y&&(We.y=Math.floor(xe.area.y));const Ne=null!=xe.area.width?Math.floor(xe.area.width):null,we=null!=xe.area.height?Math.floor(xe.area.height):null;if(We.width=je.width-We.x,We.height=je.height-We.y,null!=Ne&&null!=we)We.width=Math.min(We.width,Ne),We.height=Math.min(We.height,we);else if(null==Ne&&null!=we){const Oe=Math.min(We.width,Ne);We.height=Oe/We.width*We.height,We.width=Oe}else if(null!=Ne&&null==we){const Oe=Math.min(We.height,we);We.width=Oe/We.height*We.width,We.height=Oe}}return function he(xe,je){const We=Math.floor(Math.max(xe.x,0)),Ne=Math.floor(Math.max(xe.y,0)),we={x:We,y:Ne,width:Math.floor(Math.min(xe.width,je.width-We)),height:Math.floor(Math.min(xe.height,je.height-Ne))},Oe=we.width/we.height,$e=xe.width/xe.height;if($e===Oe)return we;if($e>Oe){const De=Math.floor(we.width/$e);return{x:we.x,y:Math.floor(we.y+(we.height-De)/2),width:we.width,height:De}}const Be=Math.floor(we.height*$e);return{x:Math.floor(we.x+(we.width-Be)/2),y:we.y,width:Be,height:we.height}}(function ge(xe,je){if(!je||null==je.width||null==je.height)return xe;const We=je.width/je.height,Ne=xe.width/xe.height;if(Ne===We)return xe;if(Ne<We){const Oe=Math.floor(xe.height*We);return xe.x-=(Oe-xe.width)/2,xe.width=Oe,xe}const we=Math.floor(xe.width/We);return xe.y-=(we-xe.height)/2,xe.height=we,xe}(We,xe),je)}(xe,{width:je.width-$e.left-$e.right,height:je.height-$e.top-$e.bottom}),{width:Se,height:De}=function _e(xe,je){if(!xe)return je;const We=xe.width,Ne=xe.height;if(null!=We&&null!=Ne)return{width:Math.floor(We),height:Math.floor(Ne)};if(null==We&&null==Ne)return je;const we=je.width/je.height;return null==Ne?{width:Math.floor(We),height:Math.floor(We/we)}:{width:Math.floor(Ne*we),height:Math.floor(Ne)}}(xe,Be),Fe=function Me(xe){switch(xe){case"png":case"jpg":case"jpeg":return xe;default:return Ie}}(We);return{format:Fe,quality:(0,A.uZ)(null!=Ne?Ne:Ge[Fe],0,100),area:Be,width:Se,height:De,rotation:we,disableDecorations:!!Oe,ignoreBackground:!(!xe||!xe.ignoreBackground),ignorePadding:!(!xe||!xe.ignorePadding)}}function W(xe,je){const We=J(xe,je),Ne=We.area,we=We.width/Ne.width,Oe=ye(We,je.padding),$e=Oe.left+Oe.right,Be=Oe.top+Oe.bottom,De=je.height-Be,Fe=Math.floor((je.width-$e)*we+$e),ve=Math.floor(De*we+Be),Ke=xe&&xe.layers?xe.layers:[],qe=We.ignoreBackground,be=We.ignorePadding;return{framebufferWidth:Fe,framebufferHeight:ve,region:{x:Math.floor(Ne.x*we)+Oe.left,y:Math.floor(Ne.y*we)+Oe.top,width:We.width,height:We.height},format:We.format,quality:We.quality,rotation:We.rotation,pixelRatio:we,layers:Ke,disableDecorations:We.disableDecorations,ignoreBackground:qe,ignorePadding:be}}function B(xe,je,We){const{ctx:Ne,canvas:we}=ie(xe,We),Oe=Ne.getImageData(0,0,xe.width,xe.height),$e=function le(xe,je){return xe.toDataURL(me[je.format],je.quality/100)}(we,je);return ue(we),{dataUrl:$e,data:Oe}}function Z(xe,je){const{ctx:We,canvas:Ne}=ie(xe,je),we=We.getImageData(0,0,xe.width,xe.height);return ue(Ne),we}function ie(xe,je){const We=function ce(){return(0,G.Wi)(oe)&&(oe=document.createElement("canvas")),oe}();je.premultipliedAlpha&&function Te(xe){const je=xe.data,We=je.length;for(let Ne=0;Ne<We;Ne+=4){const we=je[Ne+3];if(255!==we&&we>0){const Oe=255/we;je[Ne+0]=je[Ne+0]*Oe,je[Ne+1]=je[Ne+1]*Oe,je[Ne+2]=je[Ne+2]*Oe}}}(xe),We.width=xe.width,We.height=xe.height;const Ne=We.getContext("2d");return Ne.putImageData(xe,0,0),je.flipY&&function Ee(xe){xe.save(),xe.globalCompositeOperation="copy",xe.scale(1,-1),xe.translate(0,-xe.canvas.height),xe.drawImage(xe.canvas,0,0),xe.restore()}(Ne),{ctx:Ne,canvas:We}}function ue(xe){xe.width=0,xe.height=0}let oe=null;function X(xe,je,We){if(!xe||!je)throw new Error("Cannot construct image data without dimensions");if(ae)try{return new ImageData(xe,je)}catch(Ne){ae=!1}return ne(xe,je,We)}function U(xe,je,We,Ne){if(!je||!We)throw new Error("Cannot construct image data without dimensions");if(ae)try{return new ImageData(xe,je,We)}catch(Oe){ae=!1}const we=ne(je,We,Ne);return we.data.set(xe,0),we}function ee(xe,je,We,Ne=0,we=0,Oe=xe.width-Ne,$e=xe.height-we,Be=!1){const{data:Se}=xe,{width:De,height:Fe,data:ve}=je,Ke=Oe/De,qe=$e/Fe,be=Math.ceil(Ke/2),tt=Math.ceil(qe/2),Ye=xe.width;for(let ze=0;ze<Fe;ze++)for(let et=0;et<De;et++){const ke=4*(et+(Be?Fe-ze-1:ze)*De);let ot=0,at=0,yt=0,wt=0,zt=0,Rt=0;const Ft=(ze+.5)*qe;for(let bt=Math.floor(ze*qe);bt<(ze+1)*qe;bt++){const St=Math.abs(Ft-(bt+.5))/tt,Xt=(et+.5)*Ke,Mr=St*St;for(let Cr=Math.floor(et*Ke);Cr<(et+1)*Ke;Cr++){const Yr=Math.abs(Xt-(Cr+.5))/be,Lr=Math.sqrt(Mr+Yr*Yr);if(Lr>=1)continue;let ct=2*Lr*Lr*Lr-3*Lr*Lr+1;const jt=4*(Ne+Cr+(we+bt)*Ye);Rt+=ct*Se[jt+3],at+=ct,!We&&Se[jt+3]<255&&(ct=ct*Se[jt+3]/255),yt+=ct*Se[jt],wt+=ct*Se[jt+1],zt+=ct*Se[jt+2],ot+=ct}}ve[ke]=yt/ot,ve[ke+1]=wt/ot,ve[ke+2]=zt/ot,ve[ke+3]=Rt/at}return je}function $(xe,je,We){if(!je)return xe;const{framebufferWidth:Ne,framebufferHeight:we,pixelRatio:Oe,region:$e}=xe,Be=ye(xe,We),Se=Be.left+Be.right,De=Be.top+Be.bottom,Fe=Ne-Se,ve=we-De,Ke=Math.min(8,Math.min((2048-Se)/Fe,(2048-De)/ve));return Ke<1.5?xe:yi(or({},xe),{framebufferWidth:Math.round(Fe*Ke)+Se,framebufferHeight:Math.round(ve*Ke)+De,pixelRatio:Oe*Ke,resample:{region:{x:Math.round(($e.x-Be.left)*Ke)+Be.left,y:Math.round(($e.y-Be.top)*Ke)+Be.top,width:Math.round($e.width*Ke),height:Math.round($e.height*Ke)},width:Ne,height:we}})}function ne(xe,je,We){return We||(We=function de(){return se||(se=document.createElement("canvas"),se.width=1,se.height=1),se}()),We.getContext("2d").createImageData(xe,je)}let se=null,ae=!0;function ye(xe,je){return!je||xe&&xe.ignorePadding?Je:je}const me={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},Ie="png",Ge={png:100,jpg:98,jpeg:98},Je={top:0,right:0,bottom:0,left:0}},86080:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>G});var x=T(6178),A=T(59617);function G(Q,H){return null!=Q&&(null==H||(H===A.JY.Local?!Q.isGeographic||Q.isWGS84||Q.wkid===x.W.CGCS2000:Q.isWebMercator||Q.isWGS84||Q.wkid===x.W.CGCS2000||Q.wkid===x.W.GCSMARS2000||Q.wkid===x.W.GCSMARS2000_SPHERE||Q.wkid===x.W.GCSMOON2000))}},83994:(dt,Re,T)=>{"use strict";T.d(Re,{f:()=>ie});var x=T(15861),A=T(85931),G=T(63290),Q=T(62208),H=T(55713),re=T(68598),J=T(57596),W=T(67969);const B=G.Z.getLogger("esri.views.webgl.BufferObject");class ie{constructor(ce,oe,le,Y){this._context=ce,this.bufferType=oe,this.usage=le,this._glName=null,this._size=-1,this._indexType=void 0,ce.instanceCounter.increment(W._g.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,re.zu)(this._context.gl),Y&&this.setData(Y)}static createIndex(ce,oe,le){return new ie(ce,W.w0.ELEMENT_ARRAY_BUFFER,oe,le)}static createVertex(ce,oe,le){return new ie(ce,W.w0.ARRAY_BUFFER,oe,le)}static createUniform(ce,oe,le){if(ce.type!==J.zO.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new ie(ce,W.w0.UNIFORM_BUFFER,oe,le)}static createPixelPack(ce,oe=W.l1.STREAM_READ,le){if(ce.type!==J.zO.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const Y=new ie(ce,W.w0.PIXEL_PACK_BUFFER,oe);return le&&Y.setSize(le),Y}static createPixelUnpack(ce,oe=W.l1.STREAM_DRAW,le){if(ce.type!==J.zO.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new ie(ce,W.w0.PIXEL_UNPACK_BUFFER,oe,le)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteSize(){return this.bufferType===W.w0.ELEMENT_ARRAY_BUFFER?this._indexType===W.g.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===W.w0.ELEMENT_ARRAY_BUFFER||this.bufferType===W.w0.ARRAY_BUFFER}dispose(){var ce;(null==(ce=this._context)?void 0:ce.gl)?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(W._g.BufferObject,this),this._context=null):this._glName&&B.warn("Leaked WebGL buffer object")}setSize(ce,oe=null){if(ce<=0&&B.error("Buffer size needs to be positive!"),this.bufferType===W.w0.ELEMENT_ARRAY_BUFFER&&(0,Q.pC)(oe))switch(this._indexType=oe,oe){case W.g.UNSIGNED_SHORT:ce*=2;break;case W.g.UNSIGNED_INT:ce*=4}this._setBufferData(ce)}setData(ce){if(!ce)return;let oe=ce.byteLength;this.bufferType===W.w0.ELEMENT_ARRAY_BUFFER&&((0,H.Uc)(ce)&&(oe/=2,this._indexType=W.g.UNSIGNED_SHORT),(0,H.ZY)(ce)&&(oe/=4,this._indexType=W.g.UNSIGNED_INT)),this._setBufferData(oe,ce)}_setBufferData(ce,oe=null){this._size=ce;const le=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const Y=this._context.gl;(0,Q.pC)(oe)?Y.bufferData(this.bufferType,oe,this.usage):Y.bufferData(this.bufferType,ce,this.usage),(0,re.zu)(Y),this._isVAOAware&&this._context.bindVAO(le)}setSubData(ce,oe=0,le=0,Y=ce.byteLength){if(!ce)return;(oe<0||oe>=this._size)&&B.error("offset is out of range!");let j=oe,X=le,U=Y,ee=ce.byteLength;this.bufferType===W.w0.ELEMENT_ARRAY_BUFFER&&((0,H.Uc)(ce)?(ee/=2,j*=2,X*=2,U*=2):(0,H.ZY)(ce)&&(ee/=4,j*=4,X*=4,U*=4)),void 0===Y&&(Y=ee-1),le>=Y&&B.error("end must be bigger than start!"),oe+le-Y>this._size&&B.error("An attempt to write beyond the end of the buffer!");const $=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const ne=this._context.gl,se=ArrayBuffer.isView(ce)?ce.buffer:ce,ae=0===X&&U===ce.byteLength?se:se.slice(X,U);ne.bufferSubData(this.bufferType,j,ae),(0,re.zu)(ne),this._isVAOAware&&this._context.bindVAO($)}setSubDataFromView(ce,oe,le,Y){if(!ce)return;(oe<0||oe>=this._size)&&B.error("offset is out of range!"),le>=Y&&B.error("end must be bigger than start!"),oe+le-Y>this._size&&B.error("An attempt to write beyond the end of the buffer!");const j=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const X=this._context.gl;if(this._context.type===J.zO.WEBGL2)X.bufferSubData(this.bufferType,oe*ce.BYTES_PER_ELEMENT,ce,le,Y-le);else{const U=0===le&&Y===ce.length?ce:ce.subarray(le,Y);X.bufferSubData(this.bufferType,oe*ce.BYTES_PER_ELEMENT,U)}(0,re.zu)(X),this._isVAOAware&&this._context.bindVAO(j)}getSubData(ce,oe=0,le,Y){if(this._context.type!==J.zO.WEBGL2)return void B.error("Get buffer subdata is supported in WebGL2 only!");if(le<0||Y<0)return void B.error("Problem getting subdata: offset and length were less than zero!");const j=function Z(ue){return(0,A.zG)(ue)}(ce)?ce.BYTES_PER_ELEMENT:1;if(j*((null!=le?le:0)+(null!=Y?Y:0))>ce.byteLength)return void B.error("Problem getting subdata: offset and length exceeded destination size!");oe+j*(null!=Y?Y:0)>this.byteSize&&B.warn("Potential problem getting subdata: requested data exceeds buffer size!");const X=this._context.gl;this._context.bindBuffer(this,W.w0.COPY_READ_BUFFER),X.getBufferSubData(W.w0.COPY_READ_BUFFER,oe,ce,le,Y),this._context.unbindBuffer(W.w0.COPY_READ_BUFFER)}getSubDataAsync(ce,oe=0,le,Y){var j=this;return(0,x.Z)(function*(){j._context.type===J.zO.WEBGL2?(yield j._context.clientWaitAsync(),j.getSubData(ce,oe,le,Y)):B.error("Get buffer subdata is supported in WebGL2 only!")})()}}},85775:(dt,Re,T)=>{"use strict";T.d(Re,{X:()=>ue});var x=T(15861),A=T(63290),G=T(62208),Q=T(83994),H=T(68598),re=T(57596),J=T(67969),W=T(49266),B=T(55086),Z=T(26906);const ie=A.Z.getLogger("esri.views.webgl.FrameBufferObject");class ue{constructor($,ne,se=null,ae=null){var de;if(this._context=$,this._glName=null,this._depthAttachment=null,this._stencilAttachment=null,this._colorAttachments=new Map,this._initialized=!1,this._desc=or({},ne),$.instanceCounter.increment(J._g.FramebufferObject,this),(0,G.pC)(se)){Array.isArray(se)||(se=[se]);for(let _e=0;_e<se.length;++_e){const pe=se[_e],he=J.VY.COLOR_ATTACHMENT0+_e;let ge;le(pe)?(ce(pe)?(ge=pe.descriptor,this._colorAttachments.set(he,pe)):(ge=pe,this._colorAttachments.set(he,new B.x(this._context,ge))),j(ge,this._desc)):(oe(pe)?(ge=pe.descriptor,this._colorAttachments.set(he,pe)):(ge=pe,this._colorAttachments.set(he,new W.r(this._context,ge))),X(ge,this._desc)),this._validateColorAttachmentPoint(he)}}if((0,G.pC)(ae)){let _e,pe;if(le(ae))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),ce(ae)?(pe=ae.descriptor,this._depthStencilTexture=ae):(pe=ae,this._depthStencilTexture=new B.x(this._context,pe)),j(pe,this._desc);else{oe(ae)?(pe=ae.descriptor,_e=ae):(pe=ae,_e=new W.r(this._context,pe));const he=null!=(de=this._desc.depthStencilTarget)?de:J.OU.DEPTH_STENCIL_RENDER_BUFFER;he===J.OU.STENCIL_RENDER_BUFFER?this._stencilAttachment=_e:he===J.OU.DEPTH_RENDER_BUFFER||he===J.OU.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=_e:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),X(pe,this._desc)}}}dispose(){if(!this._desc)return;const $=this._context.getBoundFramebufferObject();this._disposeColorAttachments(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer($),this._context.instanceCounter.decrement(J._g.FramebufferObject,this),this._desc=null}get glName(){return this._glName}get descriptor(){return this._desc}get colorTexture(){const $=this._colorAttachments.get(J.VY.COLOR_ATTACHMENT0);return $&&ce($)?$:null}get colorAttachment(){return this._colorAttachments.get(J.VY.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}get depthStencilTexture(){return this._depthStencilTexture}get width(){return this._desc.width}get height(){return this._desc.height}get gpuMemoryUsage(){return[...this._colorAttachments].reduce(($,[ne,se])=>$+(0,Z.un)(se),0)+(0,Z.un)(this.depthStencilAttachment)}getColorTexture($){const ne=this._colorAttachments.get($);return ne&&ce(ne)?ne:null}attachColorTexture($,ne=J.VY.COLOR_ATTACHMENT0){!$||(this._validateColorAttachmentPoint(ne),j($.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D($.glName,ne)),this._colorAttachments.set(ne,$))}detachColorTexture($=J.VY.COLOR_ATTACHMENT0){const ne=this._colorAttachments.get($);if(ce(ne)){const se=ne;return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,$)),this._colorAttachments.delete($),se}}setColorTextureTarget($,ne=J.VY.COLOR_ATTACHMENT0){const se=this._colorAttachments.get(ne);ce(se)&&this._framebufferTexture2D(se.glName,ne,$)}attachDepthStencilTexture($){if((0,G.Wi)($))return;const ne=$.descriptor;ne.pixelFormat!==J.VI.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),ne.dataType!==J.Br.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),j(ne,this._desc),this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==J.OU.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=J.OU.DEPTH_STENCIL_TEXTURE),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D($.glName,J.Lu)),this._depthStencilTexture=$}detachDepthStencilTexture(){const $=this._depthStencilTexture;return $&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,J.Lu)),this._depthStencilTexture=null,$}attachDepthStencilBuffer($){if((0,G.Wi)($))return;const ne=$.descriptor;if(ne.internalFormat!==J.Tg.DEPTH_STENCIL&&ne.internalFormat!==J.Tg.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),X(ne,this._desc),this._disposeDepthStencilAttachments(),this._desc.depthStencilTarget=ne.internalFormat===J.Tg.DEPTH_STENCIL?J.OU.DEPTH_STENCIL_RENDER_BUFFER:J.OU.DEPTH_RENDER_BUFFER,this._initialized){this._context.bindFramebuffer(this);const se=this._context.gl;se.framebufferRenderbuffer(J.qi.FRAMEBUFFER,this._desc.depthStencilTarget===J.OU.DEPTH_RENDER_BUFFER?se.DEPTH_ATTACHMENT:se.DEPTH_STENCIL_ATTACHMENT,se.RENDERBUFFER,$.glName)}this._depthAttachment=$}detachDepthStencilBuffer(){const $=this._context.gl,ne=this._depthAttachment;return ne&&this._initialized&&(this._context.bindFramebuffer(this),$.framebufferRenderbuffer(J.qi.FRAMEBUFFER,this._desc.depthStencilTarget===J.OU.DEPTH_RENDER_BUFFER?$.DEPTH_ATTACHMENT:$.DEPTH_STENCIL_ATTACHMENT,$.RENDERBUFFER,null)),this._depthAttachment=null,ne}detachAll(){this._colorAttachments.forEach(($,ne)=>this._detachColorAttachment(ne)),this.detachDepthStencilBuffer(),this.detachDepthStencilTexture()}copyToTexture($,ne,se,ae,de,_e,pe){($<0||ne<0||de<0||_e<0)&&console.error("Offsets cannot be negative!"),(se<=0||ae<=0)&&console.error("Copy width and height must be greater than zero!");const he=this._desc,ge=pe.descriptor;pe.descriptor.target!==J.No.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),($+se>he.width||ne+ae>he.height||de+se>ge.width||_e+ae>ge.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const ye=this._context,Me=ye.bindTexture(pe,B.x.TEXTURE_UNIT_FOR_UPDATES);ye.setActiveTexture(B.x.TEXTURE_UNIT_FOR_UPDATES),ye.bindFramebuffer(this),ye.gl.copyTexSubImage2D(J.No.TEXTURE_2D,0,de,_e,$,ne,se,ae),ye.bindTexture(Me,B.x.TEXTURE_UNIT_FOR_UPDATES)}readPixels($,ne,se,ae,de,_e,pe){(se<=0||ae<=0)&&console.error("Copy width and height must be greater than zero!"),pe||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels($,ne,se,ae,de,_e,pe)}readPixelsAsync($,ne,se,ae,de,_e,pe){var he=this;return(0,x.Z)(function*(){if(he._context.type!==re.zO.WEBGL2)return(0,H.hZ)()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void he.readPixels($,ne,se,ae,de,_e,pe);const ge=he._context.gl,ye=Q.f.createPixelPack(he._context,J.l1.STREAM_READ,pe.byteLength);he._context.bindBuffer(ye),he._context.bindFramebuffer(he),ge.readPixels($,ne,se,ae,de,_e,0),he._context.unbindBuffer(J.w0.PIXEL_PACK_BUFFER),yield ye.getSubDataAsync(pe),ye.dispose()})()}resize($,ne){const se=this._desc;if(se.width!==$||se.height!==ne){if(!this._initialized)return se.width=$,se.height=ne,this._colorAttachments.forEach(ae=>{ae&&ae.resize($,ne)}),void(this._depthStencilTexture&&this._depthStencilTexture.resize($,ne));se.width=$,se.height=ne,this._colorAttachments.forEach(ae=>{ae&&ae.resize($,ne)}),null!=this._depthStencilTexture?this._depthStencilTexture.resize($,ne):(this._depthAttachment||this._stencilAttachment)&&(this._depthAttachment&&this._depthAttachment.resize($,ne),this._stencilAttachment&&this._stencilAttachment.resize($,ne)),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1}}initializeAndBind($=J.qi.FRAMEBUFFER){var ye,Me,Ee,Te;const ne=this._context.gl;if(this._initialized)return void ne.bindFramebuffer($,this.glName);this._glName&&ne.deleteFramebuffer(this._glName);const se=this._context,ae=ne.createFramebuffer(),de=this._desc,_e=null!=(ye=de.colorTarget)?ye:J.Lm.RENDER_BUFFER,pe=null!=(Me=de.width)?Me:1,he=null!=(Ee=de.height)?Ee:1;if(ne.bindFramebuffer($,ae),0===this._colorAttachments.size)if(_e===J.Lm.TEXTURE||_e===J.Lm.CUBEMAP)this._colorAttachments.set(J.VY.COLOR_ATTACHMENT0,function Y(ee,$,ne){return new B.x(ee,{target:ne,pixelFormat:J.VI.RGBA,dataType:J.Br.UNSIGNED_BYTE,samplingMode:J.cw.NEAREST,wrapMode:J.e8.CLAMP_TO_EDGE,width:$.width,height:$.height})}(se,de,this.descriptor.colorTarget===J.Lm.CUBEMAP?J.No.TEXTURE_CUBE_MAP:J.No.TEXTURE_2D));else{const me=new W.r(se,{internalFormat:J.lP.RGBA4,width:pe,height:he});this._colorAttachments.set(J.VY.COLOR_ATTACHMENT0,me)}this._colorAttachments.forEach((me,Ce)=>{me&&(ce(me)?this._framebufferTexture2D(me.glName,Ce,U(me),$):ne.framebufferRenderbuffer($,Ce,ne.RENDERBUFFER,me.glName))});const ge=null!=(Te=de.depthStencilTarget)?Te:J.OU.NONE;switch(ge){case J.OU.DEPTH_RENDER_BUFFER:case J.OU.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new W.r(se,{internalFormat:de.depthStencilTarget===J.OU.DEPTH_RENDER_BUFFER?J.Tg.DEPTH_COMPONENT16:J.Tg.DEPTH_STENCIL,width:pe,height:he})),ne.framebufferRenderbuffer($,ge===J.OU.DEPTH_RENDER_BUFFER?ne.DEPTH_ATTACHMENT:ne.DEPTH_STENCIL_ATTACHMENT,ne.RENDERBUFFER,this._depthAttachment.glName);break;case J.OU.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new W.r(se,{internalFormat:J.Tg.STENCIL_INDEX8,width:pe,height:he})),ne.framebufferRenderbuffer($,ne.STENCIL_ATTACHMENT,ne.RENDERBUFFER,this._stencilAttachment.glName);break;case J.OU.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(se.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new B.x(se,{target:J.No.TEXTURE_2D,pixelFormat:J.VI.DEPTH_STENCIL,dataType:J.Br.UNSIGNED_INT_24_8,samplingMode:J.cw.NEAREST,wrapMode:J.e8.CLAMP_TO_EDGE,width:pe,height:he})),this._framebufferTexture2D(this._depthStencilTexture.glName,ne.DEPTH_STENCIL_ATTACHMENT,U(this._depthStencilTexture),$)}(0,H.CG)()&&ne.checkFramebufferStatus($)!==ne.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=ae,this._initialized=!0}_framebufferTexture2D($,ne=J.VY.COLOR_ATTACHMENT0,se=J.No.TEXTURE_2D,ae=J.qi.FRAMEBUFFER,de=0){this._context.gl.framebufferTexture2D(ae,ne,se,$,de)}_detachColorAttachment($){(0,H.hZ)()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const ne=this._context.gl,se=this._colorAttachments.get($);return ce(se)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,$)):this._initialized&&(this._context.bindFramebuffer(this),ne.framebufferRenderbuffer(J.qi.FRAMEBUFFER,$,ne.RENDERBUFFER,null)),this._colorAttachments.delete($),se}_disposeColorAttachments(){this._colorAttachments.forEach(($,ne)=>{this._detachColorAttachment(ne),$.dispose()}),this._colorAttachments.clear()}_disposeDepthStencilAttachments(){const $=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),$.framebufferRenderbuffer(J.qi.FRAMEBUFFER,this._desc.depthStencilTarget===J.OU.DEPTH_RENDER_BUFFER?$.DEPTH_ATTACHMENT:$.DEPTH_STENCIL_ATTACHMENT,$.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null),this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),$.framebufferRenderbuffer(J.qi.FRAMEBUFFER,$.STENCIL_ATTACHMENT,$.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,$.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)}_validateColorAttachmentPoint($){if(-1===ue._MAX_COLOR_ATTACHMENTS){const se=this._context.capabilities.drawBuffers;ue._MAX_COLOR_ATTACHMENTS=se?this._context.gl.getParameter(se.MAX_COLOR_ATTACHMENTS):1}const ne=$-J.VY.COLOR_ATTACHMENT0;ne+1>ue._MAX_COLOR_ATTACHMENTS&&ie.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${ne+1}. Implementation supports up to ${ue._MAX_COLOR_ATTACHMENTS} color attachments`)}}function ce(ee){return"type"in ee&&"texture"===ee.type}function oe(ee){return"type"in ee&&"renderbuffer"===ee.type}function le(ee){return ce(ee)||"pixelFormat"in ee}function j(ee,$){ee.target!==J.No.TEXTURE_2D&&ee.target!==J.No.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),void 0!==$.width&&$.width>=0&&void 0!==$.height&&$.height>=0?$.width===ee.width&&$.height===ee.height||console.error("Color attachment texture must match the framebuffer's!"):($.width=ee.width,$.height=ee.height)}function X(ee,$){void 0!==$.width&&$.width>=0&&void 0!==$.height&&$.height>=0?$.width===ee.width&&$.height===ee.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):($.width=ee.width,$.height=ee.height)}function U(ee){return ee.descriptor.target===J.No.TEXTURE_CUBE_MAP?J.No.TEXTURE_CUBE_MAP_POSITIVE_X:J.No.TEXTURE_2D}ue._MAX_COLOR_ATTACHMENTS=-1},21285:(dt,Re,T)=>{"use strict";T.d(Re,{$:()=>Fe});var x=T(85931),G=(T(8314),T(62208)),Q=T(68598),H=T(57596),re=T(67969);const J=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var B,Z={exports:{}};void 0!==(B=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])&&(Z.exports=B);const ie=Z.exports;var ze,ce={exports:{}};void 0!==(ze=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"])&&(ce.exports=ze);const oe=ce.exports;var et,le={exports:{}};void 0!==(et=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT"])&&(le.exports=et);const Y=le.exports;var j=999,Me=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function me(Ye){return function Te(Ye){var ze=function Ee(){var Ye,ze,et,ke=0,ot=0,at=j,yt=[],wt=[],zt=1,Rt=0,Ft=0,bt=!1,St=!1,Xt="";return function(Zr){return wt=[],null!==Zr?function Cr(Zr){var ri;for(ke=0,et=(Xt+=Zr).length;Ye=Xt[ke],ke<et;){switch(ri=ke,at){case 0:ke="/"===Ye&&"*"===ze?(yt.push(Ye),Mr(yt.join("")),at=j,ke+1):(yt.push(Ye),ze=Ye,ke+1);break;case 1:case 2:ke=jt();break;case 3:ke=Zt();break;case 4:ke="."===Ye||/[eE]/.test(Ye)?(yt.push(Ye),at=5,ze=Ye,ke+1):"x"===Ye&&1===yt.length&&"0"===yt[0]?(at=11,yt.push(Ye),ze=Ye,ke+1):/[^\d]/.test(Ye)?(Mr(yt.join("")),at=j,ke):(yt.push(Ye),ze=Ye,ke+1);break;case 11:ke=/[^a-fA-F0-9]/.test(Ye)?(Mr(yt.join("")),at=j,ke):(yt.push(Ye),ze=Ye,ke+1);break;case 5:"f"===Ye&&(yt.push(Ye),ze=Ye,ke+=1),ke=/[eE]/.test(Ye)||"-"===Ye&&/[eE]/.test(ze)?(yt.push(Ye),ze=Ye,ke+1):/[^\d]/.test(Ye)?(Mr(yt.join("")),at=j,ke):(yt.push(Ye),ze=Ye,ke+1);break;case 9999:ke=Br();break;case 9:ke=/[^\s]/g.test(Ye)?(Mr(yt.join("")),at=j,ke):(yt.push(Ye),ze=Ye,ke+1);break;case j:yt=yt.length?[]:yt,ke="/"===ze&&"*"===Ye?(Ft=ot+ke-1,at=0,ze=Ye,ke+1):"/"===ze&&"/"===Ye?(Ft=ot+ke-1,at=1,ze=Ye,ke+1):"#"===Ye?(at=2,Ft=ot+ke,ke):/\s/.test(Ye)?(at=9,Ft=ot+ke,ke):(bt=/\d/.test(Ye),St=/[^\w_]/.test(Ye),Ft=ot+ke,at=bt?4:St?3:9999,ke)}ri!==ke&&("\n"===Xt[ri]?(Rt=0,++zt):++Rt)}return ot+=ke,Xt=Xt.slice(ke),wt}(Zr.replace?Zr.replace(/\r\n/g,"\n"):Zr):function Yr(Zr){return yt.length&&Mr(yt.join("")),at=10,Mr("(eof)"),wt}()};function Mr(Zr){Zr.length&&wt.push({type:Me[at],data:Zr,position:Ft,line:zt,column:Rt})}function jt(){return"\r"!==Ye&&"\n"!==Ye||"\\"===ze?(yt.push(Ye),ze=Ye,ke+1):(Mr(yt.join("")),at=j,ke)}function Zt(){if("."===ze&&/\d/.test(Ye))return at=5,ke;if("/"===ze&&"*"===Ye)return at=0,ke;if("/"===ze&&"/"===Ye)return at=1,ke;if("."===Ye&&yt.length){for(;tr(yt););return at=5,ke}if(";"===Ye||")"===Ye||"("===Ye){if(yt.length)for(;tr(yt););return Mr(Ye),at=j,ke+1}var Zr=2===yt.length&&"="!==Ye;if(/[\w_\d\s]/.test(Ye)||Zr){for(;tr(yt););return at=j,ke}return yt.push(Ye),ze=Ye,ke+1}function tr(Zr){for(var ri,hr,Dr=0;;){if(ri=oe.indexOf(Zr.slice(0,Zr.length+Dr).join("")),hr=oe[ri],-1===ri){if(Dr--+Zr.length>0)continue;hr=Zr.slice(0,1).join("")}return Mr(hr),Ft+=hr.length,(yt=yt.slice(hr.length)).length}}function Br(){if(/[^\d\w_]/.test(Ye)){var Zr=yt.join("");return at=ie.indexOf(Zr)>-1?8:Y.indexOf(Zr)>-1?7:6,Mr(yt.join("")),at=j,ke}return yt.push(Ye),ze=Ye,ke+1}}(),et=[];return(et=et.concat(ze(Ye))).concat(ze(null))}(Ye)}const Ie=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function Je(Ye,ze){for(let et=ze-1;et>=0;et--){const ke=Ye[et];if("whitespace"!==ke.type&&"block-comment"!==ke.type){if("keyword"!==ke.type)break;if("attribute"===ke.data||"in"===ke.data)return!0}}return!1}function xe(Ye,ze,et,ke){ke=ke||et;for(const ot of Ye)if("ident"===ot.type&&ot.data===et)return ke in ze?ze[ke]++:ze[ke]=0,xe(Ye,ze,ke+"_"+ze[ke],ke);return et}function je(Ye,ze,et="afterVersion"){function ke(zt,Rt){for(let Ft=Rt;Ft<zt.length;Ft++){const bt=zt[Ft];if("operator"===bt.type&&";"===bt.data)return Ft}return null}const at={data:"\n",type:"whitespace"},yt=zt=>zt<Ye.length&&/[^\r\n]$/.test(Ye[zt].data);let wt=function ot(zt){let Rt=-1,Ft=0,bt=-1;for(let St=0;St<zt.length;St++){const Xt=zt[St];if("preprocessor"===Xt.type&&(Xt.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++Ft:Xt.data.match(/\#endif\s*.*/)&&--Ft),"afterVersion"!==et&&"afterPrecision"!==et||"preprocessor"===Xt.type&&/^#version/.test(Xt.data)&&(bt=Math.max(bt,St)),"afterPrecision"===et&&"keyword"===Xt.type&&"precision"===Xt.data){const Mr=ke(zt,St);if(null===Mr)throw new Error("precision statement not followed by any semicolons!");bt=Math.max(bt,Mr)}Rt<bt&&0===Ft&&(Rt=St)}return Rt+1}(Ye);yt(wt-1)&&Ye.splice(wt++,0,at);for(const zt of ze)Ye.splice(wt++,0,zt);yt(wt-1)&&yt(wt)&&Ye.splice(wt,0,at)}function We(Ye,ze,et,ke="lowp"){je(Ye,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:ke},{type:"whitespace",data:" "},{type:"keyword",data:et},{type:"whitespace",data:" "},{type:"ident",data:ze},{type:"operator",data:";"}],"afterPrecision")}function Ne(Ye,ze,et,ke,ot="lowp"){je(Ye,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:ke.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:ot},{type:"whitespace",data:" "},{type:"keyword",data:et},{type:"whitespace",data:" "},{type:"ident",data:ze},{type:"operator",data:";"}],"afterPrecision")}function we(Ye,ze){let et,ke,ot=-1;for(let at=ze;at<Ye.length;at++){const yt=Ye[at];if("operator"===yt.type&&("["===yt.data&&(et=at),"]"===yt.data)){ke=at;break}"integer"===yt.type&&(ot=parseInt(yt.data,10))}return et&&ke&&Ye.splice(et,ke-et+1),ot}function Oe(Ye,ze){if((0,G.pC)(null))return null;const ke=me(Ye);if("300 es"===function Ge(Ye,ze="100",et="300 es"){const ke=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const ot of Ye)if("preprocessor"===ot.type){const at=ke.exec(ot.data);if(at){const yt=at[1].replace(/\s\s+/g," ");if(yt===et)return yt;if(yt===ze)return ot.data="#version "+et,ze;throw new Error("unknown glsl version: "+yt)}}return Ye.splice(0,0,{type:"preprocessor",data:"#version "+et},{type:"whitespace",data:"\n"}),null}(ke,"100","300 es"))return Ye;let ot=null,at=null;const yt={},wt={};for(let zt=0;zt<ke.length;++zt){const Rt=ke[zt];switch(Rt.type){case"keyword":ze===re.Ho.VERTEX_SHADER&&"attribute"===Rt.data?Rt.data="in":"varying"===Rt.data&&(Rt.data=ze===re.Ho.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(Rt.data.trim())&&(Rt.data=Rt.data.replace(/(2D|Cube|EXT)/g,"")),ze===re.Ho.FRAGMENT_SHADER&&"gl_FragColor"===Rt.data&&(ot||(ot=xe(ke,yt,"fragColor"),We(ke,ot,"vec4")),Rt.data=ot),ze===re.Ho.FRAGMENT_SHADER&&"gl_FragData"===Rt.data){const Ft=we(ke,zt+1),bt=xe(ke,yt,"fragData");Ne(ke,bt,"vec4",Ft,"mediump"),Rt.data=bt}else ze===re.Ho.FRAGMENT_SHADER&&"gl_FragDepthEXT"===Rt.data&&(at||(at=xe(ke,yt,"gl_FragDepth")),Rt.data=at);break;case"ident":if(J.includes(Rt.data)){if(ze===re.Ho.VERTEX_SHADER&&Je(ke,zt))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");Rt.data in wt||(wt[Rt.data]=xe(ke,yt,Rt.data)),Rt.data=wt[Rt.data]}}}for(let zt=ke.length-1;zt>=0;--zt){const Rt=ke[zt];if("preprocessor"===Rt.type){const Ft=Rt.data.match(/\#extension\s+(.*)\:/);if(Ft&&Ft[1]&&Ie.includes(Ft[1].trim())){const Xt=ke[zt+1];ke.splice(zt,Xt&&"whitespace"===Xt.type?2:1)}const bt=Rt.data.match(/\#ifdef\s+(.*)/);bt&&bt[1]&&Ie.includes(bt[1].trim())&&(Rt.data="#if 1");const St=Rt.data.match(/\#ifndef\s+(.*)/);St&&St[1]&&Ie.includes(St[1].trim())&&(Rt.data="#if 0")}}return function Se(Ye,ze){return ze}(0,function Ce(Ye){return Ye.map(ze=>"eof"!==ze.type?ze.data:"").join("")}(ke))}class Fe{constructor(ze,et,ke,ot,at=new Map){this._context=ze,this._locations=ot,this._uniformBlockBindings=at,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,ze||console.error("RenderingContext isn't initialized!"),0===et.length&&console.error("Shaders source should not be empty!"),this._context.type===H.zO.WEBGL2&&(et=Oe(et,re.Ho.VERTEX_SHADER),ke=Oe(ke,re.Ho.FRAGMENT_SHADER)),this._vShader=ve(this._context,re.Ho.VERTEX_SHADER,et),this._fShader=ve(this._context,re.Ho.FRAGMENT_SHADER,ke),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(re._g.Shader,this),(0,Q.CG)()&&(this.vertexShader=et,this.fragmentShader=ke)}get glName(){if((0,G.pC)(this._glName))return this._glName;if((0,G.Wi)(this._vShader))return null;const ze=this._context.gl,et=ze.createProgram();if(ze.attachShader(et,this._vShader),ze.attachShader(et,this._fShader),this._locations.forEach((ke,ot)=>ze.bindAttribLocation(et,ke,ot)),ze.linkProgram(et),(0,Q.CG)()&&!ze.getProgramParameter(et,ze.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${ze.getProgramParameter(et,ze.VALIDATE_STATUS)}, gl error ${ze.getError()}, vertex: ${ze.getShaderParameter(this._vShader,ze.COMPILE_STATUS)}, fragment: ${ze.getShaderParameter(this._fShader,ze.COMPILE_STATUS)}, info log: ${ze.getProgramInfoLog(et)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===H.zO.WEBGL2){const ke=ze;for(const[ot,at]of this._uniformBlockBindings){const yt=ke.getUniformBlockIndex(et,ot);yt<4294967295&&ke.uniformBlockBinding(et,yt,at)}}return this._glName=et,this._context.instanceCounter.increment(re._g.Program,this),et}get hasGLName(){return(0,G.pC)(this._glName)}get isCompiled(){if(this._compiled)return!0;const ze=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==ze?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,ze.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const ze=this._context.gl;this._vShader&&(ze.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(re._g.Shader,this)),this._fShader&&(ze.deleteShader(this._fShader),this._fShader=null),this._glName&&(ze.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(re._g.Program,this))}ref(){++this._refCount}_getUniformLocation(ze){return void 0===this._nameToUniformLocation[ze]&&(++tt.numUniforms,this._nameToUniformLocation[ze]=this._context.gl.getUniformLocation(this.glName,ze)),this._nameToUniformLocation[ze]}hasUniform(ze){return null!==this._getUniformLocation(ze)}setUniform1i(ze,et){const ke=this._nameToUniform1[ze];void 0!==ke&&et===ke||(this._context.gl.uniform1i(this._getUniformLocation(ze),et),this._nameToUniform1[ze]=et)}setUniform1iv(ze,et){be(this._nameToUniform1v,ze,et)&&this._context.gl.uniform1iv(this._getUniformLocation(ze),et)}setUniform2iv(ze,et){be(this._nameToUniform2,ze,et)&&this._context.gl.uniform2iv(this._getUniformLocation(ze),et)}setUniform3iv(ze,et){be(this._nameToUniform3,ze,et)&&this._context.gl.uniform3iv(this._getUniformLocation(ze),et)}setUniform4iv(ze,et){be(this._nameToUniform4,ze,et)&&this._context.gl.uniform4iv(this._getUniformLocation(ze),et)}setUniform1f(ze,et){const ke=this._nameToUniform1[ze];void 0!==ke&&et===ke||(this._context.gl.uniform1f(this._getUniformLocation(ze),et),this._nameToUniform1[ze]=et)}setUniform1fv(ze,et){be(this._nameToUniform1v,ze,et)&&this._context.gl.uniform1fv(this._getUniformLocation(ze),et)}setUniform2f(ze,et,ke){const ot=this._nameToUniform2.get(ze);void 0===ot?(this._context.gl.uniform2f(this._getUniformLocation(ze),et,ke),this._nameToUniform2.set(ze,[et,ke])):et===ot[0]&&ke===ot[1]||(this._context.gl.uniform2f(this._getUniformLocation(ze),et,ke),ot[0]=et,ot[1]=ke)}setUniform2fv(ze,et){be(this._nameToUniform2,ze,et)&&this._context.gl.uniform2fv(this._getUniformLocation(ze),et)}setUniform3f(ze,et,ke,ot){const at=this._nameToUniform3.get(ze);void 0===at?(this._context.gl.uniform3f(this._getUniformLocation(ze),et,ke,ot),this._nameToUniform3[ze]=[et,ke,ot]):et===at[0]&&ke===at[1]&&ot===at[2]||(this._context.gl.uniform3f(this._getUniformLocation(ze),et,ke,ot),at[0]=et,at[1]=ke,at[2]=ot)}setUniform3fv(ze,et){be(this._nameToUniform3,ze,et)&&this._context.gl.uniform3fv(this._getUniformLocation(ze),et)}setUniform4f(ze,et,ke,ot,at){const yt=this._nameToUniform4.get(ze);void 0===yt?(this._context.gl.uniform4f(this._getUniformLocation(ze),et,ke,ot,at),this._nameToUniform4.set(ze,[et,ke,ot,at])):void 0!==yt&&et===yt[0]&&ke===yt[1]&&ot===yt[2]&&at===yt[3]||(this._context.gl.uniform4f(this._getUniformLocation(ze),et,ke,ot,at),yt[0]=et,yt[1]=ke,yt[2]=ot,yt[3]=at)}setUniform4fv(ze,et){be(this._nameToUniform4,ze,et)&&this._context.gl.uniform4fv(this._getUniformLocation(ze),et)}setUniformMatrix3fv(ze,et,ke=!1){be(this._nameToUniformMatrix3,ze,et)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(ze),ke,et)}setUniformMatrix4fv(ze,et,ke=!1){be(this._nameToUniformMatrix4,ze,et)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(ze),ke,et)}stop(){}}function ve(Ye,ze,et){const ke=Ye.gl,ot=ke.createShader(ze);return ke.shaderSource(ot,et),ke.compileShader(ot),(0,Q.CG)()&&!ke.getShaderParameter(ot,ke.COMPILE_STATUS)&&(console.error("Compile error in ".concat(ze===re.Ho.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(ke.getShaderInfoLog(ot)),console.error(function Ke(Ye){let ze=2;return Ye.replace(/\n/g,()=>"\n"+function qe(Ye){return Ye>=1e3?Ye.toString():("  "+Ye).slice(-3)}(ze++)+":")}(et))),tt.enabled&&(tt.compiledLOC+=et.match(/\n/g).length+1),ot}function be(Ye,ze,et){const ke=Ye.get(ze);return ke?(0,x.Vx)(ke,et):(Ye.set(ze,Array.from(et)),!0)}const tt={compiledLOC:0,numUniforms:0,enabled:!1}},49266:(dt,Re,T)=>{"use strict";T.d(Re,{r:()=>G});var x=T(57596),A=T(67969);class G{constructor(H,re){this._context=H,this._desc=re,this.type="renderbuffer",this._context.instanceCounter.increment(A._g.Renderbuffer,this);const J=this._context.gl;this.glName=J.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:W,height:B,internalFormat:Z,multisampled:ie}=re;if(ie){if(this._context.type!==x.zO.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");J.renderbufferStorageMultisample(J.RENDERBUFFER,this.samples,Z,W,B)}else J.renderbufferStorage(J.RENDERBUFFER,Z,W,B)}get descriptor(){return this._desc}get samples(){const H=this._desc.samples,re=this._context.parameters.maxSamples;return H?Math.min(H,re):re}resize(H,re){const J=this._desc;if(J.width===H&&J.height===re)return;J.width=H,J.height=re;const W=this._context.gl;this._context.bindRenderbuffer(this),J.multisampled?W.renderbufferStorageMultisample(W.RENDERBUFFER,this.samples,J.internalFormat,J.width,J.height):W.renderbufferStorage(W.RENDERBUFFER,J.internalFormat,J.width,J.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(A._g.Renderbuffer,this),this._context=null)}}},55086:(dt,Re,T)=>{"use strict";T.d(Re,{x:()=>B}),T(8314);var A=T(21286),G=T(62208),Q=T(68598),H=T(57596),re=T(67969),J=T(38210);class B{constructor(X,U,ee=null){if(this._context=X,this.type="texture",this._glName=null,this._descriptor=void 0,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,X.instanceCounter.increment(re._g.Texture,this),this._descriptor=or({target:re.No.TEXTURE_2D,samplingMode:re.cw.LINEAR,wrapMode:re.e8.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1},U),X.type!==H.zO.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),le(this._descriptor.target)))throw new Error("3D and array textures are not supported in WebGL1");this._descriptor.target===re.No.TEXTURE_CUBE_MAP?this._setDataCubeMap(ee):this.setData(ee)}get glName(){return this._glName}get descriptor(){return this._descriptor}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(re._g.Texture,this))}release(){this.dispose()}resize(X,U){const ee=this._descriptor;if(ee.width!==X||ee.height!==U){if(this._wasImmutablyAllocated)throw new Error("Immutable textures can't be resized!");ee.width=X,ee.height=U,this._descriptor.target===re.No.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(X=null){for(let U=re.No.TEXTURE_CUBE_MAP_POSITIVE_X;U<=re.No.TEXTURE_CUBE_MAP_NEGATIVE_Z;U++)this._setData(X,U)}setData(X){this._setData(X)}_setData(X,U){var _e;if(!this._context||!this._context.gl)return;const ee=this._context.gl;this._glName||(this._glName=ee.createTexture()),void 0===X&&(X=null);const $=this._descriptor;null!=U||(U=$.target);const ne=le(U);null===X&&($.width=$.width||4,$.height=$.height||4,ne&&($.depth=null!=(_e=$.depth)?_e:1));const se=this._context.bindTexture(this,B.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(B.TEXTURE_UNIT_FOR_UPDATES),B._validateTexture(this._context,$),this._configurePixelStorage();let de=$.internalFormat?$.internalFormat:this._deriveInternalFormat($.pixelFormat,$.dataType);if(oe(X)){let pe=X.width,he=X.height;const ge=1;X instanceof HTMLVideoElement&&(pe=X.videoWidth,he=X.videoHeight),$.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(U,de,$.hasMipmap,pe,he,ge),this._texImage(U,0,de,pe,he,ge,X),(0,Q.zu)(ee),$.hasMipmap&&this.generateMipmap(),void 0===$.width&&($.width=pe),void 0===$.height&&($.height=he),ne&&void 0===$.depth&&($.depth=ge)}else{const{width:pe,height:he,depth:ge}=$;if(null!=pe&&null!=he||console.error("Width and height must be specified!"),ne&&null==ge&&console.error("Depth must be specified!"),$.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(U,de,$.hasMipmap,pe,he,ge),ee.DEPTH24_STENCIL8&&de===ee.DEPTH_STENCIL&&(de=ee.DEPTH24_STENCIL8),ue(X)){const ye=X.levels,Me=Y(U,pe,he,ge),Ee=Math.min(Me-1,ye.length-1);(0,J.Z)(ee)?ee.texParameteri($.target,ee.TEXTURE_MAX_LEVEL,Ee):$.hasMipmap=$.hasMipmap&&Me===ye.length;const Te=de;if(!function ie(j){return j in re.q_}(Te))throw new Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((me,Ce,Ie,Ge)=>{const Je=ye[Math.min(me,ye.length-1)];this._compressedTexImage(U,me,Te,Ce,Ie,Ge,Je)},Ee)}else(0,G.pC)(X)?(this._texImage(U,0,de,pe,he,ge,X),(0,Q.zu)(ee),$.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((ye,Me,Ee,Te)=>{this._texImage(U,ye,de,Me,Ee,Te,null),(0,Q.zu)(ee)})}B._applySamplingMode(ee,this._descriptor),B._applyWrapMode(ee,this._descriptor),B._applyAnisotropicFilteringParameters(this._context,this._descriptor),(0,Q.zu)(ee),this._context.bindTexture(se,B.TEXTURE_UNIT_FOR_UPDATES)}updateData(X,U,ee,$,ne,se){se||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const ae=this._context.gl,de=this._descriptor,{pixelFormat:_e,internalFormat:pe,dataType:he,isImmutable:ge,target:ye}=de;if(ge&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");const Me=this._context.bindTexture(this,B.TEXTURE_UNIT_FOR_UPDATES);(U<0||ee<0||$>de.width||ne>de.height||U+$>de.width||ee+ne>de.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),oe(se)?ae.texSubImage2D(ye,X,U,ee,_e,he,se):ue(se)?ae.compressedTexSubImage2D(ye,X,U,ee,$,ne,pe,se.levels[X]):ae.texSubImage2D(ye,X,U,ee,$,ne,_e,he,se),this._context.bindTexture(Me,B.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(X,U,ee,$,ne,se,ae,de){de||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const _e=this._context.gl;if(!(0,J.Z)(_e))throw new Error("3D textures are not supported in WebGL1");const pe=this._descriptor,{pixelFormat:he,dataType:ge,isImmutable:ye,target:Me,internalFormat:Ee}=pe;if(ye&&!this._wasImmutablyAllocated)throw new Error("Cannot update immutable texture before allocation!");le(Me)||console.warn("Attempting to set 3D texture data on a non-3D texture");const Te=this._context.bindTexture(this,B.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(B.TEXTURE_UNIT_FOR_UPDATES),(U<0||ee<0||$<0||ne>pe.width||se>pe.height||ae>pe.depth||U+ne>pe.width||ee+se>pe.height||$+ae>pe.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),ue(de)?_e.compressedTexSubImage3D(Me,X,U,ee,$,ne,se,ae,Ee,de=de.levels[X]):_e.texSubImage3D(Me,X,U,ee,$,ne,se,ae,he,ge,de),this._context.bindTexture(Te,B.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const X=this._descriptor;if(!X.hasMipmap){if(this._wasImmutablyAllocated)throw new Error("Cannot add mipmaps to immutable texture after allocation");X.hasMipmap=!0,this._samplingModeDirty=!0,B._validateTexture(this._context,X)}X.samplingMode===re.cw.LINEAR?(this._samplingModeDirty=!0,X.samplingMode=re.cw.LINEAR_MIPMAP_NEAREST):X.samplingMode===re.cw.NEAREST&&(this._samplingModeDirty=!0,X.samplingMode=re.cw.NEAREST_MIPMAP_NEAREST);const U=this._context.bindTexture(this,B.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(B.TEXTURE_UNIT_FOR_UPDATES),this._context.gl.generateMipmap(X.target),this._context.bindTexture(U,B.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(X){X!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=X,this._samplingModeDirty=!0)}setWrapMode(X){X!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=X,B._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const X=this._context.gl,U=this._descriptor;this._samplingModeDirty&&(B._applySamplingMode(X,U),this._samplingModeDirty=!1),this._wrapModeDirty&&(B._applyWrapMode(X,U),this._wrapModeDirty=!1)}_deriveInternalFormat(X,U){if(this._context.type===H.zO.WEBGL1)return X;switch(U){case re.Br.FLOAT:switch(X){case re.VI.RGBA:return re.lP.RGBA32F;case re.VI.RGB:return re.lP.RGB32F;default:throw new Error("Unable to derive format")}case re.Br.UNSIGNED_BYTE:switch(X){case re.VI.RGBA:return re.lP.RGBA8;case re.VI.RGB:return re.lP.RGB8}default:return X}}_configurePixelStorage(){const X=this._context.gl,{unpackAlignment:U,flipped:ee,preMultiplyAlpha:$}=this._descriptor;X.pixelStorei(X.UNPACK_ALIGNMENT,U),X.pixelStorei(X.UNPACK_FLIP_Y_WEBGL,ee?1:0),X.pixelStorei(X.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$?1:0)}_texStorage(X,U,ee,$,ne,se){const ae=this._context.gl;if(!(0,J.Z)(ae))throw new Error("Immutable textures are not supported in WebGL1");if(!function Z(j){return j in re.lP}(U))throw new Error("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const de=ee?Y(X,$,ne,se):1;le(X)?ae.texStorage3D(X,de,U,$,ne,se):ae.texStorage2D(X,de,U,$,ne),this._wasImmutablyAllocated=!0}_texImage(X,U,ee,$,ne,se,ae){const de=this._context.gl;let _e=null;const pe=this._context.type===H.zO.WEBGL2,he=le(X),{isImmutable:ge,pixelFormat:ye,dataType:Me}=this._descriptor;if(pe&&(_e=de),pe||!oe(ae))if(ge){if((0,G.pC)(ae)){const Ee=ae;he?_e.texSubImage3D(X,U,0,0,0,$,ne,se,ye,Me,Ee):de.texSubImage2D(X,U,0,0,$,ne,ye,Me,Ee)}}else{const Ee=(0,G.Wg)(ae);he?_e.texImage3D(X,U,ee,$,ne,se,0,ye,Me,Ee):de.texImage2D(X,U,ee,$,ne,0,ye,Me,Ee)}else de.texImage2D(X,0,ee,ye,Me,ae)}_compressedTexImage(X,U,ee,$,ne,se,ae){const de=this._context.gl;let _e=null;const pe=le(X),he=this._descriptor.isImmutable;if(pe){if(this._context.type!==H.zO.WEBGL2)throw new Error("3D textures are not supported in WebGL1");_e=de}he?(0,G.pC)(ae)&&(pe?_e.compressedTexSubImage3D(X,U,0,0,0,$,ne,se,ee,ae):de.compressedTexSubImage2D(X,U,0,0,$,ne,ee,ae)):pe?_e.compressedTexImage3D(X,U,ee,$,ne,se,0,ae):de.compressedTexImage2D(X,U,ee,$,ne,0,ae)}_forEachMipmapLevel(X,U=1/0){let{width:ee,height:$,depth:ne,hasMipmap:se,target:ae}=this._descriptor;const de=ae===re.No.TEXTURE_3D;for(let _e=0;X(_e,ee,$,ne),se&&(1!==ee||1!==$||de&&1!==ne)&&!(_e>=U);++_e)ee=Math.max(1,ee>>1),$=Math.max(1,$>>1),de&&(ne=Math.max(1,ne>>1))}static _validateTexture(X,U){(U.width<0||U.height<0||U.depth<0)&&console.error("Negative dimension parameters are not allowed!");const ee=(0,J.Z)(X.gl),$=(0,A.wt)(U.width)&&(0,A.wt)(U.height);ee||!U.isImmutable&&!le(U.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),ee||$||("number"==typeof U.wrapMode?U.wrapMode!==re.e8.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):U.wrapMode.s===re.e8.CLAMP_TO_EDGE&&U.wrapMode.t===re.e8.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),U.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))}static _applySamplingMode(X,U){let ee=U.samplingMode,$=U.samplingMode;ee===re.cw.LINEAR_MIPMAP_NEAREST||ee===re.cw.LINEAR_MIPMAP_LINEAR?(ee=re.cw.LINEAR,U.hasMipmap||($=re.cw.LINEAR)):ee!==re.cw.NEAREST_MIPMAP_NEAREST&&ee!==re.cw.NEAREST_MIPMAP_LINEAR||(ee=re.cw.NEAREST,U.hasMipmap||($=re.cw.NEAREST)),X.texParameteri(U.target,X.TEXTURE_MAG_FILTER,ee),X.texParameteri(U.target,X.TEXTURE_MIN_FILTER,$)}static _applyWrapMode(X,U){"number"==typeof U.wrapMode?(X.texParameteri(U.target,X.TEXTURE_WRAP_S,U.wrapMode),X.texParameteri(U.target,X.TEXTURE_WRAP_T,U.wrapMode)):(X.texParameteri(U.target,X.TEXTURE_WRAP_S,U.wrapMode.s),X.texParameteri(U.target,X.TEXTURE_WRAP_T,U.wrapMode.t))}static _applyAnisotropicFilteringParameters(X,U){var $;const ee=X.capabilities.textureFilterAnisotropic;!ee||X.gl.texParameterf(U.target,ee.TEXTURE_MAX_ANISOTROPY,null!=($=U.maxAnisotropy)?$:1)}}function ue(j){return(0,G.pC)(j)&&"type"in j&&"compressed"===j.type}function oe(j){return(0,G.pC)(j)&&!ue(j)&&!function ce(j){return(0,G.pC)(j)&&"byteLength"in j}(j)}function le(j){return j===re.No.TEXTURE_3D||j===re.No.TEXTURE_2D_ARRAY}function Y(j,X,U,ee=1){let $=Math.max(X,U);return j===re.No.TEXTURE_3D&&($=Math.max($,ee)),Math.round(Math.log($)/Math.LN2)+1}B.TEXTURE_UNIT_FOR_UPDATES=0},26906:(dt,Re,T)=>{"use strict";T.d(Re,{HH:()=>Q,RG:()=>B,UF:()=>W,XP:()=>J,_V:()=>H,un:()=>Z}),T(8314);var A=T(62208),G=T(67969);function Q(ie){const ue=ie.gl;switch(ue.getError()){case ue.NO_ERROR:return null;case ue.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case ue.INVALID_VALUE:return"A numeric argument is out of range";case ue.INVALID_OPERATION:return"The specified command is not allowed for the current state";case ue.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case ue.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case ue.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function H(ie,ue){return ie.vertexBuffers[ue].size/function re(ie){return ie[0].stride}(ie.layout[ue])}function J(ie,ue,ce,oe,le=0){const Y=ie.gl,j=ie.capabilities.instancing;ie.bindBuffer(ce);for(const X of oe){const U=ue.get(X.name);void 0===U&&console.error(`There is no location for vertex attribute '${X.name}' defined.`);const ee=le*X.stride;if(X.count<=4)Y.vertexAttribPointer(U,X.count,X.type,X.normalized,X.stride,X.offset+ee),Y.enableVertexAttribArray(U),X.divisor>0&&j&&j.vertexAttribDivisor(U,X.divisor);else if(9===X.count)for(let $=0;$<3;$++)Y.vertexAttribPointer(U+$,3,X.type,X.normalized,X.stride,X.offset+12*$+ee),Y.enableVertexAttribArray(U+$),X.divisor>0&&j&&j.vertexAttribDivisor(U+$,X.divisor);else if(16===X.count)for(let $=0;$<4;$++)Y.vertexAttribPointer(U+$,4,X.type,X.normalized,X.stride,X.offset+16*$+ee),Y.enableVertexAttribArray(U+$),X.divisor>0&&j&&j.vertexAttribDivisor(U+$,X.divisor);else console.error("Unsupported vertex attribute element count: "+X.count)}}function W(ie,ue,ce,oe){const le=ie.gl,Y=ie.capabilities.instancing;ie.bindBuffer(ce);for(const j of oe){const X=ue.get(j.name);if(j.count<=4)le.disableVertexAttribArray(X),j.divisor&&j.divisor>0&&Y&&Y.vertexAttribDivisor(X,0);else if(9===j.count)for(let U=0;U<3;U++)le.disableVertexAttribArray(X+U),j.divisor&&j.divisor>0&&Y&&Y.vertexAttribDivisor(X+U,0);else if(16===j.count)for(let U=0;U<4;U++)le.disableVertexAttribArray(X+U),j.divisor&&j.divisor>0&&Y&&Y.vertexAttribDivisor(X+U,0);else console.error("Unsupported vertex attribute element count: "+j.count)}ie.unbindBuffer(G.w0.ARRAY_BUFFER)}function B(ie){switch(ie){case G.VI.ALPHA:case G.VI.LUMINANCE:case G.VI.RED:case G.VI.RED_INTEGER:case G.lP.R8:case G.lP.R8I:case G.lP.R8UI:case G.lP.R8_SNORM:case G.Tg.STENCIL_INDEX8:return 1;case G.VI.LUMINANCE_ALPHA:case G.VI.RG:case G.VI.RG_INTEGER:case G.lP.RGBA4:case G.lP.R16F:case G.lP.R16I:case G.lP.R16UI:case G.lP.RG8:case G.lP.RG8I:case G.lP.RG8UI:case G.lP.RG8_SNORM:case G.lP.RGB565:case G.lP.RGB5_A1:case G.Tg.DEPTH_COMPONENT16:return 2;case G.VI.DEPTH_COMPONENT:case G.VI.RGB:case G.VI.RGB_INTEGER:case G.lP.RGB8:case G.lP.RGB8I:case G.lP.RGB8UI:case G.lP.RGB8_SNORM:case G.lP.SRGB8:case G.Tg.DEPTH_COMPONENT24:return 3;case G.VI.DEPTH_STENCIL:case G.VI.RGBA:case G.VI.RGBA_INTEGER:case G.lP.RGBA8:case G.lP.R32F:case G.lP.R11F_G11F_B10F:case G.lP.RG16F:case G.lP.R32I:case G.lP.R32UI:case G.lP.RG16I:case G.lP.RG16UI:case G.lP.RGBA8I:case G.lP.RGBA8UI:case G.lP.RGBA8_SNORM:case G.lP.SRGB8_ALPHA8:case G.lP.RGB9_E5:case G.lP.RGB10_A2UI:case G.lP.RGB10_A2:case G.Tg.DEPTH_STENCIL:case G.Tg.DEPTH_COMPONENT32F:case G.Tg.DEPTH24_STENCIL8:return 4;case G.Tg.DEPTH32F_STENCIL8:return 5;case G.lP.RGB16F:case G.lP.RGB16I:case G.lP.RGB16UI:return 6;case G.lP.RG32F:case G.lP.RG32I:case G.lP.RG32UI:case G.lP.RGBA16F:case G.lP.RGBA16I:case G.lP.RGBA16UI:return 8;case G.lP.RGB32F:case G.lP.RGB32I:case G.lP.RGB32UI:return 12;case G.lP.RGBA32F:case G.lP.RGBA32I:case G.lP.RGBA32UI:return 16;case G.q_.COMPRESSED_RGB_S3TC_DXT1_EXT:case G.q_.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case G.q_.COMPRESSED_RGBA_S3TC_DXT3_EXT:case G.q_.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case G.q_.COMPRESSED_R11_EAC:case G.q_.COMPRESSED_SIGNED_R11_EAC:case G.q_.COMPRESSED_RGB8_ETC2:case G.q_.COMPRESSED_SRGB8_ETC2:case G.q_.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case G.q_.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case G.q_.COMPRESSED_RG11_EAC:case G.q_.COMPRESSED_SIGNED_RG11_EAC:case G.q_.COMPRESSED_RGBA8_ETC2_EAC:case G.q_.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function Z(ie){if((0,A.Wi)(ie))return 0;if("descriptor"in ie)return ie.glName?Z(ie.descriptor):0;const ue=ie.internalFormat||"pixelFormat"in ie&&ie.pixelFormat;if(!ue)return 0;const ce="hasMipmap"in ie&&ie.hasMipmap?1.3:1,oe=ie.width*ie.height;return B(ue)*oe*ce}},49353:(dt,Re,T)=>{"use strict";T.d(Re,{U:()=>re});var x=T(63290),A=T(62208),G=T(67969),Q=T(26906);const H=x.Z.getLogger("esri.views.webgl.VertexArrayObject");class re{constructor(W,B,Z,ie,ue=null){this._context=W,this._locations=B,this._layout=Z,this._buffers=ie,this._indexBuffer=ue,this._glName=null,this._initialized=!1,W.instanceCounter.increment(G._g.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get size(){return Object.keys(this._buffers).reduce((W,B)=>W+this._buffers[B].size,(0,A.pC)(this._indexBuffer)?this._indexBuffer.size:0)}get layout(){return this._layout}get locations(){return this._locations}dispose(W=!0){var B,Z;if(this._context){if(this._glName){const ie=null==(Z=null==(B=this._context)?void 0:B.capabilities)?void 0:Z.vao;ie?(ie.deleteVertexArray(this._glName),this._glName=null):H.warn("Leaked WebGL VAO")}if(this._context.getBoundVAO()===this&&this._context.bindVAO(null),W){for(const ie in this._buffers)this._buffers[ie].dispose(),delete this._buffers[ie];this._indexBuffer=(0,A.O3)(this._indexBuffer)}this._context.instanceCounter.decrement(G._g.VertexArrayObject,this),this._context=null}else(this._glName||W&&Object.getOwnPropertyNames(this._buffers).length>0)&&H.warn("Leaked WebGL VAO")}initialize(){if(this._initialized)return;const W=this._context.capabilities.vao;if(W){const B=W.createVertexArray();W.bindVertexArray(B),this._bindLayout(),W.bindVertexArray(null),this._glName=B}this._initialized=!0}bind(){this.initialize();const W=this._context.capabilities.vao;W?W.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:W,_layout:B,_indexBuffer:Z}=this;W||H.error("Vertex buffer dictionary is empty!");const ie=this._context.gl;for(const ue in W){const ce=W[ue];ce||H.error("Vertex buffer is uninitialized!");const oe=B[ue];oe||H.error("Vertex element descriptor is empty!"),(0,Q.XP)(this._context,this._locations,ce,oe)}(0,A.pC)(Z)&&(this._context.capabilities.vao?ie.bindBuffer(ie.ELEMENT_ARRAY_BUFFER,Z.glName):this._context.bindBuffer(Z))}unbind(){this.initialize();const W=this._context.capabilities.vao;W?W.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:W,_layout:B}=this;W||H.error("Vertex buffer dictionary is empty!");for(const Z in W){const ie=W[Z];ie||H.error("Vertex buffer is uninitialized!"),(0,Q.UF)(this._context,this._locations,ie,B[Z])}(0,A.pC)(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}},40852:(dt,Re,T)=>{"use strict";T.d(Re,{G:()=>x});class x{constructor(G,Q,H,re,J,W=!1,B=0){this.name=G,this.count=Q,this.type=H,this.offset=re,this.stride=J,this.normalized=W,this.divisor=B}}},31637:(dt,Re,T)=>{"use strict";T.d(Re,{hc:()=>H});var x=T(62208),A=T(57596);let G,Q;function H(le){const Y=(0,A.Sh)(le);for(;Y.length>1;){const j=re(Y.shift());if(j.available)return j}return re(Y.shift())}function re(le){switch(le){case A.zO.WEBGL1:return function J(){return G||(G=function ce(){const le=new Z,Y=ue(A.zO.WEBGL1,le);return(0,x.Wi)(Y)||(le.supportsElementIndexUint=null!==Y.getExtension("OES_element_index_uint"),le.supportsStandardDerivatives=null!==Y.getExtension("OES_standard_derivatives"),le.supportsInstancedArrays=null!==Y.getExtension("ANGLE_instanced_arrays"),le.supportsTextureFloat=null!==Y.getExtension("OES_texture_float"),le.supportsTextureHalfFloat=null!==Y.getExtension("OES_texture_half_float"),le.supportsColorBufferFloat=null!==Y.getExtension("WEBGL_color_buffer_float"),le.supportsColorBufferFloatBlend=null!==Y.getExtension("EXT_float_blend"),le.supportsColorBufferHalfFloat=null!==Y.getExtension("EXT_color_buffer_half_float")),le}()),G}();case A.zO.WEBGL2:return function W(){return Q||(Q=function oe(){const le=new ie,Y=ue(A.zO.WEBGL2,le);return(0,x.Wi)(Y)||(le.supportsColorBufferFloat=null!==Y.getExtension("EXT_color_buffer_float"),le.supportsColorBufferFloatBlend=null!==Y.getExtension("EXT_float_blend"),le.supportsColorBufferHalfFloat=le.supportsColorBufferFloat||null!==Y.getExtension("EXT_color_buffer_half_float")),le}()),Q}()}}class B{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}}class Z extends B{constructor(){super(...arguments),this.type=A.zO.WEBGL1}}class ie extends B{constructor(){super(...arguments),this.type=A.zO.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}}function ue(le,Y){var ee;if(le===A.zO.WEBGL1&&void 0===typeof WebGLRenderingContext||le===A.zO.WEBGL2&&void 0===typeof WebGL2RenderingContext)return null;const j=document.createElement("canvas");if(!j)return null;let X=(0,A.kr)(j,le,{failIfMajorPerformanceCaveat:!0});if((0,x.Wi)(X)&&(X=(0,A.kr)(j,le),(0,x.pC)(X)&&(Y.majorPerformanceCaveat=!0)),(0,x.Wi)(X))return X;if(le===A.zO.WEBGL1){const $=null==(ee=X.getParameter(X.VERSION))?void 0:ee.match(/^WebGL\s+([\d.]*)/);if($){const ne=parseFloat($[1]);Y.available=ne>=.94}}else Y.available=!0;Y.maxTextureSize=X.getParameter(X.MAX_TEXTURE_SIZE),Y.supportsVertexShaderSamplers=X.getParameter(X.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const U=X.getShaderPrecisionFormat(X.FRAGMENT_SHADER,X.HIGH_FLOAT);return U&&(Y.supportsHighPrecisionFragment=U.precision>0),X}},38210:(dt,Re,T)=>{"use strict";function x(A){return window.WebGL2RenderingContext&&A instanceof window.WebGL2RenderingContext}T.d(Re,{Z:()=>x})},68598:(dt,Re,T)=>{"use strict";T.d(Re,{CG:()=>W,hZ:()=>J,zu:()=>B});var x=T(26584),A=T(8314);const Q=T(63290).Z.getLogger("esri/views/webgl"),re=!!(0,A.Z)("enable-feature:webgl-debug");function J(){return re}function W(){return re}function B(Z){if(J()){const ie=Z.getError();if(ie){const ue=function H(Z,ie){switch(ie){case Z.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case Z.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case Z.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case Z.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case Z.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case Z.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}(Z,ie),ce=(new Error).stack;Q.error(new x.Z("webgl-error","WebGL error occured",{message:ue,stack:ce}))}}}},57596:(dt,Re,T)=>{"use strict";T.d(Re,{Sh:()=>H,kr:()=>J,sj:()=>Q,zO:()=>G});var G,ie,x=T(8314),A=T(62208);function Q(ie,ue,ce={}){const oe=H(ie);for(;oe.length>1;){const le=J(ue,oe.shift(),ce);if((0,A.pC)(le))return le}return function re(ie,ue,ce={}){if(!window.WebGLRenderingContext)return W(ie,B),null;const oe=J(ie,ue,ce);return(0,A.Wi)(oe)&&W(ie,Z),oe}(ue,oe.shift(),ce)}function H(ie){const ue=(0,x.Z)("esri-force-webgl");if(ue===G.WEBGL1||ue===G.WEBGL2)return[ue];switch(ie){case"2d":return(0,x.Z)("mac")&&(0,x.Z)("chrome")?[G.WEBGL1,G.WEBGL2]:[G.WEBGL2,G.WEBGL1];case"3d":return[G.WEBGL2,G.WEBGL1]}}function J(ie,ue,ce={}){const oe=ue===G.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let le=null;for(const Y of oe){try{le=ie.getContext(Y,ce)}catch(j){}if(le)break}return le}function W(ie,ue){const ce=ie.parentNode;ce&&(ce.innerHTML='<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+ue+"</div></div></td></tr></table>")}(ie=G||(G={}))[ie.WEBGL1=1]="WEBGL1",ie[ie.WEBGL2=2]="WEBGL2";const B='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',Z='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>'},2757:(dt,Re,T)=>{"use strict";function x(re,J,W){for(let B=0;B<W;++B)J[2*B]=re[B],J[2*B+1]=re[B]-J[2*B]}function G(re,J){const W=re.length;for(let B=0;B<W;++B)H[0]=re[B],J[B]=H[0];return J}function Q(re,J){const W=re.length;for(let B=0;B<W;++B)H[0]=re[B],H[1]=re[B]-H[0],J[B]=H[1];return J}T.d(Re,{GB:()=>Q,LF:()=>x,U8:()=>G});const H=new Float32Array(2)},67969:(dt,Re,T)=>{"use strict";var x,A,G,Q,H,re,J,W,B,Z,ie,ue,ce,oe,le,Y,j,X,U,ee,$,ne,me;T.d(Re,{Br:()=>Y,Ho:()=>U,LR:()=>re,Ld:()=>se,Lm:()=>$,Lu:()=>_e,MX:()=>A,No:()=>ce,OU:()=>ne,Se:()=>he,Tg:()=>j,V7:()=>Ee,VI:()=>oe,VY:()=>de,Wf:()=>J,Y5:()=>Me,_g:()=>ae,cw:()=>ie,db:()=>Q,e8:()=>ue,g:()=>W,l1:()=>X,lP:()=>le,lk:()=>x,q_:()=>pe,qi:()=>ee,w0:()=>H,wb:()=>B,xS:()=>Z,zi:()=>G}),(me=x||(x={}))[me.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",me[me.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",me[me.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",function(me){me[me.POINTS=0]="POINTS",me[me.LINES=1]="LINES",me[me.LINE_LOOP=2]="LINE_LOOP",me[me.LINE_STRIP=3]="LINE_STRIP",me[me.TRIANGLES=4]="TRIANGLES",me[me.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",me[me.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(A||(A={})),function(me){me[me.ZERO=0]="ZERO",me[me.ONE=1]="ONE",me[me.SRC_COLOR=768]="SRC_COLOR",me[me.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",me[me.SRC_ALPHA=770]="SRC_ALPHA",me[me.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",me[me.DST_ALPHA=772]="DST_ALPHA",me[me.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",me[me.DST_COLOR=774]="DST_COLOR",me[me.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",me[me.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",me[me.CONSTANT_COLOR=32769]="CONSTANT_COLOR",me[me.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",me[me.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",me[me.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(G||(G={})),function(me){me[me.ADD=32774]="ADD",me[me.SUBTRACT=32778]="SUBTRACT",me[me.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(Q||(Q={})),function(me){me[me.ARRAY_BUFFER=34962]="ARRAY_BUFFER",me[me.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",me[me.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",me[me.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",me[me.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",me[me.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",me[me.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(H||(H={})),function(me){me[me.FRONT=1028]="FRONT",me[me.BACK=1029]="BACK",me[me.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(re||(re={})),function(me){me[me.CW=2304]="CW",me[me.CCW=2305]="CCW"}(J||(J={})),function(me){me[me.BYTE=5120]="BYTE",me[me.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",me[me.SHORT=5122]="SHORT",me[me.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",me[me.INT=5124]="INT",me[me.UNSIGNED_INT=5125]="UNSIGNED_INT",me[me.FLOAT=5126]="FLOAT"}(W||(W={})),function(me){me[me.NEVER=512]="NEVER",me[me.LESS=513]="LESS",me[me.EQUAL=514]="EQUAL",me[me.LEQUAL=515]="LEQUAL",me[me.GREATER=516]="GREATER",me[me.NOTEQUAL=517]="NOTEQUAL",me[me.GEQUAL=518]="GEQUAL",me[me.ALWAYS=519]="ALWAYS"}(B||(B={})),function(me){me[me.ZERO=0]="ZERO",me[me.KEEP=7680]="KEEP",me[me.REPLACE=7681]="REPLACE",me[me.INCR=7682]="INCR",me[me.DECR=7683]="DECR",me[me.INVERT=5386]="INVERT",me[me.INCR_WRAP=34055]="INCR_WRAP",me[me.DECR_WRAP=34056]="DECR_WRAP"}(Z||(Z={})),function(me){me[me.NEAREST=9728]="NEAREST",me[me.LINEAR=9729]="LINEAR",me[me.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",me[me.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",me[me.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",me[me.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(ie||(ie={})),function(me){me[me.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",me[me.REPEAT=10497]="REPEAT",me[me.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(ue||(ue={})),function(me){me[me.TEXTURE_2D=3553]="TEXTURE_2D",me[me.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",me[me.TEXTURE_3D=32879]="TEXTURE_3D",me[me.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",me[me.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",me[me.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",me[me.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",me[me.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",me[me.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",me[me.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(ce||(ce={})),function(me){me[me.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",me[me.DEPTH_STENCIL=34041]="DEPTH_STENCIL",me[me.ALPHA=6406]="ALPHA",me[me.RGB=6407]="RGB",me[me.RGBA=6408]="RGBA",me[me.LUMINANCE=6409]="LUMINANCE",me[me.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",me[me.RED=6403]="RED",me[me.RG=33319]="RG",me[me.RED_INTEGER=36244]="RED_INTEGER",me[me.RG_INTEGER=33320]="RG_INTEGER",me[me.RGB_INTEGER=36248]="RGB_INTEGER",me[me.RGBA_INTEGER=36249]="RGBA_INTEGER"}(oe||(oe={})),function(me){me[me.RGBA4=32854]="RGBA4",me[me.R16F=33325]="R16F",me[me.RG16F=33327]="RG16F",me[me.RGB32F=34837]="RGB32F",me[me.RGBA16F=34842]="RGBA16F",me[me.R32F=33326]="R32F",me[me.RG32F=33328]="RG32F",me[me.RGBA32F=34836]="RGBA32F",me[me.R11F_G11F_B10F=35898]="R11F_G11F_B10F",me[me.RGB8=32849]="RGB8",me[me.RGBA8=32856]="RGBA8",me[me.RGB5_A1=32855]="RGB5_A1",me[me.R8=33321]="R8",me[me.RG8=33323]="RG8",me[me.R8I=33329]="R8I",me[me.R8UI=33330]="R8UI",me[me.R16I=33331]="R16I",me[me.R16UI=33332]="R16UI",me[me.R32I=33333]="R32I",me[me.R32UI=33334]="R32UI",me[me.RG8I=33335]="RG8I",me[me.RG8UI=33336]="RG8UI",me[me.RG16I=33337]="RG16I",me[me.RG16UI=33338]="RG16UI",me[me.RG32I=33339]="RG32I",me[me.RG32UI=33340]="RG32UI",me[me.RGB16F=34843]="RGB16F",me[me.RGB9_E5=35901]="RGB9_E5",me[me.SRGB8=35905]="SRGB8",me[me.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",me[me.RGB565=36194]="RGB565",me[me.RGBA32UI=36208]="RGBA32UI",me[me.RGB32UI=36209]="RGB32UI",me[me.RGBA16UI=36214]="RGBA16UI",me[me.RGB16UI=36215]="RGB16UI",me[me.RGBA8UI=36220]="RGBA8UI",me[me.RGB8UI=36221]="RGB8UI",me[me.RGBA32I=36226]="RGBA32I",me[me.RGB32I=36227]="RGB32I",me[me.RGBA16I=36232]="RGBA16I",me[me.RGB16I=36233]="RGB16I",me[me.RGBA8I=36238]="RGBA8I",me[me.RGB8I=36239]="RGB8I",me[me.R8_SNORM=36756]="R8_SNORM",me[me.RG8_SNORM=36757]="RG8_SNORM",me[me.RGB8_SNORM=36758]="RGB8_SNORM",me[me.RGBA8_SNORM=36759]="RGBA8_SNORM",me[me.RGB10_A2=32857]="RGB10_A2",me[me.RGB10_A2UI=36975]="RGB10_A2UI"}(le||(le={})),function(me){me[me.FLOAT=5126]="FLOAT",me[me.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",me[me.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",me[me.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",me[me.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",me[me.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",me[me.BYTE=5120]="BYTE",me[me.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",me[me.SHORT=5122]="SHORT",me[me.UNSIGNED_INT=5125]="UNSIGNED_INT",me[me.INT=5124]="INT",me[me.HALF_FLOAT=5131]="HALF_FLOAT",me[me.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",me[me.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",me[me.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",me[me.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Y||(Y={})),function(me){me[me.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",me[me.STENCIL_INDEX8=36168]="STENCIL_INDEX8",me[me.DEPTH_STENCIL=34041]="DEPTH_STENCIL",me[me.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",me[me.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",me[me.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",me[me.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(j||(j={})),function(me){me[me.STATIC_DRAW=35044]="STATIC_DRAW",me[me.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",me[me.STREAM_DRAW=35040]="STREAM_DRAW",me[me.STATIC_READ=35045]="STATIC_READ",me[me.DYNAMIC_READ=35049]="DYNAMIC_READ",me[me.STREAM_READ=35041]="STREAM_READ",me[me.STATIC_COPY=35046]="STATIC_COPY",me[me.DYNAMIC_COPY=35050]="DYNAMIC_COPY",me[me.STREAM_COPY=35042]="STREAM_COPY"}(X||(X={})),function(me){me[me.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",me[me.VERTEX_SHADER=35633]="VERTEX_SHADER"}(U||(U={})),function(me){me[me.FRAMEBUFFER=36160]="FRAMEBUFFER",me[me.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",me[me.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(ee||(ee={})),function(me){me[me.TEXTURE=0]="TEXTURE",me[me.RENDER_BUFFER=1]="RENDER_BUFFER",me[me.CUBEMAP=2]="CUBEMAP"}($||($={})),function(me){me[me.NONE=0]="NONE",me[me.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER",me[me.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER",me[me.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER",me[me.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"}(ne||(ne={}));const se=33984;var ae,de;(function(me){me[me.Texture=0]="Texture",me[me.BufferObject=1]="BufferObject",me[me.VertexArrayObject=2]="VertexArrayObject",me[me.Shader=3]="Shader",me[me.Program=4]="Program",me[me.FramebufferObject=5]="FramebufferObject",me[me.Renderbuffer=6]="Renderbuffer",me[me.Sync=7]="Sync",me[me.COUNT=8]="COUNT"})(ae||(ae={})),function(me){me[me.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",me[me.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",me[me.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",me[me.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",me[me.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",me[me.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",me[me.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",me[me.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",me[me.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",me[me.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",me[me.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",me[me.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",me[me.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",me[me.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",me[me.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",me[me.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(de||(de={}));const _e=33306;var pe,he,ge,ye,Me,Ee,Te;(function(me){me[me.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",me[me.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",me[me.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",me[me.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",me[me.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",me[me.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",me[me.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",me[me.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",me[me.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",me[me.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",me[me.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",me[me.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",me[me.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",me[me.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(pe||(pe={})),function(me){me[me.FLOAT=5126]="FLOAT",me[me.FLOAT_VEC2=35664]="FLOAT_VEC2",me[me.FLOAT_VEC3=35665]="FLOAT_VEC3",me[me.FLOAT_VEC4=35666]="FLOAT_VEC4",me[me.INT=5124]="INT",me[me.INT_VEC2=35667]="INT_VEC2",me[me.INT_VEC3=35668]="INT_VEC3",me[me.INT_VEC4=35669]="INT_VEC4",me[me.BOOL=35670]="BOOL",me[me.BOOL_VEC2=35671]="BOOL_VEC2",me[me.BOOL_VEC3=35672]="BOOL_VEC3",me[me.BOOL_VEC4=35673]="BOOL_VEC4",me[me.FLOAT_MAT2=35674]="FLOAT_MAT2",me[me.FLOAT_MAT3=35675]="FLOAT_MAT3",me[me.FLOAT_MAT4=35676]="FLOAT_MAT4",me[me.SAMPLER_2D=35678]="SAMPLER_2D",me[me.SAMPLER_CUBE=35680]="SAMPLER_CUBE",me[me.UNSIGNED_INT=5125]="UNSIGNED_INT",me[me.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",me[me.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",me[me.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",me[me.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",me[me.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",me[me.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",me[me.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",me[me.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",me[me.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",me[me.SAMPLER_3D=35679]="SAMPLER_3D",me[me.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",me[me.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",me[me.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",me[me.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",me[me.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",me[me.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",me[me.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",me[me.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",me[me.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",me[me.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",me[me.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",me[me.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(he||(he={})),function(me){me[me.OBJECT_TYPE=37138]="OBJECT_TYPE",me[me.SYNC_CONDITION=37139]="SYNC_CONDITION",me[me.SYNC_STATUS=37140]="SYNC_STATUS",me[me.SYNC_FLAGS=37141]="SYNC_FLAGS"}(ge||(ge={})),function(me){me[me.UNSIGNALED=37144]="UNSIGNALED",me[me.SIGNALED=37145]="SIGNALED"}(ye||(ye={})),function(me){me[me.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",me[me.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",me[me.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",me[me.WAIT_FAILED=37149]="WAIT_FAILED"}(Me||(Me={})),function(me){me[me.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(Ee||(Ee={})),function(me){me[me.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(Te||(Te={}))},38982:(dt,Re,T)=>{"use strict";T.d(Re,{Br:()=>W,Fm:()=>oe,N9:()=>Y,RA:()=>j,Tc:()=>Z,Ue:()=>ie,iC:()=>B,s9:()=>re,v:()=>le,xW:()=>ce,zS:()=>ue});var x=T(99770),A=T(57596),G=T(67969),H=(T(85775),T(55086));function re(U,ee,$="nearest",ne=!1){var he;const se=!(ne&&"u8"===ee.pixelType),ae=se?G.Br.FLOAT:G.Br.UNSIGNED_BYTE,de=null==ee.pixels||0===ee.pixels.length?null:se?ee.getAsRGBAFloat():ee.getAsRGBA(),_e=null==(he=U.capabilities.textureFloat)?void 0:he.textureFloatLinear;return new H.x(U,{width:ee.width,height:ee.height,target:G.No.TEXTURE_2D,pixelFormat:G.VI.RGBA,internalFormat:U.type===A.zO.WEBGL2&&se?G.lP.RGBA32F:G.VI.RGBA,samplingMode:!_e||"bilinear"!==$&&"cubic"!==$?G.cw.NEAREST:G.cw.LINEAR,dataType:ae,wrapMode:G.e8.CLAMP_TO_EDGE,flipped:!1},de)}function W(U,ee){const{spacing:$,offsets:ne,coefficients:se,size:[ae,de]}=ee,_e=$[0]>1,pe={width:_e?4*ae:ae,height:de,target:G.No.TEXTURE_2D,pixelFormat:G.VI.RGBA,internalFormat:U.type===A.zO.WEBGL2?G.lP.RGBA32F:G.VI.RGBA,dataType:G.Br.FLOAT,samplingMode:G.cw.NEAREST,wrapMode:G.e8.CLAMP_TO_EDGE,flipped:!1},he=new Float32Array(_e?ae*de*16:2*ne.length);if(_e)for(let ge=0,ye=0;ge<se.length;ge++)he[ye++]=se[ge],ge%3==2&&(he[ye++]=1);else for(let ge=0;ge<de;ge++)for(let ye=0;ye<ae;ye++){const Me=4*(ge*ae+ye),Ee=2*(ye*de+ge);he[Me]=ne[Ee],he[Me+1]=ne[Ee+1],he[Me+3]=-1===ne[Ee]?0:1}return new H.x(U,pe,he)}function B(U,ee){return new H.x(U,{width:ee.length/4,height:1,target:G.No.TEXTURE_2D,pixelFormat:G.VI.RGBA,internalFormat:G.VI.RGBA,dataType:G.Br.UNSIGNED_BYTE,samplingMode:G.cw.NEAREST,wrapMode:G.e8.CLAMP_TO_EDGE,flipped:!1},ee)}function Z(U,ee,$,ne=1,se=!0){return{u_flipY:se,u_applyTransform:!!U,u_opacity:ne,u_transformSpacing:U?U.spacing:x.Z,u_transformGridSize:U?U.size:x.Z,u_targetImageSize:ee,u_srcImageSize:$}}function ie(U,ee){return{u_colormapOffset:ee||0,u_colormapMaxIndex:U?U.length/4-1:0}}function ue(U,ee){return{u_scale:U,u_offset:ee}}function ce(U){return{u_bandCount:U.bandCount,u_minOutput:U.outMin,u_maxOutput:U.outMax,u_minCutOff:U.minCutOff,u_maxCutOff:U.maxCutOff,u_factor:U.factor,u_useGamma:U.useGamma,u_gamma:U.gamma,u_gammaCorrection:U.gammaCorrection}}function oe(U){return{u_hillshadeType:U.hillshadeType,u_sinZcosAs:U.sinZcosAs,u_sinZsinAs:U.sinZsinAs,u_cosZs:U.cosZs,u_weights:U.weights,u_factor:U.factor,u_minValue:U.minValue,u_maxValue:U.maxValue}}function le(U,ee){const $=U.gl,ne=ee.glName,se=$.getProgramParameter(ne,$.ACTIVE_UNIFORMS),ae=new Map;let de;for(let _e=0;_e<se;_e++)de=$.getActiveUniform(ne,_e),de&&ae.set(de.name,{location:$.getUniformLocation(ne,de.name),info:de});return ae}function Y(U,ee,$){Object.keys($).forEach(ne=>{const se=ee.get(ne)||ee.get(ne+"[0]");se&&function X(U,ee,$,ne){if(null===ne||null==$)return!1;const{info:se}=ne;switch(se.type){case G.Se.FLOAT:se.size>1?U.setUniform1fv(ee,$):U.setUniform1f(ee,$);break;case G.Se.FLOAT_VEC2:U.setUniform2fv(ee,$);break;case G.Se.FLOAT_VEC3:U.setUniform3fv(ee,$);break;case G.Se.FLOAT_VEC4:U.setUniform4fv(ee,$);break;case G.Se.FLOAT_MAT3:U.setUniformMatrix3fv(ee,$);break;case G.Se.FLOAT_MAT4:U.setUniformMatrix4fv(ee,$);break;case G.Se.INT:se.size>1?U.setUniform1iv(ee,$):U.setUniform1i(ee,$);break;case G.Se.BOOL:U.setUniform1i(ee,$?1:0);break;case G.Se.INT_VEC2:case G.Se.BOOL_VEC2:U.setUniform2iv(ee,$);break;case G.Se.INT_VEC3:case G.Se.BOOL_VEC3:U.setUniform3iv(ee,$);break;case G.Se.INT_VEC4:case G.Se.BOOL_VEC4:U.setUniform4iv(ee,$);break;default:return!1}}(U,ne,$[ne],se)})}function j(U,ee,$,ne){$.length===ne.length&&(ne.some(se=>null==se)||$.some(se=>null==se)||$.forEach((se,ae)=>{ee.setUniform1i(se,ae),U.bindTexture(ne[ae],ae)}))}},2078:(dt,Re,T)=>{"use strict";T.d(Re,{BK:()=>B,LZ:()=>W,Rd:()=>H,if:()=>G,jp:()=>xe,sg:()=>re,sm:()=>X,wK:()=>Q,zp:()=>J});var x=T(42743),A=T(67969);function G(je,We,Ne=A.db.ADD,we=[0,0,0,0]){return{srcRgb:je,srcAlpha:je,dstRgb:We,dstAlpha:We,opRgb:Ne,opAlpha:Ne,color:{r:we[0],g:we[1],b:we[2],a:we[3]}}}function Q(je,We,Ne,we,Oe=A.db.ADD,$e=A.db.ADD,Be=[0,0,0,0]){return{srcRgb:je,srcAlpha:We,dstRgb:Ne,dstAlpha:we,opRgb:Oe,opAlpha:$e,color:{r:Be[0],g:Be[1],b:Be[2],a:Be[3]}}}const H={face:A.LR.BACK,mode:A.Wf.CCW},re={face:A.LR.FRONT,mode:A.Wf.CCW},J=je=>je===x.Vr.Back?H:je===x.Vr.Front?re:null,W={zNear:0,zFar:1},B={r:!0,g:!0,b:!0,a:!0};function Z(je){return $.intern(je)}function ie(je){return se.intern(je)}function ue(je){return de.intern(je)}function ce(je){return pe.intern(je)}function oe(je){return ge.intern(je)}function le(je){return Me.intern(je)}function Y(je){return Te.intern(je)}function j(je){return Ce.intern(je)}function X(je){return Ge.intern(je)}class U{constructor(We,Ne){this.makeKey=We,this.makeRef=Ne,this.interns=new Map}intern(We){if(!We)return null;const Ne=this.makeKey(We),we=this.interns;return we.has(Ne)||we.set(Ne,this.makeRef(We)),we.get(Ne)}}function ee(je){return"["+je.join(",")+"]"}const $=new U(ne,je=>or({__tag:"Blending"},je));function ne(je){return je?ee([je.srcRgb,je.srcAlpha,je.dstRgb,je.dstAlpha,je.opRgb,je.opAlpha,je.color.r,je.color.g,je.color.b,je.color.a]):null}const se=new U(ae,je=>or({__tag:"Culling"},je));function ae(je){return je?ee([je.face,je.mode]):null}const de=new U(_e,je=>or({__tag:"PolygonOffset"},je));function _e(je){return je?ee([je.factor,je.units]):null}const pe=new U(he,je=>or({__tag:"DepthTest"},je));function he(je){return je?ee([je.func]):null}const ge=new U(ye,je=>or({__tag:"StencilTest"},je));function ye(je){return je?ee([je.function.func,je.function.ref,je.function.mask,je.operation.fail,je.operation.zFail,je.operation.zPass]):null}const Me=new U(Ee,je=>or({__tag:"DepthWrite"},je));function Ee(je){return je?ee([je.zNear,je.zFar]):null}const Te=new U(me,je=>or({__tag:"ColorWrite"},je));function me(je){return je?ee([je.r,je.g,je.b,je.a]):null}const Ce=new U(Ie,je=>or({__tag:"StencilWrite"},je));function Ie(je){return je?ee([je.mask]):null}const Ge=new U(function Je(je){return je?ee([ne(je.blending),ae(je.culling),_e(je.polygonOffset),he(je.depthTest),ye(je.stencilTest),Ee(je.depthWrite),me(je.colorWrite),Ie(je.stencilWrite)]):null},je=>({blending:Z(je.blending),culling:ie(je.culling),polygonOffset:ue(je.polygonOffset),depthTest:ce(je.depthTest),stencilTest:oe(je.stencilTest),depthWrite:le(je.depthWrite),colorWrite:Y(je.colorWrite),stencilWrite:j(je.stencilWrite)}));class xe{constructor(We){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=We}setPipeline(We){(this._pipelineInvalid||We!==this._pipeline)&&(this._setBlending(We.blending),this._setCulling(We.culling),this._setPolygonOffset(We.polygonOffset),this._setDepthTest(We.depthTest),this._setStencilTest(We.stencilTest),this._setDepthWrite(We.depthWrite),this._setColorWrite(We.colorWrite),this._setStencilWrite(We.stencilWrite),this._pipeline=We),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(We){this._blending=this._setSubState(We,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(We){this._culling=this._setSubState(We,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(We){this._polygonOffset=this._setSubState(We,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(We){this._depthTest=this._setSubState(We,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(We){this._stencilTest=this._setSubState(We,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(We){this._depthWrite=this._setSubState(We,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(We){this._colorWrite=this._setSubState(We,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(We){this._stencilWrite=this._setSubState(We,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(We,Ne,we,Oe){return(we||We!==Ne)&&(Oe(We),this._pipelineInvalid=!0),We}}},92236:(dt,Re,T)=>{"use strict";T.d(Re,{a:()=>A,b:()=>G});var x=T(90912);function A(Q){const H=(0,x.vU)(100*(1-Q));return Math.max(0,Math.min(H,100))}function G(Q){return Math.max(0,Math.min(1-Q/100,1))}},32584:(dt,Re,T)=>{"use strict";T.d(Re,{Nw:()=>Y});var x=T(26584),A=T(58817),G=T(62208),Q=T(94113),H=T(23025),re=T(72469);const J=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),W=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","ogc-feature","route","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function oe(j,X){"maxScale"in j&&(X.maxScale=(0,H.k)(j.maxScale)),"minScale"in j&&(X.minScale=(0,H.k)(j.minScale))}function Y(j,X,U){if(!("write"in j)||!j.write)return U&&U.messages&&U.messages.push(new x.Z("layer:unsupported",`Layers (${j.title}, ${j.id}) of type '${j.declaredClass}' cannot be persisted`,{layer:j})),null;if(function ue(j,X){if(X.restrictedWebMapWriting){const U=function ie(j){return"basemap"===j.layerContainerType?J:"operational-layers"===j.layerContainerType?W:null}(X);return!(0,G.pC)(U)||U.has(j.type)&&!(0,re.rQ)(j)}return!0}(j,U)){const ee={};return j.write(ee,U)?ee:null}return(0,G.pC)(X)&&function le(j,X){if(function ce(j,X){if((0,re.rQ)(j)){const U=(0,Q.hS)("featureCollection.layers",X),ee=U&&U[0]&&U[0].layerDefinition;ee&&oe(j,ee)}else"stream"===j.type?oe(j,X.layerDefinition=X.layerDefinition||{}):"group"!==j.type&&oe(j,X)}(j,X),"blendMode"in j&&(X.blendMode=j.blendMode,"normal"===X.blendMode&&delete X.blendMode),X.opacity=(0,H.k)(j.opacity),X.title=j.title||"Layer",X.visibility=j.visible,"legendEnabled"in j&&"wmts"!==j.type)if((0,re.rQ)(j)){const U=X.featureCollection;U&&(U.showLegend=j.legendEnabled)}else X.showLegend=j.legendEnabled}(j,X=(0,A.d9)(X)),X}},10391:(dt,Re,T)=>{"use strict";T.d(Re,{Z:()=>Ke});var x=T(15861),A=T(17626),Q=(T(52515),T(40764)),H=T(61885),re=T(17770),J=T(72392),B=(T(8314),T(58817)),Z=T(63290),ie=T(62208),ue=T(60330),ce=T(10699),oe=T(32917),le=T(35948),Y=T(77712),j=T(66656),X=T(76898),U=T(36082),ee=T(819),$=T(39605);T(62996);const se={handleInterceptedEvent:(qe,be,tt,Ye)=>(qe.scheduleRender(),be.properties[`on${Ye.type}`].apply(be.properties.bind||tt,[Ye]))},ae={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(qe,be,tt)=>{qe.style[be]=tt}},he=(qe,be,tt=!1)=>{let Ye=qe;return be.forEach((ze,et)=>{const ke=(null==Ye?void 0:Ye.children)?((qe,be)=>qe.find(ot=>ot.domNode===ze))(Ye.children):void 0;tt&&!ke&&et!==be.length-1||(Ye=ke)}),Ye};var ye=T(76210),Me=T(54346),Ee=T(21726);let Te;Te="components/assets";var Ce=T(81431);const Ie=new Set;var xe=T(66950),je=T(38570),We=T(56683),Ne=T(41840);const we="esri.widgets.Widget",Oe=Z.Z.getLogger(we);let $e=0;function Se(qe,be){for(const tt in be)null!=qe[tt]&&("object"==typeof qe[tt]&&"object"==typeof be[tt]?Se(qe[tt],be[tt]):qe[tt]=be[tt]);return qe}const De=(qe=>{let be;const tt=or(or({},se),qe),Ye=(qe=>or(or({},ae),qe))(tt),ze=Ye.performanceLogger;let et,ke=!0,ot=!1;const at=[],yt=[],wt=(Rt,Ft,bt)=>{var Mr;let St;Ye.eventHandlerInterceptor=(Cr,Yr,Lr,ct)=>function(jt){let qt;ze("domEvent",jt);const er=((qe,be)=>{const tt=[];for(;qe&&qe!==be;)tt.push(qe),qe=qe.parentNode;return tt})(jt.currentTarget,St.domNode),Zt=er.some(ir=>{var fr;return customElements.get(null==(fr=null==ir?void 0:ir.tagName)?void 0:fr.toLowerCase())});if(jt.eventPhase!==Event.CAPTURING_PHASE&&Zt){const ir=jt.composedPath(),fr=ir.slice(ir.indexOf(jt.currentTarget),ir.indexOf(St.domNode)).filter(Ur=>Ur.getRootNode()===Ur.ownerDocument).reverse();qt=he(St.getLastRender(),fr,!0)}else er.reverse(),qt=he(St.getLastRender(),er);let tr;return qt&&(tr=tt.handleInterceptedEvent(be,qt,this,jt)),ze("domEventProcessed",jt),tr},null==(Mr=tt.postProcessProjectionOptions)||Mr.call(tt,Ye);const Xt=bt();St=Rt(Ft,Xt,Ye),at.push(St),yt.push(bt),tt.afterFirstVNodeRendered&&tt.afterFirstVNodeRendered(St,Xt)};let zt=()=>{if(et=void 0,ke){ke=!1,ze("renderStart",void 0);for(let Rt=0;Rt<at.length;Rt++){const Ft=yt[Rt]();ze("rendered",void 0),at[Rt].update(Ft),ze("patched",void 0)}ze("renderDone",void 0),ke=!0}};return tt.modifyDoRenderImplementation&&(zt=tt.modifyDoRenderImplementation(zt,at,yt)),be={renderNow:zt,scheduleRender:()=>{et||ot||(et=requestAnimationFrame(zt))},stop:()=>{et&&(cancelAnimationFrame(et),et=void 0),ot=!0},resume:()=>{ot=!1,ke=!0,be.scheduleRender()},append:(Rt,Ft)=>{wt($.v.append,Rt,Ft)},insertBefore:(Rt,Ft)=>{wt($.v.insertBefore,Rt,Ft)},merge:(Rt,Ft)=>{wt($.v.merge,Rt,Ft)},replace:(Rt,Ft)=>{wt($.v.replace,Rt,Ft)},detach:Rt=>{for(let Ft=0;Ft<yt.length;Ft++)if(yt[Ft]===Rt)return yt.splice(Ft,1),at.splice(Ft,1)[0];throw new Error("renderFunction was not found")}},be})({postProcessProjectionOptions(qe){const be=qe.eventHandlerInterceptor,tt=/capture$/i;qe.eventHandlerInterceptor=(Ye,ze,et,ke)=>{const ot=be(Ye,ze,et,ke),at=tt.test(Ye);if(!((Ye=Ye.replace(tt,"")).toLowerCase()in et)||at){const yt=Ye[2].toLowerCase()+Ye.slice(3),wt=Ft=>ot.call(et,Ft);et.addEventListener(yt,wt,at);const zt=()=>et.removeEventListener(yt,wt,at),Rt=ke.afterRemoved;ke.afterRemoved=Ft=>{null==Rt||Rt(Ft),zt()}}return ot}},handleInterceptedEvent(qe,be,tt,Ye){const{eventPhase:ze,type:et}=Ye,ke=ze===Event.CAPTURING_PHASE;let ot=`on${et}${ke?"capture":""}`;const at=be.properties;(ot in at||(ot=`on${et[0].toUpperCase()}${et.slice(1)}${ke?"Capture":""}`,ot in at))&&((0,xe.Uy)(),qe.scheduleRender(),at[ot].call(at.bind||tt,Ye))}});let Fe=!1,ve=class extends((0,ue.v)(H.Z.EventedAccessor)){constructor(qe,be){var tt;super(qe,be),tt=this,this._attached=!1,this._internalHandles=new J.Z,this._projector=De,this._readyForTrueRender=!1,this.domNode=null,this.iconClass="esri-icon-checkbox-unchecked",this.label=this.declaredClass.split(".").pop(),this.visible=!0,this.key=this,this._loadLocale=(0,ce.Ds)((0,x.Z)(function*(){if(tt._messageBundleProps&&tt._messageBundleProps.length){const ke=yield(0,ce.as)(tt._messageBundleProps.map(function(){var ot=(0,x.Z)(function*({bundlePath:at,propertyName:yt}){let wt=yield(0,Ne.ME)(at);tt.uiStrings&&Object.keys(tt.uiStrings)&&(wt=Se((0,B.d9)(wt),tt.uiStrings)),tt[yt]=wt});return function(at){return ot.apply(this,arguments)}}()));for(const ot of ke)ot.error&&Oe.error("widget-intl:locale-error",tt.declaredClass,ot.error)}yield tt.loadLocale()})),function me(){(0,ye.YY)((0,Ee.hF)((0,Me.V)("components/assets")))}();const Ye="esri-widget-uid-"+(0,le.D)(),ze=this.render.bind(this);this._trackingTarget=new ee.M(()=>this.scheduleRender());const et=()=>{var zt;if(!this._readyForTrueRender||this.destroyed)return null;if(!this.visible)return{vnodeSelector:"div",properties:{key:Ye,class:"",styles:{display:"none"}},domNode:void 0,children:void 0,text:void 0};const ke=ze();let{properties:ot}=ke;ot||(ke.properties=ot={});let{key:at,styles:yt}=ot;at||(ot.key=Ye),yt||(ot.styles=yt={}),yt.display||(yt.display="");let wt=0;return null==(zt=ke.children)||zt.forEach(Rt=>{if((0,Ce.ZJ)(Rt.vnodeSelector))return;let{properties:Ft}=Rt;Ft||(Rt.properties=Ft={}),Ft.key||(Ft.key=`${this.id}--${wt++}`)}),(0,Ce.dh)(this,ke)};this.render=()=>{if(Fe)return et();let ke=(0,xe.O9)(this);if(ke)return ke;this._trackingTarget.clear(),Fe=!0;try{ke=(0,U.LJ)(this._trackingTarget,et)}catch(ot){throw console.error(ot),ot}finally{Fe=!1}return(0,xe.KF)(this,ke),ke},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),function Ge(qe){Ie.add(qe),qe.finally(()=>Ie.delete(qe))}(this._resourcesFetch)}normalizeCtorArgs(qe,be){const tt=or({},qe);return be&&(tt.container=be),tt}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(ce.H9)}loadDependencies(){return(0,x.Z)(function*(){})()}loadLocale(){return(0,x.Z)(function*(){})()}destroy(){this.destroyed||((0,ie.SC)(this._trackingTarget),(0,ie.SC)(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,(0,xe.w7)(this))}set container(qe){this._get("container")||this._set("container",qe)}castContainer(qe){return(0,Q.L7)(qe)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+$e++}set id(qe){qe&&this._set("id",qe)}get renderable(){return this._resourcesFetch}get test(){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||((0,xe.w7)(this),this._projector.scheduleRender())}classes(...qe){return je.Sh.apply(this,qe)}renderNow(){(0,xe.w7)(this),this._projector.renderNow()}_postInitialize(){var tt,qe=this;if(this.destroyed)return;this.scheduleRender(),(null==(tt=this._delegatedEventNames)?void 0:tt.length)&&this._internalHandles.add((0,oe.YP)(()=>this.viewModel,(Ye,ze)=>{ze&&this._internalHandles.remove("delegated-events"),Ye&&(0,re.vT)(Ye)&&this._internalHandles.add(this._delegatedEventNames.map(et=>(0,re.on)(Ye,et,ke=>{this.emit(et,ke)})),"delegated-events")},oe.nn)),this.postInitialize();const be=function(){var Ye=(0,x.Z)(function*(){yield qe._loadLocale().catch(ce.H9),qe.scheduleRender()});return function(){return Ye.apply(this,arguments)}}();this._internalHandles.add([(0,We.qe)(be),(0,oe.YP)(()=>this.uiStrings,be),(0,oe.gx)(()=>this.container,Ye=>{this.destroyed||this._attach(Ye)},{initial:!0,once:!0})])}_attach(qe){qe&&(this._projector.merge(qe,this.render),this._attached=!0)}_detach(qe){qe&&this._attached&&(this._projector.detach(this.render),qe.parentNode&&qe.parentNode.removeChild(qe),this._attached=!1)}};ve[Ce.$X]=!0,(0,A._)([(0,Y.Cb)()],ve.prototype,"_readyForTrueRender",void 0),(0,A._)([(0,Y.Cb)({value:null})],ve.prototype,"container",null),(0,A._)([(0,j.p)("container")],ve.prototype,"castContainer",null),(0,A._)([(0,Y.Cb)({aliasOf:"container"})],ve.prototype,"domNode",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"iconClass",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"id",null),(0,A._)([(0,Y.Cb)()],ve.prototype,"label",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"renderable",null),(0,A._)([(0,Y.Cb)()],ve.prototype,"uiStrings",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"viewModel",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"visible",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"key",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"children",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"afterCreate",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"afterUpdate",void 0),(0,A._)([(0,Y.Cb)()],ve.prototype,"afterRemoved",void 0),ve=(0,A._)([(0,X.j)(we)],ve);const Ke=ve},67436:(dt,Re,T)=>{"use strict";T.d(Re,{_:()=>J});var x=T(17626),A=T(77712),re=(T(85931),T(8314),T(90912),T(76898));const J=W=>{let B=class extends W{constructor(...Z){super(...Z),this.goToOverride=null,this.view=null}callGoTo(Z){const{view:ie}=this;return this.goToOverride?this.goToOverride(ie,Z):ie.goTo(Z.target,Z.options)}};return(0,x._)([(0,A.Cb)()],B.prototype,"goToOverride",void 0),(0,x._)([(0,A.Cb)()],B.prototype,"view",void 0),B=(0,x._)([(0,re.j)("esri.widgets.support.GoTo")],B),B}},13065:(dt,Re,T)=>{"use strict";T.d(Re,{X6:()=>H});var x=T(21286),A=T(38570),G=T(94450);function H(W,B){const Z=function re(W){return(0,x.uZ)(Math.ceil(W),1,6)}(W.level),ie=`h${Z}`;return delete W.level,(0,G.u)(ie,yi(or({},W),{class:(0,A.Sh)("esri-widget__heading",W.class),role:"heading","aria-level":String(Z)}),B)}},24940:(dt,Re,T)=>{"use strict";T.d(Re,{h:()=>A});var x=T(38570);function A(){return function(H,re){if(!H[re])throw new TypeError(`Cannot auto bind undefined function '${re}'`);return{value:Q(H[re])}}}function Q(H){return function(re,...J){!function G(H){const{type:re}=H;return H instanceof KeyboardEvent||"keyup"===re||"keydown"===re||"keypress"===re}(re)?H.call(this,re,...J):(0,x.pf)(re.key)&&(re.preventDefault(),re.stopPropagation(),re.target.click())}}},25552:(dt,Re,T)=>{"use strict";function x(A){return(G,Q)=>{G.hasOwnProperty("_messageBundleProps")||(G._messageBundleProps=G._messageBundleProps?G._messageBundleProps.slice():[]),G._messageBundleProps.push({bundlePath:A,propertyName:Q})}}T.d(Re,{H:()=>x})},78745:(dt,Re,T)=>{"use strict";function Q(H){return re=>{re.hasOwnProperty("_delegatedEventNames")||(re._delegatedEventNames=re._delegatedEventNames?re._delegatedEventNames.slice():[]);const J=re._delegatedEventNames,W=Array.isArray(H)?H:function x(H){return H.split(",").map(re=>re.trim())}(H);J.push(...W)}}T.d(Re,{s:()=>Q})},94450:(dt,Re,T)=>{"use strict";T.d(Re,{D:()=>re,u:()=>H});var x=T(81431),A=function(J){return{vnodeSelector:"",properties:void 0,children:void 0,text:J.toString(),domNode:null}},G=function(J,W){for(var B=0,Z=J.length;B<Z;B++){var ie=J[B];Array.isArray(ie)?G(ie,W):null!=ie&&!1!==ie&&(ie.hasOwnProperty("vnodeSelector")||(ie=A(ie)),W.push(ie))}};function H(J,W,...B){return"function"!=typeof J||(0,x.ZJ)(J)?function(J,W){for(var B=[],Z=2;Z<arguments.length;Z++)B[Z-2]=arguments[Z];if(1===B.length&&"string"==typeof B[0])return{vnodeSelector:J,properties:W||void 0,children:void 0,text:B[0],domNode:null};var ie=[];return G(B,ie),{vnodeSelector:J,properties:W||void 0,children:ie,text:void 0,domNode:null}}(J,W,...B):J(W,...B)}function re(...J){return J}},81431:(dt,Re,T)=>{"use strict";T.d(Re,{$X:()=>A,ZJ:()=>Z,dh:()=>re});var x=T(54024);const A=Symbol("widget"),G=[],Q={},H=new WeakMap;function re(ie,ue){let ce=ue.children;if(ce&&ce.length)for(let le=0;le<ce.length;++le)ce[le]=re(ie,ce[le]);else ce=G;const oe=ue.vnodeSelector;if(Z(oe)){const le=ue.properties||Q,Y=le.key||oe;return{vnodeSelector:"div",properties:{key:Y,afterCreate:J,afterUpdate:W,afterRemoved:B,parentWidget:ie,widgetConstructor:oe,widgetProperties:yi(or({},le),{key:Y,children:ce})},children:void 0,text:void 0,domNode:null}}return ue}function J(ie,ue,ce,{parentWidget:oe,widgetConstructor:le,widgetProperties:Y}){var X;const j=new le(Y);j.container=ie,H.set(ie,j),null==(X=j.afterCreate)||X.call(j,j,ie),oe._internalHandles.add((0,x.kB)(()=>B(ie)))}function W(ie,ue,ce,{widgetProperties:oe}){var Y;const le=H.get(ie);le&&(le.set(oe),null==(Y=le.afterUpdate)||Y.call(le,le,ie))}function B(ie){const ue=H.get(ie);ue&&(ue.destroy(),H.delete(ie))}function Z(ie){return"function"==typeof ie&&ie[A]}},66950:(dt,Re,T)=>{"use strict";T.d(Re,{KF:()=>Q,O9:()=>G,Uy:()=>A,w7:()=>H});const x=new Map;function A(){x.clear()}function G(re){return x.get(re)}function Q(re,J){x.set(re,J)}function H(re){x.delete(re)}},25469:(dt,Re,T)=>{"use strict";function Q(re){return re&&"function"==typeof re.render}function H(re){return re&&"function"==typeof re.postMixInProperties&&"function"==typeof re.buildRendering&&"function"==typeof re.postCreate&&"function"==typeof re.startup}T.d(Re,{Qd:()=>Q,o:()=>H}),T(24940),T(94450),T(38570)},38570:(dt,Re,T)=>{"use strict";T.d(Re,{Sh:()=>Hs,vU:()=>Gi,pV:()=>Ii,XP:()=>_i,pf:()=>ds,dZ:()=>ni,_q:()=>ln,ib:()=>Ar,w3:()=>hi,Yo:()=>ji});var H=Object.prototype,re=Function.prototype.toString,J=H.hasOwnProperty,W=re.call(Object),B=H.toString,Z=function G(Mt,Hr){return function(Ir){return Mt(Hr(Ir))}}(Object.getPrototypeOf,Object),oe={exports:{}},le={},Y={exports:{}},j={};function X(){return{"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1}}var $=/javascript\s*\:/gim;j.whiteList={"align-content":!1,"align-items":!1,"align-self":!1,"alignment-adjust":!1,"alignment-baseline":!1,all:!1,"anchor-point":!1,animation:!1,"animation-delay":!1,"animation-direction":!1,"animation-duration":!1,"animation-fill-mode":!1,"animation-iteration-count":!1,"animation-name":!1,"animation-play-state":!1,"animation-timing-function":!1,azimuth:!1,"backface-visibility":!1,background:!0,"background-attachment":!0,"background-clip":!0,"background-color":!0,"background-image":!0,"background-origin":!0,"background-position":!0,"background-repeat":!0,"background-size":!0,"baseline-shift":!1,binding:!1,bleed:!1,"bookmark-label":!1,"bookmark-level":!1,"bookmark-state":!1,border:!0,"border-bottom":!0,"border-bottom-color":!0,"border-bottom-left-radius":!0,"border-bottom-right-radius":!0,"border-bottom-style":!0,"border-bottom-width":!0,"border-collapse":!0,"border-color":!0,"border-image":!0,"border-image-outset":!0,"border-image-repeat":!0,"border-image-slice":!0,"border-image-source":!0,"border-image-width":!0,"border-left":!0,"border-left-color":!0,"border-left-style":!0,"border-left-width":!0,"border-radius":!0,"border-right":!0,"border-right-color":!0,"border-right-style":!0,"border-right-width":!0,"border-spacing":!0,"border-style":!0,"border-top":!0,"border-top-color":!0,"border-top-left-radius":!0,"border-top-right-radius":!0,"border-top-style":!0,"border-top-width":!0,"border-width":!0,bottom:!1,"box-decoration-break":!0,"box-shadow":!0,"box-sizing":!0,"box-snap":!0,"box-suppress":!0,"break-after":!0,"break-before":!0,"break-inside":!0,"caption-side":!1,chains:!1,clear:!0,clip:!1,"clip-path":!1,"clip-rule":!1,color:!0,"color-interpolation-filters":!0,"column-count":!1,"column-fill":!1,"column-gap":!1,"column-rule":!1,"column-rule-color":!1,"column-rule-style":!1,"column-rule-width":!1,"column-span":!1,"column-width":!1,columns:!1,contain:!1,content:!1,"counter-increment":!1,"counter-reset":!1,"counter-set":!1,crop:!1,cue:!1,"cue-after":!1,"cue-before":!1,cursor:!1,direction:!1,display:!0,"display-inside":!0,"display-list":!0,"display-outside":!0,"dominant-baseline":!1,elevation:!1,"empty-cells":!1,filter:!1,flex:!1,"flex-basis":!1,"flex-direction":!1,"flex-flow":!1,"flex-grow":!1,"flex-shrink":!1,"flex-wrap":!1,float:!1,"float-offset":!1,"flood-color":!1,"flood-opacity":!1,"flow-from":!1,"flow-into":!1,font:!0,"font-family":!0,"font-feature-settings":!0,"font-kerning":!0,"font-language-override":!0,"font-size":!0,"font-size-adjust":!0,"font-stretch":!0,"font-style":!0,"font-synthesis":!0,"font-variant":!0,"font-variant-alternates":!0,"font-variant-caps":!0,"font-variant-east-asian":!0,"font-variant-ligatures":!0,"font-variant-numeric":!0,"font-variant-position":!0,"font-weight":!0,grid:!1,"grid-area":!1,"grid-auto-columns":!1,"grid-auto-flow":!1,"grid-auto-rows":!1,"grid-column":!1,"grid-column-end":!1,"grid-column-start":!1,"grid-row":!1,"grid-row-end":!1,"grid-row-start":!1,"grid-template":!1,"grid-template-areas":!1,"grid-template-columns":!1,"grid-template-rows":!1,"hanging-punctuation":!1,height:!0,hyphens:!1,icon:!1,"image-orientation":!1,"image-resolution":!1,"ime-mode":!1,"initial-letters":!1,"inline-box-align":!1,"justify-content":!1,"justify-items":!1,"justify-self":!1,left:!1,"letter-spacing":!0,"lighting-color":!0,"line-box-contain":!1,"line-break":!1,"line-grid":!1,"line-height":!1,"line-snap":!1,"line-stacking":!1,"line-stacking-ruby":!1,"line-stacking-shift":!1,"line-stacking-strategy":!1,"list-style":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,margin:!0,"margin-bottom":!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"marker-offset":!1,"marker-side":!1,marks:!1,mask:!1,"mask-box":!1,"mask-box-outset":!1,"mask-box-repeat":!1,"mask-box-slice":!1,"mask-box-source":!1,"mask-box-width":!1,"mask-clip":!1,"mask-image":!1,"mask-origin":!1,"mask-position":!1,"mask-repeat":!1,"mask-size":!1,"mask-source-type":!1,"mask-type":!1,"max-height":!0,"max-lines":!1,"max-width":!0,"min-height":!0,"min-width":!0,"move-to":!1,"nav-down":!1,"nav-index":!1,"nav-left":!1,"nav-right":!1,"nav-up":!1,"object-fit":!1,"object-position":!1,opacity:!1,order:!1,orphans:!1,outline:!1,"outline-color":!1,"outline-offset":!1,"outline-style":!1,"outline-width":!1,overflow:!1,"overflow-wrap":!1,"overflow-x":!1,"overflow-y":!1,padding:!0,"padding-bottom":!0,"padding-left":!0,"padding-right":!0,"padding-top":!0,page:!1,"page-break-after":!1,"page-break-before":!1,"page-break-inside":!1,"page-policy":!1,pause:!1,"pause-after":!1,"pause-before":!1,perspective:!1,"perspective-origin":!1,pitch:!1,"pitch-range":!1,"play-during":!1,position:!1,"presentation-level":!1,quotes:!1,"region-fragment":!1,resize:!1,rest:!1,"rest-after":!1,"rest-before":!1,richness:!1,right:!1,rotation:!1,"rotation-point":!1,"ruby-align":!1,"ruby-merge":!1,"ruby-position":!1,"shape-image-threshold":!1,"shape-outside":!1,"shape-margin":!1,size:!1,speak:!1,"speak-as":!1,"speak-header":!1,"speak-numeral":!1,"speak-punctuation":!1,"speech-rate":!1,stress:!1,"string-set":!1,"tab-size":!1,"table-layout":!1,"text-align":!0,"text-align-last":!0,"text-combine-upright":!0,"text-decoration":!0,"text-decoration-color":!0,"text-decoration-line":!0,"text-decoration-skip":!0,"text-decoration-style":!0,"text-emphasis":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-height":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-overflow":!0,"text-shadow":!0,"text-space-collapse":!0,"text-transform":!0,"text-underline-position":!0,"text-wrap":!0,top:!1,transform:!1,"transform-origin":!1,"transform-style":!1,transition:!1,"transition-delay":!1,"transition-duration":!1,"transition-property":!1,"transition-timing-function":!1,"unicode-bidi":!1,"vertical-align":!1,visibility:!1,"voice-balance":!1,"voice-duration":!1,"voice-family":!1,"voice-pitch":!1,"voice-range":!1,"voice-rate":!1,"voice-stress":!1,"voice-volume":!1,volume:!1,"white-space":!1,widows:!1,width:!0,"will-change":!1,"word-break":!0,"word-spacing":!0,"word-wrap":!0,"wrap-flow":!1,"wrap-through":!1,"writing-mode":!1,"z-index":!1},j.getDefaultWhiteList=X,j.onAttr=function U(Mt,Hr,Ir){},j.onIgnoreAttr=function ee(Mt,Hr,Ir){},j.safeAttrValue=function ne(Mt,Hr){return $.test(Hr)?"":Hr};var ae_trim=function(Mt){return String.prototype.trim?Mt.trim():Mt.replace(/(^\s*)|(\s*$)/g,"")},ae_trimRight=function(Mt){return String.prototype.trimRight?Mt.trimRight():Mt.replace(/(\s*$)/g,"")},pe=j;function ge(Mt){return null==Mt}function Me(Mt){(Mt=function ye(Mt){var Hr={};for(var Ir in Mt)Hr[Ir]=Mt[Ir];return Hr}(Mt||{})).whiteList=Mt.whiteList||pe.whiteList,Mt.onAttr=Mt.onAttr||pe.onAttr,Mt.onIgnoreAttr=Mt.onIgnoreAttr||pe.onIgnoreAttr,Mt.safeAttrValue=Mt.safeAttrValue||pe.safeAttrValue,this.options=Mt}Me.prototype.process=function(Mt){if(!(Mt=(Mt=Mt||"").toString()))return"";var Ir=this.options,gi=Ir.whiteList,Ui=Ir.onAttr,is=Ir.onIgnoreAttr,ss=Ir.safeAttrValue;return function de(Mt,Hr){";"!==(Mt=ae_trimRight(Mt))[Mt.length-1]&&(Mt+=";");var Ir=Mt.length,gi=!1,Ui=0,is=0,ss="";function ts(){if(!gi){var Ds=ae_trim(Mt.slice(Ui,is)),Ps=Ds.indexOf(":");if(-1!==Ps){var ms=ae_trim(Ds.slice(0,Ps)),Un=ae_trim(Ds.slice(Ps+1));if(ms){var gr=Hr(Ui,ss.length,ms,Un,Ds);gr&&(ss+=gr+"; ")}}}Ui=is+1}for(;is<Ir;is++){var ys=Mt[is];if("/"===ys&&"*"===Mt[is+1]){var ps=Mt.indexOf("*/",is+2);if(-1===ps)break;Ui=(is=ps+1)+1,gi=!1}else"("===ys?gi=!0:")"===ys?gi=!1:";"===ys?gi||ts():"\n"===ys&&ts()}return ae_trim(ss)}(Mt,function(ys,ps,Ds,Ps,ms){var Un=gi[Ds],gr=!1;if(!0===Un?gr=Un:"function"==typeof Un?gr=Un(Ps):Un instanceof RegExp&&(gr=Un.test(Ps)),!0!==gr&&(gr=!1),Ps=ss(Ds,Ps)){var mr,Sr={position:ps,sourcePosition:ys,source:ms,isWhite:gr};if(gr)return ge(mr=Ui(Ds,Ps,Sr))?Ds+":"+Ps:mr;if(!ge(mr=is(Ds,Ps,Sr)))return mr}})};var Ee=Me;!function(Mt,Hr){var Ir=j,gi=Ee;for(var is in(Hr=Mt.exports=function Ui(ss,ts){return new gi(ts).process(ss)}).FilterCSS=gi,Ir)Hr[is]=Ir[is]}(Y,Y.exports);var Te={indexOf:function(Mt,Hr){var Ir,gi;if(Array.prototype.indexOf)return Mt.indexOf(Hr);for(Ir=0,gi=Mt.length;Ir<gi;Ir++)if(Mt[Ir]===Hr)return Ir;return-1},forEach:function(Mt,Hr,Ir){var gi,Ui;if(Array.prototype.forEach)return Mt.forEach(Hr,Ir);for(gi=0,Ui=Mt.length;gi<Ui;gi++)Hr.call(Ir,Mt[gi],gi,Mt)},trim:function(Mt){return String.prototype.trim?Mt.trim():Mt.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(Mt){var Ir=/\s|\n|\t/.exec(Mt);return Ir?Ir.index:-1}},Ce=Y.exports.getDefaultWhiteList,Ie=Te;var Je=new(0,Y.exports.FilterCSS);function we(Mt){return Mt.replace($e,"&lt;").replace(Be,"&gt;")}var $e=/</g,Be=/>/g,Se=/"/g,De=/&quot;/g,Fe=/&#([a-zA-Z0-9]*);?/gim,ve=/&colon;?/gim,Ke=/&newline;?/gim,qe=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi,be=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,tt=/u\s*r\s*l\s*\(.*/gi;function Ye(Mt){return Mt.replace(Se,"&quot;")}function ze(Mt){return Mt.replace(De,'"')}function et(Mt){return Mt.replace(Fe,function(Ir,gi){return String.fromCharCode("x"===gi[0]||"X"===gi[0]?parseInt(gi.substr(1),16):parseInt(gi,10))})}function ke(Mt){return Mt.replace(ve,":").replace(Ke," ")}function ot(Mt){for(var Hr="",Ir=0,gi=Mt.length;Ir<gi;Ir++)Hr+=Mt.charCodeAt(Ir)<32?" ":Mt.charAt(Ir);return Ie.trim(Hr)}function at(Mt){return ot(Mt=ke(Mt=et(Mt=ze(Mt))))}function yt(Mt){return we(Mt=Ye(Mt))}le.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]},le.getDefaultWhiteList=function Ge(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}},le.onTag=function xe(Mt,Hr,Ir){},le.onIgnoreTag=function je(Mt,Hr,Ir){},le.onTagAttr=function We(Mt,Hr,Ir){},le.onIgnoreTagAttr=function Ne(Mt,Hr,Ir){},le.safeAttrValue=function Oe(Mt,Hr,Ir,gi){if(Ir=at(Ir),"href"===Hr||"src"===Hr){if("#"===(Ir=Ie.trim(Ir)))return"#";if("http://"!==Ir.substr(0,7)&&"https://"!==Ir.substr(0,8)&&"mailto:"!==Ir.substr(0,7)&&"tel:"!==Ir.substr(0,4)&&"data:image/"!==Ir.substr(0,11)&&"ftp://"!==Ir.substr(0,6)&&"./"!==Ir.substr(0,2)&&"../"!==Ir.substr(0,3)&&"#"!==Ir[0]&&"/"!==Ir[0])return""}else if("background"===Hr){if(qe.lastIndex=0,qe.test(Ir))return""}else if("style"===Hr){if(be.lastIndex=0,be.test(Ir)||(tt.lastIndex=0,tt.test(Ir)&&(qe.lastIndex=0,qe.test(Ir))))return"";!1!==gi&&(Ir=(gi=gi||Je).process(Ir))}return yt(Ir)},le.escapeHtml=we,le.escapeQuote=Ye,le.unescapeQuote=ze,le.escapeHtmlEntities=et,le.escapeDangerHtml5Entities=ke,le.clearNonPrintableCharacter=ot,le.friendlyAttrValue=at,le.escapeAttrValue=yt,le.onIgnoreTagStripAll=function wt(){return""},le.StripTagBody=function zt(Mt,Hr){"function"!=typeof Hr&&(Hr=function(){});var Ir=!Array.isArray(Mt),Ui=[],is=!1;return{onIgnoreTag:function(ss,ts,ys){if(function gi(ss){return!!Ir||-1!==Ie.indexOf(Mt,ss)}(ss)){if(ys.isClosing){var ps="[/removed]";return Ui.push([!1!==is?is:ys.position,ys.position+ps.length]),is=!1,ps}return is||(is=ys.position),"[removed]"}return Hr(ss,ts,ys)},remove:function(ss){var ts="",ys=0;return Ie.forEach(Ui,function(ps){ts+=ss.slice(ys,ps[0]),ys=ps[1]}),ts+=ss.slice(ys)}}},le.stripCommentTag=function Rt(Mt){for(var Hr="",Ir=0;Ir<Mt.length;){var gi=Mt.indexOf("\x3c!--",Ir);if(-1===gi){Hr+=Mt.slice(Ir);break}Hr+=Mt.slice(Ir,gi);var Ui=Mt.indexOf("--\x3e",gi);if(-1===Ui)break;Ir=Ui+3}return Hr},le.stripBlankChar=function Ft(Mt){var Hr=Mt.split("");return(Hr=Hr.filter(function(Ir){var gi=Ir.charCodeAt(0);return!(127===gi||gi<=31&&10!==gi&&13!==gi)})).join("")},le.cssFilter=Je,le.getDefaultCSSWhiteList=Ce;var bt={},St=Te;function Xt(Mt){var Hr=St.spaceIndex(Mt);if(-1===Hr)var Ir=Mt.slice(1,-1);else Ir=Mt.slice(1,Hr+1);return"/"===(Ir=St.trim(Ir).toLowerCase()).slice(0,1)&&(Ir=Ir.slice(1)),"/"===Ir.slice(-1)&&(Ir=Ir.slice(0,-1)),Ir}function Mr(Mt){return"</"===Mt.slice(0,2)}var Yr=/[^a-zA-Z0-9_:\.\-]/gim;function ct(Mt,Hr){for(;Hr<Mt.length;Hr++){var Ir=Mt[Hr];if(" "!==Ir)return"="===Ir?Hr:-1}}function jt(Mt,Hr){for(;Hr>0;Hr--){var Ir=Mt[Hr];if(" "!==Ir)return"="===Ir?Hr:-1}}function er(Mt){return function qt(Mt){return'"'===Mt[0]&&'"'===Mt[Mt.length-1]||"'"===Mt[0]&&"'"===Mt[Mt.length-1]}(Mt)?Mt.substr(1,Mt.length-2):Mt}bt.parseTag=function Cr(Mt,Hr,Ir){var gi="",Ui=0,is=!1,ss=!1,ts=0,ys=Mt.length,ps="",Ds="";e:for(ts=0;ts<ys;ts++){var Ps=Mt.charAt(ts);if(!1===is){if("<"===Ps){is=ts;continue}}else if(!1===ss){if("<"===Ps){gi+=Ir(Mt.slice(Ui,ts)),is=ts,Ui=ts;continue}if(">"===Ps){gi+=Ir(Mt.slice(Ui,is)),ps=Xt(Ds=Mt.slice(is,ts+1)),gi+=Hr(is,gi.length,ps,Ds,Mr(Ds)),Ui=ts+1,is=!1;continue}if('"'===Ps||"'"===Ps)for(var ms=1,Un=Mt.charAt(ts-ms);""===Un.trim()||"="===Un;){if("="===Un){ss=Ps;continue e}Un=Mt.charAt(ts-++ms)}}else if(Ps===ss){ss=!1;continue}}return Ui<Mt.length&&(gi+=Ir(Mt.substr(Ui))),gi},bt.parseAttr=function Lr(Mt,Hr){var Ir=0,gi=[],Ui=!1,is=Mt.length;function ss(Ps,ms){if(!((Ps=(Ps=St.trim(Ps)).replace(Yr,"").toLowerCase()).length<1)){var Un=Hr(Ps,ms||"");Un&&gi.push(Un)}}for(var ts=0;ts<is;ts++){var Ds,ys=Mt.charAt(ts);if(!1!==Ui||"="!==ys)if(!1===Ui||ts!==Ir||'"'!==ys&&"'"!==ys||"="!==Mt.charAt(ts-1)){if(/\s|\n|\t/.test(ys)){if(Mt=Mt.replace(/\s|\n|\t/g," "),!1===Ui){if(-1===(Ds=ct(Mt,ts))){ss(St.trim(Mt.slice(Ir,ts))),Ui=!1,Ir=ts+1;continue}ts=Ds-1;continue}if(-1===(Ds=jt(Mt,ts-1))){ss(Ui,er(St.trim(Mt.slice(Ir,ts)))),Ui=!1,Ir=ts+1;continue}}}else{if(-1===(Ds=Mt.indexOf(ys,ts+1)))break;ss(Ui,St.trim(Mt.slice(Ir+1,Ds))),Ui=!1,Ir=(ts=Ds)+1}else Ui=Mt.slice(Ir,ts),Ir=ts+1}return Ir<Mt.length&&(!1===Ui?ss(Mt.slice(Ir)):ss(Ui,er(St.trim(Mt.slice(Ir))))),St.trim(gi.join(" "))};var Zt=Y.exports.FilterCSS,tr=le,fr=bt.parseTag,Ur=bt.parseAttr,Br=Te;function Zr(Mt){return null==Mt}function Dr(Mt){(Mt=function hr(Mt){var Hr={};for(var Ir in Mt)Hr[Ir]=Mt[Ir];return Hr}(Mt||{})).stripIgnoreTag&&(Mt.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),Mt.onIgnoreTag=tr.onIgnoreTagStripAll),Mt.whiteList=Mt.whiteList||Mt.allowList||tr.whiteList,Mt.onTag=Mt.onTag||tr.onTag,Mt.onTagAttr=Mt.onTagAttr||tr.onTagAttr,Mt.onIgnoreTag=Mt.onIgnoreTag||tr.onIgnoreTag,Mt.onIgnoreTagAttr=Mt.onIgnoreTagAttr||tr.onIgnoreTagAttr,Mt.safeAttrValue=Mt.safeAttrValue||tr.safeAttrValue,Mt.escapeHtml=Mt.escapeHtml||tr.escapeHtml,this.options=Mt,!1===Mt.css?this.cssFilter=!1:(Mt.css=Mt.css||{},this.cssFilter=new Zt(Mt.css))}Dr.prototype.process=function(Mt){if(!(Mt=(Mt=Mt||"").toString()))return"";var Ir=this.options,gi=Ir.whiteList,Ui=Ir.onTag,is=Ir.onIgnoreTag,ss=Ir.onTagAttr,ts=Ir.onIgnoreTagAttr,ys=Ir.safeAttrValue,ps=Ir.escapeHtml,Ds=this.cssFilter;Ir.stripBlankChar&&(Mt=tr.stripBlankChar(Mt)),Ir.allowCommentTag||(Mt=tr.stripCommentTag(Mt));var Ps=!1;Ir.stripIgnoreTagBody&&(Ps=tr.StripTagBody(Ir.stripIgnoreTagBody,is),is=Ps.onIgnoreTag);var ms=fr(Mt,function(Un,gr,Sr,mr,Wr){var Wi,Di={sourcePosition:Un,position:gr,isClosing:Wr,isWhite:gi.hasOwnProperty(Sr)};if(!Zr(Wi=Ui(Sr,mr,Di)))return Wi;if(Di.isWhite){if(Di.isClosing)return"</"+Sr+">";var ns=function ri(Mt){var Hr=Br.spaceIndex(Mt);if(-1===Hr)return{html:"",closing:"/"===Mt[Mt.length-2]};var Ir="/"===(Mt=Br.trim(Mt.slice(Hr+1,-1)))[Mt.length-1];return Ir&&(Mt=Br.trim(Mt.slice(0,-1))),{html:Mt,closing:Ir}}(mr),Yi=gi[Sr],hs=Ur(ns.html,function(Ms,Zs){var So,tn=-1!==Br.indexOf(Yi,Ms);return Zr(So=ss(Sr,Ms,Zs,tn))?tn?(Zs=ys(Sr,Ms,Zs,Ds))?Ms+'="'+Zs+'"':Ms:Zr(So=ts(Sr,Ms,Zs,tn))?void 0:So:So});return mr="<"+Sr,hs&&(mr+=" "+hs),ns.closing&&(mr+=" /"),mr+">"}return Zr(Wi=is(Sr,mr,Di))?ps(mr):Wi},ps);return Ps&&(ms=Ps.remove(ms)),ms};var Kr=Dr;!function(Mt,Hr){var Ir=le,gi=bt,Ui=Kr;function is(ys,ps){return new Ui(ps).process(ys)}for(var ss in(Hr=Mt.exports=is).filterXSS=is,Hr.FilterXSS=Ui,Ir)Hr[ss]=Ir[ss];for(var ss in gi)Hr[ss]=gi[ss];(function ts(){return"undefined"!=typeof self&&"undefined"!=typeof DedicatedWorkerGlobalScope&&self instanceof DedicatedWorkerGlobalScope})()&&(self.filterXSS=Mt.exports)}(oe,oe.exports);var Pr,Fr,Nt=function(){function Mt(Hr,Ir){var Ui,gi=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(is,ss,ts,ys){return"a"===is&&"href"===ss||("img"===is||"source"===is)&&"src"===ss?gi.sanitizeUrl(ts):oe.exports.safeAttrValue(is,ss,ts,ys)}},Hr&&!Ir?Ui=Hr:Hr&&Ir?(Ui=Object.create(this.arcgisFilterOptions),Object.keys(Hr).forEach(function(is){"whiteList"===is?Ui.whiteList=gi._extendObjectOfArrays([gi.arcgisWhiteList,Hr.whiteList||{}]):Ui[is]=Hr[is]})):(Ui=Object.create(this.arcgisFilterOptions)).whiteList=this.arcgisWhiteList,this.xssFilterOptions=Ui,this._xssFilter=new oe.exports.FilterXSS(Ui)}return Mt.prototype.sanitize=function(Hr,Ir){switch(void 0===Ir&&(Ir={}),typeof Hr){case"number":return isNaN(Hr)||!isFinite(Hr)?null:Hr;case"boolean":return Hr;case"string":return this._xssFilter.process(Hr);case"object":return this._iterateOverObject(Hr,Ir);default:return Ir.allowUndefined&&void 0===Hr?void 0:null}},Mt.prototype.sanitizeUrl=function(Hr,Ir){var gi=(null!=Ir?Ir:{}).isProtocolRequired,Ui=void 0===gi||gi,is=this._trim(Hr.substring(0,Hr.indexOf(":"))),ss="/"===Hr,ts=/^#/.test(Hr),ys=is&&this.allowedProtocols.indexOf(is.toLowerCase())>-1;return ss||ts||ys?oe.exports.escapeAttrValue(Hr):is||Ui?"":oe.exports.escapeAttrValue("https://".concat(Hr))},Mt.prototype.sanitizeHTMLAttribute=function(Hr,Ir,gi,Ui){return"function"==typeof this.xssFilterOptions.safeAttrValue?this.xssFilterOptions.safeAttrValue(Hr,Ir,gi,Ui):oe.exports.safeAttrValue(Hr,Ir,gi,Ui)},Mt.prototype.validate=function(Hr,Ir){void 0===Ir&&(Ir={});var gi=this.sanitize(Hr,Ir);return{isValid:Hr===gi,sanitized:gi}},Mt.prototype._extendObjectOfArrays=function(Hr){var Ir={};return Hr.forEach(function(gi){Object.keys(gi).forEach(function(Ui){Ir[Ui]=Array.isArray(gi[Ui])&&Array.isArray(Ir[Ui])?Ir[Ui].concat(gi[Ui]):gi[Ui]})}),Ir},Mt.prototype._iterateOverObject=function(Hr,Ir){var gi=this;void 0===Ir&&(Ir={});try{var Ui=!1,is=void 0;if(Array.isArray(Hr))is=Hr.reduce(function(ts,ys){var ps=gi.validate(ys,Ir);return ps.isValid?ts.concat([ys]):(Ui=!0,ts.concat([ps.sanitized]))},[]);else{if(!function ue(Mt){if(!function ie(Mt){return!!Mt&&"object"==typeof Mt}(Mt)||"[object Object]"!=B.call(Mt)||function A(Mt){var Hr=!1;if(null!=Mt&&"function"!=typeof Mt.toString)try{Hr=!!(Mt+"")}catch(Ir){}return Hr}(Mt))return!1;var Hr=Z(Mt);if(null===Hr)return!0;var Ir=J.call(Hr,"constructor")&&Hr.constructor;return"function"==typeof Ir&&Ir instanceof Ir&&re.call(Ir)==W}(Hr))return Ir.allowUndefined&&void 0===Hr?void 0:null;is=Object.keys(Hr).reduce(function(ts,ys){var ps=Hr[ys],Ds=gi.validate(ps,Ir);return Ds.isValid?ts[ys]=ps:(Ui=!0,ts[ys]=Ds.sanitized),ts},{})}return Ui?is:Hr}catch(ts){return null}},Mt.prototype._trim=function(Hr){return String.prototype.trim?Hr.trim():Hr.replace(/(^\s*)|(\s*$)/g,"")},Mt}(),lr=T(35575),jr=T(54024),rr=(T(8314),T(63290)),pr=T(66950),mi=function(Mt){Pr||function(Mt){if("WebkitTransition"in Mt.style)Pr="webkitTransitionEnd",Fr="webkitAnimationEnd";else{if(!("transition"in Mt.style))throw new Error("Your browser is not supported!");Pr="transitionend",Fr="animationend"}}(Mt)},wi=function(Mt,Hr){return void 0===Hr&&(Hr=Mt+"-active"),function(Ir){mi(Ir);var gi=!1,Ui=function(is){gi||(gi=!0,Ir.removeEventListener(Pr,Ui),Ir.removeEventListener(Fr,Ui),Ir.classList.remove(Mt),Ir.classList.remove(Hr))};Ir.classList.add(Mt),Ir.addEventListener(Pr,Ui),Ir.addEventListener(Fr,Ui),requestAnimationFrame(function(){Ir.classList.add(Hr)})}},Qr=function(Mt,Hr){return void 0===Hr&&(Hr=Mt+"-active"),function(Ir,gi){mi(Ir);var Ui=!1,is=function(ss){Ui||(Ui=!0,Ir.removeEventListener(Pr,is),Ir.removeEventListener(Fr,is),gi())};Ir.classList.add(Mt),Ir.addEventListener(Pr,is),Ir.addEventListener(Fr,is),requestAnimationFrame(function(){Ir.classList.add(Hr)})}};const Ni=rr.Z.getLogger("esri.widgets.support.widgetUtils");function Hs(Mt){const Hr=lr.Z.acquire();for(let gi=0;gi<arguments.length;gi++){const Ui=arguments[gi],is=typeof Ui;if("string"===is)Hr.push(Ui);else if(Array.isArray(Ui))Hr.push.apply(Hr,Ui);else if("object"===is)for(const ss in Ui)Ui[ss]&&Hr.push(ss)}const Ir=Hr.join(" ");return lr.Z.release(Hr),Ir}const Ar=(()=>{const Mt=new Map,Hr=new ResizeObserver(Ir=>{(0,pr.Uy)();for(const gi of Ir)Mt.get(gi.target)(gi)});return(Ir,gi,Ui)=>(Mt.has(Ir)&&Ni.error("Already observing element",Ir),Mt.set(Ir,gi),Hr.observe(Ir,Ui),(0,jr.kB)(()=>{Hr.unobserve(Ir),Mt.delete(Ir)}))})();function ni(Mt){const Hr=null==Mt?void 0:Mt.closest("[dir]");return null!==Hr&&Hr instanceof HTMLElement&&"rtl"===Hr.dir||"rtl"===document.dir}function _i(Mt){return ni(Mt)?"rtl":"ltr"}function Ii(Mt){this[Mt.getAttribute("data-node-ref")]=null}function ji(Mt){this[Mt.getAttribute("data-node-ref")]=Mt}function Gi(Mt,Hr){return("enter"===Mt?wi:Qr)(Hr)}const zr=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"].reduce((Mt,Hr)=>(Mt[Hr]=[],Mt),{}),gs=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],hi=new Nt({whiteList:zr,onTagAttr:(Mt,Hr,Ir)=>{const gi=`${Hr}="${Ir}"`;if(gs.includes(Hr))return gi},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function ln(Mt,Hr){const Ir=Mt.getBoundingClientRect(),gi=Hr.getBoundingClientRect();(Ir.top+Ir.height>gi.top+gi.height||Ir.top<gi.top)&&Mt.scrollIntoView({block:"end"})}function ds(Mt){return"Enter"===Mt||" "===Mt}},15861:(dt,Re,T)=>{"use strict";function x(G,Q,H,re,J,W,B){try{var Z=G[W](B),ie=Z.value}catch(ue){return void H(ue)}Z.done?Q(ie):Promise.resolve(ie).then(re,J)}function A(G){return function(){var Q=this,H=arguments;return new Promise(function(re,J){var W=G.apply(Q,H);function B(ie){x(W,re,J,B,Z,"next",ie)}function Z(ie){x(W,re,J,B,Z,"throw",ie)}B(void 0)})}}T.d(Re,{Z:()=>A})}}]);